// Generated by Futhark 0.26.0 (prerelease - include info below when reporting bugs).
// git: 1de4f0c (Fri Jan 24 11:10:52 2025 +0100)
// Compiled with GHC 9.4.8.

// We need to define _GNU_SOURCE before
// _any_ headers files are imported to get
// the usage statistics of a thread (i.e. have RUSAGE_THREAD) on GNU/Linux
// https://manpages.courier-mta.org/htmlman2/getrusage.2.html
#ifndef _GNU_SOURCE // Avoid possible double-definition warning.
#define _GNU_SOURCE
#endif

#ifdef __clang__
#pragma clang diagnostic ignored "-Wunused-function"
#pragma clang diagnostic ignored "-Wunused-variable"
#pragma clang diagnostic ignored "-Wunused-const-variable"
#pragma clang diagnostic ignored "-Wparentheses"
#pragma clang diagnostic ignored "-Wunused-label"
#pragma clang diagnostic ignored "-Wunused-but-set-variable"
#elif __GNUC__
#pragma GCC diagnostic ignored "-Wunused-function"
#pragma GCC diagnostic ignored "-Wunused-variable"
#pragma GCC diagnostic ignored "-Wunused-const-variable"
#pragma GCC diagnostic ignored "-Wparentheses"
#pragma GCC diagnostic ignored "-Wunused-label"
#pragma GCC diagnostic ignored "-Wunused-but-set-variable"
#endif

// Headers
#include <stdint.h>
#include <stddef.h>
#include <stdbool.h>
#include <stdio.h>
#include <float.h>

#include <cuda.h>
#include <cuda_runtime.h>
#include <nvrtc.h>

#ifdef __cplusplus
extern "C" {
#endif

// Initialisation
struct futhark_context_config;
struct futhark_context_config *futhark_context_config_new(void);
void futhark_context_config_free(struct futhark_context_config *cfg);
int futhark_context_config_set_tuning_param(struct futhark_context_config *cfg, const char *param_name, size_t new_value);
struct futhark_context;
struct futhark_context *futhark_context_new(struct futhark_context_config *cfg);
void futhark_context_free(struct futhark_context *cfg);
void futhark_context_config_set_default_thread_block_size(struct futhark_context_config *cfg, int size);
void futhark_context_config_set_default_grid_size(struct futhark_context_config *cfg, int size);
void futhark_context_config_set_default_group_size(struct futhark_context_config *cfg, int size);
void futhark_context_config_set_default_num_groups(struct futhark_context_config *cfg, int size);
void futhark_context_config_set_default_tile_size(struct futhark_context_config *cfg, int size);
void futhark_context_config_set_default_reg_tile_size(struct futhark_context_config *cfg, int size);
void futhark_context_config_set_default_registers(struct futhark_context_config *cfg, int size);
void futhark_context_config_set_default_cache(struct futhark_context_config *cfg, int size);
void futhark_context_config_set_default_threshold(struct futhark_context_config *cfg, int size);
void futhark_context_config_set_unified_memory(struct futhark_context_config *cfg, int flag);
void futhark_context_config_add_nvrtc_option(struct futhark_context_config *cfg, const char *opt);
void futhark_context_config_set_device(struct futhark_context_config *cfg, const char *s);
const char *futhark_context_config_get_program(struct futhark_context_config *cfg);
void futhark_context_config_set_program(struct futhark_context_config *cfg, const char *s);
void futhark_context_config_dump_ptx_to(struct futhark_context_config *cfg, const char *s);
void futhark_context_config_load_ptx_from(struct futhark_context_config *cfg, const char *s);
void futhark_context_config_set_debugging(struct futhark_context_config *cfg, int flag);
void futhark_context_config_set_profiling(struct futhark_context_config *cfg, int flag);
void futhark_context_config_set_logging(struct futhark_context_config *cfg, int flag);
int futhark_get_tuning_param_count(void);
const char *futhark_get_tuning_param_name(int);
const char *futhark_get_tuning_param_class(int);

// Arrays
struct futhark_bool_1d;
struct futhark_bool_1d *futhark_new_bool_1d(struct futhark_context *ctx, const bool *data, int64_t dim0);
struct futhark_bool_1d *futhark_new_raw_bool_1d(struct futhark_context *ctx, CUdeviceptr data, int64_t dim0);
int futhark_free_bool_1d(struct futhark_context *ctx, struct futhark_bool_1d *arr);
int futhark_values_bool_1d(struct futhark_context *ctx, struct futhark_bool_1d *arr, bool *data);
int futhark_index_bool_1d(struct futhark_context *ctx, bool *out, struct futhark_bool_1d *arr, int64_t i0);
CUdeviceptr futhark_values_raw_bool_1d(struct futhark_context *ctx, struct futhark_bool_1d *arr);
const int64_t *futhark_shape_bool_1d(struct futhark_context *ctx, struct futhark_bool_1d *arr);
struct futhark_f64_1d;
struct futhark_f64_1d *futhark_new_f64_1d(struct futhark_context *ctx, const double *data, int64_t dim0);
struct futhark_f64_1d *futhark_new_raw_f64_1d(struct futhark_context *ctx, CUdeviceptr data, int64_t dim0);
int futhark_free_f64_1d(struct futhark_context *ctx, struct futhark_f64_1d *arr);
int futhark_values_f64_1d(struct futhark_context *ctx, struct futhark_f64_1d *arr, double *data);
int futhark_index_f64_1d(struct futhark_context *ctx, double *out, struct futhark_f64_1d *arr, int64_t i0);
CUdeviceptr futhark_values_raw_f64_1d(struct futhark_context *ctx, struct futhark_f64_1d *arr);
const int64_t *futhark_shape_f64_1d(struct futhark_context *ctx, struct futhark_f64_1d *arr);
struct futhark_i64_1d;
struct futhark_i64_1d *futhark_new_i64_1d(struct futhark_context *ctx, const int64_t *data, int64_t dim0);
struct futhark_i64_1d *futhark_new_raw_i64_1d(struct futhark_context *ctx, CUdeviceptr data, int64_t dim0);
int futhark_free_i64_1d(struct futhark_context *ctx, struct futhark_i64_1d *arr);
int futhark_values_i64_1d(struct futhark_context *ctx, struct futhark_i64_1d *arr, int64_t *data);
int futhark_index_i64_1d(struct futhark_context *ctx, int64_t *out, struct futhark_i64_1d *arr, int64_t i0);
CUdeviceptr futhark_values_raw_i64_1d(struct futhark_context *ctx, struct futhark_i64_1d *arr);
const int64_t *futhark_shape_i64_1d(struct futhark_context *ctx, struct futhark_i64_1d *arr);

// Opaque values
struct futhark_opaque_00764e1f7379f14f22282d21712a8514;
struct futhark_opaque_5797e930517e531e6d939a24b1db07bd;
struct futhark_opaque_tup2_f64_f64;
struct futhark_opaque_tup2_i64_i64;
struct futhark_opaque_arr1d_tup2_f64_f64;
struct futhark_opaque_arr1d_tup2_i64_i64;
struct futhark_opaque_collisionTable;
struct futhark_opaque_dbcHandler_double;
struct futhark_opaque_flushedData_double;
struct futhark_opaque_8b7e80c3fb80a9a7700efe8e89371deb;
struct futhark_opaque_a8fdbed66266f52db9d5a0da8b1f6763;
struct futhark_opaque_4dedc823193c594b5c01727ae8ac5943;
int futhark_free_opaque_00764e1f7379f14f22282d21712a8514(struct futhark_context *ctx, struct futhark_opaque_00764e1f7379f14f22282d21712a8514 *obj);
int futhark_store_opaque_00764e1f7379f14f22282d21712a8514(struct futhark_context *ctx, const struct futhark_opaque_00764e1f7379f14f22282d21712a8514 *obj, void **p, size_t *n);
struct futhark_opaque_00764e1f7379f14f22282d21712a8514 *futhark_restore_opaque_00764e1f7379f14f22282d21712a8514(struct futhark_context *ctx, const void *p);
int futhark_new_opaque_00764e1f7379f14f22282d21712a8514_degrees(struct futhark_context *ctx, struct futhark_opaque_00764e1f7379f14f22282d21712a8514 **out);
int futhark_destruct_opaque_00764e1f7379f14f22282d21712a8514_degrees(struct futhark_context *ctx, const struct futhark_opaque_00764e1f7379f14f22282d21712a8514 *obj);
int futhark_new_opaque_00764e1f7379f14f22282d21712a8514_radians(struct futhark_context *ctx, struct futhark_opaque_00764e1f7379f14f22282d21712a8514 **out);
int futhark_destruct_opaque_00764e1f7379f14f22282d21712a8514_radians(struct futhark_context *ctx, const struct futhark_opaque_00764e1f7379f14f22282d21712a8514 *obj);
int futhark_variant_opaque_00764e1f7379f14f22282d21712a8514(struct futhark_context *ctx, const struct futhark_opaque_00764e1f7379f14f22282d21712a8514 *v);
int futhark_free_opaque_5797e930517e531e6d939a24b1db07bd(struct futhark_context *ctx, struct futhark_opaque_5797e930517e531e6d939a24b1db07bd *obj);
int futhark_store_opaque_5797e930517e531e6d939a24b1db07bd(struct futhark_context *ctx, const struct futhark_opaque_5797e930517e531e6d939a24b1db07bd *obj, void **p, size_t *n);
struct futhark_opaque_5797e930517e531e6d939a24b1db07bd *futhark_restore_opaque_5797e930517e531e6d939a24b1db07bd(struct futhark_context *ctx, const void *p);
int futhark_new_opaque_5797e930517e531e6d939a24b1db07bd_euclidean(struct futhark_context *ctx, struct futhark_opaque_5797e930517e531e6d939a24b1db07bd **out);
int futhark_destruct_opaque_5797e930517e531e6d939a24b1db07bd_euclidean(struct futhark_context *ctx, const struct futhark_opaque_5797e930517e531e6d939a24b1db07bd *obj);
int futhark_new_opaque_5797e930517e531e6d939a24b1db07bd_haversine(struct futhark_context *ctx, struct futhark_opaque_5797e930517e531e6d939a24b1db07bd **out);
int futhark_destruct_opaque_5797e930517e531e6d939a24b1db07bd_haversine(struct futhark_context *ctx, const struct futhark_opaque_5797e930517e531e6d939a24b1db07bd *obj);
int futhark_variant_opaque_5797e930517e531e6d939a24b1db07bd(struct futhark_context *ctx, const struct futhark_opaque_5797e930517e531e6d939a24b1db07bd *v);
int futhark_free_opaque_tup2_f64_f64(struct futhark_context *ctx, struct futhark_opaque_tup2_f64_f64 *obj);
int futhark_store_opaque_tup2_f64_f64(struct futhark_context *ctx, const struct futhark_opaque_tup2_f64_f64 *obj, void **p, size_t *n);
struct futhark_opaque_tup2_f64_f64 *futhark_restore_opaque_tup2_f64_f64(struct futhark_context *ctx, const void *p);
int futhark_project_opaque_tup2_f64_f64_0(struct futhark_context *ctx, double *out, const struct futhark_opaque_tup2_f64_f64 *obj);
int futhark_project_opaque_tup2_f64_f64_1(struct futhark_context *ctx, double *out, const struct futhark_opaque_tup2_f64_f64 *obj);
int futhark_new_opaque_tup2_f64_f64(struct futhark_context *ctx, struct futhark_opaque_tup2_f64_f64 **out, const double f_0, const double f_1);
int futhark_free_opaque_tup2_i64_i64(struct futhark_context *ctx, struct futhark_opaque_tup2_i64_i64 *obj);
int futhark_store_opaque_tup2_i64_i64(struct futhark_context *ctx, const struct futhark_opaque_tup2_i64_i64 *obj, void **p, size_t *n);
struct futhark_opaque_tup2_i64_i64 *futhark_restore_opaque_tup2_i64_i64(struct futhark_context *ctx, const void *p);
int futhark_project_opaque_tup2_i64_i64_0(struct futhark_context *ctx, int64_t *out, const struct futhark_opaque_tup2_i64_i64 *obj);
int futhark_project_opaque_tup2_i64_i64_1(struct futhark_context *ctx, int64_t *out, const struct futhark_opaque_tup2_i64_i64 *obj);
int futhark_new_opaque_tup2_i64_i64(struct futhark_context *ctx, struct futhark_opaque_tup2_i64_i64 **out, const int64_t f_0, const int64_t f_1);
int futhark_free_opaque_arr1d_tup2_f64_f64(struct futhark_context *ctx, struct futhark_opaque_arr1d_tup2_f64_f64 *obj);
int futhark_store_opaque_arr1d_tup2_f64_f64(struct futhark_context *ctx, const struct futhark_opaque_arr1d_tup2_f64_f64 *obj, void **p, size_t *n);
struct futhark_opaque_arr1d_tup2_f64_f64 *futhark_restore_opaque_arr1d_tup2_f64_f64(struct futhark_context *ctx, const void *p);
int futhark_project_opaque_arr1d_tup2_f64_f64_0(struct futhark_context *ctx, struct futhark_f64_1d **out, const struct futhark_opaque_arr1d_tup2_f64_f64 *obj);
int futhark_project_opaque_arr1d_tup2_f64_f64_1(struct futhark_context *ctx, struct futhark_f64_1d **out, const struct futhark_opaque_arr1d_tup2_f64_f64 *obj);
int futhark_zip_opaque_arr1d_tup2_f64_f64(struct futhark_context *ctx, struct futhark_opaque_arr1d_tup2_f64_f64 **out, const struct futhark_f64_1d *f_0, const struct futhark_f64_1d *f_1);
int futhark_index_opaque_arr1d_tup2_f64_f64(struct futhark_context *ctx, struct futhark_opaque_tup2_f64_f64 **out, struct futhark_opaque_arr1d_tup2_f64_f64 *arr, int64_t i0);
const int64_t *futhark_shape_opaque_arr1d_tup2_f64_f64(struct futhark_context *ctx, struct futhark_opaque_arr1d_tup2_f64_f64 *arr);
int futhark_free_opaque_arr1d_tup2_i64_i64(struct futhark_context *ctx, struct futhark_opaque_arr1d_tup2_i64_i64 *obj);
int futhark_store_opaque_arr1d_tup2_i64_i64(struct futhark_context *ctx, const struct futhark_opaque_arr1d_tup2_i64_i64 *obj, void **p, size_t *n);
struct futhark_opaque_arr1d_tup2_i64_i64 *futhark_restore_opaque_arr1d_tup2_i64_i64(struct futhark_context *ctx, const void *p);
int futhark_project_opaque_arr1d_tup2_i64_i64_0(struct futhark_context *ctx, struct futhark_i64_1d **out, const struct futhark_opaque_arr1d_tup2_i64_i64 *obj);
int futhark_project_opaque_arr1d_tup2_i64_i64_1(struct futhark_context *ctx, struct futhark_i64_1d **out, const struct futhark_opaque_arr1d_tup2_i64_i64 *obj);
int futhark_zip_opaque_arr1d_tup2_i64_i64(struct futhark_context *ctx, struct futhark_opaque_arr1d_tup2_i64_i64 **out, const struct futhark_i64_1d *f_0, const struct futhark_i64_1d *f_1);
int futhark_index_opaque_arr1d_tup2_i64_i64(struct futhark_context *ctx, struct futhark_opaque_tup2_i64_i64 **out, struct futhark_opaque_arr1d_tup2_i64_i64 *arr, int64_t i0);
const int64_t *futhark_shape_opaque_arr1d_tup2_i64_i64(struct futhark_context *ctx, struct futhark_opaque_arr1d_tup2_i64_i64 *arr);
int futhark_free_opaque_collisionTable(struct futhark_context *ctx, struct futhark_opaque_collisionTable *obj);
int futhark_store_opaque_collisionTable(struct futhark_context *ctx, const struct futhark_opaque_collisionTable *obj, void **p, size_t *n);
struct futhark_opaque_collisionTable *futhark_restore_opaque_collisionTable(struct futhark_context *ctx, const void *p);
int futhark_project_opaque_collisionTable_chain_id(struct futhark_context *ctx, struct futhark_i64_1d **out, const struct futhark_opaque_collisionTable *obj);
int futhark_project_opaque_collisionTable_replaceWith(struct futhark_context *ctx, struct futhark_i64_1d **out, const struct futhark_opaque_collisionTable *obj);
int futhark_new_opaque_collisionTable(struct futhark_context *ctx, struct futhark_opaque_collisionTable **out, const struct futhark_i64_1d *f_chain_id, const struct futhark_i64_1d *f_replaceWith);
int futhark_free_opaque_dbcHandler_double(struct futhark_context *ctx, struct futhark_opaque_dbcHandler_double *obj);
int futhark_store_opaque_dbcHandler_double(struct futhark_context *ctx, const struct futhark_opaque_dbcHandler_double *obj, void **p, size_t *n);
struct futhark_opaque_dbcHandler_double *futhark_restore_opaque_dbcHandler_double(struct futhark_context *ctx, const void *p);
int futhark_project_opaque_dbcHandler_double_chain_collisions(struct futhark_context *ctx, struct futhark_opaque_arr1d_tup2_i64_i64 **out, const struct futhark_opaque_dbcHandler_double *obj);
int futhark_project_opaque_dbcHandler_double_clBase(struct futhark_context *ctx, struct futhark_opaque_8b7e80c3fb80a9a7700efe8e89371deb **out, const struct futhark_opaque_dbcHandler_double *obj);
int futhark_project_opaque_dbcHandler_double_clProc(struct futhark_context *ctx, struct futhark_opaque_a8fdbed66266f52db9d5a0da8b1f6763 **out, const struct futhark_opaque_dbcHandler_double *obj);
int futhark_project_opaque_dbcHandler_double_current_partition(struct futhark_context *ctx, struct futhark_opaque_4dedc823193c594b5c01727ae8ac5943 **out, const struct futhark_opaque_dbcHandler_double *obj);
int futhark_project_opaque_dbcHandler_double_toFlush_dat(struct futhark_context *ctx, struct futhark_opaque_arr1d_tup2_f64_f64 **out, const struct futhark_opaque_dbcHandler_double *obj);
int futhark_project_opaque_dbcHandler_double_toFlush_ids(struct futhark_context *ctx, struct futhark_i64_1d **out, const struct futhark_opaque_dbcHandler_double *obj);
int futhark_new_opaque_dbcHandler_double(struct futhark_context *ctx, struct futhark_opaque_dbcHandler_double **out, const struct futhark_opaque_arr1d_tup2_i64_i64 *f_chain_collisions, const struct futhark_opaque_8b7e80c3fb80a9a7700efe8e89371deb *f_clBase, const struct futhark_opaque_a8fdbed66266f52db9d5a0da8b1f6763 *f_clProc, const struct futhark_opaque_4dedc823193c594b5c01727ae8ac5943 *f_current_partition, const struct futhark_opaque_arr1d_tup2_f64_f64 *f_toFlush_dat, const struct futhark_i64_1d *f_toFlush_ids);
int futhark_free_opaque_flushedData_double(struct futhark_context *ctx, struct futhark_opaque_flushedData_double *obj);
int futhark_store_opaque_flushedData_double(struct futhark_context *ctx, const struct futhark_opaque_flushedData_double *obj, void **p, size_t *n);
struct futhark_opaque_flushedData_double *futhark_restore_opaque_flushedData_double(struct futhark_context *ctx, const void *p);
int futhark_project_opaque_flushedData_double_chain_ids(struct futhark_context *ctx, struct futhark_i64_1d **out, const struct futhark_opaque_flushedData_double *obj);
int futhark_project_opaque_flushedData_double_xs(struct futhark_context *ctx, struct futhark_f64_1d **out, const struct futhark_opaque_flushedData_double *obj);
int futhark_project_opaque_flushedData_double_ys(struct futhark_context *ctx, struct futhark_f64_1d **out, const struct futhark_opaque_flushedData_double *obj);
int futhark_new_opaque_flushedData_double(struct futhark_context *ctx, struct futhark_opaque_flushedData_double **out, const struct futhark_i64_1d *f_chain_ids, const struct futhark_f64_1d *f_xs, const struct futhark_f64_1d *f_ys);
int futhark_free_opaque_8b7e80c3fb80a9a7700efe8e89371deb(struct futhark_context *ctx, struct futhark_opaque_8b7e80c3fb80a9a7700efe8e89371deb *obj);
int futhark_store_opaque_8b7e80c3fb80a9a7700efe8e89371deb(struct futhark_context *ctx, const struct futhark_opaque_8b7e80c3fb80a9a7700efe8e89371deb *obj, void **p, size_t *n);
struct futhark_opaque_8b7e80c3fb80a9a7700efe8e89371deb *futhark_restore_opaque_8b7e80c3fb80a9a7700efe8e89371deb(struct futhark_context *ctx, const void *p);
int futhark_project_opaque_8b7e80c3fb80a9a7700efe8e89371deb_angle_t(struct futhark_context *ctx, struct futhark_opaque_00764e1f7379f14f22282d21712a8514 **out, const struct futhark_opaque_8b7e80c3fb80a9a7700efe8e89371deb *obj);
int futhark_project_opaque_8b7e80c3fb80a9a7700efe8e89371deb_dist_t(struct futhark_context *ctx, struct futhark_opaque_5797e930517e531e6d939a24b1db07bd **out, const struct futhark_opaque_8b7e80c3fb80a9a7700efe8e89371deb *obj);
int futhark_project_opaque_8b7e80c3fb80a9a7700efe8e89371deb_eps(struct futhark_context *ctx, double *out, const struct futhark_opaque_8b7e80c3fb80a9a7700efe8e89371deb *obj);
int futhark_project_opaque_8b7e80c3fb80a9a7700efe8e89371deb_m_size(struct futhark_context *ctx, int64_t *out, const struct futhark_opaque_8b7e80c3fb80a9a7700efe8e89371deb *obj);
int futhark_project_opaque_8b7e80c3fb80a9a7700efe8e89371deb_maxs(struct futhark_context *ctx, struct futhark_f64_1d **out, const struct futhark_opaque_8b7e80c3fb80a9a7700efe8e89371deb *obj);
int futhark_project_opaque_8b7e80c3fb80a9a7700efe8e89371deb_minPts(struct futhark_context *ctx, int64_t *out, const struct futhark_opaque_8b7e80c3fb80a9a7700efe8e89371deb *obj);
int futhark_project_opaque_8b7e80c3fb80a9a7700efe8e89371deb_mins(struct futhark_context *ctx, struct futhark_f64_1d **out, const struct futhark_opaque_8b7e80c3fb80a9a7700efe8e89371deb *obj);
int futhark_project_opaque_8b7e80c3fb80a9a7700efe8e89371deb_part_per_dim(struct futhark_context *ctx, struct futhark_i64_1d **out, const struct futhark_opaque_8b7e80c3fb80a9a7700efe8e89371deb *obj);
int futhark_project_opaque_8b7e80c3fb80a9a7700efe8e89371deb_radius(struct futhark_context *ctx, double *out, const struct futhark_opaque_8b7e80c3fb80a9a7700efe8e89371deb *obj);
int futhark_project_opaque_8b7e80c3fb80a9a7700efe8e89371deb_step_per_dim(struct futhark_context *ctx, struct futhark_f64_1d **out, const struct futhark_opaque_8b7e80c3fb80a9a7700efe8e89371deb *obj);
int futhark_project_opaque_8b7e80c3fb80a9a7700efe8e89371deb_total_partitions(struct futhark_context *ctx, int64_t *out, const struct futhark_opaque_8b7e80c3fb80a9a7700efe8e89371deb *obj);
int futhark_new_opaque_8b7e80c3fb80a9a7700efe8e89371deb(struct futhark_context *ctx, struct futhark_opaque_8b7e80c3fb80a9a7700efe8e89371deb **out, const struct futhark_opaque_00764e1f7379f14f22282d21712a8514 *f_angle_t, const struct futhark_opaque_5797e930517e531e6d939a24b1db07bd *f_dist_t, const double f_eps, const int64_t f_m_sizze, const struct futhark_f64_1d *f_maxs, const int64_t f_minPts, const struct futhark_f64_1d *f_mins, const struct futhark_i64_1d *f_part_per_dim, const double f_radius, const struct futhark_f64_1d *f_step_per_dim, const int64_t f_total_partitions);
int futhark_free_opaque_a8fdbed66266f52db9d5a0da8b1f6763(struct futhark_context *ctx, struct futhark_opaque_a8fdbed66266f52db9d5a0da8b1f6763 *obj);
int futhark_store_opaque_a8fdbed66266f52db9d5a0da8b1f6763(struct futhark_context *ctx, const struct futhark_opaque_a8fdbed66266f52db9d5a0da8b1f6763 *obj, void **p, size_t *n);
struct futhark_opaque_a8fdbed66266f52db9d5a0da8b1f6763 *futhark_restore_opaque_a8fdbed66266f52db9d5a0da8b1f6763(struct futhark_context *ctx, const void *p);
int futhark_project_opaque_a8fdbed66266f52db9d5a0da8b1f6763_buff_isCore(struct futhark_context *ctx, struct futhark_bool_1d **out, const struct futhark_opaque_a8fdbed66266f52db9d5a0da8b1f6763 *obj);
int futhark_project_opaque_a8fdbed66266f52db9d5a0da8b1f6763_buffered_ids(struct futhark_context *ctx, struct futhark_i64_1d **out, const struct futhark_opaque_a8fdbed66266f52db9d5a0da8b1f6763 *obj);
int futhark_project_opaque_a8fdbed66266f52db9d5a0da8b1f6763_buffered_pts(struct futhark_context *ctx, struct futhark_opaque_arr1d_tup2_f64_f64 **out, const struct futhark_opaque_a8fdbed66266f52db9d5a0da8b1f6763 *obj);
int futhark_project_opaque_a8fdbed66266f52db9d5a0da8b1f6763_chainOffs(struct futhark_context *ctx, int64_t *out, const struct futhark_opaque_a8fdbed66266f52db9d5a0da8b1f6763 *obj);
int futhark_project_opaque_a8fdbed66266f52db9d5a0da8b1f6763_cur_part_id(struct futhark_context *ctx, int64_t *out, const struct futhark_opaque_a8fdbed66266f52db9d5a0da8b1f6763 *obj);
int futhark_project_opaque_a8fdbed66266f52db9d5a0da8b1f6763_cur_part_order(struct futhark_context *ctx, int64_t *out, const struct futhark_opaque_a8fdbed66266f52db9d5a0da8b1f6763 *obj);
int futhark_project_opaque_a8fdbed66266f52db9d5a0da8b1f6763_isPartVisited(struct futhark_context *ctx, struct futhark_bool_1d **out, const struct futhark_opaque_a8fdbed66266f52db9d5a0da8b1f6763 *obj);
int futhark_project_opaque_a8fdbed66266f52db9d5a0da8b1f6763_next_offs(struct futhark_context *ctx, int64_t *out, const struct futhark_opaque_a8fdbed66266f52db9d5a0da8b1f6763 *obj);
int futhark_project_opaque_a8fdbed66266f52db9d5a0da8b1f6763_offs(struct futhark_context *ctx, int64_t *out, const struct futhark_opaque_a8fdbed66266f52db9d5a0da8b1f6763 *obj);
int futhark_project_opaque_a8fdbed66266f52db9d5a0da8b1f6763_relevantParts(struct futhark_context *ctx, struct futhark_i64_1d **out, const struct futhark_opaque_a8fdbed66266f52db9d5a0da8b1f6763 *obj);
int futhark_new_opaque_a8fdbed66266f52db9d5a0da8b1f6763(struct futhark_context *ctx, struct futhark_opaque_a8fdbed66266f52db9d5a0da8b1f6763 **out, const struct futhark_bool_1d *f_buff_isCore, const struct futhark_i64_1d *f_buffered_ids, const struct futhark_opaque_arr1d_tup2_f64_f64 *f_buffered_pts, const int64_t f_chainOffs, const int64_t f_cur_part_id, const int64_t f_cur_part_order, const struct futhark_bool_1d *f_isPartVisited, const int64_t f_next_offs, const int64_t f_offs, const struct futhark_i64_1d *f_relevantParts);
int futhark_free_opaque_4dedc823193c594b5c01727ae8ac5943(struct futhark_context *ctx, struct futhark_opaque_4dedc823193c594b5c01727ae8ac5943 *obj);
int futhark_store_opaque_4dedc823193c594b5c01727ae8ac5943(struct futhark_context *ctx, const struct futhark_opaque_4dedc823193c594b5c01727ae8ac5943 *obj, void **p, size_t *n);
struct futhark_opaque_4dedc823193c594b5c01727ae8ac5943 *futhark_restore_opaque_4dedc823193c594b5c01727ae8ac5943(struct futhark_context *ctx, const void *p);
int futhark_project_opaque_4dedc823193c594b5c01727ae8ac5943_chain_ids(struct futhark_context *ctx, struct futhark_i64_1d **out, const struct futhark_opaque_4dedc823193c594b5c01727ae8ac5943 *obj);
int futhark_project_opaque_4dedc823193c594b5c01727ae8ac5943_dat(struct futhark_context *ctx, struct futhark_opaque_arr1d_tup2_f64_f64 **out, const struct futhark_opaque_4dedc823193c594b5c01727ae8ac5943 *obj);
int futhark_project_opaque_4dedc823193c594b5c01727ae8ac5943_inner_max_coord(struct futhark_context *ctx, struct futhark_f64_1d **out, const struct futhark_opaque_4dedc823193c594b5c01727ae8ac5943 *obj);
int futhark_project_opaque_4dedc823193c594b5c01727ae8ac5943_inner_min_coord(struct futhark_context *ctx, struct futhark_f64_1d **out, const struct futhark_opaque_4dedc823193c594b5c01727ae8ac5943 *obj);
int futhark_project_opaque_4dedc823193c594b5c01727ae8ac5943_isCore(struct futhark_context *ctx, struct futhark_bool_1d **out, const struct futhark_opaque_4dedc823193c594b5c01727ae8ac5943 *obj);
int futhark_project_opaque_4dedc823193c594b5c01727ae8ac5943_isMargin(struct futhark_context *ctx, struct futhark_bool_1d **out, const struct futhark_opaque_4dedc823193c594b5c01727ae8ac5943 *obj);
int futhark_project_opaque_4dedc823193c594b5c01727ae8ac5943_isNeighbourVisited(struct futhark_context *ctx, struct futhark_bool_1d **out, const struct futhark_opaque_4dedc823193c594b5c01727ae8ac5943 *obj);
int futhark_project_opaque_4dedc823193c594b5c01727ae8ac5943_isTightMargin(struct futhark_context *ctx, struct futhark_bool_1d **out, const struct futhark_opaque_4dedc823193c594b5c01727ae8ac5943 *obj);
int futhark_project_opaque_4dedc823193c594b5c01727ae8ac5943_max_coord(struct futhark_context *ctx, struct futhark_f64_1d **out, const struct futhark_opaque_4dedc823193c594b5c01727ae8ac5943 *obj);
int futhark_project_opaque_4dedc823193c594b5c01727ae8ac5943_min_coord(struct futhark_context *ctx, struct futhark_f64_1d **out, const struct futhark_opaque_4dedc823193c594b5c01727ae8ac5943 *obj);
int futhark_project_opaque_4dedc823193c594b5c01727ae8ac5943_neighbours(struct futhark_context *ctx, struct futhark_i64_1d **out, const struct futhark_opaque_4dedc823193c594b5c01727ae8ac5943 *obj);
int futhark_project_opaque_4dedc823193c594b5c01727ae8ac5943_part_id(struct futhark_context *ctx, int64_t *out, const struct futhark_opaque_4dedc823193c594b5c01727ae8ac5943 *obj);
int futhark_new_opaque_4dedc823193c594b5c01727ae8ac5943(struct futhark_context *ctx, struct futhark_opaque_4dedc823193c594b5c01727ae8ac5943 **out, const struct futhark_i64_1d *f_chain_ids, const struct futhark_opaque_arr1d_tup2_f64_f64 *f_dat, const struct futhark_f64_1d *f_inner_max_coord, const struct futhark_f64_1d *f_inner_min_coord, const struct futhark_bool_1d *f_isCore, const struct futhark_bool_1d *f_isMargin, const struct futhark_bool_1d *f_isNeighbourVisited, const struct futhark_bool_1d *f_isTightMargin, const struct futhark_f64_1d *f_max_coord, const struct futhark_f64_1d *f_min_coord, const struct futhark_i64_1d *f_neighbours, const int64_t f_part_id);

// Entry points
int futhark_entry_add_next_partition_double(struct futhark_context *ctx, struct futhark_opaque_dbcHandler_double **out0, const struct futhark_opaque_dbcHandler_double *in0, const int64_t in1, const struct futhark_f64_1d *in2, const struct futhark_f64_1d *in3);
int futhark_entry_do_DBSCAN_double(struct futhark_context *ctx, struct futhark_opaque_dbcHandler_double **out0, const struct futhark_opaque_dbcHandler_double *in0, const int64_t in1);
int futhark_entry_flush_dat_double(struct futhark_context *ctx, struct futhark_opaque_flushedData_double **out0, const struct futhark_opaque_dbcHandler_double *in0);
int futhark_entry_make_collisions_compact_double(struct futhark_context *ctx, struct futhark_opaque_collisionTable **out0, const struct futhark_opaque_dbcHandler_double *in0);
int futhark_entry_mk_dbcHandler_double(struct futhark_context *ctx, struct futhark_opaque_dbcHandler_double **out0, const double in0, const double in1, const double in2, const double in3, const int64_t in4, const int64_t in5, const bool in6, const bool in7, const double in8, const double in9, const int64_t in10, const int64_t in11);
int futhark_entry_next_partition_to_read_double(struct futhark_context *ctx, int64_t *out0, const struct futhark_opaque_dbcHandler_double *in0);
int futhark_entry_rectify_partition_ids_double(struct futhark_context *ctx, struct futhark_i64_1d **out0, const struct futhark_i64_1d *in0, const struct futhark_opaque_collisionTable *in1, const int64_t in2);

// Miscellaneous
int futhark_context_sync(struct futhark_context *ctx);
void futhark_context_config_set_cache_file(struct futhark_context_config *cfg, const char *f);
char *futhark_context_get_error(struct futhark_context *ctx);
void futhark_context_set_logging_file(struct futhark_context *ctx, FILE *f);
void futhark_context_pause_profiling(struct futhark_context *ctx);
void futhark_context_unpause_profiling(struct futhark_context *ctx);
char *futhark_context_report(struct futhark_context *ctx);
int futhark_context_clear_caches(struct futhark_context *ctx);
#define FUTHARK_BACKEND_cuda
#define FUTHARK_SUCCESS 0
#define FUTHARK_PROGRAM_ERROR 2
#define FUTHARK_OUT_OF_MEMORY 3

#ifdef __cplusplus
}
#endif

#include <stdio.h>
#include <stdlib.h>
#include <stdbool.h>
#include <math.h>
#include <stdint.h>
// If NDEBUG is set, the assert() macro will do nothing. Since Futhark
// (unfortunately) makes use of assert() for error detection (and even some
// side effects), we want to avoid that.
#undef NDEBUG
#include <assert.h>
#include <stdarg.h>
#define SCALAR_FUN_ATTR static inline
// Start of util.h.
//
// Various helper functions that are useful in all generated C code.

#include <errno.h>
#include <string.h>

static const char *fut_progname = "(embedded Futhark)";

static void futhark_panic(int eval, const char *fmt, ...) __attribute__((noreturn));
static char* msgprintf(const char *s, ...);
static void* slurp_file(const char *filename, size_t *size);
static int dump_file(const char *file, const void *buf, size_t n);
struct str_builder;
static void str_builder_init(struct str_builder *b);
static void str_builder(struct str_builder *b, const char *s, ...);
static char *strclone(const char *str);

static void futhark_panic(int eval, const char *fmt, ...) {
  va_list ap;
  va_start(ap, fmt);
  fprintf(stderr, "%s: ", fut_progname);
  vfprintf(stderr, fmt, ap);
  va_end(ap);
  exit(eval);
}

// For generating arbitrary-sized error messages.  It is the callers
// responsibility to free the buffer at some point.
static char* msgprintf(const char *s, ...) {
  va_list vl;
  va_start(vl, s);
  size_t needed = 1 + (size_t)vsnprintf(NULL, 0, s, vl);
  char *buffer = (char*) malloc(needed);
  va_start(vl, s); // Must re-init.
  vsnprintf(buffer, needed, s, vl);
  return buffer;
}

static inline void check_err(int errval, int sets_errno, const char *fun, int line,
                             const char *msg, ...) {
  if (errval) {
    char errnum[10];

    va_list vl;
    va_start(vl, msg);

    fprintf(stderr, "ERROR: ");
    vfprintf(stderr, msg, vl);
    fprintf(stderr, " in %s() at line %d with error code %s\n",
            fun, line,
            sets_errno ? strerror(errno) : errnum);
    exit(errval);
  }
}

#define CHECK_ERR(err, ...) check_err(err, 0, __func__, __LINE__, __VA_ARGS__)
#define CHECK_ERRNO(err, ...) check_err(err, 1, __func__, __LINE__, __VA_ARGS__)

// Read the rest of an open file into a NUL-terminated string; returns
// NULL on error.
static void* fslurp_file(FILE *f, size_t *size) {
  long start = ftell(f);
  fseek(f, 0, SEEK_END);
  long src_size = ftell(f)-start;
  fseek(f, start, SEEK_SET);
  unsigned char *s = (unsigned char*) malloc((size_t)src_size + 1);
  if (fread(s, 1, (size_t)src_size, f) != (size_t)src_size) {
    free(s);
    s = NULL;
  } else {
    s[src_size] = '\0';
  }

  if (size) {
    *size = (size_t)src_size;
  }

  return s;
}

// Read a file into a NUL-terminated string; returns NULL on error.
static void* slurp_file(const char *filename, size_t *size) {
  FILE *f = fopen(filename, "rb"); // To avoid Windows messing with linebreaks.
  if (f == NULL) return NULL;
  unsigned char *s = fslurp_file(f, size);
  fclose(f);
  return s;
}

// Dump 'n' bytes from 'buf' into the file at the designated location.
// Returns 0 on success.
static int dump_file(const char *file, const void *buf, size_t n) {
  FILE *f = fopen(file, "w");

  if (f == NULL) {
    return 1;
  }

  if (fwrite(buf, sizeof(char), n, f) != n) {
    return 1;
  }

  if (fclose(f) != 0) {
    return 1;
  }

  return 0;
}

struct str_builder {
  char *str;
  size_t capacity; // Size of buffer.
  size_t used; // Bytes used, *not* including final zero.
};

static void str_builder_init(struct str_builder *b) {
  b->capacity = 10;
  b->used = 0;
  b->str = malloc(b->capacity);
  b->str[0] = 0;
}

static void str_builder(struct str_builder *b, const char *s, ...) {
  va_list vl;
  va_start(vl, s);
  size_t needed = (size_t)vsnprintf(NULL, 0, s, vl);

  while (b->capacity < b->used + needed + 1) {
    b->capacity *= 2;
    b->str = realloc(b->str, b->capacity);
  }

  va_start(vl, s); // Must re-init.
  vsnprintf(b->str+b->used, b->capacity-b->used, s, vl);
  b->used += needed;
}

static void str_builder_str(struct str_builder *b, const char *s) {
  size_t needed = strlen(s);
  if (b->capacity < b->used + needed + 1) {
    b->capacity *= 2;
    b->str = realloc(b->str, b->capacity);
  }
  strcpy(b->str+b->used, s);
  b->used += needed;
}

static void str_builder_char(struct str_builder *b, char c) {
  size_t needed = 1;
  if (b->capacity < b->used + needed + 1) {
    b->capacity *= 2;
    b->str = realloc(b->str, b->capacity);
  }
  b->str[b->used] = c;
  b->str[b->used+1] = 0;
  b->used += needed;
}

static void str_builder_json_str(struct str_builder* sb, const char* s) {
  str_builder_char(sb, '"');
  for (int j = 0; s[j]; j++) {
    char c = s[j];
    switch (c) {
    case '\n':
      str_builder_str(sb, "\\n");
      break;
    case '"':
      str_builder_str(sb, "\\\"");
      break;
    default:
      str_builder_char(sb, c);
    }
  }
  str_builder_char(sb, '"');
}

static char *strclone(const char *str) {
  size_t size = strlen(str) + 1;
  char *copy = (char*) malloc(size);
  if (copy == NULL) {
    return NULL;
  }

  memcpy(copy, str, size);
  return copy;
}

// Assumes NULL-terminated.
static char *strconcat(const char *src_fragments[]) {
  size_t src_len = 0;
  const char **p;

  for (p = src_fragments; *p; p++) {
    src_len += strlen(*p);
  }

  char *src = (char*) malloc(src_len + 1);
  size_t n = 0;
  for (p = src_fragments; *p; p++) {
    strcpy(src + n, *p);
    n += strlen(*p);
  }

  return src;
}

// End of util.h.
// Start of cache.h

#define CACHE_HASH_SIZE 8 // In 32-bit words.

struct cache_hash {
  uint32_t hash[CACHE_HASH_SIZE];
};

// Initialise a blank cache.
static void cache_hash_init(struct cache_hash *c);

// Hash some bytes and add them to the accumulated hash.
static void cache_hash(struct cache_hash *out, const char *in, size_t n);

// Try to restore cache contents from a file with the given name.
// Assumes the cache is invalid if it contains the given hash.
// Allocates memory and reads the cache conents, which is returned in
// *buf with size *buflen.  If the cache is successfully loaded, this
// function returns 0.  Otherwise it returns nonzero.  Errno is set if
// the failure to load the cache is due to anything except invalid
// cache conents.  Note that failing to restore the cache is not
// necessarily a problem: it might just be invalid or not created yet.
static int cache_restore(const char *fname, const struct cache_hash *hash,
                         unsigned char **buf, size_t *buflen);

// Store cache contents in the given file, with the given hash.
static int cache_store(const char *fname, const struct cache_hash *hash,
                       const unsigned char *buf, size_t buflen);

// Now for the implementation.

static void cache_hash_init(struct cache_hash *c) {
  memset(c->hash, 0, CACHE_HASH_SIZE * sizeof(uint32_t));
}

static void cache_hash(struct cache_hash *out, const char *in, size_t n) {
  // Adaptation of djb2 for larger output size by storing intermediate
  // states.
  uint32_t hash = 5381;
  for (size_t i = 0; i < n; i++) {
    hash = ((hash << 5) + hash) + in[i];
    out->hash[i % CACHE_HASH_SIZE] ^= hash;
  }
}

#define CACHE_HEADER_SIZE 8
static const char cache_header[CACHE_HEADER_SIZE] = "FUTHARK\0";

static int cache_restore(const char *fname, const struct cache_hash *hash,
                         unsigned char **buf, size_t *buflen) {
  FILE *f = fopen(fname, "rb");

  if (f == NULL) {
    return 1;
  }

  char f_header[CACHE_HEADER_SIZE];

  if (fread(f_header, sizeof(char), CACHE_HEADER_SIZE, f) != CACHE_HEADER_SIZE) {
    goto error;
  }

  if (memcmp(f_header, cache_header, CACHE_HEADER_SIZE) != 0) {
    goto error;
  }

  if (fseek(f, 0, SEEK_END) != 0) {
    goto error;
  }
  int64_t f_size = (int64_t)ftell(f);
  if (fseek(f, CACHE_HEADER_SIZE, SEEK_SET) != 0) {
    goto error;
  }

  int64_t expected_size;

  if (fread(&expected_size, sizeof(int64_t), 1, f) != 1) {
    goto error;
  }

  if (f_size != expected_size) {
    errno = 0;
    goto error;
  }

  int32_t f_hash[CACHE_HASH_SIZE];

  if (fread(f_hash, sizeof(int32_t), CACHE_HASH_SIZE, f) != CACHE_HASH_SIZE) {
    goto error;
  }

  if (memcmp(f_hash, hash->hash, CACHE_HASH_SIZE) != 0) {
    errno = 0;
    goto error;
  }

  *buflen = f_size - CACHE_HEADER_SIZE - sizeof(int64_t) - CACHE_HASH_SIZE*sizeof(int32_t);
  *buf = malloc(*buflen);
  if (fread(*buf, sizeof(char), *buflen, f) != *buflen) {
    free(*buf);
    goto error;
  }

  fclose(f);

  return 0;

 error:
  fclose(f);
  return 1;
}

static int cache_store(const char *fname, const struct cache_hash *hash,
                       const unsigned char *buf, size_t buflen) {
  FILE *f = fopen(fname, "wb");

  if (f == NULL) {
    return 1;
  }

  if (fwrite(cache_header, CACHE_HEADER_SIZE, 1, f) != 1) {
    goto error;
  }

  int64_t size = CACHE_HEADER_SIZE + sizeof(int64_t) + CACHE_HASH_SIZE*sizeof(int32_t) + buflen;

  if (fwrite(&size, sizeof(size), 1, f) != 1) {
    goto error;
  }

  if (fwrite(hash->hash, sizeof(int32_t), CACHE_HASH_SIZE, f) != CACHE_HASH_SIZE) {
    goto error;
  }

  if (fwrite(buf, sizeof(unsigned char), buflen, f) != buflen) {
    goto error;
  }

  fclose(f);

  return 0;

 error:
  fclose(f);
  return 1;
}

// End of cache.h
// Start of half.h.

// Conversion functions are from http://half.sourceforge.net/, but
// translated to C.
//
// Copyright (c) 2012-2021 Christian Rau
//
// Permission is hereby granted, free of charge, to any person obtaining a copy
// of this software and associated documentation files (the "Software"), to deal
// in the Software without restriction, including without limitation the rights
// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
// copies of the Software, and to permit persons to whom the Software is
// furnished to do so, subject to the following conditions:
//
// The above copyright notice and this permission notice shall be included in
// all copies or substantial portions of the Software.
//
// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
// THE SOFTWARE.

#ifndef __OPENCL_VERSION__
#define __constant
#endif

__constant static const uint16_t base_table[512] = {
  0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
  0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
  0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
  0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
  0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
  0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
  0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0001, 0x0002, 0x0004, 0x0008, 0x0010, 0x0020, 0x0040, 0x0080, 0x0100,
  0x0200, 0x0400, 0x0800, 0x0C00, 0x1000, 0x1400, 0x1800, 0x1C00, 0x2000, 0x2400, 0x2800, 0x2C00, 0x3000, 0x3400, 0x3800, 0x3C00,
  0x4000, 0x4400, 0x4800, 0x4C00, 0x5000, 0x5400, 0x5800, 0x5C00, 0x6000, 0x6400, 0x6800, 0x6C00, 0x7000, 0x7400, 0x7800, 0x7C00,
  0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00,
  0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00,
  0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00,
  0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00,
  0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00,
  0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00,
  0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00,
  0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000,
  0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000,
  0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000,
  0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000,
  0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000,
  0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000,
  0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8001, 0x8002, 0x8004, 0x8008, 0x8010, 0x8020, 0x8040, 0x8080, 0x8100,
  0x8200, 0x8400, 0x8800, 0x8C00, 0x9000, 0x9400, 0x9800, 0x9C00, 0xA000, 0xA400, 0xA800, 0xAC00, 0xB000, 0xB400, 0xB800, 0xBC00,
  0xC000, 0xC400, 0xC800, 0xCC00, 0xD000, 0xD400, 0xD800, 0xDC00, 0xE000, 0xE400, 0xE800, 0xEC00, 0xF000, 0xF400, 0xF800, 0xFC00,
  0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00,
  0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00,
  0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00,
  0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00,
  0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00,
  0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00,
  0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00 };

__constant static const unsigned char shift_table[512] = {
  24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24,
  24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24,
  24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24,
  24, 24, 24, 24, 24, 24, 24, 23, 22, 21, 20, 19, 18, 17, 16, 15, 14, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13,
  13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24,
  24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24,
  24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24,
  24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 13,
  24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24,
  24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24,
  24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24,
  24, 24, 24, 24, 24, 24, 24, 23, 22, 21, 20, 19, 18, 17, 16, 15, 14, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13,
  13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24,
  24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24,
  24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24,
  24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 13 };

__constant static const uint32_t mantissa_table[2048] = {
  0x00000000, 0x33800000, 0x34000000, 0x34400000, 0x34800000, 0x34A00000, 0x34C00000, 0x34E00000, 0x35000000, 0x35100000, 0x35200000, 0x35300000, 0x35400000, 0x35500000, 0x35600000, 0x35700000,
  0x35800000, 0x35880000, 0x35900000, 0x35980000, 0x35A00000, 0x35A80000, 0x35B00000, 0x35B80000, 0x35C00000, 0x35C80000, 0x35D00000, 0x35D80000, 0x35E00000, 0x35E80000, 0x35F00000, 0x35F80000,
  0x36000000, 0x36040000, 0x36080000, 0x360C0000, 0x36100000, 0x36140000, 0x36180000, 0x361C0000, 0x36200000, 0x36240000, 0x36280000, 0x362C0000, 0x36300000, 0x36340000, 0x36380000, 0x363C0000,
  0x36400000, 0x36440000, 0x36480000, 0x364C0000, 0x36500000, 0x36540000, 0x36580000, 0x365C0000, 0x36600000, 0x36640000, 0x36680000, 0x366C0000, 0x36700000, 0x36740000, 0x36780000, 0x367C0000,
  0x36800000, 0x36820000, 0x36840000, 0x36860000, 0x36880000, 0x368A0000, 0x368C0000, 0x368E0000, 0x36900000, 0x36920000, 0x36940000, 0x36960000, 0x36980000, 0x369A0000, 0x369C0000, 0x369E0000,
  0x36A00000, 0x36A20000, 0x36A40000, 0x36A60000, 0x36A80000, 0x36AA0000, 0x36AC0000, 0x36AE0000, 0x36B00000, 0x36B20000, 0x36B40000, 0x36B60000, 0x36B80000, 0x36BA0000, 0x36BC0000, 0x36BE0000,
  0x36C00000, 0x36C20000, 0x36C40000, 0x36C60000, 0x36C80000, 0x36CA0000, 0x36CC0000, 0x36CE0000, 0x36D00000, 0x36D20000, 0x36D40000, 0x36D60000, 0x36D80000, 0x36DA0000, 0x36DC0000, 0x36DE0000,
  0x36E00000, 0x36E20000, 0x36E40000, 0x36E60000, 0x36E80000, 0x36EA0000, 0x36EC0000, 0x36EE0000, 0x36F00000, 0x36F20000, 0x36F40000, 0x36F60000, 0x36F80000, 0x36FA0000, 0x36FC0000, 0x36FE0000,
  0x37000000, 0x37010000, 0x37020000, 0x37030000, 0x37040000, 0x37050000, 0x37060000, 0x37070000, 0x37080000, 0x37090000, 0x370A0000, 0x370B0000, 0x370C0000, 0x370D0000, 0x370E0000, 0x370F0000,
  0x37100000, 0x37110000, 0x37120000, 0x37130000, 0x37140000, 0x37150000, 0x37160000, 0x37170000, 0x37180000, 0x37190000, 0x371A0000, 0x371B0000, 0x371C0000, 0x371D0000, 0x371E0000, 0x371F0000,
  0x37200000, 0x37210000, 0x37220000, 0x37230000, 0x37240000, 0x37250000, 0x37260000, 0x37270000, 0x37280000, 0x37290000, 0x372A0000, 0x372B0000, 0x372C0000, 0x372D0000, 0x372E0000, 0x372F0000,
  0x37300000, 0x37310000, 0x37320000, 0x37330000, 0x37340000, 0x37350000, 0x37360000, 0x37370000, 0x37380000, 0x37390000, 0x373A0000, 0x373B0000, 0x373C0000, 0x373D0000, 0x373E0000, 0x373F0000,
  0x37400000, 0x37410000, 0x37420000, 0x37430000, 0x37440000, 0x37450000, 0x37460000, 0x37470000, 0x37480000, 0x37490000, 0x374A0000, 0x374B0000, 0x374C0000, 0x374D0000, 0x374E0000, 0x374F0000,
  0x37500000, 0x37510000, 0x37520000, 0x37530000, 0x37540000, 0x37550000, 0x37560000, 0x37570000, 0x37580000, 0x37590000, 0x375A0000, 0x375B0000, 0x375C0000, 0x375D0000, 0x375E0000, 0x375F0000,
  0x37600000, 0x37610000, 0x37620000, 0x37630000, 0x37640000, 0x37650000, 0x37660000, 0x37670000, 0x37680000, 0x37690000, 0x376A0000, 0x376B0000, 0x376C0000, 0x376D0000, 0x376E0000, 0x376F0000,
  0x37700000, 0x37710000, 0x37720000, 0x37730000, 0x37740000, 0x37750000, 0x37760000, 0x37770000, 0x37780000, 0x37790000, 0x377A0000, 0x377B0000, 0x377C0000, 0x377D0000, 0x377E0000, 0x377F0000,
  0x37800000, 0x37808000, 0x37810000, 0x37818000, 0x37820000, 0x37828000, 0x37830000, 0x37838000, 0x37840000, 0x37848000, 0x37850000, 0x37858000, 0x37860000, 0x37868000, 0x37870000, 0x37878000,
  0x37880000, 0x37888000, 0x37890000, 0x37898000, 0x378A0000, 0x378A8000, 0x378B0000, 0x378B8000, 0x378C0000, 0x378C8000, 0x378D0000, 0x378D8000, 0x378E0000, 0x378E8000, 0x378F0000, 0x378F8000,
  0x37900000, 0x37908000, 0x37910000, 0x37918000, 0x37920000, 0x37928000, 0x37930000, 0x37938000, 0x37940000, 0x37948000, 0x37950000, 0x37958000, 0x37960000, 0x37968000, 0x37970000, 0x37978000,
  0x37980000, 0x37988000, 0x37990000, 0x37998000, 0x379A0000, 0x379A8000, 0x379B0000, 0x379B8000, 0x379C0000, 0x379C8000, 0x379D0000, 0x379D8000, 0x379E0000, 0x379E8000, 0x379F0000, 0x379F8000,
  0x37A00000, 0x37A08000, 0x37A10000, 0x37A18000, 0x37A20000, 0x37A28000, 0x37A30000, 0x37A38000, 0x37A40000, 0x37A48000, 0x37A50000, 0x37A58000, 0x37A60000, 0x37A68000, 0x37A70000, 0x37A78000,
  0x37A80000, 0x37A88000, 0x37A90000, 0x37A98000, 0x37AA0000, 0x37AA8000, 0x37AB0000, 0x37AB8000, 0x37AC0000, 0x37AC8000, 0x37AD0000, 0x37AD8000, 0x37AE0000, 0x37AE8000, 0x37AF0000, 0x37AF8000,
  0x37B00000, 0x37B08000, 0x37B10000, 0x37B18000, 0x37B20000, 0x37B28000, 0x37B30000, 0x37B38000, 0x37B40000, 0x37B48000, 0x37B50000, 0x37B58000, 0x37B60000, 0x37B68000, 0x37B70000, 0x37B78000,
  0x37B80000, 0x37B88000, 0x37B90000, 0x37B98000, 0x37BA0000, 0x37BA8000, 0x37BB0000, 0x37BB8000, 0x37BC0000, 0x37BC8000, 0x37BD0000, 0x37BD8000, 0x37BE0000, 0x37BE8000, 0x37BF0000, 0x37BF8000,
  0x37C00000, 0x37C08000, 0x37C10000, 0x37C18000, 0x37C20000, 0x37C28000, 0x37C30000, 0x37C38000, 0x37C40000, 0x37C48000, 0x37C50000, 0x37C58000, 0x37C60000, 0x37C68000, 0x37C70000, 0x37C78000,
  0x37C80000, 0x37C88000, 0x37C90000, 0x37C98000, 0x37CA0000, 0x37CA8000, 0x37CB0000, 0x37CB8000, 0x37CC0000, 0x37CC8000, 0x37CD0000, 0x37CD8000, 0x37CE0000, 0x37CE8000, 0x37CF0000, 0x37CF8000,
  0x37D00000, 0x37D08000, 0x37D10000, 0x37D18000, 0x37D20000, 0x37D28000, 0x37D30000, 0x37D38000, 0x37D40000, 0x37D48000, 0x37D50000, 0x37D58000, 0x37D60000, 0x37D68000, 0x37D70000, 0x37D78000,
  0x37D80000, 0x37D88000, 0x37D90000, 0x37D98000, 0x37DA0000, 0x37DA8000, 0x37DB0000, 0x37DB8000, 0x37DC0000, 0x37DC8000, 0x37DD0000, 0x37DD8000, 0x37DE0000, 0x37DE8000, 0x37DF0000, 0x37DF8000,
  0x37E00000, 0x37E08000, 0x37E10000, 0x37E18000, 0x37E20000, 0x37E28000, 0x37E30000, 0x37E38000, 0x37E40000, 0x37E48000, 0x37E50000, 0x37E58000, 0x37E60000, 0x37E68000, 0x37E70000, 0x37E78000,
  0x37E80000, 0x37E88000, 0x37E90000, 0x37E98000, 0x37EA0000, 0x37EA8000, 0x37EB0000, 0x37EB8000, 0x37EC0000, 0x37EC8000, 0x37ED0000, 0x37ED8000, 0x37EE0000, 0x37EE8000, 0x37EF0000, 0x37EF8000,
  0x37F00000, 0x37F08000, 0x37F10000, 0x37F18000, 0x37F20000, 0x37F28000, 0x37F30000, 0x37F38000, 0x37F40000, 0x37F48000, 0x37F50000, 0x37F58000, 0x37F60000, 0x37F68000, 0x37F70000, 0x37F78000,
  0x37F80000, 0x37F88000, 0x37F90000, 0x37F98000, 0x37FA0000, 0x37FA8000, 0x37FB0000, 0x37FB8000, 0x37FC0000, 0x37FC8000, 0x37FD0000, 0x37FD8000, 0x37FE0000, 0x37FE8000, 0x37FF0000, 0x37FF8000,
  0x38000000, 0x38004000, 0x38008000, 0x3800C000, 0x38010000, 0x38014000, 0x38018000, 0x3801C000, 0x38020000, 0x38024000, 0x38028000, 0x3802C000, 0x38030000, 0x38034000, 0x38038000, 0x3803C000,
  0x38040000, 0x38044000, 0x38048000, 0x3804C000, 0x38050000, 0x38054000, 0x38058000, 0x3805C000, 0x38060000, 0x38064000, 0x38068000, 0x3806C000, 0x38070000, 0x38074000, 0x38078000, 0x3807C000,
  0x38080000, 0x38084000, 0x38088000, 0x3808C000, 0x38090000, 0x38094000, 0x38098000, 0x3809C000, 0x380A0000, 0x380A4000, 0x380A8000, 0x380AC000, 0x380B0000, 0x380B4000, 0x380B8000, 0x380BC000,
  0x380C0000, 0x380C4000, 0x380C8000, 0x380CC000, 0x380D0000, 0x380D4000, 0x380D8000, 0x380DC000, 0x380E0000, 0x380E4000, 0x380E8000, 0x380EC000, 0x380F0000, 0x380F4000, 0x380F8000, 0x380FC000,
  0x38100000, 0x38104000, 0x38108000, 0x3810C000, 0x38110000, 0x38114000, 0x38118000, 0x3811C000, 0x38120000, 0x38124000, 0x38128000, 0x3812C000, 0x38130000, 0x38134000, 0x38138000, 0x3813C000,
  0x38140000, 0x38144000, 0x38148000, 0x3814C000, 0x38150000, 0x38154000, 0x38158000, 0x3815C000, 0x38160000, 0x38164000, 0x38168000, 0x3816C000, 0x38170000, 0x38174000, 0x38178000, 0x3817C000,
  0x38180000, 0x38184000, 0x38188000, 0x3818C000, 0x38190000, 0x38194000, 0x38198000, 0x3819C000, 0x381A0000, 0x381A4000, 0x381A8000, 0x381AC000, 0x381B0000, 0x381B4000, 0x381B8000, 0x381BC000,
  0x381C0000, 0x381C4000, 0x381C8000, 0x381CC000, 0x381D0000, 0x381D4000, 0x381D8000, 0x381DC000, 0x381E0000, 0x381E4000, 0x381E8000, 0x381EC000, 0x381F0000, 0x381F4000, 0x381F8000, 0x381FC000,
  0x38200000, 0x38204000, 0x38208000, 0x3820C000, 0x38210000, 0x38214000, 0x38218000, 0x3821C000, 0x38220000, 0x38224000, 0x38228000, 0x3822C000, 0x38230000, 0x38234000, 0x38238000, 0x3823C000,
  0x38240000, 0x38244000, 0x38248000, 0x3824C000, 0x38250000, 0x38254000, 0x38258000, 0x3825C000, 0x38260000, 0x38264000, 0x38268000, 0x3826C000, 0x38270000, 0x38274000, 0x38278000, 0x3827C000,
  0x38280000, 0x38284000, 0x38288000, 0x3828C000, 0x38290000, 0x38294000, 0x38298000, 0x3829C000, 0x382A0000, 0x382A4000, 0x382A8000, 0x382AC000, 0x382B0000, 0x382B4000, 0x382B8000, 0x382BC000,
  0x382C0000, 0x382C4000, 0x382C8000, 0x382CC000, 0x382D0000, 0x382D4000, 0x382D8000, 0x382DC000, 0x382E0000, 0x382E4000, 0x382E8000, 0x382EC000, 0x382F0000, 0x382F4000, 0x382F8000, 0x382FC000,
  0x38300000, 0x38304000, 0x38308000, 0x3830C000, 0x38310000, 0x38314000, 0x38318000, 0x3831C000, 0x38320000, 0x38324000, 0x38328000, 0x3832C000, 0x38330000, 0x38334000, 0x38338000, 0x3833C000,
  0x38340000, 0x38344000, 0x38348000, 0x3834C000, 0x38350000, 0x38354000, 0x38358000, 0x3835C000, 0x38360000, 0x38364000, 0x38368000, 0x3836C000, 0x38370000, 0x38374000, 0x38378000, 0x3837C000,
  0x38380000, 0x38384000, 0x38388000, 0x3838C000, 0x38390000, 0x38394000, 0x38398000, 0x3839C000, 0x383A0000, 0x383A4000, 0x383A8000, 0x383AC000, 0x383B0000, 0x383B4000, 0x383B8000, 0x383BC000,
  0x383C0000, 0x383C4000, 0x383C8000, 0x383CC000, 0x383D0000, 0x383D4000, 0x383D8000, 0x383DC000, 0x383E0000, 0x383E4000, 0x383E8000, 0x383EC000, 0x383F0000, 0x383F4000, 0x383F8000, 0x383FC000,
  0x38400000, 0x38404000, 0x38408000, 0x3840C000, 0x38410000, 0x38414000, 0x38418000, 0x3841C000, 0x38420000, 0x38424000, 0x38428000, 0x3842C000, 0x38430000, 0x38434000, 0x38438000, 0x3843C000,
  0x38440000, 0x38444000, 0x38448000, 0x3844C000, 0x38450000, 0x38454000, 0x38458000, 0x3845C000, 0x38460000, 0x38464000, 0x38468000, 0x3846C000, 0x38470000, 0x38474000, 0x38478000, 0x3847C000,
  0x38480000, 0x38484000, 0x38488000, 0x3848C000, 0x38490000, 0x38494000, 0x38498000, 0x3849C000, 0x384A0000, 0x384A4000, 0x384A8000, 0x384AC000, 0x384B0000, 0x384B4000, 0x384B8000, 0x384BC000,
  0x384C0000, 0x384C4000, 0x384C8000, 0x384CC000, 0x384D0000, 0x384D4000, 0x384D8000, 0x384DC000, 0x384E0000, 0x384E4000, 0x384E8000, 0x384EC000, 0x384F0000, 0x384F4000, 0x384F8000, 0x384FC000,
  0x38500000, 0x38504000, 0x38508000, 0x3850C000, 0x38510000, 0x38514000, 0x38518000, 0x3851C000, 0x38520000, 0x38524000, 0x38528000, 0x3852C000, 0x38530000, 0x38534000, 0x38538000, 0x3853C000,
  0x38540000, 0x38544000, 0x38548000, 0x3854C000, 0x38550000, 0x38554000, 0x38558000, 0x3855C000, 0x38560000, 0x38564000, 0x38568000, 0x3856C000, 0x38570000, 0x38574000, 0x38578000, 0x3857C000,
  0x38580000, 0x38584000, 0x38588000, 0x3858C000, 0x38590000, 0x38594000, 0x38598000, 0x3859C000, 0x385A0000, 0x385A4000, 0x385A8000, 0x385AC000, 0x385B0000, 0x385B4000, 0x385B8000, 0x385BC000,
  0x385C0000, 0x385C4000, 0x385C8000, 0x385CC000, 0x385D0000, 0x385D4000, 0x385D8000, 0x385DC000, 0x385E0000, 0x385E4000, 0x385E8000, 0x385EC000, 0x385F0000, 0x385F4000, 0x385F8000, 0x385FC000,
  0x38600000, 0x38604000, 0x38608000, 0x3860C000, 0x38610000, 0x38614000, 0x38618000, 0x3861C000, 0x38620000, 0x38624000, 0x38628000, 0x3862C000, 0x38630000, 0x38634000, 0x38638000, 0x3863C000,
  0x38640000, 0x38644000, 0x38648000, 0x3864C000, 0x38650000, 0x38654000, 0x38658000, 0x3865C000, 0x38660000, 0x38664000, 0x38668000, 0x3866C000, 0x38670000, 0x38674000, 0x38678000, 0x3867C000,
  0x38680000, 0x38684000, 0x38688000, 0x3868C000, 0x38690000, 0x38694000, 0x38698000, 0x3869C000, 0x386A0000, 0x386A4000, 0x386A8000, 0x386AC000, 0x386B0000, 0x386B4000, 0x386B8000, 0x386BC000,
  0x386C0000, 0x386C4000, 0x386C8000, 0x386CC000, 0x386D0000, 0x386D4000, 0x386D8000, 0x386DC000, 0x386E0000, 0x386E4000, 0x386E8000, 0x386EC000, 0x386F0000, 0x386F4000, 0x386F8000, 0x386FC000,
  0x38700000, 0x38704000, 0x38708000, 0x3870C000, 0x38710000, 0x38714000, 0x38718000, 0x3871C000, 0x38720000, 0x38724000, 0x38728000, 0x3872C000, 0x38730000, 0x38734000, 0x38738000, 0x3873C000,
  0x38740000, 0x38744000, 0x38748000, 0x3874C000, 0x38750000, 0x38754000, 0x38758000, 0x3875C000, 0x38760000, 0x38764000, 0x38768000, 0x3876C000, 0x38770000, 0x38774000, 0x38778000, 0x3877C000,
  0x38780000, 0x38784000, 0x38788000, 0x3878C000, 0x38790000, 0x38794000, 0x38798000, 0x3879C000, 0x387A0000, 0x387A4000, 0x387A8000, 0x387AC000, 0x387B0000, 0x387B4000, 0x387B8000, 0x387BC000,
  0x387C0000, 0x387C4000, 0x387C8000, 0x387CC000, 0x387D0000, 0x387D4000, 0x387D8000, 0x387DC000, 0x387E0000, 0x387E4000, 0x387E8000, 0x387EC000, 0x387F0000, 0x387F4000, 0x387F8000, 0x387FC000,
  0x38000000, 0x38002000, 0x38004000, 0x38006000, 0x38008000, 0x3800A000, 0x3800C000, 0x3800E000, 0x38010000, 0x38012000, 0x38014000, 0x38016000, 0x38018000, 0x3801A000, 0x3801C000, 0x3801E000,
  0x38020000, 0x38022000, 0x38024000, 0x38026000, 0x38028000, 0x3802A000, 0x3802C000, 0x3802E000, 0x38030000, 0x38032000, 0x38034000, 0x38036000, 0x38038000, 0x3803A000, 0x3803C000, 0x3803E000,
  0x38040000, 0x38042000, 0x38044000, 0x38046000, 0x38048000, 0x3804A000, 0x3804C000, 0x3804E000, 0x38050000, 0x38052000, 0x38054000, 0x38056000, 0x38058000, 0x3805A000, 0x3805C000, 0x3805E000,
  0x38060000, 0x38062000, 0x38064000, 0x38066000, 0x38068000, 0x3806A000, 0x3806C000, 0x3806E000, 0x38070000, 0x38072000, 0x38074000, 0x38076000, 0x38078000, 0x3807A000, 0x3807C000, 0x3807E000,
  0x38080000, 0x38082000, 0x38084000, 0x38086000, 0x38088000, 0x3808A000, 0x3808C000, 0x3808E000, 0x38090000, 0x38092000, 0x38094000, 0x38096000, 0x38098000, 0x3809A000, 0x3809C000, 0x3809E000,
  0x380A0000, 0x380A2000, 0x380A4000, 0x380A6000, 0x380A8000, 0x380AA000, 0x380AC000, 0x380AE000, 0x380B0000, 0x380B2000, 0x380B4000, 0x380B6000, 0x380B8000, 0x380BA000, 0x380BC000, 0x380BE000,
  0x380C0000, 0x380C2000, 0x380C4000, 0x380C6000, 0x380C8000, 0x380CA000, 0x380CC000, 0x380CE000, 0x380D0000, 0x380D2000, 0x380D4000, 0x380D6000, 0x380D8000, 0x380DA000, 0x380DC000, 0x380DE000,
  0x380E0000, 0x380E2000, 0x380E4000, 0x380E6000, 0x380E8000, 0x380EA000, 0x380EC000, 0x380EE000, 0x380F0000, 0x380F2000, 0x380F4000, 0x380F6000, 0x380F8000, 0x380FA000, 0x380FC000, 0x380FE000,
  0x38100000, 0x38102000, 0x38104000, 0x38106000, 0x38108000, 0x3810A000, 0x3810C000, 0x3810E000, 0x38110000, 0x38112000, 0x38114000, 0x38116000, 0x38118000, 0x3811A000, 0x3811C000, 0x3811E000,
  0x38120000, 0x38122000, 0x38124000, 0x38126000, 0x38128000, 0x3812A000, 0x3812C000, 0x3812E000, 0x38130000, 0x38132000, 0x38134000, 0x38136000, 0x38138000, 0x3813A000, 0x3813C000, 0x3813E000,
  0x38140000, 0x38142000, 0x38144000, 0x38146000, 0x38148000, 0x3814A000, 0x3814C000, 0x3814E000, 0x38150000, 0x38152000, 0x38154000, 0x38156000, 0x38158000, 0x3815A000, 0x3815C000, 0x3815E000,
  0x38160000, 0x38162000, 0x38164000, 0x38166000, 0x38168000, 0x3816A000, 0x3816C000, 0x3816E000, 0x38170000, 0x38172000, 0x38174000, 0x38176000, 0x38178000, 0x3817A000, 0x3817C000, 0x3817E000,
  0x38180000, 0x38182000, 0x38184000, 0x38186000, 0x38188000, 0x3818A000, 0x3818C000, 0x3818E000, 0x38190000, 0x38192000, 0x38194000, 0x38196000, 0x38198000, 0x3819A000, 0x3819C000, 0x3819E000,
  0x381A0000, 0x381A2000, 0x381A4000, 0x381A6000, 0x381A8000, 0x381AA000, 0x381AC000, 0x381AE000, 0x381B0000, 0x381B2000, 0x381B4000, 0x381B6000, 0x381B8000, 0x381BA000, 0x381BC000, 0x381BE000,
  0x381C0000, 0x381C2000, 0x381C4000, 0x381C6000, 0x381C8000, 0x381CA000, 0x381CC000, 0x381CE000, 0x381D0000, 0x381D2000, 0x381D4000, 0x381D6000, 0x381D8000, 0x381DA000, 0x381DC000, 0x381DE000,
  0x381E0000, 0x381E2000, 0x381E4000, 0x381E6000, 0x381E8000, 0x381EA000, 0x381EC000, 0x381EE000, 0x381F0000, 0x381F2000, 0x381F4000, 0x381F6000, 0x381F8000, 0x381FA000, 0x381FC000, 0x381FE000,
  0x38200000, 0x38202000, 0x38204000, 0x38206000, 0x38208000, 0x3820A000, 0x3820C000, 0x3820E000, 0x38210000, 0x38212000, 0x38214000, 0x38216000, 0x38218000, 0x3821A000, 0x3821C000, 0x3821E000,
  0x38220000, 0x38222000, 0x38224000, 0x38226000, 0x38228000, 0x3822A000, 0x3822C000, 0x3822E000, 0x38230000, 0x38232000, 0x38234000, 0x38236000, 0x38238000, 0x3823A000, 0x3823C000, 0x3823E000,
  0x38240000, 0x38242000, 0x38244000, 0x38246000, 0x38248000, 0x3824A000, 0x3824C000, 0x3824E000, 0x38250000, 0x38252000, 0x38254000, 0x38256000, 0x38258000, 0x3825A000, 0x3825C000, 0x3825E000,
  0x38260000, 0x38262000, 0x38264000, 0x38266000, 0x38268000, 0x3826A000, 0x3826C000, 0x3826E000, 0x38270000, 0x38272000, 0x38274000, 0x38276000, 0x38278000, 0x3827A000, 0x3827C000, 0x3827E000,
  0x38280000, 0x38282000, 0x38284000, 0x38286000, 0x38288000, 0x3828A000, 0x3828C000, 0x3828E000, 0x38290000, 0x38292000, 0x38294000, 0x38296000, 0x38298000, 0x3829A000, 0x3829C000, 0x3829E000,
  0x382A0000, 0x382A2000, 0x382A4000, 0x382A6000, 0x382A8000, 0x382AA000, 0x382AC000, 0x382AE000, 0x382B0000, 0x382B2000, 0x382B4000, 0x382B6000, 0x382B8000, 0x382BA000, 0x382BC000, 0x382BE000,
  0x382C0000, 0x382C2000, 0x382C4000, 0x382C6000, 0x382C8000, 0x382CA000, 0x382CC000, 0x382CE000, 0x382D0000, 0x382D2000, 0x382D4000, 0x382D6000, 0x382D8000, 0x382DA000, 0x382DC000, 0x382DE000,
  0x382E0000, 0x382E2000, 0x382E4000, 0x382E6000, 0x382E8000, 0x382EA000, 0x382EC000, 0x382EE000, 0x382F0000, 0x382F2000, 0x382F4000, 0x382F6000, 0x382F8000, 0x382FA000, 0x382FC000, 0x382FE000,
  0x38300000, 0x38302000, 0x38304000, 0x38306000, 0x38308000, 0x3830A000, 0x3830C000, 0x3830E000, 0x38310000, 0x38312000, 0x38314000, 0x38316000, 0x38318000, 0x3831A000, 0x3831C000, 0x3831E000,
  0x38320000, 0x38322000, 0x38324000, 0x38326000, 0x38328000, 0x3832A000, 0x3832C000, 0x3832E000, 0x38330000, 0x38332000, 0x38334000, 0x38336000, 0x38338000, 0x3833A000, 0x3833C000, 0x3833E000,
  0x38340000, 0x38342000, 0x38344000, 0x38346000, 0x38348000, 0x3834A000, 0x3834C000, 0x3834E000, 0x38350000, 0x38352000, 0x38354000, 0x38356000, 0x38358000, 0x3835A000, 0x3835C000, 0x3835E000,
  0x38360000, 0x38362000, 0x38364000, 0x38366000, 0x38368000, 0x3836A000, 0x3836C000, 0x3836E000, 0x38370000, 0x38372000, 0x38374000, 0x38376000, 0x38378000, 0x3837A000, 0x3837C000, 0x3837E000,
  0x38380000, 0x38382000, 0x38384000, 0x38386000, 0x38388000, 0x3838A000, 0x3838C000, 0x3838E000, 0x38390000, 0x38392000, 0x38394000, 0x38396000, 0x38398000, 0x3839A000, 0x3839C000, 0x3839E000,
  0x383A0000, 0x383A2000, 0x383A4000, 0x383A6000, 0x383A8000, 0x383AA000, 0x383AC000, 0x383AE000, 0x383B0000, 0x383B2000, 0x383B4000, 0x383B6000, 0x383B8000, 0x383BA000, 0x383BC000, 0x383BE000,
  0x383C0000, 0x383C2000, 0x383C4000, 0x383C6000, 0x383C8000, 0x383CA000, 0x383CC000, 0x383CE000, 0x383D0000, 0x383D2000, 0x383D4000, 0x383D6000, 0x383D8000, 0x383DA000, 0x383DC000, 0x383DE000,
  0x383E0000, 0x383E2000, 0x383E4000, 0x383E6000, 0x383E8000, 0x383EA000, 0x383EC000, 0x383EE000, 0x383F0000, 0x383F2000, 0x383F4000, 0x383F6000, 0x383F8000, 0x383FA000, 0x383FC000, 0x383FE000,
  0x38400000, 0x38402000, 0x38404000, 0x38406000, 0x38408000, 0x3840A000, 0x3840C000, 0x3840E000, 0x38410000, 0x38412000, 0x38414000, 0x38416000, 0x38418000, 0x3841A000, 0x3841C000, 0x3841E000,
  0x38420000, 0x38422000, 0x38424000, 0x38426000, 0x38428000, 0x3842A000, 0x3842C000, 0x3842E000, 0x38430000, 0x38432000, 0x38434000, 0x38436000, 0x38438000, 0x3843A000, 0x3843C000, 0x3843E000,
  0x38440000, 0x38442000, 0x38444000, 0x38446000, 0x38448000, 0x3844A000, 0x3844C000, 0x3844E000, 0x38450000, 0x38452000, 0x38454000, 0x38456000, 0x38458000, 0x3845A000, 0x3845C000, 0x3845E000,
  0x38460000, 0x38462000, 0x38464000, 0x38466000, 0x38468000, 0x3846A000, 0x3846C000, 0x3846E000, 0x38470000, 0x38472000, 0x38474000, 0x38476000, 0x38478000, 0x3847A000, 0x3847C000, 0x3847E000,
  0x38480000, 0x38482000, 0x38484000, 0x38486000, 0x38488000, 0x3848A000, 0x3848C000, 0x3848E000, 0x38490000, 0x38492000, 0x38494000, 0x38496000, 0x38498000, 0x3849A000, 0x3849C000, 0x3849E000,
  0x384A0000, 0x384A2000, 0x384A4000, 0x384A6000, 0x384A8000, 0x384AA000, 0x384AC000, 0x384AE000, 0x384B0000, 0x384B2000, 0x384B4000, 0x384B6000, 0x384B8000, 0x384BA000, 0x384BC000, 0x384BE000,
  0x384C0000, 0x384C2000, 0x384C4000, 0x384C6000, 0x384C8000, 0x384CA000, 0x384CC000, 0x384CE000, 0x384D0000, 0x384D2000, 0x384D4000, 0x384D6000, 0x384D8000, 0x384DA000, 0x384DC000, 0x384DE000,
  0x384E0000, 0x384E2000, 0x384E4000, 0x384E6000, 0x384E8000, 0x384EA000, 0x384EC000, 0x384EE000, 0x384F0000, 0x384F2000, 0x384F4000, 0x384F6000, 0x384F8000, 0x384FA000, 0x384FC000, 0x384FE000,
  0x38500000, 0x38502000, 0x38504000, 0x38506000, 0x38508000, 0x3850A000, 0x3850C000, 0x3850E000, 0x38510000, 0x38512000, 0x38514000, 0x38516000, 0x38518000, 0x3851A000, 0x3851C000, 0x3851E000,
  0x38520000, 0x38522000, 0x38524000, 0x38526000, 0x38528000, 0x3852A000, 0x3852C000, 0x3852E000, 0x38530000, 0x38532000, 0x38534000, 0x38536000, 0x38538000, 0x3853A000, 0x3853C000, 0x3853E000,
  0x38540000, 0x38542000, 0x38544000, 0x38546000, 0x38548000, 0x3854A000, 0x3854C000, 0x3854E000, 0x38550000, 0x38552000, 0x38554000, 0x38556000, 0x38558000, 0x3855A000, 0x3855C000, 0x3855E000,
  0x38560000, 0x38562000, 0x38564000, 0x38566000, 0x38568000, 0x3856A000, 0x3856C000, 0x3856E000, 0x38570000, 0x38572000, 0x38574000, 0x38576000, 0x38578000, 0x3857A000, 0x3857C000, 0x3857E000,
  0x38580000, 0x38582000, 0x38584000, 0x38586000, 0x38588000, 0x3858A000, 0x3858C000, 0x3858E000, 0x38590000, 0x38592000, 0x38594000, 0x38596000, 0x38598000, 0x3859A000, 0x3859C000, 0x3859E000,
  0x385A0000, 0x385A2000, 0x385A4000, 0x385A6000, 0x385A8000, 0x385AA000, 0x385AC000, 0x385AE000, 0x385B0000, 0x385B2000, 0x385B4000, 0x385B6000, 0x385B8000, 0x385BA000, 0x385BC000, 0x385BE000,
  0x385C0000, 0x385C2000, 0x385C4000, 0x385C6000, 0x385C8000, 0x385CA000, 0x385CC000, 0x385CE000, 0x385D0000, 0x385D2000, 0x385D4000, 0x385D6000, 0x385D8000, 0x385DA000, 0x385DC000, 0x385DE000,
  0x385E0000, 0x385E2000, 0x385E4000, 0x385E6000, 0x385E8000, 0x385EA000, 0x385EC000, 0x385EE000, 0x385F0000, 0x385F2000, 0x385F4000, 0x385F6000, 0x385F8000, 0x385FA000, 0x385FC000, 0x385FE000,
  0x38600000, 0x38602000, 0x38604000, 0x38606000, 0x38608000, 0x3860A000, 0x3860C000, 0x3860E000, 0x38610000, 0x38612000, 0x38614000, 0x38616000, 0x38618000, 0x3861A000, 0x3861C000, 0x3861E000,
  0x38620000, 0x38622000, 0x38624000, 0x38626000, 0x38628000, 0x3862A000, 0x3862C000, 0x3862E000, 0x38630000, 0x38632000, 0x38634000, 0x38636000, 0x38638000, 0x3863A000, 0x3863C000, 0x3863E000,
  0x38640000, 0x38642000, 0x38644000, 0x38646000, 0x38648000, 0x3864A000, 0x3864C000, 0x3864E000, 0x38650000, 0x38652000, 0x38654000, 0x38656000, 0x38658000, 0x3865A000, 0x3865C000, 0x3865E000,
  0x38660000, 0x38662000, 0x38664000, 0x38666000, 0x38668000, 0x3866A000, 0x3866C000, 0x3866E000, 0x38670000, 0x38672000, 0x38674000, 0x38676000, 0x38678000, 0x3867A000, 0x3867C000, 0x3867E000,
  0x38680000, 0x38682000, 0x38684000, 0x38686000, 0x38688000, 0x3868A000, 0x3868C000, 0x3868E000, 0x38690000, 0x38692000, 0x38694000, 0x38696000, 0x38698000, 0x3869A000, 0x3869C000, 0x3869E000,
  0x386A0000, 0x386A2000, 0x386A4000, 0x386A6000, 0x386A8000, 0x386AA000, 0x386AC000, 0x386AE000, 0x386B0000, 0x386B2000, 0x386B4000, 0x386B6000, 0x386B8000, 0x386BA000, 0x386BC000, 0x386BE000,
  0x386C0000, 0x386C2000, 0x386C4000, 0x386C6000, 0x386C8000, 0x386CA000, 0x386CC000, 0x386CE000, 0x386D0000, 0x386D2000, 0x386D4000, 0x386D6000, 0x386D8000, 0x386DA000, 0x386DC000, 0x386DE000,
  0x386E0000, 0x386E2000, 0x386E4000, 0x386E6000, 0x386E8000, 0x386EA000, 0x386EC000, 0x386EE000, 0x386F0000, 0x386F2000, 0x386F4000, 0x386F6000, 0x386F8000, 0x386FA000, 0x386FC000, 0x386FE000,
  0x38700000, 0x38702000, 0x38704000, 0x38706000, 0x38708000, 0x3870A000, 0x3870C000, 0x3870E000, 0x38710000, 0x38712000, 0x38714000, 0x38716000, 0x38718000, 0x3871A000, 0x3871C000, 0x3871E000,
  0x38720000, 0x38722000, 0x38724000, 0x38726000, 0x38728000, 0x3872A000, 0x3872C000, 0x3872E000, 0x38730000, 0x38732000, 0x38734000, 0x38736000, 0x38738000, 0x3873A000, 0x3873C000, 0x3873E000,
  0x38740000, 0x38742000, 0x38744000, 0x38746000, 0x38748000, 0x3874A000, 0x3874C000, 0x3874E000, 0x38750000, 0x38752000, 0x38754000, 0x38756000, 0x38758000, 0x3875A000, 0x3875C000, 0x3875E000,
  0x38760000, 0x38762000, 0x38764000, 0x38766000, 0x38768000, 0x3876A000, 0x3876C000, 0x3876E000, 0x38770000, 0x38772000, 0x38774000, 0x38776000, 0x38778000, 0x3877A000, 0x3877C000, 0x3877E000,
  0x38780000, 0x38782000, 0x38784000, 0x38786000, 0x38788000, 0x3878A000, 0x3878C000, 0x3878E000, 0x38790000, 0x38792000, 0x38794000, 0x38796000, 0x38798000, 0x3879A000, 0x3879C000, 0x3879E000,
  0x387A0000, 0x387A2000, 0x387A4000, 0x387A6000, 0x387A8000, 0x387AA000, 0x387AC000, 0x387AE000, 0x387B0000, 0x387B2000, 0x387B4000, 0x387B6000, 0x387B8000, 0x387BA000, 0x387BC000, 0x387BE000,
  0x387C0000, 0x387C2000, 0x387C4000, 0x387C6000, 0x387C8000, 0x387CA000, 0x387CC000, 0x387CE000, 0x387D0000, 0x387D2000, 0x387D4000, 0x387D6000, 0x387D8000, 0x387DA000, 0x387DC000, 0x387DE000,
  0x387E0000, 0x387E2000, 0x387E4000, 0x387E6000, 0x387E8000, 0x387EA000, 0x387EC000, 0x387EE000, 0x387F0000, 0x387F2000, 0x387F4000, 0x387F6000, 0x387F8000, 0x387FA000, 0x387FC000, 0x387FE000 };
__constant static const uint32_t exponent_table[64] = {
  0x00000000, 0x00800000, 0x01000000, 0x01800000, 0x02000000, 0x02800000, 0x03000000, 0x03800000, 0x04000000, 0x04800000, 0x05000000, 0x05800000, 0x06000000, 0x06800000, 0x07000000, 0x07800000,
  0x08000000, 0x08800000, 0x09000000, 0x09800000, 0x0A000000, 0x0A800000, 0x0B000000, 0x0B800000, 0x0C000000, 0x0C800000, 0x0D000000, 0x0D800000, 0x0E000000, 0x0E800000, 0x0F000000, 0x47800000,
  0x80000000, 0x80800000, 0x81000000, 0x81800000, 0x82000000, 0x82800000, 0x83000000, 0x83800000, 0x84000000, 0x84800000, 0x85000000, 0x85800000, 0x86000000, 0x86800000, 0x87000000, 0x87800000,
  0x88000000, 0x88800000, 0x89000000, 0x89800000, 0x8A000000, 0x8A800000, 0x8B000000, 0x8B800000, 0x8C000000, 0x8C800000, 0x8D000000, 0x8D800000, 0x8E000000, 0x8E800000, 0x8F000000, 0xC7800000 };
__constant static const unsigned short offset_table[64] = {
  0, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024,
  0, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024 };

SCALAR_FUN_ATTR uint16_t float2halfbits(float value) {
  union { float x; uint32_t y; } u;
  u.x = value;
  uint32_t bits = u.y;

  uint16_t hbits = base_table[bits>>23] + (uint16_t)((bits&0x7FFFFF)>>shift_table[bits>>23]);;

  return hbits;
}

SCALAR_FUN_ATTR float halfbits2float(uint16_t value) {
  uint32_t bits = mantissa_table[offset_table[value>>10]+(value&0x3FF)] + exponent_table[value>>10];

  union { uint32_t x; float y; } u;
  u.x = bits;
  return u.y;
}

SCALAR_FUN_ATTR uint16_t halfbitsnextafter(uint16_t from, uint16_t to) {
  int fabs = from & 0x7FFF, tabs = to & 0x7FFF;
  if(fabs > 0x7C00 || tabs > 0x7C00) {
    return ((from&0x7FFF)>0x7C00) ? (from|0x200) : (to|0x200);
  }
  if(from == to || !(fabs|tabs)) {
    return to;
  }
  if(!fabs) {
    return (to&0x8000)+1;
  }
  unsigned int out =
    from +
    (((from>>15)^(unsigned int)((from^(0x8000|(0x8000-(from>>15))))<(to^(0x8000|(0x8000-(to>>15))))))<<1)
    - 1;
  return out;
}

// End of half.h.
// Start of timing.h.

// The function get_wall_time() returns the wall time in microseconds
// (with an unspecified offset).

#ifdef _WIN32

#include <windows.h>

static int64_t get_wall_time(void) {
  LARGE_INTEGER time,freq;
  assert(QueryPerformanceFrequency(&freq));
  assert(QueryPerformanceCounter(&time));
  return ((double)time.QuadPart / freq.QuadPart) * 1000000;
}

static int64_t get_wall_time_ns(void) {
  return get_wall_time() * 1000;
}

#else
// Assuming POSIX

#include <time.h>
#include <sys/time.h>

static int64_t get_wall_time(void) {
  struct timeval time;
  assert(gettimeofday(&time,NULL) == 0);
  return time.tv_sec * 1000000 + time.tv_usec;
}

static int64_t get_wall_time_ns(void) {
  struct timespec time;
  assert(clock_gettime(CLOCK_REALTIME, &time) == 0);
  return time.tv_sec * 1000000000 + time.tv_nsec;
}

#endif

// End of timing.h.
// Start of lock.h.

// A very simple cross-platform implementation of locks.  Uses
// pthreads on Unix and some Windows thing there.  Futhark's
// host-level code is not multithreaded, but user code may be, so we
// need some mechanism for ensuring atomic access to API functions.
// This is that mechanism.  It is not exposed to user code at all, so
// we do not have to worry about name collisions.

#ifdef _WIN32

typedef HANDLE lock_t;

static void create_lock(lock_t *lock) {
  *lock = CreateMutex(NULL,  // Default security attributes.
                      FALSE, // Initially unlocked.
                      NULL); // Unnamed.
}

static void lock_lock(lock_t *lock) {
  assert(WaitForSingleObject(*lock, INFINITE) == WAIT_OBJECT_0);
}

static void lock_unlock(lock_t *lock) {
  assert(ReleaseMutex(*lock));
}

static void free_lock(lock_t *lock) {
  CloseHandle(*lock);
}

#else
// Assuming POSIX

#include <pthread.h>

typedef pthread_mutex_t lock_t;

static void create_lock(lock_t *lock) {
  int r = pthread_mutex_init(lock, NULL);
  assert(r == 0);
}

static void lock_lock(lock_t *lock) {
  int r = pthread_mutex_lock(lock);
  assert(r == 0);
}

static void lock_unlock(lock_t *lock) {
  int r = pthread_mutex_unlock(lock);
  assert(r == 0);
}

static void free_lock(lock_t *lock) {
  // Nothing to do for pthreads.
  (void)lock;
}

#endif

// End of lock.h.
// Start of free_list.h.

typedef uintptr_t fl_mem;

// An entry in the free list.  May be invalid, to avoid having to
// deallocate entries as soon as they are removed.  There is also a
// tag, to help with memory reuse.
struct free_list_entry {
  size_t size;
  fl_mem mem;
  const char *tag;
  unsigned char valid;
};

struct free_list {
  struct free_list_entry *entries; // Pointer to entries.
  int capacity;                    // Number of entries.
  int used;                        // Number of valid entries.
  lock_t lock;                     // Thread safety.
};

static void free_list_init(struct free_list *l) {
  l->capacity = 30; // Picked arbitrarily.
  l->used = 0;
  l->entries = (struct free_list_entry*) malloc(sizeof(struct free_list_entry) * l->capacity);
  for (int i = 0; i < l->capacity; i++) {
    l->entries[i].valid = 0;
  }
  create_lock(&l->lock);
}

// Remove invalid entries from the free list.
static void free_list_pack(struct free_list *l) {
  lock_lock(&l->lock);
  int p = 0;
  for (int i = 0; i < l->capacity; i++) {
    if (l->entries[i].valid) {
      l->entries[p] = l->entries[i];
      if (i > p) {
        l->entries[i].valid = 0;
      }
      p++;
    }
  }

  // Now p is the number of used elements.  We don't want it to go
  // less than the default capacity (although in practice it's OK as
  // long as it doesn't become 1).
  if (p < 30) {
    p = 30;
  }
  l->entries = realloc(l->entries, p * sizeof(struct free_list_entry));
  l->capacity = p;
  lock_unlock(&l->lock);
}

static void free_list_destroy(struct free_list *l) {
  assert(l->used == 0);
  free(l->entries);
  free_lock(&l->lock);
}

// Not part of the interface, so no locking.
static int free_list_find_invalid(struct free_list *l) {
  int i;
  for (i = 0; i < l->capacity; i++) {
    if (!l->entries[i].valid) {
      break;
    }
  }
  return i;
}

static void free_list_insert(struct free_list *l, size_t size, fl_mem mem, const char *tag) {
  lock_lock(&l->lock);
  int i = free_list_find_invalid(l);

  if (i == l->capacity) {
    // List is full; so we have to grow it.
    int new_capacity = l->capacity * 2 * sizeof(struct free_list_entry);
    l->entries = realloc(l->entries, new_capacity);
    for (int j = 0; j < l->capacity; j++) {
      l->entries[j+l->capacity].valid = 0;
    }
    l->capacity *= 2;
  }

  // Now 'i' points to the first invalid entry.
  l->entries[i].valid = 1;
  l->entries[i].size = size;
  l->entries[i].mem = mem;
  l->entries[i].tag = tag;

  l->used++;
  lock_unlock(&l->lock);
}

// Determine whether this entry in the free list is acceptable for
// satisfying the request.  Not public, so no locking.
static bool free_list_acceptable(size_t size, const char* tag, struct free_list_entry *entry) {
  // We check not just the hard requirement (is the entry acceptable
  // and big enough?) but also put a cap on how much wasted space
  // (internal fragmentation) we allow.  This is necessarily a
  // heuristic, and a crude one.

  if (!entry->valid) {
    return false;
  }

  if (size > entry->size) {
    return false;
  }

  // We know the block fits.  Now the question is whether it is too
  // big.  Our policy is as follows:
  //
  // 1) We don't care about wasted space below 4096 bytes (to avoid
  // churn in tiny allocations).
  //
  // 2) If the tag matches, we allow _any_ amount of wasted space.
  //
  // 3) Otherwise we allow up to 50% wasted space.

  if (entry->size < 4096) {
    return true;
  }

  if (entry->tag == tag) {
    return true;
  }

  if (entry->size < size * 2) {
    return true;
  }

  return false;
}

// Find and remove a memory block of the indicated tag, or if that
// does not exist, another memory block with exactly the desired size.
// Returns 0 on success.
static int free_list_find(struct free_list *l, size_t size, const char *tag,
                          size_t *size_out, fl_mem *mem_out) {
  lock_lock(&l->lock);
  int size_match = -1;
  int i;
  int ret = 1;
  for (i = 0; i < l->capacity; i++) {
    if (free_list_acceptable(size, tag, &l->entries[i]) &&
        (size_match < 0 || l->entries[i].size < l->entries[size_match].size)) {
      // If this entry is valid, has sufficient size, and is smaller than the
      // best entry found so far, use this entry.
      size_match = i;
    }
  }

  if (size_match >= 0) {
    l->entries[size_match].valid = 0;
    *size_out = l->entries[size_match].size;
    *mem_out = l->entries[size_match].mem;
    l->used--;
    ret = 0;
  }
  lock_unlock(&l->lock);
  return ret;
}

// Remove the first block in the free list.  Returns 0 if a block was
// removed, and nonzero if the free list was already empty.
static int free_list_first(struct free_list *l, fl_mem *mem_out) {
  lock_lock(&l->lock);
  int ret = 1;
  for (int i = 0; i < l->capacity; i++) {
    if (l->entries[i].valid) {
      l->entries[i].valid = 0;
      *mem_out = l->entries[i].mem;
      l->used--;
      ret = 0;
      break;
    }
  }
  lock_unlock(&l->lock);
  return ret;
}

// End of free_list.h.
// Start of event_list.h

typedef int (*event_report_fn)(struct str_builder*, void*);

struct event {
  void* data;
  event_report_fn f;
  const char* name;
  char *description;
};

struct event_list {
  struct event *events;
  int num_events;
  int capacity;
};

static void event_list_init(struct event_list *l) {
  l->capacity = 100;
  l->num_events = 0;
  l->events = calloc(l->capacity, sizeof(struct event));
}

static void event_list_free(struct event_list *l) {
  free(l->events);
}

static void add_event_to_list(struct event_list *l,
                              const char* name,
                              char* description,
                              void* data,
                              event_report_fn f) {
  if (l->num_events == l->capacity) {
    l->capacity *= 2;
    l->events = realloc(l->events, l->capacity * sizeof(struct event));
  }
  l->events[l->num_events].name = name;
  l->events[l->num_events].description = description;
  l->events[l->num_events].data = data;
  l->events[l->num_events].f = f;
  l->num_events++;
}

static int report_events_in_list(struct event_list *l,
                                 struct str_builder* sb) {
  int ret = 0;
  for (int i = 0; i < l->num_events; i++) {
    if (i != 0) {
      str_builder_str(sb, ",");
    }
    str_builder_str(sb, "{\"name\":");
    str_builder_json_str(sb, l->events[i].name);
    str_builder_str(sb, ",\"description\":");
    str_builder_json_str(sb, l->events[i].description);
    free(l->events[i].description);
    if (l->events[i].f(sb, l->events[i].data) != 0) {
      ret = 1;
      break;
    }
    str_builder(sb, "}");
  }
  event_list_free(l);
  event_list_init(l);
  return ret;
}

// End of event_list.h

#ifdef _MSC_VER
#define inline __inline
#endif
#include <string.h>
#include <string.h>
#include <errno.h>
#include <assert.h>
#include <ctype.h>


#include <cuda.h>
#include <cuda_runtime.h>
#include <nvrtc.h>


#define FUTHARK_F64_ENABLED

// Start of scalar.h.

// Implementation of the primitive scalar operations.  Very
// repetitive.  This code is inserted directly into both CUDA and
// OpenCL programs, as well as the CPU code, so it has some #ifdefs to
// work everywhere.  Some operations are defined as macros because
// this allows us to use them as constant expressions in things like
// array sizes and static initialisers.

// Some of the #ifdefs are because OpenCL uses type-generic functions
// for some operations (e.g. sqrt), while C and CUDA sensibly use
// distinct functions for different precisions (e.g. sqrtf() and
// sqrt()).  This is quite annoying.  Due to C's unfortunate casting
// rules, it is also really easy to accidentally implement
// floating-point functions in the wrong precision, so be careful.

// Double-precision definitions are only included if the preprocessor
// macro FUTHARK_F64_ENABLED is set.

SCALAR_FUN_ATTR int32_t futrts_to_bits32(float x);
SCALAR_FUN_ATTR float futrts_from_bits32(int32_t x);

SCALAR_FUN_ATTR uint8_t add8(uint8_t x, uint8_t y) {
  return x + y;
}

SCALAR_FUN_ATTR uint16_t add16(uint16_t x, uint16_t y) {
  return x + y;
}

SCALAR_FUN_ATTR uint32_t add32(uint32_t x, uint32_t y) {
  return x + y;
}

SCALAR_FUN_ATTR uint64_t add64(uint64_t x, uint64_t y) {
  return x + y;
}

SCALAR_FUN_ATTR uint8_t sub8(uint8_t x, uint8_t y) {
  return x - y;
}

SCALAR_FUN_ATTR uint16_t sub16(uint16_t x, uint16_t y) {
  return x - y;
}

SCALAR_FUN_ATTR uint32_t sub32(uint32_t x, uint32_t y) {
  return x - y;
}

SCALAR_FUN_ATTR uint64_t sub64(uint64_t x, uint64_t y) {
  return x - y;
}

SCALAR_FUN_ATTR uint8_t mul8(uint8_t x, uint8_t y) {
  return x * y;
}

SCALAR_FUN_ATTR uint16_t mul16(uint16_t x, uint16_t y) {
  return x * y;
}

SCALAR_FUN_ATTR uint32_t mul32(uint32_t x, uint32_t y) {
  return x * y;
}

SCALAR_FUN_ATTR uint64_t mul64(uint64_t x, uint64_t y) {
  return x * y;
}

#if ISPC

SCALAR_FUN_ATTR uint8_t udiv8(uint8_t x, uint8_t y) {
  // This strange pattern is used to prevent the ISPC compiler from
  // causing SIGFPEs and bogus results on divisions where inactive lanes
  // have 0-valued divisors. It ensures that any inactive lane instead
  // has a divisor of 1. https://github.com/ispc/ispc/issues/2292
  uint8_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  return x / ys;
}

SCALAR_FUN_ATTR uint16_t udiv16(uint16_t x, uint16_t y) {
  uint16_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  return x / ys;
}

SCALAR_FUN_ATTR uint32_t udiv32(uint32_t x, uint32_t y) {
  uint32_t ys = 1;
  foreach_active(i){
    ys = y;
  }


  return x / ys;
}

SCALAR_FUN_ATTR uint64_t udiv64(uint64_t x, uint64_t y) {
  uint64_t ys = 1;
  foreach_active(i){
    ys = y;
  }


  return x / ys;
}

SCALAR_FUN_ATTR uint8_t udiv_up8(uint8_t x, uint8_t y) {
  uint8_t ys = 1;
  foreach_active(i){
    ys = y;
  }


  return (x + y - 1) / ys;
}

SCALAR_FUN_ATTR uint16_t udiv_up16(uint16_t x, uint16_t y) {
  uint16_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  return (x + y - 1) / ys;
}

SCALAR_FUN_ATTR uint32_t udiv_up32(uint32_t x, uint32_t y) {
  uint32_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  return (x + y - 1) / ys;
}

SCALAR_FUN_ATTR uint64_t udiv_up64(uint64_t x, uint64_t y) {
  uint64_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  return (x + y - 1) / ys;
}

SCALAR_FUN_ATTR uint8_t umod8(uint8_t x, uint8_t y) {
  uint8_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  return x % ys;
}

SCALAR_FUN_ATTR uint16_t umod16(uint16_t x, uint16_t y) {
  uint16_t ys = 1;
  foreach_active(i){
    ys = y;
  }


  return x % ys;
}

SCALAR_FUN_ATTR uint32_t umod32(uint32_t x, uint32_t y) {
  uint32_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  return x % ys;
}

SCALAR_FUN_ATTR uint64_t umod64(uint64_t x, uint64_t y) {
  uint64_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  return x % ys;
}

SCALAR_FUN_ATTR uint8_t udiv_safe8(uint8_t x, uint8_t y) {
  uint8_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  return y == 0 ? 0 : x / ys;
}

SCALAR_FUN_ATTR uint16_t udiv_safe16(uint16_t x, uint16_t y) {
  uint16_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  return y == 0 ? 0 : x / ys;
}

SCALAR_FUN_ATTR uint32_t udiv_safe32(uint32_t x, uint32_t y) {
  uint32_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  return y == 0 ? 0 : x / ys;
}

SCALAR_FUN_ATTR uint64_t udiv_safe64(uint64_t x, uint64_t y) {
  uint64_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  return y == 0 ? 0 : x / ys;
}

SCALAR_FUN_ATTR uint8_t udiv_up_safe8(uint8_t x, uint8_t y) {
  uint8_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  return y == 0 ? 0 : (x + y - 1) / ys;
}

SCALAR_FUN_ATTR uint16_t udiv_up_safe16(uint16_t x, uint16_t y) {
  uint16_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  return y == 0 ? 0 : (x + y - 1) / ys;
}

SCALAR_FUN_ATTR uint32_t udiv_up_safe32(uint32_t x, uint32_t y) {
  uint32_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  return y == 0 ? 0 : (x + y - 1) / ys;
}

SCALAR_FUN_ATTR uint64_t udiv_up_safe64(uint64_t x, uint64_t y) {
  uint64_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  return y == 0 ? 0 : (x + y - 1) / ys;
}

SCALAR_FUN_ATTR uint8_t umod_safe8(uint8_t x, uint8_t y) {
  uint8_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  return y == 0 ? 0 : x % ys;
}

SCALAR_FUN_ATTR uint16_t umod_safe16(uint16_t x, uint16_t y) {
  uint16_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  return y == 0 ? 0 : x % ys;
}

SCALAR_FUN_ATTR uint32_t umod_safe32(uint32_t x, uint32_t y) {
  uint32_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  return y == 0 ? 0 : x % ys;
}

SCALAR_FUN_ATTR uint64_t umod_safe64(uint64_t x, uint64_t y) {
  uint64_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  return y == 0 ? 0 : x % ys;
}

SCALAR_FUN_ATTR int8_t sdiv8(int8_t x, int8_t y) {
  int8_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  int8_t q = x / ys;
  int8_t r = x % ys;

  return q - ((r != 0 && r < 0 != y < 0) ? 1 : 0);
}

SCALAR_FUN_ATTR int16_t sdiv16(int16_t x, int16_t y) {
  int16_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  int16_t q = x / ys;
  int16_t r = x % ys;

  return q - ((r != 0 && r < 0 != y < 0) ? 1 : 0);
}

SCALAR_FUN_ATTR int32_t sdiv32(int32_t x, int32_t y) {
  int32_t ys = 1;
  foreach_active(i){
    ys = y;
  }
  int32_t q = x / ys;
  int32_t r = x % ys;

  return q - ((r != 0 && r < 0 != y < 0) ? 1 : 0);
}

SCALAR_FUN_ATTR int64_t sdiv64(int64_t x, int64_t y) {
  int64_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  int64_t q = x / ys;
  int64_t r = x % ys;

  return q - ((r != 0 && r < 0 != y < 0) ? 1 : 0);
}

SCALAR_FUN_ATTR int8_t sdiv_up8(int8_t x, int8_t y) {
  return sdiv8(x + y - 1, y);
}

SCALAR_FUN_ATTR int16_t sdiv_up16(int16_t x, int16_t y) {
  return sdiv16(x + y - 1, y);
}

SCALAR_FUN_ATTR int32_t sdiv_up32(int32_t x, int32_t y) {
  return sdiv32(x + y - 1, y);
}

SCALAR_FUN_ATTR int64_t sdiv_up64(int64_t x, int64_t y) {
  return sdiv64(x + y - 1, y);
}

SCALAR_FUN_ATTR int8_t smod8(int8_t x, int8_t y) {
  int8_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  int8_t r = x % ys;

  return r + (r == 0 || (x > 0 && y > 0) || (x < 0 && y < 0) ? 0 : y);
}

SCALAR_FUN_ATTR int16_t smod16(int16_t x, int16_t y) {
  int16_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  int16_t r = x % ys;

  return r + (r == 0 || (x > 0 && y > 0) || (x < 0 && y < 0) ? 0 : y);
}

SCALAR_FUN_ATTR int32_t smod32(int32_t x, int32_t y) {
  int32_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  int32_t r = x % ys;

  return r + (r == 0 || (x > 0 && y > 0) || (x < 0 && y < 0) ? 0 : y);
}

SCALAR_FUN_ATTR int64_t smod64(int64_t x, int64_t y) {
  int64_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  int64_t r = x % ys;

  return r + (r == 0 || (x > 0 && y > 0) || (x < 0 && y < 0) ? 0 : y);
}

SCALAR_FUN_ATTR int8_t sdiv_safe8(int8_t x, int8_t y) {
  return y == 0 ? 0 : sdiv8(x, y);
}

SCALAR_FUN_ATTR int16_t sdiv_safe16(int16_t x, int16_t y) {
  return y == 0 ? 0 : sdiv16(x, y);
}

SCALAR_FUN_ATTR int32_t sdiv_safe32(int32_t x, int32_t y) {
  return y == 0 ? 0 : sdiv32(x, y);
}

SCALAR_FUN_ATTR int64_t sdiv_safe64(int64_t x, int64_t y) {
  return y == 0 ? 0 : sdiv64(x, y);
}

SCALAR_FUN_ATTR int8_t sdiv_up_safe8(int8_t x, int8_t y) {
  return sdiv_safe8(x + y - 1, y);
}

SCALAR_FUN_ATTR int16_t sdiv_up_safe16(int16_t x, int16_t y) {
  return sdiv_safe16(x + y - 1, y);
}

SCALAR_FUN_ATTR int32_t sdiv_up_safe32(int32_t x, int32_t y) {
  return sdiv_safe32(x + y - 1, y);
}

SCALAR_FUN_ATTR int64_t sdiv_up_safe64(int64_t x, int64_t y) {
  return sdiv_safe64(x + y - 1, y);
}

SCALAR_FUN_ATTR int8_t smod_safe8(int8_t x, int8_t y) {
  return y == 0 ? 0 : smod8(x, y);
}

SCALAR_FUN_ATTR int16_t smod_safe16(int16_t x, int16_t y) {
  return y == 0 ? 0 : smod16(x, y);
}

SCALAR_FUN_ATTR int32_t smod_safe32(int32_t x, int32_t y) {
  return y == 0 ? 0 : smod32(x, y);
}

SCALAR_FUN_ATTR int64_t smod_safe64(int64_t x, int64_t y) {
  return y == 0 ? 0 : smod64(x, y);
}

SCALAR_FUN_ATTR int8_t squot8(int8_t x, int8_t y) {
  int8_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  return x / ys;
}

SCALAR_FUN_ATTR int16_t squot16(int16_t x, int16_t y) {
  int16_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  return x / ys;
}

SCALAR_FUN_ATTR int32_t squot32(int32_t x, int32_t y) {
  int32_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  return x / ys;
}

SCALAR_FUN_ATTR int64_t squot64(int64_t x, int64_t y) {
  int64_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  return x / ys;
}

SCALAR_FUN_ATTR int8_t srem8(int8_t x, int8_t y) {
  int8_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  return x % ys;
}

SCALAR_FUN_ATTR int16_t srem16(int16_t x, int16_t y) {
  int16_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  return x % ys;
}

SCALAR_FUN_ATTR int32_t srem32(int32_t x, int32_t y) {
  int32_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  return x % ys;
}

SCALAR_FUN_ATTR int64_t srem64(int64_t x, int64_t y) {
  int8_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  return x % ys;
}

SCALAR_FUN_ATTR int8_t squot_safe8(int8_t x, int8_t y) {
  int8_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  return y == 0 ? 0 : x / ys;
}

SCALAR_FUN_ATTR int16_t squot_safe16(int16_t x, int16_t y) {
  int16_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  return y == 0 ? 0 : x / ys;
}

SCALAR_FUN_ATTR int32_t squot_safe32(int32_t x, int32_t y) {
  int32_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  return y == 0 ? 0 : x / ys;
}

SCALAR_FUN_ATTR int64_t squot_safe64(int64_t x, int64_t y) {
  int64_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  return y == 0 ? 0 : x / ys;
}

SCALAR_FUN_ATTR int8_t srem_safe8(int8_t x, int8_t y) {
  int8_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  return y == 0 ? 0 : x % ys;
}

SCALAR_FUN_ATTR int16_t srem_safe16(int16_t x, int16_t y) {
  int16_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  return y == 0 ? 0 : x % ys;
}

SCALAR_FUN_ATTR int32_t srem_safe32(int32_t x, int32_t y) {
  int32_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  return y == 0 ? 0 : x % ys;
}

SCALAR_FUN_ATTR int64_t srem_safe64(int64_t x, int64_t y) {
  int64_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  return y == 0 ? 0 : x % ys;
}

#else

SCALAR_FUN_ATTR uint8_t udiv8(uint8_t x, uint8_t y) {
  return x / y;
}

SCALAR_FUN_ATTR uint16_t udiv16(uint16_t x, uint16_t y) {
  return x / y;
}

SCALAR_FUN_ATTR uint32_t udiv32(uint32_t x, uint32_t y) {
  return x / y;
}

SCALAR_FUN_ATTR uint64_t udiv64(uint64_t x, uint64_t y) {
  return x / y;
}

SCALAR_FUN_ATTR uint8_t udiv_up8(uint8_t x, uint8_t y) {
  return (x + y - 1) / y;
}

SCALAR_FUN_ATTR uint16_t udiv_up16(uint16_t x, uint16_t y) {
  return (x + y - 1) / y;
}

SCALAR_FUN_ATTR uint32_t udiv_up32(uint32_t x, uint32_t y) {
  return (x + y - 1) / y;
}

SCALAR_FUN_ATTR uint64_t udiv_up64(uint64_t x, uint64_t y) {
  return (x + y - 1) / y;
}

SCALAR_FUN_ATTR uint8_t umod8(uint8_t x, uint8_t y) {
  return x % y;
}

SCALAR_FUN_ATTR uint16_t umod16(uint16_t x, uint16_t y) {
  return x % y;
}

SCALAR_FUN_ATTR uint32_t umod32(uint32_t x, uint32_t y) {
  return x % y;
}

SCALAR_FUN_ATTR uint64_t umod64(uint64_t x, uint64_t y) {
  return x % y;
}

SCALAR_FUN_ATTR uint8_t udiv_safe8(uint8_t x, uint8_t y) {
  return y == 0 ? 0 : x / y;
}

SCALAR_FUN_ATTR uint16_t udiv_safe16(uint16_t x, uint16_t y) {
  return y == 0 ? 0 : x / y;
}

SCALAR_FUN_ATTR uint32_t udiv_safe32(uint32_t x, uint32_t y) {
  return y == 0 ? 0 : x / y;
}

SCALAR_FUN_ATTR uint64_t udiv_safe64(uint64_t x, uint64_t y) {
  return y == 0 ? 0 : x / y;
}

SCALAR_FUN_ATTR uint8_t udiv_up_safe8(uint8_t x, uint8_t y) {
  return y == 0 ? 0 : (x + y - 1) / y;
}

SCALAR_FUN_ATTR uint16_t udiv_up_safe16(uint16_t x, uint16_t y) {
  return y == 0 ? 0 : (x + y - 1) / y;
}

SCALAR_FUN_ATTR uint32_t udiv_up_safe32(uint32_t x, uint32_t y) {
  return y == 0 ? 0 : (x + y - 1) / y;
}

SCALAR_FUN_ATTR uint64_t udiv_up_safe64(uint64_t x, uint64_t y) {
  return y == 0 ? 0 : (x + y - 1) / y;
}

SCALAR_FUN_ATTR uint8_t umod_safe8(uint8_t x, uint8_t y) {
  return y == 0 ? 0 : x % y;
}

SCALAR_FUN_ATTR uint16_t umod_safe16(uint16_t x, uint16_t y) {
  return y == 0 ? 0 : x % y;
}

SCALAR_FUN_ATTR uint32_t umod_safe32(uint32_t x, uint32_t y) {
  return y == 0 ? 0 : x % y;
}

SCALAR_FUN_ATTR uint64_t umod_safe64(uint64_t x, uint64_t y) {
  return y == 0 ? 0 : x % y;
}

SCALAR_FUN_ATTR int8_t sdiv8(int8_t x, int8_t y) {
  int8_t q = x / y;
  int8_t r = x % y;

  return q - ((r != 0 && r < 0 != y < 0) ? 1 : 0);
}

SCALAR_FUN_ATTR int16_t sdiv16(int16_t x, int16_t y) {
  int16_t q = x / y;
  int16_t r = x % y;

  return q - ((r != 0 && r < 0 != y < 0) ? 1 : 0);
}

SCALAR_FUN_ATTR int32_t sdiv32(int32_t x, int32_t y) {
  int32_t q = x / y;
  int32_t r = x % y;

  return q - ((r != 0 && r < 0 != y < 0) ? 1 : 0);
}

SCALAR_FUN_ATTR int64_t sdiv64(int64_t x, int64_t y) {
  int64_t q = x / y;
  int64_t r = x % y;

  return q - ((r != 0 && r < 0 != y < 0) ? 1 : 0);
}

SCALAR_FUN_ATTR int8_t sdiv_up8(int8_t x, int8_t y) {
  return sdiv8(x + y - 1, y);
}

SCALAR_FUN_ATTR int16_t sdiv_up16(int16_t x, int16_t y) {
  return sdiv16(x + y - 1, y);
}

SCALAR_FUN_ATTR int32_t sdiv_up32(int32_t x, int32_t y) {
  return sdiv32(x + y - 1, y);
}

SCALAR_FUN_ATTR int64_t sdiv_up64(int64_t x, int64_t y) {
  return sdiv64(x + y - 1, y);
}

SCALAR_FUN_ATTR int8_t smod8(int8_t x, int8_t y) {
  int8_t r = x % y;

  return r + (r == 0 || (x > 0 && y > 0) || (x < 0 && y < 0) ? 0 : y);
}

SCALAR_FUN_ATTR int16_t smod16(int16_t x, int16_t y) {
  int16_t r = x % y;

  return r + (r == 0 || (x > 0 && y > 0) || (x < 0 && y < 0) ? 0 : y);
}

SCALAR_FUN_ATTR int32_t smod32(int32_t x, int32_t y) {
  int32_t r = x % y;

  return r + (r == 0 || (x > 0 && y > 0) || (x < 0 && y < 0) ? 0 : y);
}

SCALAR_FUN_ATTR int64_t smod64(int64_t x, int64_t y) {
  int64_t r = x % y;

  return r + (r == 0 || (x > 0 && y > 0) || (x < 0 && y < 0) ? 0 : y);
}

SCALAR_FUN_ATTR int8_t sdiv_safe8(int8_t x, int8_t y) {
  return y == 0 ? 0 : sdiv8(x, y);
}

SCALAR_FUN_ATTR int16_t sdiv_safe16(int16_t x, int16_t y) {
  return y == 0 ? 0 : sdiv16(x, y);
}

SCALAR_FUN_ATTR int32_t sdiv_safe32(int32_t x, int32_t y) {
  return y == 0 ? 0 : sdiv32(x, y);
}

SCALAR_FUN_ATTR int64_t sdiv_safe64(int64_t x, int64_t y) {
  return y == 0 ? 0 : sdiv64(x, y);
}

SCALAR_FUN_ATTR int8_t sdiv_up_safe8(int8_t x, int8_t y) {
  return sdiv_safe8(x + y - 1, y);
}

SCALAR_FUN_ATTR int16_t sdiv_up_safe16(int16_t x, int16_t y) {
  return sdiv_safe16(x + y - 1, y);
}

SCALAR_FUN_ATTR int32_t sdiv_up_safe32(int32_t x, int32_t y) {
  return sdiv_safe32(x + y - 1, y);
}

SCALAR_FUN_ATTR int64_t sdiv_up_safe64(int64_t x, int64_t y) {
  return sdiv_safe64(x + y - 1, y);
}

SCALAR_FUN_ATTR int8_t smod_safe8(int8_t x, int8_t y) {
  return y == 0 ? 0 : smod8(x, y);
}

SCALAR_FUN_ATTR int16_t smod_safe16(int16_t x, int16_t y) {
  return y == 0 ? 0 : smod16(x, y);
}

SCALAR_FUN_ATTR int32_t smod_safe32(int32_t x, int32_t y) {
  return y == 0 ? 0 : smod32(x, y);
}

SCALAR_FUN_ATTR int64_t smod_safe64(int64_t x, int64_t y) {
  return y == 0 ? 0 : smod64(x, y);
}

SCALAR_FUN_ATTR int8_t squot8(int8_t x, int8_t y) {
  return x / y;
}

SCALAR_FUN_ATTR int16_t squot16(int16_t x, int16_t y) {
  return x / y;
}

SCALAR_FUN_ATTR int32_t squot32(int32_t x, int32_t y) {
  return x / y;
}

SCALAR_FUN_ATTR int64_t squot64(int64_t x, int64_t y) {
  return x / y;
}

SCALAR_FUN_ATTR int8_t srem8(int8_t x, int8_t y) {
  return x % y;
}

SCALAR_FUN_ATTR int16_t srem16(int16_t x, int16_t y) {
  return x % y;
}

SCALAR_FUN_ATTR int32_t srem32(int32_t x, int32_t y) {
  return x % y;
}

SCALAR_FUN_ATTR int64_t srem64(int64_t x, int64_t y) {
  return x % y;
}

SCALAR_FUN_ATTR int8_t squot_safe8(int8_t x, int8_t y) {
  return y == 0 ? 0 : x / y;
}

SCALAR_FUN_ATTR int16_t squot_safe16(int16_t x, int16_t y) {
  return y == 0 ? 0 : x / y;
}

SCALAR_FUN_ATTR int32_t squot_safe32(int32_t x, int32_t y) {
  return y == 0 ? 0 : x / y;
}

SCALAR_FUN_ATTR int64_t squot_safe64(int64_t x, int64_t y) {
  return y == 0 ? 0 : x / y;
}

SCALAR_FUN_ATTR int8_t srem_safe8(int8_t x, int8_t y) {
  return y == 0 ? 0 : x % y;
}

SCALAR_FUN_ATTR int16_t srem_safe16(int16_t x, int16_t y) {
  return y == 0 ? 0 : x % y;
}

SCALAR_FUN_ATTR int32_t srem_safe32(int32_t x, int32_t y) {
  return y == 0 ? 0 : x % y;
}

SCALAR_FUN_ATTR int64_t srem_safe64(int64_t x, int64_t y) {
  return y == 0 ? 0 : x % y;
}

#endif

SCALAR_FUN_ATTR int8_t smin8(int8_t x, int8_t y) {
  return x < y ? x : y;
}

SCALAR_FUN_ATTR int16_t smin16(int16_t x, int16_t y) {
  return x < y ? x : y;
}

SCALAR_FUN_ATTR int32_t smin32(int32_t x, int32_t y) {
  return x < y ? x : y;
}

SCALAR_FUN_ATTR int64_t smin64(int64_t x, int64_t y) {
  return x < y ? x : y;
}

SCALAR_FUN_ATTR uint8_t umin8(uint8_t x, uint8_t y) {
  return x < y ? x : y;
}

SCALAR_FUN_ATTR uint16_t umin16(uint16_t x, uint16_t y) {
  return x < y ? x : y;
}

SCALAR_FUN_ATTR uint32_t umin32(uint32_t x, uint32_t y) {
  return x < y ? x : y;
}

SCALAR_FUN_ATTR uint64_t umin64(uint64_t x, uint64_t y) {
  return x < y ? x : y;
}

SCALAR_FUN_ATTR int8_t smax8(int8_t x, int8_t y) {
  return x < y ? y : x;
}

SCALAR_FUN_ATTR int16_t smax16(int16_t x, int16_t y) {
  return x < y ? y : x;
}

SCALAR_FUN_ATTR int32_t smax32(int32_t x, int32_t y) {
  return x < y ? y : x;
}

SCALAR_FUN_ATTR int64_t smax64(int64_t x, int64_t y) {
  return x < y ? y : x;
}

SCALAR_FUN_ATTR uint8_t umax8(uint8_t x, uint8_t y) {
  return x < y ? y : x;
}

SCALAR_FUN_ATTR uint16_t umax16(uint16_t x, uint16_t y) {
  return x < y ? y : x;
}

SCALAR_FUN_ATTR uint32_t umax32(uint32_t x, uint32_t y) {
  return x < y ? y : x;
}

SCALAR_FUN_ATTR uint64_t umax64(uint64_t x, uint64_t y) {
  return x < y ? y : x;
}

SCALAR_FUN_ATTR uint8_t shl8(uint8_t x, uint8_t y) {
  return (uint8_t)(x << y);
}

SCALAR_FUN_ATTR uint16_t shl16(uint16_t x, uint16_t y) {
  return (uint16_t)(x << y);
}

SCALAR_FUN_ATTR uint32_t shl32(uint32_t x, uint32_t y) {
  return x << y;
}

SCALAR_FUN_ATTR uint64_t shl64(uint64_t x, uint64_t y) {
  return x << y;
}

SCALAR_FUN_ATTR uint8_t lshr8(uint8_t x, uint8_t y) {
  return x >> y;
}

SCALAR_FUN_ATTR uint16_t lshr16(uint16_t x, uint16_t y) {
  return x >> y;
}

SCALAR_FUN_ATTR uint32_t lshr32(uint32_t x, uint32_t y) {
  return x >> y;
}

SCALAR_FUN_ATTR uint64_t lshr64(uint64_t x, uint64_t y) {
  return x >> y;
}

SCALAR_FUN_ATTR int8_t ashr8(int8_t x, int8_t y) {
  return x >> y;
}

SCALAR_FUN_ATTR int16_t ashr16(int16_t x, int16_t y) {
  return x >> y;
}

SCALAR_FUN_ATTR int32_t ashr32(int32_t x, int32_t y) {
  return x >> y;
}

SCALAR_FUN_ATTR int64_t ashr64(int64_t x, int64_t y) {
  return x >> y;
}

SCALAR_FUN_ATTR uint8_t and8(uint8_t x, uint8_t y) {
  return x & y;
}

SCALAR_FUN_ATTR uint16_t and16(uint16_t x, uint16_t y) {
  return x & y;
}

SCALAR_FUN_ATTR uint32_t and32(uint32_t x, uint32_t y) {
  return x & y;
}

SCALAR_FUN_ATTR uint64_t and64(uint64_t x, uint64_t y) {
  return x & y;
}

SCALAR_FUN_ATTR uint8_t or8(uint8_t x, uint8_t y) {
  return x | y;
}

SCALAR_FUN_ATTR uint16_t or16(uint16_t x, uint16_t y) {
  return x | y;
}

SCALAR_FUN_ATTR uint32_t or32(uint32_t x, uint32_t y) {
  return x | y;
}

SCALAR_FUN_ATTR uint64_t or64(uint64_t x, uint64_t y) {
  return x | y;
}

SCALAR_FUN_ATTR uint8_t xor8(uint8_t x, uint8_t y) {
  return x ^ y;
}

SCALAR_FUN_ATTR uint16_t xor16(uint16_t x, uint16_t y) {
  return x ^ y;
}

SCALAR_FUN_ATTR uint32_t xor32(uint32_t x, uint32_t y) {
  return x ^ y;
}

SCALAR_FUN_ATTR uint64_t xor64(uint64_t x, uint64_t y) {
  return x ^ y;
}

SCALAR_FUN_ATTR bool ult8(uint8_t x, uint8_t y) {
  return x < y;
}

SCALAR_FUN_ATTR bool ult16(uint16_t x, uint16_t y) {
  return x < y;
}

SCALAR_FUN_ATTR bool ult32(uint32_t x, uint32_t y) {
  return x < y;
}

SCALAR_FUN_ATTR bool ult64(uint64_t x, uint64_t y) {
  return x < y;
}

SCALAR_FUN_ATTR bool ule8(uint8_t x, uint8_t y) {
  return x <= y;
}

SCALAR_FUN_ATTR bool ule16(uint16_t x, uint16_t y) {
  return x <= y;
}

SCALAR_FUN_ATTR bool ule32(uint32_t x, uint32_t y) {
  return x <= y;
}

SCALAR_FUN_ATTR bool ule64(uint64_t x, uint64_t y) {
  return x <= y;
}

SCALAR_FUN_ATTR bool slt8(int8_t x, int8_t y) {
  return x < y;
}

SCALAR_FUN_ATTR bool slt16(int16_t x, int16_t y) {
  return x < y;
}

SCALAR_FUN_ATTR bool slt32(int32_t x, int32_t y) {
  return x < y;
}

SCALAR_FUN_ATTR bool slt64(int64_t x, int64_t y) {
  return x < y;
}

SCALAR_FUN_ATTR bool sle8(int8_t x, int8_t y) {
  return x <= y;
}

SCALAR_FUN_ATTR bool sle16(int16_t x, int16_t y) {
  return x <= y;
}

SCALAR_FUN_ATTR bool sle32(int32_t x, int32_t y) {
  return x <= y;
}

SCALAR_FUN_ATTR bool sle64(int64_t x, int64_t y) {
  return x <= y;
}

SCALAR_FUN_ATTR uint8_t pow8(uint8_t x, uint8_t y) {
  uint8_t res = 1, rem = y;

  while (rem != 0) {
    if (rem & 1)
      res *= x;
    rem >>= 1;
    x *= x;
  }
  return res;
}

SCALAR_FUN_ATTR uint16_t pow16(uint16_t x, uint16_t y) {
  uint16_t res = 1, rem = y;

  while (rem != 0) {
    if (rem & 1)
      res *= x;
    rem >>= 1;
    x *= x;
  }
  return res;
}

SCALAR_FUN_ATTR uint32_t pow32(uint32_t x, uint32_t y) {
  uint32_t res = 1, rem = y;

  while (rem != 0) {
    if (rem & 1)
      res *= x;
    rem >>= 1;
    x *= x;
  }
  return res;
}

SCALAR_FUN_ATTR uint64_t pow64(uint64_t x, uint64_t y) {
  uint64_t res = 1, rem = y;

  while (rem != 0) {
    if (rem & 1)
      res *= x;
    rem >>= 1;
    x *= x;
  }
  return res;
}

SCALAR_FUN_ATTR bool itob_i8_bool(int8_t x) {
  return x != 0;
}

SCALAR_FUN_ATTR bool itob_i16_bool(int16_t x) {
  return x != 0;
}

SCALAR_FUN_ATTR bool itob_i32_bool(int32_t x) {
  return x != 0;
}

SCALAR_FUN_ATTR bool itob_i64_bool(int64_t x) {
  return x != 0;
}

SCALAR_FUN_ATTR int8_t btoi_bool_i8(bool x) {
  return x;
}

SCALAR_FUN_ATTR int16_t btoi_bool_i16(bool x) {
  return x;
}

SCALAR_FUN_ATTR int32_t btoi_bool_i32(bool x) {
  return x;
}

SCALAR_FUN_ATTR int64_t btoi_bool_i64(bool x) {
  return x;
}

#define sext_i8_i8(x) ((int8_t) (int8_t) (x))
#define sext_i8_i16(x) ((int16_t) (int8_t) (x))
#define sext_i8_i32(x) ((int32_t) (int8_t) (x))
#define sext_i8_i64(x) ((int64_t) (int8_t) (x))
#define sext_i16_i8(x) ((int8_t) (int16_t) (x))
#define sext_i16_i16(x) ((int16_t) (int16_t) (x))
#define sext_i16_i32(x) ((int32_t) (int16_t) (x))
#define sext_i16_i64(x) ((int64_t) (int16_t) (x))
#define sext_i32_i8(x) ((int8_t) (int32_t) (x))
#define sext_i32_i16(x) ((int16_t) (int32_t) (x))
#define sext_i32_i32(x) ((int32_t) (int32_t) (x))
#define sext_i32_i64(x) ((int64_t) (int32_t) (x))
#define sext_i64_i8(x) ((int8_t) (int64_t) (x))
#define sext_i64_i16(x) ((int16_t) (int64_t) (x))
#define sext_i64_i32(x) ((int32_t) (int64_t) (x))
#define sext_i64_i64(x) ((int64_t) (int64_t) (x))
#define zext_i8_i8(x) ((int8_t) (uint8_t) (x))
#define zext_i8_i16(x) ((int16_t) (uint8_t) (x))
#define zext_i8_i32(x) ((int32_t) (uint8_t) (x))
#define zext_i8_i64(x) ((int64_t) (uint8_t) (x))
#define zext_i16_i8(x) ((int8_t) (uint16_t) (x))
#define zext_i16_i16(x) ((int16_t) (uint16_t) (x))
#define zext_i16_i32(x) ((int32_t) (uint16_t) (x))
#define zext_i16_i64(x) ((int64_t) (uint16_t) (x))
#define zext_i32_i8(x) ((int8_t) (uint32_t) (x))
#define zext_i32_i16(x) ((int16_t) (uint32_t) (x))
#define zext_i32_i32(x) ((int32_t) (uint32_t) (x))
#define zext_i32_i64(x) ((int64_t) (uint32_t) (x))
#define zext_i64_i8(x) ((int8_t) (uint64_t) (x))
#define zext_i64_i16(x) ((int16_t) (uint64_t) (x))
#define zext_i64_i32(x) ((int32_t) (uint64_t) (x))
#define zext_i64_i64(x) ((int64_t) (uint64_t) (x))

SCALAR_FUN_ATTR int8_t abs8(int8_t x) {
  return (int8_t)abs(x);
}

SCALAR_FUN_ATTR int16_t abs16(int16_t x) {
  return (int16_t)abs(x);
}

SCALAR_FUN_ATTR int32_t abs32(int32_t x) {
  return abs(x);
}

SCALAR_FUN_ATTR int64_t abs64(int64_t x) {
#if defined(__OPENCL_VERSION__) || defined(ISPC)
  return abs(x);
#else
  return llabs(x);
#endif
}

#if defined(__OPENCL_VERSION__)
SCALAR_FUN_ATTR int32_t futrts_popc8(int8_t x) {
  return popcount(x);
}

SCALAR_FUN_ATTR int32_t futrts_popc16(int16_t x) {
  return popcount(x);
}

SCALAR_FUN_ATTR int32_t futrts_popc32(int32_t x) {
  return popcount(x);
}

SCALAR_FUN_ATTR int32_t futrts_popc64(int64_t x) {
  return popcount(x);
}
#elif defined(__CUDA_ARCH__)

SCALAR_FUN_ATTR int32_t futrts_popc8(int8_t x) {
  return __popc(zext_i8_i32(x));
}

SCALAR_FUN_ATTR int32_t futrts_popc16(int16_t x) {
  return __popc(zext_i16_i32(x));
}

SCALAR_FUN_ATTR int32_t futrts_popc32(int32_t x) {
  return __popc(x);
}

SCALAR_FUN_ATTR int32_t futrts_popc64(int64_t x) {
  return __popcll(x);
}

#else // Not OpenCL or CUDA, but plain C.

SCALAR_FUN_ATTR int32_t futrts_popc8(uint8_t x) {
  int c = 0;
  for (; x; ++c) { x &= x - 1; }
  return c;
}

SCALAR_FUN_ATTR int32_t futrts_popc16(uint16_t x) {
  int c = 0;
  for (; x; ++c) { x &= x - 1; }
  return c;
}

SCALAR_FUN_ATTR int32_t futrts_popc32(uint32_t x) {
  int c = 0;
  for (; x; ++c) { x &= x - 1; }
  return c;
}

SCALAR_FUN_ATTR int32_t futrts_popc64(uint64_t x) {
  int c = 0;
  for (; x; ++c) { x &= x - 1; }
  return c;
}
#endif

#if defined(__OPENCL_VERSION__)
SCALAR_FUN_ATTR uint8_t  futrts_umul_hi8 ( uint8_t a,  uint8_t b) { return mul_hi(a, b); }
SCALAR_FUN_ATTR uint16_t futrts_umul_hi16(uint16_t a, uint16_t b) { return mul_hi(a, b); }
SCALAR_FUN_ATTR uint32_t futrts_umul_hi32(uint32_t a, uint32_t b) { return mul_hi(a, b); }
SCALAR_FUN_ATTR uint64_t futrts_umul_hi64(uint64_t a, uint64_t b) { return mul_hi(a, b); }
SCALAR_FUN_ATTR uint8_t  futrts_smul_hi8 ( int8_t a,  int8_t b) { return mul_hi(a, b); }
SCALAR_FUN_ATTR uint16_t futrts_smul_hi16(int16_t a, int16_t b) { return mul_hi(a, b); }
SCALAR_FUN_ATTR uint32_t futrts_smul_hi32(int32_t a, int32_t b) { return mul_hi(a, b); }
SCALAR_FUN_ATTR uint64_t futrts_smul_hi64(int64_t a, int64_t b) { return mul_hi(a, b); }
#elif defined(__CUDA_ARCH__)
SCALAR_FUN_ATTR  uint8_t futrts_umul_hi8(uint8_t a, uint8_t b) { return ((uint16_t)a) * ((uint16_t)b) >> 8; }
SCALAR_FUN_ATTR uint16_t futrts_umul_hi16(uint16_t a, uint16_t b) { return ((uint32_t)a) * ((uint32_t)b) >> 16; }
SCALAR_FUN_ATTR uint32_t futrts_umul_hi32(uint32_t a, uint32_t b) { return __umulhi(a, b); }
SCALAR_FUN_ATTR uint64_t futrts_umul_hi64(uint64_t a, uint64_t b) { return __umul64hi(a, b); }
SCALAR_FUN_ATTR  uint8_t futrts_smul_hi8 ( int8_t a, int8_t b) { return ((int16_t)a) * ((int16_t)b) >> 8; }
SCALAR_FUN_ATTR uint16_t futrts_smul_hi16(int16_t a, int16_t b) { return ((int32_t)a) * ((int32_t)b) >> 16; }
SCALAR_FUN_ATTR uint32_t futrts_smul_hi32(int32_t a, int32_t b) { return __mulhi(a, b); }
SCALAR_FUN_ATTR uint64_t futrts_smul_hi64(int64_t a, int64_t b) { return __mul64hi(a, b); }
#elif ISPC
SCALAR_FUN_ATTR uint8_t futrts_umul_hi8(uint8_t a, uint8_t b) { return ((uint16_t)a) * ((uint16_t)b) >> 8; }
SCALAR_FUN_ATTR uint16_t futrts_umul_hi16(uint16_t a, uint16_t b) { return ((uint32_t)a) * ((uint32_t)b) >> 16; }
SCALAR_FUN_ATTR uint32_t futrts_umul_hi32(uint32_t a, uint32_t b) { return ((uint64_t)a) * ((uint64_t)b) >> 32; }
SCALAR_FUN_ATTR uint64_t futrts_umul_hi64(uint64_t a, uint64_t b) {
  uint64_t ah = a >> 32;
  uint64_t al = a & 0xffffffff;
  uint64_t bh = b >> 32;
  uint64_t bl = b & 0xffffffff;

  uint64_t p1 = al * bl;
  uint64_t p2 = al * bh;
  uint64_t p3 = ah * bl;
  uint64_t p4 = ah * bh;

  uint64_t p1h = p1 >> 32;
  uint64_t p2h = p2 >> 32;
  uint64_t p3h = p3 >> 32;
  uint64_t p2l = p2 & 0xffffffff;
  uint64_t p3l = p3 & 0xffffffff;

  uint64_t l = p1h + p2l + p3l;
  uint64_t m = (p2 >> 32) + (p3 >> 32);
  uint64_t h = (l >> 32) + m + p4;

  return h;
}
SCALAR_FUN_ATTR  int8_t futrts_smul_hi8 ( int8_t a,  int8_t b) { return ((uint16_t)a) * ((uint16_t)b) >> 8; }
SCALAR_FUN_ATTR int16_t futrts_smul_hi16(int16_t a, int16_t b) { return ((uint32_t)a) * ((uint32_t)b) >> 16; }
SCALAR_FUN_ATTR int32_t futrts_smul_hi32(int32_t a, int32_t b) { return ((uint64_t)a) * ((uint64_t)b) >> 32; }
SCALAR_FUN_ATTR int64_t futrts_smul_hi64(int64_t a, int64_t b) {
  uint64_t ah = a >> 32;
  uint64_t al = a & 0xffffffff;
  uint64_t bh = b >> 32;
  uint64_t bl = b & 0xffffffff;

  uint64_t p1 =  al * bl;
  int64_t  p2 = al * bh;
  int64_t  p3 = ah * bl;
  uint64_t p4 =  ah * bh;

  uint64_t p1h = p1 >> 32;
  uint64_t p2h = p2 >> 32;
  uint64_t p3h = p3 >> 32;
  uint64_t p2l = p2 & 0xffffffff;
  uint64_t p3l = p3 & 0xffffffff;

  uint64_t l = p1h + p2l + p3l;
  uint64_t m = (p2 >> 32) + (p3 >> 32);
  uint64_t h = (l >> 32) + m + p4;

  return h;
}

#else // Not OpenCL, ISPC, or CUDA, but plain C.
SCALAR_FUN_ATTR uint8_t futrts_umul_hi8(uint8_t a, uint8_t b) { return ((uint16_t)a) * ((uint16_t)b) >> 8; }
SCALAR_FUN_ATTR uint16_t futrts_umul_hi16(uint16_t a, uint16_t b) { return ((uint32_t)a) * ((uint32_t)b) >> 16; }
SCALAR_FUN_ATTR uint32_t futrts_umul_hi32(uint32_t a, uint32_t b) { return ((uint64_t)a) * ((uint64_t)b) >> 32; }
SCALAR_FUN_ATTR uint64_t futrts_umul_hi64(uint64_t a, uint64_t b) { return ((__uint128_t)a) * ((__uint128_t)b) >> 64; }
SCALAR_FUN_ATTR int8_t futrts_smul_hi8(int8_t a, int8_t b) { return ((int16_t)a) * ((int16_t)b) >> 8; }
SCALAR_FUN_ATTR int16_t futrts_smul_hi16(int16_t a, int16_t b) { return ((int32_t)a) * ((int32_t)b) >> 16; }
SCALAR_FUN_ATTR int32_t futrts_smul_hi32(int32_t a, int32_t b) { return ((int64_t)a) * ((int64_t)b) >> 32; }
SCALAR_FUN_ATTR int64_t futrts_smul_hi64(int64_t a, int64_t b) { return ((__int128_t)a) * ((__int128_t)b) >> 64; }
#endif

#if defined(__OPENCL_VERSION__)
SCALAR_FUN_ATTR  uint8_t futrts_umad_hi8 ( uint8_t a,  uint8_t b,  uint8_t c) { return mad_hi(a, b, c); }
SCALAR_FUN_ATTR uint16_t futrts_umad_hi16(uint16_t a, uint16_t b, uint16_t c) { return mad_hi(a, b, c); }
SCALAR_FUN_ATTR uint32_t futrts_umad_hi32(uint32_t a, uint32_t b, uint32_t c) { return mad_hi(a, b, c); }
SCALAR_FUN_ATTR uint64_t futrts_umad_hi64(uint64_t a, uint64_t b, uint64_t c) { return mad_hi(a, b, c); }
SCALAR_FUN_ATTR  uint8_t futrts_smad_hi8( int8_t a,  int8_t b,   int8_t c) { return mad_hi(a, b, c); }
SCALAR_FUN_ATTR uint16_t futrts_smad_hi16(int16_t a, int16_t b, int16_t c) { return mad_hi(a, b, c); }
SCALAR_FUN_ATTR uint32_t futrts_smad_hi32(int32_t a, int32_t b, int32_t c) { return mad_hi(a, b, c); }
SCALAR_FUN_ATTR uint64_t futrts_smad_hi64(int64_t a, int64_t b, int64_t c) { return mad_hi(a, b, c); }
#else // Not OpenCL

SCALAR_FUN_ATTR  uint8_t futrts_umad_hi8( uint8_t a,  uint8_t b,  uint8_t c) { return futrts_umul_hi8(a, b) + c; }
SCALAR_FUN_ATTR uint16_t futrts_umad_hi16(uint16_t a, uint16_t b, uint16_t c) { return futrts_umul_hi16(a, b) + c; }
SCALAR_FUN_ATTR uint32_t futrts_umad_hi32(uint32_t a, uint32_t b, uint32_t c) { return futrts_umul_hi32(a, b) + c; }
SCALAR_FUN_ATTR uint64_t futrts_umad_hi64(uint64_t a, uint64_t b, uint64_t c) { return futrts_umul_hi64(a, b) + c; }
SCALAR_FUN_ATTR  uint8_t futrts_smad_hi8 ( int8_t a,  int8_t b,  int8_t c) { return futrts_smul_hi8(a, b) + c; }
SCALAR_FUN_ATTR uint16_t futrts_smad_hi16(int16_t a, int16_t b, int16_t c) { return futrts_smul_hi16(a, b) + c; }
SCALAR_FUN_ATTR uint32_t futrts_smad_hi32(int32_t a, int32_t b, int32_t c) { return futrts_smul_hi32(a, b) + c; }
SCALAR_FUN_ATTR uint64_t futrts_smad_hi64(int64_t a, int64_t b, int64_t c) { return futrts_smul_hi64(a, b) + c; }
#endif

#if defined(__OPENCL_VERSION__)
SCALAR_FUN_ATTR int32_t futrts_clzz8(int8_t x) {
  return clz(x);
}

SCALAR_FUN_ATTR int32_t futrts_clzz16(int16_t x) {
  return clz(x);
}

SCALAR_FUN_ATTR int32_t futrts_clzz32(int32_t x) {
  return clz(x);
}

SCALAR_FUN_ATTR int32_t futrts_clzz64(int64_t x) {
  return clz(x);
}

#elif defined(__CUDA_ARCH__)

SCALAR_FUN_ATTR int32_t futrts_clzz8(int8_t x) {
  return __clz(zext_i8_i32(x)) - 24;
}

SCALAR_FUN_ATTR int32_t futrts_clzz16(int16_t x) {
  return __clz(zext_i16_i32(x)) - 16;
}

SCALAR_FUN_ATTR int32_t futrts_clzz32(int32_t x) {
  return __clz(x);
}

SCALAR_FUN_ATTR int32_t futrts_clzz64(int64_t x) {
  return __clzll(x);
}

#elif ISPC

SCALAR_FUN_ATTR int32_t futrts_clzz8(int8_t x) {
  return count_leading_zeros((int32_t)(uint8_t)x)-24;
}

SCALAR_FUN_ATTR int32_t futrts_clzz16(int16_t x) {
  return count_leading_zeros((int32_t)(uint16_t)x)-16;
}

SCALAR_FUN_ATTR int32_t futrts_clzz32(int32_t x) {
  return count_leading_zeros(x);
}

SCALAR_FUN_ATTR int32_t futrts_clzz64(int64_t x) {
  return count_leading_zeros(x);
}

#else // Not OpenCL, ISPC or CUDA, but plain C.

SCALAR_FUN_ATTR int32_t futrts_clzz8(int8_t x) {
  return x == 0 ? 8 : __builtin_clz((uint32_t)zext_i8_i32(x)) - 24;
}

SCALAR_FUN_ATTR int32_t futrts_clzz16(int16_t x) {
  return x == 0 ? 16 : __builtin_clz((uint32_t)zext_i16_i32(x)) - 16;
}

SCALAR_FUN_ATTR int32_t futrts_clzz32(int32_t x) {
  return x == 0 ? 32 : __builtin_clz((uint32_t)x);
}

SCALAR_FUN_ATTR int32_t futrts_clzz64(int64_t x) {
  return x == 0 ? 64 : __builtin_clzll((uint64_t)x);
}
#endif

#if defined(__OPENCL_VERSION__)
SCALAR_FUN_ATTR int32_t futrts_ctzz8(int8_t x) {
  int i = 0;
  for (; i < 8 && (x & 1) == 0; i++, x >>= 1)
    ;
  return i;
}

SCALAR_FUN_ATTR int32_t futrts_ctzz16(int16_t x) {
  int i = 0;
  for (; i < 16 && (x & 1) == 0; i++, x >>= 1)
    ;
  return i;
}

SCALAR_FUN_ATTR int32_t futrts_ctzz32(int32_t x) {
  int i = 0;
  for (; i < 32 && (x & 1) == 0; i++, x >>= 1)
    ;
  return i;
}

SCALAR_FUN_ATTR int32_t futrts_ctzz64(int64_t x) {
  int i = 0;
  for (; i < 64 && (x & 1) == 0; i++, x >>= 1)
    ;
  return i;
}

#elif defined(__CUDA_ARCH__)

SCALAR_FUN_ATTR int32_t futrts_ctzz8(int8_t x) {
  int y = __ffs(x);
  return y == 0 ? 8 : y - 1;
}

SCALAR_FUN_ATTR int32_t futrts_ctzz16(int16_t x) {
  int y = __ffs(x);
  return y == 0 ? 16 : y - 1;
}

SCALAR_FUN_ATTR int32_t futrts_ctzz32(int32_t x) {
  int y = __ffs(x);
  return y == 0 ? 32 : y - 1;
}

SCALAR_FUN_ATTR int32_t futrts_ctzz64(int64_t x) {
  int y = __ffsll(x);
  return y == 0 ? 64 : y - 1;
}

#elif ISPC

SCALAR_FUN_ATTR int32_t futrts_ctzz8(int8_t x) {
  return x == 0 ? 8 : count_trailing_zeros((int32_t)x);
}

SCALAR_FUN_ATTR int32_t futrts_ctzz16(int16_t x) {
  return x == 0 ? 16 : count_trailing_zeros((int32_t)x);
}

SCALAR_FUN_ATTR int32_t futrts_ctzz32(int32_t x) {
  return count_trailing_zeros(x);
}

SCALAR_FUN_ATTR int32_t futrts_ctzz64(int64_t x) {
  return count_trailing_zeros(x);
}

#else // Not OpenCL or CUDA, but plain C.

SCALAR_FUN_ATTR int32_t futrts_ctzz8(int8_t x) {
  return x == 0 ? 8 : __builtin_ctz((uint32_t)x);
}

SCALAR_FUN_ATTR int32_t futrts_ctzz16(int16_t x) {
  return x == 0 ? 16 : __builtin_ctz((uint32_t)x);
}

SCALAR_FUN_ATTR int32_t futrts_ctzz32(int32_t x) {
  return x == 0 ? 32 : __builtin_ctz((uint32_t)x);
}

SCALAR_FUN_ATTR int32_t futrts_ctzz64(int64_t x) {
  return x == 0 ? 64 : __builtin_ctzll((uint64_t)x);
}
#endif

SCALAR_FUN_ATTR float fdiv32(float x, float y) {
  return x / y;
}

SCALAR_FUN_ATTR float fadd32(float x, float y) {
  return x + y;
}

SCALAR_FUN_ATTR float fsub32(float x, float y) {
  return x - y;
}

SCALAR_FUN_ATTR float fmul32(float x, float y) {
  return x * y;
}

SCALAR_FUN_ATTR bool cmplt32(float x, float y) {
  return x < y;
}

SCALAR_FUN_ATTR bool cmple32(float x, float y) {
  return x <= y;
}

SCALAR_FUN_ATTR float sitofp_i8_f32(int8_t x) {
  return (float) x;
}

SCALAR_FUN_ATTR float sitofp_i16_f32(int16_t x) {
  return (float) x;
}

SCALAR_FUN_ATTR float sitofp_i32_f32(int32_t x) {
  return (float) x;
}

SCALAR_FUN_ATTR float sitofp_i64_f32(int64_t x) {
  return (float) x;
}

SCALAR_FUN_ATTR float uitofp_i8_f32(uint8_t x) {
  return (float) x;
}

SCALAR_FUN_ATTR float uitofp_i16_f32(uint16_t x) {
  return (float) x;
}

SCALAR_FUN_ATTR float uitofp_i32_f32(uint32_t x) {
  return (float) x;
}

SCALAR_FUN_ATTR float uitofp_i64_f32(uint64_t x) {
  return (float) x;
}

#ifdef __OPENCL_VERSION__
SCALAR_FUN_ATTR float fabs32(float x) {
  return fabs(x);
}

SCALAR_FUN_ATTR float fmax32(float x, float y) {
  return fmax(x, y);
}

SCALAR_FUN_ATTR float fmin32(float x, float y) {
  return fmin(x, y);
}

SCALAR_FUN_ATTR float fpow32(float x, float y) {
  return pow(x, y);
}

#elif ISPC

SCALAR_FUN_ATTR float fabs32(float x) {
  return abs(x);
}

SCALAR_FUN_ATTR float fmax32(float x, float y) {
  return isnan(x) ? y : isnan(y) ? x : max(x, y);
}

SCALAR_FUN_ATTR float fmin32(float x, float y) {
  return isnan(x) ? y : isnan(y) ? x : min(x, y);
}

SCALAR_FUN_ATTR float fpow32(float a, float b) {
  float ret;
  foreach_active (i) {
      uniform float r = __stdlib_powf(extract(a, i), extract(b, i));
      ret = insert(ret, i, r);
  }
  return ret;
}

#else // Not OpenCL, but CUDA or plain C.

SCALAR_FUN_ATTR float fabs32(float x) {
  return fabsf(x);
}

SCALAR_FUN_ATTR float fmax32(float x, float y) {
  return fmaxf(x, y);
}

SCALAR_FUN_ATTR float fmin32(float x, float y) {
  return fminf(x, y);
}

SCALAR_FUN_ATTR float fpow32(float x, float y) {
  return powf(x, y);
}
#endif

SCALAR_FUN_ATTR bool futrts_isnan32(float x) {
  return isnan(x);
}

#if ISPC

SCALAR_FUN_ATTR bool futrts_isinf32(float x) {
  return !isnan(x) && isnan(x - x);
}

SCALAR_FUN_ATTR bool futrts_isfinite32(float x) {
  return !isnan(x) && !futrts_isinf32(x);
}

#else

SCALAR_FUN_ATTR bool futrts_isinf32(float x) {
  return isinf(x);
}

#endif

SCALAR_FUN_ATTR int8_t fptosi_f32_i8(float x) {
  if (futrts_isnan32(x) || futrts_isinf32(x)) {
    return 0;
  } else {
    return (int8_t) x;
  }
}

SCALAR_FUN_ATTR int16_t fptosi_f32_i16(float x) {
  if (futrts_isnan32(x) || futrts_isinf32(x)) {
    return 0;
  } else {
    return (int16_t) x;
  }
}

SCALAR_FUN_ATTR int32_t fptosi_f32_i32(float x) {
  if (futrts_isnan32(x) || futrts_isinf32(x)) {
    return 0;
  } else {
    return (int32_t) x;
  }
}

SCALAR_FUN_ATTR int64_t fptosi_f32_i64(float x) {
  if (futrts_isnan32(x) || futrts_isinf32(x)) {
    return 0;
  } else {
    return (int64_t) x;
  };
}

SCALAR_FUN_ATTR uint8_t fptoui_f32_i8(float x) {
  if (futrts_isnan32(x) || futrts_isinf32(x)) {
    return 0;
  } else {
    return (uint8_t) (int8_t) x;
  }
}

SCALAR_FUN_ATTR uint16_t fptoui_f32_i16(float x) {
  if (futrts_isnan32(x) || futrts_isinf32(x)) {
    return 0;
  } else {
    return (uint16_t) (int16_t) x;
  }
}

SCALAR_FUN_ATTR uint32_t fptoui_f32_i32(float x) {
  if (futrts_isnan32(x) || futrts_isinf32(x)) {
    return 0;
  } else {
    return (uint32_t) (int32_t) x;
  }
}

SCALAR_FUN_ATTR uint64_t fptoui_f32_i64(float x) {
  if (futrts_isnan32(x) || futrts_isinf32(x)) {
    return 0;
  } else {
    return (uint64_t) (int64_t) x;
  }
}

SCALAR_FUN_ATTR bool ftob_f32_bool(float x) {
  return x != 0;
}

SCALAR_FUN_ATTR float btof_bool_f32(bool x) {
  return x ? 1 : 0;
}

#ifdef __OPENCL_VERSION__
SCALAR_FUN_ATTR float futrts_log32(float x) {
  return log(x);
}

SCALAR_FUN_ATTR float futrts_log2_32(float x) {
  return log2(x);
}

SCALAR_FUN_ATTR float futrts_log10_32(float x) {
  return log10(x);
}

SCALAR_FUN_ATTR float futrts_log1p_32(float x) {
  return log1p(x);
}

SCALAR_FUN_ATTR float futrts_sqrt32(float x) {
  return sqrt(x);
}

SCALAR_FUN_ATTR float futrts_cbrt32(float x) {
  return cbrt(x);
}

SCALAR_FUN_ATTR float futrts_exp32(float x) {
  return exp(x);
}

SCALAR_FUN_ATTR float futrts_cos32(float x) {
  return cos(x);
}

SCALAR_FUN_ATTR float futrts_sin32(float x) {
  return sin(x);
}

SCALAR_FUN_ATTR float futrts_tan32(float x) {
  return tan(x);
}

SCALAR_FUN_ATTR float futrts_acos32(float x) {
  return acos(x);
}

SCALAR_FUN_ATTR float futrts_asin32(float x) {
  return asin(x);
}

SCALAR_FUN_ATTR float futrts_atan32(float x) {
  return atan(x);
}

SCALAR_FUN_ATTR float futrts_cosh32(float x) {
  return cosh(x);
}

SCALAR_FUN_ATTR float futrts_sinh32(float x) {
  return sinh(x);
}

SCALAR_FUN_ATTR float futrts_tanh32(float x) {
  return tanh(x);
}

SCALAR_FUN_ATTR float futrts_acosh32(float x) {
  return acosh(x);
}

SCALAR_FUN_ATTR float futrts_asinh32(float x) {
  return asinh(x);
}

SCALAR_FUN_ATTR float futrts_atanh32(float x) {
  return atanh(x);
}

SCALAR_FUN_ATTR float futrts_atan2_32(float x, float y) {
  return atan2(x, y);
}

SCALAR_FUN_ATTR float futrts_hypot32(float x, float y) {
  return hypot(x, y);
}

SCALAR_FUN_ATTR float futrts_gamma32(float x) {
  return tgamma(x);
}

SCALAR_FUN_ATTR float futrts_lgamma32(float x) {
  return lgamma(x);
}

SCALAR_FUN_ATTR float futrts_erf32(float x) {
  return erf(x);
}

SCALAR_FUN_ATTR float futrts_erfc32(float x) {
  return erfc(x);
}

SCALAR_FUN_ATTR float fmod32(float x, float y) {
  return fmod(x, y);
}

SCALAR_FUN_ATTR float futrts_round32(float x) {
  return rint(x);
}

SCALAR_FUN_ATTR float futrts_floor32(float x) {
  return floor(x);
}

SCALAR_FUN_ATTR float futrts_ceil32(float x) {
  return ceil(x);
}

SCALAR_FUN_ATTR float futrts_nextafter32(float x, float y) {
  return nextafter(x, y);
}

SCALAR_FUN_ATTR float futrts_lerp32(float v0, float v1, float t) {
  return mix(v0, v1, t);
}

SCALAR_FUN_ATTR float futrts_ldexp32(float x, int32_t y) {
  return ldexp(x, y);
}

SCALAR_FUN_ATTR float futrts_copysign32(float x, float y) {
  return copysign(x, y);
}

SCALAR_FUN_ATTR float futrts_mad32(float a, float b, float c) {
  return mad(a, b, c);
}

SCALAR_FUN_ATTR float futrts_fma32(float a, float b, float c) {
  return fma(a, b, c);
}

#elif ISPC

SCALAR_FUN_ATTR float futrts_log32(float x) {
  return futrts_isfinite32(x) || (futrts_isinf32(x) && x < 0)? log(x) : x;
}

SCALAR_FUN_ATTR float futrts_log2_32(float x) {
  return futrts_log32(x) / log(2.0f);
}

SCALAR_FUN_ATTR float futrts_log10_32(float x) {
  return futrts_log32(x) / log(10.0f);
}

SCALAR_FUN_ATTR float futrts_log1p_32(float x) {
  if(x == -1.0f || (futrts_isinf32(x) && x > 0.0f)) return x / 0.0f;
  float y = 1.0f + x;
  float z = y - 1.0f;
  return log(y) - (z-x)/y;
}

SCALAR_FUN_ATTR float futrts_sqrt32(float x) {
  return sqrt(x);
}

extern "C" unmasked uniform float cbrtf(uniform float);
SCALAR_FUN_ATTR float futrts_cbrt32(float x) {
  float res;
  foreach_active (i) {
    uniform float r = cbrtf(extract(x, i));
    res = insert(res, i, r);
  }
  return res;
}

SCALAR_FUN_ATTR float futrts_exp32(float x) {
  return exp(x);
}

SCALAR_FUN_ATTR float futrts_cos32(float x) {
  return cos(x);
}

SCALAR_FUN_ATTR float futrts_sin32(float x) {
  return sin(x);
}

SCALAR_FUN_ATTR float futrts_tan32(float x) {
  return tan(x);
}

SCALAR_FUN_ATTR float futrts_acos32(float x) {
  return acos(x);
}

SCALAR_FUN_ATTR float futrts_asin32(float x) {
  return asin(x);
}

SCALAR_FUN_ATTR float futrts_atan32(float x) {
  return atan(x);
}

SCALAR_FUN_ATTR float futrts_cosh32(float x) {
  return (exp(x)+exp(-x)) / 2.0f;
}

SCALAR_FUN_ATTR float futrts_sinh32(float x) {
  return (exp(x)-exp(-x)) / 2.0f;
}

SCALAR_FUN_ATTR float futrts_tanh32(float x) {
  return futrts_sinh32(x)/futrts_cosh32(x);
}

SCALAR_FUN_ATTR float futrts_acosh32(float x) {
  float f = x+sqrt(x*x-1);
  if(futrts_isfinite32(f)) return log(f);
  return f;
}

SCALAR_FUN_ATTR float futrts_asinh32(float x) {
  float f = x+sqrt(x*x+1);
  if(futrts_isfinite32(f)) return log(f);
  return f;

}

SCALAR_FUN_ATTR float futrts_atanh32(float x) {
  float f = (1+x)/(1-x);
  if(futrts_isfinite32(f)) return log(f)/2.0f;
  return f;

}

SCALAR_FUN_ATTR float futrts_atan2_32(float x, float y) {
  return (x == 0.0f && y == 0.0f) ? 0.0f : atan2(x, y);
}

SCALAR_FUN_ATTR float futrts_hypot32(float x, float y) {
  if (futrts_isfinite32(x) && futrts_isfinite32(y)) {
    x = abs(x);
    y = abs(y);
    float a;
    float b;
    if (x >= y){
        a = x;
        b = y;
    } else {
        a = y;
        b = x;
    }
    if(b == 0){
      return a;
    }

    int e;
    float an;
    float bn;
    an = frexp (a, &e);
    bn = ldexp (b, - e);
    float cn;
    cn = sqrt (an * an + bn * bn);
    return ldexp (cn, e);
  } else {
    if (futrts_isinf32(x) || futrts_isinf32(y)) return INFINITY;
    else return x + y;
  }

}

extern "C" unmasked uniform float tgammaf(uniform float x);
SCALAR_FUN_ATTR float futrts_gamma32(float x) {
  float res;
  foreach_active (i) {
    uniform float r = tgammaf(extract(x, i));
    res = insert(res, i, r);
  }
  return res;
}

extern "C" unmasked uniform float lgammaf(uniform float x);
SCALAR_FUN_ATTR float futrts_lgamma32(float x) {
  float res;
  foreach_active (i) {
    uniform float r = lgammaf(extract(x, i));
    res = insert(res, i, r);
  }
  return res;
}

extern "C" unmasked uniform float erff(uniform float x);
SCALAR_FUN_ATTR float futrts_erf32(float x) {
  float res;
  foreach_active (i) {
    uniform float r = erff(extract(x, i));
    res = insert(res, i, r);
  }
  return res;
}

extern "C" unmasked uniform float erfcf(uniform float x);
SCALAR_FUN_ATTR float futrts_erfc32(float x) {
  float res;
  foreach_active (i) {
    uniform float r = erfcf(extract(x, i));
    res = insert(res, i, r);
  }
  return res;
}

SCALAR_FUN_ATTR float fmod32(float x, float y) {
  return x - y * trunc(x/y);
}

SCALAR_FUN_ATTR float futrts_round32(float x) {
  return round(x);
}

SCALAR_FUN_ATTR float futrts_floor32(float x) {
  return floor(x);
}

SCALAR_FUN_ATTR float futrts_ceil32(float x) {
  return ceil(x);
}

extern "C" unmasked uniform float nextafterf(uniform float x, uniform float y);
SCALAR_FUN_ATTR float futrts_nextafter32(float x, float y) {
  float res;
  foreach_active (i) {
    uniform float r = nextafterf(extract(x, i), extract(y, i));
    res = insert(res, i, r);
  }
  return res;
}

SCALAR_FUN_ATTR float futrts_lerp32(float v0, float v1, float t) {
  return v0 + (v1 - v0) * t;
}

SCALAR_FUN_ATTR float futrts_ldexp32(float x, int32_t y) {
  return x * pow((double)2.0, (double)y);
}

SCALAR_FUN_ATTR float futrts_copysign32(float x, float y) {
  int32_t xb = futrts_to_bits32(x);
  int32_t yb = futrts_to_bits32(y);
  return futrts_from_bits32((xb & ~(1<<31)) | (yb & (1<<31)));
}

SCALAR_FUN_ATTR float futrts_mad32(float a, float b, float c) {
  return a * b + c;
}

SCALAR_FUN_ATTR float futrts_fma32(float a, float b, float c) {
  return a * b + c;
}

#else // Not OpenCL or ISPC, but CUDA or plain C.

SCALAR_FUN_ATTR float futrts_log32(float x) {
  return logf(x);
}

SCALAR_FUN_ATTR float futrts_log2_32(float x) {
  return log2f(x);
}

SCALAR_FUN_ATTR float futrts_log10_32(float x) {
  return log10f(x);
}

SCALAR_FUN_ATTR float futrts_log1p_32(float x) {
  return log1pf(x);
}

SCALAR_FUN_ATTR float futrts_sqrt32(float x) {
  return sqrtf(x);
}

SCALAR_FUN_ATTR float futrts_cbrt32(float x) {
  return cbrtf(x);
}

SCALAR_FUN_ATTR float futrts_exp32(float x) {
  return expf(x);
}

SCALAR_FUN_ATTR float futrts_cos32(float x) {
  return cosf(x);
}

SCALAR_FUN_ATTR float futrts_sin32(float x) {
  return sinf(x);
}

SCALAR_FUN_ATTR float futrts_tan32(float x) {
  return tanf(x);
}

SCALAR_FUN_ATTR float futrts_acos32(float x) {
  return acosf(x);
}

SCALAR_FUN_ATTR float futrts_asin32(float x) {
  return asinf(x);
}

SCALAR_FUN_ATTR float futrts_atan32(float x) {
  return atanf(x);
}

SCALAR_FUN_ATTR float futrts_cosh32(float x) {
  return coshf(x);
}

SCALAR_FUN_ATTR float futrts_sinh32(float x) {
  return sinhf(x);
}

SCALAR_FUN_ATTR float futrts_tanh32(float x) {
  return tanhf(x);
}

SCALAR_FUN_ATTR float futrts_acosh32(float x) {
  return acoshf(x);
}

SCALAR_FUN_ATTR float futrts_asinh32(float x) {
  return asinhf(x);
}

SCALAR_FUN_ATTR float futrts_atanh32(float x) {
  return atanhf(x);
}

SCALAR_FUN_ATTR float futrts_atan2_32(float x, float y) {
  return atan2f(x, y);
}

SCALAR_FUN_ATTR float futrts_hypot32(float x, float y) {
  return hypotf(x, y);
}

SCALAR_FUN_ATTR float futrts_gamma32(float x) {
  return tgammaf(x);
}

SCALAR_FUN_ATTR float futrts_lgamma32(float x) {
  return lgammaf(x);
}

SCALAR_FUN_ATTR float futrts_erf32(float x) {
  return erff(x);
}

SCALAR_FUN_ATTR float futrts_erfc32(float x) {
  return erfcf(x);
}

SCALAR_FUN_ATTR float fmod32(float x, float y) {
  return fmodf(x, y);
}

SCALAR_FUN_ATTR float futrts_round32(float x) {
  return rintf(x);
}

SCALAR_FUN_ATTR float futrts_floor32(float x) {
  return floorf(x);
}

SCALAR_FUN_ATTR float futrts_ceil32(float x) {
  return ceilf(x);
}

SCALAR_FUN_ATTR float futrts_nextafter32(float x, float y) {
  return nextafterf(x, y);
}

SCALAR_FUN_ATTR float futrts_lerp32(float v0, float v1, float t) {
  return v0 + (v1 - v0) * t;
}

SCALAR_FUN_ATTR float futrts_ldexp32(float x, int32_t y) {
  return ldexpf(x, y);
}

SCALAR_FUN_ATTR float futrts_copysign32(float x, float y) {
  return copysignf(x, y);
}

SCALAR_FUN_ATTR float futrts_mad32(float a, float b, float c) {
  return a * b + c;
}

SCALAR_FUN_ATTR float futrts_fma32(float a, float b, float c) {
  return fmaf(a, b, c);
}
#endif

#if ISPC
SCALAR_FUN_ATTR int32_t futrts_to_bits32(float x) {
  return intbits(x);
}

SCALAR_FUN_ATTR float futrts_from_bits32(int32_t x) {
  return floatbits(x);
}
#else
SCALAR_FUN_ATTR int32_t futrts_to_bits32(float x) {
  union {
    float f;
    int32_t t;
  } p;

  p.f = x;
  return p.t;
}

SCALAR_FUN_ATTR float futrts_from_bits32(int32_t x) {
  union {
    int32_t f;
    float t;
  } p;

  p.f = x;
  return p.t;
}
#endif

SCALAR_FUN_ATTR float fsignum32(float x) {
  return futrts_isnan32(x) ? x : (x > 0 ? 1 : 0) - (x < 0 ? 1 : 0);
}

#ifdef FUTHARK_F64_ENABLED

SCALAR_FUN_ATTR double futrts_from_bits64(int64_t x);
SCALAR_FUN_ATTR int64_t futrts_to_bits64(double x);

#if ISPC
SCALAR_FUN_ATTR bool futrts_isinf64(float x) {
  return !isnan(x) && isnan(x - x);
}

SCALAR_FUN_ATTR bool futrts_isfinite64(float x) {
  return !isnan(x) && !futrts_isinf64(x);
}

SCALAR_FUN_ATTR double fdiv64(double x, double y) {
  return x / y;
}

SCALAR_FUN_ATTR double fadd64(double x, double y) {
  return x + y;
}

SCALAR_FUN_ATTR double fsub64(double x, double y) {
  return x - y;
}

SCALAR_FUN_ATTR double fmul64(double x, double y) {
  return x * y;
}

SCALAR_FUN_ATTR bool cmplt64(double x, double y) {
  return x < y;
}

SCALAR_FUN_ATTR bool cmple64(double x, double y) {
  return x <= y;
}

SCALAR_FUN_ATTR double sitofp_i8_f64(int8_t x) {
  return (double) x;
}

SCALAR_FUN_ATTR double sitofp_i16_f64(int16_t x) {
  return (double) x;
}

SCALAR_FUN_ATTR double sitofp_i32_f64(int32_t x) {
  return (double) x;
}

SCALAR_FUN_ATTR double sitofp_i64_f64(int64_t x) {
  return (double) x;
}

SCALAR_FUN_ATTR double uitofp_i8_f64(uint8_t x) {
  return (double) x;
}

SCALAR_FUN_ATTR double uitofp_i16_f64(uint16_t x) {
  return (double) x;
}

SCALAR_FUN_ATTR double uitofp_i32_f64(uint32_t x) {
  return (double) x;
}

SCALAR_FUN_ATTR double uitofp_i64_f64(uint64_t x) {
  return (double) x;
}

SCALAR_FUN_ATTR double fabs64(double x) {
  return abs(x);
}

SCALAR_FUN_ATTR double fmax64(double x, double y) {
  return isnan(x) ? y : isnan(y) ? x : max(x, y);
}

SCALAR_FUN_ATTR double fmin64(double x, double y) {
  return isnan(x) ? y : isnan(y) ? x : min(x, y);
}

SCALAR_FUN_ATTR double fpow64(double a, double b) {
  float ret;
  foreach_active (i) {
      uniform float r = __stdlib_powf(extract(a, i), extract(b, i));
      ret = insert(ret, i, r);
  }
  return ret;
}

SCALAR_FUN_ATTR double futrts_log64(double x) {
  return futrts_isfinite64(x) || (futrts_isinf64(x) && x < 0)? log(x) : x;
}

SCALAR_FUN_ATTR double futrts_log2_64(double x) {
  return futrts_log64(x)/log(2.0d);
}

SCALAR_FUN_ATTR double futrts_log10_64(double x) {
  return futrts_log64(x)/log(10.0d);
}

SCALAR_FUN_ATTR double futrts_log1p_64(double x) {
  if(x == -1.0d || (futrts_isinf64(x) && x > 0.0d)) return x / 0.0d;
  double y = 1.0d + x;
  double z = y - 1.0d;
  return log(y) - (z-x)/y;
}

SCALAR_FUN_ATTR double futrts_sqrt64(double x) {
  return sqrt(x);
}

extern "C" unmasked uniform double cbrt(uniform double);
SCALAR_FUN_ATTR double futrts_cbrt64(double x) {
  double res;
  foreach_active (i) {
    uniform double r = cbrtf(extract(x, i));
    res = insert(res, i, r);
  }
  return res;
}

SCALAR_FUN_ATTR double futrts_exp64(double x) {
  return exp(x);
}

SCALAR_FUN_ATTR double futrts_cos64(double x) {
  return cos(x);
}

SCALAR_FUN_ATTR double futrts_sin64(double x) {
  return sin(x);
}

SCALAR_FUN_ATTR double futrts_tan64(double x) {
  return tan(x);
}

SCALAR_FUN_ATTR double futrts_acos64(double x) {
  return acos(x);
}

SCALAR_FUN_ATTR double futrts_asin64(double x) {
  return asin(x);
}

SCALAR_FUN_ATTR double futrts_atan64(double x) {
  return atan(x);
}

SCALAR_FUN_ATTR double futrts_cosh64(double x) {
  return (exp(x)+exp(-x)) / 2.0d;
}

SCALAR_FUN_ATTR double futrts_sinh64(double x) {
  return (exp(x)-exp(-x)) / 2.0d;
}

SCALAR_FUN_ATTR double futrts_tanh64(double x) {
  return futrts_sinh64(x)/futrts_cosh64(x);
}

SCALAR_FUN_ATTR double futrts_acosh64(double x) {
  double f = x+sqrt(x*x-1.0d);
  if(futrts_isfinite64(f)) return log(f);
  return f;
}

SCALAR_FUN_ATTR double futrts_asinh64(double x) {
  double f = x+sqrt(x*x+1.0d);
  if(futrts_isfinite64(f)) return log(f);
  return f;
}

SCALAR_FUN_ATTR double futrts_atanh64(double x) {
  double f = (1.0d+x)/(1.0d-x);
  if(futrts_isfinite64(f)) return log(f)/2.0d;
  return f;

}

SCALAR_FUN_ATTR double futrts_atan2_64(double x, double y) {
  return atan2(x, y);
}

extern "C" unmasked uniform double hypot(uniform double x, uniform double y);
SCALAR_FUN_ATTR double futrts_hypot64(double x, double y) {
  double res;
  foreach_active (i) {
    uniform double r = hypot(extract(x, i), extract(y, i));
    res = insert(res, i, r);
  }
  return res;
}

extern "C" unmasked uniform double tgamma(uniform double x);
SCALAR_FUN_ATTR double futrts_gamma64(double x) {
  double res;
  foreach_active (i) {
    uniform double r = tgamma(extract(x, i));
    res = insert(res, i, r);
  }
  return res;
}

extern "C" unmasked uniform double lgamma(uniform double x);
SCALAR_FUN_ATTR double futrts_lgamma64(double x) {
  double res;
  foreach_active (i) {
    uniform double r = lgamma(extract(x, i));
    res = insert(res, i, r);
  }
  return res;
}

extern "C" unmasked uniform double erf(uniform double x);
SCALAR_FUN_ATTR double futrts_erf64(double x) {
  double res;
  foreach_active (i) {
    uniform double r = erf(extract(x, i));
    res = insert(res, i, r);
  }
  return res;
}

extern "C" unmasked uniform double erfc(uniform double x);
SCALAR_FUN_ATTR double futrts_erfc64(double x) {
  double res;
  foreach_active (i) {
    uniform double r = erfc(extract(x, i));
    res = insert(res, i, r);
  }
  return res;
}

SCALAR_FUN_ATTR double futrts_fma64(double a, double b, double c) {
  return a * b + c;
}

SCALAR_FUN_ATTR double futrts_round64(double x) {
  return round(x);
}

SCALAR_FUN_ATTR double futrts_ceil64(double x) {
  return ceil(x);
}

extern "C" unmasked uniform double nextafter(uniform float x, uniform double y);
SCALAR_FUN_ATTR float futrts_nextafter64(double x, double y) {
  double res;
  foreach_active (i) {
    uniform double r = nextafter(extract(x, i), extract(y, i));
    res = insert(res, i, r);
  }
  return res;
}

SCALAR_FUN_ATTR double futrts_floor64(double x) {
  return floor(x);
}

SCALAR_FUN_ATTR bool futrts_isnan64(double x) {
  return isnan(x);
}

SCALAR_FUN_ATTR int8_t fptosi_f64_i8(double x) {
  if (futrts_isnan64(x) || futrts_isinf64(x)) {
    return 0;
  } else {
    return (int8_t) x;
  }
}

SCALAR_FUN_ATTR int16_t fptosi_f64_i16(double x) {
  if (futrts_isnan64(x) || futrts_isinf64(x)) {
    return 0;
  } else {
    return (int16_t) x;
  }
}

SCALAR_FUN_ATTR int32_t fptosi_f64_i32(double x) {
  if (futrts_isnan64(x) || futrts_isinf64(x)) {
    return 0;
  } else {
    return (int32_t) x;
  }
}

SCALAR_FUN_ATTR int64_t fptosi_f64_i64(double x) {
  if (futrts_isnan64(x) || futrts_isinf64(x)) {
    return 0;
  } else {
    return (int64_t) x;
  }
}

SCALAR_FUN_ATTR uint8_t fptoui_f64_i8(double x) {
  if (futrts_isnan64(x) || futrts_isinf64(x)) {
    return 0;
  } else {
    return (uint8_t) (int8_t) x;
  }
}

SCALAR_FUN_ATTR uint16_t fptoui_f64_i16(double x) {
  if (futrts_isnan64(x) || futrts_isinf64(x)) {
    return 0;
  } else {
    return (uint16_t) (int16_t) x;
  }
}

SCALAR_FUN_ATTR uint32_t fptoui_f64_i32(double x) {
  if (futrts_isnan64(x) || futrts_isinf64(x)) {
    return 0;
  } else {
    return (uint32_t) (int32_t) x;
  }
}

SCALAR_FUN_ATTR uint64_t fptoui_f64_i64(double x) {
  if (futrts_isnan64(x) || futrts_isinf64(x)) {
    return 0;
  } else {
    return (uint64_t) (int64_t) x;
  }
}

SCALAR_FUN_ATTR bool ftob_f64_bool(double x) {
  return x != 0.0;
}

SCALAR_FUN_ATTR double btof_bool_f64(bool x) {
  return x ? 1.0 : 0.0;
}

SCALAR_FUN_ATTR int64_t futrts_to_bits64(double x) {
  int64_t res;
  foreach_active (i) {
    uniform double tmp = extract(x, i);
    uniform int64_t r = *((uniform int64_t* uniform)&tmp);
    res = insert(res, i, r);
  }
  return res;
}

SCALAR_FUN_ATTR double futrts_from_bits64(int64_t x) {
  double res;
  foreach_active (i) {
    uniform int64_t tmp = extract(x, i);
    uniform double r = *((uniform double* uniform)&tmp);
    res = insert(res, i, r);
  }
  return res;
}

SCALAR_FUN_ATTR double fmod64(double x, double y) {
  return x - y * trunc(x/y);
}

SCALAR_FUN_ATTR double fsignum64(double x) {
  return futrts_isnan64(x) ? x : (x > 0 ? 1.0d : 0.0d) - (x < 0 ? 1.0d : 0.0d);
}

SCALAR_FUN_ATTR double futrts_lerp64(double v0, double v1, double t) {
  return v0 + (v1 - v0) * t;
}

SCALAR_FUN_ATTR double futrts_ldexp64(double x, int32_t y) {
  return x * pow((double)2.0, (double)y);
}

SCALAR_FUN_ATTR double futrts_copysign64(double x, double y) {
  int64_t xb = futrts_to_bits64(x);
  int64_t yb = futrts_to_bits64(y);
  return futrts_from_bits64((xb & ~(((int64_t)1)<<63)) | (yb & (((int64_t)1)<<63)));
}

SCALAR_FUN_ATTR double futrts_mad64(double a, double b, double c) {
  return a * b + c;
}

SCALAR_FUN_ATTR float fpconv_f32_f32(float x) {
  return (float) x;
}

SCALAR_FUN_ATTR double fpconv_f32_f64(float x) {
  return (double) x;
}

SCALAR_FUN_ATTR float fpconv_f64_f32(double x) {
  return (float) x;
}

SCALAR_FUN_ATTR double fpconv_f64_f64(double x) {
  return (double) x;
}

#else

SCALAR_FUN_ATTR double fdiv64(double x, double y) {
  return x / y;
}

SCALAR_FUN_ATTR double fadd64(double x, double y) {
  return x + y;
}

SCALAR_FUN_ATTR double fsub64(double x, double y) {
  return x - y;
}

SCALAR_FUN_ATTR double fmul64(double x, double y) {
  return x * y;
}

SCALAR_FUN_ATTR bool cmplt64(double x, double y) {
  return x < y;
}

SCALAR_FUN_ATTR bool cmple64(double x, double y) {
  return x <= y;
}

SCALAR_FUN_ATTR double sitofp_i8_f64(int8_t x) {
  return (double) x;
}

SCALAR_FUN_ATTR double sitofp_i16_f64(int16_t x) {
  return (double) x;
}

SCALAR_FUN_ATTR double sitofp_i32_f64(int32_t x) {
  return (double) x;
}

SCALAR_FUN_ATTR double sitofp_i64_f64(int64_t x) {
  return (double) x;
}

SCALAR_FUN_ATTR double uitofp_i8_f64(uint8_t x) {
  return (double) x;
}

SCALAR_FUN_ATTR double uitofp_i16_f64(uint16_t x) {
  return (double) x;
}

SCALAR_FUN_ATTR double uitofp_i32_f64(uint32_t x) {
  return (double) x;
}

SCALAR_FUN_ATTR double uitofp_i64_f64(uint64_t x) {
  return (double) x;
}

SCALAR_FUN_ATTR double fabs64(double x) {
  return fabs(x);
}

SCALAR_FUN_ATTR double fmax64(double x, double y) {
  return fmax(x, y);
}

SCALAR_FUN_ATTR double fmin64(double x, double y) {
  return fmin(x, y);
}

SCALAR_FUN_ATTR double fpow64(double x, double y) {
  return pow(x, y);
}

SCALAR_FUN_ATTR double futrts_log64(double x) {
  return log(x);
}

SCALAR_FUN_ATTR double futrts_log2_64(double x) {
  return log2(x);
}

SCALAR_FUN_ATTR double futrts_log10_64(double x) {
  return log10(x);
}

SCALAR_FUN_ATTR double futrts_log1p_64(double x) {
  return log1p(x);
}

SCALAR_FUN_ATTR double futrts_sqrt64(double x) {
  return sqrt(x);
}

SCALAR_FUN_ATTR double futrts_cbrt64(double x) {
  return cbrt(x);
}

SCALAR_FUN_ATTR double futrts_exp64(double x) {
  return exp(x);
}

SCALAR_FUN_ATTR double futrts_cos64(double x) {
  return cos(x);
}

SCALAR_FUN_ATTR double futrts_sin64(double x) {
  return sin(x);
}

SCALAR_FUN_ATTR double futrts_tan64(double x) {
  return tan(x);
}

SCALAR_FUN_ATTR double futrts_acos64(double x) {
  return acos(x);
}

SCALAR_FUN_ATTR double futrts_asin64(double x) {
  return asin(x);
}

SCALAR_FUN_ATTR double futrts_atan64(double x) {
  return atan(x);
}

SCALAR_FUN_ATTR double futrts_cosh64(double x) {
  return cosh(x);
}

SCALAR_FUN_ATTR double futrts_sinh64(double x) {
  return sinh(x);
}

SCALAR_FUN_ATTR double futrts_tanh64(double x) {
  return tanh(x);
}

SCALAR_FUN_ATTR double futrts_acosh64(double x) {
  return acosh(x);
}

SCALAR_FUN_ATTR double futrts_asinh64(double x) {
  return asinh(x);
}

SCALAR_FUN_ATTR double futrts_atanh64(double x) {
  return atanh(x);
}

SCALAR_FUN_ATTR double futrts_atan2_64(double x, double y) {
  return atan2(x, y);
}

SCALAR_FUN_ATTR double futrts_hypot64(double x, double y) {
  return hypot(x, y);
}

SCALAR_FUN_ATTR double futrts_gamma64(double x) {
  return tgamma(x);
}

SCALAR_FUN_ATTR double futrts_lgamma64(double x) {
  return lgamma(x);
}

SCALAR_FUN_ATTR double futrts_erf64(double x) {
  return erf(x);
}

SCALAR_FUN_ATTR double futrts_erfc64(double x) {
  return erfc(x);
}

SCALAR_FUN_ATTR double futrts_fma64(double a, double b, double c) {
  return fma(a, b, c);
}

SCALAR_FUN_ATTR double futrts_round64(double x) {
  return rint(x);
}

SCALAR_FUN_ATTR double futrts_ceil64(double x) {
  return ceil(x);
}

SCALAR_FUN_ATTR float futrts_nextafter64(float x, float y) {
  return nextafter(x, y);
}

SCALAR_FUN_ATTR double futrts_floor64(double x) {
  return floor(x);
}

SCALAR_FUN_ATTR bool futrts_isnan64(double x) {
  return isnan(x);
}

SCALAR_FUN_ATTR bool futrts_isinf64(double x) {
  return isinf(x);
}

SCALAR_FUN_ATTR int8_t fptosi_f64_i8(double x) {
  if (futrts_isnan64(x) || futrts_isinf64(x)) {
    return 0;
  } else {
    return (int8_t) x;
  }
}

SCALAR_FUN_ATTR int16_t fptosi_f64_i16(double x) {
  if (futrts_isnan64(x) || futrts_isinf64(x)) {
    return 0;
  } else {
    return (int16_t) x;
  }
}

SCALAR_FUN_ATTR int32_t fptosi_f64_i32(double x) {
  if (futrts_isnan64(x) || futrts_isinf64(x)) {
    return 0;
  } else {
    return (int32_t) x;
  }
}

SCALAR_FUN_ATTR int64_t fptosi_f64_i64(double x) {
  if (futrts_isnan64(x) || futrts_isinf64(x)) {
    return 0;
  } else {
    return (int64_t) x;
  }
}

SCALAR_FUN_ATTR uint8_t fptoui_f64_i8(double x) {
  if (futrts_isnan64(x) || futrts_isinf64(x)) {
    return 0;
  } else {
    return (uint8_t) (int8_t) x;
  }
}

SCALAR_FUN_ATTR uint16_t fptoui_f64_i16(double x) {
  if (futrts_isnan64(x) || futrts_isinf64(x)) {
    return 0;
  } else {
    return (uint16_t) (int16_t) x;
  }
}

SCALAR_FUN_ATTR uint32_t fptoui_f64_i32(double x) {
  if (futrts_isnan64(x) || futrts_isinf64(x)) {
    return 0;
  } else {
    return (uint32_t) (int32_t) x;
  }
}

SCALAR_FUN_ATTR uint64_t fptoui_f64_i64(double x) {
  if (futrts_isnan64(x) || futrts_isinf64(x)) {
    return 0;
  } else {
    return (uint64_t) (int64_t) x;
  }
}

SCALAR_FUN_ATTR bool ftob_f64_bool(double x) {
  return x != 0;
}

SCALAR_FUN_ATTR double btof_bool_f64(bool x) {
  return x ? 1 : 0;
}

SCALAR_FUN_ATTR int64_t futrts_to_bits64(double x) {
  union {
    double f;
    int64_t t;
  } p;

  p.f = x;
  return p.t;
}

SCALAR_FUN_ATTR double futrts_from_bits64(int64_t x) {
  union {
    int64_t f;
    double t;
  } p;

  p.f = x;
  return p.t;
}

SCALAR_FUN_ATTR double fmod64(double x, double y) {
  return fmod(x, y);
}

SCALAR_FUN_ATTR double fsignum64(double x) {
  return futrts_isnan64(x) ? x : (x > 0) - (x < 0);
}

SCALAR_FUN_ATTR double futrts_lerp64(double v0, double v1, double t) {
#ifdef __OPENCL_VERSION__
  return mix(v0, v1, t);
#else
  return v0 + (v1 - v0) * t;
#endif
}

SCALAR_FUN_ATTR double futrts_ldexp64(double x, int32_t y) {
  return ldexp(x, y);
}

SCALAR_FUN_ATTR float futrts_copysign64(double x, double y) {
  return copysign(x, y);
}

SCALAR_FUN_ATTR double futrts_mad64(double a, double b, double c) {
#ifdef __OPENCL_VERSION__
  return mad(a, b, c);
#else
  return a * b + c;
#endif
}

SCALAR_FUN_ATTR float fpconv_f32_f32(float x) {
  return (float) x;
}

SCALAR_FUN_ATTR double fpconv_f32_f64(float x) {
  return (double) x;
}

SCALAR_FUN_ATTR float fpconv_f64_f32(double x) {
  return (float) x;
}

SCALAR_FUN_ATTR double fpconv_f64_f64(double x) {
  return (double) x;
}

#endif

#endif

// End of scalar.h.
// Start of scalar_f16.h.

// Half-precision is emulated if needed (e.g. in straight C) with the
// native type used if possible.  The emulation works by typedef'ing
// 'float' to 'f16', and then implementing all operations on single
// precision.  To cut down on duplication, we use the same code for
// those Futhark functions that require just operators or casts.  The
// in-memory representation for arrays will still be 16 bits even
// under emulation, so the compiler will have to be careful when
// generating reads or writes.

#if !defined(cl_khr_fp16) && !(defined(__CUDA_ARCH__) && __CUDA_ARCH__ >= 600) && !(defined(ISPC))
#define EMULATE_F16
#endif

#if !defined(EMULATE_F16) && defined(__OPENCL_VERSION__)
#pragma OPENCL EXTENSION cl_khr_fp16 : enable
#endif

#ifdef EMULATE_F16

// Note that the half-precision storage format is still 16 bits - the
// compiler will have to be real careful!
typedef float f16;

#elif ISPC
typedef float16 f16;

#else

#ifdef __CUDA_ARCH__
#include <cuda_fp16.h>
#endif

typedef half f16;

#endif

// Some of these functions convert to single precision because half
// precision versions are not available.

SCALAR_FUN_ATTR f16 fadd16(f16 x, f16 y) {
  return x + y;
}

SCALAR_FUN_ATTR f16 fsub16(f16 x, f16 y) {
  return x - y;
}

SCALAR_FUN_ATTR f16 fmul16(f16 x, f16 y) {
  return x * y;
}

SCALAR_FUN_ATTR bool cmplt16(f16 x, f16 y) {
  return x < y;
}

SCALAR_FUN_ATTR bool cmple16(f16 x, f16 y) {
  return x <= y;
}

SCALAR_FUN_ATTR f16 sitofp_i8_f16(int8_t x) {
  return (f16) x;
}

SCALAR_FUN_ATTR f16 sitofp_i16_f16(int16_t x) {
  return (f16) x;
}

SCALAR_FUN_ATTR f16 sitofp_i32_f16(int32_t x) {
  return (f16) x;
}

SCALAR_FUN_ATTR f16 sitofp_i64_f16(int64_t x) {
  return (f16) x;
}

SCALAR_FUN_ATTR f16 uitofp_i8_f16(uint8_t x) {
  return (f16) x;
}

SCALAR_FUN_ATTR f16 uitofp_i16_f16(uint16_t x) {
  return (f16) x;
}

SCALAR_FUN_ATTR f16 uitofp_i32_f16(uint32_t x) {
  return (f16) x;
}

SCALAR_FUN_ATTR f16 uitofp_i64_f16(uint64_t x) {
  return (f16) x;
}

SCALAR_FUN_ATTR int8_t fptosi_f16_i8(f16 x) {
  return (int8_t) (float) x;
}

SCALAR_FUN_ATTR int16_t fptosi_f16_i16(f16 x) {
  return (int16_t) x;
}

SCALAR_FUN_ATTR int32_t fptosi_f16_i32(f16 x) {
  return (int32_t) x;
}

SCALAR_FUN_ATTR int64_t fptosi_f16_i64(f16 x) {
  return (int64_t) x;
}

SCALAR_FUN_ATTR uint8_t fptoui_f16_i8(f16 x) {
  return (uint8_t) (float) x;
}

SCALAR_FUN_ATTR uint16_t fptoui_f16_i16(f16 x) {
  return (uint16_t) x;
}

SCALAR_FUN_ATTR uint32_t fptoui_f16_i32(f16 x) {
  return (uint32_t) x;
}

SCALAR_FUN_ATTR uint64_t fptoui_f16_i64(f16 x) {
  return (uint64_t) x;
}

SCALAR_FUN_ATTR bool ftob_f16_bool(f16 x) {
  return x != (f16)0;
}

SCALAR_FUN_ATTR f16 btof_bool_f16(bool x) {
  return x ? 1 : 0;
}

#ifndef EMULATE_F16
SCALAR_FUN_ATTR bool futrts_isnan16(f16 x) {
  return isnan((float)x);
}

#ifdef __OPENCL_VERSION__

SCALAR_FUN_ATTR f16 fabs16(f16 x) {
  return fabs(x);
}

SCALAR_FUN_ATTR f16 fmax16(f16 x, f16 y) {
  return fmax(x, y);
}

SCALAR_FUN_ATTR f16 fmin16(f16 x, f16 y) {
  return fmin(x, y);
}

SCALAR_FUN_ATTR f16 fpow16(f16 x, f16 y) {
  return pow(x, y);
}

#elif ISPC
SCALAR_FUN_ATTR f16 fabs16(f16 x) {
  return abs(x);
}

SCALAR_FUN_ATTR f16 fmax16(f16 x, f16 y) {
  return futrts_isnan16(x) ? y : futrts_isnan16(y) ? x : max(x, y);
}

SCALAR_FUN_ATTR f16 fmin16(f16 x, f16 y) {
  return futrts_isnan16(x) ? y : futrts_isnan16(y) ? x : min(x, y);
}

SCALAR_FUN_ATTR f16 fpow16(f16 x, f16 y) {
  return pow(x, y);
}

#else // Assuming CUDA.

SCALAR_FUN_ATTR f16 fabs16(f16 x) {
  return fabsf(x);
}

SCALAR_FUN_ATTR f16 fmax16(f16 x, f16 y) {
  return fmaxf(x, y);
}

SCALAR_FUN_ATTR f16 fmin16(f16 x, f16 y) {
  return fminf(x, y);
}

SCALAR_FUN_ATTR f16 fpow16(f16 x, f16 y) {
  return powf(x, y);
}
#endif

#if ISPC
SCALAR_FUN_ATTR bool futrts_isinf16(float x) {
  return !futrts_isnan16(x) && futrts_isnan16(x - x);
}
SCALAR_FUN_ATTR bool futrts_isfinite16(float x) {
  return !futrts_isnan16(x) && !futrts_isinf16(x);
}

#else

SCALAR_FUN_ATTR bool futrts_isinf16(f16 x) {
  return isinf((float)x);
}
#endif

#ifdef __OPENCL_VERSION__
SCALAR_FUN_ATTR f16 futrts_log16(f16 x) {
  return log(x);
}

SCALAR_FUN_ATTR f16 futrts_log2_16(f16 x) {
  return log2(x);
}

SCALAR_FUN_ATTR f16 futrts_log10_16(f16 x) {
  return log10(x);
}

SCALAR_FUN_ATTR f16 futrts_log1p_16(f16 x) {
  return log1p(x);
}

SCALAR_FUN_ATTR f16 futrts_sqrt16(f16 x) {
  return sqrt(x);
}

SCALAR_FUN_ATTR f16 futrts_cbrt16(f16 x) {
  return cbrt(x);
}

SCALAR_FUN_ATTR f16 futrts_exp16(f16 x) {
  return exp(x);
}

SCALAR_FUN_ATTR f16 futrts_cos16(f16 x) {
  return cos(x);
}

SCALAR_FUN_ATTR f16 futrts_sin16(f16 x) {
  return sin(x);
}

SCALAR_FUN_ATTR f16 futrts_tan16(f16 x) {
  return tan(x);
}

SCALAR_FUN_ATTR f16 futrts_acos16(f16 x) {
  return acos(x);
}

SCALAR_FUN_ATTR f16 futrts_asin16(f16 x) {
  return asin(x);
}

SCALAR_FUN_ATTR f16 futrts_atan16(f16 x) {
  return atan(x);
}

SCALAR_FUN_ATTR f16 futrts_cosh16(f16 x) {
  return cosh(x);
}

SCALAR_FUN_ATTR f16 futrts_sinh16(f16 x) {
  return sinh(x);
}

SCALAR_FUN_ATTR f16 futrts_tanh16(f16 x) {
  return tanh(x);
}

SCALAR_FUN_ATTR f16 futrts_acosh16(f16 x) {
  return acosh(x);
}

SCALAR_FUN_ATTR f16 futrts_asinh16(f16 x) {
  return asinh(x);
}

SCALAR_FUN_ATTR f16 futrts_atanh16(f16 x) {
  return atanh(x);
}

SCALAR_FUN_ATTR f16 futrts_atan2_16(f16 x, f16 y) {
  return atan2(x, y);
}

SCALAR_FUN_ATTR f16 futrts_hypot16(f16 x, f16 y) {
  return hypot(x, y);
}

SCALAR_FUN_ATTR f16 futrts_gamma16(f16 x) {
  return tgamma(x);
}

SCALAR_FUN_ATTR f16 futrts_lgamma16(f16 x) {
  return lgamma(x);
}

SCALAR_FUN_ATTR f16 futrts_erf16(f16 x) {
  return erf(x);
}

SCALAR_FUN_ATTR f16 futrts_erfc16(f16 x) {
  return erfc(x);
}

SCALAR_FUN_ATTR f16 fmod16(f16 x, f16 y) {
  return fmod(x, y);
}

SCALAR_FUN_ATTR f16 futrts_round16(f16 x) {
  return rint(x);
}

SCALAR_FUN_ATTR f16 futrts_floor16(f16 x) {
  return floor(x);
}

SCALAR_FUN_ATTR f16 futrts_ceil16(f16 x) {
  return ceil(x);
}

SCALAR_FUN_ATTR f16 futrts_nextafter16(f16 x, f16 y) {
  return nextafter(x, y);
}

SCALAR_FUN_ATTR f16 futrts_lerp16(f16 v0, f16 v1, f16 t) {
  return mix(v0, v1, t);
}

SCALAR_FUN_ATTR f16 futrts_ldexp16(f16 x, int32_t y) {
  return ldexp(x, y);
}

SCALAR_FUN_ATTR f16 futrts_copysign16(f16 x, f16 y) {
  return copysign(x, y);
}

SCALAR_FUN_ATTR f16 futrts_mad16(f16 a, f16 b, f16 c) {
  return mad(a, b, c);
}

SCALAR_FUN_ATTR f16 futrts_fma16(f16 a, f16 b, f16 c) {
  return fma(a, b, c);
}
#elif ISPC

SCALAR_FUN_ATTR f16 futrts_log16(f16 x) {
  return futrts_isfinite16(x) || (futrts_isinf16(x) && x < 0) ? log(x) : x;
}

SCALAR_FUN_ATTR f16 futrts_log2_16(f16 x) {
  return futrts_log16(x) / log(2.0f16);
}

SCALAR_FUN_ATTR f16 futrts_log10_16(f16 x) {
  return futrts_log16(x) / log(10.0f16);
}

SCALAR_FUN_ATTR f16 futrts_log1p_16(f16 x) {
  if(x == -1.0f16 || (futrts_isinf16(x) && x > 0.0f16)) return x / 0.0f16;
  f16 y = 1.0f16 + x;
  f16 z = y - 1.0f16;
  return log(y) - (z-x)/y;
}

SCALAR_FUN_ATTR f16 futrts_sqrt16(f16 x) {
  return (float16)sqrt((float)x);
}

SCALAR_FUN_ATTR f16 futrts_exp16(f16 x) {
  return exp(x);
}

SCALAR_FUN_ATTR f16 futrts_cos16(f16 x) {
  return (float16)cos((float)x);
}

SCALAR_FUN_ATTR f16 futrts_sin16(f16 x) {
  return (float16)sin((float)x);
}

SCALAR_FUN_ATTR f16 futrts_tan16(f16 x) {
  return (float16)tan((float)x);
}

SCALAR_FUN_ATTR f16 futrts_acos16(f16 x) {
  return (float16)acos((float)x);
}

SCALAR_FUN_ATTR f16 futrts_asin16(f16 x) {
  return (float16)asin((float)x);
}

SCALAR_FUN_ATTR f16 futrts_atan16(f16 x) {
  return (float16)atan((float)x);
}

SCALAR_FUN_ATTR f16 futrts_cosh16(f16 x) {
  return (exp(x)+exp(-x)) / 2.0f16;
}

SCALAR_FUN_ATTR f16 futrts_sinh16(f16 x) {
  return (exp(x)-exp(-x)) / 2.0f16;
}

SCALAR_FUN_ATTR f16 futrts_tanh16(f16 x) {
  return futrts_sinh16(x)/futrts_cosh16(x);
}

SCALAR_FUN_ATTR f16 futrts_acosh16(f16 x) {
  float16 f = x+(float16)sqrt((float)(x*x-1));
  if(futrts_isfinite16(f)) return log(f);
  return f;
}

SCALAR_FUN_ATTR f16 futrts_asinh16(f16 x) {
  float16 f = x+(float16)sqrt((float)(x*x+1));
  if(futrts_isfinite16(f)) return log(f);
  return f;
}

SCALAR_FUN_ATTR f16 futrts_atanh16(f16 x) {
  float16 f = (1+x)/(1-x);
  if(futrts_isfinite16(f)) return log(f)/2.0f16;
  return f;
}

SCALAR_FUN_ATTR f16 futrts_atan2_16(f16 x, f16 y) {
  return (float16)atan2((float)x, (float)y);
}

SCALAR_FUN_ATTR f16 futrts_hypot16(f16 x, f16 y) {
  return (float16)futrts_hypot32((float)x, (float)y);
}

extern "C" unmasked uniform float tgammaf(uniform float x);
SCALAR_FUN_ATTR f16 futrts_gamma16(f16 x) {
  f16 res;
  foreach_active (i) {
    uniform f16 r = (f16)tgammaf(extract((float)x, i));
    res = insert(res, i, r);
  }
  return res;
}

extern "C" unmasked uniform float lgammaf(uniform float x);
SCALAR_FUN_ATTR f16 futrts_lgamma16(f16 x) {
  f16 res;
  foreach_active (i) {
    uniform f16 r = (f16)lgammaf(extract((float)x, i));
    res = insert(res, i, r);
  }
  return res;
}

SCALAR_FUN_ATTR f16 futrts_cbrt16(f16 x) {
  f16 res = (f16)futrts_cbrt32((float)x);
  return res;
}

SCALAR_FUN_ATTR f16 futrts_erf16(f16 x) {
  f16 res = (f16)futrts_erf32((float)x);
  return res;
}

SCALAR_FUN_ATTR f16 futrts_erfc16(f16 x) {
  f16 res = (f16)futrts_erfc32((float)x);
  return res;
}

SCALAR_FUN_ATTR f16 fmod16(f16 x, f16 y) {
  return x - y * (float16)trunc((float) (x/y));
}

SCALAR_FUN_ATTR f16 futrts_round16(f16 x) {
  return (float16)round((float)x);
}

SCALAR_FUN_ATTR f16 futrts_floor16(f16 x) {
  return (float16)floor((float)x);
}

SCALAR_FUN_ATTR f16 futrts_ceil16(f16 x) {
  return (float16)ceil((float)x);
}

SCALAR_FUN_ATTR f16 futrts_nextafter16(f16 x, f16 y) {
  return (float16)futrts_nextafter32((float)x, (float) y);
}

SCALAR_FUN_ATTR f16 futrts_lerp16(f16 v0, f16 v1, f16 t) {
  return v0 + (v1 - v0) * t;
}

SCALAR_FUN_ATTR f16 futrts_ldexp16(f16 x, int32_t y) {
  return futrts_ldexp32((float)x, y);
}

SCALAR_FUN_ATTR f16 futrts_copysign16(f16 x, f16 y) {
  return futrts_copysign32((float)x, y);
}

SCALAR_FUN_ATTR f16 futrts_mad16(f16 a, f16 b, f16 c) {
  return a * b + c;
}

SCALAR_FUN_ATTR f16 futrts_fma16(f16 a, f16 b, f16 c) {
  return a * b + c;
}

#else // Assume CUDA.

SCALAR_FUN_ATTR f16 futrts_log16(f16 x) {
  return hlog(x);
}

SCALAR_FUN_ATTR f16 futrts_log2_16(f16 x) {
  return hlog2(x);
}

SCALAR_FUN_ATTR f16 futrts_log10_16(f16 x) {
  return hlog10(x);
}

SCALAR_FUN_ATTR f16 futrts_log1p_16(f16 x) {
  return (f16)log1pf((float)x);
}

SCALAR_FUN_ATTR f16 futrts_sqrt16(f16 x) {
  return hsqrt(x);
}

SCALAR_FUN_ATTR f16 futrts_cbrt16(f16 x) {
  return cbrtf(x);
}

SCALAR_FUN_ATTR f16 futrts_exp16(f16 x) {
  return hexp(x);
}

SCALAR_FUN_ATTR f16 futrts_cos16(f16 x) {
  return hcos(x);
}

SCALAR_FUN_ATTR f16 futrts_sin16(f16 x) {
  return hsin(x);
}

SCALAR_FUN_ATTR f16 futrts_tan16(f16 x) {
  return tanf(x);
}

SCALAR_FUN_ATTR f16 futrts_acos16(f16 x) {
  return acosf(x);
}

SCALAR_FUN_ATTR f16 futrts_asin16(f16 x) {
  return asinf(x);
}

SCALAR_FUN_ATTR f16 futrts_atan16(f16 x) {
  return atanf(x);
}

SCALAR_FUN_ATTR f16 futrts_cosh16(f16 x) {
  return coshf(x);
}

SCALAR_FUN_ATTR f16 futrts_sinh16(f16 x) {
  return sinhf(x);
}

SCALAR_FUN_ATTR f16 futrts_tanh16(f16 x) {
  return tanhf(x);
}

SCALAR_FUN_ATTR f16 futrts_acosh16(f16 x) {
  return acoshf(x);
}

SCALAR_FUN_ATTR f16 futrts_asinh16(f16 x) {
  return asinhf(x);
}

SCALAR_FUN_ATTR f16 futrts_atanh16(f16 x) {
  return atanhf(x);
}

SCALAR_FUN_ATTR f16 futrts_atan2_16(f16 x, f16 y) {
  return atan2f(x, y);
}

SCALAR_FUN_ATTR f16 futrts_hypot16(f16 x, f16 y) {
  return hypotf(x, y);
}

SCALAR_FUN_ATTR f16 futrts_gamma16(f16 x) {
  return tgammaf(x);
}

SCALAR_FUN_ATTR f16 futrts_lgamma16(f16 x) {
  return lgammaf(x);
}

SCALAR_FUN_ATTR f16 futrts_erf16(f16 x) {
  return erff(x);
}

SCALAR_FUN_ATTR f16 futrts_erfc16(f16 x) {
  return erfcf(x);
}

SCALAR_FUN_ATTR f16 fmod16(f16 x, f16 y) {
  return fmodf(x, y);
}

SCALAR_FUN_ATTR f16 futrts_round16(f16 x) {
  return rintf(x);
}

SCALAR_FUN_ATTR f16 futrts_floor16(f16 x) {
  return hfloor(x);
}

SCALAR_FUN_ATTR f16 futrts_ceil16(f16 x) {
  return hceil(x);
}

SCALAR_FUN_ATTR f16 futrts_nextafter16(f16 x, f16 y) {
  return __ushort_as_half(halfbitsnextafter(__half_as_ushort(x), __half_as_ushort(y)));
}

SCALAR_FUN_ATTR f16 futrts_lerp16(f16 v0, f16 v1, f16 t) {
  return v0 + (v1 - v0) * t;
}

SCALAR_FUN_ATTR f16 futrts_ldexp16(f16 x, int32_t y) {
  return futrts_ldexp32((float)x, y);
}

SCALAR_FUN_ATTR f16 futrts_copysign16(f16 x, f16 y) {
  return futrts_copysign32((float)x, y);
}

SCALAR_FUN_ATTR f16 futrts_mad16(f16 a, f16 b, f16 c) {
  return a * b + c;
}

SCALAR_FUN_ATTR f16 futrts_fma16(f16 a, f16 b, f16 c) {
  return fmaf(a, b, c);
}

#endif

// The CUDA __half type cannot be put in unions for some reason, so we
// use bespoke conversion functions instead.
#ifdef __CUDA_ARCH__
SCALAR_FUN_ATTR int16_t futrts_to_bits16(f16 x) {
  return __half_as_ushort(x);
}
SCALAR_FUN_ATTR f16 futrts_from_bits16(int16_t x) {
  return __ushort_as_half(x);
}
#elif ISPC

SCALAR_FUN_ATTR int16_t futrts_to_bits16(f16 x) {
  varying int16_t y = *((varying int16_t * uniform)&x);
  return y;
}

SCALAR_FUN_ATTR f16 futrts_from_bits16(int16_t x) {
  varying f16 y = *((varying f16 * uniform)&x);
  return y;
}
#else
SCALAR_FUN_ATTR int16_t futrts_to_bits16(f16 x) {
  union {
    f16 f;
    int16_t t;
  } p;

  p.f = x;
  return p.t;
}

SCALAR_FUN_ATTR f16 futrts_from_bits16(int16_t x) {
  union {
    int16_t f;
    f16 t;
  } p;

  p.f = x;
  return p.t;
}
#endif

#else // No native f16 - emulate.

SCALAR_FUN_ATTR f16 fabs16(f16 x) {
  return fabs32(x);
}

SCALAR_FUN_ATTR f16 fmax16(f16 x, f16 y) {
  return fmax32(x, y);
}

SCALAR_FUN_ATTR f16 fmin16(f16 x, f16 y) {
  return fmin32(x, y);
}

SCALAR_FUN_ATTR f16 fpow16(f16 x, f16 y) {
  return fpow32(x, y);
}

SCALAR_FUN_ATTR bool futrts_isnan16(f16 x) {
  return futrts_isnan32(x);
}

SCALAR_FUN_ATTR bool futrts_isinf16(f16 x) {
  return futrts_isinf32(x);
}

SCALAR_FUN_ATTR f16 futrts_log16(f16 x) {
  return futrts_log32(x);
}

SCALAR_FUN_ATTR f16 futrts_log2_16(f16 x) {
  return futrts_log2_32(x);
}

SCALAR_FUN_ATTR f16 futrts_log10_16(f16 x) {
  return futrts_log10_32(x);
}

SCALAR_FUN_ATTR f16 futrts_log1p_16(f16 x) {
  return futrts_log1p_32(x);
}

SCALAR_FUN_ATTR f16 futrts_sqrt16(f16 x) {
  return futrts_sqrt32(x);
}

SCALAR_FUN_ATTR f16 futrts_cbrt16(f16 x) {
  return futrts_cbrt32(x);
}

SCALAR_FUN_ATTR f16 futrts_exp16(f16 x) {
  return futrts_exp32(x);
}

SCALAR_FUN_ATTR f16 futrts_cos16(f16 x) {
  return futrts_cos32(x);
}

SCALAR_FUN_ATTR f16 futrts_sin16(f16 x) {
  return futrts_sin32(x);
}

SCALAR_FUN_ATTR f16 futrts_tan16(f16 x) {
  return futrts_tan32(x);
}

SCALAR_FUN_ATTR f16 futrts_acos16(f16 x) {
  return futrts_acos32(x);
}

SCALAR_FUN_ATTR f16 futrts_asin16(f16 x) {
  return futrts_asin32(x);
}

SCALAR_FUN_ATTR f16 futrts_atan16(f16 x) {
  return futrts_atan32(x);
}

SCALAR_FUN_ATTR f16 futrts_cosh16(f16 x) {
  return futrts_cosh32(x);
}

SCALAR_FUN_ATTR f16 futrts_sinh16(f16 x) {
  return futrts_sinh32(x);
}

SCALAR_FUN_ATTR f16 futrts_tanh16(f16 x) {
  return futrts_tanh32(x);
}

SCALAR_FUN_ATTR f16 futrts_acosh16(f16 x) {
  return futrts_acosh32(x);
}

SCALAR_FUN_ATTR f16 futrts_asinh16(f16 x) {
  return futrts_asinh32(x);
}

SCALAR_FUN_ATTR f16 futrts_atanh16(f16 x) {
  return futrts_atanh32(x);
}

SCALAR_FUN_ATTR f16 futrts_atan2_16(f16 x, f16 y) {
  return futrts_atan2_32(x, y);
}

SCALAR_FUN_ATTR f16 futrts_hypot16(f16 x, f16 y) {
  return futrts_hypot32(x, y);
}

SCALAR_FUN_ATTR f16 futrts_gamma16(f16 x) {
  return futrts_gamma32(x);
}

SCALAR_FUN_ATTR f16 futrts_lgamma16(f16 x) {
  return futrts_lgamma32(x);
}

SCALAR_FUN_ATTR f16 futrts_erf16(f16 x) {
  return futrts_erf32(x);
}

SCALAR_FUN_ATTR f16 futrts_erfc16(f16 x) {
  return futrts_erfc32(x);
}

SCALAR_FUN_ATTR f16 fmod16(f16 x, f16 y) {
  return fmod32(x, y);
}

SCALAR_FUN_ATTR f16 futrts_round16(f16 x) {
  return futrts_round32(x);
}

SCALAR_FUN_ATTR f16 futrts_floor16(f16 x) {
  return futrts_floor32(x);
}

SCALAR_FUN_ATTR f16 futrts_ceil16(f16 x) {
  return futrts_ceil32(x);
}

SCALAR_FUN_ATTR f16 futrts_nextafter16(f16 x, f16 y) {
  return halfbits2float(halfbitsnextafter(float2halfbits(x), float2halfbits(y)));
}

SCALAR_FUN_ATTR f16 futrts_lerp16(f16 v0, f16 v1, f16 t) {
  return futrts_lerp32(v0, v1, t);
}

SCALAR_FUN_ATTR f16 futrts_ldexp16(f16 x, int32_t y) {
  return futrts_ldexp32(x, y);
}

SCALAR_FUN_ATTR f16 futrts_copysign16(f16 x, f16 y) {
  return futrts_copysign32((float)x, y);
}

SCALAR_FUN_ATTR f16 futrts_mad16(f16 a, f16 b, f16 c) {
  return futrts_mad32(a, b, c);
}

SCALAR_FUN_ATTR f16 futrts_fma16(f16 a, f16 b, f16 c) {
  return futrts_fma32(a, b, c);
}

// Even when we are using an OpenCL that does not support cl_khr_fp16,
// it must still support vload_half for actually creating a
// half-precision number, which can then be efficiently converted to a
// float.  Similarly for vstore_half.
#ifdef __OPENCL_VERSION__

SCALAR_FUN_ATTR int16_t futrts_to_bits16(f16 x) {
  int16_t y;
  // Violating strict aliasing here.
  vstore_half((float)x, 0, (half*)&y);
  return y;
}

SCALAR_FUN_ATTR f16 futrts_from_bits16(int16_t x) {
  return (f16)vload_half(0, (half*)&x);
}

#else

SCALAR_FUN_ATTR int16_t futrts_to_bits16(f16 x) {
  return (int16_t)float2halfbits(x);
}

SCALAR_FUN_ATTR f16 futrts_from_bits16(int16_t x) {
  return halfbits2float((uint16_t)x);
}

SCALAR_FUN_ATTR f16 fsignum16(f16 x) {
  return futrts_isnan16(x) ? x : (x > 0 ? 1 : 0) - (x < 0 ? 1 : 0);
}

#endif

#endif

SCALAR_FUN_ATTR float fpconv_f16_f16(f16 x) {
  return x;
}

SCALAR_FUN_ATTR float fpconv_f16_f32(f16 x) {
  return x;
}

SCALAR_FUN_ATTR f16 fpconv_f32_f16(float x) {
  return (f16) x;
}

#ifdef FUTHARK_F64_ENABLED

SCALAR_FUN_ATTR double fpconv_f16_f64(f16 x) {
  return (double) x;
}

#if ISPC
SCALAR_FUN_ATTR f16 fpconv_f64_f16(double x) {
  return (f16) ((float)x);
}
#else
SCALAR_FUN_ATTR f16 fpconv_f64_f16(double x) {
  return (f16) x;
}
#endif
#endif


// End of scalar_f16.h.

// Start of context_prototypes.h
//
// Prototypes for the functions in context.h, or that will be called
// from those functions, that need to be available very early.

struct futhark_context_config;
struct futhark_context;

static void set_error(struct futhark_context* ctx, char *error);

// These are called in context/config new/free functions and contain
// shared setup.  They are generated by the compiler itself.
static int init_constants(struct futhark_context*);
static int free_constants(struct futhark_context*);
static void setup_program(struct futhark_context* ctx);
static void teardown_program(struct futhark_context *ctx);

// Allocate host memory.  Must be freed with host_free().
static void host_alloc(struct futhark_context* ctx, size_t size, const char* tag, size_t* size_out, void** mem_out);
// Allocate memory allocated with host_alloc().
static void host_free(struct futhark_context* ctx, size_t size, const char* tag, void* mem);

// Log that a copy has occurred.
static void log_copy(struct futhark_context* ctx,
                     const char *kind, int r,
                     int64_t dst_offset, int64_t dst_strides[r],
                     int64_t src_offset, int64_t src_strides[r],
                     int64_t shape[r]);

static void log_transpose(struct futhark_context* ctx,
                          int64_t k, int64_t m, int64_t n);

static bool lmad_map_tr(int64_t *num_arrays_out, int64_t *n_out, int64_t *m_out,
                        int r,
                        const int64_t dst_strides[r],
                        const int64_t src_strides[r],
                        const int64_t shape[r]);

static bool lmad_contiguous(int r, int64_t strides[r], int64_t shape[r]);

static bool lmad_memcpyable(int r,
                            int64_t dst_strides[r], int64_t src_strides[r], int64_t shape[r]);

static void add_event(struct futhark_context* ctx,
                      const char* name,
                      char* description,
                      void* data,
                      event_report_fn f);

// Functions that must be defined by the backend.
static void backend_context_config_setup(struct futhark_context_config* cfg);
static void backend_context_config_teardown(struct futhark_context_config* cfg);
static int backend_context_setup(struct futhark_context *ctx);
static void backend_context_teardown(struct futhark_context *ctx);

// End of of context_prototypes.h

struct memblock_device {
    int *references;
    CUdeviceptr mem;
    int64_t size;
    const char *desc;
};
struct memblock {
    int *references;
    unsigned char *mem;
    int64_t size;
    const char *desc;
};
struct constants {
    int dummy;
    struct memblock_device counters_mem_54551;
    struct memblock_device counters_mem_54625;
    struct memblock_device counters_mem_55050;
    struct memblock_device counters_mem_55495;
    struct memblock_device counters_mem_55534;
    struct memblock_device counters_mem_55581;
    struct memblock_device counters_mem_56605;
    struct memblock_device counters_mem_56764;
    struct memblock_device counters_mem_56815;
    struct memblock_device counters_mem_56850;
    struct memblock_device global_dynid_mem_54616;
    struct memblock_device global_dynid_mem_54626;
    struct memblock_device global_dynid_mem_54637;
    struct memblock_device global_dynid_mem_54642;
    struct memblock_device global_dynid_mem_54800;
    struct memblock_device global_dynid_mem_54871;
    struct memblock_device global_dynid_mem_54920;
    struct memblock_device global_dynid_mem_55083;
    struct memblock_device global_dynid_mem_55112;
    struct memblock_device global_dynid_mem_55221;
    struct memblock_device global_dynid_mem_55228;
    struct memblock_device global_dynid_mem_55334;
    struct memblock_device global_dynid_mem_55338;
    struct memblock_device global_dynid_mem_55581;
    struct memblock_device global_dynid_mem_55728;
    struct memblock_device global_dynid_mem_55884;
    struct memblock_device global_dynid_mem_56002;
    struct memblock_device global_dynid_mem_56151;
    struct memblock_device global_dynid_mem_56269;
    struct memblock_device global_dynid_mem_56425;
};
struct tuning_params {
    int dummy;
    int64_t *add_next_partition_doublezisegmap_num_tblocks_46475;
    int64_t *add_next_partition_doublezisegmap_num_tblocks_46491;
    int64_t *add_next_partition_doublezisegmap_num_tblocks_46790;
    int64_t *add_next_partition_doublezisegmap_num_tblocks_46806;
    int64_t *add_next_partition_doublezisegmap_tblock_sizze_46063;
    int64_t *add_next_partition_doublezisegmap_tblock_sizze_46132;
    int64_t *add_next_partition_doublezisegmap_tblock_sizze_46473;
    int64_t *add_next_partition_doublezisegmap_tblock_sizze_46489;
    int64_t *add_next_partition_doublezisegmap_tblock_sizze_46686;
    int64_t *add_next_partition_doublezisegmap_tblock_sizze_46788;
    int64_t *add_next_partition_doublezisegmap_tblock_sizze_46804;
    int64_t *add_next_partition_doublezisegmap_tblock_sizze_46812;
    int64_t *add_next_partition_doublezisegmap_tblock_sizze_46889;
    int64_t *add_next_partition_doublezisegred_num_tblocks_46115;
    int64_t *add_next_partition_doublezisegred_num_tblocks_46591;
    int64_t *add_next_partition_doublezisegred_tblock_sizze_46113;
    int64_t *add_next_partition_doublezisegred_tblock_sizze_46589;
    int64_t *add_next_partition_doublezisegscan_num_tblocks_45773;
    int64_t *add_next_partition_doublezisegscan_num_tblocks_46230;
    int64_t *add_next_partition_doublezisegscan_num_tblocks_46481;
    int64_t *add_next_partition_doublezisegscan_num_tblocks_46780;
    int64_t *add_next_partition_doublezisegscan_num_tblocks_46796;
    int64_t *add_next_partition_doublezisegscan_tblock_sizze_45771;
    int64_t *add_next_partition_doublezisegscan_tblock_sizze_46228;
    int64_t *add_next_partition_doublezisegscan_tblock_sizze_46479;
    int64_t *add_next_partition_doublezisegscan_tblock_sizze_46778;
    int64_t *add_next_partition_doublezisegscan_tblock_sizze_46794;
    int64_t *add_next_partition_doublezisuff_intra_par_2;
    int64_t *add_next_partition_doublezisuff_outer_par_1;
    int64_t *add_next_partition_doublezisuff_outer_par_3;
    int64_t *add_next_partition_doublezisuff_outer_screma_0;
    int64_t *add_next_partition_doublezitile_sizze_49825;
    int64_t *add_next_partition_doublezitile_sizze_50037;
    int64_t *builtinzhiota_i64zitblock_sizze_54734;
    int64_t *builtinzhreplicate_boolzitblock_sizze_55483;
    int64_t *builtinzhreplicate_f64zitblock_sizze_54810;
    int64_t *builtinzhreplicate_i32zitblock_sizze_54636;
    int64_t *builtinzhreplicate_i64zitblock_sizze_54551;
    int64_t *builtinzhreplicate_i8zitblock_sizze_54601;
    int64_t *do_DBSCAN_doublezisegmap_num_tblocks_46959;
    int64_t *do_DBSCAN_doublezisegmap_num_tblocks_46975;
    int64_t *do_DBSCAN_doublezisegmap_num_tblocks_46991;
    int64_t *do_DBSCAN_doublezisegmap_num_tblocks_47007;
    int64_t *do_DBSCAN_doublezisegmap_num_tblocks_47015;
    int64_t *do_DBSCAN_doublezisegmap_num_tblocks_47055;
    int64_t *do_DBSCAN_doublezisegmap_num_tblocks_47411;
    int64_t *do_DBSCAN_doublezisegmap_num_tblocks_47824;
    int64_t *do_DBSCAN_doublezisegmap_num_tblocks_48454;
    int64_t *do_DBSCAN_doublezisegmap_num_tblocks_48462;
    int64_t *do_DBSCAN_doublezisegmap_num_tblocks_48914;
    int64_t *do_DBSCAN_doublezisegmap_tblock_sizze_46957;
    int64_t *do_DBSCAN_doublezisegmap_tblock_sizze_46973;
    int64_t *do_DBSCAN_doublezisegmap_tblock_sizze_46989;
    int64_t *do_DBSCAN_doublezisegmap_tblock_sizze_47005;
    int64_t *do_DBSCAN_doublezisegmap_tblock_sizze_47013;
    int64_t *do_DBSCAN_doublezisegmap_tblock_sizze_47021;
    int64_t *do_DBSCAN_doublezisegmap_tblock_sizze_47053;
    int64_t *do_DBSCAN_doublezisegmap_tblock_sizze_47228;
    int64_t *do_DBSCAN_doublezisegmap_tblock_sizze_47329;
    int64_t *do_DBSCAN_doublezisegmap_tblock_sizze_47355;
    int64_t *do_DBSCAN_doublezisegmap_tblock_sizze_47391;
    int64_t *do_DBSCAN_doublezisegmap_tblock_sizze_47409;
    int64_t *do_DBSCAN_doublezisegmap_tblock_sizze_47822;
    int64_t *do_DBSCAN_doublezisegmap_tblock_sizze_48136;
    int64_t *do_DBSCAN_doublezisegmap_tblock_sizze_48362;
    int64_t *do_DBSCAN_doublezisegmap_tblock_sizze_48452;
    int64_t *do_DBSCAN_doublezisegmap_tblock_sizze_48460;
    int64_t *do_DBSCAN_doublezisegmap_tblock_sizze_48912;
    int64_t *do_DBSCAN_doublezisegmap_tblock_sizze_49100;
    int64_t *do_DBSCAN_doublezisegred_num_tblocks_47178;
    int64_t *do_DBSCAN_doublezisegred_num_tblocks_47311;
    int64_t *do_DBSCAN_doublezisegred_num_tblocks_48306;
    int64_t *do_DBSCAN_doublezisegred_num_tblocks_49044;
    int64_t *do_DBSCAN_doublezisegred_num_tblocks_49190;
    int64_t *do_DBSCAN_doublezisegred_num_tblocks_49200;
    int64_t *do_DBSCAN_doublezisegred_tblock_sizze_47176;
    int64_t *do_DBSCAN_doublezisegred_tblock_sizze_47309;
    int64_t *do_DBSCAN_doublezisegred_tblock_sizze_48304;
    int64_t *do_DBSCAN_doublezisegred_tblock_sizze_49042;
    int64_t *do_DBSCAN_doublezisegred_tblock_sizze_49188;
    int64_t *do_DBSCAN_doublezisegred_tblock_sizze_49198;
    int64_t *do_DBSCAN_doublezisegscan_num_tblocks_46949;
    int64_t *do_DBSCAN_doublezisegscan_num_tblocks_46965;
    int64_t *do_DBSCAN_doublezisegscan_num_tblocks_46981;
    int64_t *do_DBSCAN_doublezisegscan_num_tblocks_46997;
    int64_t *do_DBSCAN_doublezisegscan_num_tblocks_47045;
    int64_t *do_DBSCAN_doublezisegscan_num_tblocks_47061;
    int64_t *do_DBSCAN_doublezisegscan_num_tblocks_47321;
    int64_t *do_DBSCAN_doublezisegscan_num_tblocks_47448;
    int64_t *do_DBSCAN_doublezisegscan_num_tblocks_47708;
    int64_t *do_DBSCAN_doublezisegscan_num_tblocks_47832;
    int64_t *do_DBSCAN_doublezisegscan_num_tblocks_48039;
    int64_t *do_DBSCAN_doublezisegscan_num_tblocks_48470;
    int64_t *do_DBSCAN_doublezisegscan_num_tblocks_48780;
    int64_t *do_DBSCAN_doublezisegscan_tblock_sizze_46947;
    int64_t *do_DBSCAN_doublezisegscan_tblock_sizze_46963;
    int64_t *do_DBSCAN_doublezisegscan_tblock_sizze_46979;
    int64_t *do_DBSCAN_doublezisegscan_tblock_sizze_46995;
    int64_t *do_DBSCAN_doublezisegscan_tblock_sizze_47043;
    int64_t *do_DBSCAN_doublezisegscan_tblock_sizze_47059;
    int64_t *do_DBSCAN_doublezisegscan_tblock_sizze_47319;
    int64_t *do_DBSCAN_doublezisegscan_tblock_sizze_47446;
    int64_t *do_DBSCAN_doublezisegscan_tblock_sizze_47706;
    int64_t *do_DBSCAN_doublezisegscan_tblock_sizze_47830;
    int64_t *do_DBSCAN_doublezisegscan_tblock_sizze_48037;
    int64_t *do_DBSCAN_doublezisegscan_tblock_sizze_48468;
    int64_t *do_DBSCAN_doublezisegscan_tblock_sizze_48778;
    int64_t *do_DBSCAN_doublezisuff_outer_par_0;
    int64_t *do_DBSCAN_doublezisuff_outer_par_2;
    int64_t *do_DBSCAN_doublezisuff_outer_par_4;
    int64_t *do_DBSCAN_doublezisuff_outer_par_5;
    int64_t *do_DBSCAN_doublezisuff_outer_par_7;
    int64_t *do_DBSCAN_doublezisuff_outer_par_8;
    int64_t *do_DBSCAN_doublezisuff_outer_screma_1;
    int64_t *do_DBSCAN_doublezisuff_outer_screma_3;
    int64_t *do_DBSCAN_doublezisuff_outer_screma_6;
    int64_t *do_DBSCAN_doublezitile_sizze_49825;
    int64_t *do_DBSCAN_doublezitile_sizze_50205;
    int64_t *do_DBSCAN_doublezitile_sizze_50560;
    int64_t *do_DBSCAN_doublezitile_sizze_50915;
    int64_t *do_DBSCAN_doublezitile_sizze_51194;
    int64_t *do_DBSCAN_doublezitile_sizze_51473;
    int64_t *do_DBSCAN_doublezitile_sizze_51882;
    int64_t *do_DBSCAN_doublezitile_sizze_52264;
    int64_t *do_DBSCAN_doublezitile_sizze_52646;
    int64_t *get_num_neighbours_against_10103zisegmap_tblock_sizze_49363;
    int64_t *get_num_neighbours_against_10103zisegred_num_tblocks_49315;
    int64_t *get_num_neighbours_against_10103zisegred_tblock_sizze_49313;
    int64_t *get_num_neighbours_against_10103zisuff_outer_par_0;
    int64_t *get_num_neighbours_against_10103zitile_sizze_49825;
    int64_t *get_num_neighbours_against_10106zisegmap_tblock_sizze_49597;
    int64_t *get_num_neighbours_against_10106zisegred_num_tblocks_49549;
    int64_t *get_num_neighbours_against_10106zisegred_tblock_sizze_49547;
    int64_t *get_num_neighbours_against_10106zisuff_outer_par_0;
    int64_t *get_num_neighbours_against_10106zitile_sizze_49825;
    int64_t *make_collisions_compact_doublezisegmap_num_tblocks_45660;
    int64_t *make_collisions_compact_doublezisegmap_tblock_sizze_45658;
    int64_t *make_collisions_compact_doublezisegscan_num_tblocks_45650;
    int64_t *make_collisions_compact_doublezisegscan_tblock_sizze_45648;
    int64_t *make_collisions_compact_doublezisuff_outer_par_0;
    int64_t *make_collisions_compact_doublezitile_sizze_49825;
    int64_t *make_collisions_compact_doublezitile_sizze_50094;
    int64_t *next_partition_to_read_doublezisegmap_num_tblocks_45497;
    int64_t *next_partition_to_read_doublezisegmap_tblock_sizze_45495;
    int64_t *next_partition_to_read_doublezisegred_num_tblocks_45477;
    int64_t *next_partition_to_read_doublezisegred_tblock_sizze_45475;
    int64_t *next_partition_to_read_doublezisegscan_num_tblocks_45487;
    int64_t *next_partition_to_read_doublezisegscan_tblock_sizze_45485;
    int64_t *rectify_partition_ids_doublezisuff_outer_par_0;
    int64_t *rectify_partition_ids_doublezitile_sizze_49825;
    int64_t *rectify_partition_ids_doublezitile_sizze_50069;
};
static const int num_tuning_params = 151;
static const char *tuning_param_names[] = {"add_next_partition_double.segmap_num_tblocks_46475", "add_next_partition_double.segmap_num_tblocks_46491", "add_next_partition_double.segmap_num_tblocks_46790", "add_next_partition_double.segmap_num_tblocks_46806", "add_next_partition_double.segmap_tblock_size_46063", "add_next_partition_double.segmap_tblock_size_46132", "add_next_partition_double.segmap_tblock_size_46473", "add_next_partition_double.segmap_tblock_size_46489", "add_next_partition_double.segmap_tblock_size_46686", "add_next_partition_double.segmap_tblock_size_46788", "add_next_partition_double.segmap_tblock_size_46804", "add_next_partition_double.segmap_tblock_size_46812", "add_next_partition_double.segmap_tblock_size_46889", "add_next_partition_double.segred_num_tblocks_46115", "add_next_partition_double.segred_num_tblocks_46591", "add_next_partition_double.segred_tblock_size_46113", "add_next_partition_double.segred_tblock_size_46589", "add_next_partition_double.segscan_num_tblocks_45773", "add_next_partition_double.segscan_num_tblocks_46230", "add_next_partition_double.segscan_num_tblocks_46481", "add_next_partition_double.segscan_num_tblocks_46780", "add_next_partition_double.segscan_num_tblocks_46796", "add_next_partition_double.segscan_tblock_size_45771", "add_next_partition_double.segscan_tblock_size_46228", "add_next_partition_double.segscan_tblock_size_46479", "add_next_partition_double.segscan_tblock_size_46778", "add_next_partition_double.segscan_tblock_size_46794", "add_next_partition_double.suff_intra_par_2", "add_next_partition_double.suff_outer_par_1", "add_next_partition_double.suff_outer_par_3", "add_next_partition_double.suff_outer_screma_0", "add_next_partition_double.tile_size_49825", "add_next_partition_double.tile_size_50037", "builtin#iota_i64.tblock_size_54734", "builtin#replicate_bool.tblock_size_55483", "builtin#replicate_f64.tblock_size_54810", "builtin#replicate_i32.tblock_size_54636", "builtin#replicate_i64.tblock_size_54551", "builtin#replicate_i8.tblock_size_54601", "do_DBSCAN_double.segmap_num_tblocks_46959", "do_DBSCAN_double.segmap_num_tblocks_46975", "do_DBSCAN_double.segmap_num_tblocks_46991", "do_DBSCAN_double.segmap_num_tblocks_47007", "do_DBSCAN_double.segmap_num_tblocks_47015", "do_DBSCAN_double.segmap_num_tblocks_47055", "do_DBSCAN_double.segmap_num_tblocks_47411", "do_DBSCAN_double.segmap_num_tblocks_47824", "do_DBSCAN_double.segmap_num_tblocks_48454", "do_DBSCAN_double.segmap_num_tblocks_48462", "do_DBSCAN_double.segmap_num_tblocks_48914", "do_DBSCAN_double.segmap_tblock_size_46957", "do_DBSCAN_double.segmap_tblock_size_46973", "do_DBSCAN_double.segmap_tblock_size_46989", "do_DBSCAN_double.segmap_tblock_size_47005", "do_DBSCAN_double.segmap_tblock_size_47013", "do_DBSCAN_double.segmap_tblock_size_47021", "do_DBSCAN_double.segmap_tblock_size_47053", "do_DBSCAN_double.segmap_tblock_size_47228", "do_DBSCAN_double.segmap_tblock_size_47329", "do_DBSCAN_double.segmap_tblock_size_47355", "do_DBSCAN_double.segmap_tblock_size_47391", "do_DBSCAN_double.segmap_tblock_size_47409", "do_DBSCAN_double.segmap_tblock_size_47822", "do_DBSCAN_double.segmap_tblock_size_48136", "do_DBSCAN_double.segmap_tblock_size_48362", "do_DBSCAN_double.segmap_tblock_size_48452", "do_DBSCAN_double.segmap_tblock_size_48460", "do_DBSCAN_double.segmap_tblock_size_48912", "do_DBSCAN_double.segmap_tblock_size_49100", "do_DBSCAN_double.segred_num_tblocks_47178", "do_DBSCAN_double.segred_num_tblocks_47311", "do_DBSCAN_double.segred_num_tblocks_48306", "do_DBSCAN_double.segred_num_tblocks_49044", "do_DBSCAN_double.segred_num_tblocks_49190", "do_DBSCAN_double.segred_num_tblocks_49200", "do_DBSCAN_double.segred_tblock_size_47176", "do_DBSCAN_double.segred_tblock_size_47309", "do_DBSCAN_double.segred_tblock_size_48304", "do_DBSCAN_double.segred_tblock_size_49042", "do_DBSCAN_double.segred_tblock_size_49188", "do_DBSCAN_double.segred_tblock_size_49198", "do_DBSCAN_double.segscan_num_tblocks_46949", "do_DBSCAN_double.segscan_num_tblocks_46965", "do_DBSCAN_double.segscan_num_tblocks_46981", "do_DBSCAN_double.segscan_num_tblocks_46997", "do_DBSCAN_double.segscan_num_tblocks_47045", "do_DBSCAN_double.segscan_num_tblocks_47061", "do_DBSCAN_double.segscan_num_tblocks_47321", "do_DBSCAN_double.segscan_num_tblocks_47448", "do_DBSCAN_double.segscan_num_tblocks_47708", "do_DBSCAN_double.segscan_num_tblocks_47832", "do_DBSCAN_double.segscan_num_tblocks_48039", "do_DBSCAN_double.segscan_num_tblocks_48470", "do_DBSCAN_double.segscan_num_tblocks_48780", "do_DBSCAN_double.segscan_tblock_size_46947", "do_DBSCAN_double.segscan_tblock_size_46963", "do_DBSCAN_double.segscan_tblock_size_46979", "do_DBSCAN_double.segscan_tblock_size_46995", "do_DBSCAN_double.segscan_tblock_size_47043", "do_DBSCAN_double.segscan_tblock_size_47059", "do_DBSCAN_double.segscan_tblock_size_47319", "do_DBSCAN_double.segscan_tblock_size_47446", "do_DBSCAN_double.segscan_tblock_size_47706", "do_DBSCAN_double.segscan_tblock_size_47830", "do_DBSCAN_double.segscan_tblock_size_48037", "do_DBSCAN_double.segscan_tblock_size_48468", "do_DBSCAN_double.segscan_tblock_size_48778", "do_DBSCAN_double.suff_outer_par_0", "do_DBSCAN_double.suff_outer_par_2", "do_DBSCAN_double.suff_outer_par_4", "do_DBSCAN_double.suff_outer_par_5", "do_DBSCAN_double.suff_outer_par_7", "do_DBSCAN_double.suff_outer_par_8", "do_DBSCAN_double.suff_outer_screma_1", "do_DBSCAN_double.suff_outer_screma_3", "do_DBSCAN_double.suff_outer_screma_6", "do_DBSCAN_double.tile_size_49825", "do_DBSCAN_double.tile_size_50205", "do_DBSCAN_double.tile_size_50560", "do_DBSCAN_double.tile_size_50915", "do_DBSCAN_double.tile_size_51194", "do_DBSCAN_double.tile_size_51473", "do_DBSCAN_double.tile_size_51882", "do_DBSCAN_double.tile_size_52264", "do_DBSCAN_double.tile_size_52646", "get_num_neighbours_against_10103.segmap_tblock_size_49363", "get_num_neighbours_against_10103.segred_num_tblocks_49315", "get_num_neighbours_against_10103.segred_tblock_size_49313", "get_num_neighbours_against_10103.suff_outer_par_0", "get_num_neighbours_against_10103.tile_size_49825", "get_num_neighbours_against_10106.segmap_tblock_size_49597", "get_num_neighbours_against_10106.segred_num_tblocks_49549", "get_num_neighbours_against_10106.segred_tblock_size_49547", "get_num_neighbours_against_10106.suff_outer_par_0", "get_num_neighbours_against_10106.tile_size_49825", "make_collisions_compact_double.segmap_num_tblocks_45660", "make_collisions_compact_double.segmap_tblock_size_45658", "make_collisions_compact_double.segscan_num_tblocks_45650", "make_collisions_compact_double.segscan_tblock_size_45648", "make_collisions_compact_double.suff_outer_par_0", "make_collisions_compact_double.tile_size_49825", "make_collisions_compact_double.tile_size_50094", "next_partition_to_read_double.segmap_num_tblocks_45497", "next_partition_to_read_double.segmap_tblock_size_45495", "next_partition_to_read_double.segred_num_tblocks_45477", "next_partition_to_read_double.segred_tblock_size_45475", "next_partition_to_read_double.segscan_num_tblocks_45487", "next_partition_to_read_double.segscan_tblock_size_45485", "rectify_partition_ids_double.suff_outer_par_0", "rectify_partition_ids_double.tile_size_49825", "rectify_partition_ids_double.tile_size_50069", NULL};
static const char *tuning_param_vars[] = {"add_next_partition_doublezisegmap_num_tblocks_46475", "add_next_partition_doublezisegmap_num_tblocks_46491", "add_next_partition_doublezisegmap_num_tblocks_46790", "add_next_partition_doublezisegmap_num_tblocks_46806", "add_next_partition_doublezisegmap_tblock_sizze_46063", "add_next_partition_doublezisegmap_tblock_sizze_46132", "add_next_partition_doublezisegmap_tblock_sizze_46473", "add_next_partition_doublezisegmap_tblock_sizze_46489", "add_next_partition_doublezisegmap_tblock_sizze_46686", "add_next_partition_doublezisegmap_tblock_sizze_46788", "add_next_partition_doublezisegmap_tblock_sizze_46804", "add_next_partition_doublezisegmap_tblock_sizze_46812", "add_next_partition_doublezisegmap_tblock_sizze_46889", "add_next_partition_doublezisegred_num_tblocks_46115", "add_next_partition_doublezisegred_num_tblocks_46591", "add_next_partition_doublezisegred_tblock_sizze_46113", "add_next_partition_doublezisegred_tblock_sizze_46589", "add_next_partition_doublezisegscan_num_tblocks_45773", "add_next_partition_doublezisegscan_num_tblocks_46230", "add_next_partition_doublezisegscan_num_tblocks_46481", "add_next_partition_doublezisegscan_num_tblocks_46780", "add_next_partition_doublezisegscan_num_tblocks_46796", "add_next_partition_doublezisegscan_tblock_sizze_45771", "add_next_partition_doublezisegscan_tblock_sizze_46228", "add_next_partition_doublezisegscan_tblock_sizze_46479", "add_next_partition_doublezisegscan_tblock_sizze_46778", "add_next_partition_doublezisegscan_tblock_sizze_46794", "add_next_partition_doublezisuff_intra_par_2", "add_next_partition_doublezisuff_outer_par_1", "add_next_partition_doublezisuff_outer_par_3", "add_next_partition_doublezisuff_outer_screma_0", "add_next_partition_doublezitile_sizze_49825", "add_next_partition_doublezitile_sizze_50037", "builtinzhiota_i64zitblock_sizze_54734", "builtinzhreplicate_boolzitblock_sizze_55483", "builtinzhreplicate_f64zitblock_sizze_54810", "builtinzhreplicate_i32zitblock_sizze_54636", "builtinzhreplicate_i64zitblock_sizze_54551", "builtinzhreplicate_i8zitblock_sizze_54601", "do_DBSCAN_doublezisegmap_num_tblocks_46959", "do_DBSCAN_doublezisegmap_num_tblocks_46975", "do_DBSCAN_doublezisegmap_num_tblocks_46991", "do_DBSCAN_doublezisegmap_num_tblocks_47007", "do_DBSCAN_doublezisegmap_num_tblocks_47015", "do_DBSCAN_doublezisegmap_num_tblocks_47055", "do_DBSCAN_doublezisegmap_num_tblocks_47411", "do_DBSCAN_doublezisegmap_num_tblocks_47824", "do_DBSCAN_doublezisegmap_num_tblocks_48454", "do_DBSCAN_doublezisegmap_num_tblocks_48462", "do_DBSCAN_doublezisegmap_num_tblocks_48914", "do_DBSCAN_doublezisegmap_tblock_sizze_46957", "do_DBSCAN_doublezisegmap_tblock_sizze_46973", "do_DBSCAN_doublezisegmap_tblock_sizze_46989", "do_DBSCAN_doublezisegmap_tblock_sizze_47005", "do_DBSCAN_doublezisegmap_tblock_sizze_47013", "do_DBSCAN_doublezisegmap_tblock_sizze_47021", "do_DBSCAN_doublezisegmap_tblock_sizze_47053", "do_DBSCAN_doublezisegmap_tblock_sizze_47228", "do_DBSCAN_doublezisegmap_tblock_sizze_47329", "do_DBSCAN_doublezisegmap_tblock_sizze_47355", "do_DBSCAN_doublezisegmap_tblock_sizze_47391", "do_DBSCAN_doublezisegmap_tblock_sizze_47409", "do_DBSCAN_doublezisegmap_tblock_sizze_47822", "do_DBSCAN_doublezisegmap_tblock_sizze_48136", "do_DBSCAN_doublezisegmap_tblock_sizze_48362", "do_DBSCAN_doublezisegmap_tblock_sizze_48452", "do_DBSCAN_doublezisegmap_tblock_sizze_48460", "do_DBSCAN_doublezisegmap_tblock_sizze_48912", "do_DBSCAN_doublezisegmap_tblock_sizze_49100", "do_DBSCAN_doublezisegred_num_tblocks_47178", "do_DBSCAN_doublezisegred_num_tblocks_47311", "do_DBSCAN_doublezisegred_num_tblocks_48306", "do_DBSCAN_doublezisegred_num_tblocks_49044", "do_DBSCAN_doublezisegred_num_tblocks_49190", "do_DBSCAN_doublezisegred_num_tblocks_49200", "do_DBSCAN_doublezisegred_tblock_sizze_47176", "do_DBSCAN_doublezisegred_tblock_sizze_47309", "do_DBSCAN_doublezisegred_tblock_sizze_48304", "do_DBSCAN_doublezisegred_tblock_sizze_49042", "do_DBSCAN_doublezisegred_tblock_sizze_49188", "do_DBSCAN_doublezisegred_tblock_sizze_49198", "do_DBSCAN_doublezisegscan_num_tblocks_46949", "do_DBSCAN_doublezisegscan_num_tblocks_46965", "do_DBSCAN_doublezisegscan_num_tblocks_46981", "do_DBSCAN_doublezisegscan_num_tblocks_46997", "do_DBSCAN_doublezisegscan_num_tblocks_47045", "do_DBSCAN_doublezisegscan_num_tblocks_47061", "do_DBSCAN_doublezisegscan_num_tblocks_47321", "do_DBSCAN_doublezisegscan_num_tblocks_47448", "do_DBSCAN_doublezisegscan_num_tblocks_47708", "do_DBSCAN_doublezisegscan_num_tblocks_47832", "do_DBSCAN_doublezisegscan_num_tblocks_48039", "do_DBSCAN_doublezisegscan_num_tblocks_48470", "do_DBSCAN_doublezisegscan_num_tblocks_48780", "do_DBSCAN_doublezisegscan_tblock_sizze_46947", "do_DBSCAN_doublezisegscan_tblock_sizze_46963", "do_DBSCAN_doublezisegscan_tblock_sizze_46979", "do_DBSCAN_doublezisegscan_tblock_sizze_46995", "do_DBSCAN_doublezisegscan_tblock_sizze_47043", "do_DBSCAN_doublezisegscan_tblock_sizze_47059", "do_DBSCAN_doublezisegscan_tblock_sizze_47319", "do_DBSCAN_doublezisegscan_tblock_sizze_47446", "do_DBSCAN_doublezisegscan_tblock_sizze_47706", "do_DBSCAN_doublezisegscan_tblock_sizze_47830", "do_DBSCAN_doublezisegscan_tblock_sizze_48037", "do_DBSCAN_doublezisegscan_tblock_sizze_48468", "do_DBSCAN_doublezisegscan_tblock_sizze_48778", "do_DBSCAN_doublezisuff_outer_par_0", "do_DBSCAN_doublezisuff_outer_par_2", "do_DBSCAN_doublezisuff_outer_par_4", "do_DBSCAN_doublezisuff_outer_par_5", "do_DBSCAN_doublezisuff_outer_par_7", "do_DBSCAN_doublezisuff_outer_par_8", "do_DBSCAN_doublezisuff_outer_screma_1", "do_DBSCAN_doublezisuff_outer_screma_3", "do_DBSCAN_doublezisuff_outer_screma_6", "do_DBSCAN_doublezitile_sizze_49825", "do_DBSCAN_doublezitile_sizze_50205", "do_DBSCAN_doublezitile_sizze_50560", "do_DBSCAN_doublezitile_sizze_50915", "do_DBSCAN_doublezitile_sizze_51194", "do_DBSCAN_doublezitile_sizze_51473", "do_DBSCAN_doublezitile_sizze_51882", "do_DBSCAN_doublezitile_sizze_52264", "do_DBSCAN_doublezitile_sizze_52646", "get_num_neighbours_against_10103zisegmap_tblock_sizze_49363", "get_num_neighbours_against_10103zisegred_num_tblocks_49315", "get_num_neighbours_against_10103zisegred_tblock_sizze_49313", "get_num_neighbours_against_10103zisuff_outer_par_0", "get_num_neighbours_against_10103zitile_sizze_49825", "get_num_neighbours_against_10106zisegmap_tblock_sizze_49597", "get_num_neighbours_against_10106zisegred_num_tblocks_49549", "get_num_neighbours_against_10106zisegred_tblock_sizze_49547", "get_num_neighbours_against_10106zisuff_outer_par_0", "get_num_neighbours_against_10106zitile_sizze_49825", "make_collisions_compact_doublezisegmap_num_tblocks_45660", "make_collisions_compact_doublezisegmap_tblock_sizze_45658", "make_collisions_compact_doublezisegscan_num_tblocks_45650", "make_collisions_compact_doublezisegscan_tblock_sizze_45648", "make_collisions_compact_doublezisuff_outer_par_0", "make_collisions_compact_doublezitile_sizze_49825", "make_collisions_compact_doublezitile_sizze_50094", "next_partition_to_read_doublezisegmap_num_tblocks_45497", "next_partition_to_read_doublezisegmap_tblock_sizze_45495", "next_partition_to_read_doublezisegred_num_tblocks_45477", "next_partition_to_read_doublezisegred_tblock_sizze_45475", "next_partition_to_read_doublezisegscan_num_tblocks_45487", "next_partition_to_read_doublezisegscan_tblock_sizze_45485", "rectify_partition_ids_doublezisuff_outer_par_0", "rectify_partition_ids_doublezitile_sizze_49825", "rectify_partition_ids_doublezitile_sizze_50069", NULL};
static const char *tuning_param_classes[] = {"grid_size", "grid_size", "grid_size", "grid_size", "thread_block_size", "thread_block_size", "thread_block_size", "thread_block_size", "thread_block_size", "thread_block_size", "thread_block_size", "thread_block_size", "thread_block_size", "grid_size", "grid_size", "thread_block_size", "thread_block_size", "grid_size", "grid_size", "grid_size", "grid_size", "grid_size", "thread_block_size", "thread_block_size", "thread_block_size", "thread_block_size", "thread_block_size", "threshold(32, !add_next_partition_double.suff_outer_par_1 !add_next_partition_double.suff_outer_screma_0)", "threshold(def, !add_next_partition_double.suff_outer_screma_0)", "threshold(def, )", "threshold(def, )", "thread_block_size", "thread_block_size", "thread_block_size", "thread_block_size", "thread_block_size", "thread_block_size", "thread_block_size", "thread_block_size", "grid_size", "grid_size", "grid_size", "grid_size", "grid_size", "grid_size", "grid_size", "grid_size", "grid_size", "grid_size", "grid_size", "thread_block_size", "thread_block_size", "thread_block_size", "thread_block_size", "thread_block_size", "thread_block_size", "thread_block_size", "thread_block_size", "thread_block_size", "thread_block_size", "thread_block_size", "thread_block_size", "thread_block_size", "thread_block_size", "thread_block_size", "thread_block_size", "thread_block_size", "thread_block_size", "thread_block_size", "grid_size", "grid_size", "grid_size", "grid_size", "grid_size", "grid_size", "thread_block_size", "thread_block_size", "thread_block_size", "thread_block_size", "thread_block_size", "thread_block_size", "grid_size", "grid_size", "grid_size", "grid_size", "grid_size", "grid_size", "grid_size", "grid_size", "grid_size", "grid_size", "grid_size", "grid_size", "grid_size", "thread_block_size", "thread_block_size", "thread_block_size", "thread_block_size", "thread_block_size", "thread_block_size", "thread_block_size", "thread_block_size", "thread_block_size", "thread_block_size", "thread_block_size", "thread_block_size", "thread_block_size", "threshold(def, )", "threshold(def, !do_DBSCAN_double.suff_outer_screma_1)", "threshold(def, !do_DBSCAN_double.suff_outer_screma_3)", "threshold(def, )", "threshold(def, !do_DBSCAN_double.suff_outer_screma_6)", "threshold(def, )", "threshold(def, )", "threshold(def, )", "threshold(def, )", "thread_block_size", "thread_block_size", "thread_block_size", "thread_block_size", "thread_block_size", "thread_block_size", "thread_block_size", "thread_block_size", "thread_block_size", "thread_block_size", "grid_size", "thread_block_size", "threshold(def, )", "thread_block_size", "thread_block_size", "grid_size", "thread_block_size", "threshold(def, )", "thread_block_size", "grid_size", "thread_block_size", "grid_size", "thread_block_size", "threshold(def, )", "thread_block_size", "thread_block_size", "grid_size", "thread_block_size", "grid_size", "thread_block_size", "grid_size", "thread_block_size", "threshold(def, )", "thread_block_size", "thread_block_size", NULL};
static int64_t tuning_param_defaults[] = {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 32, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0};
static const int max_failure_args = 2;
static const int f64_required = 1;
static const char *gpu_program[] = {"#define FUTHARK_CUDA\n// start of prelude.cu\n\n#define SCALAR_FUN_ATTR __device__ static inline\n#define FUTHARK_FUN_ATTR __device__ static\n#define FUTHARK_F64_ENABLED\n\ntypedef char int8_t;\ntypedef short int16_t;\ntypedef int int32_t;\ntypedef long long int64_t;\ntypedef unsigned char uint8_t;\ntypedef unsigned short uint16_t;\ntypedef unsigned int uint32_t;\ntypedef unsigned long long uint64_t;\n\n#define __global\n#define __local\n#define __private\n#define __constant\n#define __write_only\n#define __read_only\n\nstatic inline __device__ int get_tblock_id(int d) {\n  switch (d) {\n  case 0: return blockIdx.x;\n  case 1: return blockIdx.y;\n  case 2: return blockIdx.z;\n  default: return 0;\n  }\n}\n\nstatic inline __device__ int get_num_tblocks(int d) {\n  switch(d) {\n  case 0: return gridDim.x;\n  case 1: return gridDim.y;\n  case 2: return gridDim.z;\n  default: return 0;\n  }\n}\n\nstatic inline __device__ int get_global_id(int d) {\n  switch (d) {\n    case 0: return threadIdx.x + blockIdx.x * blockDim.x;\n    case 1: return threadIdx.y + blockIdx.y * blockDim.y;\n    case 2: return threadIdx.z + blockIdx.z * blockDim.z;\n    default: return 0;\n  }\n}\n\nstatic inline __device__ int get_local_id(int d) {\n  switch (d) {\n    case 0: return threadIdx.x;\n    case 1: return threadIdx.y;\n    case 2: return threadIdx.z;\n    default: return 0;\n  }\n}\n\nstatic inline __device__ int get_local_size(int d) {\n  switch (d) {\n    case 0: return blockDim.x;\n    case 1: return blockDim.y;\n    case 2: return blockDim.z;\n    default: return 0;\n  }\n}\n\nstatic inline __device__ int get_global_size(int d) {\n  switch (d) {\n    case 0: return gridDim.x * blockDim.x;\n    case 1: return gridDim.y * blockDim.y;\n    case 2: return gridDim.z * blockDim.z;\n    default: return 0;\n  }\n}\n\n\n#define CLK_LOCAL_MEM_FENCE 1\n#define CLK_GLOBAL_MEM_FENCE 2\nstatic inline __device__ void barrier(int x) {\n  __syncthreads();\n}\nstatic inline __device__ void mem_fence_local() {\n  __threadfence_block();\n}\nstatic inline __device__ void mem_fence_global", "() {\n  __threadfence();\n}\n\nstatic inline __device__ void barrier_local() {\n  __syncthreads();\n}\n\n#define NAN (0.0/0.0)\n#define INFINITY (1.0/0.0)\nextern volatile __shared__ unsigned char shared_mem[];\n\n#define SHARED_MEM_PARAM\n#define FUTHARK_KERNEL extern \"C\" __global__ __launch_bounds__(MAX_THREADS_PER_BLOCK)\n#define FUTHARK_KERNEL_SIZED(a,b,c) extern \"C\" __global__ __launch_bounds__(a*b*c)\n\n// End of prelude.cu\n// Start of half.h.\n\n// Conversion functions are from http://half.sourceforge.net/, but\n// translated to C.\n//\n// Copyright (c) 2012-2021 Christian Rau\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\n#ifndef __OPENCL_VERSION__\n#define __constant\n#endif\n\n__constant static const uint16_t base_table[512] = {\n  0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,\n  0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0", "000, 0x0000,\n  0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,\n  0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,\n  0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,\n  0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,\n  0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0001, 0x0002, 0x0004, 0x0008, 0x0010, 0x0020, 0x0040, 0x0080, 0x0100,\n  0x0200, 0x0400, 0x0800, 0x0C00, 0x1000, 0x1400, 0x1800, 0x1C00, 0x2000, 0x2400, 0x2800, 0x2C00, 0x3000, 0x3400, 0x3800, 0x3C00,\n  0x4000, 0x4400, 0x4800, 0x4C00, 0x5000, 0x5400, 0x5800, 0x5C00, 0x6000, 0x6400, 0x6800, 0x6C00, 0x7000, 0x7400, 0x7800, 0x7C00,\n  0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00,\n  0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00,\n  0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00,\n  0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00,\n  0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00,\n  0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00,\n  0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00,\n  0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000,\n  0x8000, 0x8000, 0x8000, 0x8000, 0x8",
                                    "000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000,\n  0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000,\n  0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000,\n  0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000,\n  0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000,\n  0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8001, 0x8002, 0x8004, 0x8008, 0x8010, 0x8020, 0x8040, 0x8080, 0x8100,\n  0x8200, 0x8400, 0x8800, 0x8C00, 0x9000, 0x9400, 0x9800, 0x9C00, 0xA000, 0xA400, 0xA800, 0xAC00, 0xB000, 0xB400, 0xB800, 0xBC00,\n  0xC000, 0xC400, 0xC800, 0xCC00, 0xD000, 0xD400, 0xD800, 0xDC00, 0xE000, 0xE400, 0xE800, 0xEC00, 0xF000, 0xF400, 0xF800, 0xFC00,\n  0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00,\n  0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00,\n  0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00,\n  0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00,\n  0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00,\n  0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00,\n  0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00 };\n\n__constant static const unsigned char shift_table[512] = {\n  24, 24, 24, 24, 24, 24,", " 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24,\n  24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24,\n  24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24,\n  24, 24, 24, 24, 24, 24, 24, 23, 22, 21, 20, 19, 18, 17, 16, 15, 14, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13,\n  13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24,\n  24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24,\n  24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24,\n  24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 13,\n  24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24,\n  24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24,\n  24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24,\n  24, 24, 24, 24, 24, 24, 24, 23, 22, 21, 20, 19, 18, 17, 16, 15, 14, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13,\n  13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24,\n  24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24,\n  24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24,\n  24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 2", "4, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 13 };\n\n__constant static const uint32_t mantissa_table[2048] = {\n  0x00000000, 0x33800000, 0x34000000, 0x34400000, 0x34800000, 0x34A00000, 0x34C00000, 0x34E00000, 0x35000000, 0x35100000, 0x35200000, 0x35300000, 0x35400000, 0x35500000, 0x35600000, 0x35700000,\n  0x35800000, 0x35880000, 0x35900000, 0x35980000, 0x35A00000, 0x35A80000, 0x35B00000, 0x35B80000, 0x35C00000, 0x35C80000, 0x35D00000, 0x35D80000, 0x35E00000, 0x35E80000, 0x35F00000, 0x35F80000,\n  0x36000000, 0x36040000, 0x36080000, 0x360C0000, 0x36100000, 0x36140000, 0x36180000, 0x361C0000, 0x36200000, 0x36240000, 0x36280000, 0x362C0000, 0x36300000, 0x36340000, 0x36380000, 0x363C0000,\n  0x36400000, 0x36440000, 0x36480000, 0x364C0000, 0x36500000, 0x36540000, 0x36580000, 0x365C0000, 0x36600000, 0x36640000, 0x36680000, 0x366C0000, 0x36700000, 0x36740000, 0x36780000, 0x367C0000,\n  0x36800000, 0x36820000, 0x36840000, 0x36860000, 0x36880000, 0x368A0000, 0x368C0000, 0x368E0000, 0x36900000, 0x36920000, 0x36940000, 0x36960000, 0x36980000, 0x369A0000, 0x369C0000, 0x369E0000,\n  0x36A00000, 0x36A20000, 0x36A40000, 0x36A60000, 0x36A80000, 0x36AA0000, 0x36AC0000, 0x36AE0000, 0x36B00000, 0x36B20000, 0x36B40000, 0x36B60000, 0x36B80000, 0x36BA0000, 0x36BC0000, 0x36BE0000,\n  0x36C00000, 0x36C20000, 0x36C40000, 0x36C60000, 0x36C80000, 0x36CA0000, 0x36CC0000, 0x36CE0000, 0x36D00000, 0x36D20000, 0x36D40000, 0x36D60000, 0x36D80000, 0x36DA0000, 0x36DC0000, 0x36DE0000,\n  0x36E00000, 0x36E20000, 0x36E40000, 0x36E60000, 0x36E80000, 0x36EA0000, 0x36EC0000, 0x36EE0000, 0x36F00000, 0x36F20000, 0x36F40000, 0x36F60000, 0x36F80000, 0x36FA0000, 0x36FC0000, 0x36FE0000,\n  0x37000000, 0x37010000, 0x37020000, 0x37030000, 0x37040000, 0x37050000, 0x37060000, 0x37070000, 0x37080000, 0x37090000, 0x370A0000, 0x370B0000, 0x370C0000, 0x370D0000, 0x370E0000, 0x370F0000,\n  0x37100000, 0x37110000, 0x37120000, 0x37130000, 0x37140000, 0x37150000, 0x37160000, 0x37170000, 0x37180000, 0x37190000, 0x371A0000, 0x37",
                                    "1B0000, 0x371C0000, 0x371D0000, 0x371E0000, 0x371F0000,\n  0x37200000, 0x37210000, 0x37220000, 0x37230000, 0x37240000, 0x37250000, 0x37260000, 0x37270000, 0x37280000, 0x37290000, 0x372A0000, 0x372B0000, 0x372C0000, 0x372D0000, 0x372E0000, 0x372F0000,\n  0x37300000, 0x37310000, 0x37320000, 0x37330000, 0x37340000, 0x37350000, 0x37360000, 0x37370000, 0x37380000, 0x37390000, 0x373A0000, 0x373B0000, 0x373C0000, 0x373D0000, 0x373E0000, 0x373F0000,\n  0x37400000, 0x37410000, 0x37420000, 0x37430000, 0x37440000, 0x37450000, 0x37460000, 0x37470000, 0x37480000, 0x37490000, 0x374A0000, 0x374B0000, 0x374C0000, 0x374D0000, 0x374E0000, 0x374F0000,\n  0x37500000, 0x37510000, 0x37520000, 0x37530000, 0x37540000, 0x37550000, 0x37560000, 0x37570000, 0x37580000, 0x37590000, 0x375A0000, 0x375B0000, 0x375C0000, 0x375D0000, 0x375E0000, 0x375F0000,\n  0x37600000, 0x37610000, 0x37620000, 0x37630000, 0x37640000, 0x37650000, 0x37660000, 0x37670000, 0x37680000, 0x37690000, 0x376A0000, 0x376B0000, 0x376C0000, 0x376D0000, 0x376E0000, 0x376F0000,\n  0x37700000, 0x37710000, 0x37720000, 0x37730000, 0x37740000, 0x37750000, 0x37760000, 0x37770000, 0x37780000, 0x37790000, 0x377A0000, 0x377B0000, 0x377C0000, 0x377D0000, 0x377E0000, 0x377F0000,\n  0x37800000, 0x37808000, 0x37810000, 0x37818000, 0x37820000, 0x37828000, 0x37830000, 0x37838000, 0x37840000, 0x37848000, 0x37850000, 0x37858000, 0x37860000, 0x37868000, 0x37870000, 0x37878000,\n  0x37880000, 0x37888000, 0x37890000, 0x37898000, 0x378A0000, 0x378A8000, 0x378B0000, 0x378B8000, 0x378C0000, 0x378C8000, 0x378D0000, 0x378D8000, 0x378E0000, 0x378E8000, 0x378F0000, 0x378F8000,\n  0x37900000, 0x37908000, 0x37910000, 0x37918000, 0x37920000, 0x37928000, 0x37930000, 0x37938000, 0x37940000, 0x37948000, 0x37950000, 0x37958000, 0x37960000, 0x37968000, 0x37970000, 0x37978000,\n  0x37980000, 0x37988000, 0x37990000, 0x37998000, 0x379A0000, 0x379A8000, 0x379B0000, 0x379B8000, 0x379C0000, 0x379C8000, 0x379D0000, 0x379D8000, 0x379E0000, 0x379E8000, 0x379F0000, 0x379F8000,\n  0x", "37A00000, 0x37A08000, 0x37A10000, 0x37A18000, 0x37A20000, 0x37A28000, 0x37A30000, 0x37A38000, 0x37A40000, 0x37A48000, 0x37A50000, 0x37A58000, 0x37A60000, 0x37A68000, 0x37A70000, 0x37A78000,\n  0x37A80000, 0x37A88000, 0x37A90000, 0x37A98000, 0x37AA0000, 0x37AA8000, 0x37AB0000, 0x37AB8000, 0x37AC0000, 0x37AC8000, 0x37AD0000, 0x37AD8000, 0x37AE0000, 0x37AE8000, 0x37AF0000, 0x37AF8000,\n  0x37B00000, 0x37B08000, 0x37B10000, 0x37B18000, 0x37B20000, 0x37B28000, 0x37B30000, 0x37B38000, 0x37B40000, 0x37B48000, 0x37B50000, 0x37B58000, 0x37B60000, 0x37B68000, 0x37B70000, 0x37B78000,\n  0x37B80000, 0x37B88000, 0x37B90000, 0x37B98000, 0x37BA0000, 0x37BA8000, 0x37BB0000, 0x37BB8000, 0x37BC0000, 0x37BC8000, 0x37BD0000, 0x37BD8000, 0x37BE0000, 0x37BE8000, 0x37BF0000, 0x37BF8000,\n  0x37C00000, 0x37C08000, 0x37C10000, 0x37C18000, 0x37C20000, 0x37C28000, 0x37C30000, 0x37C38000, 0x37C40000, 0x37C48000, 0x37C50000, 0x37C58000, 0x37C60000, 0x37C68000, 0x37C70000, 0x37C78000,\n  0x37C80000, 0x37C88000, 0x37C90000, 0x37C98000, 0x37CA0000, 0x37CA8000, 0x37CB0000, 0x37CB8000, 0x37CC0000, 0x37CC8000, 0x37CD0000, 0x37CD8000, 0x37CE0000, 0x37CE8000, 0x37CF0000, 0x37CF8000,\n  0x37D00000, 0x37D08000, 0x37D10000, 0x37D18000, 0x37D20000, 0x37D28000, 0x37D30000, 0x37D38000, 0x37D40000, 0x37D48000, 0x37D50000, 0x37D58000, 0x37D60000, 0x37D68000, 0x37D70000, 0x37D78000,\n  0x37D80000, 0x37D88000, 0x37D90000, 0x37D98000, 0x37DA0000, 0x37DA8000, 0x37DB0000, 0x37DB8000, 0x37DC0000, 0x37DC8000, 0x37DD0000, 0x37DD8000, 0x37DE0000, 0x37DE8000, 0x37DF0000, 0x37DF8000,\n  0x37E00000, 0x37E08000, 0x37E10000, 0x37E18000, 0x37E20000, 0x37E28000, 0x37E30000, 0x37E38000, 0x37E40000, 0x37E48000, 0x37E50000, 0x37E58000, 0x37E60000, 0x37E68000, 0x37E70000, 0x37E78000,\n  0x37E80000, 0x37E88000, 0x37E90000, 0x37E98000, 0x37EA0000, 0x37EA8000, 0x37EB0000, 0x37EB8000, 0x37EC0000, 0x37EC8000, 0x37ED0000, 0x37ED8000, 0x37EE0000, 0x37EE8000, 0x37EF0000, 0x37EF8000,\n  0x37F00000, 0x37F08000, 0x37F10000, 0x37F18000, 0x37F20000, 0x", "37F28000, 0x37F30000, 0x37F38000, 0x37F40000, 0x37F48000, 0x37F50000, 0x37F58000, 0x37F60000, 0x37F68000, 0x37F70000, 0x37F78000,\n  0x37F80000, 0x37F88000, 0x37F90000, 0x37F98000, 0x37FA0000, 0x37FA8000, 0x37FB0000, 0x37FB8000, 0x37FC0000, 0x37FC8000, 0x37FD0000, 0x37FD8000, 0x37FE0000, 0x37FE8000, 0x37FF0000, 0x37FF8000,\n  0x38000000, 0x38004000, 0x38008000, 0x3800C000, 0x38010000, 0x38014000, 0x38018000, 0x3801C000, 0x38020000, 0x38024000, 0x38028000, 0x3802C000, 0x38030000, 0x38034000, 0x38038000, 0x3803C000,\n  0x38040000, 0x38044000, 0x38048000, 0x3804C000, 0x38050000, 0x38054000, 0x38058000, 0x3805C000, 0x38060000, 0x38064000, 0x38068000, 0x3806C000, 0x38070000, 0x38074000, 0x38078000, 0x3807C000,\n  0x38080000, 0x38084000, 0x38088000, 0x3808C000, 0x38090000, 0x38094000, 0x38098000, 0x3809C000, 0x380A0000, 0x380A4000, 0x380A8000, 0x380AC000, 0x380B0000, 0x380B4000, 0x380B8000, 0x380BC000,\n  0x380C0000, 0x380C4000, 0x380C8000, 0x380CC000, 0x380D0000, 0x380D4000, 0x380D8000, 0x380DC000, 0x380E0000, 0x380E4000, 0x380E8000, 0x380EC000, 0x380F0000, 0x380F4000, 0x380F8000, 0x380FC000,\n  0x38100000, 0x38104000, 0x38108000, 0x3810C000, 0x38110000, 0x38114000, 0x38118000, 0x3811C000, 0x38120000, 0x38124000, 0x38128000, 0x3812C000, 0x38130000, 0x38134000, 0x38138000, 0x3813C000,\n  0x38140000, 0x38144000, 0x38148000, 0x3814C000, 0x38150000, 0x38154000, 0x38158000, 0x3815C000, 0x38160000, 0x38164000, 0x38168000, 0x3816C000, 0x38170000, 0x38174000, 0x38178000, 0x3817C000,\n  0x38180000, 0x38184000, 0x38188000, 0x3818C000, 0x38190000, 0x38194000, 0x38198000, 0x3819C000, 0x381A0000, 0x381A4000, 0x381A8000, 0x381AC000, 0x381B0000, 0x381B4000, 0x381B8000, 0x381BC000,\n  0x381C0000, 0x381C4000, 0x381C8000, 0x381CC000, 0x381D0000, 0x381D4000, 0x381D8000, 0x381DC000, 0x381E0000, 0x381E4000, 0x381E8000, 0x381EC000, 0x381F0000, 0x381F4000, 0x381F8000, 0x381FC000,\n  0x38200000, 0x38204000, 0x38208000, 0x3820C000, 0x38210000, 0x38214000, 0x38218000, 0x3821C000, 0x38220000, 0x38224000, 0x",
                                    "38228000, 0x3822C000, 0x38230000, 0x38234000, 0x38238000, 0x3823C000,\n  0x38240000, 0x38244000, 0x38248000, 0x3824C000, 0x38250000, 0x38254000, 0x38258000, 0x3825C000, 0x38260000, 0x38264000, 0x38268000, 0x3826C000, 0x38270000, 0x38274000, 0x38278000, 0x3827C000,\n  0x38280000, 0x38284000, 0x38288000, 0x3828C000, 0x38290000, 0x38294000, 0x38298000, 0x3829C000, 0x382A0000, 0x382A4000, 0x382A8000, 0x382AC000, 0x382B0000, 0x382B4000, 0x382B8000, 0x382BC000,\n  0x382C0000, 0x382C4000, 0x382C8000, 0x382CC000, 0x382D0000, 0x382D4000, 0x382D8000, 0x382DC000, 0x382E0000, 0x382E4000, 0x382E8000, 0x382EC000, 0x382F0000, 0x382F4000, 0x382F8000, 0x382FC000,\n  0x38300000, 0x38304000, 0x38308000, 0x3830C000, 0x38310000, 0x38314000, 0x38318000, 0x3831C000, 0x38320000, 0x38324000, 0x38328000, 0x3832C000, 0x38330000, 0x38334000, 0x38338000, 0x3833C000,\n  0x38340000, 0x38344000, 0x38348000, 0x3834C000, 0x38350000, 0x38354000, 0x38358000, 0x3835C000, 0x38360000, 0x38364000, 0x38368000, 0x3836C000, 0x38370000, 0x38374000, 0x38378000, 0x3837C000,\n  0x38380000, 0x38384000, 0x38388000, 0x3838C000, 0x38390000, 0x38394000, 0x38398000, 0x3839C000, 0x383A0000, 0x383A4000, 0x383A8000, 0x383AC000, 0x383B0000, 0x383B4000, 0x383B8000, 0x383BC000,\n  0x383C0000, 0x383C4000, 0x383C8000, 0x383CC000, 0x383D0000, 0x383D4000, 0x383D8000, 0x383DC000, 0x383E0000, 0x383E4000, 0x383E8000, 0x383EC000, 0x383F0000, 0x383F4000, 0x383F8000, 0x383FC000,\n  0x38400000, 0x38404000, 0x38408000, 0x3840C000, 0x38410000, 0x38414000, 0x38418000, 0x3841C000, 0x38420000, 0x38424000, 0x38428000, 0x3842C000, 0x38430000, 0x38434000, 0x38438000, 0x3843C000,\n  0x38440000, 0x38444000, 0x38448000, 0x3844C000, 0x38450000, 0x38454000, 0x38458000, 0x3845C000, 0x38460000, 0x38464000, 0x38468000, 0x3846C000, 0x38470000, 0x38474000, 0x38478000, 0x3847C000,\n  0x38480000, 0x38484000, 0x38488000, 0x3848C000, 0x38490000, 0x38494000, 0x38498000, 0x3849C000, 0x384A0000, 0x384A4000, 0x384A8000, 0x384AC000, 0x384B0000, 0x384B4000, 0x384B8000, 0x", "384BC000,\n  0x384C0000, 0x384C4000, 0x384C8000, 0x384CC000, 0x384D0000, 0x384D4000, 0x384D8000, 0x384DC000, 0x384E0000, 0x384E4000, 0x384E8000, 0x384EC000, 0x384F0000, 0x384F4000, 0x384F8000, 0x384FC000,\n  0x38500000, 0x38504000, 0x38508000, 0x3850C000, 0x38510000, 0x38514000, 0x38518000, 0x3851C000, 0x38520000, 0x38524000, 0x38528000, 0x3852C000, 0x38530000, 0x38534000, 0x38538000, 0x3853C000,\n  0x38540000, 0x38544000, 0x38548000, 0x3854C000, 0x38550000, 0x38554000, 0x38558000, 0x3855C000, 0x38560000, 0x38564000, 0x38568000, 0x3856C000, 0x38570000, 0x38574000, 0x38578000, 0x3857C000,\n  0x38580000, 0x38584000, 0x38588000, 0x3858C000, 0x38590000, 0x38594000, 0x38598000, 0x3859C000, 0x385A0000, 0x385A4000, 0x385A8000, 0x385AC000, 0x385B0000, 0x385B4000, 0x385B8000, 0x385BC000,\n  0x385C0000, 0x385C4000, 0x385C8000, 0x385CC000, 0x385D0000, 0x385D4000, 0x385D8000, 0x385DC000, 0x385E0000, 0x385E4000, 0x385E8000, 0x385EC000, 0x385F0000, 0x385F4000, 0x385F8000, 0x385FC000,\n  0x38600000, 0x38604000, 0x38608000, 0x3860C000, 0x38610000, 0x38614000, 0x38618000, 0x3861C000, 0x38620000, 0x38624000, 0x38628000, 0x3862C000, 0x38630000, 0x38634000, 0x38638000, 0x3863C000,\n  0x38640000, 0x38644000, 0x38648000, 0x3864C000, 0x38650000, 0x38654000, 0x38658000, 0x3865C000, 0x38660000, 0x38664000, 0x38668000, 0x3866C000, 0x38670000, 0x38674000, 0x38678000, 0x3867C000,\n  0x38680000, 0x38684000, 0x38688000, 0x3868C000, 0x38690000, 0x38694000, 0x38698000, 0x3869C000, 0x386A0000, 0x386A4000, 0x386A8000, 0x386AC000, 0x386B0000, 0x386B4000, 0x386B8000, 0x386BC000,\n  0x386C0000, 0x386C4000, 0x386C8000, 0x386CC000, 0x386D0000, 0x386D4000, 0x386D8000, 0x386DC000, 0x386E0000, 0x386E4000, 0x386E8000, 0x386EC000, 0x386F0000, 0x386F4000, 0x386F8000, 0x386FC000,\n  0x38700000, 0x38704000, 0x38708000, 0x3870C000, 0x38710000, 0x38714000, 0x38718000, 0x3871C000, 0x38720000, 0x38724000, 0x38728000, 0x3872C000, 0x38730000, 0x38734000, 0x38738000, 0x3873C000,\n  0x38740000, 0x38744000, 0x38748000, 0x3874C000, ", "0x38750000, 0x38754000, 0x38758000, 0x3875C000, 0x38760000, 0x38764000, 0x38768000, 0x3876C000, 0x38770000, 0x38774000, 0x38778000, 0x3877C000,\n  0x38780000, 0x38784000, 0x38788000, 0x3878C000, 0x38790000, 0x38794000, 0x38798000, 0x3879C000, 0x387A0000, 0x387A4000, 0x387A8000, 0x387AC000, 0x387B0000, 0x387B4000, 0x387B8000, 0x387BC000,\n  0x387C0000, 0x387C4000, 0x387C8000, 0x387CC000, 0x387D0000, 0x387D4000, 0x387D8000, 0x387DC000, 0x387E0000, 0x387E4000, 0x387E8000, 0x387EC000, 0x387F0000, 0x387F4000, 0x387F8000, 0x387FC000,\n  0x38000000, 0x38002000, 0x38004000, 0x38006000, 0x38008000, 0x3800A000, 0x3800C000, 0x3800E000, 0x38010000, 0x38012000, 0x38014000, 0x38016000, 0x38018000, 0x3801A000, 0x3801C000, 0x3801E000,\n  0x38020000, 0x38022000, 0x38024000, 0x38026000, 0x38028000, 0x3802A000, 0x3802C000, 0x3802E000, 0x38030000, 0x38032000, 0x38034000, 0x38036000, 0x38038000, 0x3803A000, 0x3803C000, 0x3803E000,\n  0x38040000, 0x38042000, 0x38044000, 0x38046000, 0x38048000, 0x3804A000, 0x3804C000, 0x3804E000, 0x38050000, 0x38052000, 0x38054000, 0x38056000, 0x38058000, 0x3805A000, 0x3805C000, 0x3805E000,\n  0x38060000, 0x38062000, 0x38064000, 0x38066000, 0x38068000, 0x3806A000, 0x3806C000, 0x3806E000, 0x38070000, 0x38072000, 0x38074000, 0x38076000, 0x38078000, 0x3807A000, 0x3807C000, 0x3807E000,\n  0x38080000, 0x38082000, 0x38084000, 0x38086000, 0x38088000, 0x3808A000, 0x3808C000, 0x3808E000, 0x38090000, 0x38092000, 0x38094000, 0x38096000, 0x38098000, 0x3809A000, 0x3809C000, 0x3809E000,\n  0x380A0000, 0x380A2000, 0x380A4000, 0x380A6000, 0x380A8000, 0x380AA000, 0x380AC000, 0x380AE000, 0x380B0000, 0x380B2000, 0x380B4000, 0x380B6000, 0x380B8000, 0x380BA000, 0x380BC000, 0x380BE000,\n  0x380C0000, 0x380C2000, 0x380C4000, 0x380C6000, 0x380C8000, 0x380CA000, 0x380CC000, 0x380CE000, 0x380D0000, 0x380D2000, 0x380D4000, 0x380D6000, 0x380D8000, 0x380DA000, 0x380DC000, 0x380DE000,\n  0x380E0000, 0x380E2000, 0x380E4000, 0x380E6000, 0x380E8000, 0x380EA000, 0x380EC000, 0x380EE000, 0x380F0000, ",
                                    "0x380F2000, 0x380F4000, 0x380F6000, 0x380F8000, 0x380FA000, 0x380FC000, 0x380FE000,\n  0x38100000, 0x38102000, 0x38104000, 0x38106000, 0x38108000, 0x3810A000, 0x3810C000, 0x3810E000, 0x38110000, 0x38112000, 0x38114000, 0x38116000, 0x38118000, 0x3811A000, 0x3811C000, 0x3811E000,\n  0x38120000, 0x38122000, 0x38124000, 0x38126000, 0x38128000, 0x3812A000, 0x3812C000, 0x3812E000, 0x38130000, 0x38132000, 0x38134000, 0x38136000, 0x38138000, 0x3813A000, 0x3813C000, 0x3813E000,\n  0x38140000, 0x38142000, 0x38144000, 0x38146000, 0x38148000, 0x3814A000, 0x3814C000, 0x3814E000, 0x38150000, 0x38152000, 0x38154000, 0x38156000, 0x38158000, 0x3815A000, 0x3815C000, 0x3815E000,\n  0x38160000, 0x38162000, 0x38164000, 0x38166000, 0x38168000, 0x3816A000, 0x3816C000, 0x3816E000, 0x38170000, 0x38172000, 0x38174000, 0x38176000, 0x38178000, 0x3817A000, 0x3817C000, 0x3817E000,\n  0x38180000, 0x38182000, 0x38184000, 0x38186000, 0x38188000, 0x3818A000, 0x3818C000, 0x3818E000, 0x38190000, 0x38192000, 0x38194000, 0x38196000, 0x38198000, 0x3819A000, 0x3819C000, 0x3819E000,\n  0x381A0000, 0x381A2000, 0x381A4000, 0x381A6000, 0x381A8000, 0x381AA000, 0x381AC000, 0x381AE000, 0x381B0000, 0x381B2000, 0x381B4000, 0x381B6000, 0x381B8000, 0x381BA000, 0x381BC000, 0x381BE000,\n  0x381C0000, 0x381C2000, 0x381C4000, 0x381C6000, 0x381C8000, 0x381CA000, 0x381CC000, 0x381CE000, 0x381D0000, 0x381D2000, 0x381D4000, 0x381D6000, 0x381D8000, 0x381DA000, 0x381DC000, 0x381DE000,\n  0x381E0000, 0x381E2000, 0x381E4000, 0x381E6000, 0x381E8000, 0x381EA000, 0x381EC000, 0x381EE000, 0x381F0000, 0x381F2000, 0x381F4000, 0x381F6000, 0x381F8000, 0x381FA000, 0x381FC000, 0x381FE000,\n  0x38200000, 0x38202000, 0x38204000, 0x38206000, 0x38208000, 0x3820A000, 0x3820C000, 0x3820E000, 0x38210000, 0x38212000, 0x38214000, 0x38216000, 0x38218000, 0x3821A000, 0x3821C000, 0x3821E000,\n  0x38220000, 0x38222000, 0x38224000, 0x38226000, 0x38228000, 0x3822A000, 0x3822C000, 0x3822E000, 0x38230000, 0x38232000, 0x38234000, 0x38236000, 0x38238000, 0x3823A000, ", "0x3823C000, 0x3823E000,\n  0x38240000, 0x38242000, 0x38244000, 0x38246000, 0x38248000, 0x3824A000, 0x3824C000, 0x3824E000, 0x38250000, 0x38252000, 0x38254000, 0x38256000, 0x38258000, 0x3825A000, 0x3825C000, 0x3825E000,\n  0x38260000, 0x38262000, 0x38264000, 0x38266000, 0x38268000, 0x3826A000, 0x3826C000, 0x3826E000, 0x38270000, 0x38272000, 0x38274000, 0x38276000, 0x38278000, 0x3827A000, 0x3827C000, 0x3827E000,\n  0x38280000, 0x38282000, 0x38284000, 0x38286000, 0x38288000, 0x3828A000, 0x3828C000, 0x3828E000, 0x38290000, 0x38292000, 0x38294000, 0x38296000, 0x38298000, 0x3829A000, 0x3829C000, 0x3829E000,\n  0x382A0000, 0x382A2000, 0x382A4000, 0x382A6000, 0x382A8000, 0x382AA000, 0x382AC000, 0x382AE000, 0x382B0000, 0x382B2000, 0x382B4000, 0x382B6000, 0x382B8000, 0x382BA000, 0x382BC000, 0x382BE000,\n  0x382C0000, 0x382C2000, 0x382C4000, 0x382C6000, 0x382C8000, 0x382CA000, 0x382CC000, 0x382CE000, 0x382D0000, 0x382D2000, 0x382D4000, 0x382D6000, 0x382D8000, 0x382DA000, 0x382DC000, 0x382DE000,\n  0x382E0000, 0x382E2000, 0x382E4000, 0x382E6000, 0x382E8000, 0x382EA000, 0x382EC000, 0x382EE000, 0x382F0000, 0x382F2000, 0x382F4000, 0x382F6000, 0x382F8000, 0x382FA000, 0x382FC000, 0x382FE000,\n  0x38300000, 0x38302000, 0x38304000, 0x38306000, 0x38308000, 0x3830A000, 0x3830C000, 0x3830E000, 0x38310000, 0x38312000, 0x38314000, 0x38316000, 0x38318000, 0x3831A000, 0x3831C000, 0x3831E000,\n  0x38320000, 0x38322000, 0x38324000, 0x38326000, 0x38328000, 0x3832A000, 0x3832C000, 0x3832E000, 0x38330000, 0x38332000, 0x38334000, 0x38336000, 0x38338000, 0x3833A000, 0x3833C000, 0x3833E000,\n  0x38340000, 0x38342000, 0x38344000, 0x38346000, 0x38348000, 0x3834A000, 0x3834C000, 0x3834E000, 0x38350000, 0x38352000, 0x38354000, 0x38356000, 0x38358000, 0x3835A000, 0x3835C000, 0x3835E000,\n  0x38360000, 0x38362000, 0x38364000, 0x38366000, 0x38368000, 0x3836A000, 0x3836C000, 0x3836E000, 0x38370000, 0x38372000, 0x38374000, 0x38376000, 0x38378000, 0x3837A000, 0x3837C000, 0x3837E000,\n  0x38380000, 0x38382000, 0x38384000", ", 0x38386000, 0x38388000, 0x3838A000, 0x3838C000, 0x3838E000, 0x38390000, 0x38392000, 0x38394000, 0x38396000, 0x38398000, 0x3839A000, 0x3839C000, 0x3839E000,\n  0x383A0000, 0x383A2000, 0x383A4000, 0x383A6000, 0x383A8000, 0x383AA000, 0x383AC000, 0x383AE000, 0x383B0000, 0x383B2000, 0x383B4000, 0x383B6000, 0x383B8000, 0x383BA000, 0x383BC000, 0x383BE000,\n  0x383C0000, 0x383C2000, 0x383C4000, 0x383C6000, 0x383C8000, 0x383CA000, 0x383CC000, 0x383CE000, 0x383D0000, 0x383D2000, 0x383D4000, 0x383D6000, 0x383D8000, 0x383DA000, 0x383DC000, 0x383DE000,\n  0x383E0000, 0x383E2000, 0x383E4000, 0x383E6000, 0x383E8000, 0x383EA000, 0x383EC000, 0x383EE000, 0x383F0000, 0x383F2000, 0x383F4000, 0x383F6000, 0x383F8000, 0x383FA000, 0x383FC000, 0x383FE000,\n  0x38400000, 0x38402000, 0x38404000, 0x38406000, 0x38408000, 0x3840A000, 0x3840C000, 0x3840E000, 0x38410000, 0x38412000, 0x38414000, 0x38416000, 0x38418000, 0x3841A000, 0x3841C000, 0x3841E000,\n  0x38420000, 0x38422000, 0x38424000, 0x38426000, 0x38428000, 0x3842A000, 0x3842C000, 0x3842E000, 0x38430000, 0x38432000, 0x38434000, 0x38436000, 0x38438000, 0x3843A000, 0x3843C000, 0x3843E000,\n  0x38440000, 0x38442000, 0x38444000, 0x38446000, 0x38448000, 0x3844A000, 0x3844C000, 0x3844E000, 0x38450000, 0x38452000, 0x38454000, 0x38456000, 0x38458000, 0x3845A000, 0x3845C000, 0x3845E000,\n  0x38460000, 0x38462000, 0x38464000, 0x38466000, 0x38468000, 0x3846A000, 0x3846C000, 0x3846E000, 0x38470000, 0x38472000, 0x38474000, 0x38476000, 0x38478000, 0x3847A000, 0x3847C000, 0x3847E000,\n  0x38480000, 0x38482000, 0x38484000, 0x38486000, 0x38488000, 0x3848A000, 0x3848C000, 0x3848E000, 0x38490000, 0x38492000, 0x38494000, 0x38496000, 0x38498000, 0x3849A000, 0x3849C000, 0x3849E000,\n  0x384A0000, 0x384A2000, 0x384A4000, 0x384A6000, 0x384A8000, 0x384AA000, 0x384AC000, 0x384AE000, 0x384B0000, 0x384B2000, 0x384B4000, 0x384B6000, 0x384B8000, 0x384BA000, 0x384BC000, 0x384BE000,\n  0x384C0000, 0x384C2000, 0x384C4000, 0x384C6000, 0x384C8000, 0x384CA000, 0x384CC000, 0x384CE000",
                                    ", 0x384D0000, 0x384D2000, 0x384D4000, 0x384D6000, 0x384D8000, 0x384DA000, 0x384DC000, 0x384DE000,\n  0x384E0000, 0x384E2000, 0x384E4000, 0x384E6000, 0x384E8000, 0x384EA000, 0x384EC000, 0x384EE000, 0x384F0000, 0x384F2000, 0x384F4000, 0x384F6000, 0x384F8000, 0x384FA000, 0x384FC000, 0x384FE000,\n  0x38500000, 0x38502000, 0x38504000, 0x38506000, 0x38508000, 0x3850A000, 0x3850C000, 0x3850E000, 0x38510000, 0x38512000, 0x38514000, 0x38516000, 0x38518000, 0x3851A000, 0x3851C000, 0x3851E000,\n  0x38520000, 0x38522000, 0x38524000, 0x38526000, 0x38528000, 0x3852A000, 0x3852C000, 0x3852E000, 0x38530000, 0x38532000, 0x38534000, 0x38536000, 0x38538000, 0x3853A000, 0x3853C000, 0x3853E000,\n  0x38540000, 0x38542000, 0x38544000, 0x38546000, 0x38548000, 0x3854A000, 0x3854C000, 0x3854E000, 0x38550000, 0x38552000, 0x38554000, 0x38556000, 0x38558000, 0x3855A000, 0x3855C000, 0x3855E000,\n  0x38560000, 0x38562000, 0x38564000, 0x38566000, 0x38568000, 0x3856A000, 0x3856C000, 0x3856E000, 0x38570000, 0x38572000, 0x38574000, 0x38576000, 0x38578000, 0x3857A000, 0x3857C000, 0x3857E000,\n  0x38580000, 0x38582000, 0x38584000, 0x38586000, 0x38588000, 0x3858A000, 0x3858C000, 0x3858E000, 0x38590000, 0x38592000, 0x38594000, 0x38596000, 0x38598000, 0x3859A000, 0x3859C000, 0x3859E000,\n  0x385A0000, 0x385A2000, 0x385A4000, 0x385A6000, 0x385A8000, 0x385AA000, 0x385AC000, 0x385AE000, 0x385B0000, 0x385B2000, 0x385B4000, 0x385B6000, 0x385B8000, 0x385BA000, 0x385BC000, 0x385BE000,\n  0x385C0000, 0x385C2000, 0x385C4000, 0x385C6000, 0x385C8000, 0x385CA000, 0x385CC000, 0x385CE000, 0x385D0000, 0x385D2000, 0x385D4000, 0x385D6000, 0x385D8000, 0x385DA000, 0x385DC000, 0x385DE000,\n  0x385E0000, 0x385E2000, 0x385E4000, 0x385E6000, 0x385E8000, 0x385EA000, 0x385EC000, 0x385EE000, 0x385F0000, 0x385F2000, 0x385F4000, 0x385F6000, 0x385F8000, 0x385FA000, 0x385FC000, 0x385FE000,\n  0x38600000, 0x38602000, 0x38604000, 0x38606000, 0x38608000, 0x3860A000, 0x3860C000, 0x3860E000, 0x38610000, 0x38612000, 0x38614000, 0x38616000, 0x38618000", ", 0x3861A000, 0x3861C000, 0x3861E000,\n  0x38620000, 0x38622000, 0x38624000, 0x38626000, 0x38628000, 0x3862A000, 0x3862C000, 0x3862E000, 0x38630000, 0x38632000, 0x38634000, 0x38636000, 0x38638000, 0x3863A000, 0x3863C000, 0x3863E000,\n  0x38640000, 0x38642000, 0x38644000, 0x38646000, 0x38648000, 0x3864A000, 0x3864C000, 0x3864E000, 0x38650000, 0x38652000, 0x38654000, 0x38656000, 0x38658000, 0x3865A000, 0x3865C000, 0x3865E000,\n  0x38660000, 0x38662000, 0x38664000, 0x38666000, 0x38668000, 0x3866A000, 0x3866C000, 0x3866E000, 0x38670000, 0x38672000, 0x38674000, 0x38676000, 0x38678000, 0x3867A000, 0x3867C000, 0x3867E000,\n  0x38680000, 0x38682000, 0x38684000, 0x38686000, 0x38688000, 0x3868A000, 0x3868C000, 0x3868E000, 0x38690000, 0x38692000, 0x38694000, 0x38696000, 0x38698000, 0x3869A000, 0x3869C000, 0x3869E000,\n  0x386A0000, 0x386A2000, 0x386A4000, 0x386A6000, 0x386A8000, 0x386AA000, 0x386AC000, 0x386AE000, 0x386B0000, 0x386B2000, 0x386B4000, 0x386B6000, 0x386B8000, 0x386BA000, 0x386BC000, 0x386BE000,\n  0x386C0000, 0x386C2000, 0x386C4000, 0x386C6000, 0x386C8000, 0x386CA000, 0x386CC000, 0x386CE000, 0x386D0000, 0x386D2000, 0x386D4000, 0x386D6000, 0x386D8000, 0x386DA000, 0x386DC000, 0x386DE000,\n  0x386E0000, 0x386E2000, 0x386E4000, 0x386E6000, 0x386E8000, 0x386EA000, 0x386EC000, 0x386EE000, 0x386F0000, 0x386F2000, 0x386F4000, 0x386F6000, 0x386F8000, 0x386FA000, 0x386FC000, 0x386FE000,\n  0x38700000, 0x38702000, 0x38704000, 0x38706000, 0x38708000, 0x3870A000, 0x3870C000, 0x3870E000, 0x38710000, 0x38712000, 0x38714000, 0x38716000, 0x38718000, 0x3871A000, 0x3871C000, 0x3871E000,\n  0x38720000, 0x38722000, 0x38724000, 0x38726000, 0x38728000, 0x3872A000, 0x3872C000, 0x3872E000, 0x38730000, 0x38732000, 0x38734000, 0x38736000, 0x38738000, 0x3873A000, 0x3873C000, 0x3873E000,\n  0x38740000, 0x38742000, 0x38744000, 0x38746000, 0x38748000, 0x3874A000, 0x3874C000, 0x3874E000, 0x38750000, 0x38752000, 0x38754000, 0x38756000, 0x38758000, 0x3875A000, 0x3875C000, 0x3875E000,\n  0x38760000, 0x387620", "00, 0x38764000, 0x38766000, 0x38768000, 0x3876A000, 0x3876C000, 0x3876E000, 0x38770000, 0x38772000, 0x38774000, 0x38776000, 0x38778000, 0x3877A000, 0x3877C000, 0x3877E000,\n  0x38780000, 0x38782000, 0x38784000, 0x38786000, 0x38788000, 0x3878A000, 0x3878C000, 0x3878E000, 0x38790000, 0x38792000, 0x38794000, 0x38796000, 0x38798000, 0x3879A000, 0x3879C000, 0x3879E000,\n  0x387A0000, 0x387A2000, 0x387A4000, 0x387A6000, 0x387A8000, 0x387AA000, 0x387AC000, 0x387AE000, 0x387B0000, 0x387B2000, 0x387B4000, 0x387B6000, 0x387B8000, 0x387BA000, 0x387BC000, 0x387BE000,\n  0x387C0000, 0x387C2000, 0x387C4000, 0x387C6000, 0x387C8000, 0x387CA000, 0x387CC000, 0x387CE000, 0x387D0000, 0x387D2000, 0x387D4000, 0x387D6000, 0x387D8000, 0x387DA000, 0x387DC000, 0x387DE000,\n  0x387E0000, 0x387E2000, 0x387E4000, 0x387E6000, 0x387E8000, 0x387EA000, 0x387EC000, 0x387EE000, 0x387F0000, 0x387F2000, 0x387F4000, 0x387F6000, 0x387F8000, 0x387FA000, 0x387FC000, 0x387FE000 };\n__constant static const uint32_t exponent_table[64] = {\n  0x00000000, 0x00800000, 0x01000000, 0x01800000, 0x02000000, 0x02800000, 0x03000000, 0x03800000, 0x04000000, 0x04800000, 0x05000000, 0x05800000, 0x06000000, 0x06800000, 0x07000000, 0x07800000,\n  0x08000000, 0x08800000, 0x09000000, 0x09800000, 0x0A000000, 0x0A800000, 0x0B000000, 0x0B800000, 0x0C000000, 0x0C800000, 0x0D000000, 0x0D800000, 0x0E000000, 0x0E800000, 0x0F000000, 0x47800000,\n  0x80000000, 0x80800000, 0x81000000, 0x81800000, 0x82000000, 0x82800000, 0x83000000, 0x83800000, 0x84000000, 0x84800000, 0x85000000, 0x85800000, 0x86000000, 0x86800000, 0x87000000, 0x87800000,\n  0x88000000, 0x88800000, 0x89000000, 0x89800000, 0x8A000000, 0x8A800000, 0x8B000000, 0x8B800000, 0x8C000000, 0x8C800000, 0x8D000000, 0x8D800000, 0x8E000000, 0x8E800000, 0x8F000000, 0xC7800000 };\n__constant static const unsigned short offset_table[64] = {\n  0, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1",
                                    "024, 1024, 1024, 1024, 1024, 1024,\n  0, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024 };\n\nSCALAR_FUN_ATTR uint16_t float2halfbits(float value) {\n  union { float x; uint32_t y; } u;\n  u.x = value;\n  uint32_t bits = u.y;\n\n  uint16_t hbits = base_table[bits>>23] + (uint16_t)((bits&0x7FFFFF)>>shift_table[bits>>23]);;\n\n  return hbits;\n}\n\nSCALAR_FUN_ATTR float halfbits2float(uint16_t value) {\n  uint32_t bits = mantissa_table[offset_table[value>>10]+(value&0x3FF)] + exponent_table[value>>10];\n\n  union { uint32_t x; float y; } u;\n  u.x = bits;\n  return u.y;\n}\n\nSCALAR_FUN_ATTR uint16_t halfbitsnextafter(uint16_t from, uint16_t to) {\n  int fabs = from & 0x7FFF, tabs = to & 0x7FFF;\n  if(fabs > 0x7C00 || tabs > 0x7C00) {\n    return ((from&0x7FFF)>0x7C00) ? (from|0x200) : (to|0x200);\n  }\n  if(from == to || !(fabs|tabs)) {\n    return to;\n  }\n  if(!fabs) {\n    return (to&0x8000)+1;\n  }\n  unsigned int out =\n    from +\n    (((from>>15)^(unsigned int)((from^(0x8000|(0x8000-(from>>15))))<(to^(0x8000|(0x8000-(to>>15))))))<<1)\n    - 1;\n  return out;\n}\n\n// End of half.h.\n// Start of scalar.h.\n\n// Implementation of the primitive scalar operations.  Very\n// repetitive.  This code is inserted directly into both CUDA and\n// OpenCL programs, as well as the CPU code, so it has some #ifdefs to\n// work everywhere.  Some operations are defined as macros because\n// this allows us to use them as constant expressions in things like\n// array sizes and static initialisers.\n\n// Some of the #ifdefs are because OpenCL uses type-generic functions\n// for some operations (e.g. sqrt), while C and CUDA sensibly use\n// distinct functions for different precisions (e.g. sqrtf() and\n// sqrt()).  This is quite annoying.  Due to C's unfortunate casting\n// rules, it is also really easy to accidentally implement\n// floating-point functions in the wrong precision, so be careful.\n\n/", "/ Double-precision definitions are only included if the preprocessor\n// macro FUTHARK_F64_ENABLED is set.\n\nSCALAR_FUN_ATTR int32_t futrts_to_bits32(float x);\nSCALAR_FUN_ATTR float futrts_from_bits32(int32_t x);\n\nSCALAR_FUN_ATTR uint8_t add8(uint8_t x, uint8_t y) {\n  return x + y;\n}\n\nSCALAR_FUN_ATTR uint16_t add16(uint16_t x, uint16_t y) {\n  return x + y;\n}\n\nSCALAR_FUN_ATTR uint32_t add32(uint32_t x, uint32_t y) {\n  return x + y;\n}\n\nSCALAR_FUN_ATTR uint64_t add64(uint64_t x, uint64_t y) {\n  return x + y;\n}\n\nSCALAR_FUN_ATTR uint8_t sub8(uint8_t x, uint8_t y) {\n  return x - y;\n}\n\nSCALAR_FUN_ATTR uint16_t sub16(uint16_t x, uint16_t y) {\n  return x - y;\n}\n\nSCALAR_FUN_ATTR uint32_t sub32(uint32_t x, uint32_t y) {\n  return x - y;\n}\n\nSCALAR_FUN_ATTR uint64_t sub64(uint64_t x, uint64_t y) {\n  return x - y;\n}\n\nSCALAR_FUN_ATTR uint8_t mul8(uint8_t x, uint8_t y) {\n  return x * y;\n}\n\nSCALAR_FUN_ATTR uint16_t mul16(uint16_t x, uint16_t y) {\n  return x * y;\n}\n\nSCALAR_FUN_ATTR uint32_t mul32(uint32_t x, uint32_t y) {\n  return x * y;\n}\n\nSCALAR_FUN_ATTR uint64_t mul64(uint64_t x, uint64_t y) {\n  return x * y;\n}\n\n#if ISPC\n\nSCALAR_FUN_ATTR uint8_t udiv8(uint8_t x, uint8_t y) {\n  // This strange pattern is used to prevent the ISPC compiler from\n  // causing SIGFPEs and bogus results on divisions where inactive lanes\n  // have 0-valued divisors. It ensures that any inactive lane instead\n  // has a divisor of 1. https://github.com/ispc/ispc/issues/2292\n  uint8_t ys = 1;\n  foreach_active(i){\n    ys = y;\n  }\n\n  return x / ys;\n}\n\nSCALAR_FUN_ATTR uint16_t udiv16(uint16_t x, uint16_t y) {\n  uint16_t ys = 1;\n  foreach_active(i){\n    ys = y;\n  }\n\n  return x / ys;\n}\n\nSCALAR_FUN_ATTR uint32_t udiv32(uint32_t x, uint32_t y) {\n  uint32_t ys = 1;\n  foreach_active(i){\n    ys = y;\n  }\n\n\n  return x / ys;\n}\n\nSCALAR_FUN_ATTR uint64_t udiv64(uint64_t x, uint64_t y) {\n  uint64_t ys = 1;\n  foreach_active(i){\n    ys = y;\n  }\n\n\n  return x / ys;\n}\n\nSCALAR_FUN_ATTR uint8_t udiv_up8(uint8_t x, uint8_t y) {\n  uint", "8_t ys = 1;\n  foreach_active(i){\n    ys = y;\n  }\n\n\n  return (x + y - 1) / ys;\n}\n\nSCALAR_FUN_ATTR uint16_t udiv_up16(uint16_t x, uint16_t y) {\n  uint16_t ys = 1;\n  foreach_active(i){\n    ys = y;\n  }\n\n  return (x + y - 1) / ys;\n}\n\nSCALAR_FUN_ATTR uint32_t udiv_up32(uint32_t x, uint32_t y) {\n  uint32_t ys = 1;\n  foreach_active(i){\n    ys = y;\n  }\n\n  return (x + y - 1) / ys;\n}\n\nSCALAR_FUN_ATTR uint64_t udiv_up64(uint64_t x, uint64_t y) {\n  uint64_t ys = 1;\n  foreach_active(i){\n    ys = y;\n  }\n\n  return (x + y - 1) / ys;\n}\n\nSCALAR_FUN_ATTR uint8_t umod8(uint8_t x, uint8_t y) {\n  uint8_t ys = 1;\n  foreach_active(i){\n    ys = y;\n  }\n\n  return x % ys;\n}\n\nSCALAR_FUN_ATTR uint16_t umod16(uint16_t x, uint16_t y) {\n  uint16_t ys = 1;\n  foreach_active(i){\n    ys = y;\n  }\n\n\n  return x % ys;\n}\n\nSCALAR_FUN_ATTR uint32_t umod32(uint32_t x, uint32_t y) {\n  uint32_t ys = 1;\n  foreach_active(i){\n    ys = y;\n  }\n\n  return x % ys;\n}\n\nSCALAR_FUN_ATTR uint64_t umod64(uint64_t x, uint64_t y) {\n  uint64_t ys = 1;\n  foreach_active(i){\n    ys = y;\n  }\n\n  return x % ys;\n}\n\nSCALAR_FUN_ATTR uint8_t udiv_safe8(uint8_t x, uint8_t y) {\n  uint8_t ys = 1;\n  foreach_active(i){\n    ys = y;\n  }\n\n  return y == 0 ? 0 : x / ys;\n}\n\nSCALAR_FUN_ATTR uint16_t udiv_safe16(uint16_t x, uint16_t y) {\n  uint16_t ys = 1;\n  foreach_active(i){\n    ys = y;\n  }\n\n  return y == 0 ? 0 : x / ys;\n}\n\nSCALAR_FUN_ATTR uint32_t udiv_safe32(uint32_t x, uint32_t y) {\n  uint32_t ys = 1;\n  foreach_active(i){\n    ys = y;\n  }\n\n  return y == 0 ? 0 : x / ys;\n}\n\nSCALAR_FUN_ATTR uint64_t udiv_safe64(uint64_t x, uint64_t y) {\n  uint64_t ys = 1;\n  foreach_active(i){\n    ys = y;\n  }\n\n  return y == 0 ? 0 : x / ys;\n}\n\nSCALAR_FUN_ATTR uint8_t udiv_up_safe8(uint8_t x, uint8_t y) {\n  uint8_t ys = 1;\n  foreach_active(i){\n    ys = y;\n  }\n\n  return y == 0 ? 0 : (x + y - 1) / ys;\n}\n\nSCALAR_FUN_ATTR uint16_t udiv_up_safe16(uint16_t x, uint16_t y) {\n  uint16_t ys = 1;\n  foreach_active(i){\n    ys = y;\n  }\n\n  return y == 0 ? 0 : (x + y - 1) / ys;\n}\n\nSCALA",
                                    "R_FUN_ATTR uint32_t udiv_up_safe32(uint32_t x, uint32_t y) {\n  uint32_t ys = 1;\n  foreach_active(i){\n    ys = y;\n  }\n\n  return y == 0 ? 0 : (x + y - 1) / ys;\n}\n\nSCALAR_FUN_ATTR uint64_t udiv_up_safe64(uint64_t x, uint64_t y) {\n  uint64_t ys = 1;\n  foreach_active(i){\n    ys = y;\n  }\n\n  return y == 0 ? 0 : (x + y - 1) / ys;\n}\n\nSCALAR_FUN_ATTR uint8_t umod_safe8(uint8_t x, uint8_t y) {\n  uint8_t ys = 1;\n  foreach_active(i){\n    ys = y;\n  }\n\n  return y == 0 ? 0 : x % ys;\n}\n\nSCALAR_FUN_ATTR uint16_t umod_safe16(uint16_t x, uint16_t y) {\n  uint16_t ys = 1;\n  foreach_active(i){\n    ys = y;\n  }\n\n  return y == 0 ? 0 : x % ys;\n}\n\nSCALAR_FUN_ATTR uint32_t umod_safe32(uint32_t x, uint32_t y) {\n  uint32_t ys = 1;\n  foreach_active(i){\n    ys = y;\n  }\n\n  return y == 0 ? 0 : x % ys;\n}\n\nSCALAR_FUN_ATTR uint64_t umod_safe64(uint64_t x, uint64_t y) {\n  uint64_t ys = 1;\n  foreach_active(i){\n    ys = y;\n  }\n\n  return y == 0 ? 0 : x % ys;\n}\n\nSCALAR_FUN_ATTR int8_t sdiv8(int8_t x, int8_t y) {\n  int8_t ys = 1;\n  foreach_active(i){\n    ys = y;\n  }\n\n  int8_t q = x / ys;\n  int8_t r = x % ys;\n\n  return q - ((r != 0 && r < 0 != y < 0) ? 1 : 0);\n}\n\nSCALAR_FUN_ATTR int16_t sdiv16(int16_t x, int16_t y) {\n  int16_t ys = 1;\n  foreach_active(i){\n    ys = y;\n  }\n\n  int16_t q = x / ys;\n  int16_t r = x % ys;\n\n  return q - ((r != 0 && r < 0 != y < 0) ? 1 : 0);\n}\n\nSCALAR_FUN_ATTR int32_t sdiv32(int32_t x, int32_t y) {\n  int32_t ys = 1;\n  foreach_active(i){\n    ys = y;\n  }\n  int32_t q = x / ys;\n  int32_t r = x % ys;\n\n  return q - ((r != 0 && r < 0 != y < 0) ? 1 : 0);\n}\n\nSCALAR_FUN_ATTR int64_t sdiv64(int64_t x, int64_t y) {\n  int64_t ys = 1;\n  foreach_active(i){\n    ys = y;\n  }\n\n  int64_t q = x / ys;\n  int64_t r = x % ys;\n\n  return q - ((r != 0 && r < 0 != y < 0) ? 1 : 0);\n}\n\nSCALAR_FUN_ATTR int8_t sdiv_up8(int8_t x, int8_t y) {\n  return sdiv8(x + y - 1, y);\n}\n\nSCALAR_FUN_ATTR int16_t sdiv_up16(int16_t x, int16_t y) {\n  return sdiv16(x + y - 1, y);\n}\n\nSCALAR_FUN_ATTR int32_t sdiv_up32(int32_t x, int32_t y)", " {\n  return sdiv32(x + y - 1, y);\n}\n\nSCALAR_FUN_ATTR int64_t sdiv_up64(int64_t x, int64_t y) {\n  return sdiv64(x + y - 1, y);\n}\n\nSCALAR_FUN_ATTR int8_t smod8(int8_t x, int8_t y) {\n  int8_t ys = 1;\n  foreach_active(i){\n    ys = y;\n  }\n\n  int8_t r = x % ys;\n\n  return r + (r == 0 || (x > 0 && y > 0) || (x < 0 && y < 0) ? 0 : y);\n}\n\nSCALAR_FUN_ATTR int16_t smod16(int16_t x, int16_t y) {\n  int16_t ys = 1;\n  foreach_active(i){\n    ys = y;\n  }\n\n  int16_t r = x % ys;\n\n  return r + (r == 0 || (x > 0 && y > 0) || (x < 0 && y < 0) ? 0 : y);\n}\n\nSCALAR_FUN_ATTR int32_t smod32(int32_t x, int32_t y) {\n  int32_t ys = 1;\n  foreach_active(i){\n    ys = y;\n  }\n\n  int32_t r = x % ys;\n\n  return r + (r == 0 || (x > 0 && y > 0) || (x < 0 && y < 0) ? 0 : y);\n}\n\nSCALAR_FUN_ATTR int64_t smod64(int64_t x, int64_t y) {\n  int64_t ys = 1;\n  foreach_active(i){\n    ys = y;\n  }\n\n  int64_t r = x % ys;\n\n  return r + (r == 0 || (x > 0 && y > 0) || (x < 0 && y < 0) ? 0 : y);\n}\n\nSCALAR_FUN_ATTR int8_t sdiv_safe8(int8_t x, int8_t y) {\n  return y == 0 ? 0 : sdiv8(x, y);\n}\n\nSCALAR_FUN_ATTR int16_t sdiv_safe16(int16_t x, int16_t y) {\n  return y == 0 ? 0 : sdiv16(x, y);\n}\n\nSCALAR_FUN_ATTR int32_t sdiv_safe32(int32_t x, int32_t y) {\n  return y == 0 ? 0 : sdiv32(x, y);\n}\n\nSCALAR_FUN_ATTR int64_t sdiv_safe64(int64_t x, int64_t y) {\n  return y == 0 ? 0 : sdiv64(x, y);\n}\n\nSCALAR_FUN_ATTR int8_t sdiv_up_safe8(int8_t x, int8_t y) {\n  return sdiv_safe8(x + y - 1, y);\n}\n\nSCALAR_FUN_ATTR int16_t sdiv_up_safe16(int16_t x, int16_t y) {\n  return sdiv_safe16(x + y - 1, y);\n}\n\nSCALAR_FUN_ATTR int32_t sdiv_up_safe32(int32_t x, int32_t y) {\n  return sdiv_safe32(x + y - 1, y);\n}\n\nSCALAR_FUN_ATTR int64_t sdiv_up_safe64(int64_t x, int64_t y) {\n  return sdiv_safe64(x + y - 1, y);\n}\n\nSCALAR_FUN_ATTR int8_t smod_safe8(int8_t x, int8_t y) {\n  return y == 0 ? 0 : smod8(x, y);\n}\n\nSCALAR_FUN_ATTR int16_t smod_safe16(int16_t x, int16_t y) {\n  return y == 0 ? 0 : smod16(x, y);\n}\n\nSCALAR_FUN_ATTR int32_t smod_safe32(int32_t x, int32_t y) ", "{\n  return y == 0 ? 0 : smod32(x, y);\n}\n\nSCALAR_FUN_ATTR int64_t smod_safe64(int64_t x, int64_t y) {\n  return y == 0 ? 0 : smod64(x, y);\n}\n\nSCALAR_FUN_ATTR int8_t squot8(int8_t x, int8_t y) {\n  int8_t ys = 1;\n  foreach_active(i){\n    ys = y;\n  }\n\n  return x / ys;\n}\n\nSCALAR_FUN_ATTR int16_t squot16(int16_t x, int16_t y) {\n  int16_t ys = 1;\n  foreach_active(i){\n    ys = y;\n  }\n\n  return x / ys;\n}\n\nSCALAR_FUN_ATTR int32_t squot32(int32_t x, int32_t y) {\n  int32_t ys = 1;\n  foreach_active(i){\n    ys = y;\n  }\n\n  return x / ys;\n}\n\nSCALAR_FUN_ATTR int64_t squot64(int64_t x, int64_t y) {\n  int64_t ys = 1;\n  foreach_active(i){\n    ys = y;\n  }\n\n  return x / ys;\n}\n\nSCALAR_FUN_ATTR int8_t srem8(int8_t x, int8_t y) {\n  int8_t ys = 1;\n  foreach_active(i){\n    ys = y;\n  }\n\n  return x % ys;\n}\n\nSCALAR_FUN_ATTR int16_t srem16(int16_t x, int16_t y) {\n  int16_t ys = 1;\n  foreach_active(i){\n    ys = y;\n  }\n\n  return x % ys;\n}\n\nSCALAR_FUN_ATTR int32_t srem32(int32_t x, int32_t y) {\n  int32_t ys = 1;\n  foreach_active(i){\n    ys = y;\n  }\n\n  return x % ys;\n}\n\nSCALAR_FUN_ATTR int64_t srem64(int64_t x, int64_t y) {\n  int8_t ys = 1;\n  foreach_active(i){\n    ys = y;\n  }\n\n  return x % ys;\n}\n\nSCALAR_FUN_ATTR int8_t squot_safe8(int8_t x, int8_t y) {\n  int8_t ys = 1;\n  foreach_active(i){\n    ys = y;\n  }\n\n  return y == 0 ? 0 : x / ys;\n}\n\nSCALAR_FUN_ATTR int16_t squot_safe16(int16_t x, int16_t y) {\n  int16_t ys = 1;\n  foreach_active(i){\n    ys = y;\n  }\n\n  return y == 0 ? 0 : x / ys;\n}\n\nSCALAR_FUN_ATTR int32_t squot_safe32(int32_t x, int32_t y) {\n  int32_t ys = 1;\n  foreach_active(i){\n    ys = y;\n  }\n\n  return y == 0 ? 0 : x / ys;\n}\n\nSCALAR_FUN_ATTR int64_t squot_safe64(int64_t x, int64_t y) {\n  int64_t ys = 1;\n  foreach_active(i){\n    ys = y;\n  }\n\n  return y == 0 ? 0 : x / ys;\n}\n\nSCALAR_FUN_ATTR int8_t srem_safe8(int8_t x, int8_t y) {\n  int8_t ys = 1;\n  foreach_active(i){\n    ys = y;\n  }\n\n  return y == 0 ? 0 : x % ys;\n}\n\nSCALAR_FUN_ATTR int16_t srem_safe16(int16_t x, int16_t y) {\n  int16_t ys = 1;\n  ",
                                    "foreach_active(i){\n    ys = y;\n  }\n\n  return y == 0 ? 0 : x % ys;\n}\n\nSCALAR_FUN_ATTR int32_t srem_safe32(int32_t x, int32_t y) {\n  int32_t ys = 1;\n  foreach_active(i){\n    ys = y;\n  }\n\n  return y == 0 ? 0 : x % ys;\n}\n\nSCALAR_FUN_ATTR int64_t srem_safe64(int64_t x, int64_t y) {\n  int64_t ys = 1;\n  foreach_active(i){\n    ys = y;\n  }\n\n  return y == 0 ? 0 : x % ys;\n}\n\n#else\n\nSCALAR_FUN_ATTR uint8_t udiv8(uint8_t x, uint8_t y) {\n  return x / y;\n}\n\nSCALAR_FUN_ATTR uint16_t udiv16(uint16_t x, uint16_t y) {\n  return x / y;\n}\n\nSCALAR_FUN_ATTR uint32_t udiv32(uint32_t x, uint32_t y) {\n  return x / y;\n}\n\nSCALAR_FUN_ATTR uint64_t udiv64(uint64_t x, uint64_t y) {\n  return x / y;\n}\n\nSCALAR_FUN_ATTR uint8_t udiv_up8(uint8_t x, uint8_t y) {\n  return (x + y - 1) / y;\n}\n\nSCALAR_FUN_ATTR uint16_t udiv_up16(uint16_t x, uint16_t y) {\n  return (x + y - 1) / y;\n}\n\nSCALAR_FUN_ATTR uint32_t udiv_up32(uint32_t x, uint32_t y) {\n  return (x + y - 1) / y;\n}\n\nSCALAR_FUN_ATTR uint64_t udiv_up64(uint64_t x, uint64_t y) {\n  return (x + y - 1) / y;\n}\n\nSCALAR_FUN_ATTR uint8_t umod8(uint8_t x, uint8_t y) {\n  return x % y;\n}\n\nSCALAR_FUN_ATTR uint16_t umod16(uint16_t x, uint16_t y) {\n  return x % y;\n}\n\nSCALAR_FUN_ATTR uint32_t umod32(uint32_t x, uint32_t y) {\n  return x % y;\n}\n\nSCALAR_FUN_ATTR uint64_t umod64(uint64_t x, uint64_t y) {\n  return x % y;\n}\n\nSCALAR_FUN_ATTR uint8_t udiv_safe8(uint8_t x, uint8_t y) {\n  return y == 0 ? 0 : x / y;\n}\n\nSCALAR_FUN_ATTR uint16_t udiv_safe16(uint16_t x, uint16_t y) {\n  return y == 0 ? 0 : x / y;\n}\n\nSCALAR_FUN_ATTR uint32_t udiv_safe32(uint32_t x, uint32_t y) {\n  return y == 0 ? 0 : x / y;\n}\n\nSCALAR_FUN_ATTR uint64_t udiv_safe64(uint64_t x, uint64_t y) {\n  return y == 0 ? 0 : x / y;\n}\n\nSCALAR_FUN_ATTR uint8_t udiv_up_safe8(uint8_t x, uint8_t y) {\n  return y == 0 ? 0 : (x + y - 1) / y;\n}\n\nSCALAR_FUN_ATTR uint16_t udiv_up_safe16(uint16_t x, uint16_t y) {\n  return y == 0 ? 0 : (x + y - 1) / y;\n}\n\nSCALAR_FUN_ATTR uint32_t udiv_up_safe32(uint32_t x, uint32_t y) {\n  return", " y == 0 ? 0 : (x + y - 1) / y;\n}\n\nSCALAR_FUN_ATTR uint64_t udiv_up_safe64(uint64_t x, uint64_t y) {\n  return y == 0 ? 0 : (x + y - 1) / y;\n}\n\nSCALAR_FUN_ATTR uint8_t umod_safe8(uint8_t x, uint8_t y) {\n  return y == 0 ? 0 : x % y;\n}\n\nSCALAR_FUN_ATTR uint16_t umod_safe16(uint16_t x, uint16_t y) {\n  return y == 0 ? 0 : x % y;\n}\n\nSCALAR_FUN_ATTR uint32_t umod_safe32(uint32_t x, uint32_t y) {\n  return y == 0 ? 0 : x % y;\n}\n\nSCALAR_FUN_ATTR uint64_t umod_safe64(uint64_t x, uint64_t y) {\n  return y == 0 ? 0 : x % y;\n}\n\nSCALAR_FUN_ATTR int8_t sdiv8(int8_t x, int8_t y) {\n  int8_t q = x / y;\n  int8_t r = x % y;\n\n  return q - ((r != 0 && r < 0 != y < 0) ? 1 : 0);\n}\n\nSCALAR_FUN_ATTR int16_t sdiv16(int16_t x, int16_t y) {\n  int16_t q = x / y;\n  int16_t r = x % y;\n\n  return q - ((r != 0 && r < 0 != y < 0) ? 1 : 0);\n}\n\nSCALAR_FUN_ATTR int32_t sdiv32(int32_t x, int32_t y) {\n  int32_t q = x / y;\n  int32_t r = x % y;\n\n  return q - ((r != 0 && r < 0 != y < 0) ? 1 : 0);\n}\n\nSCALAR_FUN_ATTR int64_t sdiv64(int64_t x, int64_t y) {\n  int64_t q = x / y;\n  int64_t r = x % y;\n\n  return q - ((r != 0 && r < 0 != y < 0) ? 1 : 0);\n}\n\nSCALAR_FUN_ATTR int8_t sdiv_up8(int8_t x, int8_t y) {\n  return sdiv8(x + y - 1, y);\n}\n\nSCALAR_FUN_ATTR int16_t sdiv_up16(int16_t x, int16_t y) {\n  return sdiv16(x + y - 1, y);\n}\n\nSCALAR_FUN_ATTR int32_t sdiv_up32(int32_t x, int32_t y) {\n  return sdiv32(x + y - 1, y);\n}\n\nSCALAR_FUN_ATTR int64_t sdiv_up64(int64_t x, int64_t y) {\n  return sdiv64(x + y - 1, y);\n}\n\nSCALAR_FUN_ATTR int8_t smod8(int8_t x, int8_t y) {\n  int8_t r = x % y;\n\n  return r + (r == 0 || (x > 0 && y > 0) || (x < 0 && y < 0) ? 0 : y);\n}\n\nSCALAR_FUN_ATTR int16_t smod16(int16_t x, int16_t y) {\n  int16_t r = x % y;\n\n  return r + (r == 0 || (x > 0 && y > 0) || (x < 0 && y < 0) ? 0 : y);\n}\n\nSCALAR_FUN_ATTR int32_t smod32(int32_t x, int32_t y) {\n  int32_t r = x % y;\n\n  return r + (r == 0 || (x > 0 && y > 0) || (x < 0 && y < 0) ? 0 : y);\n}\n\nSCALAR_FUN_ATTR int64_t smod64(int64_t x, int64_t y) {\n  int64_t r = ", "x % y;\n\n  return r + (r == 0 || (x > 0 && y > 0) || (x < 0 && y < 0) ? 0 : y);\n}\n\nSCALAR_FUN_ATTR int8_t sdiv_safe8(int8_t x, int8_t y) {\n  return y == 0 ? 0 : sdiv8(x, y);\n}\n\nSCALAR_FUN_ATTR int16_t sdiv_safe16(int16_t x, int16_t y) {\n  return y == 0 ? 0 : sdiv16(x, y);\n}\n\nSCALAR_FUN_ATTR int32_t sdiv_safe32(int32_t x, int32_t y) {\n  return y == 0 ? 0 : sdiv32(x, y);\n}\n\nSCALAR_FUN_ATTR int64_t sdiv_safe64(int64_t x, int64_t y) {\n  return y == 0 ? 0 : sdiv64(x, y);\n}\n\nSCALAR_FUN_ATTR int8_t sdiv_up_safe8(int8_t x, int8_t y) {\n  return sdiv_safe8(x + y - 1, y);\n}\n\nSCALAR_FUN_ATTR int16_t sdiv_up_safe16(int16_t x, int16_t y) {\n  return sdiv_safe16(x + y - 1, y);\n}\n\nSCALAR_FUN_ATTR int32_t sdiv_up_safe32(int32_t x, int32_t y) {\n  return sdiv_safe32(x + y - 1, y);\n}\n\nSCALAR_FUN_ATTR int64_t sdiv_up_safe64(int64_t x, int64_t y) {\n  return sdiv_safe64(x + y - 1, y);\n}\n\nSCALAR_FUN_ATTR int8_t smod_safe8(int8_t x, int8_t y) {\n  return y == 0 ? 0 : smod8(x, y);\n}\n\nSCALAR_FUN_ATTR int16_t smod_safe16(int16_t x, int16_t y) {\n  return y == 0 ? 0 : smod16(x, y);\n}\n\nSCALAR_FUN_ATTR int32_t smod_safe32(int32_t x, int32_t y) {\n  return y == 0 ? 0 : smod32(x, y);\n}\n\nSCALAR_FUN_ATTR int64_t smod_safe64(int64_t x, int64_t y) {\n  return y == 0 ? 0 : smod64(x, y);\n}\n\nSCALAR_FUN_ATTR int8_t squot8(int8_t x, int8_t y) {\n  return x / y;\n}\n\nSCALAR_FUN_ATTR int16_t squot16(int16_t x, int16_t y) {\n  return x / y;\n}\n\nSCALAR_FUN_ATTR int32_t squot32(int32_t x, int32_t y) {\n  return x / y;\n}\n\nSCALAR_FUN_ATTR int64_t squot64(int64_t x, int64_t y) {\n  return x / y;\n}\n\nSCALAR_FUN_ATTR int8_t srem8(int8_t x, int8_t y) {\n  return x % y;\n}\n\nSCALAR_FUN_ATTR int16_t srem16(int16_t x, int16_t y) {\n  return x % y;\n}\n\nSCALAR_FUN_ATTR int32_t srem32(int32_t x, int32_t y) {\n  return x % y;\n}\n\nSCALAR_FUN_ATTR int64_t srem64(int64_t x, int64_t y) {\n  return x % y;\n}\n\nSCALAR_FUN_ATTR int8_t squot_safe8(int8_t x, int8_t y) {\n  return y == 0 ? 0 : x / y;\n}\n\nSCALAR_FUN_ATTR int16_t squot_safe16(int16_t x, int16_t ",
                                    "y) {\n  return y == 0 ? 0 : x / y;\n}\n\nSCALAR_FUN_ATTR int32_t squot_safe32(int32_t x, int32_t y) {\n  return y == 0 ? 0 : x / y;\n}\n\nSCALAR_FUN_ATTR int64_t squot_safe64(int64_t x, int64_t y) {\n  return y == 0 ? 0 : x / y;\n}\n\nSCALAR_FUN_ATTR int8_t srem_safe8(int8_t x, int8_t y) {\n  return y == 0 ? 0 : x % y;\n}\n\nSCALAR_FUN_ATTR int16_t srem_safe16(int16_t x, int16_t y) {\n  return y == 0 ? 0 : x % y;\n}\n\nSCALAR_FUN_ATTR int32_t srem_safe32(int32_t x, int32_t y) {\n  return y == 0 ? 0 : x % y;\n}\n\nSCALAR_FUN_ATTR int64_t srem_safe64(int64_t x, int64_t y) {\n  return y == 0 ? 0 : x % y;\n}\n\n#endif\n\nSCALAR_FUN_ATTR int8_t smin8(int8_t x, int8_t y) {\n  return x < y ? x : y;\n}\n\nSCALAR_FUN_ATTR int16_t smin16(int16_t x, int16_t y) {\n  return x < y ? x : y;\n}\n\nSCALAR_FUN_ATTR int32_t smin32(int32_t x, int32_t y) {\n  return x < y ? x : y;\n}\n\nSCALAR_FUN_ATTR int64_t smin64(int64_t x, int64_t y) {\n  return x < y ? x : y;\n}\n\nSCALAR_FUN_ATTR uint8_t umin8(uint8_t x, uint8_t y) {\n  return x < y ? x : y;\n}\n\nSCALAR_FUN_ATTR uint16_t umin16(uint16_t x, uint16_t y) {\n  return x < y ? x : y;\n}\n\nSCALAR_FUN_ATTR uint32_t umin32(uint32_t x, uint32_t y) {\n  return x < y ? x : y;\n}\n\nSCALAR_FUN_ATTR uint64_t umin64(uint64_t x, uint64_t y) {\n  return x < y ? x : y;\n}\n\nSCALAR_FUN_ATTR int8_t smax8(int8_t x, int8_t y) {\n  return x < y ? y : x;\n}\n\nSCALAR_FUN_ATTR int16_t smax16(int16_t x, int16_t y) {\n  return x < y ? y : x;\n}\n\nSCALAR_FUN_ATTR int32_t smax32(int32_t x, int32_t y) {\n  return x < y ? y : x;\n}\n\nSCALAR_FUN_ATTR int64_t smax64(int64_t x, int64_t y) {\n  return x < y ? y : x;\n}\n\nSCALAR_FUN_ATTR uint8_t umax8(uint8_t x, uint8_t y) {\n  return x < y ? y : x;\n}\n\nSCALAR_FUN_ATTR uint16_t umax16(uint16_t x, uint16_t y) {\n  return x < y ? y : x;\n}\n\nSCALAR_FUN_ATTR uint32_t umax32(uint32_t x, uint32_t y) {\n  return x < y ? y : x;\n}\n\nSCALAR_FUN_ATTR uint64_t umax64(uint64_t x, uint64_t y) {\n  return x < y ? y : x;\n}\n\nSCALAR_FUN_ATTR uint8_t shl8(uint8_t x, uint8_t y) {\n  return (uint8_t)(x << y);\n}\n\nS", "CALAR_FUN_ATTR uint16_t shl16(uint16_t x, uint16_t y) {\n  return (uint16_t)(x << y);\n}\n\nSCALAR_FUN_ATTR uint32_t shl32(uint32_t x, uint32_t y) {\n  return x << y;\n}\n\nSCALAR_FUN_ATTR uint64_t shl64(uint64_t x, uint64_t y) {\n  return x << y;\n}\n\nSCALAR_FUN_ATTR uint8_t lshr8(uint8_t x, uint8_t y) {\n  return x >> y;\n}\n\nSCALAR_FUN_ATTR uint16_t lshr16(uint16_t x, uint16_t y) {\n  return x >> y;\n}\n\nSCALAR_FUN_ATTR uint32_t lshr32(uint32_t x, uint32_t y) {\n  return x >> y;\n}\n\nSCALAR_FUN_ATTR uint64_t lshr64(uint64_t x, uint64_t y) {\n  return x >> y;\n}\n\nSCALAR_FUN_ATTR int8_t ashr8(int8_t x, int8_t y) {\n  return x >> y;\n}\n\nSCALAR_FUN_ATTR int16_t ashr16(int16_t x, int16_t y) {\n  return x >> y;\n}\n\nSCALAR_FUN_ATTR int32_t ashr32(int32_t x, int32_t y) {\n  return x >> y;\n}\n\nSCALAR_FUN_ATTR int64_t ashr64(int64_t x, int64_t y) {\n  return x >> y;\n}\n\nSCALAR_FUN_ATTR uint8_t and8(uint8_t x, uint8_t y) {\n  return x & y;\n}\n\nSCALAR_FUN_ATTR uint16_t and16(uint16_t x, uint16_t y) {\n  return x & y;\n}\n\nSCALAR_FUN_ATTR uint32_t and32(uint32_t x, uint32_t y) {\n  return x & y;\n}\n\nSCALAR_FUN_ATTR uint64_t and64(uint64_t x, uint64_t y) {\n  return x & y;\n}\n\nSCALAR_FUN_ATTR uint8_t or8(uint8_t x, uint8_t y) {\n  return x | y;\n}\n\nSCALAR_FUN_ATTR uint16_t or16(uint16_t x, uint16_t y) {\n  return x | y;\n}\n\nSCALAR_FUN_ATTR uint32_t or32(uint32_t x, uint32_t y) {\n  return x | y;\n}\n\nSCALAR_FUN_ATTR uint64_t or64(uint64_t x, uint64_t y) {\n  return x | y;\n}\n\nSCALAR_FUN_ATTR uint8_t xor8(uint8_t x, uint8_t y) {\n  return x ^ y;\n}\n\nSCALAR_FUN_ATTR uint16_t xor16(uint16_t x, uint16_t y) {\n  return x ^ y;\n}\n\nSCALAR_FUN_ATTR uint32_t xor32(uint32_t x, uint32_t y) {\n  return x ^ y;\n}\n\nSCALAR_FUN_ATTR uint64_t xor64(uint64_t x, uint64_t y) {\n  return x ^ y;\n}\n\nSCALAR_FUN_ATTR bool ult8(uint8_t x, uint8_t y) {\n  return x < y;\n}\n\nSCALAR_FUN_ATTR bool ult16(uint16_t x, uint16_t y) {\n  return x < y;\n}\n\nSCALAR_FUN_ATTR bool ult32(uint32_t x, uint32_t y) {\n  return x < y;\n}\n\nSCALAR_FUN_ATTR bool ult64(uint64_t x, uint64", "_t y) {\n  return x < y;\n}\n\nSCALAR_FUN_ATTR bool ule8(uint8_t x, uint8_t y) {\n  return x <= y;\n}\n\nSCALAR_FUN_ATTR bool ule16(uint16_t x, uint16_t y) {\n  return x <= y;\n}\n\nSCALAR_FUN_ATTR bool ule32(uint32_t x, uint32_t y) {\n  return x <= y;\n}\n\nSCALAR_FUN_ATTR bool ule64(uint64_t x, uint64_t y) {\n  return x <= y;\n}\n\nSCALAR_FUN_ATTR bool slt8(int8_t x, int8_t y) {\n  return x < y;\n}\n\nSCALAR_FUN_ATTR bool slt16(int16_t x, int16_t y) {\n  return x < y;\n}\n\nSCALAR_FUN_ATTR bool slt32(int32_t x, int32_t y) {\n  return x < y;\n}\n\nSCALAR_FUN_ATTR bool slt64(int64_t x, int64_t y) {\n  return x < y;\n}\n\nSCALAR_FUN_ATTR bool sle8(int8_t x, int8_t y) {\n  return x <= y;\n}\n\nSCALAR_FUN_ATTR bool sle16(int16_t x, int16_t y) {\n  return x <= y;\n}\n\nSCALAR_FUN_ATTR bool sle32(int32_t x, int32_t y) {\n  return x <= y;\n}\n\nSCALAR_FUN_ATTR bool sle64(int64_t x, int64_t y) {\n  return x <= y;\n}\n\nSCALAR_FUN_ATTR uint8_t pow8(uint8_t x, uint8_t y) {\n  uint8_t res = 1, rem = y;\n\n  while (rem != 0) {\n    if (rem & 1)\n      res *= x;\n    rem >>= 1;\n    x *= x;\n  }\n  return res;\n}\n\nSCALAR_FUN_ATTR uint16_t pow16(uint16_t x, uint16_t y) {\n  uint16_t res = 1, rem = y;\n\n  while (rem != 0) {\n    if (rem & 1)\n      res *= x;\n    rem >>= 1;\n    x *= x;\n  }\n  return res;\n}\n\nSCALAR_FUN_ATTR uint32_t pow32(uint32_t x, uint32_t y) {\n  uint32_t res = 1, rem = y;\n\n  while (rem != 0) {\n    if (rem & 1)\n      res *= x;\n    rem >>= 1;\n    x *= x;\n  }\n  return res;\n}\n\nSCALAR_FUN_ATTR uint64_t pow64(uint64_t x, uint64_t y) {\n  uint64_t res = 1, rem = y;\n\n  while (rem != 0) {\n    if (rem & 1)\n      res *= x;\n    rem >>= 1;\n    x *= x;\n  }\n  return res;\n}\n\nSCALAR_FUN_ATTR bool itob_i8_bool(int8_t x) {\n  return x != 0;\n}\n\nSCALAR_FUN_ATTR bool itob_i16_bool(int16_t x) {\n  return x != 0;\n}\n\nSCALAR_FUN_ATTR bool itob_i32_bool(int32_t x) {\n  return x != 0;\n}\n\nSCALAR_FUN_ATTR bool itob_i64_bool(int64_t x) {\n  return x != 0;\n}\n\nSCALAR_FUN_ATTR int8_t btoi_bool_i8(bool x) {\n  return x;\n}\n\nSCALAR_FUN_ATTR int16_t btoi_bool_i16(bool x",
                                    ") {\n  return x;\n}\n\nSCALAR_FUN_ATTR int32_t btoi_bool_i32(bool x) {\n  return x;\n}\n\nSCALAR_FUN_ATTR int64_t btoi_bool_i64(bool x) {\n  return x;\n}\n\n#define sext_i8_i8(x) ((int8_t) (int8_t) (x))\n#define sext_i8_i16(x) ((int16_t) (int8_t) (x))\n#define sext_i8_i32(x) ((int32_t) (int8_t) (x))\n#define sext_i8_i64(x) ((int64_t) (int8_t) (x))\n#define sext_i16_i8(x) ((int8_t) (int16_t) (x))\n#define sext_i16_i16(x) ((int16_t) (int16_t) (x))\n#define sext_i16_i32(x) ((int32_t) (int16_t) (x))\n#define sext_i16_i64(x) ((int64_t) (int16_t) (x))\n#define sext_i32_i8(x) ((int8_t) (int32_t) (x))\n#define sext_i32_i16(x) ((int16_t) (int32_t) (x))\n#define sext_i32_i32(x) ((int32_t) (int32_t) (x))\n#define sext_i32_i64(x) ((int64_t) (int32_t) (x))\n#define sext_i64_i8(x) ((int8_t) (int64_t) (x))\n#define sext_i64_i16(x) ((int16_t) (int64_t) (x))\n#define sext_i64_i32(x) ((int32_t) (int64_t) (x))\n#define sext_i64_i64(x) ((int64_t) (int64_t) (x))\n#define zext_i8_i8(x) ((int8_t) (uint8_t) (x))\n#define zext_i8_i16(x) ((int16_t) (uint8_t) (x))\n#define zext_i8_i32(x) ((int32_t) (uint8_t) (x))\n#define zext_i8_i64(x) ((int64_t) (uint8_t) (x))\n#define zext_i16_i8(x) ((int8_t) (uint16_t) (x))\n#define zext_i16_i16(x) ((int16_t) (uint16_t) (x))\n#define zext_i16_i32(x) ((int32_t) (uint16_t) (x))\n#define zext_i16_i64(x) ((int64_t) (uint16_t) (x))\n#define zext_i32_i8(x) ((int8_t) (uint32_t) (x))\n#define zext_i32_i16(x) ((int16_t) (uint32_t) (x))\n#define zext_i32_i32(x) ((int32_t) (uint32_t) (x))\n#define zext_i32_i64(x) ((int64_t) (uint32_t) (x))\n#define zext_i64_i8(x) ((int8_t) (uint64_t) (x))\n#define zext_i64_i16(x) ((int16_t) (uint64_t) (x))\n#define zext_i64_i32(x) ((int32_t) (uint64_t) (x))\n#define zext_i64_i64(x) ((int64_t) (uint64_t) (x))\n\nSCALAR_FUN_ATTR int8_t abs8(int8_t x) {\n  return (int8_t)abs(x);\n}\n\nSCALAR_FUN_ATTR int16_t abs16(int16_t x) {\n  return (int16_t)abs(x);\n}\n\nSCALAR_FUN_ATTR int32_t abs32(int32_t x) {\n  return abs(x);\n}\n\nSCALAR_FUN_ATTR int64_t abs64(int64_t x) {\n#if defined(__OPENCL_VER", "SION__) || defined(ISPC)\n  return abs(x);\n#else\n  return llabs(x);\n#endif\n}\n\n#if defined(__OPENCL_VERSION__)\nSCALAR_FUN_ATTR int32_t futrts_popc8(int8_t x) {\n  return popcount(x);\n}\n\nSCALAR_FUN_ATTR int32_t futrts_popc16(int16_t x) {\n  return popcount(x);\n}\n\nSCALAR_FUN_ATTR int32_t futrts_popc32(int32_t x) {\n  return popcount(x);\n}\n\nSCALAR_FUN_ATTR int32_t futrts_popc64(int64_t x) {\n  return popcount(x);\n}\n#elif defined(__CUDA_ARCH__)\n\nSCALAR_FUN_ATTR int32_t futrts_popc8(int8_t x) {\n  return __popc(zext_i8_i32(x));\n}\n\nSCALAR_FUN_ATTR int32_t futrts_popc16(int16_t x) {\n  return __popc(zext_i16_i32(x));\n}\n\nSCALAR_FUN_ATTR int32_t futrts_popc32(int32_t x) {\n  return __popc(x);\n}\n\nSCALAR_FUN_ATTR int32_t futrts_popc64(int64_t x) {\n  return __popcll(x);\n}\n\n#else // Not OpenCL or CUDA, but plain C.\n\nSCALAR_FUN_ATTR int32_t futrts_popc8(uint8_t x) {\n  int c = 0;\n  for (; x; ++c) { x &= x - 1; }\n  return c;\n}\n\nSCALAR_FUN_ATTR int32_t futrts_popc16(uint16_t x) {\n  int c = 0;\n  for (; x; ++c) { x &= x - 1; }\n  return c;\n}\n\nSCALAR_FUN_ATTR int32_t futrts_popc32(uint32_t x) {\n  int c = 0;\n  for (; x; ++c) { x &= x - 1; }\n  return c;\n}\n\nSCALAR_FUN_ATTR int32_t futrts_popc64(uint64_t x) {\n  int c = 0;\n  for (; x; ++c) { x &= x - 1; }\n  return c;\n}\n#endif\n\n#if defined(__OPENCL_VERSION__)\nSCALAR_FUN_ATTR uint8_t  futrts_umul_hi8 ( uint8_t a,  uint8_t b) { return mul_hi(a, b); }\nSCALAR_FUN_ATTR uint16_t futrts_umul_hi16(uint16_t a, uint16_t b) { return mul_hi(a, b); }\nSCALAR_FUN_ATTR uint32_t futrts_umul_hi32(uint32_t a, uint32_t b) { return mul_hi(a, b); }\nSCALAR_FUN_ATTR uint64_t futrts_umul_hi64(uint64_t a, uint64_t b) { return mul_hi(a, b); }\nSCALAR_FUN_ATTR uint8_t  futrts_smul_hi8 ( int8_t a,  int8_t b) { return mul_hi(a, b); }\nSCALAR_FUN_ATTR uint16_t futrts_smul_hi16(int16_t a, int16_t b) { return mul_hi(a, b); }\nSCALAR_FUN_ATTR uint32_t futrts_smul_hi32(int32_t a, int32_t b) { return mul_hi(a, b); }\nSCALAR_FUN_ATTR uint64_t futrts_smul_hi64(int64_t a, int64_t b) { return m", "ul_hi(a, b); }\n#elif defined(__CUDA_ARCH__)\nSCALAR_FUN_ATTR  uint8_t futrts_umul_hi8(uint8_t a, uint8_t b) { return ((uint16_t)a) * ((uint16_t)b) >> 8; }\nSCALAR_FUN_ATTR uint16_t futrts_umul_hi16(uint16_t a, uint16_t b) { return ((uint32_t)a) * ((uint32_t)b) >> 16; }\nSCALAR_FUN_ATTR uint32_t futrts_umul_hi32(uint32_t a, uint32_t b) { return __umulhi(a, b); }\nSCALAR_FUN_ATTR uint64_t futrts_umul_hi64(uint64_t a, uint64_t b) { return __umul64hi(a, b); }\nSCALAR_FUN_ATTR  uint8_t futrts_smul_hi8 ( int8_t a, int8_t b) { return ((int16_t)a) * ((int16_t)b) >> 8; }\nSCALAR_FUN_ATTR uint16_t futrts_smul_hi16(int16_t a, int16_t b) { return ((int32_t)a) * ((int32_t)b) >> 16; }\nSCALAR_FUN_ATTR uint32_t futrts_smul_hi32(int32_t a, int32_t b) { return __mulhi(a, b); }\nSCALAR_FUN_ATTR uint64_t futrts_smul_hi64(int64_t a, int64_t b) { return __mul64hi(a, b); }\n#elif ISPC\nSCALAR_FUN_ATTR uint8_t futrts_umul_hi8(uint8_t a, uint8_t b) { return ((uint16_t)a) * ((uint16_t)b) >> 8; }\nSCALAR_FUN_ATTR uint16_t futrts_umul_hi16(uint16_t a, uint16_t b) { return ((uint32_t)a) * ((uint32_t)b) >> 16; }\nSCALAR_FUN_ATTR uint32_t futrts_umul_hi32(uint32_t a, uint32_t b) { return ((uint64_t)a) * ((uint64_t)b) >> 32; }\nSCALAR_FUN_ATTR uint64_t futrts_umul_hi64(uint64_t a, uint64_t b) {\n  uint64_t ah = a >> 32;\n  uint64_t al = a & 0xffffffff;\n  uint64_t bh = b >> 32;\n  uint64_t bl = b & 0xffffffff;\n\n  uint64_t p1 = al * bl;\n  uint64_t p2 = al * bh;\n  uint64_t p3 = ah * bl;\n  uint64_t p4 = ah * bh;\n\n  uint64_t p1h = p1 >> 32;\n  uint64_t p2h = p2 >> 32;\n  uint64_t p3h = p3 >> 32;\n  uint64_t p2l = p2 & 0xffffffff;\n  uint64_t p3l = p3 & 0xffffffff;\n\n  uint64_t l = p1h + p2l + p3l;\n  uint64_t m = (p2 >> 32) + (p3 >> 32);\n  uint64_t h = (l >> 32) + m + p4;\n\n  return h;\n}\nSCALAR_FUN_ATTR  int8_t futrts_smul_hi8 ( int8_t a,  int8_t b) { return ((uint16_t)a) * ((uint16_t)b) >> 8; }\nSCALAR_FUN_ATTR int16_t futrts_smul_hi16(int16_t a, int16_t b) { return ((uint32_t)a) * ((uint32_t)b) >> 16; }\nSCALAR_FUN_ATTR int",
                                    "32_t futrts_smul_hi32(int32_t a, int32_t b) { return ((uint64_t)a) * ((uint64_t)b) >> 32; }\nSCALAR_FUN_ATTR int64_t futrts_smul_hi64(int64_t a, int64_t b) {\n  uint64_t ah = a >> 32;\n  uint64_t al = a & 0xffffffff;\n  uint64_t bh = b >> 32;\n  uint64_t bl = b & 0xffffffff;\n\n  uint64_t p1 =  al * bl;\n  int64_t  p2 = al * bh;\n  int64_t  p3 = ah * bl;\n  uint64_t p4 =  ah * bh;\n\n  uint64_t p1h = p1 >> 32;\n  uint64_t p2h = p2 >> 32;\n  uint64_t p3h = p3 >> 32;\n  uint64_t p2l = p2 & 0xffffffff;\n  uint64_t p3l = p3 & 0xffffffff;\n\n  uint64_t l = p1h + p2l + p3l;\n  uint64_t m = (p2 >> 32) + (p3 >> 32);\n  uint64_t h = (l >> 32) + m + p4;\n\n  return h;\n}\n\n#else // Not OpenCL, ISPC, or CUDA, but plain C.\nSCALAR_FUN_ATTR uint8_t futrts_umul_hi8(uint8_t a, uint8_t b) { return ((uint16_t)a) * ((uint16_t)b) >> 8; }\nSCALAR_FUN_ATTR uint16_t futrts_umul_hi16(uint16_t a, uint16_t b) { return ((uint32_t)a) * ((uint32_t)b) >> 16; }\nSCALAR_FUN_ATTR uint32_t futrts_umul_hi32(uint32_t a, uint32_t b) { return ((uint64_t)a) * ((uint64_t)b) >> 32; }\nSCALAR_FUN_ATTR uint64_t futrts_umul_hi64(uint64_t a, uint64_t b) { return ((__uint128_t)a) * ((__uint128_t)b) >> 64; }\nSCALAR_FUN_ATTR int8_t futrts_smul_hi8(int8_t a, int8_t b) { return ((int16_t)a) * ((int16_t)b) >> 8; }\nSCALAR_FUN_ATTR int16_t futrts_smul_hi16(int16_t a, int16_t b) { return ((int32_t)a) * ((int32_t)b) >> 16; }\nSCALAR_FUN_ATTR int32_t futrts_smul_hi32(int32_t a, int32_t b) { return ((int64_t)a) * ((int64_t)b) >> 32; }\nSCALAR_FUN_ATTR int64_t futrts_smul_hi64(int64_t a, int64_t b) { return ((__int128_t)a) * ((__int128_t)b) >> 64; }\n#endif\n\n#if defined(__OPENCL_VERSION__)\nSCALAR_FUN_ATTR  uint8_t futrts_umad_hi8 ( uint8_t a,  uint8_t b,  uint8_t c) { return mad_hi(a, b, c); }\nSCALAR_FUN_ATTR uint16_t futrts_umad_hi16(uint16_t a, uint16_t b, uint16_t c) { return mad_hi(a, b, c); }\nSCALAR_FUN_ATTR uint32_t futrts_umad_hi32(uint32_t a, uint32_t b, uint32_t c) { return mad_hi(a, b, c); }\nSCALAR_FUN_ATTR uint64_t futrts_umad_hi64(uint64_t ", "a, uint64_t b, uint64_t c) { return mad_hi(a, b, c); }\nSCALAR_FUN_ATTR  uint8_t futrts_smad_hi8( int8_t a,  int8_t b,   int8_t c) { return mad_hi(a, b, c); }\nSCALAR_FUN_ATTR uint16_t futrts_smad_hi16(int16_t a, int16_t b, int16_t c) { return mad_hi(a, b, c); }\nSCALAR_FUN_ATTR uint32_t futrts_smad_hi32(int32_t a, int32_t b, int32_t c) { return mad_hi(a, b, c); }\nSCALAR_FUN_ATTR uint64_t futrts_smad_hi64(int64_t a, int64_t b, int64_t c) { return mad_hi(a, b, c); }\n#else // Not OpenCL\n\nSCALAR_FUN_ATTR  uint8_t futrts_umad_hi8( uint8_t a,  uint8_t b,  uint8_t c) { return futrts_umul_hi8(a, b) + c; }\nSCALAR_FUN_ATTR uint16_t futrts_umad_hi16(uint16_t a, uint16_t b, uint16_t c) { return futrts_umul_hi16(a, b) + c; }\nSCALAR_FUN_ATTR uint32_t futrts_umad_hi32(uint32_t a, uint32_t b, uint32_t c) { return futrts_umul_hi32(a, b) + c; }\nSCALAR_FUN_ATTR uint64_t futrts_umad_hi64(uint64_t a, uint64_t b, uint64_t c) { return futrts_umul_hi64(a, b) + c; }\nSCALAR_FUN_ATTR  uint8_t futrts_smad_hi8 ( int8_t a,  int8_t b,  int8_t c) { return futrts_smul_hi8(a, b) + c; }\nSCALAR_FUN_ATTR uint16_t futrts_smad_hi16(int16_t a, int16_t b, int16_t c) { return futrts_smul_hi16(a, b) + c; }\nSCALAR_FUN_ATTR uint32_t futrts_smad_hi32(int32_t a, int32_t b, int32_t c) { return futrts_smul_hi32(a, b) + c; }\nSCALAR_FUN_ATTR uint64_t futrts_smad_hi64(int64_t a, int64_t b, int64_t c) { return futrts_smul_hi64(a, b) + c; }\n#endif\n\n#if defined(__OPENCL_VERSION__)\nSCALAR_FUN_ATTR int32_t futrts_clzz8(int8_t x) {\n  return clz(x);\n}\n\nSCALAR_FUN_ATTR int32_t futrts_clzz16(int16_t x) {\n  return clz(x);\n}\n\nSCALAR_FUN_ATTR int32_t futrts_clzz32(int32_t x) {\n  return clz(x);\n}\n\nSCALAR_FUN_ATTR int32_t futrts_clzz64(int64_t x) {\n  return clz(x);\n}\n\n#elif defined(__CUDA_ARCH__)\n\nSCALAR_FUN_ATTR int32_t futrts_clzz8(int8_t x) {\n  return __clz(zext_i8_i32(x)) - 24;\n}\n\nSCALAR_FUN_ATTR int32_t futrts_clzz16(int16_t x) {\n  return __clz(zext_i16_i32(x)) - 16;\n}\n\nSCALAR_FUN_ATTR int32_t futrts_clzz32(int32_t x) {\n  retur", "n __clz(x);\n}\n\nSCALAR_FUN_ATTR int32_t futrts_clzz64(int64_t x) {\n  return __clzll(x);\n}\n\n#elif ISPC\n\nSCALAR_FUN_ATTR int32_t futrts_clzz8(int8_t x) {\n  return count_leading_zeros((int32_t)(uint8_t)x)-24;\n}\n\nSCALAR_FUN_ATTR int32_t futrts_clzz16(int16_t x) {\n  return count_leading_zeros((int32_t)(uint16_t)x)-16;\n}\n\nSCALAR_FUN_ATTR int32_t futrts_clzz32(int32_t x) {\n  return count_leading_zeros(x);\n}\n\nSCALAR_FUN_ATTR int32_t futrts_clzz64(int64_t x) {\n  return count_leading_zeros(x);\n}\n\n#else // Not OpenCL, ISPC or CUDA, but plain C.\n\nSCALAR_FUN_ATTR int32_t futrts_clzz8(int8_t x) {\n  return x == 0 ? 8 : __builtin_clz((uint32_t)zext_i8_i32(x)) - 24;\n}\n\nSCALAR_FUN_ATTR int32_t futrts_clzz16(int16_t x) {\n  return x == 0 ? 16 : __builtin_clz((uint32_t)zext_i16_i32(x)) - 16;\n}\n\nSCALAR_FUN_ATTR int32_t futrts_clzz32(int32_t x) {\n  return x == 0 ? 32 : __builtin_clz((uint32_t)x);\n}\n\nSCALAR_FUN_ATTR int32_t futrts_clzz64(int64_t x) {\n  return x == 0 ? 64 : __builtin_clzll((uint64_t)x);\n}\n#endif\n\n#if defined(__OPENCL_VERSION__)\nSCALAR_FUN_ATTR int32_t futrts_ctzz8(int8_t x) {\n  int i = 0;\n  for (; i < 8 && (x & 1) == 0; i++, x >>= 1)\n    ;\n  return i;\n}\n\nSCALAR_FUN_ATTR int32_t futrts_ctzz16(int16_t x) {\n  int i = 0;\n  for (; i < 16 && (x & 1) == 0; i++, x >>= 1)\n    ;\n  return i;\n}\n\nSCALAR_FUN_ATTR int32_t futrts_ctzz32(int32_t x) {\n  int i = 0;\n  for (; i < 32 && (x & 1) == 0; i++, x >>= 1)\n    ;\n  return i;\n}\n\nSCALAR_FUN_ATTR int32_t futrts_ctzz64(int64_t x) {\n  int i = 0;\n  for (; i < 64 && (x & 1) == 0; i++, x >>= 1)\n    ;\n  return i;\n}\n\n#elif defined(__CUDA_ARCH__)\n\nSCALAR_FUN_ATTR int32_t futrts_ctzz8(int8_t x) {\n  int y = __ffs(x);\n  return y == 0 ? 8 : y - 1;\n}\n\nSCALAR_FUN_ATTR int32_t futrts_ctzz16(int16_t x) {\n  int y = __ffs(x);\n  return y == 0 ? 16 : y - 1;\n}\n\nSCALAR_FUN_ATTR int32_t futrts_ctzz32(int32_t x) {\n  int y = __ffs(x);\n  return y == 0 ? 32 : y - 1;\n}\n\nSCALAR_FUN_ATTR int32_t futrts_ctzz64(int64_t x) {\n  int y = __ffsll(x);\n  return y == 0 ? 64 : y - 1",
                                    ";\n}\n\n#elif ISPC\n\nSCALAR_FUN_ATTR int32_t futrts_ctzz8(int8_t x) {\n  return x == 0 ? 8 : count_trailing_zeros((int32_t)x);\n}\n\nSCALAR_FUN_ATTR int32_t futrts_ctzz16(int16_t x) {\n  return x == 0 ? 16 : count_trailing_zeros((int32_t)x);\n}\n\nSCALAR_FUN_ATTR int32_t futrts_ctzz32(int32_t x) {\n  return count_trailing_zeros(x);\n}\n\nSCALAR_FUN_ATTR int32_t futrts_ctzz64(int64_t x) {\n  return count_trailing_zeros(x);\n}\n\n#else // Not OpenCL or CUDA, but plain C.\n\nSCALAR_FUN_ATTR int32_t futrts_ctzz8(int8_t x) {\n  return x == 0 ? 8 : __builtin_ctz((uint32_t)x);\n}\n\nSCALAR_FUN_ATTR int32_t futrts_ctzz16(int16_t x) {\n  return x == 0 ? 16 : __builtin_ctz((uint32_t)x);\n}\n\nSCALAR_FUN_ATTR int32_t futrts_ctzz32(int32_t x) {\n  return x == 0 ? 32 : __builtin_ctz((uint32_t)x);\n}\n\nSCALAR_FUN_ATTR int32_t futrts_ctzz64(int64_t x) {\n  return x == 0 ? 64 : __builtin_ctzll((uint64_t)x);\n}\n#endif\n\nSCALAR_FUN_ATTR float fdiv32(float x, float y) {\n  return x / y;\n}\n\nSCALAR_FUN_ATTR float fadd32(float x, float y) {\n  return x + y;\n}\n\nSCALAR_FUN_ATTR float fsub32(float x, float y) {\n  return x - y;\n}\n\nSCALAR_FUN_ATTR float fmul32(float x, float y) {\n  return x * y;\n}\n\nSCALAR_FUN_ATTR bool cmplt32(float x, float y) {\n  return x < y;\n}\n\nSCALAR_FUN_ATTR bool cmple32(float x, float y) {\n  return x <= y;\n}\n\nSCALAR_FUN_ATTR float sitofp_i8_f32(int8_t x) {\n  return (float) x;\n}\n\nSCALAR_FUN_ATTR float sitofp_i16_f32(int16_t x) {\n  return (float) x;\n}\n\nSCALAR_FUN_ATTR float sitofp_i32_f32(int32_t x) {\n  return (float) x;\n}\n\nSCALAR_FUN_ATTR float sitofp_i64_f32(int64_t x) {\n  return (float) x;\n}\n\nSCALAR_FUN_ATTR float uitofp_i8_f32(uint8_t x) {\n  return (float) x;\n}\n\nSCALAR_FUN_ATTR float uitofp_i16_f32(uint16_t x) {\n  return (float) x;\n}\n\nSCALAR_FUN_ATTR float uitofp_i32_f32(uint32_t x) {\n  return (float) x;\n}\n\nSCALAR_FUN_ATTR float uitofp_i64_f32(uint64_t x) {\n  return (float) x;\n}\n\n#ifdef __OPENCL_VERSION__\nSCALAR_FUN_ATTR float fabs32(float x) {\n  return fabs(x);\n}\n\nSCALAR_FUN_ATTR float fmax32(float x, f", "loat y) {\n  return fmax(x, y);\n}\n\nSCALAR_FUN_ATTR float fmin32(float x, float y) {\n  return fmin(x, y);\n}\n\nSCALAR_FUN_ATTR float fpow32(float x, float y) {\n  return pow(x, y);\n}\n\n#elif ISPC\n\nSCALAR_FUN_ATTR float fabs32(float x) {\n  return abs(x);\n}\n\nSCALAR_FUN_ATTR float fmax32(float x, float y) {\n  return isnan(x) ? y : isnan(y) ? x : max(x, y);\n}\n\nSCALAR_FUN_ATTR float fmin32(float x, float y) {\n  return isnan(x) ? y : isnan(y) ? x : min(x, y);\n}\n\nSCALAR_FUN_ATTR float fpow32(float a, float b) {\n  float ret;\n  foreach_active (i) {\n      uniform float r = __stdlib_powf(extract(a, i), extract(b, i));\n      ret = insert(ret, i, r);\n  }\n  return ret;\n}\n\n#else // Not OpenCL, but CUDA or plain C.\n\nSCALAR_FUN_ATTR float fabs32(float x) {\n  return fabsf(x);\n}\n\nSCALAR_FUN_ATTR float fmax32(float x, float y) {\n  return fmaxf(x, y);\n}\n\nSCALAR_FUN_ATTR float fmin32(float x, float y) {\n  return fminf(x, y);\n}\n\nSCALAR_FUN_ATTR float fpow32(float x, float y) {\n  return powf(x, y);\n}\n#endif\n\nSCALAR_FUN_ATTR bool futrts_isnan32(float x) {\n  return isnan(x);\n}\n\n#if ISPC\n\nSCALAR_FUN_ATTR bool futrts_isinf32(float x) {\n  return !isnan(x) && isnan(x - x);\n}\n\nSCALAR_FUN_ATTR bool futrts_isfinite32(float x) {\n  return !isnan(x) && !futrts_isinf32(x);\n}\n\n#else\n\nSCALAR_FUN_ATTR bool futrts_isinf32(float x) {\n  return isinf(x);\n}\n\n#endif\n\nSCALAR_FUN_ATTR int8_t fptosi_f32_i8(float x) {\n  if (futrts_isnan32(x) || futrts_isinf32(x)) {\n    return 0;\n  } else {\n    return (int8_t) x;\n  }\n}\n\nSCALAR_FUN_ATTR int16_t fptosi_f32_i16(float x) {\n  if (futrts_isnan32(x) || futrts_isinf32(x)) {\n    return 0;\n  } else {\n    return (int16_t) x;\n  }\n}\n\nSCALAR_FUN_ATTR int32_t fptosi_f32_i32(float x) {\n  if (futrts_isnan32(x) || futrts_isinf32(x)) {\n    return 0;\n  } else {\n    return (int32_t) x;\n  }\n}\n\nSCALAR_FUN_ATTR int64_t fptosi_f32_i64(float x) {\n  if (futrts_isnan32(x) || futrts_isinf32(x)) {\n    return 0;\n  } else {\n    return (int64_t) x;\n  };\n}\n\nSCALAR_FUN_ATTR uint8_t fptoui_f32_i8(float x) {", "\n  if (futrts_isnan32(x) || futrts_isinf32(x)) {\n    return 0;\n  } else {\n    return (uint8_t) (int8_t) x;\n  }\n}\n\nSCALAR_FUN_ATTR uint16_t fptoui_f32_i16(float x) {\n  if (futrts_isnan32(x) || futrts_isinf32(x)) {\n    return 0;\n  } else {\n    return (uint16_t) (int16_t) x;\n  }\n}\n\nSCALAR_FUN_ATTR uint32_t fptoui_f32_i32(float x) {\n  if (futrts_isnan32(x) || futrts_isinf32(x)) {\n    return 0;\n  } else {\n    return (uint32_t) (int32_t) x;\n  }\n}\n\nSCALAR_FUN_ATTR uint64_t fptoui_f32_i64(float x) {\n  if (futrts_isnan32(x) || futrts_isinf32(x)) {\n    return 0;\n  } else {\n    return (uint64_t) (int64_t) x;\n  }\n}\n\nSCALAR_FUN_ATTR bool ftob_f32_bool(float x) {\n  return x != 0;\n}\n\nSCALAR_FUN_ATTR float btof_bool_f32(bool x) {\n  return x ? 1 : 0;\n}\n\n#ifdef __OPENCL_VERSION__\nSCALAR_FUN_ATTR float futrts_log32(float x) {\n  return log(x);\n}\n\nSCALAR_FUN_ATTR float futrts_log2_32(float x) {\n  return log2(x);\n}\n\nSCALAR_FUN_ATTR float futrts_log10_32(float x) {\n  return log10(x);\n}\n\nSCALAR_FUN_ATTR float futrts_log1p_32(float x) {\n  return log1p(x);\n}\n\nSCALAR_FUN_ATTR float futrts_sqrt32(float x) {\n  return sqrt(x);\n}\n\nSCALAR_FUN_ATTR float futrts_cbrt32(float x) {\n  return cbrt(x);\n}\n\nSCALAR_FUN_ATTR float futrts_exp32(float x) {\n  return exp(x);\n}\n\nSCALAR_FUN_ATTR float futrts_cos32(float x) {\n  return cos(x);\n}\n\nSCALAR_FUN_ATTR float futrts_sin32(float x) {\n  return sin(x);\n}\n\nSCALAR_FUN_ATTR float futrts_tan32(float x) {\n  return tan(x);\n}\n\nSCALAR_FUN_ATTR float futrts_acos32(float x) {\n  return acos(x);\n}\n\nSCALAR_FUN_ATTR float futrts_asin32(float x) {\n  return asin(x);\n}\n\nSCALAR_FUN_ATTR float futrts_atan32(float x) {\n  return atan(x);\n}\n\nSCALAR_FUN_ATTR float futrts_cosh32(float x) {\n  return cosh(x);\n}\n\nSCALAR_FUN_ATTR float futrts_sinh32(float x) {\n  return sinh(x);\n}\n\nSCALAR_FUN_ATTR float futrts_tanh32(float x) {\n  return tanh(x);\n}\n\nSCALAR_FUN_ATTR float futrts_acosh32(float x) {\n  return acosh(x);\n}\n\nSCALAR_FUN_ATTR float futrts_asinh32(float x) {\n  return asinh(x);\n}\n\nSC",
                                    "ALAR_FUN_ATTR float futrts_atanh32(float x) {\n  return atanh(x);\n}\n\nSCALAR_FUN_ATTR float futrts_atan2_32(float x, float y) {\n  return atan2(x, y);\n}\n\nSCALAR_FUN_ATTR float futrts_hypot32(float x, float y) {\n  return hypot(x, y);\n}\n\nSCALAR_FUN_ATTR float futrts_gamma32(float x) {\n  return tgamma(x);\n}\n\nSCALAR_FUN_ATTR float futrts_lgamma32(float x) {\n  return lgamma(x);\n}\n\nSCALAR_FUN_ATTR float futrts_erf32(float x) {\n  return erf(x);\n}\n\nSCALAR_FUN_ATTR float futrts_erfc32(float x) {\n  return erfc(x);\n}\n\nSCALAR_FUN_ATTR float fmod32(float x, float y) {\n  return fmod(x, y);\n}\n\nSCALAR_FUN_ATTR float futrts_round32(float x) {\n  return rint(x);\n}\n\nSCALAR_FUN_ATTR float futrts_floor32(float x) {\n  return floor(x);\n}\n\nSCALAR_FUN_ATTR float futrts_ceil32(float x) {\n  return ceil(x);\n}\n\nSCALAR_FUN_ATTR float futrts_nextafter32(float x, float y) {\n  return nextafter(x, y);\n}\n\nSCALAR_FUN_ATTR float futrts_lerp32(float v0, float v1, float t) {\n  return mix(v0, v1, t);\n}\n\nSCALAR_FUN_ATTR float futrts_ldexp32(float x, int32_t y) {\n  return ldexp(x, y);\n}\n\nSCALAR_FUN_ATTR float futrts_copysign32(float x, float y) {\n  return copysign(x, y);\n}\n\nSCALAR_FUN_ATTR float futrts_mad32(float a, float b, float c) {\n  return mad(a, b, c);\n}\n\nSCALAR_FUN_ATTR float futrts_fma32(float a, float b, float c) {\n  return fma(a, b, c);\n}\n\n#elif ISPC\n\nSCALAR_FUN_ATTR float futrts_log32(float x) {\n  return futrts_isfinite32(x) || (futrts_isinf32(x) && x < 0)? log(x) : x;\n}\n\nSCALAR_FUN_ATTR float futrts_log2_32(float x) {\n  return futrts_log32(x) / log(2.0f);\n}\n\nSCALAR_FUN_ATTR float futrts_log10_32(float x) {\n  return futrts_log32(x) / log(10.0f);\n}\n\nSCALAR_FUN_ATTR float futrts_log1p_32(float x) {\n  if(x == -1.0f || (futrts_isinf32(x) && x > 0.0f)) return x / 0.0f;\n  float y = 1.0f + x;\n  float z = y - 1.0f;\n  return log(y) - (z-x)/y;\n}\n\nSCALAR_FUN_ATTR float futrts_sqrt32(float x) {\n  return sqrt(x);\n}\n\nextern \"C\" unmasked uniform float cbrtf(uniform float);\nSCALAR_FUN_ATTR float futrts_cbrt32(float", " x) {\n  float res;\n  foreach_active (i) {\n    uniform float r = cbrtf(extract(x, i));\n    res = insert(res, i, r);\n  }\n  return res;\n}\n\nSCALAR_FUN_ATTR float futrts_exp32(float x) {\n  return exp(x);\n}\n\nSCALAR_FUN_ATTR float futrts_cos32(float x) {\n  return cos(x);\n}\n\nSCALAR_FUN_ATTR float futrts_sin32(float x) {\n  return sin(x);\n}\n\nSCALAR_FUN_ATTR float futrts_tan32(float x) {\n  return tan(x);\n}\n\nSCALAR_FUN_ATTR float futrts_acos32(float x) {\n  return acos(x);\n}\n\nSCALAR_FUN_ATTR float futrts_asin32(float x) {\n  return asin(x);\n}\n\nSCALAR_FUN_ATTR float futrts_atan32(float x) {\n  return atan(x);\n}\n\nSCALAR_FUN_ATTR float futrts_cosh32(float x) {\n  return (exp(x)+exp(-x)) / 2.0f;\n}\n\nSCALAR_FUN_ATTR float futrts_sinh32(float x) {\n  return (exp(x)-exp(-x)) / 2.0f;\n}\n\nSCALAR_FUN_ATTR float futrts_tanh32(float x) {\n  return futrts_sinh32(x)/futrts_cosh32(x);\n}\n\nSCALAR_FUN_ATTR float futrts_acosh32(float x) {\n  float f = x+sqrt(x*x-1);\n  if(futrts_isfinite32(f)) return log(f);\n  return f;\n}\n\nSCALAR_FUN_ATTR float futrts_asinh32(float x) {\n  float f = x+sqrt(x*x+1);\n  if(futrts_isfinite32(f)) return log(f);\n  return f;\n\n}\n\nSCALAR_FUN_ATTR float futrts_atanh32(float x) {\n  float f = (1+x)/(1-x);\n  if(futrts_isfinite32(f)) return log(f)/2.0f;\n  return f;\n\n}\n\nSCALAR_FUN_ATTR float futrts_atan2_32(float x, float y) {\n  return (x == 0.0f && y == 0.0f) ? 0.0f : atan2(x, y);\n}\n\nSCALAR_FUN_ATTR float futrts_hypot32(float x, float y) {\n  if (futrts_isfinite32(x) && futrts_isfinite32(y)) {\n    x = abs(x);\n    y = abs(y);\n    float a;\n    float b;\n    if (x >= y){\n        a = x;\n        b = y;\n    } else {\n        a = y;\n        b = x;\n    }\n    if(b == 0){\n      return a;\n    }\n\n    int e;\n    float an;\n    float bn;\n    an = frexp (a, &e);\n    bn = ldexp (b, - e);\n    float cn;\n    cn = sqrt (an * an + bn * bn);\n    return ldexp (cn, e);\n  } else {\n    if (futrts_isinf32(x) || futrts_isinf32(y)) return INFINITY;\n    else return x + y;\n  }\n\n}\n\nextern \"C\" unmasked uniform float tgammaf(", "uniform float x);\nSCALAR_FUN_ATTR float futrts_gamma32(float x) {\n  float res;\n  foreach_active (i) {\n    uniform float r = tgammaf(extract(x, i));\n    res = insert(res, i, r);\n  }\n  return res;\n}\n\nextern \"C\" unmasked uniform float lgammaf(uniform float x);\nSCALAR_FUN_ATTR float futrts_lgamma32(float x) {\n  float res;\n  foreach_active (i) {\n    uniform float r = lgammaf(extract(x, i));\n    res = insert(res, i, r);\n  }\n  return res;\n}\n\nextern \"C\" unmasked uniform float erff(uniform float x);\nSCALAR_FUN_ATTR float futrts_erf32(float x) {\n  float res;\n  foreach_active (i) {\n    uniform float r = erff(extract(x, i));\n    res = insert(res, i, r);\n  }\n  return res;\n}\n\nextern \"C\" unmasked uniform float erfcf(uniform float x);\nSCALAR_FUN_ATTR float futrts_erfc32(float x) {\n  float res;\n  foreach_active (i) {\n    uniform float r = erfcf(extract(x, i));\n    res = insert(res, i, r);\n  }\n  return res;\n}\n\nSCALAR_FUN_ATTR float fmod32(float x, float y) {\n  return x - y * trunc(x/y);\n}\n\nSCALAR_FUN_ATTR float futrts_round32(float x) {\n  return round(x);\n}\n\nSCALAR_FUN_ATTR float futrts_floor32(float x) {\n  return floor(x);\n}\n\nSCALAR_FUN_ATTR float futrts_ceil32(float x) {\n  return ceil(x);\n}\n\nextern \"C\" unmasked uniform float nextafterf(uniform float x, uniform float y);\nSCALAR_FUN_ATTR float futrts_nextafter32(float x, float y) {\n  float res;\n  foreach_active (i) {\n    uniform float r = nextafterf(extract(x, i), extract(y, i));\n    res = insert(res, i, r);\n  }\n  return res;\n}\n\nSCALAR_FUN_ATTR float futrts_lerp32(float v0, float v1, float t) {\n  return v0 + (v1 - v0) * t;\n}\n\nSCALAR_FUN_ATTR float futrts_ldexp32(float x, int32_t y) {\n  return x * pow((double)2.0, (double)y);\n}\n\nSCALAR_FUN_ATTR float futrts_copysign32(float x, float y) {\n  int32_t xb = futrts_to_bits32(x);\n  int32_t yb = futrts_to_bits32(y);\n  return futrts_from_bits32((xb & ~(1<<31)) | (yb & (1<<31)));\n}\n\nSCALAR_FUN_ATTR float futrts_mad32(float a, float b, float c) {\n  return a * b + c;\n}\n\nSCALAR_FUN_ATTR float futr",
                                    "ts_fma32(float a, float b, float c) {\n  return a * b + c;\n}\n\n#else // Not OpenCL or ISPC, but CUDA or plain C.\n\nSCALAR_FUN_ATTR float futrts_log32(float x) {\n  return logf(x);\n}\n\nSCALAR_FUN_ATTR float futrts_log2_32(float x) {\n  return log2f(x);\n}\n\nSCALAR_FUN_ATTR float futrts_log10_32(float x) {\n  return log10f(x);\n}\n\nSCALAR_FUN_ATTR float futrts_log1p_32(float x) {\n  return log1pf(x);\n}\n\nSCALAR_FUN_ATTR float futrts_sqrt32(float x) {\n  return sqrtf(x);\n}\n\nSCALAR_FUN_ATTR float futrts_cbrt32(float x) {\n  return cbrtf(x);\n}\n\nSCALAR_FUN_ATTR float futrts_exp32(float x) {\n  return expf(x);\n}\n\nSCALAR_FUN_ATTR float futrts_cos32(float x) {\n  return cosf(x);\n}\n\nSCALAR_FUN_ATTR float futrts_sin32(float x) {\n  return sinf(x);\n}\n\nSCALAR_FUN_ATTR float futrts_tan32(float x) {\n  return tanf(x);\n}\n\nSCALAR_FUN_ATTR float futrts_acos32(float x) {\n  return acosf(x);\n}\n\nSCALAR_FUN_ATTR float futrts_asin32(float x) {\n  return asinf(x);\n}\n\nSCALAR_FUN_ATTR float futrts_atan32(float x) {\n  return atanf(x);\n}\n\nSCALAR_FUN_ATTR float futrts_cosh32(float x) {\n  return coshf(x);\n}\n\nSCALAR_FUN_ATTR float futrts_sinh32(float x) {\n  return sinhf(x);\n}\n\nSCALAR_FUN_ATTR float futrts_tanh32(float x) {\n  return tanhf(x);\n}\n\nSCALAR_FUN_ATTR float futrts_acosh32(float x) {\n  return acoshf(x);\n}\n\nSCALAR_FUN_ATTR float futrts_asinh32(float x) {\n  return asinhf(x);\n}\n\nSCALAR_FUN_ATTR float futrts_atanh32(float x) {\n  return atanhf(x);\n}\n\nSCALAR_FUN_ATTR float futrts_atan2_32(float x, float y) {\n  return atan2f(x, y);\n}\n\nSCALAR_FUN_ATTR float futrts_hypot32(float x, float y) {\n  return hypotf(x, y);\n}\n\nSCALAR_FUN_ATTR float futrts_gamma32(float x) {\n  return tgammaf(x);\n}\n\nSCALAR_FUN_ATTR float futrts_lgamma32(float x) {\n  return lgammaf(x);\n}\n\nSCALAR_FUN_ATTR float futrts_erf32(float x) {\n  return erff(x);\n}\n\nSCALAR_FUN_ATTR float futrts_erfc32(float x) {\n  return erfcf(x);\n}\n\nSCALAR_FUN_ATTR float fmod32(float x, float y) {\n  return fmodf(x, y);\n}\n\nSCALAR_FUN_ATTR float futrts_round32(float x) {\n  re", "turn rintf(x);\n}\n\nSCALAR_FUN_ATTR float futrts_floor32(float x) {\n  return floorf(x);\n}\n\nSCALAR_FUN_ATTR float futrts_ceil32(float x) {\n  return ceilf(x);\n}\n\nSCALAR_FUN_ATTR float futrts_nextafter32(float x, float y) {\n  return nextafterf(x, y);\n}\n\nSCALAR_FUN_ATTR float futrts_lerp32(float v0, float v1, float t) {\n  return v0 + (v1 - v0) * t;\n}\n\nSCALAR_FUN_ATTR float futrts_ldexp32(float x, int32_t y) {\n  return ldexpf(x, y);\n}\n\nSCALAR_FUN_ATTR float futrts_copysign32(float x, float y) {\n  return copysignf(x, y);\n}\n\nSCALAR_FUN_ATTR float futrts_mad32(float a, float b, float c) {\n  return a * b + c;\n}\n\nSCALAR_FUN_ATTR float futrts_fma32(float a, float b, float c) {\n  return fmaf(a, b, c);\n}\n#endif\n\n#if ISPC\nSCALAR_FUN_ATTR int32_t futrts_to_bits32(float x) {\n  return intbits(x);\n}\n\nSCALAR_FUN_ATTR float futrts_from_bits32(int32_t x) {\n  return floatbits(x);\n}\n#else\nSCALAR_FUN_ATTR int32_t futrts_to_bits32(float x) {\n  union {\n    float f;\n    int32_t t;\n  } p;\n\n  p.f = x;\n  return p.t;\n}\n\nSCALAR_FUN_ATTR float futrts_from_bits32(int32_t x) {\n  union {\n    int32_t f;\n    float t;\n  } p;\n\n  p.f = x;\n  return p.t;\n}\n#endif\n\nSCALAR_FUN_ATTR float fsignum32(float x) {\n  return futrts_isnan32(x) ? x : (x > 0 ? 1 : 0) - (x < 0 ? 1 : 0);\n}\n\n#ifdef FUTHARK_F64_ENABLED\n\nSCALAR_FUN_ATTR double futrts_from_bits64(int64_t x);\nSCALAR_FUN_ATTR int64_t futrts_to_bits64(double x);\n\n#if ISPC\nSCALAR_FUN_ATTR bool futrts_isinf64(float x) {\n  return !isnan(x) && isnan(x - x);\n}\n\nSCALAR_FUN_ATTR bool futrts_isfinite64(float x) {\n  return !isnan(x) && !futrts_isinf64(x);\n}\n\nSCALAR_FUN_ATTR double fdiv64(double x, double y) {\n  return x / y;\n}\n\nSCALAR_FUN_ATTR double fadd64(double x, double y) {\n  return x + y;\n}\n\nSCALAR_FUN_ATTR double fsub64(double x, double y) {\n  return x - y;\n}\n\nSCALAR_FUN_ATTR double fmul64(double x, double y) {\n  return x * y;\n}\n\nSCALAR_FUN_ATTR bool cmplt64(double x, double y) {\n  return x < y;\n}\n\nSCALAR_FUN_ATTR bool cmple64(double x, double y) {\n  return x <= y;\n}", "\n\nSCALAR_FUN_ATTR double sitofp_i8_f64(int8_t x) {\n  return (double) x;\n}\n\nSCALAR_FUN_ATTR double sitofp_i16_f64(int16_t x) {\n  return (double) x;\n}\n\nSCALAR_FUN_ATTR double sitofp_i32_f64(int32_t x) {\n  return (double) x;\n}\n\nSCALAR_FUN_ATTR double sitofp_i64_f64(int64_t x) {\n  return (double) x;\n}\n\nSCALAR_FUN_ATTR double uitofp_i8_f64(uint8_t x) {\n  return (double) x;\n}\n\nSCALAR_FUN_ATTR double uitofp_i16_f64(uint16_t x) {\n  return (double) x;\n}\n\nSCALAR_FUN_ATTR double uitofp_i32_f64(uint32_t x) {\n  return (double) x;\n}\n\nSCALAR_FUN_ATTR double uitofp_i64_f64(uint64_t x) {\n  return (double) x;\n}\n\nSCALAR_FUN_ATTR double fabs64(double x) {\n  return abs(x);\n}\n\nSCALAR_FUN_ATTR double fmax64(double x, double y) {\n  return isnan(x) ? y : isnan(y) ? x : max(x, y);\n}\n\nSCALAR_FUN_ATTR double fmin64(double x, double y) {\n  return isnan(x) ? y : isnan(y) ? x : min(x, y);\n}\n\nSCALAR_FUN_ATTR double fpow64(double a, double b) {\n  float ret;\n  foreach_active (i) {\n      uniform float r = __stdlib_powf(extract(a, i), extract(b, i));\n      ret = insert(ret, i, r);\n  }\n  return ret;\n}\n\nSCALAR_FUN_ATTR double futrts_log64(double x) {\n  return futrts_isfinite64(x) || (futrts_isinf64(x) && x < 0)? log(x) : x;\n}\n\nSCALAR_FUN_ATTR double futrts_log2_64(double x) {\n  return futrts_log64(x)/log(2.0d);\n}\n\nSCALAR_FUN_ATTR double futrts_log10_64(double x) {\n  return futrts_log64(x)/log(10.0d);\n}\n\nSCALAR_FUN_ATTR double futrts_log1p_64(double x) {\n  if(x == -1.0d || (futrts_isinf64(x) && x > 0.0d)) return x / 0.0d;\n  double y = 1.0d + x;\n  double z = y - 1.0d;\n  return log(y) - (z-x)/y;\n}\n\nSCALAR_FUN_ATTR double futrts_sqrt64(double x) {\n  return sqrt(x);\n}\n\nextern \"C\" unmasked uniform double cbrt(uniform double);\nSCALAR_FUN_ATTR double futrts_cbrt64(double x) {\n  double res;\n  foreach_active (i) {\n    uniform double r = cbrtf(extract(x, i));\n    res = insert(res, i, r);\n  }\n  return res;\n}\n\nSCALAR_FUN_ATTR double futrts_exp64(double x) {\n  return exp(x);\n}\n\nSCALAR_FUN_ATTR double futrts_cos64(dou",
                                    "ble x) {\n  return cos(x);\n}\n\nSCALAR_FUN_ATTR double futrts_sin64(double x) {\n  return sin(x);\n}\n\nSCALAR_FUN_ATTR double futrts_tan64(double x) {\n  return tan(x);\n}\n\nSCALAR_FUN_ATTR double futrts_acos64(double x) {\n  return acos(x);\n}\n\nSCALAR_FUN_ATTR double futrts_asin64(double x) {\n  return asin(x);\n}\n\nSCALAR_FUN_ATTR double futrts_atan64(double x) {\n  return atan(x);\n}\n\nSCALAR_FUN_ATTR double futrts_cosh64(double x) {\n  return (exp(x)+exp(-x)) / 2.0d;\n}\n\nSCALAR_FUN_ATTR double futrts_sinh64(double x) {\n  return (exp(x)-exp(-x)) / 2.0d;\n}\n\nSCALAR_FUN_ATTR double futrts_tanh64(double x) {\n  return futrts_sinh64(x)/futrts_cosh64(x);\n}\n\nSCALAR_FUN_ATTR double futrts_acosh64(double x) {\n  double f = x+sqrt(x*x-1.0d);\n  if(futrts_isfinite64(f)) return log(f);\n  return f;\n}\n\nSCALAR_FUN_ATTR double futrts_asinh64(double x) {\n  double f = x+sqrt(x*x+1.0d);\n  if(futrts_isfinite64(f)) return log(f);\n  return f;\n}\n\nSCALAR_FUN_ATTR double futrts_atanh64(double x) {\n  double f = (1.0d+x)/(1.0d-x);\n  if(futrts_isfinite64(f)) return log(f)/2.0d;\n  return f;\n\n}\n\nSCALAR_FUN_ATTR double futrts_atan2_64(double x, double y) {\n  return atan2(x, y);\n}\n\nextern \"C\" unmasked uniform double hypot(uniform double x, uniform double y);\nSCALAR_FUN_ATTR double futrts_hypot64(double x, double y) {\n  double res;\n  foreach_active (i) {\n    uniform double r = hypot(extract(x, i), extract(y, i));\n    res = insert(res, i, r);\n  }\n  return res;\n}\n\nextern \"C\" unmasked uniform double tgamma(uniform double x);\nSCALAR_FUN_ATTR double futrts_gamma64(double x) {\n  double res;\n  foreach_active (i) {\n    uniform double r = tgamma(extract(x, i));\n    res = insert(res, i, r);\n  }\n  return res;\n}\n\nextern \"C\" unmasked uniform double lgamma(uniform double x);\nSCALAR_FUN_ATTR double futrts_lgamma64(double x) {\n  double res;\n  foreach_active (i) {\n    uniform double r = lgamma(extract(x, i));\n    res = insert(res, i, r);\n  }\n  return res;\n}\n\nextern \"C\" unmasked uniform double erf(uniform double x);\nSCALAR_FUN_ATTR do", "uble futrts_erf64(double x) {\n  double res;\n  foreach_active (i) {\n    uniform double r = erf(extract(x, i));\n    res = insert(res, i, r);\n  }\n  return res;\n}\n\nextern \"C\" unmasked uniform double erfc(uniform double x);\nSCALAR_FUN_ATTR double futrts_erfc64(double x) {\n  double res;\n  foreach_active (i) {\n    uniform double r = erfc(extract(x, i));\n    res = insert(res, i, r);\n  }\n  return res;\n}\n\nSCALAR_FUN_ATTR double futrts_fma64(double a, double b, double c) {\n  return a * b + c;\n}\n\nSCALAR_FUN_ATTR double futrts_round64(double x) {\n  return round(x);\n}\n\nSCALAR_FUN_ATTR double futrts_ceil64(double x) {\n  return ceil(x);\n}\n\nextern \"C\" unmasked uniform double nextafter(uniform float x, uniform double y);\nSCALAR_FUN_ATTR float futrts_nextafter64(double x, double y) {\n  double res;\n  foreach_active (i) {\n    uniform double r = nextafter(extract(x, i), extract(y, i));\n    res = insert(res, i, r);\n  }\n  return res;\n}\n\nSCALAR_FUN_ATTR double futrts_floor64(double x) {\n  return floor(x);\n}\n\nSCALAR_FUN_ATTR bool futrts_isnan64(double x) {\n  return isnan(x);\n}\n\nSCALAR_FUN_ATTR int8_t fptosi_f64_i8(double x) {\n  if (futrts_isnan64(x) || futrts_isinf64(x)) {\n    return 0;\n  } else {\n    return (int8_t) x;\n  }\n}\n\nSCALAR_FUN_ATTR int16_t fptosi_f64_i16(double x) {\n  if (futrts_isnan64(x) || futrts_isinf64(x)) {\n    return 0;\n  } else {\n    return (int16_t) x;\n  }\n}\n\nSCALAR_FUN_ATTR int32_t fptosi_f64_i32(double x) {\n  if (futrts_isnan64(x) || futrts_isinf64(x)) {\n    return 0;\n  } else {\n    return (int32_t) x;\n  }\n}\n\nSCALAR_FUN_ATTR int64_t fptosi_f64_i64(double x) {\n  if (futrts_isnan64(x) || futrts_isinf64(x)) {\n    return 0;\n  } else {\n    return (int64_t) x;\n  }\n}\n\nSCALAR_FUN_ATTR uint8_t fptoui_f64_i8(double x) {\n  if (futrts_isnan64(x) || futrts_isinf64(x)) {\n    return 0;\n  } else {\n    return (uint8_t) (int8_t) x;\n  }\n}\n\nSCALAR_FUN_ATTR uint16_t fptoui_f64_i16(double x) {\n  if (futrts_isnan64(x) || futrts_isinf64(x)) {\n    return 0;\n  } else {\n    return (uint16_t) (int", "16_t) x;\n  }\n}\n\nSCALAR_FUN_ATTR uint32_t fptoui_f64_i32(double x) {\n  if (futrts_isnan64(x) || futrts_isinf64(x)) {\n    return 0;\n  } else {\n    return (uint32_t) (int32_t) x;\n  }\n}\n\nSCALAR_FUN_ATTR uint64_t fptoui_f64_i64(double x) {\n  if (futrts_isnan64(x) || futrts_isinf64(x)) {\n    return 0;\n  } else {\n    return (uint64_t) (int64_t) x;\n  }\n}\n\nSCALAR_FUN_ATTR bool ftob_f64_bool(double x) {\n  return x != 0.0;\n}\n\nSCALAR_FUN_ATTR double btof_bool_f64(bool x) {\n  return x ? 1.0 : 0.0;\n}\n\nSCALAR_FUN_ATTR int64_t futrts_to_bits64(double x) {\n  int64_t res;\n  foreach_active (i) {\n    uniform double tmp = extract(x, i);\n    uniform int64_t r = *((uniform int64_t* uniform)&tmp);\n    res = insert(res, i, r);\n  }\n  return res;\n}\n\nSCALAR_FUN_ATTR double futrts_from_bits64(int64_t x) {\n  double res;\n  foreach_active (i) {\n    uniform int64_t tmp = extract(x, i);\n    uniform double r = *((uniform double* uniform)&tmp);\n    res = insert(res, i, r);\n  }\n  return res;\n}\n\nSCALAR_FUN_ATTR double fmod64(double x, double y) {\n  return x - y * trunc(x/y);\n}\n\nSCALAR_FUN_ATTR double fsignum64(double x) {\n  return futrts_isnan64(x) ? x : (x > 0 ? 1.0d : 0.0d) - (x < 0 ? 1.0d : 0.0d);\n}\n\nSCALAR_FUN_ATTR double futrts_lerp64(double v0, double v1, double t) {\n  return v0 + (v1 - v0) * t;\n}\n\nSCALAR_FUN_ATTR double futrts_ldexp64(double x, int32_t y) {\n  return x * pow((double)2.0, (double)y);\n}\n\nSCALAR_FUN_ATTR double futrts_copysign64(double x, double y) {\n  int64_t xb = futrts_to_bits64(x);\n  int64_t yb = futrts_to_bits64(y);\n  return futrts_from_bits64((xb & ~(((int64_t)1)<<63)) | (yb & (((int64_t)1)<<63)));\n}\n\nSCALAR_FUN_ATTR double futrts_mad64(double a, double b, double c) {\n  return a * b + c;\n}\n\nSCALAR_FUN_ATTR float fpconv_f32_f32(float x) {\n  return (float) x;\n}\n\nSCALAR_FUN_ATTR double fpconv_f32_f64(float x) {\n  return (double) x;\n}\n\nSCALAR_FUN_ATTR float fpconv_f64_f32(double x) {\n  return (float) x;\n}\n\nSCALAR_FUN_ATTR double fpconv_f64_f64(double x) {\n  return (double) x;\n}\n\n#e",
                                    "lse\n\nSCALAR_FUN_ATTR double fdiv64(double x, double y) {\n  return x / y;\n}\n\nSCALAR_FUN_ATTR double fadd64(double x, double y) {\n  return x + y;\n}\n\nSCALAR_FUN_ATTR double fsub64(double x, double y) {\n  return x - y;\n}\n\nSCALAR_FUN_ATTR double fmul64(double x, double y) {\n  return x * y;\n}\n\nSCALAR_FUN_ATTR bool cmplt64(double x, double y) {\n  return x < y;\n}\n\nSCALAR_FUN_ATTR bool cmple64(double x, double y) {\n  return x <= y;\n}\n\nSCALAR_FUN_ATTR double sitofp_i8_f64(int8_t x) {\n  return (double) x;\n}\n\nSCALAR_FUN_ATTR double sitofp_i16_f64(int16_t x) {\n  return (double) x;\n}\n\nSCALAR_FUN_ATTR double sitofp_i32_f64(int32_t x) {\n  return (double) x;\n}\n\nSCALAR_FUN_ATTR double sitofp_i64_f64(int64_t x) {\n  return (double) x;\n}\n\nSCALAR_FUN_ATTR double uitofp_i8_f64(uint8_t x) {\n  return (double) x;\n}\n\nSCALAR_FUN_ATTR double uitofp_i16_f64(uint16_t x) {\n  return (double) x;\n}\n\nSCALAR_FUN_ATTR double uitofp_i32_f64(uint32_t x) {\n  return (double) x;\n}\n\nSCALAR_FUN_ATTR double uitofp_i64_f64(uint64_t x) {\n  return (double) x;\n}\n\nSCALAR_FUN_ATTR double fabs64(double x) {\n  return fabs(x);\n}\n\nSCALAR_FUN_ATTR double fmax64(double x, double y) {\n  return fmax(x, y);\n}\n\nSCALAR_FUN_ATTR double fmin64(double x, double y) {\n  return fmin(x, y);\n}\n\nSCALAR_FUN_ATTR double fpow64(double x, double y) {\n  return pow(x, y);\n}\n\nSCALAR_FUN_ATTR double futrts_log64(double x) {\n  return log(x);\n}\n\nSCALAR_FUN_ATTR double futrts_log2_64(double x) {\n  return log2(x);\n}\n\nSCALAR_FUN_ATTR double futrts_log10_64(double x) {\n  return log10(x);\n}\n\nSCALAR_FUN_ATTR double futrts_log1p_64(double x) {\n  return log1p(x);\n}\n\nSCALAR_FUN_ATTR double futrts_sqrt64(double x) {\n  return sqrt(x);\n}\n\nSCALAR_FUN_ATTR double futrts_cbrt64(double x) {\n  return cbrt(x);\n}\n\nSCALAR_FUN_ATTR double futrts_exp64(double x) {\n  return exp(x);\n}\n\nSCALAR_FUN_ATTR double futrts_cos64(double x) {\n  return cos(x);\n}\n\nSCALAR_FUN_ATTR double futrts_sin64(double x) {\n  return sin(x);\n}\n\nSCALAR_FUN_ATTR double futrts_tan64(double x) {\n  r", "eturn tan(x);\n}\n\nSCALAR_FUN_ATTR double futrts_acos64(double x) {\n  return acos(x);\n}\n\nSCALAR_FUN_ATTR double futrts_asin64(double x) {\n  return asin(x);\n}\n\nSCALAR_FUN_ATTR double futrts_atan64(double x) {\n  return atan(x);\n}\n\nSCALAR_FUN_ATTR double futrts_cosh64(double x) {\n  return cosh(x);\n}\n\nSCALAR_FUN_ATTR double futrts_sinh64(double x) {\n  return sinh(x);\n}\n\nSCALAR_FUN_ATTR double futrts_tanh64(double x) {\n  return tanh(x);\n}\n\nSCALAR_FUN_ATTR double futrts_acosh64(double x) {\n  return acosh(x);\n}\n\nSCALAR_FUN_ATTR double futrts_asinh64(double x) {\n  return asinh(x);\n}\n\nSCALAR_FUN_ATTR double futrts_atanh64(double x) {\n  return atanh(x);\n}\n\nSCALAR_FUN_ATTR double futrts_atan2_64(double x, double y) {\n  return atan2(x, y);\n}\n\nSCALAR_FUN_ATTR double futrts_hypot64(double x, double y) {\n  return hypot(x, y);\n}\n\nSCALAR_FUN_ATTR double futrts_gamma64(double x) {\n  return tgamma(x);\n}\n\nSCALAR_FUN_ATTR double futrts_lgamma64(double x) {\n  return lgamma(x);\n}\n\nSCALAR_FUN_ATTR double futrts_erf64(double x) {\n  return erf(x);\n}\n\nSCALAR_FUN_ATTR double futrts_erfc64(double x) {\n  return erfc(x);\n}\n\nSCALAR_FUN_ATTR double futrts_fma64(double a, double b, double c) {\n  return fma(a, b, c);\n}\n\nSCALAR_FUN_ATTR double futrts_round64(double x) {\n  return rint(x);\n}\n\nSCALAR_FUN_ATTR double futrts_ceil64(double x) {\n  return ceil(x);\n}\n\nSCALAR_FUN_ATTR float futrts_nextafter64(float x, float y) {\n  return nextafter(x, y);\n}\n\nSCALAR_FUN_ATTR double futrts_floor64(double x) {\n  return floor(x);\n}\n\nSCALAR_FUN_ATTR bool futrts_isnan64(double x) {\n  return isnan(x);\n}\n\nSCALAR_FUN_ATTR bool futrts_isinf64(double x) {\n  return isinf(x);\n}\n\nSCALAR_FUN_ATTR int8_t fptosi_f64_i8(double x) {\n  if (futrts_isnan64(x) || futrts_isinf64(x)) {\n    return 0;\n  } else {\n    return (int8_t) x;\n  }\n}\n\nSCALAR_FUN_ATTR int16_t fptosi_f64_i16(double x) {\n  if (futrts_isnan64(x) || futrts_isinf64(x)) {\n    return 0;\n  } else {\n    return (int16_t) x;\n  }\n}\n\nSCALAR_FUN_ATTR int32_t fptosi_f64_i32(double x", ") {\n  if (futrts_isnan64(x) || futrts_isinf64(x)) {\n    return 0;\n  } else {\n    return (int32_t) x;\n  }\n}\n\nSCALAR_FUN_ATTR int64_t fptosi_f64_i64(double x) {\n  if (futrts_isnan64(x) || futrts_isinf64(x)) {\n    return 0;\n  } else {\n    return (int64_t) x;\n  }\n}\n\nSCALAR_FUN_ATTR uint8_t fptoui_f64_i8(double x) {\n  if (futrts_isnan64(x) || futrts_isinf64(x)) {\n    return 0;\n  } else {\n    return (uint8_t) (int8_t) x;\n  }\n}\n\nSCALAR_FUN_ATTR uint16_t fptoui_f64_i16(double x) {\n  if (futrts_isnan64(x) || futrts_isinf64(x)) {\n    return 0;\n  } else {\n    return (uint16_t) (int16_t) x;\n  }\n}\n\nSCALAR_FUN_ATTR uint32_t fptoui_f64_i32(double x) {\n  if (futrts_isnan64(x) || futrts_isinf64(x)) {\n    return 0;\n  } else {\n    return (uint32_t) (int32_t) x;\n  }\n}\n\nSCALAR_FUN_ATTR uint64_t fptoui_f64_i64(double x) {\n  if (futrts_isnan64(x) || futrts_isinf64(x)) {\n    return 0;\n  } else {\n    return (uint64_t) (int64_t) x;\n  }\n}\n\nSCALAR_FUN_ATTR bool ftob_f64_bool(double x) {\n  return x != 0;\n}\n\nSCALAR_FUN_ATTR double btof_bool_f64(bool x) {\n  return x ? 1 : 0;\n}\n\nSCALAR_FUN_ATTR int64_t futrts_to_bits64(double x) {\n  union {\n    double f;\n    int64_t t;\n  } p;\n\n  p.f = x;\n  return p.t;\n}\n\nSCALAR_FUN_ATTR double futrts_from_bits64(int64_t x) {\n  union {\n    int64_t f;\n    double t;\n  } p;\n\n  p.f = x;\n  return p.t;\n}\n\nSCALAR_FUN_ATTR double fmod64(double x, double y) {\n  return fmod(x, y);\n}\n\nSCALAR_FUN_ATTR double fsignum64(double x) {\n  return futrts_isnan64(x) ? x : (x > 0) - (x < 0);\n}\n\nSCALAR_FUN_ATTR double futrts_lerp64(double v0, double v1, double t) {\n#ifdef __OPENCL_VERSION__\n  return mix(v0, v1, t);\n#else\n  return v0 + (v1 - v0) * t;\n#endif\n}\n\nSCALAR_FUN_ATTR double futrts_ldexp64(double x, int32_t y) {\n  return ldexp(x, y);\n}\n\nSCALAR_FUN_ATTR float futrts_copysign64(double x, double y) {\n  return copysign(x, y);\n}\n\nSCALAR_FUN_ATTR double futrts_mad64(double a, double b, double c) {\n#ifdef __OPENCL_VERSION__\n  return mad(a, b, c);\n#else\n  return a * b + c;\n#endif\n}\n\nSCALAR",
                                    "_FUN_ATTR float fpconv_f32_f32(float x) {\n  return (float) x;\n}\n\nSCALAR_FUN_ATTR double fpconv_f32_f64(float x) {\n  return (double) x;\n}\n\nSCALAR_FUN_ATTR float fpconv_f64_f32(double x) {\n  return (float) x;\n}\n\nSCALAR_FUN_ATTR double fpconv_f64_f64(double x) {\n  return (double) x;\n}\n\n#endif\n\n#endif\n\n// End of scalar.h.\n// Start of scalar_f16.h.\n\n// Half-precision is emulated if needed (e.g. in straight C) with the\n// native type used if possible.  The emulation works by typedef'ing\n// 'float' to 'f16', and then implementing all operations on single\n// precision.  To cut down on duplication, we use the same code for\n// those Futhark functions that require just operators or casts.  The\n// in-memory representation for arrays will still be 16 bits even\n// under emulation, so the compiler will have to be careful when\n// generating reads or writes.\n\n#if !defined(cl_khr_fp16) && !(defined(__CUDA_ARCH__) && __CUDA_ARCH__ >= 600) && !(defined(ISPC))\n#define EMULATE_F16\n#endif\n\n#if !defined(EMULATE_F16) && defined(__OPENCL_VERSION__)\n#pragma OPENCL EXTENSION cl_khr_fp16 : enable\n#endif\n\n#ifdef EMULATE_F16\n\n// Note that the half-precision storage format is still 16 bits - the\n// compiler will have to be real careful!\ntypedef float f16;\n\n#elif ISPC\ntypedef float16 f16;\n\n#else\n\n#ifdef __CUDA_ARCH__\n#include <cuda_fp16.h>\n#endif\n\ntypedef half f16;\n\n#endif\n\n// Some of these functions convert to single precision because half\n// precision versions are not available.\n\nSCALAR_FUN_ATTR f16 fadd16(f16 x, f16 y) {\n  return x + y;\n}\n\nSCALAR_FUN_ATTR f16 fsub16(f16 x, f16 y) {\n  return x - y;\n}\n\nSCALAR_FUN_ATTR f16 fmul16(f16 x, f16 y) {\n  return x * y;\n}\n\nSCALAR_FUN_ATTR bool cmplt16(f16 x, f16 y) {\n  return x < y;\n}\n\nSCALAR_FUN_ATTR bool cmple16(f16 x, f16 y) {\n  return x <= y;\n}\n\nSCALAR_FUN_ATTR f16 sitofp_i8_f16(int8_t x) {\n  return (f16) x;\n}\n\nSCALAR_FUN_ATTR f16 sitofp_i16_f16(int16_t x) {\n  return (f16) x;\n}\n\nSCALAR_FUN_ATTR f16 sitofp_i32_f16(int32_t x) {\n  return (f16) x;\n}\n\nSCALAR", "_FUN_ATTR f16 sitofp_i64_f16(int64_t x) {\n  return (f16) x;\n}\n\nSCALAR_FUN_ATTR f16 uitofp_i8_f16(uint8_t x) {\n  return (f16) x;\n}\n\nSCALAR_FUN_ATTR f16 uitofp_i16_f16(uint16_t x) {\n  return (f16) x;\n}\n\nSCALAR_FUN_ATTR f16 uitofp_i32_f16(uint32_t x) {\n  return (f16) x;\n}\n\nSCALAR_FUN_ATTR f16 uitofp_i64_f16(uint64_t x) {\n  return (f16) x;\n}\n\nSCALAR_FUN_ATTR int8_t fptosi_f16_i8(f16 x) {\n  return (int8_t) (float) x;\n}\n\nSCALAR_FUN_ATTR int16_t fptosi_f16_i16(f16 x) {\n  return (int16_t) x;\n}\n\nSCALAR_FUN_ATTR int32_t fptosi_f16_i32(f16 x) {\n  return (int32_t) x;\n}\n\nSCALAR_FUN_ATTR int64_t fptosi_f16_i64(f16 x) {\n  return (int64_t) x;\n}\n\nSCALAR_FUN_ATTR uint8_t fptoui_f16_i8(f16 x) {\n  return (uint8_t) (float) x;\n}\n\nSCALAR_FUN_ATTR uint16_t fptoui_f16_i16(f16 x) {\n  return (uint16_t) x;\n}\n\nSCALAR_FUN_ATTR uint32_t fptoui_f16_i32(f16 x) {\n  return (uint32_t) x;\n}\n\nSCALAR_FUN_ATTR uint64_t fptoui_f16_i64(f16 x) {\n  return (uint64_t) x;\n}\n\nSCALAR_FUN_ATTR bool ftob_f16_bool(f16 x) {\n  return x != (f16)0;\n}\n\nSCALAR_FUN_ATTR f16 btof_bool_f16(bool x) {\n  return x ? 1 : 0;\n}\n\n#ifndef EMULATE_F16\nSCALAR_FUN_ATTR bool futrts_isnan16(f16 x) {\n  return isnan((float)x);\n}\n\n#ifdef __OPENCL_VERSION__\n\nSCALAR_FUN_ATTR f16 fabs16(f16 x) {\n  return fabs(x);\n}\n\nSCALAR_FUN_ATTR f16 fmax16(f16 x, f16 y) {\n  return fmax(x, y);\n}\n\nSCALAR_FUN_ATTR f16 fmin16(f16 x, f16 y) {\n  return fmin(x, y);\n}\n\nSCALAR_FUN_ATTR f16 fpow16(f16 x, f16 y) {\n  return pow(x, y);\n}\n\n#elif ISPC\nSCALAR_FUN_ATTR f16 fabs16(f16 x) {\n  return abs(x);\n}\n\nSCALAR_FUN_ATTR f16 fmax16(f16 x, f16 y) {\n  return futrts_isnan16(x) ? y : futrts_isnan16(y) ? x : max(x, y);\n}\n\nSCALAR_FUN_ATTR f16 fmin16(f16 x, f16 y) {\n  return futrts_isnan16(x) ? y : futrts_isnan16(y) ? x : min(x, y);\n}\n\nSCALAR_FUN_ATTR f16 fpow16(f16 x, f16 y) {\n  return pow(x, y);\n}\n\n#else // Assuming CUDA.\n\nSCALAR_FUN_ATTR f16 fabs16(f16 x) {\n  return fabsf(x);\n}\n\nSCALAR_FUN_ATTR f16 fmax16(f16 x, f16 y) {\n  return fmaxf(x, y);\n}\n\nSCALAR_FUN_ATTR f16 fmin16(f16 ", "x, f16 y) {\n  return fminf(x, y);\n}\n\nSCALAR_FUN_ATTR f16 fpow16(f16 x, f16 y) {\n  return powf(x, y);\n}\n#endif\n\n#if ISPC\nSCALAR_FUN_ATTR bool futrts_isinf16(float x) {\n  return !futrts_isnan16(x) && futrts_isnan16(x - x);\n}\nSCALAR_FUN_ATTR bool futrts_isfinite16(float x) {\n  return !futrts_isnan16(x) && !futrts_isinf16(x);\n}\n\n#else\n\nSCALAR_FUN_ATTR bool futrts_isinf16(f16 x) {\n  return isinf((float)x);\n}\n#endif\n\n#ifdef __OPENCL_VERSION__\nSCALAR_FUN_ATTR f16 futrts_log16(f16 x) {\n  return log(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_log2_16(f16 x) {\n  return log2(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_log10_16(f16 x) {\n  return log10(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_log1p_16(f16 x) {\n  return log1p(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_sqrt16(f16 x) {\n  return sqrt(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_cbrt16(f16 x) {\n  return cbrt(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_exp16(f16 x) {\n  return exp(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_cos16(f16 x) {\n  return cos(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_sin16(f16 x) {\n  return sin(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_tan16(f16 x) {\n  return tan(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_acos16(f16 x) {\n  return acos(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_asin16(f16 x) {\n  return asin(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_atan16(f16 x) {\n  return atan(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_cosh16(f16 x) {\n  return cosh(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_sinh16(f16 x) {\n  return sinh(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_tanh16(f16 x) {\n  return tanh(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_acosh16(f16 x) {\n  return acosh(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_asinh16(f16 x) {\n  return asinh(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_atanh16(f16 x) {\n  return atanh(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_atan2_16(f16 x, f16 y) {\n  return atan2(x, y);\n}\n\nSCALAR_FUN_ATTR f16 futrts_hypot16(f16 x, f16 y) {\n  return hypot(x, y);\n}\n\nSCALAR_FUN_ATTR f16 futrts_gamma16(f16 x) {\n  return tgamma(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_lgamma16(f16 x) {\n  return lgamma(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_erf16(f16 x) {\n  return e",
                                    "rf(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_erfc16(f16 x) {\n  return erfc(x);\n}\n\nSCALAR_FUN_ATTR f16 fmod16(f16 x, f16 y) {\n  return fmod(x, y);\n}\n\nSCALAR_FUN_ATTR f16 futrts_round16(f16 x) {\n  return rint(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_floor16(f16 x) {\n  return floor(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_ceil16(f16 x) {\n  return ceil(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_nextafter16(f16 x, f16 y) {\n  return nextafter(x, y);\n}\n\nSCALAR_FUN_ATTR f16 futrts_lerp16(f16 v0, f16 v1, f16 t) {\n  return mix(v0, v1, t);\n}\n\nSCALAR_FUN_ATTR f16 futrts_ldexp16(f16 x, int32_t y) {\n  return ldexp(x, y);\n}\n\nSCALAR_FUN_ATTR f16 futrts_copysign16(f16 x, f16 y) {\n  return copysign(x, y);\n}\n\nSCALAR_FUN_ATTR f16 futrts_mad16(f16 a, f16 b, f16 c) {\n  return mad(a, b, c);\n}\n\nSCALAR_FUN_ATTR f16 futrts_fma16(f16 a, f16 b, f16 c) {\n  return fma(a, b, c);\n}\n#elif ISPC\n\nSCALAR_FUN_ATTR f16 futrts_log16(f16 x) {\n  return futrts_isfinite16(x) || (futrts_isinf16(x) && x < 0) ? log(x) : x;\n}\n\nSCALAR_FUN_ATTR f16 futrts_log2_16(f16 x) {\n  return futrts_log16(x) / log(2.0f16);\n}\n\nSCALAR_FUN_ATTR f16 futrts_log10_16(f16 x) {\n  return futrts_log16(x) / log(10.0f16);\n}\n\nSCALAR_FUN_ATTR f16 futrts_log1p_16(f16 x) {\n  if(x == -1.0f16 || (futrts_isinf16(x) && x > 0.0f16)) return x / 0.0f16;\n  f16 y = 1.0f16 + x;\n  f16 z = y - 1.0f16;\n  return log(y) - (z-x)/y;\n}\n\nSCALAR_FUN_ATTR f16 futrts_sqrt16(f16 x) {\n  return (float16)sqrt((float)x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_exp16(f16 x) {\n  return exp(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_cos16(f16 x) {\n  return (float16)cos((float)x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_sin16(f16 x) {\n  return (float16)sin((float)x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_tan16(f16 x) {\n  return (float16)tan((float)x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_acos16(f16 x) {\n  return (float16)acos((float)x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_asin16(f16 x) {\n  return (float16)asin((float)x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_atan16(f16 x) {\n  return (float16)atan((float)x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_cosh16(f16 x) {\n  retu", "rn (exp(x)+exp(-x)) / 2.0f16;\n}\n\nSCALAR_FUN_ATTR f16 futrts_sinh16(f16 x) {\n  return (exp(x)-exp(-x)) / 2.0f16;\n}\n\nSCALAR_FUN_ATTR f16 futrts_tanh16(f16 x) {\n  return futrts_sinh16(x)/futrts_cosh16(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_acosh16(f16 x) {\n  float16 f = x+(float16)sqrt((float)(x*x-1));\n  if(futrts_isfinite16(f)) return log(f);\n  return f;\n}\n\nSCALAR_FUN_ATTR f16 futrts_asinh16(f16 x) {\n  float16 f = x+(float16)sqrt((float)(x*x+1));\n  if(futrts_isfinite16(f)) return log(f);\n  return f;\n}\n\nSCALAR_FUN_ATTR f16 futrts_atanh16(f16 x) {\n  float16 f = (1+x)/(1-x);\n  if(futrts_isfinite16(f)) return log(f)/2.0f16;\n  return f;\n}\n\nSCALAR_FUN_ATTR f16 futrts_atan2_16(f16 x, f16 y) {\n  return (float16)atan2((float)x, (float)y);\n}\n\nSCALAR_FUN_ATTR f16 futrts_hypot16(f16 x, f16 y) {\n  return (float16)futrts_hypot32((float)x, (float)y);\n}\n\nextern \"C\" unmasked uniform float tgammaf(uniform float x);\nSCALAR_FUN_ATTR f16 futrts_gamma16(f16 x) {\n  f16 res;\n  foreach_active (i) {\n    uniform f16 r = (f16)tgammaf(extract((float)x, i));\n    res = insert(res, i, r);\n  }\n  return res;\n}\n\nextern \"C\" unmasked uniform float lgammaf(uniform float x);\nSCALAR_FUN_ATTR f16 futrts_lgamma16(f16 x) {\n  f16 res;\n  foreach_active (i) {\n    uniform f16 r = (f16)lgammaf(extract((float)x, i));\n    res = insert(res, i, r);\n  }\n  return res;\n}\n\nSCALAR_FUN_ATTR f16 futrts_cbrt16(f16 x) {\n  f16 res = (f16)futrts_cbrt32((float)x);\n  return res;\n}\n\nSCALAR_FUN_ATTR f16 futrts_erf16(f16 x) {\n  f16 res = (f16)futrts_erf32((float)x);\n  return res;\n}\n\nSCALAR_FUN_ATTR f16 futrts_erfc16(f16 x) {\n  f16 res = (f16)futrts_erfc32((float)x);\n  return res;\n}\n\nSCALAR_FUN_ATTR f16 fmod16(f16 x, f16 y) {\n  return x - y * (float16)trunc((float) (x/y));\n}\n\nSCALAR_FUN_ATTR f16 futrts_round16(f16 x) {\n  return (float16)round((float)x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_floor16(f16 x) {\n  return (float16)floor((float)x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_ceil16(f16 x) {\n  return (float16)ceil((float)x);\n}\n\nSCALAR_FUN_ATTR f16 futrt", "s_nextafter16(f16 x, f16 y) {\n  return (float16)futrts_nextafter32((float)x, (float) y);\n}\n\nSCALAR_FUN_ATTR f16 futrts_lerp16(f16 v0, f16 v1, f16 t) {\n  return v0 + (v1 - v0) * t;\n}\n\nSCALAR_FUN_ATTR f16 futrts_ldexp16(f16 x, int32_t y) {\n  return futrts_ldexp32((float)x, y);\n}\n\nSCALAR_FUN_ATTR f16 futrts_copysign16(f16 x, f16 y) {\n  return futrts_copysign32((float)x, y);\n}\n\nSCALAR_FUN_ATTR f16 futrts_mad16(f16 a, f16 b, f16 c) {\n  return a * b + c;\n}\n\nSCALAR_FUN_ATTR f16 futrts_fma16(f16 a, f16 b, f16 c) {\n  return a * b + c;\n}\n\n#else // Assume CUDA.\n\nSCALAR_FUN_ATTR f16 futrts_log16(f16 x) {\n  return hlog(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_log2_16(f16 x) {\n  return hlog2(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_log10_16(f16 x) {\n  return hlog10(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_log1p_16(f16 x) {\n  return (f16)log1pf((float)x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_sqrt16(f16 x) {\n  return hsqrt(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_cbrt16(f16 x) {\n  return cbrtf(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_exp16(f16 x) {\n  return hexp(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_cos16(f16 x) {\n  return hcos(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_sin16(f16 x) {\n  return hsin(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_tan16(f16 x) {\n  return tanf(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_acos16(f16 x) {\n  return acosf(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_asin16(f16 x) {\n  return asinf(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_atan16(f16 x) {\n  return atanf(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_cosh16(f16 x) {\n  return coshf(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_sinh16(f16 x) {\n  return sinhf(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_tanh16(f16 x) {\n  return tanhf(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_acosh16(f16 x) {\n  return acoshf(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_asinh16(f16 x) {\n  return asinhf(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_atanh16(f16 x) {\n  return atanhf(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_atan2_16(f16 x, f16 y) {\n  return atan2f(x, y);\n}\n\nSCALAR_FUN_ATTR f16 futrts_hypot16(f16 x, f16 y) {\n  return hypotf(x, y);\n}\n\nSCALAR_FUN_ATTR f16 futrts_gamma16(f1",
                                    "6 x) {\n  return tgammaf(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_lgamma16(f16 x) {\n  return lgammaf(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_erf16(f16 x) {\n  return erff(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_erfc16(f16 x) {\n  return erfcf(x);\n}\n\nSCALAR_FUN_ATTR f16 fmod16(f16 x, f16 y) {\n  return fmodf(x, y);\n}\n\nSCALAR_FUN_ATTR f16 futrts_round16(f16 x) {\n  return rintf(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_floor16(f16 x) {\n  return hfloor(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_ceil16(f16 x) {\n  return hceil(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_nextafter16(f16 x, f16 y) {\n  return __ushort_as_half(halfbitsnextafter(__half_as_ushort(x), __half_as_ushort(y)));\n}\n\nSCALAR_FUN_ATTR f16 futrts_lerp16(f16 v0, f16 v1, f16 t) {\n  return v0 + (v1 - v0) * t;\n}\n\nSCALAR_FUN_ATTR f16 futrts_ldexp16(f16 x, int32_t y) {\n  return futrts_ldexp32((float)x, y);\n}\n\nSCALAR_FUN_ATTR f16 futrts_copysign16(f16 x, f16 y) {\n  return futrts_copysign32((float)x, y);\n}\n\nSCALAR_FUN_ATTR f16 futrts_mad16(f16 a, f16 b, f16 c) {\n  return a * b + c;\n}\n\nSCALAR_FUN_ATTR f16 futrts_fma16(f16 a, f16 b, f16 c) {\n  return fmaf(a, b, c);\n}\n\n#endif\n\n// The CUDA __half type cannot be put in unions for some reason, so we\n// use bespoke conversion functions instead.\n#ifdef __CUDA_ARCH__\nSCALAR_FUN_ATTR int16_t futrts_to_bits16(f16 x) {\n  return __half_as_ushort(x);\n}\nSCALAR_FUN_ATTR f16 futrts_from_bits16(int16_t x) {\n  return __ushort_as_half(x);\n}\n#elif ISPC\n\nSCALAR_FUN_ATTR int16_t futrts_to_bits16(f16 x) {\n  varying int16_t y = *((varying int16_t * uniform)&x);\n  return y;\n}\n\nSCALAR_FUN_ATTR f16 futrts_from_bits16(int16_t x) {\n  varying f16 y = *((varying f16 * uniform)&x);\n  return y;\n}\n#else\nSCALAR_FUN_ATTR int16_t futrts_to_bits16(f16 x) {\n  union {\n    f16 f;\n    int16_t t;\n  } p;\n\n  p.f = x;\n  return p.t;\n}\n\nSCALAR_FUN_ATTR f16 futrts_from_bits16(int16_t x) {\n  union {\n    int16_t f;\n    f16 t;\n  } p;\n\n  p.f = x;\n  return p.t;\n}\n#endif\n\n#else // No native f16 - emulate.\n\nSCALAR_FUN_ATTR f16 fabs16(f16 x) {\n  return fabs32(x);\n}\n\nSC", "ALAR_FUN_ATTR f16 fmax16(f16 x, f16 y) {\n  return fmax32(x, y);\n}\n\nSCALAR_FUN_ATTR f16 fmin16(f16 x, f16 y) {\n  return fmin32(x, y);\n}\n\nSCALAR_FUN_ATTR f16 fpow16(f16 x, f16 y) {\n  return fpow32(x, y);\n}\n\nSCALAR_FUN_ATTR bool futrts_isnan16(f16 x) {\n  return futrts_isnan32(x);\n}\n\nSCALAR_FUN_ATTR bool futrts_isinf16(f16 x) {\n  return futrts_isinf32(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_log16(f16 x) {\n  return futrts_log32(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_log2_16(f16 x) {\n  return futrts_log2_32(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_log10_16(f16 x) {\n  return futrts_log10_32(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_log1p_16(f16 x) {\n  return futrts_log1p_32(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_sqrt16(f16 x) {\n  return futrts_sqrt32(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_cbrt16(f16 x) {\n  return futrts_cbrt32(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_exp16(f16 x) {\n  return futrts_exp32(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_cos16(f16 x) {\n  return futrts_cos32(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_sin16(f16 x) {\n  return futrts_sin32(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_tan16(f16 x) {\n  return futrts_tan32(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_acos16(f16 x) {\n  return futrts_acos32(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_asin16(f16 x) {\n  return futrts_asin32(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_atan16(f16 x) {\n  return futrts_atan32(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_cosh16(f16 x) {\n  return futrts_cosh32(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_sinh16(f16 x) {\n  return futrts_sinh32(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_tanh16(f16 x) {\n  return futrts_tanh32(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_acosh16(f16 x) {\n  return futrts_acosh32(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_asinh16(f16 x) {\n  return futrts_asinh32(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_atanh16(f16 x) {\n  return futrts_atanh32(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_atan2_16(f16 x, f16 y) {\n  return futrts_atan2_32(x, y);\n}\n\nSCALAR_FUN_ATTR f16 futrts_hypot16(f16 x, f16 y) {\n  return futrts_hypot32(x, y);\n}\n\nSCALAR_FUN_ATTR f16 futrts_gamma16(f16 x) {\n  return futrts_gamma32(x);\n}\n\nSCA", "LAR_FUN_ATTR f16 futrts_lgamma16(f16 x) {\n  return futrts_lgamma32(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_erf16(f16 x) {\n  return futrts_erf32(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_erfc16(f16 x) {\n  return futrts_erfc32(x);\n}\n\nSCALAR_FUN_ATTR f16 fmod16(f16 x, f16 y) {\n  return fmod32(x, y);\n}\n\nSCALAR_FUN_ATTR f16 futrts_round16(f16 x) {\n  return futrts_round32(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_floor16(f16 x) {\n  return futrts_floor32(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_ceil16(f16 x) {\n  return futrts_ceil32(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_nextafter16(f16 x, f16 y) {\n  return halfbits2float(halfbitsnextafter(float2halfbits(x), float2halfbits(y)));\n}\n\nSCALAR_FUN_ATTR f16 futrts_lerp16(f16 v0, f16 v1, f16 t) {\n  return futrts_lerp32(v0, v1, t);\n}\n\nSCALAR_FUN_ATTR f16 futrts_ldexp16(f16 x, int32_t y) {\n  return futrts_ldexp32(x, y);\n}\n\nSCALAR_FUN_ATTR f16 futrts_copysign16(f16 x, f16 y) {\n  return futrts_copysign32((float)x, y);\n}\n\nSCALAR_FUN_ATTR f16 futrts_mad16(f16 a, f16 b, f16 c) {\n  return futrts_mad32(a, b, c);\n}\n\nSCALAR_FUN_ATTR f16 futrts_fma16(f16 a, f16 b, f16 c) {\n  return futrts_fma32(a, b, c);\n}\n\n// Even when we are using an OpenCL that does not support cl_khr_fp16,\n// it must still support vload_half for actually creating a\n// half-precision number, which can then be efficiently converted to a\n// float.  Similarly for vstore_half.\n#ifdef __OPENCL_VERSION__\n\nSCALAR_FUN_ATTR int16_t futrts_to_bits16(f16 x) {\n  int16_t y;\n  // Violating strict aliasing here.\n  vstore_half((float)x, 0, (half*)&y);\n  return y;\n}\n\nSCALAR_FUN_ATTR f16 futrts_from_bits16(int16_t x) {\n  return (f16)vload_half(0, (half*)&x);\n}\n\n#else\n\nSCALAR_FUN_ATTR int16_t futrts_to_bits16(f16 x) {\n  return (int16_t)float2halfbits(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_from_bits16(int16_t x) {\n  return halfbits2float((uint16_t)x);\n}\n\nSCALAR_FUN_ATTR f16 fsignum16(f16 x) {\n  return futrts_isnan16(x) ? x : (x > 0 ? 1 : 0) - (x < 0 ? 1 : 0);\n}\n\n#endif\n\n#endif\n\nSCALAR_FUN_ATTR float fpconv_f16_f16(f16 x) {\n  retu",
                                    "rn x;\n}\n\nSCALAR_FUN_ATTR float fpconv_f16_f32(f16 x) {\n  return x;\n}\n\nSCALAR_FUN_ATTR f16 fpconv_f32_f16(float x) {\n  return (f16) x;\n}\n\n#ifdef FUTHARK_F64_ENABLED\n\nSCALAR_FUN_ATTR double fpconv_f16_f64(f16 x) {\n  return (double) x;\n}\n\n#if ISPC\nSCALAR_FUN_ATTR f16 fpconv_f64_f16(double x) {\n  return (f16) ((float)x);\n}\n#else\nSCALAR_FUN_ATTR f16 fpconv_f64_f16(double x) {\n  return (f16) x;\n}\n#endif\n#endif\n\n\n// End of scalar_f16.h.\n// Start of atomics.h\n\nSCALAR_FUN_ATTR int32_t atomic_xchg_i32_global(volatile __global int32_t *p, int32_t x);\nSCALAR_FUN_ATTR int32_t atomic_xchg_i32_shared(volatile __local int32_t *p, int32_t x);\nSCALAR_FUN_ATTR int32_t atomic_cmpxchg_i32_global(volatile __global int32_t *p,\n                                                         int32_t cmp, int32_t val);\nSCALAR_FUN_ATTR int32_t atomic_cmpxchg_i32_shared(volatile __local int32_t *p,\n                                                        int32_t cmp, int32_t val);\nSCALAR_FUN_ATTR int32_t atomic_add_i32_global(volatile __global int32_t *p, int32_t x);\nSCALAR_FUN_ATTR int32_t atomic_add_i32_shared(volatile __local int32_t *p, int32_t x);\nSCALAR_FUN_ATTR float atomic_fadd_f32_global(volatile __global float *p, float x);\nSCALAR_FUN_ATTR float atomic_fadd_f32_shared(volatile __local float *p, float x);\nSCALAR_FUN_ATTR int32_t atomic_smax_i32_global(volatile __global int32_t *p, int32_t x);\nSCALAR_FUN_ATTR int32_t atomic_smax_i32_shared(volatile __local int32_t *p, int32_t x);\nSCALAR_FUN_ATTR int32_t atomic_smin_i32_global(volatile __global int32_t *p, int32_t x);\nSCALAR_FUN_ATTR int32_t atomic_smin_i32_shared(volatile __local int32_t *p, int32_t x);\nSCALAR_FUN_ATTR uint32_t atomic_umax_i32_global(volatile __global uint32_t *p, uint32_t x);\nSCALAR_FUN_ATTR uint32_t atomic_umax_i32_shared(volatile __local uint32_t *p, uint32_t x);\nSCALAR_FUN_ATTR uint32_t atomic_umin_i32_global(volatile __global uint32_t *p, uint32_t x);\nSCALAR_FUN_ATTR uint32_t atomic_umin_i32_shared(volatile __local uint32", "_t *p, uint32_t x);\nSCALAR_FUN_ATTR int32_t atomic_and_i32_global(volatile __global int32_t *p, int32_t x);\nSCALAR_FUN_ATTR int32_t atomic_and_i32_shared(volatile __local int32_t *p, int32_t x);\nSCALAR_FUN_ATTR int32_t atomic_or_i32_global(volatile __global int32_t *p, int32_t x);\nSCALAR_FUN_ATTR int32_t atomic_or_i32_shared(volatile __local int32_t *p, int32_t x);\nSCALAR_FUN_ATTR int32_t atomic_xor_i32_global(volatile __global int32_t *p, int32_t x);\nSCALAR_FUN_ATTR int32_t atomic_xor_i32_shared(volatile __local int32_t *p, int32_t x);\n\nSCALAR_FUN_ATTR int32_t atomic_xchg_i32_global(volatile __global int32_t *p, int32_t x) {\n#if defined(FUTHARK_CUDA) || defined(FUTHARK_HIP)\n  return atomicExch((int32_t*)p, x);\n#else\n  return atomic_xor(p, x);\n#endif\n}\n\nSCALAR_FUN_ATTR int32_t atomic_xchg_i32_shared(volatile __local int32_t *p, int32_t x) {\n#if defined(FUTHARK_CUDA) || defined(FUTHARK_HIP)\n  return atomicExch((int32_t*)p, x);\n#else\n  return atomic_xor(p, x);\n#endif\n}\n\nSCALAR_FUN_ATTR int32_t atomic_cmpxchg_i32_global(volatile __global int32_t *p,\n                                                         int32_t cmp, int32_t val) {\n#if defined(FUTHARK_CUDA) || defined(FUTHARK_HIP)\n  return atomicCAS((int32_t*)p, cmp, val);\n#else\n  return atomic_cmpxchg(p, cmp, val);\n#endif\n}\n\nSCALAR_FUN_ATTR int32_t atomic_cmpxchg_i32_shared(volatile __local int32_t *p,\n                                                        int32_t cmp, int32_t val) {\n#if defined(FUTHARK_CUDA) || defined(FUTHARK_HIP)\n  return atomicCAS((int32_t*)p, cmp, val);\n#else\n  return atomic_cmpxchg(p, cmp, val);\n#endif\n}\n\nSCALAR_FUN_ATTR int32_t atomic_add_i32_global(volatile __global int32_t *p, int32_t x) {\n#if defined(FUTHARK_CUDA) || defined(FUTHARK_HIP)\n  return atomicAdd((int32_t*)p, x);\n#else\n  return atomic_add(p, x);\n#endif\n}\n\nSCALAR_FUN_ATTR int32_t atomic_add_i32_shared(volatile __local int32_t *p, int32_t x) {\n#if defined(FUTHARK_CUDA) || defined(FUTHARK_HIP)\n  return atomicAdd((int32_t*)p, x);\n#el", "se\n  return atomic_add(p, x);\n#endif\n}\n\nSCALAR_FUN_ATTR float atomic_fadd_f32_global(volatile __global float *p, float x) {\n#if defined(FUTHARK_CUDA) || defined(FUTHARK_HIP)\n  return atomicAdd((float*)p, x);\n  // On OpenCL, use technique from\n  // https://pipinspace.github.io/blog/atomic-float-addition-in-opencl.html\n#elif defined(cl_nv_pragma_unroll)\n  // use hardware-supported atomic addition on Nvidia GPUs with inline\n  // PTX assembly\n  float ret;\n  asm volatile(\"atom.global.add.f32 %0,[%1],%2;\":\"=f\"(ret):\"l\"(p),\"f\"(x):\"memory\");\n  return ret;\n#elif defined(__opencl_c_ext_fp32_global_atomic_add)\n  // use hardware-supported atomic addition on some Intel GPUs\n  return atomic_fetch_add_explicit((volatile __global atomic_float*)p,\n                                   x,\n                                   memory_order_relaxed);\n#elif __has_builtin(__builtin_amdgcn_global_atomic_fadd_f32)\n  // use hardware-supported atomic addition on some AMD GPUs\n  return __builtin_amdgcn_global_atomic_fadd_f32(p, x);\n#else\n  // fallback emulation:\n  // https://forums.developer.nvidia.com/t/atomicadd-float-float-atomicmul-float-float/14639/5\n  float old = x;\n  float ret;\n  while ((old=atomic_xchg(p, ret=atomic_xchg(p, 0.0f)+old))!=0.0f);\n  return ret;\n#endif\n}\n\nSCALAR_FUN_ATTR float atomic_fadd_f32_shared(volatile __local float *p, float x) {\n#if defined(FUTHARK_CUDA) || defined(FUTHARK_HIP)\n  return atomicAdd((float*)p, x);\n#else\n  union { int32_t i; float f; } old;\n  union { int32_t i; float f; } assumed;\n  old.f = *p;\n  do {\n    assumed.f = old.f;\n    old.f = old.f + x;\n    old.i = atomic_cmpxchg_i32_shared((volatile __local int32_t*)p, assumed.i, old.i);\n  } while (assumed.i != old.i);\n  return old.f;\n#endif\n}\n\nSCALAR_FUN_ATTR int32_t atomic_smax_i32_global(volatile __global int32_t *p, int32_t x) {\n#if defined(FUTHARK_CUDA) || defined(FUTHARK_HIP)\n  return atomicMax((int32_t*)p, x);\n#else\n  return atomic_max(p, x);\n#endif\n}\n\nSCALAR_FUN_ATTR int32_t atomic_smax_i32_shared(volatile",
                                    " __local int32_t *p, int32_t x) {\n#if defined(FUTHARK_CUDA) || defined(FUTHARK_HIP)\n  return atomicMax((int32_t*)p, x);\n#else\n  return atomic_max(p, x);\n#endif\n}\n\nSCALAR_FUN_ATTR int32_t atomic_smin_i32_global(volatile __global int32_t *p, int32_t x) {\n#if defined(FUTHARK_CUDA) || defined(FUTHARK_HIP)\n  return atomicMin((int32_t*)p, x);\n#else\n  return atomic_min(p, x);\n#endif\n}\n\nSCALAR_FUN_ATTR int32_t atomic_smin_i32_shared(volatile __local int32_t *p, int32_t x) {\n#if defined(FUTHARK_CUDA) || defined(FUTHARK_HIP)\n  return atomicMin((int32_t*)p, x);\n#else\n  return atomic_min(p, x);\n#endif\n}\n\nSCALAR_FUN_ATTR uint32_t atomic_umax_i32_global(volatile __global uint32_t *p, uint32_t x) {\n#if defined(FUTHARK_CUDA) || defined(FUTHARK_HIP)\n  return atomicMax((uint32_t*)p, x);\n#else\n  return atomic_max(p, x);\n#endif\n}\n\nSCALAR_FUN_ATTR uint32_t atomic_umax_i32_shared(volatile __local uint32_t *p, uint32_t x) {\n#if defined(FUTHARK_CUDA) || defined(FUTHARK_HIP)\n  return atomicMax((uint32_t*)p, x);\n#else\n  return atomic_max(p, x);\n#endif\n}\n\nSCALAR_FUN_ATTR uint32_t atomic_umin_i32_global(volatile __global uint32_t *p, uint32_t x) {\n#if defined(FUTHARK_CUDA) || defined(FUTHARK_HIP)\n  return atomicMin((uint32_t*)p, x);\n#else\n  return atomic_min(p, x);\n#endif\n}\n\nSCALAR_FUN_ATTR uint32_t atomic_umin_i32_shared(volatile __local uint32_t *p, uint32_t x) {\n#if defined(FUTHARK_CUDA) || defined(FUTHARK_HIP)\n  return atomicMin((uint32_t*)p, x);\n#else\n  return atomic_min(p, x);\n#endif\n}\n\nSCALAR_FUN_ATTR int32_t atomic_and_i32_global(volatile __global int32_t *p, int32_t x) {\n#if defined(FUTHARK_CUDA) || defined(FUTHARK_HIP)\n  return atomicAnd((int32_t*)p, x);\n#else\n  return atomic_and(p, x);\n#endif\n}\n\nSCALAR_FUN_ATTR int32_t atomic_and_i32_shared(volatile __local int32_t *p, int32_t x) {\n#if defined(FUTHARK_CUDA) || defined(FUTHARK_HIP)\n  return atomicAnd((int32_t*)p, x);\n#else\n  return atomic_and(p, x);\n#endif\n}\n\nSCALAR_FUN_ATTR int32_t atomic_or_i32_global(volatile __global int32_t *p, ", "int32_t x) {\n#if defined(FUTHARK_CUDA) || defined(FUTHARK_HIP)\n  return atomicOr((int32_t*)p, x);\n#else\n  return atomic_or(p, x);\n#endif\n}\n\nSCALAR_FUN_ATTR int32_t atomic_or_i32_shared(volatile __local int32_t *p, int32_t x) {\n#if defined(FUTHARK_CUDA) || defined(FUTHARK_HIP)\n  return atomicOr((int32_t*)p, x);\n#else\n  return atomic_or(p, x);\n#endif\n}\n\nSCALAR_FUN_ATTR int32_t atomic_xor_i32_global(volatile __global int32_t *p, int32_t x) {\n#if defined(FUTHARK_CUDA) || defined(FUTHARK_HIP)\n  return atomicXor((int32_t*)p, x);\n#else\n  return atomic_xor(p, x);\n#endif\n}\n\nSCALAR_FUN_ATTR int32_t atomic_xor_i32_shared(volatile __local int32_t *p, int32_t x) {\n#if defined(FUTHARK_CUDA) || defined(FUTHARK_HIP)\n  return atomicXor((int32_t*)p, x);\n#else\n  return atomic_xor(p, x);\n#endif\n}\n\n// Start of 64 bit atomics\n\n#if defined(FUTHARK_CUDA) || defined(FUTHARK_HIP) || defined(cl_khr_int64_base_atomics) && defined(cl_khr_int64_extended_atomics)\n\nSCALAR_FUN_ATTR int64_t atomic_xchg_i64_global(volatile __global int64_t *p, int64_t x);\nSCALAR_FUN_ATTR int64_t atomic_xchg_i64_shared(volatile __local int64_t *p, int64_t x);\nSCALAR_FUN_ATTR int64_t atomic_cmpxchg_i64_global(volatile __global int64_t *p,\n                                                         int64_t cmp, int64_t val);\nSCALAR_FUN_ATTR int64_t atomic_cmpxchg_i64_shared(volatile __local int64_t *p,\n                                                        int64_t cmp, int64_t val);\nSCALAR_FUN_ATTR int64_t atomic_add_i64_global(volatile __global int64_t *p, int64_t x);\nSCALAR_FUN_ATTR int64_t atomic_add_i64_shared(volatile __local int64_t *p, int64_t x);\nSCALAR_FUN_ATTR int64_t atomic_smax_i64_global(volatile __global int64_t *p, int64_t x);\nSCALAR_FUN_ATTR int64_t atomic_smax_i64_shared(volatile __local int64_t *p, int64_t x);\nSCALAR_FUN_ATTR int64_t atomic_smin_i64_global(volatile __global int64_t *p, int64_t x);\nSCALAR_FUN_ATTR int64_t atomic_smin_i64_shared(volatile __local int64_t *p, int64_t x);\nSCALAR_FUN_ATTR uint", "64_t atomic_umax_i64_global(volatile __global uint64_t *p, uint64_t x);\nSCALAR_FUN_ATTR uint64_t atomic_umax_i64_shared(volatile __local uint64_t *p, uint64_t x);\nSCALAR_FUN_ATTR uint64_t atomic_umin_i64_global(volatile __global uint64_t *p, uint64_t x);\nSCALAR_FUN_ATTR uint64_t atomic_umin_i64_shared(volatile __local uint64_t *p, uint64_t x);\nSCALAR_FUN_ATTR int64_t atomic_and_i64_global(volatile __global int64_t *p, int64_t x);\nSCALAR_FUN_ATTR int64_t atomic_and_i64_shared(volatile __local int64_t *p, int64_t x);\nSCALAR_FUN_ATTR int64_t atomic_or_i64_global(volatile __global int64_t *p, int64_t x);\nSCALAR_FUN_ATTR int64_t atomic_or_i64_shared(volatile __local int64_t *p, int64_t x);\nSCALAR_FUN_ATTR int64_t atomic_xor_i64_global(volatile __global int64_t *p, int64_t x);\nSCALAR_FUN_ATTR int64_t atomic_xor_i64_shared(volatile __local int64_t *p, int64_t x);\n\n#ifdef FUTHARK_F64_ENABLED\nSCALAR_FUN_ATTR double atomic_fadd_f64_global(volatile __global double *p, double x);\nSCALAR_FUN_ATTR double atomic_fadd_f64_shared(volatile __local double *p, double x);\n#endif\n\nSCALAR_FUN_ATTR int64_t atomic_xchg_i64_global(volatile __global int64_t *p, int64_t x) {\n#if defined(FUTHARK_CUDA) || defined(FUTHARK_HIP)\n  return atomicExch((uint64_t*)p, x);\n#else\n  return atom_xor(p, x);\n#endif\n}\n\nSCALAR_FUN_ATTR int64_t atomic_xchg_i64_shared(volatile __local int64_t *p, int64_t x) {\n#if defined(FUTHARK_CUDA) || defined(FUTHARK_HIP)\n  return atomicExch((uint64_t*)p, x);\n#else\n  return atom_xor(p, x);\n#endif\n}\n\nSCALAR_FUN_ATTR int64_t atomic_cmpxchg_i64_global(volatile __global int64_t *p,\n                                                         int64_t cmp, int64_t val) {\n#if defined(FUTHARK_CUDA) || defined(FUTHARK_HIP)\n  return atomicCAS((uint64_t*)p, cmp, val);\n#else\n  return atom_cmpxchg(p, cmp, val);\n#endif\n}\n\nSCALAR_FUN_ATTR int64_t atomic_cmpxchg_i64_shared(volatile __local int64_t *p,\n                                                        int64_t cmp, int64_t val) {\n#if defined(F",
                                    "UTHARK_CUDA) || defined(FUTHARK_HIP)\n  return atomicCAS((uint64_t*)p, cmp, val);\n#else\n  return atom_cmpxchg(p, cmp, val);\n#endif\n}\n\nSCALAR_FUN_ATTR int64_t atomic_add_i64_global(volatile __global int64_t *p, int64_t x) {\n#if defined(FUTHARK_CUDA) || defined(FUTHARK_HIP)\n  return atomicAdd((uint64_t*)p, x);\n#else\n  return atom_add(p, x);\n#endif\n}\n\nSCALAR_FUN_ATTR int64_t atomic_add_i64_shared(volatile __local int64_t *p, int64_t x) {\n#if defined(FUTHARK_CUDA) || defined(FUTHARK_HIP)\n  return atomicAdd((uint64_t*)p, x);\n#else\n  return atom_add(p, x);\n#endif\n}\n\n#ifdef FUTHARK_F64_ENABLED\n\nSCALAR_FUN_ATTR double atomic_fadd_f64_global(volatile __global double *p, double x) {\n#if defined(FUTHARK_CUDA) && __CUDA_ARCH__ >= 600 || defined(FUTHARK_HIP)\n  return atomicAdd((double*)p, x);\n  // On OpenCL, use technique from\n  // https://pipinspace.github.io/blog/atomic-float-addition-in-opencl.html\n#elif defined(cl_nv_pragma_unroll)\n  // use hardware-supported atomic addition on Nvidia GPUs with inline\n  // PTX assembly\n  double ret;\n  asm volatile(\"atom.global.add.f64 %0,[%1],%2;\":\"=d\"(ret):\"l\"(p),\"d\"(x):\"memory\");\n  return ret;\n#elif __has_builtin(__builtin_amdgcn_global_atomic_fadd_f64)\n  // use hardware-supported atomic addition on some AMD GPUs\n  return __builtin_amdgcn_global_atomic_fadd_f64(p, x);\n#else\n  // fallback emulation:\n  // https://forums.developer.nvidia.com/t/atomicadd-float-float-atomicmul-float-float/14639/5\n  union {int64_t i; double f;} old;\n  union {int64_t i; double f;} ret;\n  old.f = x;\n  while (1) {\n    ret.i = atom_xchg((volatile __global int64_t*)p, (int64_t)0);\n    ret.f += old.f;\n    old.i = atom_xchg((volatile __global int64_t*)p, ret.i);\n    if (old.i == 0) {\n      break;\n    }\n  }\n  return ret.f;\n#endif\n}\n\nSCALAR_FUN_ATTR double atomic_fadd_f64_shared(volatile __local double *p, double x) {\n#if defined(FUTHARK_CUDA) && __CUDA_ARCH__ >= 600 || defined(FUTHARK_HIP)\n  return atomicAdd((double*)p, x);\n#else\n  union { int64_t i; double f; } old;\n  u", "nion { int64_t i; double f; } assumed;\n  old.f = *p;\n  do {\n    assumed.f = old.f;\n    old.f = old.f + x;\n    old.i = atomic_cmpxchg_i64_shared((volatile __local int64_t*)p, assumed.i, old.i);\n  } while (assumed.i != old.i);\n  return old.f;\n#endif\n}\n\n#endif\n\nSCALAR_FUN_ATTR int64_t atomic_smax_i64_global(volatile __global int64_t *p, int64_t x) {\n#if defined(FUTHARK_CUDA)\n  return atomicMax((int64_t*)p, x);\n#elif defined(FUTHARK_HIP)\n  // Currentely missing in HIP; probably a temporary oversight.\n  int64_t old = *p, assumed;\n  do {\n    assumed = old;\n    old = smax64(old, x);\n    old = atomic_cmpxchg_i64_global((volatile __global int64_t*)p, assumed, old);\n  } while (assumed != old);\n  return old;\n#else\n  return atom_max(p, x);\n#endif\n}\n\nSCALAR_FUN_ATTR int64_t atomic_smax_i64_shared(volatile __local int64_t *p, int64_t x) {\n#if defined(FUTHARK_CUDA)\n  return atomicMax((int64_t*)p, x);\n#elif defined(FUTHARK_HIP)\n  // Currentely missing in HIP; probably a temporary oversight.\n  int64_t old = *p, assumed;\n  do {\n    assumed = old;\n    old = smax64(old, x);\n    old = atomic_cmpxchg_i64_shared((volatile __local int64_t*)p, assumed, old);\n  } while (assumed != old);\n  return old;\n#else\n  return atom_max(p, x);\n#endif\n}\n\nSCALAR_FUN_ATTR int64_t atomic_smin_i64_global(volatile __global int64_t *p, int64_t x) {\n#if defined(FUTHARK_CUDA)\n  return atomicMin((int64_t*)p, x);\n#elif defined(FUTHARK_HIP)\n  // Currentely missing in HIP; probably a temporary oversight.\n  int64_t old = *p, assumed;\n  do {\n    assumed = old;\n    old = smin64(old, x);\n    old = atomic_cmpxchg_i64_global((volatile __global int64_t*)p, assumed, old);\n  } while (assumed != old);\n  return old;\n#else\n  return atom_min(p, x);\n#endif\n}\n\nSCALAR_FUN_ATTR int64_t atomic_smin_i64_shared(volatile __local int64_t *p, int64_t x) {\n#if defined(FUTHARK_CUDA)\n  return atomicMin((int64_t*)p, x);\n#elif defined(FUTHARK_HIP)\n  // Currentely missing in HIP; probably a temporary oversight.\n  int64_t old = *p, assumed;\n  do ", "{\n    assumed = old;\n    old = smin64(old, x);\n    old = atomic_cmpxchg_i64_shared((volatile __local int64_t*)p, assumed, old);\n  } while (assumed != old);\n  return old;\n#else\n  return atom_min(p, x);\n#endif\n}\n\nSCALAR_FUN_ATTR uint64_t atomic_umax_i64_global(volatile __global uint64_t *p, uint64_t x) {\n#if defined(FUTHARK_CUDA) || defined(FUTHARK_HIP)\n  return atomicMax((uint64_t*)p, x);\n#else\n  return atom_max(p, x);\n#endif\n}\n\nSCALAR_FUN_ATTR uint64_t atomic_umax_i64_shared(volatile __local uint64_t *p, uint64_t x) {\n#if defined(FUTHARK_CUDA) || defined(FUTHARK_HIP)\n  return atomicMax((uint64_t*)p, x);\n#else\n  return atom_max(p, x);\n#endif\n}\n\nSCALAR_FUN_ATTR uint64_t atomic_umin_i64_global(volatile __global uint64_t *p, uint64_t x) {\n#if defined(FUTHARK_CUDA) || defined(FUTHARK_HIP)\n  return atomicMin((uint64_t*)p, x);\n#else\n  return atom_min(p, x);\n#endif\n}\n\nSCALAR_FUN_ATTR uint64_t atomic_umin_i64_shared(volatile __local uint64_t *p, uint64_t x) {\n#if defined(FUTHARK_CUDA) || defined(FUTHARK_HIP)\n  return atomicMin((uint64_t*)p, x);\n#else\n  return atom_min(p, x);\n#endif\n}\n\nSCALAR_FUN_ATTR int64_t atomic_and_i64_global(volatile __global int64_t *p, int64_t x) {\n#if defined(FUTHARK_CUDA) || defined(FUTHARK_HIP)\n  return atomicAnd((uint64_t*)p, x);\n#else\n  return atom_and(p, x);\n#endif\n}\n\nSCALAR_FUN_ATTR int64_t atomic_and_i64_shared(volatile __local int64_t *p, int64_t x) {\n#if defined(FUTHARK_CUDA) || defined(FUTHARK_HIP)\n  return atomicAnd((uint64_t*)p, x);\n#else\n  return atom_and(p, x);\n#endif\n}\n\nSCALAR_FUN_ATTR int64_t atomic_or_i64_global(volatile __global int64_t *p, int64_t x) {\n#if defined(FUTHARK_CUDA) || defined(FUTHARK_HIP)\n  return atomicOr((uint64_t*)p, x);\n#else\n  return atom_or(p, x);\n#endif\n}\n\nSCALAR_FUN_ATTR int64_t atomic_or_i64_shared(volatile __local int64_t *p, int64_t x) {\n#if defined(FUTHARK_CUDA) || defined(FUTHARK_HIP)\n  return atomicOr((uint64_t*)p, x);\n#else\n  return atom_or(p, x);\n#endif\n}\n\nSCALAR_FUN_ATTR int64_t atomic_xor_i64_global(v",
                                    "olatile __global int64_t *p, int64_t x) {\n#if defined(FUTHARK_CUDA) || defined(FUTHARK_HIP)\n  return atomicXor((uint64_t*)p, x);\n#else\n  return atom_xor(p, x);\n#endif\n}\n\nSCALAR_FUN_ATTR int64_t atomic_xor_i64_shared(volatile __local int64_t *p, int64_t x) {\n#if defined(FUTHARK_CUDA) || defined(FUTHARK_HIP)\n  return atomicXor((uint64_t*)p, x);\n#else\n  return atom_xor(p, x);\n#endif\n}\n\n#endif // defined(FUTHARK_CUDA) || defined(FUTHARK_HIP) || defined(cl_khr_int64_base_atomics) && defined(cl_khr_int64_extended_atomics)\n\n// End of atomics.h\n// Start of transpose.cl\n\n#define GEN_TRANSPOSE_KERNELS(NAME, ELEM_TYPE)                          \\\nFUTHARK_KERNEL_SIZED(TR_BLOCK_DIM*2, TR_TILE_DIM/TR_ELEMS_PER_THREAD, 1)\\\nvoid map_transpose_##NAME(SHARED_MEM_PARAM                              \\\n                          __global ELEM_TYPE *dst_mem,                  \\\n                          int64_t dst_offset,                           \\\n                          __global ELEM_TYPE *src_mem,                  \\\n                          int64_t src_offset,                           \\\n                          int32_t num_arrays,                           \\\n                          int32_t x_elems,                              \\\n                          int32_t y_elems,                              \\\n                          int32_t mulx,                                 \\\n                          int32_t muly,                                 \\\n                          int32_t repeat_1,                             \\\n                          int32_t repeat_2) {                           \\\n  (void)mulx; (void)muly;                                               \\\n  __local ELEM_TYPE* block = (__local ELEM_TYPE*)shared_mem;            \\\n  int tblock_id_0 = get_tblock_id(0);                                   \\\n  int global_id_0 = get_global_id(0);                                   \\\n  int tblock_id_1 = get_tblock_id(1);                                   \\\n  int global_id_1 = get_g", "lobal_id(1);                                   \\\n  for (int i1 = 0; i1 <= repeat_1; i1++) {                              \\\n    int tblock_id_2 = get_tblock_id(2);                                 \\\n    int global_id_2 = get_global_id(2);                                 \\\n    for (int i2 = 0; i2 <= repeat_2; i2++) {                            \\\n      int32_t our_array_offset = tblock_id_2 * x_elems * y_elems;       \\\n      int32_t odata_offset = dst_offset + our_array_offset;             \\\n      int32_t idata_offset = src_offset + our_array_offset;             \\\n      int32_t x_index = global_id_0;                                    \\\n      int32_t y_index = tblock_id_1 * TR_TILE_DIM + get_local_id(1);    \\\n      if (x_index < x_elems) {                                          \\\n        for (int32_t j = 0; j < TR_ELEMS_PER_THREAD; j++) {             \\\n          int32_t index_i = (y_index + j * (TR_TILE_DIM/TR_ELEMS_PER_THREAD)) * x_elems + x_index; \\\n          if (y_index + j * (TR_TILE_DIM/TR_ELEMS_PER_THREAD) < y_elems) { \\\n            block[(get_local_id(1) + j * (TR_TILE_DIM/TR_ELEMS_PER_THREAD)) * (TR_TILE_DIM+1) + \\\n                  get_local_id(0)] =                                    \\\n              src_mem[idata_offset + index_i];                          \\\n          }                                                             \\\n        }                                                               \\\n      }                                                                 \\\n      barrier_local();                                                  \\\n      x_index = tblock_id_1 * TR_TILE_DIM + get_local_id(0);            \\\n      y_index = tblock_id_0 * TR_TILE_DIM + get_local_id(1);            \\\n      if (x_index < y_elems) {                                          \\\n        for (int32_t j = 0; j < TR_ELEMS_PER_THREAD; j++) {             \\\n          int32_t index_out = (y_index + j * (TR_TILE_DIM/TR_ELEMS_PER_THREAD)) * y_elems + x_index; \\\n          if (y_in", "dex + j * (TR_TILE_DIM/TR_ELEMS_PER_THREAD) < x_elems) { \\\n            dst_mem[(odata_offset + index_out)] =                       \\\n              block[get_local_id(0) * (TR_TILE_DIM+1) +                 \\\n                    get_local_id(1) + j * (TR_TILE_DIM/TR_ELEMS_PER_THREAD)]; \\\n          }                                                             \\\n        }                                                               \\\n      }                                                                 \\\n      tblock_id_2 += get_num_tblocks(2);                                \\\n      global_id_2 += get_global_size(2);                                \\\n    }                                                                   \\\n    tblock_id_1 += get_num_tblocks(1);                                  \\\n    global_id_1 += get_global_size(1);                                  \\\n  }                                                                     \\\n}                                                                       \\\n                                                                        \\\nFUTHARK_KERNEL_SIZED(TR_BLOCK_DIM, TR_BLOCK_DIM, 1)                     \\\nvoid map_transpose_##NAME##_low_height(SHARED_MEM_PARAM                 \\\n                                                __global ELEM_TYPE *dst_mem, \\\n                                                int64_t dst_offset,     \\\n                                                __global ELEM_TYPE *src_mem, \\\n                                                int64_t src_offset,     \\\n                                                int32_t num_arrays,     \\\n                                                int32_t x_elems,        \\\n                                                int32_t y_elems,        \\\n                                                int32_t mulx,           \\\n                                                int32_t muly,           \\\n                                                int32_t repeat_1,       \\\n ",
                                    "                                               int32_t repeat_2) {     \\\n  __local ELEM_TYPE* block = (__local ELEM_TYPE*)shared_mem;            \\\n  int tblock_id_0 = get_tblock_id(0);                                   \\\n  int global_id_0 = get_global_id(0);                                   \\\n  int tblock_id_1 = get_tblock_id(1);                                   \\\n  int global_id_1 = get_global_id(1);                                   \\\n  for (int i1 = 0; i1 <= repeat_1; i1++) {                              \\\n    int tblock_id_2 = get_tblock_id(2);                                 \\\n    int global_id_2 = get_global_id(2);                                 \\\n    for (int i2 = 0; i2 <= repeat_2; i2++) {                            \\\n      int32_t our_array_offset = tblock_id_2 * x_elems * y_elems;       \\\n      int32_t odata_offset = dst_offset + our_array_offset;             \\\n      int32_t idata_offset = src_offset + our_array_offset;             \\\n      int32_t x_index =                                                 \\\n        tblock_id_0 * TR_BLOCK_DIM * mulx +                             \\\n        get_local_id(0) +                                               \\\n        get_local_id(1)%mulx * TR_BLOCK_DIM;                            \\\n      int32_t y_index = tblock_id_1 * TR_BLOCK_DIM + get_local_id(1)/mulx; \\\n      int32_t index_in = y_index * x_elems + x_index;                   \\\n      if (x_index < x_elems && y_index < y_elems) {                     \\\n        block[get_local_id(1) * (TR_BLOCK_DIM+1) + get_local_id(0)] =   \\\n          src_mem[idata_offset + index_in];                             \\\n      }                                                                 \\\n      barrier_local();                                                  \\\n      x_index = tblock_id_1 * TR_BLOCK_DIM + get_local_id(0)/mulx;      \\\n      y_index =                                                         \\\n        tblock_id_0 * TR_BLOCK_DIM * mulx +                             \\\n", "        get_local_id(1) +                                               \\\n        (get_local_id(0)%mulx) * TR_BLOCK_DIM;                          \\\n      int32_t index_out = y_index * y_elems + x_index;                  \\\n      if (x_index < y_elems && y_index < x_elems) {                     \\\n        dst_mem[odata_offset + index_out] =                             \\\n          block[get_local_id(0) * (TR_BLOCK_DIM+1) + get_local_id(1)];  \\\n      }                                                                 \\\n      tblock_id_2 += get_num_tblocks(2);                                \\\n      global_id_2 += get_global_size(2);                                \\\n    }                                                                   \\\n    tblock_id_1 += get_num_tblocks(1);                                  \\\n    global_id_1 += get_global_size(1);                                  \\\n  }                                                                     \\\n}                                                                       \\\n                                                                        \\\nFUTHARK_KERNEL_SIZED(TR_BLOCK_DIM, TR_BLOCK_DIM, 1)                     \\\nvoid map_transpose_##NAME##_low_width(SHARED_MEM_PARAM                  \\\n                                      __global ELEM_TYPE *dst_mem,      \\\n                                      int64_t dst_offset,               \\\n                                      __global ELEM_TYPE *src_mem,      \\\n                                      int64_t src_offset,               \\\n                                      int32_t num_arrays,               \\\n                                      int32_t x_elems,                  \\\n                                      int32_t y_elems,                  \\\n                                      int32_t mulx,                     \\\n                                      int32_t muly,                     \\\n                                      int32_t repeat_1,                 \\\n  ", "                                    int32_t repeat_2) {               \\\n  __local ELEM_TYPE* block = (__local ELEM_TYPE*)shared_mem;            \\\n  int tblock_id_0 = get_tblock_id(0);                                   \\\n  int global_id_0 = get_global_id(0);                                   \\\n  int tblock_id_1 = get_tblock_id(1);                                   \\\n  int global_id_1 = get_global_id(1);                                   \\\n  for (int i1 = 0; i1 <= repeat_1; i1++) {                              \\\n    int tblock_id_2 = get_tblock_id(2);                                 \\\n    int global_id_2 = get_global_id(2);                                 \\\n    for (int i2 = 0; i2 <= repeat_2; i2++) {                            \\\n      int32_t our_array_offset = tblock_id_2 * x_elems * y_elems;       \\\n      int32_t odata_offset = dst_offset + our_array_offset;             \\\n      int32_t idata_offset = src_offset + our_array_offset;             \\\n      int32_t x_index = tblock_id_0 * TR_BLOCK_DIM + get_local_id(0)/muly; \\\n      int32_t y_index =                                                 \\\n        tblock_id_1 * TR_BLOCK_DIM * muly +                             \\\n        get_local_id(1) + (get_local_id(0)%muly) * TR_BLOCK_DIM;        \\\n      int32_t index_in = y_index * x_elems + x_index;                   \\\n      if (x_index < x_elems && y_index < y_elems) {                     \\\n        block[get_local_id(1) * (TR_BLOCK_DIM+1) + get_local_id(0)] =   \\\n          src_mem[idata_offset + index_in];                             \\\n      }                                                                 \\\n      barrier_local();                                                  \\\n      x_index = tblock_id_1 * TR_BLOCK_DIM * muly +                     \\\n        get_local_id(0) + (get_local_id(1)%muly) * TR_BLOCK_DIM;        \\\n      y_index = tblock_id_0 * TR_BLOCK_DIM + get_local_id(1)/muly;      \\\n      int32_t index_out = y_index * y_elems + x_index;                  \\\n ",
                                    "     if (x_index < y_elems && y_index < x_elems) {                     \\\n        dst_mem[odata_offset + index_out] =                             \\\n          block[get_local_id(0) * (TR_BLOCK_DIM+1) + get_local_id(1)];  \\\n      }                                                                 \\\n      tblock_id_2 += get_num_tblocks(2);                                \\\n      global_id_2 += get_num_tblocks(2) * get_local_size(2);            \\\n    }                                                                   \\\n    tblock_id_1 += get_num_tblocks(1);                                  \\\n    global_id_1 += get_num_tblocks(1) * get_local_size(1);              \\\n  }                                                                     \\\n}                                                                       \\\n                                                                        \\\nFUTHARK_KERNEL_SIZED(TR_BLOCK_DIM*TR_BLOCK_DIM, 1, 1)                   \\\nvoid map_transpose_##NAME##_small(SHARED_MEM_PARAM                       \\\n                                  __global ELEM_TYPE *dst_mem,          \\\n                                  int64_t dst_offset,                   \\\n                                  __global ELEM_TYPE *src_mem,          \\\n                                  int64_t src_offset,                   \\\n                                  int32_t num_arrays,                   \\\n                                  int32_t x_elems,                      \\\n                                  int32_t y_elems,                      \\\n                                  int32_t mulx,                         \\\n                                  int32_t muly,                         \\\n                                  int32_t repeat_1,                     \\\n                                  int32_t repeat_2) {                   \\\n  (void)mulx; (void)muly;                                               \\\n  __local ELEM_TYPE* block = (__local ELEM_TYPE*)shared_mem;            \\\n  ", "int tblock_id_0 = get_tblock_id(0);                                   \\\n  int global_id_0 = get_global_id(0);                                   \\\n  int tblock_id_1 = get_tblock_id(1);                                   \\\n  int global_id_1 = get_global_id(1);                                   \\\n  for (int i1 = 0; i1 <= repeat_1; i1++) {                              \\\n    int tblock_id_2 = get_tblock_id(2);                                 \\\n    int global_id_2 = get_global_id(2);                                 \\\n    for (int i2 = 0; i2 <= repeat_2; i2++) {                            \\\n      int32_t our_array_offset = global_id_0/(y_elems * x_elems) * y_elems * x_elems; \\\n      int32_t x_index = (global_id_0 % (y_elems * x_elems))/y_elems;    \\\n      int32_t y_index = global_id_0%y_elems;                            \\\n      int32_t odata_offset = dst_offset + our_array_offset;             \\\n      int32_t idata_offset = src_offset + our_array_offset;             \\\n      int32_t index_in = y_index * x_elems + x_index;                   \\\n      int32_t index_out = x_index * y_elems + y_index;                  \\\n      if (global_id_0 < x_elems * y_elems * num_arrays) {               \\\n        dst_mem[odata_offset + index_out] = src_mem[idata_offset + index_in]; \\\n      }                                                                 \\\n      tblock_id_2 += get_num_tblocks(2);                                \\\n      global_id_2 += get_global_size(2);                                \\\n    }                                                                   \\\n    tblock_id_1 += get_num_tblocks(1);                                  \\\n    global_id_1 += get_global_size(1);                                  \\\n  }                                                                     \\\n}                                                                       \\\n                                                                        \\\nFUTHARK_KERNEL_SIZED(TR_BLOCK_DIM*2, TR_TILE_DIM/TR_ELEMS_", "PER_THREAD, 1)\\\nvoid map_transpose_##NAME##_large(SHARED_MEM_PARAM                      \\\n                                  __global ELEM_TYPE *dst_mem,          \\\n                                  int64_t dst_offset,                   \\\n                                  __global ELEM_TYPE *src_mem,          \\\n                                  int64_t src_offset,                   \\\n                                  int64_t num_arrays,                   \\\n                                  int64_t x_elems,                      \\\n                                  int64_t y_elems,                      \\\n                                  int64_t mulx,                         \\\n                                  int64_t muly,                         \\\n                                  int32_t repeat_1,                     \\\n                                  int32_t repeat_2) {                   \\\n  (void)mulx; (void)muly;                                               \\\n  __local ELEM_TYPE* block = (__local ELEM_TYPE*)shared_mem;             \\\n  int tblock_id_0 = get_tblock_id(0);                                   \\\n  int global_id_0 = get_global_id(0);                                   \\\n  int tblock_id_1 = get_tblock_id(1);                                   \\\n  int global_id_1 = get_global_id(1);                                   \\\n  for (int i1 = 0; i1 <= repeat_1; i1++) {                              \\\n    int tblock_id_2 = get_tblock_id(2);                                 \\\n    int global_id_2 = get_global_id(2);                                 \\\n    for (int i2 = 0; i2 <= repeat_2; i2++) {                            \\\n      int64_t our_array_offset = tblock_id_2 * x_elems * y_elems;       \\\n      int64_t odata_offset = dst_offset + our_array_offset;             \\\n      int64_t idata_offset = src_offset + our_array_offset;             \\\n      int64_t x_index = global_id_0;                                    \\\n      int64_t y_index = tblock_id_1 * TR_TILE_DIM + get_loc",
                                    "al_id(1);    \\\n      if (x_index < x_elems) {                                          \\\n        for (int64_t j = 0; j < TR_ELEMS_PER_THREAD; j++) {             \\\n          int64_t index_i = (y_index + j * (TR_TILE_DIM/TR_ELEMS_PER_THREAD)) * x_elems + x_index; \\\n          if (y_index + j * (TR_TILE_DIM/TR_ELEMS_PER_THREAD) < y_elems) { \\\n            block[(get_local_id(1) + j * (TR_TILE_DIM/TR_ELEMS_PER_THREAD)) * (TR_TILE_DIM+1) + \\\n                  get_local_id(0)] =                                    \\\n              src_mem[idata_offset + index_i];                          \\\n          }                                                             \\\n        }                                                               \\\n      }                                                                 \\\n      barrier_local();                                                  \\\n      x_index = tblock_id_1 * TR_TILE_DIM + get_local_id(0);            \\\n      y_index = tblock_id_0 * TR_TILE_DIM + get_local_id(1);            \\\n      if (x_index < y_elems) {                                          \\\n        for (int64_t j = 0; j < TR_ELEMS_PER_THREAD; j++) {             \\\n          int64_t index_out = (y_index + j * (TR_TILE_DIM/TR_ELEMS_PER_THREAD)) * y_elems + x_index; \\\n          if (y_index + j * (TR_TILE_DIM/TR_ELEMS_PER_THREAD) < x_elems) { \\\n            dst_mem[(odata_offset + index_out)] =                       \\\n              block[get_local_id(0) * (TR_TILE_DIM+1) +                 \\\n                    get_local_id(1) + j * (TR_TILE_DIM/TR_ELEMS_PER_THREAD)]; \\\n          }                                                             \\\n        }                                                               \\\n      }                                                                 \\\n      tblock_id_2 += get_num_tblocks(2);                                \\\n      global_id_2 += get_global_size(2);                                \\\n    }                                      ", "                             \\\n    tblock_id_1 += get_num_tblocks(1);                                  \\\n    global_id_1 += get_global_size(1);                                  \\\n  }                                                                     \\\n}                                                                       \\\n\nGEN_TRANSPOSE_KERNELS(1b, uint8_t)\nGEN_TRANSPOSE_KERNELS(2b, uint16_t)\nGEN_TRANSPOSE_KERNELS(4b, uint32_t)\nGEN_TRANSPOSE_KERNELS(8b, uint64_t)\n\n// End of transpose.cl\n// Start of copy.cl\n\n#define GEN_COPY_KERNEL(NAME, ELEM_TYPE) \\\nFUTHARK_KERNEL void lmad_copy_##NAME(SHARED_MEM_PARAM                   \\\n                               __global ELEM_TYPE *dst_mem,             \\\n                               int64_t dst_offset,                      \\\n                               __global ELEM_TYPE *src_mem,             \\\n                               int64_t src_offset,                      \\\n                               int64_t n,                               \\\n                               int r,                                   \\\n                               int64_t shape0, int64_t dst_stride0, int64_t src_stride0, \\\n                               int64_t shape1, int64_t dst_stride1, int64_t src_stride1, \\\n                               int64_t shape2, int64_t dst_stride2, int64_t src_stride2, \\\n                               int64_t shape3, int64_t dst_stride3, int64_t src_stride3, \\\n                               int64_t shape4, int64_t dst_stride4, int64_t src_stride4, \\\n                               int64_t shape5, int64_t dst_stride5, int64_t src_stride5, \\\n                               int64_t shape6, int64_t dst_stride6, int64_t src_stride6, \\\n                               int64_t shape7, int64_t dst_stride7, int64_t src_stride7) { \\\n  int64_t gtid = get_global_id(0);                                      \\\n  int64_t remainder = gtid;                                             \\\n                                             ", "                           \\\n  if (gtid >= n) {                                                      \\\n    return;                                                             \\\n  }                                                                     \\\n                                                                        \\\n  if (r > 0) {                                                          \\\n    int64_t i = remainder % shape0;                                     \\\n    dst_offset += i * dst_stride0;                                      \\\n    src_offset += i * src_stride0;                                      \\\n    remainder /= shape0;                                                \\\n  }                                                                     \\\n  if (r > 1) {                                                          \\\n    int64_t i = remainder % shape1;                                     \\\n    dst_offset += i * dst_stride1;                                      \\\n    src_offset += i * src_stride1;                                      \\\n    remainder /= shape1;                                                \\\n  }                                                                     \\\n  if (r > 2) {                                                          \\\n    int64_t i = remainder % shape2;                                     \\\n    dst_offset += i * dst_stride2;                                      \\\n    src_offset += i * src_stride2;                                      \\\n    remainder /= shape2;                                                \\\n  }                                                                     \\\n  if (r > 3) {                                                          \\\n    int64_t i = remainder % shape3;                                     \\\n    dst_offset += i * dst_stride3;                                      \\\n    src_offset += i * src_stride3;                                      \\\n    remainder /= shape3;                       ",
                                    "                         \\\n  }                                                                     \\\n  if (r > 4) {                                                          \\\n    int64_t i = remainder % shape4;                                     \\\n    dst_offset += i * dst_stride4;                                      \\\n    src_offset += i * src_stride4;                                      \\\n    remainder /= shape4;                                                \\\n  }                                                                     \\\n  if (r > 5) {                                                          \\\n    int64_t i = remainder % shape5;                                     \\\n    dst_offset += i * dst_stride5;                                      \\\n    src_offset += i * src_stride5;                                      \\\n    remainder /= shape5;                                                \\\n  }                                                                     \\\n  if (r > 6) {                                                          \\\n    int64_t i = remainder % shape6;                                     \\\n    dst_offset += i * dst_stride6;                                      \\\n    src_offset += i * src_stride6;                                      \\\n    remainder /= shape6;                                                \\\n  }                                                                     \\\n  if (r > 7) {                                                          \\\n    int64_t i = remainder % shape7;                                     \\\n    dst_offset += i * dst_stride7;                                      \\\n    src_offset += i * src_stride7;                                      \\\n    remainder /= shape7;                                                \\\n  }                                                                     \\\n                                                                        \\\n  dst_mem[dst_offset] = src_mem[src_offset];     ", "                       \\\n}\n\nGEN_COPY_KERNEL(1b, uint8_t)\nGEN_COPY_KERNEL(2b, uint16_t)\nGEN_COPY_KERNEL(4b, uint32_t)\nGEN_COPY_KERNEL(8b, uint64_t)\n\n// End of copy.cl\n\n\n\nFUTHARK_KERNEL_SIZED(add_next_partition_doublezigpuseq_54795_dim1, 1, 1)\nvoid add_next_partition_doublezigpuseq_54795(__global int *global_failure, __global unsigned char *clBase_mem_53511, __global unsigned char *mem_53556)\n{\n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_54797;\n    int32_t tblock_sizze_54800;\n    int32_t wave_sizze_54799;\n    int32_t block_id_54798;\n    int32_t global_tid_54796;\n    int64_t tid_54795;\n    double x_53432;\n    \n    local_tid_54797 = get_local_id(0);\n    tblock_sizze_54800 = get_local_size(0);\n    wave_sizze_54799 = LOCKSTEP_WIDTH;\n    block_id_54798 = get_tblock_id(0);\n    global_tid_54796 = block_id_54798 * tblock_sizze_54800 + local_tid_54797;\n    tid_54795 = sext_i32_i64(global_tid_54796);\n    x_53432 = ((__global double *) clBase_mem_53511)[(int64_t) 0];\n    ((__global double *) mem_53556)[(int64_t) 0] = x_53432;\n    \n  error_0:\n    return;\n}\nFUTHARK_KERNEL_SIZED(add_next_partition_doublezigpuseq_54821_dim1, 1, 1)\nvoid add_next_partition_doublezigpuseq_54821(__global int *global_failure, __global unsigned char *clBase_mem_53509, __global unsigned char *mem_53559)\n{\n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_54823;\n    int32_t tblock_sizze_54826;\n    int32_t wave_sizze_54825;\n    int32_t block_id_54824;\n    int32_t global_tid_54822;\n    int64_t tid_54821;\n    double x_53436;\n    \n    local_tid_54823 = get_local_id(0);\n    tblock_sizze_54826 = get_local_size(0);\n    wave_sizze_54825 = LOCKSTEP_WIDTH;\n    block_id_54824 = get_tblock_id(0);\n    global_tid_54822 = block_id_54824 * tblock_sizze_54826 + local_tid_54823;\n    tid_54821 = sext_i32_i64(global_tid_54822);\n    x_53436 = ((__global double *) clBase_mem_53509)[(int64_t) 0];\n    ((__global double *) mem_53559)[(int64_t) 0] = x_53436;\n    \n  error_0:\n    ret", "urn;\n}\nFUTHARK_KERNEL_SIZED(add_next_partition_doublezigpuseq_54827_dim1, 1, 1)\nvoid add_next_partition_doublezigpuseq_54827(__global int *global_failure, __global unsigned char *clBase_mem_53511, __global unsigned char *mem_53562)\n{\n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_54829;\n    int32_t tblock_sizze_54832;\n    int32_t wave_sizze_54831;\n    int32_t block_id_54830;\n    int32_t global_tid_54828;\n    int64_t tid_54827;\n    double x_53440;\n    \n    local_tid_54829 = get_local_id(0);\n    tblock_sizze_54832 = get_local_size(0);\n    wave_sizze_54831 = LOCKSTEP_WIDTH;\n    block_id_54830 = get_tblock_id(0);\n    global_tid_54828 = block_id_54830 * tblock_sizze_54832 + local_tid_54829;\n    tid_54827 = sext_i32_i64(global_tid_54828);\n    x_53440 = ((__global double *) clBase_mem_53511)[(int64_t) 1];\n    ((__global double *) mem_53562)[(int64_t) 0] = x_53440;\n    \n  error_0:\n    return;\n}\nFUTHARK_KERNEL_SIZED(add_next_partition_doublezigpuseq_54833_dim1, 1, 1)\nvoid add_next_partition_doublezigpuseq_54833(__global int *global_failure, __global unsigned char *clBase_mem_53509, __global unsigned char *mem_53565)\n{\n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_54835;\n    int32_t tblock_sizze_54838;\n    int32_t wave_sizze_54837;\n    int32_t block_id_54836;\n    int32_t global_tid_54834;\n    int64_t tid_54833;\n    double x_53444;\n    \n    local_tid_54835 = get_local_id(0);\n    tblock_sizze_54838 = get_local_size(0);\n    wave_sizze_54837 = LOCKSTEP_WIDTH;\n    block_id_54836 = get_tblock_id(0);\n    global_tid_54834 = block_id_54836 * tblock_sizze_54838 + local_tid_54835;\n    tid_54833 = sext_i32_i64(global_tid_54834);\n    x_53444 = ((__global double *) clBase_mem_53509)[(int64_t) 1];\n    ((__global double *) mem_53565)[(int64_t) 0] = x_53444;\n    \n  error_0:\n    return;\n}\nFUTHARK_KERNEL_SIZED(add_next_partition_doublezigpuseq_54839_dim1, 1, 1)\nvoid add_next_partition_doublezigpuseq_54839(__global int *global_failure, __globa",
                                    "l unsigned char *clBase_mem_53511, __global unsigned char *mem_53568)\n{\n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_54841;\n    int32_t tblock_sizze_54844;\n    int32_t wave_sizze_54843;\n    int32_t block_id_54842;\n    int32_t global_tid_54840;\n    int64_t tid_54839;\n    double x_53448;\n    \n    local_tid_54841 = get_local_id(0);\n    tblock_sizze_54844 = get_local_size(0);\n    wave_sizze_54843 = LOCKSTEP_WIDTH;\n    block_id_54842 = get_tblock_id(0);\n    global_tid_54840 = block_id_54842 * tblock_sizze_54844 + local_tid_54841;\n    tid_54839 = sext_i32_i64(global_tid_54840);\n    x_53448 = ((__global double *) clBase_mem_53511)[(int64_t) 0];\n    ((__global double *) mem_53568)[(int64_t) 0] = x_53448;\n    \n  error_0:\n    return;\n}\nFUTHARK_KERNEL_SIZED(add_next_partition_doublezigpuseq_54845_dim1, 1, 1)\nvoid add_next_partition_doublezigpuseq_54845(__global int *global_failure, __global unsigned char *clBase_mem_53511, __global unsigned char *mem_53571)\n{\n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_54847;\n    int32_t tblock_sizze_54850;\n    int32_t wave_sizze_54849;\n    int32_t block_id_54848;\n    int32_t global_tid_54846;\n    int64_t tid_54845;\n    double x_53452;\n    \n    local_tid_54847 = get_local_id(0);\n    tblock_sizze_54850 = get_local_size(0);\n    wave_sizze_54849 = LOCKSTEP_WIDTH;\n    block_id_54848 = get_tblock_id(0);\n    global_tid_54846 = block_id_54848 * tblock_sizze_54850 + local_tid_54847;\n    tid_54845 = sext_i32_i64(global_tid_54846);\n    x_53452 = ((__global double *) clBase_mem_53511)[(int64_t) 1];\n    ((__global double *) mem_53571)[(int64_t) 0] = x_53452;\n    \n  error_0:\n    return;\n}\nFUTHARK_KERNEL_SIZED(add_next_partition_doublezigpuseq_54852_dim1, 1, 1)\nvoid add_next_partition_doublezigpuseq_54852(__global int *global_failure, int failure_is_an_option, __global int64_t *global_failure_args, int64_t new_id_28463, unsigned char loop_not_taken_41387_bits, __global unsigned char *clBase_mem_53509,", " __global unsigned char *clBase_mem_53510, __global unsigned char *clBase_mem_53511, __global unsigned char *mem_53578, __global unsigned char *mem_53579, __global unsigned char *mem_53580, __global unsigned char *mem_53581, __global unsigned char *mem_53582, __global unsigned char *mem_53583, __global unsigned char *mem_53584, __global unsigned char *mem_53585, __global unsigned char *mem_53586, __global unsigned char *mem_53587, __global unsigned char *mem_53588, __global unsigned char *mem_53589, __global unsigned char *mem_53590, __global unsigned char *mem_53591, __global unsigned char *mem_53592, __global unsigned char *mem_53593)\n{\n    bool loop_not_taken_41387 = loop_not_taken_41387_bits;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_54854;\n    int32_t tblock_sizze_54857;\n    int32_t wave_sizze_54856;\n    int32_t block_id_54855;\n    int32_t global_tid_54853;\n    int64_t tid_54852;\n    int64_t zv_rhs_53183;\n    bool zzero_53186;\n    bool nonzzero_53189;\n    bool nonzzero_cert_53192;\n    int64_t x_id_53195;\n    int64_t y_id_53198;\n    bool cond_53201;\n    int64_t zp_lhs_53205;\n    int64_t zm_lhs_53209;\n    int64_t nleft_t_res_53212;\n    int64_t nleft_53216;\n    bool cond_t_res_53219;\n    bool x_53223;\n    int64_t zt_lhs_53226;\n    int64_t zp_lhs_53230;\n    int64_t zm_lhs_53234;\n    int64_t nld_t_res_53237;\n    int64_t nld_53241;\n    int64_t ndown_53245;\n    int64_t zl_rhs_53248;\n    bool cond_53252;\n    bool x_53256;\n    int64_t nrd_t_res_53259;\n    int64_t nrd_53263;\n    int64_t nright_t_res_53266;\n    int64_t nright_53270;\n    int64_t zm_lhs_53274;\n    int64_t zl_rhs_53277;\n    bool cond_t_res_53281;\n    bool x_53285;\n    int64_t zt_lhs_53288;\n    int64_t zp_lhs_53292;\n    int64_t zp_lhs_53296;\n    int64_t nru_t_res_53299;\n    int64_t nru_53303;\n    int64_t zm_lhs_53305;\n    int64_t zl_rhs_53308;\n    bool cond_53312;\n    int64_t nup_53316;\n    bool x_53320;\n    int64_t nlu_t_res_53323;\n    int64_t nlu_53327;\n    bool cond_5334", "0;\n    double minC_53349;\n    bool cond_53352;\n    double minC_53361;\n    bool cond_53365;\n    double maxC_53375;\n    bool cond_53379;\n    double maxC_53388;\n    bool protect_assert_disj_53427;\n    bool nonzzero_cert_53430;\n    \n    local_tid_54854 = get_local_id(0);\n    tblock_sizze_54857 = get_local_size(0);\n    wave_sizze_54856 = LOCKSTEP_WIDTH;\n    block_id_54855 = get_tblock_id(0);\n    global_tid_54853 = block_id_54855 * tblock_sizze_54857 + local_tid_54854;\n    tid_54852 = sext_i32_i64(global_tid_54853);\n    zv_rhs_53183 = ((__global int64_t *) clBase_mem_53510)[(int64_t) 0];\n    zzero_53186 = zv_rhs_53183 == (int64_t) 0;\n    nonzzero_53189 = !zzero_53186;\n    if (!nonzzero_53189) {\n        {\n            if (atomic_cmpxchg_i32_global(global_failure, -1, 0) == -1) {\n                ;\n            }\n            return;\n        }\n    }\n    x_id_53195 = smod64(new_id_28463, zv_rhs_53183);\n    y_id_53198 = sdiv64(new_id_28463, zv_rhs_53183);\n    cond_53201 = slt64((int64_t) 0, x_id_53195);\n    zp_lhs_53205 = mul64(zv_rhs_53183, y_id_53198);\n    zm_lhs_53209 = add64(x_id_53195, zp_lhs_53205);\n    nleft_t_res_53212 = sub64(zm_lhs_53209, (int64_t) 1);\n    if (cond_53201) {\n        nleft_53216 = nleft_t_res_53212;\n    } else {\n        nleft_53216 = (int64_t) -1;\n    }\n    cond_t_res_53219 = slt64((int64_t) 0, y_id_53198);\n    x_53223 = cond_53201 && cond_t_res_53219;\n    zt_lhs_53226 = sub64(y_id_53198, (int64_t) 1);\n    zp_lhs_53230 = mul64(zv_rhs_53183, zt_lhs_53226);\n    zm_lhs_53234 = add64(x_id_53195, zp_lhs_53230);\n    nld_t_res_53237 = sub64(zm_lhs_53234, (int64_t) 1);\n    if (x_53223) {\n        nld_53241 = nld_t_res_53237;\n    } else {\n        nld_53241 = (int64_t) -1;\n    }\n    if (cond_t_res_53219) {\n        ndown_53245 = zm_lhs_53234;\n    } else {\n        ndown_53245 = (int64_t) -1;\n    }\n    zl_rhs_53248 = sub64(zv_rhs_53183, (int64_t) 1);\n    cond_53252 = slt64(x_id_53195, zl_rhs_53248);\n    x_53256 = cond_t_res_53219 && cond_53252;\n    nrd_t_res_53259 = ad",
                                    "d64((int64_t) 1, zm_lhs_53234);\n    if (x_53256) {\n        nrd_53263 = nrd_t_res_53259;\n    } else {\n        nrd_53263 = (int64_t) -1;\n    }\n    nright_t_res_53266 = add64((int64_t) 1, zm_lhs_53209);\n    if (cond_53252) {\n        nright_53270 = nright_t_res_53266;\n    } else {\n        nright_53270 = (int64_t) -1;\n    }\n    if (cond_53252) {\n        int64_t x_53273 = ((__global int64_t *) clBase_mem_53510)[(int64_t) 1];\n        \n        zm_lhs_53274 = x_53273;\n    } else {\n        zm_lhs_53274 = (int64_t) 0;\n    }\n    zl_rhs_53277 = sub64(zm_lhs_53274, (int64_t) 1);\n    cond_t_res_53281 = slt64(y_id_53198, zl_rhs_53277);\n    x_53285 = cond_53252 && cond_t_res_53281;\n    zt_lhs_53288 = add64((int64_t) 1, y_id_53198);\n    zp_lhs_53292 = mul64(zv_rhs_53183, zt_lhs_53288);\n    zp_lhs_53296 = add64(x_id_53195, zp_lhs_53292);\n    nru_t_res_53299 = add64((int64_t) 1, zp_lhs_53296);\n    if (x_53285) {\n        nru_53303 = nru_t_res_53299;\n    } else {\n        nru_53303 = (int64_t) -1;\n    }\n    zm_lhs_53305 = ((__global int64_t *) clBase_mem_53510)[(int64_t) 1];\n    zl_rhs_53308 = sub64(zm_lhs_53305, (int64_t) 1);\n    cond_53312 = slt64(y_id_53198, zl_rhs_53308);\n    if (cond_53312) {\n        nup_53316 = zp_lhs_53296;\n    } else {\n        nup_53316 = (int64_t) -1;\n    }\n    x_53320 = cond_53201 && cond_53312;\n    nlu_t_res_53323 = sub64(zp_lhs_53296, (int64_t) 1);\n    if (x_53320) {\n        nlu_53327 = nlu_t_res_53323;\n    } else {\n        nlu_53327 = (int64_t) -1;\n    }\n    ((__global int64_t *) mem_53578)[(int64_t) 0] = nleft_53216;\n    ((__global int64_t *) mem_53578)[(int64_t) 1] = nld_53241;\n    ((__global int64_t *) mem_53578)[(int64_t) 2] = ndown_53245;\n    ((__global int64_t *) mem_53578)[(int64_t) 3] = nrd_53263;\n    ((__global int64_t *) mem_53578)[(int64_t) 4] = nright_53270;\n    ((__global int64_t *) mem_53578)[(int64_t) 5] = nru_53303;\n    ((__global int64_t *) mem_53578)[(int64_t) 6] = nup_53316;\n    ((__global int64_t *) mem_53578)[(int64_t) 7] = nlu_53327;\n   ", " cond_53340 = x_id_53195 == (int64_t) 0;\n    if (cond_53340) {\n        minC_53349 = -INFINITY;\n    } else {\n        double times_arg1_53343;\n        double i64_res_53345;\n        double zt_res_53346;\n        double plus_arg0_53347;\n        double zp_res_53348;\n        \n        times_arg1_53343 = ((__global double *) clBase_mem_53511)[(int64_t) 0];\n        i64_res_53345 = sitofp_i64_f64(x_id_53195);\n        zt_res_53346 = times_arg1_53343 * i64_res_53345;\n        plus_arg0_53347 = ((__global double *) clBase_mem_53509)[(int64_t) 0];\n        zp_res_53348 = zt_res_53346 + plus_arg0_53347;\n        minC_53349 = zp_res_53348;\n    }\n    cond_53352 = y_id_53198 == (int64_t) 0;\n    if (cond_53352) {\n        minC_53361 = -INFINITY;\n    } else {\n        double times_arg1_53355;\n        double i64_res_53357;\n        double zt_res_53358;\n        double plus_arg0_53359;\n        double zp_res_53360;\n        \n        times_arg1_53355 = ((__global double *) clBase_mem_53511)[(int64_t) 1];\n        i64_res_53357 = sitofp_i64_f64(y_id_53198);\n        zt_res_53358 = times_arg1_53355 * i64_res_53357;\n        plus_arg0_53359 = ((__global double *) clBase_mem_53509)[(int64_t) 1];\n        zp_res_53360 = zt_res_53358 + plus_arg0_53359;\n        minC_53361 = zp_res_53360;\n    }\n    cond_53365 = x_id_53195 == zl_rhs_53248;\n    if (cond_53365) {\n        maxC_53375 = INFINITY;\n    } else {\n        double times_arg1_53368;\n        int64_t from_i64_arg0_53370;\n        double i64_res_53371;\n        double zt_res_53372;\n        double plus_arg0_53373;\n        double zp_res_53374;\n        \n        times_arg1_53368 = ((__global double *) clBase_mem_53511)[(int64_t) 0];\n        from_i64_arg0_53370 = add64((int64_t) 1, x_id_53195);\n        i64_res_53371 = sitofp_i64_f64(from_i64_arg0_53370);\n        zt_res_53372 = times_arg1_53368 * i64_res_53371;\n        plus_arg0_53373 = ((__global double *) clBase_mem_53509)[(int64_t) 0];\n        zp_res_53374 = zt_res_53372 + plus_arg0_53373;\n        maxC_53375 = zp_r", "es_53374;\n    }\n    cond_53379 = y_id_53198 == zl_rhs_53308;\n    if (cond_53379) {\n        maxC_53388 = INFINITY;\n    } else {\n        double times_arg1_53382;\n        double i64_res_53384;\n        double zt_res_53385;\n        double plus_arg0_53386;\n        double zp_res_53387;\n        \n        times_arg1_53382 = ((__global double *) clBase_mem_53511)[(int64_t) 1];\n        i64_res_53384 = sitofp_i64_f64(zt_lhs_53288);\n        zt_res_53385 = times_arg1_53382 * i64_res_53384;\n        plus_arg0_53386 = ((__global double *) clBase_mem_53509)[(int64_t) 1];\n        zp_res_53387 = zt_res_53385 + plus_arg0_53386;\n        maxC_53388 = zp_res_53387;\n    }\n    protect_assert_disj_53427 = loop_not_taken_41387 || nonzzero_53189;\n    if (!protect_assert_disj_53427) {\n        {\n            if (atomic_cmpxchg_i32_global(global_failure, -1, 1) == -1) {\n                ;\n            }\n            return;\n        }\n    }\n    ((__global double *) mem_53579)[(int64_t) 0] = minC_53349;\n    ((__global double *) mem_53579)[(int64_t) 1] = minC_53361;\n    ((__global double *) mem_53580)[(int64_t) 0] = maxC_53375;\n    ((__global double *) mem_53580)[(int64_t) 1] = maxC_53388;\n    ((__global int64_t *) mem_53581)[(int64_t) 0] = zv_rhs_53183;\n    for (int64_t i_0 = 0; i_0 < (int64_t) 8; i_0++) {\n        ((__global int64_t *) mem_53582)[i_0] = ((__global int64_t *) mem_53578)[i_0];\n    }\n    ((__global bool *) mem_53583)[(int64_t) 0] = cond_53340;\n    ((__global double *) mem_53584)[(int64_t) 0] = minC_53349;\n    ((__global bool *) mem_53585)[(int64_t) 0] = cond_53352;\n    ((__global double *) mem_53586)[(int64_t) 0] = minC_53361;\n    ((__global bool *) mem_53587)[(int64_t) 0] = cond_53365;\n    ((__global double *) mem_53588)[(int64_t) 0] = maxC_53375;\n    ((__global bool *) mem_53589)[(int64_t) 0] = cond_53379;\n    ((__global double *) mem_53590)[(int64_t) 0] = maxC_53388;\n    for (int64_t i_0 = 0; i_0 < (int64_t) 2; i_0++) {\n        ((__global double *) mem_53592)[i_0] = ((__global double *) ",
                                    "mem_53579)[i_0];\n    }\n    for (int64_t i_0 = 0; i_0 < (int64_t) 2; i_0++) {\n        ((__global double *) mem_53593)[i_0] = ((__global double *) mem_53580)[i_0];\n    }\n    \n  error_0:\n    return;\n}\nFUTHARK_KERNEL_SIZED(add_next_partition_doublezigpuseq_55663_dim1, 1, 1)\nvoid add_next_partition_doublezigpuseq_55663(__global int *global_failure, double zt_res_40980, __global unsigned char *mem_53583, __global unsigned char *mem_53584, __global unsigned char *mem_53585, __global unsigned char *mem_53586, __global unsigned char *mem_53587, __global unsigned char *mem_53588, __global unsigned char *mem_53589, __global unsigned char *mem_53590, __global unsigned char *ext_mem_53654, __global unsigned char *mem_53731, __global unsigned char *mem_53732, __global unsigned char *mem_53733, __global unsigned char *mem_53734)\n{\n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_55665;\n    int32_t tblock_sizze_55668;\n    int32_t wave_sizze_55667;\n    int32_t block_id_55666;\n    int32_t global_tid_55664;\n    int64_t tid_55663;\n    bool cond_53390;\n    bool cond_53392;\n    double minC_53395;\n    double min_inner_53397;\n    bool cond_53399;\n    bool cond_53401;\n    double minC_53404;\n    double min_inner_53406;\n    bool cond_53408;\n    bool cond_53410;\n    double maxC_53413;\n    double max_inner_53415;\n    bool cond_53417;\n    bool cond_53419;\n    double maxC_53422;\n    double max_inner_53424;\n    \n    local_tid_55665 = get_local_id(0);\n    tblock_sizze_55668 = get_local_size(0);\n    wave_sizze_55667 = LOCKSTEP_WIDTH;\n    block_id_55666 = get_tblock_id(0);\n    global_tid_55664 = block_id_55666 * tblock_sizze_55668 + local_tid_55665;\n    tid_55663 = sext_i32_i64(global_tid_55664);\n    cond_53390 = ((__global bool *) mem_53583)[(int64_t) 0];\n    if (cond_53390) {\n        cond_53392 = 1;\n    } else {\n        bool cond_f_res_53391 = ((__global bool *) ext_mem_53654)[(int64_t) 0];\n        \n        cond_53392 = cond_f_res_53391;\n    }\n    minC_53395 = ((__global dou", "ble *) mem_53584)[(int64_t) 0];\n    if (cond_53392) {\n        min_inner_53397 = minC_53395;\n    } else {\n        double zp_res_53396 = zt_res_40980 + minC_53395;\n        \n        min_inner_53397 = zp_res_53396;\n    }\n    cond_53399 = ((__global bool *) mem_53585)[(int64_t) 0];\n    if (cond_53399) {\n        cond_53401 = 1;\n    } else {\n        bool cond_f_res_53400 = ((__global bool *) ext_mem_53654)[(int64_t) 1];\n        \n        cond_53401 = cond_f_res_53400;\n    }\n    minC_53404 = ((__global double *) mem_53586)[(int64_t) 0];\n    if (cond_53401) {\n        min_inner_53406 = minC_53404;\n    } else {\n        double zp_res_53405 = zt_res_40980 + minC_53404;\n        \n        min_inner_53406 = zp_res_53405;\n    }\n    cond_53408 = ((__global bool *) mem_53587)[(int64_t) 0];\n    if (cond_53408) {\n        cond_53410 = 1;\n    } else {\n        bool cond_f_res_53409 = ((__global bool *) ext_mem_53654)[(int64_t) 2];\n        \n        cond_53410 = cond_f_res_53409;\n    }\n    maxC_53413 = ((__global double *) mem_53588)[(int64_t) 0];\n    if (cond_53410) {\n        max_inner_53415 = maxC_53413;\n    } else {\n        double zm_res_53414 = maxC_53413 - zt_res_40980;\n        \n        max_inner_53415 = zm_res_53414;\n    }\n    cond_53417 = ((__global bool *) mem_53589)[(int64_t) 0];\n    if (cond_53417) {\n        cond_53419 = 1;\n    } else {\n        bool cond_f_res_53418 = ((__global bool *) ext_mem_53654)[(int64_t) 3];\n        \n        cond_53419 = cond_f_res_53418;\n    }\n    maxC_53422 = ((__global double *) mem_53590)[(int64_t) 0];\n    if (cond_53419) {\n        max_inner_53424 = maxC_53422;\n    } else {\n        double zm_res_53423 = maxC_53422 - zt_res_40980;\n        \n        max_inner_53424 = zm_res_53423;\n    }\n    ((__global double *) mem_53731)[(int64_t) 0] = min_inner_53397;\n    ((__global double *) mem_53731)[(int64_t) 1] = min_inner_53406;\n    ((__global double *) mem_53732)[(int64_t) 0] = max_inner_53415;\n    ((__global double *) mem_53732)[(int64_t) 1] = max_inner_53424;\n    f", "or (int64_t i_0 = 0; i_0 < (int64_t) 2; i_0++) {\n        ((__global double *) mem_53733)[i_0] = ((__global double *) mem_53731)[i_0];\n    }\n    for (int64_t i_0 = 0; i_0 < (int64_t) 2; i_0++) {\n        ((__global double *) mem_53734)[i_0] = ((__global double *) mem_53732)[i_0];\n    }\n    \n  error_0:\n    return;\n}\nFUTHARK_KERNEL_SIZED(add_next_partition_doublezisegmap_46379_dim1, 1, 1)\nvoid add_next_partition_doublezisegmap_46379(__global int *global_failure, int failure_is_an_option, __global int64_t *global_failure_args, int64_t part_no_28414, __global unsigned char *clProc_mem_53516, __global unsigned char *mem_53582, __global unsigned char *mem_53595)\n{\n    #define segmap_tblock_sizze_46375 (add_next_partition_doublezisegmap_46379zisegmap_tblock_sizze_46375)\n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_55008;\n    int32_t tblock_sizze_55011;\n    int32_t wave_sizze_55010;\n    int32_t block_id_55009;\n    int32_t global_tid_55007;\n    int64_t phys_tid_46379;\n    int64_t global_tid_55012;\n    int64_t slice_55013;\n    int64_t gtid_46378;\n    int64_t remnant_55014;\n    \n    local_tid_55008 = get_local_id(0);\n    tblock_sizze_55011 = get_local_size(0);\n    wave_sizze_55010 = LOCKSTEP_WIDTH;\n    block_id_55009 = get_tblock_id(0);\n    global_tid_55007 = block_id_55009 * tblock_sizze_55011 + local_tid_55008;\n    phys_tid_46379 = sext_i32_i64(global_tid_55007);\n    global_tid_55012 = sext_i32_i64(block_id_55009) * segmap_tblock_sizze_46375 + sext_i32_i64(local_tid_55008);\n    slice_55013 = (int64_t) 8;\n    gtid_46378 = global_tid_55012;\n    remnant_55014 = global_tid_55012 - gtid_46378;\n    if (slt64(gtid_46378, (int64_t) 8)) {\n        int64_t eta_p_46380;\n        bool cond_46381;\n        bool lifted_lambda_res_46382;\n        \n        eta_p_46380 = ((__global int64_t *) mem_53582)[gtid_46378];\n        cond_46381 = sle64((int64_t) 0, eta_p_46380);\n        if (cond_46381) {\n            bool y_46383;\n            bool bounds_check_46384;\n            b",
                                    "ool index_certs_46385;\n            bool lifted_lambda_res_t_res_46386;\n            \n            y_46383 = slt64(eta_p_46380, part_no_28414);\n            bounds_check_46384 = cond_46381 && y_46383;\n            if (!bounds_check_46384) {\n                {\n                    if (atomic_cmpxchg_i32_global(global_failure, -1, 6) == -1) {\n                        global_failure_args[0] = (int64_t) eta_p_46380;\n                        global_failure_args[1] = (int64_t) part_no_28414;\n                        ;\n                    }\n                    return;\n                }\n            }\n            lifted_lambda_res_t_res_46386 = ((__global bool *) clProc_mem_53516)[eta_p_46380];\n            lifted_lambda_res_46382 = lifted_lambda_res_t_res_46386;\n        } else {\n            lifted_lambda_res_46382 = 0;\n        }\n        ((__global bool *) mem_53595)[gtid_46378] = lifted_lambda_res_46382;\n    }\n    \n  error_0:\n    return;\n    #undef segmap_tblock_sizze_46375\n}\nFUTHARK_KERNEL_SIZED(add_next_partition_doublezisegmap_46408_dim1, 1, 1)\nvoid add_next_partition_doublezisegmap_46408(__global int *global_failure, int failure_is_an_option, __global int64_t *global_failure_args, int64_t n_new_28422, double clBase_28427, __global unsigned char *clBase_mem_53509, __global unsigned char *clBase_mem_53510, __global unsigned char *clBase_mem_53511, __global unsigned char *new_xs_mem_53533, __global unsigned char *new_ys_mem_53534, __global unsigned char *mem_53582, __global unsigned char *mem_53597, __global unsigned char *mem_53599, __global unsigned char *mem_53600)\n{\n    #define segmap_tblock_sizze_46403 (add_next_partition_doublezisegmap_46408zisegmap_tblock_sizze_46403)\n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_55089;\n    int32_t tblock_sizze_55092;\n    int32_t wave_sizze_55091;\n    int32_t block_id_55090;\n    int32_t global_tid_55088;\n    int64_t phys_tid_46408;\n    int64_t global_tid_55093;\n    int64_t slice_55094;\n    int64_t gtid_46407;\n    int", "64_t remnant_55095;\n    \n    local_tid_55089 = get_local_id(0);\n    tblock_sizze_55092 = get_local_size(0);\n    wave_sizze_55091 = LOCKSTEP_WIDTH;\n    block_id_55090 = get_tblock_id(0);\n    global_tid_55088 = block_id_55090 * tblock_sizze_55092 + local_tid_55089;\n    phys_tid_46408 = sext_i32_i64(global_tid_55088);\n    global_tid_55093 = sext_i32_i64(block_id_55090) * segmap_tblock_sizze_46403 + sext_i32_i64(local_tid_55089);\n    slice_55094 = (int64_t) 8;\n    gtid_46407 = global_tid_55093;\n    remnant_55095 = global_tid_55093 - gtid_46407;\n    if (slt64(gtid_46407, (int64_t) 8)) {\n        bool defunc_0_reduce_res_46410;\n        int64_t lifted_lambda_res_46411;\n        bool cond_46412;\n        int64_t lifted_lambda_res_46413;\n        bool lifted_lambda_res_46414;\n        int64_t defunc_0_f_res_46450;\n        \n        defunc_0_reduce_res_46410 = ((__global bool *) mem_53597)[gtid_46407];\n        if (defunc_0_reduce_res_46410) {\n            lifted_lambda_res_46411 = (int64_t) -1;\n        } else {\n            int64_t eta_p_46409 = ((__global int64_t *) mem_53582)[gtid_46407];\n            \n            lifted_lambda_res_46411 = eta_p_46409;\n        }\n        cond_46412 = slt64(lifted_lambda_res_46411, (int64_t) 0);\n        if (cond_46412) {\n            lifted_lambda_res_46413 = (int64_t) -1;\n        } else {\n            lifted_lambda_res_46413 = lifted_lambda_res_46411;\n        }\n        if (cond_46412) {\n            lifted_lambda_res_46414 = 0;\n        } else {\n            int64_t zv_rhs_46415;\n            bool zzero_46416;\n            bool nonzzero_46417;\n            bool nonzzero_cert_46418;\n            int64_t nxid_46419;\n            int64_t nyid_46420;\n            double times_arg1_46421;\n            double i64_res_46422;\n            double zt_res_46423;\n            double plus_arg0_46424;\n            double zp_res_46425;\n            double times_arg1_46426;\n            double i64_res_46427;\n            double zt_res_46428;\n            double plus_arg0_46429;\n      ", "      double zp_res_46430;\n            double zp_res_46431;\n            double zp_res_46432;\n            double zm_res_46433;\n            double zp_res_46434;\n            double zm_res_46435;\n            double zp_res_46436;\n            bool defunc_0_reduce_res_46437;\n            bool redout_53118;\n            \n            zv_rhs_46415 = ((__global int64_t *) clBase_mem_53510)[(int64_t) 0];\n            zzero_46416 = zv_rhs_46415 == (int64_t) 0;\n            nonzzero_46417 = !zzero_46416;\n            if (!nonzzero_46417) {\n                {\n                    if (atomic_cmpxchg_i32_global(global_failure, -1, 7) == -1) {\n                        ;\n                    }\n                    return;\n                }\n            }\n            nxid_46419 = smod64(lifted_lambda_res_46411, zv_rhs_46415);\n            nyid_46420 = sdiv64(lifted_lambda_res_46411, zv_rhs_46415);\n            times_arg1_46421 = ((__global double *) clBase_mem_53511)[(int64_t) 0];\n            i64_res_46422 = sitofp_i64_f64(nxid_46419);\n            zt_res_46423 = times_arg1_46421 * i64_res_46422;\n            plus_arg0_46424 = ((__global double *) clBase_mem_53509)[(int64_t) 0];\n            zp_res_46425 = zt_res_46423 + plus_arg0_46424;\n            times_arg1_46426 = ((__global double *) clBase_mem_53511)[(int64_t) 1];\n            i64_res_46427 = sitofp_i64_f64(nyid_46420);\n            zt_res_46428 = times_arg1_46426 * i64_res_46427;\n            plus_arg0_46429 = ((__global double *) clBase_mem_53509)[(int64_t) 1];\n            zp_res_46430 = zt_res_46428 + plus_arg0_46429;\n            zp_res_46431 = times_arg1_46421 + zp_res_46425;\n            zp_res_46432 = times_arg1_46426 + zp_res_46430;\n            zm_res_46433 = zp_res_46425 - clBase_28427;\n            zp_res_46434 = clBase_28427 + zp_res_46431;\n            zm_res_46435 = zp_res_46430 - clBase_28427;\n            zp_res_46436 = clBase_28427 + zp_res_46432;\n            redout_53118 = 0;\n            for (int64_t i_53119 = 0; i_53119 < n_new_28422; ",
                                    "i_53119++) {\n                double eta_p_46438;\n                double eta_p_46439;\n                bool zgze_res_46440;\n                bool zlze_res_46441;\n                bool x_46442;\n                bool zgze_res_46443;\n                bool zlze_res_46444;\n                bool x_46445;\n                bool x_46446;\n                bool defunc_0_op_res_46449;\n                bool redout_tmp_55096;\n                \n                eta_p_46438 = ((__global double *) new_xs_mem_53533)[i_53119];\n                eta_p_46439 = ((__global double *) new_ys_mem_53534)[i_53119];\n                zgze_res_46440 = zm_res_46433 <= eta_p_46438;\n                zlze_res_46441 = eta_p_46438 <= zp_res_46434;\n                x_46442 = zgze_res_46440 && zlze_res_46441;\n                zgze_res_46443 = zm_res_46435 <= eta_p_46439;\n                zlze_res_46444 = eta_p_46439 <= zp_res_46436;\n                x_46445 = zgze_res_46443 && zlze_res_46444;\n                x_46446 = x_46442 && x_46445;\n                defunc_0_op_res_46449 = x_46446 || redout_53118;\n                redout_tmp_55096 = defunc_0_op_res_46449;\n                redout_53118 = redout_tmp_55096;\n            }\n            defunc_0_reduce_res_46437 = redout_53118;\n            lifted_lambda_res_46414 = defunc_0_reduce_res_46437;\n        }\n        defunc_0_f_res_46450 = btoi_bool_i64(lifted_lambda_res_46414);\n        ((__global int64_t *) mem_53599)[gtid_46407] = defunc_0_f_res_46450;\n        ((__global int64_t *) mem_53600)[gtid_46407] = lifted_lambda_res_46413;\n    }\n    \n  error_0:\n    return;\n    #undef segmap_tblock_sizze_46403\n}\nFUTHARK_KERNEL_SIZED(add_next_partition_doublezisegmap_46471_dim1, 1, 1)\nvoid add_next_partition_doublezisegmap_46471(__global int *global_failure, int64_t m_f_res_41148, int64_t num_tblocks_46476, int32_t virt_num_tblocks_55201, __global unsigned char *ext_mem_53655, __global unsigned char *ext_mem_53656, __global unsigned char *ext_mem_53657, __global unsigned char *mem_53659)\n{\n    #", "define segmap_tblock_sizze_46474 (add_next_partition_doublezisegmap_46471zisegmap_tblock_sizze_46474)\n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_55203;\n    int32_t tblock_sizze_55206;\n    int32_t wave_sizze_55205;\n    int32_t block_id_55204;\n    int32_t global_tid_55202;\n    int64_t phys_tid_46471;\n    int32_t phys_tblock_id_55207;\n    int32_t iterations_55208;\n    \n    local_tid_55203 = get_local_id(0);\n    tblock_sizze_55206 = get_local_size(0);\n    wave_sizze_55205 = LOCKSTEP_WIDTH;\n    block_id_55204 = get_tblock_id(0);\n    global_tid_55202 = block_id_55204 * tblock_sizze_55206 + local_tid_55203;\n    phys_tid_46471 = sext_i32_i64(global_tid_55202);\n    phys_tblock_id_55207 = get_tblock_id(0);\n    iterations_55208 = sdiv_up32(virt_num_tblocks_55201 - phys_tblock_id_55207, sext_i64_i32(num_tblocks_46476));\n    for (int32_t i_55209 = 0; i_55209 < iterations_55208; i_55209++) {\n        int32_t virt_tblock_id_55210;\n        int64_t global_tid_55211;\n        int64_t slice_55212;\n        int64_t write_i_46470;\n        int64_t remnant_55213;\n        \n        virt_tblock_id_55210 = phys_tblock_id_55207 + i_55209 * sext_i64_i32(num_tblocks_46476);\n        global_tid_55211 = sext_i32_i64(virt_tblock_id_55210) * segmap_tblock_sizze_46474 + sext_i32_i64(local_tid_55203);\n        slice_55212 = (int64_t) 8;\n        write_i_46470 = global_tid_55211;\n        remnant_55213 = global_tid_55211 - write_i_46470;\n        if (slt64(write_i_46470, (int64_t) 8)) {\n            int64_t eta_p_44828;\n            int64_t write_value_44830;\n            bool cond_44831;\n            int64_t lifted_lambda_res_44832;\n            \n            eta_p_44828 = ((__global int64_t *) ext_mem_53656)[write_i_46470];\n            write_value_44830 = ((__global int64_t *) ext_mem_53655)[write_i_46470];\n            cond_44831 = eta_p_44828 == (int64_t) 1;\n            if (cond_44831) {\n                int64_t eta_p_44829;\n                int64_t lifted_lambda_res_t_res_45215;\n     ", "           \n                eta_p_44829 = ((__global int64_t *) ext_mem_53657)[write_i_46470];\n                lifted_lambda_res_t_res_45215 = sub64(eta_p_44829, (int64_t) 1);\n                lifted_lambda_res_44832 = lifted_lambda_res_t_res_45215;\n            } else {\n                lifted_lambda_res_44832 = (int64_t) -1;\n            }\n            if (sle64((int64_t) 0, lifted_lambda_res_44832) && slt64(lifted_lambda_res_44832, m_f_res_41148)) {\n                ((__global int64_t *) mem_53659)[lifted_lambda_res_44832] = write_value_44830;\n            }\n        }\n        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    }\n    \n  error_1:\n    return;\n    #undef segmap_tblock_sizze_46474\n}\nFUTHARK_KERNEL_SIZED(add_next_partition_doublezisegmap_46487_dim1, 1, 1)\nvoid add_next_partition_doublezisegmap_46487(__global int *global_failure, int64_t dz2083U_28419, int64_t conc_tmp_41169, int64_t m_41195, int64_t num_tblocks_46492, int32_t virt_num_tblocks_55516, __global unsigned char *clProc_mem_53517, __global unsigned char *mem_53659, __global unsigned char *mem_53665, __global unsigned char *mem_53667, __global unsigned char *mem_53669)\n{\n    #define segmap_tblock_sizze_46490 (add_next_partition_doublezisegmap_46487zisegmap_tblock_sizze_46490)\n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_55518;\n    int32_t tblock_sizze_55521;\n    int32_t wave_sizze_55520;\n    int32_t block_id_55519;\n    int32_t global_tid_55517;\n    int64_t phys_tid_46487;\n    int32_t phys_tblock_id_55522;\n    int32_t iterations_55523;\n    \n    local_tid_55518 = get_local_id(0);\n    tblock_sizze_55521 = get_local_size(0);\n    wave_sizze_55520 = LOCKSTEP_WIDTH;\n    block_id_55519 = get_tblock_id(0);\n    global_tid_55517 = block_id_55519 * tblock_sizze_55521 + local_tid_55518;\n    phys_tid_46487 = sext_i32_i64(global_tid_55517);\n    phys_tblock_id_55522 = get_tblock_id(0);\n    iterations_55523 = sdiv_up32(virt_num_tblocks_55516 - phys_tblock_id_55522, sext_i64_i32(num_tb",
                                    "locks_46492));\n    for (int32_t i_55524 = 0; i_55524 < iterations_55523; i_55524++) {\n        int32_t virt_tblock_id_55525;\n        int64_t global_tid_55526;\n        int64_t slice_55527;\n        int64_t write_i_46486;\n        int64_t remnant_55528;\n        \n        virt_tblock_id_55525 = phys_tblock_id_55522 + i_55524 * sext_i64_i32(num_tblocks_46492);\n        global_tid_55526 = sext_i32_i64(virt_tblock_id_55525) * segmap_tblock_sizze_46490 + sext_i32_i64(local_tid_55518);\n        slice_55527 = conc_tmp_41169;\n        write_i_46486 = global_tid_55526;\n        remnant_55528 = global_tid_55526 - write_i_46486;\n        if (slt64(write_i_46486, conc_tmp_41169)) {\n            int64_t eta_p_44810;\n            bool index_concat_cmp_49681;\n            int64_t index_concat_branch_49685;\n            bool cond_44813;\n            int64_t lifted_lambda_res_44814;\n            \n            eta_p_44810 = ((__global int64_t *) mem_53667)[write_i_46486];\n            index_concat_cmp_49681 = sle64(dz2083U_28419, write_i_46486);\n            if (index_concat_cmp_49681) {\n                int64_t index_concat_i_49682;\n                int64_t index_concat_49683;\n                \n                index_concat_i_49682 = sub64(write_i_46486, dz2083U_28419);\n                index_concat_49683 = ((__global int64_t *) mem_53659)[index_concat_i_49682];\n                index_concat_branch_49685 = index_concat_49683;\n            } else {\n                int64_t index_concat_49684 = ((__global int64_t *) clProc_mem_53517)[write_i_46486];\n                \n                index_concat_branch_49685 = index_concat_49684;\n            }\n            cond_44813 = eta_p_44810 == (int64_t) 1;\n            if (cond_44813) {\n                int64_t eta_p_44811;\n                int64_t lifted_lambda_res_t_res_45217;\n                \n                eta_p_44811 = ((__global int64_t *) mem_53665)[write_i_46486];\n                lifted_lambda_res_t_res_45217 = sub64(eta_p_44811, (int64_t) 1);\n                lifted_l", "ambda_res_44814 = lifted_lambda_res_t_res_45217;\n            } else {\n                lifted_lambda_res_44814 = (int64_t) -1;\n            }\n            if (sle64((int64_t) 0, lifted_lambda_res_44814) && slt64(lifted_lambda_res_44814, m_41195)) {\n                ((__global int64_t *) mem_53669)[lifted_lambda_res_44814] = index_concat_branch_49685;\n            }\n        }\n        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    }\n    \n  error_1:\n    return;\n    #undef segmap_tblock_sizze_46490\n}\nFUTHARK_KERNEL_SIZED(add_next_partition_doublezisegmap_46736_dim1, 1, 1)\nvoid add_next_partition_doublezisegmap_46736(__global int *global_failure, int failure_is_an_option, __global int64_t *global_failure_args, int64_t n_new_28422, double clBase_28427, __global unsigned char *clBase_mem_53509, __global unsigned char *clBase_mem_53510, __global unsigned char *clBase_mem_53511, __global unsigned char *new_xs_mem_53533, __global unsigned char *new_ys_mem_53534, __global unsigned char *mem_53582, __global unsigned char *ext_mem_53699, __global unsigned char *mem_53701)\n{\n    #define segmap_tblock_sizze_46732 (add_next_partition_doublezisegmap_46736zisegmap_tblock_sizze_46732)\n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_55621;\n    int32_t tblock_sizze_55624;\n    int32_t wave_sizze_55623;\n    int32_t block_id_55622;\n    int32_t global_tid_55620;\n    int64_t phys_tid_46736;\n    int64_t global_tid_55625;\n    int64_t slice_55626;\n    int64_t gtid_46735;\n    int64_t remnant_55627;\n    \n    local_tid_55621 = get_local_id(0);\n    tblock_sizze_55624 = get_local_size(0);\n    wave_sizze_55623 = LOCKSTEP_WIDTH;\n    block_id_55622 = get_tblock_id(0);\n    global_tid_55620 = block_id_55622 * tblock_sizze_55624 + local_tid_55621;\n    phys_tid_46736 = sext_i32_i64(global_tid_55620);\n    global_tid_55625 = sext_i32_i64(block_id_55622) * segmap_tblock_sizze_46732 + sext_i32_i64(local_tid_55621);\n    slice_55626 = n_new_28422;\n    gtid_46735 = global_tid_55625;\n", "    remnant_55627 = global_tid_55625 - gtid_46735;\n    if (slt64(gtid_46735, n_new_28422)) {\n        bool eta_p_46737;\n        bool lifted_lambda_res_46740;\n        \n        eta_p_46737 = ((__global bool *) ext_mem_53699)[gtid_46735];\n        if (eta_p_46737) {\n            double eta_p_46738;\n            double eta_p_46739;\n            bool defunc_0_reduce_res_46741;\n            bool redout_53124;\n            \n            eta_p_46738 = ((__global double *) new_xs_mem_53533)[gtid_46735];\n            eta_p_46739 = ((__global double *) new_ys_mem_53534)[gtid_46735];\n            redout_53124 = 0;\n            for (int64_t i_53125 = 0; i_53125 < (int64_t) 8; i_53125++) {\n                int64_t eta_p_46742;\n                bool cond_46743;\n                bool lifted_lambda_res_46744;\n                bool defunc_0_op_res_46776;\n                bool redout_tmp_55628;\n                \n                eta_p_46742 = ((__global int64_t *) mem_53582)[i_53125];\n                cond_46743 = slt64(eta_p_46742, (int64_t) 0);\n                if (cond_46743) {\n                    lifted_lambda_res_46744 = 0;\n                } else {\n                    int64_t zv_rhs_46745;\n                    bool zzero_46746;\n                    bool nonzzero_46747;\n                    bool nonzzero_cert_46748;\n                    int64_t nxid_46749;\n                    int64_t nyid_46750;\n                    double times_arg1_46751;\n                    double i64_res_46752;\n                    double zt_res_46753;\n                    double plus_arg0_46754;\n                    double zp_res_46755;\n                    double times_arg1_46756;\n                    double i64_res_46757;\n                    double zt_res_46758;\n                    double plus_arg0_46759;\n                    double zp_res_46760;\n                    double zp_res_46761;\n                    double zp_res_46762;\n                    double zm_res_46763;\n                    bool zgze_res_46764;\n                    double zp_",
                                    "res_46765;\n                    bool zlze_res_46766;\n                    bool x_46767;\n                    double zm_res_46768;\n                    bool zgze_res_46769;\n                    double zp_res_46770;\n                    bool zlze_res_46771;\n                    bool x_46772;\n                    bool x_46773;\n                    \n                    zv_rhs_46745 = ((__global int64_t *) clBase_mem_53510)[(int64_t) 0];\n                    zzero_46746 = zv_rhs_46745 == (int64_t) 0;\n                    nonzzero_46747 = !zzero_46746;\n                    if (!nonzzero_46747) {\n                        {\n                            if (atomic_cmpxchg_i32_global(global_failure, -1, 14) == -1) {\n                                ;\n                            }\n                            return;\n                        }\n                    }\n                    nxid_46749 = smod64(eta_p_46742, zv_rhs_46745);\n                    nyid_46750 = sdiv64(eta_p_46742, zv_rhs_46745);\n                    times_arg1_46751 = ((__global double *) clBase_mem_53511)[(int64_t) 0];\n                    i64_res_46752 = sitofp_i64_f64(nxid_46749);\n                    zt_res_46753 = times_arg1_46751 * i64_res_46752;\n                    plus_arg0_46754 = ((__global double *) clBase_mem_53509)[(int64_t) 0];\n                    zp_res_46755 = zt_res_46753 + plus_arg0_46754;\n                    times_arg1_46756 = ((__global double *) clBase_mem_53511)[(int64_t) 1];\n                    i64_res_46757 = sitofp_i64_f64(nyid_46750);\n                    zt_res_46758 = times_arg1_46756 * i64_res_46757;\n                    plus_arg0_46759 = ((__global double *) clBase_mem_53509)[(int64_t) 1];\n                    zp_res_46760 = zt_res_46758 + plus_arg0_46759;\n                    zp_res_46761 = times_arg1_46751 + zp_res_46755;\n                    zp_res_46762 = times_arg1_46756 + zp_res_46760;\n                    zm_res_46763 = zp_res_46755 - clBase_28427;\n                    zgze_res_46764 = zm_res_4676", "3 <= eta_p_46738;\n                    zp_res_46765 = clBase_28427 + zp_res_46761;\n                    zlze_res_46766 = eta_p_46738 <= zp_res_46765;\n                    x_46767 = zgze_res_46764 && zlze_res_46766;\n                    zm_res_46768 = zp_res_46760 - clBase_28427;\n                    zgze_res_46769 = zm_res_46768 <= eta_p_46739;\n                    zp_res_46770 = clBase_28427 + zp_res_46762;\n                    zlze_res_46771 = eta_p_46739 <= zp_res_46770;\n                    x_46772 = zgze_res_46769 && zlze_res_46771;\n                    x_46773 = x_46767 && x_46772;\n                    lifted_lambda_res_46744 = x_46773;\n                }\n                defunc_0_op_res_46776 = lifted_lambda_res_46744 || redout_53124;\n                redout_tmp_55628 = defunc_0_op_res_46776;\n                redout_53124 = redout_tmp_55628;\n            }\n            defunc_0_reduce_res_46741 = redout_53124;\n            lifted_lambda_res_46740 = defunc_0_reduce_res_46741;\n        } else {\n            lifted_lambda_res_46740 = 0;\n        }\n        ((__global bool *) mem_53701)[gtid_46735] = lifted_lambda_res_46740;\n    }\n    \n  error_0:\n    return;\n    #undef segmap_tblock_sizze_46732\n}\nFUTHARK_KERNEL_SIZED(add_next_partition_doublezisegmap_46786_dim1, 1, 1)\nvoid add_next_partition_doublezisegmap_46786(__global int *global_failure, int64_t n_old_28413, int64_t y_41336, int64_t num_tblocks_46791, int32_t virt_num_tblocks_54782, __global unsigned char *current_partition_mem_53518, __global unsigned char *current_partition_mem_53519, __global unsigned char *current_partition_mem_53520, __global unsigned char *current_partition_mem_53523, __global unsigned char *mem_53542, __global unsigned char *mem_53544, __global unsigned char *mem_53546, __global unsigned char *mem_53548, __global unsigned char *mem_53550, __global unsigned char *mem_53551, __global unsigned char *mem_53553)\n{\n    #define segmap_tblock_sizze_46789 (add_next_partition_doublezisegmap_46786zisegmap_tblock_sizz", "e_46789)\n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_54784;\n    int32_t tblock_sizze_54787;\n    int32_t wave_sizze_54786;\n    int32_t block_id_54785;\n    int32_t global_tid_54783;\n    int64_t phys_tid_46786;\n    int32_t phys_tblock_id_54788;\n    int32_t iterations_54789;\n    \n    local_tid_54784 = get_local_id(0);\n    tblock_sizze_54787 = get_local_size(0);\n    wave_sizze_54786 = LOCKSTEP_WIDTH;\n    block_id_54785 = get_tblock_id(0);\n    global_tid_54783 = block_id_54785 * tblock_sizze_54787 + local_tid_54784;\n    phys_tid_46786 = sext_i32_i64(global_tid_54783);\n    phys_tblock_id_54788 = get_tblock_id(0);\n    iterations_54789 = sdiv_up32(virt_num_tblocks_54782 - phys_tblock_id_54788, sext_i64_i32(num_tblocks_46791));\n    for (int32_t i_54790 = 0; i_54790 < iterations_54789; i_54790++) {\n        int32_t virt_tblock_id_54791;\n        int64_t global_tid_54792;\n        int64_t slice_54793;\n        int64_t write_i_46785;\n        int64_t remnant_54794;\n        \n        virt_tblock_id_54791 = phys_tblock_id_54788 + i_54790 * sext_i64_i32(num_tblocks_46791);\n        global_tid_54792 = sext_i32_i64(virt_tblock_id_54791) * segmap_tblock_sizze_46789 + sext_i32_i64(local_tid_54784);\n        slice_54793 = n_old_28413;\n        write_i_46785 = global_tid_54792;\n        remnant_54794 = global_tid_54792 - write_i_46785;\n        if (slt64(write_i_46785, n_old_28413)) {\n            int64_t c_41341;\n            int64_t offset_41342;\n            int64_t offset_41343;\n            double v_41344;\n            double v_41345;\n            bool v_41346;\n            int64_t v_41347;\n            bool is_this_one_41348;\n            bool is_this_one_41349;\n            int64_t this_offset_41350;\n            int64_t total_res_41351;\n            int64_t this_offset_41352;\n            int64_t total_res_41353;\n            \n            c_41341 = ((__global int64_t *) mem_53546)[write_i_46785];\n            offset_41342 = ((__global int64_t *) mem_53542)[write_i_46785];\n    ",
                                    "        offset_41343 = ((__global int64_t *) mem_53544)[write_i_46785];\n            v_41344 = ((__global double *) current_partition_mem_53519)[write_i_46785];\n            v_41345 = ((__global double *) current_partition_mem_53520)[write_i_46785];\n            v_41346 = ((__global bool *) current_partition_mem_53523)[write_i_46785];\n            v_41347 = ((__global int64_t *) current_partition_mem_53518)[write_i_46785];\n            is_this_one_41348 = c_41341 == (int64_t) 0;\n            is_this_one_41349 = c_41341 == (int64_t) 1;\n            this_offset_41350 = y_41336 + offset_41343;\n            if (is_this_one_41349) {\n                total_res_41351 = this_offset_41350;\n            } else {\n                total_res_41351 = (int64_t) -1;\n            }\n            this_offset_41352 = (int64_t) -1 + offset_41342;\n            if (is_this_one_41348) {\n                total_res_41353 = this_offset_41352;\n            } else {\n                total_res_41353 = total_res_41351;\n            }\n            if (sle64((int64_t) 0, total_res_41353) && slt64(total_res_41353, n_old_28413)) {\n                ((__global double *) mem_53548)[total_res_41353] = v_41344;\n            }\n            if (sle64((int64_t) 0, total_res_41353) && slt64(total_res_41353, n_old_28413)) {\n                ((__global double *) mem_53550)[total_res_41353] = v_41345;\n            }\n            if (sle64((int64_t) 0, total_res_41353) && slt64(total_res_41353, n_old_28413)) {\n                ((__global bool *) mem_53551)[total_res_41353] = v_41346;\n            }\n            if (sle64((int64_t) 0, total_res_41353) && slt64(total_res_41353, n_old_28413)) {\n                ((__global int64_t *) mem_53553)[total_res_41353] = v_41347;\n            }\n        }\n        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    }\n    \n  error_1:\n    return;\n    #undef segmap_tblock_sizze_46789\n}\nFUTHARK_KERNEL_SIZED(add_next_partition_doublezisegmap_46802_dim1, 1, 1)\nvoid add_next_partition_doublezisegmap_46802(__", "global int *global_failure, int64_t dzlz7bUZLzpZRz20Udz2082Uz20Udz2084Uz2088Uz2083Uz7dUzg_41379, int64_t y_41488, int64_t num_tblocks_46807, int32_t virt_num_tblocks_55629, __global unsigned char *mem_53574, __global unsigned char *mem_53704, __global unsigned char *mem_53706, __global unsigned char *mem_53708)\n{\n    #define segmap_tblock_sizze_46805 (add_next_partition_doublezisegmap_46802zisegmap_tblock_sizze_46805)\n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_55631;\n    int32_t tblock_sizze_55634;\n    int32_t wave_sizze_55633;\n    int32_t block_id_55632;\n    int32_t global_tid_55630;\n    int64_t phys_tid_46802;\n    int32_t phys_tblock_id_55635;\n    int32_t iterations_55636;\n    \n    local_tid_55631 = get_local_id(0);\n    tblock_sizze_55634 = get_local_size(0);\n    wave_sizze_55633 = LOCKSTEP_WIDTH;\n    block_id_55632 = get_tblock_id(0);\n    global_tid_55630 = block_id_55632 * tblock_sizze_55634 + local_tid_55631;\n    phys_tid_46802 = sext_i32_i64(global_tid_55630);\n    phys_tblock_id_55635 = get_tblock_id(0);\n    iterations_55636 = sdiv_up32(virt_num_tblocks_55629 - phys_tblock_id_55635, sext_i64_i32(num_tblocks_46807));\n    for (int32_t i_55637 = 0; i_55637 < iterations_55636; i_55637++) {\n        int32_t virt_tblock_id_55638;\n        int64_t global_tid_55639;\n        int64_t slice_55640;\n        int64_t write_i_46801;\n        int64_t remnant_55641;\n        \n        virt_tblock_id_55638 = phys_tblock_id_55635 + i_55637 * sext_i64_i32(num_tblocks_46807);\n        global_tid_55639 = sext_i32_i64(virt_tblock_id_55638) * segmap_tblock_sizze_46805 + sext_i32_i64(local_tid_55631);\n        slice_55640 = dzlz7bUZLzpZRz20Udz2082Uz20Udz2084Uz2088Uz2083Uz7dUzg_41379;\n        write_i_46801 = global_tid_55639;\n        remnant_55641 = global_tid_55639 - write_i_46801;\n        if (slt64(write_i_46801, dzlz7bUZLzpZRz20Udz2082Uz20Udz2084Uz2088Uz2083Uz7dUzg_41379)) {\n            int64_t c_41490;\n            int64_t offset_41491;\n            int64_t offs", "et_41492;\n            bool is_this_one_41494;\n            bool is_this_one_41495;\n            int64_t this_offset_41496;\n            int64_t total_res_41497;\n            int64_t this_offset_41498;\n            int64_t total_res_41499;\n            \n            c_41490 = ((__global int64_t *) mem_53708)[write_i_46801];\n            offset_41491 = ((__global int64_t *) mem_53704)[write_i_46801];\n            offset_41492 = ((__global int64_t *) mem_53706)[write_i_46801];\n            is_this_one_41494 = c_41490 == (int64_t) 0;\n            is_this_one_41495 = c_41490 == (int64_t) 1;\n            this_offset_41496 = y_41488 + offset_41492;\n            if (is_this_one_41495) {\n                total_res_41497 = this_offset_41496;\n            } else {\n                total_res_41497 = (int64_t) -1;\n            }\n            this_offset_41498 = (int64_t) -1 + offset_41491;\n            if (is_this_one_41494) {\n                total_res_41499 = this_offset_41498;\n            } else {\n                total_res_41499 = total_res_41497;\n            }\n            if (sle64((int64_t) 0, total_res_41499) && slt64(total_res_41499, dzlz7bUZLzpZRz20Udz2082Uz20Udz2084Uz2088Uz2083Uz7dUzg_41379)) {\n                ((__global int64_t *) mem_53574)[total_res_41499] = write_i_46801;\n            }\n        }\n        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    }\n    \n  error_1:\n    return;\n    #undef segmap_tblock_sizze_46805\n}\nFUTHARK_KERNEL_SIZED(add_next_partition_doublezisegmap_46855_dim1, 1, 1)\nvoid add_next_partition_doublezisegmap_46855(__global int *global_failure, int failure_is_an_option, __global int64_t *global_failure_args, int64_t dz2080U_28416, int64_t dz2081U_28417, int64_t dz2082U_28418, int64_t dzlz7bUZLzpZRz20Udz2082Uz20Udz2084Uz2088Uz2083Uz7dUzg_41379, int64_t conc_tmp_41380, int64_t conc_tmp_41381, int64_t partition_sizze_41486, __global unsigned char *clProc_mem_53512, __global unsigned char *clProc_mem_53513, __global unsigned char *clProc_mem_53514, __global unsi",
                                    "gned char *clProc_mem_53515, __global unsigned char *mem_53548, __global unsigned char *mem_53550, __global unsigned char *mem_53551, __global unsigned char *mem_53553, __global unsigned char *mem_53574, __global unsigned char *mem_53712, __global unsigned char *mem_53714, __global unsigned char *mem_53715, __global unsigned char *mem_53717)\n{\n    #define segmap_tblock_sizze_46848 (add_next_partition_doublezisegmap_46855zisegmap_tblock_sizze_46848)\n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_55644;\n    int32_t tblock_sizze_55647;\n    int32_t wave_sizze_55646;\n    int32_t block_id_55645;\n    int32_t global_tid_55643;\n    int64_t phys_tid_46855;\n    int64_t global_tid_55648;\n    int64_t slice_55649;\n    int64_t gtid_46854;\n    int64_t remnant_55650;\n    \n    local_tid_55644 = get_local_id(0);\n    tblock_sizze_55647 = get_local_size(0);\n    wave_sizze_55646 = LOCKSTEP_WIDTH;\n    block_id_55645 = get_tblock_id(0);\n    global_tid_55643 = block_id_55645 * tblock_sizze_55647 + local_tid_55644;\n    phys_tid_46855 = sext_i32_i64(global_tid_55643);\n    global_tid_55648 = sext_i32_i64(block_id_55645) * segmap_tblock_sizze_46848 + sext_i32_i64(local_tid_55644);\n    slice_55649 = partition_sizze_41486;\n    gtid_46854 = global_tid_55648;\n    remnant_55650 = global_tid_55648 - gtid_46854;\n    if (slt64(gtid_46854, partition_sizze_41486)) {\n        int64_t eta_p_46856;\n        bool x_46857;\n        bool y_46858;\n        bool bounds_check_46859;\n        bool index_certs_46860;\n        bool y_46870;\n        bool bounds_check_46871;\n        bool index_certs_46872;\n        bool y_46878;\n        bool bounds_check_46879;\n        bool index_certs_46880;\n        bool index_concat_cmp_46861;\n        double index_concat_branch_46862;\n        double index_concat_branch_46866;\n        bool index_concat_cmp_46873;\n        bool index_concat_branch_46874;\n        bool index_concat_cmp_46881;\n        int64_t index_concat_branch_46882;\n        \n        eta_p_46856 = ((_", "_global int64_t *) mem_53574)[gtid_46854];\n        x_46857 = sle64((int64_t) 0, eta_p_46856);\n        y_46858 = slt64(eta_p_46856, dzlz7bUZLzpZRz20Udz2082Uz20Udz2084Uz2088Uz2083Uz7dUzg_41379);\n        bounds_check_46859 = x_46857 && y_46858;\n        if (!bounds_check_46859) {\n            {\n                if (atomic_cmpxchg_i32_global(global_failure, -1, 15) == -1) {\n                    global_failure_args[0] = (int64_t) eta_p_46856;\n                    global_failure_args[1] = (int64_t) dzlz7bUZLzpZRz20Udz2082Uz20Udz2084Uz2088Uz2083Uz7dUzg_41379;\n                    ;\n                }\n                return;\n            }\n        }\n        y_46870 = slt64(eta_p_46856, conc_tmp_41380);\n        bounds_check_46871 = x_46857 && y_46870;\n        if (!bounds_check_46871) {\n            {\n                if (atomic_cmpxchg_i32_global(global_failure, -1, 16) == -1) {\n                    global_failure_args[0] = (int64_t) eta_p_46856;\n                    global_failure_args[1] = (int64_t) conc_tmp_41380;\n                    ;\n                }\n                return;\n            }\n        }\n        y_46878 = slt64(eta_p_46856, conc_tmp_41381);\n        bounds_check_46879 = x_46857 && y_46878;\n        if (!bounds_check_46879) {\n            {\n                if (atomic_cmpxchg_i32_global(global_failure, -1, 17) == -1) {\n                    global_failure_args[0] = (int64_t) eta_p_46856;\n                    global_failure_args[1] = (int64_t) conc_tmp_41381;\n                    ;\n                }\n                return;\n            }\n        }\n        index_concat_cmp_46861 = sle64(dz2082U_28418, eta_p_46856);\n        if (index_concat_cmp_46861) {\n            int64_t index_concat_i_46863;\n            double index_concat_46864;\n            \n            index_concat_i_46863 = sub64(eta_p_46856, dz2082U_28418);\n            index_concat_46864 = ((__global double *) mem_53548)[index_concat_i_46863];\n            index_concat_branch_46862 = index_concat_46864;\n        } else {\n       ", "     double index_concat_46865 = ((__global double *) clProc_mem_53514)[eta_p_46856];\n            \n            index_concat_branch_46862 = index_concat_46865;\n        }\n        if (index_concat_cmp_46861) {\n            int64_t index_concat_i_46867;\n            double index_concat_46868;\n            \n            index_concat_i_46867 = sub64(eta_p_46856, dz2082U_28418);\n            index_concat_46868 = ((__global double *) mem_53550)[index_concat_i_46867];\n            index_concat_branch_46866 = index_concat_46868;\n        } else {\n            double index_concat_46869 = ((__global double *) clProc_mem_53515)[eta_p_46856];\n            \n            index_concat_branch_46866 = index_concat_46869;\n        }\n        index_concat_cmp_46873 = sle64(dz2080U_28416, eta_p_46856);\n        if (index_concat_cmp_46873) {\n            int64_t index_concat_i_46875;\n            bool index_concat_46876;\n            \n            index_concat_i_46875 = sub64(eta_p_46856, dz2080U_28416);\n            index_concat_46876 = ((__global bool *) mem_53551)[index_concat_i_46875];\n            index_concat_branch_46874 = index_concat_46876;\n        } else {\n            bool index_concat_46877 = ((__global bool *) clProc_mem_53512)[eta_p_46856];\n            \n            index_concat_branch_46874 = index_concat_46877;\n        }\n        index_concat_cmp_46881 = sle64(dz2081U_28417, eta_p_46856);\n        if (index_concat_cmp_46881) {\n            int64_t index_concat_i_46883;\n            int64_t index_concat_46884;\n            \n            index_concat_i_46883 = sub64(eta_p_46856, dz2081U_28417);\n            index_concat_46884 = ((__global int64_t *) mem_53553)[index_concat_i_46883];\n            index_concat_branch_46882 = index_concat_46884;\n        } else {\n            int64_t index_concat_46885 = ((__global int64_t *) clProc_mem_53513)[eta_p_46856];\n            \n            index_concat_branch_46882 = index_concat_46885;\n        }\n        ((__global double *) mem_53712)[gtid_46854] = index_concat_bra",
                                    "nch_46862;\n        ((__global double *) mem_53714)[gtid_46854] = index_concat_branch_46866;\n        ((__global bool *) mem_53715)[gtid_46854] = index_concat_branch_46874;\n        ((__global int64_t *) mem_53717)[gtid_46854] = index_concat_branch_46882;\n    }\n    \n  error_0:\n    return;\n    #undef segmap_tblock_sizze_46848\n}\nFUTHARK_KERNEL_SIZED(add_next_partition_doublezisegmap_46923_dim1, 1, 1)\nvoid add_next_partition_doublezisegmap_46923(__global int *global_failure, int failure_is_an_option, __global int64_t *global_failure_args, int64_t dz2081U_28417, int64_t dz2082U_28418, int64_t j_m_i_41365, int64_t dzlz7bUZLzpZRz20Udz2082Uz20Udz2084Uz2088Uz2083Uz7dUzg_41379, int64_t conc_tmp_41381, int64_t partition_sizze_41486, int64_t j_m_i_41512, __global unsigned char *clProc_mem_53513, __global unsigned char *clProc_mem_53514, __global unsigned char *clProc_mem_53515, __global unsigned char *mem_53548, __global unsigned char *mem_53550, __global unsigned char *mem_53553, __global unsigned char *mem_53574, __global unsigned char *mem_53726, __global unsigned char *mem_53728, __global unsigned char *mem_53730)\n{\n    #define segmap_tblock_sizze_46917 (add_next_partition_doublezisegmap_46923zisegmap_tblock_sizze_46917)\n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_55653;\n    int32_t tblock_sizze_55656;\n    int32_t wave_sizze_55655;\n    int32_t block_id_55654;\n    int32_t global_tid_55652;\n    int64_t phys_tid_46923;\n    int64_t global_tid_55657;\n    int64_t slice_55658;\n    int64_t gtid_46922;\n    int64_t remnant_55659;\n    \n    local_tid_55653 = get_local_id(0);\n    tblock_sizze_55656 = get_local_size(0);\n    wave_sizze_55655 = LOCKSTEP_WIDTH;\n    block_id_55654 = get_tblock_id(0);\n    global_tid_55652 = block_id_55654 * tblock_sizze_55656 + local_tid_55653;\n    phys_tid_46923 = sext_i32_i64(global_tid_55652);\n    global_tid_55657 = sext_i32_i64(block_id_55654) * segmap_tblock_sizze_46917 + sext_i32_i64(local_tid_55653);\n    slice_55658 = j_m_i_4", "1512;\n    gtid_46922 = global_tid_55657;\n    remnant_55659 = global_tid_55657 - gtid_46922;\n    if (slt64(gtid_46922, j_m_i_41512)) {\n        int64_t slice_49675;\n        int64_t eta_p_46924;\n        bool x_46925;\n        bool y_46926;\n        bool bounds_check_46927;\n        bool index_certs_46928;\n        bool y_46938;\n        bool bounds_check_46939;\n        bool index_certs_46940;\n        bool index_concat_cmp_46929;\n        double index_concat_branch_46930;\n        double index_concat_branch_46934;\n        bool index_concat_cmp_46941;\n        int64_t index_concat_branch_46942;\n        \n        slice_49675 = partition_sizze_41486 + gtid_46922;\n        eta_p_46924 = ((__global int64_t *) mem_53574)[slice_49675];\n        x_46925 = sle64((int64_t) 0, eta_p_46924);\n        y_46926 = slt64(eta_p_46924, dzlz7bUZLzpZRz20Udz2082Uz20Udz2084Uz2088Uz2083Uz7dUzg_41379);\n        bounds_check_46927 = x_46925 && y_46926;\n        if (!bounds_check_46927) {\n            {\n                if (atomic_cmpxchg_i32_global(global_failure, -1, 18) == -1) {\n                    global_failure_args[0] = (int64_t) eta_p_46924;\n                    global_failure_args[1] = (int64_t) dzlz7bUZLzpZRz20Udz2082Uz20Udz2084Uz2088Uz2083Uz7dUzg_41379;\n                    ;\n                }\n                return;\n            }\n        }\n        y_46938 = slt64(eta_p_46924, conc_tmp_41381);\n        bounds_check_46939 = x_46925 && y_46938;\n        if (!bounds_check_46939) {\n            {\n                if (atomic_cmpxchg_i32_global(global_failure, -1, 19) == -1) {\n                    global_failure_args[0] = (int64_t) eta_p_46924;\n                    global_failure_args[1] = (int64_t) conc_tmp_41381;\n                    ;\n                }\n                return;\n            }\n        }\n        index_concat_cmp_46929 = sle64(dz2082U_28418, eta_p_46924);\n        if (index_concat_cmp_46929) {\n            int64_t index_concat_i_46931;\n            double index_concat_46932;\n            \n            index_", "concat_i_46931 = sub64(eta_p_46924, dz2082U_28418);\n            index_concat_46932 = ((__global double *) mem_53548)[index_concat_i_46931];\n            index_concat_branch_46930 = index_concat_46932;\n        } else {\n            double index_concat_46933 = ((__global double *) clProc_mem_53514)[eta_p_46924];\n            \n            index_concat_branch_46930 = index_concat_46933;\n        }\n        if (index_concat_cmp_46929) {\n            int64_t index_concat_i_46935;\n            double index_concat_46936;\n            \n            index_concat_i_46935 = sub64(eta_p_46924, dz2082U_28418);\n            index_concat_46936 = ((__global double *) mem_53550)[index_concat_i_46935];\n            index_concat_branch_46934 = index_concat_46936;\n        } else {\n            double index_concat_46937 = ((__global double *) clProc_mem_53515)[eta_p_46924];\n            \n            index_concat_branch_46934 = index_concat_46937;\n        }\n        index_concat_cmp_46941 = sle64(dz2081U_28417, eta_p_46924);\n        if (index_concat_cmp_46941) {\n            int64_t index_concat_i_46943;\n            int64_t index_concat_46944;\n            \n            index_concat_i_46943 = sub64(eta_p_46924, dz2081U_28417);\n            index_concat_46944 = ((__global int64_t *) mem_53553)[index_concat_i_46943];\n            index_concat_branch_46942 = index_concat_46944;\n        } else {\n            int64_t index_concat_46945 = ((__global int64_t *) clProc_mem_53513)[eta_p_46924];\n            \n            index_concat_branch_46942 = index_concat_46945;\n        }\n        ((__global double *) mem_53726)[j_m_i_41365 + gtid_46922] = index_concat_branch_46930;\n        ((__global double *) mem_53728)[j_m_i_41365 + gtid_46922] = index_concat_branch_46934;\n        ((__global int64_t *) mem_53730)[j_m_i_41365 + gtid_46922] = index_concat_branch_46942;\n    }\n    \n  error_0:\n    return;\n    #undef segmap_tblock_sizze_46917\n}\nFUTHARK_KERNEL\nvoid add_next_partition_doublezisegmap_intrablock_46316(__global int *globa",
                                    "l_failure, int failure_is_an_option, __global int64_t *global_failure_args, int64_t part_no_28414, int64_t dz2083U_28419, int64_t n_new_28422, double clBase_28427, int64_t computed_tblock_sizze_46238, __global unsigned char *clBase_mem_53509, __global unsigned char *clBase_mem_53510, __global unsigned char *clBase_mem_53511, __global unsigned char *clProc_mem_53516, __global unsigned char *clProc_mem_53517, __global unsigned char *new_xs_mem_53533, __global unsigned char *new_ys_mem_53534, __global unsigned char *mem_53582, __global unsigned char *mem_53602, __global unsigned char *mem_53603, __global unsigned char *mem_53604)\n{\n    volatile __local unsigned char *red_arr_mem_55002_backing_1 = &shared_mem[0];\n    const int64_t red_arr_mem_55002_backing_1_offset = 0 + (n_new_28422 + srem64((int64_t) 8 - srem64(n_new_28422, (int64_t) 8), (int64_t) 8));\n    volatile __local unsigned char *red_arr_mem_54998_backing_0 = &shared_mem[red_arr_mem_55002_backing_1_offset];\n    const int64_t red_arr_mem_54998_backing_0_offset = red_arr_mem_55002_backing_1_offset + (dz2083U_28419 + srem64((int64_t) 8 - srem64(dz2083U_28419, (int64_t) 8), (int64_t) 8));\n    volatile __local int local_failure;\n    \n    if (failure_is_an_option) {\n        int failed = *global_failure >= 0;\n        \n        if (failed)\n            return;\n    }\n    local_failure = 0;\n    barrier(CLK_LOCAL_MEM_FENCE);\n    \n    int32_t local_tid_54986;\n    int32_t tblock_sizze_54989;\n    int32_t wave_sizze_54988;\n    int32_t block_id_54987;\n    int32_t global_tid_54985;\n    int64_t phys_tblock_id_46316;\n    int64_t slice_54991;\n    int64_t ltid_pre_54990;\n    int64_t remnant_54992;\n    int64_t slice_54994;\n    int64_t ltid_pre_54993;\n    int64_t remnant_54995;\n    int64_t slice_54996;\n    int64_t gtid_46315;\n    int64_t remnant_54997;\n    int64_t eta_p_46317;\n    bool cond_46318;\n    bool lifted_lambda_res_46319;\n    bool defunc_0_reduce_res_46324;\n    int64_t phys_tid_46326;\n    __local unsigned char *red_arr_mem_54", "998;\n    int64_t gtid_46325;\n    int32_t offset_55000;\n    int32_t skip_waves_55001;\n    bool eta_p_46327;\n    bool eta_p_46328;\n    int64_t lifted_lambda_res_46332;\n    bool cond_46333;\n    int64_t lifted_lambda_res_46334;\n    bool lifted_lambda_res_46335;\n    int64_t defunc_0_f_res_46373;\n    \n    local_tid_54986 = get_local_id(0);\n    tblock_sizze_54989 = get_local_size(0);\n    wave_sizze_54988 = LOCKSTEP_WIDTH;\n    block_id_54987 = get_tblock_id(0);\n    global_tid_54985 = block_id_54987 * tblock_sizze_54989 + local_tid_54986;\n    phys_tblock_id_46316 = sext_i32_i64(block_id_54987);\n    slice_54991 = dz2083U_28419;\n    ltid_pre_54990 = sext_i32_i64(local_tid_54986);\n    remnant_54992 = sext_i32_i64(local_tid_54986) - ltid_pre_54990;\n    slice_54994 = n_new_28422;\n    ltid_pre_54993 = sext_i32_i64(local_tid_54986);\n    remnant_54995 = sext_i32_i64(local_tid_54986) - ltid_pre_54993;\n    slice_54996 = (int64_t) 8;\n    gtid_46315 = sext_i32_i64(block_id_54987);\n    remnant_54997 = sext_i32_i64(block_id_54987) - gtid_46315;\n    eta_p_46317 = ((__global int64_t *) mem_53582)[gtid_46315];\n    cond_46318 = sle64((int64_t) 0, eta_p_46317);\n    barrier(CLK_LOCAL_MEM_FENCE);\n    if (cond_46318) {\n        bool y_46320;\n        bool bounds_check_46321;\n        bool index_certs_46322;\n        bool lifted_lambda_res_t_res_46323;\n        \n        y_46320 = slt64(eta_p_46317, part_no_28414);\n        bounds_check_46321 = cond_46318 && y_46320;\n        if (!bounds_check_46321) {\n            {\n                if (atomic_cmpxchg_i32_global(global_failure, -1, 4) == -1) {\n                    global_failure_args[0] = (int64_t) eta_p_46317;\n                    global_failure_args[1] = (int64_t) part_no_28414;\n                    ;\n                }\n                local_failure = 1;\n                goto error_1;\n            }\n        }\n        lifted_lambda_res_t_res_46323 = ((__global bool *) clProc_mem_53516)[eta_p_46317];\n        lifted_lambda_res_46319 = lifted_lambda_res_t_res_4632", "3;\n    } else {\n        lifted_lambda_res_46319 = 0;\n    }\n    phys_tid_46326 = sext_i32_i64(local_tid_54986);\n    red_arr_mem_54998 = (__local unsigned char *) red_arr_mem_54998_backing_0;\n    gtid_46325 = sext_i32_i64(sext_i64_i32(ltid_pre_54990));\n    if (slt64(gtid_46325, dz2083U_28419)) {\n        int64_t eta_p_46330;\n        bool lifted_lambda_res_46331;\n        \n        eta_p_46330 = ((__global int64_t *) clProc_mem_53517)[gtid_46325];\n        lifted_lambda_res_46331 = eta_p_46330 == eta_p_46317;\n        ((__local bool *) red_arr_mem_54998)[gtid_46325] = lifted_lambda_res_46331;\n    }\n    \n  error_1:\n    barrier(CLK_LOCAL_MEM_FENCE);\n    if (local_failure)\n        return;\n    barrier(CLK_LOCAL_MEM_FENCE);\n    skip_waves_55001 = 1;\n    offset_55000 = 0;\n    // participating threads read initial accumulator\n    {\n        if (slt32(local_tid_54986, sext_i64_i32(dz2083U_28419))) {\n            eta_p_46327 = ((__local bool *) red_arr_mem_54998)[sext_i32_i64(local_tid_54986 + offset_55000)];\n        }\n    }\n    offset_55000 = 1;\n    while (slt32(offset_55000, wave_sizze_54988)) {\n        if (slt32(local_tid_54986 + offset_55000, sext_i64_i32(dz2083U_28419)) && ((local_tid_54986 - squot32(local_tid_54986, wave_sizze_54988) * wave_sizze_54988) & (2 * offset_55000 - 1)) == 0) {\n            // read array element\n            {\n                eta_p_46328 = ((volatile __local bool *) red_arr_mem_54998)[sext_i32_i64(local_tid_54986 + offset_55000)];\n            }\n            // apply reduction operation\n            {\n                bool defunc_0_op_res_46329 = eta_p_46327 || eta_p_46328;\n                \n                eta_p_46327 = defunc_0_op_res_46329;\n            }\n            // write result of operation\n            {\n                ((volatile __local bool *) red_arr_mem_54998)[sext_i32_i64(local_tid_54986)] = eta_p_46327;\n            }\n        }\n        offset_55000 *= 2;\n    }\n    while (slt32(skip_waves_55001, squot32(sext_i64_i32(computed_tblock_sizze_46238) + w",
                                    "ave_sizze_54988 - 1, wave_sizze_54988))) {\n        barrier(CLK_LOCAL_MEM_FENCE);\n        offset_55000 = skip_waves_55001 * wave_sizze_54988;\n        if (slt32(local_tid_54986 + offset_55000, sext_i64_i32(dz2083U_28419)) && ((local_tid_54986 - squot32(local_tid_54986, wave_sizze_54988) * wave_sizze_54988) == 0 && (squot32(local_tid_54986, wave_sizze_54988) & (2 * skip_waves_55001 - 1)) == 0)) {\n            // read array element\n            {\n                eta_p_46328 = ((__local bool *) red_arr_mem_54998)[sext_i32_i64(local_tid_54986 + offset_55000)];\n            }\n            // apply reduction operation\n            {\n                bool defunc_0_op_res_46329 = eta_p_46327 || eta_p_46328;\n                \n                eta_p_46327 = defunc_0_op_res_46329;\n            }\n            // write result of operation\n            {\n                ((__local bool *) red_arr_mem_54998)[sext_i32_i64(local_tid_54986)] = eta_p_46327;\n            }\n        }\n        skip_waves_55001 *= 2;\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // Save result of reduction.\n    {\n        defunc_0_reduce_res_46324 = ((__local bool *) red_arr_mem_54998)[(int64_t) 0];\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    barrier(CLK_LOCAL_MEM_FENCE);\n    if (defunc_0_reduce_res_46324) {\n        lifted_lambda_res_46332 = (int64_t) -1;\n    } else {\n        lifted_lambda_res_46332 = eta_p_46317;\n    }\n    cond_46333 = slt64(lifted_lambda_res_46332, (int64_t) 0);\n    barrier(CLK_LOCAL_MEM_FENCE);\n    if (cond_46333) {\n        lifted_lambda_res_46334 = (int64_t) -1;\n    } else {\n        lifted_lambda_res_46334 = lifted_lambda_res_46332;\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    if (cond_46333) {\n        lifted_lambda_res_46335 = 0;\n    } else {\n        int64_t zv_rhs_46336;\n        bool zzero_46337;\n        bool nonzzero_46338;\n        bool nonzzero_cert_46339;\n        int64_t nxid_46340;\n        int64_t nyid_46341;\n        double times_arg1_46342;\n        double i64_res_", "46343;\n        double zt_res_46344;\n        double plus_arg0_46345;\n        double zp_res_46346;\n        double times_arg1_46347;\n        double i64_res_46348;\n        double zt_res_46349;\n        double plus_arg0_46350;\n        double zp_res_46351;\n        double zp_res_46352;\n        double zp_res_46353;\n        double zm_res_46354;\n        double zp_res_46355;\n        double zm_res_46356;\n        double zp_res_46357;\n        bool defunc_0_reduce_res_46358;\n        int64_t phys_tid_46360;\n        __local unsigned char *red_arr_mem_55002;\n        int64_t gtid_46359;\n        int32_t offset_55004;\n        int32_t skip_waves_55005;\n        bool eta_p_46361;\n        bool eta_p_46362;\n        \n        zv_rhs_46336 = ((__global int64_t *) clBase_mem_53510)[(int64_t) 0];\n        zzero_46337 = zv_rhs_46336 == (int64_t) 0;\n        nonzzero_46338 = !zzero_46337;\n        if (!nonzzero_46338) {\n            {\n                if (atomic_cmpxchg_i32_global(global_failure, -1, 5) == -1) {\n                    ;\n                }\n                local_failure = 1;\n                goto error_8;\n            }\n        }\n        nxid_46340 = smod64(lifted_lambda_res_46332, zv_rhs_46336);\n        nyid_46341 = sdiv64(lifted_lambda_res_46332, zv_rhs_46336);\n        times_arg1_46342 = ((__global double *) clBase_mem_53511)[(int64_t) 0];\n        i64_res_46343 = sitofp_i64_f64(nxid_46340);\n        zt_res_46344 = times_arg1_46342 * i64_res_46343;\n        plus_arg0_46345 = ((__global double *) clBase_mem_53509)[(int64_t) 0];\n        zp_res_46346 = zt_res_46344 + plus_arg0_46345;\n        times_arg1_46347 = ((__global double *) clBase_mem_53511)[(int64_t) 1];\n        i64_res_46348 = sitofp_i64_f64(nyid_46341);\n        zt_res_46349 = times_arg1_46347 * i64_res_46348;\n        plus_arg0_46350 = ((__global double *) clBase_mem_53509)[(int64_t) 1];\n        zp_res_46351 = zt_res_46349 + plus_arg0_46350;\n        zp_res_46352 = times_arg1_46342 + zp_res_46346;\n        zp_res_46353 = times_arg1_46347 + zp", "_res_46351;\n        zm_res_46354 = zp_res_46346 - clBase_28427;\n        zp_res_46355 = clBase_28427 + zp_res_46352;\n        zm_res_46356 = zp_res_46351 - clBase_28427;\n        zp_res_46357 = clBase_28427 + zp_res_46353;\n        phys_tid_46360 = sext_i32_i64(local_tid_54986);\n        red_arr_mem_55002 = (__local unsigned char *) red_arr_mem_55002_backing_1;\n        gtid_46359 = sext_i32_i64(sext_i64_i32(ltid_pre_54993));\n        if (slt64(gtid_46359, n_new_28422)) {\n            double eta_p_46364;\n            double eta_p_46365;\n            bool zgze_res_46366;\n            bool zlze_res_46367;\n            bool x_46368;\n            bool zgze_res_46369;\n            bool zlze_res_46370;\n            bool x_46371;\n            bool x_46372;\n            \n            eta_p_46364 = ((__global double *) new_xs_mem_53533)[gtid_46359];\n            eta_p_46365 = ((__global double *) new_ys_mem_53534)[gtid_46359];\n            zgze_res_46366 = zm_res_46354 <= eta_p_46364;\n            zlze_res_46367 = eta_p_46364 <= zp_res_46355;\n            x_46368 = zgze_res_46366 && zlze_res_46367;\n            zgze_res_46369 = zm_res_46356 <= eta_p_46365;\n            zlze_res_46370 = eta_p_46365 <= zp_res_46357;\n            x_46371 = zgze_res_46369 && zlze_res_46370;\n            x_46372 = x_46368 && x_46371;\n            ((__local bool *) red_arr_mem_55002)[gtid_46359] = x_46372;\n        }\n        \n      error_8:\n        barrier(CLK_LOCAL_MEM_FENCE);\n        if (local_failure)\n            return;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        skip_waves_55005 = 1;\n        offset_55004 = 0;\n        // participating threads read initial accumulator\n        {\n            if (slt32(local_tid_54986, sext_i64_i32(n_new_28422))) {\n                eta_p_46361 = ((__local bool *) red_arr_mem_55002)[sext_i32_i64(local_tid_54986 + offset_55004)];\n            }\n        }\n        offset_55004 = 1;\n        while (slt32(offset_55004, wave_sizze_54988)) {\n            if (slt32(local_tid_54986 + offset_55004, sext_",
                                    "i64_i32(n_new_28422)) && ((local_tid_54986 - squot32(local_tid_54986, wave_sizze_54988) * wave_sizze_54988) & (2 * offset_55004 - 1)) == 0) {\n                // read array element\n                {\n                    eta_p_46362 = ((volatile __local bool *) red_arr_mem_55002)[sext_i32_i64(local_tid_54986 + offset_55004)];\n                }\n                // apply reduction operation\n                {\n                    bool defunc_0_op_res_46363 = eta_p_46361 || eta_p_46362;\n                    \n                    eta_p_46361 = defunc_0_op_res_46363;\n                }\n                // write result of operation\n                {\n                    ((volatile __local bool *) red_arr_mem_55002)[sext_i32_i64(local_tid_54986)] = eta_p_46361;\n                }\n            }\n            offset_55004 *= 2;\n        }\n        while (slt32(skip_waves_55005, squot32(sext_i64_i32(computed_tblock_sizze_46238) + wave_sizze_54988 - 1, wave_sizze_54988))) {\n            barrier(CLK_LOCAL_MEM_FENCE);\n            offset_55004 = skip_waves_55005 * wave_sizze_54988;\n            if (slt32(local_tid_54986 + offset_55004, sext_i64_i32(n_new_28422)) && ((local_tid_54986 - squot32(local_tid_54986, wave_sizze_54988) * wave_sizze_54988) == 0 && (squot32(local_tid_54986, wave_sizze_54988) & (2 * skip_waves_55005 - 1)) == 0)) {\n                // read array element\n                {\n                    eta_p_46362 = ((__local bool *) red_arr_mem_55002)[sext_i32_i64(local_tid_54986 + offset_55004)];\n                }\n                // apply reduction operation\n                {\n                    bool defunc_0_op_res_46363 = eta_p_46361 || eta_p_46362;\n                    \n                    eta_p_46361 = defunc_0_op_res_46363;\n                }\n                // write result of operation\n                {\n                    ((__local bool *) red_arr_mem_55002)[sext_i32_i64(local_tid_54986)] = eta_p_46361;\n                }\n            }\n            skip_waves_55005 *= 2;\n        }\n   ", "     barrier(CLK_LOCAL_MEM_FENCE);\n        barrier(CLK_LOCAL_MEM_FENCE);\n        // Save result of reduction.\n        {\n            defunc_0_reduce_res_46358 = ((__local bool *) red_arr_mem_55002)[(int64_t) 0];\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        lifted_lambda_res_46335 = defunc_0_reduce_res_46358;\n    }\n    defunc_0_f_res_46373 = btoi_bool_i64(lifted_lambda_res_46335);\n    if (local_tid_54986 == 0) {\n        ((__global int64_t *) mem_53602)[gtid_46315] = defunc_0_f_res_46373;\n    }\n    if (local_tid_54986 == 0) {\n        ((__global int64_t *) mem_53603)[gtid_46315] = lifted_lambda_res_46334;\n    }\n    if (local_tid_54986 == 0) {\n        ((__global bool *) mem_53604)[gtid_46315] = lifted_lambda_res_46319;\n    }\n    \n  error_12:\n    return;\n}\nFUTHARK_KERNEL_SIZED(add_next_partition_doublezisegmap_intrablock_49824_dim1, 1, 1)\nvoid add_next_partition_doublezisegmap_intrablock_49824(__global int *global_failure, int failure_is_an_option, __global int64_t *global_failure_args, int64_t part_no_28414, int64_t dz2083U_28419, int64_t n_new_28422, double clBase_28427, int64_t num_whole_tiles_49841, int64_t residual_input_49922, unsigned char cond_49923_bits, int64_t binop_x_49933, __global unsigned char *clBase_mem_53509, __global unsigned char *clBase_mem_53510, __global unsigned char *clBase_mem_53511, __global unsigned char *clProc_mem_53516, __global unsigned char *clProc_mem_53517, __global unsigned char *new_xs_mem_53533, __global unsigned char *new_ys_mem_53534, __global unsigned char *mem_53582, __global unsigned char *mem_53640, __global unsigned char *mem_53641, __global unsigned char *mem_53642)\n{\n    bool cond_49923 = cond_49923_bits;\n    \n    #define tile_sizze_49826 (add_next_partition_doublezisegmap_intrablock_49824zitile_sizze_49826)\n    #define ldim_49827 (add_next_partition_doublezisegmap_intrablock_49824zildim_49827)\n    #define bytes_53617 (add_next_partition_doublezisegmap_intrablock_49824zibytes_53617)\n    \n    volatile __local unsign", "ed char *color_54516_backing_0 = &shared_mem[0];\n    const int64_t color_54516_backing_0_offset = 0 + (bytes_53617 + srem64((int64_t) 8 - srem64(bytes_53617, (int64_t) 8), (int64_t) 8));\n    volatile __local int local_failure;\n    \n    if (failure_is_an_option) {\n        int failed = *global_failure >= 0;\n        \n        if (failed)\n            return;\n    }\n    local_failure = 0;\n    barrier(CLK_LOCAL_MEM_FENCE);\n    \n    int32_t local_tid_54965;\n    int32_t tblock_sizze_54968;\n    int32_t wave_sizze_54967;\n    int32_t block_id_54966;\n    int32_t global_tid_54964;\n    int64_t gid_flat_49824;\n    int64_t slice_54970;\n    int64_t ltid_pre_54969;\n    int64_t remnant_54971;\n    int64_t slice_54972;\n    int64_t gid_49823;\n    int64_t remnant_54973;\n    __local unsigned char *color_54516;\n    int64_t binop_x_49834;\n    int64_t mem_53612[1];\n    int64_t ltid_flat_49829;\n    int64_t ltid_49828;\n    int64_t gtid_49835;\n    bool cond_49836;\n    int64_t pre_49837;\n    bool mem_53615[1];\n    int64_t ltid_flat_49843;\n    int64_t ltid_49842;\n    bool ext_mem_53622[1];\n    bool mem_param_53616[1];\n    bool mem_53627[1];\n    bool ext_mem_53628[1];\n    int64_t mem_53632[1];\n    int64_t mem_53636[1];\n    bool mem_53639[1];\n    int64_t ltid_flat_49966;\n    int64_t ltid_49965;\n    int64_t gtid_49976;\n    bool cond_49978;\n    int64_t postlude_49979;\n    int64_t postlude_49980;\n    bool postlude_49981;\n    \n    local_tid_54965 = get_local_id(0);\n    tblock_sizze_54968 = get_local_size(0);\n    wave_sizze_54967 = LOCKSTEP_WIDTH;\n    block_id_54966 = get_tblock_id(0);\n    global_tid_54964 = block_id_54966 * tblock_sizze_54968 + local_tid_54965;\n    gid_flat_49824 = sext_i32_i64(block_id_54966);\n    slice_54970 = tile_sizze_49826;\n    ltid_pre_54969 = sext_i32_i64(local_tid_54965);\n    remnant_54971 = sext_i32_i64(local_tid_54965) - ltid_pre_54969;\n    slice_54972 = ldim_49827;\n    gid_49823 = sext_i32_i64(block_id_54966);\n    remnant_54973 = sext_i32_i64(block_id_54966) - gid_49823;\n    c",
                                    "olor_54516 = (__local unsigned char *) color_54516_backing_0;\n    binop_x_49834 = gid_49823 * tile_sizze_49826;\n    ltid_flat_49829 = sext_i32_i64(local_tid_54965);\n    ltid_49828 = sext_i32_i64(sext_i64_i32(ltid_pre_54969));\n    gtid_49835 = ltid_49828 + binop_x_49834;\n    cond_49836 = slt64(gtid_49835, (int64_t) 8);\n    if (cond_49836) {\n        int64_t eta_p_49838 = ((__global int64_t *) mem_53582)[gtid_49835];\n        \n        pre_49837 = eta_p_49838;\n    } else {\n        pre_49837 = (int64_t) 0;\n    }\n    mem_53612[(int64_t) 0] = pre_49837;\n    barrier(CLK_LOCAL_MEM_FENCE);\n    ltid_flat_49843 = sext_i32_i64(local_tid_54965);\n    ltid_49842 = sext_i32_i64(sext_i64_i32(ltid_pre_54969));\n    mem_53615[(int64_t) 0] = 0;\n    barrier(CLK_LOCAL_MEM_FENCE);\n    barrier(CLK_LOCAL_MEM_FENCE);\n    for (int32_t i_1 = 0; i_1 < 1; i_1++)\n        mem_param_53616[i_1] = mem_53615[i_1];\n    for (int64_t tile_id_49849 = 0; tile_id_49849 < num_whole_tiles_49841; tile_id_49849++) {\n        int64_t binop_x_49892;\n        int64_t ltid_flat_49891;\n        int64_t ltid_49890;\n        int64_t j_49893;\n        bool cond_49897;\n        int64_t pre1d_49898;\n        bool mem_53621[1];\n        int64_t ltid_flat_49903;\n        int64_t ltid_49902;\n        int64_t gtid_49905;\n        bool acc_49907;\n        bool cond_49908;\n        bool acc_49909;\n        bool mem_param_tmp_54974[1];\n        \n        binop_x_49892 = tile_sizze_49826 * tile_id_49849;\n        ltid_flat_49891 = sext_i32_i64(local_tid_54965);\n        ltid_49890 = sext_i32_i64(sext_i64_i32(ltid_pre_54969));\n        j_49893 = ltid_49890 + binop_x_49892;\n        cond_49897 = slt64(j_49893, dz2083U_28419);\n        if (cond_49897) {\n            int64_t tile_elem_49899 = ((__global int64_t *) clProc_mem_53517)[j_49893];\n            \n            pre1d_49898 = tile_elem_49899;\n        } else {\n            pre1d_49898 = (int64_t) 0;\n        }\n        ((__local int64_t *) color_54516)[ltid_49890] = pre1d_49898;\n        barrier(CLK_LOCAL_ME", "M_FENCE);\n        ltid_flat_49903 = sext_i32_i64(local_tid_54965);\n        ltid_49902 = sext_i32_i64(sext_i64_i32(ltid_pre_54969));\n        gtid_49905 = binop_x_49834 + ltid_49902;\n        acc_49907 = mem_param_53616[(int64_t) 0];\n        cond_49908 = slt64(gtid_49905, (int64_t) 8);\n        if (cond_49908) {\n            int64_t eta_p_49906;\n            bool x_49910;\n            bool redout_53112;\n            \n            eta_p_49906 = mem_53612[(int64_t) 0];\n            redout_53112 = acc_49907;\n            for (int64_t i_53113 = 0; i_53113 < tile_sizze_49826; i_53113++) {\n                int64_t eta_p_49911;\n                bool lifted_lambda_res_49912;\n                bool defunc_0_op_res_49915;\n                bool redout_tmp_54976;\n                \n                eta_p_49911 = ((__local int64_t *) color_54516)[i_53113];\n                lifted_lambda_res_49912 = eta_p_49911 == eta_p_49906;\n                defunc_0_op_res_49915 = lifted_lambda_res_49912 || redout_53112;\n                redout_tmp_54976 = defunc_0_op_res_49915;\n                redout_53112 = redout_tmp_54976;\n            }\n            x_49910 = redout_53112;\n            acc_49909 = x_49910;\n        } else {\n            acc_49909 = acc_49907;\n        }\n        mem_53621[(int64_t) 0] = acc_49909;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        for (int32_t i_2 = 0; i_2 < 1; i_2++)\n            mem_param_tmp_54974[i_2] = mem_53621[i_2];\n        for (int32_t i_3 = 0; i_3 < 1; i_3++)\n            mem_param_53616[i_3] = mem_param_tmp_54974[i_3];\n    }\n    for (int32_t i_4 = 0; i_4 < 1; i_4++)\n        ext_mem_53622[i_4] = mem_param_53616[i_4];\n    barrier(CLK_LOCAL_MEM_FENCE);\n    if (cond_49923) {\n        for (int32_t i_5 = 0; i_5 < 1; i_5++)\n            ext_mem_53628[i_5] = ext_mem_53622[i_5];\n    } else {\n        int64_t ltid_flat_49925;\n        int64_t ltid_49924;\n        int64_t j_49934;\n        bool cond_49938;\n        int64_t pre1d_49939;\n        int64_t ltid_flat_49945;\n        int64_t ltid_49944;\n  ", "      int64_t gtid_49952;\n        bool acc_49954;\n        bool cond_49955;\n        bool acc_49956;\n        \n        ltid_flat_49925 = sext_i32_i64(local_tid_54965);\n        ltid_49924 = sext_i32_i64(sext_i64_i32(ltid_pre_54969));\n        j_49934 = ltid_49924 + binop_x_49933;\n        cond_49938 = slt64(j_49934, dz2083U_28419);\n        if (cond_49938) {\n            int64_t tile_elem_49940 = ((__global int64_t *) clProc_mem_53517)[j_49934];\n            \n            pre1d_49939 = tile_elem_49940;\n        } else {\n            pre1d_49939 = (int64_t) 0;\n        }\n        ((__local int64_t *) color_54516)[ltid_49924] = pre1d_49939;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        ltid_flat_49945 = sext_i32_i64(local_tid_54965);\n        ltid_49944 = sext_i32_i64(sext_i64_i32(ltid_pre_54969));\n        gtid_49952 = binop_x_49834 + ltid_49944;\n        acc_49954 = ext_mem_53622[(int64_t) 0];\n        cond_49955 = slt64(gtid_49952, (int64_t) 8);\n        if (cond_49955) {\n            int64_t eta_p_49953;\n            bool x_49957;\n            bool redout_53114;\n            \n            eta_p_49953 = mem_53612[(int64_t) 0];\n            redout_53114 = acc_49954;\n            for (int64_t i_53115 = 0; i_53115 < residual_input_49922; i_53115++) {\n                int64_t eta_p_49958;\n                bool lifted_lambda_res_49959;\n                bool defunc_0_op_res_49962;\n                bool redout_tmp_54977;\n                \n                eta_p_49958 = ((__local int64_t *) color_54516)[i_53115];\n                lifted_lambda_res_49959 = eta_p_49958 == eta_p_49953;\n                defunc_0_op_res_49962 = lifted_lambda_res_49959 || redout_53114;\n                redout_tmp_54977 = defunc_0_op_res_49962;\n                redout_53114 = redout_tmp_54977;\n            }\n            x_49957 = redout_53114;\n            acc_49956 = x_49957;\n        } else {\n            acc_49956 = acc_49954;\n        }\n        mem_53627[(int64_t) 0] = acc_49956;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        for (in",
                                    "t32_t i_6 = 0; i_6 < 1; i_6++)\n            ext_mem_53628[i_6] = mem_53627[i_6];\n    }\n    ltid_flat_49966 = sext_i32_i64(local_tid_54965);\n    ltid_49965 = sext_i32_i64(sext_i64_i32(ltid_pre_54969));\n    gtid_49976 = binop_x_49834 + ltid_49965;\n    cond_49978 = slt64(gtid_49976, (int64_t) 8);\n    if (cond_49978) {\n        bool defunc_0_reduce_res_49977;\n        int64_t eta_p_49982;\n        bool cond_49983;\n        bool lifted_lambda_res_49984;\n        int64_t lifted_lambda_res_49989;\n        bool cond_49990;\n        int64_t lifted_lambda_res_49991;\n        bool lifted_lambda_res_49992;\n        int64_t defunc_0_f_res_50028;\n        \n        defunc_0_reduce_res_49977 = ext_mem_53628[(int64_t) 0];\n        eta_p_49982 = mem_53612[(int64_t) 0];\n        cond_49983 = sle64((int64_t) 0, eta_p_49982);\n        if (cond_49983) {\n            bool y_49985;\n            bool bounds_check_49986;\n            bool index_certs_49987;\n            bool lifted_lambda_res_t_res_49988;\n            \n            y_49985 = slt64(eta_p_49982, part_no_28414);\n            bounds_check_49986 = cond_49983 && y_49985;\n            if (!bounds_check_49986) {\n                {\n                    if (atomic_cmpxchg_i32_global(global_failure, -1, 2) == -1) {\n                        global_failure_args[0] = (int64_t) eta_p_49982;\n                        global_failure_args[1] = (int64_t) part_no_28414;\n                        ;\n                    }\n                    local_failure = 1;\n                    goto error_8;\n                }\n            }\n            lifted_lambda_res_t_res_49988 = ((__global bool *) clProc_mem_53516)[eta_p_49982];\n            lifted_lambda_res_49984 = lifted_lambda_res_t_res_49988;\n        } else {\n            lifted_lambda_res_49984 = 0;\n        }\n        if (defunc_0_reduce_res_49977) {\n            lifted_lambda_res_49989 = (int64_t) -1;\n        } else {\n            lifted_lambda_res_49989 = eta_p_49982;\n        }\n        cond_49990 = slt64(lifted_lambda_res_49989, (int", "64_t) 0);\n        if (cond_49990) {\n            lifted_lambda_res_49991 = (int64_t) -1;\n        } else {\n            lifted_lambda_res_49991 = lifted_lambda_res_49989;\n        }\n        if (cond_49990) {\n            lifted_lambda_res_49992 = 0;\n        } else {\n            int64_t zv_rhs_49993;\n            bool zzero_49994;\n            bool nonzzero_49995;\n            bool nonzzero_cert_49996;\n            int64_t nxid_49997;\n            int64_t nyid_49998;\n            double times_arg1_49999;\n            double i64_res_50000;\n            double zt_res_50001;\n            double plus_arg0_50002;\n            double zp_res_50003;\n            double times_arg1_50004;\n            double i64_res_50005;\n            double zt_res_50006;\n            double plus_arg0_50007;\n            double zp_res_50008;\n            double zp_res_50009;\n            double zp_res_50010;\n            double zm_res_50011;\n            double zp_res_50012;\n            double zm_res_50013;\n            double zp_res_50014;\n            bool defunc_0_reduce_res_50015;\n            bool redout_53116;\n            \n            zv_rhs_49993 = ((__global int64_t *) clBase_mem_53510)[(int64_t) 0];\n            zzero_49994 = zv_rhs_49993 == (int64_t) 0;\n            nonzzero_49995 = !zzero_49994;\n            if (!nonzzero_49995) {\n                {\n                    if (atomic_cmpxchg_i32_global(global_failure, -1, 3) == -1) {\n                        ;\n                    }\n                    local_failure = 1;\n                    goto error_8;\n                }\n            }\n            nxid_49997 = smod64(lifted_lambda_res_49989, zv_rhs_49993);\n            nyid_49998 = sdiv64(lifted_lambda_res_49989, zv_rhs_49993);\n            times_arg1_49999 = ((__global double *) clBase_mem_53511)[(int64_t) 0];\n            i64_res_50000 = sitofp_i64_f64(nxid_49997);\n            zt_res_50001 = times_arg1_49999 * i64_res_50000;\n            plus_arg0_50002 = ((__global double *) clBase_mem_53509)[(int64_t) 0];\n            ", "zp_res_50003 = zt_res_50001 + plus_arg0_50002;\n            times_arg1_50004 = ((__global double *) clBase_mem_53511)[(int64_t) 1];\n            i64_res_50005 = sitofp_i64_f64(nyid_49998);\n            zt_res_50006 = times_arg1_50004 * i64_res_50005;\n            plus_arg0_50007 = ((__global double *) clBase_mem_53509)[(int64_t) 1];\n            zp_res_50008 = zt_res_50006 + plus_arg0_50007;\n            zp_res_50009 = times_arg1_49999 + zp_res_50003;\n            zp_res_50010 = times_arg1_50004 + zp_res_50008;\n            zm_res_50011 = zp_res_50003 - clBase_28427;\n            zp_res_50012 = clBase_28427 + zp_res_50009;\n            zm_res_50013 = zp_res_50008 - clBase_28427;\n            zp_res_50014 = clBase_28427 + zp_res_50010;\n            redout_53116 = 0;\n            for (int64_t i_53117 = 0; i_53117 < n_new_28422; i_53117++) {\n                double eta_p_50016;\n                double eta_p_50017;\n                bool zgze_res_50018;\n                bool zlze_res_50019;\n                bool x_50020;\n                bool zgze_res_50021;\n                bool zlze_res_50022;\n                bool x_50023;\n                bool x_50024;\n                bool defunc_0_op_res_50027;\n                bool redout_tmp_54978;\n                \n                eta_p_50016 = ((__global double *) new_xs_mem_53533)[i_53117];\n                eta_p_50017 = ((__global double *) new_ys_mem_53534)[i_53117];\n                zgze_res_50018 = zm_res_50011 <= eta_p_50016;\n                zlze_res_50019 = eta_p_50016 <= zp_res_50012;\n                x_50020 = zgze_res_50018 && zlze_res_50019;\n                zgze_res_50021 = zm_res_50013 <= eta_p_50017;\n                zlze_res_50022 = eta_p_50017 <= zp_res_50014;\n                x_50023 = zgze_res_50021 && zlze_res_50022;\n                x_50024 = x_50020 && x_50023;\n                defunc_0_op_res_50027 = x_50024 || redout_53116;\n                redout_tmp_54978 = defunc_0_op_res_50027;\n                redout_53116 = redout_tmp_54978;\n        ",
                                    "    }\n            defunc_0_reduce_res_50015 = redout_53116;\n            lifted_lambda_res_49992 = defunc_0_reduce_res_50015;\n        }\n        defunc_0_f_res_50028 = btoi_bool_i64(lifted_lambda_res_49992);\n        postlude_49979 = defunc_0_f_res_50028;\n        postlude_49980 = lifted_lambda_res_49991;\n        postlude_49981 = lifted_lambda_res_49984;\n    } else {\n        postlude_49979 = (int64_t) 0;\n        postlude_49980 = (int64_t) 0;\n        postlude_49981 = 0;\n    }\n    mem_53632[(int64_t) 0] = postlude_49979;\n    mem_53636[(int64_t) 0] = postlude_49980;\n    mem_53639[(int64_t) 0] = postlude_49981;\n    \n  error_8:\n    barrier(CLK_LOCAL_MEM_FENCE);\n    if (local_failure)\n        return;\n    barrier(CLK_LOCAL_MEM_FENCE);\n    if (slt64(sext_i32_i64(local_tid_54965) + tile_sizze_49826 * sext_i32_i64(block_id_54966), (int64_t) 8)) {\n        int64_t tmp_54979 = mem_53632[(int64_t) 0];\n        \n        ((__global int64_t *) mem_53640)[sext_i32_i64(local_tid_54965) + tile_sizze_49826 * sext_i32_i64(block_id_54966)] = tmp_54979;\n    }\n    if (slt64(sext_i32_i64(local_tid_54965) + tile_sizze_49826 * sext_i32_i64(block_id_54966), (int64_t) 8)) {\n        int64_t tmp_54980 = mem_53636[(int64_t) 0];\n        \n        ((__global int64_t *) mem_53641)[sext_i32_i64(local_tid_54965) + tile_sizze_49826 * sext_i32_i64(block_id_54966)] = tmp_54980;\n    }\n    if (slt64(sext_i32_i64(local_tid_54965) + tile_sizze_49826 * sext_i32_i64(block_id_54966), (int64_t) 8)) {\n        bool tmp_54981 = mem_53639[(int64_t) 0];\n        \n        ((__global bool *) mem_53642)[sext_i32_i64(local_tid_54965) + tile_sizze_49826 * sext_i32_i64(block_id_54966)] = tmp_54981;\n    }\n    \n  error_9:\n    return;\n    #undef tile_sizze_49826\n    #undef ldim_49827\n    #undef bytes_53617\n}\nFUTHARK_KERNEL_SIZED(add_next_partition_doublezisegmap_intrablock_50036_dim1, 1, 1)\nvoid add_next_partition_doublezisegmap_intrablock_50036(__global int *global_failure, int failure_is_an_option, __global int64_t *global_failure_a", "rgs, int64_t n_new_28422, double zt_res_40980, int64_t ldim_50039, __global unsigned char *clBase_mem_53509, __global unsigned char *clBase_mem_53510, __global unsigned char *clBase_mem_53511, __global unsigned char *new_xs_mem_53533, __global unsigned char *new_ys_mem_53534, __global unsigned char *mem_53582, __global unsigned char *mem_53698)\n{\n    #define tile_sizze_50038 (add_next_partition_doublezisegmap_intrablock_50036zitile_sizze_50038)\n    #define num_whole_tiles_50059 (add_next_partition_doublezisegmap_intrablock_50036zinum_whole_tiles_50059)\n    #define residual_input_50234 (add_next_partition_doublezisegmap_intrablock_50036ziresidual_input_50234)\n    #define cond_50235 (add_next_partition_doublezisegmap_intrablock_50036zicond_50235)\n    #define binop_x_50245 (add_next_partition_doublezisegmap_intrablock_50036zibinop_x_50245)\n    #define bytes_53686 (add_next_partition_doublezisegmap_intrablock_50036zibytes_53686)\n    \n    volatile __local unsigned char *color_54517_backing_0 = &shared_mem[0];\n    const int64_t color_54517_backing_0_offset = 0 + (bytes_53686 + srem64((int64_t) 8 - srem64(bytes_53686, (int64_t) 8), (int64_t) 8));\n    volatile __local int local_failure;\n    \n    if (failure_is_an_option) {\n        int failed = *global_failure >= 0;\n        \n        if (failed)\n            return;\n    }\n    local_failure = 0;\n    barrier(CLK_LOCAL_MEM_FENCE);\n    \n    int32_t local_tid_55532;\n    int32_t tblock_sizze_55535;\n    int32_t wave_sizze_55534;\n    int32_t block_id_55533;\n    int32_t global_tid_55531;\n    int64_t gid_flat_50036;\n    int64_t slice_55537;\n    int64_t ltid_pre_55536;\n    int64_t remnant_55538;\n    int64_t slice_55539;\n    int64_t gid_50035;\n    int64_t remnant_55540;\n    __local unsigned char *color_54517;\n    int64_t binop_x_50048;\n    double mem_53677[1];\n    double mem_53681[1];\n    int64_t ltid_flat_50041;\n    int64_t ltid_50040;\n    int64_t gtid_50049;\n    bool cond_50050;\n    double pre_50051;\n    double pre_50052;\n    bool mem_5", "3684[1];\n    int64_t ltid_flat_50061;\n    int64_t ltid_50060;\n    bool ext_mem_53691[1];\n    bool mem_param_53685[1];\n    bool mem_53696[1];\n    bool ext_mem_53697[1];\n    \n    local_tid_55532 = get_local_id(0);\n    tblock_sizze_55535 = get_local_size(0);\n    wave_sizze_55534 = LOCKSTEP_WIDTH;\n    block_id_55533 = get_tblock_id(0);\n    global_tid_55531 = block_id_55533 * tblock_sizze_55535 + local_tid_55532;\n    gid_flat_50036 = sext_i32_i64(block_id_55533);\n    slice_55537 = tile_sizze_50038;\n    ltid_pre_55536 = sext_i32_i64(local_tid_55532);\n    remnant_55538 = sext_i32_i64(local_tid_55532) - ltid_pre_55536;\n    slice_55539 = ldim_50039;\n    gid_50035 = sext_i32_i64(block_id_55533);\n    remnant_55540 = sext_i32_i64(block_id_55533) - gid_50035;\n    color_54517 = (__local unsigned char *) color_54517_backing_0;\n    binop_x_50048 = gid_50035 * tile_sizze_50038;\n    ltid_flat_50041 = sext_i32_i64(local_tid_55532);\n    ltid_50040 = sext_i32_i64(sext_i64_i32(ltid_pre_55536));\n    gtid_50049 = ltid_50040 + binop_x_50048;\n    cond_50050 = slt64(gtid_50049, n_new_28422);\n    if (cond_50050) {\n        double eta_p_50053;\n        double eta_p_50054;\n        \n        eta_p_50053 = ((__global double *) new_xs_mem_53533)[gtid_50049];\n        eta_p_50054 = ((__global double *) new_ys_mem_53534)[gtid_50049];\n        pre_50051 = eta_p_50053;\n        pre_50052 = eta_p_50054;\n    } else {\n        pre_50051 = 0.0;\n        pre_50052 = 0.0;\n    }\n    mem_53677[(int64_t) 0] = pre_50051;\n    mem_53681[(int64_t) 0] = pre_50052;\n    barrier(CLK_LOCAL_MEM_FENCE);\n    ltid_flat_50061 = sext_i32_i64(local_tid_55532);\n    ltid_50060 = sext_i32_i64(sext_i64_i32(ltid_pre_55536));\n    mem_53684[(int64_t) 0] = 0;\n    barrier(CLK_LOCAL_MEM_FENCE);\n    barrier(CLK_LOCAL_MEM_FENCE);\n    for (int32_t i_1 = 0; i_1 < 1; i_1++)\n        mem_param_53685[i_1] = mem_53684[i_1];\n    for (int64_t tile_id_50067 = 0; tile_id_50067 < num_whole_tiles_50059; tile_id_50067++) {\n        int64_t binop_x_50142;\n      ",
                                    "  int64_t ltid_flat_50141;\n        int64_t ltid_50140;\n        int64_t j_50143;\n        bool cond_50148;\n        int64_t pre1d_50149;\n        bool mem_53690[1];\n        int64_t ltid_flat_50154;\n        int64_t ltid_50153;\n        int64_t gtid_50156;\n        bool acc_50159;\n        bool cond_50160;\n        bool acc_50161;\n        bool mem_param_tmp_55541[1];\n        \n        binop_x_50142 = tile_sizze_50038 * tile_id_50067;\n        ltid_flat_50141 = sext_i32_i64(local_tid_55532);\n        ltid_50140 = sext_i32_i64(sext_i64_i32(ltid_pre_55536));\n        j_50143 = ltid_50140 + binop_x_50142;\n        cond_50148 = slt64(j_50143, (int64_t) 8);\n        if (cond_50148) {\n            int64_t tile_elem_50150 = ((__global int64_t *) mem_53582)[j_50143];\n            \n            pre1d_50149 = tile_elem_50150;\n        } else {\n            pre1d_50149 = (int64_t) 0;\n        }\n        ((__local int64_t *) color_54517)[ltid_50140] = pre1d_50149;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        ltid_flat_50154 = sext_i32_i64(local_tid_55532);\n        ltid_50153 = sext_i32_i64(sext_i64_i32(ltid_pre_55536));\n        gtid_50156 = binop_x_50048 + ltid_50153;\n        acc_50159 = mem_param_53685[(int64_t) 0];\n        cond_50160 = slt64(gtid_50156, n_new_28422);\n        if (cond_50160) {\n            double eta_p_50157;\n            double eta_p_50158;\n            bool x_50162;\n            bool redout_53120;\n            \n            eta_p_50157 = mem_53677[(int64_t) 0];\n            eta_p_50158 = mem_53681[(int64_t) 0];\n            redout_53120 = acc_50159;\n            for (int64_t i_53121 = 0; i_53121 < tile_sizze_50038; i_53121++) {\n                int64_t eta_p_50163;\n                bool cond_50164;\n                bool lifted_lambda_res_50165;\n                bool defunc_0_op_res_50197;\n                bool redout_tmp_55543;\n                \n                eta_p_50163 = ((__local int64_t *) color_54517)[i_53121];\n                cond_50164 = slt64(eta_p_50163, (int64_t) 0);\n                ", "if (cond_50164) {\n                    lifted_lambda_res_50165 = 0;\n                } else {\n                    int64_t zv_rhs_50166;\n                    bool zzero_50167;\n                    bool nonzzero_50168;\n                    bool nonzzero_cert_50169;\n                    int64_t nxid_50170;\n                    int64_t nyid_50171;\n                    double times_arg1_50172;\n                    double i64_res_50173;\n                    double zt_res_50174;\n                    double plus_arg0_50175;\n                    double zp_res_50176;\n                    double times_arg1_50177;\n                    double i64_res_50178;\n                    double zt_res_50179;\n                    double plus_arg0_50180;\n                    double zp_res_50181;\n                    double zp_res_50182;\n                    double zp_res_50183;\n                    double zm_res_50184;\n                    bool zgze_res_50185;\n                    double zp_res_50186;\n                    bool zlze_res_50187;\n                    bool x_50188;\n                    double zm_res_50189;\n                    bool zgze_res_50190;\n                    double zp_res_50191;\n                    bool zlze_res_50192;\n                    bool x_50193;\n                    bool x_50194;\n                    \n                    zv_rhs_50166 = ((__global int64_t *) clBase_mem_53510)[(int64_t) 0];\n                    zzero_50167 = zv_rhs_50166 == (int64_t) 0;\n                    nonzzero_50168 = !zzero_50167;\n                    if (!nonzzero_50168) {\n                        {\n                            if (atomic_cmpxchg_i32_global(global_failure, -1, 10) == -1) {\n                                ;\n                            }\n                            local_failure = 1;\n                            goto error_4;\n                        }\n                    }\n                    nxid_50170 = smod64(eta_p_50163, zv_rhs_50166);\n                    nyid_50171 = sdiv64(eta_p_50163, zv_rhs_50166);\n  ", "                  times_arg1_50172 = ((__global double *) clBase_mem_53511)[(int64_t) 0];\n                    i64_res_50173 = sitofp_i64_f64(nxid_50170);\n                    zt_res_50174 = times_arg1_50172 * i64_res_50173;\n                    plus_arg0_50175 = ((__global double *) clBase_mem_53509)[(int64_t) 0];\n                    zp_res_50176 = zt_res_50174 + plus_arg0_50175;\n                    times_arg1_50177 = ((__global double *) clBase_mem_53511)[(int64_t) 1];\n                    i64_res_50178 = sitofp_i64_f64(nyid_50171);\n                    zt_res_50179 = times_arg1_50177 * i64_res_50178;\n                    plus_arg0_50180 = ((__global double *) clBase_mem_53509)[(int64_t) 1];\n                    zp_res_50181 = zt_res_50179 + plus_arg0_50180;\n                    zp_res_50182 = times_arg1_50172 + zp_res_50176;\n                    zp_res_50183 = times_arg1_50177 + zp_res_50181;\n                    zm_res_50184 = zp_res_50176 - zt_res_40980;\n                    zgze_res_50185 = zm_res_50184 <= eta_p_50157;\n                    zp_res_50186 = zt_res_40980 + zp_res_50182;\n                    zlze_res_50187 = eta_p_50157 <= zp_res_50186;\n                    x_50188 = zgze_res_50185 && zlze_res_50187;\n                    zm_res_50189 = zp_res_50181 - zt_res_40980;\n                    zgze_res_50190 = zm_res_50189 <= eta_p_50158;\n                    zp_res_50191 = zt_res_40980 + zp_res_50183;\n                    zlze_res_50192 = eta_p_50158 <= zp_res_50191;\n                    x_50193 = zgze_res_50190 && zlze_res_50192;\n                    x_50194 = x_50188 && x_50193;\n                    lifted_lambda_res_50165 = x_50194;\n                }\n                defunc_0_op_res_50197 = lifted_lambda_res_50165 || redout_53120;\n                redout_tmp_55543 = defunc_0_op_res_50197;\n                redout_53120 = redout_tmp_55543;\n            }\n            x_50162 = redout_53120;\n            acc_50161 = x_50162;\n        } else {\n            acc_50161 = acc_50159;\n      ",
                                    "  }\n        mem_53690[(int64_t) 0] = acc_50161;\n        \n      error_4:\n        barrier(CLK_LOCAL_MEM_FENCE);\n        if (local_failure)\n            return;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        for (int32_t i_2 = 0; i_2 < 1; i_2++)\n            mem_param_tmp_55541[i_2] = mem_53690[i_2];\n        for (int32_t i_3 = 0; i_3 < 1; i_3++)\n            mem_param_53685[i_3] = mem_param_tmp_55541[i_3];\n    }\n    for (int32_t i_4 = 0; i_4 < 1; i_4++)\n        ext_mem_53691[i_4] = mem_param_53685[i_4];\n    barrier(CLK_LOCAL_MEM_FENCE);\n    if (cond_50235) {\n        for (int32_t i_5 = 0; i_5 < 1; i_5++)\n            ext_mem_53697[i_5] = ext_mem_53691[i_5];\n    } else {\n        int64_t ltid_flat_50237;\n        int64_t ltid_50236;\n        int64_t j_50246;\n        bool cond_50251;\n        int64_t pre1d_50252;\n        int64_t ltid_flat_50258;\n        int64_t ltid_50257;\n        int64_t gtid_50265;\n        bool acc_50268;\n        bool cond_50269;\n        bool acc_50270;\n        \n        ltid_flat_50237 = sext_i32_i64(local_tid_55532);\n        ltid_50236 = sext_i32_i64(sext_i64_i32(ltid_pre_55536));\n        j_50246 = ltid_50236 + binop_x_50245;\n        cond_50251 = slt64(j_50246, (int64_t) 8);\n        if (cond_50251) {\n            int64_t tile_elem_50253 = ((__global int64_t *) mem_53582)[j_50246];\n            \n            pre1d_50252 = tile_elem_50253;\n        } else {\n            pre1d_50252 = (int64_t) 0;\n        }\n        ((__local int64_t *) color_54517)[ltid_50236] = pre1d_50252;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        ltid_flat_50258 = sext_i32_i64(local_tid_55532);\n        ltid_50257 = sext_i32_i64(sext_i64_i32(ltid_pre_55536));\n        gtid_50265 = binop_x_50048 + ltid_50257;\n        acc_50268 = ext_mem_53691[(int64_t) 0];\n        cond_50269 = slt64(gtid_50265, n_new_28422);\n        if (cond_50269) {\n            double eta_p_50266;\n            double eta_p_50267;\n            bool x_50271;\n            bool redout_53122;\n            \n            eta_p_50266 = mem_536", "77[(int64_t) 0];\n            eta_p_50267 = mem_53681[(int64_t) 0];\n            redout_53122 = acc_50268;\n            for (int64_t i_53123 = 0; i_53123 < residual_input_50234; i_53123++) {\n                int64_t eta_p_50272;\n                bool cond_50273;\n                bool lifted_lambda_res_50274;\n                bool defunc_0_op_res_50306;\n                bool redout_tmp_55544;\n                \n                eta_p_50272 = ((__local int64_t *) color_54517)[i_53123];\n                cond_50273 = slt64(eta_p_50272, (int64_t) 0);\n                if (cond_50273) {\n                    lifted_lambda_res_50274 = 0;\n                } else {\n                    int64_t zv_rhs_50275;\n                    bool zzero_50276;\n                    bool nonzzero_50277;\n                    bool nonzzero_cert_50278;\n                    int64_t nxid_50279;\n                    int64_t nyid_50280;\n                    double times_arg1_50281;\n                    double i64_res_50282;\n                    double zt_res_50283;\n                    double plus_arg0_50284;\n                    double zp_res_50285;\n                    double times_arg1_50286;\n                    double i64_res_50287;\n                    double zt_res_50288;\n                    double plus_arg0_50289;\n                    double zp_res_50290;\n                    double zp_res_50291;\n                    double zp_res_50292;\n                    double zm_res_50293;\n                    bool zgze_res_50294;\n                    double zp_res_50295;\n                    bool zlze_res_50296;\n                    bool x_50297;\n                    double zm_res_50298;\n                    bool zgze_res_50299;\n                    double zp_res_50300;\n                    bool zlze_res_50301;\n                    bool x_50302;\n                    bool x_50303;\n                    \n                    zv_rhs_50275 = ((__global int64_t *) clBase_mem_53510)[(int64_t) 0];\n                    zzero_50276 = zv_rhs_50275 == (int64_", "t) 0;\n                    nonzzero_50277 = !zzero_50276;\n                    if (!nonzzero_50277) {\n                        {\n                            if (atomic_cmpxchg_i32_global(global_failure, -1, 11) == -1) {\n                                ;\n                            }\n                            local_failure = 1;\n                            goto error_7;\n                        }\n                    }\n                    nxid_50279 = smod64(eta_p_50272, zv_rhs_50275);\n                    nyid_50280 = sdiv64(eta_p_50272, zv_rhs_50275);\n                    times_arg1_50281 = ((__global double *) clBase_mem_53511)[(int64_t) 0];\n                    i64_res_50282 = sitofp_i64_f64(nxid_50279);\n                    zt_res_50283 = times_arg1_50281 * i64_res_50282;\n                    plus_arg0_50284 = ((__global double *) clBase_mem_53509)[(int64_t) 0];\n                    zp_res_50285 = zt_res_50283 + plus_arg0_50284;\n                    times_arg1_50286 = ((__global double *) clBase_mem_53511)[(int64_t) 1];\n                    i64_res_50287 = sitofp_i64_f64(nyid_50280);\n                    zt_res_50288 = times_arg1_50286 * i64_res_50287;\n                    plus_arg0_50289 = ((__global double *) clBase_mem_53509)[(int64_t) 1];\n                    zp_res_50290 = zt_res_50288 + plus_arg0_50289;\n                    zp_res_50291 = times_arg1_50281 + zp_res_50285;\n                    zp_res_50292 = times_arg1_50286 + zp_res_50290;\n                    zm_res_50293 = zp_res_50285 - zt_res_40980;\n                    zgze_res_50294 = zm_res_50293 <= eta_p_50266;\n                    zp_res_50295 = zt_res_40980 + zp_res_50291;\n                    zlze_res_50296 = eta_p_50266 <= zp_res_50295;\n                    x_50297 = zgze_res_50294 && zlze_res_50296;\n                    zm_res_50298 = zp_res_50290 - zt_res_40980;\n                    zgze_res_50299 = zm_res_50298 <= eta_p_50267;\n                    zp_res_50300 = zt_res_40980 + zp_res_50292;\n                    zlze_r",
                                    "es_50301 = eta_p_50267 <= zp_res_50300;\n                    x_50302 = zgze_res_50299 && zlze_res_50301;\n                    x_50303 = x_50297 && x_50302;\n                    lifted_lambda_res_50274 = x_50303;\n                }\n                defunc_0_op_res_50306 = lifted_lambda_res_50274 || redout_53122;\n                redout_tmp_55544 = defunc_0_op_res_50306;\n                redout_53122 = redout_tmp_55544;\n            }\n            x_50271 = redout_53122;\n            acc_50270 = x_50271;\n        } else {\n            acc_50270 = acc_50268;\n        }\n        mem_53696[(int64_t) 0] = acc_50270;\n        \n      error_7:\n        barrier(CLK_LOCAL_MEM_FENCE);\n        if (local_failure)\n            return;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        for (int32_t i_6 = 0; i_6 < 1; i_6++)\n            ext_mem_53697[i_6] = mem_53696[i_6];\n    }\n    if (slt64(sext_i32_i64(local_tid_55532) + tile_sizze_50038 * sext_i32_i64(block_id_55533), n_new_28422)) {\n        bool tmp_55545 = ext_mem_53697[(int64_t) 0];\n        \n        ((__global bool *) mem_53698)[sext_i32_i64(local_tid_55532) + tile_sizze_50038 * sext_i32_i64(block_id_55533)] = tmp_55545;\n    }\n    \n  error_8:\n    return;\n    #undef tile_sizze_50038\n    #undef num_whole_tiles_50059\n    #undef residual_input_50234\n    #undef cond_50235\n    #undef binop_x_50245\n    #undef bytes_53686\n}\nFUTHARK_KERNEL_SIZED(add_next_partition_doublezisegred_large_46395_dim1, 1, 1)\nvoid add_next_partition_doublezisegred_large_46395(__global int *global_failure, int64_t dz2083U_28419, int64_t num_tblocks_46390, int64_t blocks_per_segment_55044, int64_t q_55045, int64_t num_virtblocks_55046, int64_t threads_per_segment_55047, __global unsigned char *clProc_mem_53517, __global unsigned char *mem_53582, __global unsigned char *mem_53597, __global unsigned char *segred_tmp_mem_55048, __global unsigned char *counters_mem_55050)\n{\n    #define segred_tblock_sizze_46389 (add_next_partition_doublezisegred_large_46395zisegred_tblock_sizze_46389)\n ", "   #define chunk_sizze_55015 (add_next_partition_doublezisegred_large_46395zichunk_sizze_55015)\n    \n    volatile __local unsigned char *sync_arr_mem_55059_backing_1 = &shared_mem[0];\n    const int64_t sync_arr_mem_55059_backing_1_offset = 0 + 8;\n    volatile __local unsigned char *red_arr_bool_mem_55057_backing_0 = &shared_mem[sync_arr_mem_55059_backing_1_offset];\n    const int64_t red_arr_bool_mem_55057_backing_0_offset = sync_arr_mem_55059_backing_1_offset + (segred_tblock_sizze_46389 + srem64((int64_t) 8 - srem64(segred_tblock_sizze_46389, (int64_t) 8), (int64_t) 8));\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_55053;\n    int32_t tblock_sizze_55056;\n    int32_t wave_sizze_55055;\n    int32_t block_id_55054;\n    int32_t global_tid_55052;\n    int64_t phys_tid_46395;\n    __local unsigned char *red_arr_bool_mem_55057;\n    __local unsigned char *sync_arr_mem_55059;\n    int32_t phys_tblock_id_55061;\n    int32_t iterations_55062;\n    \n    local_tid_55053 = get_local_id(0);\n    tblock_sizze_55056 = get_local_size(0);\n    wave_sizze_55055 = LOCKSTEP_WIDTH;\n    block_id_55054 = get_tblock_id(0);\n    global_tid_55052 = block_id_55054 * tblock_sizze_55056 + local_tid_55053;\n    phys_tid_46395 = sext_i32_i64(global_tid_55052);\n    red_arr_bool_mem_55057 = (__local unsigned char *) red_arr_bool_mem_55057_backing_0;\n    sync_arr_mem_55059 = (__local unsigned char *) sync_arr_mem_55059_backing_1;\n    phys_tblock_id_55061 = get_tblock_id(0);\n    iterations_55062 = sdiv_up32(sext_i64_i32(num_virtblocks_55046) - phys_tblock_id_55061, sext_i64_i32(num_tblocks_46390));\n    for (int32_t i_55063 = 0; i_55063 < iterations_55062; i_55063++) {\n        int32_t virt_tblock_id_55064;\n        int64_t flat_segment_id_55065;\n        int64_t global_tid_55066;\n        int64_t slice_55067;\n        int64_t gtid_46393;\n        int64_t remnant_55068;\n        int64_t gtid_46394;\n        bool eta_p_block_res_acc_55069;\n        bool eta_p_46396;\n        bool eta_p_46397", ";\n        int64_t tblock_id_in_segment_55073;\n        int64_t block_base_offset_55074;\n        int32_t offset_55077;\n        int32_t skip_waves_55078;\n        bool eta_p_55070;\n        bool eta_p_55071;\n        \n        virt_tblock_id_55064 = phys_tblock_id_55061 + i_55063 * sext_i64_i32(num_tblocks_46390);\n        flat_segment_id_55065 = squot64(sext_i32_i64(virt_tblock_id_55064), blocks_per_segment_55044);\n        global_tid_55066 = srem64(sext_i32_i64(virt_tblock_id_55064) * segred_tblock_sizze_46389 + sext_i32_i64(local_tid_55053), threads_per_segment_55047);\n        slice_55067 = (int64_t) 8;\n        gtid_46393 = flat_segment_id_55065;\n        remnant_55068 = flat_segment_id_55065 - gtid_46393;\n        // ne-initialise the outer (per-block) accumulator(s)\n        {\n            eta_p_block_res_acc_55069 = 0;\n        }\n        tblock_id_in_segment_55073 = squot64(global_tid_55066, segred_tblock_sizze_46389);\n        block_base_offset_55074 = tblock_id_in_segment_55073 * q_55045 * segred_tblock_sizze_46389;\n        for (int64_t i_55075 = 0; i_55075 < q_55045; i_55075++) {\n            int64_t block_offset_55076 = block_base_offset_55074 + i_55075 * segred_tblock_sizze_46389;\n            \n            gtid_46394 = global_tid_55066 + threads_per_segment_55047 * i_55075;\n            if (slt64(gtid_46394, dz2083U_28419)) {\n                // apply map function(s)\n                {\n                    // apply map function\n                    {\n                        int64_t eta_p_46399 = ((__global int64_t *) mem_53582)[gtid_46393];\n                        int64_t eta_p_46400 = ((__global int64_t *) clProc_mem_53517)[gtid_46394];\n                        bool lifted_lambda_res_46401 = eta_p_46400 == eta_p_46399;\n                        \n                        // load accumulator(s)\n                        {\n                            eta_p_46396 = eta_p_block_res_acc_55069;\n                        }\n                        // load next value(s)\n                       ",
                                    " {\n                            eta_p_46397 = lifted_lambda_res_46401;\n                        }\n                        // apply reduction operator(s)\n                        {\n                            bool defunc_0_op_res_46398 = eta_p_46396 || eta_p_46397;\n                            \n                            // store in accumulator(s)\n                            {\n                                eta_p_block_res_acc_55069 = defunc_0_op_res_46398;\n                            }\n                        }\n                    }\n                }\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        // store accs. prims go in lmem; non-prims in params (in global mem)\n        {\n            ((__local bool *) red_arr_bool_mem_55057)[sext_i32_i64(local_tid_55053)] = eta_p_block_res_acc_55069;\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        skip_waves_55078 = 1;\n        offset_55077 = 0;\n        // participating threads read initial accumulator\n        {\n            if (slt32(local_tid_55053, sext_i64_i32(segred_tblock_sizze_46389))) {\n                eta_p_55070 = ((__local bool *) red_arr_bool_mem_55057)[sext_i32_i64(local_tid_55053 + offset_55077)];\n            }\n        }\n        offset_55077 = 1;\n        while (slt32(offset_55077, wave_sizze_55055)) {\n            if (slt32(local_tid_55053 + offset_55077, sext_i64_i32(segred_tblock_sizze_46389)) && ((local_tid_55053 - squot32(local_tid_55053, wave_sizze_55055) * wave_sizze_55055) & (2 * offset_55077 - 1)) == 0) {\n                // read array element\n                {\n                    eta_p_55071 = ((volatile __local bool *) red_arr_bool_mem_55057)[sext_i32_i64(local_tid_55053 + offset_55077)];\n                }\n                // apply reduction operation\n                {\n                    bool defunc_0_op_res_55072 = eta_p_55070 || eta_p_55071;\n                    \n                    eta_p_55070 = defunc_0_op_res_55072;\n                }\n                // write result of operation\n", "                {\n                    ((volatile __local bool *) red_arr_bool_mem_55057)[sext_i32_i64(local_tid_55053)] = eta_p_55070;\n                }\n            }\n            offset_55077 *= 2;\n        }\n        while (slt32(skip_waves_55078, squot32(sext_i64_i32(segred_tblock_sizze_46389) + wave_sizze_55055 - 1, wave_sizze_55055))) {\n            barrier(CLK_LOCAL_MEM_FENCE);\n            offset_55077 = skip_waves_55078 * wave_sizze_55055;\n            if (slt32(local_tid_55053 + offset_55077, sext_i64_i32(segred_tblock_sizze_46389)) && ((local_tid_55053 - squot32(local_tid_55053, wave_sizze_55055) * wave_sizze_55055) == 0 && (squot32(local_tid_55053, wave_sizze_55055) & (2 * skip_waves_55078 - 1)) == 0)) {\n                // read array element\n                {\n                    eta_p_55071 = ((__local bool *) red_arr_bool_mem_55057)[sext_i32_i64(local_tid_55053 + offset_55077)];\n                }\n                // apply reduction operation\n                {\n                    bool defunc_0_op_res_55072 = eta_p_55070 || eta_p_55071;\n                    \n                    eta_p_55070 = defunc_0_op_res_55072;\n                }\n                // write result of operation\n                {\n                    ((__local bool *) red_arr_bool_mem_55057)[sext_i32_i64(local_tid_55053)] = eta_p_55070;\n                }\n            }\n            skip_waves_55078 *= 2;\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        barrier(CLK_LOCAL_MEM_FENCE);\n        // thread 0 updates per-block acc(s); rest reset to ne\n        {\n            if (sext_i32_i64(local_tid_55053) == (int64_t) 0) {\n                eta_p_block_res_acc_55069 = eta_p_55070;\n            } else {\n                eta_p_block_res_acc_55069 = 0;\n            }\n        }\n        if (blocks_per_segment_55044 == (int64_t) 1) {\n            // first thread in block saves final result to memory\n            {\n                if (local_tid_55053 == 0) {\n                    ((__global bool *) mem_53597)[gtid_4639", "3] = eta_p_block_res_acc_55069;\n                }\n            }\n        } else {\n            int32_t old_counter_55079;\n            bool is_last_block_55080;\n            \n            // first thread in block saves block result to global memory\n            {\n                if (local_tid_55053 == 0) {\n                    ((__global bool *) segred_tmp_mem_55048)[sext_i32_i64(virt_tblock_id_55064)] = eta_p_block_res_acc_55069;\n                    mem_fence_global();\n                    old_counter_55079 = atomic_add_i32_global(&((volatile __global int *) counters_mem_55050)[srem64(flat_segment_id_55065, (int64_t) 20480)], (int) 1);\n                    ((__local bool *) sync_arr_mem_55059)[(int64_t) 0] = old_counter_55079 == sext_i64_i32(blocks_per_segment_55044 - (int64_t) 1);\n                }\n            }\n            barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n            is_last_block_55080 = ((__local bool *) sync_arr_mem_55059)[(int64_t) 0];\n            if (is_last_block_55080) {\n                if (local_tid_55053 == 0) {\n                    old_counter_55079 = atomic_add_i32_global(&((volatile __global int *) counters_mem_55050)[srem64(flat_segment_id_55065, (int64_t) 20480)], (int) sext_i64_i32((int64_t) 0 - blocks_per_segment_55044));\n                }\n                // read in the per-block-results\n                {\n                    int64_t read_per_thread_55081 = sdiv_up64(blocks_per_segment_55044, segred_tblock_sizze_46389);\n                    \n                    eta_p_46396 = 0;\n                    for (int64_t i_55082 = 0; i_55082 < read_per_thread_55081; i_55082++) {\n                        int64_t block_res_id_55083 = sext_i32_i64(local_tid_55053) * read_per_thread_55081 + i_55082;\n                        int64_t index_of_block_res_55084 = flat_segment_id_55065 * blocks_per_segment_55044 + block_res_id_55083;\n                        \n                        if (slt64(block_res_id_55083, blocks_per_segment_55044)) {\n                      ",
                                    "      eta_p_46397 = ((__global bool *) segred_tmp_mem_55048)[index_of_block_res_55084];\n                            \n                            bool defunc_0_op_res_46398 = eta_p_46396 || eta_p_46397;\n                            \n                            eta_p_46396 = defunc_0_op_res_46398;\n                        }\n                    }\n                }\n                ((__local bool *) red_arr_bool_mem_55057)[sext_i32_i64(local_tid_55053)] = eta_p_46396;\n                barrier(CLK_LOCAL_MEM_FENCE);\n                // reduce the per-block results\n                {\n                    int32_t offset_55085;\n                    int32_t skip_waves_55086 = 1;\n                    bool eta_p_55070;\n                    bool eta_p_55071;\n                    \n                    offset_55085 = 0;\n                    // participating threads read initial accumulator\n                    {\n                        if (slt32(local_tid_55053, sext_i64_i32(segred_tblock_sizze_46389))) {\n                            eta_p_55070 = ((__local bool *) red_arr_bool_mem_55057)[sext_i32_i64(local_tid_55053 + offset_55085)];\n                        }\n                    }\n                    offset_55085 = 1;\n                    while (slt32(offset_55085, wave_sizze_55055)) {\n                        if (slt32(local_tid_55053 + offset_55085, sext_i64_i32(segred_tblock_sizze_46389)) && ((local_tid_55053 - squot32(local_tid_55053, wave_sizze_55055) * wave_sizze_55055) & (2 * offset_55085 - 1)) == 0) {\n                            // read array element\n                            {\n                                eta_p_55071 = ((volatile __local bool *) red_arr_bool_mem_55057)[sext_i32_i64(local_tid_55053 + offset_55085)];\n                            }\n                            // apply reduction operation\n                            {\n                                bool defunc_0_op_res_55072 = eta_p_55070 || eta_p_55071;\n                                \n                                e", "ta_p_55070 = defunc_0_op_res_55072;\n                            }\n                            // write result of operation\n                            {\n                                ((volatile __local bool *) red_arr_bool_mem_55057)[sext_i32_i64(local_tid_55053)] = eta_p_55070;\n                            }\n                        }\n                        offset_55085 *= 2;\n                    }\n                    while (slt32(skip_waves_55086, squot32(sext_i64_i32(segred_tblock_sizze_46389) + wave_sizze_55055 - 1, wave_sizze_55055))) {\n                        barrier(CLK_LOCAL_MEM_FENCE);\n                        offset_55085 = skip_waves_55086 * wave_sizze_55055;\n                        if (slt32(local_tid_55053 + offset_55085, sext_i64_i32(segred_tblock_sizze_46389)) && ((local_tid_55053 - squot32(local_tid_55053, wave_sizze_55055) * wave_sizze_55055) == 0 && (squot32(local_tid_55053, wave_sizze_55055) & (2 * skip_waves_55086 - 1)) == 0)) {\n                            // read array element\n                            {\n                                eta_p_55071 = ((__local bool *) red_arr_bool_mem_55057)[sext_i32_i64(local_tid_55053 + offset_55085)];\n                            }\n                            // apply reduction operation\n                            {\n                                bool defunc_0_op_res_55072 = eta_p_55070 || eta_p_55071;\n                                \n                                eta_p_55070 = defunc_0_op_res_55072;\n                            }\n                            // write result of operation\n                            {\n                                ((__local bool *) red_arr_bool_mem_55057)[sext_i32_i64(local_tid_55053)] = eta_p_55070;\n                            }\n                        }\n                        skip_waves_55086 *= 2;\n                    }\n                    barrier(CLK_LOCAL_MEM_FENCE);\n                    // and back to memory with the final result\n                    {\n                 ", "       if (local_tid_55053 == 0) {\n                            ((__global bool *) mem_53597)[gtid_46393] = eta_p_55070;\n                        }\n                    }\n                }\n            }\n        }\n        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    }\n    \n  error_6:\n    return;\n    #undef segred_tblock_sizze_46389\n    #undef chunk_sizze_55015\n}\nFUTHARK_KERNEL_SIZED(add_next_partition_doublezisegred_large_46644_dim1, 1, 1)\nvoid add_next_partition_doublezisegred_large_46644(__global int *global_failure, int failure_is_an_option, __global int64_t *global_failure_args, int64_t n_new_28422, double zt_res_40980, int64_t num_tblocks_46639, int64_t blocks_per_segment_55575, int64_t q_55576, int64_t num_virtblocks_55577, int64_t threads_per_segment_55578, __global unsigned char *clBase_mem_53509, __global unsigned char *clBase_mem_53510, __global unsigned char *clBase_mem_53511, __global unsigned char *new_xs_mem_53533, __global unsigned char *new_ys_mem_53534, __global unsigned char *mem_53582, __global unsigned char *mem_53672, __global unsigned char *segred_tmp_mem_55579, __global unsigned char *counters_mem_55581)\n{\n    #define segred_tblock_sizze_46638 (add_next_partition_doublezisegred_large_46644zisegred_tblock_sizze_46638)\n    #define chunk_sizze_55546 (add_next_partition_doublezisegred_large_46644zichunk_sizze_55546)\n    \n    volatile __local unsigned char *sync_arr_mem_55590_backing_1 = &shared_mem[0];\n    const int64_t sync_arr_mem_55590_backing_1_offset = 0 + 8;\n    volatile __local unsigned char *red_arr_bool_mem_55588_backing_0 = &shared_mem[sync_arr_mem_55590_backing_1_offset];\n    const int64_t red_arr_bool_mem_55588_backing_0_offset = sync_arr_mem_55590_backing_1_offset + (segred_tblock_sizze_46638 + srem64((int64_t) 8 - srem64(segred_tblock_sizze_46638, (int64_t) 8), (int64_t) 8));\n    volatile __local int local_failure;\n    \n    if (failure_is_an_option) {\n        int failed = *global_failure >= 0;\n        \n        if (failed)\n   ",
                                    "         return;\n    }\n    local_failure = 0;\n    barrier(CLK_LOCAL_MEM_FENCE);\n    \n    int32_t local_tid_55584;\n    int32_t tblock_sizze_55587;\n    int32_t wave_sizze_55586;\n    int32_t block_id_55585;\n    int32_t global_tid_55583;\n    int64_t phys_tid_46644;\n    __local unsigned char *red_arr_bool_mem_55588;\n    __local unsigned char *sync_arr_mem_55590;\n    int32_t phys_tblock_id_55592;\n    int32_t iterations_55593;\n    \n    local_tid_55584 = get_local_id(0);\n    tblock_sizze_55587 = get_local_size(0);\n    wave_sizze_55586 = LOCKSTEP_WIDTH;\n    block_id_55585 = get_tblock_id(0);\n    global_tid_55583 = block_id_55585 * tblock_sizze_55587 + local_tid_55584;\n    phys_tid_46644 = sext_i32_i64(global_tid_55583);\n    red_arr_bool_mem_55588 = (__local unsigned char *) red_arr_bool_mem_55588_backing_0;\n    sync_arr_mem_55590 = (__local unsigned char *) sync_arr_mem_55590_backing_1;\n    phys_tblock_id_55592 = get_tblock_id(0);\n    iterations_55593 = sdiv_up32(sext_i64_i32(num_virtblocks_55577) - phys_tblock_id_55592, sext_i64_i32(num_tblocks_46639));\n    for (int32_t i_55594 = 0; i_55594 < iterations_55593; i_55594++) {\n        int32_t virt_tblock_id_55595;\n        int64_t flat_segment_id_55596;\n        int64_t global_tid_55597;\n        int64_t slice_55598;\n        int64_t gtid_46642;\n        int64_t remnant_55599;\n        int64_t gtid_46643;\n        bool eta_p_block_res_acc_55600;\n        bool eta_p_46645;\n        bool eta_p_46646;\n        int64_t tblock_id_in_segment_55604;\n        int64_t block_base_offset_55605;\n        int32_t offset_55608;\n        int32_t skip_waves_55609;\n        bool eta_p_55601;\n        bool eta_p_55602;\n        \n        virt_tblock_id_55595 = phys_tblock_id_55592 + i_55594 * sext_i64_i32(num_tblocks_46639);\n        flat_segment_id_55596 = squot64(sext_i32_i64(virt_tblock_id_55595), blocks_per_segment_55575);\n        global_tid_55597 = srem64(sext_i32_i64(virt_tblock_id_55595) * segred_tblock_sizze_46638 + sext_i32_i64(local_tid_55584), threads_", "per_segment_55578);\n        slice_55598 = n_new_28422;\n        gtid_46642 = flat_segment_id_55596;\n        remnant_55599 = flat_segment_id_55596 - gtid_46642;\n        // ne-initialise the outer (per-block) accumulator(s)\n        {\n            eta_p_block_res_acc_55600 = 0;\n        }\n        tblock_id_in_segment_55604 = squot64(global_tid_55597, segred_tblock_sizze_46638);\n        block_base_offset_55605 = tblock_id_in_segment_55604 * q_55576 * segred_tblock_sizze_46638;\n        for (int64_t i_55606 = 0; i_55606 < q_55576; i_55606++) {\n            int64_t block_offset_55607 = block_base_offset_55605 + i_55606 * segred_tblock_sizze_46638;\n            \n            gtid_46643 = global_tid_55597 + threads_per_segment_55578 * i_55606;\n            if (slt64(gtid_46643, (int64_t) 8)) {\n                // apply map function(s)\n                {\n                    // apply map function\n                    {\n                        int64_t eta_p_46650 = ((__global int64_t *) mem_53582)[gtid_46643];\n                        bool cond_46651 = slt64(eta_p_46650, (int64_t) 0);\n                        bool lifted_lambda_res_46652;\n                        \n                        if (cond_46651) {\n                            lifted_lambda_res_46652 = 0;\n                        } else {\n                            int64_t zv_rhs_46653 = ((__global int64_t *) clBase_mem_53510)[(int64_t) 0];\n                            bool zzero_46654 = zv_rhs_46653 == (int64_t) 0;\n                            bool nonzzero_46655 = !zzero_46654;\n                            bool nonzzero_cert_46656;\n                            \n                            if (!nonzzero_46655) {\n                                {\n                                    if (atomic_cmpxchg_i32_global(global_failure, -1, 13) == -1) {\n                                        ;\n                                    }\n                                    local_failure = 1;\n                                    goto error_0;\n             ", "                   }\n                            }\n                            \n                            double eta_p_46648 = ((__global double *) new_xs_mem_53533)[gtid_46642];\n                            double eta_p_46649 = ((__global double *) new_ys_mem_53534)[gtid_46642];\n                            int64_t nxid_46657 = smod64(eta_p_46650, zv_rhs_46653);\n                            int64_t nyid_46658 = sdiv64(eta_p_46650, zv_rhs_46653);\n                            double times_arg1_46659 = ((__global double *) clBase_mem_53511)[(int64_t) 0];\n                            double i64_res_46660 = sitofp_i64_f64(nxid_46657);\n                            double zt_res_46661 = times_arg1_46659 * i64_res_46660;\n                            double plus_arg0_46662 = ((__global double *) clBase_mem_53509)[(int64_t) 0];\n                            double zp_res_46663 = zt_res_46661 + plus_arg0_46662;\n                            double times_arg1_46664 = ((__global double *) clBase_mem_53511)[(int64_t) 1];\n                            double i64_res_46665 = sitofp_i64_f64(nyid_46658);\n                            double zt_res_46666 = times_arg1_46664 * i64_res_46665;\n                            double plus_arg0_46667 = ((__global double *) clBase_mem_53509)[(int64_t) 1];\n                            double zp_res_46668 = zt_res_46666 + plus_arg0_46667;\n                            double zp_res_46669 = times_arg1_46659 + zp_res_46663;\n                            double zp_res_46670 = times_arg1_46664 + zp_res_46668;\n                            double zm_res_46671 = zp_res_46663 - zt_res_40980;\n                            bool zgze_res_46672 = zm_res_46671 <= eta_p_46648;\n                            double zp_res_46673 = zt_res_40980 + zp_res_46669;\n                            bool zlze_res_46674 = eta_p_46648 <= zp_res_46673;\n                            bool x_46675 = zgze_res_46672 && zlze_res_46674;\n                            double zm_res_46676 = zp_res_46668 - zt_res_409",
                                    "80;\n                            bool zgze_res_46677 = zm_res_46676 <= eta_p_46649;\n                            double zp_res_46678 = zt_res_40980 + zp_res_46670;\n                            bool zlze_res_46679 = eta_p_46649 <= zp_res_46678;\n                            bool x_46680 = zgze_res_46677 && zlze_res_46679;\n                            bool x_46681 = x_46675 && x_46680;\n                            \n                            lifted_lambda_res_46652 = x_46681;\n                        }\n                        // load accumulator(s)\n                        {\n                            eta_p_46645 = eta_p_block_res_acc_55600;\n                        }\n                        // load next value(s)\n                        {\n                            eta_p_46646 = lifted_lambda_res_46652;\n                        }\n                        // apply reduction operator(s)\n                        {\n                            bool defunc_0_op_res_46647 = eta_p_46645 || eta_p_46646;\n                            \n                            // store in accumulator(s)\n                            {\n                                eta_p_block_res_acc_55600 = defunc_0_op_res_46647;\n                            }\n                        }\n                    }\n                }\n            }\n        }\n        \n      error_0:\n        barrier(CLK_LOCAL_MEM_FENCE);\n        if (local_failure)\n            return;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        // store accs. prims go in lmem; non-prims in params (in global mem)\n        {\n            ((__local bool *) red_arr_bool_mem_55588)[sext_i32_i64(local_tid_55584)] = eta_p_block_res_acc_55600;\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        skip_waves_55609 = 1;\n        offset_55608 = 0;\n        // participating threads read initial accumulator\n        {\n            if (slt32(local_tid_55584, sext_i64_i32(segred_tblock_sizze_46638))) {\n                eta_p_55601 = ((__local bool *) red_arr_bool_mem_55588)[sext_i32_i", "64(local_tid_55584 + offset_55608)];\n            }\n        }\n        offset_55608 = 1;\n        while (slt32(offset_55608, wave_sizze_55586)) {\n            if (slt32(local_tid_55584 + offset_55608, sext_i64_i32(segred_tblock_sizze_46638)) && ((local_tid_55584 - squot32(local_tid_55584, wave_sizze_55586) * wave_sizze_55586) & (2 * offset_55608 - 1)) == 0) {\n                // read array element\n                {\n                    eta_p_55602 = ((volatile __local bool *) red_arr_bool_mem_55588)[sext_i32_i64(local_tid_55584 + offset_55608)];\n                }\n                // apply reduction operation\n                {\n                    bool defunc_0_op_res_55603 = eta_p_55601 || eta_p_55602;\n                    \n                    eta_p_55601 = defunc_0_op_res_55603;\n                }\n                // write result of operation\n                {\n                    ((volatile __local bool *) red_arr_bool_mem_55588)[sext_i32_i64(local_tid_55584)] = eta_p_55601;\n                }\n            }\n            offset_55608 *= 2;\n        }\n        while (slt32(skip_waves_55609, squot32(sext_i64_i32(segred_tblock_sizze_46638) + wave_sizze_55586 - 1, wave_sizze_55586))) {\n            barrier(CLK_LOCAL_MEM_FENCE);\n            offset_55608 = skip_waves_55609 * wave_sizze_55586;\n            if (slt32(local_tid_55584 + offset_55608, sext_i64_i32(segred_tblock_sizze_46638)) && ((local_tid_55584 - squot32(local_tid_55584, wave_sizze_55586) * wave_sizze_55586) == 0 && (squot32(local_tid_55584, wave_sizze_55586) & (2 * skip_waves_55609 - 1)) == 0)) {\n                // read array element\n                {\n                    eta_p_55602 = ((__local bool *) red_arr_bool_mem_55588)[sext_i32_i64(local_tid_55584 + offset_55608)];\n                }\n                // apply reduction operation\n                {\n                    bool defunc_0_op_res_55603 = eta_p_55601 || eta_p_55602;\n                    \n                    eta_p_55601 = defunc_0_op_res_55603;\n                }\n   ", "             // write result of operation\n                {\n                    ((__local bool *) red_arr_bool_mem_55588)[sext_i32_i64(local_tid_55584)] = eta_p_55601;\n                }\n            }\n            skip_waves_55609 *= 2;\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        barrier(CLK_LOCAL_MEM_FENCE);\n        // thread 0 updates per-block acc(s); rest reset to ne\n        {\n            if (sext_i32_i64(local_tid_55584) == (int64_t) 0) {\n                eta_p_block_res_acc_55600 = eta_p_55601;\n            } else {\n                eta_p_block_res_acc_55600 = 0;\n            }\n        }\n        if (blocks_per_segment_55575 == (int64_t) 1) {\n            // first thread in block saves final result to memory\n            {\n                if (local_tid_55584 == 0) {\n                    ((__global bool *) mem_53672)[gtid_46642] = eta_p_block_res_acc_55600;\n                }\n            }\n        } else {\n            int32_t old_counter_55610;\n            bool is_last_block_55611;\n            \n            // first thread in block saves block result to global memory\n            {\n                if (local_tid_55584 == 0) {\n                    ((__global bool *) segred_tmp_mem_55579)[sext_i32_i64(virt_tblock_id_55595)] = eta_p_block_res_acc_55600;\n                    mem_fence_global();\n                    old_counter_55610 = atomic_add_i32_global(&((volatile __global int *) counters_mem_55581)[srem64(flat_segment_id_55596, (int64_t) 20480)], (int) 1);\n                    ((__local bool *) sync_arr_mem_55590)[(int64_t) 0] = old_counter_55610 == sext_i64_i32(blocks_per_segment_55575 - (int64_t) 1);\n                }\n            }\n            barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n            is_last_block_55611 = ((__local bool *) sync_arr_mem_55590)[(int64_t) 0];\n            if (is_last_block_55611) {\n                if (local_tid_55584 == 0) {\n                    old_counter_55610 = atomic_add_i32_global(&((volatile __global int *) counters_mem_5",
                                    "5581)[srem64(flat_segment_id_55596, (int64_t) 20480)], (int) sext_i64_i32((int64_t) 0 - blocks_per_segment_55575));\n                }\n                // read in the per-block-results\n                {\n                    int64_t read_per_thread_55612 = sdiv_up64(blocks_per_segment_55575, segred_tblock_sizze_46638);\n                    \n                    eta_p_46645 = 0;\n                    for (int64_t i_55613 = 0; i_55613 < read_per_thread_55612; i_55613++) {\n                        int64_t block_res_id_55614 = sext_i32_i64(local_tid_55584) * read_per_thread_55612 + i_55613;\n                        int64_t index_of_block_res_55615 = flat_segment_id_55596 * blocks_per_segment_55575 + block_res_id_55614;\n                        \n                        if (slt64(block_res_id_55614, blocks_per_segment_55575)) {\n                            eta_p_46646 = ((__global bool *) segred_tmp_mem_55579)[index_of_block_res_55615];\n                            \n                            bool defunc_0_op_res_46647 = eta_p_46645 || eta_p_46646;\n                            \n                            eta_p_46645 = defunc_0_op_res_46647;\n                        }\n                    }\n                }\n                ((__local bool *) red_arr_bool_mem_55588)[sext_i32_i64(local_tid_55584)] = eta_p_46645;\n                barrier(CLK_LOCAL_MEM_FENCE);\n                // reduce the per-block results\n                {\n                    int32_t offset_55616;\n                    int32_t skip_waves_55617 = 1;\n                    bool eta_p_55601;\n                    bool eta_p_55602;\n                    \n                    offset_55616 = 0;\n                    // participating threads read initial accumulator\n                    {\n                        if (slt32(local_tid_55584, sext_i64_i32(segred_tblock_sizze_46638))) {\n                            eta_p_55601 = ((__local bool *) red_arr_bool_mem_55588)[sext_i32_i64(local_tid_55584 + offset_55616)];\n                        }\n      ", "              }\n                    offset_55616 = 1;\n                    while (slt32(offset_55616, wave_sizze_55586)) {\n                        if (slt32(local_tid_55584 + offset_55616, sext_i64_i32(segred_tblock_sizze_46638)) && ((local_tid_55584 - squot32(local_tid_55584, wave_sizze_55586) * wave_sizze_55586) & (2 * offset_55616 - 1)) == 0) {\n                            // read array element\n                            {\n                                eta_p_55602 = ((volatile __local bool *) red_arr_bool_mem_55588)[sext_i32_i64(local_tid_55584 + offset_55616)];\n                            }\n                            // apply reduction operation\n                            {\n                                bool defunc_0_op_res_55603 = eta_p_55601 || eta_p_55602;\n                                \n                                eta_p_55601 = defunc_0_op_res_55603;\n                            }\n                            // write result of operation\n                            {\n                                ((volatile __local bool *) red_arr_bool_mem_55588)[sext_i32_i64(local_tid_55584)] = eta_p_55601;\n                            }\n                        }\n                        offset_55616 *= 2;\n                    }\n                    while (slt32(skip_waves_55617, squot32(sext_i64_i32(segred_tblock_sizze_46638) + wave_sizze_55586 - 1, wave_sizze_55586))) {\n                        barrier(CLK_LOCAL_MEM_FENCE);\n                        offset_55616 = skip_waves_55617 * wave_sizze_55586;\n                        if (slt32(local_tid_55584 + offset_55616, sext_i64_i32(segred_tblock_sizze_46638)) && ((local_tid_55584 - squot32(local_tid_55584, wave_sizze_55586) * wave_sizze_55586) == 0 && (squot32(local_tid_55584, wave_sizze_55586) & (2 * skip_waves_55617 - 1)) == 0)) {\n                            // read array element\n                            {\n                                eta_p_55602 = ((__local bool *) red_arr_bool_mem_55588)[sext_i32_i64(local_tid_55", "584 + offset_55616)];\n                            }\n                            // apply reduction operation\n                            {\n                                bool defunc_0_op_res_55603 = eta_p_55601 || eta_p_55602;\n                                \n                                eta_p_55601 = defunc_0_op_res_55603;\n                            }\n                            // write result of operation\n                            {\n                                ((__local bool *) red_arr_bool_mem_55588)[sext_i32_i64(local_tid_55584)] = eta_p_55601;\n                            }\n                        }\n                        skip_waves_55617 *= 2;\n                    }\n                    barrier(CLK_LOCAL_MEM_FENCE);\n                    // and back to memory with the final result\n                    {\n                        if (local_tid_55584 == 0) {\n                            ((__global bool *) mem_53672)[gtid_46642] = eta_p_55601;\n                        }\n                    }\n                }\n            }\n        }\n        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    }\n    \n  error_6:\n    return;\n    #undef segred_tblock_sizze_46638\n    #undef chunk_sizze_55546\n}\nFUTHARK_KERNEL_SIZED(add_next_partition_doublezisegred_small_46395_dim1, 1, 1)\nvoid add_next_partition_doublezisegred_small_46395(__global int *global_failure, int64_t dz2083U_28419, int64_t num_tblocks_46390, int64_t segment_sizze_nonzzero_55016, __global unsigned char *clProc_mem_53517, __global unsigned char *mem_53582, __global unsigned char *mem_53597)\n{\n    #define segred_tblock_sizze_46389 (add_next_partition_doublezisegred_small_46395zisegred_tblock_sizze_46389)\n    \n    volatile __local unsigned char *red_arr_bool_mem_55023_backing_0 = &shared_mem[0];\n    const int64_t red_arr_bool_mem_55023_backing_0_offset = 0 + (segred_tblock_sizze_46389 + srem64((int64_t) 8 - srem64(segred_tblock_sizze_46389, (int64_t) 8), (int64_t) 8));\n    \n    if (*global_failure >= 0)\n   ",
                                    "     return;\n    \n    int32_t local_tid_55019;\n    int32_t tblock_sizze_55022;\n    int32_t wave_sizze_55021;\n    int32_t block_id_55020;\n    int32_t global_tid_55018;\n    int64_t phys_tid_46395;\n    __local unsigned char *red_arr_bool_mem_55023;\n    int32_t phys_tblock_id_55025;\n    int32_t iterations_55026;\n    \n    local_tid_55019 = get_local_id(0);\n    tblock_sizze_55022 = get_local_size(0);\n    wave_sizze_55021 = LOCKSTEP_WIDTH;\n    block_id_55020 = get_tblock_id(0);\n    global_tid_55018 = block_id_55020 * tblock_sizze_55022 + local_tid_55019;\n    phys_tid_46395 = sext_i32_i64(global_tid_55018);\n    red_arr_bool_mem_55023 = (__local unsigned char *) red_arr_bool_mem_55023_backing_0;\n    phys_tblock_id_55025 = get_tblock_id(0);\n    iterations_55026 = sdiv_up32(sext_i64_i32(sdiv_up64((int64_t) 8, squot64(segred_tblock_sizze_46389, segment_sizze_nonzzero_55016))) - phys_tblock_id_55025, sext_i64_i32(num_tblocks_46390));\n    for (int32_t i_55027 = 0; i_55027 < iterations_55026; i_55027++) {\n        int32_t virt_tblock_id_55028;\n        int64_t slice_55029;\n        int64_t gtid_46393;\n        int64_t remnant_55030;\n        int64_t gtid_46394;\n        \n        virt_tblock_id_55028 = phys_tblock_id_55025 + i_55027 * sext_i64_i32(num_tblocks_46390);\n        slice_55029 = (int64_t) 8;\n        gtid_46393 = squot64(sext_i32_i64(local_tid_55019), segment_sizze_nonzzero_55016) + sext_i32_i64(virt_tblock_id_55028) * squot64(segred_tblock_sizze_46389, segment_sizze_nonzzero_55016);\n        remnant_55030 = squot64(sext_i32_i64(local_tid_55019), segment_sizze_nonzzero_55016) + sext_i32_i64(virt_tblock_id_55028) * squot64(segred_tblock_sizze_46389, segment_sizze_nonzzero_55016) - gtid_46393;\n        gtid_46394 = srem64(sext_i32_i64(local_tid_55019), dz2083U_28419);\n        // apply map function if in bounds\n        {\n            if (slt64((int64_t) 0, dz2083U_28419) && (slt64(gtid_46393, (int64_t) 8) && slt64(sext_i32_i64(local_tid_55019), dz2083U_28419 * squot64(segred_tblock_si", "zze_46389, segment_sizze_nonzzero_55016)))) {\n                // apply map function\n                {\n                    int64_t eta_p_46399 = ((__global int64_t *) mem_53582)[gtid_46393];\n                    int64_t eta_p_46400 = ((__global int64_t *) clProc_mem_53517)[gtid_46394];\n                    bool lifted_lambda_res_46401 = eta_p_46400 == eta_p_46399;\n                    \n                    // save results to be reduced\n                    {\n                        ((__local bool *) red_arr_bool_mem_55023)[sext_i32_i64(local_tid_55019)] = lifted_lambda_res_46401;\n                    }\n                }\n            } else {\n                ((__local bool *) red_arr_bool_mem_55023)[sext_i32_i64(local_tid_55019)] = 0;\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        if (slt64((int64_t) 0, dz2083U_28419)) {\n            // perform segmented scan to imitate reduction\n            {\n                bool eta_p_46396;\n                bool eta_p_46397;\n                bool eta_p_55031;\n                bool eta_p_55032;\n                bool ltid_in_bounds_55034 = slt64(sext_i32_i64(local_tid_55019), dz2083U_28419 * squot64(segred_tblock_sizze_46389, segment_sizze_nonzzero_55016));\n                int32_t skip_threads_55035;\n                \n                // read input for in-block scan\n                {\n                    if (ltid_in_bounds_55034) {\n                        eta_p_46397 = ((volatile __local bool *) red_arr_bool_mem_55023)[sext_i32_i64(local_tid_55019)];\n                        if ((local_tid_55019 - squot32(local_tid_55019, 32) * 32) == 0) {\n                            eta_p_46396 = eta_p_46397;\n                        }\n                    }\n                }\n                // in-block scan (hopefully no barriers needed)\n                {\n                    skip_threads_55035 = 1;\n                    while (slt32(skip_threads_55035, 32)) {\n                        bool thread_active_55036 = sle32(skip_threads_55035, local_tid_", "55019 - squot32(local_tid_55019, 32) * 32) && ltid_in_bounds_55034;\n                        \n                        if (thread_active_55036) {\n                            // read operands\n                            {\n                                eta_p_46396 = ((volatile __local bool *) red_arr_bool_mem_55023)[sext_i32_i64(local_tid_55019) - sext_i32_i64(skip_threads_55035)];\n                            }\n                        }\n                        // perform operation\n                        {\n                            bool inactive_55037 = slt64(srem64(sext_i32_i64(local_tid_55019), dz2083U_28419), sext_i32_i64(local_tid_55019) - sext_i32_i64(local_tid_55019 - skip_threads_55035));\n                            \n                            if (thread_active_55036 && inactive_55037) {\n                                eta_p_46396 = eta_p_46397;\n                            }\n                            if (thread_active_55036) {\n                                if (!inactive_55037) {\n                                    bool defunc_0_op_res_46398 = eta_p_46396 || eta_p_46397;\n                                    \n                                    eta_p_46396 = defunc_0_op_res_46398;\n                                }\n                            }\n                        }\n                        if (sle32(wave_sizze_55021, skip_threads_55035)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        if (thread_active_55036) {\n                            // write result\n                            {\n                                ((volatile __local bool *) red_arr_bool_mem_55023)[sext_i32_i64(local_tid_55019)] = eta_p_46396;\n                                eta_p_46397 = eta_p_46396;\n                            }\n                        }\n                        if (sle32(wave_sizze_55021, skip_threads_55035)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n              ",
                                    "          skip_threads_55035 *= 2;\n                    }\n                }\n                barrier(CLK_LOCAL_MEM_FENCE);\n                // last thread of block 'i' writes its result to offset 'i'\n                {\n                    if ((local_tid_55019 - squot32(local_tid_55019, 32) * 32) == 31 && ltid_in_bounds_55034) {\n                        ((volatile __local bool *) red_arr_bool_mem_55023)[sext_i32_i64(squot32(local_tid_55019, 32))] = eta_p_46396;\n                    }\n                }\n                barrier(CLK_LOCAL_MEM_FENCE);\n                // scan the first block, after which offset 'i' contains carry-in for block 'i+1'\n                {\n                    int32_t skip_threads_55038;\n                    \n                    // read input for in-block scan\n                    {\n                        if (squot32(local_tid_55019, 32) == 0 && ltid_in_bounds_55034) {\n                            eta_p_55032 = ((volatile __local bool *) red_arr_bool_mem_55023)[sext_i32_i64(local_tid_55019)];\n                            if ((local_tid_55019 - squot32(local_tid_55019, 32) * 32) == 0) {\n                                eta_p_55031 = eta_p_55032;\n                            }\n                        }\n                    }\n                    // in-block scan (hopefully no barriers needed)\n                    {\n                        skip_threads_55038 = 1;\n                        while (slt32(skip_threads_55038, 32)) {\n                            bool thread_active_55039 = sle32(skip_threads_55038, local_tid_55019 - squot32(local_tid_55019, 32) * 32) && (squot32(local_tid_55019, 32) == 0 && ltid_in_bounds_55034);\n                            \n                            if (thread_active_55039) {\n                                // read operands\n                                {\n                                    eta_p_55031 = ((volatile __local bool *) red_arr_bool_mem_55023)[sext_i32_i64(local_tid_55019) - sext_i32_i64(skip_threads_55038)];\n               ", "                 }\n                            }\n                            // perform operation\n                            {\n                                bool inactive_55040 = slt64(srem64(sext_i32_i64(local_tid_55019 * 32 + 32 - 1), dz2083U_28419), sext_i32_i64(local_tid_55019 * 32 + 32 - 1) - sext_i32_i64((local_tid_55019 - skip_threads_55038) * 32 + 32 - 1));\n                                \n                                if (thread_active_55039 && inactive_55040) {\n                                    eta_p_55031 = eta_p_55032;\n                                }\n                                if (thread_active_55039) {\n                                    if (!inactive_55040) {\n                                        bool defunc_0_op_res_55033 = eta_p_55031 || eta_p_55032;\n                                        \n                                        eta_p_55031 = defunc_0_op_res_55033;\n                                    }\n                                }\n                            }\n                            if (sle32(wave_sizze_55021, skip_threads_55038)) {\n                                barrier(CLK_LOCAL_MEM_FENCE);\n                            }\n                            if (thread_active_55039) {\n                                // write result\n                                {\n                                    ((volatile __local bool *) red_arr_bool_mem_55023)[sext_i32_i64(local_tid_55019)] = eta_p_55031;\n                                    eta_p_55032 = eta_p_55031;\n                                }\n                            }\n                            if (sle32(wave_sizze_55021, skip_threads_55038)) {\n                                barrier(CLK_LOCAL_MEM_FENCE);\n                            }\n                            skip_threads_55038 *= 2;\n                        }\n                    }\n                }\n                barrier(CLK_LOCAL_MEM_FENCE);\n                \n                bool no_carry_in_55041 = squot32(local_tid_55019, ", "32) == 0 || !ltid_in_bounds_55034;\n                \n                // carry-in for every block except the first\n                {\n                    // read operands\n                    {\n                        if (!no_carry_in_55041) {\n                            eta_p_46397 = eta_p_46396;\n                            eta_p_46396 = ((__local bool *) red_arr_bool_mem_55023)[sext_i32_i64(squot32(local_tid_55019, 32)) - (int64_t) 1];\n                        }\n                    }\n                    // perform operation\n                    {\n                        bool inactive_55042 = slt64(srem64(sext_i32_i64(local_tid_55019), dz2083U_28419), sext_i32_i64(local_tid_55019) - sext_i32_i64(squot32(local_tid_55019, 32) * 32 - 1));\n                        \n                        if (!no_carry_in_55041) {\n                            if (inactive_55042) {\n                                eta_p_46396 = eta_p_46397;\n                            }\n                        }\n                        if (!no_carry_in_55041) {\n                            if (!inactive_55042) {\n                                bool defunc_0_op_res_46398 = eta_p_46396 || eta_p_46397;\n                                \n                                eta_p_46396 = defunc_0_op_res_46398;\n                            }\n                        }\n                    }\n                    // write final result\n                    {\n                        if (!no_carry_in_55041) {\n                            ((__local bool *) red_arr_bool_mem_55023)[sext_i32_i64(local_tid_55019)] = eta_p_46396;\n                        }\n                    }\n                }\n                barrier(CLK_LOCAL_MEM_FENCE);\n                // restore correct values for first block\n                {\n                    if (squot32(local_tid_55019, 32) == 0 && ltid_in_bounds_55034) {\n                        ((__local bool *) red_arr_bool_mem_55023)[sext_i32_i64(local_tid_55019)] = eta_p_46397;\n                    }\n            ",
                                    "    }\n                barrier(CLK_LOCAL_MEM_FENCE);\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        // save final values of segments\n        {\n            if (slt64(sext_i32_i64(virt_tblock_id_55028) * squot64(segred_tblock_sizze_46389, segment_sizze_nonzzero_55016) + sext_i32_i64(local_tid_55019), (int64_t) 8) && slt64(sext_i32_i64(local_tid_55019), squot64(segred_tblock_sizze_46389, segment_sizze_nonzzero_55016))) {\n                bool tmp_55043 = ((__local bool *) red_arr_bool_mem_55023)[(sext_i32_i64(local_tid_55019) + (int64_t) 1) * segment_sizze_nonzzero_55016 - (int64_t) 1];\n                \n                ((__global bool *) mem_53597)[sext_i32_i64(virt_tblock_id_55028) * squot64(segred_tblock_sizze_46389, segment_sizze_nonzzero_55016) + sext_i32_i64(local_tid_55019)] = tmp_55043;\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    }\n    \n  error_3:\n    return;\n    #undef segred_tblock_sizze_46389\n}\nFUTHARK_KERNEL_SIZED(add_next_partition_doublezisegred_small_46644_dim1, 1, 1)\nvoid add_next_partition_doublezisegred_small_46644(__global int *global_failure, int failure_is_an_option, __global int64_t *global_failure_args, int64_t n_new_28422, double zt_res_40980, int64_t num_tblocks_46639, int64_t segment_sizze_nonzzero_55547, __global unsigned char *clBase_mem_53509, __global unsigned char *clBase_mem_53510, __global unsigned char *clBase_mem_53511, __global unsigned char *new_xs_mem_53533, __global unsigned char *new_ys_mem_53534, __global unsigned char *mem_53582, __global unsigned char *mem_53672)\n{\n    #define segred_tblock_sizze_46638 (add_next_partition_doublezisegred_small_46644zisegred_tblock_sizze_46638)\n    \n    volatile __local unsigned char *red_arr_bool_mem_55554_backing_0 = &shared_mem[0];\n    const int64_t red_arr_bool_mem_55554_backing_0_offset = 0 + (segred_tblock_sizze_46638 + srem64((int64_t) 8 - srem64(segred_tblock_sizze_46638, (int64_t) 8), ", "(int64_t) 8));\n    volatile __local int local_failure;\n    \n    if (failure_is_an_option) {\n        int failed = *global_failure >= 0;\n        \n        if (failed)\n            return;\n    }\n    local_failure = 0;\n    barrier(CLK_LOCAL_MEM_FENCE);\n    \n    int32_t local_tid_55550;\n    int32_t tblock_sizze_55553;\n    int32_t wave_sizze_55552;\n    int32_t block_id_55551;\n    int32_t global_tid_55549;\n    int64_t phys_tid_46644;\n    __local unsigned char *red_arr_bool_mem_55554;\n    int32_t phys_tblock_id_55556;\n    int32_t iterations_55557;\n    \n    local_tid_55550 = get_local_id(0);\n    tblock_sizze_55553 = get_local_size(0);\n    wave_sizze_55552 = LOCKSTEP_WIDTH;\n    block_id_55551 = get_tblock_id(0);\n    global_tid_55549 = block_id_55551 * tblock_sizze_55553 + local_tid_55550;\n    phys_tid_46644 = sext_i32_i64(global_tid_55549);\n    red_arr_bool_mem_55554 = (__local unsigned char *) red_arr_bool_mem_55554_backing_0;\n    phys_tblock_id_55556 = get_tblock_id(0);\n    iterations_55557 = sdiv_up32(sext_i64_i32(sdiv_up64(n_new_28422, squot64(segred_tblock_sizze_46638, segment_sizze_nonzzero_55547))) - phys_tblock_id_55556, sext_i64_i32(num_tblocks_46639));\n    for (int32_t i_55558 = 0; i_55558 < iterations_55557; i_55558++) {\n        int32_t virt_tblock_id_55559;\n        int64_t slice_55560;\n        int64_t gtid_46642;\n        int64_t remnant_55561;\n        int64_t gtid_46643;\n        \n        virt_tblock_id_55559 = phys_tblock_id_55556 + i_55558 * sext_i64_i32(num_tblocks_46639);\n        slice_55560 = n_new_28422;\n        gtid_46642 = squot64(sext_i32_i64(local_tid_55550), segment_sizze_nonzzero_55547) + sext_i32_i64(virt_tblock_id_55559) * squot64(segred_tblock_sizze_46638, segment_sizze_nonzzero_55547);\n        remnant_55561 = squot64(sext_i32_i64(local_tid_55550), segment_sizze_nonzzero_55547) + sext_i32_i64(virt_tblock_id_55559) * squot64(segred_tblock_sizze_46638, segment_sizze_nonzzero_55547) - gtid_46642;\n        gtid_46643 = srem64(sext_i32_i64(local_tid_55550), ", "(int64_t) 8);\n        // apply map function if in bounds\n        {\n            if (slt64((int64_t) 0, (int64_t) 8) && (slt64(gtid_46642, n_new_28422) && slt64(sext_i32_i64(local_tid_55550), (int64_t) 8 * squot64(segred_tblock_sizze_46638, segment_sizze_nonzzero_55547)))) {\n                // apply map function\n                {\n                    int64_t eta_p_46650 = ((__global int64_t *) mem_53582)[gtid_46643];\n                    bool cond_46651 = slt64(eta_p_46650, (int64_t) 0);\n                    bool lifted_lambda_res_46652;\n                    \n                    if (cond_46651) {\n                        lifted_lambda_res_46652 = 0;\n                    } else {\n                        int64_t zv_rhs_46653 = ((__global int64_t *) clBase_mem_53510)[(int64_t) 0];\n                        bool zzero_46654 = zv_rhs_46653 == (int64_t) 0;\n                        bool nonzzero_46655 = !zzero_46654;\n                        bool nonzzero_cert_46656;\n                        \n                        if (!nonzzero_46655) {\n                            {\n                                if (atomic_cmpxchg_i32_global(global_failure, -1, 12) == -1) {\n                                    ;\n                                }\n                                local_failure = 1;\n                                goto error_0;\n                            }\n                        }\n                        \n                        double eta_p_46648 = ((__global double *) new_xs_mem_53533)[gtid_46642];\n                        double eta_p_46649 = ((__global double *) new_ys_mem_53534)[gtid_46642];\n                        int64_t nxid_46657 = smod64(eta_p_46650, zv_rhs_46653);\n                        int64_t nyid_46658 = sdiv64(eta_p_46650, zv_rhs_46653);\n                        double times_arg1_46659 = ((__global double *) clBase_mem_53511)[(int64_t) 0];\n                        double i64_res_46660 = sitofp_i64_f64(nxid_46657);\n                        double zt_res_46661 = times_arg1_4",
                                    "6659 * i64_res_46660;\n                        double plus_arg0_46662 = ((__global double *) clBase_mem_53509)[(int64_t) 0];\n                        double zp_res_46663 = zt_res_46661 + plus_arg0_46662;\n                        double times_arg1_46664 = ((__global double *) clBase_mem_53511)[(int64_t) 1];\n                        double i64_res_46665 = sitofp_i64_f64(nyid_46658);\n                        double zt_res_46666 = times_arg1_46664 * i64_res_46665;\n                        double plus_arg0_46667 = ((__global double *) clBase_mem_53509)[(int64_t) 1];\n                        double zp_res_46668 = zt_res_46666 + plus_arg0_46667;\n                        double zp_res_46669 = times_arg1_46659 + zp_res_46663;\n                        double zp_res_46670 = times_arg1_46664 + zp_res_46668;\n                        double zm_res_46671 = zp_res_46663 - zt_res_40980;\n                        bool zgze_res_46672 = zm_res_46671 <= eta_p_46648;\n                        double zp_res_46673 = zt_res_40980 + zp_res_46669;\n                        bool zlze_res_46674 = eta_p_46648 <= zp_res_46673;\n                        bool x_46675 = zgze_res_46672 && zlze_res_46674;\n                        double zm_res_46676 = zp_res_46668 - zt_res_40980;\n                        bool zgze_res_46677 = zm_res_46676 <= eta_p_46649;\n                        double zp_res_46678 = zt_res_40980 + zp_res_46670;\n                        bool zlze_res_46679 = eta_p_46649 <= zp_res_46678;\n                        bool x_46680 = zgze_res_46677 && zlze_res_46679;\n                        bool x_46681 = x_46675 && x_46680;\n                        \n                        lifted_lambda_res_46652 = x_46681;\n                    }\n                    // save results to be reduced\n                    {\n                        ((__local bool *) red_arr_bool_mem_55554)[sext_i32_i64(local_tid_55550)] = lifted_lambda_res_46652;\n                    }\n                }\n            } else {\n                ((__local bool *) ", "red_arr_bool_mem_55554)[sext_i32_i64(local_tid_55550)] = 0;\n            }\n        }\n        \n      error_0:\n        barrier(CLK_LOCAL_MEM_FENCE);\n        if (local_failure)\n            return;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        if (slt64((int64_t) 0, (int64_t) 8)) {\n            // perform segmented scan to imitate reduction\n            {\n                bool eta_p_46645;\n                bool eta_p_46646;\n                bool eta_p_55562;\n                bool eta_p_55563;\n                bool ltid_in_bounds_55565 = slt64(sext_i32_i64(local_tid_55550), (int64_t) 8 * squot64(segred_tblock_sizze_46638, segment_sizze_nonzzero_55547));\n                int32_t skip_threads_55566;\n                \n                // read input for in-block scan\n                {\n                    if (ltid_in_bounds_55565) {\n                        eta_p_46646 = ((volatile __local bool *) red_arr_bool_mem_55554)[sext_i32_i64(local_tid_55550)];\n                        if ((local_tid_55550 - squot32(local_tid_55550, 32) * 32) == 0) {\n                            eta_p_46645 = eta_p_46646;\n                        }\n                    }\n                }\n                // in-block scan (hopefully no barriers needed)\n                {\n                    skip_threads_55566 = 1;\n                    while (slt32(skip_threads_55566, 32)) {\n                        bool thread_active_55567 = sle32(skip_threads_55566, local_tid_55550 - squot32(local_tid_55550, 32) * 32) && ltid_in_bounds_55565;\n                        \n                        if (thread_active_55567) {\n                            // read operands\n                            {\n                                eta_p_46645 = ((volatile __local bool *) red_arr_bool_mem_55554)[sext_i32_i64(local_tid_55550) - sext_i32_i64(skip_threads_55566)];\n                            }\n                        }\n                        // perform operation\n                        {\n                            bool inactive_55568 = slt64(srem6", "4(sext_i32_i64(local_tid_55550), (int64_t) 8), sext_i32_i64(local_tid_55550) - sext_i32_i64(local_tid_55550 - skip_threads_55566));\n                            \n                            if (thread_active_55567 && inactive_55568) {\n                                eta_p_46645 = eta_p_46646;\n                            }\n                            if (thread_active_55567) {\n                                if (!inactive_55568) {\n                                    bool defunc_0_op_res_46647 = eta_p_46645 || eta_p_46646;\n                                    \n                                    eta_p_46645 = defunc_0_op_res_46647;\n                                }\n                            }\n                        }\n                        if (sle32(wave_sizze_55552, skip_threads_55566)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        if (thread_active_55567) {\n                            // write result\n                            {\n                                ((volatile __local bool *) red_arr_bool_mem_55554)[sext_i32_i64(local_tid_55550)] = eta_p_46645;\n                                eta_p_46646 = eta_p_46645;\n                            }\n                        }\n                        if (sle32(wave_sizze_55552, skip_threads_55566)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        skip_threads_55566 *= 2;\n                    }\n                }\n                barrier(CLK_LOCAL_MEM_FENCE);\n                // last thread of block 'i' writes its result to offset 'i'\n                {\n                    if ((local_tid_55550 - squot32(local_tid_55550, 32) * 32) == 31 && ltid_in_bounds_55565) {\n                        ((volatile __local bool *) red_arr_bool_mem_55554)[sext_i32_i64(squot32(local_tid_55550, 32))] = eta_p_46645;\n                    }\n                }\n                barrier(CLK_LOCAL_MEM_FENCE);\n                // scan the",
                                    " first block, after which offset 'i' contains carry-in for block 'i+1'\n                {\n                    int32_t skip_threads_55569;\n                    \n                    // read input for in-block scan\n                    {\n                        if (squot32(local_tid_55550, 32) == 0 && ltid_in_bounds_55565) {\n                            eta_p_55563 = ((volatile __local bool *) red_arr_bool_mem_55554)[sext_i32_i64(local_tid_55550)];\n                            if ((local_tid_55550 - squot32(local_tid_55550, 32) * 32) == 0) {\n                                eta_p_55562 = eta_p_55563;\n                            }\n                        }\n                    }\n                    // in-block scan (hopefully no barriers needed)\n                    {\n                        skip_threads_55569 = 1;\n                        while (slt32(skip_threads_55569, 32)) {\n                            bool thread_active_55570 = sle32(skip_threads_55569, local_tid_55550 - squot32(local_tid_55550, 32) * 32) && (squot32(local_tid_55550, 32) == 0 && ltid_in_bounds_55565);\n                            \n                            if (thread_active_55570) {\n                                // read operands\n                                {\n                                    eta_p_55562 = ((volatile __local bool *) red_arr_bool_mem_55554)[sext_i32_i64(local_tid_55550) - sext_i32_i64(skip_threads_55569)];\n                                }\n                            }\n                            // perform operation\n                            {\n                                bool inactive_55571 = slt64(srem64(sext_i32_i64(local_tid_55550 * 32 + 32 - 1), (int64_t) 8), sext_i32_i64(local_tid_55550 * 32 + 32 - 1) - sext_i32_i64((local_tid_55550 - skip_threads_55569) * 32 + 32 - 1));\n                                \n                                if (thread_active_55570 && inactive_55571) {\n                                    eta_p_55562 = eta_p_55563;\n                               ", " }\n                                if (thread_active_55570) {\n                                    if (!inactive_55571) {\n                                        bool defunc_0_op_res_55564 = eta_p_55562 || eta_p_55563;\n                                        \n                                        eta_p_55562 = defunc_0_op_res_55564;\n                                    }\n                                }\n                            }\n                            if (sle32(wave_sizze_55552, skip_threads_55569)) {\n                                barrier(CLK_LOCAL_MEM_FENCE);\n                            }\n                            if (thread_active_55570) {\n                                // write result\n                                {\n                                    ((volatile __local bool *) red_arr_bool_mem_55554)[sext_i32_i64(local_tid_55550)] = eta_p_55562;\n                                    eta_p_55563 = eta_p_55562;\n                                }\n                            }\n                            if (sle32(wave_sizze_55552, skip_threads_55569)) {\n                                barrier(CLK_LOCAL_MEM_FENCE);\n                            }\n                            skip_threads_55569 *= 2;\n                        }\n                    }\n                }\n                barrier(CLK_LOCAL_MEM_FENCE);\n                \n                bool no_carry_in_55572 = squot32(local_tid_55550, 32) == 0 || !ltid_in_bounds_55565;\n                \n                // carry-in for every block except the first\n                {\n                    // read operands\n                    {\n                        if (!no_carry_in_55572) {\n                            eta_p_46646 = eta_p_46645;\n                            eta_p_46645 = ((__local bool *) red_arr_bool_mem_55554)[sext_i32_i64(squot32(local_tid_55550, 32)) - (int64_t) 1];\n                        }\n                    }\n                    // perform operation\n                    {\n                        bo", "ol inactive_55573 = slt64(srem64(sext_i32_i64(local_tid_55550), (int64_t) 8), sext_i32_i64(local_tid_55550) - sext_i32_i64(squot32(local_tid_55550, 32) * 32 - 1));\n                        \n                        if (!no_carry_in_55572) {\n                            if (inactive_55573) {\n                                eta_p_46645 = eta_p_46646;\n                            }\n                        }\n                        if (!no_carry_in_55572) {\n                            if (!inactive_55573) {\n                                bool defunc_0_op_res_46647 = eta_p_46645 || eta_p_46646;\n                                \n                                eta_p_46645 = defunc_0_op_res_46647;\n                            }\n                        }\n                    }\n                    // write final result\n                    {\n                        if (!no_carry_in_55572) {\n                            ((__local bool *) red_arr_bool_mem_55554)[sext_i32_i64(local_tid_55550)] = eta_p_46645;\n                        }\n                    }\n                }\n                barrier(CLK_LOCAL_MEM_FENCE);\n                // restore correct values for first block\n                {\n                    if (squot32(local_tid_55550, 32) == 0 && ltid_in_bounds_55565) {\n                        ((__local bool *) red_arr_bool_mem_55554)[sext_i32_i64(local_tid_55550)] = eta_p_46646;\n                    }\n                }\n                barrier(CLK_LOCAL_MEM_FENCE);\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        // save final values of segments\n        {\n            if (slt64(sext_i32_i64(virt_tblock_id_55559) * squot64(segred_tblock_sizze_46638, segment_sizze_nonzzero_55547) + sext_i32_i64(local_tid_55550), n_new_28422) && slt64(sext_i32_i64(local_tid_55550), squot64(segred_tblock_sizze_46638, segment_sizze_nonzzero_55547))) {\n                bool tmp_55574 = ((__local bool *) red_arr_bool_mem_55554)[(sext_i32_i64(local_tid_55550) + (int64_t) 1) * segment_si",
                                    "zze_nonzzero_55547 - (int64_t) 1];\n                \n                ((__global bool *) mem_53672)[sext_i32_i64(virt_tblock_id_55559) * squot64(segred_tblock_sizze_46638, segment_sizze_nonzzero_55547) + sext_i32_i64(local_tid_55550)] = tmp_55574;\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    }\n    \n  error_3:\n    return;\n    #undef segred_tblock_sizze_46638\n}\nFUTHARK_KERNEL_SIZED(add_next_partition_doublezisegscan_46461_dim1, 1, 1)\nvoid add_next_partition_doublezisegscan_46461(__global int *global_failure, int64_t num_tblocks_46457, int64_t num_virt_blocks_55104, int64_t num_virt_threads_55105, __global unsigned char *ext_mem_53645, __global unsigned char *mem_53648, __global unsigned char *status_flags_mem_55106, __global unsigned char *aggregates_mem_55108, __global unsigned char *incprefixes_mem_55110, __global unsigned char *global_dynid_mem_55112)\n{\n    #define segscan_tblock_sizze_46456 (add_next_partition_doublezisegscan_46461zisegscan_tblock_sizze_46456)\n    #define chunk_sizze_55103 (add_next_partition_doublezisegscan_46461zichunk_sizze_55103)\n    \n    volatile __local unsigned char *local_mem_55122_backing_0 = &shared_mem[0];\n    const int64_t local_mem_55122_backing_0_offset = 0 + (smax64(smax64((int64_t) 288, (int64_t) 8 * segscan_tblock_sizze_46456), chunk_sizze_55103 * segscan_tblock_sizze_46456 * (int64_t) 8) + srem64((int64_t) 8 - srem64(smax64(smax64((int64_t) 288, (int64_t) 8 * segscan_tblock_sizze_46456), chunk_sizze_55103 * segscan_tblock_sizze_46456 * (int64_t) 8), (int64_t) 8), (int64_t) 8));\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_55115;\n    int32_t tblock_sizze_55118;\n    int32_t wave_sizze_55117;\n    int32_t block_id_55116;\n    int32_t global_tid_55114;\n    int64_t phys_tid_46461;\n    int32_t chunk_sizze_32b_55119;\n    int64_t byte_offsets_55120;\n    int64_t warp_byte_offset_55121;\n    __local unsigned char *local_mem_55122;\n", "    int64_t trans_arr_len_55123;\n    int64_t phys_block_id_55129;\n    int64_t virtloop_bound_55130;\n    \n    local_tid_55115 = get_local_id(0);\n    tblock_sizze_55118 = get_local_size(0);\n    wave_sizze_55117 = LOCKSTEP_WIDTH;\n    block_id_55116 = get_tblock_id(0);\n    global_tid_55114 = block_id_55116 * tblock_sizze_55118 + local_tid_55115;\n    phys_tid_46461 = sext_i32_i64(global_tid_55114);\n    chunk_sizze_32b_55119 = sext_i64_i32(chunk_sizze_55103);\n    byte_offsets_55120 = segscan_tblock_sizze_46456 * (int64_t) 8;\n    warp_byte_offset_55121 = (int64_t) 288;\n    // Allocate reusable shared memory\n    { }\n    local_mem_55122 = (__local unsigned char *) local_mem_55122_backing_0;\n    trans_arr_len_55123 = chunk_sizze_55103 * segscan_tblock_sizze_46456;\n    phys_block_id_55129 = get_tblock_id(0);\n    virtloop_bound_55130 = sdiv_up64(num_virt_blocks_55104 - phys_block_id_55129, num_tblocks_46457);\n    for (int64_t virtloop_i_55131 = 0; virtloop_i_55131 < virtloop_bound_55130; virtloop_i_55131++) {\n        int64_t dynamic_id_55132;\n        int64_t block_offset_55133;\n        int64_t sgm_idx_55134;\n        int32_t boundary_55135;\n        int32_t segsizze_compact_55136;\n        int64_t private_mem_55137[chunk_sizze_55103];\n        int64_t thd_offset_55139;\n        int64_t acc_55155;\n        int64_t prefix_55165;\n        bool block_new_sgm_55166;\n        \n        // First thread in block fetches this block's dynamic_id\n        {\n            if (local_tid_55115 == 0) {\n                dynamic_id_55132 = atomic_add_i32_global(&((volatile __global int *) global_dynid_mem_55112)[(int64_t) 0], (int) 1);\n                // Set dynamic id for this block\n                {\n                    ((__local int64_t *) local_mem_55122)[(int64_t) 0] = dynamic_id_55132;\n                }\n                // First thread in last (virtual) block resets global dynamic_id\n                {\n                    if (dynamic_id_55132 == num_virt_blocks_55104 - (int64_t) 1) {\n                    ", "    ((__global int32_t *) global_dynid_mem_55112)[(int64_t) 0] = 0;\n                    }\n                }\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        dynamic_id_55132 = ((__local int32_t *) local_mem_55122)[(int64_t) 0];\n        barrier(CLK_LOCAL_MEM_FENCE);\n        block_offset_55133 = dynamic_id_55132 * chunk_sizze_55103 * segscan_tblock_sizze_46456;\n        sgm_idx_55134 = smod64(block_offset_55133, (int64_t) 8);\n        boundary_55135 = sext_i64_i32(smin64(chunk_sizze_55103 * segscan_tblock_sizze_46456, (int64_t) 8 - sgm_idx_55134));\n        segsizze_compact_55136 = sext_i64_i32(smin64(chunk_sizze_55103 * segscan_tblock_sizze_46456, (int64_t) 8));\n        thd_offset_55139 = block_offset_55133 + sext_i32_i64(local_tid_55115);\n        // Load and map\n        {\n            for (int64_t i_55140 = 0; i_55140 < chunk_sizze_55103; i_55140++) {\n                int64_t virt_tid_55141 = thd_offset_55139 + i_55140 * segscan_tblock_sizze_46456;\n                int64_t slice_55142 = (int64_t) 8;\n                int64_t gtid_46460 = virt_tid_55141;\n                int64_t remnant_55143 = virt_tid_55141 - gtid_46460;\n                \n                if (slt64(virt_tid_55141, (int64_t) 8)) {\n                    int64_t x_46465 = ((__global int64_t *) ext_mem_53645)[gtid_46460];\n                    \n                    private_mem_55137[i_55140] = x_46465;\n                } else {\n                    private_mem_55137[i_55140] = (int64_t) 0;\n                }\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        // Transpose scan inputs\n        {\n            for (int64_t i_55144 = 0; i_55144 < chunk_sizze_55103; i_55144++) {\n                int64_t sharedIdx_55145 = sext_i32_i64(local_tid_55115) + i_55144 * segscan_tblock_sizze_46456;\n                int64_t tmp_55146 = private_mem_55137[i_55144];\n                \n                ((__local int64_t *) local_mem_55122)[sharedIdx_55145] = tmp_55146;\n            }\n            barrier(CLK_L",
                                    "OCAL_MEM_FENCE);\n            for (int64_t i_55147 = 0; i_55147 < chunk_sizze_55103; i_55147++) {\n                int64_t sharedIdx_55148 = sext_i32_i64(local_tid_55115) * chunk_sizze_55103 + i_55147;\n                int64_t tmp_55149 = ((__local int64_t *) local_mem_55122)[sharedIdx_55148];\n                \n                private_mem_55137[i_55147] = tmp_55149;\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n        }\n        // Per thread scan\n        {\n            for (int64_t i_55150 = 0; i_55150 < chunk_sizze_55103 - (int64_t) 1; i_55150++) {\n                int64_t eta_p_46462;\n                int64_t eta_p_46463;\n                \n                eta_p_46462 = private_mem_55137[i_55150];\n                eta_p_46463 = private_mem_55137[i_55150 + (int64_t) 1];\n                \n                int64_t defunc_0_op_res_46464 = add64(eta_p_46462, eta_p_46463);\n                \n                private_mem_55137[i_55150 + (int64_t) 1] = defunc_0_op_res_46464;\n            }\n        }\n        // Publish results in shared memory\n        {\n            int64_t tmp_55151 = private_mem_55137[chunk_sizze_55103 - (int64_t) 1];\n            \n            ((__local int64_t *) local_mem_55122)[sext_i32_i64(local_tid_55115)] = tmp_55151;\n            barrier(CLK_LOCAL_MEM_FENCE);\n        }\n        // Scan results (with warp scan)\n        {\n            int64_t eta_p_55152;\n            int64_t eta_p_55153;\n            int64_t eta_p_55156;\n            int64_t eta_p_55157;\n            bool ltid_in_bounds_55159 = slt64(sext_i32_i64(local_tid_55115), num_virt_threads_55105);\n            int32_t skip_threads_55160;\n            \n            // read input for in-block scan\n            {\n                if (ltid_in_bounds_55159) {\n                    eta_p_55153 = ((volatile __local int64_t *) local_mem_55122)[sext_i32_i64(local_tid_55115)];\n                    if ((local_tid_55115 - squot32(local_tid_55115, 32) * 32) == 0) {\n                        eta_p_55152 = eta_p_55153;\n         ", "           }\n                }\n            }\n            // in-block scan (hopefully no barriers needed)\n            {\n                skip_threads_55160 = 1;\n                while (slt32(skip_threads_55160, 32)) {\n                    bool thread_active_55161 = sle32(skip_threads_55160, local_tid_55115 - squot32(local_tid_55115, 32) * 32) && ltid_in_bounds_55159;\n                    \n                    if (thread_active_55161) {\n                        // read operands\n                        {\n                            eta_p_55152 = ((volatile __local int64_t *) local_mem_55122)[sext_i32_i64(local_tid_55115) - sext_i32_i64(skip_threads_55160)];\n                        }\n                    }\n                    // perform operation\n                    {\n                        if (thread_active_55161) {\n                            int64_t defunc_0_op_res_55154 = add64(eta_p_55152, eta_p_55153);\n                            \n                            eta_p_55152 = defunc_0_op_res_55154;\n                        }\n                    }\n                    if (sle32(wave_sizze_55117, skip_threads_55160)) {\n                        barrier(CLK_LOCAL_MEM_FENCE);\n                    }\n                    if (thread_active_55161) {\n                        // write result\n                        {\n                            ((volatile __local int64_t *) local_mem_55122)[sext_i32_i64(local_tid_55115)] = eta_p_55152;\n                            eta_p_55153 = eta_p_55152;\n                        }\n                    }\n                    if (sle32(wave_sizze_55117, skip_threads_55160)) {\n                        barrier(CLK_LOCAL_MEM_FENCE);\n                    }\n                    skip_threads_55160 *= 2;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // last thread of block 'i' writes its result to offset 'i'\n            {\n                if ((local_tid_55115 - squot32(local_tid_55115, 32) * 32) == 31 && ltid_in_bounds_55159) {\n   ", "                 ((volatile __local int64_t *) local_mem_55122)[sext_i32_i64(squot32(local_tid_55115, 32))] = eta_p_55152;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // scan the first block, after which offset 'i' contains carry-in for block 'i+1'\n            {\n                int32_t skip_threads_55162;\n                \n                // read input for in-block scan\n                {\n                    if (squot32(local_tid_55115, 32) == 0 && ltid_in_bounds_55159) {\n                        eta_p_55157 = ((volatile __local int64_t *) local_mem_55122)[sext_i32_i64(local_tid_55115)];\n                        if ((local_tid_55115 - squot32(local_tid_55115, 32) * 32) == 0) {\n                            eta_p_55156 = eta_p_55157;\n                        }\n                    }\n                }\n                // in-block scan (hopefully no barriers needed)\n                {\n                    skip_threads_55162 = 1;\n                    while (slt32(skip_threads_55162, 32)) {\n                        bool thread_active_55163 = sle32(skip_threads_55162, local_tid_55115 - squot32(local_tid_55115, 32) * 32) && (squot32(local_tid_55115, 32) == 0 && ltid_in_bounds_55159);\n                        \n                        if (thread_active_55163) {\n                            // read operands\n                            {\n                                eta_p_55156 = ((volatile __local int64_t *) local_mem_55122)[sext_i32_i64(local_tid_55115) - sext_i32_i64(skip_threads_55162)];\n                            }\n                        }\n                        // perform operation\n                        {\n                            if (thread_active_55163) {\n                                int64_t defunc_0_op_res_55158 = add64(eta_p_55156, eta_p_55157);\n                                \n                                eta_p_55156 = defunc_0_op_res_55158;\n                            }\n                        }\n                        if ",
                                    "(sle32(wave_sizze_55117, skip_threads_55162)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        if (thread_active_55163) {\n                            // write result\n                            {\n                                ((volatile __local int64_t *) local_mem_55122)[sext_i32_i64(local_tid_55115)] = eta_p_55156;\n                                eta_p_55157 = eta_p_55156;\n                            }\n                        }\n                        if (sle32(wave_sizze_55117, skip_threads_55162)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        skip_threads_55162 *= 2;\n                    }\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            \n            bool no_carry_in_55164 = squot32(local_tid_55115, 32) == 0 || !ltid_in_bounds_55159;\n            \n            // carry-in for every block except the first\n            {\n                // read operands\n                {\n                    if (!no_carry_in_55164) {\n                        eta_p_55153 = eta_p_55152;\n                        eta_p_55152 = ((__local int64_t *) local_mem_55122)[sext_i32_i64(squot32(local_tid_55115, 32)) - (int64_t) 1];\n                    }\n                }\n                // perform operation\n                {\n                    if (!no_carry_in_55164) {\n                        int64_t defunc_0_op_res_55154 = add64(eta_p_55152, eta_p_55153);\n                        \n                        eta_p_55152 = defunc_0_op_res_55154;\n                    }\n                }\n                // write final result\n                {\n                    if (!no_carry_in_55164) {\n                        ((__local int64_t *) local_mem_55122)[sext_i32_i64(local_tid_55115)] = eta_p_55152;\n                    }\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // restore correct values for first block\n      ", "      {\n                if (squot32(local_tid_55115, 32) == 0 && ltid_in_bounds_55159) {\n                    ((__local int64_t *) local_mem_55122)[sext_i32_i64(local_tid_55115)] = eta_p_55153;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            barrier(CLK_LOCAL_MEM_FENCE);\n            if (local_tid_55115 == 0) {\n                acc_55155 = ((__local int64_t *) local_mem_55122)[segscan_tblock_sizze_46456 - (int64_t) 1];\n            } else {\n                acc_55155 = ((__local int64_t *) local_mem_55122)[sext_i32_i64(local_tid_55115) - (int64_t) 1];\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n        }\n        prefix_55165 = (int64_t) 0;\n        block_new_sgm_55166 = sgm_idx_55134 == (int64_t) 0;\n        // Perform lookback\n        {\n            if (block_new_sgm_55166 && local_tid_55115 == 0) {\n                ((volatile __global int64_t *) incprefixes_mem_55110)[dynamic_id_55132] = acc_55155;\n                mem_fence_global();\n                ((volatile __global int8_t *) status_flags_mem_55106)[dynamic_id_55132] = (int8_t) 2;\n                acc_55155 = (int64_t) 0;\n            }\n            if (!block_new_sgm_55166 && slt32(local_tid_55115, wave_sizze_55117)) {\n                if (local_tid_55115 == 0) {\n                    ((volatile __global int64_t *) aggregates_mem_55108)[dynamic_id_55132] = acc_55155;\n                    mem_fence_global();\n                    ((volatile __global int8_t *) status_flags_mem_55106)[dynamic_id_55132] = (int8_t) 1;\n                    \n                    int8_t tmp_55167 = ((volatile __global int8_t *) status_flags_mem_55106)[dynamic_id_55132 - (int64_t) 1];\n                    \n                    ((volatile __local int8_t *) local_mem_55122)[(int64_t) 0] = tmp_55167;\n                }\n                mem_fence_local();\n                \n                int8_t status_55168 = ((__local int8_t *) local_mem_55122)[(int64_t) 0];\n                \n                if (status_55168 == (i", "nt8_t) 2) {\n                    if (local_tid_55115 == 0) {\n                        prefix_55165 = ((volatile __global int64_t *) incprefixes_mem_55110)[dynamic_id_55132 - (int64_t) 1];\n                    }\n                } else {\n                    int32_t readOffset_55169 = sext_i64_i32(dynamic_id_55132 - sext_i32_i64(wave_sizze_55117));\n                    \n                    while (slt32(wave_sizze_55117 * -1, readOffset_55169)) {\n                        int32_t read_i_55170 = readOffset_55169 + local_tid_55115;\n                        int64_t aggr_55171 = (int64_t) 0;\n                        int8_t flag_55172 = (int8_t) 0;\n                        \n                        if (sle32(0, read_i_55170)) {\n                            flag_55172 = ((volatile __global int8_t *) status_flags_mem_55106)[sext_i32_i64(read_i_55170)];\n                            if (flag_55172 == (int8_t) 2) {\n                                aggr_55171 = ((volatile __global int64_t *) incprefixes_mem_55110)[sext_i32_i64(read_i_55170)];\n                            } else if (flag_55172 == (int8_t) 1) {\n                                aggr_55171 = ((volatile __global int64_t *) aggregates_mem_55108)[sext_i32_i64(read_i_55170)];\n                            }\n                        }\n                        ((__local int64_t *) local_mem_55122)[(int64_t) 4 + sext_i32_i64(local_tid_55115)] = aggr_55171;\n                        ((__local int8_t *) local_mem_55122)[sext_i32_i64(local_tid_55115)] = flag_55172;\n                        flag_55172 = ((__local int8_t *) local_mem_55122)[sext_i32_i64(wave_sizze_55117) - (int64_t) 1];\n                        if (slt8(flag_55172, (int8_t) 2)) {\n                            int8_t flg_x_55176;\n                            int8_t flg_y_55177;\n                            int64_t eta_p_55173;\n                            int64_t eta_p_55174;\n                            int32_t skip_threads_55178;\n                            \n                            // r",
                                    "ead input for in-block scan\n                            {\n                                flg_y_55177 = ((volatile __local int8_t *) local_mem_55122)[sext_i32_i64(local_tid_55115)];\n                                eta_p_55174 = ((volatile __local int64_t *) local_mem_55122)[(int64_t) 4 + sext_i32_i64(local_tid_55115)];\n                                if ((local_tid_55115 - squot32(local_tid_55115, 32) * 32) == 0) {\n                                    eta_p_55173 = eta_p_55174;\n                                    flg_x_55176 = flg_y_55177;\n                                }\n                            }\n                            // in-block scan (hopefully no barriers needed)\n                            {\n                                skip_threads_55178 = 1;\n                                while (slt32(skip_threads_55178, 32)) {\n                                    if (sle32(skip_threads_55178, local_tid_55115 - squot32(local_tid_55115, 32) * 32)) {\n                                        // read operands\n                                        {\n                                            flg_x_55176 = ((volatile __local int8_t *) local_mem_55122)[sext_i32_i64(local_tid_55115) - sext_i32_i64(skip_threads_55178)];\n                                            eta_p_55173 = ((volatile __local int64_t *) local_mem_55122)[(int64_t) 4 + (sext_i32_i64(local_tid_55115) - sext_i32_i64(skip_threads_55178))];\n                                        }\n                                        // perform operation\n                                        {\n                                            if (flg_y_55177 == (int8_t) 2 || flg_y_55177 == (int8_t) 0) {\n                                                flg_x_55176 = flg_y_55177;\n                                                eta_p_55173 = eta_p_55174;\n                                            } else {\n                                                int64_t defunc_0_op_res_55175 = add64(eta_p_55173, eta_p_55174);\n          ", "                                      \n                                                eta_p_55173 = defunc_0_op_res_55175;\n                                            }\n                                        }\n                                        // write result\n                                        {\n                                            ((volatile __local int8_t *) local_mem_55122)[sext_i32_i64(local_tid_55115)] = flg_x_55176;\n                                            flg_y_55177 = flg_x_55176;\n                                            ((volatile __local int64_t *) local_mem_55122)[(int64_t) 4 + sext_i32_i64(local_tid_55115)] = eta_p_55173;\n                                            eta_p_55174 = eta_p_55173;\n                                        }\n                                    }\n                                    skip_threads_55178 *= 2;\n                                }\n                            }\n                        }\n                        flag_55172 = ((__local int8_t *) local_mem_55122)[sext_i32_i64(wave_sizze_55117) - (int64_t) 1];\n                        aggr_55171 = ((__local int64_t *) local_mem_55122)[(int64_t) 4 + (sext_i32_i64(wave_sizze_55117) - (int64_t) 1)];\n                        if (flag_55172 == (int8_t) 2) {\n                            readOffset_55169 = wave_sizze_55117 * -1;\n                        } else if (flag_55172 == (int8_t) 1) {\n                            readOffset_55169 -= wave_sizze_55117;\n                        }\n                        if (slt8((int8_t) 0, flag_55172)) {\n                            int64_t eta_p_55179 = aggr_55171;\n                            int64_t eta_p_55180 = prefix_55165;\n                            int64_t defunc_0_op_res_55181 = add64(eta_p_55179, eta_p_55180);\n                            \n                            prefix_55165 = defunc_0_op_res_55181;\n                        }\n                        mem_fence_local();\n                    }\n                }\n       ", "         if (local_tid_55115 == 0) {\n                    if (boundary_55135 == sext_i64_i32(segscan_tblock_sizze_46456 * chunk_sizze_55103)) {\n                        int64_t eta_p_55182 = prefix_55165;\n                        int64_t eta_p_55183 = acc_55155;\n                        int64_t defunc_0_op_res_55184 = add64(eta_p_55182, eta_p_55183);\n                        \n                        ((volatile __global int64_t *) incprefixes_mem_55110)[dynamic_id_55132] = defunc_0_op_res_55184;\n                        mem_fence_global();\n                        ((volatile __global int8_t *) status_flags_mem_55106)[dynamic_id_55132] = (int8_t) 2;\n                    }\n                    ((__local int64_t *) local_mem_55122)[(int64_t) 4] = prefix_55165;\n                    acc_55155 = (int64_t) 0;\n                }\n            }\n            if (!(dynamic_id_55132 == (int64_t) 0)) {\n                barrier(CLK_LOCAL_MEM_FENCE);\n                prefix_55165 = ((__local int64_t *) local_mem_55122)[(int64_t) 4];\n                barrier(CLK_LOCAL_MEM_FENCE);\n            }\n        }\n        // Distribute results\n        {\n            int64_t eta_p_55185;\n            int64_t eta_p_55186;\n            int64_t eta_p_55188 = prefix_55165;\n            int64_t eta_p_55189 = acc_55155;\n            \n            if (slt32(local_tid_55115 * chunk_sizze_32b_55119, boundary_55135) && !block_new_sgm_55166) {\n                int64_t defunc_0_op_res_55190 = add64(eta_p_55188, eta_p_55189);\n                \n                eta_p_55185 = defunc_0_op_res_55190;\n            } else {\n                eta_p_55185 = acc_55155;\n            }\n            \n            int32_t stopping_point_55191 = segsizze_compact_55136 - srem32(local_tid_55115 * chunk_sizze_32b_55119 - 1 + segsizze_compact_55136 - boundary_55135, segsizze_compact_55136);\n            \n            for (int64_t i_55192 = 0; i_55192 < chunk_sizze_55103; i_55192++) {\n                if (slt32(sext_i64_i32(i_55192), stopping_point_55191 - 1)",
                                    ") {\n                    eta_p_55186 = private_mem_55137[i_55192];\n                    \n                    int64_t defunc_0_op_res_55187 = add64(eta_p_55185, eta_p_55186);\n                    \n                    private_mem_55137[i_55192] = defunc_0_op_res_55187;\n                }\n            }\n        }\n        // Transpose scan output and Write it to global memory in coalesced fashion\n        {\n            for (int64_t i_55193 = 0; i_55193 < chunk_sizze_55103; i_55193++) {\n                int64_t sharedIdx_55194 = sext_i32_i64(local_tid_55115) * chunk_sizze_55103 + i_55193;\n                int64_t tmp_55195 = private_mem_55137[i_55193];\n                \n                ((__local int64_t *) local_mem_55122)[sharedIdx_55194] = tmp_55195;\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            for (int64_t i_55196 = 0; i_55196 < chunk_sizze_55103; i_55196++) {\n                int64_t flat_idx_55197 = thd_offset_55139 + i_55196 * segscan_tblock_sizze_46456;\n                int64_t slice_55198 = (int64_t) 8;\n                int64_t gtid_46460 = flat_idx_55197;\n                int64_t remnant_55199 = flat_idx_55197 - gtid_46460;\n                \n                if (slt64(flat_idx_55197, (int64_t) 8)) {\n                    int64_t tmp_55200 = ((__local int64_t *) local_mem_55122)[flat_idx_55197 - block_offset_55133];\n                    \n                    ((__global int64_t *) mem_53648)[gtid_46460] = tmp_55200;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n        }\n    }\n    \n  error_3:\n    return;\n    #undef segscan_tblock_sizze_46456\n    #undef chunk_sizze_55103\n}\nFUTHARK_KERNEL_SIZED(add_next_partition_doublezisegscan_46485_dim1, 1, 1)\nvoid add_next_partition_doublezisegscan_46485(__global int *global_failure, int failure_is_an_option, __global int64_t *global_failure_args, int64_t part_no_28414, int64_t dz2083U_28419, int64_t conc_tmp_41169, int64_t num_tblocks_46482, int64_t num_virt_blocks_55220, int64_t num_virt_threads", "_55221, __global unsigned char *clProc_mem_53517, __global unsigned char *mem_53539, __global unsigned char *mem_53659, __global unsigned char *mem_53665, __global unsigned char *mem_53667, __global unsigned char *status_flags_mem_55222, __global unsigned char *aggregates_mem_55224, __global unsigned char *incprefixes_mem_55226, __global unsigned char *global_dynid_mem_55228)\n{\n    #define segscan_tblock_sizze_46480 (add_next_partition_doublezisegscan_46485zisegscan_tblock_sizze_46480)\n    #define chunk_sizze_55219 (add_next_partition_doublezisegscan_46485zichunk_sizze_55219)\n    \n    volatile __local unsigned char *local_mem_55238_backing_0 = &shared_mem[0];\n    const int64_t local_mem_55238_backing_0_offset = 0 + (smax64(smax64((int64_t) 288, (int64_t) 8 * segscan_tblock_sizze_46480), chunk_sizze_55219 * segscan_tblock_sizze_46480 * (int64_t) 8) + srem64((int64_t) 8 - srem64(smax64(smax64((int64_t) 288, (int64_t) 8 * segscan_tblock_sizze_46480), chunk_sizze_55219 * segscan_tblock_sizze_46480 * (int64_t) 8), (int64_t) 8), (int64_t) 8));\n    volatile __local int local_failure;\n    \n    if (failure_is_an_option) {\n        int failed = *global_failure >= 0;\n        \n        if (failed)\n            return;\n    }\n    local_failure = 0;\n    barrier(CLK_LOCAL_MEM_FENCE);\n    \n    int32_t local_tid_55231;\n    int32_t tblock_sizze_55234;\n    int32_t wave_sizze_55233;\n    int32_t block_id_55232;\n    int32_t global_tid_55230;\n    int64_t phys_tid_46485;\n    int32_t chunk_sizze_32b_55235;\n    int64_t byte_offsets_55236;\n    int64_t warp_byte_offset_55237;\n    __local unsigned char *local_mem_55238;\n    int64_t trans_arr_len_55239;\n    int64_t phys_block_id_55245;\n    int64_t virtloop_bound_55246;\n    \n    local_tid_55231 = get_local_id(0);\n    tblock_sizze_55234 = get_local_size(0);\n    wave_sizze_55233 = LOCKSTEP_WIDTH;\n    block_id_55232 = get_tblock_id(0);\n    global_tid_55230 = block_id_55232 * tblock_sizze_55234 + local_tid_55231;\n    phys_tid_46485 = sext_i32_i64(global_", "tid_55230);\n    chunk_sizze_32b_55235 = sext_i64_i32(chunk_sizze_55219);\n    byte_offsets_55236 = segscan_tblock_sizze_46480 * (int64_t) 8;\n    warp_byte_offset_55237 = (int64_t) 288;\n    // Allocate reusable shared memory\n    { }\n    local_mem_55238 = (__local unsigned char *) local_mem_55238_backing_0;\n    trans_arr_len_55239 = chunk_sizze_55219 * segscan_tblock_sizze_46480;\n    phys_block_id_55245 = get_tblock_id(0);\n    virtloop_bound_55246 = sdiv_up64(num_virt_blocks_55220 - phys_block_id_55245, num_tblocks_46482);\n    for (int64_t virtloop_i_55247 = 0; virtloop_i_55247 < virtloop_bound_55246; virtloop_i_55247++) {\n        int64_t dynamic_id_55248;\n        int64_t block_offset_55249;\n        int64_t sgm_idx_55250;\n        int32_t boundary_55251;\n        int32_t segsizze_compact_55252;\n        int64_t private_mem_55253[chunk_sizze_55219];\n        int64_t thd_offset_55255;\n        int64_t acc_55271;\n        int64_t prefix_55281;\n        bool block_new_sgm_55282;\n        \n        // First thread in block fetches this block's dynamic_id\n        {\n            if (local_tid_55231 == 0) {\n                dynamic_id_55248 = atomic_add_i32_global(&((volatile __global int *) global_dynid_mem_55228)[(int64_t) 0], (int) 1);\n                // Set dynamic id for this block\n                {\n                    ((__local int64_t *) local_mem_55238)[(int64_t) 0] = dynamic_id_55248;\n                }\n                // First thread in last (virtual) block resets global dynamic_id\n                {\n                    if (dynamic_id_55248 == num_virt_blocks_55220 - (int64_t) 1) {\n                        ((__global int32_t *) global_dynid_mem_55228)[(int64_t) 0] = 0;\n                    }\n                }\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        dynamic_id_55248 = ((__local int32_t *) local_mem_55238)[(int64_t) 0];\n        barrier(CLK_LOCAL_MEM_FENCE);\n        block_offset_55249 = dynamic_id_55248 * chunk_sizze_55219 * segscan_tblock_sizze_46480;\n  ",
                                    "      sgm_idx_55250 = smod64(block_offset_55249, conc_tmp_41169);\n        boundary_55251 = sext_i64_i32(smin64(chunk_sizze_55219 * segscan_tblock_sizze_46480, conc_tmp_41169 - sgm_idx_55250));\n        segsizze_compact_55252 = sext_i64_i32(smin64(chunk_sizze_55219 * segscan_tblock_sizze_46480, conc_tmp_41169));\n        thd_offset_55255 = block_offset_55249 + sext_i32_i64(local_tid_55231);\n        // Load and map\n        {\n            for (int64_t i_55256 = 0; i_55256 < chunk_sizze_55219; i_55256++) {\n                int64_t virt_tid_55257 = thd_offset_55255 + i_55256 * segscan_tblock_sizze_46480;\n                int64_t slice_55258 = conc_tmp_41169;\n                int64_t gtid_46484 = virt_tid_55257;\n                int64_t remnant_55259 = virt_tid_55257 - gtid_46484;\n                \n                if (slt64(virt_tid_55257, conc_tmp_41169)) {\n                    bool index_concat_cmp_49687 = sle64(dz2083U_28419, gtid_46484);\n                    int64_t index_concat_branch_49691;\n                    \n                    if (index_concat_cmp_49687) {\n                        int64_t index_concat_i_49688 = sub64(gtid_46484, dz2083U_28419);\n                        int64_t index_concat_49689 = ((__global int64_t *) mem_53659)[index_concat_i_49688];\n                        \n                        index_concat_branch_49691 = index_concat_49689;\n                    } else {\n                        int64_t index_concat_49690 = ((__global int64_t *) clProc_mem_53517)[gtid_46484];\n                        \n                        index_concat_branch_49691 = index_concat_49690;\n                    }\n                    \n                    bool x_44819 = sle64((int64_t) 0, index_concat_branch_49691);\n                    bool y_44820 = slt64(index_concat_branch_49691, part_no_28414);\n                    bool bounds_check_44821 = x_44819 && y_44820;\n                    bool index_certs_44822;\n                    \n                    if (!bounds_check_44821) {\n                   ", "     {\n                            if (atomic_cmpxchg_i32_global(global_failure, -1, 8) == -1) {\n                                global_failure_args[0] = (int64_t) index_concat_branch_49691;\n                                global_failure_args[1] = (int64_t) part_no_28414;\n                                ;\n                            }\n                            local_failure = 1;\n                            goto error_0;\n                        }\n                    }\n                    \n                    bool tmp_44823 = ((__global bool *) mem_53539)[index_concat_branch_49691];\n                    bool lifted_lambda_res_44824 = !tmp_44823;\n                    int64_t defunc_0_f_res_44825 = btoi_bool_i64(lifted_lambda_res_44824);\n                    \n                    ((__global int64_t *) mem_53667)[gtid_46484] = defunc_0_f_res_44825;\n                    private_mem_55253[i_55256] = defunc_0_f_res_44825;\n                } else {\n                    private_mem_55253[i_55256] = (int64_t) 0;\n                }\n            }\n        }\n        \n      error_0:\n        barrier(CLK_LOCAL_MEM_FENCE);\n        if (local_failure)\n            return;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        // Transpose scan inputs\n        {\n            for (int64_t i_55260 = 0; i_55260 < chunk_sizze_55219; i_55260++) {\n                int64_t sharedIdx_55261 = sext_i32_i64(local_tid_55231) + i_55260 * segscan_tblock_sizze_46480;\n                int64_t tmp_55262 = private_mem_55253[i_55260];\n                \n                ((__local int64_t *) local_mem_55238)[sharedIdx_55261] = tmp_55262;\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            for (int64_t i_55263 = 0; i_55263 < chunk_sizze_55219; i_55263++) {\n                int64_t sharedIdx_55264 = sext_i32_i64(local_tid_55231) * chunk_sizze_55219 + i_55263;\n                int64_t tmp_55265 = ((__local int64_t *) local_mem_55238)[sharedIdx_55264];\n                \n                private_mem_55253[i_55263] = tmp_55", "265;\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n        }\n        // Per thread scan\n        {\n            for (int64_t i_55266 = 0; i_55266 < chunk_sizze_55219 - (int64_t) 1; i_55266++) {\n                int64_t eta_p_41182;\n                int64_t eta_p_41183;\n                \n                eta_p_41182 = private_mem_55253[i_55266];\n                eta_p_41183 = private_mem_55253[i_55266 + (int64_t) 1];\n                \n                int64_t defunc_0_op_res_41184 = add64(eta_p_41182, eta_p_41183);\n                \n                private_mem_55253[i_55266 + (int64_t) 1] = defunc_0_op_res_41184;\n            }\n        }\n        // Publish results in shared memory\n        {\n            int64_t tmp_55267 = private_mem_55253[chunk_sizze_55219 - (int64_t) 1];\n            \n            ((__local int64_t *) local_mem_55238)[sext_i32_i64(local_tid_55231)] = tmp_55267;\n            barrier(CLK_LOCAL_MEM_FENCE);\n        }\n        // Scan results (with warp scan)\n        {\n            int64_t eta_p_55268;\n            int64_t eta_p_55269;\n            int64_t eta_p_55272;\n            int64_t eta_p_55273;\n            bool ltid_in_bounds_55275 = slt64(sext_i32_i64(local_tid_55231), num_virt_threads_55221);\n            int32_t skip_threads_55276;\n            \n            // read input for in-block scan\n            {\n                if (ltid_in_bounds_55275) {\n                    eta_p_55269 = ((volatile __local int64_t *) local_mem_55238)[sext_i32_i64(local_tid_55231)];\n                    if ((local_tid_55231 - squot32(local_tid_55231, 32) * 32) == 0) {\n                        eta_p_55268 = eta_p_55269;\n                    }\n                }\n            }\n            // in-block scan (hopefully no barriers needed)\n            {\n                skip_threads_55276 = 1;\n                while (slt32(skip_threads_55276, 32)) {\n                    bool thread_active_55277 = sle32(skip_threads_55276, local_tid_55231 - squot32(local_tid_55231, 32) * 32) && ltid_in_bounds_5",
                                    "5275;\n                    \n                    if (thread_active_55277) {\n                        // read operands\n                        {\n                            eta_p_55268 = ((volatile __local int64_t *) local_mem_55238)[sext_i32_i64(local_tid_55231) - sext_i32_i64(skip_threads_55276)];\n                        }\n                    }\n                    // perform operation\n                    {\n                        if (thread_active_55277) {\n                            int64_t defunc_0_op_res_55270 = add64(eta_p_55268, eta_p_55269);\n                            \n                            eta_p_55268 = defunc_0_op_res_55270;\n                        }\n                    }\n                    if (sle32(wave_sizze_55233, skip_threads_55276)) {\n                        barrier(CLK_LOCAL_MEM_FENCE);\n                    }\n                    if (thread_active_55277) {\n                        // write result\n                        {\n                            ((volatile __local int64_t *) local_mem_55238)[sext_i32_i64(local_tid_55231)] = eta_p_55268;\n                            eta_p_55269 = eta_p_55268;\n                        }\n                    }\n                    if (sle32(wave_sizze_55233, skip_threads_55276)) {\n                        barrier(CLK_LOCAL_MEM_FENCE);\n                    }\n                    skip_threads_55276 *= 2;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // last thread of block 'i' writes its result to offset 'i'\n            {\n                if ((local_tid_55231 - squot32(local_tid_55231, 32) * 32) == 31 && ltid_in_bounds_55275) {\n                    ((volatile __local int64_t *) local_mem_55238)[sext_i32_i64(squot32(local_tid_55231, 32))] = eta_p_55268;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // scan the first block, after which offset 'i' contains carry-in for block 'i+1'\n            {\n                int32_t skip_threads_55278;\n           ", "     \n                // read input for in-block scan\n                {\n                    if (squot32(local_tid_55231, 32) == 0 && ltid_in_bounds_55275) {\n                        eta_p_55273 = ((volatile __local int64_t *) local_mem_55238)[sext_i32_i64(local_tid_55231)];\n                        if ((local_tid_55231 - squot32(local_tid_55231, 32) * 32) == 0) {\n                            eta_p_55272 = eta_p_55273;\n                        }\n                    }\n                }\n                // in-block scan (hopefully no barriers needed)\n                {\n                    skip_threads_55278 = 1;\n                    while (slt32(skip_threads_55278, 32)) {\n                        bool thread_active_55279 = sle32(skip_threads_55278, local_tid_55231 - squot32(local_tid_55231, 32) * 32) && (squot32(local_tid_55231, 32) == 0 && ltid_in_bounds_55275);\n                        \n                        if (thread_active_55279) {\n                            // read operands\n                            {\n                                eta_p_55272 = ((volatile __local int64_t *) local_mem_55238)[sext_i32_i64(local_tid_55231) - sext_i32_i64(skip_threads_55278)];\n                            }\n                        }\n                        // perform operation\n                        {\n                            if (thread_active_55279) {\n                                int64_t defunc_0_op_res_55274 = add64(eta_p_55272, eta_p_55273);\n                                \n                                eta_p_55272 = defunc_0_op_res_55274;\n                            }\n                        }\n                        if (sle32(wave_sizze_55233, skip_threads_55278)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        if (thread_active_55279) {\n                            // write result\n                            {\n                                ((volatile __local int64_t *) local_mem_55238)[sext_i32_i64(local_tid_5", "5231)] = eta_p_55272;\n                                eta_p_55273 = eta_p_55272;\n                            }\n                        }\n                        if (sle32(wave_sizze_55233, skip_threads_55278)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        skip_threads_55278 *= 2;\n                    }\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            \n            bool no_carry_in_55280 = squot32(local_tid_55231, 32) == 0 || !ltid_in_bounds_55275;\n            \n            // carry-in for every block except the first\n            {\n                // read operands\n                {\n                    if (!no_carry_in_55280) {\n                        eta_p_55269 = eta_p_55268;\n                        eta_p_55268 = ((__local int64_t *) local_mem_55238)[sext_i32_i64(squot32(local_tid_55231, 32)) - (int64_t) 1];\n                    }\n                }\n                // perform operation\n                {\n                    if (!no_carry_in_55280) {\n                        int64_t defunc_0_op_res_55270 = add64(eta_p_55268, eta_p_55269);\n                        \n                        eta_p_55268 = defunc_0_op_res_55270;\n                    }\n                }\n                // write final result\n                {\n                    if (!no_carry_in_55280) {\n                        ((__local int64_t *) local_mem_55238)[sext_i32_i64(local_tid_55231)] = eta_p_55268;\n                    }\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // restore correct values for first block\n            {\n                if (squot32(local_tid_55231, 32) == 0 && ltid_in_bounds_55275) {\n                    ((__local int64_t *) local_mem_55238)[sext_i32_i64(local_tid_55231)] = eta_p_55269;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            barrier(CLK_LOCAL_MEM_FENCE);\n            if (local_tid_55231 == 0) {\n           ",
                                    "     acc_55271 = ((__local int64_t *) local_mem_55238)[segscan_tblock_sizze_46480 - (int64_t) 1];\n            } else {\n                acc_55271 = ((__local int64_t *) local_mem_55238)[sext_i32_i64(local_tid_55231) - (int64_t) 1];\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n        }\n        prefix_55281 = (int64_t) 0;\n        block_new_sgm_55282 = sgm_idx_55250 == (int64_t) 0;\n        // Perform lookback\n        {\n            if (block_new_sgm_55282 && local_tid_55231 == 0) {\n                ((volatile __global int64_t *) incprefixes_mem_55226)[dynamic_id_55248] = acc_55271;\n                mem_fence_global();\n                ((volatile __global int8_t *) status_flags_mem_55222)[dynamic_id_55248] = (int8_t) 2;\n                acc_55271 = (int64_t) 0;\n            }\n            if (!block_new_sgm_55282 && slt32(local_tid_55231, wave_sizze_55233)) {\n                if (local_tid_55231 == 0) {\n                    ((volatile __global int64_t *) aggregates_mem_55224)[dynamic_id_55248] = acc_55271;\n                    mem_fence_global();\n                    ((volatile __global int8_t *) status_flags_mem_55222)[dynamic_id_55248] = (int8_t) 1;\n                    \n                    int8_t tmp_55283 = ((volatile __global int8_t *) status_flags_mem_55222)[dynamic_id_55248 - (int64_t) 1];\n                    \n                    ((volatile __local int8_t *) local_mem_55238)[(int64_t) 0] = tmp_55283;\n                }\n                mem_fence_local();\n                \n                int8_t status_55284 = ((__local int8_t *) local_mem_55238)[(int64_t) 0];\n                \n                if (status_55284 == (int8_t) 2) {\n                    if (local_tid_55231 == 0) {\n                        prefix_55281 = ((volatile __global int64_t *) incprefixes_mem_55226)[dynamic_id_55248 - (int64_t) 1];\n                    }\n                } else {\n                    int32_t readOffset_55285 = sext_i64_i32(dynamic_id_55248 - sext_i32_i64(wave_sizze_55233));\n               ", "     \n                    while (slt32(wave_sizze_55233 * -1, readOffset_55285)) {\n                        int32_t read_i_55286 = readOffset_55285 + local_tid_55231;\n                        int64_t aggr_55287 = (int64_t) 0;\n                        int8_t flag_55288 = (int8_t) 0;\n                        \n                        if (sle32(0, read_i_55286)) {\n                            flag_55288 = ((volatile __global int8_t *) status_flags_mem_55222)[sext_i32_i64(read_i_55286)];\n                            if (flag_55288 == (int8_t) 2) {\n                                aggr_55287 = ((volatile __global int64_t *) incprefixes_mem_55226)[sext_i32_i64(read_i_55286)];\n                            } else if (flag_55288 == (int8_t) 1) {\n                                aggr_55287 = ((volatile __global int64_t *) aggregates_mem_55224)[sext_i32_i64(read_i_55286)];\n                            }\n                        }\n                        ((__local int64_t *) local_mem_55238)[(int64_t) 4 + sext_i32_i64(local_tid_55231)] = aggr_55287;\n                        ((__local int8_t *) local_mem_55238)[sext_i32_i64(local_tid_55231)] = flag_55288;\n                        flag_55288 = ((__local int8_t *) local_mem_55238)[sext_i32_i64(wave_sizze_55233) - (int64_t) 1];\n                        if (slt8(flag_55288, (int8_t) 2)) {\n                            int8_t flg_x_55292;\n                            int8_t flg_y_55293;\n                            int64_t eta_p_55289;\n                            int64_t eta_p_55290;\n                            int32_t skip_threads_55294;\n                            \n                            // read input for in-block scan\n                            {\n                                flg_y_55293 = ((volatile __local int8_t *) local_mem_55238)[sext_i32_i64(local_tid_55231)];\n                                eta_p_55290 = ((volatile __local int64_t *) local_mem_55238)[(int64_t) 4 + sext_i32_i64(local_tid_55231)];\n                                if ((lo", "cal_tid_55231 - squot32(local_tid_55231, 32) * 32) == 0) {\n                                    eta_p_55289 = eta_p_55290;\n                                    flg_x_55292 = flg_y_55293;\n                                }\n                            }\n                            // in-block scan (hopefully no barriers needed)\n                            {\n                                skip_threads_55294 = 1;\n                                while (slt32(skip_threads_55294, 32)) {\n                                    if (sle32(skip_threads_55294, local_tid_55231 - squot32(local_tid_55231, 32) * 32)) {\n                                        // read operands\n                                        {\n                                            flg_x_55292 = ((volatile __local int8_t *) local_mem_55238)[sext_i32_i64(local_tid_55231) - sext_i32_i64(skip_threads_55294)];\n                                            eta_p_55289 = ((volatile __local int64_t *) local_mem_55238)[(int64_t) 4 + (sext_i32_i64(local_tid_55231) - sext_i32_i64(skip_threads_55294))];\n                                        }\n                                        // perform operation\n                                        {\n                                            if (flg_y_55293 == (int8_t) 2 || flg_y_55293 == (int8_t) 0) {\n                                                flg_x_55292 = flg_y_55293;\n                                                eta_p_55289 = eta_p_55290;\n                                            } else {\n                                                int64_t defunc_0_op_res_55291 = add64(eta_p_55289, eta_p_55290);\n                                                \n                                                eta_p_55289 = defunc_0_op_res_55291;\n                                            }\n                                        }\n                                        // write result\n                                        {\n                                            ((vola",
                                    "tile __local int8_t *) local_mem_55238)[sext_i32_i64(local_tid_55231)] = flg_x_55292;\n                                            flg_y_55293 = flg_x_55292;\n                                            ((volatile __local int64_t *) local_mem_55238)[(int64_t) 4 + sext_i32_i64(local_tid_55231)] = eta_p_55289;\n                                            eta_p_55290 = eta_p_55289;\n                                        }\n                                    }\n                                    skip_threads_55294 *= 2;\n                                }\n                            }\n                        }\n                        flag_55288 = ((__local int8_t *) local_mem_55238)[sext_i32_i64(wave_sizze_55233) - (int64_t) 1];\n                        aggr_55287 = ((__local int64_t *) local_mem_55238)[(int64_t) 4 + (sext_i32_i64(wave_sizze_55233) - (int64_t) 1)];\n                        if (flag_55288 == (int8_t) 2) {\n                            readOffset_55285 = wave_sizze_55233 * -1;\n                        } else if (flag_55288 == (int8_t) 1) {\n                            readOffset_55285 -= wave_sizze_55233;\n                        }\n                        if (slt8((int8_t) 0, flag_55288)) {\n                            int64_t eta_p_55295 = aggr_55287;\n                            int64_t eta_p_55296 = prefix_55281;\n                            int64_t defunc_0_op_res_55297 = add64(eta_p_55295, eta_p_55296);\n                            \n                            prefix_55281 = defunc_0_op_res_55297;\n                        }\n                        mem_fence_local();\n                    }\n                }\n                if (local_tid_55231 == 0) {\n                    if (boundary_55251 == sext_i64_i32(segscan_tblock_sizze_46480 * chunk_sizze_55219)) {\n                        int64_t eta_p_55298 = prefix_55281;\n                        int64_t eta_p_55299 = acc_55271;\n                        int64_t defunc_0_op_res_55300 = add64(eta_p_55298, eta_p_55299);\n           ", "             \n                        ((volatile __global int64_t *) incprefixes_mem_55226)[dynamic_id_55248] = defunc_0_op_res_55300;\n                        mem_fence_global();\n                        ((volatile __global int8_t *) status_flags_mem_55222)[dynamic_id_55248] = (int8_t) 2;\n                    }\n                    ((__local int64_t *) local_mem_55238)[(int64_t) 4] = prefix_55281;\n                    acc_55271 = (int64_t) 0;\n                }\n            }\n            if (!(dynamic_id_55248 == (int64_t) 0)) {\n                barrier(CLK_LOCAL_MEM_FENCE);\n                prefix_55281 = ((__local int64_t *) local_mem_55238)[(int64_t) 4];\n                barrier(CLK_LOCAL_MEM_FENCE);\n            }\n        }\n        // Distribute results\n        {\n            int64_t eta_p_55301;\n            int64_t eta_p_55302;\n            int64_t eta_p_55304 = prefix_55281;\n            int64_t eta_p_55305 = acc_55271;\n            \n            if (slt32(local_tid_55231 * chunk_sizze_32b_55235, boundary_55251) && !block_new_sgm_55282) {\n                int64_t defunc_0_op_res_55306 = add64(eta_p_55304, eta_p_55305);\n                \n                eta_p_55301 = defunc_0_op_res_55306;\n            } else {\n                eta_p_55301 = acc_55271;\n            }\n            \n            int32_t stopping_point_55307 = segsizze_compact_55252 - srem32(local_tid_55231 * chunk_sizze_32b_55235 - 1 + segsizze_compact_55252 - boundary_55251, segsizze_compact_55252);\n            \n            for (int64_t i_55308 = 0; i_55308 < chunk_sizze_55219; i_55308++) {\n                if (slt32(sext_i64_i32(i_55308), stopping_point_55307 - 1)) {\n                    eta_p_55302 = private_mem_55253[i_55308];\n                    \n                    int64_t defunc_0_op_res_55303 = add64(eta_p_55301, eta_p_55302);\n                    \n                    private_mem_55253[i_55308] = defunc_0_op_res_55303;\n                }\n            }\n        }\n        // Transpose scan output and Write it to glob", "al memory in coalesced fashion\n        {\n            for (int64_t i_55309 = 0; i_55309 < chunk_sizze_55219; i_55309++) {\n                int64_t sharedIdx_55310 = sext_i32_i64(local_tid_55231) * chunk_sizze_55219 + i_55309;\n                int64_t tmp_55311 = private_mem_55253[i_55309];\n                \n                ((__local int64_t *) local_mem_55238)[sharedIdx_55310] = tmp_55311;\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            for (int64_t i_55312 = 0; i_55312 < chunk_sizze_55219; i_55312++) {\n                int64_t flat_idx_55313 = thd_offset_55255 + i_55312 * segscan_tblock_sizze_46480;\n                int64_t slice_55314 = conc_tmp_41169;\n                int64_t gtid_46484 = flat_idx_55313;\n                int64_t remnant_55315 = flat_idx_55313 - gtid_46484;\n                \n                if (slt64(flat_idx_55313, conc_tmp_41169)) {\n                    int64_t tmp_55316 = ((__local int64_t *) local_mem_55238)[flat_idx_55313 - block_offset_55249];\n                    \n                    ((__global int64_t *) mem_53665)[gtid_46484] = tmp_55316;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n        }\n    }\n    \n  error_3:\n    return;\n    #undef segscan_tblock_sizze_46480\n    #undef chunk_sizze_55219\n}\nFUTHARK_KERNEL_SIZED(add_next_partition_doublezisegscan_46784_dim1, 1, 1)\nvoid add_next_partition_doublezisegscan_46784(__global int *global_failure, int64_t n_old_28413, int64_t num_tblocks_46781, int64_t num_virt_blocks_54594, int64_t num_virt_threads_54595, __global unsigned char *current_partition_mem_53524, __global unsigned char *mem_53542, __global unsigned char *mem_53544, __global unsigned char *mem_53546, __global unsigned char *status_flags_mem_54596, __global unsigned char *aggregates_mem_54618, __global unsigned char *incprefixes_mem_54620, __global unsigned char *aggregates_mem_54622, __global unsigned char *incprefixes_mem_54624, __global unsigned char *global_dynid_mem_54626)\n{\n    #define segsca",
                                    "n_tblock_sizze_46779 (add_next_partition_doublezisegscan_46784zisegscan_tblock_sizze_46779)\n    #define chunk_sizze_54593 (add_next_partition_doublezisegscan_46784zichunk_sizze_54593)\n    \n    volatile __local unsigned char *local_mem_54658_backing_0 = &shared_mem[0];\n    const int64_t local_mem_54658_backing_0_offset = 0 + (smax64(smax64((int64_t) 544, sdiv_up64((int64_t) 8 * segscan_tblock_sizze_46779, (int64_t) 8) * (int64_t) 8 + (int64_t) 8 * segscan_tblock_sizze_46779), smax64(chunk_sizze_54593 * segscan_tblock_sizze_46779 * (int64_t) 8, chunk_sizze_54593 * segscan_tblock_sizze_46779 * (int64_t) 8)) + srem64((int64_t) 8 - srem64(smax64(smax64((int64_t) 544, sdiv_up64((int64_t) 8 * segscan_tblock_sizze_46779, (int64_t) 8) * (int64_t) 8 + (int64_t) 8 * segscan_tblock_sizze_46779), smax64(chunk_sizze_54593 * segscan_tblock_sizze_46779 * (int64_t) 8, chunk_sizze_54593 * segscan_tblock_sizze_46779 * (int64_t) 8)), (int64_t) 8), (int64_t) 8));\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_54649;\n    int32_t tblock_sizze_54652;\n    int32_t wave_sizze_54651;\n    int32_t block_id_54650;\n    int32_t global_tid_54648;\n    int64_t phys_tid_46784;\n    int32_t chunk_sizze_32b_54653;\n    int64_t byte_offsets_54654;\n    int64_t byte_offsets_54655;\n    int64_t warp_byte_offset_54656;\n    int64_t warp_byte_offset_54657;\n    __local unsigned char *local_mem_54658;\n    int64_t trans_arr_len_54659;\n    int64_t phys_block_id_54668;\n    int64_t virtloop_bound_54669;\n    \n    local_tid_54649 = get_local_id(0);\n    tblock_sizze_54652 = get_local_size(0);\n    wave_sizze_54651 = LOCKSTEP_WIDTH;\n    block_id_54650 = get_tblock_id(0);\n    global_tid_54648 = block_id_54650 * tblock_sizze_54652 + local_tid_54649;\n    phys_tid_46784 = sext_i32_i64(global_tid_54648);\n    chunk_sizze_32b_54653 = sext_i64_i32(chunk_sizze_54593);\n    byte_offsets_54654 = segscan_tblock_sizze_46779 * (int64_t) 8;\n    byte_offsets_54655 = sdiv_up64(byte_offsets_54654, (int64_t) 8) * ", "(int64_t) 8 + segscan_tblock_sizze_46779 * (int64_t) 8;\n    warp_byte_offset_54656 = (int64_t) 288;\n    warp_byte_offset_54657 = sdiv_up64(warp_byte_offset_54656, (int64_t) 8) * (int64_t) 8 + (int64_t) 256;\n    // Allocate reusable shared memory\n    { }\n    local_mem_54658 = (__local unsigned char *) local_mem_54658_backing_0;\n    trans_arr_len_54659 = chunk_sizze_54593 * segscan_tblock_sizze_46779;\n    phys_block_id_54668 = get_tblock_id(0);\n    virtloop_bound_54669 = sdiv_up64(num_virt_blocks_54594 - phys_block_id_54668, num_tblocks_46781);\n    for (int64_t virtloop_i_54670 = 0; virtloop_i_54670 < virtloop_bound_54669; virtloop_i_54670++) {\n        int64_t dynamic_id_54671;\n        int64_t block_offset_54672;\n        int64_t sgm_idx_54673;\n        int32_t boundary_54674;\n        int32_t segsizze_compact_54675;\n        int64_t private_mem_54676[chunk_sizze_54593];\n        int64_t private_mem_54678[chunk_sizze_54593];\n        int64_t thd_offset_54680;\n        int64_t acc_54706;\n        int64_t acc_54707;\n        int64_t prefix_54720;\n        int64_t prefix_54721;\n        bool block_new_sgm_54722;\n        \n        // First thread in block fetches this block's dynamic_id\n        {\n            if (local_tid_54649 == 0) {\n                dynamic_id_54671 = atomic_add_i32_global(&((volatile __global int *) global_dynid_mem_54626)[(int64_t) 0], (int) 1);\n                // Set dynamic id for this block\n                {\n                    ((__local int64_t *) local_mem_54658)[(int64_t) 0] = dynamic_id_54671;\n                }\n                // First thread in last (virtual) block resets global dynamic_id\n                {\n                    if (dynamic_id_54671 == num_virt_blocks_54594 - (int64_t) 1) {\n                        ((__global int32_t *) global_dynid_mem_54626)[(int64_t) 0] = 0;\n                    }\n                }\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        dynamic_id_54671 = ((__local int32_t *) local_mem_54658)[(int64_t) 0];\n  ", "      barrier(CLK_LOCAL_MEM_FENCE);\n        block_offset_54672 = dynamic_id_54671 * chunk_sizze_54593 * segscan_tblock_sizze_46779;\n        sgm_idx_54673 = smod64(block_offset_54672, n_old_28413);\n        boundary_54674 = sext_i64_i32(smin64(chunk_sizze_54593 * segscan_tblock_sizze_46779, n_old_28413 - sgm_idx_54673));\n        segsizze_compact_54675 = sext_i64_i32(smin64(chunk_sizze_54593 * segscan_tblock_sizze_46779, n_old_28413));\n        thd_offset_54680 = block_offset_54672 + sext_i32_i64(local_tid_54649);\n        // Load and map\n        {\n            for (int64_t i_54681 = 0; i_54681 < chunk_sizze_54593; i_54681++) {\n                int64_t virt_tid_54682 = thd_offset_54680 + i_54681 * segscan_tblock_sizze_46779;\n                int64_t slice_54683 = n_old_28413;\n                int64_t gtid_46783 = virt_tid_54682;\n                int64_t remnant_54684 = virt_tid_54682 - gtid_46783;\n                \n                if (slt64(virt_tid_54682, n_old_28413)) {\n                    bool x_44796 = ((__global bool *) current_partition_mem_53524)[gtid_46783];\n                    bool cond_neg_44797 = !x_44796;\n                    int64_t defunc_0_lifted_pzq_res_44798 = btoi_bool_i64(cond_neg_44797);\n                    bool is_i_44799 = defunc_0_lifted_pzq_res_44798 == (int64_t) 0;\n                    int64_t part_res_44800 = btoi_bool_i64(is_i_44799);\n                    int64_t part_res_44801;\n                    int64_t part_res_44802;\n                    \n                    if (is_i_44799) {\n                        part_res_44801 = (int64_t) 0;\n                        part_res_44802 = (int64_t) 0;\n                    } else {\n                        bool is_i_44803 = defunc_0_lifted_pzq_res_44798 == (int64_t) 1;\n                        int64_t part_res_44804;\n                        \n                        if (is_i_44803) {\n                            part_res_44804 = (int64_t) 1;\n                        } else {\n                            part_res_44804 = (int64",
                                    "_t) 2;\n                        }\n                        \n                        int64_t part_res_44805 = btoi_bool_i64(is_i_44803);\n                        \n                        part_res_44801 = part_res_44804;\n                        part_res_44802 = part_res_44805;\n                    }\n                    ((__global int64_t *) mem_53546)[gtid_46783] = part_res_44801;\n                    private_mem_54676[i_54681] = part_res_44800;\n                    private_mem_54678[i_54681] = part_res_44802;\n                } else {\n                    private_mem_54676[i_54681] = (int64_t) 0;\n                    private_mem_54678[i_54681] = (int64_t) 0;\n                }\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        // Transpose scan inputs\n        {\n            for (int64_t i_54685 = 0; i_54685 < chunk_sizze_54593; i_54685++) {\n                int64_t sharedIdx_54686 = sext_i32_i64(local_tid_54649) + i_54685 * segscan_tblock_sizze_46779;\n                int64_t tmp_54687 = private_mem_54676[i_54685];\n                \n                ((__local int64_t *) local_mem_54658)[sharedIdx_54686] = tmp_54687;\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            for (int64_t i_54688 = 0; i_54688 < chunk_sizze_54593; i_54688++) {\n                int64_t sharedIdx_54689 = sext_i32_i64(local_tid_54649) * chunk_sizze_54593 + i_54688;\n                int64_t tmp_54690 = ((__local int64_t *) local_mem_54658)[sharedIdx_54689];\n                \n                private_mem_54676[i_54688] = tmp_54690;\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            for (int64_t i_54691 = 0; i_54691 < chunk_sizze_54593; i_54691++) {\n                int64_t sharedIdx_54692 = sext_i32_i64(local_tid_54649) + i_54691 * segscan_tblock_sizze_46779;\n                int64_t tmp_54693 = private_mem_54678[i_54691];\n                \n                ((__local int64_t *) local_mem_54658)[sharedIdx_54692] = tmp_54693;\n            }\n            barrier(CLK_LOCAL_ME", "M_FENCE);\n            for (int64_t i_54694 = 0; i_54694 < chunk_sizze_54593; i_54694++) {\n                int64_t sharedIdx_54695 = sext_i32_i64(local_tid_54649) * chunk_sizze_54593 + i_54694;\n                int64_t tmp_54696 = ((__local int64_t *) local_mem_54658)[sharedIdx_54695];\n                \n                private_mem_54678[i_54694] = tmp_54696;\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n        }\n        // Per thread scan\n        {\n            for (int64_t i_54697 = 0; i_54697 < chunk_sizze_54593 - (int64_t) 1; i_54697++) {\n                int64_t x_41320;\n                int64_t y_41322;\n                \n                x_41320 = private_mem_54676[i_54697];\n                y_41322 = private_mem_54676[i_54697 + (int64_t) 1];\n                \n                int64_t x_41321;\n                int64_t y_41323;\n                \n                x_41321 = private_mem_54678[i_54697];\n                y_41323 = private_mem_54678[i_54697 + (int64_t) 1];\n                \n                int64_t zz_41324 = x_41320 + y_41322;\n                int64_t zz_41325 = x_41321 + y_41323;\n                \n                private_mem_54676[i_54697 + (int64_t) 1] = zz_41324;\n                private_mem_54678[i_54697 + (int64_t) 1] = zz_41325;\n            }\n        }\n        // Publish results in shared memory\n        {\n            int64_t tmp_54698 = private_mem_54676[chunk_sizze_54593 - (int64_t) 1];\n            \n            ((__local int64_t *) local_mem_54658)[sext_i32_i64(local_tid_54649)] = tmp_54698;\n            \n            int64_t tmp_54699 = private_mem_54678[chunk_sizze_54593 - (int64_t) 1];\n            \n            ((__local int64_t *) local_mem_54658)[squot64(byte_offsets_54654, (int64_t) 8) + sext_i32_i64(local_tid_54649)] = tmp_54699;\n            barrier(CLK_LOCAL_MEM_FENCE);\n        }\n        // Scan results (with warp scan)\n        {\n            int64_t x_54700;\n            int64_t x_54701;\n            int64_t y_54702;\n            int64_t y_54703;\n   ", "         int64_t x_54708;\n            int64_t x_54709;\n            int64_t y_54710;\n            int64_t y_54711;\n            bool ltid_in_bounds_54714 = slt64(sext_i32_i64(local_tid_54649), num_virt_threads_54595);\n            int32_t skip_threads_54715;\n            \n            // read input for in-block scan\n            {\n                if (ltid_in_bounds_54714) {\n                    y_54702 = ((volatile __local int64_t *) local_mem_54658)[sext_i32_i64(local_tid_54649)];\n                    y_54703 = ((volatile __local int64_t *) local_mem_54658)[squot64(byte_offsets_54654, (int64_t) 8) + sext_i32_i64(local_tid_54649)];\n                    if ((local_tid_54649 - squot32(local_tid_54649, 32) * 32) == 0) {\n                        x_54700 = y_54702;\n                        x_54701 = y_54703;\n                    }\n                }\n            }\n            // in-block scan (hopefully no barriers needed)\n            {\n                skip_threads_54715 = 1;\n                while (slt32(skip_threads_54715, 32)) {\n                    bool thread_active_54716 = sle32(skip_threads_54715, local_tid_54649 - squot32(local_tid_54649, 32) * 32) && ltid_in_bounds_54714;\n                    \n                    if (thread_active_54716) {\n                        // read operands\n                        {\n                            x_54700 = ((volatile __local int64_t *) local_mem_54658)[sext_i32_i64(local_tid_54649) - sext_i32_i64(skip_threads_54715)];\n                            x_54701 = ((volatile __local int64_t *) local_mem_54658)[squot64(byte_offsets_54654, (int64_t) 8) + (sext_i32_i64(local_tid_54649) - sext_i32_i64(skip_threads_54715))];\n                        }\n                    }\n                    // perform operation\n                    {\n                        if (thread_active_54716) {\n                            int64_t zz_54704 = x_54700 + y_54702;\n                            int64_t zz_54705 = x_54701 + y_54703;\n                            \n               ",
                                    "             x_54700 = zz_54704;\n                            x_54701 = zz_54705;\n                        }\n                    }\n                    if (sle32(wave_sizze_54651, skip_threads_54715)) {\n                        barrier(CLK_LOCAL_MEM_FENCE);\n                    }\n                    if (thread_active_54716) {\n                        // write result\n                        {\n                            ((volatile __local int64_t *) local_mem_54658)[sext_i32_i64(local_tid_54649)] = x_54700;\n                            y_54702 = x_54700;\n                            ((volatile __local int64_t *) local_mem_54658)[squot64(byte_offsets_54654, (int64_t) 8) + sext_i32_i64(local_tid_54649)] = x_54701;\n                            y_54703 = x_54701;\n                        }\n                    }\n                    if (sle32(wave_sizze_54651, skip_threads_54715)) {\n                        barrier(CLK_LOCAL_MEM_FENCE);\n                    }\n                    skip_threads_54715 *= 2;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // last thread of block 'i' writes its result to offset 'i'\n            {\n                if ((local_tid_54649 - squot32(local_tid_54649, 32) * 32) == 31 && ltid_in_bounds_54714) {\n                    ((volatile __local int64_t *) local_mem_54658)[sext_i32_i64(squot32(local_tid_54649, 32))] = x_54700;\n                    ((volatile __local int64_t *) local_mem_54658)[squot64(byte_offsets_54654, (int64_t) 8) + sext_i32_i64(squot32(local_tid_54649, 32))] = x_54701;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // scan the first block, after which offset 'i' contains carry-in for block 'i+1'\n            {\n                int32_t skip_threads_54717;\n                \n                // read input for in-block scan\n                {\n                    if (squot32(local_tid_54649, 32) == 0 && ltid_in_bounds_54714) {\n                        y_54710 = ((volatile __local", " int64_t *) local_mem_54658)[sext_i32_i64(local_tid_54649)];\n                        y_54711 = ((volatile __local int64_t *) local_mem_54658)[squot64(byte_offsets_54654, (int64_t) 8) + sext_i32_i64(local_tid_54649)];\n                        if ((local_tid_54649 - squot32(local_tid_54649, 32) * 32) == 0) {\n                            x_54708 = y_54710;\n                            x_54709 = y_54711;\n                        }\n                    }\n                }\n                // in-block scan (hopefully no barriers needed)\n                {\n                    skip_threads_54717 = 1;\n                    while (slt32(skip_threads_54717, 32)) {\n                        bool thread_active_54718 = sle32(skip_threads_54717, local_tid_54649 - squot32(local_tid_54649, 32) * 32) && (squot32(local_tid_54649, 32) == 0 && ltid_in_bounds_54714);\n                        \n                        if (thread_active_54718) {\n                            // read operands\n                            {\n                                x_54708 = ((volatile __local int64_t *) local_mem_54658)[sext_i32_i64(local_tid_54649) - sext_i32_i64(skip_threads_54717)];\n                                x_54709 = ((volatile __local int64_t *) local_mem_54658)[squot64(byte_offsets_54654, (int64_t) 8) + (sext_i32_i64(local_tid_54649) - sext_i32_i64(skip_threads_54717))];\n                            }\n                        }\n                        // perform operation\n                        {\n                            if (thread_active_54718) {\n                                int64_t zz_54712 = x_54708 + y_54710;\n                                int64_t zz_54713 = x_54709 + y_54711;\n                                \n                                x_54708 = zz_54712;\n                                x_54709 = zz_54713;\n                            }\n                        }\n                        if (sle32(wave_sizze_54651, skip_threads_54717)) {\n                            barrier(CLK_LOCAL_MEM_FENCE", ");\n                        }\n                        if (thread_active_54718) {\n                            // write result\n                            {\n                                ((volatile __local int64_t *) local_mem_54658)[sext_i32_i64(local_tid_54649)] = x_54708;\n                                y_54710 = x_54708;\n                                ((volatile __local int64_t *) local_mem_54658)[squot64(byte_offsets_54654, (int64_t) 8) + sext_i32_i64(local_tid_54649)] = x_54709;\n                                y_54711 = x_54709;\n                            }\n                        }\n                        if (sle32(wave_sizze_54651, skip_threads_54717)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        skip_threads_54717 *= 2;\n                    }\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            \n            bool no_carry_in_54719 = squot32(local_tid_54649, 32) == 0 || !ltid_in_bounds_54714;\n            \n            // carry-in for every block except the first\n            {\n                // read operands\n                {\n                    if (!no_carry_in_54719) {\n                        y_54702 = x_54700;\n                        y_54703 = x_54701;\n                        x_54700 = ((__local int64_t *) local_mem_54658)[sext_i32_i64(squot32(local_tid_54649, 32)) - (int64_t) 1];\n                        x_54701 = ((__local int64_t *) local_mem_54658)[squot64(byte_offsets_54654, (int64_t) 8) + (sext_i32_i64(squot32(local_tid_54649, 32)) - (int64_t) 1)];\n                    }\n                }\n                // perform operation\n                {\n                    if (!no_carry_in_54719) {\n                        int64_t zz_54704 = x_54700 + y_54702;\n                        int64_t zz_54705 = x_54701 + y_54703;\n                        \n                        x_54700 = zz_54704;\n                        x_54701 = zz_54705;\n                    }\n               ",
                                    " }\n                // write final result\n                {\n                    if (!no_carry_in_54719) {\n                        ((__local int64_t *) local_mem_54658)[sext_i32_i64(local_tid_54649)] = x_54700;\n                        ((__local int64_t *) local_mem_54658)[squot64(byte_offsets_54654, (int64_t) 8) + sext_i32_i64(local_tid_54649)] = x_54701;\n                    }\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // restore correct values for first block\n            {\n                if (squot32(local_tid_54649, 32) == 0 && ltid_in_bounds_54714) {\n                    ((__local int64_t *) local_mem_54658)[sext_i32_i64(local_tid_54649)] = y_54702;\n                    ((__local int64_t *) local_mem_54658)[squot64(byte_offsets_54654, (int64_t) 8) + sext_i32_i64(local_tid_54649)] = y_54703;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            barrier(CLK_LOCAL_MEM_FENCE);\n            if (local_tid_54649 == 0) {\n                acc_54706 = ((__local int64_t *) local_mem_54658)[segscan_tblock_sizze_46779 - (int64_t) 1];\n                acc_54707 = ((__local int64_t *) local_mem_54658)[squot64(byte_offsets_54654, (int64_t) 8) + (segscan_tblock_sizze_46779 - (int64_t) 1)];\n            } else {\n                acc_54706 = ((__local int64_t *) local_mem_54658)[sext_i32_i64(local_tid_54649) - (int64_t) 1];\n                acc_54707 = ((__local int64_t *) local_mem_54658)[squot64(byte_offsets_54654, (int64_t) 8) + (sext_i32_i64(local_tid_54649) - (int64_t) 1)];\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n        }\n        prefix_54720 = (int64_t) 0;\n        prefix_54721 = (int64_t) 0;\n        block_new_sgm_54722 = sgm_idx_54673 == (int64_t) 0;\n        // Perform lookback\n        {\n            if (block_new_sgm_54722 && local_tid_54649 == 0) {\n                ((volatile __global int64_t *) incprefixes_mem_54620)[dynamic_id_54671] = acc_54706;\n                ((volatile __global int64_t *) ", "incprefixes_mem_54624)[dynamic_id_54671] = acc_54707;\n                mem_fence_global();\n                ((volatile __global int8_t *) status_flags_mem_54596)[dynamic_id_54671] = (int8_t) 2;\n                acc_54706 = (int64_t) 0;\n                acc_54707 = (int64_t) 0;\n            }\n            if (!block_new_sgm_54722 && slt32(local_tid_54649, wave_sizze_54651)) {\n                if (local_tid_54649 == 0) {\n                    ((volatile __global int64_t *) aggregates_mem_54618)[dynamic_id_54671] = acc_54706;\n                    ((volatile __global int64_t *) aggregates_mem_54622)[dynamic_id_54671] = acc_54707;\n                    mem_fence_global();\n                    ((volatile __global int8_t *) status_flags_mem_54596)[dynamic_id_54671] = (int8_t) 1;\n                    \n                    int8_t tmp_54723 = ((volatile __global int8_t *) status_flags_mem_54596)[dynamic_id_54671 - (int64_t) 1];\n                    \n                    ((volatile __local int8_t *) local_mem_54658)[(int64_t) 0] = tmp_54723;\n                }\n                mem_fence_local();\n                \n                int8_t status_54724 = ((__local int8_t *) local_mem_54658)[(int64_t) 0];\n                \n                if (status_54724 == (int8_t) 2) {\n                    if (local_tid_54649 == 0) {\n                        prefix_54720 = ((volatile __global int64_t *) incprefixes_mem_54620)[dynamic_id_54671 - (int64_t) 1];\n                        prefix_54721 = ((volatile __global int64_t *) incprefixes_mem_54624)[dynamic_id_54671 - (int64_t) 1];\n                    }\n                } else {\n                    int32_t readOffset_54725 = sext_i64_i32(dynamic_id_54671 - sext_i32_i64(wave_sizze_54651));\n                    \n                    while (slt32(wave_sizze_54651 * -1, readOffset_54725)) {\n                        int32_t read_i_54726 = readOffset_54725 + local_tid_54649;\n                        int64_t aggr_54727 = (int64_t) 0;\n                        int64_t aggr_54728 = (", "int64_t) 0;\n                        int8_t flag_54729 = (int8_t) 0;\n                        \n                        if (sle32(0, read_i_54726)) {\n                            flag_54729 = ((volatile __global int8_t *) status_flags_mem_54596)[sext_i32_i64(read_i_54726)];\n                            if (flag_54729 == (int8_t) 2) {\n                                aggr_54727 = ((volatile __global int64_t *) incprefixes_mem_54620)[sext_i32_i64(read_i_54726)];\n                                aggr_54728 = ((volatile __global int64_t *) incprefixes_mem_54624)[sext_i32_i64(read_i_54726)];\n                            } else if (flag_54729 == (int8_t) 1) {\n                                aggr_54727 = ((volatile __global int64_t *) aggregates_mem_54618)[sext_i32_i64(read_i_54726)];\n                                aggr_54728 = ((volatile __global int64_t *) aggregates_mem_54622)[sext_i32_i64(read_i_54726)];\n                            }\n                        }\n                        ((__local int64_t *) local_mem_54658)[(int64_t) 4 + sext_i32_i64(local_tid_54649)] = aggr_54727;\n                        ((__local int64_t *) local_mem_54658)[squot64(warp_byte_offset_54656, (int64_t) 8) + sext_i32_i64(local_tid_54649)] = aggr_54728;\n                        ((__local int8_t *) local_mem_54658)[sext_i32_i64(local_tid_54649)] = flag_54729;\n                        flag_54729 = ((__local int8_t *) local_mem_54658)[sext_i32_i64(wave_sizze_54651) - (int64_t) 1];\n                        if (slt8(flag_54729, (int8_t) 2)) {\n                            int8_t flg_x_54736;\n                            int8_t flg_y_54737;\n                            int64_t x_54730;\n                            int64_t x_54731;\n                            int64_t y_54732;\n                            int64_t y_54733;\n                            int32_t skip_threads_54738;\n                            \n                            // read input for in-block scan\n                            {\n                       ",
                                    "         flg_y_54737 = ((volatile __local int8_t *) local_mem_54658)[sext_i32_i64(local_tid_54649)];\n                                y_54732 = ((volatile __local int64_t *) local_mem_54658)[(int64_t) 4 + sext_i32_i64(local_tid_54649)];\n                                y_54733 = ((volatile __local int64_t *) local_mem_54658)[squot64(warp_byte_offset_54656, (int64_t) 8) + sext_i32_i64(local_tid_54649)];\n                                if ((local_tid_54649 - squot32(local_tid_54649, 32) * 32) == 0) {\n                                    x_54730 = y_54732;\n                                    x_54731 = y_54733;\n                                    flg_x_54736 = flg_y_54737;\n                                }\n                            }\n                            // in-block scan (hopefully no barriers needed)\n                            {\n                                skip_threads_54738 = 1;\n                                while (slt32(skip_threads_54738, 32)) {\n                                    if (sle32(skip_threads_54738, local_tid_54649 - squot32(local_tid_54649, 32) * 32)) {\n                                        // read operands\n                                        {\n                                            flg_x_54736 = ((volatile __local int8_t *) local_mem_54658)[sext_i32_i64(local_tid_54649) - sext_i32_i64(skip_threads_54738)];\n                                            x_54730 = ((volatile __local int64_t *) local_mem_54658)[(int64_t) 4 + (sext_i32_i64(local_tid_54649) - sext_i32_i64(skip_threads_54738))];\n                                            x_54731 = ((volatile __local int64_t *) local_mem_54658)[squot64(warp_byte_offset_54656, (int64_t) 8) + (sext_i32_i64(local_tid_54649) - sext_i32_i64(skip_threads_54738))];\n                                        }\n                                        // perform operation\n                                        {\n                                            if (flg_y_54737 == (int8_t) 2 || flg_y_54737 ", "== (int8_t) 0) {\n                                                flg_x_54736 = flg_y_54737;\n                                                x_54730 = y_54732;\n                                                x_54731 = y_54733;\n                                            } else {\n                                                int64_t zz_54734 = x_54730 + y_54732;\n                                                int64_t zz_54735 = x_54731 + y_54733;\n                                                \n                                                x_54730 = zz_54734;\n                                                x_54731 = zz_54735;\n                                            }\n                                        }\n                                        // write result\n                                        {\n                                            ((volatile __local int8_t *) local_mem_54658)[sext_i32_i64(local_tid_54649)] = flg_x_54736;\n                                            flg_y_54737 = flg_x_54736;\n                                            ((volatile __local int64_t *) local_mem_54658)[(int64_t) 4 + sext_i32_i64(local_tid_54649)] = x_54730;\n                                            y_54732 = x_54730;\n                                            ((volatile __local int64_t *) local_mem_54658)[squot64(warp_byte_offset_54656, (int64_t) 8) + sext_i32_i64(local_tid_54649)] = x_54731;\n                                            y_54733 = x_54731;\n                                        }\n                                    }\n                                    skip_threads_54738 *= 2;\n                                }\n                            }\n                        }\n                        flag_54729 = ((__local int8_t *) local_mem_54658)[sext_i32_i64(wave_sizze_54651) - (int64_t) 1];\n                        aggr_54727 = ((__local int64_t *) local_mem_54658)[(int64_t) 4 + (sext_i32_i64(wave_sizze_54651) - (int64_t) 1)];\n                        aggr", "_54728 = ((__local int64_t *) local_mem_54658)[squot64(warp_byte_offset_54656, (int64_t) 8) + (sext_i32_i64(wave_sizze_54651) - (int64_t) 1)];\n                        if (flag_54729 == (int8_t) 2) {\n                            readOffset_54725 = wave_sizze_54651 * -1;\n                        } else if (flag_54729 == (int8_t) 1) {\n                            readOffset_54725 -= wave_sizze_54651;\n                        }\n                        if (slt8((int8_t) 0, flag_54729)) {\n                            int64_t x_54739 = aggr_54727;\n                            int64_t x_54740 = aggr_54728;\n                            int64_t y_54741 = prefix_54720;\n                            int64_t y_54742 = prefix_54721;\n                            int64_t zz_54743 = x_54739 + y_54741;\n                            int64_t zz_54744 = x_54740 + y_54742;\n                            \n                            prefix_54720 = zz_54743;\n                            prefix_54721 = zz_54744;\n                        }\n                        mem_fence_local();\n                    }\n                }\n                if (local_tid_54649 == 0) {\n                    if (boundary_54674 == sext_i64_i32(segscan_tblock_sizze_46779 * chunk_sizze_54593)) {\n                        int64_t x_54745 = prefix_54720;\n                        int64_t x_54746 = prefix_54721;\n                        int64_t y_54747 = acc_54706;\n                        int64_t y_54748 = acc_54707;\n                        int64_t zz_54749 = x_54745 + y_54747;\n                        int64_t zz_54750 = x_54746 + y_54748;\n                        \n                        ((volatile __global int64_t *) incprefixes_mem_54620)[dynamic_id_54671] = zz_54749;\n                        ((volatile __global int64_t *) incprefixes_mem_54624)[dynamic_id_54671] = zz_54750;\n                        mem_fence_global();\n                        ((volatile __global int8_t *) status_flags_mem_54596)[dynamic_id_54671] = (int8_t) 2;\n                 ",
                                    "   }\n                    ((__local int64_t *) local_mem_54658)[(int64_t) 4] = prefix_54720;\n                    ((__local int64_t *) local_mem_54658)[squot64(warp_byte_offset_54656, (int64_t) 8)] = prefix_54721;\n                    acc_54706 = (int64_t) 0;\n                    acc_54707 = (int64_t) 0;\n                }\n            }\n            if (!(dynamic_id_54671 == (int64_t) 0)) {\n                barrier(CLK_LOCAL_MEM_FENCE);\n                prefix_54720 = ((__local int64_t *) local_mem_54658)[(int64_t) 4];\n                prefix_54721 = ((__local int64_t *) local_mem_54658)[squot64(warp_byte_offset_54656, (int64_t) 8)];\n                barrier(CLK_LOCAL_MEM_FENCE);\n            }\n        }\n        // Distribute results\n        {\n            int64_t x_54751;\n            int64_t y_54753;\n            int64_t x_54757 = prefix_54720;\n            int64_t y_54759 = acc_54706;\n            int64_t x_54752;\n            int64_t y_54754;\n            int64_t x_54758 = prefix_54721;\n            int64_t y_54760 = acc_54707;\n            \n            if (slt32(local_tid_54649 * chunk_sizze_32b_54653, boundary_54674) && !block_new_sgm_54722) {\n                int64_t zz_54761 = x_54757 + y_54759;\n                int64_t zz_54762 = x_54758 + y_54760;\n                \n                x_54751 = zz_54761;\n                x_54752 = zz_54762;\n            } else {\n                x_54751 = acc_54706;\n                x_54752 = acc_54707;\n            }\n            \n            int32_t stopping_point_54763 = segsizze_compact_54675 - srem32(local_tid_54649 * chunk_sizze_32b_54653 - 1 + segsizze_compact_54675 - boundary_54674, segsizze_compact_54675);\n            \n            for (int64_t i_54764 = 0; i_54764 < chunk_sizze_54593; i_54764++) {\n                if (slt32(sext_i64_i32(i_54764), stopping_point_54763 - 1)) {\n                    y_54753 = private_mem_54676[i_54764];\n                    y_54754 = private_mem_54678[i_54764];\n                    \n                    int64_t zz_54755 =", " x_54751 + y_54753;\n                    int64_t zz_54756 = x_54752 + y_54754;\n                    \n                    private_mem_54676[i_54764] = zz_54755;\n                    private_mem_54678[i_54764] = zz_54756;\n                }\n            }\n        }\n        // Transpose scan output and Write it to global memory in coalesced fashion\n        {\n            for (int64_t i_54765 = 0; i_54765 < chunk_sizze_54593; i_54765++) {\n                int64_t sharedIdx_54766 = sext_i32_i64(local_tid_54649) * chunk_sizze_54593 + i_54765;\n                int64_t tmp_54767 = private_mem_54676[i_54765];\n                \n                ((__local int64_t *) local_mem_54658)[sharedIdx_54766] = tmp_54767;\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            for (int64_t i_54768 = 0; i_54768 < chunk_sizze_54593; i_54768++) {\n                int64_t flat_idx_54769 = thd_offset_54680 + i_54768 * segscan_tblock_sizze_46779;\n                int64_t slice_54770 = n_old_28413;\n                int64_t gtid_46783 = flat_idx_54769;\n                int64_t remnant_54771 = flat_idx_54769 - gtid_46783;\n                \n                if (slt64(flat_idx_54769, n_old_28413)) {\n                    int64_t tmp_54772 = ((__local int64_t *) local_mem_54658)[flat_idx_54769 - block_offset_54672];\n                    \n                    ((__global int64_t *) mem_53542)[gtid_46783] = tmp_54772;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            for (int64_t i_54773 = 0; i_54773 < chunk_sizze_54593; i_54773++) {\n                int64_t sharedIdx_54774 = sext_i32_i64(local_tid_54649) * chunk_sizze_54593 + i_54773;\n                int64_t tmp_54775 = private_mem_54678[i_54773];\n                \n                ((__local int64_t *) local_mem_54658)[sharedIdx_54774] = tmp_54775;\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            for (int64_t i_54776 = 0; i_54776 < chunk_sizze_54593; i_54776++) {\n                int64_t flat_idx_54777 = thd", "_offset_54680 + i_54776 * segscan_tblock_sizze_46779;\n                int64_t slice_54778 = n_old_28413;\n                int64_t gtid_46783 = flat_idx_54777;\n                int64_t remnant_54779 = flat_idx_54777 - gtid_46783;\n                \n                if (slt64(flat_idx_54777, n_old_28413)) {\n                    int64_t tmp_54780 = ((__local int64_t *) local_mem_54658)[flat_idx_54777 - block_offset_54672];\n                    \n                    ((__global int64_t *) mem_53544)[gtid_46783] = tmp_54780;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n        }\n    }\n    \n  error_3:\n    return;\n    #undef segscan_tblock_sizze_46779\n    #undef chunk_sizze_54593\n}\nFUTHARK_KERNEL_SIZED(add_next_partition_doublezisegscan_46800_dim1, 1, 1)\nvoid add_next_partition_doublezisegscan_46800(__global int *global_failure, int failure_is_an_option, __global int64_t *global_failure_args, int64_t dz2082U_28418, int64_t dz2083U_28419, double zt_res_40980, int64_t dzlz7bUZLzpZRz20Udz2082Uz20Udz2084Uz2088Uz2083Uz7dUzg_41379, unsigned char cond_41383_bits, int64_t num_tblocks_46797, int64_t num_virt_blocks_55322, int64_t num_virt_threads_55323, __global unsigned char *clProc_mem_53514, __global unsigned char *clProc_mem_53515, __global unsigned char *clProc_mem_53517, __global unsigned char *mem_53548, __global unsigned char *mem_53550, __global unsigned char *ext_mem_53557, __global unsigned char *ext_mem_53560, __global unsigned char *ext_mem_53563, __global unsigned char *ext_mem_53566, __global unsigned char *ext_mem_53569, __global unsigned char *ext_mem_53572, __global unsigned char *mem_53581, __global unsigned char *mem_53704, __global unsigned char *mem_53706, __global unsigned char *mem_53708, __global unsigned char *status_flags_mem_55324, __global unsigned char *aggregates_mem_55326, __global unsigned char *incprefixes_mem_55328, __global unsigned char *aggregates_mem_55330, __global unsigned char *incprefixes_mem_55332, __global unsigned ch",
                                    "ar *global_dynid_mem_55334)\n{\n    bool cond_41383 = cond_41383_bits;\n    \n    #define segscan_tblock_sizze_46795 (add_next_partition_doublezisegscan_46800zisegscan_tblock_sizze_46795)\n    #define chunk_sizze_55321 (add_next_partition_doublezisegscan_46800zichunk_sizze_55321)\n    \n    volatile __local unsigned char *local_mem_55346_backing_0 = &shared_mem[0];\n    const int64_t local_mem_55346_backing_0_offset = 0 + (smax64(smax64((int64_t) 544, sdiv_up64((int64_t) 8 * segscan_tblock_sizze_46795, (int64_t) 8) * (int64_t) 8 + (int64_t) 8 * segscan_tblock_sizze_46795), smax64(chunk_sizze_55321 * segscan_tblock_sizze_46795 * (int64_t) 8, chunk_sizze_55321 * segscan_tblock_sizze_46795 * (int64_t) 8)) + srem64((int64_t) 8 - srem64(smax64(smax64((int64_t) 544, sdiv_up64((int64_t) 8 * segscan_tblock_sizze_46795, (int64_t) 8) * (int64_t) 8 + (int64_t) 8 * segscan_tblock_sizze_46795), smax64(chunk_sizze_55321 * segscan_tblock_sizze_46795 * (int64_t) 8, chunk_sizze_55321 * segscan_tblock_sizze_46795 * (int64_t) 8)), (int64_t) 8), (int64_t) 8));\n    volatile __local int local_failure;\n    \n    if (failure_is_an_option) {\n        int failed = *global_failure >= 0;\n        \n        if (failed)\n            return;\n    }\n    local_failure = 0;\n    barrier(CLK_LOCAL_MEM_FENCE);\n    \n    int32_t local_tid_55337;\n    int32_t tblock_sizze_55340;\n    int32_t wave_sizze_55339;\n    int32_t block_id_55338;\n    int32_t global_tid_55336;\n    int64_t phys_tid_46800;\n    int32_t chunk_sizze_32b_55341;\n    int64_t byte_offsets_55342;\n    int64_t byte_offsets_55343;\n    int64_t warp_byte_offset_55344;\n    int64_t warp_byte_offset_55345;\n    __local unsigned char *local_mem_55346;\n    int64_t trans_arr_len_55347;\n    int64_t phys_block_id_55356;\n    int64_t virtloop_bound_55357;\n    \n    local_tid_55337 = get_local_id(0);\n    tblock_sizze_55340 = get_local_size(0);\n    wave_sizze_55339 = LOCKSTEP_WIDTH;\n    block_id_55338 = get_tblock_id(0);\n    global_tid_55336 = block_id_55338 * tblock_sizze_553", "40 + local_tid_55337;\n    phys_tid_46800 = sext_i32_i64(global_tid_55336);\n    chunk_sizze_32b_55341 = sext_i64_i32(chunk_sizze_55321);\n    byte_offsets_55342 = segscan_tblock_sizze_46795 * (int64_t) 8;\n    byte_offsets_55343 = sdiv_up64(byte_offsets_55342, (int64_t) 8) * (int64_t) 8 + segscan_tblock_sizze_46795 * (int64_t) 8;\n    warp_byte_offset_55344 = (int64_t) 288;\n    warp_byte_offset_55345 = sdiv_up64(warp_byte_offset_55344, (int64_t) 8) * (int64_t) 8 + (int64_t) 256;\n    // Allocate reusable shared memory\n    { }\n    local_mem_55346 = (__local unsigned char *) local_mem_55346_backing_0;\n    trans_arr_len_55347 = chunk_sizze_55321 * segscan_tblock_sizze_46795;\n    phys_block_id_55356 = get_tblock_id(0);\n    virtloop_bound_55357 = sdiv_up64(num_virt_blocks_55322 - phys_block_id_55356, num_tblocks_46797);\n    for (int64_t virtloop_i_55358 = 0; virtloop_i_55358 < virtloop_bound_55357; virtloop_i_55358++) {\n        int64_t dynamic_id_55359;\n        int64_t block_offset_55360;\n        int64_t sgm_idx_55361;\n        int32_t boundary_55362;\n        int32_t segsizze_compact_55363;\n        int64_t private_mem_55364[chunk_sizze_55321];\n        int64_t private_mem_55366[chunk_sizze_55321];\n        int64_t thd_offset_55368;\n        int64_t acc_55397;\n        int64_t acc_55398;\n        int64_t prefix_55411;\n        int64_t prefix_55412;\n        bool block_new_sgm_55413;\n        \n        // First thread in block fetches this block's dynamic_id\n        {\n            if (local_tid_55337 == 0) {\n                dynamic_id_55359 = atomic_add_i32_global(&((volatile __global int *) global_dynid_mem_55334)[(int64_t) 0], (int) 1);\n                // Set dynamic id for this block\n                {\n                    ((__local int64_t *) local_mem_55346)[(int64_t) 0] = dynamic_id_55359;\n                }\n                // First thread in last (virtual) block resets global dynamic_id\n                {\n                    if (dynamic_id_55359 == num_virt_blocks_55322 - (int64_t) 1) ", "{\n                        ((__global int32_t *) global_dynid_mem_55334)[(int64_t) 0] = 0;\n                    }\n                }\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        dynamic_id_55359 = ((__local int32_t *) local_mem_55346)[(int64_t) 0];\n        barrier(CLK_LOCAL_MEM_FENCE);\n        block_offset_55360 = dynamic_id_55359 * chunk_sizze_55321 * segscan_tblock_sizze_46795;\n        sgm_idx_55361 = smod64(block_offset_55360, dzlz7bUZLzpZRz20Udz2082Uz20Udz2084Uz2088Uz2083Uz7dUzg_41379);\n        boundary_55362 = sext_i64_i32(smin64(chunk_sizze_55321 * segscan_tblock_sizze_46795, dzlz7bUZLzpZRz20Udz2082Uz20Udz2084Uz2088Uz2083Uz7dUzg_41379 - sgm_idx_55361));\n        segsizze_compact_55363 = sext_i64_i32(smin64(chunk_sizze_55321 * segscan_tblock_sizze_46795, dzlz7bUZLzpZRz20Udz2082Uz20Udz2084Uz2088Uz2083Uz7dUzg_41379));\n        thd_offset_55368 = block_offset_55360 + sext_i32_i64(local_tid_55337);\n        // Load and map\n        {\n            for (int64_t i_55369 = 0; i_55369 < chunk_sizze_55321; i_55369++) {\n                int64_t virt_tid_55370 = thd_offset_55368 + i_55369 * segscan_tblock_sizze_46795;\n                int64_t slice_55371 = dzlz7bUZLzpZRz20Udz2082Uz20Udz2084Uz2088Uz2083Uz7dUzg_41379;\n                int64_t gtid_46799 = virt_tid_55370;\n                int64_t remnant_55372 = virt_tid_55370 - gtid_46799;\n                \n                if (slt64(virt_tid_55370, dzlz7bUZLzpZRz20Udz2082Uz20Udz2084Uz2088Uz2083Uz7dUzg_41379)) {\n                    int64_t zv_rhs_53456 = ((__global int64_t *) mem_53581)[(int64_t) 0];\n                    double times_arg1_53457 = ((__global double *) ext_mem_53557)[(int64_t) 0];\n                    double plus_arg0_53458 = ((__global double *) ext_mem_53560)[(int64_t) 0];\n                    double times_arg1_53459 = ((__global double *) ext_mem_53563)[(int64_t) 0];\n                    double plus_arg0_53460 = ((__global double *) ext_mem_53566)[(int64_t) 0];\n                    double plus_arg1_53",
                                    "461 = ((__global double *) ext_mem_53569)[(int64_t) 0];\n                    double plus_arg1_53462 = ((__global double *) ext_mem_53572)[(int64_t) 0];\n                    bool index_concat_cmp_44735 = sle64(dz2082U_28418, gtid_46799);\n                    double index_concat_branch_44736;\n                    \n                    if (index_concat_cmp_44735) {\n                        int64_t index_concat_i_45264 = sub64(gtid_46799, dz2082U_28418);\n                        double index_concat_45265 = ((__global double *) mem_53548)[index_concat_i_45264];\n                        \n                        index_concat_branch_44736 = index_concat_45265;\n                    } else {\n                        double index_concat_44739 = ((__global double *) clProc_mem_53514)[gtid_46799];\n                        \n                        index_concat_branch_44736 = index_concat_44739;\n                    }\n                    \n                    double index_concat_branch_44740;\n                    \n                    if (index_concat_cmp_44735) {\n                        int64_t index_concat_i_45266 = sub64(gtid_46799, dz2082U_28418);\n                        double index_concat_45267 = ((__global double *) mem_53550)[index_concat_i_45266];\n                        \n                        index_concat_branch_44740 = index_concat_45267;\n                    } else {\n                        double index_concat_44743 = ((__global double *) clProc_mem_53515)[gtid_46799];\n                        \n                        index_concat_branch_44740 = index_concat_44743;\n                    }\n                    \n                    bool isNearAnyRelevant_44744;\n                    int64_t isNearAnyRelevant_44745;\n                    bool isNearAnyRelevant_44746;\n                    bool loop_while_44747;\n                    int64_t curPart_i_44748;\n                    bool isNear_44749;\n                    \n                    loop_while_44747 = cond_41383;\n                    curPart_i_4", "4748 = (int64_t) 0;\n                    isNear_44749 = 0;\n                    while (loop_while_44747) {\n                        bool x_44750 = sle64((int64_t) 0, curPart_i_44748);\n                        bool y_44751 = slt64(curPart_i_44748, dz2083U_28419);\n                        bool bounds_check_44752 = x_44750 && y_44751;\n                        bool index_certs_44753;\n                        \n                        if (!bounds_check_44752) {\n                            {\n                                if (atomic_cmpxchg_i32_global(global_failure, -1, 9) == -1) {\n                                    global_failure_args[0] = (int64_t) curPart_i_44748;\n                                    global_failure_args[1] = (int64_t) dz2083U_28419;\n                                    ;\n                                }\n                                local_failure = 1;\n                                goto error_0;\n                            }\n                        }\n                        \n                        int64_t curPart_44754 = ((__global int64_t *) clProc_mem_53517)[curPart_i_44748];\n                        int64_t cur_xid_44755 = smod64(curPart_44754, zv_rhs_53456);\n                        int64_t cur_yid_44756 = sdiv64(curPart_44754, zv_rhs_53456);\n                        double i64_res_44757 = sitofp_i64_f64(cur_xid_44755);\n                        double zt_res_44758 = i64_res_44757 * times_arg1_53457;\n                        double zp_res_44759 = zt_res_44758 + plus_arg0_53458;\n                        double i64_res_44760 = sitofp_i64_f64(cur_yid_44756);\n                        double zt_res_44761 = i64_res_44760 * times_arg1_53459;\n                        double zp_res_44762 = zt_res_44761 + plus_arg0_53460;\n                        double zp_res_44763 = zp_res_44759 + plus_arg1_53461;\n                        double zp_res_44764 = zp_res_44762 + plus_arg1_53462;\n                        double zm_res_44765 = zp_res_44759 - zt_res_40980;\n                    ", "    bool zgze_res_44766 = zm_res_44765 <= index_concat_branch_44736;\n                        double zp_res_44767 = zt_res_40980 + zp_res_44763;\n                        bool zlze_res_44768 = index_concat_branch_44736 <= zp_res_44767;\n                        bool x_44769 = zgze_res_44766 && zlze_res_44768;\n                        double zm_res_44770 = zp_res_44762 - zt_res_40980;\n                        bool zgze_res_44771 = zm_res_44770 <= index_concat_branch_44740;\n                        double zp_res_44772 = zt_res_40980 + zp_res_44764;\n                        bool zlze_res_44773 = index_concat_branch_44740 <= zp_res_44772;\n                        bool x_44774 = zgze_res_44771 && zlze_res_44773;\n                        bool x_44775 = x_44769 && x_44774;\n                        int64_t tmp_44776 = add64((int64_t) 1, curPart_i_44748);\n                        bool cond_44777 = slt64(tmp_44776, dz2083U_28419);\n                        bool loop_cond_t_res_44778 = !x_44775;\n                        bool x_44779 = cond_44777 && loop_cond_t_res_44778;\n                        bool loop_while_tmp_55373 = x_44779;\n                        int64_t curPart_i_tmp_55374 = tmp_44776;\n                        bool isNear_tmp_55375 = x_44775;\n                        \n                        loop_while_44747 = loop_while_tmp_55373;\n                        curPart_i_44748 = curPart_i_tmp_55374;\n                        isNear_44749 = isNear_tmp_55375;\n                    }\n                    isNearAnyRelevant_44744 = loop_while_44747;\n                    isNearAnyRelevant_44745 = curPart_i_44748;\n                    isNearAnyRelevant_44746 = isNear_44749;\n                    \n                    bool cond_neg_44781 = !isNearAnyRelevant_44746;\n                    int64_t defunc_0_lifted_pzq_res_44782 = btoi_bool_i64(cond_neg_44781);\n                    bool is_i_44783 = defunc_0_lifted_pzq_res_44782 == (int64_t) 0;\n                    int64_t part_res_44784 = btoi_bool_i64(is_i_44783);\n ",
                                    "                   int64_t part_res_44785;\n                    int64_t part_res_44786;\n                    \n                    if (is_i_44783) {\n                        part_res_44785 = (int64_t) 0;\n                        part_res_44786 = (int64_t) 0;\n                    } else {\n                        bool is_i_44787 = defunc_0_lifted_pzq_res_44782 == (int64_t) 1;\n                        int64_t part_res_44788;\n                        \n                        if (is_i_44787) {\n                            part_res_44788 = (int64_t) 1;\n                        } else {\n                            part_res_44788 = (int64_t) 2;\n                        }\n                        \n                        int64_t part_res_44789 = btoi_bool_i64(is_i_44787);\n                        \n                        part_res_44785 = part_res_44788;\n                        part_res_44786 = part_res_44789;\n                    }\n                    ((__global int64_t *) mem_53708)[gtid_46799] = part_res_44785;\n                    private_mem_55364[i_55369] = part_res_44784;\n                    private_mem_55366[i_55369] = part_res_44786;\n                } else {\n                    private_mem_55364[i_55369] = (int64_t) 0;\n                    private_mem_55366[i_55369] = (int64_t) 0;\n                }\n            }\n        }\n        \n      error_0:\n        barrier(CLK_LOCAL_MEM_FENCE);\n        if (local_failure)\n            return;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        // Transpose scan inputs\n        {\n            for (int64_t i_55376 = 0; i_55376 < chunk_sizze_55321; i_55376++) {\n                int64_t sharedIdx_55377 = sext_i32_i64(local_tid_55337) + i_55376 * segscan_tblock_sizze_46795;\n                int64_t tmp_55378 = private_mem_55364[i_55376];\n                \n                ((__local int64_t *) local_mem_55346)[sharedIdx_55377] = tmp_55378;\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            for (int64_t i_55379 = 0; i_55379 < chunk_sizze_55321; i_5", "5379++) {\n                int64_t sharedIdx_55380 = sext_i32_i64(local_tid_55337) * chunk_sizze_55321 + i_55379;\n                int64_t tmp_55381 = ((__local int64_t *) local_mem_55346)[sharedIdx_55380];\n                \n                private_mem_55364[i_55379] = tmp_55381;\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            for (int64_t i_55382 = 0; i_55382 < chunk_sizze_55321; i_55382++) {\n                int64_t sharedIdx_55383 = sext_i32_i64(local_tid_55337) + i_55382 * segscan_tblock_sizze_46795;\n                int64_t tmp_55384 = private_mem_55366[i_55382];\n                \n                ((__local int64_t *) local_mem_55346)[sharedIdx_55383] = tmp_55384;\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            for (int64_t i_55385 = 0; i_55385 < chunk_sizze_55321; i_55385++) {\n                int64_t sharedIdx_55386 = sext_i32_i64(local_tid_55337) * chunk_sizze_55321 + i_55385;\n                int64_t tmp_55387 = ((__local int64_t *) local_mem_55346)[sharedIdx_55386];\n                \n                private_mem_55366[i_55385] = tmp_55387;\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n        }\n        // Per thread scan\n        {\n            for (int64_t i_55388 = 0; i_55388 < chunk_sizze_55321 - (int64_t) 1; i_55388++) {\n                int64_t x_41475;\n                int64_t y_41477;\n                \n                x_41475 = private_mem_55364[i_55388];\n                y_41477 = private_mem_55364[i_55388 + (int64_t) 1];\n                \n                int64_t x_41476;\n                int64_t y_41478;\n                \n                x_41476 = private_mem_55366[i_55388];\n                y_41478 = private_mem_55366[i_55388 + (int64_t) 1];\n                \n                int64_t zz_41479 = x_41475 + y_41477;\n                int64_t zz_41480 = x_41476 + y_41478;\n                \n                private_mem_55364[i_55388 + (int64_t) 1] = zz_41479;\n                private_mem_55366[i_55388 + (int64_t) 1] = zz_41480;\n ", "           }\n        }\n        // Publish results in shared memory\n        {\n            int64_t tmp_55389 = private_mem_55364[chunk_sizze_55321 - (int64_t) 1];\n            \n            ((__local int64_t *) local_mem_55346)[sext_i32_i64(local_tid_55337)] = tmp_55389;\n            \n            int64_t tmp_55390 = private_mem_55366[chunk_sizze_55321 - (int64_t) 1];\n            \n            ((__local int64_t *) local_mem_55346)[squot64(byte_offsets_55342, (int64_t) 8) + sext_i32_i64(local_tid_55337)] = tmp_55390;\n            barrier(CLK_LOCAL_MEM_FENCE);\n        }\n        // Scan results (with warp scan)\n        {\n            int64_t x_55391;\n            int64_t x_55392;\n            int64_t y_55393;\n            int64_t y_55394;\n            int64_t x_55399;\n            int64_t x_55400;\n            int64_t y_55401;\n            int64_t y_55402;\n            bool ltid_in_bounds_55405 = slt64(sext_i32_i64(local_tid_55337), num_virt_threads_55323);\n            int32_t skip_threads_55406;\n            \n            // read input for in-block scan\n            {\n                if (ltid_in_bounds_55405) {\n                    y_55393 = ((volatile __local int64_t *) local_mem_55346)[sext_i32_i64(local_tid_55337)];\n                    y_55394 = ((volatile __local int64_t *) local_mem_55346)[squot64(byte_offsets_55342, (int64_t) 8) + sext_i32_i64(local_tid_55337)];\n                    if ((local_tid_55337 - squot32(local_tid_55337, 32) * 32) == 0) {\n                        x_55391 = y_55393;\n                        x_55392 = y_55394;\n                    }\n                }\n            }\n            // in-block scan (hopefully no barriers needed)\n            {\n                skip_threads_55406 = 1;\n                while (slt32(skip_threads_55406, 32)) {\n                    bool thread_active_55407 = sle32(skip_threads_55406, local_tid_55337 - squot32(local_tid_55337, 32) * 32) && ltid_in_bounds_55405;\n                    \n                    if (thread_active_55407) {\n                 ",
                                    "       // read operands\n                        {\n                            x_55391 = ((volatile __local int64_t *) local_mem_55346)[sext_i32_i64(local_tid_55337) - sext_i32_i64(skip_threads_55406)];\n                            x_55392 = ((volatile __local int64_t *) local_mem_55346)[squot64(byte_offsets_55342, (int64_t) 8) + (sext_i32_i64(local_tid_55337) - sext_i32_i64(skip_threads_55406))];\n                        }\n                    }\n                    // perform operation\n                    {\n                        if (thread_active_55407) {\n                            int64_t zz_55395 = x_55391 + y_55393;\n                            int64_t zz_55396 = x_55392 + y_55394;\n                            \n                            x_55391 = zz_55395;\n                            x_55392 = zz_55396;\n                        }\n                    }\n                    if (sle32(wave_sizze_55339, skip_threads_55406)) {\n                        barrier(CLK_LOCAL_MEM_FENCE);\n                    }\n                    if (thread_active_55407) {\n                        // write result\n                        {\n                            ((volatile __local int64_t *) local_mem_55346)[sext_i32_i64(local_tid_55337)] = x_55391;\n                            y_55393 = x_55391;\n                            ((volatile __local int64_t *) local_mem_55346)[squot64(byte_offsets_55342, (int64_t) 8) + sext_i32_i64(local_tid_55337)] = x_55392;\n                            y_55394 = x_55392;\n                        }\n                    }\n                    if (sle32(wave_sizze_55339, skip_threads_55406)) {\n                        barrier(CLK_LOCAL_MEM_FENCE);\n                    }\n                    skip_threads_55406 *= 2;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // last thread of block 'i' writes its result to offset 'i'\n            {\n                if ((local_tid_55337 - squot32(local_tid_55337, 32) * 32) == 31 && ltid_in_bounds_55405", ") {\n                    ((volatile __local int64_t *) local_mem_55346)[sext_i32_i64(squot32(local_tid_55337, 32))] = x_55391;\n                    ((volatile __local int64_t *) local_mem_55346)[squot64(byte_offsets_55342, (int64_t) 8) + sext_i32_i64(squot32(local_tid_55337, 32))] = x_55392;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // scan the first block, after which offset 'i' contains carry-in for block 'i+1'\n            {\n                int32_t skip_threads_55408;\n                \n                // read input for in-block scan\n                {\n                    if (squot32(local_tid_55337, 32) == 0 && ltid_in_bounds_55405) {\n                        y_55401 = ((volatile __local int64_t *) local_mem_55346)[sext_i32_i64(local_tid_55337)];\n                        y_55402 = ((volatile __local int64_t *) local_mem_55346)[squot64(byte_offsets_55342, (int64_t) 8) + sext_i32_i64(local_tid_55337)];\n                        if ((local_tid_55337 - squot32(local_tid_55337, 32) * 32) == 0) {\n                            x_55399 = y_55401;\n                            x_55400 = y_55402;\n                        }\n                    }\n                }\n                // in-block scan (hopefully no barriers needed)\n                {\n                    skip_threads_55408 = 1;\n                    while (slt32(skip_threads_55408, 32)) {\n                        bool thread_active_55409 = sle32(skip_threads_55408, local_tid_55337 - squot32(local_tid_55337, 32) * 32) && (squot32(local_tid_55337, 32) == 0 && ltid_in_bounds_55405);\n                        \n                        if (thread_active_55409) {\n                            // read operands\n                            {\n                                x_55399 = ((volatile __local int64_t *) local_mem_55346)[sext_i32_i64(local_tid_55337) - sext_i32_i64(skip_threads_55408)];\n                                x_55400 = ((volatile __local int64_t *) local_mem_55346)[squot64(byte_offsets", "_55342, (int64_t) 8) + (sext_i32_i64(local_tid_55337) - sext_i32_i64(skip_threads_55408))];\n                            }\n                        }\n                        // perform operation\n                        {\n                            if (thread_active_55409) {\n                                int64_t zz_55403 = x_55399 + y_55401;\n                                int64_t zz_55404 = x_55400 + y_55402;\n                                \n                                x_55399 = zz_55403;\n                                x_55400 = zz_55404;\n                            }\n                        }\n                        if (sle32(wave_sizze_55339, skip_threads_55408)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        if (thread_active_55409) {\n                            // write result\n                            {\n                                ((volatile __local int64_t *) local_mem_55346)[sext_i32_i64(local_tid_55337)] = x_55399;\n                                y_55401 = x_55399;\n                                ((volatile __local int64_t *) local_mem_55346)[squot64(byte_offsets_55342, (int64_t) 8) + sext_i32_i64(local_tid_55337)] = x_55400;\n                                y_55402 = x_55400;\n                            }\n                        }\n                        if (sle32(wave_sizze_55339, skip_threads_55408)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        skip_threads_55408 *= 2;\n                    }\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            \n            bool no_carry_in_55410 = squot32(local_tid_55337, 32) == 0 || !ltid_in_bounds_55405;\n            \n            // carry-in for every block except the first\n            {\n                // read operands\n                {\n                    if (!no_carry_in_55410) {\n                        y_55393 = x_55391;\n                        y_55",
                                    "394 = x_55392;\n                        x_55391 = ((__local int64_t *) local_mem_55346)[sext_i32_i64(squot32(local_tid_55337, 32)) - (int64_t) 1];\n                        x_55392 = ((__local int64_t *) local_mem_55346)[squot64(byte_offsets_55342, (int64_t) 8) + (sext_i32_i64(squot32(local_tid_55337, 32)) - (int64_t) 1)];\n                    }\n                }\n                // perform operation\n                {\n                    if (!no_carry_in_55410) {\n                        int64_t zz_55395 = x_55391 + y_55393;\n                        int64_t zz_55396 = x_55392 + y_55394;\n                        \n                        x_55391 = zz_55395;\n                        x_55392 = zz_55396;\n                    }\n                }\n                // write final result\n                {\n                    if (!no_carry_in_55410) {\n                        ((__local int64_t *) local_mem_55346)[sext_i32_i64(local_tid_55337)] = x_55391;\n                        ((__local int64_t *) local_mem_55346)[squot64(byte_offsets_55342, (int64_t) 8) + sext_i32_i64(local_tid_55337)] = x_55392;\n                    }\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // restore correct values for first block\n            {\n                if (squot32(local_tid_55337, 32) == 0 && ltid_in_bounds_55405) {\n                    ((__local int64_t *) local_mem_55346)[sext_i32_i64(local_tid_55337)] = y_55393;\n                    ((__local int64_t *) local_mem_55346)[squot64(byte_offsets_55342, (int64_t) 8) + sext_i32_i64(local_tid_55337)] = y_55394;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            barrier(CLK_LOCAL_MEM_FENCE);\n            if (local_tid_55337 == 0) {\n                acc_55397 = ((__local int64_t *) local_mem_55346)[segscan_tblock_sizze_46795 - (int64_t) 1];\n                acc_55398 = ((__local int64_t *) local_mem_55346)[squot64(byte_offsets_55342, (int64_t) 8) + (segscan_tblock_sizze_46795 - (int64_t) 1)];\n", "            } else {\n                acc_55397 = ((__local int64_t *) local_mem_55346)[sext_i32_i64(local_tid_55337) - (int64_t) 1];\n                acc_55398 = ((__local int64_t *) local_mem_55346)[squot64(byte_offsets_55342, (int64_t) 8) + (sext_i32_i64(local_tid_55337) - (int64_t) 1)];\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n        }\n        prefix_55411 = (int64_t) 0;\n        prefix_55412 = (int64_t) 0;\n        block_new_sgm_55413 = sgm_idx_55361 == (int64_t) 0;\n        // Perform lookback\n        {\n            if (block_new_sgm_55413 && local_tid_55337 == 0) {\n                ((volatile __global int64_t *) incprefixes_mem_55328)[dynamic_id_55359] = acc_55397;\n                ((volatile __global int64_t *) incprefixes_mem_55332)[dynamic_id_55359] = acc_55398;\n                mem_fence_global();\n                ((volatile __global int8_t *) status_flags_mem_55324)[dynamic_id_55359] = (int8_t) 2;\n                acc_55397 = (int64_t) 0;\n                acc_55398 = (int64_t) 0;\n            }\n            if (!block_new_sgm_55413 && slt32(local_tid_55337, wave_sizze_55339)) {\n                if (local_tid_55337 == 0) {\n                    ((volatile __global int64_t *) aggregates_mem_55326)[dynamic_id_55359] = acc_55397;\n                    ((volatile __global int64_t *) aggregates_mem_55330)[dynamic_id_55359] = acc_55398;\n                    mem_fence_global();\n                    ((volatile __global int8_t *) status_flags_mem_55324)[dynamic_id_55359] = (int8_t) 1;\n                    \n                    int8_t tmp_55414 = ((volatile __global int8_t *) status_flags_mem_55324)[dynamic_id_55359 - (int64_t) 1];\n                    \n                    ((volatile __local int8_t *) local_mem_55346)[(int64_t) 0] = tmp_55414;\n                }\n                mem_fence_local();\n                \n                int8_t status_55415 = ((__local int8_t *) local_mem_55346)[(int64_t) 0];\n                \n                if (status_55415 == (int8_t) 2) {\n       ", "             if (local_tid_55337 == 0) {\n                        prefix_55411 = ((volatile __global int64_t *) incprefixes_mem_55328)[dynamic_id_55359 - (int64_t) 1];\n                        prefix_55412 = ((volatile __global int64_t *) incprefixes_mem_55332)[dynamic_id_55359 - (int64_t) 1];\n                    }\n                } else {\n                    int32_t readOffset_55416 = sext_i64_i32(dynamic_id_55359 - sext_i32_i64(wave_sizze_55339));\n                    \n                    while (slt32(wave_sizze_55339 * -1, readOffset_55416)) {\n                        int32_t read_i_55417 = readOffset_55416 + local_tid_55337;\n                        int64_t aggr_55418 = (int64_t) 0;\n                        int64_t aggr_55419 = (int64_t) 0;\n                        int8_t flag_55420 = (int8_t) 0;\n                        \n                        if (sle32(0, read_i_55417)) {\n                            flag_55420 = ((volatile __global int8_t *) status_flags_mem_55324)[sext_i32_i64(read_i_55417)];\n                            if (flag_55420 == (int8_t) 2) {\n                                aggr_55418 = ((volatile __global int64_t *) incprefixes_mem_55328)[sext_i32_i64(read_i_55417)];\n                                aggr_55419 = ((volatile __global int64_t *) incprefixes_mem_55332)[sext_i32_i64(read_i_55417)];\n                            } else if (flag_55420 == (int8_t) 1) {\n                                aggr_55418 = ((volatile __global int64_t *) aggregates_mem_55326)[sext_i32_i64(read_i_55417)];\n                                aggr_55419 = ((volatile __global int64_t *) aggregates_mem_55330)[sext_i32_i64(read_i_55417)];\n                            }\n                        }\n                        ((__local int64_t *) local_mem_55346)[(int64_t) 4 + sext_i32_i64(local_tid_55337)] = aggr_55418;\n                        ((__local int64_t *) local_mem_55346)[squot64(warp_byte_offset_55344, (int64_t) 8) + sext_i32_i64(local_tid_55337)] = aggr_55419;\n                        ",
                                    "((__local int8_t *) local_mem_55346)[sext_i32_i64(local_tid_55337)] = flag_55420;\n                        flag_55420 = ((__local int8_t *) local_mem_55346)[sext_i32_i64(wave_sizze_55339) - (int64_t) 1];\n                        if (slt8(flag_55420, (int8_t) 2)) {\n                            int8_t flg_x_55427;\n                            int8_t flg_y_55428;\n                            int64_t x_55421;\n                            int64_t x_55422;\n                            int64_t y_55423;\n                            int64_t y_55424;\n                            int32_t skip_threads_55429;\n                            \n                            // read input for in-block scan\n                            {\n                                flg_y_55428 = ((volatile __local int8_t *) local_mem_55346)[sext_i32_i64(local_tid_55337)];\n                                y_55423 = ((volatile __local int64_t *) local_mem_55346)[(int64_t) 4 + sext_i32_i64(local_tid_55337)];\n                                y_55424 = ((volatile __local int64_t *) local_mem_55346)[squot64(warp_byte_offset_55344, (int64_t) 8) + sext_i32_i64(local_tid_55337)];\n                                if ((local_tid_55337 - squot32(local_tid_55337, 32) * 32) == 0) {\n                                    x_55421 = y_55423;\n                                    x_55422 = y_55424;\n                                    flg_x_55427 = flg_y_55428;\n                                }\n                            }\n                            // in-block scan (hopefully no barriers needed)\n                            {\n                                skip_threads_55429 = 1;\n                                while (slt32(skip_threads_55429, 32)) {\n                                    if (sle32(skip_threads_55429, local_tid_55337 - squot32(local_tid_55337, 32) * 32)) {\n                                        // read operands\n                                        {\n                                            flg_x_55427 = ((volatile ", "__local int8_t *) local_mem_55346)[sext_i32_i64(local_tid_55337) - sext_i32_i64(skip_threads_55429)];\n                                            x_55421 = ((volatile __local int64_t *) local_mem_55346)[(int64_t) 4 + (sext_i32_i64(local_tid_55337) - sext_i32_i64(skip_threads_55429))];\n                                            x_55422 = ((volatile __local int64_t *) local_mem_55346)[squot64(warp_byte_offset_55344, (int64_t) 8) + (sext_i32_i64(local_tid_55337) - sext_i32_i64(skip_threads_55429))];\n                                        }\n                                        // perform operation\n                                        {\n                                            if (flg_y_55428 == (int8_t) 2 || flg_y_55428 == (int8_t) 0) {\n                                                flg_x_55427 = flg_y_55428;\n                                                x_55421 = y_55423;\n                                                x_55422 = y_55424;\n                                            } else {\n                                                int64_t zz_55425 = x_55421 + y_55423;\n                                                int64_t zz_55426 = x_55422 + y_55424;\n                                                \n                                                x_55421 = zz_55425;\n                                                x_55422 = zz_55426;\n                                            }\n                                        }\n                                        // write result\n                                        {\n                                            ((volatile __local int8_t *) local_mem_55346)[sext_i32_i64(local_tid_55337)] = flg_x_55427;\n                                            flg_y_55428 = flg_x_55427;\n                                            ((volatile __local int64_t *) local_mem_55346)[(int64_t) 4 + sext_i32_i64(local_tid_55337)] = x_55421;\n                                            y_55423 = x_55421;\n                        ", "                    ((volatile __local int64_t *) local_mem_55346)[squot64(warp_byte_offset_55344, (int64_t) 8) + sext_i32_i64(local_tid_55337)] = x_55422;\n                                            y_55424 = x_55422;\n                                        }\n                                    }\n                                    skip_threads_55429 *= 2;\n                                }\n                            }\n                        }\n                        flag_55420 = ((__local int8_t *) local_mem_55346)[sext_i32_i64(wave_sizze_55339) - (int64_t) 1];\n                        aggr_55418 = ((__local int64_t *) local_mem_55346)[(int64_t) 4 + (sext_i32_i64(wave_sizze_55339) - (int64_t) 1)];\n                        aggr_55419 = ((__local int64_t *) local_mem_55346)[squot64(warp_byte_offset_55344, (int64_t) 8) + (sext_i32_i64(wave_sizze_55339) - (int64_t) 1)];\n                        if (flag_55420 == (int8_t) 2) {\n                            readOffset_55416 = wave_sizze_55339 * -1;\n                        } else if (flag_55420 == (int8_t) 1) {\n                            readOffset_55416 -= wave_sizze_55339;\n                        }\n                        if (slt8((int8_t) 0, flag_55420)) {\n                            int64_t x_55430 = aggr_55418;\n                            int64_t x_55431 = aggr_55419;\n                            int64_t y_55432 = prefix_55411;\n                            int64_t y_55433 = prefix_55412;\n                            int64_t zz_55434 = x_55430 + y_55432;\n                            int64_t zz_55435 = x_55431 + y_55433;\n                            \n                            prefix_55411 = zz_55434;\n                            prefix_55412 = zz_55435;\n                        }\n                        mem_fence_local();\n                    }\n                }\n                if (local_tid_55337 == 0) {\n                    if (boundary_55362 == sext_i64_i32(segscan_tblock_sizze_46795 * chunk_sizze_55321)) {\n                 ",
                                    "       int64_t x_55436 = prefix_55411;\n                        int64_t x_55437 = prefix_55412;\n                        int64_t y_55438 = acc_55397;\n                        int64_t y_55439 = acc_55398;\n                        int64_t zz_55440 = x_55436 + y_55438;\n                        int64_t zz_55441 = x_55437 + y_55439;\n                        \n                        ((volatile __global int64_t *) incprefixes_mem_55328)[dynamic_id_55359] = zz_55440;\n                        ((volatile __global int64_t *) incprefixes_mem_55332)[dynamic_id_55359] = zz_55441;\n                        mem_fence_global();\n                        ((volatile __global int8_t *) status_flags_mem_55324)[dynamic_id_55359] = (int8_t) 2;\n                    }\n                    ((__local int64_t *) local_mem_55346)[(int64_t) 4] = prefix_55411;\n                    ((__local int64_t *) local_mem_55346)[squot64(warp_byte_offset_55344, (int64_t) 8)] = prefix_55412;\n                    acc_55397 = (int64_t) 0;\n                    acc_55398 = (int64_t) 0;\n                }\n            }\n            if (!(dynamic_id_55359 == (int64_t) 0)) {\n                barrier(CLK_LOCAL_MEM_FENCE);\n                prefix_55411 = ((__local int64_t *) local_mem_55346)[(int64_t) 4];\n                prefix_55412 = ((__local int64_t *) local_mem_55346)[squot64(warp_byte_offset_55344, (int64_t) 8)];\n                barrier(CLK_LOCAL_MEM_FENCE);\n            }\n        }\n        // Distribute results\n        {\n            int64_t x_55442;\n            int64_t y_55444;\n            int64_t x_55448 = prefix_55411;\n            int64_t y_55450 = acc_55397;\n            int64_t x_55443;\n            int64_t y_55445;\n            int64_t x_55449 = prefix_55412;\n            int64_t y_55451 = acc_55398;\n            \n            if (slt32(local_tid_55337 * chunk_sizze_32b_55341, boundary_55362) && !block_new_sgm_55413) {\n                int64_t zz_55452 = x_55448 + y_55450;\n                int64_t zz_55453 = x_55449 + y_55451;\n       ", "         \n                x_55442 = zz_55452;\n                x_55443 = zz_55453;\n            } else {\n                x_55442 = acc_55397;\n                x_55443 = acc_55398;\n            }\n            \n            int32_t stopping_point_55454 = segsizze_compact_55363 - srem32(local_tid_55337 * chunk_sizze_32b_55341 - 1 + segsizze_compact_55363 - boundary_55362, segsizze_compact_55363);\n            \n            for (int64_t i_55455 = 0; i_55455 < chunk_sizze_55321; i_55455++) {\n                if (slt32(sext_i64_i32(i_55455), stopping_point_55454 - 1)) {\n                    y_55444 = private_mem_55364[i_55455];\n                    y_55445 = private_mem_55366[i_55455];\n                    \n                    int64_t zz_55446 = x_55442 + y_55444;\n                    int64_t zz_55447 = x_55443 + y_55445;\n                    \n                    private_mem_55364[i_55455] = zz_55446;\n                    private_mem_55366[i_55455] = zz_55447;\n                }\n            }\n        }\n        // Transpose scan output and Write it to global memory in coalesced fashion\n        {\n            for (int64_t i_55456 = 0; i_55456 < chunk_sizze_55321; i_55456++) {\n                int64_t sharedIdx_55457 = sext_i32_i64(local_tid_55337) * chunk_sizze_55321 + i_55456;\n                int64_t tmp_55458 = private_mem_55364[i_55456];\n                \n                ((__local int64_t *) local_mem_55346)[sharedIdx_55457] = tmp_55458;\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            for (int64_t i_55459 = 0; i_55459 < chunk_sizze_55321; i_55459++) {\n                int64_t flat_idx_55460 = thd_offset_55368 + i_55459 * segscan_tblock_sizze_46795;\n                int64_t slice_55461 = dzlz7bUZLzpZRz20Udz2082Uz20Udz2084Uz2088Uz2083Uz7dUzg_41379;\n                int64_t gtid_46799 = flat_idx_55460;\n                int64_t remnant_55462 = flat_idx_55460 - gtid_46799;\n                \n                if (slt64(flat_idx_55460, dzlz7bUZLzpZRz20Udz2082Uz20Udz2084Uz2088Uz2083Uz", "7dUzg_41379)) {\n                    int64_t tmp_55463 = ((__local int64_t *) local_mem_55346)[flat_idx_55460 - block_offset_55360];\n                    \n                    ((__global int64_t *) mem_53704)[gtid_46799] = tmp_55463;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            for (int64_t i_55464 = 0; i_55464 < chunk_sizze_55321; i_55464++) {\n                int64_t sharedIdx_55465 = sext_i32_i64(local_tid_55337) * chunk_sizze_55321 + i_55464;\n                int64_t tmp_55466 = private_mem_55366[i_55464];\n                \n                ((__local int64_t *) local_mem_55346)[sharedIdx_55465] = tmp_55466;\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            for (int64_t i_55467 = 0; i_55467 < chunk_sizze_55321; i_55467++) {\n                int64_t flat_idx_55468 = thd_offset_55368 + i_55467 * segscan_tblock_sizze_46795;\n                int64_t slice_55469 = dzlz7bUZLzpZRz20Udz2082Uz20Udz2084Uz2088Uz2083Uz7dUzg_41379;\n                int64_t gtid_46799 = flat_idx_55468;\n                int64_t remnant_55470 = flat_idx_55468 - gtid_46799;\n                \n                if (slt64(flat_idx_55468, dzlz7bUZLzpZRz20Udz2082Uz20Udz2084Uz2088Uz2083Uz7dUzg_41379)) {\n                    int64_t tmp_55471 = ((__local int64_t *) local_mem_55346)[flat_idx_55468 - block_offset_55360];\n                    \n                    ((__global int64_t *) mem_53706)[gtid_46799] = tmp_55471;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n        }\n    }\n    \n  error_3:\n    return;\n    #undef segscan_tblock_sizze_46795\n    #undef chunk_sizze_55321\n}\nFUTHARK_KERNEL\nvoid builtinzhiota_i64ziiota_i64_54730(int64_t n_54726, int64_t x_54727, int64_t s_54728, int64_t virt_num_tblocks_54735, int64_t num_tblocks_54736, __global unsigned char *mem_54725)\n{\n    int32_t iota_ltid_54731;\n    int32_t tblock_sizze_54733;\n    int32_t iota_gid_54732;\n    int32_t iota_gtid_54730;\n    int32_t phys_tblock_id_54737;\n    int32_t it",
                                    "erations_54738;\n    \n    iota_ltid_54731 = get_local_id(0);\n    tblock_sizze_54733 = get_local_size(0);\n    iota_gid_54732 = get_tblock_id(0);\n    iota_gtid_54730 = iota_gid_54732 * tblock_sizze_54733 + iota_ltid_54731;\n    phys_tblock_id_54737 = get_tblock_id(0);\n    iterations_54738 = sdiv_up32(sext_i64_i32(virt_num_tblocks_54735) - phys_tblock_id_54737, sext_i64_i32(num_tblocks_54736));\n    for (int32_t i_54739 = 0; i_54739 < iterations_54738; i_54739++) {\n        int32_t virt_tblock_id_54740;\n        int64_t global_tid_54741;\n        \n        virt_tblock_id_54740 = phys_tblock_id_54737 + i_54739 * sext_i64_i32(num_tblocks_54736);\n        global_tid_54741 = sext_i32_i64(virt_tblock_id_54740) * sext_i32_i64(tblock_sizze_54733) + sext_i32_i64(iota_ltid_54731);\n        if (slt64(global_tid_54741, n_54726)) {\n            ((__global int64_t *) mem_54725)[global_tid_54741] = add64(mul64(global_tid_54741, s_54728), x_54727);\n        }\n        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    }\n    \n  error_1:\n    return;\n}\nFUTHARK_KERNEL\nvoid builtinzhreplicate_boolzireplicate_55479(int64_t num_elems_55475, unsigned char val_55476_bits, int64_t replicate_n_55478, int64_t virt_num_tblocks_55484, int64_t num_tblocks_55485, __global unsigned char *mem_55474)\n{\n    bool val_55476 = val_55476_bits;\n    int32_t replicate_ltid_55480;\n    int32_t tblock_sizze_55482;\n    int32_t replicate_gid_55481;\n    int32_t replicate_gtid_55479;\n    int32_t phys_tblock_id_55486;\n    int32_t iterations_55487;\n    \n    replicate_ltid_55480 = get_local_id(0);\n    tblock_sizze_55482 = get_local_size(0);\n    replicate_gid_55481 = get_tblock_id(0);\n    replicate_gtid_55479 = replicate_gid_55481 * tblock_sizze_55482 + replicate_ltid_55480;\n    phys_tblock_id_55486 = get_tblock_id(0);\n    iterations_55487 = sdiv_up32(sext_i64_i32(virt_num_tblocks_55484) - phys_tblock_id_55486, sext_i64_i32(num_tblocks_55485));\n    for (int32_t i_55488 = 0; i_55488 < iterations_55487; i_55488++) {\n        int3", "2_t virt_tblock_id_55489;\n        int64_t global_tid_55490;\n        int64_t slice_55492;\n        int64_t rep_i_55491;\n        int64_t remnant_55493;\n        \n        virt_tblock_id_55489 = phys_tblock_id_55486 + i_55488 * sext_i64_i32(num_tblocks_55485);\n        global_tid_55490 = sext_i32_i64(virt_tblock_id_55489) * sext_i32_i64(tblock_sizze_55482) + sext_i32_i64(replicate_ltid_55480);\n        slice_55492 = num_elems_55475;\n        rep_i_55491 = global_tid_55490;\n        remnant_55493 = global_tid_55490 - rep_i_55491;\n        if (slt64(global_tid_55490, replicate_n_55478)) {\n            ((__global bool *) mem_55474)[rep_i_55491] = val_55476;\n        }\n        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    }\n    \n  error_1:\n    return;\n}\nFUTHARK_KERNEL\nvoid builtinzhreplicate_f64zireplicate_54806(int64_t num_elems_54802, double val_54803, int64_t replicate_n_54805, int64_t virt_num_tblocks_54811, int64_t num_tblocks_54812, __global unsigned char *mem_54801)\n{\n    int32_t replicate_ltid_54807;\n    int32_t tblock_sizze_54809;\n    int32_t replicate_gid_54808;\n    int32_t replicate_gtid_54806;\n    int32_t phys_tblock_id_54813;\n    int32_t iterations_54814;\n    \n    replicate_ltid_54807 = get_local_id(0);\n    tblock_sizze_54809 = get_local_size(0);\n    replicate_gid_54808 = get_tblock_id(0);\n    replicate_gtid_54806 = replicate_gid_54808 * tblock_sizze_54809 + replicate_ltid_54807;\n    phys_tblock_id_54813 = get_tblock_id(0);\n    iterations_54814 = sdiv_up32(sext_i64_i32(virt_num_tblocks_54811) - phys_tblock_id_54813, sext_i64_i32(num_tblocks_54812));\n    for (int32_t i_54815 = 0; i_54815 < iterations_54814; i_54815++) {\n        int32_t virt_tblock_id_54816;\n        int64_t global_tid_54817;\n        int64_t slice_54819;\n        int64_t rep_i_54818;\n        int64_t remnant_54820;\n        \n        virt_tblock_id_54816 = phys_tblock_id_54813 + i_54815 * sext_i64_i32(num_tblocks_54812);\n        global_tid_54817 = sext_i32_i64(virt_tblock_id_54816) * sext_i32_i64(tb", "lock_sizze_54809) + sext_i32_i64(replicate_ltid_54807);\n        slice_54819 = num_elems_54802;\n        rep_i_54818 = global_tid_54817;\n        remnant_54820 = global_tid_54817 - rep_i_54818;\n        if (slt64(global_tid_54817, replicate_n_54805)) {\n            ((__global double *) mem_54801)[rep_i_54818] = val_54803;\n        }\n        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    }\n    \n  error_1:\n    return;\n}\nFUTHARK_KERNEL\nvoid builtinzhreplicate_i32zireplicate_54632(int64_t num_elems_54628, int32_t val_54629, int64_t replicate_n_54631, int64_t virt_num_tblocks_54637, int64_t num_tblocks_54638, __global unsigned char *mem_54627)\n{\n    int32_t replicate_ltid_54633;\n    int32_t tblock_sizze_54635;\n    int32_t replicate_gid_54634;\n    int32_t replicate_gtid_54632;\n    int32_t phys_tblock_id_54639;\n    int32_t iterations_54640;\n    \n    replicate_ltid_54633 = get_local_id(0);\n    tblock_sizze_54635 = get_local_size(0);\n    replicate_gid_54634 = get_tblock_id(0);\n    replicate_gtid_54632 = replicate_gid_54634 * tblock_sizze_54635 + replicate_ltid_54633;\n    phys_tblock_id_54639 = get_tblock_id(0);\n    iterations_54640 = sdiv_up32(sext_i64_i32(virt_num_tblocks_54637) - phys_tblock_id_54639, sext_i64_i32(num_tblocks_54638));\n    for (int32_t i_54641 = 0; i_54641 < iterations_54640; i_54641++) {\n        int32_t virt_tblock_id_54642;\n        int64_t global_tid_54643;\n        int64_t slice_54645;\n        int64_t rep_i_54644;\n        int64_t remnant_54646;\n        \n        virt_tblock_id_54642 = phys_tblock_id_54639 + i_54641 * sext_i64_i32(num_tblocks_54638);\n        global_tid_54643 = sext_i32_i64(virt_tblock_id_54642) * sext_i32_i64(tblock_sizze_54635) + sext_i32_i64(replicate_ltid_54633);\n        slice_54645 = num_elems_54628;\n        rep_i_54644 = global_tid_54643;\n        remnant_54646 = global_tid_54643 - rep_i_54644;\n        if (slt64(global_tid_54643, replicate_n_54631)) {\n            ((__global int32_t *) mem_54627)[rep_i_54644] = val_54629;\n        }\n ",
                                    "       barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    }\n    \n  error_1:\n    return;\n}\nFUTHARK_KERNEL\nvoid builtinzhreplicate_i64zireplicate_54547(int64_t num_elems_54543, int64_t val_54544, int64_t replicate_n_54546, int64_t virt_num_tblocks_54552, int64_t num_tblocks_54553, __global unsigned char *mem_54542)\n{\n    int32_t replicate_ltid_54548;\n    int32_t tblock_sizze_54550;\n    int32_t replicate_gid_54549;\n    int32_t replicate_gtid_54547;\n    int32_t phys_tblock_id_54554;\n    int32_t iterations_54555;\n    \n    replicate_ltid_54548 = get_local_id(0);\n    tblock_sizze_54550 = get_local_size(0);\n    replicate_gid_54549 = get_tblock_id(0);\n    replicate_gtid_54547 = replicate_gid_54549 * tblock_sizze_54550 + replicate_ltid_54548;\n    phys_tblock_id_54554 = get_tblock_id(0);\n    iterations_54555 = sdiv_up32(sext_i64_i32(virt_num_tblocks_54552) - phys_tblock_id_54554, sext_i64_i32(num_tblocks_54553));\n    for (int32_t i_54556 = 0; i_54556 < iterations_54555; i_54556++) {\n        int32_t virt_tblock_id_54557;\n        int64_t global_tid_54558;\n        int64_t slice_54560;\n        int64_t rep_i_54559;\n        int64_t remnant_54561;\n        \n        virt_tblock_id_54557 = phys_tblock_id_54554 + i_54556 * sext_i64_i32(num_tblocks_54553);\n        global_tid_54558 = sext_i32_i64(virt_tblock_id_54557) * sext_i32_i64(tblock_sizze_54550) + sext_i32_i64(replicate_ltid_54548);\n        slice_54560 = num_elems_54543;\n        rep_i_54559 = global_tid_54558;\n        remnant_54561 = global_tid_54558 - rep_i_54559;\n        if (slt64(global_tid_54558, replicate_n_54546)) {\n            ((__global int64_t *) mem_54542)[rep_i_54559] = val_54544;\n        }\n        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    }\n    \n  error_1:\n    return;\n}\nFUTHARK_KERNEL\nvoid builtinzhreplicate_i8zireplicate_54597(int64_t num_elems_54593, int8_t val_54594, int64_t replicate_n_54596, int64_t virt_num_tblocks_54602, int64_t num_tblocks_54603, __global unsigned char *mem_54592)\n{\n    int32", "_t replicate_ltid_54598;\n    int32_t tblock_sizze_54600;\n    int32_t replicate_gid_54599;\n    int32_t replicate_gtid_54597;\n    int32_t phys_tblock_id_54604;\n    int32_t iterations_54605;\n    \n    replicate_ltid_54598 = get_local_id(0);\n    tblock_sizze_54600 = get_local_size(0);\n    replicate_gid_54599 = get_tblock_id(0);\n    replicate_gtid_54597 = replicate_gid_54599 * tblock_sizze_54600 + replicate_ltid_54598;\n    phys_tblock_id_54604 = get_tblock_id(0);\n    iterations_54605 = sdiv_up32(sext_i64_i32(virt_num_tblocks_54602) - phys_tblock_id_54604, sext_i64_i32(num_tblocks_54603));\n    for (int32_t i_54606 = 0; i_54606 < iterations_54605; i_54606++) {\n        int32_t virt_tblock_id_54607;\n        int64_t global_tid_54608;\n        int64_t slice_54610;\n        int64_t rep_i_54609;\n        int64_t remnant_54611;\n        \n        virt_tblock_id_54607 = phys_tblock_id_54604 + i_54606 * sext_i64_i32(num_tblocks_54603);\n        global_tid_54608 = sext_i32_i64(virt_tblock_id_54607) * sext_i32_i64(tblock_sizze_54600) + sext_i32_i64(replicate_ltid_54598);\n        slice_54610 = num_elems_54593;\n        rep_i_54609 = global_tid_54608;\n        remnant_54611 = global_tid_54608 - rep_i_54609;\n        if (slt64(global_tid_54608, replicate_n_54596)) {\n            ((__global int8_t *) mem_54592)[rep_i_54609] = val_54594;\n        }\n        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    }\n    \n  error_1:\n    return;\n}\nFUTHARK_KERNEL_SIZED(do_DBSCAN_doublezigpuseq_54781_dim1, 1, 1)\nvoid do_DBSCAN_doublezigpuseq_54781(__global int *global_failure, double clBase_36811, double zt_res_43632, __global unsigned char *current_partition_mem_53528, __global unsigned char *mem_53560, __global unsigned char *mem_53561)\n{\n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_54783;\n    int32_t tblock_sizze_54786;\n    int32_t wave_sizze_54785;\n    int32_t block_id_54784;\n    int32_t global_tid_54782;\n    int64_t tid_54781;\n    double minus_arg0_53183;\n    double zm_res_", "53186;\n    double zm_res_53190;\n    \n    local_tid_54783 = get_local_id(0);\n    tblock_sizze_54786 = get_local_size(0);\n    wave_sizze_54785 = LOCKSTEP_WIDTH;\n    block_id_54784 = get_tblock_id(0);\n    global_tid_54782 = block_id_54784 * tblock_sizze_54786 + local_tid_54783;\n    tid_54781 = sext_i32_i64(global_tid_54782);\n    minus_arg0_53183 = ((__global double *) current_partition_mem_53528)[(int64_t) 0];\n    zm_res_53186 = minus_arg0_53183 - zt_res_43632;\n    zm_res_53190 = minus_arg0_53183 - clBase_36811;\n    ((__global double *) mem_53560)[(int64_t) 0] = zm_res_53186;\n    ((__global double *) mem_53561)[(int64_t) 0] = zm_res_53190;\n    \n  error_0:\n    return;\n}\nFUTHARK_KERNEL_SIZED(do_DBSCAN_doublezigpuseq_56885_dim1, 1, 1)\nvoid do_DBSCAN_doublezigpuseq_56885(__global int *global_failure, __global unsigned char *mem_54340, __global unsigned char *mem_54342, __global unsigned char *mem_54347)\n{\n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_56887;\n    int32_t tblock_sizze_56890;\n    int32_t wave_sizze_56889;\n    int32_t block_id_56888;\n    int32_t global_tid_56886;\n    int64_t tid_56885;\n    int64_t defunc_0_reduce_res_53193;\n    int64_t defunc_0_reduce_res_53195;\n    int64_t max_res_53199;\n    \n    local_tid_56887 = get_local_id(0);\n    tblock_sizze_56890 = get_local_size(0);\n    wave_sizze_56889 = LOCKSTEP_WIDTH;\n    block_id_56888 = get_tblock_id(0);\n    global_tid_56886 = block_id_56888 * tblock_sizze_56890 + local_tid_56887;\n    tid_56885 = sext_i32_i64(global_tid_56886);\n    defunc_0_reduce_res_53193 = ((__global int64_t *) mem_54340)[(int64_t) 0];\n    defunc_0_reduce_res_53195 = ((__global int64_t *) mem_54342)[(int64_t) 0];\n    max_res_53199 = smax64(defunc_0_reduce_res_53193, defunc_0_reduce_res_53195);\n    ((__global int64_t *) mem_54347)[(int64_t) 0] = max_res_53199;\n    \n  error_0:\n    return;\n}\nFUTHARK_KERNEL_SIZED(do_DBSCAN_doublezisegmap_46955_dim1, 1, 1)\nvoid do_DBSCAN_doublezisegmap_46955(__global int *global_failure, i",
                                    "nt64_t n_36798, int64_t m_43655, int64_t num_tblocks_46960, int32_t virt_num_tblocks_54743, __global unsigned char *current_partition_mem_53519, __global unsigned char *current_partition_mem_53520, __global unsigned char *mem_53535, __global unsigned char *mem_53537, __global unsigned char *mem_53543, __global unsigned char *mem_53545, __global unsigned char *mem_53547)\n{\n    #define segmap_tblock_sizze_46958 (do_DBSCAN_doublezisegmap_46955zisegmap_tblock_sizze_46958)\n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_54745;\n    int32_t tblock_sizze_54748;\n    int32_t wave_sizze_54747;\n    int32_t block_id_54746;\n    int32_t global_tid_54744;\n    int64_t phys_tid_46955;\n    int32_t phys_tblock_id_54749;\n    int32_t iterations_54750;\n    \n    local_tid_54745 = get_local_id(0);\n    tblock_sizze_54748 = get_local_size(0);\n    wave_sizze_54747 = LOCKSTEP_WIDTH;\n    block_id_54746 = get_tblock_id(0);\n    global_tid_54744 = block_id_54746 * tblock_sizze_54748 + local_tid_54745;\n    phys_tid_46955 = sext_i32_i64(global_tid_54744);\n    phys_tblock_id_54749 = get_tblock_id(0);\n    iterations_54750 = sdiv_up32(virt_num_tblocks_54743 - phys_tblock_id_54749, sext_i64_i32(num_tblocks_46960));\n    for (int32_t i_54751 = 0; i_54751 < iterations_54750; i_54751++) {\n        int32_t virt_tblock_id_54752;\n        int64_t global_tid_54753;\n        int64_t slice_54754;\n        int64_t write_i_46954;\n        int64_t remnant_54755;\n        \n        virt_tblock_id_54752 = phys_tblock_id_54749 + i_54751 * sext_i64_i32(num_tblocks_46960);\n        global_tid_54753 = sext_i32_i64(virt_tblock_id_54752) * segmap_tblock_sizze_46958 + sext_i32_i64(local_tid_54745);\n        slice_54754 = n_36798;\n        write_i_46954 = global_tid_54753;\n        remnant_54755 = global_tid_54753 - write_i_46954;\n        if (slt64(write_i_46954, n_36798)) {\n            int64_t eta_p_45074;\n            double write_value_45077;\n            double write_value_45078;\n            bool cond_45079;\n  ", "          int64_t lifted_lambda_res_45080;\n            \n            eta_p_45074 = ((__global int64_t *) mem_53537)[write_i_46954];\n            write_value_45077 = ((__global double *) current_partition_mem_53519)[write_i_46954];\n            write_value_45078 = ((__global double *) current_partition_mem_53520)[write_i_46954];\n            cond_45079 = eta_p_45074 == (int64_t) 1;\n            if (cond_45079) {\n                int64_t eta_p_45075;\n                int64_t lifted_lambda_res_t_res_45321;\n                \n                eta_p_45075 = ((__global int64_t *) mem_53535)[write_i_46954];\n                lifted_lambda_res_t_res_45321 = sub64(eta_p_45075, (int64_t) 1);\n                lifted_lambda_res_45080 = lifted_lambda_res_t_res_45321;\n            } else {\n                lifted_lambda_res_45080 = (int64_t) -1;\n            }\n            if (sle64((int64_t) 0, lifted_lambda_res_45080) && slt64(lifted_lambda_res_45080, m_43655)) {\n                ((__global int64_t *) mem_53547)[lifted_lambda_res_45080] = write_i_46954;\n            }\n            if (sle64((int64_t) 0, lifted_lambda_res_45080) && slt64(lifted_lambda_res_45080, m_43655)) {\n                ((__global double *) mem_53545)[lifted_lambda_res_45080] = write_value_45077;\n            }\n            if (sle64((int64_t) 0, lifted_lambda_res_45080) && slt64(lifted_lambda_res_45080, m_43655)) {\n                ((__global double *) mem_53543)[lifted_lambda_res_45080] = write_value_45078;\n            }\n        }\n        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    }\n    \n  error_1:\n    return;\n    #undef segmap_tblock_sizze_46958\n}\nFUTHARK_KERNEL_SIZED(do_DBSCAN_doublezisegmap_46971_dim1, 1, 1)\nvoid do_DBSCAN_doublezisegmap_46971(__global int *global_failure, int64_t dz2082U_36803, int64_t m_43734, int64_t num_tblocks_46976, int32_t virt_num_tblocks_54889, __global unsigned char *clProc_mem_53514, __global unsigned char *clProc_mem_53515, __global unsigned char *mem_53564, __global unsigned char *me", "m_53566, __global unsigned char *mem_53568, __global unsigned char *mem_53570, __global unsigned char *mem_53572, __global unsigned char *mem_53574, __global unsigned char *mem_53576)\n{\n    #define segmap_tblock_sizze_46974 (do_DBSCAN_doublezisegmap_46971zisegmap_tblock_sizze_46974)\n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_54891;\n    int32_t tblock_sizze_54894;\n    int32_t wave_sizze_54893;\n    int32_t block_id_54892;\n    int32_t global_tid_54890;\n    int64_t phys_tid_46971;\n    int32_t phys_tblock_id_54895;\n    int32_t iterations_54896;\n    \n    local_tid_54891 = get_local_id(0);\n    tblock_sizze_54894 = get_local_size(0);\n    wave_sizze_54893 = LOCKSTEP_WIDTH;\n    block_id_54892 = get_tblock_id(0);\n    global_tid_54890 = block_id_54892 * tblock_sizze_54894 + local_tid_54891;\n    phys_tid_46971 = sext_i32_i64(global_tid_54890);\n    phys_tblock_id_54895 = get_tblock_id(0);\n    iterations_54896 = sdiv_up32(virt_num_tblocks_54889 - phys_tblock_id_54895, sext_i64_i32(num_tblocks_46976));\n    for (int32_t i_54897 = 0; i_54897 < iterations_54896; i_54897++) {\n        int32_t virt_tblock_id_54898;\n        int64_t global_tid_54899;\n        int64_t slice_54900;\n        int64_t write_i_46970;\n        int64_t remnant_54901;\n        \n        virt_tblock_id_54898 = phys_tblock_id_54895 + i_54897 * sext_i64_i32(num_tblocks_46976);\n        global_tid_54899 = sext_i32_i64(virt_tblock_id_54898) * segmap_tblock_sizze_46974 + sext_i32_i64(local_tid_54891);\n        slice_54900 = dz2082U_36803;\n        write_i_46970 = global_tid_54899;\n        remnant_54901 = global_tid_54899 - write_i_46970;\n        if (slt64(write_i_46970, dz2082U_36803)) {\n            int64_t eta_p_45013;\n            double write_value_45015;\n            double write_value_45016;\n            int64_t write_value_45017;\n            bool cond_45019;\n            int64_t lifted_lambda_res_45020;\n            \n            eta_p_45013 = ((__global int64_t *) mem_53566)[write_i_46970];\n       ",
                                    "     write_value_45015 = ((__global double *) clProc_mem_53514)[write_i_46970];\n            write_value_45016 = ((__global double *) clProc_mem_53515)[write_i_46970];\n            write_value_45017 = ((__global int64_t *) mem_53568)[write_i_46970];\n            cond_45019 = eta_p_45013 == (int64_t) 1;\n            if (cond_45019) {\n                int64_t eta_p_45014;\n                int64_t lifted_lambda_res_t_res_45336;\n                \n                eta_p_45014 = ((__global int64_t *) mem_53564)[write_i_46970];\n                lifted_lambda_res_t_res_45336 = sub64(eta_p_45014, (int64_t) 1);\n                lifted_lambda_res_45020 = lifted_lambda_res_t_res_45336;\n            } else {\n                lifted_lambda_res_45020 = (int64_t) -1;\n            }\n            if (sle64((int64_t) 0, lifted_lambda_res_45020) && slt64(lifted_lambda_res_45020, m_43734)) {\n                ((__global double *) mem_53576)[lifted_lambda_res_45020] = write_value_45015;\n            }\n            if (sle64((int64_t) 0, lifted_lambda_res_45020) && slt64(lifted_lambda_res_45020, m_43734)) {\n                ((__global double *) mem_53574)[lifted_lambda_res_45020] = write_value_45016;\n            }\n            if (sle64((int64_t) 0, lifted_lambda_res_45020) && slt64(lifted_lambda_res_45020, m_43734)) {\n                ((__global int64_t *) mem_53572)[lifted_lambda_res_45020] = write_value_45017;\n            }\n            if (sle64((int64_t) 0, lifted_lambda_res_45020) && slt64(lifted_lambda_res_45020, m_43734)) {\n                ((__global int64_t *) mem_53570)[lifted_lambda_res_45020] = write_i_46970;\n            }\n        }\n        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    }\n    \n  error_1:\n    return;\n    #undef segmap_tblock_sizze_46974\n}\nFUTHARK_KERNEL_SIZED(do_DBSCAN_doublezisegmap_46987_dim1, 1, 1)\nvoid do_DBSCAN_doublezisegmap_46987(__global int *global_failure, int64_t m_43734, int64_t y_43814, int64_t num_tblocks_46992, int32_t virt_num_tblocks_55056, __global unsign", "ed char *mem_53570, __global unsigned char *mem_53572, __global unsigned char *mem_53574, __global unsigned char *mem_53576, __global unsigned char *mem_53580, __global unsigned char *mem_53582, __global unsigned char *mem_53584, __global unsigned char *mem_53586, __global unsigned char *mem_53588, __global unsigned char *mem_53590, __global unsigned char *mem_53592)\n{\n    #define segmap_tblock_sizze_46990 (do_DBSCAN_doublezisegmap_46987zisegmap_tblock_sizze_46990)\n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_55058;\n    int32_t tblock_sizze_55061;\n    int32_t wave_sizze_55060;\n    int32_t block_id_55059;\n    int32_t global_tid_55057;\n    int64_t phys_tid_46987;\n    int32_t phys_tblock_id_55062;\n    int32_t iterations_55063;\n    \n    local_tid_55058 = get_local_id(0);\n    tblock_sizze_55061 = get_local_size(0);\n    wave_sizze_55060 = LOCKSTEP_WIDTH;\n    block_id_55059 = get_tblock_id(0);\n    global_tid_55057 = block_id_55059 * tblock_sizze_55061 + local_tid_55058;\n    phys_tid_46987 = sext_i32_i64(global_tid_55057);\n    phys_tblock_id_55062 = get_tblock_id(0);\n    iterations_55063 = sdiv_up32(virt_num_tblocks_55056 - phys_tblock_id_55062, sext_i64_i32(num_tblocks_46992));\n    for (int32_t i_55064 = 0; i_55064 < iterations_55063; i_55064++) {\n        int32_t virt_tblock_id_55065;\n        int64_t global_tid_55066;\n        int64_t slice_55067;\n        int64_t write_i_46986;\n        int64_t remnant_55068;\n        \n        virt_tblock_id_55065 = phys_tblock_id_55062 + i_55064 * sext_i64_i32(num_tblocks_46992);\n        global_tid_55066 = sext_i32_i64(virt_tblock_id_55065) * segmap_tblock_sizze_46990 + sext_i32_i64(local_tid_55058);\n        slice_55067 = m_43734;\n        write_i_46986 = global_tid_55066;\n        remnant_55068 = global_tid_55066 - write_i_46986;\n        if (slt64(write_i_46986, m_43734)) {\n            int64_t c_43819;\n            int64_t offset_43820;\n            int64_t offset_43821;\n            double v_43822;\n            double", " v_43823;\n            int64_t v_43824;\n            int64_t v_43825;\n            bool is_this_one_43826;\n            bool is_this_one_43827;\n            int64_t this_offset_43828;\n            int64_t total_res_43829;\n            int64_t this_offset_43830;\n            int64_t total_res_43831;\n            \n            c_43819 = ((__global int64_t *) mem_53584)[write_i_46986];\n            offset_43820 = ((__global int64_t *) mem_53580)[write_i_46986];\n            offset_43821 = ((__global int64_t *) mem_53582)[write_i_46986];\n            v_43822 = ((__global double *) mem_53576)[write_i_46986];\n            v_43823 = ((__global double *) mem_53574)[write_i_46986];\n            v_43824 = ((__global int64_t *) mem_53572)[write_i_46986];\n            v_43825 = ((__global int64_t *) mem_53570)[write_i_46986];\n            is_this_one_43826 = c_43819 == (int64_t) 0;\n            is_this_one_43827 = c_43819 == (int64_t) 1;\n            this_offset_43828 = y_43814 + offset_43821;\n            if (is_this_one_43827) {\n                total_res_43829 = this_offset_43828;\n            } else {\n                total_res_43829 = (int64_t) -1;\n            }\n            this_offset_43830 = (int64_t) -1 + offset_43820;\n            if (is_this_one_43826) {\n                total_res_43831 = this_offset_43830;\n            } else {\n                total_res_43831 = total_res_43829;\n            }\n            if (sle64((int64_t) 0, total_res_43831) && slt64(total_res_43831, m_43734)) {\n                ((__global double *) mem_53586)[total_res_43831] = v_43822;\n            }\n            if (sle64((int64_t) 0, total_res_43831) && slt64(total_res_43831, m_43734)) {\n                ((__global double *) mem_53588)[total_res_43831] = v_43823;\n            }\n            if (sle64((int64_t) 0, total_res_43831) && slt64(total_res_43831, m_43734)) {\n                ((__global int64_t *) mem_53590)[total_res_43831] = v_43824;\n            }\n            if (sle64((int64_t) 0, total_res_43831) && slt64(total_res_",
                                    "43831, m_43734)) {\n                ((__global int64_t *) mem_53592)[total_res_43831] = v_43825;\n            }\n        }\n        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    }\n    \n  error_1:\n    return;\n    #undef segmap_tblock_sizze_46990\n}\nFUTHARK_KERNEL_SIZED(do_DBSCAN_doublezisegmap_47003_dim1, 1, 1)\nvoid do_DBSCAN_doublezisegmap_47003(__global int *global_failure, int64_t partition_sizze_43809, int64_t m_43906, int64_t num_tblocks_47008, int32_t virt_num_tblocks_55173, __global unsigned char *mem_53586, __global unsigned char *mem_53588, __global unsigned char *mem_53590, __global unsigned char *mem_53605, __global unsigned char *mem_53607, __global unsigned char *mem_53610, __global unsigned char *mem_53612, __global unsigned char *mem_53614)\n{\n    #define segmap_tblock_sizze_47006 (do_DBSCAN_doublezisegmap_47003zisegmap_tblock_sizze_47006)\n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_55175;\n    int32_t tblock_sizze_55178;\n    int32_t wave_sizze_55177;\n    int32_t block_id_55176;\n    int32_t global_tid_55174;\n    int64_t phys_tid_47003;\n    int32_t phys_tblock_id_55179;\n    int32_t iterations_55180;\n    \n    local_tid_55175 = get_local_id(0);\n    tblock_sizze_55178 = get_local_size(0);\n    wave_sizze_55177 = LOCKSTEP_WIDTH;\n    block_id_55176 = get_tblock_id(0);\n    global_tid_55174 = block_id_55176 * tblock_sizze_55178 + local_tid_55175;\n    phys_tid_47003 = sext_i32_i64(global_tid_55174);\n    phys_tblock_id_55179 = get_tblock_id(0);\n    iterations_55180 = sdiv_up32(virt_num_tblocks_55173 - phys_tblock_id_55179, sext_i64_i32(num_tblocks_47008));\n    for (int32_t i_55181 = 0; i_55181 < iterations_55180; i_55181++) {\n        int32_t virt_tblock_id_55182;\n        int64_t global_tid_55183;\n        int64_t slice_55184;\n        int64_t write_i_47002;\n        int64_t remnant_55185;\n        \n        virt_tblock_id_55182 = phys_tblock_id_55179 + i_55181 * sext_i64_i32(num_tblocks_47008);\n        global_tid_55183 = sext_i32_i64(v", "irt_tblock_id_55182) * segmap_tblock_sizze_47006 + sext_i32_i64(local_tid_55175);\n        slice_55184 = partition_sizze_43809;\n        write_i_47002 = global_tid_55183;\n        remnant_55185 = global_tid_55183 - write_i_47002;\n        if (slt64(write_i_47002, partition_sizze_43809)) {\n            int64_t eta_p_44925;\n            double write_value_44927;\n            double write_value_44928;\n            int64_t write_value_44929;\n            bool cond_44930;\n            int64_t lifted_lambda_res_44931;\n            \n            eta_p_44925 = ((__global int64_t *) mem_53607)[write_i_47002];\n            write_value_44927 = ((__global double *) mem_53586)[write_i_47002];\n            write_value_44928 = ((__global double *) mem_53588)[write_i_47002];\n            write_value_44929 = ((__global int64_t *) mem_53590)[write_i_47002];\n            cond_44930 = eta_p_44925 == (int64_t) 1;\n            if (cond_44930) {\n                int64_t eta_p_44926;\n                int64_t lifted_lambda_res_t_res_45351;\n                \n                eta_p_44926 = ((__global int64_t *) mem_53605)[write_i_47002];\n                lifted_lambda_res_t_res_45351 = sub64(eta_p_44926, (int64_t) 1);\n                lifted_lambda_res_44931 = lifted_lambda_res_t_res_45351;\n            } else {\n                lifted_lambda_res_44931 = (int64_t) -1;\n            }\n            if (sle64((int64_t) 0, lifted_lambda_res_44931) && slt64(lifted_lambda_res_44931, m_43906)) {\n                ((__global double *) mem_53614)[lifted_lambda_res_44931] = write_value_44927;\n            }\n            if (sle64((int64_t) 0, lifted_lambda_res_44931) && slt64(lifted_lambda_res_44931, m_43906)) {\n                ((__global double *) mem_53612)[lifted_lambda_res_44931] = write_value_44928;\n            }\n            if (sle64((int64_t) 0, lifted_lambda_res_44931) && slt64(lifted_lambda_res_44931, m_43906)) {\n                ((__global int64_t *) mem_53610)[lifted_lambda_res_44931] = write_value_44929;\n            }\n    ", "    }\n        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    }\n    \n  error_1:\n    return;\n    #undef segmap_tblock_sizze_47006\n}\nFUTHARK_KERNEL_SIZED(do_DBSCAN_doublezisegmap_47011_dim1, 1, 1)\nvoid do_DBSCAN_doublezisegmap_47011(__global int *global_failure, int64_t n_36798, int64_t m_43655, int64_t num_tblocks_47016, int32_t virt_num_tblocks_55186, __global unsigned char *mem_53547, __global unsigned char *mem_53553, __global unsigned char *ext_mem_53616)\n{\n    #define segmap_tblock_sizze_47014 (do_DBSCAN_doublezisegmap_47011zisegmap_tblock_sizze_47014)\n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_55188;\n    int32_t tblock_sizze_55191;\n    int32_t wave_sizze_55190;\n    int32_t block_id_55189;\n    int32_t global_tid_55187;\n    int64_t phys_tid_47011;\n    int32_t phys_tblock_id_55192;\n    int32_t iterations_55193;\n    \n    local_tid_55188 = get_local_id(0);\n    tblock_sizze_55191 = get_local_size(0);\n    wave_sizze_55190 = LOCKSTEP_WIDTH;\n    block_id_55189 = get_tblock_id(0);\n    global_tid_55187 = block_id_55189 * tblock_sizze_55191 + local_tid_55188;\n    phys_tid_47011 = sext_i32_i64(global_tid_55187);\n    phys_tblock_id_55192 = get_tblock_id(0);\n    iterations_55193 = sdiv_up32(virt_num_tblocks_55186 - phys_tblock_id_55192, sext_i64_i32(num_tblocks_47016));\n    for (int32_t i_55194 = 0; i_55194 < iterations_55193; i_55194++) {\n        int32_t virt_tblock_id_55195;\n        int64_t global_tid_55196;\n        int64_t slice_55197;\n        int64_t write_i_47010;\n        int64_t remnant_55198;\n        \n        virt_tblock_id_55195 = phys_tblock_id_55192 + i_55194 * sext_i64_i32(num_tblocks_47016);\n        global_tid_55196 = sext_i32_i64(virt_tblock_id_55195) * segmap_tblock_sizze_47014 + sext_i32_i64(local_tid_55188);\n        slice_55197 = m_43655;\n        write_i_47010 = global_tid_55196;\n        remnant_55198 = global_tid_55196 - write_i_47010;\n        if (slt64(write_i_47010, m_43655)) {\n            int64_t write_index_43882;\n  ",
                                    "          int64_t write_value_43883;\n            \n            write_index_43882 = ((__global int64_t *) mem_53547)[write_i_47010];\n            write_value_43883 = ((__global int64_t *) ext_mem_53616)[write_i_47010];\n            if (sle64((int64_t) 0, write_index_43882) && slt64(write_index_43882, n_36798)) {\n                ((__global int64_t *) mem_53553)[write_index_43882] = write_value_43883;\n            }\n        }\n        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    }\n    \n  error_1:\n    return;\n    #undef segmap_tblock_sizze_47014\n}\nFUTHARK_KERNEL_SIZED(do_DBSCAN_doublezisegmap_47036_dim1, 1, 1)\nvoid do_DBSCAN_doublezisegmap_47036(__global int *global_failure, int64_t n_36798, int64_t clBase_36814, __global unsigned char *mem_53553, __global unsigned char *ext_mem_53554, __global unsigned char *mem_53619)\n{\n    #define segmap_tblock_sizze_47032 (do_DBSCAN_doublezisegmap_47036zisegmap_tblock_sizze_47032)\n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_55201;\n    int32_t tblock_sizze_55204;\n    int32_t wave_sizze_55203;\n    int32_t block_id_55202;\n    int32_t global_tid_55200;\n    int64_t phys_tid_47036;\n    int64_t global_tid_55205;\n    int64_t slice_55206;\n    int64_t gtid_47035;\n    int64_t remnant_55207;\n    \n    local_tid_55201 = get_local_id(0);\n    tblock_sizze_55204 = get_local_size(0);\n    wave_sizze_55203 = LOCKSTEP_WIDTH;\n    block_id_55202 = get_tblock_id(0);\n    global_tid_55200 = block_id_55202 * tblock_sizze_55204 + local_tid_55201;\n    phys_tid_47036 = sext_i32_i64(global_tid_55200);\n    global_tid_55205 = sext_i32_i64(block_id_55202) * segmap_tblock_sizze_47032 + sext_i32_i64(local_tid_55201);\n    slice_55206 = n_36798;\n    gtid_47035 = global_tid_55205;\n    remnant_55207 = global_tid_55205 - gtid_47035;\n    if (slt64(gtid_47035, n_36798)) {\n        int64_t eta_p_47037;\n        int64_t eta_p_47038;\n        int64_t lifted_lambda_res_47039;\n        int64_t defunc_0_f_res_47040;\n        bool lifted_lambda_res_47", "041;\n        \n        eta_p_47037 = ((__global int64_t *) ext_mem_53554)[gtid_47035];\n        eta_p_47038 = ((__global int64_t *) mem_53553)[gtid_47035];\n        lifted_lambda_res_47039 = sub64(eta_p_47037, (int64_t) 1);\n        defunc_0_f_res_47040 = add64(eta_p_47038, lifted_lambda_res_47039);\n        lifted_lambda_res_47041 = sle64(clBase_36814, defunc_0_f_res_47040);\n        ((__global bool *) mem_53619)[gtid_47035] = lifted_lambda_res_47041;\n    }\n    \n  error_0:\n    return;\n    #undef segmap_tblock_sizze_47032\n}\nFUTHARK_KERNEL_SIZED(do_DBSCAN_doublezisegmap_47051_dim1, 1, 1)\nvoid do_DBSCAN_doublezisegmap_47051(__global int *global_failure, int64_t n_36798, int64_t m_43948, int64_t num_tblocks_47056, int32_t virt_num_tblocks_55310, __global unsigned char *current_partition_mem_53519, __global unsigned char *current_partition_mem_53520, __global unsigned char *mem_53622, __global unsigned char *mem_53624, __global unsigned char *mem_53628, __global unsigned char *mem_53630, __global unsigned char *mem_53632)\n{\n    #define segmap_tblock_sizze_47054 (do_DBSCAN_doublezisegmap_47051zisegmap_tblock_sizze_47054)\n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_55312;\n    int32_t tblock_sizze_55315;\n    int32_t wave_sizze_55314;\n    int32_t block_id_55313;\n    int32_t global_tid_55311;\n    int64_t phys_tid_47051;\n    int32_t phys_tblock_id_55316;\n    int32_t iterations_55317;\n    \n    local_tid_55312 = get_local_id(0);\n    tblock_sizze_55315 = get_local_size(0);\n    wave_sizze_55314 = LOCKSTEP_WIDTH;\n    block_id_55313 = get_tblock_id(0);\n    global_tid_55311 = block_id_55313 * tblock_sizze_55315 + local_tid_55312;\n    phys_tid_47051 = sext_i32_i64(global_tid_55311);\n    phys_tblock_id_55316 = get_tblock_id(0);\n    iterations_55317 = sdiv_up32(virt_num_tblocks_55310 - phys_tblock_id_55316, sext_i64_i32(num_tblocks_47056));\n    for (int32_t i_55318 = 0; i_55318 < iterations_55317; i_55318++) {\n        int32_t virt_tblock_id_55319;\n        int64_t", " global_tid_55320;\n        int64_t slice_55321;\n        int64_t write_i_47050;\n        int64_t remnant_55322;\n        \n        virt_tblock_id_55319 = phys_tblock_id_55316 + i_55318 * sext_i64_i32(num_tblocks_47056);\n        global_tid_55320 = sext_i32_i64(virt_tblock_id_55319) * segmap_tblock_sizze_47054 + sext_i32_i64(local_tid_55312);\n        slice_55321 = n_36798;\n        write_i_47050 = global_tid_55320;\n        remnant_55322 = global_tid_55320 - write_i_47050;\n        if (slt64(write_i_47050, n_36798)) {\n            int64_t eta_p_44912;\n            double write_value_44914;\n            double write_value_44915;\n            bool cond_44916;\n            int64_t lifted_lambda_res_44917;\n            \n            eta_p_44912 = ((__global int64_t *) mem_53624)[write_i_47050];\n            write_value_44914 = ((__global double *) current_partition_mem_53519)[write_i_47050];\n            write_value_44915 = ((__global double *) current_partition_mem_53520)[write_i_47050];\n            cond_44916 = eta_p_44912 == (int64_t) 1;\n            if (cond_44916) {\n                int64_t eta_p_44913;\n                int64_t lifted_lambda_res_t_res_45354;\n                \n                eta_p_44913 = ((__global int64_t *) mem_53622)[write_i_47050];\n                lifted_lambda_res_t_res_45354 = sub64(eta_p_44913, (int64_t) 1);\n                lifted_lambda_res_44917 = lifted_lambda_res_t_res_45354;\n            } else {\n                lifted_lambda_res_44917 = (int64_t) -1;\n            }\n            if (sle64((int64_t) 0, lifted_lambda_res_44917) && slt64(lifted_lambda_res_44917, m_43948)) {\n                ((__global double *) mem_53632)[lifted_lambda_res_44917] = write_value_44914;\n            }\n            if (sle64((int64_t) 0, lifted_lambda_res_44917) && slt64(lifted_lambda_res_44917, m_43948)) {\n                ((__global double *) mem_53630)[lifted_lambda_res_44917] = write_value_44915;\n            }\n            if (sle64((int64_t) 0, lifted_lambda_res_44917) && slt64(lifte",
                                    "d_lambda_res_44917, m_43948)) {\n                ((__global int64_t *) mem_53628)[lifted_lambda_res_44917] = (int64_t) -1;\n            }\n        }\n        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    }\n    \n  error_1:\n    return;\n    #undef segmap_tblock_sizze_47054\n}\nFUTHARK_KERNEL_SIZED(do_DBSCAN_doublezisegmap_47249_dim1, 1, 1)\nvoid do_DBSCAN_doublezisegmap_47249(__global int *global_failure, int8_t clBase_36809, int64_t m_43906, int64_t inf_44008, int64_t j_m_i_44011, __global unsigned char *mem_53612, __global unsigned char *mem_53614, __global unsigned char *mem_53630, __global unsigned char *mem_53632, __global unsigned char *mem_53655, __global unsigned char *mem_53657, __global unsigned char *mem_53659)\n{\n    #define segmap_tblock_sizze_47243 (do_DBSCAN_doublezisegmap_47249zisegmap_tblock_sizze_47243)\n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_55453;\n    int32_t tblock_sizze_55456;\n    int32_t wave_sizze_55455;\n    int32_t block_id_55454;\n    int32_t global_tid_55452;\n    int64_t phys_tid_47249;\n    int64_t global_tid_55457;\n    int64_t slice_55458;\n    int64_t gtid_47248;\n    int64_t remnant_55459;\n    \n    local_tid_55453 = get_local_id(0);\n    tblock_sizze_55456 = get_local_size(0);\n    wave_sizze_55455 = LOCKSTEP_WIDTH;\n    block_id_55454 = get_tblock_id(0);\n    global_tid_55452 = block_id_55454 * tblock_sizze_55456 + local_tid_55453;\n    phys_tid_47249 = sext_i32_i64(global_tid_55452);\n    global_tid_55457 = sext_i32_i64(block_id_55454) * segmap_tblock_sizze_47243 + sext_i32_i64(local_tid_55453);\n    slice_55458 = j_m_i_44011;\n    gtid_47248 = global_tid_55457;\n    remnant_55459 = global_tid_55457 - gtid_47248;\n    if (slt64(gtid_47248, j_m_i_44011)) {\n        int64_t slice_49799;\n        bool index_concat_cmp_49801;\n        double index_concat_branch_49805;\n        double index_concat_branch_49798;\n        double zt_res_47252;\n        double zt_res_47253;\n        double zs_res_47254;\n        double zs_res_47255", ";\n        double d_haversine_res_47256;\n        double d_haversine_res_47257;\n        double cos_res_47258;\n        \n        slice_49799 = inf_44008 + gtid_47248;\n        index_concat_cmp_49801 = sle64(m_43906, slice_49799);\n        if (index_concat_cmp_49801) {\n            int64_t index_concat_i_49802;\n            double index_concat_49803;\n            \n            index_concat_i_49802 = sub64(slice_49799, m_43906);\n            index_concat_49803 = ((__global double *) mem_53632)[index_concat_i_49802];\n            index_concat_branch_49805 = index_concat_49803;\n        } else {\n            double index_concat_49804 = ((__global double *) mem_53614)[slice_49799];\n            \n            index_concat_branch_49805 = index_concat_49804;\n        }\n        if (index_concat_cmp_49801) {\n            int64_t index_concat_i_49795;\n            double index_concat_49796;\n            \n            index_concat_i_49795 = sub64(slice_49799, m_43906);\n            index_concat_49796 = ((__global double *) mem_53630)[index_concat_i_49795];\n            index_concat_branch_49798 = index_concat_49796;\n        } else {\n            double index_concat_49797 = ((__global double *) mem_53612)[slice_49799];\n            \n            index_concat_branch_49798 = index_concat_49797;\n        }\n        zt_res_47252 = 3.141592653589793 * index_concat_branch_49805;\n        zt_res_47253 = 3.141592653589793 * index_concat_branch_49798;\n        zs_res_47254 = zt_res_47252 / 180.0;\n        zs_res_47255 = zt_res_47253 / 180.0;\n        if (clBase_36809 == (int8_t) 1) {\n            d_haversine_res_47256 = index_concat_branch_49805;\n        } else {\n            d_haversine_res_47256 = zs_res_47254;\n        }\n        if (clBase_36809 == (int8_t) 1) {\n            d_haversine_res_47257 = index_concat_branch_49798;\n        } else {\n            d_haversine_res_47257 = zs_res_47255;\n        }\n        cos_res_47258 = futrts_cos64(d_haversine_res_47256);\n        ((__global double *) mem_53655)[gtid_47248] = d_have", "rsine_res_47256;\n        ((__global double *) mem_53657)[gtid_47248] = d_haversine_res_47257;\n        ((__global double *) mem_53659)[gtid_47248] = cos_res_47258;\n    }\n    \n  error_0:\n    return;\n    #undef segmap_tblock_sizze_47243\n}\nFUTHARK_KERNEL_SIZED(do_DBSCAN_doublezisegmap_47345_dim1, 1, 1)\nvoid do_DBSCAN_doublezisegmap_47345(__global int *global_failure, int64_t conc_tmp_43977, __global unsigned char *mem_53730, __global unsigned char *mem_53733)\n{\n    #define segmap_tblock_sizze_47341 (do_DBSCAN_doublezisegmap_47345zisegmap_tblock_sizze_47341)\n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_55672;\n    int32_t tblock_sizze_55675;\n    int32_t wave_sizze_55674;\n    int32_t block_id_55673;\n    int32_t global_tid_55671;\n    int64_t phys_tid_47345;\n    int64_t global_tid_55676;\n    int64_t slice_55677;\n    int64_t gtid_47344;\n    int64_t remnant_55678;\n    \n    local_tid_55672 = get_local_id(0);\n    tblock_sizze_55675 = get_local_size(0);\n    wave_sizze_55674 = LOCKSTEP_WIDTH;\n    block_id_55673 = get_tblock_id(0);\n    global_tid_55671 = block_id_55673 * tblock_sizze_55675 + local_tid_55672;\n    phys_tid_47345 = sext_i32_i64(global_tid_55671);\n    global_tid_55676 = sext_i32_i64(block_id_55673) * segmap_tblock_sizze_47341 + sext_i32_i64(local_tid_55672);\n    slice_55677 = conc_tmp_43977;\n    gtid_47344 = global_tid_55676;\n    remnant_55678 = global_tid_55676 - gtid_47344;\n    if (slt64(gtid_47344, conc_tmp_43977)) {\n        int64_t zv_lhs_47347;\n        int64_t tmp_47348;\n        bool cond_47350;\n        int64_t lifted_lambda_res_47351;\n        \n        zv_lhs_47347 = add64((int64_t) -1, gtid_47344);\n        tmp_47348 = smod64(zv_lhs_47347, conc_tmp_43977);\n        cond_47350 = gtid_47344 == (int64_t) 0;\n        if (cond_47350) {\n            lifted_lambda_res_47351 = (int64_t) 0;\n        } else {\n            int64_t lifted_lambda_res_47349 = ((__global int64_t *) mem_53730)[tmp_47348];\n            \n            lifted_lambda_res_47351 = l",
                                    "ifted_lambda_res_47349;\n        }\n        ((__global int64_t *) mem_53733)[gtid_47344] = lifted_lambda_res_47351;\n    }\n    \n  error_0:\n    return;\n    #undef segmap_tblock_sizze_47341\n}\nFUTHARK_KERNEL_SIZED(do_DBSCAN_doublezisegmap_47376_dim1, 1, 1)\nvoid do_DBSCAN_doublezisegmap_47376(__global int *global_failure, int failure_is_an_option, __global int64_t *global_failure_args, int64_t conc_tmp_43977, int64_t inf_44127, int64_t min_res_44129, __global unsigned char *ext_mem_53727, __global unsigned char *mem_53733, __global unsigned char *mem_param_53736, __global unsigned char *mem_53739)\n{\n    #define segmap_tblock_sizze_47372 (do_DBSCAN_doublezisegmap_47376zisegmap_tblock_sizze_47372)\n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_55683;\n    int32_t tblock_sizze_55686;\n    int32_t wave_sizze_55685;\n    int32_t block_id_55684;\n    int32_t global_tid_55682;\n    int64_t phys_tid_47376;\n    int64_t global_tid_55687;\n    int64_t slice_55688;\n    int64_t gtid_47375;\n    int64_t remnant_55689;\n    \n    local_tid_55683 = get_local_id(0);\n    tblock_sizze_55686 = get_local_size(0);\n    wave_sizze_55685 = LOCKSTEP_WIDTH;\n    block_id_55684 = get_tblock_id(0);\n    global_tid_55682 = block_id_55684 * tblock_sizze_55686 + local_tid_55683;\n    phys_tid_47376 = sext_i32_i64(global_tid_55682);\n    global_tid_55687 = sext_i32_i64(block_id_55684) * segmap_tblock_sizze_47372 + sext_i32_i64(local_tid_55683);\n    slice_55688 = conc_tmp_43977;\n    gtid_47375 = global_tid_55687;\n    remnant_55689 = global_tid_55687 - gtid_47375;\n    if (slt64(gtid_47375, conc_tmp_43977)) {\n        int64_t eta_p_47377;\n        bool cond_47379;\n        bool cond_t_res_47380;\n        bool x_47381;\n        int64_t lifted_lambda_res_47382;\n        \n        eta_p_47377 = ((__global int64_t *) ext_mem_53727)[gtid_47375];\n        cond_47379 = sle64(inf_44127, eta_p_47377);\n        cond_t_res_47380 = slt64(eta_p_47377, min_res_44129);\n        x_47381 = cond_47379 && cond_t_res_47380;\n", "        if (x_47381) {\n            bool x_47383;\n            bool y_47384;\n            bool bounds_check_47385;\n            bool index_certs_47386;\n            int64_t lifted_lambda_res_t_res_47387;\n            \n            x_47383 = sle64((int64_t) 0, eta_p_47377);\n            y_47384 = slt64(eta_p_47377, conc_tmp_43977);\n            bounds_check_47385 = x_47383 && y_47384;\n            if (!bounds_check_47385) {\n                {\n                    if (atomic_cmpxchg_i32_global(global_failure, -1, 21) == -1) {\n                        global_failure_args[0] = (int64_t) eta_p_47377;\n                        global_failure_args[1] = (int64_t) conc_tmp_43977;\n                        ;\n                    }\n                    return;\n                }\n            }\n            lifted_lambda_res_t_res_47387 = ((__global int64_t *) mem_53733)[eta_p_47377];\n            lifted_lambda_res_47382 = lifted_lambda_res_t_res_47387;\n        } else {\n            int64_t eta_p_47378 = ((__global int64_t *) mem_param_53736)[gtid_47375];\n            \n            lifted_lambda_res_47382 = eta_p_47378;\n        }\n        ((__global int64_t *) mem_53739)[gtid_47375] = lifted_lambda_res_47382;\n    }\n    \n  error_0:\n    return;\n    #undef segmap_tblock_sizze_47372\n}\nFUTHARK_KERNEL_SIZED(do_DBSCAN_doublezisegmap_47403_dim1, 1, 1)\nvoid do_DBSCAN_doublezisegmap_47403(__global int *global_failure, int64_t clProc_36824, int64_t conc_tmp_43977, __global unsigned char *ext_mem_53742, __global unsigned char *mem_53745)\n{\n    #define segmap_tblock_sizze_47399 (do_DBSCAN_doublezisegmap_47403zisegmap_tblock_sizze_47399)\n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_55692;\n    int32_t tblock_sizze_55695;\n    int32_t wave_sizze_55694;\n    int32_t block_id_55693;\n    int32_t global_tid_55691;\n    int64_t phys_tid_47403;\n    int64_t global_tid_55696;\n    int64_t slice_55697;\n    int64_t gtid_47402;\n    int64_t remnant_55698;\n    \n    local_tid_55692 = get_local_id(0);\n    tbloc", "k_sizze_55695 = get_local_size(0);\n    wave_sizze_55694 = LOCKSTEP_WIDTH;\n    block_id_55693 = get_tblock_id(0);\n    global_tid_55691 = block_id_55693 * tblock_sizze_55695 + local_tid_55692;\n    phys_tid_47403 = sext_i32_i64(global_tid_55691);\n    global_tid_55696 = sext_i32_i64(block_id_55693) * segmap_tblock_sizze_47399 + sext_i32_i64(local_tid_55692);\n    slice_55697 = conc_tmp_43977;\n    gtid_47402 = global_tid_55696;\n    remnant_55698 = global_tid_55696 - gtid_47402;\n    if (slt64(gtid_47402, conc_tmp_43977)) {\n        int64_t eta_p_47404;\n        int64_t lifted_lambda_res_47405;\n        \n        eta_p_47404 = ((__global int64_t *) ext_mem_53742)[gtid_47402];\n        lifted_lambda_res_47405 = add64(clProc_36824, eta_p_47404);\n        ((__global int64_t *) mem_53745)[gtid_47402] = lifted_lambda_res_47405;\n    }\n    \n  error_0:\n    return;\n    #undef segmap_tblock_sizze_47399\n}\nFUTHARK_KERNEL_SIZED(do_DBSCAN_doublezisegmap_47407_dim1, 1, 1)\nvoid do_DBSCAN_doublezisegmap_47407(__global int *global_failure, int64_t m_43906, int64_t conc_tmp_43977, int64_t m_44164, int64_t num_tblocks_47412, int32_t virt_num_tblocks_55700, __global unsigned char *mem_53610, __global unsigned char *mem_53628, __global unsigned char *mem_53638, __global unsigned char *mem_53640, __global unsigned char *mem_53642, __global unsigned char *mem_53745, __global unsigned char *mem_53747)\n{\n    #define segmap_tblock_sizze_47410 (do_DBSCAN_doublezisegmap_47407zisegmap_tblock_sizze_47410)\n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_55702;\n    int32_t tblock_sizze_55705;\n    int32_t wave_sizze_55704;\n    int32_t block_id_55703;\n    int32_t global_tid_55701;\n    int64_t phys_tid_47407;\n    int32_t phys_tblock_id_55706;\n    int32_t iterations_55707;\n    \n    local_tid_55702 = get_local_id(0);\n    tblock_sizze_55705 = get_local_size(0);\n    wave_sizze_55704 = LOCKSTEP_WIDTH;\n    block_id_55703 = get_tblock_id(0);\n    global_tid_55701 = block_id_55703 * tblock_sizze_557",
                                    "05 + local_tid_55702;\n    phys_tid_47407 = sext_i32_i64(global_tid_55701);\n    phys_tblock_id_55706 = get_tblock_id(0);\n    iterations_55707 = sdiv_up32(virt_num_tblocks_55700 - phys_tblock_id_55706, sext_i64_i32(num_tblocks_47412));\n    for (int32_t i_55708 = 0; i_55708 < iterations_55707; i_55708++) {\n        int32_t virt_tblock_id_55709;\n        int64_t global_tid_55710;\n        int64_t slice_55711;\n        int64_t write_i_47406;\n        int64_t remnant_55712;\n        \n        virt_tblock_id_55709 = phys_tblock_id_55706 + i_55708 * sext_i64_i32(num_tblocks_47412);\n        global_tid_55710 = sext_i32_i64(virt_tblock_id_55709) * segmap_tblock_sizze_47410 + sext_i32_i64(local_tid_55702);\n        slice_55711 = conc_tmp_43977;\n        write_i_47406 = global_tid_55710;\n        remnant_55712 = global_tid_55710 - write_i_47406;\n        if (slt64(write_i_47406, conc_tmp_43977)) {\n            int64_t eta_p_44878;\n            int64_t write_value_44880;\n            bool index_concat_cmp_49740;\n            int64_t index_concat_branch_49744;\n            bool cond_44882;\n            int64_t lifted_lambda_res_44883;\n            \n            eta_p_44878 = ((__global int64_t *) mem_53640)[write_i_47406];\n            write_value_44880 = ((__global int64_t *) mem_53745)[write_i_47406];\n            index_concat_cmp_49740 = sle64(m_43906, write_i_47406);\n            if (index_concat_cmp_49740) {\n                int64_t index_concat_i_49741;\n                int64_t index_concat_49742;\n                \n                index_concat_i_49741 = sub64(write_i_47406, m_43906);\n                index_concat_49742 = ((__global int64_t *) mem_53628)[index_concat_i_49741];\n                index_concat_branch_49744 = index_concat_49742;\n            } else {\n                int64_t index_concat_49743 = ((__global int64_t *) mem_53610)[write_i_47406];\n                \n                index_concat_branch_49744 = index_concat_49743;\n            }\n            cond_44882 = eta_p_44878 == (int64_t) 1;\n   ", "         if (cond_44882) {\n                int64_t eta_p_44879;\n                int64_t lifted_lambda_res_t_res_45371;\n                \n                eta_p_44879 = ((__global int64_t *) mem_53638)[write_i_47406];\n                lifted_lambda_res_t_res_45371 = sub64(eta_p_44879, (int64_t) 1);\n                lifted_lambda_res_44883 = lifted_lambda_res_t_res_45371;\n            } else {\n                lifted_lambda_res_44883 = (int64_t) -1;\n            }\n            if (sle64((int64_t) 0, lifted_lambda_res_44883) && slt64(lifted_lambda_res_44883, m_44164)) {\n                ((__global int64_t *) mem_53747)[lifted_lambda_res_44883] = write_value_44880;\n            }\n            if (sle64((int64_t) 0, lifted_lambda_res_44883) && slt64(lifted_lambda_res_44883, m_44164)) {\n                ((__global int64_t *) mem_53642)[lifted_lambda_res_44883] = index_concat_branch_49744;\n            }\n        }\n        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    }\n    \n  error_1:\n    return;\n    #undef segmap_tblock_sizze_47410\n}\nFUTHARK_KERNEL_SIZED(do_DBSCAN_doublezisegmap_47820_dim1, 1, 1)\nvoid do_DBSCAN_doublezisegmap_47820(__global int *global_failure, int64_t m_44164, int64_t m_44254, int64_t num_tblocks_47825, int32_t virt_num_tblocks_55974, __global unsigned char *mem_53642, __global unsigned char *mem_53747, __global unsigned char *ext_mem_53884, __global unsigned char *ext_mem_53885, __global unsigned char *mem_53887, __global unsigned char *mem_53889)\n{\n    #define segmap_tblock_sizze_47823 (do_DBSCAN_doublezisegmap_47820zisegmap_tblock_sizze_47823)\n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_55976;\n    int32_t tblock_sizze_55979;\n    int32_t wave_sizze_55978;\n    int32_t block_id_55977;\n    int32_t global_tid_55975;\n    int64_t phys_tid_47820;\n    int32_t phys_tblock_id_55980;\n    int32_t iterations_55981;\n    \n    local_tid_55976 = get_local_id(0);\n    tblock_sizze_55979 = get_local_size(0);\n    wave_sizze_55978 = LOCKSTEP_WIDTH", ";\n    block_id_55977 = get_tblock_id(0);\n    global_tid_55975 = block_id_55977 * tblock_sizze_55979 + local_tid_55976;\n    phys_tid_47820 = sext_i32_i64(global_tid_55975);\n    phys_tblock_id_55980 = get_tblock_id(0);\n    iterations_55981 = sdiv_up32(virt_num_tblocks_55974 - phys_tblock_id_55980, sext_i64_i32(num_tblocks_47825));\n    for (int32_t i_55982 = 0; i_55982 < iterations_55981; i_55982++) {\n        int32_t virt_tblock_id_55983;\n        int64_t global_tid_55984;\n        int64_t slice_55985;\n        int64_t write_i_47819;\n        int64_t remnant_55986;\n        \n        virt_tblock_id_55983 = phys_tblock_id_55980 + i_55982 * sext_i64_i32(num_tblocks_47825);\n        global_tid_55984 = sext_i32_i64(virt_tblock_id_55983) * segmap_tblock_sizze_47823 + sext_i32_i64(local_tid_55976);\n        slice_55985 = m_44164;\n        write_i_47819 = global_tid_55984;\n        remnant_55986 = global_tid_55984 - write_i_47819;\n        if (slt64(write_i_47819, m_44164)) {\n            int64_t eta_p_44824;\n            int64_t write_value_44826;\n            int64_t write_value_44827;\n            bool cond_44828;\n            int64_t lifted_lambda_res_44829;\n            \n            eta_p_44824 = ((__global int64_t *) ext_mem_53884)[write_i_47819];\n            write_value_44826 = ((__global int64_t *) mem_53747)[write_i_47819];\n            write_value_44827 = ((__global int64_t *) mem_53642)[write_i_47819];\n            cond_44828 = eta_p_44824 == (int64_t) 1;\n            if (cond_44828) {\n                int64_t eta_p_44825;\n                int64_t lifted_lambda_res_t_res_45376;\n                \n                eta_p_44825 = ((__global int64_t *) ext_mem_53885)[write_i_47819];\n                lifted_lambda_res_t_res_45376 = sub64(eta_p_44825, (int64_t) 1);\n                lifted_lambda_res_44829 = lifted_lambda_res_t_res_45376;\n            } else {\n                lifted_lambda_res_44829 = (int64_t) -1;\n            }\n            if (sle64((int64_t) 0, lifted_lambda_res_44829) && slt64(li",
                                    "fted_lambda_res_44829, m_44254)) {\n                ((__global int64_t *) mem_53889)[lifted_lambda_res_44829] = write_value_44826;\n            }\n            if (sle64((int64_t) 0, lifted_lambda_res_44829) && slt64(lifted_lambda_res_44829, m_44254)) {\n                ((__global int64_t *) mem_53887)[lifted_lambda_res_44829] = write_value_44827;\n            }\n        }\n        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    }\n    \n  error_1:\n    return;\n    #undef segmap_tblock_sizze_47823\n}\nFUTHARK_KERNEL_SIZED(do_DBSCAN_doublezisegmap_48163_dim1, 1, 1)\nvoid do_DBSCAN_doublezisegmap_48163(__global int *global_failure, int64_t m_43906, int64_t conc_tmp_43977, __global unsigned char *mem_53612, __global unsigned char *mem_53614, __global unsigned char *mem_53630, __global unsigned char *mem_53632, __global unsigned char *mem_54010, __global unsigned char *mem_54012)\n{\n    #define segmap_tblock_sizze_48157 (do_DBSCAN_doublezisegmap_48163zisegmap_tblock_sizze_48157)\n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_56517;\n    int32_t tblock_sizze_56520;\n    int32_t wave_sizze_56519;\n    int32_t block_id_56518;\n    int32_t global_tid_56516;\n    int64_t phys_tid_48163;\n    int64_t global_tid_56521;\n    int64_t slice_56522;\n    int64_t gtid_48162;\n    int64_t remnant_56523;\n    \n    local_tid_56517 = get_local_id(0);\n    tblock_sizze_56520 = get_local_size(0);\n    wave_sizze_56519 = LOCKSTEP_WIDTH;\n    block_id_56518 = get_tblock_id(0);\n    global_tid_56516 = block_id_56518 * tblock_sizze_56520 + local_tid_56517;\n    phys_tid_48163 = sext_i32_i64(global_tid_56516);\n    global_tid_56521 = sext_i32_i64(block_id_56518) * segmap_tblock_sizze_48157 + sext_i32_i64(local_tid_56517);\n    slice_56522 = conc_tmp_43977;\n    gtid_48162 = global_tid_56521;\n    remnant_56523 = global_tid_56521 - gtid_48162;\n    if (slt64(gtid_48162, conc_tmp_43977)) {\n        bool index_concat_cmp_48170;\n        double index_concat_branch_48171;\n        double index_concat_", "branch_48175;\n        \n        index_concat_cmp_48170 = sle64(m_43906, gtid_48162);\n        if (index_concat_cmp_48170) {\n            int64_t index_concat_i_48172;\n            double index_concat_48173;\n            \n            index_concat_i_48172 = sub64(gtid_48162, m_43906);\n            index_concat_48173 = ((__global double *) mem_53632)[index_concat_i_48172];\n            index_concat_branch_48171 = index_concat_48173;\n        } else {\n            double index_concat_48174 = ((__global double *) mem_53614)[gtid_48162];\n            \n            index_concat_branch_48171 = index_concat_48174;\n        }\n        if (index_concat_cmp_48170) {\n            int64_t index_concat_i_48176;\n            double index_concat_48177;\n            \n            index_concat_i_48176 = sub64(gtid_48162, m_43906);\n            index_concat_48177 = ((__global double *) mem_53630)[index_concat_i_48176];\n            index_concat_branch_48175 = index_concat_48177;\n        } else {\n            double index_concat_48178 = ((__global double *) mem_53612)[gtid_48162];\n            \n            index_concat_branch_48175 = index_concat_48178;\n        }\n        ((__global double *) mem_54010)[gtid_48162] = index_concat_branch_48171;\n        ((__global double *) mem_54012)[gtid_48162] = index_concat_branch_48175;\n    }\n    \n  error_0:\n    return;\n    #undef segmap_tblock_sizze_48157\n}\nFUTHARK_KERNEL_SIZED(do_DBSCAN_doublezisegmap_48383_dim1, 1, 1)\nvoid do_DBSCAN_doublezisegmap_48383(__global int *global_failure, int8_t clBase_36809, int64_t inf_44477, int64_t dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_44480, __global unsigned char *mem_53586, __global unsigned char *mem_53588, __global unsigned char *mem_54018, __global unsigned char *mem_54020, __global unsigned char *mem_54022)\n{\n    #define segmap_tblock_sizze_48377 (do_DBSCAN_doublezisegmap_48383zisegmap_tblock_sizze_48377)\n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_56549;\n    int32_t tblock_sizze_56552;\n    int32_t wave_si", "zze_56551;\n    int32_t block_id_56550;\n    int32_t global_tid_56548;\n    int64_t phys_tid_48383;\n    int64_t global_tid_56553;\n    int64_t slice_56554;\n    int64_t gtid_48382;\n    int64_t remnant_56555;\n    \n    local_tid_56549 = get_local_id(0);\n    tblock_sizze_56552 = get_local_size(0);\n    wave_sizze_56551 = LOCKSTEP_WIDTH;\n    block_id_56550 = get_tblock_id(0);\n    global_tid_56548 = block_id_56550 * tblock_sizze_56552 + local_tid_56549;\n    phys_tid_48383 = sext_i32_i64(global_tid_56548);\n    global_tid_56553 = sext_i32_i64(block_id_56550) * segmap_tblock_sizze_48377 + sext_i32_i64(local_tid_56549);\n    slice_56554 = dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_44480;\n    gtid_48382 = global_tid_56553;\n    remnant_56555 = global_tid_56553 - gtid_48382;\n    if (slt64(gtid_48382, dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_44480)) {\n        int64_t slice_49702;\n        double eta_p_48384;\n        double eta_p_48385;\n        double zt_res_48386;\n        double zt_res_48387;\n        double zs_res_48388;\n        double zs_res_48389;\n        double d_haversine_res_48390;\n        double d_haversine_res_48391;\n        double cos_res_48392;\n        \n        slice_49702 = inf_44477 + gtid_48382;\n        eta_p_48384 = ((__global double *) mem_53586)[slice_49702];\n        eta_p_48385 = ((__global double *) mem_53588)[slice_49702];\n        zt_res_48386 = 3.141592653589793 * eta_p_48384;\n        zt_res_48387 = 3.141592653589793 * eta_p_48385;\n        zs_res_48388 = zt_res_48386 / 180.0;\n        zs_res_48389 = zt_res_48387 / 180.0;\n        if (clBase_36809 == (int8_t) 1) {\n            d_haversine_res_48390 = eta_p_48384;\n        } else {\n            d_haversine_res_48390 = zs_res_48388;\n        }\n        if (clBase_36809 == (int8_t) 1) {\n            d_haversine_res_48391 = eta_p_48385;\n        } else {\n            d_haversine_res_48391 = zs_res_48389;\n        }\n        cos_res_48392 = futrts_cos64(d_haversine_res_48390);\n        ((__global double *) mem_54018)[gtid_48382] = d_haversine_res_48390",
                                    ";\n        ((__global double *) mem_54020)[gtid_48382] = d_haversine_res_48391;\n        ((__global double *) mem_54022)[gtid_48382] = cos_res_48392;\n    }\n    \n  error_0:\n    return;\n    #undef segmap_tblock_sizze_48377\n}\nFUTHARK_KERNEL_SIZED(do_DBSCAN_doublezisegmap_48450_dim1, 1, 1)\nvoid do_DBSCAN_doublezisegmap_48450(__global int *global_failure, int64_t dz2080U_36801, int64_t dz2081U_36802, int64_t partition_sizze_43809, int64_t num_tblocks_48455, int32_t virt_num_tblocks_56656, __global unsigned char *mem_53549, __global unsigned char *mem_53551, __global unsigned char *mem_53592, __global unsigned char *mem_53608, __global unsigned char *mem_53626)\n{\n    #define segmap_tblock_sizze_48453 (do_DBSCAN_doublezisegmap_48450zisegmap_tblock_sizze_48453)\n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_56658;\n    int32_t tblock_sizze_56661;\n    int32_t wave_sizze_56660;\n    int32_t block_id_56659;\n    int32_t global_tid_56657;\n    int64_t phys_tid_48450;\n    int32_t phys_tblock_id_56662;\n    int32_t iterations_56663;\n    \n    local_tid_56658 = get_local_id(0);\n    tblock_sizze_56661 = get_local_size(0);\n    wave_sizze_56660 = LOCKSTEP_WIDTH;\n    block_id_56659 = get_tblock_id(0);\n    global_tid_56657 = block_id_56659 * tblock_sizze_56661 + local_tid_56658;\n    phys_tid_48450 = sext_i32_i64(global_tid_56657);\n    phys_tblock_id_56662 = get_tblock_id(0);\n    iterations_56663 = sdiv_up32(virt_num_tblocks_56656 - phys_tblock_id_56662, sext_i64_i32(num_tblocks_48455));\n    for (int32_t i_56664 = 0; i_56664 < iterations_56663; i_56664++) {\n        int32_t virt_tblock_id_56665;\n        int64_t global_tid_56666;\n        int64_t slice_56667;\n        int64_t write_i_48449;\n        int64_t remnant_56668;\n        \n        virt_tblock_id_56665 = phys_tblock_id_56662 + i_56664 * sext_i64_i32(num_tblocks_48455);\n        global_tid_56666 = sext_i32_i64(virt_tblock_id_56665) * segmap_tblock_sizze_48453 + sext_i32_i64(local_tid_56658);\n        slice_56667 = parti", "tion_sizze_43809;\n        write_i_48449 = global_tid_56666;\n        remnant_56668 = global_tid_56666 - write_i_48449;\n        if (slt64(write_i_48449, partition_sizze_43809)) {\n            int64_t write_index_45088;\n            bool write_value_45089;\n            int64_t write_value_45091;\n            \n            write_index_45088 = ((__global int64_t *) mem_53592)[write_i_48449];\n            write_value_45089 = ((__global bool *) mem_53608)[write_i_48449];\n            write_value_45091 = ((__global int64_t *) mem_53626)[write_i_48449];\n            if (sle64((int64_t) 0, write_index_45088) && slt64(write_index_45088, dz2080U_36801)) {\n                ((__global bool *) mem_53549)[write_index_45088] = write_value_45089;\n            }\n            if (sle64((int64_t) 0, write_index_45088) && slt64(write_index_45088, dz2081U_36802)) {\n                ((__global int64_t *) mem_53551)[write_index_45088] = write_value_45091;\n            }\n        }\n        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    }\n    \n  error_1:\n    return;\n    #undef segmap_tblock_sizze_48453\n}\nFUTHARK_KERNEL_SIZED(do_DBSCAN_doublezisegmap_48458_dim1, 1, 1)\nvoid do_DBSCAN_doublezisegmap_48458(__global int *global_failure, int64_t m_43906, int64_t conc_tmp_43977, int64_t m_44319, int64_t num_tblocks_48463, int32_t virt_num_tblocks_56241, __global unsigned char *mem_53610, __global unsigned char *mem_53628, __global unsigned char *ext_mem_54005, __global unsigned char *ext_mem_54006, __global unsigned char *ext_mem_54007, __global unsigned char *mem_54094, __global unsigned char *mem_54096)\n{\n    #define segmap_tblock_sizze_48461 (do_DBSCAN_doublezisegmap_48458zisegmap_tblock_sizze_48461)\n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_56243;\n    int32_t tblock_sizze_56246;\n    int32_t wave_sizze_56245;\n    int32_t block_id_56244;\n    int32_t global_tid_56242;\n    int64_t phys_tid_48458;\n    int32_t phys_tblock_id_56247;\n    int32_t iterations_56248;\n    \n    loca", "l_tid_56243 = get_local_id(0);\n    tblock_sizze_56246 = get_local_size(0);\n    wave_sizze_56245 = LOCKSTEP_WIDTH;\n    block_id_56244 = get_tblock_id(0);\n    global_tid_56242 = block_id_56244 * tblock_sizze_56246 + local_tid_56243;\n    phys_tid_48458 = sext_i32_i64(global_tid_56242);\n    phys_tblock_id_56247 = get_tblock_id(0);\n    iterations_56248 = sdiv_up32(virt_num_tblocks_56241 - phys_tblock_id_56247, sext_i64_i32(num_tblocks_48463));\n    for (int32_t i_56249 = 0; i_56249 < iterations_56248; i_56249++) {\n        int32_t virt_tblock_id_56250;\n        int64_t global_tid_56251;\n        int64_t slice_56252;\n        int64_t write_i_48457;\n        int64_t remnant_56253;\n        \n        virt_tblock_id_56250 = phys_tblock_id_56247 + i_56249 * sext_i64_i32(num_tblocks_48463);\n        global_tid_56251 = sext_i32_i64(virt_tblock_id_56250) * segmap_tblock_sizze_48461 + sext_i32_i64(local_tid_56243);\n        slice_56252 = conc_tmp_43977;\n        write_i_48457 = global_tid_56251;\n        remnant_56253 = global_tid_56251 - write_i_48457;\n        if (slt64(write_i_48457, conc_tmp_43977)) {\n            int64_t eta_p_44777;\n            bool index_concat_cmp_49692;\n            int64_t index_concat_branch_49696;\n            int64_t write_value_44780;\n            bool cond_44781;\n            int64_t lifted_lambda_res_44782;\n            \n            eta_p_44777 = ((__global int64_t *) ext_mem_54006)[write_i_48457];\n            index_concat_cmp_49692 = sle64(m_43906, write_i_48457);\n            if (index_concat_cmp_49692) {\n                int64_t index_concat_i_49693;\n                int64_t index_concat_49694;\n                \n                index_concat_i_49693 = sub64(write_i_48457, m_43906);\n                index_concat_49694 = ((__global int64_t *) mem_53628)[index_concat_i_49693];\n                index_concat_branch_49696 = index_concat_49694;\n            } else {\n                int64_t index_concat_49695 = ((__global int64_t *) mem_53610)[write_i_48457];\n                \n  ",
                                    "              index_concat_branch_49696 = index_concat_49695;\n            }\n            write_value_44780 = ((__global int64_t *) ext_mem_54005)[write_i_48457];\n            cond_44781 = eta_p_44777 == (int64_t) 1;\n            if (cond_44781) {\n                int64_t eta_p_44778;\n                int64_t lifted_lambda_res_t_res_45380;\n                \n                eta_p_44778 = ((__global int64_t *) ext_mem_54007)[write_i_48457];\n                lifted_lambda_res_t_res_45380 = sub64(eta_p_44778, (int64_t) 1);\n                lifted_lambda_res_44782 = lifted_lambda_res_t_res_45380;\n            } else {\n                lifted_lambda_res_44782 = (int64_t) -1;\n            }\n            if (sle64((int64_t) 0, lifted_lambda_res_44782) && slt64(lifted_lambda_res_44782, m_44319)) {\n                ((__global int64_t *) mem_54096)[lifted_lambda_res_44782] = index_concat_branch_49696;\n            }\n            if (sle64((int64_t) 0, lifted_lambda_res_44782) && slt64(lifted_lambda_res_44782, m_44319)) {\n                ((__global int64_t *) mem_54094)[lifted_lambda_res_44782] = write_value_44780;\n            }\n        }\n        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    }\n    \n  error_1:\n    return;\n    #undef segmap_tblock_sizze_48461\n}\nFUTHARK_KERNEL_SIZED(do_DBSCAN_doublezisegmap_48910_dim1, 1, 1)\nvoid do_DBSCAN_doublezisegmap_48910(__global int *global_failure, int64_t m_44319, int64_t m_44409, int64_t num_tblocks_48915, int32_t virt_num_tblocks_56670, __global unsigned char *mem_54094, __global unsigned char *mem_54096, __global unsigned char *ext_mem_54253, __global unsigned char *ext_mem_54254, __global unsigned char *mem_54256, __global unsigned char *mem_54258)\n{\n    #define segmap_tblock_sizze_48913 (do_DBSCAN_doublezisegmap_48910zisegmap_tblock_sizze_48913)\n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_56672;\n    int32_t tblock_sizze_56675;\n    int32_t wave_sizze_56674;\n    int32_t block_id_56673;\n    int32_t global_tid_566", "71;\n    int64_t phys_tid_48910;\n    int32_t phys_tblock_id_56676;\n    int32_t iterations_56677;\n    \n    local_tid_56672 = get_local_id(0);\n    tblock_sizze_56675 = get_local_size(0);\n    wave_sizze_56674 = LOCKSTEP_WIDTH;\n    block_id_56673 = get_tblock_id(0);\n    global_tid_56671 = block_id_56673 * tblock_sizze_56675 + local_tid_56672;\n    phys_tid_48910 = sext_i32_i64(global_tid_56671);\n    phys_tblock_id_56676 = get_tblock_id(0);\n    iterations_56677 = sdiv_up32(virt_num_tblocks_56670 - phys_tblock_id_56676, sext_i64_i32(num_tblocks_48915));\n    for (int32_t i_56678 = 0; i_56678 < iterations_56677; i_56678++) {\n        int32_t virt_tblock_id_56679;\n        int64_t global_tid_56680;\n        int64_t slice_56681;\n        int64_t write_i_48909;\n        int64_t remnant_56682;\n        \n        virt_tblock_id_56679 = phys_tblock_id_56676 + i_56678 * sext_i64_i32(num_tblocks_48915);\n        global_tid_56680 = sext_i32_i64(virt_tblock_id_56679) * segmap_tblock_sizze_48913 + sext_i32_i64(local_tid_56672);\n        slice_56681 = m_44319;\n        write_i_48909 = global_tid_56680;\n        remnant_56682 = global_tid_56680 - write_i_48909;\n        if (slt64(write_i_48909, m_44319)) {\n            int64_t eta_p_44714;\n            int64_t write_value_44716;\n            int64_t write_value_44717;\n            bool cond_44718;\n            int64_t lifted_lambda_res_44719;\n            \n            eta_p_44714 = ((__global int64_t *) ext_mem_54253)[write_i_48909];\n            write_value_44716 = ((__global int64_t *) mem_54096)[write_i_48909];\n            write_value_44717 = ((__global int64_t *) mem_54094)[write_i_48909];\n            cond_44718 = eta_p_44714 == (int64_t) 1;\n            if (cond_44718) {\n                int64_t eta_p_44715;\n                int64_t lifted_lambda_res_t_res_45385;\n                \n                eta_p_44715 = ((__global int64_t *) ext_mem_54254)[write_i_48909];\n                lifted_lambda_res_t_res_45385 = sub64(eta_p_44715, (int64_t) 1);\n              ", "  lifted_lambda_res_44719 = lifted_lambda_res_t_res_45385;\n            } else {\n                lifted_lambda_res_44719 = (int64_t) -1;\n            }\n            if (sle64((int64_t) 0, lifted_lambda_res_44719) && slt64(lifted_lambda_res_44719, m_44409)) {\n                ((__global int64_t *) mem_54258)[lifted_lambda_res_44719] = write_value_44716;\n            }\n            if (sle64((int64_t) 0, lifted_lambda_res_44719) && slt64(lifted_lambda_res_44719, m_44409)) {\n                ((__global int64_t *) mem_54256)[lifted_lambda_res_44719] = write_value_44717;\n            }\n        }\n        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    }\n    \n  error_1:\n    return;\n    #undef segmap_tblock_sizze_48913\n}\nFUTHARK_KERNEL_SIZED(do_DBSCAN_doublezisegmap_49121_dim1, 1, 1)\nvoid do_DBSCAN_doublezisegmap_49121(__global int *global_failure, int8_t clBase_36809, int64_t inf_44560, int64_t dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_44563, __global unsigned char *current_partition_mem_53519, __global unsigned char *current_partition_mem_53520, __global unsigned char *mem_54265, __global unsigned char *mem_54267, __global unsigned char *mem_54269)\n{\n    #define segmap_tblock_sizze_49115 (do_DBSCAN_doublezisegmap_49121zisegmap_tblock_sizze_49115)\n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_56708;\n    int32_t tblock_sizze_56711;\n    int32_t wave_sizze_56710;\n    int32_t block_id_56709;\n    int32_t global_tid_56707;\n    int64_t phys_tid_49121;\n    int64_t global_tid_56712;\n    int64_t slice_56713;\n    int64_t gtid_49120;\n    int64_t remnant_56714;\n    \n    local_tid_56708 = get_local_id(0);\n    tblock_sizze_56711 = get_local_size(0);\n    wave_sizze_56710 = LOCKSTEP_WIDTH;\n    block_id_56709 = get_tblock_id(0);\n    global_tid_56707 = block_id_56709 * tblock_sizze_56711 + local_tid_56708;\n    phys_tid_49121 = sext_i32_i64(global_tid_56707);\n    global_tid_56712 = sext_i32_i64(block_id_56709) * segmap_tblock_sizze_49115 + sext_i32_i64(local_tid_56708);\n  ",
                                    "  slice_56713 = dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_44563;\n    gtid_49120 = global_tid_56712;\n    remnant_56714 = global_tid_56712 - gtid_49120;\n    if (slt64(gtid_49120, dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_44563)) {\n        int64_t slice_49680;\n        double eta_p_49122;\n        double eta_p_49123;\n        double zt_res_49124;\n        double zt_res_49125;\n        double zs_res_49126;\n        double zs_res_49127;\n        double d_haversine_res_49128;\n        double d_haversine_res_49129;\n        double cos_res_49130;\n        \n        slice_49680 = inf_44560 + gtid_49120;\n        eta_p_49122 = ((__global double *) current_partition_mem_53519)[slice_49680];\n        eta_p_49123 = ((__global double *) current_partition_mem_53520)[slice_49680];\n        zt_res_49124 = 3.141592653589793 * eta_p_49122;\n        zt_res_49125 = 3.141592653589793 * eta_p_49123;\n        zs_res_49126 = zt_res_49124 / 180.0;\n        zs_res_49127 = zt_res_49125 / 180.0;\n        if (clBase_36809 == (int8_t) 1) {\n            d_haversine_res_49128 = eta_p_49122;\n        } else {\n            d_haversine_res_49128 = zs_res_49126;\n        }\n        if (clBase_36809 == (int8_t) 1) {\n            d_haversine_res_49129 = eta_p_49123;\n        } else {\n            d_haversine_res_49129 = zs_res_49127;\n        }\n        cos_res_49130 = futrts_cos64(d_haversine_res_49128);\n        ((__global double *) mem_54265)[gtid_49120] = d_haversine_res_49128;\n        ((__global double *) mem_54267)[gtid_49120] = d_haversine_res_49129;\n        ((__global double *) mem_54269)[gtid_49120] = cos_res_49130;\n    }\n    \n  error_0:\n    return;\n    #undef segmap_tblock_sizze_49115\n}\nFUTHARK_KERNEL_SIZED(do_DBSCAN_doublezisegmap_intrablock_49824_dim1, 1, 1)\nvoid do_DBSCAN_doublezisegmap_intrablock_49824(__global int *global_failure, int8_t clBase_36809, int8_t clBase_36810, double clBase_36811, double clBase_36817, int64_t m_43906, int64_t conc_tmp_43977, int64_t inf_44008, int64_t j_m_i_44011, int64_t ldim_49827, int64_t num_whole_til", "es_49886, int64_t residual_input_50093, unsigned char cond_50094_bits, int64_t binop_x_50110, __global unsigned char *mem_53612, __global unsigned char *mem_53614, __global unsigned char *mem_53630, __global unsigned char *mem_53632, __global unsigned char *mem_param_53652, __global unsigned char *mem_53716)\n{\n    bool cond_50094 = cond_50094_bits;\n    \n    #define tile_sizze_49826 (do_DBSCAN_doublezisegmap_intrablock_49824zitile_sizze_49826)\n    #define bytes_53693 (do_DBSCAN_doublezisegmap_intrablock_49824zibytes_53693)\n    \n    volatile __local unsigned char *color_54518_backing_2 = &shared_mem[0];\n    const int64_t color_54518_backing_2_offset = 0 + (bytes_53693 + srem64((int64_t) 8 - srem64(bytes_53693, (int64_t) 8), (int64_t) 8));\n    volatile __local unsigned char *color_54517_backing_1 = &shared_mem[color_54518_backing_2_offset];\n    const int64_t color_54517_backing_1_offset = color_54518_backing_2_offset + (bytes_53693 + srem64((int64_t) 8 - srem64(bytes_53693, (int64_t) 8), (int64_t) 8));\n    volatile __local unsigned char *color_54516_backing_0 = &shared_mem[color_54517_backing_1_offset];\n    const int64_t color_54516_backing_0_offset = color_54517_backing_1_offset + (bytes_53693 + srem64((int64_t) 8 - srem64(bytes_53693, (int64_t) 8), (int64_t) 8));\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_55437;\n    int32_t tblock_sizze_55440;\n    int32_t wave_sizze_55439;\n    int32_t block_id_55438;\n    int32_t global_tid_55436;\n    int64_t gid_flat_49824;\n    int64_t slice_55442;\n    int64_t ltid_pre_55441;\n    int64_t remnant_55443;\n    int64_t slice_55444;\n    int64_t gid_49823;\n    int64_t remnant_55445;\n    __local unsigned char *color_54516;\n    __local unsigned char *color_54517;\n    __local unsigned char *color_54518;\n    int64_t binop_x_49844;\n    int64_t mem_53667[1];\n    double mem_53671[1];\n    double mem_53675[1];\n    double mem_53679[1];\n    double mem_53683[1];\n    double mem_53687[1];\n    int64_t ltid_flat_49829;\n  ", "  int64_t ltid_49828;\n    int64_t gtid_49845;\n    bool cond_49846;\n    int64_t pre_49847;\n    double pre_49848;\n    double pre_49849;\n    double pre_49850;\n    double pre_49851;\n    double pre_49852;\n    int64_t mem_53691[1];\n    int64_t ltid_flat_49888;\n    int64_t ltid_49887;\n    int64_t ext_mem_53703[1];\n    int64_t mem_param_53692[1];\n    int64_t mem_53713[1];\n    int64_t ext_mem_53714[1];\n    \n    local_tid_55437 = get_local_id(0);\n    tblock_sizze_55440 = get_local_size(0);\n    wave_sizze_55439 = LOCKSTEP_WIDTH;\n    block_id_55438 = get_tblock_id(0);\n    global_tid_55436 = block_id_55438 * tblock_sizze_55440 + local_tid_55437;\n    gid_flat_49824 = sext_i32_i64(block_id_55438);\n    slice_55442 = tile_sizze_49826;\n    ltid_pre_55441 = sext_i32_i64(local_tid_55437);\n    remnant_55443 = sext_i32_i64(local_tid_55437) - ltid_pre_55441;\n    slice_55444 = ldim_49827;\n    gid_49823 = sext_i32_i64(block_id_55438);\n    remnant_55445 = sext_i32_i64(block_id_55438) - gid_49823;\n    color_54516 = (__local unsigned char *) color_54516_backing_0;\n    color_54517 = (__local unsigned char *) color_54517_backing_1;\n    color_54518 = (__local unsigned char *) color_54518_backing_2;\n    binop_x_49844 = gid_49823 * tile_sizze_49826;\n    ltid_flat_49829 = sext_i32_i64(local_tid_55437);\n    ltid_49828 = sext_i32_i64(sext_i64_i32(ltid_pre_55441));\n    gtid_49845 = ltid_49828 + binop_x_49844;\n    cond_49846 = slt64(gtid_49845, j_m_i_44011);\n    if (cond_49846) {\n        int64_t slice_49853;\n        int64_t eta_p_49854;\n        bool index_concat_cmp_49856;\n        double index_concat_branch_49857;\n        double index_concat_branch_49863;\n        double zt_res_49867;\n        double zt_res_49868;\n        double zs_res_49869;\n        double zs_res_49870;\n        double d_haversine_res_49871;\n        double d_haversine_res_49872;\n        double cos_res_49873;\n        \n        slice_49853 = inf_44008 + gtid_49845;\n        eta_p_49854 = ((__global int64_t *) mem_param_53652)[slice_49853];\n  ",
                                    "      index_concat_cmp_49856 = sle64(m_43906, slice_49853);\n        if (index_concat_cmp_49856) {\n            int64_t index_concat_i_49858;\n            double index_concat_49859;\n            \n            index_concat_i_49858 = sub64(slice_49853, m_43906);\n            index_concat_49859 = ((__global double *) mem_53632)[index_concat_i_49858];\n            index_concat_branch_49857 = index_concat_49859;\n        } else {\n            double index_concat_49860 = ((__global double *) mem_53614)[slice_49853];\n            \n            index_concat_branch_49857 = index_concat_49860;\n        }\n        if (index_concat_cmp_49856) {\n            int64_t index_concat_i_49864;\n            double index_concat_49865;\n            \n            index_concat_i_49864 = sub64(slice_49853, m_43906);\n            index_concat_49865 = ((__global double *) mem_53630)[index_concat_i_49864];\n            index_concat_branch_49863 = index_concat_49865;\n        } else {\n            double index_concat_49866 = ((__global double *) mem_53612)[slice_49853];\n            \n            index_concat_branch_49863 = index_concat_49866;\n        }\n        zt_res_49867 = 3.141592653589793 * index_concat_branch_49857;\n        zt_res_49868 = 3.141592653589793 * index_concat_branch_49863;\n        zs_res_49869 = zt_res_49867 / 180.0;\n        zs_res_49870 = zt_res_49868 / 180.0;\n        if (clBase_36809 == (int8_t) 1) {\n            d_haversine_res_49871 = index_concat_branch_49857;\n        } else {\n            d_haversine_res_49871 = zs_res_49869;\n        }\n        if (clBase_36809 == (int8_t) 1) {\n            d_haversine_res_49872 = index_concat_branch_49863;\n        } else {\n            d_haversine_res_49872 = zs_res_49870;\n        }\n        cos_res_49873 = futrts_cos64(d_haversine_res_49871);\n        pre_49847 = eta_p_49854;\n        pre_49848 = d_haversine_res_49871;\n        pre_49849 = d_haversine_res_49872;\n        pre_49850 = cos_res_49873;\n        pre_49851 = index_concat_branch_49863;\n        pre_49852 = inde", "x_concat_branch_49857;\n    } else {\n        pre_49847 = (int64_t) 0;\n        pre_49848 = 0.0;\n        pre_49849 = 0.0;\n        pre_49850 = 0.0;\n        pre_49851 = 0.0;\n        pre_49852 = 0.0;\n    }\n    mem_53667[(int64_t) 0] = pre_49847;\n    mem_53671[(int64_t) 0] = pre_49848;\n    mem_53675[(int64_t) 0] = pre_49849;\n    mem_53679[(int64_t) 0] = pre_49850;\n    mem_53683[(int64_t) 0] = pre_49851;\n    mem_53687[(int64_t) 0] = pre_49852;\n    barrier(CLK_LOCAL_MEM_FENCE);\n    ltid_flat_49888 = sext_i32_i64(local_tid_55437);\n    ltid_49887 = sext_i32_i64(sext_i64_i32(ltid_pre_55441));\n    mem_53691[(int64_t) 0] = (int64_t) 9223372036854775807;\n    barrier(CLK_LOCAL_MEM_FENCE);\n    barrier(CLK_LOCAL_MEM_FENCE);\n    for (int32_t i_3 = 0; i_3 < 1; i_3++)\n        mem_param_53692[i_3] = mem_53691[i_3];\n    for (int64_t tile_id_49894 = 0; tile_id_49894 < num_whole_tiles_49886; tile_id_49894++) {\n        int64_t binop_x_49991;\n        int64_t ltid_flat_49990;\n        int64_t ltid_49989;\n        int64_t j_49992;\n        bool cond_50001;\n        double pre1d_50002;\n        double pre1d_50003;\n        int64_t pre1d_50004;\n        int64_t mem_53702[1];\n        int64_t ltid_flat_50013;\n        int64_t ltid_50012;\n        int64_t gtid_50015;\n        int64_t acc_50022;\n        bool cond_50023;\n        int64_t acc_50024;\n        int64_t mem_param_tmp_55446[1];\n        \n        binop_x_49991 = tile_sizze_49826 * tile_id_49894;\n        ltid_flat_49990 = sext_i32_i64(local_tid_55437);\n        ltid_49989 = sext_i32_i64(sext_i64_i32(ltid_pre_55441));\n        j_49992 = ltid_49989 + binop_x_49991;\n        cond_50001 = slt64(j_49992, conc_tmp_43977);\n        if (cond_50001) {\n            bool index_concat_cmp_53103;\n            double index_concat_branch_53107;\n            double index_concat_branch_53101;\n            int64_t tile_elem_50007;\n            \n            index_concat_cmp_53103 = sle64(m_43906, j_49992);\n            if (index_concat_cmp_53103) {\n                int64_t index_conca", "t_i_53104;\n                double index_concat_53105;\n                \n                index_concat_i_53104 = sub64(j_49992, m_43906);\n                index_concat_53105 = ((__global double *) mem_53632)[index_concat_i_53104];\n                index_concat_branch_53107 = index_concat_53105;\n            } else {\n                double index_concat_53106 = ((__global double *) mem_53614)[j_49992];\n                \n                index_concat_branch_53107 = index_concat_53106;\n            }\n            if (index_concat_cmp_53103) {\n                int64_t index_concat_i_53098;\n                double index_concat_53099;\n                \n                index_concat_i_53098 = sub64(j_49992, m_43906);\n                index_concat_53099 = ((__global double *) mem_53630)[index_concat_i_53098];\n                index_concat_branch_53101 = index_concat_53099;\n            } else {\n                double index_concat_53100 = ((__global double *) mem_53612)[j_49992];\n                \n                index_concat_branch_53101 = index_concat_53100;\n            }\n            tile_elem_50007 = ((__global int64_t *) mem_param_53652)[j_49992];\n            pre1d_50002 = index_concat_branch_53107;\n            pre1d_50003 = index_concat_branch_53101;\n            pre1d_50004 = tile_elem_50007;\n        } else {\n            pre1d_50002 = 0.0;\n            pre1d_50003 = 0.0;\n            pre1d_50004 = (int64_t) 0;\n        }\n        ((__local double *) color_54518)[ltid_49989] = pre1d_50002;\n        ((__local double *) color_54517)[ltid_49989] = pre1d_50003;\n        ((__local int64_t *) color_54516)[ltid_49989] = pre1d_50004;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        ltid_flat_50013 = sext_i32_i64(local_tid_55437);\n        ltid_50012 = sext_i32_i64(sext_i64_i32(ltid_pre_55441));\n        gtid_50015 = binop_x_49844 + ltid_50012;\n        acc_50022 = mem_param_53692[(int64_t) 0];\n        cond_50023 = slt64(gtid_50015, j_m_i_44011);\n        if (cond_50023) {\n            int64_t eta_p_50016;\n     ",
                                    "       double d_haversine_res_50017;\n            double d_haversine_res_50018;\n            double cos_res_50019;\n            double index_concat_branch_50020;\n            double index_concat_branch_50021;\n            int64_t x_50025;\n            int64_t redout_53108;\n            \n            eta_p_50016 = mem_53667[(int64_t) 0];\n            d_haversine_res_50017 = mem_53671[(int64_t) 0];\n            d_haversine_res_50018 = mem_53675[(int64_t) 0];\n            cos_res_50019 = mem_53679[(int64_t) 0];\n            index_concat_branch_50020 = mem_53683[(int64_t) 0];\n            index_concat_branch_50021 = mem_53687[(int64_t) 0];\n            redout_53108 = acc_50022;\n            for (int64_t i_53109 = 0; i_53109 < tile_sizze_49826; i_53109++) {\n                double eta_p_50026;\n                double eta_p_50027;\n                double dist_res_50029;\n                bool zlze_res_50054;\n                int64_t lifted_lambda_res_50055;\n                int64_t min_res_50058;\n                int64_t redout_tmp_55448;\n                \n                eta_p_50026 = ((__local double *) color_54518)[i_53109];\n                eta_p_50027 = ((__local double *) color_54517)[i_53109];\n                if (clBase_36810 == (int8_t) 0) {\n                    double zm_res_50030;\n                    double zm_res_50031;\n                    double hypot_res_50032;\n                    \n                    zm_res_50030 = index_concat_branch_50020 - eta_p_50027;\n                    zm_res_50031 = index_concat_branch_50021 - eta_p_50026;\n                    hypot_res_50032 = futrts_hypot64(zm_res_50031, zm_res_50030);\n                    dist_res_50029 = hypot_res_50032;\n                } else {\n                    double d_haversine_res_50033;\n                    double d_haversine_res_50034;\n                    double zm_res_50039;\n                    double cos_res_50040;\n                    double zm_res_50041;\n                    double cos_res_50042;\n                    double zt_res_5", "0043;\n                    double zm_res_50044;\n                    double zm_res_50045;\n                    double zt_res_50046;\n                    double zp_res_50047;\n                    double zs_res_50048;\n                    double min_res_50049;\n                    double zt_res_50050;\n                    double zm_res_50051;\n                    double acos_res_50052;\n                    double zt_res_50053;\n                    \n                    if (clBase_36809 == (int8_t) 1) {\n                        d_haversine_res_50033 = eta_p_50026;\n                        d_haversine_res_50034 = eta_p_50027;\n                    } else {\n                        double zt_res_50035;\n                        double zs_res_50036;\n                        double zt_res_50037;\n                        double zs_res_50038;\n                        \n                        zt_res_50035 = 3.141592653589793 * eta_p_50026;\n                        zs_res_50036 = zt_res_50035 / 180.0;\n                        zt_res_50037 = 3.141592653589793 * eta_p_50027;\n                        zs_res_50038 = zt_res_50037 / 180.0;\n                        d_haversine_res_50033 = zs_res_50036;\n                        d_haversine_res_50034 = zs_res_50038;\n                    }\n                    zm_res_50039 = d_haversine_res_50017 - d_haversine_res_50033;\n                    cos_res_50040 = futrts_cos64(zm_res_50039);\n                    zm_res_50041 = 1.0 - cos_res_50040;\n                    cos_res_50042 = futrts_cos64(d_haversine_res_50033);\n                    zt_res_50043 = cos_res_50019 * cos_res_50042;\n                    zm_res_50044 = d_haversine_res_50018 - d_haversine_res_50034;\n                    zm_res_50045 = 1.0 - zm_res_50044;\n                    zt_res_50046 = zt_res_50043 * zm_res_50045;\n                    zp_res_50047 = zm_res_50041 + zt_res_50046;\n                    zs_res_50048 = zp_res_50047 / 2.0;\n                    min_res_50049 = fmin64(1.0, zs_res_50048);\n              ", "      zt_res_50050 = 2.0 * min_res_50049;\n                    zm_res_50051 = 1.0 - zt_res_50050;\n                    acos_res_50052 = futrts_acos64(zm_res_50051);\n                    zt_res_50053 = clBase_36817 * acos_res_50052;\n                    dist_res_50029 = zt_res_50053;\n                }\n                zlze_res_50054 = dist_res_50029 <= clBase_36811;\n                if (zlze_res_50054) {\n                    int64_t eta_p_50028 = ((__local int64_t *) color_54516)[i_53109];\n                    \n                    lifted_lambda_res_50055 = eta_p_50028;\n                } else {\n                    lifted_lambda_res_50055 = eta_p_50016;\n                }\n                min_res_50058 = smin64(lifted_lambda_res_50055, redout_53108);\n                redout_tmp_55448 = min_res_50058;\n                redout_53108 = redout_tmp_55448;\n            }\n            x_50025 = redout_53108;\n            acc_50024 = x_50025;\n        } else {\n            acc_50024 = acc_50022;\n        }\n        mem_53702[(int64_t) 0] = acc_50024;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        for (int32_t i_4 = 0; i_4 < 1; i_4++)\n            mem_param_tmp_55446[i_4] = mem_53702[i_4];\n        for (int32_t i_5 = 0; i_5 < 1; i_5++)\n            mem_param_53692[i_5] = mem_param_tmp_55446[i_5];\n    }\n    for (int32_t i_6 = 0; i_6 < 1; i_6++)\n        ext_mem_53703[i_6] = mem_param_53692[i_6];\n    barrier(CLK_LOCAL_MEM_FENCE);\n    if (cond_50094) {\n        for (int32_t i_7 = 0; i_7 < 1; i_7++)\n            ext_mem_53714[i_7] = ext_mem_53703[i_7];\n    } else {\n        int64_t ltid_flat_50096;\n        int64_t ltid_50095;\n        int64_t j_50111;\n        bool cond_50120;\n        double pre1d_50121;\n        double pre1d_50122;\n        int64_t pre1d_50123;\n        int64_t ltid_flat_50137;\n        int64_t ltid_50136;\n        int64_t gtid_50144;\n        int64_t acc_50151;\n        bool cond_50152;\n        int64_t acc_50153;\n        \n        ltid_flat_50096 = sext_i32_i64(local_tid_55437);\n        ltid_50095 = ",
                                    "sext_i32_i64(sext_i64_i32(ltid_pre_55441));\n        j_50111 = ltid_50095 + binop_x_50110;\n        cond_50120 = slt64(j_50111, conc_tmp_43977);\n        if (cond_50120) {\n            bool index_concat_cmp_53091;\n            double index_concat_branch_53095;\n            double index_concat_branch_53089;\n            int64_t tile_elem_50126;\n            \n            index_concat_cmp_53091 = sle64(m_43906, j_50111);\n            if (index_concat_cmp_53091) {\n                int64_t index_concat_i_53092;\n                double index_concat_53093;\n                \n                index_concat_i_53092 = sub64(j_50111, m_43906);\n                index_concat_53093 = ((__global double *) mem_53632)[index_concat_i_53092];\n                index_concat_branch_53095 = index_concat_53093;\n            } else {\n                double index_concat_53094 = ((__global double *) mem_53614)[j_50111];\n                \n                index_concat_branch_53095 = index_concat_53094;\n            }\n            if (index_concat_cmp_53091) {\n                int64_t index_concat_i_53086;\n                double index_concat_53087;\n                \n                index_concat_i_53086 = sub64(j_50111, m_43906);\n                index_concat_53087 = ((__global double *) mem_53630)[index_concat_i_53086];\n                index_concat_branch_53089 = index_concat_53087;\n            } else {\n                double index_concat_53088 = ((__global double *) mem_53612)[j_50111];\n                \n                index_concat_branch_53089 = index_concat_53088;\n            }\n            tile_elem_50126 = ((__global int64_t *) mem_param_53652)[j_50111];\n            pre1d_50121 = index_concat_branch_53095;\n            pre1d_50122 = index_concat_branch_53089;\n            pre1d_50123 = tile_elem_50126;\n        } else {\n            pre1d_50121 = 0.0;\n            pre1d_50122 = 0.0;\n            pre1d_50123 = (int64_t) 0;\n        }\n        ((__local double *) color_54518)[ltid_50095] = pre1d_50121;\n        ((__local doub", "le *) color_54517)[ltid_50095] = pre1d_50122;\n        ((__local int64_t *) color_54516)[ltid_50095] = pre1d_50123;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        ltid_flat_50137 = sext_i32_i64(local_tid_55437);\n        ltid_50136 = sext_i32_i64(sext_i64_i32(ltid_pre_55441));\n        gtid_50144 = binop_x_49844 + ltid_50136;\n        acc_50151 = ext_mem_53703[(int64_t) 0];\n        cond_50152 = slt64(gtid_50144, j_m_i_44011);\n        if (cond_50152) {\n            int64_t eta_p_50145;\n            double d_haversine_res_50146;\n            double d_haversine_res_50147;\n            double cos_res_50148;\n            double index_concat_branch_50149;\n            double index_concat_branch_50150;\n            int64_t x_50154;\n            int64_t redout_53110;\n            \n            eta_p_50145 = mem_53667[(int64_t) 0];\n            d_haversine_res_50146 = mem_53671[(int64_t) 0];\n            d_haversine_res_50147 = mem_53675[(int64_t) 0];\n            cos_res_50148 = mem_53679[(int64_t) 0];\n            index_concat_branch_50149 = mem_53683[(int64_t) 0];\n            index_concat_branch_50150 = mem_53687[(int64_t) 0];\n            redout_53110 = acc_50151;\n            for (int64_t i_53111 = 0; i_53111 < residual_input_50093; i_53111++) {\n                double eta_p_50155;\n                double eta_p_50156;\n                double dist_res_50158;\n                bool zlze_res_50183;\n                int64_t lifted_lambda_res_50184;\n                int64_t min_res_50187;\n                int64_t redout_tmp_55449;\n                \n                eta_p_50155 = ((__local double *) color_54518)[i_53111];\n                eta_p_50156 = ((__local double *) color_54517)[i_53111];\n                if (clBase_36810 == (int8_t) 0) {\n                    double zm_res_50159;\n                    double zm_res_50160;\n                    double hypot_res_50161;\n                    \n                    zm_res_50159 = index_concat_branch_50149 - eta_p_50156;\n                    zm_res_50160 = index_conc", "at_branch_50150 - eta_p_50155;\n                    hypot_res_50161 = futrts_hypot64(zm_res_50160, zm_res_50159);\n                    dist_res_50158 = hypot_res_50161;\n                } else {\n                    double d_haversine_res_50162;\n                    double d_haversine_res_50163;\n                    double zm_res_50168;\n                    double cos_res_50169;\n                    double zm_res_50170;\n                    double cos_res_50171;\n                    double zt_res_50172;\n                    double zm_res_50173;\n                    double zm_res_50174;\n                    double zt_res_50175;\n                    double zp_res_50176;\n                    double zs_res_50177;\n                    double min_res_50178;\n                    double zt_res_50179;\n                    double zm_res_50180;\n                    double acos_res_50181;\n                    double zt_res_50182;\n                    \n                    if (clBase_36809 == (int8_t) 1) {\n                        d_haversine_res_50162 = eta_p_50155;\n                        d_haversine_res_50163 = eta_p_50156;\n                    } else {\n                        double zt_res_50164;\n                        double zs_res_50165;\n                        double zt_res_50166;\n                        double zs_res_50167;\n                        \n                        zt_res_50164 = 3.141592653589793 * eta_p_50155;\n                        zs_res_50165 = zt_res_50164 / 180.0;\n                        zt_res_50166 = 3.141592653589793 * eta_p_50156;\n                        zs_res_50167 = zt_res_50166 / 180.0;\n                        d_haversine_res_50162 = zs_res_50165;\n                        d_haversine_res_50163 = zs_res_50167;\n                    }\n                    zm_res_50168 = d_haversine_res_50146 - d_haversine_res_50162;\n                    cos_res_50169 = futrts_cos64(zm_res_50168);\n                    zm_res_50170 = 1.0 - cos_res_50169;\n                    cos_res_50171 = futrts_",
                                    "cos64(d_haversine_res_50162);\n                    zt_res_50172 = cos_res_50148 * cos_res_50171;\n                    zm_res_50173 = d_haversine_res_50147 - d_haversine_res_50163;\n                    zm_res_50174 = 1.0 - zm_res_50173;\n                    zt_res_50175 = zt_res_50172 * zm_res_50174;\n                    zp_res_50176 = zm_res_50170 + zt_res_50175;\n                    zs_res_50177 = zp_res_50176 / 2.0;\n                    min_res_50178 = fmin64(1.0, zs_res_50177);\n                    zt_res_50179 = 2.0 * min_res_50178;\n                    zm_res_50180 = 1.0 - zt_res_50179;\n                    acos_res_50181 = futrts_acos64(zm_res_50180);\n                    zt_res_50182 = clBase_36817 * acos_res_50181;\n                    dist_res_50158 = zt_res_50182;\n                }\n                zlze_res_50183 = dist_res_50158 <= clBase_36811;\n                if (zlze_res_50183) {\n                    int64_t eta_p_50157 = ((__local int64_t *) color_54516)[i_53111];\n                    \n                    lifted_lambda_res_50184 = eta_p_50157;\n                } else {\n                    lifted_lambda_res_50184 = eta_p_50145;\n                }\n                min_res_50187 = smin64(lifted_lambda_res_50184, redout_53110);\n                redout_tmp_55449 = min_res_50187;\n                redout_53110 = redout_tmp_55449;\n            }\n            x_50154 = redout_53110;\n            acc_50153 = x_50154;\n        } else {\n            acc_50153 = acc_50151;\n        }\n        mem_53713[(int64_t) 0] = acc_50153;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        for (int32_t i_8 = 0; i_8 < 1; i_8++)\n            ext_mem_53714[i_8] = mem_53713[i_8];\n    }\n    if (slt64(sext_i32_i64(local_tid_55437) + tile_sizze_49826 * sext_i32_i64(block_id_55438), j_m_i_44011)) {\n        int64_t tmp_55450 = ext_mem_53714[(int64_t) 0];\n        \n        ((__global int64_t *) mem_53716)[sext_i32_i64(local_tid_55437) + tile_sizze_49826 * sext_i32_i64(block_id_55438)] = tmp_55450;\n    }\n    \n  error_8:", "\n    return;\n    #undef tile_sizze_49826\n    #undef bytes_53693\n}\nFUTHARK_KERNEL_SIZED(do_DBSCAN_doublezisegmap_intrablock_50204_dim1, 1, 1)\nvoid do_DBSCAN_doublezisegmap_intrablock_50204(__global int *global_failure, int64_t m_44164, int64_t ldim_50207, int64_t num_whole_tiles_50227, int64_t residual_input_50441, unsigned char cond_50442_bits, int64_t binop_x_50458, __global unsigned char *mem_53642, __global unsigned char *mem_53747, __global unsigned char *mem_53872)\n{\n    bool cond_50442 = cond_50442_bits;\n    \n    #define tile_sizze_50206 (do_DBSCAN_doublezisegmap_intrablock_50204zitile_sizze_50206)\n    #define bytes_53835 (do_DBSCAN_doublezisegmap_intrablock_50204zibytes_53835)\n    \n    volatile __local unsigned char *color_54521_backing_2 = &shared_mem[0];\n    const int64_t color_54521_backing_2_offset = 0 + (bytes_53835 + srem64((int64_t) 8 - srem64(bytes_53835, (int64_t) 8), (int64_t) 8));\n    volatile __local unsigned char *color_54520_backing_1 = &shared_mem[color_54521_backing_2_offset];\n    const int64_t color_54520_backing_1_offset = color_54521_backing_2_offset + (bytes_53835 + srem64((int64_t) 8 - srem64(bytes_53835, (int64_t) 8), (int64_t) 8));\n    volatile __local unsigned char *color_54519_backing_0 = &shared_mem[color_54520_backing_1_offset];\n    const int64_t color_54519_backing_0_offset = color_54520_backing_1_offset + (bytes_53835 + srem64((int64_t) 8 - srem64(bytes_53835, (int64_t) 8), (int64_t) 8));\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_55823;\n    int32_t tblock_sizze_55826;\n    int32_t wave_sizze_55825;\n    int32_t block_id_55824;\n    int32_t global_tid_55822;\n    int64_t gid_flat_50204;\n    int64_t slice_55828;\n    int64_t ltid_pre_55827;\n    int64_t remnant_55829;\n    int64_t slice_55830;\n    int64_t gid_50203;\n    int64_t remnant_55831;\n    __local unsigned char *color_54519;\n    __local unsigned char *color_54520;\n    __local unsigned char *color_54521;\n    int64_t binop_x_50216;\n    int64_t mem_5", "3815[1];\n    int64_t mem_53819[1];\n    int64_t ltid_flat_50209;\n    int64_t ltid_50208;\n    int64_t gtid_50217;\n    bool cond_50218;\n    int64_t pre_50219;\n    int64_t pre_50220;\n    int64_t mem_53823[1];\n    int64_t mem_53827[1];\n    int64_t mem_53831[1];\n    int64_t ltid_flat_50229;\n    int64_t ltid_50228;\n    int64_t gtid_50239;\n    bool cond_50240;\n    int64_t neutral_50241;\n    int64_t neutral_50242;\n    int64_t neutral_50243;\n    int64_t ext_mem_53855[1];\n    int64_t ext_mem_53854[1];\n    int64_t ext_mem_53853[1];\n    int64_t mem_param_53832[1];\n    int64_t mem_param_53833[1];\n    int64_t mem_param_53834[1];\n    int64_t mem_53865[1];\n    int64_t ext_mem_53866[1];\n    int64_t mem_53870[1];\n    int64_t ltid_flat_50540;\n    int64_t ltid_50539;\n    int64_t gtid_50546;\n    bool cond_50550;\n    int64_t postlude_50551;\n    \n    local_tid_55823 = get_local_id(0);\n    tblock_sizze_55826 = get_local_size(0);\n    wave_sizze_55825 = LOCKSTEP_WIDTH;\n    block_id_55824 = get_tblock_id(0);\n    global_tid_55822 = block_id_55824 * tblock_sizze_55826 + local_tid_55823;\n    gid_flat_50204 = sext_i32_i64(block_id_55824);\n    slice_55828 = tile_sizze_50206;\n    ltid_pre_55827 = sext_i32_i64(local_tid_55823);\n    remnant_55829 = sext_i32_i64(local_tid_55823) - ltid_pre_55827;\n    slice_55830 = ldim_50207;\n    gid_50203 = sext_i32_i64(block_id_55824);\n    remnant_55831 = sext_i32_i64(block_id_55824) - gid_50203;\n    color_54519 = (__local unsigned char *) color_54519_backing_0;\n    color_54520 = (__local unsigned char *) color_54520_backing_1;\n    color_54521 = (__local unsigned char *) color_54521_backing_2;\n    binop_x_50216 = gid_50203 * tile_sizze_50206;\n    ltid_flat_50209 = sext_i32_i64(local_tid_55823);\n    ltid_50208 = sext_i32_i64(sext_i64_i32(ltid_pre_55827));\n    gtid_50217 = ltid_50208 + binop_x_50216;\n    cond_50218 = slt64(gtid_50217, m_44164);\n    if (cond_50218) {\n        int64_t lifted_lambda_res_50221;\n        int64_t lifted_lambda_res_50222;\n        \n        lifte",
                                    "d_lambda_res_50221 = ((__global int64_t *) mem_53747)[gtid_50217];\n        lifted_lambda_res_50222 = ((__global int64_t *) mem_53642)[gtid_50217];\n        pre_50219 = lifted_lambda_res_50221;\n        pre_50220 = lifted_lambda_res_50222;\n    } else {\n        pre_50219 = (int64_t) 0;\n        pre_50220 = (int64_t) 0;\n    }\n    mem_53815[(int64_t) 0] = pre_50219;\n    mem_53819[(int64_t) 0] = pre_50220;\n    barrier(CLK_LOCAL_MEM_FENCE);\n    ltid_flat_50229 = sext_i32_i64(local_tid_55823);\n    ltid_50228 = sext_i32_i64(sext_i64_i32(ltid_pre_55827));\n    gtid_50239 = binop_x_50216 + ltid_50228;\n    cond_50240 = slt64(gtid_50239, m_44164);\n    if (cond_50240) {\n        neutral_50241 = gtid_50239;\n    } else {\n        neutral_50241 = (int64_t) 0;\n    }\n    if (cond_50240) {\n        int64_t lifted_lambda_res_50244;\n        int64_t lifted_lambda_res_50245;\n        \n        lifted_lambda_res_50244 = mem_53815[(int64_t) 0];\n        lifted_lambda_res_50245 = mem_53819[(int64_t) 0];\n        neutral_50242 = lifted_lambda_res_50244;\n        neutral_50243 = lifted_lambda_res_50245;\n    } else {\n        neutral_50242 = (int64_t) 0;\n        neutral_50243 = (int64_t) 0;\n    }\n    mem_53823[(int64_t) 0] = neutral_50241;\n    mem_53827[(int64_t) 0] = neutral_50242;\n    mem_53831[(int64_t) 0] = neutral_50243;\n    barrier(CLK_LOCAL_MEM_FENCE);\n    barrier(CLK_LOCAL_MEM_FENCE);\n    for (int32_t i_3 = 0; i_3 < 1; i_3++)\n        mem_param_53832[i_3] = mem_53823[i_3];\n    for (int32_t i_4 = 0; i_4 < 1; i_4++)\n        mem_param_53833[i_4] = mem_53827[i_4];\n    for (int32_t i_5 = 0; i_5 < 1; i_5++)\n        mem_param_53834[i_5] = mem_53831[i_5];\n    for (int64_t tile_id_50255 = 0; tile_id_50255 < num_whole_tiles_50227; tile_id_50255++) {\n        int64_t binop_x_50351;\n        int64_t ltid_flat_50350;\n        int64_t ltid_50349;\n        int64_t j_50352;\n        bool cond_50357;\n        int64_t pre1d_50358;\n        int64_t pre1d_50359;\n        int64_t pre1d_50360;\n        int64_t mem_53844[1];\n      ", "  int64_t mem_53848[1];\n        int64_t mem_53852[1];\n        int64_t ltid_flat_50371;\n        int64_t ltid_50370;\n        int64_t gtid_50373;\n        int64_t acc_50376;\n        int64_t acc_50377;\n        int64_t acc_50378;\n        bool cond_50379;\n        int64_t acc_50380;\n        int64_t acc_50381;\n        int64_t acc_50382;\n        int64_t mem_param_tmp_55832[1];\n        int64_t mem_param_tmp_55833[1];\n        int64_t mem_param_tmp_55834[1];\n        \n        binop_x_50351 = tile_sizze_50206 * tile_id_50255;\n        ltid_flat_50350 = sext_i32_i64(local_tid_55823);\n        ltid_50349 = sext_i32_i64(sext_i64_i32(ltid_pre_55827));\n        j_50352 = ltid_50349 + binop_x_50351;\n        cond_50357 = slt64(j_50352, m_44164);\n        if (cond_50357) {\n            pre1d_50358 = j_50352;\n        } else {\n            pre1d_50358 = (int64_t) 0;\n        }\n        if (cond_50357) {\n            int64_t tile_elem_50362;\n            int64_t tile_elem_50363;\n            \n            tile_elem_50362 = ((__global int64_t *) mem_53747)[j_50352];\n            tile_elem_50363 = ((__global int64_t *) mem_53642)[j_50352];\n            pre1d_50359 = tile_elem_50362;\n            pre1d_50360 = tile_elem_50363;\n        } else {\n            pre1d_50359 = (int64_t) 0;\n            pre1d_50360 = (int64_t) 0;\n        }\n        ((__local int64_t *) color_54521)[ltid_50349] = pre1d_50358;\n        ((__local int64_t *) color_54520)[ltid_50349] = pre1d_50359;\n        ((__local int64_t *) color_54519)[ltid_50349] = pre1d_50360;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        ltid_flat_50371 = sext_i32_i64(local_tid_55823);\n        ltid_50370 = sext_i32_i64(sext_i64_i32(ltid_pre_55827));\n        gtid_50373 = binop_x_50216 + ltid_50370;\n        acc_50376 = mem_param_53832[(int64_t) 0];\n        acc_50377 = mem_param_53833[(int64_t) 0];\n        acc_50378 = mem_param_53834[(int64_t) 0];\n        cond_50379 = slt64(gtid_50373, m_44164);\n        if (cond_50379) {\n            int64_t lifted_lambda_res_50374;\n      ", "      int64_t lifted_lambda_res_50375;\n            int64_t x_50383;\n            int64_t x_50384;\n            int64_t x_50385;\n            int64_t redout_53116;\n            int64_t redout_53117;\n            int64_t redout_53118;\n            \n            lifted_lambda_res_50374 = mem_53815[(int64_t) 0];\n            lifted_lambda_res_50375 = mem_53819[(int64_t) 0];\n            redout_53116 = acc_50376;\n            redout_53117 = acc_50377;\n            redout_53118 = acc_50378;\n            for (int64_t i_53119 = 0; i_53119 < tile_sizze_50206; i_53119++) {\n                int64_t x_50386;\n                int64_t x_50387;\n                int64_t x_50388;\n                bool cond_50395;\n                bool cond_50396;\n                bool cond_f_res_50397;\n                bool cond_f_res_50398;\n                bool y_50399;\n                bool cond_50400;\n                bool cond_50401;\n                bool cond_t_res_50402;\n                bool x_50403;\n                bool cond_f_res_t_res_50404;\n                bool x_50405;\n                bool x_50406;\n                bool y_50407;\n                bool cond_50408;\n                int64_t lifted_lambda_res_50409;\n                int64_t lifted_lambda_res_50410;\n                int64_t lifted_lambda_res_50411;\n                int64_t redout_tmp_55838;\n                int64_t redout_tmp_55839;\n                int64_t redout_tmp_55840;\n                \n                x_50386 = ((__local int64_t *) color_54521)[i_53119];\n                x_50387 = ((__local int64_t *) color_54520)[i_53119];\n                x_50388 = ((__local int64_t *) color_54519)[i_53119];\n                cond_50395 = redout_53117 == lifted_lambda_res_50374;\n                cond_50396 = !cond_50395;\n                cond_f_res_50397 = redout_53118 == lifted_lambda_res_50375;\n                cond_f_res_50398 = !cond_f_res_50397;\n                y_50399 = cond_50395 && cond_f_res_50398;\n                cond_50400 = cond_50396 || y_50399;\n              ",
                                    "  cond_50401 = slt64(x_50386, redout_53116);\n                cond_t_res_50402 = x_50387 == lifted_lambda_res_50374;\n                x_50403 = cond_50401 && cond_t_res_50402;\n                cond_f_res_t_res_50404 = x_50388 == lifted_lambda_res_50375;\n                x_50405 = x_50403 && cond_f_res_t_res_50404;\n                x_50406 = !cond_50400;\n                y_50407 = x_50405 && x_50406;\n                cond_50408 = cond_50400 || y_50407;\n                if (cond_50408) {\n                    lifted_lambda_res_50409 = x_50386;\n                } else {\n                    lifted_lambda_res_50409 = redout_53116;\n                }\n                if (cond_50408) {\n                    lifted_lambda_res_50410 = x_50387;\n                } else {\n                    lifted_lambda_res_50410 = redout_53117;\n                }\n                if (cond_50408) {\n                    lifted_lambda_res_50411 = x_50388;\n                } else {\n                    lifted_lambda_res_50411 = redout_53118;\n                }\n                redout_tmp_55838 = lifted_lambda_res_50409;\n                redout_tmp_55839 = lifted_lambda_res_50410;\n                redout_tmp_55840 = lifted_lambda_res_50411;\n                redout_53116 = redout_tmp_55838;\n                redout_53117 = redout_tmp_55839;\n                redout_53118 = redout_tmp_55840;\n            }\n            x_50383 = redout_53116;\n            x_50384 = redout_53117;\n            x_50385 = redout_53118;\n            acc_50380 = x_50383;\n            acc_50381 = x_50384;\n            acc_50382 = x_50385;\n        } else {\n            acc_50380 = acc_50376;\n            acc_50381 = acc_50377;\n            acc_50382 = acc_50378;\n        }\n        mem_53844[(int64_t) 0] = acc_50380;\n        mem_53848[(int64_t) 0] = acc_50381;\n        mem_53852[(int64_t) 0] = acc_50382;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        for (int32_t i_6 = 0; i_6 < 1; i_6++)\n            mem_param_tmp_55832[i_6] = mem_53844[i_6];\n        for (int32_t i_7", " = 0; i_7 < 1; i_7++)\n            mem_param_tmp_55833[i_7] = mem_53848[i_7];\n        for (int32_t i_8 = 0; i_8 < 1; i_8++)\n            mem_param_tmp_55834[i_8] = mem_53852[i_8];\n        for (int32_t i_9 = 0; i_9 < 1; i_9++)\n            mem_param_53832[i_9] = mem_param_tmp_55832[i_9];\n        for (int32_t i_10 = 0; i_10 < 1; i_10++)\n            mem_param_53833[i_10] = mem_param_tmp_55833[i_10];\n        for (int32_t i_11 = 0; i_11 < 1; i_11++)\n            mem_param_53834[i_11] = mem_param_tmp_55834[i_11];\n    }\n    for (int32_t i_12 = 0; i_12 < 1; i_12++)\n        ext_mem_53855[i_12] = mem_param_53832[i_12];\n    for (int32_t i_13 = 0; i_13 < 1; i_13++)\n        ext_mem_53854[i_13] = mem_param_53833[i_13];\n    for (int32_t i_14 = 0; i_14 < 1; i_14++)\n        ext_mem_53853[i_14] = mem_param_53834[i_14];\n    barrier(CLK_LOCAL_MEM_FENCE);\n    if (cond_50442) {\n        for (int32_t i_15 = 0; i_15 < 1; i_15++)\n            ext_mem_53866[i_15] = ext_mem_53855[i_15];\n    } else {\n        int64_t ltid_flat_50444;\n        int64_t ltid_50443;\n        int64_t j_50459;\n        bool cond_50464;\n        int64_t pre1d_50465;\n        int64_t pre1d_50466;\n        int64_t pre1d_50467;\n        int64_t ltid_flat_50481;\n        int64_t ltid_50480;\n        int64_t gtid_50494;\n        int64_t acc_50497;\n        bool cond_50500;\n        int64_t acc_50501;\n        \n        ltid_flat_50444 = sext_i32_i64(local_tid_55823);\n        ltid_50443 = sext_i32_i64(sext_i64_i32(ltid_pre_55827));\n        j_50459 = ltid_50443 + binop_x_50458;\n        cond_50464 = slt64(j_50459, m_44164);\n        if (cond_50464) {\n            pre1d_50465 = j_50459;\n        } else {\n            pre1d_50465 = (int64_t) 0;\n        }\n        if (cond_50464) {\n            int64_t tile_elem_50469;\n            int64_t tile_elem_50470;\n            \n            tile_elem_50469 = ((__global int64_t *) mem_53747)[j_50459];\n            tile_elem_50470 = ((__global int64_t *) mem_53642)[j_50459];\n            pre1d_50466 = tile_elem_50469;\n", "            pre1d_50467 = tile_elem_50470;\n        } else {\n            pre1d_50466 = (int64_t) 0;\n            pre1d_50467 = (int64_t) 0;\n        }\n        ((__local int64_t *) color_54521)[ltid_50443] = pre1d_50465;\n        ((__local int64_t *) color_54520)[ltid_50443] = pre1d_50466;\n        ((__local int64_t *) color_54519)[ltid_50443] = pre1d_50467;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        ltid_flat_50481 = sext_i32_i64(local_tid_55823);\n        ltid_50480 = sext_i32_i64(sext_i64_i32(ltid_pre_55827));\n        gtid_50494 = binop_x_50216 + ltid_50480;\n        acc_50497 = ext_mem_53855[(int64_t) 0];\n        cond_50500 = slt64(gtid_50494, m_44164);\n        if (cond_50500) {\n            int64_t lifted_lambda_res_50495;\n            int64_t lifted_lambda_res_50496;\n            int64_t acc_50498;\n            int64_t acc_50499;\n            int64_t x_50504;\n            int64_t x_50505;\n            int64_t x_50506;\n            int64_t redout_53120;\n            int64_t redout_53121;\n            int64_t redout_53122;\n            \n            lifted_lambda_res_50495 = mem_53815[(int64_t) 0];\n            lifted_lambda_res_50496 = mem_53819[(int64_t) 0];\n            acc_50498 = ext_mem_53854[(int64_t) 0];\n            acc_50499 = ext_mem_53853[(int64_t) 0];\n            redout_53120 = acc_50497;\n            redout_53121 = acc_50498;\n            redout_53122 = acc_50499;\n            for (int64_t i_53123 = 0; i_53123 < residual_input_50441; i_53123++) {\n                int64_t x_50507;\n                int64_t x_50508;\n                int64_t x_50509;\n                bool cond_50516;\n                bool cond_50517;\n                bool cond_f_res_50518;\n                bool cond_f_res_50519;\n                bool y_50520;\n                bool cond_50521;\n                bool cond_50522;\n                bool cond_t_res_50523;\n                bool x_50524;\n                bool cond_f_res_t_res_50525;\n                bool x_50526;\n                bool x_50527;\n                bool ",
                                    "y_50528;\n                bool cond_50529;\n                int64_t lifted_lambda_res_50530;\n                int64_t lifted_lambda_res_50531;\n                int64_t lifted_lambda_res_50532;\n                int64_t redout_tmp_55841;\n                int64_t redout_tmp_55842;\n                int64_t redout_tmp_55843;\n                \n                x_50507 = ((__local int64_t *) color_54521)[i_53123];\n                x_50508 = ((__local int64_t *) color_54520)[i_53123];\n                x_50509 = ((__local int64_t *) color_54519)[i_53123];\n                cond_50516 = redout_53121 == lifted_lambda_res_50495;\n                cond_50517 = !cond_50516;\n                cond_f_res_50518 = redout_53122 == lifted_lambda_res_50496;\n                cond_f_res_50519 = !cond_f_res_50518;\n                y_50520 = cond_50516 && cond_f_res_50519;\n                cond_50521 = cond_50517 || y_50520;\n                cond_50522 = slt64(x_50507, redout_53120);\n                cond_t_res_50523 = x_50508 == lifted_lambda_res_50495;\n                x_50524 = cond_50522 && cond_t_res_50523;\n                cond_f_res_t_res_50525 = x_50509 == lifted_lambda_res_50496;\n                x_50526 = x_50524 && cond_f_res_t_res_50525;\n                x_50527 = !cond_50521;\n                y_50528 = x_50526 && x_50527;\n                cond_50529 = cond_50521 || y_50528;\n                if (cond_50529) {\n                    lifted_lambda_res_50530 = x_50507;\n                } else {\n                    lifted_lambda_res_50530 = redout_53120;\n                }\n                if (cond_50529) {\n                    lifted_lambda_res_50531 = x_50508;\n                } else {\n                    lifted_lambda_res_50531 = redout_53121;\n                }\n                if (cond_50529) {\n                    lifted_lambda_res_50532 = x_50509;\n                } else {\n                    lifted_lambda_res_50532 = redout_53122;\n                }\n                redout_tmp_55841 = lifted_lambda_res_50530;\n       ", "         redout_tmp_55842 = lifted_lambda_res_50531;\n                redout_tmp_55843 = lifted_lambda_res_50532;\n                redout_53120 = redout_tmp_55841;\n                redout_53121 = redout_tmp_55842;\n                redout_53122 = redout_tmp_55843;\n            }\n            x_50504 = redout_53120;\n            x_50505 = redout_53121;\n            x_50506 = redout_53122;\n            acc_50501 = x_50504;\n        } else {\n            acc_50501 = acc_50497;\n        }\n        mem_53865[(int64_t) 0] = acc_50501;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        for (int32_t i_16 = 0; i_16 < 1; i_16++)\n            ext_mem_53866[i_16] = mem_53865[i_16];\n    }\n    ltid_flat_50540 = sext_i32_i64(local_tid_55823);\n    ltid_50539 = sext_i32_i64(sext_i64_i32(ltid_pre_55827));\n    gtid_50546 = binop_x_50216 + ltid_50539;\n    cond_50550 = slt64(gtid_50546, m_44164);\n    if (cond_50550) {\n        int64_t defunc_0_f_res_50547;\n        bool lifted_lambda_res_50554;\n        int64_t defunc_0_f_res_50555;\n        \n        defunc_0_f_res_50547 = ext_mem_53866[(int64_t) 0];\n        lifted_lambda_res_50554 = defunc_0_f_res_50547 == gtid_50546;\n        defunc_0_f_res_50555 = btoi_bool_i64(lifted_lambda_res_50554);\n        postlude_50551 = defunc_0_f_res_50555;\n    } else {\n        postlude_50551 = (int64_t) 0;\n    }\n    mem_53870[(int64_t) 0] = postlude_50551;\n    barrier(CLK_LOCAL_MEM_FENCE);\n    if (slt64(sext_i32_i64(local_tid_55823) + tile_sizze_50206 * sext_i32_i64(block_id_55824), m_44164)) {\n        int64_t tmp_55844 = mem_53870[(int64_t) 0];\n        \n        ((__global int64_t *) mem_53872)[sext_i32_i64(local_tid_55823) + tile_sizze_50206 * sext_i32_i64(block_id_55824)] = tmp_55844;\n    }\n    \n  error_9:\n    return;\n    #undef tile_sizze_50206\n    #undef bytes_53835\n}\nFUTHARK_KERNEL_SIZED(do_DBSCAN_doublezisegmap_intrablock_50559_dim1, 1, 1)\nvoid do_DBSCAN_doublezisegmap_intrablock_50559(__global int *global_failure, int64_t m_44164, int64_t ldim_50562, int64_t num_whole_tiles_", "50582, int64_t residual_input_50796, unsigned char cond_50797_bits, int64_t binop_x_50813, __global unsigned char *mem_53642, __global unsigned char *mem_53747, __global unsigned char *mem_53810)\n{\n    bool cond_50797 = cond_50797_bits;\n    \n    #define tile_sizze_50561 (do_DBSCAN_doublezisegmap_intrablock_50559zitile_sizze_50561)\n    #define bytes_53773 (do_DBSCAN_doublezisegmap_intrablock_50559zibytes_53773)\n    \n    volatile __local unsigned char *color_54524_backing_2 = &shared_mem[0];\n    const int64_t color_54524_backing_2_offset = 0 + (bytes_53773 + srem64((int64_t) 8 - srem64(bytes_53773, (int64_t) 8), (int64_t) 8));\n    volatile __local unsigned char *color_54523_backing_1 = &shared_mem[color_54524_backing_2_offset];\n    const int64_t color_54523_backing_1_offset = color_54524_backing_2_offset + (bytes_53773 + srem64((int64_t) 8 - srem64(bytes_53773, (int64_t) 8), (int64_t) 8));\n    volatile __local unsigned char *color_54522_backing_0 = &shared_mem[color_54523_backing_1_offset];\n    const int64_t color_54522_backing_0_offset = color_54523_backing_1_offset + (bytes_53773 + srem64((int64_t) 8 - srem64(bytes_53773, (int64_t) 8), (int64_t) 8));\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_55848;\n    int32_t tblock_sizze_55851;\n    int32_t wave_sizze_55850;\n    int32_t block_id_55849;\n    int32_t global_tid_55847;\n    int64_t gid_flat_50559;\n    int64_t slice_55853;\n    int64_t ltid_pre_55852;\n    int64_t remnant_55854;\n    int64_t slice_55855;\n    int64_t gid_50558;\n    int64_t remnant_55856;\n    __local unsigned char *color_54522;\n    __local unsigned char *color_54523;\n    __local unsigned char *color_54524;\n    int64_t binop_x_50571;\n    int64_t mem_53753[1];\n    int64_t mem_53757[1];\n    int64_t ltid_flat_50564;\n    int64_t ltid_50563;\n    int64_t gtid_50572;\n    bool cond_50573;\n    int64_t pre_50574;\n    int64_t pre_50575;\n    int64_t mem_53761[1];\n    int64_t mem_53765[1];\n    int64_t mem_53769[1];\n    int64_t ltid_flat_",
                                    "50584;\n    int64_t ltid_50583;\n    int64_t gtid_50594;\n    bool cond_50595;\n    int64_t neutral_50596;\n    int64_t neutral_50597;\n    int64_t neutral_50598;\n    int64_t ext_mem_53793[1];\n    int64_t ext_mem_53792[1];\n    int64_t ext_mem_53791[1];\n    int64_t mem_param_53770[1];\n    int64_t mem_param_53771[1];\n    int64_t mem_param_53772[1];\n    int64_t mem_53803[1];\n    int64_t ext_mem_53804[1];\n    int64_t mem_53808[1];\n    int64_t ltid_flat_50895;\n    int64_t ltid_50894;\n    int64_t gtid_50901;\n    bool cond_50905;\n    int64_t postlude_50906;\n    \n    local_tid_55848 = get_local_id(0);\n    tblock_sizze_55851 = get_local_size(0);\n    wave_sizze_55850 = LOCKSTEP_WIDTH;\n    block_id_55849 = get_tblock_id(0);\n    global_tid_55847 = block_id_55849 * tblock_sizze_55851 + local_tid_55848;\n    gid_flat_50559 = sext_i32_i64(block_id_55849);\n    slice_55853 = tile_sizze_50561;\n    ltid_pre_55852 = sext_i32_i64(local_tid_55848);\n    remnant_55854 = sext_i32_i64(local_tid_55848) - ltid_pre_55852;\n    slice_55855 = ldim_50562;\n    gid_50558 = sext_i32_i64(block_id_55849);\n    remnant_55856 = sext_i32_i64(block_id_55849) - gid_50558;\n    color_54522 = (__local unsigned char *) color_54522_backing_0;\n    color_54523 = (__local unsigned char *) color_54523_backing_1;\n    color_54524 = (__local unsigned char *) color_54524_backing_2;\n    binop_x_50571 = gid_50558 * tile_sizze_50561;\n    ltid_flat_50564 = sext_i32_i64(local_tid_55848);\n    ltid_50563 = sext_i32_i64(sext_i64_i32(ltid_pre_55852));\n    gtid_50572 = ltid_50563 + binop_x_50571;\n    cond_50573 = slt64(gtid_50572, m_44164);\n    if (cond_50573) {\n        int64_t lifted_lambda_res_50576;\n        int64_t lifted_lambda_res_50577;\n        \n        lifted_lambda_res_50576 = ((__global int64_t *) mem_53747)[gtid_50572];\n        lifted_lambda_res_50577 = ((__global int64_t *) mem_53642)[gtid_50572];\n        pre_50574 = lifted_lambda_res_50576;\n        pre_50575 = lifted_lambda_res_50577;\n    } else {\n        pre_50574 = (int64_t)", " 0;\n        pre_50575 = (int64_t) 0;\n    }\n    mem_53753[(int64_t) 0] = pre_50574;\n    mem_53757[(int64_t) 0] = pre_50575;\n    barrier(CLK_LOCAL_MEM_FENCE);\n    ltid_flat_50584 = sext_i32_i64(local_tid_55848);\n    ltid_50583 = sext_i32_i64(sext_i64_i32(ltid_pre_55852));\n    gtid_50594 = binop_x_50571 + ltid_50583;\n    cond_50595 = slt64(gtid_50594, m_44164);\n    if (cond_50595) {\n        neutral_50596 = gtid_50594;\n    } else {\n        neutral_50596 = (int64_t) 0;\n    }\n    if (cond_50595) {\n        int64_t lifted_lambda_res_50599;\n        int64_t lifted_lambda_res_50600;\n        \n        lifted_lambda_res_50599 = mem_53753[(int64_t) 0];\n        lifted_lambda_res_50600 = mem_53757[(int64_t) 0];\n        neutral_50597 = lifted_lambda_res_50599;\n        neutral_50598 = lifted_lambda_res_50600;\n    } else {\n        neutral_50597 = (int64_t) 0;\n        neutral_50598 = (int64_t) 0;\n    }\n    mem_53761[(int64_t) 0] = neutral_50596;\n    mem_53765[(int64_t) 0] = neutral_50597;\n    mem_53769[(int64_t) 0] = neutral_50598;\n    barrier(CLK_LOCAL_MEM_FENCE);\n    barrier(CLK_LOCAL_MEM_FENCE);\n    for (int32_t i_3 = 0; i_3 < 1; i_3++)\n        mem_param_53770[i_3] = mem_53761[i_3];\n    for (int32_t i_4 = 0; i_4 < 1; i_4++)\n        mem_param_53771[i_4] = mem_53765[i_4];\n    for (int32_t i_5 = 0; i_5 < 1; i_5++)\n        mem_param_53772[i_5] = mem_53769[i_5];\n    for (int64_t tile_id_50610 = 0; tile_id_50610 < num_whole_tiles_50582; tile_id_50610++) {\n        int64_t binop_x_50706;\n        int64_t ltid_flat_50705;\n        int64_t ltid_50704;\n        int64_t j_50707;\n        bool cond_50712;\n        int64_t pre1d_50713;\n        int64_t pre1d_50714;\n        int64_t pre1d_50715;\n        int64_t mem_53782[1];\n        int64_t mem_53786[1];\n        int64_t mem_53790[1];\n        int64_t ltid_flat_50726;\n        int64_t ltid_50725;\n        int64_t gtid_50728;\n        int64_t acc_50731;\n        int64_t acc_50732;\n        int64_t acc_50733;\n        bool cond_50734;\n        int64_t acc_50735;\n   ", "     int64_t acc_50736;\n        int64_t acc_50737;\n        int64_t mem_param_tmp_55857[1];\n        int64_t mem_param_tmp_55858[1];\n        int64_t mem_param_tmp_55859[1];\n        \n        binop_x_50706 = tile_sizze_50561 * tile_id_50610;\n        ltid_flat_50705 = sext_i32_i64(local_tid_55848);\n        ltid_50704 = sext_i32_i64(sext_i64_i32(ltid_pre_55852));\n        j_50707 = ltid_50704 + binop_x_50706;\n        cond_50712 = slt64(j_50707, m_44164);\n        if (cond_50712) {\n            pre1d_50713 = j_50707;\n        } else {\n            pre1d_50713 = (int64_t) 0;\n        }\n        if (cond_50712) {\n            int64_t tile_elem_50717;\n            int64_t tile_elem_50718;\n            \n            tile_elem_50717 = ((__global int64_t *) mem_53747)[j_50707];\n            tile_elem_50718 = ((__global int64_t *) mem_53642)[j_50707];\n            pre1d_50714 = tile_elem_50717;\n            pre1d_50715 = tile_elem_50718;\n        } else {\n            pre1d_50714 = (int64_t) 0;\n            pre1d_50715 = (int64_t) 0;\n        }\n        ((__local int64_t *) color_54524)[ltid_50704] = pre1d_50713;\n        ((__local int64_t *) color_54523)[ltid_50704] = pre1d_50714;\n        ((__local int64_t *) color_54522)[ltid_50704] = pre1d_50715;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        ltid_flat_50726 = sext_i32_i64(local_tid_55848);\n        ltid_50725 = sext_i32_i64(sext_i64_i32(ltid_pre_55852));\n        gtid_50728 = binop_x_50571 + ltid_50725;\n        acc_50731 = mem_param_53770[(int64_t) 0];\n        acc_50732 = mem_param_53771[(int64_t) 0];\n        acc_50733 = mem_param_53772[(int64_t) 0];\n        cond_50734 = slt64(gtid_50728, m_44164);\n        if (cond_50734) {\n            int64_t lifted_lambda_res_50729;\n            int64_t lifted_lambda_res_50730;\n            int64_t x_50738;\n            int64_t x_50739;\n            int64_t x_50740;\n            int64_t redout_53124;\n            int64_t redout_53125;\n            int64_t redout_53126;\n            \n            lifted_lambda_res_50729 = ",
                                    "mem_53753[(int64_t) 0];\n            lifted_lambda_res_50730 = mem_53757[(int64_t) 0];\n            redout_53124 = acc_50731;\n            redout_53125 = acc_50732;\n            redout_53126 = acc_50733;\n            for (int64_t i_53127 = 0; i_53127 < tile_sizze_50561; i_53127++) {\n                int64_t x_50741;\n                int64_t x_50742;\n                int64_t x_50743;\n                bool cond_50750;\n                bool cond_50751;\n                bool cond_f_res_50752;\n                bool cond_f_res_50753;\n                bool y_50754;\n                bool cond_50755;\n                bool cond_50756;\n                bool cond_t_res_50757;\n                bool x_50758;\n                bool cond_f_res_t_res_50759;\n                bool x_50760;\n                bool x_50761;\n                bool y_50762;\n                bool cond_50763;\n                int64_t lifted_lambda_res_50764;\n                int64_t lifted_lambda_res_50765;\n                int64_t lifted_lambda_res_50766;\n                int64_t redout_tmp_55863;\n                int64_t redout_tmp_55864;\n                int64_t redout_tmp_55865;\n                \n                x_50741 = ((__local int64_t *) color_54524)[i_53127];\n                x_50742 = ((__local int64_t *) color_54523)[i_53127];\n                x_50743 = ((__local int64_t *) color_54522)[i_53127];\n                cond_50750 = redout_53125 == lifted_lambda_res_50729;\n                cond_50751 = !cond_50750;\n                cond_f_res_50752 = redout_53126 == lifted_lambda_res_50730;\n                cond_f_res_50753 = !cond_f_res_50752;\n                y_50754 = cond_50750 && cond_f_res_50753;\n                cond_50755 = cond_50751 || y_50754;\n                cond_50756 = slt64(x_50741, redout_53124);\n                cond_t_res_50757 = x_50742 == lifted_lambda_res_50729;\n                x_50758 = cond_50756 && cond_t_res_50757;\n                cond_f_res_t_res_50759 = x_50743 == lifted_lambda_res_50730;\n                x_50760 = x_", "50758 && cond_f_res_t_res_50759;\n                x_50761 = !cond_50755;\n                y_50762 = x_50760 && x_50761;\n                cond_50763 = cond_50755 || y_50762;\n                if (cond_50763) {\n                    lifted_lambda_res_50764 = x_50741;\n                } else {\n                    lifted_lambda_res_50764 = redout_53124;\n                }\n                if (cond_50763) {\n                    lifted_lambda_res_50765 = x_50742;\n                } else {\n                    lifted_lambda_res_50765 = redout_53125;\n                }\n                if (cond_50763) {\n                    lifted_lambda_res_50766 = x_50743;\n                } else {\n                    lifted_lambda_res_50766 = redout_53126;\n                }\n                redout_tmp_55863 = lifted_lambda_res_50764;\n                redout_tmp_55864 = lifted_lambda_res_50765;\n                redout_tmp_55865 = lifted_lambda_res_50766;\n                redout_53124 = redout_tmp_55863;\n                redout_53125 = redout_tmp_55864;\n                redout_53126 = redout_tmp_55865;\n            }\n            x_50738 = redout_53124;\n            x_50739 = redout_53125;\n            x_50740 = redout_53126;\n            acc_50735 = x_50738;\n            acc_50736 = x_50739;\n            acc_50737 = x_50740;\n        } else {\n            acc_50735 = acc_50731;\n            acc_50736 = acc_50732;\n            acc_50737 = acc_50733;\n        }\n        mem_53782[(int64_t) 0] = acc_50735;\n        mem_53786[(int64_t) 0] = acc_50736;\n        mem_53790[(int64_t) 0] = acc_50737;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        for (int32_t i_6 = 0; i_6 < 1; i_6++)\n            mem_param_tmp_55857[i_6] = mem_53782[i_6];\n        for (int32_t i_7 = 0; i_7 < 1; i_7++)\n            mem_param_tmp_55858[i_7] = mem_53786[i_7];\n        for (int32_t i_8 = 0; i_8 < 1; i_8++)\n            mem_param_tmp_55859[i_8] = mem_53790[i_8];\n        for (int32_t i_9 = 0; i_9 < 1; i_9++)\n            mem_param_53770[i_9] = mem_param_tmp_55857[", "i_9];\n        for (int32_t i_10 = 0; i_10 < 1; i_10++)\n            mem_param_53771[i_10] = mem_param_tmp_55858[i_10];\n        for (int32_t i_11 = 0; i_11 < 1; i_11++)\n            mem_param_53772[i_11] = mem_param_tmp_55859[i_11];\n    }\n    for (int32_t i_12 = 0; i_12 < 1; i_12++)\n        ext_mem_53793[i_12] = mem_param_53770[i_12];\n    for (int32_t i_13 = 0; i_13 < 1; i_13++)\n        ext_mem_53792[i_13] = mem_param_53771[i_13];\n    for (int32_t i_14 = 0; i_14 < 1; i_14++)\n        ext_mem_53791[i_14] = mem_param_53772[i_14];\n    barrier(CLK_LOCAL_MEM_FENCE);\n    if (cond_50797) {\n        for (int32_t i_15 = 0; i_15 < 1; i_15++)\n            ext_mem_53804[i_15] = ext_mem_53793[i_15];\n    } else {\n        int64_t ltid_flat_50799;\n        int64_t ltid_50798;\n        int64_t j_50814;\n        bool cond_50819;\n        int64_t pre1d_50820;\n        int64_t pre1d_50821;\n        int64_t pre1d_50822;\n        int64_t ltid_flat_50836;\n        int64_t ltid_50835;\n        int64_t gtid_50849;\n        int64_t acc_50852;\n        bool cond_50855;\n        int64_t acc_50856;\n        \n        ltid_flat_50799 = sext_i32_i64(local_tid_55848);\n        ltid_50798 = sext_i32_i64(sext_i64_i32(ltid_pre_55852));\n        j_50814 = ltid_50798 + binop_x_50813;\n        cond_50819 = slt64(j_50814, m_44164);\n        if (cond_50819) {\n            pre1d_50820 = j_50814;\n        } else {\n            pre1d_50820 = (int64_t) 0;\n        }\n        if (cond_50819) {\n            int64_t tile_elem_50824;\n            int64_t tile_elem_50825;\n            \n            tile_elem_50824 = ((__global int64_t *) mem_53747)[j_50814];\n            tile_elem_50825 = ((__global int64_t *) mem_53642)[j_50814];\n            pre1d_50821 = tile_elem_50824;\n            pre1d_50822 = tile_elem_50825;\n        } else {\n            pre1d_50821 = (int64_t) 0;\n            pre1d_50822 = (int64_t) 0;\n        }\n        ((__local int64_t *) color_54524)[ltid_50798] = pre1d_50820;\n        ((__local int64_t *) color_54523)[ltid_50798] = pre1d_",
                                    "50821;\n        ((__local int64_t *) color_54522)[ltid_50798] = pre1d_50822;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        ltid_flat_50836 = sext_i32_i64(local_tid_55848);\n        ltid_50835 = sext_i32_i64(sext_i64_i32(ltid_pre_55852));\n        gtid_50849 = binop_x_50571 + ltid_50835;\n        acc_50852 = ext_mem_53793[(int64_t) 0];\n        cond_50855 = slt64(gtid_50849, m_44164);\n        if (cond_50855) {\n            int64_t lifted_lambda_res_50850;\n            int64_t lifted_lambda_res_50851;\n            int64_t acc_50853;\n            int64_t acc_50854;\n            int64_t x_50859;\n            int64_t x_50860;\n            int64_t x_50861;\n            int64_t redout_53128;\n            int64_t redout_53129;\n            int64_t redout_53130;\n            \n            lifted_lambda_res_50850 = mem_53753[(int64_t) 0];\n            lifted_lambda_res_50851 = mem_53757[(int64_t) 0];\n            acc_50853 = ext_mem_53792[(int64_t) 0];\n            acc_50854 = ext_mem_53791[(int64_t) 0];\n            redout_53128 = acc_50852;\n            redout_53129 = acc_50853;\n            redout_53130 = acc_50854;\n            for (int64_t i_53131 = 0; i_53131 < residual_input_50796; i_53131++) {\n                int64_t x_50862;\n                int64_t x_50863;\n                int64_t x_50864;\n                bool cond_50871;\n                bool cond_50872;\n                bool cond_f_res_50873;\n                bool cond_f_res_50874;\n                bool y_50875;\n                bool cond_50876;\n                bool cond_50877;\n                bool cond_t_res_50878;\n                bool x_50879;\n                bool cond_f_res_t_res_50880;\n                bool x_50881;\n                bool x_50882;\n                bool y_50883;\n                bool cond_50884;\n                int64_t lifted_lambda_res_50885;\n                int64_t lifted_lambda_res_50886;\n                int64_t lifted_lambda_res_50887;\n                int64_t redout_tmp_55866;\n                int64_t redout_tmp_55867;\n      ", "          int64_t redout_tmp_55868;\n                \n                x_50862 = ((__local int64_t *) color_54524)[i_53131];\n                x_50863 = ((__local int64_t *) color_54523)[i_53131];\n                x_50864 = ((__local int64_t *) color_54522)[i_53131];\n                cond_50871 = redout_53129 == lifted_lambda_res_50850;\n                cond_50872 = !cond_50871;\n                cond_f_res_50873 = redout_53130 == lifted_lambda_res_50851;\n                cond_f_res_50874 = !cond_f_res_50873;\n                y_50875 = cond_50871 && cond_f_res_50874;\n                cond_50876 = cond_50872 || y_50875;\n                cond_50877 = slt64(x_50862, redout_53128);\n                cond_t_res_50878 = x_50863 == lifted_lambda_res_50850;\n                x_50879 = cond_50877 && cond_t_res_50878;\n                cond_f_res_t_res_50880 = x_50864 == lifted_lambda_res_50851;\n                x_50881 = x_50879 && cond_f_res_t_res_50880;\n                x_50882 = !cond_50876;\n                y_50883 = x_50881 && x_50882;\n                cond_50884 = cond_50876 || y_50883;\n                if (cond_50884) {\n                    lifted_lambda_res_50885 = x_50862;\n                } else {\n                    lifted_lambda_res_50885 = redout_53128;\n                }\n                if (cond_50884) {\n                    lifted_lambda_res_50886 = x_50863;\n                } else {\n                    lifted_lambda_res_50886 = redout_53129;\n                }\n                if (cond_50884) {\n                    lifted_lambda_res_50887 = x_50864;\n                } else {\n                    lifted_lambda_res_50887 = redout_53130;\n                }\n                redout_tmp_55866 = lifted_lambda_res_50885;\n                redout_tmp_55867 = lifted_lambda_res_50886;\n                redout_tmp_55868 = lifted_lambda_res_50887;\n                redout_53128 = redout_tmp_55866;\n                redout_53129 = redout_tmp_55867;\n                redout_53130 = redout_tmp_55868;\n            }\n     ", "       x_50859 = redout_53128;\n            x_50860 = redout_53129;\n            x_50861 = redout_53130;\n            acc_50856 = x_50859;\n        } else {\n            acc_50856 = acc_50852;\n        }\n        mem_53803[(int64_t) 0] = acc_50856;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        for (int32_t i_16 = 0; i_16 < 1; i_16++)\n            ext_mem_53804[i_16] = mem_53803[i_16];\n    }\n    ltid_flat_50895 = sext_i32_i64(local_tid_55848);\n    ltid_50894 = sext_i32_i64(sext_i64_i32(ltid_pre_55852));\n    gtid_50901 = binop_x_50571 + ltid_50894;\n    cond_50905 = slt64(gtid_50901, m_44164);\n    if (cond_50905) {\n        int64_t defunc_0_f_res_50902;\n        bool lifted_lambda_res_50909;\n        int64_t defunc_0_f_res_50910;\n        \n        defunc_0_f_res_50902 = ext_mem_53804[(int64_t) 0];\n        lifted_lambda_res_50909 = defunc_0_f_res_50902 == gtid_50901;\n        defunc_0_f_res_50910 = btoi_bool_i64(lifted_lambda_res_50909);\n        postlude_50906 = defunc_0_f_res_50910;\n    } else {\n        postlude_50906 = (int64_t) 0;\n    }\n    mem_53808[(int64_t) 0] = postlude_50906;\n    barrier(CLK_LOCAL_MEM_FENCE);\n    if (slt64(sext_i32_i64(local_tid_55848) + tile_sizze_50561 * sext_i32_i64(block_id_55849), m_44164)) {\n        int64_t tmp_55869 = mem_53808[(int64_t) 0];\n        \n        ((__global int64_t *) mem_53810)[sext_i32_i64(local_tid_55848) + tile_sizze_50561 * sext_i32_i64(block_id_55849)] = tmp_55869;\n    }\n    \n  error_9:\n    return;\n    #undef tile_sizze_50561\n    #undef bytes_53773\n}\nFUTHARK_KERNEL_SIZED(do_DBSCAN_doublezisegmap_intrablock_50914_dim1, 1, 1)\nvoid do_DBSCAN_doublezisegmap_intrablock_50914(__global int *global_failure, int64_t clProc_36824, int64_t m_43906, int64_t conc_tmp_43977, int64_t m_44254, int64_t ldim_50917, int64_t num_whole_tiles_50931, int64_t residual_input_51090, unsigned char cond_51091_bits, int64_t binop_x_51104, __global unsigned char *mem_53610, __global unsigned char *mem_53628, __global unsigned char *mem_53745, __global unsigned ch",
                                    "ar *mem_53887, __global unsigned char *mem_53889, __global unsigned char *mem_53988, __global unsigned char *mem_53990)\n{\n    bool cond_51091 = cond_51091_bits;\n    \n    #define tile_sizze_50916 (do_DBSCAN_doublezisegmap_intrablock_50914zitile_sizze_50916)\n    #define bytes_53956 (do_DBSCAN_doublezisegmap_intrablock_50914zibytes_53956)\n    \n    volatile __local unsigned char *color_54526_backing_1 = &shared_mem[0];\n    const int64_t color_54526_backing_1_offset = 0 + (bytes_53956 + srem64((int64_t) 8 - srem64(bytes_53956, (int64_t) 8), (int64_t) 8));\n    volatile __local unsigned char *color_54525_backing_0 = &shared_mem[color_54526_backing_1_offset];\n    const int64_t color_54525_backing_0_offset = color_54526_backing_1_offset + (bytes_53956 + srem64((int64_t) 8 - srem64(bytes_53956, (int64_t) 8), (int64_t) 8));\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_56096;\n    int32_t tblock_sizze_56099;\n    int32_t wave_sizze_56098;\n    int32_t block_id_56097;\n    int32_t global_tid_56095;\n    int64_t gid_flat_50914;\n    int64_t slice_56101;\n    int64_t ltid_pre_56100;\n    int64_t remnant_56102;\n    int64_t slice_56103;\n    int64_t gid_50913;\n    int64_t remnant_56104;\n    __local unsigned char *color_54525;\n    __local unsigned char *color_54526;\n    int64_t binop_x_50924;\n    int64_t mem_53945[1];\n    int64_t ltid_flat_50919;\n    int64_t ltid_50918;\n    int64_t gtid_50925;\n    bool cond_50926;\n    int64_t pre_50927;\n    int64_t mem_53949[1];\n    int64_t mem_53953[1];\n    int64_t ltid_flat_50933;\n    int64_t ltid_50932;\n    int64_t gtid_50941;\n    bool cond_50942;\n    int64_t neutral_50943;\n    int64_t neutral_50944;\n    int64_t ext_mem_53969[1];\n    int64_t ext_mem_53968[1];\n    int64_t mem_param_53954[1];\n    int64_t mem_param_53955[1];\n    int64_t mem_53977[1];\n    int64_t ext_mem_53978[1];\n    int64_t mem_53982[1];\n    int64_t mem_53986[1];\n    int64_t ltid_flat_51164;\n    int64_t ltid_51163;\n    int64_t gtid_51172;\n    int64_t defunc_0", "_f_res_51174;\n    bool cond_51175;\n    int64_t postlude_51177;\n    int64_t postlude_51176;\n    \n    local_tid_56096 = get_local_id(0);\n    tblock_sizze_56099 = get_local_size(0);\n    wave_sizze_56098 = LOCKSTEP_WIDTH;\n    block_id_56097 = get_tblock_id(0);\n    global_tid_56095 = block_id_56097 * tblock_sizze_56099 + local_tid_56096;\n    gid_flat_50914 = sext_i32_i64(block_id_56097);\n    slice_56101 = tile_sizze_50916;\n    ltid_pre_56100 = sext_i32_i64(local_tid_56096);\n    remnant_56102 = sext_i32_i64(local_tid_56096) - ltid_pre_56100;\n    slice_56103 = ldim_50917;\n    gid_50913 = sext_i32_i64(block_id_56097);\n    remnant_56104 = sext_i32_i64(block_id_56097) - gid_50913;\n    color_54525 = (__local unsigned char *) color_54525_backing_0;\n    color_54526 = (__local unsigned char *) color_54526_backing_1;\n    binop_x_50924 = gid_50913 * tile_sizze_50916;\n    ltid_flat_50919 = sext_i32_i64(local_tid_56096);\n    ltid_50918 = sext_i32_i64(sext_i64_i32(ltid_pre_56100));\n    gtid_50925 = ltid_50918 + binop_x_50924;\n    cond_50926 = slt64(gtid_50925, conc_tmp_43977);\n    if (cond_50926) {\n        int64_t eta_p_50928 = ((__global int64_t *) mem_53745)[gtid_50925];\n        \n        pre_50927 = eta_p_50928;\n    } else {\n        pre_50927 = (int64_t) 0;\n    }\n    mem_53945[(int64_t) 0] = pre_50927;\n    barrier(CLK_LOCAL_MEM_FENCE);\n    ltid_flat_50933 = sext_i32_i64(local_tid_56096);\n    ltid_50932 = sext_i32_i64(sext_i64_i32(ltid_pre_56100));\n    gtid_50941 = binop_x_50924 + ltid_50932;\n    cond_50942 = slt64(gtid_50941, conc_tmp_43977);\n    if (cond_50942) {\n        int64_t eta_p_50945 = mem_53945[(int64_t) 0];\n        \n        neutral_50943 = eta_p_50945;\n        neutral_50944 = eta_p_50945;\n    } else {\n        neutral_50943 = (int64_t) 0;\n        neutral_50944 = (int64_t) 0;\n    }\n    mem_53949[(int64_t) 0] = neutral_50943;\n    mem_53953[(int64_t) 0] = neutral_50944;\n    barrier(CLK_LOCAL_MEM_FENCE);\n    barrier(CLK_LOCAL_MEM_FENCE);\n    for (int32_t i_2 = 0; i_2 < 1; i_2++", ")\n        mem_param_53954[i_2] = mem_53949[i_2];\n    for (int32_t i_3 = 0; i_3 < 1; i_3++)\n        mem_param_53955[i_3] = mem_53953[i_3];\n    for (int64_t tile_id_50952 = 0; tile_id_50952 < num_whole_tiles_50931; tile_id_50952++) {\n        int64_t binop_x_51024;\n        int64_t ltid_flat_51023;\n        int64_t ltid_51022;\n        int64_t j_51025;\n        bool cond_51029;\n        int64_t pre1d_51030;\n        int64_t pre1d_51031;\n        int64_t mem_53963[1];\n        int64_t mem_53967[1];\n        int64_t ltid_flat_51039;\n        int64_t ltid_51038;\n        int64_t gtid_51041;\n        int64_t acc_51043;\n        int64_t acc_51044;\n        bool cond_51045;\n        int64_t acc_51046;\n        int64_t acc_51047;\n        int64_t mem_param_tmp_56105[1];\n        int64_t mem_param_tmp_56106[1];\n        \n        binop_x_51024 = tile_sizze_50916 * tile_id_50952;\n        ltid_flat_51023 = sext_i32_i64(local_tid_56096);\n        ltid_51022 = sext_i32_i64(sext_i64_i32(ltid_pre_56100));\n        j_51025 = ltid_51022 + binop_x_51024;\n        cond_51029 = slt64(j_51025, m_44254);\n        if (cond_51029) {\n            int64_t tile_elem_51032;\n            int64_t tile_elem_51033;\n            \n            tile_elem_51032 = ((__global int64_t *) mem_53889)[j_51025];\n            tile_elem_51033 = ((__global int64_t *) mem_53887)[j_51025];\n            pre1d_51030 = tile_elem_51032;\n            pre1d_51031 = tile_elem_51033;\n        } else {\n            pre1d_51030 = (int64_t) 0;\n            pre1d_51031 = (int64_t) 0;\n        }\n        ((__local int64_t *) color_54526)[ltid_51022] = pre1d_51030;\n        ((__local int64_t *) color_54525)[ltid_51022] = pre1d_51031;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        ltid_flat_51039 = sext_i32_i64(local_tid_56096);\n        ltid_51038 = sext_i32_i64(sext_i64_i32(ltid_pre_56100));\n        gtid_51041 = binop_x_50924 + ltid_51038;\n        acc_51043 = mem_param_53954[(int64_t) 0];\n        acc_51044 = mem_param_53955[(int64_t) 0];\n        cond_51045 = slt64(g",
                                    "tid_51041, conc_tmp_43977);\n        if (cond_51045) {\n            int64_t eta_p_51042;\n            int64_t x_51048;\n            int64_t x_51049;\n            int64_t redout_53135;\n            int64_t redout_53136;\n            \n            eta_p_51042 = mem_53945[(int64_t) 0];\n            redout_53135 = acc_51043;\n            redout_53136 = acc_51044;\n            for (int64_t i_53137 = 0; i_53137 < tile_sizze_50916; i_53137++) {\n                int64_t x_51050;\n                int64_t x_51051;\n                bool cond_51056;\n                bool cond_51057;\n                bool cond_f_res_51058;\n                bool y_51059;\n                bool cond_51060;\n                bool cond_51061;\n                bool cond_f_res_t_res_51062;\n                bool x_51063;\n                bool x_51064;\n                bool y_51065;\n                bool cond_51066;\n                int64_t lifted_lambda_res_51067;\n                int64_t lifted_lambda_res_51068;\n                int64_t redout_tmp_56109;\n                int64_t redout_tmp_56110;\n                \n                x_51050 = ((__local int64_t *) color_54526)[i_53137];\n                x_51051 = ((__local int64_t *) color_54525)[i_53137];\n                cond_51056 = redout_53135 == eta_p_51042;\n                cond_51057 = !cond_51056;\n                cond_f_res_51058 = slt64(redout_53136, (int64_t) 0);\n                y_51059 = cond_51056 && cond_f_res_51058;\n                cond_51060 = cond_51057 || y_51059;\n                cond_51061 = slt64(x_51051, redout_53136);\n                cond_f_res_t_res_51062 = x_51050 == eta_p_51042;\n                x_51063 = cond_51061 && cond_f_res_t_res_51062;\n                x_51064 = !cond_51060;\n                y_51065 = x_51063 && x_51064;\n                cond_51066 = cond_51060 || y_51065;\n                if (cond_51066) {\n                    lifted_lambda_res_51067 = x_51050;\n                } else {\n                    lifted_lambda_res_51067 = redout_53135;\n                }", "\n                if (cond_51066) {\n                    lifted_lambda_res_51068 = x_51051;\n                } else {\n                    lifted_lambda_res_51068 = redout_53136;\n                }\n                redout_tmp_56109 = lifted_lambda_res_51067;\n                redout_tmp_56110 = lifted_lambda_res_51068;\n                redout_53135 = redout_tmp_56109;\n                redout_53136 = redout_tmp_56110;\n            }\n            x_51048 = redout_53135;\n            x_51049 = redout_53136;\n            acc_51046 = x_51048;\n            acc_51047 = x_51049;\n        } else {\n            acc_51046 = acc_51043;\n            acc_51047 = acc_51044;\n        }\n        mem_53963[(int64_t) 0] = acc_51046;\n        mem_53967[(int64_t) 0] = acc_51047;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        for (int32_t i_4 = 0; i_4 < 1; i_4++)\n            mem_param_tmp_56105[i_4] = mem_53963[i_4];\n        for (int32_t i_5 = 0; i_5 < 1; i_5++)\n            mem_param_tmp_56106[i_5] = mem_53967[i_5];\n        for (int32_t i_6 = 0; i_6 < 1; i_6++)\n            mem_param_53954[i_6] = mem_param_tmp_56105[i_6];\n        for (int32_t i_7 = 0; i_7 < 1; i_7++)\n            mem_param_53955[i_7] = mem_param_tmp_56106[i_7];\n    }\n    for (int32_t i_8 = 0; i_8 < 1; i_8++)\n        ext_mem_53969[i_8] = mem_param_53954[i_8];\n    for (int32_t i_9 = 0; i_9 < 1; i_9++)\n        ext_mem_53968[i_9] = mem_param_53955[i_9];\n    barrier(CLK_LOCAL_MEM_FENCE);\n    if (cond_51091) {\n        for (int32_t i_10 = 0; i_10 < 1; i_10++)\n            ext_mem_53978[i_10] = ext_mem_53968[i_10];\n    } else {\n        int64_t ltid_flat_51093;\n        int64_t ltid_51092;\n        int64_t j_51105;\n        bool cond_51109;\n        int64_t pre1d_51110;\n        int64_t pre1d_51111;\n        int64_t ltid_flat_51121;\n        int64_t ltid_51120;\n        int64_t gtid_51131;\n        int64_t acc_51134;\n        bool cond_51135;\n        int64_t acc_51137;\n        \n        ltid_flat_51093 = sext_i32_i64(local_tid_56096);\n        ltid_51092 = sext_i32_", "i64(sext_i64_i32(ltid_pre_56100));\n        j_51105 = ltid_51092 + binop_x_51104;\n        cond_51109 = slt64(j_51105, m_44254);\n        if (cond_51109) {\n            int64_t tile_elem_51112;\n            int64_t tile_elem_51113;\n            \n            tile_elem_51112 = ((__global int64_t *) mem_53889)[j_51105];\n            tile_elem_51113 = ((__global int64_t *) mem_53887)[j_51105];\n            pre1d_51110 = tile_elem_51112;\n            pre1d_51111 = tile_elem_51113;\n        } else {\n            pre1d_51110 = (int64_t) 0;\n            pre1d_51111 = (int64_t) 0;\n        }\n        ((__local int64_t *) color_54526)[ltid_51092] = pre1d_51110;\n        ((__local int64_t *) color_54525)[ltid_51092] = pre1d_51111;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        ltid_flat_51121 = sext_i32_i64(local_tid_56096);\n        ltid_51120 = sext_i32_i64(sext_i64_i32(ltid_pre_56100));\n        gtid_51131 = binop_x_50924 + ltid_51120;\n        acc_51134 = ext_mem_53968[(int64_t) 0];\n        cond_51135 = slt64(gtid_51131, conc_tmp_43977);\n        if (cond_51135) {\n            int64_t eta_p_51132;\n            int64_t acc_51133;\n            int64_t x_51138;\n            int64_t x_51139;\n            int64_t redout_53138;\n            int64_t redout_53139;\n            \n            eta_p_51132 = mem_53945[(int64_t) 0];\n            acc_51133 = ext_mem_53969[(int64_t) 0];\n            redout_53138 = acc_51133;\n            redout_53139 = acc_51134;\n            for (int64_t i_53140 = 0; i_53140 < residual_input_51090; i_53140++) {\n                int64_t x_51140;\n                int64_t x_51141;\n                bool cond_51146;\n                bool cond_51147;\n                bool cond_f_res_51148;\n                bool y_51149;\n                bool cond_51150;\n                bool cond_51151;\n                bool cond_f_res_t_res_51152;\n                bool x_51153;\n                bool x_51154;\n                bool y_51155;\n                bool cond_51156;\n                int64_t lifted_lambda_res_51157",
                                    ";\n                int64_t lifted_lambda_res_51158;\n                int64_t redout_tmp_56111;\n                int64_t redout_tmp_56112;\n                \n                x_51140 = ((__local int64_t *) color_54526)[i_53140];\n                x_51141 = ((__local int64_t *) color_54525)[i_53140];\n                cond_51146 = redout_53138 == eta_p_51132;\n                cond_51147 = !cond_51146;\n                cond_f_res_51148 = slt64(redout_53139, (int64_t) 0);\n                y_51149 = cond_51146 && cond_f_res_51148;\n                cond_51150 = cond_51147 || y_51149;\n                cond_51151 = slt64(x_51141, redout_53139);\n                cond_f_res_t_res_51152 = x_51140 == eta_p_51132;\n                x_51153 = cond_51151 && cond_f_res_t_res_51152;\n                x_51154 = !cond_51150;\n                y_51155 = x_51153 && x_51154;\n                cond_51156 = cond_51150 || y_51155;\n                if (cond_51156) {\n                    lifted_lambda_res_51157 = x_51140;\n                } else {\n                    lifted_lambda_res_51157 = redout_53138;\n                }\n                if (cond_51156) {\n                    lifted_lambda_res_51158 = x_51141;\n                } else {\n                    lifted_lambda_res_51158 = redout_53139;\n                }\n                redout_tmp_56111 = lifted_lambda_res_51157;\n                redout_tmp_56112 = lifted_lambda_res_51158;\n                redout_53138 = redout_tmp_56111;\n                redout_53139 = redout_tmp_56112;\n            }\n            x_51138 = redout_53138;\n            x_51139 = redout_53139;\n            acc_51137 = x_51139;\n        } else {\n            acc_51137 = acc_51134;\n        }\n        mem_53977[(int64_t) 0] = acc_51137;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        for (int32_t i_11 = 0; i_11 < 1; i_11++)\n            ext_mem_53978[i_11] = mem_53977[i_11];\n    }\n    ltid_flat_51164 = sext_i32_i64(local_tid_56096);\n    ltid_51163 = sext_i32_i64(sext_i64_i32(ltid_pre_56100));\n    gtid_51172 = bi", "nop_x_50924 + ltid_51163;\n    defunc_0_f_res_51174 = ext_mem_53978[(int64_t) 0];\n    cond_51175 = slt64(gtid_51172, conc_tmp_43977);\n    if (cond_51175) {\n        postlude_51177 = defunc_0_f_res_51174;\n    } else {\n        postlude_51177 = (int64_t) 0;\n    }\n    if (cond_51175) {\n        bool index_concat_cmp_51179;\n        int64_t index_concat_branch_51180;\n        bool cond_51184;\n        bool lifted_lambda_res_t_res_51185;\n        bool x_51186;\n        int64_t defunc_0_f_res_51187;\n        \n        index_concat_cmp_51179 = sle64(m_43906, gtid_51172);\n        if (index_concat_cmp_51179) {\n            int64_t index_concat_i_51181;\n            int64_t index_concat_51182;\n            \n            index_concat_i_51181 = sub64(gtid_51172, m_43906);\n            index_concat_51182 = ((__global int64_t *) mem_53628)[index_concat_i_51181];\n            index_concat_branch_51180 = index_concat_51182;\n        } else {\n            int64_t index_concat_51183 = ((__global int64_t *) mem_53610)[gtid_51172];\n            \n            index_concat_branch_51180 = index_concat_51183;\n        }\n        cond_51184 = slt64(defunc_0_f_res_51174, clProc_36824);\n        lifted_lambda_res_t_res_51185 = sle64((int64_t) 0, index_concat_branch_51180);\n        x_51186 = cond_51184 && lifted_lambda_res_t_res_51185;\n        defunc_0_f_res_51187 = btoi_bool_i64(x_51186);\n        postlude_51176 = defunc_0_f_res_51187;\n    } else {\n        postlude_51176 = (int64_t) 0;\n    }\n    mem_53982[(int64_t) 0] = postlude_51176;\n    mem_53986[(int64_t) 0] = postlude_51177;\n    barrier(CLK_LOCAL_MEM_FENCE);\n    if (slt64(sext_i32_i64(local_tid_56096) + tile_sizze_50916 * sext_i32_i64(block_id_56097), conc_tmp_43977)) {\n        int64_t tmp_56113 = mem_53982[(int64_t) 0];\n        \n        ((__global int64_t *) mem_53988)[sext_i32_i64(local_tid_56096) + tile_sizze_50916 * sext_i32_i64(block_id_56097)] = tmp_56113;\n    }\n    if (slt64(sext_i32_i64(local_tid_56096) + tile_sizze_50916 * sext_i32_i64(block_id_56097), ", "conc_tmp_43977)) {\n        int64_t tmp_56114 = mem_53986[(int64_t) 0];\n        \n        ((__global int64_t *) mem_53990)[sext_i32_i64(local_tid_56096) + tile_sizze_50916 * sext_i32_i64(block_id_56097)] = tmp_56114;\n    }\n    \n  error_9:\n    return;\n    #undef tile_sizze_50916\n    #undef bytes_53956\n}\nFUTHARK_KERNEL_SIZED(do_DBSCAN_doublezisegmap_intrablock_51193_dim1, 1, 1)\nvoid do_DBSCAN_doublezisegmap_intrablock_51193(__global int *global_failure, int64_t clProc_36824, int64_t m_43906, int64_t conc_tmp_43977, int64_t m_44254, int64_t ldim_51196, int64_t num_whole_tiles_51210, int64_t residual_input_51369, unsigned char cond_51370_bits, int64_t binop_x_51383, __global unsigned char *mem_53610, __global unsigned char *mem_53628, __global unsigned char *mem_53745, __global unsigned char *mem_53887, __global unsigned char *mem_53889, __global unsigned char *mem_53938, __global unsigned char *mem_53940)\n{\n    bool cond_51370 = cond_51370_bits;\n    \n    #define tile_sizze_51195 (do_DBSCAN_doublezisegmap_intrablock_51193zitile_sizze_51195)\n    #define bytes_53906 (do_DBSCAN_doublezisegmap_intrablock_51193zibytes_53906)\n    \n    volatile __local unsigned char *color_54528_backing_1 = &shared_mem[0];\n    const int64_t color_54528_backing_1_offset = 0 + (bytes_53906 + srem64((int64_t) 8 - srem64(bytes_53906, (int64_t) 8), (int64_t) 8));\n    volatile __local unsigned char *color_54527_backing_0 = &shared_mem[color_54528_backing_1_offset];\n    const int64_t color_54527_backing_0_offset = color_54528_backing_1_offset + (bytes_53906 + srem64((int64_t) 8 - srem64(bytes_53906, (int64_t) 8), (int64_t) 8));\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_56118;\n    int32_t tblock_sizze_56121;\n    int32_t wave_sizze_56120;\n    int32_t block_id_56119;\n    int32_t global_tid_56117;\n    int64_t gid_flat_51193;\n    int64_t slice_56123;\n    int64_t ltid_pre_56122;\n    int64_t remnant_56124;\n    int64_t slice_56125;\n    int64_t gid_51192;\n    int64_t remnant_",
                                    "56126;\n    __local unsigned char *color_54527;\n    __local unsigned char *color_54528;\n    int64_t binop_x_51203;\n    int64_t mem_53895[1];\n    int64_t ltid_flat_51198;\n    int64_t ltid_51197;\n    int64_t gtid_51204;\n    bool cond_51205;\n    int64_t pre_51206;\n    int64_t mem_53899[1];\n    int64_t mem_53903[1];\n    int64_t ltid_flat_51212;\n    int64_t ltid_51211;\n    int64_t gtid_51220;\n    bool cond_51221;\n    int64_t neutral_51222;\n    int64_t neutral_51223;\n    int64_t ext_mem_53919[1];\n    int64_t ext_mem_53918[1];\n    int64_t mem_param_53904[1];\n    int64_t mem_param_53905[1];\n    int64_t mem_53927[1];\n    int64_t ext_mem_53928[1];\n    int64_t mem_53932[1];\n    int64_t mem_53936[1];\n    int64_t ltid_flat_51443;\n    int64_t ltid_51442;\n    int64_t gtid_51451;\n    int64_t defunc_0_f_res_51453;\n    bool cond_51454;\n    int64_t postlude_51456;\n    int64_t postlude_51455;\n    \n    local_tid_56118 = get_local_id(0);\n    tblock_sizze_56121 = get_local_size(0);\n    wave_sizze_56120 = LOCKSTEP_WIDTH;\n    block_id_56119 = get_tblock_id(0);\n    global_tid_56117 = block_id_56119 * tblock_sizze_56121 + local_tid_56118;\n    gid_flat_51193 = sext_i32_i64(block_id_56119);\n    slice_56123 = tile_sizze_51195;\n    ltid_pre_56122 = sext_i32_i64(local_tid_56118);\n    remnant_56124 = sext_i32_i64(local_tid_56118) - ltid_pre_56122;\n    slice_56125 = ldim_51196;\n    gid_51192 = sext_i32_i64(block_id_56119);\n    remnant_56126 = sext_i32_i64(block_id_56119) - gid_51192;\n    color_54527 = (__local unsigned char *) color_54527_backing_0;\n    color_54528 = (__local unsigned char *) color_54528_backing_1;\n    binop_x_51203 = gid_51192 * tile_sizze_51195;\n    ltid_flat_51198 = sext_i32_i64(local_tid_56118);\n    ltid_51197 = sext_i32_i64(sext_i64_i32(ltid_pre_56122));\n    gtid_51204 = ltid_51197 + binop_x_51203;\n    cond_51205 = slt64(gtid_51204, conc_tmp_43977);\n    if (cond_51205) {\n        int64_t eta_p_51207 = ((__global int64_t *) mem_53745)[gtid_51204];\n        \n        pre_51206 = eta_", "p_51207;\n    } else {\n        pre_51206 = (int64_t) 0;\n    }\n    mem_53895[(int64_t) 0] = pre_51206;\n    barrier(CLK_LOCAL_MEM_FENCE);\n    ltid_flat_51212 = sext_i32_i64(local_tid_56118);\n    ltid_51211 = sext_i32_i64(sext_i64_i32(ltid_pre_56122));\n    gtid_51220 = binop_x_51203 + ltid_51211;\n    cond_51221 = slt64(gtid_51220, conc_tmp_43977);\n    if (cond_51221) {\n        int64_t eta_p_51224 = mem_53895[(int64_t) 0];\n        \n        neutral_51222 = eta_p_51224;\n        neutral_51223 = eta_p_51224;\n    } else {\n        neutral_51222 = (int64_t) 0;\n        neutral_51223 = (int64_t) 0;\n    }\n    mem_53899[(int64_t) 0] = neutral_51222;\n    mem_53903[(int64_t) 0] = neutral_51223;\n    barrier(CLK_LOCAL_MEM_FENCE);\n    barrier(CLK_LOCAL_MEM_FENCE);\n    for (int32_t i_2 = 0; i_2 < 1; i_2++)\n        mem_param_53904[i_2] = mem_53899[i_2];\n    for (int32_t i_3 = 0; i_3 < 1; i_3++)\n        mem_param_53905[i_3] = mem_53903[i_3];\n    for (int64_t tile_id_51231 = 0; tile_id_51231 < num_whole_tiles_51210; tile_id_51231++) {\n        int64_t binop_x_51303;\n        int64_t ltid_flat_51302;\n        int64_t ltid_51301;\n        int64_t j_51304;\n        bool cond_51308;\n        int64_t pre1d_51309;\n        int64_t pre1d_51310;\n        int64_t mem_53913[1];\n        int64_t mem_53917[1];\n        int64_t ltid_flat_51318;\n        int64_t ltid_51317;\n        int64_t gtid_51320;\n        int64_t acc_51322;\n        int64_t acc_51323;\n        bool cond_51324;\n        int64_t acc_51325;\n        int64_t acc_51326;\n        int64_t mem_param_tmp_56127[1];\n        int64_t mem_param_tmp_56128[1];\n        \n        binop_x_51303 = tile_sizze_51195 * tile_id_51231;\n        ltid_flat_51302 = sext_i32_i64(local_tid_56118);\n        ltid_51301 = sext_i32_i64(sext_i64_i32(ltid_pre_56122));\n        j_51304 = ltid_51301 + binop_x_51303;\n        cond_51308 = slt64(j_51304, m_44254);\n        if (cond_51308) {\n            int64_t tile_elem_51311;\n            int64_t tile_elem_51312;\n            \n            tile_e", "lem_51311 = ((__global int64_t *) mem_53889)[j_51304];\n            tile_elem_51312 = ((__global int64_t *) mem_53887)[j_51304];\n            pre1d_51309 = tile_elem_51311;\n            pre1d_51310 = tile_elem_51312;\n        } else {\n            pre1d_51309 = (int64_t) 0;\n            pre1d_51310 = (int64_t) 0;\n        }\n        ((__local int64_t *) color_54528)[ltid_51301] = pre1d_51309;\n        ((__local int64_t *) color_54527)[ltid_51301] = pre1d_51310;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        ltid_flat_51318 = sext_i32_i64(local_tid_56118);\n        ltid_51317 = sext_i32_i64(sext_i64_i32(ltid_pre_56122));\n        gtid_51320 = binop_x_51203 + ltid_51317;\n        acc_51322 = mem_param_53904[(int64_t) 0];\n        acc_51323 = mem_param_53905[(int64_t) 0];\n        cond_51324 = slt64(gtid_51320, conc_tmp_43977);\n        if (cond_51324) {\n            int64_t eta_p_51321;\n            int64_t x_51327;\n            int64_t x_51328;\n            int64_t redout_53141;\n            int64_t redout_53142;\n            \n            eta_p_51321 = mem_53895[(int64_t) 0];\n            redout_53141 = acc_51322;\n            redout_53142 = acc_51323;\n            for (int64_t i_53143 = 0; i_53143 < tile_sizze_51195; i_53143++) {\n                int64_t x_51329;\n                int64_t x_51330;\n                bool cond_51335;\n                bool cond_51336;\n                bool cond_f_res_51337;\n                bool y_51338;\n                bool cond_51339;\n                bool cond_51340;\n                bool cond_f_res_t_res_51341;\n                bool x_51342;\n                bool x_51343;\n                bool y_51344;\n                bool cond_51345;\n                int64_t lifted_lambda_res_51346;\n                int64_t lifted_lambda_res_51347;\n                int64_t redout_tmp_56131;\n                int64_t redout_tmp_56132;\n                \n                x_51329 = ((__local int64_t *) color_54528)[i_53143];\n                x_51330 = ((__local int64_t *) color_54527)[i_53143];\n ",
                                    "               cond_51335 = redout_53141 == eta_p_51321;\n                cond_51336 = !cond_51335;\n                cond_f_res_51337 = slt64(redout_53142, (int64_t) 0);\n                y_51338 = cond_51335 && cond_f_res_51337;\n                cond_51339 = cond_51336 || y_51338;\n                cond_51340 = slt64(x_51330, redout_53142);\n                cond_f_res_t_res_51341 = x_51329 == eta_p_51321;\n                x_51342 = cond_51340 && cond_f_res_t_res_51341;\n                x_51343 = !cond_51339;\n                y_51344 = x_51342 && x_51343;\n                cond_51345 = cond_51339 || y_51344;\n                if (cond_51345) {\n                    lifted_lambda_res_51346 = x_51329;\n                } else {\n                    lifted_lambda_res_51346 = redout_53141;\n                }\n                if (cond_51345) {\n                    lifted_lambda_res_51347 = x_51330;\n                } else {\n                    lifted_lambda_res_51347 = redout_53142;\n                }\n                redout_tmp_56131 = lifted_lambda_res_51346;\n                redout_tmp_56132 = lifted_lambda_res_51347;\n                redout_53141 = redout_tmp_56131;\n                redout_53142 = redout_tmp_56132;\n            }\n            x_51327 = redout_53141;\n            x_51328 = redout_53142;\n            acc_51325 = x_51327;\n            acc_51326 = x_51328;\n        } else {\n            acc_51325 = acc_51322;\n            acc_51326 = acc_51323;\n        }\n        mem_53913[(int64_t) 0] = acc_51325;\n        mem_53917[(int64_t) 0] = acc_51326;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        for (int32_t i_4 = 0; i_4 < 1; i_4++)\n            mem_param_tmp_56127[i_4] = mem_53913[i_4];\n        for (int32_t i_5 = 0; i_5 < 1; i_5++)\n            mem_param_tmp_56128[i_5] = mem_53917[i_5];\n        for (int32_t i_6 = 0; i_6 < 1; i_6++)\n            mem_param_53904[i_6] = mem_param_tmp_56127[i_6];\n        for (int32_t i_7 = 0; i_7 < 1; i_7++)\n            mem_param_53905[i_7] = mem_param_tmp_56128[i_7];\n    ", "}\n    for (int32_t i_8 = 0; i_8 < 1; i_8++)\n        ext_mem_53919[i_8] = mem_param_53904[i_8];\n    for (int32_t i_9 = 0; i_9 < 1; i_9++)\n        ext_mem_53918[i_9] = mem_param_53905[i_9];\n    barrier(CLK_LOCAL_MEM_FENCE);\n    if (cond_51370) {\n        for (int32_t i_10 = 0; i_10 < 1; i_10++)\n            ext_mem_53928[i_10] = ext_mem_53918[i_10];\n    } else {\n        int64_t ltid_flat_51372;\n        int64_t ltid_51371;\n        int64_t j_51384;\n        bool cond_51388;\n        int64_t pre1d_51389;\n        int64_t pre1d_51390;\n        int64_t ltid_flat_51400;\n        int64_t ltid_51399;\n        int64_t gtid_51410;\n        int64_t acc_51413;\n        bool cond_51414;\n        int64_t acc_51416;\n        \n        ltid_flat_51372 = sext_i32_i64(local_tid_56118);\n        ltid_51371 = sext_i32_i64(sext_i64_i32(ltid_pre_56122));\n        j_51384 = ltid_51371 + binop_x_51383;\n        cond_51388 = slt64(j_51384, m_44254);\n        if (cond_51388) {\n            int64_t tile_elem_51391;\n            int64_t tile_elem_51392;\n            \n            tile_elem_51391 = ((__global int64_t *) mem_53889)[j_51384];\n            tile_elem_51392 = ((__global int64_t *) mem_53887)[j_51384];\n            pre1d_51389 = tile_elem_51391;\n            pre1d_51390 = tile_elem_51392;\n        } else {\n            pre1d_51389 = (int64_t) 0;\n            pre1d_51390 = (int64_t) 0;\n        }\n        ((__local int64_t *) color_54528)[ltid_51371] = pre1d_51389;\n        ((__local int64_t *) color_54527)[ltid_51371] = pre1d_51390;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        ltid_flat_51400 = sext_i32_i64(local_tid_56118);\n        ltid_51399 = sext_i32_i64(sext_i64_i32(ltid_pre_56122));\n        gtid_51410 = binop_x_51203 + ltid_51399;\n        acc_51413 = ext_mem_53918[(int64_t) 0];\n        cond_51414 = slt64(gtid_51410, conc_tmp_43977);\n        if (cond_51414) {\n            int64_t eta_p_51411;\n            int64_t acc_51412;\n            int64_t x_51417;\n            int64_t x_51418;\n            int64_t redout_531", "44;\n            int64_t redout_53145;\n            \n            eta_p_51411 = mem_53895[(int64_t) 0];\n            acc_51412 = ext_mem_53919[(int64_t) 0];\n            redout_53144 = acc_51412;\n            redout_53145 = acc_51413;\n            for (int64_t i_53146 = 0; i_53146 < residual_input_51369; i_53146++) {\n                int64_t x_51419;\n                int64_t x_51420;\n                bool cond_51425;\n                bool cond_51426;\n                bool cond_f_res_51427;\n                bool y_51428;\n                bool cond_51429;\n                bool cond_51430;\n                bool cond_f_res_t_res_51431;\n                bool x_51432;\n                bool x_51433;\n                bool y_51434;\n                bool cond_51435;\n                int64_t lifted_lambda_res_51436;\n                int64_t lifted_lambda_res_51437;\n                int64_t redout_tmp_56133;\n                int64_t redout_tmp_56134;\n                \n                x_51419 = ((__local int64_t *) color_54528)[i_53146];\n                x_51420 = ((__local int64_t *) color_54527)[i_53146];\n                cond_51425 = redout_53144 == eta_p_51411;\n                cond_51426 = !cond_51425;\n                cond_f_res_51427 = slt64(redout_53145, (int64_t) 0);\n                y_51428 = cond_51425 && cond_f_res_51427;\n                cond_51429 = cond_51426 || y_51428;\n                cond_51430 = slt64(x_51420, redout_53145);\n                cond_f_res_t_res_51431 = x_51419 == eta_p_51411;\n                x_51432 = cond_51430 && cond_f_res_t_res_51431;\n                x_51433 = !cond_51429;\n                y_51434 = x_51432 && x_51433;\n                cond_51435 = cond_51429 || y_51434;\n                if (cond_51435) {\n                    lifted_lambda_res_51436 = x_51419;\n                } else {\n                    lifted_lambda_res_51436 = redout_53144;\n                }\n                if (cond_51435) {\n                    lifted_lambda_res_51437 = x_51420;\n                } else {\n    ",
                                    "                lifted_lambda_res_51437 = redout_53145;\n                }\n                redout_tmp_56133 = lifted_lambda_res_51436;\n                redout_tmp_56134 = lifted_lambda_res_51437;\n                redout_53144 = redout_tmp_56133;\n                redout_53145 = redout_tmp_56134;\n            }\n            x_51417 = redout_53144;\n            x_51418 = redout_53145;\n            acc_51416 = x_51418;\n        } else {\n            acc_51416 = acc_51413;\n        }\n        mem_53927[(int64_t) 0] = acc_51416;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        for (int32_t i_11 = 0; i_11 < 1; i_11++)\n            ext_mem_53928[i_11] = mem_53927[i_11];\n    }\n    ltid_flat_51443 = sext_i32_i64(local_tid_56118);\n    ltid_51442 = sext_i32_i64(sext_i64_i32(ltid_pre_56122));\n    gtid_51451 = binop_x_51203 + ltid_51442;\n    defunc_0_f_res_51453 = ext_mem_53928[(int64_t) 0];\n    cond_51454 = slt64(gtid_51451, conc_tmp_43977);\n    if (cond_51454) {\n        postlude_51456 = defunc_0_f_res_51453;\n    } else {\n        postlude_51456 = (int64_t) 0;\n    }\n    if (cond_51454) {\n        bool index_concat_cmp_51458;\n        int64_t index_concat_branch_51459;\n        bool cond_51463;\n        bool lifted_lambda_res_t_res_51464;\n        bool x_51465;\n        int64_t defunc_0_f_res_51466;\n        \n        index_concat_cmp_51458 = sle64(m_43906, gtid_51451);\n        if (index_concat_cmp_51458) {\n            int64_t index_concat_i_51460;\n            int64_t index_concat_51461;\n            \n            index_concat_i_51460 = sub64(gtid_51451, m_43906);\n            index_concat_51461 = ((__global int64_t *) mem_53628)[index_concat_i_51460];\n            index_concat_branch_51459 = index_concat_51461;\n        } else {\n            int64_t index_concat_51462 = ((__global int64_t *) mem_53610)[gtid_51451];\n            \n            index_concat_branch_51459 = index_concat_51462;\n        }\n        cond_51463 = slt64(defunc_0_f_res_51453, clProc_36824);\n        lifted_lambda_res_t_res_51464 = sle64((int", "64_t) 0, index_concat_branch_51459);\n        x_51465 = cond_51463 && lifted_lambda_res_t_res_51464;\n        defunc_0_f_res_51466 = btoi_bool_i64(x_51465);\n        postlude_51455 = defunc_0_f_res_51466;\n    } else {\n        postlude_51455 = (int64_t) 0;\n    }\n    mem_53932[(int64_t) 0] = postlude_51455;\n    mem_53936[(int64_t) 0] = postlude_51456;\n    barrier(CLK_LOCAL_MEM_FENCE);\n    if (slt64(sext_i32_i64(local_tid_56118) + tile_sizze_51195 * sext_i32_i64(block_id_56119), conc_tmp_43977)) {\n        int64_t tmp_56135 = mem_53932[(int64_t) 0];\n        \n        ((__global int64_t *) mem_53938)[sext_i32_i64(local_tid_56118) + tile_sizze_51195 * sext_i32_i64(block_id_56119)] = tmp_56135;\n    }\n    if (slt64(sext_i32_i64(local_tid_56118) + tile_sizze_51195 * sext_i32_i64(block_id_56119), conc_tmp_43977)) {\n        int64_t tmp_56136 = mem_53936[(int64_t) 0];\n        \n        ((__global int64_t *) mem_53940)[sext_i32_i64(local_tid_56118) + tile_sizze_51195 * sext_i32_i64(block_id_56119)] = tmp_56136;\n    }\n    \n  error_9:\n    return;\n    #undef tile_sizze_51195\n    #undef bytes_53906\n}\nFUTHARK_KERNEL_SIZED(do_DBSCAN_doublezisegmap_intrablock_51472_dim1, 1, 1)\nvoid do_DBSCAN_doublezisegmap_intrablock_51472(__global int *global_failure, int8_t clBase_36809, int8_t clBase_36810, double clBase_36811, double clBase_36817, int64_t conc_tmp_43977, int64_t inf_44477, int64_t dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_44480, int64_t ldim_51475, int64_t num_whole_tiles_51519, int64_t residual_input_51757, unsigned char cond_51758_bits, int64_t binop_x_51774, __global unsigned char *mem_53586, __global unsigned char *mem_53588, __global unsigned char *mem_53626, __global unsigned char *ext_mem_54005, __global unsigned char *mem_54010, __global unsigned char *mem_54012)\n{\n    bool cond_51758 = cond_51758_bits;\n    \n    #define tile_sizze_51474 (do_DBSCAN_doublezisegmap_intrablock_51472zitile_sizze_51474)\n    #define bytes_54059 (do_DBSCAN_doublezisegmap_intrablock_51472zibytes_54059)\n    \n    ", "volatile __local unsigned char *color_54537_backing_2 = &shared_mem[0];\n    const int64_t color_54537_backing_2_offset = 0 + (bytes_54059 + srem64((int64_t) 8 - srem64(bytes_54059, (int64_t) 8), (int64_t) 8));\n    volatile __local unsigned char *color_54536_backing_1 = &shared_mem[color_54537_backing_2_offset];\n    const int64_t color_54536_backing_1_offset = color_54537_backing_2_offset + (bytes_54059 + srem64((int64_t) 8 - srem64(bytes_54059, (int64_t) 8), (int64_t) 8));\n    volatile __local unsigned char *color_54535_backing_0 = &shared_mem[color_54536_backing_1_offset];\n    const int64_t color_54535_backing_0_offset = color_54536_backing_1_offset + (bytes_54059 + srem64((int64_t) 8 - srem64(bytes_54059, (int64_t) 8), (int64_t) 8));\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_56529;\n    int32_t tblock_sizze_56532;\n    int32_t wave_sizze_56531;\n    int32_t block_id_56530;\n    int32_t global_tid_56528;\n    int64_t gid_flat_51472;\n    int64_t slice_56534;\n    int64_t ltid_pre_56533;\n    int64_t remnant_56535;\n    int64_t slice_56536;\n    int64_t gid_51471;\n    int64_t remnant_56537;\n    __local unsigned char *color_54535;\n    __local unsigned char *color_54536;\n    __local unsigned char *color_54537;\n    int64_t binop_x_51490;\n    double mem_54032[1];\n    double mem_54036[1];\n    double mem_54040[1];\n    double mem_54044[1];\n    double mem_54048[1];\n    int64_t ltid_flat_51477;\n    int64_t ltid_51476;\n    int64_t gtid_51491;\n    bool cond_51492;\n    double pre_51493;\n    double pre_51494;\n    double pre_51495;\n    double pre_51496;\n    double pre_51497;\n    int64_t mem_54052[1];\n    double mem_54056[1];\n    int64_t ltid_flat_51521;\n    int64_t ltid_51520;\n    int64_t ext_mem_54074[1];\n    double ext_mem_54073[1];\n    int64_t mem_param_54057[1];\n    double mem_param_54058[1];\n    int64_t mem_54084[1];\n    int64_t ext_mem_54085[1];\n    \n    local_tid_56529 = get_local_id(0);\n    tblock_sizze_56532 = get_local_size(0);\n    wave_sizze_5",
                                    "6531 = LOCKSTEP_WIDTH;\n    block_id_56530 = get_tblock_id(0);\n    global_tid_56528 = block_id_56530 * tblock_sizze_56532 + local_tid_56529;\n    gid_flat_51472 = sext_i32_i64(block_id_56530);\n    slice_56534 = tile_sizze_51474;\n    ltid_pre_56533 = sext_i32_i64(local_tid_56529);\n    remnant_56535 = sext_i32_i64(local_tid_56529) - ltid_pre_56533;\n    slice_56536 = ldim_51475;\n    gid_51471 = sext_i32_i64(block_id_56530);\n    remnant_56537 = sext_i32_i64(block_id_56530) - gid_51471;\n    color_54535 = (__local unsigned char *) color_54535_backing_0;\n    color_54536 = (__local unsigned char *) color_54536_backing_1;\n    color_54537 = (__local unsigned char *) color_54537_backing_2;\n    binop_x_51490 = gid_51471 * tile_sizze_51474;\n    ltid_flat_51477 = sext_i32_i64(local_tid_56529);\n    ltid_51476 = sext_i32_i64(sext_i64_i32(ltid_pre_56533));\n    gtid_51491 = ltid_51476 + binop_x_51490;\n    cond_51492 = slt64(gtid_51491, dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_44480);\n    if (cond_51492) {\n        int64_t slice_51498;\n        double eta_p_51499;\n        double eta_p_51501;\n        double zt_res_51502;\n        double zt_res_51503;\n        double zs_res_51504;\n        double zs_res_51505;\n        double d_haversine_res_51506;\n        double d_haversine_res_51507;\n        double cos_res_51508;\n        \n        slice_51498 = inf_44477 + gtid_51491;\n        eta_p_51499 = ((__global double *) mem_53586)[slice_51498];\n        eta_p_51501 = ((__global double *) mem_53588)[slice_51498];\n        zt_res_51502 = 3.141592653589793 * eta_p_51499;\n        zt_res_51503 = 3.141592653589793 * eta_p_51501;\n        zs_res_51504 = zt_res_51502 / 180.0;\n        zs_res_51505 = zt_res_51503 / 180.0;\n        if (clBase_36809 == (int8_t) 1) {\n            d_haversine_res_51506 = eta_p_51499;\n        } else {\n            d_haversine_res_51506 = zs_res_51504;\n        }\n        if (clBase_36809 == (int8_t) 1) {\n            d_haversine_res_51507 = eta_p_51501;\n        } else {\n            d_haversine_res_51", "507 = zs_res_51505;\n        }\n        cos_res_51508 = futrts_cos64(d_haversine_res_51506);\n        pre_51493 = eta_p_51499;\n        pre_51494 = eta_p_51501;\n        pre_51495 = d_haversine_res_51506;\n        pre_51496 = d_haversine_res_51507;\n        pre_51497 = cos_res_51508;\n    } else {\n        pre_51493 = 0.0;\n        pre_51494 = 0.0;\n        pre_51495 = 0.0;\n        pre_51496 = 0.0;\n        pre_51497 = 0.0;\n    }\n    mem_54032[(int64_t) 0] = pre_51493;\n    mem_54036[(int64_t) 0] = pre_51494;\n    mem_54040[(int64_t) 0] = pre_51495;\n    mem_54044[(int64_t) 0] = pre_51496;\n    mem_54048[(int64_t) 0] = pre_51497;\n    barrier(CLK_LOCAL_MEM_FENCE);\n    ltid_flat_51521 = sext_i32_i64(local_tid_56529);\n    ltid_51520 = sext_i32_i64(sext_i64_i32(ltid_pre_56533));\n    mem_54052[(int64_t) 0] = (int64_t) -1;\n    mem_54056[(int64_t) 0] = INFINITY;\n    barrier(CLK_LOCAL_MEM_FENCE);\n    barrier(CLK_LOCAL_MEM_FENCE);\n    for (int32_t i_3 = 0; i_3 < 1; i_3++)\n        mem_param_54057[i_3] = mem_54052[i_3];\n    for (int32_t i_4 = 0; i_4 < 1; i_4++)\n        mem_param_54058[i_4] = mem_54056[i_4];\n    for (int64_t tile_id_51529 = 0; tile_id_51529 < num_whole_tiles_51519; tile_id_51529++) {\n        int64_t binop_x_51638;\n        int64_t ltid_flat_51637;\n        int64_t ltid_51636;\n        int64_t j_51639;\n        bool cond_51647;\n        double pre1d_51648;\n        double pre1d_51649;\n        int64_t pre1d_51650;\n        int64_t mem_54068[1];\n        double mem_54072[1];\n        int64_t ltid_flat_51660;\n        int64_t ltid_51659;\n        int64_t gtid_51662;\n        int64_t acc_51668;\n        double acc_51669;\n        bool cond_51670;\n        int64_t acc_51671;\n        double acc_51672;\n        int64_t mem_param_tmp_56538[1];\n        double mem_param_tmp_56539[1];\n        \n        binop_x_51638 = tile_sizze_51474 * tile_id_51529;\n        ltid_flat_51637 = sext_i32_i64(local_tid_56529);\n        ltid_51636 = sext_i32_i64(sext_i64_i32(ltid_pre_56533));\n        j_51639 = ltid_51636 + bin", "op_x_51638;\n        cond_51647 = slt64(j_51639, conc_tmp_43977);\n        if (cond_51647) {\n            double tile_elem_51651;\n            double tile_elem_51652;\n            int64_t tile_elem_51653;\n            \n            tile_elem_51651 = ((__global double *) mem_54010)[j_51639];\n            tile_elem_51652 = ((__global double *) mem_54012)[j_51639];\n            tile_elem_51653 = ((__global int64_t *) ext_mem_54005)[j_51639];\n            pre1d_51648 = tile_elem_51651;\n            pre1d_51649 = tile_elem_51652;\n            pre1d_51650 = tile_elem_51653;\n        } else {\n            pre1d_51648 = 0.0;\n            pre1d_51649 = 0.0;\n            pre1d_51650 = (int64_t) 0;\n        }\n        ((__local double *) color_54537)[ltid_51636] = pre1d_51648;\n        ((__local double *) color_54536)[ltid_51636] = pre1d_51649;\n        ((__local int64_t *) color_54535)[ltid_51636] = pre1d_51650;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        ltid_flat_51660 = sext_i32_i64(local_tid_56529);\n        ltid_51659 = sext_i32_i64(sext_i64_i32(ltid_pre_56533));\n        gtid_51662 = binop_x_51490 + ltid_51659;\n        acc_51668 = mem_param_54057[(int64_t) 0];\n        acc_51669 = mem_param_54058[(int64_t) 0];\n        cond_51670 = slt64(gtid_51662, dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_44480);\n        if (cond_51670) {\n            double eta_p_51663;\n            double eta_p_51664;\n            double d_haversine_res_51665;\n            double d_haversine_res_51666;\n            double cos_res_51667;\n            int64_t x_51673;\n            double x_51674;\n            int64_t redout_53147;\n            double redout_53148;\n            \n            eta_p_51663 = mem_54032[(int64_t) 0];\n            eta_p_51664 = mem_54036[(int64_t) 0];\n            d_haversine_res_51665 = mem_54040[(int64_t) 0];\n            d_haversine_res_51666 = mem_54044[(int64_t) 0];\n            cos_res_51667 = mem_54048[(int64_t) 0];\n            redout_53147 = acc_51668;\n            redout_53148 = acc_51669;\n            for (int6",
                                    "4_t i_53149 = 0; i_53149 < tile_sizze_51474; i_53149++) {\n                double eta_p_51675;\n                double eta_p_51676;\n                double dist_res_51678;\n                bool zg_res_51707;\n                bool zg_res_51708;\n                bool x_51709;\n                int64_t lifted_lambda_res_51710;\n                double lifted_lambda_res_51711;\n                int64_t redout_tmp_56542;\n                double redout_tmp_56543;\n                \n                eta_p_51675 = ((__local double *) color_54537)[i_53149];\n                eta_p_51676 = ((__local double *) color_54536)[i_53149];\n                if (clBase_36810 == (int8_t) 0) {\n                    double zm_res_51679;\n                    double zm_res_51680;\n                    double hypot_res_51681;\n                    \n                    zm_res_51679 = eta_p_51664 - eta_p_51676;\n                    zm_res_51680 = eta_p_51663 - eta_p_51675;\n                    hypot_res_51681 = futrts_hypot64(zm_res_51680, zm_res_51679);\n                    dist_res_51678 = hypot_res_51681;\n                } else {\n                    double d_haversine_res_51682;\n                    double d_haversine_res_51683;\n                    double zm_res_51688;\n                    double cos_res_51689;\n                    double zm_res_51690;\n                    double cos_res_51691;\n                    double zt_res_51692;\n                    double zm_res_51693;\n                    double zm_res_51694;\n                    double zt_res_51695;\n                    double zp_res_51696;\n                    double zs_res_51697;\n                    double min_res_51698;\n                    double zt_res_51699;\n                    double zm_res_51700;\n                    double acos_res_51701;\n                    double zt_res_51702;\n                    \n                    if (clBase_36809 == (int8_t) 1) {\n                        d_haversine_res_51682 = eta_p_51675;\n                        d_haversine_res_51683 = et", "a_p_51676;\n                    } else {\n                        double zt_res_51684;\n                        double zs_res_51685;\n                        double zt_res_51686;\n                        double zs_res_51687;\n                        \n                        zt_res_51684 = 3.141592653589793 * eta_p_51675;\n                        zs_res_51685 = zt_res_51684 / 180.0;\n                        zt_res_51686 = 3.141592653589793 * eta_p_51676;\n                        zs_res_51687 = zt_res_51686 / 180.0;\n                        d_haversine_res_51682 = zs_res_51685;\n                        d_haversine_res_51683 = zs_res_51687;\n                    }\n                    zm_res_51688 = d_haversine_res_51665 - d_haversine_res_51682;\n                    cos_res_51689 = futrts_cos64(zm_res_51688);\n                    zm_res_51690 = 1.0 - cos_res_51689;\n                    cos_res_51691 = futrts_cos64(d_haversine_res_51682);\n                    zt_res_51692 = cos_res_51667 * cos_res_51691;\n                    zm_res_51693 = d_haversine_res_51666 - d_haversine_res_51683;\n                    zm_res_51694 = 1.0 - zm_res_51693;\n                    zt_res_51695 = zt_res_51692 * zm_res_51694;\n                    zp_res_51696 = zm_res_51690 + zt_res_51695;\n                    zs_res_51697 = zp_res_51696 / 2.0;\n                    min_res_51698 = fmin64(1.0, zs_res_51697);\n                    zt_res_51699 = 2.0 * min_res_51698;\n                    zm_res_51700 = 1.0 - zt_res_51699;\n                    acos_res_51701 = futrts_acos64(zm_res_51700);\n                    zt_res_51702 = clBase_36817 * acos_res_51701;\n                    dist_res_51678 = zt_res_51702;\n                }\n                zg_res_51707 = clBase_36811 < redout_53148;\n                zg_res_51708 = clBase_36811 < dist_res_51678;\n                x_51709 = zg_res_51707 && zg_res_51708;\n                if (x_51709) {\n                    lifted_lambda_res_51710 = (int64_t) -1;\n                    lifted_lambda_res_", "51711 = INFINITY;\n                } else {\n                    bool zl_res_51712;\n                    int64_t lifted_lambda_res_f_res_51713;\n                    double lifted_lambda_res_f_res_51714;\n                    \n                    zl_res_51712 = redout_53148 < dist_res_51678;\n                    if (zl_res_51712) {\n                        lifted_lambda_res_f_res_51713 = redout_53147;\n                    } else {\n                        int64_t x_51677 = ((__local int64_t *) color_54535)[i_53149];\n                        \n                        lifted_lambda_res_f_res_51713 = x_51677;\n                    }\n                    if (zl_res_51712) {\n                        lifted_lambda_res_f_res_51714 = redout_53148;\n                    } else {\n                        lifted_lambda_res_f_res_51714 = dist_res_51678;\n                    }\n                    lifted_lambda_res_51710 = lifted_lambda_res_f_res_51713;\n                    lifted_lambda_res_51711 = lifted_lambda_res_f_res_51714;\n                }\n                redout_tmp_56542 = lifted_lambda_res_51710;\n                redout_tmp_56543 = lifted_lambda_res_51711;\n                redout_53147 = redout_tmp_56542;\n                redout_53148 = redout_tmp_56543;\n            }\n            x_51673 = redout_53147;\n            x_51674 = redout_53148;\n            acc_51671 = x_51673;\n            acc_51672 = x_51674;\n        } else {\n            acc_51671 = acc_51668;\n            acc_51672 = acc_51669;\n        }\n        mem_54068[(int64_t) 0] = acc_51671;\n        mem_54072[(int64_t) 0] = acc_51672;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        for (int32_t i_5 = 0; i_5 < 1; i_5++)\n            mem_param_tmp_56538[i_5] = mem_54068[i_5];\n        for (int32_t i_6 = 0; i_6 < 1; i_6++)\n            mem_param_tmp_56539[i_6] = mem_54072[i_6];\n        for (int32_t i_7 = 0; i_7 < 1; i_7++)\n            mem_param_54057[i_7] = mem_param_tmp_56538[i_7];\n        for (int32_t i_8 = 0; i_8 < 1; i_8++)\n            mem_param_54",
                                    "058[i_8] = mem_param_tmp_56539[i_8];\n    }\n    for (int32_t i_9 = 0; i_9 < 1; i_9++)\n        ext_mem_54074[i_9] = mem_param_54057[i_9];\n    for (int32_t i_10 = 0; i_10 < 1; i_10++)\n        ext_mem_54073[i_10] = mem_param_54058[i_10];\n    barrier(CLK_LOCAL_MEM_FENCE);\n    if (cond_51758) {\n        for (int32_t i_11 = 0; i_11 < 1; i_11++)\n            ext_mem_54085[i_11] = ext_mem_54074[i_11];\n    } else {\n        int64_t ltid_flat_51760;\n        int64_t ltid_51759;\n        int64_t j_51775;\n        bool cond_51783;\n        double pre1d_51784;\n        double pre1d_51785;\n        int64_t pre1d_51786;\n        int64_t ltid_flat_51800;\n        int64_t ltid_51799;\n        int64_t gtid_51810;\n        int64_t acc_51816;\n        bool cond_51818;\n        int64_t acc_51819;\n        \n        ltid_flat_51760 = sext_i32_i64(local_tid_56529);\n        ltid_51759 = sext_i32_i64(sext_i64_i32(ltid_pre_56533));\n        j_51775 = ltid_51759 + binop_x_51774;\n        cond_51783 = slt64(j_51775, conc_tmp_43977);\n        if (cond_51783) {\n            double tile_elem_51787;\n            double tile_elem_51788;\n            int64_t tile_elem_51789;\n            \n            tile_elem_51787 = ((__global double *) mem_54010)[j_51775];\n            tile_elem_51788 = ((__global double *) mem_54012)[j_51775];\n            tile_elem_51789 = ((__global int64_t *) ext_mem_54005)[j_51775];\n            pre1d_51784 = tile_elem_51787;\n            pre1d_51785 = tile_elem_51788;\n            pre1d_51786 = tile_elem_51789;\n        } else {\n            pre1d_51784 = 0.0;\n            pre1d_51785 = 0.0;\n            pre1d_51786 = (int64_t) 0;\n        }\n        ((__local double *) color_54537)[ltid_51759] = pre1d_51784;\n        ((__local double *) color_54536)[ltid_51759] = pre1d_51785;\n        ((__local int64_t *) color_54535)[ltid_51759] = pre1d_51786;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        ltid_flat_51800 = sext_i32_i64(local_tid_56529);\n        ltid_51799 = sext_i32_i64(sext_i64_i32(ltid_pre_56533));\n        ", "gtid_51810 = binop_x_51490 + ltid_51799;\n        acc_51816 = ext_mem_54074[(int64_t) 0];\n        cond_51818 = slt64(gtid_51810, dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_44480);\n        if (cond_51818) {\n            double eta_p_51811;\n            double eta_p_51812;\n            double d_haversine_res_51813;\n            double d_haversine_res_51814;\n            double cos_res_51815;\n            double acc_51817;\n            int64_t x_51821;\n            double x_51822;\n            int64_t redout_53150;\n            double redout_53151;\n            \n            eta_p_51811 = mem_54032[(int64_t) 0];\n            eta_p_51812 = mem_54036[(int64_t) 0];\n            d_haversine_res_51813 = mem_54040[(int64_t) 0];\n            d_haversine_res_51814 = mem_54044[(int64_t) 0];\n            cos_res_51815 = mem_54048[(int64_t) 0];\n            acc_51817 = ext_mem_54073[(int64_t) 0];\n            redout_53150 = acc_51816;\n            redout_53151 = acc_51817;\n            for (int64_t i_53152 = 0; i_53152 < residual_input_51757; i_53152++) {\n                double eta_p_51823;\n                double eta_p_51824;\n                double dist_res_51826;\n                bool zg_res_51855;\n                bool zg_res_51856;\n                bool x_51857;\n                int64_t lifted_lambda_res_51858;\n                double lifted_lambda_res_51859;\n                int64_t redout_tmp_56544;\n                double redout_tmp_56545;\n                \n                eta_p_51823 = ((__local double *) color_54537)[i_53152];\n                eta_p_51824 = ((__local double *) color_54536)[i_53152];\n                if (clBase_36810 == (int8_t) 0) {\n                    double zm_res_51827;\n                    double zm_res_51828;\n                    double hypot_res_51829;\n                    \n                    zm_res_51827 = eta_p_51812 - eta_p_51824;\n                    zm_res_51828 = eta_p_51811 - eta_p_51823;\n                    hypot_res_51829 = futrts_hypot64(zm_res_51828, zm_res_51827);\n               ", "     dist_res_51826 = hypot_res_51829;\n                } else {\n                    double d_haversine_res_51830;\n                    double d_haversine_res_51831;\n                    double zm_res_51836;\n                    double cos_res_51837;\n                    double zm_res_51838;\n                    double cos_res_51839;\n                    double zt_res_51840;\n                    double zm_res_51841;\n                    double zm_res_51842;\n                    double zt_res_51843;\n                    double zp_res_51844;\n                    double zs_res_51845;\n                    double min_res_51846;\n                    double zt_res_51847;\n                    double zm_res_51848;\n                    double acos_res_51849;\n                    double zt_res_51850;\n                    \n                    if (clBase_36809 == (int8_t) 1) {\n                        d_haversine_res_51830 = eta_p_51823;\n                        d_haversine_res_51831 = eta_p_51824;\n                    } else {\n                        double zt_res_51832;\n                        double zs_res_51833;\n                        double zt_res_51834;\n                        double zs_res_51835;\n                        \n                        zt_res_51832 = 3.141592653589793 * eta_p_51823;\n                        zs_res_51833 = zt_res_51832 / 180.0;\n                        zt_res_51834 = 3.141592653589793 * eta_p_51824;\n                        zs_res_51835 = zt_res_51834 / 180.0;\n                        d_haversine_res_51830 = zs_res_51833;\n                        d_haversine_res_51831 = zs_res_51835;\n                    }\n                    zm_res_51836 = d_haversine_res_51813 - d_haversine_res_51830;\n                    cos_res_51837 = futrts_cos64(zm_res_51836);\n                    zm_res_51838 = 1.0 - cos_res_51837;\n                    cos_res_51839 = futrts_cos64(d_haversine_res_51830);\n                    zt_res_51840 = cos_res_51815 * cos_res_51839;\n                    zm_res_51841",
                                    " = d_haversine_res_51814 - d_haversine_res_51831;\n                    zm_res_51842 = 1.0 - zm_res_51841;\n                    zt_res_51843 = zt_res_51840 * zm_res_51842;\n                    zp_res_51844 = zm_res_51838 + zt_res_51843;\n                    zs_res_51845 = zp_res_51844 / 2.0;\n                    min_res_51846 = fmin64(1.0, zs_res_51845);\n                    zt_res_51847 = 2.0 * min_res_51846;\n                    zm_res_51848 = 1.0 - zt_res_51847;\n                    acos_res_51849 = futrts_acos64(zm_res_51848);\n                    zt_res_51850 = clBase_36817 * acos_res_51849;\n                    dist_res_51826 = zt_res_51850;\n                }\n                zg_res_51855 = clBase_36811 < redout_53151;\n                zg_res_51856 = clBase_36811 < dist_res_51826;\n                x_51857 = zg_res_51855 && zg_res_51856;\n                if (x_51857) {\n                    lifted_lambda_res_51858 = (int64_t) -1;\n                    lifted_lambda_res_51859 = INFINITY;\n                } else {\n                    bool zl_res_51860;\n                    int64_t lifted_lambda_res_f_res_51861;\n                    double lifted_lambda_res_f_res_51862;\n                    \n                    zl_res_51860 = redout_53151 < dist_res_51826;\n                    if (zl_res_51860) {\n                        lifted_lambda_res_f_res_51861 = redout_53150;\n                    } else {\n                        int64_t x_51825 = ((__local int64_t *) color_54535)[i_53152];\n                        \n                        lifted_lambda_res_f_res_51861 = x_51825;\n                    }\n                    if (zl_res_51860) {\n                        lifted_lambda_res_f_res_51862 = redout_53151;\n                    } else {\n                        lifted_lambda_res_f_res_51862 = dist_res_51826;\n                    }\n                    lifted_lambda_res_51858 = lifted_lambda_res_f_res_51861;\n                    lifted_lambda_res_51859 = lifted_lambda_res_f_res_51862;\n                }\n  ", "              redout_tmp_56544 = lifted_lambda_res_51858;\n                redout_tmp_56545 = lifted_lambda_res_51859;\n                redout_53150 = redout_tmp_56544;\n                redout_53151 = redout_tmp_56545;\n            }\n            x_51821 = redout_53150;\n            x_51822 = redout_53151;\n            acc_51819 = x_51821;\n        } else {\n            acc_51819 = acc_51816;\n        }\n        mem_54084[(int64_t) 0] = acc_51819;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        for (int32_t i_12 = 0; i_12 < 1; i_12++)\n            ext_mem_54085[i_12] = mem_54084[i_12];\n    }\n    if (slt64(sext_i32_i64(local_tid_56529) + tile_sizze_51474 * sext_i32_i64(block_id_56530), dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_44480)) {\n        int64_t tmp_56546 = ext_mem_54085[(int64_t) 0];\n        \n        ((__global int64_t *) mem_53626)[inf_44477 + (sext_i32_i64(local_tid_56529) + tile_sizze_51474 * sext_i32_i64(block_id_56530))] = tmp_56546;\n    }\n    \n  error_8:\n    return;\n    #undef tile_sizze_51474\n    #undef bytes_54059\n}\nFUTHARK_KERNEL_SIZED(do_DBSCAN_doublezisegmap_intrablock_51881_dim1, 1, 1)\nvoid do_DBSCAN_doublezisegmap_intrablock_51881(__global int *global_failure, int64_t m_44319, int64_t ldim_51884, int64_t num_whole_tiles_51904, int64_t residual_input_52136, unsigned char cond_52137_bits, int64_t binop_x_52153, __global unsigned char *mem_54094, __global unsigned char *mem_54096, __global unsigned char *mem_54241)\n{\n    bool cond_52137 = cond_52137_bits;\n    \n    #define tile_sizze_51883 (do_DBSCAN_doublezisegmap_intrablock_51881zitile_sizze_51883)\n    #define bytes_54194 (do_DBSCAN_doublezisegmap_intrablock_51881zibytes_54194)\n    \n    volatile __local unsigned char *color_54531_backing_2 = &shared_mem[0];\n    const int64_t color_54531_backing_2_offset = 0 + (bytes_54194 + srem64((int64_t) 8 - srem64(bytes_54194, (int64_t) 8), (int64_t) 8));\n    volatile __local unsigned char *color_54530_backing_1 = &shared_mem[color_54531_backing_2_offset];\n    const int64_t color_54", "530_backing_1_offset = color_54531_backing_2_offset + (bytes_54194 + srem64((int64_t) 8 - srem64(bytes_54194, (int64_t) 8), (int64_t) 8));\n    volatile __local unsigned char *color_54529_backing_0 = &shared_mem[color_54530_backing_1_offset];\n    const int64_t color_54529_backing_0_offset = color_54530_backing_1_offset + (bytes_54194 + srem64((int64_t) 8 - srem64(bytes_54194, (int64_t) 8), (int64_t) 8));\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_56364;\n    int32_t tblock_sizze_56367;\n    int32_t wave_sizze_56366;\n    int32_t block_id_56365;\n    int32_t global_tid_56363;\n    int64_t gid_flat_51881;\n    int64_t slice_56369;\n    int64_t ltid_pre_56368;\n    int64_t remnant_56370;\n    int64_t slice_56371;\n    int64_t gid_51880;\n    int64_t remnant_56372;\n    __local unsigned char *color_54529;\n    __local unsigned char *color_54530;\n    __local unsigned char *color_54531;\n    int64_t binop_x_51893;\n    int64_t mem_54174[1];\n    int64_t mem_54178[1];\n    int64_t ltid_flat_51886;\n    int64_t ltid_51885;\n    int64_t gtid_51894;\n    bool cond_51895;\n    int64_t pre_51896;\n    int64_t pre_51897;\n    int64_t mem_54182[1];\n    int64_t mem_54186[1];\n    int64_t mem_54190[1];\n    int64_t ltid_flat_51906;\n    int64_t ltid_51905;\n    int64_t gtid_51916;\n    bool cond_51917;\n    int64_t neutral_51918;\n    int64_t neutral_51919;\n    int64_t neutral_51920;\n    int64_t ext_mem_54214[1];\n    int64_t ext_mem_54213[1];\n    int64_t ext_mem_54212[1];\n    int64_t mem_param_54191[1];\n    int64_t mem_param_54192[1];\n    int64_t mem_param_54193[1];\n    int64_t mem_54224[1];\n    int64_t mem_54228[1];\n    int64_t mem_54232[1];\n    int64_t ext_mem_54235[1];\n    int64_t ext_mem_54234[1];\n    int64_t ext_mem_54233[1];\n    int64_t mem_54239[1];\n    int64_t ltid_flat_52241;\n    int64_t ltid_52240;\n    int64_t gtid_52247;\n    bool cond_52251;\n    int64_t postlude_52252;\n    \n    local_tid_56364 = get_local_id(0);\n    tblock_sizze_56367 = get_local_size(0);\n    wave_si",
                                    "zze_56366 = LOCKSTEP_WIDTH;\n    block_id_56365 = get_tblock_id(0);\n    global_tid_56363 = block_id_56365 * tblock_sizze_56367 + local_tid_56364;\n    gid_flat_51881 = sext_i32_i64(block_id_56365);\n    slice_56369 = tile_sizze_51883;\n    ltid_pre_56368 = sext_i32_i64(local_tid_56364);\n    remnant_56370 = sext_i32_i64(local_tid_56364) - ltid_pre_56368;\n    slice_56371 = ldim_51884;\n    gid_51880 = sext_i32_i64(block_id_56365);\n    remnant_56372 = sext_i32_i64(block_id_56365) - gid_51880;\n    color_54529 = (__local unsigned char *) color_54529_backing_0;\n    color_54530 = (__local unsigned char *) color_54530_backing_1;\n    color_54531 = (__local unsigned char *) color_54531_backing_2;\n    binop_x_51893 = gid_51880 * tile_sizze_51883;\n    ltid_flat_51886 = sext_i32_i64(local_tid_56364);\n    ltid_51885 = sext_i32_i64(sext_i64_i32(ltid_pre_56368));\n    gtid_51894 = ltid_51885 + binop_x_51893;\n    cond_51895 = slt64(gtid_51894, m_44319);\n    if (cond_51895) {\n        int64_t lifted_lambda_res_51898;\n        int64_t lifted_lambda_res_51899;\n        \n        lifted_lambda_res_51898 = ((__global int64_t *) mem_54096)[gtid_51894];\n        lifted_lambda_res_51899 = ((__global int64_t *) mem_54094)[gtid_51894];\n        pre_51896 = lifted_lambda_res_51898;\n        pre_51897 = lifted_lambda_res_51899;\n    } else {\n        pre_51896 = (int64_t) 0;\n        pre_51897 = (int64_t) 0;\n    }\n    mem_54174[(int64_t) 0] = pre_51896;\n    mem_54178[(int64_t) 0] = pre_51897;\n    barrier(CLK_LOCAL_MEM_FENCE);\n    ltid_flat_51906 = sext_i32_i64(local_tid_56364);\n    ltid_51905 = sext_i32_i64(sext_i64_i32(ltid_pre_56368));\n    gtid_51916 = binop_x_51893 + ltid_51905;\n    cond_51917 = slt64(gtid_51916, m_44319);\n    if (cond_51917) {\n        neutral_51918 = gtid_51916;\n    } else {\n        neutral_51918 = (int64_t) 0;\n    }\n    if (cond_51917) {\n        int64_t lifted_lambda_res_51921;\n        int64_t lifted_lambda_res_51922;\n        \n        lifted_lambda_res_51921 = mem_54174[(int64_t) 0];\n    ", "    lifted_lambda_res_51922 = mem_54178[(int64_t) 0];\n        neutral_51919 = lifted_lambda_res_51921;\n        neutral_51920 = lifted_lambda_res_51922;\n    } else {\n        neutral_51919 = (int64_t) 0;\n        neutral_51920 = (int64_t) 0;\n    }\n    mem_54182[(int64_t) 0] = neutral_51918;\n    mem_54186[(int64_t) 0] = neutral_51919;\n    mem_54190[(int64_t) 0] = neutral_51920;\n    barrier(CLK_LOCAL_MEM_FENCE);\n    barrier(CLK_LOCAL_MEM_FENCE);\n    for (int32_t i_3 = 0; i_3 < 1; i_3++)\n        mem_param_54191[i_3] = mem_54182[i_3];\n    for (int32_t i_4 = 0; i_4 < 1; i_4++)\n        mem_param_54192[i_4] = mem_54186[i_4];\n    for (int32_t i_5 = 0; i_5 < 1; i_5++)\n        mem_param_54193[i_5] = mem_54190[i_5];\n    for (int64_t tile_id_51932 = 0; tile_id_51932 < num_whole_tiles_51904; tile_id_51932++) {\n        int64_t binop_x_52034;\n        int64_t ltid_flat_52033;\n        int64_t ltid_52032;\n        int64_t j_52035;\n        bool cond_52040;\n        int64_t pre1d_52041;\n        int64_t pre1d_52042;\n        int64_t pre1d_52043;\n        int64_t mem_54203[1];\n        int64_t mem_54207[1];\n        int64_t mem_54211[1];\n        int64_t ltid_flat_52054;\n        int64_t ltid_52053;\n        int64_t gtid_52056;\n        int64_t acc_52059;\n        int64_t acc_52060;\n        int64_t acc_52061;\n        bool cond_52062;\n        int64_t acc_52063;\n        int64_t acc_52064;\n        int64_t acc_52065;\n        int64_t mem_param_tmp_56373[1];\n        int64_t mem_param_tmp_56374[1];\n        int64_t mem_param_tmp_56375[1];\n        \n        binop_x_52034 = tile_sizze_51883 * tile_id_51932;\n        ltid_flat_52033 = sext_i32_i64(local_tid_56364);\n        ltid_52032 = sext_i32_i64(sext_i64_i32(ltid_pre_56368));\n        j_52035 = ltid_52032 + binop_x_52034;\n        cond_52040 = slt64(j_52035, m_44319);\n        if (cond_52040) {\n            pre1d_52041 = j_52035;\n        } else {\n            pre1d_52041 = (int64_t) 0;\n        }\n        if (cond_52040) {\n            int64_t tile_elem_52045;\n        ", "    int64_t tile_elem_52046;\n            \n            tile_elem_52045 = ((__global int64_t *) mem_54096)[j_52035];\n            tile_elem_52046 = ((__global int64_t *) mem_54094)[j_52035];\n            pre1d_52042 = tile_elem_52045;\n            pre1d_52043 = tile_elem_52046;\n        } else {\n            pre1d_52042 = (int64_t) 0;\n            pre1d_52043 = (int64_t) 0;\n        }\n        ((__local int64_t *) color_54531)[ltid_52032] = pre1d_52041;\n        ((__local int64_t *) color_54530)[ltid_52032] = pre1d_52042;\n        ((__local int64_t *) color_54529)[ltid_52032] = pre1d_52043;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        ltid_flat_52054 = sext_i32_i64(local_tid_56364);\n        ltid_52053 = sext_i32_i64(sext_i64_i32(ltid_pre_56368));\n        gtid_52056 = binop_x_51893 + ltid_52053;\n        acc_52059 = mem_param_54191[(int64_t) 0];\n        acc_52060 = mem_param_54192[(int64_t) 0];\n        acc_52061 = mem_param_54193[(int64_t) 0];\n        cond_52062 = slt64(gtid_52056, m_44319);\n        if (cond_52062) {\n            int64_t lifted_lambda_res_52058;\n            int64_t x_52066;\n            int64_t x_52067;\n            int64_t x_52068;\n            int64_t redout_53157;\n            int64_t redout_53158;\n            int64_t redout_53159;\n            \n            lifted_lambda_res_52058 = mem_54178[(int64_t) 0];\n            redout_53157 = acc_52059;\n            redout_53158 = acc_52060;\n            redout_53159 = acc_52061;\n            for (int64_t i_53160 = 0; i_53160 < tile_sizze_51883; i_53160++) {\n                int64_t x_52069;\n                int64_t x_52070;\n                int64_t x_52071;\n                bool cond_52078;\n                bool cond_52079;\n                bool cond_f_res_52080;\n                bool y_52081;\n                bool cond_52082;\n                bool cond_52083;\n                bool cond_52084;\n                bool cond_t_res_52085;\n                bool cond_t_res_52086;\n                bool x_52087;\n                bool cond_52088;\n    ",
                                    "            bool cond_f_res_t_res_f_res_t_res_52089;\n                bool x_52090;\n                bool x_52091;\n                bool y_52092;\n                bool cond_f_res_t_res_52093;\n                bool x_52094;\n                bool x_52095;\n                bool y_52096;\n                bool cond_52097;\n                int64_t lifted_lambda_res_52098;\n                int64_t lifted_lambda_res_52099;\n                int64_t lifted_lambda_res_52100;\n                int64_t redout_tmp_56379;\n                int64_t redout_tmp_56380;\n                int64_t redout_tmp_56381;\n                \n                x_52069 = ((__local int64_t *) color_54531)[i_53160];\n                x_52070 = ((__local int64_t *) color_54530)[i_53160];\n                x_52071 = ((__local int64_t *) color_54529)[i_53160];\n                cond_52078 = redout_53159 == lifted_lambda_res_52058;\n                cond_52079 = !cond_52078;\n                cond_f_res_52080 = redout_53159 == redout_53158;\n                y_52081 = cond_52078 && cond_f_res_52080;\n                cond_52082 = cond_52079 || y_52081;\n                cond_52083 = x_52071 == lifted_lambda_res_52058;\n                cond_52084 = slt64(x_52070, redout_53158);\n                cond_t_res_52085 = x_52070 == x_52071;\n                cond_t_res_52086 = !cond_t_res_52085;\n                x_52087 = cond_52084 && cond_t_res_52086;\n                cond_52088 = x_52070 == redout_53158;\n                cond_f_res_t_res_f_res_t_res_52089 = slt64(x_52069, redout_53157);\n                x_52090 = cond_52088 && cond_f_res_t_res_f_res_t_res_52089;\n                x_52091 = !x_52087;\n                y_52092 = x_52090 && x_52091;\n                cond_f_res_t_res_52093 = x_52087 || y_52092;\n                x_52094 = cond_52083 && cond_f_res_t_res_52093;\n                x_52095 = !cond_52082;\n                y_52096 = x_52094 && x_52095;\n                cond_52097 = cond_52082 || y_52096;\n                if (cond_52097) {\n                    ", "lifted_lambda_res_52098 = x_52069;\n                } else {\n                    lifted_lambda_res_52098 = redout_53157;\n                }\n                if (cond_52097) {\n                    lifted_lambda_res_52099 = x_52071;\n                } else {\n                    lifted_lambda_res_52099 = redout_53159;\n                }\n                if (cond_52097) {\n                    lifted_lambda_res_52100 = x_52070;\n                } else {\n                    lifted_lambda_res_52100 = redout_53158;\n                }\n                redout_tmp_56379 = lifted_lambda_res_52098;\n                redout_tmp_56380 = lifted_lambda_res_52099;\n                redout_tmp_56381 = lifted_lambda_res_52100;\n                redout_53157 = redout_tmp_56379;\n                redout_53158 = redout_tmp_56380;\n                redout_53159 = redout_tmp_56381;\n            }\n            x_52066 = redout_53157;\n            x_52067 = redout_53158;\n            x_52068 = redout_53159;\n            acc_52063 = x_52066;\n            acc_52064 = x_52067;\n            acc_52065 = x_52068;\n        } else {\n            acc_52063 = acc_52059;\n            acc_52064 = acc_52060;\n            acc_52065 = acc_52061;\n        }\n        mem_54203[(int64_t) 0] = acc_52063;\n        mem_54207[(int64_t) 0] = acc_52064;\n        mem_54211[(int64_t) 0] = acc_52065;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        for (int32_t i_6 = 0; i_6 < 1; i_6++)\n            mem_param_tmp_56373[i_6] = mem_54203[i_6];\n        for (int32_t i_7 = 0; i_7 < 1; i_7++)\n            mem_param_tmp_56374[i_7] = mem_54207[i_7];\n        for (int32_t i_8 = 0; i_8 < 1; i_8++)\n            mem_param_tmp_56375[i_8] = mem_54211[i_8];\n        for (int32_t i_9 = 0; i_9 < 1; i_9++)\n            mem_param_54191[i_9] = mem_param_tmp_56373[i_9];\n        for (int32_t i_10 = 0; i_10 < 1; i_10++)\n            mem_param_54192[i_10] = mem_param_tmp_56374[i_10];\n        for (int32_t i_11 = 0; i_11 < 1; i_11++)\n            mem_param_54193[i_11] = mem_param_tmp_56375[i", "_11];\n    }\n    for (int32_t i_12 = 0; i_12 < 1; i_12++)\n        ext_mem_54214[i_12] = mem_param_54191[i_12];\n    for (int32_t i_13 = 0; i_13 < 1; i_13++)\n        ext_mem_54213[i_13] = mem_param_54192[i_13];\n    for (int32_t i_14 = 0; i_14 < 1; i_14++)\n        ext_mem_54212[i_14] = mem_param_54193[i_14];\n    barrier(CLK_LOCAL_MEM_FENCE);\n    if (cond_52137) {\n        for (int32_t i_15 = 0; i_15 < 1; i_15++)\n            ext_mem_54235[i_15] = ext_mem_54214[i_15];\n        for (int32_t i_16 = 0; i_16 < 1; i_16++)\n            ext_mem_54234[i_16] = ext_mem_54213[i_16];\n        for (int32_t i_17 = 0; i_17 < 1; i_17++)\n            ext_mem_54233[i_17] = ext_mem_54212[i_17];\n    } else {\n        int64_t ltid_flat_52139;\n        int64_t ltid_52138;\n        int64_t j_52154;\n        bool cond_52159;\n        int64_t pre1d_52160;\n        int64_t pre1d_52161;\n        int64_t pre1d_52162;\n        int64_t ltid_flat_52176;\n        int64_t ltid_52175;\n        int64_t gtid_52189;\n        int64_t acc_52192;\n        int64_t acc_52193;\n        int64_t acc_52194;\n        bool cond_52195;\n        int64_t acc_52196;\n        int64_t acc_52197;\n        int64_t acc_52198;\n        \n        ltid_flat_52139 = sext_i32_i64(local_tid_56364);\n        ltid_52138 = sext_i32_i64(sext_i64_i32(ltid_pre_56368));\n        j_52154 = ltid_52138 + binop_x_52153;\n        cond_52159 = slt64(j_52154, m_44319);\n        if (cond_52159) {\n            pre1d_52160 = j_52154;\n        } else {\n            pre1d_52160 = (int64_t) 0;\n        }\n        if (cond_52159) {\n            int64_t tile_elem_52164;\n            int64_t tile_elem_52165;\n            \n            tile_elem_52164 = ((__global int64_t *) mem_54096)[j_52154];\n            tile_elem_52165 = ((__global int64_t *) mem_54094)[j_52154];\n            pre1d_52161 = tile_elem_52164;\n            pre1d_52162 = tile_elem_52165;\n        } else {\n            pre1d_52161 = (int64_t) 0;\n            pre1d_52162 = (int64_t) 0;\n        }\n        ((__local int64_t *) color_5453",
                                    "1)[ltid_52138] = pre1d_52160;\n        ((__local int64_t *) color_54530)[ltid_52138] = pre1d_52161;\n        ((__local int64_t *) color_54529)[ltid_52138] = pre1d_52162;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        ltid_flat_52176 = sext_i32_i64(local_tid_56364);\n        ltid_52175 = sext_i32_i64(sext_i64_i32(ltid_pre_56368));\n        gtid_52189 = binop_x_51893 + ltid_52175;\n        acc_52192 = ext_mem_54214[(int64_t) 0];\n        acc_52193 = ext_mem_54213[(int64_t) 0];\n        acc_52194 = ext_mem_54212[(int64_t) 0];\n        cond_52195 = slt64(gtid_52189, m_44319);\n        if (cond_52195) {\n            int64_t lifted_lambda_res_52191;\n            int64_t x_52199;\n            int64_t x_52200;\n            int64_t x_52201;\n            int64_t redout_53161;\n            int64_t redout_53162;\n            int64_t redout_53163;\n            \n            lifted_lambda_res_52191 = mem_54178[(int64_t) 0];\n            redout_53161 = acc_52192;\n            redout_53162 = acc_52193;\n            redout_53163 = acc_52194;\n            for (int64_t i_53164 = 0; i_53164 < residual_input_52136; i_53164++) {\n                int64_t x_52202;\n                int64_t x_52203;\n                int64_t x_52204;\n                bool cond_52211;\n                bool cond_52212;\n                bool cond_f_res_52213;\n                bool y_52214;\n                bool cond_52215;\n                bool cond_52216;\n                bool cond_52217;\n                bool cond_t_res_52218;\n                bool cond_t_res_52219;\n                bool x_52220;\n                bool cond_52221;\n                bool cond_f_res_t_res_f_res_t_res_52222;\n                bool x_52223;\n                bool x_52224;\n                bool y_52225;\n                bool cond_f_res_t_res_52226;\n                bool x_52227;\n                bool x_52228;\n                bool y_52229;\n                bool cond_52230;\n                int64_t lifted_lambda_res_52231;\n                int64_t lifted_lambda_res_52232;\n           ", "     int64_t lifted_lambda_res_52233;\n                int64_t redout_tmp_56382;\n                int64_t redout_tmp_56383;\n                int64_t redout_tmp_56384;\n                \n                x_52202 = ((__local int64_t *) color_54531)[i_53164];\n                x_52203 = ((__local int64_t *) color_54530)[i_53164];\n                x_52204 = ((__local int64_t *) color_54529)[i_53164];\n                cond_52211 = redout_53163 == lifted_lambda_res_52191;\n                cond_52212 = !cond_52211;\n                cond_f_res_52213 = redout_53163 == redout_53162;\n                y_52214 = cond_52211 && cond_f_res_52213;\n                cond_52215 = cond_52212 || y_52214;\n                cond_52216 = x_52204 == lifted_lambda_res_52191;\n                cond_52217 = slt64(x_52203, redout_53162);\n                cond_t_res_52218 = x_52203 == x_52204;\n                cond_t_res_52219 = !cond_t_res_52218;\n                x_52220 = cond_52217 && cond_t_res_52219;\n                cond_52221 = x_52203 == redout_53162;\n                cond_f_res_t_res_f_res_t_res_52222 = slt64(x_52202, redout_53161);\n                x_52223 = cond_52221 && cond_f_res_t_res_f_res_t_res_52222;\n                x_52224 = !x_52220;\n                y_52225 = x_52223 && x_52224;\n                cond_f_res_t_res_52226 = x_52220 || y_52225;\n                x_52227 = cond_52216 && cond_f_res_t_res_52226;\n                x_52228 = !cond_52215;\n                y_52229 = x_52227 && x_52228;\n                cond_52230 = cond_52215 || y_52229;\n                if (cond_52230) {\n                    lifted_lambda_res_52231 = x_52202;\n                } else {\n                    lifted_lambda_res_52231 = redout_53161;\n                }\n                if (cond_52230) {\n                    lifted_lambda_res_52232 = x_52204;\n                } else {\n                    lifted_lambda_res_52232 = redout_53163;\n                }\n                if (cond_52230) {\n                    lifted_lambda_res_52233 = x_52203;\n ", "               } else {\n                    lifted_lambda_res_52233 = redout_53162;\n                }\n                redout_tmp_56382 = lifted_lambda_res_52231;\n                redout_tmp_56383 = lifted_lambda_res_52232;\n                redout_tmp_56384 = lifted_lambda_res_52233;\n                redout_53161 = redout_tmp_56382;\n                redout_53162 = redout_tmp_56383;\n                redout_53163 = redout_tmp_56384;\n            }\n            x_52199 = redout_53161;\n            x_52200 = redout_53162;\n            x_52201 = redout_53163;\n            acc_52196 = x_52199;\n            acc_52197 = x_52200;\n            acc_52198 = x_52201;\n        } else {\n            acc_52196 = acc_52192;\n            acc_52197 = acc_52193;\n            acc_52198 = acc_52194;\n        }\n        mem_54224[(int64_t) 0] = acc_52196;\n        mem_54228[(int64_t) 0] = acc_52197;\n        mem_54232[(int64_t) 0] = acc_52198;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        for (int32_t i_18 = 0; i_18 < 1; i_18++)\n            ext_mem_54235[i_18] = mem_54224[i_18];\n        for (int32_t i_19 = 0; i_19 < 1; i_19++)\n            ext_mem_54234[i_19] = mem_54228[i_19];\n        for (int32_t i_20 = 0; i_20 < 1; i_20++)\n            ext_mem_54233[i_20] = mem_54232[i_20];\n    }\n    ltid_flat_52241 = sext_i32_i64(local_tid_56364);\n    ltid_52240 = sext_i32_i64(sext_i64_i32(ltid_pre_56368));\n    gtid_52247 = binop_x_51893 + ltid_52240;\n    cond_52251 = slt64(gtid_52247, m_44319);\n    if (cond_52251) {\n        int64_t defunc_0_f_res_52248;\n        int64_t defunc_0_f_res_52249;\n        int64_t defunc_0_f_res_52250;\n        bool cond_52255;\n        bool lifted_lambda_res_t_res_52256;\n        bool lifted_lambda_res_t_res_52257;\n        bool x_52258;\n        int64_t defunc_0_f_res_52259;\n        \n        defunc_0_f_res_52248 = ext_mem_54235[(int64_t) 0];\n        defunc_0_f_res_52249 = ext_mem_54234[(int64_t) 0];\n        defunc_0_f_res_52250 = ext_mem_54233[(int64_t) 0];\n        cond_52255 = gtid_52247 == defunc_0",
                                    "_f_res_52248;\n        lifted_lambda_res_t_res_52256 = defunc_0_f_res_52249 == defunc_0_f_res_52250;\n        lifted_lambda_res_t_res_52257 = !lifted_lambda_res_t_res_52256;\n        x_52258 = cond_52255 && lifted_lambda_res_t_res_52257;\n        defunc_0_f_res_52259 = btoi_bool_i64(x_52258);\n        postlude_52252 = defunc_0_f_res_52259;\n    } else {\n        postlude_52252 = (int64_t) 0;\n    }\n    mem_54239[(int64_t) 0] = postlude_52252;\n    barrier(CLK_LOCAL_MEM_FENCE);\n    if (slt64(sext_i32_i64(local_tid_56364) + tile_sizze_51883 * sext_i32_i64(block_id_56365), m_44319)) {\n        int64_t tmp_56385 = mem_54239[(int64_t) 0];\n        \n        ((__global int64_t *) mem_54241)[sext_i32_i64(local_tid_56364) + tile_sizze_51883 * sext_i32_i64(block_id_56365)] = tmp_56385;\n    }\n    \n  error_9:\n    return;\n    #undef tile_sizze_51883\n    #undef bytes_54194\n}\nFUTHARK_KERNEL_SIZED(do_DBSCAN_doublezisegmap_intrablock_52263_dim1, 1, 1)\nvoid do_DBSCAN_doublezisegmap_intrablock_52263(__global int *global_failure, int64_t m_44319, int64_t ldim_52266, int64_t num_whole_tiles_52286, int64_t residual_input_52518, unsigned char cond_52519_bits, int64_t binop_x_52535, __global unsigned char *mem_54094, __global unsigned char *mem_54096, __global unsigned char *mem_54169)\n{\n    bool cond_52519 = cond_52519_bits;\n    \n    #define tile_sizze_52265 (do_DBSCAN_doublezisegmap_intrablock_52263zitile_sizze_52265)\n    #define bytes_54122 (do_DBSCAN_doublezisegmap_intrablock_52263zibytes_54122)\n    \n    volatile __local unsigned char *color_54534_backing_2 = &shared_mem[0];\n    const int64_t color_54534_backing_2_offset = 0 + (bytes_54122 + srem64((int64_t) 8 - srem64(bytes_54122, (int64_t) 8), (int64_t) 8));\n    volatile __local unsigned char *color_54533_backing_1 = &shared_mem[color_54534_backing_2_offset];\n    const int64_t color_54533_backing_1_offset = color_54534_backing_2_offset + (bytes_54122 + srem64((int64_t) 8 - srem64(bytes_54122, (int64_t) 8), (int64_t) 8));\n    volatile __local un", "signed char *color_54532_backing_0 = &shared_mem[color_54533_backing_1_offset];\n    const int64_t color_54532_backing_0_offset = color_54533_backing_1_offset + (bytes_54122 + srem64((int64_t) 8 - srem64(bytes_54122, (int64_t) 8), (int64_t) 8));\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_56389;\n    int32_t tblock_sizze_56392;\n    int32_t wave_sizze_56391;\n    int32_t block_id_56390;\n    int32_t global_tid_56388;\n    int64_t gid_flat_52263;\n    int64_t slice_56394;\n    int64_t ltid_pre_56393;\n    int64_t remnant_56395;\n    int64_t slice_56396;\n    int64_t gid_52262;\n    int64_t remnant_56397;\n    __local unsigned char *color_54532;\n    __local unsigned char *color_54533;\n    __local unsigned char *color_54534;\n    int64_t binop_x_52275;\n    int64_t mem_54102[1];\n    int64_t mem_54106[1];\n    int64_t ltid_flat_52268;\n    int64_t ltid_52267;\n    int64_t gtid_52276;\n    bool cond_52277;\n    int64_t pre_52278;\n    int64_t pre_52279;\n    int64_t mem_54110[1];\n    int64_t mem_54114[1];\n    int64_t mem_54118[1];\n    int64_t ltid_flat_52288;\n    int64_t ltid_52287;\n    int64_t gtid_52298;\n    bool cond_52299;\n    int64_t neutral_52300;\n    int64_t neutral_52301;\n    int64_t neutral_52302;\n    int64_t ext_mem_54142[1];\n    int64_t ext_mem_54141[1];\n    int64_t ext_mem_54140[1];\n    int64_t mem_param_54119[1];\n    int64_t mem_param_54120[1];\n    int64_t mem_param_54121[1];\n    int64_t mem_54152[1];\n    int64_t mem_54156[1];\n    int64_t mem_54160[1];\n    int64_t ext_mem_54163[1];\n    int64_t ext_mem_54162[1];\n    int64_t ext_mem_54161[1];\n    int64_t mem_54167[1];\n    int64_t ltid_flat_52623;\n    int64_t ltid_52622;\n    int64_t gtid_52629;\n    bool cond_52633;\n    int64_t postlude_52634;\n    \n    local_tid_56389 = get_local_id(0);\n    tblock_sizze_56392 = get_local_size(0);\n    wave_sizze_56391 = LOCKSTEP_WIDTH;\n    block_id_56390 = get_tblock_id(0);\n    global_tid_56388 = block_id_56390 * tblock_sizze_56392 + local_tid_56389;\n    gid_flat_5226", "3 = sext_i32_i64(block_id_56390);\n    slice_56394 = tile_sizze_52265;\n    ltid_pre_56393 = sext_i32_i64(local_tid_56389);\n    remnant_56395 = sext_i32_i64(local_tid_56389) - ltid_pre_56393;\n    slice_56396 = ldim_52266;\n    gid_52262 = sext_i32_i64(block_id_56390);\n    remnant_56397 = sext_i32_i64(block_id_56390) - gid_52262;\n    color_54532 = (__local unsigned char *) color_54532_backing_0;\n    color_54533 = (__local unsigned char *) color_54533_backing_1;\n    color_54534 = (__local unsigned char *) color_54534_backing_2;\n    binop_x_52275 = gid_52262 * tile_sizze_52265;\n    ltid_flat_52268 = sext_i32_i64(local_tid_56389);\n    ltid_52267 = sext_i32_i64(sext_i64_i32(ltid_pre_56393));\n    gtid_52276 = ltid_52267 + binop_x_52275;\n    cond_52277 = slt64(gtid_52276, m_44319);\n    if (cond_52277) {\n        int64_t lifted_lambda_res_52280;\n        int64_t lifted_lambda_res_52281;\n        \n        lifted_lambda_res_52280 = ((__global int64_t *) mem_54096)[gtid_52276];\n        lifted_lambda_res_52281 = ((__global int64_t *) mem_54094)[gtid_52276];\n        pre_52278 = lifted_lambda_res_52280;\n        pre_52279 = lifted_lambda_res_52281;\n    } else {\n        pre_52278 = (int64_t) 0;\n        pre_52279 = (int64_t) 0;\n    }\n    mem_54102[(int64_t) 0] = pre_52278;\n    mem_54106[(int64_t) 0] = pre_52279;\n    barrier(CLK_LOCAL_MEM_FENCE);\n    ltid_flat_52288 = sext_i32_i64(local_tid_56389);\n    ltid_52287 = sext_i32_i64(sext_i64_i32(ltid_pre_56393));\n    gtid_52298 = binop_x_52275 + ltid_52287;\n    cond_52299 = slt64(gtid_52298, m_44319);\n    if (cond_52299) {\n        neutral_52300 = gtid_52298;\n    } else {\n        neutral_52300 = (int64_t) 0;\n    }\n    if (cond_52299) {\n        int64_t lifted_lambda_res_52303;\n        int64_t lifted_lambda_res_52304;\n        \n        lifted_lambda_res_52303 = mem_54102[(int64_t) 0];\n        lifted_lambda_res_52304 = mem_54106[(int64_t) 0];\n        neutral_52301 = lifted_lambda_res_52303;\n        neutral_52302 = lifted_lambda_res_52304;\n    } else",
                                    " {\n        neutral_52301 = (int64_t) 0;\n        neutral_52302 = (int64_t) 0;\n    }\n    mem_54110[(int64_t) 0] = neutral_52300;\n    mem_54114[(int64_t) 0] = neutral_52301;\n    mem_54118[(int64_t) 0] = neutral_52302;\n    barrier(CLK_LOCAL_MEM_FENCE);\n    barrier(CLK_LOCAL_MEM_FENCE);\n    for (int32_t i_3 = 0; i_3 < 1; i_3++)\n        mem_param_54119[i_3] = mem_54110[i_3];\n    for (int32_t i_4 = 0; i_4 < 1; i_4++)\n        mem_param_54120[i_4] = mem_54114[i_4];\n    for (int32_t i_5 = 0; i_5 < 1; i_5++)\n        mem_param_54121[i_5] = mem_54118[i_5];\n    for (int64_t tile_id_52314 = 0; tile_id_52314 < num_whole_tiles_52286; tile_id_52314++) {\n        int64_t binop_x_52416;\n        int64_t ltid_flat_52415;\n        int64_t ltid_52414;\n        int64_t j_52417;\n        bool cond_52422;\n        int64_t pre1d_52423;\n        int64_t pre1d_52424;\n        int64_t pre1d_52425;\n        int64_t mem_54131[1];\n        int64_t mem_54135[1];\n        int64_t mem_54139[1];\n        int64_t ltid_flat_52436;\n        int64_t ltid_52435;\n        int64_t gtid_52438;\n        int64_t acc_52441;\n        int64_t acc_52442;\n        int64_t acc_52443;\n        bool cond_52444;\n        int64_t acc_52445;\n        int64_t acc_52446;\n        int64_t acc_52447;\n        int64_t mem_param_tmp_56398[1];\n        int64_t mem_param_tmp_56399[1];\n        int64_t mem_param_tmp_56400[1];\n        \n        binop_x_52416 = tile_sizze_52265 * tile_id_52314;\n        ltid_flat_52415 = sext_i32_i64(local_tid_56389);\n        ltid_52414 = sext_i32_i64(sext_i64_i32(ltid_pre_56393));\n        j_52417 = ltid_52414 + binop_x_52416;\n        cond_52422 = slt64(j_52417, m_44319);\n        if (cond_52422) {\n            pre1d_52423 = j_52417;\n        } else {\n            pre1d_52423 = (int64_t) 0;\n        }\n        if (cond_52422) {\n            int64_t tile_elem_52427;\n            int64_t tile_elem_52428;\n            \n            tile_elem_52427 = ((__global int64_t *) mem_54096)[j_52417];\n            tile_elem_52428 = ((__global int64_", "t *) mem_54094)[j_52417];\n            pre1d_52424 = tile_elem_52427;\n            pre1d_52425 = tile_elem_52428;\n        } else {\n            pre1d_52424 = (int64_t) 0;\n            pre1d_52425 = (int64_t) 0;\n        }\n        ((__local int64_t *) color_54534)[ltid_52414] = pre1d_52423;\n        ((__local int64_t *) color_54533)[ltid_52414] = pre1d_52424;\n        ((__local int64_t *) color_54532)[ltid_52414] = pre1d_52425;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        ltid_flat_52436 = sext_i32_i64(local_tid_56389);\n        ltid_52435 = sext_i32_i64(sext_i64_i32(ltid_pre_56393));\n        gtid_52438 = binop_x_52275 + ltid_52435;\n        acc_52441 = mem_param_54119[(int64_t) 0];\n        acc_52442 = mem_param_54120[(int64_t) 0];\n        acc_52443 = mem_param_54121[(int64_t) 0];\n        cond_52444 = slt64(gtid_52438, m_44319);\n        if (cond_52444) {\n            int64_t lifted_lambda_res_52440;\n            int64_t x_52448;\n            int64_t x_52449;\n            int64_t x_52450;\n            int64_t redout_53165;\n            int64_t redout_53166;\n            int64_t redout_53167;\n            \n            lifted_lambda_res_52440 = mem_54106[(int64_t) 0];\n            redout_53165 = acc_52441;\n            redout_53166 = acc_52442;\n            redout_53167 = acc_52443;\n            for (int64_t i_53168 = 0; i_53168 < tile_sizze_52265; i_53168++) {\n                int64_t x_52451;\n                int64_t x_52452;\n                int64_t x_52453;\n                bool cond_52460;\n                bool cond_52461;\n                bool cond_f_res_52462;\n                bool y_52463;\n                bool cond_52464;\n                bool cond_52465;\n                bool cond_52466;\n                bool cond_t_res_52467;\n                bool cond_t_res_52468;\n                bool x_52469;\n                bool cond_52470;\n                bool cond_f_res_t_res_f_res_t_res_52471;\n                bool x_52472;\n                bool x_52473;\n                bool y_52474;\n                boo", "l cond_f_res_t_res_52475;\n                bool x_52476;\n                bool x_52477;\n                bool y_52478;\n                bool cond_52479;\n                int64_t lifted_lambda_res_52480;\n                int64_t lifted_lambda_res_52481;\n                int64_t lifted_lambda_res_52482;\n                int64_t redout_tmp_56404;\n                int64_t redout_tmp_56405;\n                int64_t redout_tmp_56406;\n                \n                x_52451 = ((__local int64_t *) color_54534)[i_53168];\n                x_52452 = ((__local int64_t *) color_54533)[i_53168];\n                x_52453 = ((__local int64_t *) color_54532)[i_53168];\n                cond_52460 = redout_53167 == lifted_lambda_res_52440;\n                cond_52461 = !cond_52460;\n                cond_f_res_52462 = redout_53167 == redout_53166;\n                y_52463 = cond_52460 && cond_f_res_52462;\n                cond_52464 = cond_52461 || y_52463;\n                cond_52465 = x_52453 == lifted_lambda_res_52440;\n                cond_52466 = slt64(x_52452, redout_53166);\n                cond_t_res_52467 = x_52452 == x_52453;\n                cond_t_res_52468 = !cond_t_res_52467;\n                x_52469 = cond_52466 && cond_t_res_52468;\n                cond_52470 = x_52452 == redout_53166;\n                cond_f_res_t_res_f_res_t_res_52471 = slt64(x_52451, redout_53165);\n                x_52472 = cond_52470 && cond_f_res_t_res_f_res_t_res_52471;\n                x_52473 = !x_52469;\n                y_52474 = x_52472 && x_52473;\n                cond_f_res_t_res_52475 = x_52469 || y_52474;\n                x_52476 = cond_52465 && cond_f_res_t_res_52475;\n                x_52477 = !cond_52464;\n                y_52478 = x_52476 && x_52477;\n                cond_52479 = cond_52464 || y_52478;\n                if (cond_52479) {\n                    lifted_lambda_res_52480 = x_52451;\n                } else {\n                    lifted_lambda_res_52480 = redout_53165;\n                }\n                if (cond",
                                    "_52479) {\n                    lifted_lambda_res_52481 = x_52453;\n                } else {\n                    lifted_lambda_res_52481 = redout_53167;\n                }\n                if (cond_52479) {\n                    lifted_lambda_res_52482 = x_52452;\n                } else {\n                    lifted_lambda_res_52482 = redout_53166;\n                }\n                redout_tmp_56404 = lifted_lambda_res_52480;\n                redout_tmp_56405 = lifted_lambda_res_52481;\n                redout_tmp_56406 = lifted_lambda_res_52482;\n                redout_53165 = redout_tmp_56404;\n                redout_53166 = redout_tmp_56405;\n                redout_53167 = redout_tmp_56406;\n            }\n            x_52448 = redout_53165;\n            x_52449 = redout_53166;\n            x_52450 = redout_53167;\n            acc_52445 = x_52448;\n            acc_52446 = x_52449;\n            acc_52447 = x_52450;\n        } else {\n            acc_52445 = acc_52441;\n            acc_52446 = acc_52442;\n            acc_52447 = acc_52443;\n        }\n        mem_54131[(int64_t) 0] = acc_52445;\n        mem_54135[(int64_t) 0] = acc_52446;\n        mem_54139[(int64_t) 0] = acc_52447;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        for (int32_t i_6 = 0; i_6 < 1; i_6++)\n            mem_param_tmp_56398[i_6] = mem_54131[i_6];\n        for (int32_t i_7 = 0; i_7 < 1; i_7++)\n            mem_param_tmp_56399[i_7] = mem_54135[i_7];\n        for (int32_t i_8 = 0; i_8 < 1; i_8++)\n            mem_param_tmp_56400[i_8] = mem_54139[i_8];\n        for (int32_t i_9 = 0; i_9 < 1; i_9++)\n            mem_param_54119[i_9] = mem_param_tmp_56398[i_9];\n        for (int32_t i_10 = 0; i_10 < 1; i_10++)\n            mem_param_54120[i_10] = mem_param_tmp_56399[i_10];\n        for (int32_t i_11 = 0; i_11 < 1; i_11++)\n            mem_param_54121[i_11] = mem_param_tmp_56400[i_11];\n    }\n    for (int32_t i_12 = 0; i_12 < 1; i_12++)\n        ext_mem_54142[i_12] = mem_param_54119[i_12];\n    for (int32_t i_13 = 0; i_13 < 1; i_13++)\n       ", " ext_mem_54141[i_13] = mem_param_54120[i_13];\n    for (int32_t i_14 = 0; i_14 < 1; i_14++)\n        ext_mem_54140[i_14] = mem_param_54121[i_14];\n    barrier(CLK_LOCAL_MEM_FENCE);\n    if (cond_52519) {\n        for (int32_t i_15 = 0; i_15 < 1; i_15++)\n            ext_mem_54163[i_15] = ext_mem_54142[i_15];\n        for (int32_t i_16 = 0; i_16 < 1; i_16++)\n            ext_mem_54162[i_16] = ext_mem_54141[i_16];\n        for (int32_t i_17 = 0; i_17 < 1; i_17++)\n            ext_mem_54161[i_17] = ext_mem_54140[i_17];\n    } else {\n        int64_t ltid_flat_52521;\n        int64_t ltid_52520;\n        int64_t j_52536;\n        bool cond_52541;\n        int64_t pre1d_52542;\n        int64_t pre1d_52543;\n        int64_t pre1d_52544;\n        int64_t ltid_flat_52558;\n        int64_t ltid_52557;\n        int64_t gtid_52571;\n        int64_t acc_52574;\n        int64_t acc_52575;\n        int64_t acc_52576;\n        bool cond_52577;\n        int64_t acc_52578;\n        int64_t acc_52579;\n        int64_t acc_52580;\n        \n        ltid_flat_52521 = sext_i32_i64(local_tid_56389);\n        ltid_52520 = sext_i32_i64(sext_i64_i32(ltid_pre_56393));\n        j_52536 = ltid_52520 + binop_x_52535;\n        cond_52541 = slt64(j_52536, m_44319);\n        if (cond_52541) {\n            pre1d_52542 = j_52536;\n        } else {\n            pre1d_52542 = (int64_t) 0;\n        }\n        if (cond_52541) {\n            int64_t tile_elem_52546;\n            int64_t tile_elem_52547;\n            \n            tile_elem_52546 = ((__global int64_t *) mem_54096)[j_52536];\n            tile_elem_52547 = ((__global int64_t *) mem_54094)[j_52536];\n            pre1d_52543 = tile_elem_52546;\n            pre1d_52544 = tile_elem_52547;\n        } else {\n            pre1d_52543 = (int64_t) 0;\n            pre1d_52544 = (int64_t) 0;\n        }\n        ((__local int64_t *) color_54534)[ltid_52520] = pre1d_52542;\n        ((__local int64_t *) color_54533)[ltid_52520] = pre1d_52543;\n        ((__local int64_t *) color_54532)[ltid_52520] = pre1d_5", "2544;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        ltid_flat_52558 = sext_i32_i64(local_tid_56389);\n        ltid_52557 = sext_i32_i64(sext_i64_i32(ltid_pre_56393));\n        gtid_52571 = binop_x_52275 + ltid_52557;\n        acc_52574 = ext_mem_54142[(int64_t) 0];\n        acc_52575 = ext_mem_54141[(int64_t) 0];\n        acc_52576 = ext_mem_54140[(int64_t) 0];\n        cond_52577 = slt64(gtid_52571, m_44319);\n        if (cond_52577) {\n            int64_t lifted_lambda_res_52573;\n            int64_t x_52581;\n            int64_t x_52582;\n            int64_t x_52583;\n            int64_t redout_53169;\n            int64_t redout_53170;\n            int64_t redout_53171;\n            \n            lifted_lambda_res_52573 = mem_54106[(int64_t) 0];\n            redout_53169 = acc_52574;\n            redout_53170 = acc_52575;\n            redout_53171 = acc_52576;\n            for (int64_t i_53172 = 0; i_53172 < residual_input_52518; i_53172++) {\n                int64_t x_52584;\n                int64_t x_52585;\n                int64_t x_52586;\n                bool cond_52593;\n                bool cond_52594;\n                bool cond_f_res_52595;\n                bool y_52596;\n                bool cond_52597;\n                bool cond_52598;\n                bool cond_52599;\n                bool cond_t_res_52600;\n                bool cond_t_res_52601;\n                bool x_52602;\n                bool cond_52603;\n                bool cond_f_res_t_res_f_res_t_res_52604;\n                bool x_52605;\n                bool x_52606;\n                bool y_52607;\n                bool cond_f_res_t_res_52608;\n                bool x_52609;\n                bool x_52610;\n                bool y_52611;\n                bool cond_52612;\n                int64_t lifted_lambda_res_52613;\n                int64_t lifted_lambda_res_52614;\n                int64_t lifted_lambda_res_52615;\n                int64_t redout_tmp_56407;\n                int64_t redout_tmp_56408;\n                int64_t redout_tmp_56409",
                                    ";\n                \n                x_52584 = ((__local int64_t *) color_54534)[i_53172];\n                x_52585 = ((__local int64_t *) color_54533)[i_53172];\n                x_52586 = ((__local int64_t *) color_54532)[i_53172];\n                cond_52593 = redout_53171 == lifted_lambda_res_52573;\n                cond_52594 = !cond_52593;\n                cond_f_res_52595 = redout_53171 == redout_53170;\n                y_52596 = cond_52593 && cond_f_res_52595;\n                cond_52597 = cond_52594 || y_52596;\n                cond_52598 = x_52586 == lifted_lambda_res_52573;\n                cond_52599 = slt64(x_52585, redout_53170);\n                cond_t_res_52600 = x_52585 == x_52586;\n                cond_t_res_52601 = !cond_t_res_52600;\n                x_52602 = cond_52599 && cond_t_res_52601;\n                cond_52603 = x_52585 == redout_53170;\n                cond_f_res_t_res_f_res_t_res_52604 = slt64(x_52584, redout_53169);\n                x_52605 = cond_52603 && cond_f_res_t_res_f_res_t_res_52604;\n                x_52606 = !x_52602;\n                y_52607 = x_52605 && x_52606;\n                cond_f_res_t_res_52608 = x_52602 || y_52607;\n                x_52609 = cond_52598 && cond_f_res_t_res_52608;\n                x_52610 = !cond_52597;\n                y_52611 = x_52609 && x_52610;\n                cond_52612 = cond_52597 || y_52611;\n                if (cond_52612) {\n                    lifted_lambda_res_52613 = x_52584;\n                } else {\n                    lifted_lambda_res_52613 = redout_53169;\n                }\n                if (cond_52612) {\n                    lifted_lambda_res_52614 = x_52586;\n                } else {\n                    lifted_lambda_res_52614 = redout_53171;\n                }\n                if (cond_52612) {\n                    lifted_lambda_res_52615 = x_52585;\n                } else {\n                    lifted_lambda_res_52615 = redout_53170;\n                }\n                redout_tmp_56407 = lifted_lambda_res_52613;\n", "                redout_tmp_56408 = lifted_lambda_res_52614;\n                redout_tmp_56409 = lifted_lambda_res_52615;\n                redout_53169 = redout_tmp_56407;\n                redout_53170 = redout_tmp_56408;\n                redout_53171 = redout_tmp_56409;\n            }\n            x_52581 = redout_53169;\n            x_52582 = redout_53170;\n            x_52583 = redout_53171;\n            acc_52578 = x_52581;\n            acc_52579 = x_52582;\n            acc_52580 = x_52583;\n        } else {\n            acc_52578 = acc_52574;\n            acc_52579 = acc_52575;\n            acc_52580 = acc_52576;\n        }\n        mem_54152[(int64_t) 0] = acc_52578;\n        mem_54156[(int64_t) 0] = acc_52579;\n        mem_54160[(int64_t) 0] = acc_52580;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        for (int32_t i_18 = 0; i_18 < 1; i_18++)\n            ext_mem_54163[i_18] = mem_54152[i_18];\n        for (int32_t i_19 = 0; i_19 < 1; i_19++)\n            ext_mem_54162[i_19] = mem_54156[i_19];\n        for (int32_t i_20 = 0; i_20 < 1; i_20++)\n            ext_mem_54161[i_20] = mem_54160[i_20];\n    }\n    ltid_flat_52623 = sext_i32_i64(local_tid_56389);\n    ltid_52622 = sext_i32_i64(sext_i64_i32(ltid_pre_56393));\n    gtid_52629 = binop_x_52275 + ltid_52622;\n    cond_52633 = slt64(gtid_52629, m_44319);\n    if (cond_52633) {\n        int64_t defunc_0_f_res_52630;\n        int64_t defunc_0_f_res_52631;\n        int64_t defunc_0_f_res_52632;\n        bool cond_52637;\n        bool lifted_lambda_res_t_res_52638;\n        bool lifted_lambda_res_t_res_52639;\n        bool x_52640;\n        int64_t defunc_0_f_res_52641;\n        \n        defunc_0_f_res_52630 = ext_mem_54163[(int64_t) 0];\n        defunc_0_f_res_52631 = ext_mem_54162[(int64_t) 0];\n        defunc_0_f_res_52632 = ext_mem_54161[(int64_t) 0];\n        cond_52637 = gtid_52629 == defunc_0_f_res_52630;\n        lifted_lambda_res_t_res_52638 = defunc_0_f_res_52631 == defunc_0_f_res_52632;\n        lifted_lambda_res_t_res_52639 = !lifted_lambda_res_t_r", "es_52638;\n        x_52640 = cond_52637 && lifted_lambda_res_t_res_52639;\n        defunc_0_f_res_52641 = btoi_bool_i64(x_52640);\n        postlude_52634 = defunc_0_f_res_52641;\n    } else {\n        postlude_52634 = (int64_t) 0;\n    }\n    mem_54167[(int64_t) 0] = postlude_52634;\n    barrier(CLK_LOCAL_MEM_FENCE);\n    if (slt64(sext_i32_i64(local_tid_56389) + tile_sizze_52265 * sext_i32_i64(block_id_56390), m_44319)) {\n        int64_t tmp_56410 = mem_54167[(int64_t) 0];\n        \n        ((__global int64_t *) mem_54169)[sext_i32_i64(local_tid_56389) + tile_sizze_52265 * sext_i32_i64(block_id_56390)] = tmp_56410;\n    }\n    \n  error_9:\n    return;\n    #undef tile_sizze_52265\n    #undef bytes_54122\n}\nFUTHARK_KERNEL_SIZED(do_DBSCAN_doublezisegmap_intrablock_52645_dim1, 1, 1)\nvoid do_DBSCAN_doublezisegmap_intrablock_52645(__global int *global_failure, int8_t clBase_36809, int8_t clBase_36810, double clBase_36811, double clBase_36817, int64_t conc_tmp_43977, int64_t inf_44560, int64_t dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_44563, int64_t ldim_52648, int64_t num_whole_tiles_52692, int64_t residual_input_52930, unsigned char cond_52931_bits, int64_t binop_x_52947, __global unsigned char *current_partition_mem_53519, __global unsigned char *current_partition_mem_53520, __global unsigned char *mem_53556, __global unsigned char *ext_mem_54005, __global unsigned char *mem_54010, __global unsigned char *mem_54012)\n{\n    bool cond_52931 = cond_52931_bits;\n    \n    #define tile_sizze_52647 (do_DBSCAN_doublezisegmap_intrablock_52645zitile_sizze_52647)\n    #define bytes_54306 (do_DBSCAN_doublezisegmap_intrablock_52645zibytes_54306)\n    \n    volatile __local unsigned char *color_54540_backing_2 = &shared_mem[0];\n    const int64_t color_54540_backing_2_offset = 0 + (bytes_54306 + srem64((int64_t) 8 - srem64(bytes_54306, (int64_t) 8), (int64_t) 8));\n    volatile __local unsigned char *color_54539_backing_1 = &shared_mem[color_54540_backing_2_offset];\n    const int64_t color_54539_backing_1_offset",
                                    " = color_54540_backing_2_offset + (bytes_54306 + srem64((int64_t) 8 - srem64(bytes_54306, (int64_t) 8), (int64_t) 8));\n    volatile __local unsigned char *color_54538_backing_0 = &shared_mem[color_54539_backing_1_offset];\n    const int64_t color_54538_backing_0_offset = color_54539_backing_1_offset + (bytes_54306 + srem64((int64_t) 8 - srem64(bytes_54306, (int64_t) 8), (int64_t) 8));\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_56688;\n    int32_t tblock_sizze_56691;\n    int32_t wave_sizze_56690;\n    int32_t block_id_56689;\n    int32_t global_tid_56687;\n    int64_t gid_flat_52645;\n    int64_t slice_56693;\n    int64_t ltid_pre_56692;\n    int64_t remnant_56694;\n    int64_t slice_56695;\n    int64_t gid_52644;\n    int64_t remnant_56696;\n    __local unsigned char *color_54538;\n    __local unsigned char *color_54539;\n    __local unsigned char *color_54540;\n    int64_t binop_x_52663;\n    double mem_54279[1];\n    double mem_54283[1];\n    double mem_54287[1];\n    double mem_54291[1];\n    double mem_54295[1];\n    int64_t ltid_flat_52650;\n    int64_t ltid_52649;\n    int64_t gtid_52664;\n    bool cond_52665;\n    double pre_52666;\n    double pre_52667;\n    double pre_52668;\n    double pre_52669;\n    double pre_52670;\n    int64_t mem_54299[1];\n    double mem_54303[1];\n    int64_t ltid_flat_52694;\n    int64_t ltid_52693;\n    int64_t ext_mem_54321[1];\n    double ext_mem_54320[1];\n    int64_t mem_param_54304[1];\n    double mem_param_54305[1];\n    int64_t mem_54331[1];\n    int64_t ext_mem_54332[1];\n    \n    local_tid_56688 = get_local_id(0);\n    tblock_sizze_56691 = get_local_size(0);\n    wave_sizze_56690 = LOCKSTEP_WIDTH;\n    block_id_56689 = get_tblock_id(0);\n    global_tid_56687 = block_id_56689 * tblock_sizze_56691 + local_tid_56688;\n    gid_flat_52645 = sext_i32_i64(block_id_56689);\n    slice_56693 = tile_sizze_52647;\n    ltid_pre_56692 = sext_i32_i64(local_tid_56688);\n    remnant_56694 = sext_i32_i64(local_tid_56688) - ltid_pre_56692;\n    slice_56", "695 = ldim_52648;\n    gid_52644 = sext_i32_i64(block_id_56689);\n    remnant_56696 = sext_i32_i64(block_id_56689) - gid_52644;\n    color_54538 = (__local unsigned char *) color_54538_backing_0;\n    color_54539 = (__local unsigned char *) color_54539_backing_1;\n    color_54540 = (__local unsigned char *) color_54540_backing_2;\n    binop_x_52663 = gid_52644 * tile_sizze_52647;\n    ltid_flat_52650 = sext_i32_i64(local_tid_56688);\n    ltid_52649 = sext_i32_i64(sext_i64_i32(ltid_pre_56692));\n    gtid_52664 = ltid_52649 + binop_x_52663;\n    cond_52665 = slt64(gtid_52664, dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_44563);\n    if (cond_52665) {\n        int64_t slice_52671;\n        double eta_p_52672;\n        double eta_p_52674;\n        double zt_res_52675;\n        double zt_res_52676;\n        double zs_res_52677;\n        double zs_res_52678;\n        double d_haversine_res_52679;\n        double d_haversine_res_52680;\n        double cos_res_52681;\n        \n        slice_52671 = inf_44560 + gtid_52664;\n        eta_p_52672 = ((__global double *) current_partition_mem_53519)[slice_52671];\n        eta_p_52674 = ((__global double *) current_partition_mem_53520)[slice_52671];\n        zt_res_52675 = 3.141592653589793 * eta_p_52672;\n        zt_res_52676 = 3.141592653589793 * eta_p_52674;\n        zs_res_52677 = zt_res_52675 / 180.0;\n        zs_res_52678 = zt_res_52676 / 180.0;\n        if (clBase_36809 == (int8_t) 1) {\n            d_haversine_res_52679 = eta_p_52672;\n        } else {\n            d_haversine_res_52679 = zs_res_52677;\n        }\n        if (clBase_36809 == (int8_t) 1) {\n            d_haversine_res_52680 = eta_p_52674;\n        } else {\n            d_haversine_res_52680 = zs_res_52678;\n        }\n        cos_res_52681 = futrts_cos64(d_haversine_res_52679);\n        pre_52666 = eta_p_52672;\n        pre_52667 = eta_p_52674;\n        pre_52668 = d_haversine_res_52679;\n        pre_52669 = d_haversine_res_52680;\n        pre_52670 = cos_res_52681;\n    } else {\n        pre_52666 = 0.0;\n       ", " pre_52667 = 0.0;\n        pre_52668 = 0.0;\n        pre_52669 = 0.0;\n        pre_52670 = 0.0;\n    }\n    mem_54279[(int64_t) 0] = pre_52666;\n    mem_54283[(int64_t) 0] = pre_52667;\n    mem_54287[(int64_t) 0] = pre_52668;\n    mem_54291[(int64_t) 0] = pre_52669;\n    mem_54295[(int64_t) 0] = pre_52670;\n    barrier(CLK_LOCAL_MEM_FENCE);\n    ltid_flat_52694 = sext_i32_i64(local_tid_56688);\n    ltid_52693 = sext_i32_i64(sext_i64_i32(ltid_pre_56692));\n    mem_54299[(int64_t) 0] = (int64_t) -1;\n    mem_54303[(int64_t) 0] = INFINITY;\n    barrier(CLK_LOCAL_MEM_FENCE);\n    barrier(CLK_LOCAL_MEM_FENCE);\n    for (int32_t i_3 = 0; i_3 < 1; i_3++)\n        mem_param_54304[i_3] = mem_54299[i_3];\n    for (int32_t i_4 = 0; i_4 < 1; i_4++)\n        mem_param_54305[i_4] = mem_54303[i_4];\n    for (int64_t tile_id_52702 = 0; tile_id_52702 < num_whole_tiles_52692; tile_id_52702++) {\n        int64_t binop_x_52811;\n        int64_t ltid_flat_52810;\n        int64_t ltid_52809;\n        int64_t j_52812;\n        bool cond_52820;\n        double pre1d_52821;\n        double pre1d_52822;\n        int64_t pre1d_52823;\n        int64_t mem_54315[1];\n        double mem_54319[1];\n        int64_t ltid_flat_52833;\n        int64_t ltid_52832;\n        int64_t gtid_52835;\n        int64_t acc_52841;\n        double acc_52842;\n        bool cond_52843;\n        int64_t acc_52844;\n        double acc_52845;\n        int64_t mem_param_tmp_56697[1];\n        double mem_param_tmp_56698[1];\n        \n        binop_x_52811 = tile_sizze_52647 * tile_id_52702;\n        ltid_flat_52810 = sext_i32_i64(local_tid_56688);\n        ltid_52809 = sext_i32_i64(sext_i64_i32(ltid_pre_56692));\n        j_52812 = ltid_52809 + binop_x_52811;\n        cond_52820 = slt64(j_52812, conc_tmp_43977);\n        if (cond_52820) {\n            double tile_elem_52824;\n            double tile_elem_52825;\n            int64_t tile_elem_52826;\n            \n            tile_elem_52824 = ((__global double *) mem_54010)[j_52812];\n            tile_elem_52825 = ((__glob",
                                    "al double *) mem_54012)[j_52812];\n            tile_elem_52826 = ((__global int64_t *) ext_mem_54005)[j_52812];\n            pre1d_52821 = tile_elem_52824;\n            pre1d_52822 = tile_elem_52825;\n            pre1d_52823 = tile_elem_52826;\n        } else {\n            pre1d_52821 = 0.0;\n            pre1d_52822 = 0.0;\n            pre1d_52823 = (int64_t) 0;\n        }\n        ((__local double *) color_54540)[ltid_52809] = pre1d_52821;\n        ((__local double *) color_54539)[ltid_52809] = pre1d_52822;\n        ((__local int64_t *) color_54538)[ltid_52809] = pre1d_52823;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        ltid_flat_52833 = sext_i32_i64(local_tid_56688);\n        ltid_52832 = sext_i32_i64(sext_i64_i32(ltid_pre_56692));\n        gtid_52835 = binop_x_52663 + ltid_52832;\n        acc_52841 = mem_param_54304[(int64_t) 0];\n        acc_52842 = mem_param_54305[(int64_t) 0];\n        cond_52843 = slt64(gtid_52835, dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_44563);\n        if (cond_52843) {\n            double eta_p_52836;\n            double eta_p_52837;\n            double d_haversine_res_52838;\n            double d_haversine_res_52839;\n            double cos_res_52840;\n            int64_t x_52846;\n            double x_52847;\n            int64_t redout_53173;\n            double redout_53174;\n            \n            eta_p_52836 = mem_54279[(int64_t) 0];\n            eta_p_52837 = mem_54283[(int64_t) 0];\n            d_haversine_res_52838 = mem_54287[(int64_t) 0];\n            d_haversine_res_52839 = mem_54291[(int64_t) 0];\n            cos_res_52840 = mem_54295[(int64_t) 0];\n            redout_53173 = acc_52841;\n            redout_53174 = acc_52842;\n            for (int64_t i_53175 = 0; i_53175 < tile_sizze_52647; i_53175++) {\n                double eta_p_52848;\n                double eta_p_52849;\n                double dist_res_52851;\n                bool zg_res_52880;\n                bool zg_res_52881;\n                bool x_52882;\n                int64_t lifted_lambda_res_52883;\n     ", "           double lifted_lambda_res_52884;\n                int64_t redout_tmp_56701;\n                double redout_tmp_56702;\n                \n                eta_p_52848 = ((__local double *) color_54540)[i_53175];\n                eta_p_52849 = ((__local double *) color_54539)[i_53175];\n                if (clBase_36810 == (int8_t) 0) {\n                    double zm_res_52852;\n                    double zm_res_52853;\n                    double hypot_res_52854;\n                    \n                    zm_res_52852 = eta_p_52837 - eta_p_52849;\n                    zm_res_52853 = eta_p_52836 - eta_p_52848;\n                    hypot_res_52854 = futrts_hypot64(zm_res_52853, zm_res_52852);\n                    dist_res_52851 = hypot_res_52854;\n                } else {\n                    double d_haversine_res_52855;\n                    double d_haversine_res_52856;\n                    double zm_res_52861;\n                    double cos_res_52862;\n                    double zm_res_52863;\n                    double cos_res_52864;\n                    double zt_res_52865;\n                    double zm_res_52866;\n                    double zm_res_52867;\n                    double zt_res_52868;\n                    double zp_res_52869;\n                    double zs_res_52870;\n                    double min_res_52871;\n                    double zt_res_52872;\n                    double zm_res_52873;\n                    double acos_res_52874;\n                    double zt_res_52875;\n                    \n                    if (clBase_36809 == (int8_t) 1) {\n                        d_haversine_res_52855 = eta_p_52848;\n                        d_haversine_res_52856 = eta_p_52849;\n                    } else {\n                        double zt_res_52857;\n                        double zs_res_52858;\n                        double zt_res_52859;\n                        double zs_res_52860;\n                        \n                        zt_res_52857 = 3.141592653589793 * eta_p_52848;\n      ", "                  zs_res_52858 = zt_res_52857 / 180.0;\n                        zt_res_52859 = 3.141592653589793 * eta_p_52849;\n                        zs_res_52860 = zt_res_52859 / 180.0;\n                        d_haversine_res_52855 = zs_res_52858;\n                        d_haversine_res_52856 = zs_res_52860;\n                    }\n                    zm_res_52861 = d_haversine_res_52838 - d_haversine_res_52855;\n                    cos_res_52862 = futrts_cos64(zm_res_52861);\n                    zm_res_52863 = 1.0 - cos_res_52862;\n                    cos_res_52864 = futrts_cos64(d_haversine_res_52855);\n                    zt_res_52865 = cos_res_52840 * cos_res_52864;\n                    zm_res_52866 = d_haversine_res_52839 - d_haversine_res_52856;\n                    zm_res_52867 = 1.0 - zm_res_52866;\n                    zt_res_52868 = zt_res_52865 * zm_res_52867;\n                    zp_res_52869 = zm_res_52863 + zt_res_52868;\n                    zs_res_52870 = zp_res_52869 / 2.0;\n                    min_res_52871 = fmin64(1.0, zs_res_52870);\n                    zt_res_52872 = 2.0 * min_res_52871;\n                    zm_res_52873 = 1.0 - zt_res_52872;\n                    acos_res_52874 = futrts_acos64(zm_res_52873);\n                    zt_res_52875 = clBase_36817 * acos_res_52874;\n                    dist_res_52851 = zt_res_52875;\n                }\n                zg_res_52880 = clBase_36811 < redout_53174;\n                zg_res_52881 = clBase_36811 < dist_res_52851;\n                x_52882 = zg_res_52880 && zg_res_52881;\n                if (x_52882) {\n                    lifted_lambda_res_52883 = (int64_t) -1;\n                    lifted_lambda_res_52884 = INFINITY;\n                } else {\n                    bool zl_res_52885;\n                    int64_t lifted_lambda_res_f_res_52886;\n                    double lifted_lambda_res_f_res_52887;\n                    \n                    zl_res_52885 = redout_53174 < dist_res_52851;\n                    if (zl_res_52885)",
                                    " {\n                        lifted_lambda_res_f_res_52886 = redout_53173;\n                    } else {\n                        int64_t x_52850 = ((__local int64_t *) color_54538)[i_53175];\n                        \n                        lifted_lambda_res_f_res_52886 = x_52850;\n                    }\n                    if (zl_res_52885) {\n                        lifted_lambda_res_f_res_52887 = redout_53174;\n                    } else {\n                        lifted_lambda_res_f_res_52887 = dist_res_52851;\n                    }\n                    lifted_lambda_res_52883 = lifted_lambda_res_f_res_52886;\n                    lifted_lambda_res_52884 = lifted_lambda_res_f_res_52887;\n                }\n                redout_tmp_56701 = lifted_lambda_res_52883;\n                redout_tmp_56702 = lifted_lambda_res_52884;\n                redout_53173 = redout_tmp_56701;\n                redout_53174 = redout_tmp_56702;\n            }\n            x_52846 = redout_53173;\n            x_52847 = redout_53174;\n            acc_52844 = x_52846;\n            acc_52845 = x_52847;\n        } else {\n            acc_52844 = acc_52841;\n            acc_52845 = acc_52842;\n        }\n        mem_54315[(int64_t) 0] = acc_52844;\n        mem_54319[(int64_t) 0] = acc_52845;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        for (int32_t i_5 = 0; i_5 < 1; i_5++)\n            mem_param_tmp_56697[i_5] = mem_54315[i_5];\n        for (int32_t i_6 = 0; i_6 < 1; i_6++)\n            mem_param_tmp_56698[i_6] = mem_54319[i_6];\n        for (int32_t i_7 = 0; i_7 < 1; i_7++)\n            mem_param_54304[i_7] = mem_param_tmp_56697[i_7];\n        for (int32_t i_8 = 0; i_8 < 1; i_8++)\n            mem_param_54305[i_8] = mem_param_tmp_56698[i_8];\n    }\n    for (int32_t i_9 = 0; i_9 < 1; i_9++)\n        ext_mem_54321[i_9] = mem_param_54304[i_9];\n    for (int32_t i_10 = 0; i_10 < 1; i_10++)\n        ext_mem_54320[i_10] = mem_param_54305[i_10];\n    barrier(CLK_LOCAL_MEM_FENCE);\n    if (cond_52931) {\n        for (int32_t i_11 = 0; i_", "11 < 1; i_11++)\n            ext_mem_54332[i_11] = ext_mem_54321[i_11];\n    } else {\n        int64_t ltid_flat_52933;\n        int64_t ltid_52932;\n        int64_t j_52948;\n        bool cond_52956;\n        double pre1d_52957;\n        double pre1d_52958;\n        int64_t pre1d_52959;\n        int64_t ltid_flat_52973;\n        int64_t ltid_52972;\n        int64_t gtid_52983;\n        int64_t acc_52989;\n        bool cond_52991;\n        int64_t acc_52992;\n        \n        ltid_flat_52933 = sext_i32_i64(local_tid_56688);\n        ltid_52932 = sext_i32_i64(sext_i64_i32(ltid_pre_56692));\n        j_52948 = ltid_52932 + binop_x_52947;\n        cond_52956 = slt64(j_52948, conc_tmp_43977);\n        if (cond_52956) {\n            double tile_elem_52960;\n            double tile_elem_52961;\n            int64_t tile_elem_52962;\n            \n            tile_elem_52960 = ((__global double *) mem_54010)[j_52948];\n            tile_elem_52961 = ((__global double *) mem_54012)[j_52948];\n            tile_elem_52962 = ((__global int64_t *) ext_mem_54005)[j_52948];\n            pre1d_52957 = tile_elem_52960;\n            pre1d_52958 = tile_elem_52961;\n            pre1d_52959 = tile_elem_52962;\n        } else {\n            pre1d_52957 = 0.0;\n            pre1d_52958 = 0.0;\n            pre1d_52959 = (int64_t) 0;\n        }\n        ((__local double *) color_54540)[ltid_52932] = pre1d_52957;\n        ((__local double *) color_54539)[ltid_52932] = pre1d_52958;\n        ((__local int64_t *) color_54538)[ltid_52932] = pre1d_52959;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        ltid_flat_52973 = sext_i32_i64(local_tid_56688);\n        ltid_52972 = sext_i32_i64(sext_i64_i32(ltid_pre_56692));\n        gtid_52983 = binop_x_52663 + ltid_52972;\n        acc_52989 = ext_mem_54321[(int64_t) 0];\n        cond_52991 = slt64(gtid_52983, dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_44563);\n        if (cond_52991) {\n            double eta_p_52984;\n            double eta_p_52985;\n            double d_haversine_res_52986;\n            double d_", "haversine_res_52987;\n            double cos_res_52988;\n            double acc_52990;\n            int64_t x_52994;\n            double x_52995;\n            int64_t redout_53176;\n            double redout_53177;\n            \n            eta_p_52984 = mem_54279[(int64_t) 0];\n            eta_p_52985 = mem_54283[(int64_t) 0];\n            d_haversine_res_52986 = mem_54287[(int64_t) 0];\n            d_haversine_res_52987 = mem_54291[(int64_t) 0];\n            cos_res_52988 = mem_54295[(int64_t) 0];\n            acc_52990 = ext_mem_54320[(int64_t) 0];\n            redout_53176 = acc_52989;\n            redout_53177 = acc_52990;\n            for (int64_t i_53178 = 0; i_53178 < residual_input_52930; i_53178++) {\n                double eta_p_52996;\n                double eta_p_52997;\n                double dist_res_52999;\n                bool zg_res_53028;\n                bool zg_res_53029;\n                bool x_53030;\n                int64_t lifted_lambda_res_53031;\n                double lifted_lambda_res_53032;\n                int64_t redout_tmp_56703;\n                double redout_tmp_56704;\n                \n                eta_p_52996 = ((__local double *) color_54540)[i_53178];\n                eta_p_52997 = ((__local double *) color_54539)[i_53178];\n                if (clBase_36810 == (int8_t) 0) {\n                    double zm_res_53000;\n                    double zm_res_53001;\n                    double hypot_res_53002;\n                    \n                    zm_res_53000 = eta_p_52985 - eta_p_52997;\n                    zm_res_53001 = eta_p_52984 - eta_p_52996;\n                    hypot_res_53002 = futrts_hypot64(zm_res_53001, zm_res_53000);\n                    dist_res_52999 = hypot_res_53002;\n                } else {\n                    double d_haversine_res_53003;\n                    double d_haversine_res_53004;\n                    double zm_res_53009;\n                    double cos_res_53010;\n                    double zm_res_53011;\n                    double cos_res_",
                                    "53012;\n                    double zt_res_53013;\n                    double zm_res_53014;\n                    double zm_res_53015;\n                    double zt_res_53016;\n                    double zp_res_53017;\n                    double zs_res_53018;\n                    double min_res_53019;\n                    double zt_res_53020;\n                    double zm_res_53021;\n                    double acos_res_53022;\n                    double zt_res_53023;\n                    \n                    if (clBase_36809 == (int8_t) 1) {\n                        d_haversine_res_53003 = eta_p_52996;\n                        d_haversine_res_53004 = eta_p_52997;\n                    } else {\n                        double zt_res_53005;\n                        double zs_res_53006;\n                        double zt_res_53007;\n                        double zs_res_53008;\n                        \n                        zt_res_53005 = 3.141592653589793 * eta_p_52996;\n                        zs_res_53006 = zt_res_53005 / 180.0;\n                        zt_res_53007 = 3.141592653589793 * eta_p_52997;\n                        zs_res_53008 = zt_res_53007 / 180.0;\n                        d_haversine_res_53003 = zs_res_53006;\n                        d_haversine_res_53004 = zs_res_53008;\n                    }\n                    zm_res_53009 = d_haversine_res_52986 - d_haversine_res_53003;\n                    cos_res_53010 = futrts_cos64(zm_res_53009);\n                    zm_res_53011 = 1.0 - cos_res_53010;\n                    cos_res_53012 = futrts_cos64(d_haversine_res_53003);\n                    zt_res_53013 = cos_res_52988 * cos_res_53012;\n                    zm_res_53014 = d_haversine_res_52987 - d_haversine_res_53004;\n                    zm_res_53015 = 1.0 - zm_res_53014;\n                    zt_res_53016 = zt_res_53013 * zm_res_53015;\n                    zp_res_53017 = zm_res_53011 + zt_res_53016;\n                    zs_res_53018 = zp_res_53017 / 2.0;\n                    min_res_53019 =", " fmin64(1.0, zs_res_53018);\n                    zt_res_53020 = 2.0 * min_res_53019;\n                    zm_res_53021 = 1.0 - zt_res_53020;\n                    acos_res_53022 = futrts_acos64(zm_res_53021);\n                    zt_res_53023 = clBase_36817 * acos_res_53022;\n                    dist_res_52999 = zt_res_53023;\n                }\n                zg_res_53028 = clBase_36811 < redout_53177;\n                zg_res_53029 = clBase_36811 < dist_res_52999;\n                x_53030 = zg_res_53028 && zg_res_53029;\n                if (x_53030) {\n                    lifted_lambda_res_53031 = (int64_t) -1;\n                    lifted_lambda_res_53032 = INFINITY;\n                } else {\n                    bool zl_res_53033;\n                    int64_t lifted_lambda_res_f_res_53034;\n                    double lifted_lambda_res_f_res_53035;\n                    \n                    zl_res_53033 = redout_53177 < dist_res_52999;\n                    if (zl_res_53033) {\n                        lifted_lambda_res_f_res_53034 = redout_53176;\n                    } else {\n                        int64_t x_52998 = ((__local int64_t *) color_54538)[i_53178];\n                        \n                        lifted_lambda_res_f_res_53034 = x_52998;\n                    }\n                    if (zl_res_53033) {\n                        lifted_lambda_res_f_res_53035 = redout_53177;\n                    } else {\n                        lifted_lambda_res_f_res_53035 = dist_res_52999;\n                    }\n                    lifted_lambda_res_53031 = lifted_lambda_res_f_res_53034;\n                    lifted_lambda_res_53032 = lifted_lambda_res_f_res_53035;\n                }\n                redout_tmp_56703 = lifted_lambda_res_53031;\n                redout_tmp_56704 = lifted_lambda_res_53032;\n                redout_53176 = redout_tmp_56703;\n                redout_53177 = redout_tmp_56704;\n            }\n            x_52994 = redout_53176;\n            x_52995 = redout_53177;\n            acc_52992", " = x_52994;\n        } else {\n            acc_52992 = acc_52989;\n        }\n        mem_54331[(int64_t) 0] = acc_52992;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        for (int32_t i_12 = 0; i_12 < 1; i_12++)\n            ext_mem_54332[i_12] = mem_54331[i_12];\n    }\n    if (slt64(sext_i32_i64(local_tid_56688) + tile_sizze_52647 * sext_i32_i64(block_id_56689), dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_44563)) {\n        int64_t tmp_56705 = ext_mem_54332[(int64_t) 0];\n        \n        ((__global int64_t *) mem_53556)[inf_44560 + (sext_i32_i64(local_tid_56688) + tile_sizze_52647 * sext_i32_i64(block_id_56689))] = tmp_56705;\n    }\n    \n  error_8:\n    return;\n    #undef tile_sizze_52647\n    #undef bytes_54306\n}\nFUTHARK_KERNEL_SIZED(do_DBSCAN_doublezisegred_large_47267_dim1, 1, 1)\nvoid do_DBSCAN_doublezisegred_large_47267(__global int *global_failure, int8_t clBase_36809, int8_t clBase_36810, double clBase_36811, double clBase_36817, int64_t m_43906, int64_t conc_tmp_43977, int64_t inf_44008, int64_t j_m_i_44011, int64_t num_tblocks_47262, unsigned char x_53498_bits, int64_t blocks_per_segment_55489, int64_t q_55490, int64_t num_virtblocks_55491, int64_t threads_per_segment_55492, __global unsigned char *mem_53612, __global unsigned char *mem_53614, __global unsigned char *mem_53630, __global unsigned char *mem_53632, __global unsigned char *mem_param_53652, __global unsigned char *mem_53655, __global unsigned char *mem_53657, __global unsigned char *mem_53659, __global unsigned char *mem_53662, __global unsigned char *segred_tmp_mem_55493, __global unsigned char *counters_mem_55495)\n{\n    bool x_53498 = x_53498_bits;\n    \n    #define segred_tblock_sizze_47261 (do_DBSCAN_doublezisegred_large_47267zisegred_tblock_sizze_47261)\n    #define chunk_sizze_55460 (do_DBSCAN_doublezisegred_large_47267zichunk_sizze_55460)\n    \n    volatile __local unsigned char *sync_arr_mem_55504_backing_1 = &shared_mem[0];\n    const int64_t sync_arr_mem_55504_backing_1_offset = 0 + 8;\n    volatile __local unsig",
                                    "ned char *red_arr_i64_mem_55502_backing_0 = &shared_mem[sync_arr_mem_55504_backing_1_offset];\n    const int64_t red_arr_i64_mem_55502_backing_0_offset = sync_arr_mem_55504_backing_1_offset + ((int64_t) 8 * segred_tblock_sizze_47261 + srem64((int64_t) 8 - srem64((int64_t) 8 * segred_tblock_sizze_47261, (int64_t) 8), (int64_t) 8));\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_55498;\n    int32_t tblock_sizze_55501;\n    int32_t wave_sizze_55500;\n    int32_t block_id_55499;\n    int32_t global_tid_55497;\n    int64_t phys_tid_47267;\n    __local unsigned char *red_arr_i64_mem_55502;\n    __local unsigned char *sync_arr_mem_55504;\n    int32_t phys_tblock_id_55506;\n    int32_t iterations_55507;\n    \n    local_tid_55498 = get_local_id(0);\n    tblock_sizze_55501 = get_local_size(0);\n    wave_sizze_55500 = LOCKSTEP_WIDTH;\n    block_id_55499 = get_tblock_id(0);\n    global_tid_55497 = block_id_55499 * tblock_sizze_55501 + local_tid_55498;\n    phys_tid_47267 = sext_i32_i64(global_tid_55497);\n    red_arr_i64_mem_55502 = (__local unsigned char *) red_arr_i64_mem_55502_backing_0;\n    sync_arr_mem_55504 = (__local unsigned char *) sync_arr_mem_55504_backing_1;\n    phys_tblock_id_55506 = get_tblock_id(0);\n    iterations_55507 = sdiv_up32(sext_i64_i32(num_virtblocks_55491) - phys_tblock_id_55506, sext_i64_i32(num_tblocks_47262));\n    for (int32_t i_55508 = 0; i_55508 < iterations_55507; i_55508++) {\n        int32_t virt_tblock_id_55509;\n        int64_t flat_segment_id_55510;\n        int64_t global_tid_55511;\n        int64_t slice_55512;\n        int64_t gtid_47265;\n        int64_t remnant_55513;\n        int64_t gtid_47266;\n        int64_t eta_p_block_res_acc_55514;\n        int64_t eta_p_47268;\n        int64_t eta_p_47269;\n        int64_t tblock_id_in_segment_55518;\n        int64_t block_base_offset_55519;\n        int32_t offset_55522;\n        int32_t skip_waves_55523;\n        int64_t eta_p_55515;\n        int64_t eta_p_55516;\n        \n        virt_tblock_id_", "55509 = phys_tblock_id_55506 + i_55508 * sext_i64_i32(num_tblocks_47262);\n        flat_segment_id_55510 = squot64(sext_i32_i64(virt_tblock_id_55509), blocks_per_segment_55489);\n        global_tid_55511 = srem64(sext_i32_i64(virt_tblock_id_55509) * segred_tblock_sizze_47261 + sext_i32_i64(local_tid_55498), threads_per_segment_55492);\n        slice_55512 = j_m_i_44011;\n        gtid_47265 = flat_segment_id_55510;\n        remnant_55513 = flat_segment_id_55510 - gtid_47265;\n        // ne-initialise the outer (per-block) accumulator(s)\n        {\n            eta_p_block_res_acc_55514 = (int64_t) 9223372036854775807;\n        }\n        tblock_id_in_segment_55518 = squot64(global_tid_55511, segred_tblock_sizze_47261);\n        block_base_offset_55519 = tblock_id_in_segment_55518 * q_55490 * segred_tblock_sizze_47261;\n        for (int64_t i_55520 = 0; i_55520 < q_55490; i_55520++) {\n            int64_t block_offset_55521 = block_base_offset_55519 + i_55520 * segred_tblock_sizze_47261;\n            \n            gtid_47266 = global_tid_55511 + threads_per_segment_55492 * i_55520;\n            if (slt64(gtid_47266, conc_tmp_43977)) {\n                // apply map function(s)\n                {\n                    // apply map function\n                    {\n                        int64_t slice_49791 = inf_44008 + gtid_47265;\n                        bool index_concat_cmp_49786 = sle64(m_43906, slice_49791);\n                        double index_concat_branch_49790;\n                        \n                        if (index_concat_cmp_49786) {\n                            int64_t index_concat_i_49787 = sub64(slice_49791, m_43906);\n                            double index_concat_49788 = ((__global double *) mem_53632)[index_concat_i_49787];\n                            \n                            index_concat_branch_49790 = index_concat_49788;\n                        } else {\n                            double index_concat_49789 = ((__global double *) mem_53614)[slice_49791];\n             ", "               \n                            index_concat_branch_49790 = index_concat_49789;\n                        }\n                        \n                        double index_concat_branch_49783;\n                        \n                        if (index_concat_cmp_49786) {\n                            int64_t index_concat_i_49780 = sub64(slice_49791, m_43906);\n                            double index_concat_49781 = ((__global double *) mem_53630)[index_concat_i_49780];\n                            \n                            index_concat_branch_49783 = index_concat_49781;\n                        } else {\n                            double index_concat_49782 = ((__global double *) mem_53612)[slice_49791];\n                            \n                            index_concat_branch_49783 = index_concat_49782;\n                        }\n                        \n                        bool index_concat_cmp_49772 = sle64(m_43906, gtid_47266);\n                        double index_concat_branch_49776;\n                        \n                        if (index_concat_cmp_49772) {\n                            int64_t index_concat_i_49773 = sub64(gtid_47266, m_43906);\n                            double index_concat_49774 = ((__global double *) mem_53632)[index_concat_i_49773];\n                            \n                            index_concat_branch_49776 = index_concat_49774;\n                        } else {\n                            double index_concat_49775 = ((__global double *) mem_53614)[gtid_47266];\n                            \n                            index_concat_branch_49776 = index_concat_49775;\n                        }\n                        \n                        double index_concat_branch_49770;\n                        \n                        if (index_concat_cmp_49772) {\n                            int64_t index_concat_i_49767 = sub64(gtid_47266, m_43906);\n                            double index_concat_49768 = ((__global double *) mem_53630)[i",
                                    "ndex_concat_i_49767];\n                            \n                            index_concat_branch_49770 = index_concat_49768;\n                        } else {\n                            double index_concat_49769 = ((__global double *) mem_53612)[gtid_47266];\n                            \n                            index_concat_branch_49770 = index_concat_49769;\n                        }\n                        \n                        double d_haversine_res_47274;\n                        \n                        if (x_53498) {\n                            double x_53500 = ((__global double *) mem_53655)[gtid_47265];\n                            \n                            d_haversine_res_47274 = x_53500;\n                        } else {\n                            d_haversine_res_47274 = 0.0;\n                        }\n                        \n                        double d_haversine_res_47275;\n                        \n                        if (x_53498) {\n                            double x_53502 = ((__global double *) mem_53657)[gtid_47265];\n                            \n                            d_haversine_res_47275 = x_53502;\n                        } else {\n                            d_haversine_res_47275 = 0.0;\n                        }\n                        \n                        double cos_res_47276;\n                        \n                        if (x_53498) {\n                            double x_53504 = ((__global double *) mem_53659)[gtid_47265];\n                            \n                            cos_res_47276 = x_53504;\n                        } else {\n                            cos_res_47276 = 0.0;\n                        }\n                        \n                        double dist_res_47280;\n                        \n                        if (clBase_36810 == (int8_t) 0) {\n                            double zm_res_47281 = index_concat_branch_49783 - index_concat_branch_49770;\n                            double zm_res_47282 = index", "_concat_branch_49790 - index_concat_branch_49776;\n                            double hypot_res_47283 = futrts_hypot64(zm_res_47282, zm_res_47281);\n                            \n                            dist_res_47280 = hypot_res_47283;\n                        } else {\n                            double d_haversine_res_47284;\n                            double d_haversine_res_47285;\n                            \n                            if (clBase_36809 == (int8_t) 1) {\n                                d_haversine_res_47284 = index_concat_branch_49776;\n                                d_haversine_res_47285 = index_concat_branch_49770;\n                            } else {\n                                double zt_res_47286 = 3.141592653589793 * index_concat_branch_49776;\n                                double zs_res_47287 = zt_res_47286 / 180.0;\n                                double zt_res_47288 = 3.141592653589793 * index_concat_branch_49770;\n                                double zs_res_47289 = zt_res_47288 / 180.0;\n                                \n                                d_haversine_res_47284 = zs_res_47287;\n                                d_haversine_res_47285 = zs_res_47289;\n                            }\n                            \n                            double zm_res_47290 = d_haversine_res_47274 - d_haversine_res_47284;\n                            double cos_res_47291 = futrts_cos64(zm_res_47290);\n                            double zm_res_47292 = 1.0 - cos_res_47291;\n                            double cos_res_47293 = futrts_cos64(d_haversine_res_47284);\n                            double zt_res_47294 = cos_res_47276 * cos_res_47293;\n                            double zm_res_47295 = d_haversine_res_47275 - d_haversine_res_47285;\n                            double zm_res_47296 = 1.0 - zm_res_47295;\n                            double zt_res_47297 = zt_res_47294 * zm_res_47296;\n                            double zp_res_47298 = zm_res_47292 + zt_res", "_47297;\n                            double zs_res_47299 = zp_res_47298 / 2.0;\n                            double min_res_47300 = fmin64(1.0, zs_res_47299);\n                            double zt_res_47301 = 2.0 * min_res_47300;\n                            double zm_res_47302 = 1.0 - zt_res_47301;\n                            double acos_res_47303 = futrts_acos64(zm_res_47302);\n                            double zt_res_47304 = clBase_36817 * acos_res_47303;\n                            \n                            dist_res_47280 = zt_res_47304;\n                        }\n                        \n                        bool zlze_res_47305 = dist_res_47280 <= clBase_36811;\n                        int64_t lifted_lambda_res_47306;\n                        \n                        if (zlze_res_47305) {\n                            int64_t eta_p_47279 = ((__global int64_t *) mem_param_53652)[gtid_47266];\n                            \n                            lifted_lambda_res_47306 = eta_p_47279;\n                        } else {\n                            int64_t eta_p_47271 = ((__global int64_t *) mem_param_53652)[slice_49791];\n                            \n                            lifted_lambda_res_47306 = eta_p_47271;\n                        }\n                        // load accumulator(s)\n                        {\n                            eta_p_47268 = eta_p_block_res_acc_55514;\n                        }\n                        // load next value(s)\n                        {\n                            eta_p_47269 = lifted_lambda_res_47306;\n                        }\n                        // apply reduction operator(s)\n                        {\n                            int64_t min_res_47270 = smin64(eta_p_47268, eta_p_47269);\n                            \n                            // store in accumulator(s)\n                            {\n                                eta_p_block_res_acc_55514 = min_res_47270;\n                            }\n                     ",
                                    "   }\n                    }\n                }\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        // store accs. prims go in lmem; non-prims in params (in global mem)\n        {\n            ((__local int64_t *) red_arr_i64_mem_55502)[sext_i32_i64(local_tid_55498)] = eta_p_block_res_acc_55514;\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        skip_waves_55523 = 1;\n        offset_55522 = 0;\n        // participating threads read initial accumulator\n        {\n            if (slt32(local_tid_55498, sext_i64_i32(segred_tblock_sizze_47261))) {\n                eta_p_55515 = ((__local int64_t *) red_arr_i64_mem_55502)[sext_i32_i64(local_tid_55498 + offset_55522)];\n            }\n        }\n        offset_55522 = 1;\n        while (slt32(offset_55522, wave_sizze_55500)) {\n            if (slt32(local_tid_55498 + offset_55522, sext_i64_i32(segred_tblock_sizze_47261)) && ((local_tid_55498 - squot32(local_tid_55498, wave_sizze_55500) * wave_sizze_55500) & (2 * offset_55522 - 1)) == 0) {\n                // read array element\n                {\n                    eta_p_55516 = ((volatile __local int64_t *) red_arr_i64_mem_55502)[sext_i32_i64(local_tid_55498 + offset_55522)];\n                }\n                // apply reduction operation\n                {\n                    int64_t min_res_55517 = smin64(eta_p_55515, eta_p_55516);\n                    \n                    eta_p_55515 = min_res_55517;\n                }\n                // write result of operation\n                {\n                    ((volatile __local int64_t *) red_arr_i64_mem_55502)[sext_i32_i64(local_tid_55498)] = eta_p_55515;\n                }\n            }\n            offset_55522 *= 2;\n        }\n        while (slt32(skip_waves_55523, squot32(sext_i64_i32(segred_tblock_sizze_47261) + wave_sizze_55500 - 1, wave_sizze_55500))) {\n            barrier(CLK_LOCAL_MEM_FENCE);\n            offset_55522 = skip_waves_55523 * wave_sizze_55500;\n            if (slt32(local_tid_55498 + offset_55522, sext_i64", "_i32(segred_tblock_sizze_47261)) && ((local_tid_55498 - squot32(local_tid_55498, wave_sizze_55500) * wave_sizze_55500) == 0 && (squot32(local_tid_55498, wave_sizze_55500) & (2 * skip_waves_55523 - 1)) == 0)) {\n                // read array element\n                {\n                    eta_p_55516 = ((__local int64_t *) red_arr_i64_mem_55502)[sext_i32_i64(local_tid_55498 + offset_55522)];\n                }\n                // apply reduction operation\n                {\n                    int64_t min_res_55517 = smin64(eta_p_55515, eta_p_55516);\n                    \n                    eta_p_55515 = min_res_55517;\n                }\n                // write result of operation\n                {\n                    ((__local int64_t *) red_arr_i64_mem_55502)[sext_i32_i64(local_tid_55498)] = eta_p_55515;\n                }\n            }\n            skip_waves_55523 *= 2;\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        barrier(CLK_LOCAL_MEM_FENCE);\n        // thread 0 updates per-block acc(s); rest reset to ne\n        {\n            if (sext_i32_i64(local_tid_55498) == (int64_t) 0) {\n                eta_p_block_res_acc_55514 = eta_p_55515;\n            } else {\n                eta_p_block_res_acc_55514 = (int64_t) 9223372036854775807;\n            }\n        }\n        if (blocks_per_segment_55489 == (int64_t) 1) {\n            // first thread in block saves final result to memory\n            {\n                if (local_tid_55498 == 0) {\n                    ((__global int64_t *) mem_53662)[gtid_47265] = eta_p_block_res_acc_55514;\n                }\n            }\n        } else {\n            int32_t old_counter_55524;\n            bool is_last_block_55525;\n            \n            // first thread in block saves block result to global memory\n            {\n                if (local_tid_55498 == 0) {\n                    ((__global int64_t *) segred_tmp_mem_55493)[sext_i32_i64(virt_tblock_id_55509)] = eta_p_block_res_acc_55514;\n                    mem_fence_global();\n          ", "          old_counter_55524 = atomic_add_i32_global(&((volatile __global int *) counters_mem_55495)[srem64(flat_segment_id_55510, (int64_t) 20480)], (int) 1);\n                    ((__local bool *) sync_arr_mem_55504)[(int64_t) 0] = old_counter_55524 == sext_i64_i32(blocks_per_segment_55489 - (int64_t) 1);\n                }\n            }\n            barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n            is_last_block_55525 = ((__local bool *) sync_arr_mem_55504)[(int64_t) 0];\n            if (is_last_block_55525) {\n                if (local_tid_55498 == 0) {\n                    old_counter_55524 = atomic_add_i32_global(&((volatile __global int *) counters_mem_55495)[srem64(flat_segment_id_55510, (int64_t) 20480)], (int) sext_i64_i32((int64_t) 0 - blocks_per_segment_55489));\n                }\n                // read in the per-block-results\n                {\n                    int64_t read_per_thread_55526 = sdiv_up64(blocks_per_segment_55489, segred_tblock_sizze_47261);\n                    \n                    eta_p_47268 = (int64_t) 9223372036854775807;\n                    for (int64_t i_55527 = 0; i_55527 < read_per_thread_55526; i_55527++) {\n                        int64_t block_res_id_55528 = sext_i32_i64(local_tid_55498) * read_per_thread_55526 + i_55527;\n                        int64_t index_of_block_res_55529 = flat_segment_id_55510 * blocks_per_segment_55489 + block_res_id_55528;\n                        \n                        if (slt64(block_res_id_55528, blocks_per_segment_55489)) {\n                            eta_p_47269 = ((__global int64_t *) segred_tmp_mem_55493)[index_of_block_res_55529];\n                            \n                            int64_t min_res_47270 = smin64(eta_p_47268, eta_p_47269);\n                            \n                            eta_p_47268 = min_res_47270;\n                        }\n                    }\n                }\n                ((__local int64_t *) red_arr_i64_mem_55502)[sext_i32_i64(local_tid_55498)] =",
                                    " eta_p_47268;\n                barrier(CLK_LOCAL_MEM_FENCE);\n                // reduce the per-block results\n                {\n                    int32_t offset_55530;\n                    int32_t skip_waves_55531 = 1;\n                    int64_t eta_p_55515;\n                    int64_t eta_p_55516;\n                    \n                    offset_55530 = 0;\n                    // participating threads read initial accumulator\n                    {\n                        if (slt32(local_tid_55498, sext_i64_i32(segred_tblock_sizze_47261))) {\n                            eta_p_55515 = ((__local int64_t *) red_arr_i64_mem_55502)[sext_i32_i64(local_tid_55498 + offset_55530)];\n                        }\n                    }\n                    offset_55530 = 1;\n                    while (slt32(offset_55530, wave_sizze_55500)) {\n                        if (slt32(local_tid_55498 + offset_55530, sext_i64_i32(segred_tblock_sizze_47261)) && ((local_tid_55498 - squot32(local_tid_55498, wave_sizze_55500) * wave_sizze_55500) & (2 * offset_55530 - 1)) == 0) {\n                            // read array element\n                            {\n                                eta_p_55516 = ((volatile __local int64_t *) red_arr_i64_mem_55502)[sext_i32_i64(local_tid_55498 + offset_55530)];\n                            }\n                            // apply reduction operation\n                            {\n                                int64_t min_res_55517 = smin64(eta_p_55515, eta_p_55516);\n                                \n                                eta_p_55515 = min_res_55517;\n                            }\n                            // write result of operation\n                            {\n                                ((volatile __local int64_t *) red_arr_i64_mem_55502)[sext_i32_i64(local_tid_55498)] = eta_p_55515;\n                            }\n                        }\n                        offset_55530 *= 2;\n                    }\n                    while (slt32(skip_waves_", "55531, squot32(sext_i64_i32(segred_tblock_sizze_47261) + wave_sizze_55500 - 1, wave_sizze_55500))) {\n                        barrier(CLK_LOCAL_MEM_FENCE);\n                        offset_55530 = skip_waves_55531 * wave_sizze_55500;\n                        if (slt32(local_tid_55498 + offset_55530, sext_i64_i32(segred_tblock_sizze_47261)) && ((local_tid_55498 - squot32(local_tid_55498, wave_sizze_55500) * wave_sizze_55500) == 0 && (squot32(local_tid_55498, wave_sizze_55500) & (2 * skip_waves_55531 - 1)) == 0)) {\n                            // read array element\n                            {\n                                eta_p_55516 = ((__local int64_t *) red_arr_i64_mem_55502)[sext_i32_i64(local_tid_55498 + offset_55530)];\n                            }\n                            // apply reduction operation\n                            {\n                                int64_t min_res_55517 = smin64(eta_p_55515, eta_p_55516);\n                                \n                                eta_p_55515 = min_res_55517;\n                            }\n                            // write result of operation\n                            {\n                                ((__local int64_t *) red_arr_i64_mem_55502)[sext_i32_i64(local_tid_55498)] = eta_p_55515;\n                            }\n                        }\n                        skip_waves_55531 *= 2;\n                    }\n                    barrier(CLK_LOCAL_MEM_FENCE);\n                    // and back to memory with the final result\n                    {\n                        if (local_tid_55498 == 0) {\n                            ((__global int64_t *) mem_53662)[gtid_47265] = eta_p_55515;\n                        }\n                    }\n                }\n            }\n        }\n        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    }\n    \n  error_6:\n    return;\n    #undef segred_tblock_sizze_47261\n    #undef chunk_sizze_55460\n}\nFUTHARK_KERNEL_SIZED(do_DBSCAN_doublezisegred_large_48402_dim1, 1, 1)\nvoid", " do_DBSCAN_doublezisegred_large_48402(__global int *global_failure, int8_t clBase_36809, int8_t clBase_36810, double clBase_36811, double clBase_36817, int64_t conc_tmp_43977, int64_t inf_44477, int64_t dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_44480, int64_t num_tblocks_48396, unsigned char x_53498_bits, int64_t blocks_per_segment_56597, int64_t q_56598, int64_t num_virtblocks_56599, int64_t threads_per_segment_56600, __global unsigned char *mem_53586, __global unsigned char *mem_53588, __global unsigned char *mem_53626, __global unsigned char *ext_mem_54005, __global unsigned char *mem_54010, __global unsigned char *mem_54012, __global unsigned char *mem_54018, __global unsigned char *mem_54020, __global unsigned char *mem_54022, __global unsigned char *mem_54027, __global unsigned char *segred_tmp_mem_56601, __global unsigned char *segred_tmp_mem_56603, __global unsigned char *counters_mem_56605)\n{\n    bool x_53498 = x_53498_bits;\n    \n    #define segred_tblock_sizze_48395 (do_DBSCAN_doublezisegred_large_48402zisegred_tblock_sizze_48395)\n    #define chunk_sizze_56556 (do_DBSCAN_doublezisegred_large_48402zichunk_sizze_56556)\n    \n    volatile __local unsigned char *sync_arr_mem_56616_backing_2 = &shared_mem[0];\n    const int64_t sync_arr_mem_56616_backing_2_offset = 0 + 8;\n    volatile __local unsigned char *red_arr_f64_mem_56614_backing_1 = &shared_mem[sync_arr_mem_56616_backing_2_offset];\n    const int64_t red_arr_f64_mem_56614_backing_1_offset = sync_arr_mem_56616_backing_2_offset + ((int64_t) 8 * segred_tblock_sizze_48395 + srem64((int64_t) 8 - srem64((int64_t) 8 * segred_tblock_sizze_48395, (int64_t) 8), (int64_t) 8));\n    volatile __local unsigned char *red_arr_i64_mem_56612_backing_0 = &shared_mem[red_arr_f64_mem_56614_backing_1_offset];\n    const int64_t red_arr_i64_mem_56612_backing_0_offset = red_arr_f64_mem_56614_backing_1_offset + ((int64_t) 8 * segred_tblock_sizze_48395 + srem64((int64_t) 8 - srem64((int64_t) 8 * segred_tblock_sizze_48395, (int64_t) 8), (int6",
                                    "4_t) 8));\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_56608;\n    int32_t tblock_sizze_56611;\n    int32_t wave_sizze_56610;\n    int32_t block_id_56609;\n    int32_t global_tid_56607;\n    int64_t phys_tid_48402;\n    __local unsigned char *red_arr_i64_mem_56612;\n    __local unsigned char *red_arr_f64_mem_56614;\n    __local unsigned char *sync_arr_mem_56616;\n    int32_t phys_tblock_id_56618;\n    int32_t iterations_56619;\n    \n    local_tid_56608 = get_local_id(0);\n    tblock_sizze_56611 = get_local_size(0);\n    wave_sizze_56610 = LOCKSTEP_WIDTH;\n    block_id_56609 = get_tblock_id(0);\n    global_tid_56607 = block_id_56609 * tblock_sizze_56611 + local_tid_56608;\n    phys_tid_48402 = sext_i32_i64(global_tid_56607);\n    red_arr_i64_mem_56612 = (__local unsigned char *) red_arr_i64_mem_56612_backing_0;\n    red_arr_f64_mem_56614 = (__local unsigned char *) red_arr_f64_mem_56614_backing_1;\n    sync_arr_mem_56616 = (__local unsigned char *) sync_arr_mem_56616_backing_2;\n    phys_tblock_id_56618 = get_tblock_id(0);\n    iterations_56619 = sdiv_up32(sext_i64_i32(num_virtblocks_56599) - phys_tblock_id_56618, sext_i64_i32(num_tblocks_48396));\n    for (int32_t i_56620 = 0; i_56620 < iterations_56619; i_56620++) {\n        int32_t virt_tblock_id_56621;\n        int64_t flat_segment_id_56622;\n        int64_t global_tid_56623;\n        int64_t slice_56624;\n        int64_t gtid_48400;\n        int64_t remnant_56625;\n        int64_t gtid_48401;\n        int64_t eta_p_block_res_acc_56626;\n        double eta_p_block_res_acc_56627;\n        int64_t eta_p_48403;\n        double eta_p_48404;\n        int64_t eta_p_48405;\n        double eta_p_48406;\n        int64_t tblock_id_in_segment_56640;\n        int64_t block_base_offset_56641;\n        int32_t offset_56644;\n        int32_t skip_waves_56645;\n        int64_t eta_p_56628;\n        double eta_p_56629;\n        int64_t eta_p_56630;\n        double eta_p_56631;\n        \n        virt_tblock_id_56621 = phys_tblock_id_56618 + ", "i_56620 * sext_i64_i32(num_tblocks_48396);\n        flat_segment_id_56622 = squot64(sext_i32_i64(virt_tblock_id_56621), blocks_per_segment_56597);\n        global_tid_56623 = srem64(sext_i32_i64(virt_tblock_id_56621) * segred_tblock_sizze_48395 + sext_i32_i64(local_tid_56608), threads_per_segment_56600);\n        slice_56624 = dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_44480;\n        gtid_48400 = flat_segment_id_56622;\n        remnant_56625 = flat_segment_id_56622 - gtid_48400;\n        // ne-initialise the outer (per-block) accumulator(s)\n        {\n            eta_p_block_res_acc_56626 = (int64_t) -1;\n            eta_p_block_res_acc_56627 = INFINITY;\n        }\n        tblock_id_in_segment_56640 = squot64(global_tid_56623, segred_tblock_sizze_48395);\n        block_base_offset_56641 = tblock_id_in_segment_56640 * q_56598 * segred_tblock_sizze_48395;\n        for (int64_t i_56642 = 0; i_56642 < q_56598; i_56642++) {\n            int64_t block_offset_56643 = block_base_offset_56641 + i_56642 * segred_tblock_sizze_48395;\n            \n            gtid_48401 = global_tid_56623 + threads_per_segment_56600 * i_56642;\n            if (slt64(gtid_48401, conc_tmp_43977)) {\n                // apply map function(s)\n                {\n                    // apply map function\n                    {\n                        int64_t slice_49700 = inf_44477 + gtid_48400;\n                        double eta_p_48420 = ((__global double *) mem_54010)[gtid_48401];\n                        double eta_p_48421 = ((__global double *) mem_54012)[gtid_48401];\n                        int64_t x_48422 = ((__global int64_t *) ext_mem_54005)[gtid_48401];\n                        double d_haversine_res_48417;\n                        \n                        if (x_53498) {\n                            double x_53491 = ((__global double *) mem_54018)[gtid_48400];\n                            \n                            d_haversine_res_48417 = x_53491;\n                        } else {\n                            d_haversine", "_res_48417 = 0.0;\n                        }\n                        \n                        double d_haversine_res_48418;\n                        \n                        if (x_53498) {\n                            double x_53493 = ((__global double *) mem_54020)[gtid_48400];\n                            \n                            d_haversine_res_48418 = x_53493;\n                        } else {\n                            d_haversine_res_48418 = 0.0;\n                        }\n                        \n                        double cos_res_48419;\n                        \n                        if (x_53498) {\n                            double x_53495 = ((__global double *) mem_54022)[gtid_48400];\n                            \n                            cos_res_48419 = x_53495;\n                        } else {\n                            cos_res_48419 = 0.0;\n                        }\n                        \n                        double dist_res_48423;\n                        \n                        if (clBase_36810 == (int8_t) 0) {\n                            double eta_p_48415 = ((__global double *) mem_53586)[slice_49700];\n                            double eta_p_48416 = ((__global double *) mem_53588)[slice_49700];\n                            double zm_res_48424 = eta_p_48416 - eta_p_48421;\n                            double zm_res_48425 = eta_p_48415 - eta_p_48420;\n                            double hypot_res_48426 = futrts_hypot64(zm_res_48425, zm_res_48424);\n                            \n                            dist_res_48423 = hypot_res_48426;\n                        } else {\n                            double d_haversine_res_48427;\n                            double d_haversine_res_48428;\n                            \n                            if (clBase_36809 == (int8_t) 1) {\n                                d_haversine_res_48427 = eta_p_48420;\n                                d_haversine_res_48428 = eta_p_48421;\n                            } else {\n",
                                    "                                double zt_res_48429 = 3.141592653589793 * eta_p_48420;\n                                double zs_res_48430 = zt_res_48429 / 180.0;\n                                double zt_res_48431 = 3.141592653589793 * eta_p_48421;\n                                double zs_res_48432 = zt_res_48431 / 180.0;\n                                \n                                d_haversine_res_48427 = zs_res_48430;\n                                d_haversine_res_48428 = zs_res_48432;\n                            }\n                            \n                            double zm_res_48433 = d_haversine_res_48417 - d_haversine_res_48427;\n                            double cos_res_48434 = futrts_cos64(zm_res_48433);\n                            double zm_res_48435 = 1.0 - cos_res_48434;\n                            double cos_res_48436 = futrts_cos64(d_haversine_res_48427);\n                            double zt_res_48437 = cos_res_48419 * cos_res_48436;\n                            double zm_res_48438 = d_haversine_res_48418 - d_haversine_res_48428;\n                            double zm_res_48439 = 1.0 - zm_res_48438;\n                            double zt_res_48440 = zt_res_48437 * zm_res_48439;\n                            double zp_res_48441 = zm_res_48435 + zt_res_48440;\n                            double zs_res_48442 = zp_res_48441 / 2.0;\n                            double min_res_48443 = fmin64(1.0, zs_res_48442);\n                            double zt_res_48444 = 2.0 * min_res_48443;\n                            double zm_res_48445 = 1.0 - zt_res_48444;\n                            double acos_res_48446 = futrts_acos64(zm_res_48445);\n                            double zt_res_48447 = clBase_36817 * acos_res_48446;\n                            \n                            dist_res_48423 = zt_res_48447;\n                        }\n                        // load accumulator(s)\n                        {\n                            eta_p_48403 = eta_p_block_res_acc_5", "6626;\n                            eta_p_48404 = eta_p_block_res_acc_56627;\n                        }\n                        // load next value(s)\n                        {\n                            eta_p_48405 = x_48422;\n                            eta_p_48406 = dist_res_48423;\n                        }\n                        // apply reduction operator(s)\n                        {\n                            bool zg_res_48407 = clBase_36811 < eta_p_48404;\n                            bool zg_res_48408 = clBase_36811 < eta_p_48406;\n                            bool x_48409 = zg_res_48407 && zg_res_48408;\n                            int64_t lifted_lambda_res_48410;\n                            double lifted_lambda_res_48411;\n                            \n                            if (x_48409) {\n                                lifted_lambda_res_48410 = (int64_t) -1;\n                                lifted_lambda_res_48411 = INFINITY;\n                            } else {\n                                bool zl_res_48412 = eta_p_48404 < eta_p_48406;\n                                int64_t lifted_lambda_res_f_res_48413;\n                                \n                                if (zl_res_48412) {\n                                    lifted_lambda_res_f_res_48413 = eta_p_48403;\n                                } else {\n                                    lifted_lambda_res_f_res_48413 = eta_p_48405;\n                                }\n                                \n                                double lifted_lambda_res_f_res_48414;\n                                \n                                if (zl_res_48412) {\n                                    lifted_lambda_res_f_res_48414 = eta_p_48404;\n                                } else {\n                                    lifted_lambda_res_f_res_48414 = eta_p_48406;\n                                }\n                                lifted_lambda_res_48410 = lifted_lambda_res_f_res_48413;\n                              ", "  lifted_lambda_res_48411 = lifted_lambda_res_f_res_48414;\n                            }\n                            // store in accumulator(s)\n                            {\n                                eta_p_block_res_acc_56626 = lifted_lambda_res_48410;\n                                eta_p_block_res_acc_56627 = lifted_lambda_res_48411;\n                            }\n                        }\n                    }\n                }\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        // store accs. prims go in lmem; non-prims in params (in global mem)\n        {\n            ((__local int64_t *) red_arr_i64_mem_56612)[sext_i32_i64(local_tid_56608)] = eta_p_block_res_acc_56626;\n            ((__local double *) red_arr_f64_mem_56614)[sext_i32_i64(local_tid_56608)] = eta_p_block_res_acc_56627;\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        skip_waves_56645 = 1;\n        offset_56644 = 0;\n        // participating threads read initial accumulator\n        {\n            if (slt32(local_tid_56608, sext_i64_i32(segred_tblock_sizze_48395))) {\n                eta_p_56628 = ((__local int64_t *) red_arr_i64_mem_56612)[sext_i32_i64(local_tid_56608 + offset_56644)];\n                eta_p_56629 = ((__local double *) red_arr_f64_mem_56614)[sext_i32_i64(local_tid_56608 + offset_56644)];\n            }\n        }\n        offset_56644 = 1;\n        while (slt32(offset_56644, wave_sizze_56610)) {\n            if (slt32(local_tid_56608 + offset_56644, sext_i64_i32(segred_tblock_sizze_48395)) && ((local_tid_56608 - squot32(local_tid_56608, wave_sizze_56610) * wave_sizze_56610) & (2 * offset_56644 - 1)) == 0) {\n                // read array element\n                {\n                    eta_p_56630 = ((volatile __local int64_t *) red_arr_i64_mem_56612)[sext_i32_i64(local_tid_56608 + offset_56644)];\n                    eta_p_56631 = ((volatile __local double *) red_arr_f64_mem_56614)[sext_i32_i64(local_tid_56608 + offset_56644)];\n                }\n                // app",
                                    "ly reduction operation\n                {\n                    bool zg_res_56632 = clBase_36811 < eta_p_56629;\n                    bool zg_res_56633 = clBase_36811 < eta_p_56631;\n                    bool x_56634 = zg_res_56632 && zg_res_56633;\n                    int64_t lifted_lambda_res_56635;\n                    double lifted_lambda_res_56636;\n                    \n                    if (x_56634) {\n                        lifted_lambda_res_56635 = (int64_t) -1;\n                        lifted_lambda_res_56636 = INFINITY;\n                    } else {\n                        bool zl_res_56637 = eta_p_56629 < eta_p_56631;\n                        int64_t lifted_lambda_res_f_res_56638;\n                        \n                        if (zl_res_56637) {\n                            lifted_lambda_res_f_res_56638 = eta_p_56628;\n                        } else {\n                            lifted_lambda_res_f_res_56638 = eta_p_56630;\n                        }\n                        \n                        double lifted_lambda_res_f_res_56639;\n                        \n                        if (zl_res_56637) {\n                            lifted_lambda_res_f_res_56639 = eta_p_56629;\n                        } else {\n                            lifted_lambda_res_f_res_56639 = eta_p_56631;\n                        }\n                        lifted_lambda_res_56635 = lifted_lambda_res_f_res_56638;\n                        lifted_lambda_res_56636 = lifted_lambda_res_f_res_56639;\n                    }\n                    eta_p_56628 = lifted_lambda_res_56635;\n                    eta_p_56629 = lifted_lambda_res_56636;\n                }\n                // write result of operation\n                {\n                    ((volatile __local int64_t *) red_arr_i64_mem_56612)[sext_i32_i64(local_tid_56608)] = eta_p_56628;\n                    ((volatile __local double *) red_arr_f64_mem_56614)[sext_i32_i64(local_tid_56608)] = eta_p_56629;\n                }\n            }\n            offset_5664", "4 *= 2;\n        }\n        while (slt32(skip_waves_56645, squot32(sext_i64_i32(segred_tblock_sizze_48395) + wave_sizze_56610 - 1, wave_sizze_56610))) {\n            barrier(CLK_LOCAL_MEM_FENCE);\n            offset_56644 = skip_waves_56645 * wave_sizze_56610;\n            if (slt32(local_tid_56608 + offset_56644, sext_i64_i32(segred_tblock_sizze_48395)) && ((local_tid_56608 - squot32(local_tid_56608, wave_sizze_56610) * wave_sizze_56610) == 0 && (squot32(local_tid_56608, wave_sizze_56610) & (2 * skip_waves_56645 - 1)) == 0)) {\n                // read array element\n                {\n                    eta_p_56630 = ((__local int64_t *) red_arr_i64_mem_56612)[sext_i32_i64(local_tid_56608 + offset_56644)];\n                    eta_p_56631 = ((__local double *) red_arr_f64_mem_56614)[sext_i32_i64(local_tid_56608 + offset_56644)];\n                }\n                // apply reduction operation\n                {\n                    bool zg_res_56632 = clBase_36811 < eta_p_56629;\n                    bool zg_res_56633 = clBase_36811 < eta_p_56631;\n                    bool x_56634 = zg_res_56632 && zg_res_56633;\n                    int64_t lifted_lambda_res_56635;\n                    double lifted_lambda_res_56636;\n                    \n                    if (x_56634) {\n                        lifted_lambda_res_56635 = (int64_t) -1;\n                        lifted_lambda_res_56636 = INFINITY;\n                    } else {\n                        bool zl_res_56637 = eta_p_56629 < eta_p_56631;\n                        int64_t lifted_lambda_res_f_res_56638;\n                        \n                        if (zl_res_56637) {\n                            lifted_lambda_res_f_res_56638 = eta_p_56628;\n                        } else {\n                            lifted_lambda_res_f_res_56638 = eta_p_56630;\n                        }\n                        \n                        double lifted_lambda_res_f_res_56639;\n                        \n                        if (zl_res_56637) {\n      ", "                      lifted_lambda_res_f_res_56639 = eta_p_56629;\n                        } else {\n                            lifted_lambda_res_f_res_56639 = eta_p_56631;\n                        }\n                        lifted_lambda_res_56635 = lifted_lambda_res_f_res_56638;\n                        lifted_lambda_res_56636 = lifted_lambda_res_f_res_56639;\n                    }\n                    eta_p_56628 = lifted_lambda_res_56635;\n                    eta_p_56629 = lifted_lambda_res_56636;\n                }\n                // write result of operation\n                {\n                    ((__local int64_t *) red_arr_i64_mem_56612)[sext_i32_i64(local_tid_56608)] = eta_p_56628;\n                    ((__local double *) red_arr_f64_mem_56614)[sext_i32_i64(local_tid_56608)] = eta_p_56629;\n                }\n            }\n            skip_waves_56645 *= 2;\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        barrier(CLK_LOCAL_MEM_FENCE);\n        // thread 0 updates per-block acc(s); rest reset to ne\n        {\n            if (sext_i32_i64(local_tid_56608) == (int64_t) 0) {\n                eta_p_block_res_acc_56626 = eta_p_56628;\n                eta_p_block_res_acc_56627 = eta_p_56629;\n            } else {\n                eta_p_block_res_acc_56626 = (int64_t) -1;\n                eta_p_block_res_acc_56627 = INFINITY;\n            }\n        }\n        if (blocks_per_segment_56597 == (int64_t) 1) {\n            // first thread in block saves final result to memory\n            {\n                if (local_tid_56608 == 0) {\n                    ((__global int64_t *) mem_53626)[inf_44477 + gtid_48400] = eta_p_block_res_acc_56626;\n                    ((__global double *) mem_54027)[gtid_48400] = eta_p_block_res_acc_56627;\n                }\n            }\n        } else {\n            int32_t old_counter_56646;\n            bool is_last_block_56647;\n            \n            // first thread in block saves block result to global memory\n            {\n                if (local_tid_5660",
                                    "8 == 0) {\n                    ((__global int64_t *) segred_tmp_mem_56601)[sext_i32_i64(virt_tblock_id_56621)] = eta_p_block_res_acc_56626;\n                    mem_fence_global();\n                    ((__global double *) segred_tmp_mem_56603)[sext_i32_i64(virt_tblock_id_56621)] = eta_p_block_res_acc_56627;\n                    mem_fence_global();\n                    old_counter_56646 = atomic_add_i32_global(&((volatile __global int *) counters_mem_56605)[srem64(flat_segment_id_56622, (int64_t) 20480)], (int) 1);\n                    ((__local bool *) sync_arr_mem_56616)[(int64_t) 0] = old_counter_56646 == sext_i64_i32(blocks_per_segment_56597 - (int64_t) 1);\n                }\n            }\n            barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n            is_last_block_56647 = ((__local bool *) sync_arr_mem_56616)[(int64_t) 0];\n            if (is_last_block_56647) {\n                if (local_tid_56608 == 0) {\n                    old_counter_56646 = atomic_add_i32_global(&((volatile __global int *) counters_mem_56605)[srem64(flat_segment_id_56622, (int64_t) 20480)], (int) sext_i64_i32((int64_t) 0 - blocks_per_segment_56597));\n                }\n                // read in the per-block-results\n                {\n                    int64_t read_per_thread_56648 = sdiv_up64(blocks_per_segment_56597, segred_tblock_sizze_48395);\n                    \n                    eta_p_48403 = (int64_t) -1;\n                    eta_p_48404 = INFINITY;\n                    for (int64_t i_56649 = 0; i_56649 < read_per_thread_56648; i_56649++) {\n                        int64_t block_res_id_56650 = sext_i32_i64(local_tid_56608) * read_per_thread_56648 + i_56649;\n                        int64_t index_of_block_res_56651 = flat_segment_id_56622 * blocks_per_segment_56597 + block_res_id_56650;\n                        \n                        if (slt64(block_res_id_56650, blocks_per_segment_56597)) {\n                            eta_p_48405 = ((__global int64_t *) segred_tmp_mem_56601)[in", "dex_of_block_res_56651];\n                            eta_p_48406 = ((__global double *) segred_tmp_mem_56603)[index_of_block_res_56651];\n                            \n                            bool zg_res_48407 = clBase_36811 < eta_p_48404;\n                            bool zg_res_48408 = clBase_36811 < eta_p_48406;\n                            bool x_48409 = zg_res_48407 && zg_res_48408;\n                            int64_t lifted_lambda_res_48410;\n                            double lifted_lambda_res_48411;\n                            \n                            if (x_48409) {\n                                lifted_lambda_res_48410 = (int64_t) -1;\n                                lifted_lambda_res_48411 = INFINITY;\n                            } else {\n                                bool zl_res_48412 = eta_p_48404 < eta_p_48406;\n                                int64_t lifted_lambda_res_f_res_48413;\n                                \n                                if (zl_res_48412) {\n                                    lifted_lambda_res_f_res_48413 = eta_p_48403;\n                                } else {\n                                    lifted_lambda_res_f_res_48413 = eta_p_48405;\n                                }\n                                \n                                double lifted_lambda_res_f_res_48414;\n                                \n                                if (zl_res_48412) {\n                                    lifted_lambda_res_f_res_48414 = eta_p_48404;\n                                } else {\n                                    lifted_lambda_res_f_res_48414 = eta_p_48406;\n                                }\n                                lifted_lambda_res_48410 = lifted_lambda_res_f_res_48413;\n                                lifted_lambda_res_48411 = lifted_lambda_res_f_res_48414;\n                            }\n                            eta_p_48403 = lifted_lambda_res_48410;\n                            eta_p_48404 = lifted_lambda_res_48411;\n", "                        }\n                    }\n                }\n                ((__local int64_t *) red_arr_i64_mem_56612)[sext_i32_i64(local_tid_56608)] = eta_p_48403;\n                ((__local double *) red_arr_f64_mem_56614)[sext_i32_i64(local_tid_56608)] = eta_p_48404;\n                barrier(CLK_LOCAL_MEM_FENCE);\n                // reduce the per-block results\n                {\n                    int32_t offset_56652;\n                    int32_t skip_waves_56653 = 1;\n                    int64_t eta_p_56628;\n                    double eta_p_56629;\n                    int64_t eta_p_56630;\n                    double eta_p_56631;\n                    \n                    offset_56652 = 0;\n                    // participating threads read initial accumulator\n                    {\n                        if (slt32(local_tid_56608, sext_i64_i32(segred_tblock_sizze_48395))) {\n                            eta_p_56628 = ((__local int64_t *) red_arr_i64_mem_56612)[sext_i32_i64(local_tid_56608 + offset_56652)];\n                            eta_p_56629 = ((__local double *) red_arr_f64_mem_56614)[sext_i32_i64(local_tid_56608 + offset_56652)];\n                        }\n                    }\n                    offset_56652 = 1;\n                    while (slt32(offset_56652, wave_sizze_56610)) {\n                        if (slt32(local_tid_56608 + offset_56652, sext_i64_i32(segred_tblock_sizze_48395)) && ((local_tid_56608 - squot32(local_tid_56608, wave_sizze_56610) * wave_sizze_56610) & (2 * offset_56652 - 1)) == 0) {\n                            // read array element\n                            {\n                                eta_p_56630 = ((volatile __local int64_t *) red_arr_i64_mem_56612)[sext_i32_i64(local_tid_56608 + offset_56652)];\n                                eta_p_56631 = ((volatile __local double *) red_arr_f64_mem_56614)[sext_i32_i64(local_tid_56608 + offset_56652)];\n                            }\n                            // apply reduction operation\n       ",
                                    "                     {\n                                bool zg_res_56632 = clBase_36811 < eta_p_56629;\n                                bool zg_res_56633 = clBase_36811 < eta_p_56631;\n                                bool x_56634 = zg_res_56632 && zg_res_56633;\n                                int64_t lifted_lambda_res_56635;\n                                double lifted_lambda_res_56636;\n                                \n                                if (x_56634) {\n                                    lifted_lambda_res_56635 = (int64_t) -1;\n                                    lifted_lambda_res_56636 = INFINITY;\n                                } else {\n                                    bool zl_res_56637 = eta_p_56629 < eta_p_56631;\n                                    int64_t lifted_lambda_res_f_res_56638;\n                                    \n                                    if (zl_res_56637) {\n                                        lifted_lambda_res_f_res_56638 = eta_p_56628;\n                                    } else {\n                                        lifted_lambda_res_f_res_56638 = eta_p_56630;\n                                    }\n                                    \n                                    double lifted_lambda_res_f_res_56639;\n                                    \n                                    if (zl_res_56637) {\n                                        lifted_lambda_res_f_res_56639 = eta_p_56629;\n                                    } else {\n                                        lifted_lambda_res_f_res_56639 = eta_p_56631;\n                                    }\n                                    lifted_lambda_res_56635 = lifted_lambda_res_f_res_56638;\n                                    lifted_lambda_res_56636 = lifted_lambda_res_f_res_56639;\n                                }\n                                eta_p_56628 = lifted_lambda_res_56635;\n                                eta_p_56629 = lifted_lambda_res_56636;\n                   ", "         }\n                            // write result of operation\n                            {\n                                ((volatile __local int64_t *) red_arr_i64_mem_56612)[sext_i32_i64(local_tid_56608)] = eta_p_56628;\n                                ((volatile __local double *) red_arr_f64_mem_56614)[sext_i32_i64(local_tid_56608)] = eta_p_56629;\n                            }\n                        }\n                        offset_56652 *= 2;\n                    }\n                    while (slt32(skip_waves_56653, squot32(sext_i64_i32(segred_tblock_sizze_48395) + wave_sizze_56610 - 1, wave_sizze_56610))) {\n                        barrier(CLK_LOCAL_MEM_FENCE);\n                        offset_56652 = skip_waves_56653 * wave_sizze_56610;\n                        if (slt32(local_tid_56608 + offset_56652, sext_i64_i32(segred_tblock_sizze_48395)) && ((local_tid_56608 - squot32(local_tid_56608, wave_sizze_56610) * wave_sizze_56610) == 0 && (squot32(local_tid_56608, wave_sizze_56610) & (2 * skip_waves_56653 - 1)) == 0)) {\n                            // read array element\n                            {\n                                eta_p_56630 = ((__local int64_t *) red_arr_i64_mem_56612)[sext_i32_i64(local_tid_56608 + offset_56652)];\n                                eta_p_56631 = ((__local double *) red_arr_f64_mem_56614)[sext_i32_i64(local_tid_56608 + offset_56652)];\n                            }\n                            // apply reduction operation\n                            {\n                                bool zg_res_56632 = clBase_36811 < eta_p_56629;\n                                bool zg_res_56633 = clBase_36811 < eta_p_56631;\n                                bool x_56634 = zg_res_56632 && zg_res_56633;\n                                int64_t lifted_lambda_res_56635;\n                                double lifted_lambda_res_56636;\n                                \n                                if (x_56634) {\n                                    lifted_la", "mbda_res_56635 = (int64_t) -1;\n                                    lifted_lambda_res_56636 = INFINITY;\n                                } else {\n                                    bool zl_res_56637 = eta_p_56629 < eta_p_56631;\n                                    int64_t lifted_lambda_res_f_res_56638;\n                                    \n                                    if (zl_res_56637) {\n                                        lifted_lambda_res_f_res_56638 = eta_p_56628;\n                                    } else {\n                                        lifted_lambda_res_f_res_56638 = eta_p_56630;\n                                    }\n                                    \n                                    double lifted_lambda_res_f_res_56639;\n                                    \n                                    if (zl_res_56637) {\n                                        lifted_lambda_res_f_res_56639 = eta_p_56629;\n                                    } else {\n                                        lifted_lambda_res_f_res_56639 = eta_p_56631;\n                                    }\n                                    lifted_lambda_res_56635 = lifted_lambda_res_f_res_56638;\n                                    lifted_lambda_res_56636 = lifted_lambda_res_f_res_56639;\n                                }\n                                eta_p_56628 = lifted_lambda_res_56635;\n                                eta_p_56629 = lifted_lambda_res_56636;\n                            }\n                            // write result of operation\n                            {\n                                ((__local int64_t *) red_arr_i64_mem_56612)[sext_i32_i64(local_tid_56608)] = eta_p_56628;\n                                ((__local double *) red_arr_f64_mem_56614)[sext_i32_i64(local_tid_56608)] = eta_p_56629;\n                            }\n                        }\n                        skip_waves_56653 *= 2;\n                    }\n                    barrier(CLK_LOCAL_MEM_FENCE)",
                                    ";\n                    // and back to memory with the final result\n                    {\n                        if (local_tid_56608 == 0) {\n                            ((__global int64_t *) mem_53626)[inf_44477 + gtid_48400] = eta_p_56628;\n                            ((__global double *) mem_54027)[gtid_48400] = eta_p_56629;\n                        }\n                    }\n                }\n            }\n        }\n        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    }\n    \n  error_6:\n    return;\n    #undef segred_tblock_sizze_48395\n    #undef chunk_sizze_56556\n}\nFUTHARK_KERNEL_SIZED(do_DBSCAN_doublezisegred_large_49140_dim1, 1, 1)\nvoid do_DBSCAN_doublezisegred_large_49140(__global int *global_failure, int8_t clBase_36809, int8_t clBase_36810, double clBase_36811, double clBase_36817, int64_t conc_tmp_43977, int64_t inf_44560, int64_t dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_44563, int64_t num_tblocks_49134, unsigned char x_53498_bits, int64_t blocks_per_segment_56756, int64_t q_56757, int64_t num_virtblocks_56758, int64_t threads_per_segment_56759, __global unsigned char *current_partition_mem_53519, __global unsigned char *current_partition_mem_53520, __global unsigned char *mem_53556, __global unsigned char *ext_mem_54005, __global unsigned char *mem_54010, __global unsigned char *mem_54012, __global unsigned char *mem_54265, __global unsigned char *mem_54267, __global unsigned char *mem_54269, __global unsigned char *mem_54274, __global unsigned char *segred_tmp_mem_56760, __global unsigned char *segred_tmp_mem_56762, __global unsigned char *counters_mem_56764)\n{\n    bool x_53498 = x_53498_bits;\n    \n    #define segred_tblock_sizze_49133 (do_DBSCAN_doublezisegred_large_49140zisegred_tblock_sizze_49133)\n    #define chunk_sizze_56715 (do_DBSCAN_doublezisegred_large_49140zichunk_sizze_56715)\n    \n    volatile __local unsigned char *sync_arr_mem_56775_backing_2 = &shared_mem[0];\n    const int64_t sync_arr_mem_56775_backing_2_offset = 0 + 8;\n    volatile __local u", "nsigned char *red_arr_f64_mem_56773_backing_1 = &shared_mem[sync_arr_mem_56775_backing_2_offset];\n    const int64_t red_arr_f64_mem_56773_backing_1_offset = sync_arr_mem_56775_backing_2_offset + ((int64_t) 8 * segred_tblock_sizze_49133 + srem64((int64_t) 8 - srem64((int64_t) 8 * segred_tblock_sizze_49133, (int64_t) 8), (int64_t) 8));\n    volatile __local unsigned char *red_arr_i64_mem_56771_backing_0 = &shared_mem[red_arr_f64_mem_56773_backing_1_offset];\n    const int64_t red_arr_i64_mem_56771_backing_0_offset = red_arr_f64_mem_56773_backing_1_offset + ((int64_t) 8 * segred_tblock_sizze_49133 + srem64((int64_t) 8 - srem64((int64_t) 8 * segred_tblock_sizze_49133, (int64_t) 8), (int64_t) 8));\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_56767;\n    int32_t tblock_sizze_56770;\n    int32_t wave_sizze_56769;\n    int32_t block_id_56768;\n    int32_t global_tid_56766;\n    int64_t phys_tid_49140;\n    __local unsigned char *red_arr_i64_mem_56771;\n    __local unsigned char *red_arr_f64_mem_56773;\n    __local unsigned char *sync_arr_mem_56775;\n    int32_t phys_tblock_id_56777;\n    int32_t iterations_56778;\n    \n    local_tid_56767 = get_local_id(0);\n    tblock_sizze_56770 = get_local_size(0);\n    wave_sizze_56769 = LOCKSTEP_WIDTH;\n    block_id_56768 = get_tblock_id(0);\n    global_tid_56766 = block_id_56768 * tblock_sizze_56770 + local_tid_56767;\n    phys_tid_49140 = sext_i32_i64(global_tid_56766);\n    red_arr_i64_mem_56771 = (__local unsigned char *) red_arr_i64_mem_56771_backing_0;\n    red_arr_f64_mem_56773 = (__local unsigned char *) red_arr_f64_mem_56773_backing_1;\n    sync_arr_mem_56775 = (__local unsigned char *) sync_arr_mem_56775_backing_2;\n    phys_tblock_id_56777 = get_tblock_id(0);\n    iterations_56778 = sdiv_up32(sext_i64_i32(num_virtblocks_56758) - phys_tblock_id_56777, sext_i64_i32(num_tblocks_49134));\n    for (int32_t i_56779 = 0; i_56779 < iterations_56778; i_56779++) {\n        int32_t virt_tblock_id_56780;\n        int64_t flat_seg", "ment_id_56781;\n        int64_t global_tid_56782;\n        int64_t slice_56783;\n        int64_t gtid_49138;\n        int64_t remnant_56784;\n        int64_t gtid_49139;\n        int64_t eta_p_block_res_acc_56785;\n        double eta_p_block_res_acc_56786;\n        int64_t eta_p_49141;\n        double eta_p_49142;\n        int64_t eta_p_49143;\n        double eta_p_49144;\n        int64_t tblock_id_in_segment_56799;\n        int64_t block_base_offset_56800;\n        int32_t offset_56803;\n        int32_t skip_waves_56804;\n        int64_t eta_p_56787;\n        double eta_p_56788;\n        int64_t eta_p_56789;\n        double eta_p_56790;\n        \n        virt_tblock_id_56780 = phys_tblock_id_56777 + i_56779 * sext_i64_i32(num_tblocks_49134);\n        flat_segment_id_56781 = squot64(sext_i32_i64(virt_tblock_id_56780), blocks_per_segment_56756);\n        global_tid_56782 = srem64(sext_i32_i64(virt_tblock_id_56780) * segred_tblock_sizze_49133 + sext_i32_i64(local_tid_56767), threads_per_segment_56759);\n        slice_56783 = dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_44563;\n        gtid_49138 = flat_segment_id_56781;\n        remnant_56784 = flat_segment_id_56781 - gtid_49138;\n        // ne-initialise the outer (per-block) accumulator(s)\n        {\n            eta_p_block_res_acc_56785 = (int64_t) -1;\n            eta_p_block_res_acc_56786 = INFINITY;\n        }\n        tblock_id_in_segment_56799 = squot64(global_tid_56782, segred_tblock_sizze_49133);\n        block_base_offset_56800 = tblock_id_in_segment_56799 * q_56757 * segred_tblock_sizze_49133;\n        for (int64_t i_56801 = 0; i_56801 < q_56757; i_56801++) {\n            int64_t block_offset_56802 = block_base_offset_56800 + i_56801 * segred_tblock_sizze_49133;\n            \n            gtid_49139 = global_tid_56782 + threads_per_segment_56759 * i_56801;\n            if (slt64(gtid_49139, conc_tmp_43977)) {\n                // apply map function(s)\n                {\n                    // apply map function\n                    {\n                      ",
                                    "  int64_t slice_49678 = inf_44560 + gtid_49138;\n                        double eta_p_49158 = ((__global double *) mem_54010)[gtid_49139];\n                        double eta_p_49159 = ((__global double *) mem_54012)[gtid_49139];\n                        int64_t x_49160 = ((__global int64_t *) ext_mem_54005)[gtid_49139];\n                        double d_haversine_res_49155;\n                        \n                        if (x_53498) {\n                            double x_53482 = ((__global double *) mem_54265)[gtid_49138];\n                            \n                            d_haversine_res_49155 = x_53482;\n                        } else {\n                            d_haversine_res_49155 = 0.0;\n                        }\n                        \n                        double d_haversine_res_49156;\n                        \n                        if (x_53498) {\n                            double x_53484 = ((__global double *) mem_54267)[gtid_49138];\n                            \n                            d_haversine_res_49156 = x_53484;\n                        } else {\n                            d_haversine_res_49156 = 0.0;\n                        }\n                        \n                        double cos_res_49157;\n                        \n                        if (x_53498) {\n                            double x_53486 = ((__global double *) mem_54269)[gtid_49138];\n                            \n                            cos_res_49157 = x_53486;\n                        } else {\n                            cos_res_49157 = 0.0;\n                        }\n                        \n                        double dist_res_49161;\n                        \n                        if (clBase_36810 == (int8_t) 0) {\n                            double eta_p_49153 = ((__global double *) current_partition_mem_53519)[slice_49678];\n                            double eta_p_49154 = ((__global double *) current_partition_mem_53520)[slice_49678];\n                            dou", "ble zm_res_49162 = eta_p_49154 - eta_p_49159;\n                            double zm_res_49163 = eta_p_49153 - eta_p_49158;\n                            double hypot_res_49164 = futrts_hypot64(zm_res_49163, zm_res_49162);\n                            \n                            dist_res_49161 = hypot_res_49164;\n                        } else {\n                            double d_haversine_res_49165;\n                            double d_haversine_res_49166;\n                            \n                            if (clBase_36809 == (int8_t) 1) {\n                                d_haversine_res_49165 = eta_p_49158;\n                                d_haversine_res_49166 = eta_p_49159;\n                            } else {\n                                double zt_res_49167 = 3.141592653589793 * eta_p_49158;\n                                double zs_res_49168 = zt_res_49167 / 180.0;\n                                double zt_res_49169 = 3.141592653589793 * eta_p_49159;\n                                double zs_res_49170 = zt_res_49169 / 180.0;\n                                \n                                d_haversine_res_49165 = zs_res_49168;\n                                d_haversine_res_49166 = zs_res_49170;\n                            }\n                            \n                            double zm_res_49171 = d_haversine_res_49155 - d_haversine_res_49165;\n                            double cos_res_49172 = futrts_cos64(zm_res_49171);\n                            double zm_res_49173 = 1.0 - cos_res_49172;\n                            double cos_res_49174 = futrts_cos64(d_haversine_res_49165);\n                            double zt_res_49175 = cos_res_49157 * cos_res_49174;\n                            double zm_res_49176 = d_haversine_res_49156 - d_haversine_res_49166;\n                            double zm_res_49177 = 1.0 - zm_res_49176;\n                            double zt_res_49178 = zt_res_49175 * zm_res_49177;\n                            double zp_res_49179 = zm_r", "es_49173 + zt_res_49178;\n                            double zs_res_49180 = zp_res_49179 / 2.0;\n                            double min_res_49181 = fmin64(1.0, zs_res_49180);\n                            double zt_res_49182 = 2.0 * min_res_49181;\n                            double zm_res_49183 = 1.0 - zt_res_49182;\n                            double acos_res_49184 = futrts_acos64(zm_res_49183);\n                            double zt_res_49185 = clBase_36817 * acos_res_49184;\n                            \n                            dist_res_49161 = zt_res_49185;\n                        }\n                        // load accumulator(s)\n                        {\n                            eta_p_49141 = eta_p_block_res_acc_56785;\n                            eta_p_49142 = eta_p_block_res_acc_56786;\n                        }\n                        // load next value(s)\n                        {\n                            eta_p_49143 = x_49160;\n                            eta_p_49144 = dist_res_49161;\n                        }\n                        // apply reduction operator(s)\n                        {\n                            bool zg_res_49145 = clBase_36811 < eta_p_49142;\n                            bool zg_res_49146 = clBase_36811 < eta_p_49144;\n                            bool x_49147 = zg_res_49145 && zg_res_49146;\n                            int64_t lifted_lambda_res_49148;\n                            double lifted_lambda_res_49149;\n                            \n                            if (x_49147) {\n                                lifted_lambda_res_49148 = (int64_t) -1;\n                                lifted_lambda_res_49149 = INFINITY;\n                            } else {\n                                bool zl_res_49150 = eta_p_49142 < eta_p_49144;\n                                int64_t lifted_lambda_res_f_res_49151;\n                                \n                                if (zl_res_49150) {\n                                    lifted_lambda_res_f",
                                    "_res_49151 = eta_p_49141;\n                                } else {\n                                    lifted_lambda_res_f_res_49151 = eta_p_49143;\n                                }\n                                \n                                double lifted_lambda_res_f_res_49152;\n                                \n                                if (zl_res_49150) {\n                                    lifted_lambda_res_f_res_49152 = eta_p_49142;\n                                } else {\n                                    lifted_lambda_res_f_res_49152 = eta_p_49144;\n                                }\n                                lifted_lambda_res_49148 = lifted_lambda_res_f_res_49151;\n                                lifted_lambda_res_49149 = lifted_lambda_res_f_res_49152;\n                            }\n                            // store in accumulator(s)\n                            {\n                                eta_p_block_res_acc_56785 = lifted_lambda_res_49148;\n                                eta_p_block_res_acc_56786 = lifted_lambda_res_49149;\n                            }\n                        }\n                    }\n                }\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        // store accs. prims go in lmem; non-prims in params (in global mem)\n        {\n            ((__local int64_t *) red_arr_i64_mem_56771)[sext_i32_i64(local_tid_56767)] = eta_p_block_res_acc_56785;\n            ((__local double *) red_arr_f64_mem_56773)[sext_i32_i64(local_tid_56767)] = eta_p_block_res_acc_56786;\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        skip_waves_56804 = 1;\n        offset_56803 = 0;\n        // participating threads read initial accumulator\n        {\n            if (slt32(local_tid_56767, sext_i64_i32(segred_tblock_sizze_49133))) {\n                eta_p_56787 = ((__local int64_t *) red_arr_i64_mem_56771)[sext_i32_i64(local_tid_56767 + offset_56803)];\n                eta_p_56788 = ((__local double *) red_arr_f64_mem_56773)[sext_", "i32_i64(local_tid_56767 + offset_56803)];\n            }\n        }\n        offset_56803 = 1;\n        while (slt32(offset_56803, wave_sizze_56769)) {\n            if (slt32(local_tid_56767 + offset_56803, sext_i64_i32(segred_tblock_sizze_49133)) && ((local_tid_56767 - squot32(local_tid_56767, wave_sizze_56769) * wave_sizze_56769) & (2 * offset_56803 - 1)) == 0) {\n                // read array element\n                {\n                    eta_p_56789 = ((volatile __local int64_t *) red_arr_i64_mem_56771)[sext_i32_i64(local_tid_56767 + offset_56803)];\n                    eta_p_56790 = ((volatile __local double *) red_arr_f64_mem_56773)[sext_i32_i64(local_tid_56767 + offset_56803)];\n                }\n                // apply reduction operation\n                {\n                    bool zg_res_56791 = clBase_36811 < eta_p_56788;\n                    bool zg_res_56792 = clBase_36811 < eta_p_56790;\n                    bool x_56793 = zg_res_56791 && zg_res_56792;\n                    int64_t lifted_lambda_res_56794;\n                    double lifted_lambda_res_56795;\n                    \n                    if (x_56793) {\n                        lifted_lambda_res_56794 = (int64_t) -1;\n                        lifted_lambda_res_56795 = INFINITY;\n                    } else {\n                        bool zl_res_56796 = eta_p_56788 < eta_p_56790;\n                        int64_t lifted_lambda_res_f_res_56797;\n                        \n                        if (zl_res_56796) {\n                            lifted_lambda_res_f_res_56797 = eta_p_56787;\n                        } else {\n                            lifted_lambda_res_f_res_56797 = eta_p_56789;\n                        }\n                        \n                        double lifted_lambda_res_f_res_56798;\n                        \n                        if (zl_res_56796) {\n                            lifted_lambda_res_f_res_56798 = eta_p_56788;\n                        } else {\n                            lifted_lambda_res_f_", "res_56798 = eta_p_56790;\n                        }\n                        lifted_lambda_res_56794 = lifted_lambda_res_f_res_56797;\n                        lifted_lambda_res_56795 = lifted_lambda_res_f_res_56798;\n                    }\n                    eta_p_56787 = lifted_lambda_res_56794;\n                    eta_p_56788 = lifted_lambda_res_56795;\n                }\n                // write result of operation\n                {\n                    ((volatile __local int64_t *) red_arr_i64_mem_56771)[sext_i32_i64(local_tid_56767)] = eta_p_56787;\n                    ((volatile __local double *) red_arr_f64_mem_56773)[sext_i32_i64(local_tid_56767)] = eta_p_56788;\n                }\n            }\n            offset_56803 *= 2;\n        }\n        while (slt32(skip_waves_56804, squot32(sext_i64_i32(segred_tblock_sizze_49133) + wave_sizze_56769 - 1, wave_sizze_56769))) {\n            barrier(CLK_LOCAL_MEM_FENCE);\n            offset_56803 = skip_waves_56804 * wave_sizze_56769;\n            if (slt32(local_tid_56767 + offset_56803, sext_i64_i32(segred_tblock_sizze_49133)) && ((local_tid_56767 - squot32(local_tid_56767, wave_sizze_56769) * wave_sizze_56769) == 0 && (squot32(local_tid_56767, wave_sizze_56769) & (2 * skip_waves_56804 - 1)) == 0)) {\n                // read array element\n                {\n                    eta_p_56789 = ((__local int64_t *) red_arr_i64_mem_56771)[sext_i32_i64(local_tid_56767 + offset_56803)];\n                    eta_p_56790 = ((__local double *) red_arr_f64_mem_56773)[sext_i32_i64(local_tid_56767 + offset_56803)];\n                }\n                // apply reduction operation\n                {\n                    bool zg_res_56791 = clBase_36811 < eta_p_56788;\n                    bool zg_res_56792 = clBase_36811 < eta_p_56790;\n                    bool x_56793 = zg_res_56791 && zg_res_56792;\n                    int64_t lifted_lambda_res_56794;\n                    double lifted_lambda_res_56795;\n                    \n                    if (x_56793)",
                                    " {\n                        lifted_lambda_res_56794 = (int64_t) -1;\n                        lifted_lambda_res_56795 = INFINITY;\n                    } else {\n                        bool zl_res_56796 = eta_p_56788 < eta_p_56790;\n                        int64_t lifted_lambda_res_f_res_56797;\n                        \n                        if (zl_res_56796) {\n                            lifted_lambda_res_f_res_56797 = eta_p_56787;\n                        } else {\n                            lifted_lambda_res_f_res_56797 = eta_p_56789;\n                        }\n                        \n                        double lifted_lambda_res_f_res_56798;\n                        \n                        if (zl_res_56796) {\n                            lifted_lambda_res_f_res_56798 = eta_p_56788;\n                        } else {\n                            lifted_lambda_res_f_res_56798 = eta_p_56790;\n                        }\n                        lifted_lambda_res_56794 = lifted_lambda_res_f_res_56797;\n                        lifted_lambda_res_56795 = lifted_lambda_res_f_res_56798;\n                    }\n                    eta_p_56787 = lifted_lambda_res_56794;\n                    eta_p_56788 = lifted_lambda_res_56795;\n                }\n                // write result of operation\n                {\n                    ((__local int64_t *) red_arr_i64_mem_56771)[sext_i32_i64(local_tid_56767)] = eta_p_56787;\n                    ((__local double *) red_arr_f64_mem_56773)[sext_i32_i64(local_tid_56767)] = eta_p_56788;\n                }\n            }\n            skip_waves_56804 *= 2;\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        barrier(CLK_LOCAL_MEM_FENCE);\n        // thread 0 updates per-block acc(s); rest reset to ne\n        {\n            if (sext_i32_i64(local_tid_56767) == (int64_t) 0) {\n                eta_p_block_res_acc_56785 = eta_p_56787;\n                eta_p_block_res_acc_56786 = eta_p_56788;\n            } else {\n                eta_p_block_res_acc_56785 = (int", "64_t) -1;\n                eta_p_block_res_acc_56786 = INFINITY;\n            }\n        }\n        if (blocks_per_segment_56756 == (int64_t) 1) {\n            // first thread in block saves final result to memory\n            {\n                if (local_tid_56767 == 0) {\n                    ((__global int64_t *) mem_53556)[inf_44560 + gtid_49138] = eta_p_block_res_acc_56785;\n                    ((__global double *) mem_54274)[gtid_49138] = eta_p_block_res_acc_56786;\n                }\n            }\n        } else {\n            int32_t old_counter_56805;\n            bool is_last_block_56806;\n            \n            // first thread in block saves block result to global memory\n            {\n                if (local_tid_56767 == 0) {\n                    ((__global int64_t *) segred_tmp_mem_56760)[sext_i32_i64(virt_tblock_id_56780)] = eta_p_block_res_acc_56785;\n                    mem_fence_global();\n                    ((__global double *) segred_tmp_mem_56762)[sext_i32_i64(virt_tblock_id_56780)] = eta_p_block_res_acc_56786;\n                    mem_fence_global();\n                    old_counter_56805 = atomic_add_i32_global(&((volatile __global int *) counters_mem_56764)[srem64(flat_segment_id_56781, (int64_t) 20480)], (int) 1);\n                    ((__local bool *) sync_arr_mem_56775)[(int64_t) 0] = old_counter_56805 == sext_i64_i32(blocks_per_segment_56756 - (int64_t) 1);\n                }\n            }\n            barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n            is_last_block_56806 = ((__local bool *) sync_arr_mem_56775)[(int64_t) 0];\n            if (is_last_block_56806) {\n                if (local_tid_56767 == 0) {\n                    old_counter_56805 = atomic_add_i32_global(&((volatile __global int *) counters_mem_56764)[srem64(flat_segment_id_56781, (int64_t) 20480)], (int) sext_i64_i32((int64_t) 0 - blocks_per_segment_56756));\n                }\n                // read in the per-block-results\n                {\n                    int64_t read_per_th", "read_56807 = sdiv_up64(blocks_per_segment_56756, segred_tblock_sizze_49133);\n                    \n                    eta_p_49141 = (int64_t) -1;\n                    eta_p_49142 = INFINITY;\n                    for (int64_t i_56808 = 0; i_56808 < read_per_thread_56807; i_56808++) {\n                        int64_t block_res_id_56809 = sext_i32_i64(local_tid_56767) * read_per_thread_56807 + i_56808;\n                        int64_t index_of_block_res_56810 = flat_segment_id_56781 * blocks_per_segment_56756 + block_res_id_56809;\n                        \n                        if (slt64(block_res_id_56809, blocks_per_segment_56756)) {\n                            eta_p_49143 = ((__global int64_t *) segred_tmp_mem_56760)[index_of_block_res_56810];\n                            eta_p_49144 = ((__global double *) segred_tmp_mem_56762)[index_of_block_res_56810];\n                            \n                            bool zg_res_49145 = clBase_36811 < eta_p_49142;\n                            bool zg_res_49146 = clBase_36811 < eta_p_49144;\n                            bool x_49147 = zg_res_49145 && zg_res_49146;\n                            int64_t lifted_lambda_res_49148;\n                            double lifted_lambda_res_49149;\n                            \n                            if (x_49147) {\n                                lifted_lambda_res_49148 = (int64_t) -1;\n                                lifted_lambda_res_49149 = INFINITY;\n                            } else {\n                                bool zl_res_49150 = eta_p_49142 < eta_p_49144;\n                                int64_t lifted_lambda_res_f_res_49151;\n                                \n                                if (zl_res_49150) {\n                                    lifted_lambda_res_f_res_49151 = eta_p_49141;\n                                } else {\n                                    lifted_lambda_res_f_res_49151 = eta_p_49143;\n                                }\n                                \n        ",
                                    "                        double lifted_lambda_res_f_res_49152;\n                                \n                                if (zl_res_49150) {\n                                    lifted_lambda_res_f_res_49152 = eta_p_49142;\n                                } else {\n                                    lifted_lambda_res_f_res_49152 = eta_p_49144;\n                                }\n                                lifted_lambda_res_49148 = lifted_lambda_res_f_res_49151;\n                                lifted_lambda_res_49149 = lifted_lambda_res_f_res_49152;\n                            }\n                            eta_p_49141 = lifted_lambda_res_49148;\n                            eta_p_49142 = lifted_lambda_res_49149;\n                        }\n                    }\n                }\n                ((__local int64_t *) red_arr_i64_mem_56771)[sext_i32_i64(local_tid_56767)] = eta_p_49141;\n                ((__local double *) red_arr_f64_mem_56773)[sext_i32_i64(local_tid_56767)] = eta_p_49142;\n                barrier(CLK_LOCAL_MEM_FENCE);\n                // reduce the per-block results\n                {\n                    int32_t offset_56811;\n                    int32_t skip_waves_56812 = 1;\n                    int64_t eta_p_56787;\n                    double eta_p_56788;\n                    int64_t eta_p_56789;\n                    double eta_p_56790;\n                    \n                    offset_56811 = 0;\n                    // participating threads read initial accumulator\n                    {\n                        if (slt32(local_tid_56767, sext_i64_i32(segred_tblock_sizze_49133))) {\n                            eta_p_56787 = ((__local int64_t *) red_arr_i64_mem_56771)[sext_i32_i64(local_tid_56767 + offset_56811)];\n                            eta_p_56788 = ((__local double *) red_arr_f64_mem_56773)[sext_i32_i64(local_tid_56767 + offset_56811)];\n                        }\n                    }\n                    offset_56811 = 1;\n                    while (slt32(o", "ffset_56811, wave_sizze_56769)) {\n                        if (slt32(local_tid_56767 + offset_56811, sext_i64_i32(segred_tblock_sizze_49133)) && ((local_tid_56767 - squot32(local_tid_56767, wave_sizze_56769) * wave_sizze_56769) & (2 * offset_56811 - 1)) == 0) {\n                            // read array element\n                            {\n                                eta_p_56789 = ((volatile __local int64_t *) red_arr_i64_mem_56771)[sext_i32_i64(local_tid_56767 + offset_56811)];\n                                eta_p_56790 = ((volatile __local double *) red_arr_f64_mem_56773)[sext_i32_i64(local_tid_56767 + offset_56811)];\n                            }\n                            // apply reduction operation\n                            {\n                                bool zg_res_56791 = clBase_36811 < eta_p_56788;\n                                bool zg_res_56792 = clBase_36811 < eta_p_56790;\n                                bool x_56793 = zg_res_56791 && zg_res_56792;\n                                int64_t lifted_lambda_res_56794;\n                                double lifted_lambda_res_56795;\n                                \n                                if (x_56793) {\n                                    lifted_lambda_res_56794 = (int64_t) -1;\n                                    lifted_lambda_res_56795 = INFINITY;\n                                } else {\n                                    bool zl_res_56796 = eta_p_56788 < eta_p_56790;\n                                    int64_t lifted_lambda_res_f_res_56797;\n                                    \n                                    if (zl_res_56796) {\n                                        lifted_lambda_res_f_res_56797 = eta_p_56787;\n                                    } else {\n                                        lifted_lambda_res_f_res_56797 = eta_p_56789;\n                                    }\n                                    \n                                    double lifted_lambda_res_f_res_56798;\n ", "                                   \n                                    if (zl_res_56796) {\n                                        lifted_lambda_res_f_res_56798 = eta_p_56788;\n                                    } else {\n                                        lifted_lambda_res_f_res_56798 = eta_p_56790;\n                                    }\n                                    lifted_lambda_res_56794 = lifted_lambda_res_f_res_56797;\n                                    lifted_lambda_res_56795 = lifted_lambda_res_f_res_56798;\n                                }\n                                eta_p_56787 = lifted_lambda_res_56794;\n                                eta_p_56788 = lifted_lambda_res_56795;\n                            }\n                            // write result of operation\n                            {\n                                ((volatile __local int64_t *) red_arr_i64_mem_56771)[sext_i32_i64(local_tid_56767)] = eta_p_56787;\n                                ((volatile __local double *) red_arr_f64_mem_56773)[sext_i32_i64(local_tid_56767)] = eta_p_56788;\n                            }\n                        }\n                        offset_56811 *= 2;\n                    }\n                    while (slt32(skip_waves_56812, squot32(sext_i64_i32(segred_tblock_sizze_49133) + wave_sizze_56769 - 1, wave_sizze_56769))) {\n                        barrier(CLK_LOCAL_MEM_FENCE);\n                        offset_56811 = skip_waves_56812 * wave_sizze_56769;\n                        if (slt32(local_tid_56767 + offset_56811, sext_i64_i32(segred_tblock_sizze_49133)) && ((local_tid_56767 - squot32(local_tid_56767, wave_sizze_56769) * wave_sizze_56769) == 0 && (squot32(local_tid_56767, wave_sizze_56769) & (2 * skip_waves_56812 - 1)) == 0)) {\n                            // read array element\n                            {\n                                eta_p_56789 = ((__local int64_t *) red_arr_i64_mem_56771)[sext_i32_i64(local_tid_56767 + offset_56811)];\n                  ",
                                    "              eta_p_56790 = ((__local double *) red_arr_f64_mem_56773)[sext_i32_i64(local_tid_56767 + offset_56811)];\n                            }\n                            // apply reduction operation\n                            {\n                                bool zg_res_56791 = clBase_36811 < eta_p_56788;\n                                bool zg_res_56792 = clBase_36811 < eta_p_56790;\n                                bool x_56793 = zg_res_56791 && zg_res_56792;\n                                int64_t lifted_lambda_res_56794;\n                                double lifted_lambda_res_56795;\n                                \n                                if (x_56793) {\n                                    lifted_lambda_res_56794 = (int64_t) -1;\n                                    lifted_lambda_res_56795 = INFINITY;\n                                } else {\n                                    bool zl_res_56796 = eta_p_56788 < eta_p_56790;\n                                    int64_t lifted_lambda_res_f_res_56797;\n                                    \n                                    if (zl_res_56796) {\n                                        lifted_lambda_res_f_res_56797 = eta_p_56787;\n                                    } else {\n                                        lifted_lambda_res_f_res_56797 = eta_p_56789;\n                                    }\n                                    \n                                    double lifted_lambda_res_f_res_56798;\n                                    \n                                    if (zl_res_56796) {\n                                        lifted_lambda_res_f_res_56798 = eta_p_56788;\n                                    } else {\n                                        lifted_lambda_res_f_res_56798 = eta_p_56790;\n                                    }\n                                    lifted_lambda_res_56794 = lifted_lambda_res_f_res_56797;\n                                    lifted_lambda_res_56795 = lifted_lambda_", "res_f_res_56798;\n                                }\n                                eta_p_56787 = lifted_lambda_res_56794;\n                                eta_p_56788 = lifted_lambda_res_56795;\n                            }\n                            // write result of operation\n                            {\n                                ((__local int64_t *) red_arr_i64_mem_56771)[sext_i32_i64(local_tid_56767)] = eta_p_56787;\n                                ((__local double *) red_arr_f64_mem_56773)[sext_i32_i64(local_tid_56767)] = eta_p_56788;\n                            }\n                        }\n                        skip_waves_56812 *= 2;\n                    }\n                    barrier(CLK_LOCAL_MEM_FENCE);\n                    // and back to memory with the final result\n                    {\n                        if (local_tid_56767 == 0) {\n                            ((__global int64_t *) mem_53556)[inf_44560 + gtid_49138] = eta_p_56787;\n                            ((__global double *) mem_54274)[gtid_49138] = eta_p_56788;\n                        }\n                    }\n                }\n            }\n        }\n        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    }\n    \n  error_6:\n    return;\n    #undef segred_tblock_sizze_49133\n    #undef chunk_sizze_56715\n}\nFUTHARK_KERNEL_SIZED(do_DBSCAN_doublezisegred_nonseg_47317_dim1, 1, 1)\nvoid do_DBSCAN_doublezisegred_nonseg_47317(__global int *global_failure, int64_t conc_tmp_43977, int64_t num_tblocks_47312, int64_t num_threads_55538, __global unsigned char *mem_param_53649, __global unsigned char *ext_mem_53722, __global unsigned char *mem_53724, __global unsigned char *counters_mem_55534, __global unsigned char *segred_tmp_mem_55536)\n{\n    #define segred_tblock_sizze_47310 (do_DBSCAN_doublezisegred_nonseg_47317zisegred_tblock_sizze_47310)\n    #define chunk_sizze_55533 (do_DBSCAN_doublezisegred_nonseg_47317zichunk_sizze_55533)\n    \n    volatile __local unsigned char *sync_arr_mem_55546_backing_1 =", " &shared_mem[0];\n    const int64_t sync_arr_mem_55546_backing_1_offset = 0 + 8;\n    volatile __local unsigned char *red_arr_bool_mem_55544_backing_0 = &shared_mem[sync_arr_mem_55546_backing_1_offset];\n    const int64_t red_arr_bool_mem_55544_backing_0_offset = sync_arr_mem_55546_backing_1_offset + (segred_tblock_sizze_47310 + srem64((int64_t) 8 - srem64(segred_tblock_sizze_47310, (int64_t) 8), (int64_t) 8));\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_55540;\n    int32_t tblock_sizze_55543;\n    int32_t wave_sizze_55542;\n    int32_t block_id_55541;\n    int32_t global_tid_55539;\n    int64_t phys_tid_47317;\n    __local unsigned char *red_arr_bool_mem_55544;\n    __local unsigned char *sync_arr_mem_55546;\n    int64_t dummy_47315;\n    int64_t gtid_47316;\n    int64_t q_55548;\n    bool eta_p_block_res_acc_55549;\n    bool eta_p_44086;\n    bool eta_p_44087;\n    int64_t tblock_id_in_segment_55553;\n    int64_t block_base_offset_55554;\n    int32_t offset_55557;\n    int32_t skip_waves_55558;\n    bool eta_p_55550;\n    bool eta_p_55551;\n    int32_t old_counter_55559;\n    bool is_last_block_55560;\n    \n    local_tid_55540 = get_local_id(0);\n    tblock_sizze_55543 = get_local_size(0);\n    wave_sizze_55542 = LOCKSTEP_WIDTH;\n    block_id_55541 = get_tblock_id(0);\n    global_tid_55539 = block_id_55541 * tblock_sizze_55543 + local_tid_55540;\n    phys_tid_47317 = sext_i32_i64(global_tid_55539);\n    red_arr_bool_mem_55544 = (__local unsigned char *) red_arr_bool_mem_55544_backing_0;\n    sync_arr_mem_55546 = (__local unsigned char *) sync_arr_mem_55546_backing_1;\n    dummy_47315 = (int64_t) 0;\n    gtid_47316 = (int64_t) 0;\n    q_55548 = sdiv_up64(conc_tmp_43977, sext_i32_i64(sext_i64_i32(segred_tblock_sizze_47310 * num_tblocks_47312)) * chunk_sizze_55533);\n    // ne-initialise the outer (per-block) accumulator(s)\n    {\n        eta_p_block_res_acc_55549 = 1;\n    }\n    tblock_id_in_segment_55553 = squot64(phys_tid_47317, segred_tblock_sizze_47310);\n    block_b",
                                    "ase_offset_55554 = tblock_id_in_segment_55553 * q_55548 * segred_tblock_sizze_47310;\n    for (int64_t i_55555 = 0; i_55555 < q_55548; i_55555++) {\n        int64_t block_offset_55556 = block_base_offset_55554 + i_55555 * segred_tblock_sizze_47310;\n        \n        gtid_47316 = phys_tid_47317 + num_threads_55538 * i_55555;\n        if (slt64(gtid_47316, conc_tmp_43977)) {\n            // apply map function(s)\n            {\n                // apply map function\n                {\n                    int64_t eta_p_45128 = ((__global int64_t *) mem_param_53649)[gtid_47316];\n                    int64_t eta_p_45129 = ((__global int64_t *) ext_mem_53722)[gtid_47316];\n                    bool defunc_0_f_res_45130 = eta_p_45128 == eta_p_45129;\n                    \n                    // load accumulator(s)\n                    {\n                        eta_p_44086 = eta_p_block_res_acc_55549;\n                    }\n                    // load next value(s)\n                    {\n                        eta_p_44087 = defunc_0_f_res_45130;\n                    }\n                    // apply reduction operator(s)\n                    {\n                        bool x_44088 = eta_p_44086 && eta_p_44087;\n                        \n                        // store in accumulator(s)\n                        {\n                            eta_p_block_res_acc_55549 = x_44088;\n                        }\n                    }\n                }\n            }\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // store accs. prims go in lmem; non-prims in params (in global mem)\n    {\n        ((__local bool *) red_arr_bool_mem_55544)[sext_i32_i64(local_tid_55540)] = eta_p_block_res_acc_55549;\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    skip_waves_55558 = 1;\n    offset_55557 = 0;\n    // participating threads read initial accumulator\n    {\n        if (slt32(local_tid_55540, sext_i64_i32(segred_tblock_sizze_47310))) {\n            eta_p_55550 = ((__local bool *) red_arr_bool_mem_55544)[sext_i32_i64(local_", "tid_55540 + offset_55557)];\n        }\n    }\n    offset_55557 = 1;\n    while (slt32(offset_55557, wave_sizze_55542)) {\n        if (slt32(local_tid_55540 + offset_55557, sext_i64_i32(segred_tblock_sizze_47310)) && ((local_tid_55540 - squot32(local_tid_55540, wave_sizze_55542) * wave_sizze_55542) & (2 * offset_55557 - 1)) == 0) {\n            // read array element\n            {\n                eta_p_55551 = ((volatile __local bool *) red_arr_bool_mem_55544)[sext_i32_i64(local_tid_55540 + offset_55557)];\n            }\n            // apply reduction operation\n            {\n                bool x_55552 = eta_p_55550 && eta_p_55551;\n                \n                eta_p_55550 = x_55552;\n            }\n            // write result of operation\n            {\n                ((volatile __local bool *) red_arr_bool_mem_55544)[sext_i32_i64(local_tid_55540)] = eta_p_55550;\n            }\n        }\n        offset_55557 *= 2;\n    }\n    while (slt32(skip_waves_55558, squot32(sext_i64_i32(segred_tblock_sizze_47310) + wave_sizze_55542 - 1, wave_sizze_55542))) {\n        barrier(CLK_LOCAL_MEM_FENCE);\n        offset_55557 = skip_waves_55558 * wave_sizze_55542;\n        if (slt32(local_tid_55540 + offset_55557, sext_i64_i32(segred_tblock_sizze_47310)) && ((local_tid_55540 - squot32(local_tid_55540, wave_sizze_55542) * wave_sizze_55542) == 0 && (squot32(local_tid_55540, wave_sizze_55542) & (2 * skip_waves_55558 - 1)) == 0)) {\n            // read array element\n            {\n                eta_p_55551 = ((__local bool *) red_arr_bool_mem_55544)[sext_i32_i64(local_tid_55540 + offset_55557)];\n            }\n            // apply reduction operation\n            {\n                bool x_55552 = eta_p_55550 && eta_p_55551;\n                \n                eta_p_55550 = x_55552;\n            }\n            // write result of operation\n            {\n                ((__local bool *) red_arr_bool_mem_55544)[sext_i32_i64(local_tid_55540)] = eta_p_55550;\n            }\n        }\n        skip_waves_55558 *= 2", ";\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // thread 0 updates per-block acc(s); rest reset to ne\n    {\n        if (sext_i32_i64(local_tid_55540) == (int64_t) 0) {\n            eta_p_block_res_acc_55549 = eta_p_55550;\n        } else {\n            eta_p_block_res_acc_55549 = 1;\n        }\n    }\n    // first thread in block saves block result to global memory\n    {\n        if (local_tid_55540 == 0) {\n            ((__global bool *) segred_tmp_mem_55536)[sext_i32_i64(block_id_55541)] = eta_p_block_res_acc_55549;\n            mem_fence_global();\n            old_counter_55559 = atomic_add_i32_global(&((volatile __global int *) counters_mem_55534)[(int64_t) 0], (int) 1);\n            ((__local bool *) sync_arr_mem_55546)[(int64_t) 0] = old_counter_55559 == sext_i64_i32(num_tblocks_47312 - (int64_t) 1);\n        }\n    }\n    barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    is_last_block_55560 = ((__local bool *) sync_arr_mem_55546)[(int64_t) 0];\n    if (is_last_block_55560) {\n        if (local_tid_55540 == 0) {\n            old_counter_55559 = atomic_add_i32_global(&((volatile __global int *) counters_mem_55534)[(int64_t) 0], (int) sext_i64_i32((int64_t) 0 - num_tblocks_47312));\n        }\n        // read in the per-block-results\n        {\n            int64_t read_per_thread_55561 = sdiv_up64(num_tblocks_47312, segred_tblock_sizze_47310);\n            \n            eta_p_44086 = 1;\n            for (int64_t i_55562 = 0; i_55562 < read_per_thread_55561; i_55562++) {\n                int64_t block_res_id_55563 = sext_i32_i64(local_tid_55540) * read_per_thread_55561 + i_55562;\n                int64_t index_of_block_res_55564 = block_res_id_55563;\n                \n                if (slt64(block_res_id_55563, num_tblocks_47312)) {\n                    eta_p_44087 = ((__global bool *) segred_tmp_mem_55536)[index_of_block_res_55564];\n                    \n                    bool x_44088 = eta_p_44086 && eta_p_44087;\n                    \n           ",
                                    "         eta_p_44086 = x_44088;\n                }\n            }\n        }\n        ((__local bool *) red_arr_bool_mem_55544)[sext_i32_i64(local_tid_55540)] = eta_p_44086;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        // reduce the per-block results\n        {\n            int32_t offset_55565;\n            int32_t skip_waves_55566 = 1;\n            bool eta_p_55550;\n            bool eta_p_55551;\n            \n            offset_55565 = 0;\n            // participating threads read initial accumulator\n            {\n                if (slt32(local_tid_55540, sext_i64_i32(segred_tblock_sizze_47310))) {\n                    eta_p_55550 = ((__local bool *) red_arr_bool_mem_55544)[sext_i32_i64(local_tid_55540 + offset_55565)];\n                }\n            }\n            offset_55565 = 1;\n            while (slt32(offset_55565, wave_sizze_55542)) {\n                if (slt32(local_tid_55540 + offset_55565, sext_i64_i32(segred_tblock_sizze_47310)) && ((local_tid_55540 - squot32(local_tid_55540, wave_sizze_55542) * wave_sizze_55542) & (2 * offset_55565 - 1)) == 0) {\n                    // read array element\n                    {\n                        eta_p_55551 = ((volatile __local bool *) red_arr_bool_mem_55544)[sext_i32_i64(local_tid_55540 + offset_55565)];\n                    }\n                    // apply reduction operation\n                    {\n                        bool x_55552 = eta_p_55550 && eta_p_55551;\n                        \n                        eta_p_55550 = x_55552;\n                    }\n                    // write result of operation\n                    {\n                        ((volatile __local bool *) red_arr_bool_mem_55544)[sext_i32_i64(local_tid_55540)] = eta_p_55550;\n                    }\n                }\n                offset_55565 *= 2;\n            }\n            while (slt32(skip_waves_55566, squot32(sext_i64_i32(segred_tblock_sizze_47310) + wave_sizze_55542 - 1, wave_sizze_55542))) {\n                barrier(CLK_LOCAL_MEM_FENCE);\n                of", "fset_55565 = skip_waves_55566 * wave_sizze_55542;\n                if (slt32(local_tid_55540 + offset_55565, sext_i64_i32(segred_tblock_sizze_47310)) && ((local_tid_55540 - squot32(local_tid_55540, wave_sizze_55542) * wave_sizze_55542) == 0 && (squot32(local_tid_55540, wave_sizze_55542) & (2 * skip_waves_55566 - 1)) == 0)) {\n                    // read array element\n                    {\n                        eta_p_55551 = ((__local bool *) red_arr_bool_mem_55544)[sext_i32_i64(local_tid_55540 + offset_55565)];\n                    }\n                    // apply reduction operation\n                    {\n                        bool x_55552 = eta_p_55550 && eta_p_55551;\n                        \n                        eta_p_55550 = x_55552;\n                    }\n                    // write result of operation\n                    {\n                        ((__local bool *) red_arr_bool_mem_55544)[sext_i32_i64(local_tid_55540)] = eta_p_55550;\n                    }\n                }\n                skip_waves_55566 *= 2;\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // and back to memory with the final result\n            {\n                if (local_tid_55540 == 0) {\n                    ((__global bool *) mem_53724)[(int64_t) 0] = eta_p_55550;\n                }\n            }\n        }\n    }\n    \n  error_5:\n    return;\n    #undef segred_tblock_sizze_47310\n    #undef chunk_sizze_55533\n}\nFUTHARK_KERNEL_SIZED(do_DBSCAN_doublezisegred_nonseg_49196_dim1, 1, 1)\nvoid do_DBSCAN_doublezisegred_nonseg_49196(__global int *global_failure, int64_t n_36798, int64_t num_tblocks_49191, int64_t num_threads_56819, __global unsigned char *mem_53556, __global unsigned char *mem_54340, __global unsigned char *counters_mem_56815, __global unsigned char *segred_tmp_mem_56817)\n{\n    #define segred_tblock_sizze_49189 (do_DBSCAN_doublezisegred_nonseg_49196zisegred_tblock_sizze_49189)\n    #define chunk_sizze_56814 (do_DBSCAN_doublezisegred_nonseg_49196zichunk_sizze_56814)\n    ", "\n    volatile __local unsigned char *sync_arr_mem_56827_backing_1 = &shared_mem[0];\n    const int64_t sync_arr_mem_56827_backing_1_offset = 0 + 8;\n    volatile __local unsigned char *red_arr_i64_mem_56825_backing_0 = &shared_mem[sync_arr_mem_56827_backing_1_offset];\n    const int64_t red_arr_i64_mem_56825_backing_0_offset = sync_arr_mem_56827_backing_1_offset + ((int64_t) 8 * segred_tblock_sizze_49189 + srem64((int64_t) 8 - srem64((int64_t) 8 * segred_tblock_sizze_49189, (int64_t) 8), (int64_t) 8));\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_56821;\n    int32_t tblock_sizze_56824;\n    int32_t wave_sizze_56823;\n    int32_t block_id_56822;\n    int32_t global_tid_56820;\n    int64_t phys_tid_49196;\n    __local unsigned char *red_arr_i64_mem_56825;\n    __local unsigned char *sync_arr_mem_56827;\n    int64_t dummy_49194;\n    int64_t gtid_49195;\n    int64_t q_56829;\n    int64_t eta_p_block_res_acc_56830;\n    int64_t eta_p_44643;\n    int64_t eta_p_44644;\n    int64_t tblock_id_in_segment_56834;\n    int64_t block_base_offset_56835;\n    int32_t offset_56838;\n    int32_t skip_waves_56839;\n    int64_t eta_p_56831;\n    int64_t eta_p_56832;\n    int32_t old_counter_56840;\n    bool is_last_block_56841;\n    \n    local_tid_56821 = get_local_id(0);\n    tblock_sizze_56824 = get_local_size(0);\n    wave_sizze_56823 = LOCKSTEP_WIDTH;\n    block_id_56822 = get_tblock_id(0);\n    global_tid_56820 = block_id_56822 * tblock_sizze_56824 + local_tid_56821;\n    phys_tid_49196 = sext_i32_i64(global_tid_56820);\n    red_arr_i64_mem_56825 = (__local unsigned char *) red_arr_i64_mem_56825_backing_0;\n    sync_arr_mem_56827 = (__local unsigned char *) sync_arr_mem_56827_backing_1;\n    dummy_49194 = (int64_t) 0;\n    gtid_49195 = (int64_t) 0;\n    q_56829 = sdiv_up64(n_36798, sext_i32_i64(sext_i64_i32(segred_tblock_sizze_49189 * num_tblocks_49191)) * chunk_sizze_56814);\n    // ne-initialise the outer (per-block) accumulator(s)\n    {\n        eta_p_block_res_acc_56830 = (int64_",
                                    "t) -9223372036854775808;\n    }\n    tblock_id_in_segment_56834 = squot64(phys_tid_49196, segred_tblock_sizze_49189);\n    block_base_offset_56835 = tblock_id_in_segment_56834 * q_56829 * segred_tblock_sizze_49189;\n    for (int64_t i_56836 = 0; i_56836 < q_56829; i_56836++) {\n        int64_t block_offset_56837 = block_base_offset_56835 + i_56836 * segred_tblock_sizze_49189;\n        \n        gtid_49195 = phys_tid_49196 + num_threads_56819 * i_56836;\n        if (slt64(gtid_49195, n_36798)) {\n            // apply map function(s)\n            {\n                // apply map function\n                {\n                    int64_t x_44642 = ((__global int64_t *) mem_53556)[gtid_49195];\n                    \n                    // load accumulator(s)\n                    {\n                        eta_p_44643 = eta_p_block_res_acc_56830;\n                    }\n                    // load next value(s)\n                    {\n                        eta_p_44644 = x_44642;\n                    }\n                    // apply reduction operator(s)\n                    {\n                        int64_t max_res_44645 = smax64(eta_p_44643, eta_p_44644);\n                        \n                        // store in accumulator(s)\n                        {\n                            eta_p_block_res_acc_56830 = max_res_44645;\n                        }\n                    }\n                }\n            }\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // store accs. prims go in lmem; non-prims in params (in global mem)\n    {\n        ((__local int64_t *) red_arr_i64_mem_56825)[sext_i32_i64(local_tid_56821)] = eta_p_block_res_acc_56830;\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    skip_waves_56839 = 1;\n    offset_56838 = 0;\n    // participating threads read initial accumulator\n    {\n        if (slt32(local_tid_56821, sext_i64_i32(segred_tblock_sizze_49189))) {\n            eta_p_56831 = ((__local int64_t *) red_arr_i64_mem_56825)[sext_i32_i64(local_tid_56821 + offset_56838)];\n        }\n    }\n  ", "  offset_56838 = 1;\n    while (slt32(offset_56838, wave_sizze_56823)) {\n        if (slt32(local_tid_56821 + offset_56838, sext_i64_i32(segred_tblock_sizze_49189)) && ((local_tid_56821 - squot32(local_tid_56821, wave_sizze_56823) * wave_sizze_56823) & (2 * offset_56838 - 1)) == 0) {\n            // read array element\n            {\n                eta_p_56832 = ((volatile __local int64_t *) red_arr_i64_mem_56825)[sext_i32_i64(local_tid_56821 + offset_56838)];\n            }\n            // apply reduction operation\n            {\n                int64_t max_res_56833 = smax64(eta_p_56831, eta_p_56832);\n                \n                eta_p_56831 = max_res_56833;\n            }\n            // write result of operation\n            {\n                ((volatile __local int64_t *) red_arr_i64_mem_56825)[sext_i32_i64(local_tid_56821)] = eta_p_56831;\n            }\n        }\n        offset_56838 *= 2;\n    }\n    while (slt32(skip_waves_56839, squot32(sext_i64_i32(segred_tblock_sizze_49189) + wave_sizze_56823 - 1, wave_sizze_56823))) {\n        barrier(CLK_LOCAL_MEM_FENCE);\n        offset_56838 = skip_waves_56839 * wave_sizze_56823;\n        if (slt32(local_tid_56821 + offset_56838, sext_i64_i32(segred_tblock_sizze_49189)) && ((local_tid_56821 - squot32(local_tid_56821, wave_sizze_56823) * wave_sizze_56823) == 0 && (squot32(local_tid_56821, wave_sizze_56823) & (2 * skip_waves_56839 - 1)) == 0)) {\n            // read array element\n            {\n                eta_p_56832 = ((__local int64_t *) red_arr_i64_mem_56825)[sext_i32_i64(local_tid_56821 + offset_56838)];\n            }\n            // apply reduction operation\n            {\n                int64_t max_res_56833 = smax64(eta_p_56831, eta_p_56832);\n                \n                eta_p_56831 = max_res_56833;\n            }\n            // write result of operation\n            {\n                ((__local int64_t *) red_arr_i64_mem_56825)[sext_i32_i64(local_tid_56821)] = eta_p_56831;\n            }\n        }\n        skip_waves_56839 ", "*= 2;\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // thread 0 updates per-block acc(s); rest reset to ne\n    {\n        if (sext_i32_i64(local_tid_56821) == (int64_t) 0) {\n            eta_p_block_res_acc_56830 = eta_p_56831;\n        } else {\n            eta_p_block_res_acc_56830 = (int64_t) -9223372036854775808;\n        }\n    }\n    // first thread in block saves block result to global memory\n    {\n        if (local_tid_56821 == 0) {\n            ((__global int64_t *) segred_tmp_mem_56817)[sext_i32_i64(block_id_56822)] = eta_p_block_res_acc_56830;\n            mem_fence_global();\n            old_counter_56840 = atomic_add_i32_global(&((volatile __global int *) counters_mem_56815)[(int64_t) 0], (int) 1);\n            ((__local bool *) sync_arr_mem_56827)[(int64_t) 0] = old_counter_56840 == sext_i64_i32(num_tblocks_49191 - (int64_t) 1);\n        }\n    }\n    barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    is_last_block_56841 = ((__local bool *) sync_arr_mem_56827)[(int64_t) 0];\n    if (is_last_block_56841) {\n        if (local_tid_56821 == 0) {\n            old_counter_56840 = atomic_add_i32_global(&((volatile __global int *) counters_mem_56815)[(int64_t) 0], (int) sext_i64_i32((int64_t) 0 - num_tblocks_49191));\n        }\n        // read in the per-block-results\n        {\n            int64_t read_per_thread_56842 = sdiv_up64(num_tblocks_49191, segred_tblock_sizze_49189);\n            \n            eta_p_44643 = (int64_t) -9223372036854775808;\n            for (int64_t i_56843 = 0; i_56843 < read_per_thread_56842; i_56843++) {\n                int64_t block_res_id_56844 = sext_i32_i64(local_tid_56821) * read_per_thread_56842 + i_56843;\n                int64_t index_of_block_res_56845 = block_res_id_56844;\n                \n                if (slt64(block_res_id_56844, num_tblocks_49191)) {\n                    eta_p_44644 = ((__global int64_t *) segred_tmp_mem_56817)[index_of_block_res_56845];\n                    \n                    int64_t",
                                    " max_res_44645 = smax64(eta_p_44643, eta_p_44644);\n                    \n                    eta_p_44643 = max_res_44645;\n                }\n            }\n        }\n        ((__local int64_t *) red_arr_i64_mem_56825)[sext_i32_i64(local_tid_56821)] = eta_p_44643;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        // reduce the per-block results\n        {\n            int32_t offset_56846;\n            int32_t skip_waves_56847 = 1;\n            int64_t eta_p_56831;\n            int64_t eta_p_56832;\n            \n            offset_56846 = 0;\n            // participating threads read initial accumulator\n            {\n                if (slt32(local_tid_56821, sext_i64_i32(segred_tblock_sizze_49189))) {\n                    eta_p_56831 = ((__local int64_t *) red_arr_i64_mem_56825)[sext_i32_i64(local_tid_56821 + offset_56846)];\n                }\n            }\n            offset_56846 = 1;\n            while (slt32(offset_56846, wave_sizze_56823)) {\n                if (slt32(local_tid_56821 + offset_56846, sext_i64_i32(segred_tblock_sizze_49189)) && ((local_tid_56821 - squot32(local_tid_56821, wave_sizze_56823) * wave_sizze_56823) & (2 * offset_56846 - 1)) == 0) {\n                    // read array element\n                    {\n                        eta_p_56832 = ((volatile __local int64_t *) red_arr_i64_mem_56825)[sext_i32_i64(local_tid_56821 + offset_56846)];\n                    }\n                    // apply reduction operation\n                    {\n                        int64_t max_res_56833 = smax64(eta_p_56831, eta_p_56832);\n                        \n                        eta_p_56831 = max_res_56833;\n                    }\n                    // write result of operation\n                    {\n                        ((volatile __local int64_t *) red_arr_i64_mem_56825)[sext_i32_i64(local_tid_56821)] = eta_p_56831;\n                    }\n                }\n                offset_56846 *= 2;\n            }\n            while (slt32(skip_waves_56847, squot32(sext_i64_i32(segred_tblock", "_sizze_49189) + wave_sizze_56823 - 1, wave_sizze_56823))) {\n                barrier(CLK_LOCAL_MEM_FENCE);\n                offset_56846 = skip_waves_56847 * wave_sizze_56823;\n                if (slt32(local_tid_56821 + offset_56846, sext_i64_i32(segred_tblock_sizze_49189)) && ((local_tid_56821 - squot32(local_tid_56821, wave_sizze_56823) * wave_sizze_56823) == 0 && (squot32(local_tid_56821, wave_sizze_56823) & (2 * skip_waves_56847 - 1)) == 0)) {\n                    // read array element\n                    {\n                        eta_p_56832 = ((__local int64_t *) red_arr_i64_mem_56825)[sext_i32_i64(local_tid_56821 + offset_56846)];\n                    }\n                    // apply reduction operation\n                    {\n                        int64_t max_res_56833 = smax64(eta_p_56831, eta_p_56832);\n                        \n                        eta_p_56831 = max_res_56833;\n                    }\n                    // write result of operation\n                    {\n                        ((__local int64_t *) red_arr_i64_mem_56825)[sext_i32_i64(local_tid_56821)] = eta_p_56831;\n                    }\n                }\n                skip_waves_56847 *= 2;\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // and back to memory with the final result\n            {\n                if (local_tid_56821 == 0) {\n                    ((__global int64_t *) mem_54340)[(int64_t) 0] = eta_p_56831;\n                }\n            }\n        }\n    }\n    \n  error_5:\n    return;\n    #undef segred_tblock_sizze_49189\n    #undef chunk_sizze_56814\n}\nFUTHARK_KERNEL_SIZED(do_DBSCAN_doublezisegred_nonseg_49206_dim1, 1, 1)\nvoid do_DBSCAN_doublezisegred_nonseg_49206(__global int *global_failure, int64_t partition_sizze_43809, int64_t num_tblocks_49201, int64_t num_threads_56854, __global unsigned char *mem_53626, __global unsigned char *mem_54342, __global unsigned char *counters_mem_56850, __global unsigned char *segred_tmp_mem_56852)\n{\n    #define segred_tblock_sizze_", "49199 (do_DBSCAN_doublezisegred_nonseg_49206zisegred_tblock_sizze_49199)\n    #define chunk_sizze_56849 (do_DBSCAN_doublezisegred_nonseg_49206zichunk_sizze_56849)\n    \n    volatile __local unsigned char *sync_arr_mem_56862_backing_1 = &shared_mem[0];\n    const int64_t sync_arr_mem_56862_backing_1_offset = 0 + 8;\n    volatile __local unsigned char *red_arr_i64_mem_56860_backing_0 = &shared_mem[sync_arr_mem_56862_backing_1_offset];\n    const int64_t red_arr_i64_mem_56860_backing_0_offset = sync_arr_mem_56862_backing_1_offset + ((int64_t) 8 * segred_tblock_sizze_49199 + srem64((int64_t) 8 - srem64((int64_t) 8 * segred_tblock_sizze_49199, (int64_t) 8), (int64_t) 8));\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_56856;\n    int32_t tblock_sizze_56859;\n    int32_t wave_sizze_56858;\n    int32_t block_id_56857;\n    int32_t global_tid_56855;\n    int64_t phys_tid_49206;\n    __local unsigned char *red_arr_i64_mem_56860;\n    __local unsigned char *sync_arr_mem_56862;\n    int64_t dummy_49204;\n    int64_t gtid_49205;\n    int64_t q_56864;\n    int64_t eta_p_block_res_acc_56865;\n    int64_t eta_p_44648;\n    int64_t eta_p_44649;\n    int64_t tblock_id_in_segment_56869;\n    int64_t block_base_offset_56870;\n    int32_t offset_56873;\n    int32_t skip_waves_56874;\n    int64_t eta_p_56866;\n    int64_t eta_p_56867;\n    int32_t old_counter_56875;\n    bool is_last_block_56876;\n    \n    local_tid_56856 = get_local_id(0);\n    tblock_sizze_56859 = get_local_size(0);\n    wave_sizze_56858 = LOCKSTEP_WIDTH;\n    block_id_56857 = get_tblock_id(0);\n    global_tid_56855 = block_id_56857 * tblock_sizze_56859 + local_tid_56856;\n    phys_tid_49206 = sext_i32_i64(global_tid_56855);\n    red_arr_i64_mem_56860 = (__local unsigned char *) red_arr_i64_mem_56860_backing_0;\n    sync_arr_mem_56862 = (__local unsigned char *) sync_arr_mem_56862_backing_1;\n    dummy_49204 = (int64_t) 0;\n    gtid_49205 = (int64_t) 0;\n    q_56864 = sdiv_up64(partition_sizze_43809, sext_i32_i64(sext_i64_i",
                                    "32(segred_tblock_sizze_49199 * num_tblocks_49201)) * chunk_sizze_56849);\n    // ne-initialise the outer (per-block) accumulator(s)\n    {\n        eta_p_block_res_acc_56865 = (int64_t) -9223372036854775808;\n    }\n    tblock_id_in_segment_56869 = squot64(phys_tid_49206, segred_tblock_sizze_49199);\n    block_base_offset_56870 = tblock_id_in_segment_56869 * q_56864 * segred_tblock_sizze_49199;\n    for (int64_t i_56871 = 0; i_56871 < q_56864; i_56871++) {\n        int64_t block_offset_56872 = block_base_offset_56870 + i_56871 * segred_tblock_sizze_49199;\n        \n        gtid_49205 = phys_tid_49206 + num_threads_56854 * i_56871;\n        if (slt64(gtid_49205, partition_sizze_43809)) {\n            // apply map function(s)\n            {\n                // apply map function\n                {\n                    int64_t x_44647 = ((__global int64_t *) mem_53626)[gtid_49205];\n                    \n                    // load accumulator(s)\n                    {\n                        eta_p_44648 = eta_p_block_res_acc_56865;\n                    }\n                    // load next value(s)\n                    {\n                        eta_p_44649 = x_44647;\n                    }\n                    // apply reduction operator(s)\n                    {\n                        int64_t max_res_44650 = smax64(eta_p_44648, eta_p_44649);\n                        \n                        // store in accumulator(s)\n                        {\n                            eta_p_block_res_acc_56865 = max_res_44650;\n                        }\n                    }\n                }\n            }\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // store accs. prims go in lmem; non-prims in params (in global mem)\n    {\n        ((__local int64_t *) red_arr_i64_mem_56860)[sext_i32_i64(local_tid_56856)] = eta_p_block_res_acc_56865;\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    skip_waves_56874 = 1;\n    offset_56873 = 0;\n    // participating threads read initial accumulator\n    {\n        if (slt32(lo", "cal_tid_56856, sext_i64_i32(segred_tblock_sizze_49199))) {\n            eta_p_56866 = ((__local int64_t *) red_arr_i64_mem_56860)[sext_i32_i64(local_tid_56856 + offset_56873)];\n        }\n    }\n    offset_56873 = 1;\n    while (slt32(offset_56873, wave_sizze_56858)) {\n        if (slt32(local_tid_56856 + offset_56873, sext_i64_i32(segred_tblock_sizze_49199)) && ((local_tid_56856 - squot32(local_tid_56856, wave_sizze_56858) * wave_sizze_56858) & (2 * offset_56873 - 1)) == 0) {\n            // read array element\n            {\n                eta_p_56867 = ((volatile __local int64_t *) red_arr_i64_mem_56860)[sext_i32_i64(local_tid_56856 + offset_56873)];\n            }\n            // apply reduction operation\n            {\n                int64_t max_res_56868 = smax64(eta_p_56866, eta_p_56867);\n                \n                eta_p_56866 = max_res_56868;\n            }\n            // write result of operation\n            {\n                ((volatile __local int64_t *) red_arr_i64_mem_56860)[sext_i32_i64(local_tid_56856)] = eta_p_56866;\n            }\n        }\n        offset_56873 *= 2;\n    }\n    while (slt32(skip_waves_56874, squot32(sext_i64_i32(segred_tblock_sizze_49199) + wave_sizze_56858 - 1, wave_sizze_56858))) {\n        barrier(CLK_LOCAL_MEM_FENCE);\n        offset_56873 = skip_waves_56874 * wave_sizze_56858;\n        if (slt32(local_tid_56856 + offset_56873, sext_i64_i32(segred_tblock_sizze_49199)) && ((local_tid_56856 - squot32(local_tid_56856, wave_sizze_56858) * wave_sizze_56858) == 0 && (squot32(local_tid_56856, wave_sizze_56858) & (2 * skip_waves_56874 - 1)) == 0)) {\n            // read array element\n            {\n                eta_p_56867 = ((__local int64_t *) red_arr_i64_mem_56860)[sext_i32_i64(local_tid_56856 + offset_56873)];\n            }\n            // apply reduction operation\n            {\n                int64_t max_res_56868 = smax64(eta_p_56866, eta_p_56867);\n                \n                eta_p_56866 = max_res_56868;\n            }\n            // w", "rite result of operation\n            {\n                ((__local int64_t *) red_arr_i64_mem_56860)[sext_i32_i64(local_tid_56856)] = eta_p_56866;\n            }\n        }\n        skip_waves_56874 *= 2;\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // thread 0 updates per-block acc(s); rest reset to ne\n    {\n        if (sext_i32_i64(local_tid_56856) == (int64_t) 0) {\n            eta_p_block_res_acc_56865 = eta_p_56866;\n        } else {\n            eta_p_block_res_acc_56865 = (int64_t) -9223372036854775808;\n        }\n    }\n    // first thread in block saves block result to global memory\n    {\n        if (local_tid_56856 == 0) {\n            ((__global int64_t *) segred_tmp_mem_56852)[sext_i32_i64(block_id_56857)] = eta_p_block_res_acc_56865;\n            mem_fence_global();\n            old_counter_56875 = atomic_add_i32_global(&((volatile __global int *) counters_mem_56850)[(int64_t) 0], (int) 1);\n            ((__local bool *) sync_arr_mem_56862)[(int64_t) 0] = old_counter_56875 == sext_i64_i32(num_tblocks_49201 - (int64_t) 1);\n        }\n    }\n    barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    is_last_block_56876 = ((__local bool *) sync_arr_mem_56862)[(int64_t) 0];\n    if (is_last_block_56876) {\n        if (local_tid_56856 == 0) {\n            old_counter_56875 = atomic_add_i32_global(&((volatile __global int *) counters_mem_56850)[(int64_t) 0], (int) sext_i64_i32((int64_t) 0 - num_tblocks_49201));\n        }\n        // read in the per-block-results\n        {\n            int64_t read_per_thread_56877 = sdiv_up64(num_tblocks_49201, segred_tblock_sizze_49199);\n            \n            eta_p_44648 = (int64_t) -9223372036854775808;\n            for (int64_t i_56878 = 0; i_56878 < read_per_thread_56877; i_56878++) {\n                int64_t block_res_id_56879 = sext_i32_i64(local_tid_56856) * read_per_thread_56877 + i_56878;\n                int64_t index_of_block_res_56880 = block_res_id_56879;\n                \n                if (slt64(b",
                                    "lock_res_id_56879, num_tblocks_49201)) {\n                    eta_p_44649 = ((__global int64_t *) segred_tmp_mem_56852)[index_of_block_res_56880];\n                    \n                    int64_t max_res_44650 = smax64(eta_p_44648, eta_p_44649);\n                    \n                    eta_p_44648 = max_res_44650;\n                }\n            }\n        }\n        ((__local int64_t *) red_arr_i64_mem_56860)[sext_i32_i64(local_tid_56856)] = eta_p_44648;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        // reduce the per-block results\n        {\n            int32_t offset_56881;\n            int32_t skip_waves_56882 = 1;\n            int64_t eta_p_56866;\n            int64_t eta_p_56867;\n            \n            offset_56881 = 0;\n            // participating threads read initial accumulator\n            {\n                if (slt32(local_tid_56856, sext_i64_i32(segred_tblock_sizze_49199))) {\n                    eta_p_56866 = ((__local int64_t *) red_arr_i64_mem_56860)[sext_i32_i64(local_tid_56856 + offset_56881)];\n                }\n            }\n            offset_56881 = 1;\n            while (slt32(offset_56881, wave_sizze_56858)) {\n                if (slt32(local_tid_56856 + offset_56881, sext_i64_i32(segred_tblock_sizze_49199)) && ((local_tid_56856 - squot32(local_tid_56856, wave_sizze_56858) * wave_sizze_56858) & (2 * offset_56881 - 1)) == 0) {\n                    // read array element\n                    {\n                        eta_p_56867 = ((volatile __local int64_t *) red_arr_i64_mem_56860)[sext_i32_i64(local_tid_56856 + offset_56881)];\n                    }\n                    // apply reduction operation\n                    {\n                        int64_t max_res_56868 = smax64(eta_p_56866, eta_p_56867);\n                        \n                        eta_p_56866 = max_res_56868;\n                    }\n                    // write result of operation\n                    {\n                        ((volatile __local int64_t *) red_arr_i64_mem_56860)[sext_i32_i64(local", "_tid_56856)] = eta_p_56866;\n                    }\n                }\n                offset_56881 *= 2;\n            }\n            while (slt32(skip_waves_56882, squot32(sext_i64_i32(segred_tblock_sizze_49199) + wave_sizze_56858 - 1, wave_sizze_56858))) {\n                barrier(CLK_LOCAL_MEM_FENCE);\n                offset_56881 = skip_waves_56882 * wave_sizze_56858;\n                if (slt32(local_tid_56856 + offset_56881, sext_i64_i32(segred_tblock_sizze_49199)) && ((local_tid_56856 - squot32(local_tid_56856, wave_sizze_56858) * wave_sizze_56858) == 0 && (squot32(local_tid_56856, wave_sizze_56858) & (2 * skip_waves_56882 - 1)) == 0)) {\n                    // read array element\n                    {\n                        eta_p_56867 = ((__local int64_t *) red_arr_i64_mem_56860)[sext_i32_i64(local_tid_56856 + offset_56881)];\n                    }\n                    // apply reduction operation\n                    {\n                        int64_t max_res_56868 = smax64(eta_p_56866, eta_p_56867);\n                        \n                        eta_p_56866 = max_res_56868;\n                    }\n                    // write result of operation\n                    {\n                        ((__local int64_t *) red_arr_i64_mem_56860)[sext_i32_i64(local_tid_56856)] = eta_p_56866;\n                    }\n                }\n                skip_waves_56882 *= 2;\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // and back to memory with the final result\n            {\n                if (local_tid_56856 == 0) {\n                    ((__global int64_t *) mem_54342)[(int64_t) 0] = eta_p_56866;\n                }\n            }\n        }\n    }\n    \n  error_5:\n    return;\n    #undef segred_tblock_sizze_49199\n    #undef chunk_sizze_56849\n}\nFUTHARK_KERNEL_SIZED(do_DBSCAN_doublezisegred_small_47267_dim1, 1, 1)\nvoid do_DBSCAN_doublezisegred_small_47267(__global int *global_failure, int8_t clBase_36809, int8_t clBase_36810, double clBase_36811, double clBase_36817, int", "64_t m_43906, int64_t conc_tmp_43977, int64_t inf_44008, int64_t j_m_i_44011, int64_t num_tblocks_47262, unsigned char x_53498_bits, int64_t segment_sizze_nonzzero_55461, __global unsigned char *mem_53612, __global unsigned char *mem_53614, __global unsigned char *mem_53630, __global unsigned char *mem_53632, __global unsigned char *mem_param_53652, __global unsigned char *mem_53655, __global unsigned char *mem_53657, __global unsigned char *mem_53659, __global unsigned char *mem_53662)\n{\n    bool x_53498 = x_53498_bits;\n    \n    #define segred_tblock_sizze_47261 (do_DBSCAN_doublezisegred_small_47267zisegred_tblock_sizze_47261)\n    \n    volatile __local unsigned char *red_arr_i64_mem_55468_backing_0 = &shared_mem[0];\n    const int64_t red_arr_i64_mem_55468_backing_0_offset = 0 + ((int64_t) 8 * segred_tblock_sizze_47261 + srem64((int64_t) 8 - srem64((int64_t) 8 * segred_tblock_sizze_47261, (int64_t) 8), (int64_t) 8));\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_55464;\n    int32_t tblock_sizze_55467;\n    int32_t wave_sizze_55466;\n    int32_t block_id_55465;\n    int32_t global_tid_55463;\n    int64_t phys_tid_47267;\n    __local unsigned char *red_arr_i64_mem_55468;\n    int32_t phys_tblock_id_55470;\n    int32_t iterations_55471;\n    \n    local_tid_55464 = get_local_id(0);\n    tblock_sizze_55467 = get_local_size(0);\n    wave_sizze_55466 = LOCKSTEP_WIDTH;\n    block_id_55465 = get_tblock_id(0);\n    global_tid_55463 = block_id_55465 * tblock_sizze_55467 + local_tid_55464;\n    phys_tid_47267 = sext_i32_i64(global_tid_55463);\n    red_arr_i64_mem_55468 = (__local unsigned char *) red_arr_i64_mem_55468_backing_0;\n    phys_tblock_id_55470 = get_tblock_id(0);\n    iterations_55471 = sdiv_up32(sext_i64_i32(sdiv_up64(j_m_i_44011, squot64(segred_tblock_sizze_47261, segment_sizze_nonzzero_55461))) - phys_tblock_id_55470, sext_i64_i32(num_tblocks_47262));\n    for (int32_t i_55472 = 0; i_55472 < iterations_55471; i_55472++) {\n        int32_t virt_tblock_",
                                    "id_55473;\n        int64_t slice_55474;\n        int64_t gtid_47265;\n        int64_t remnant_55475;\n        int64_t gtid_47266;\n        \n        virt_tblock_id_55473 = phys_tblock_id_55470 + i_55472 * sext_i64_i32(num_tblocks_47262);\n        slice_55474 = j_m_i_44011;\n        gtid_47265 = squot64(sext_i32_i64(local_tid_55464), segment_sizze_nonzzero_55461) + sext_i32_i64(virt_tblock_id_55473) * squot64(segred_tblock_sizze_47261, segment_sizze_nonzzero_55461);\n        remnant_55475 = squot64(sext_i32_i64(local_tid_55464), segment_sizze_nonzzero_55461) + sext_i32_i64(virt_tblock_id_55473) * squot64(segred_tblock_sizze_47261, segment_sizze_nonzzero_55461) - gtid_47265;\n        gtid_47266 = srem64(sext_i32_i64(local_tid_55464), conc_tmp_43977);\n        // apply map function if in bounds\n        {\n            if (slt64((int64_t) 0, conc_tmp_43977) && (slt64(gtid_47265, j_m_i_44011) && slt64(sext_i32_i64(local_tid_55464), conc_tmp_43977 * squot64(segred_tblock_sizze_47261, segment_sizze_nonzzero_55461)))) {\n                // apply map function\n                {\n                    int64_t slice_49791 = inf_44008 + gtid_47265;\n                    bool index_concat_cmp_49786 = sle64(m_43906, slice_49791);\n                    double index_concat_branch_49790;\n                    \n                    if (index_concat_cmp_49786) {\n                        int64_t index_concat_i_49787 = sub64(slice_49791, m_43906);\n                        double index_concat_49788 = ((__global double *) mem_53632)[index_concat_i_49787];\n                        \n                        index_concat_branch_49790 = index_concat_49788;\n                    } else {\n                        double index_concat_49789 = ((__global double *) mem_53614)[slice_49791];\n                        \n                        index_concat_branch_49790 = index_concat_49789;\n                    }\n                    \n                    double index_concat_branch_49783;\n                    \n                    if (index", "_concat_cmp_49786) {\n                        int64_t index_concat_i_49780 = sub64(slice_49791, m_43906);\n                        double index_concat_49781 = ((__global double *) mem_53630)[index_concat_i_49780];\n                        \n                        index_concat_branch_49783 = index_concat_49781;\n                    } else {\n                        double index_concat_49782 = ((__global double *) mem_53612)[slice_49791];\n                        \n                        index_concat_branch_49783 = index_concat_49782;\n                    }\n                    \n                    bool index_concat_cmp_49772 = sle64(m_43906, gtid_47266);\n                    double index_concat_branch_49776;\n                    \n                    if (index_concat_cmp_49772) {\n                        int64_t index_concat_i_49773 = sub64(gtid_47266, m_43906);\n                        double index_concat_49774 = ((__global double *) mem_53632)[index_concat_i_49773];\n                        \n                        index_concat_branch_49776 = index_concat_49774;\n                    } else {\n                        double index_concat_49775 = ((__global double *) mem_53614)[gtid_47266];\n                        \n                        index_concat_branch_49776 = index_concat_49775;\n                    }\n                    \n                    double index_concat_branch_49770;\n                    \n                    if (index_concat_cmp_49772) {\n                        int64_t index_concat_i_49767 = sub64(gtid_47266, m_43906);\n                        double index_concat_49768 = ((__global double *) mem_53630)[index_concat_i_49767];\n                        \n                        index_concat_branch_49770 = index_concat_49768;\n                    } else {\n                        double index_concat_49769 = ((__global double *) mem_53612)[gtid_47266];\n                        \n                        index_concat_branch_49770 = index_concat_49769;\n                    }\n           ", "         \n                    double d_haversine_res_47274;\n                    \n                    if (x_53498) {\n                        double x_53500 = ((__global double *) mem_53655)[gtid_47265];\n                        \n                        d_haversine_res_47274 = x_53500;\n                    } else {\n                        d_haversine_res_47274 = 0.0;\n                    }\n                    \n                    double d_haversine_res_47275;\n                    \n                    if (x_53498) {\n                        double x_53502 = ((__global double *) mem_53657)[gtid_47265];\n                        \n                        d_haversine_res_47275 = x_53502;\n                    } else {\n                        d_haversine_res_47275 = 0.0;\n                    }\n                    \n                    double cos_res_47276;\n                    \n                    if (x_53498) {\n                        double x_53504 = ((__global double *) mem_53659)[gtid_47265];\n                        \n                        cos_res_47276 = x_53504;\n                    } else {\n                        cos_res_47276 = 0.0;\n                    }\n                    \n                    double dist_res_47280;\n                    \n                    if (clBase_36810 == (int8_t) 0) {\n                        double zm_res_47281 = index_concat_branch_49783 - index_concat_branch_49770;\n                        double zm_res_47282 = index_concat_branch_49790 - index_concat_branch_49776;\n                        double hypot_res_47283 = futrts_hypot64(zm_res_47282, zm_res_47281);\n                        \n                        dist_res_47280 = hypot_res_47283;\n                    } else {\n                        double d_haversine_res_47284;\n                        double d_haversine_res_47285;\n                        \n                        if (clBase_36809 == (int8_t) 1) {\n                            d_haversine_res_47284 = index_concat_branch_49776;\n                      ",
                                    "      d_haversine_res_47285 = index_concat_branch_49770;\n                        } else {\n                            double zt_res_47286 = 3.141592653589793 * index_concat_branch_49776;\n                            double zs_res_47287 = zt_res_47286 / 180.0;\n                            double zt_res_47288 = 3.141592653589793 * index_concat_branch_49770;\n                            double zs_res_47289 = zt_res_47288 / 180.0;\n                            \n                            d_haversine_res_47284 = zs_res_47287;\n                            d_haversine_res_47285 = zs_res_47289;\n                        }\n                        \n                        double zm_res_47290 = d_haversine_res_47274 - d_haversine_res_47284;\n                        double cos_res_47291 = futrts_cos64(zm_res_47290);\n                        double zm_res_47292 = 1.0 - cos_res_47291;\n                        double cos_res_47293 = futrts_cos64(d_haversine_res_47284);\n                        double zt_res_47294 = cos_res_47276 * cos_res_47293;\n                        double zm_res_47295 = d_haversine_res_47275 - d_haversine_res_47285;\n                        double zm_res_47296 = 1.0 - zm_res_47295;\n                        double zt_res_47297 = zt_res_47294 * zm_res_47296;\n                        double zp_res_47298 = zm_res_47292 + zt_res_47297;\n                        double zs_res_47299 = zp_res_47298 / 2.0;\n                        double min_res_47300 = fmin64(1.0, zs_res_47299);\n                        double zt_res_47301 = 2.0 * min_res_47300;\n                        double zm_res_47302 = 1.0 - zt_res_47301;\n                        double acos_res_47303 = futrts_acos64(zm_res_47302);\n                        double zt_res_47304 = clBase_36817 * acos_res_47303;\n                        \n                        dist_res_47280 = zt_res_47304;\n                    }\n                    \n                    bool zlze_res_47305 = dist_res_47280 <= clBase_36811;\n                    int64_t lif", "ted_lambda_res_47306;\n                    \n                    if (zlze_res_47305) {\n                        int64_t eta_p_47279 = ((__global int64_t *) mem_param_53652)[gtid_47266];\n                        \n                        lifted_lambda_res_47306 = eta_p_47279;\n                    } else {\n                        int64_t eta_p_47271 = ((__global int64_t *) mem_param_53652)[slice_49791];\n                        \n                        lifted_lambda_res_47306 = eta_p_47271;\n                    }\n                    // save results to be reduced\n                    {\n                        ((__local int64_t *) red_arr_i64_mem_55468)[sext_i32_i64(local_tid_55464)] = lifted_lambda_res_47306;\n                    }\n                }\n            } else {\n                ((__local int64_t *) red_arr_i64_mem_55468)[sext_i32_i64(local_tid_55464)] = (int64_t) 9223372036854775807;\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        if (slt64((int64_t) 0, conc_tmp_43977)) {\n            // perform segmented scan to imitate reduction\n            {\n                int64_t eta_p_47268;\n                int64_t eta_p_47269;\n                int64_t eta_p_55476;\n                int64_t eta_p_55477;\n                bool ltid_in_bounds_55479 = slt64(sext_i32_i64(local_tid_55464), conc_tmp_43977 * squot64(segred_tblock_sizze_47261, segment_sizze_nonzzero_55461));\n                int32_t skip_threads_55480;\n                \n                // read input for in-block scan\n                {\n                    if (ltid_in_bounds_55479) {\n                        eta_p_47269 = ((volatile __local int64_t *) red_arr_i64_mem_55468)[sext_i32_i64(local_tid_55464)];\n                        if ((local_tid_55464 - squot32(local_tid_55464, 32) * 32) == 0) {\n                            eta_p_47268 = eta_p_47269;\n                        }\n                    }\n                }\n                // in-block scan (hopefully no barriers needed)\n                {\n                   ", " skip_threads_55480 = 1;\n                    while (slt32(skip_threads_55480, 32)) {\n                        bool thread_active_55481 = sle32(skip_threads_55480, local_tid_55464 - squot32(local_tid_55464, 32) * 32) && ltid_in_bounds_55479;\n                        \n                        if (thread_active_55481) {\n                            // read operands\n                            {\n                                eta_p_47268 = ((volatile __local int64_t *) red_arr_i64_mem_55468)[sext_i32_i64(local_tid_55464) - sext_i32_i64(skip_threads_55480)];\n                            }\n                        }\n                        // perform operation\n                        {\n                            bool inactive_55482 = slt64(srem64(sext_i32_i64(local_tid_55464), conc_tmp_43977), sext_i32_i64(local_tid_55464) - sext_i32_i64(local_tid_55464 - skip_threads_55480));\n                            \n                            if (thread_active_55481 && inactive_55482) {\n                                eta_p_47268 = eta_p_47269;\n                            }\n                            if (thread_active_55481) {\n                                if (!inactive_55482) {\n                                    int64_t min_res_47270 = smin64(eta_p_47268, eta_p_47269);\n                                    \n                                    eta_p_47268 = min_res_47270;\n                                }\n                            }\n                        }\n                        if (sle32(wave_sizze_55466, skip_threads_55480)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        if (thread_active_55481) {\n                            // write result\n                            {\n                                ((volatile __local int64_t *) red_arr_i64_mem_55468)[sext_i32_i64(local_tid_55464)] = eta_p_47268;\n                                eta_p_47269 = eta_p_47268;\n                            }\n                        }\n   ",
                                    "                     if (sle32(wave_sizze_55466, skip_threads_55480)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        skip_threads_55480 *= 2;\n                    }\n                }\n                barrier(CLK_LOCAL_MEM_FENCE);\n                // last thread of block 'i' writes its result to offset 'i'\n                {\n                    if ((local_tid_55464 - squot32(local_tid_55464, 32) * 32) == 31 && ltid_in_bounds_55479) {\n                        ((volatile __local int64_t *) red_arr_i64_mem_55468)[sext_i32_i64(squot32(local_tid_55464, 32))] = eta_p_47268;\n                    }\n                }\n                barrier(CLK_LOCAL_MEM_FENCE);\n                // scan the first block, after which offset 'i' contains carry-in for block 'i+1'\n                {\n                    int32_t skip_threads_55483;\n                    \n                    // read input for in-block scan\n                    {\n                        if (squot32(local_tid_55464, 32) == 0 && ltid_in_bounds_55479) {\n                            eta_p_55477 = ((volatile __local int64_t *) red_arr_i64_mem_55468)[sext_i32_i64(local_tid_55464)];\n                            if ((local_tid_55464 - squot32(local_tid_55464, 32) * 32) == 0) {\n                                eta_p_55476 = eta_p_55477;\n                            }\n                        }\n                    }\n                    // in-block scan (hopefully no barriers needed)\n                    {\n                        skip_threads_55483 = 1;\n                        while (slt32(skip_threads_55483, 32)) {\n                            bool thread_active_55484 = sle32(skip_threads_55483, local_tid_55464 - squot32(local_tid_55464, 32) * 32) && (squot32(local_tid_55464, 32) == 0 && ltid_in_bounds_55479);\n                            \n                            if (thread_active_55484) {\n                                // read operands\n                                {\n         ", "                           eta_p_55476 = ((volatile __local int64_t *) red_arr_i64_mem_55468)[sext_i32_i64(local_tid_55464) - sext_i32_i64(skip_threads_55483)];\n                                }\n                            }\n                            // perform operation\n                            {\n                                bool inactive_55485 = slt64(srem64(sext_i32_i64(local_tid_55464 * 32 + 32 - 1), conc_tmp_43977), sext_i32_i64(local_tid_55464 * 32 + 32 - 1) - sext_i32_i64((local_tid_55464 - skip_threads_55483) * 32 + 32 - 1));\n                                \n                                if (thread_active_55484 && inactive_55485) {\n                                    eta_p_55476 = eta_p_55477;\n                                }\n                                if (thread_active_55484) {\n                                    if (!inactive_55485) {\n                                        int64_t min_res_55478 = smin64(eta_p_55476, eta_p_55477);\n                                        \n                                        eta_p_55476 = min_res_55478;\n                                    }\n                                }\n                            }\n                            if (sle32(wave_sizze_55466, skip_threads_55483)) {\n                                barrier(CLK_LOCAL_MEM_FENCE);\n                            }\n                            if (thread_active_55484) {\n                                // write result\n                                {\n                                    ((volatile __local int64_t *) red_arr_i64_mem_55468)[sext_i32_i64(local_tid_55464)] = eta_p_55476;\n                                    eta_p_55477 = eta_p_55476;\n                                }\n                            }\n                            if (sle32(wave_sizze_55466, skip_threads_55483)) {\n                                barrier(CLK_LOCAL_MEM_FENCE);\n                            }\n                            skip_threads_55483 *= 2;\n                       ", " }\n                    }\n                }\n                barrier(CLK_LOCAL_MEM_FENCE);\n                \n                bool no_carry_in_55486 = squot32(local_tid_55464, 32) == 0 || !ltid_in_bounds_55479;\n                \n                // carry-in for every block except the first\n                {\n                    // read operands\n                    {\n                        if (!no_carry_in_55486) {\n                            eta_p_47269 = eta_p_47268;\n                            eta_p_47268 = ((__local int64_t *) red_arr_i64_mem_55468)[sext_i32_i64(squot32(local_tid_55464, 32)) - (int64_t) 1];\n                        }\n                    }\n                    // perform operation\n                    {\n                        bool inactive_55487 = slt64(srem64(sext_i32_i64(local_tid_55464), conc_tmp_43977), sext_i32_i64(local_tid_55464) - sext_i32_i64(squot32(local_tid_55464, 32) * 32 - 1));\n                        \n                        if (!no_carry_in_55486) {\n                            if (inactive_55487) {\n                                eta_p_47268 = eta_p_47269;\n                            }\n                        }\n                        if (!no_carry_in_55486) {\n                            if (!inactive_55487) {\n                                int64_t min_res_47270 = smin64(eta_p_47268, eta_p_47269);\n                                \n                                eta_p_47268 = min_res_47270;\n                            }\n                        }\n                    }\n                    // write final result\n                    {\n                        if (!no_carry_in_55486) {\n                            ((__local int64_t *) red_arr_i64_mem_55468)[sext_i32_i64(local_tid_55464)] = eta_p_47268;\n                        }\n                    }\n                }\n                barrier(CLK_LOCAL_MEM_FENCE);\n                // restore correct values for first block\n                {\n                    if (squot32(local_tid_55464, 32) == 0 && ",
                                    "ltid_in_bounds_55479) {\n                        ((__local int64_t *) red_arr_i64_mem_55468)[sext_i32_i64(local_tid_55464)] = eta_p_47269;\n                    }\n                }\n                barrier(CLK_LOCAL_MEM_FENCE);\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        // save final values of segments\n        {\n            if (slt64(sext_i32_i64(virt_tblock_id_55473) * squot64(segred_tblock_sizze_47261, segment_sizze_nonzzero_55461) + sext_i32_i64(local_tid_55464), j_m_i_44011) && slt64(sext_i32_i64(local_tid_55464), squot64(segred_tblock_sizze_47261, segment_sizze_nonzzero_55461))) {\n                int64_t tmp_55488 = ((__local int64_t *) red_arr_i64_mem_55468)[(sext_i32_i64(local_tid_55464) + (int64_t) 1) * segment_sizze_nonzzero_55461 - (int64_t) 1];\n                \n                ((__global int64_t *) mem_53662)[sext_i32_i64(virt_tblock_id_55473) * squot64(segred_tblock_sizze_47261, segment_sizze_nonzzero_55461) + sext_i32_i64(local_tid_55464)] = tmp_55488;\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    }\n    \n  error_3:\n    return;\n    #undef segred_tblock_sizze_47261\n}\nFUTHARK_KERNEL_SIZED(do_DBSCAN_doublezisegred_small_48402_dim1, 1, 1)\nvoid do_DBSCAN_doublezisegred_small_48402(__global int *global_failure, int8_t clBase_36809, int8_t clBase_36810, double clBase_36811, double clBase_36817, int64_t conc_tmp_43977, int64_t inf_44477, int64_t dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_44480, int64_t num_tblocks_48396, unsigned char x_53498_bits, int64_t segment_sizze_nonzzero_56557, __global unsigned char *mem_53586, __global unsigned char *mem_53588, __global unsigned char *mem_53626, __global unsigned char *ext_mem_54005, __global unsigned char *mem_54010, __global unsigned char *mem_54012, __global unsigned char *mem_54018, __global unsigned char *mem_54020, __global unsigned char *mem_54022, __global unsigned char *mem_54027)\n{\n    bool x_53498 = x_53498_bits;\n ", "   \n    #define segred_tblock_sizze_48395 (do_DBSCAN_doublezisegred_small_48402zisegred_tblock_sizze_48395)\n    \n    volatile __local unsigned char *red_arr_f64_mem_56566_backing_1 = &shared_mem[0];\n    const int64_t red_arr_f64_mem_56566_backing_1_offset = 0 + ((int64_t) 8 * segred_tblock_sizze_48395 + srem64((int64_t) 8 - srem64((int64_t) 8 * segred_tblock_sizze_48395, (int64_t) 8), (int64_t) 8));\n    volatile __local unsigned char *red_arr_i64_mem_56564_backing_0 = &shared_mem[red_arr_f64_mem_56566_backing_1_offset];\n    const int64_t red_arr_i64_mem_56564_backing_0_offset = red_arr_f64_mem_56566_backing_1_offset + ((int64_t) 8 * segred_tblock_sizze_48395 + srem64((int64_t) 8 - srem64((int64_t) 8 * segred_tblock_sizze_48395, (int64_t) 8), (int64_t) 8));\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_56560;\n    int32_t tblock_sizze_56563;\n    int32_t wave_sizze_56562;\n    int32_t block_id_56561;\n    int32_t global_tid_56559;\n    int64_t phys_tid_48402;\n    __local unsigned char *red_arr_i64_mem_56564;\n    __local unsigned char *red_arr_f64_mem_56566;\n    int32_t phys_tblock_id_56568;\n    int32_t iterations_56569;\n    \n    local_tid_56560 = get_local_id(0);\n    tblock_sizze_56563 = get_local_size(0);\n    wave_sizze_56562 = LOCKSTEP_WIDTH;\n    block_id_56561 = get_tblock_id(0);\n    global_tid_56559 = block_id_56561 * tblock_sizze_56563 + local_tid_56560;\n    phys_tid_48402 = sext_i32_i64(global_tid_56559);\n    red_arr_i64_mem_56564 = (__local unsigned char *) red_arr_i64_mem_56564_backing_0;\n    red_arr_f64_mem_56566 = (__local unsigned char *) red_arr_f64_mem_56566_backing_1;\n    phys_tblock_id_56568 = get_tblock_id(0);\n    iterations_56569 = sdiv_up32(sext_i64_i32(sdiv_up64(dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_44480, squot64(segred_tblock_sizze_48395, segment_sizze_nonzzero_56557))) - phys_tblock_id_56568, sext_i64_i32(num_tblocks_48396));\n    for (int32_t i_56570 = 0; i_56570 < iterations_56569; i_56570++) {\n        int32_t virt_tblock", "_id_56571;\n        int64_t slice_56572;\n        int64_t gtid_48400;\n        int64_t remnant_56573;\n        int64_t gtid_48401;\n        \n        virt_tblock_id_56571 = phys_tblock_id_56568 + i_56570 * sext_i64_i32(num_tblocks_48396);\n        slice_56572 = dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_44480;\n        gtid_48400 = squot64(sext_i32_i64(local_tid_56560), segment_sizze_nonzzero_56557) + sext_i32_i64(virt_tblock_id_56571) * squot64(segred_tblock_sizze_48395, segment_sizze_nonzzero_56557);\n        remnant_56573 = squot64(sext_i32_i64(local_tid_56560), segment_sizze_nonzzero_56557) + sext_i32_i64(virt_tblock_id_56571) * squot64(segred_tblock_sizze_48395, segment_sizze_nonzzero_56557) - gtid_48400;\n        gtid_48401 = srem64(sext_i32_i64(local_tid_56560), conc_tmp_43977);\n        // apply map function if in bounds\n        {\n            if (slt64((int64_t) 0, conc_tmp_43977) && (slt64(gtid_48400, dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_44480) && slt64(sext_i32_i64(local_tid_56560), conc_tmp_43977 * squot64(segred_tblock_sizze_48395, segment_sizze_nonzzero_56557)))) {\n                // apply map function\n                {\n                    int64_t slice_49700 = inf_44477 + gtid_48400;\n                    double eta_p_48420 = ((__global double *) mem_54010)[gtid_48401];\n                    double eta_p_48421 = ((__global double *) mem_54012)[gtid_48401];\n                    int64_t x_48422 = ((__global int64_t *) ext_mem_54005)[gtid_48401];\n                    double d_haversine_res_48417;\n                    \n                    if (x_53498) {\n                        double x_53491 = ((__global double *) mem_54018)[gtid_48400];\n                        \n                        d_haversine_res_48417 = x_53491;\n                    } else {\n                        d_haversine_res_48417 = 0.0;\n                    }\n                    \n                    double d_haversine_res_48418;\n                    \n                    if (x_53498) {\n                        double x_53493 = ",
                                    "((__global double *) mem_54020)[gtid_48400];\n                        \n                        d_haversine_res_48418 = x_53493;\n                    } else {\n                        d_haversine_res_48418 = 0.0;\n                    }\n                    \n                    double cos_res_48419;\n                    \n                    if (x_53498) {\n                        double x_53495 = ((__global double *) mem_54022)[gtid_48400];\n                        \n                        cos_res_48419 = x_53495;\n                    } else {\n                        cos_res_48419 = 0.0;\n                    }\n                    \n                    double dist_res_48423;\n                    \n                    if (clBase_36810 == (int8_t) 0) {\n                        double eta_p_48415 = ((__global double *) mem_53586)[slice_49700];\n                        double eta_p_48416 = ((__global double *) mem_53588)[slice_49700];\n                        double zm_res_48424 = eta_p_48416 - eta_p_48421;\n                        double zm_res_48425 = eta_p_48415 - eta_p_48420;\n                        double hypot_res_48426 = futrts_hypot64(zm_res_48425, zm_res_48424);\n                        \n                        dist_res_48423 = hypot_res_48426;\n                    } else {\n                        double d_haversine_res_48427;\n                        double d_haversine_res_48428;\n                        \n                        if (clBase_36809 == (int8_t) 1) {\n                            d_haversine_res_48427 = eta_p_48420;\n                            d_haversine_res_48428 = eta_p_48421;\n                        } else {\n                            double zt_res_48429 = 3.141592653589793 * eta_p_48420;\n                            double zs_res_48430 = zt_res_48429 / 180.0;\n                            double zt_res_48431 = 3.141592653589793 * eta_p_48421;\n                            double zs_res_48432 = zt_res_48431 / 180.0;\n                            \n                            d", "_haversine_res_48427 = zs_res_48430;\n                            d_haversine_res_48428 = zs_res_48432;\n                        }\n                        \n                        double zm_res_48433 = d_haversine_res_48417 - d_haversine_res_48427;\n                        double cos_res_48434 = futrts_cos64(zm_res_48433);\n                        double zm_res_48435 = 1.0 - cos_res_48434;\n                        double cos_res_48436 = futrts_cos64(d_haversine_res_48427);\n                        double zt_res_48437 = cos_res_48419 * cos_res_48436;\n                        double zm_res_48438 = d_haversine_res_48418 - d_haversine_res_48428;\n                        double zm_res_48439 = 1.0 - zm_res_48438;\n                        double zt_res_48440 = zt_res_48437 * zm_res_48439;\n                        double zp_res_48441 = zm_res_48435 + zt_res_48440;\n                        double zs_res_48442 = zp_res_48441 / 2.0;\n                        double min_res_48443 = fmin64(1.0, zs_res_48442);\n                        double zt_res_48444 = 2.0 * min_res_48443;\n                        double zm_res_48445 = 1.0 - zt_res_48444;\n                        double acos_res_48446 = futrts_acos64(zm_res_48445);\n                        double zt_res_48447 = clBase_36817 * acos_res_48446;\n                        \n                        dist_res_48423 = zt_res_48447;\n                    }\n                    // save results to be reduced\n                    {\n                        ((__local int64_t *) red_arr_i64_mem_56564)[sext_i32_i64(local_tid_56560)] = x_48422;\n                        ((__local double *) red_arr_f64_mem_56566)[sext_i32_i64(local_tid_56560)] = dist_res_48423;\n                    }\n                }\n            } else {\n                ((__local int64_t *) red_arr_i64_mem_56564)[sext_i32_i64(local_tid_56560)] = (int64_t) -1;\n                ((__local double *) red_arr_f64_mem_56566)[sext_i32_i64(local_tid_56560)] = INFINITY;\n            }\n        }\n        barrier(CLK_", "LOCAL_MEM_FENCE);\n        if (slt64((int64_t) 0, conc_tmp_43977)) {\n            // perform segmented scan to imitate reduction\n            {\n                int64_t eta_p_48403;\n                double eta_p_48404;\n                int64_t eta_p_48405;\n                double eta_p_48406;\n                int64_t eta_p_56574;\n                double eta_p_56575;\n                int64_t eta_p_56576;\n                double eta_p_56577;\n                bool ltid_in_bounds_56586 = slt64(sext_i32_i64(local_tid_56560), conc_tmp_43977 * squot64(segred_tblock_sizze_48395, segment_sizze_nonzzero_56557));\n                int32_t skip_threads_56587;\n                \n                // read input for in-block scan\n                {\n                    if (ltid_in_bounds_56586) {\n                        eta_p_48405 = ((volatile __local int64_t *) red_arr_i64_mem_56564)[sext_i32_i64(local_tid_56560)];\n                        eta_p_48406 = ((volatile __local double *) red_arr_f64_mem_56566)[sext_i32_i64(local_tid_56560)];\n                        if ((local_tid_56560 - squot32(local_tid_56560, 32) * 32) == 0) {\n                            eta_p_48403 = eta_p_48405;\n                            eta_p_48404 = eta_p_48406;\n                        }\n                    }\n                }\n                // in-block scan (hopefully no barriers needed)\n                {\n                    skip_threads_56587 = 1;\n                    while (slt32(skip_threads_56587, 32)) {\n                        bool thread_active_56588 = sle32(skip_threads_56587, local_tid_56560 - squot32(local_tid_56560, 32) * 32) && ltid_in_bounds_56586;\n                        \n                        if (thread_active_56588) {\n                            // read operands\n                            {\n                                eta_p_48403 = ((volatile __local int64_t *) red_arr_i64_mem_56564)[sext_i32_i64(local_tid_56560) - sext_i32_i64(skip_threads_56587)];\n                                eta_p_48404 = ((volatile _",
                                    "_local double *) red_arr_f64_mem_56566)[sext_i32_i64(local_tid_56560) - sext_i32_i64(skip_threads_56587)];\n                            }\n                        }\n                        // perform operation\n                        {\n                            bool inactive_56589 = slt64(srem64(sext_i32_i64(local_tid_56560), conc_tmp_43977), sext_i32_i64(local_tid_56560) - sext_i32_i64(local_tid_56560 - skip_threads_56587));\n                            \n                            if (thread_active_56588 && inactive_56589) {\n                                eta_p_48403 = eta_p_48405;\n                                eta_p_48404 = eta_p_48406;\n                            }\n                            if (thread_active_56588) {\n                                if (!inactive_56589) {\n                                    bool zg_res_48407 = clBase_36811 < eta_p_48404;\n                                    bool zg_res_48408 = clBase_36811 < eta_p_48406;\n                                    bool x_48409 = zg_res_48407 && zg_res_48408;\n                                    int64_t lifted_lambda_res_48410;\n                                    double lifted_lambda_res_48411;\n                                    \n                                    if (x_48409) {\n                                        lifted_lambda_res_48410 = (int64_t) -1;\n                                        lifted_lambda_res_48411 = INFINITY;\n                                    } else {\n                                        bool zl_res_48412 = eta_p_48404 < eta_p_48406;\n                                        int64_t lifted_lambda_res_f_res_48413;\n                                        \n                                        if (zl_res_48412) {\n                                            lifted_lambda_res_f_res_48413 = eta_p_48403;\n                                        } else {\n                                            lifted_lambda_res_f_res_48413 = eta_p_48405;\n                                        }", "\n                                        \n                                        double lifted_lambda_res_f_res_48414;\n                                        \n                                        if (zl_res_48412) {\n                                            lifted_lambda_res_f_res_48414 = eta_p_48404;\n                                        } else {\n                                            lifted_lambda_res_f_res_48414 = eta_p_48406;\n                                        }\n                                        lifted_lambda_res_48410 = lifted_lambda_res_f_res_48413;\n                                        lifted_lambda_res_48411 = lifted_lambda_res_f_res_48414;\n                                    }\n                                    eta_p_48403 = lifted_lambda_res_48410;\n                                    eta_p_48404 = lifted_lambda_res_48411;\n                                }\n                            }\n                        }\n                        if (sle32(wave_sizze_56562, skip_threads_56587)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        if (thread_active_56588) {\n                            // write result\n                            {\n                                ((volatile __local int64_t *) red_arr_i64_mem_56564)[sext_i32_i64(local_tid_56560)] = eta_p_48403;\n                                eta_p_48405 = eta_p_48403;\n                                ((volatile __local double *) red_arr_f64_mem_56566)[sext_i32_i64(local_tid_56560)] = eta_p_48404;\n                                eta_p_48406 = eta_p_48404;\n                            }\n                        }\n                        if (sle32(wave_sizze_56562, skip_threads_56587)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        skip_threads_56587 *= 2;\n                    }\n                }\n                barrier(CLK_LOCAL_MEM_FENCE);\n                // last t", "hread of block 'i' writes its result to offset 'i'\n                {\n                    if ((local_tid_56560 - squot32(local_tid_56560, 32) * 32) == 31 && ltid_in_bounds_56586) {\n                        ((volatile __local int64_t *) red_arr_i64_mem_56564)[sext_i32_i64(squot32(local_tid_56560, 32))] = eta_p_48403;\n                        ((volatile __local double *) red_arr_f64_mem_56566)[sext_i32_i64(squot32(local_tid_56560, 32))] = eta_p_48404;\n                    }\n                }\n                barrier(CLK_LOCAL_MEM_FENCE);\n                // scan the first block, after which offset 'i' contains carry-in for block 'i+1'\n                {\n                    int32_t skip_threads_56590;\n                    \n                    // read input for in-block scan\n                    {\n                        if (squot32(local_tid_56560, 32) == 0 && ltid_in_bounds_56586) {\n                            eta_p_56576 = ((volatile __local int64_t *) red_arr_i64_mem_56564)[sext_i32_i64(local_tid_56560)];\n                            eta_p_56577 = ((volatile __local double *) red_arr_f64_mem_56566)[sext_i32_i64(local_tid_56560)];\n                            if ((local_tid_56560 - squot32(local_tid_56560, 32) * 32) == 0) {\n                                eta_p_56574 = eta_p_56576;\n                                eta_p_56575 = eta_p_56577;\n                            }\n                        }\n                    }\n                    // in-block scan (hopefully no barriers needed)\n                    {\n                        skip_threads_56590 = 1;\n                        while (slt32(skip_threads_56590, 32)) {\n                            bool thread_active_56591 = sle32(skip_threads_56590, local_tid_56560 - squot32(local_tid_56560, 32) * 32) && (squot32(local_tid_56560, 32) == 0 && ltid_in_bounds_56586);\n                            \n                            if (thread_active_56591) {\n                                // read operands\n                                {\n     ",
                                    "                               eta_p_56574 = ((volatile __local int64_t *) red_arr_i64_mem_56564)[sext_i32_i64(local_tid_56560) - sext_i32_i64(skip_threads_56590)];\n                                    eta_p_56575 = ((volatile __local double *) red_arr_f64_mem_56566)[sext_i32_i64(local_tid_56560) - sext_i32_i64(skip_threads_56590)];\n                                }\n                            }\n                            // perform operation\n                            {\n                                bool inactive_56592 = slt64(srem64(sext_i32_i64(local_tid_56560 * 32 + 32 - 1), conc_tmp_43977), sext_i32_i64(local_tid_56560 * 32 + 32 - 1) - sext_i32_i64((local_tid_56560 - skip_threads_56590) * 32 + 32 - 1));\n                                \n                                if (thread_active_56591 && inactive_56592) {\n                                    eta_p_56574 = eta_p_56576;\n                                    eta_p_56575 = eta_p_56577;\n                                }\n                                if (thread_active_56591) {\n                                    if (!inactive_56592) {\n                                        bool zg_res_56578 = clBase_36811 < eta_p_56575;\n                                        bool zg_res_56579 = clBase_36811 < eta_p_56577;\n                                        bool x_56580 = zg_res_56578 && zg_res_56579;\n                                        int64_t lifted_lambda_res_56581;\n                                        double lifted_lambda_res_56582;\n                                        \n                                        if (x_56580) {\n                                            lifted_lambda_res_56581 = (int64_t) -1;\n                                            lifted_lambda_res_56582 = INFINITY;\n                                        } else {\n                                            bool zl_res_56583 = eta_p_56575 < eta_p_56577;\n                                            int64_t lifted_lambda_res_f_res_56584;\n  ", "                                          \n                                            if (zl_res_56583) {\n                                                lifted_lambda_res_f_res_56584 = eta_p_56574;\n                                            } else {\n                                                lifted_lambda_res_f_res_56584 = eta_p_56576;\n                                            }\n                                            \n                                            double lifted_lambda_res_f_res_56585;\n                                            \n                                            if (zl_res_56583) {\n                                                lifted_lambda_res_f_res_56585 = eta_p_56575;\n                                            } else {\n                                                lifted_lambda_res_f_res_56585 = eta_p_56577;\n                                            }\n                                            lifted_lambda_res_56581 = lifted_lambda_res_f_res_56584;\n                                            lifted_lambda_res_56582 = lifted_lambda_res_f_res_56585;\n                                        }\n                                        eta_p_56574 = lifted_lambda_res_56581;\n                                        eta_p_56575 = lifted_lambda_res_56582;\n                                    }\n                                }\n                            }\n                            if (sle32(wave_sizze_56562, skip_threads_56590)) {\n                                barrier(CLK_LOCAL_MEM_FENCE);\n                            }\n                            if (thread_active_56591) {\n                                // write result\n                                {\n                                    ((volatile __local int64_t *) red_arr_i64_mem_56564)[sext_i32_i64(local_tid_56560)] = eta_p_56574;\n                                    eta_p_56576 = eta_p_56574;\n                                    ((volatile __local double *) red_arr_f64_", "mem_56566)[sext_i32_i64(local_tid_56560)] = eta_p_56575;\n                                    eta_p_56577 = eta_p_56575;\n                                }\n                            }\n                            if (sle32(wave_sizze_56562, skip_threads_56590)) {\n                                barrier(CLK_LOCAL_MEM_FENCE);\n                            }\n                            skip_threads_56590 *= 2;\n                        }\n                    }\n                }\n                barrier(CLK_LOCAL_MEM_FENCE);\n                \n                bool no_carry_in_56593 = squot32(local_tid_56560, 32) == 0 || !ltid_in_bounds_56586;\n                \n                // carry-in for every block except the first\n                {\n                    // read operands\n                    {\n                        if (!no_carry_in_56593) {\n                            eta_p_48405 = eta_p_48403;\n                            eta_p_48406 = eta_p_48404;\n                            eta_p_48403 = ((__local int64_t *) red_arr_i64_mem_56564)[sext_i32_i64(squot32(local_tid_56560, 32)) - (int64_t) 1];\n                            eta_p_48404 = ((__local double *) red_arr_f64_mem_56566)[sext_i32_i64(squot32(local_tid_56560, 32)) - (int64_t) 1];\n                        }\n                    }\n                    // perform operation\n                    {\n                        bool inactive_56594 = slt64(srem64(sext_i32_i64(local_tid_56560), conc_tmp_43977), sext_i32_i64(local_tid_56560) - sext_i32_i64(squot32(local_tid_56560, 32) * 32 - 1));\n                        \n                        if (!no_carry_in_56593) {\n                            if (inactive_56594) {\n                                eta_p_48403 = eta_p_48405;\n                                eta_p_48404 = eta_p_48406;\n                            }\n                        }\n                        if (!no_carry_in_56593) {\n                            if (!inactive_56594) {\n                                bool zg_res_48407 = cl",
                                    "Base_36811 < eta_p_48404;\n                                bool zg_res_48408 = clBase_36811 < eta_p_48406;\n                                bool x_48409 = zg_res_48407 && zg_res_48408;\n                                int64_t lifted_lambda_res_48410;\n                                double lifted_lambda_res_48411;\n                                \n                                if (x_48409) {\n                                    lifted_lambda_res_48410 = (int64_t) -1;\n                                    lifted_lambda_res_48411 = INFINITY;\n                                } else {\n                                    bool zl_res_48412 = eta_p_48404 < eta_p_48406;\n                                    int64_t lifted_lambda_res_f_res_48413;\n                                    \n                                    if (zl_res_48412) {\n                                        lifted_lambda_res_f_res_48413 = eta_p_48403;\n                                    } else {\n                                        lifted_lambda_res_f_res_48413 = eta_p_48405;\n                                    }\n                                    \n                                    double lifted_lambda_res_f_res_48414;\n                                    \n                                    if (zl_res_48412) {\n                                        lifted_lambda_res_f_res_48414 = eta_p_48404;\n                                    } else {\n                                        lifted_lambda_res_f_res_48414 = eta_p_48406;\n                                    }\n                                    lifted_lambda_res_48410 = lifted_lambda_res_f_res_48413;\n                                    lifted_lambda_res_48411 = lifted_lambda_res_f_res_48414;\n                                }\n                                eta_p_48403 = lifted_lambda_res_48410;\n                                eta_p_48404 = lifted_lambda_res_48411;\n                            }\n                        }\n                    }\n                  ", "  // write final result\n                    {\n                        if (!no_carry_in_56593) {\n                            ((__local int64_t *) red_arr_i64_mem_56564)[sext_i32_i64(local_tid_56560)] = eta_p_48403;\n                            ((__local double *) red_arr_f64_mem_56566)[sext_i32_i64(local_tid_56560)] = eta_p_48404;\n                        }\n                    }\n                }\n                barrier(CLK_LOCAL_MEM_FENCE);\n                // restore correct values for first block\n                {\n                    if (squot32(local_tid_56560, 32) == 0 && ltid_in_bounds_56586) {\n                        ((__local int64_t *) red_arr_i64_mem_56564)[sext_i32_i64(local_tid_56560)] = eta_p_48405;\n                        ((__local double *) red_arr_f64_mem_56566)[sext_i32_i64(local_tid_56560)] = eta_p_48406;\n                    }\n                }\n                barrier(CLK_LOCAL_MEM_FENCE);\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        // save final values of segments\n        {\n            if (slt64(sext_i32_i64(virt_tblock_id_56571) * squot64(segred_tblock_sizze_48395, segment_sizze_nonzzero_56557) + sext_i32_i64(local_tid_56560), dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_44480) && slt64(sext_i32_i64(local_tid_56560), squot64(segred_tblock_sizze_48395, segment_sizze_nonzzero_56557))) {\n                int64_t tmp_56595 = ((__local int64_t *) red_arr_i64_mem_56564)[(sext_i32_i64(local_tid_56560) + (int64_t) 1) * segment_sizze_nonzzero_56557 - (int64_t) 1];\n                \n                ((__global int64_t *) mem_53626)[inf_44477 + (sext_i32_i64(virt_tblock_id_56571) * squot64(segred_tblock_sizze_48395, segment_sizze_nonzzero_56557) + sext_i32_i64(local_tid_56560))] = tmp_56595;\n                \n                double tmp_56596 = ((__local double *) red_arr_f64_mem_56566)[(sext_i32_i64(local_tid_56560) + (int64_t) 1) * segment_sizze_nonzzero_56557 - (int64_t) 1];\n                \n                ((__global double *) mem_54027)[sext_i32_", "i64(virt_tblock_id_56571) * squot64(segred_tblock_sizze_48395, segment_sizze_nonzzero_56557) + sext_i32_i64(local_tid_56560)] = tmp_56596;\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    }\n    \n  error_3:\n    return;\n    #undef segred_tblock_sizze_48395\n}\nFUTHARK_KERNEL_SIZED(do_DBSCAN_doublezisegred_small_49140_dim1, 1, 1)\nvoid do_DBSCAN_doublezisegred_small_49140(__global int *global_failure, int8_t clBase_36809, int8_t clBase_36810, double clBase_36811, double clBase_36817, int64_t conc_tmp_43977, int64_t inf_44560, int64_t dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_44563, int64_t num_tblocks_49134, unsigned char x_53498_bits, int64_t segment_sizze_nonzzero_56716, __global unsigned char *current_partition_mem_53519, __global unsigned char *current_partition_mem_53520, __global unsigned char *mem_53556, __global unsigned char *ext_mem_54005, __global unsigned char *mem_54010, __global unsigned char *mem_54012, __global unsigned char *mem_54265, __global unsigned char *mem_54267, __global unsigned char *mem_54269, __global unsigned char *mem_54274)\n{\n    bool x_53498 = x_53498_bits;\n    \n    #define segred_tblock_sizze_49133 (do_DBSCAN_doublezisegred_small_49140zisegred_tblock_sizze_49133)\n    \n    volatile __local unsigned char *red_arr_f64_mem_56725_backing_1 = &shared_mem[0];\n    const int64_t red_arr_f64_mem_56725_backing_1_offset = 0 + ((int64_t) 8 * segred_tblock_sizze_49133 + srem64((int64_t) 8 - srem64((int64_t) 8 * segred_tblock_sizze_49133, (int64_t) 8), (int64_t) 8));\n    volatile __local unsigned char *red_arr_i64_mem_56723_backing_0 = &shared_mem[red_arr_f64_mem_56725_backing_1_offset];\n    const int64_t red_arr_i64_mem_56723_backing_0_offset = red_arr_f64_mem_56725_backing_1_offset + ((int64_t) 8 * segred_tblock_sizze_49133 + srem64((int64_t) 8 - srem64((int64_t) 8 * segred_tblock_sizze_49133, (int64_t) 8), (int64_t) 8));\n    \n    if (*global_failure >= 0)\n        return;\n    \n    i",
                                    "nt32_t local_tid_56719;\n    int32_t tblock_sizze_56722;\n    int32_t wave_sizze_56721;\n    int32_t block_id_56720;\n    int32_t global_tid_56718;\n    int64_t phys_tid_49140;\n    __local unsigned char *red_arr_i64_mem_56723;\n    __local unsigned char *red_arr_f64_mem_56725;\n    int32_t phys_tblock_id_56727;\n    int32_t iterations_56728;\n    \n    local_tid_56719 = get_local_id(0);\n    tblock_sizze_56722 = get_local_size(0);\n    wave_sizze_56721 = LOCKSTEP_WIDTH;\n    block_id_56720 = get_tblock_id(0);\n    global_tid_56718 = block_id_56720 * tblock_sizze_56722 + local_tid_56719;\n    phys_tid_49140 = sext_i32_i64(global_tid_56718);\n    red_arr_i64_mem_56723 = (__local unsigned char *) red_arr_i64_mem_56723_backing_0;\n    red_arr_f64_mem_56725 = (__local unsigned char *) red_arr_f64_mem_56725_backing_1;\n    phys_tblock_id_56727 = get_tblock_id(0);\n    iterations_56728 = sdiv_up32(sext_i64_i32(sdiv_up64(dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_44563, squot64(segred_tblock_sizze_49133, segment_sizze_nonzzero_56716))) - phys_tblock_id_56727, sext_i64_i32(num_tblocks_49134));\n    for (int32_t i_56729 = 0; i_56729 < iterations_56728; i_56729++) {\n        int32_t virt_tblock_id_56730;\n        int64_t slice_56731;\n        int64_t gtid_49138;\n        int64_t remnant_56732;\n        int64_t gtid_49139;\n        \n        virt_tblock_id_56730 = phys_tblock_id_56727 + i_56729 * sext_i64_i32(num_tblocks_49134);\n        slice_56731 = dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_44563;\n        gtid_49138 = squot64(sext_i32_i64(local_tid_56719), segment_sizze_nonzzero_56716) + sext_i32_i64(virt_tblock_id_56730) * squot64(segred_tblock_sizze_49133, segment_sizze_nonzzero_56716);\n        remnant_56732 = squot64(sext_i32_i64(local_tid_56719), segment_sizze_nonzzero_56716) + sext_i32_i64(virt_tblock_id_56730) * squot64(segred_tblock_sizze_49133, segment_sizze_nonzzero_56716) - gtid_49138;\n        gtid_49139 = srem64(sext_i32_i64(local_tid_56719), conc_tmp_43977);\n        // apply map function if in bounds\n       ", " {\n            if (slt64((int64_t) 0, conc_tmp_43977) && (slt64(gtid_49138, dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_44563) && slt64(sext_i32_i64(local_tid_56719), conc_tmp_43977 * squot64(segred_tblock_sizze_49133, segment_sizze_nonzzero_56716)))) {\n                // apply map function\n                {\n                    int64_t slice_49678 = inf_44560 + gtid_49138;\n                    double eta_p_49158 = ((__global double *) mem_54010)[gtid_49139];\n                    double eta_p_49159 = ((__global double *) mem_54012)[gtid_49139];\n                    int64_t x_49160 = ((__global int64_t *) ext_mem_54005)[gtid_49139];\n                    double d_haversine_res_49155;\n                    \n                    if (x_53498) {\n                        double x_53482 = ((__global double *) mem_54265)[gtid_49138];\n                        \n                        d_haversine_res_49155 = x_53482;\n                    } else {\n                        d_haversine_res_49155 = 0.0;\n                    }\n                    \n                    double d_haversine_res_49156;\n                    \n                    if (x_53498) {\n                        double x_53484 = ((__global double *) mem_54267)[gtid_49138];\n                        \n                        d_haversine_res_49156 = x_53484;\n                    } else {\n                        d_haversine_res_49156 = 0.0;\n                    }\n                    \n                    double cos_res_49157;\n                    \n                    if (x_53498) {\n                        double x_53486 = ((__global double *) mem_54269)[gtid_49138];\n                        \n                        cos_res_49157 = x_53486;\n                    } else {\n                        cos_res_49157 = 0.0;\n                    }\n                    \n                    double dist_res_49161;\n                    \n                    if (clBase_36810 == (int8_t) 0) {\n                        double eta_p_49153 = ((__global double *) current_partition", "_mem_53519)[slice_49678];\n                        double eta_p_49154 = ((__global double *) current_partition_mem_53520)[slice_49678];\n                        double zm_res_49162 = eta_p_49154 - eta_p_49159;\n                        double zm_res_49163 = eta_p_49153 - eta_p_49158;\n                        double hypot_res_49164 = futrts_hypot64(zm_res_49163, zm_res_49162);\n                        \n                        dist_res_49161 = hypot_res_49164;\n                    } else {\n                        double d_haversine_res_49165;\n                        double d_haversine_res_49166;\n                        \n                        if (clBase_36809 == (int8_t) 1) {\n                            d_haversine_res_49165 = eta_p_49158;\n                            d_haversine_res_49166 = eta_p_49159;\n                        } else {\n                            double zt_res_49167 = 3.141592653589793 * eta_p_49158;\n                            double zs_res_49168 = zt_res_49167 / 180.0;\n                            double zt_res_49169 = 3.141592653589793 * eta_p_49159;\n                            double zs_res_49170 = zt_res_49169 / 180.0;\n                            \n                            d_haversine_res_49165 = zs_res_49168;\n                            d_haversine_res_49166 = zs_res_49170;\n                        }\n                        \n                        double zm_res_49171 = d_haversine_res_49155 - d_haversine_res_49165;\n                        double cos_res_49172 = futrts_cos64(zm_res_49171);\n                        double zm_res_49173 = 1.0 - cos_res_49172;\n                        double cos_res_49174 = futrts_cos64(d_haversine_res_49165);\n                        double zt_res_49175 = cos_res_49157 * cos_res_49174;\n                        double zm_res_49176 = d_haversine_res_49156 - d_haversine_res_49166;\n                        double zm_res_49177 = 1.0 - zm_res_49176;\n                        double zt_res_49178 = zt_res_49175 * zm_res_49177;\n        ",
                                    "                double zp_res_49179 = zm_res_49173 + zt_res_49178;\n                        double zs_res_49180 = zp_res_49179 / 2.0;\n                        double min_res_49181 = fmin64(1.0, zs_res_49180);\n                        double zt_res_49182 = 2.0 * min_res_49181;\n                        double zm_res_49183 = 1.0 - zt_res_49182;\n                        double acos_res_49184 = futrts_acos64(zm_res_49183);\n                        double zt_res_49185 = clBase_36817 * acos_res_49184;\n                        \n                        dist_res_49161 = zt_res_49185;\n                    }\n                    // save results to be reduced\n                    {\n                        ((__local int64_t *) red_arr_i64_mem_56723)[sext_i32_i64(local_tid_56719)] = x_49160;\n                        ((__local double *) red_arr_f64_mem_56725)[sext_i32_i64(local_tid_56719)] = dist_res_49161;\n                    }\n                }\n            } else {\n                ((__local int64_t *) red_arr_i64_mem_56723)[sext_i32_i64(local_tid_56719)] = (int64_t) -1;\n                ((__local double *) red_arr_f64_mem_56725)[sext_i32_i64(local_tid_56719)] = INFINITY;\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        if (slt64((int64_t) 0, conc_tmp_43977)) {\n            // perform segmented scan to imitate reduction\n            {\n                int64_t eta_p_49141;\n                double eta_p_49142;\n                int64_t eta_p_49143;\n                double eta_p_49144;\n                int64_t eta_p_56733;\n                double eta_p_56734;\n                int64_t eta_p_56735;\n                double eta_p_56736;\n                bool ltid_in_bounds_56745 = slt64(sext_i32_i64(local_tid_56719), conc_tmp_43977 * squot64(segred_tblock_sizze_49133, segment_sizze_nonzzero_56716));\n                int32_t skip_threads_56746;\n                \n                // read input for in-block scan\n                {\n                    if (ltid_in_bounds_56745) {\n                   ", "     eta_p_49143 = ((volatile __local int64_t *) red_arr_i64_mem_56723)[sext_i32_i64(local_tid_56719)];\n                        eta_p_49144 = ((volatile __local double *) red_arr_f64_mem_56725)[sext_i32_i64(local_tid_56719)];\n                        if ((local_tid_56719 - squot32(local_tid_56719, 32) * 32) == 0) {\n                            eta_p_49141 = eta_p_49143;\n                            eta_p_49142 = eta_p_49144;\n                        }\n                    }\n                }\n                // in-block scan (hopefully no barriers needed)\n                {\n                    skip_threads_56746 = 1;\n                    while (slt32(skip_threads_56746, 32)) {\n                        bool thread_active_56747 = sle32(skip_threads_56746, local_tid_56719 - squot32(local_tid_56719, 32) * 32) && ltid_in_bounds_56745;\n                        \n                        if (thread_active_56747) {\n                            // read operands\n                            {\n                                eta_p_49141 = ((volatile __local int64_t *) red_arr_i64_mem_56723)[sext_i32_i64(local_tid_56719) - sext_i32_i64(skip_threads_56746)];\n                                eta_p_49142 = ((volatile __local double *) red_arr_f64_mem_56725)[sext_i32_i64(local_tid_56719) - sext_i32_i64(skip_threads_56746)];\n                            }\n                        }\n                        // perform operation\n                        {\n                            bool inactive_56748 = slt64(srem64(sext_i32_i64(local_tid_56719), conc_tmp_43977), sext_i32_i64(local_tid_56719) - sext_i32_i64(local_tid_56719 - skip_threads_56746));\n                            \n                            if (thread_active_56747 && inactive_56748) {\n                                eta_p_49141 = eta_p_49143;\n                                eta_p_49142 = eta_p_49144;\n                            }\n                            if (thread_active_56747) {\n                                if (!inactive_56748) {\n  ", "                                  bool zg_res_49145 = clBase_36811 < eta_p_49142;\n                                    bool zg_res_49146 = clBase_36811 < eta_p_49144;\n                                    bool x_49147 = zg_res_49145 && zg_res_49146;\n                                    int64_t lifted_lambda_res_49148;\n                                    double lifted_lambda_res_49149;\n                                    \n                                    if (x_49147) {\n                                        lifted_lambda_res_49148 = (int64_t) -1;\n                                        lifted_lambda_res_49149 = INFINITY;\n                                    } else {\n                                        bool zl_res_49150 = eta_p_49142 < eta_p_49144;\n                                        int64_t lifted_lambda_res_f_res_49151;\n                                        \n                                        if (zl_res_49150) {\n                                            lifted_lambda_res_f_res_49151 = eta_p_49141;\n                                        } else {\n                                            lifted_lambda_res_f_res_49151 = eta_p_49143;\n                                        }\n                                        \n                                        double lifted_lambda_res_f_res_49152;\n                                        \n                                        if (zl_res_49150) {\n                                            lifted_lambda_res_f_res_49152 = eta_p_49142;\n                                        } else {\n                                            lifted_lambda_res_f_res_49152 = eta_p_49144;\n                                        }\n                                        lifted_lambda_res_49148 = lifted_lambda_res_f_res_49151;\n                                        lifted_lambda_res_49149 = lifted_lambda_res_f_res_49152;\n                                    }\n                                    eta_p_49141 = lifted_lambda_res_49",
                                    "148;\n                                    eta_p_49142 = lifted_lambda_res_49149;\n                                }\n                            }\n                        }\n                        if (sle32(wave_sizze_56721, skip_threads_56746)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        if (thread_active_56747) {\n                            // write result\n                            {\n                                ((volatile __local int64_t *) red_arr_i64_mem_56723)[sext_i32_i64(local_tid_56719)] = eta_p_49141;\n                                eta_p_49143 = eta_p_49141;\n                                ((volatile __local double *) red_arr_f64_mem_56725)[sext_i32_i64(local_tid_56719)] = eta_p_49142;\n                                eta_p_49144 = eta_p_49142;\n                            }\n                        }\n                        if (sle32(wave_sizze_56721, skip_threads_56746)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        skip_threads_56746 *= 2;\n                    }\n                }\n                barrier(CLK_LOCAL_MEM_FENCE);\n                // last thread of block 'i' writes its result to offset 'i'\n                {\n                    if ((local_tid_56719 - squot32(local_tid_56719, 32) * 32) == 31 && ltid_in_bounds_56745) {\n                        ((volatile __local int64_t *) red_arr_i64_mem_56723)[sext_i32_i64(squot32(local_tid_56719, 32))] = eta_p_49141;\n                        ((volatile __local double *) red_arr_f64_mem_56725)[sext_i32_i64(squot32(local_tid_56719, 32))] = eta_p_49142;\n                    }\n                }\n                barrier(CLK_LOCAL_MEM_FENCE);\n                // scan the first block, after which offset 'i' contains carry-in for block 'i+1'\n                {\n                    int32_t skip_threads_56749;\n                    \n                    // read input for in-block scan\n                  ", "  {\n                        if (squot32(local_tid_56719, 32) == 0 && ltid_in_bounds_56745) {\n                            eta_p_56735 = ((volatile __local int64_t *) red_arr_i64_mem_56723)[sext_i32_i64(local_tid_56719)];\n                            eta_p_56736 = ((volatile __local double *) red_arr_f64_mem_56725)[sext_i32_i64(local_tid_56719)];\n                            if ((local_tid_56719 - squot32(local_tid_56719, 32) * 32) == 0) {\n                                eta_p_56733 = eta_p_56735;\n                                eta_p_56734 = eta_p_56736;\n                            }\n                        }\n                    }\n                    // in-block scan (hopefully no barriers needed)\n                    {\n                        skip_threads_56749 = 1;\n                        while (slt32(skip_threads_56749, 32)) {\n                            bool thread_active_56750 = sle32(skip_threads_56749, local_tid_56719 - squot32(local_tid_56719, 32) * 32) && (squot32(local_tid_56719, 32) == 0 && ltid_in_bounds_56745);\n                            \n                            if (thread_active_56750) {\n                                // read operands\n                                {\n                                    eta_p_56733 = ((volatile __local int64_t *) red_arr_i64_mem_56723)[sext_i32_i64(local_tid_56719) - sext_i32_i64(skip_threads_56749)];\n                                    eta_p_56734 = ((volatile __local double *) red_arr_f64_mem_56725)[sext_i32_i64(local_tid_56719) - sext_i32_i64(skip_threads_56749)];\n                                }\n                            }\n                            // perform operation\n                            {\n                                bool inactive_56751 = slt64(srem64(sext_i32_i64(local_tid_56719 * 32 + 32 - 1), conc_tmp_43977), sext_i32_i64(local_tid_56719 * 32 + 32 - 1) - sext_i32_i64((local_tid_56719 - skip_threads_56749) * 32 + 32 - 1));\n                                \n                                if (th", "read_active_56750 && inactive_56751) {\n                                    eta_p_56733 = eta_p_56735;\n                                    eta_p_56734 = eta_p_56736;\n                                }\n                                if (thread_active_56750) {\n                                    if (!inactive_56751) {\n                                        bool zg_res_56737 = clBase_36811 < eta_p_56734;\n                                        bool zg_res_56738 = clBase_36811 < eta_p_56736;\n                                        bool x_56739 = zg_res_56737 && zg_res_56738;\n                                        int64_t lifted_lambda_res_56740;\n                                        double lifted_lambda_res_56741;\n                                        \n                                        if (x_56739) {\n                                            lifted_lambda_res_56740 = (int64_t) -1;\n                                            lifted_lambda_res_56741 = INFINITY;\n                                        } else {\n                                            bool zl_res_56742 = eta_p_56734 < eta_p_56736;\n                                            int64_t lifted_lambda_res_f_res_56743;\n                                            \n                                            if (zl_res_56742) {\n                                                lifted_lambda_res_f_res_56743 = eta_p_56733;\n                                            } else {\n                                                lifted_lambda_res_f_res_56743 = eta_p_56735;\n                                            }\n                                            \n                                            double lifted_lambda_res_f_res_56744;\n                                            \n                                            if (zl_res_56742) {\n                                                lifted_lambda_res_f_res_56744 = eta_p_56734;\n                                            } else {\n                  ",
                                    "                              lifted_lambda_res_f_res_56744 = eta_p_56736;\n                                            }\n                                            lifted_lambda_res_56740 = lifted_lambda_res_f_res_56743;\n                                            lifted_lambda_res_56741 = lifted_lambda_res_f_res_56744;\n                                        }\n                                        eta_p_56733 = lifted_lambda_res_56740;\n                                        eta_p_56734 = lifted_lambda_res_56741;\n                                    }\n                                }\n                            }\n                            if (sle32(wave_sizze_56721, skip_threads_56749)) {\n                                barrier(CLK_LOCAL_MEM_FENCE);\n                            }\n                            if (thread_active_56750) {\n                                // write result\n                                {\n                                    ((volatile __local int64_t *) red_arr_i64_mem_56723)[sext_i32_i64(local_tid_56719)] = eta_p_56733;\n                                    eta_p_56735 = eta_p_56733;\n                                    ((volatile __local double *) red_arr_f64_mem_56725)[sext_i32_i64(local_tid_56719)] = eta_p_56734;\n                                    eta_p_56736 = eta_p_56734;\n                                }\n                            }\n                            if (sle32(wave_sizze_56721, skip_threads_56749)) {\n                                barrier(CLK_LOCAL_MEM_FENCE);\n                            }\n                            skip_threads_56749 *= 2;\n                        }\n                    }\n                }\n                barrier(CLK_LOCAL_MEM_FENCE);\n                \n                bool no_carry_in_56752 = squot32(local_tid_56719, 32) == 0 || !ltid_in_bounds_56745;\n                \n                // carry-in for every block except the first\n                {\n                    // read operands\n                    {", "\n                        if (!no_carry_in_56752) {\n                            eta_p_49143 = eta_p_49141;\n                            eta_p_49144 = eta_p_49142;\n                            eta_p_49141 = ((__local int64_t *) red_arr_i64_mem_56723)[sext_i32_i64(squot32(local_tid_56719, 32)) - (int64_t) 1];\n                            eta_p_49142 = ((__local double *) red_arr_f64_mem_56725)[sext_i32_i64(squot32(local_tid_56719, 32)) - (int64_t) 1];\n                        }\n                    }\n                    // perform operation\n                    {\n                        bool inactive_56753 = slt64(srem64(sext_i32_i64(local_tid_56719), conc_tmp_43977), sext_i32_i64(local_tid_56719) - sext_i32_i64(squot32(local_tid_56719, 32) * 32 - 1));\n                        \n                        if (!no_carry_in_56752) {\n                            if (inactive_56753) {\n                                eta_p_49141 = eta_p_49143;\n                                eta_p_49142 = eta_p_49144;\n                            }\n                        }\n                        if (!no_carry_in_56752) {\n                            if (!inactive_56753) {\n                                bool zg_res_49145 = clBase_36811 < eta_p_49142;\n                                bool zg_res_49146 = clBase_36811 < eta_p_49144;\n                                bool x_49147 = zg_res_49145 && zg_res_49146;\n                                int64_t lifted_lambda_res_49148;\n                                double lifted_lambda_res_49149;\n                                \n                                if (x_49147) {\n                                    lifted_lambda_res_49148 = (int64_t) -1;\n                                    lifted_lambda_res_49149 = INFINITY;\n                                } else {\n                                    bool zl_res_49150 = eta_p_49142 < eta_p_49144;\n                                    int64_t lifted_lambda_res_f_res_49151;\n                                    \n                ", "                    if (zl_res_49150) {\n                                        lifted_lambda_res_f_res_49151 = eta_p_49141;\n                                    } else {\n                                        lifted_lambda_res_f_res_49151 = eta_p_49143;\n                                    }\n                                    \n                                    double lifted_lambda_res_f_res_49152;\n                                    \n                                    if (zl_res_49150) {\n                                        lifted_lambda_res_f_res_49152 = eta_p_49142;\n                                    } else {\n                                        lifted_lambda_res_f_res_49152 = eta_p_49144;\n                                    }\n                                    lifted_lambda_res_49148 = lifted_lambda_res_f_res_49151;\n                                    lifted_lambda_res_49149 = lifted_lambda_res_f_res_49152;\n                                }\n                                eta_p_49141 = lifted_lambda_res_49148;\n                                eta_p_49142 = lifted_lambda_res_49149;\n                            }\n                        }\n                    }\n                    // write final result\n                    {\n                        if (!no_carry_in_56752) {\n                            ((__local int64_t *) red_arr_i64_mem_56723)[sext_i32_i64(local_tid_56719)] = eta_p_49141;\n                            ((__local double *) red_arr_f64_mem_56725)[sext_i32_i64(local_tid_56719)] = eta_p_49142;\n                        }\n                    }\n                }\n                barrier(CLK_LOCAL_MEM_FENCE);\n                // restore correct values for first block\n                {\n                    if (squot32(local_tid_56719, 32) == 0 && ltid_in_bounds_56745) {\n                        ((__local int64_t *) red_arr_i64_mem_56723)[sext_i32_i64(local_tid_56719)] = eta_p_49143;\n                        ((__local double *) red_arr_f64_mem_56725)[sext_i3",
                                    "2_i64(local_tid_56719)] = eta_p_49144;\n                    }\n                }\n                barrier(CLK_LOCAL_MEM_FENCE);\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        // save final values of segments\n        {\n            if (slt64(sext_i32_i64(virt_tblock_id_56730) * squot64(segred_tblock_sizze_49133, segment_sizze_nonzzero_56716) + sext_i32_i64(local_tid_56719), dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_44563) && slt64(sext_i32_i64(local_tid_56719), squot64(segred_tblock_sizze_49133, segment_sizze_nonzzero_56716))) {\n                int64_t tmp_56754 = ((__local int64_t *) red_arr_i64_mem_56723)[(sext_i32_i64(local_tid_56719) + (int64_t) 1) * segment_sizze_nonzzero_56716 - (int64_t) 1];\n                \n                ((__global int64_t *) mem_53556)[inf_44560 + (sext_i32_i64(virt_tblock_id_56730) * squot64(segred_tblock_sizze_49133, segment_sizze_nonzzero_56716) + sext_i32_i64(local_tid_56719))] = tmp_56754;\n                \n                double tmp_56755 = ((__local double *) red_arr_f64_mem_56725)[(sext_i32_i64(local_tid_56719) + (int64_t) 1) * segment_sizze_nonzzero_56716 - (int64_t) 1];\n                \n                ((__global double *) mem_54274)[sext_i32_i64(virt_tblock_id_56730) * squot64(segred_tblock_sizze_49133, segment_sizze_nonzzero_56716) + sext_i32_i64(local_tid_56719)] = tmp_56755;\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    }\n    \n  error_3:\n    return;\n    #undef segred_tblock_sizze_49133\n}\nFUTHARK_KERNEL_SIZED(do_DBSCAN_doublezisegscan_46953_dim1, 1, 1)\nvoid do_DBSCAN_doublezisegscan_46953(__global int *global_failure, int64_t n_36798, int64_t num_tblocks_46950, int64_t num_virt_blocks_54588, int64_t num_virt_threads_54589, __global unsigned char *current_partition_mem_53526, __global unsigned char *mem_53535, __global unsigned char *mem_53537, __global unsigned char *status_flags_mem_54590, __global unsigned char *aggregates_mem_54612, _", "_global unsigned char *incprefixes_mem_54614, __global unsigned char *global_dynid_mem_54616)\n{\n    #define segscan_tblock_sizze_46948 (do_DBSCAN_doublezisegscan_46953zisegscan_tblock_sizze_46948)\n    #define chunk_sizze_54587 (do_DBSCAN_doublezisegscan_46953zichunk_sizze_54587)\n    \n    volatile __local unsigned char *local_mem_54646_backing_0 = &shared_mem[0];\n    const int64_t local_mem_54646_backing_0_offset = 0 + (smax64(smax64((int64_t) 288, (int64_t) 8 * segscan_tblock_sizze_46948), chunk_sizze_54587 * segscan_tblock_sizze_46948 * (int64_t) 8) + srem64((int64_t) 8 - srem64(smax64(smax64((int64_t) 288, (int64_t) 8 * segscan_tblock_sizze_46948), chunk_sizze_54587 * segscan_tblock_sizze_46948 * (int64_t) 8), (int64_t) 8), (int64_t) 8));\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_54639;\n    int32_t tblock_sizze_54642;\n    int32_t wave_sizze_54641;\n    int32_t block_id_54640;\n    int32_t global_tid_54638;\n    int64_t phys_tid_46953;\n    int32_t chunk_sizze_32b_54643;\n    int64_t byte_offsets_54644;\n    int64_t warp_byte_offset_54645;\n    __local unsigned char *local_mem_54646;\n    int64_t trans_arr_len_54647;\n    int64_t phys_block_id_54653;\n    int64_t virtloop_bound_54654;\n    \n    local_tid_54639 = get_local_id(0);\n    tblock_sizze_54642 = get_local_size(0);\n    wave_sizze_54641 = LOCKSTEP_WIDTH;\n    block_id_54640 = get_tblock_id(0);\n    global_tid_54638 = block_id_54640 * tblock_sizze_54642 + local_tid_54639;\n    phys_tid_46953 = sext_i32_i64(global_tid_54638);\n    chunk_sizze_32b_54643 = sext_i64_i32(chunk_sizze_54587);\n    byte_offsets_54644 = segscan_tblock_sizze_46948 * (int64_t) 8;\n    warp_byte_offset_54645 = (int64_t) 288;\n    // Allocate reusable shared memory\n    { }\n    local_mem_54646 = (__local unsigned char *) local_mem_54646_backing_0;\n    trans_arr_len_54647 = chunk_sizze_54587 * segscan_tblock_sizze_46948;\n    phys_block_id_54653 = get_tblock_id(0);\n    virtloop_bound_54654 = sdiv_up64(num_virt_blocks_54588 -", " phys_block_id_54653, num_tblocks_46950);\n    for (int64_t virtloop_i_54655 = 0; virtloop_i_54655 < virtloop_bound_54654; virtloop_i_54655++) {\n        int64_t dynamic_id_54656;\n        int64_t block_offset_54657;\n        int64_t sgm_idx_54658;\n        int32_t boundary_54659;\n        int32_t segsizze_compact_54660;\n        int64_t private_mem_54661[chunk_sizze_54587];\n        int64_t thd_offset_54663;\n        int64_t acc_54679;\n        int64_t prefix_54689;\n        bool block_new_sgm_54690;\n        \n        // First thread in block fetches this block's dynamic_id\n        {\n            if (local_tid_54639 == 0) {\n                dynamic_id_54656 = atomic_add_i32_global(&((volatile __global int *) global_dynid_mem_54616)[(int64_t) 0], (int) 1);\n                // Set dynamic id for this block\n                {\n                    ((__local int64_t *) local_mem_54646)[(int64_t) 0] = dynamic_id_54656;\n                }\n                // First thread in last (virtual) block resets global dynamic_id\n                {\n                    if (dynamic_id_54656 == num_virt_blocks_54588 - (int64_t) 1) {\n                        ((__global int32_t *) global_dynid_mem_54616)[(int64_t) 0] = 0;\n                    }\n                }\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        dynamic_id_54656 = ((__local int32_t *) local_mem_54646)[(int64_t) 0];\n        barrier(CLK_LOCAL_MEM_FENCE);\n        block_offset_54657 = dynamic_id_54656 * chunk_sizze_54587 * segscan_tblock_sizze_46948;\n        sgm_idx_54658 = smod64(block_offset_54657, n_36798);\n        boundary_54659 = sext_i64_i32(smin64(chunk_sizze_54587 * segscan_tblock_sizze_46948, n_36798 - sgm_idx_54658));\n        segsizze_compact_54660 = sext_i64_i32(smin64(chunk_sizze_54587 * segscan_tblock_sizze_46948, n_36798));\n        thd_offset_54663 = block_offset_54657 + sext_i32_i64(local_tid_54639);\n        // Load and map\n        {\n            for (int64_t i_54664 = 0; i_54664 < chunk_sizze_54587; i_54664++) {\n",
                                    "                int64_t virt_tid_54665 = thd_offset_54663 + i_54664 * segscan_tblock_sizze_46948;\n                int64_t slice_54666 = n_36798;\n                int64_t gtid_46952 = virt_tid_54665;\n                int64_t remnant_54667 = virt_tid_54665 - gtid_46952;\n                \n                if (slt64(virt_tid_54665, n_36798)) {\n                    bool eta_p_45084 = ((__global bool *) current_partition_mem_53526)[gtid_46952];\n                    int64_t defunc_0_f_res_45085 = btoi_bool_i64(eta_p_45084);\n                    \n                    ((__global int64_t *) mem_53537)[gtid_46952] = defunc_0_f_res_45085;\n                    private_mem_54661[i_54664] = defunc_0_f_res_45085;\n                } else {\n                    private_mem_54661[i_54664] = (int64_t) 0;\n                }\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        // Transpose scan inputs\n        {\n            for (int64_t i_54668 = 0; i_54668 < chunk_sizze_54587; i_54668++) {\n                int64_t sharedIdx_54669 = sext_i32_i64(local_tid_54639) + i_54668 * segscan_tblock_sizze_46948;\n                int64_t tmp_54670 = private_mem_54661[i_54668];\n                \n                ((__local int64_t *) local_mem_54646)[sharedIdx_54669] = tmp_54670;\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            for (int64_t i_54671 = 0; i_54671 < chunk_sizze_54587; i_54671++) {\n                int64_t sharedIdx_54672 = sext_i32_i64(local_tid_54639) * chunk_sizze_54587 + i_54671;\n                int64_t tmp_54673 = ((__local int64_t *) local_mem_54646)[sharedIdx_54672];\n                \n                private_mem_54661[i_54671] = tmp_54673;\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n        }\n        // Per thread scan\n        {\n            for (int64_t i_54674 = 0; i_54674 < chunk_sizze_54587 - (int64_t) 1; i_54674++) {\n                int64_t eta_p_43642;\n                int64_t eta_p_43643;\n                \n                eta_p_43642 = private_mem_5", "4661[i_54674];\n                eta_p_43643 = private_mem_54661[i_54674 + (int64_t) 1];\n                \n                int64_t defunc_0_op_res_43644 = add64(eta_p_43642, eta_p_43643);\n                \n                private_mem_54661[i_54674 + (int64_t) 1] = defunc_0_op_res_43644;\n            }\n        }\n        // Publish results in shared memory\n        {\n            int64_t tmp_54675 = private_mem_54661[chunk_sizze_54587 - (int64_t) 1];\n            \n            ((__local int64_t *) local_mem_54646)[sext_i32_i64(local_tid_54639)] = tmp_54675;\n            barrier(CLK_LOCAL_MEM_FENCE);\n        }\n        // Scan results (with warp scan)\n        {\n            int64_t eta_p_54676;\n            int64_t eta_p_54677;\n            int64_t eta_p_54680;\n            int64_t eta_p_54681;\n            bool ltid_in_bounds_54683 = slt64(sext_i32_i64(local_tid_54639), num_virt_threads_54589);\n            int32_t skip_threads_54684;\n            \n            // read input for in-block scan\n            {\n                if (ltid_in_bounds_54683) {\n                    eta_p_54677 = ((volatile __local int64_t *) local_mem_54646)[sext_i32_i64(local_tid_54639)];\n                    if ((local_tid_54639 - squot32(local_tid_54639, 32) * 32) == 0) {\n                        eta_p_54676 = eta_p_54677;\n                    }\n                }\n            }\n            // in-block scan (hopefully no barriers needed)\n            {\n                skip_threads_54684 = 1;\n                while (slt32(skip_threads_54684, 32)) {\n                    bool thread_active_54685 = sle32(skip_threads_54684, local_tid_54639 - squot32(local_tid_54639, 32) * 32) && ltid_in_bounds_54683;\n                    \n                    if (thread_active_54685) {\n                        // read operands\n                        {\n                            eta_p_54676 = ((volatile __local int64_t *) local_mem_54646)[sext_i32_i64(local_tid_54639) - sext_i32_i64(skip_threads_54684)];\n                        }\n             ", "       }\n                    // perform operation\n                    {\n                        if (thread_active_54685) {\n                            int64_t defunc_0_op_res_54678 = add64(eta_p_54676, eta_p_54677);\n                            \n                            eta_p_54676 = defunc_0_op_res_54678;\n                        }\n                    }\n                    if (sle32(wave_sizze_54641, skip_threads_54684)) {\n                        barrier(CLK_LOCAL_MEM_FENCE);\n                    }\n                    if (thread_active_54685) {\n                        // write result\n                        {\n                            ((volatile __local int64_t *) local_mem_54646)[sext_i32_i64(local_tid_54639)] = eta_p_54676;\n                            eta_p_54677 = eta_p_54676;\n                        }\n                    }\n                    if (sle32(wave_sizze_54641, skip_threads_54684)) {\n                        barrier(CLK_LOCAL_MEM_FENCE);\n                    }\n                    skip_threads_54684 *= 2;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // last thread of block 'i' writes its result to offset 'i'\n            {\n                if ((local_tid_54639 - squot32(local_tid_54639, 32) * 32) == 31 && ltid_in_bounds_54683) {\n                    ((volatile __local int64_t *) local_mem_54646)[sext_i32_i64(squot32(local_tid_54639, 32))] = eta_p_54676;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // scan the first block, after which offset 'i' contains carry-in for block 'i+1'\n            {\n                int32_t skip_threads_54686;\n                \n                // read input for in-block scan\n                {\n                    if (squot32(local_tid_54639, 32) == 0 && ltid_in_bounds_54683) {\n                        eta_p_54681 = ((volatile __local int64_t *) local_mem_54646)[sext_i32_i64(local_tid_54639)];\n                        if ((local_tid_54639 - squot32(local_t",
                                    "id_54639, 32) * 32) == 0) {\n                            eta_p_54680 = eta_p_54681;\n                        }\n                    }\n                }\n                // in-block scan (hopefully no barriers needed)\n                {\n                    skip_threads_54686 = 1;\n                    while (slt32(skip_threads_54686, 32)) {\n                        bool thread_active_54687 = sle32(skip_threads_54686, local_tid_54639 - squot32(local_tid_54639, 32) * 32) && (squot32(local_tid_54639, 32) == 0 && ltid_in_bounds_54683);\n                        \n                        if (thread_active_54687) {\n                            // read operands\n                            {\n                                eta_p_54680 = ((volatile __local int64_t *) local_mem_54646)[sext_i32_i64(local_tid_54639) - sext_i32_i64(skip_threads_54686)];\n                            }\n                        }\n                        // perform operation\n                        {\n                            if (thread_active_54687) {\n                                int64_t defunc_0_op_res_54682 = add64(eta_p_54680, eta_p_54681);\n                                \n                                eta_p_54680 = defunc_0_op_res_54682;\n                            }\n                        }\n                        if (sle32(wave_sizze_54641, skip_threads_54686)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        if (thread_active_54687) {\n                            // write result\n                            {\n                                ((volatile __local int64_t *) local_mem_54646)[sext_i32_i64(local_tid_54639)] = eta_p_54680;\n                                eta_p_54681 = eta_p_54680;\n                            }\n                        }\n                        if (sle32(wave_sizze_54641, skip_threads_54686)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        skip_threads_546", "86 *= 2;\n                    }\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            \n            bool no_carry_in_54688 = squot32(local_tid_54639, 32) == 0 || !ltid_in_bounds_54683;\n            \n            // carry-in for every block except the first\n            {\n                // read operands\n                {\n                    if (!no_carry_in_54688) {\n                        eta_p_54677 = eta_p_54676;\n                        eta_p_54676 = ((__local int64_t *) local_mem_54646)[sext_i32_i64(squot32(local_tid_54639, 32)) - (int64_t) 1];\n                    }\n                }\n                // perform operation\n                {\n                    if (!no_carry_in_54688) {\n                        int64_t defunc_0_op_res_54678 = add64(eta_p_54676, eta_p_54677);\n                        \n                        eta_p_54676 = defunc_0_op_res_54678;\n                    }\n                }\n                // write final result\n                {\n                    if (!no_carry_in_54688) {\n                        ((__local int64_t *) local_mem_54646)[sext_i32_i64(local_tid_54639)] = eta_p_54676;\n                    }\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // restore correct values for first block\n            {\n                if (squot32(local_tid_54639, 32) == 0 && ltid_in_bounds_54683) {\n                    ((__local int64_t *) local_mem_54646)[sext_i32_i64(local_tid_54639)] = eta_p_54677;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            barrier(CLK_LOCAL_MEM_FENCE);\n            if (local_tid_54639 == 0) {\n                acc_54679 = ((__local int64_t *) local_mem_54646)[segscan_tblock_sizze_46948 - (int64_t) 1];\n            } else {\n                acc_54679 = ((__local int64_t *) local_mem_54646)[sext_i32_i64(local_tid_54639) - (int64_t) 1];\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n        }\n        prefix_54689 = (int64_t) 0;\n   ", "     block_new_sgm_54690 = sgm_idx_54658 == (int64_t) 0;\n        // Perform lookback\n        {\n            if (block_new_sgm_54690 && local_tid_54639 == 0) {\n                ((volatile __global int64_t *) incprefixes_mem_54614)[dynamic_id_54656] = acc_54679;\n                mem_fence_global();\n                ((volatile __global int8_t *) status_flags_mem_54590)[dynamic_id_54656] = (int8_t) 2;\n                acc_54679 = (int64_t) 0;\n            }\n            if (!block_new_sgm_54690 && slt32(local_tid_54639, wave_sizze_54641)) {\n                if (local_tid_54639 == 0) {\n                    ((volatile __global int64_t *) aggregates_mem_54612)[dynamic_id_54656] = acc_54679;\n                    mem_fence_global();\n                    ((volatile __global int8_t *) status_flags_mem_54590)[dynamic_id_54656] = (int8_t) 1;\n                    \n                    int8_t tmp_54691 = ((volatile __global int8_t *) status_flags_mem_54590)[dynamic_id_54656 - (int64_t) 1];\n                    \n                    ((volatile __local int8_t *) local_mem_54646)[(int64_t) 0] = tmp_54691;\n                }\n                mem_fence_local();\n                \n                int8_t status_54692 = ((__local int8_t *) local_mem_54646)[(int64_t) 0];\n                \n                if (status_54692 == (int8_t) 2) {\n                    if (local_tid_54639 == 0) {\n                        prefix_54689 = ((volatile __global int64_t *) incprefixes_mem_54614)[dynamic_id_54656 - (int64_t) 1];\n                    }\n                } else {\n                    int32_t readOffset_54693 = sext_i64_i32(dynamic_id_54656 - sext_i32_i64(wave_sizze_54641));\n                    \n                    while (slt32(wave_sizze_54641 * -1, readOffset_54693)) {\n                        int32_t read_i_54694 = readOffset_54693 + local_tid_54639;\n                        int64_t aggr_54695 = (int64_t) 0;\n                        int8_t flag_54696 = (int8_t) 0;\n                        \n                        if (sle",
                                    "32(0, read_i_54694)) {\n                            flag_54696 = ((volatile __global int8_t *) status_flags_mem_54590)[sext_i32_i64(read_i_54694)];\n                            if (flag_54696 == (int8_t) 2) {\n                                aggr_54695 = ((volatile __global int64_t *) incprefixes_mem_54614)[sext_i32_i64(read_i_54694)];\n                            } else if (flag_54696 == (int8_t) 1) {\n                                aggr_54695 = ((volatile __global int64_t *) aggregates_mem_54612)[sext_i32_i64(read_i_54694)];\n                            }\n                        }\n                        ((__local int64_t *) local_mem_54646)[(int64_t) 4 + sext_i32_i64(local_tid_54639)] = aggr_54695;\n                        ((__local int8_t *) local_mem_54646)[sext_i32_i64(local_tid_54639)] = flag_54696;\n                        flag_54696 = ((__local int8_t *) local_mem_54646)[sext_i32_i64(wave_sizze_54641) - (int64_t) 1];\n                        if (slt8(flag_54696, (int8_t) 2)) {\n                            int8_t flg_x_54700;\n                            int8_t flg_y_54701;\n                            int64_t eta_p_54697;\n                            int64_t eta_p_54698;\n                            int32_t skip_threads_54702;\n                            \n                            // read input for in-block scan\n                            {\n                                flg_y_54701 = ((volatile __local int8_t *) local_mem_54646)[sext_i32_i64(local_tid_54639)];\n                                eta_p_54698 = ((volatile __local int64_t *) local_mem_54646)[(int64_t) 4 + sext_i32_i64(local_tid_54639)];\n                                if ((local_tid_54639 - squot32(local_tid_54639, 32) * 32) == 0) {\n                                    eta_p_54697 = eta_p_54698;\n                                    flg_x_54700 = flg_y_54701;\n                                }\n                            }\n                            // in-block scan (hopefully no barriers needed)\n           ", "                 {\n                                skip_threads_54702 = 1;\n                                while (slt32(skip_threads_54702, 32)) {\n                                    if (sle32(skip_threads_54702, local_tid_54639 - squot32(local_tid_54639, 32) * 32)) {\n                                        // read operands\n                                        {\n                                            flg_x_54700 = ((volatile __local int8_t *) local_mem_54646)[sext_i32_i64(local_tid_54639) - sext_i32_i64(skip_threads_54702)];\n                                            eta_p_54697 = ((volatile __local int64_t *) local_mem_54646)[(int64_t) 4 + (sext_i32_i64(local_tid_54639) - sext_i32_i64(skip_threads_54702))];\n                                        }\n                                        // perform operation\n                                        {\n                                            if (flg_y_54701 == (int8_t) 2 || flg_y_54701 == (int8_t) 0) {\n                                                flg_x_54700 = flg_y_54701;\n                                                eta_p_54697 = eta_p_54698;\n                                            } else {\n                                                int64_t defunc_0_op_res_54699 = add64(eta_p_54697, eta_p_54698);\n                                                \n                                                eta_p_54697 = defunc_0_op_res_54699;\n                                            }\n                                        }\n                                        // write result\n                                        {\n                                            ((volatile __local int8_t *) local_mem_54646)[sext_i32_i64(local_tid_54639)] = flg_x_54700;\n                                            flg_y_54701 = flg_x_54700;\n                                            ((volatile __local int64_t *) local_mem_54646)[(int64_t) 4 + sext_i32_i64(local_tid_54639)] = eta_p_54697;\n                            ", "                eta_p_54698 = eta_p_54697;\n                                        }\n                                    }\n                                    skip_threads_54702 *= 2;\n                                }\n                            }\n                        }\n                        flag_54696 = ((__local int8_t *) local_mem_54646)[sext_i32_i64(wave_sizze_54641) - (int64_t) 1];\n                        aggr_54695 = ((__local int64_t *) local_mem_54646)[(int64_t) 4 + (sext_i32_i64(wave_sizze_54641) - (int64_t) 1)];\n                        if (flag_54696 == (int8_t) 2) {\n                            readOffset_54693 = wave_sizze_54641 * -1;\n                        } else if (flag_54696 == (int8_t) 1) {\n                            readOffset_54693 -= wave_sizze_54641;\n                        }\n                        if (slt8((int8_t) 0, flag_54696)) {\n                            int64_t eta_p_54703 = aggr_54695;\n                            int64_t eta_p_54704 = prefix_54689;\n                            int64_t defunc_0_op_res_54705 = add64(eta_p_54703, eta_p_54704);\n                            \n                            prefix_54689 = defunc_0_op_res_54705;\n                        }\n                        mem_fence_local();\n                    }\n                }\n                if (local_tid_54639 == 0) {\n                    if (boundary_54659 == sext_i64_i32(segscan_tblock_sizze_46948 * chunk_sizze_54587)) {\n                        int64_t eta_p_54706 = prefix_54689;\n                        int64_t eta_p_54707 = acc_54679;\n                        int64_t defunc_0_op_res_54708 = add64(eta_p_54706, eta_p_54707);\n                        \n                        ((volatile __global int64_t *) incprefixes_mem_54614)[dynamic_id_54656] = defunc_0_op_res_54708;\n                        mem_fence_global();\n                        ((volatile __global int8_t *) status_flags_mem_54590)[dynamic_id_54656] = (int8_t) 2;\n                    }\n                    ((__l",
                                    "ocal int64_t *) local_mem_54646)[(int64_t) 4] = prefix_54689;\n                    acc_54679 = (int64_t) 0;\n                }\n            }\n            if (!(dynamic_id_54656 == (int64_t) 0)) {\n                barrier(CLK_LOCAL_MEM_FENCE);\n                prefix_54689 = ((__local int64_t *) local_mem_54646)[(int64_t) 4];\n                barrier(CLK_LOCAL_MEM_FENCE);\n            }\n        }\n        // Distribute results\n        {\n            int64_t eta_p_54709;\n            int64_t eta_p_54710;\n            int64_t eta_p_54712 = prefix_54689;\n            int64_t eta_p_54713 = acc_54679;\n            \n            if (slt32(local_tid_54639 * chunk_sizze_32b_54643, boundary_54659) && !block_new_sgm_54690) {\n                int64_t defunc_0_op_res_54714 = add64(eta_p_54712, eta_p_54713);\n                \n                eta_p_54709 = defunc_0_op_res_54714;\n            } else {\n                eta_p_54709 = acc_54679;\n            }\n            \n            int32_t stopping_point_54715 = segsizze_compact_54660 - srem32(local_tid_54639 * chunk_sizze_32b_54643 - 1 + segsizze_compact_54660 - boundary_54659, segsizze_compact_54660);\n            \n            for (int64_t i_54716 = 0; i_54716 < chunk_sizze_54587; i_54716++) {\n                if (slt32(sext_i64_i32(i_54716), stopping_point_54715 - 1)) {\n                    eta_p_54710 = private_mem_54661[i_54716];\n                    \n                    int64_t defunc_0_op_res_54711 = add64(eta_p_54709, eta_p_54710);\n                    \n                    private_mem_54661[i_54716] = defunc_0_op_res_54711;\n                }\n            }\n        }\n        // Transpose scan output and Write it to global memory in coalesced fashion\n        {\n            for (int64_t i_54717 = 0; i_54717 < chunk_sizze_54587; i_54717++) {\n                int64_t sharedIdx_54718 = sext_i32_i64(local_tid_54639) * chunk_sizze_54587 + i_54717;\n                int64_t tmp_54719 = private_mem_54661[i_54717];\n                \n                ((__local int64", "_t *) local_mem_54646)[sharedIdx_54718] = tmp_54719;\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            for (int64_t i_54720 = 0; i_54720 < chunk_sizze_54587; i_54720++) {\n                int64_t flat_idx_54721 = thd_offset_54663 + i_54720 * segscan_tblock_sizze_46948;\n                int64_t slice_54722 = n_36798;\n                int64_t gtid_46952 = flat_idx_54721;\n                int64_t remnant_54723 = flat_idx_54721 - gtid_46952;\n                \n                if (slt64(flat_idx_54721, n_36798)) {\n                    int64_t tmp_54724 = ((__local int64_t *) local_mem_54646)[flat_idx_54721 - block_offset_54657];\n                    \n                    ((__global int64_t *) mem_53535)[gtid_46952] = tmp_54724;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n        }\n    }\n    \n  error_3:\n    return;\n    #undef segscan_tblock_sizze_46948\n    #undef chunk_sizze_54587\n}\nFUTHARK_KERNEL_SIZED(do_DBSCAN_doublezisegscan_46969_dim1, 1, 1)\nvoid do_DBSCAN_doublezisegscan_46969(__global int *global_failure, int failure_is_an_option, __global int64_t *global_failure_args, int64_t dz2081U_36802, int64_t dz2082U_36803, double zt_res_43632, int64_t num_tblocks_46966, int64_t num_virt_blocks_54792, int64_t num_virt_threads_54793, __global unsigned char *clProc_mem_53513, __global unsigned char *clProc_mem_53514, __global unsigned char *clProc_mem_53515, __global unsigned char *current_partition_mem_53527, __global unsigned char *current_partition_mem_53528, __global unsigned char *mem_53560, __global unsigned char *mem_53564, __global unsigned char *mem_53566, __global unsigned char *mem_53568, __global unsigned char *status_flags_mem_54794, __global unsigned char *aggregates_mem_54796, __global unsigned char *incprefixes_mem_54798, __global unsigned char *global_dynid_mem_54800)\n{\n    #define segscan_tblock_sizze_46964 (do_DBSCAN_doublezisegscan_46969zisegscan_tblock_sizze_46964)\n    #define chunk_sizze_54791 (do_DBSCAN_doublezisegs", "can_46969zichunk_sizze_54791)\n    \n    volatile __local unsigned char *local_mem_54810_backing_0 = &shared_mem[0];\n    const int64_t local_mem_54810_backing_0_offset = 0 + (smax64(smax64((int64_t) 288, (int64_t) 8 * segscan_tblock_sizze_46964), chunk_sizze_54791 * segscan_tblock_sizze_46964 * (int64_t) 8) + srem64((int64_t) 8 - srem64(smax64(smax64((int64_t) 288, (int64_t) 8 * segscan_tblock_sizze_46964), chunk_sizze_54791 * segscan_tblock_sizze_46964 * (int64_t) 8), (int64_t) 8), (int64_t) 8));\n    volatile __local int local_failure;\n    \n    if (failure_is_an_option) {\n        int failed = *global_failure >= 0;\n        \n        if (failed)\n            return;\n    }\n    local_failure = 0;\n    barrier(CLK_LOCAL_MEM_FENCE);\n    \n    int32_t local_tid_54803;\n    int32_t tblock_sizze_54806;\n    int32_t wave_sizze_54805;\n    int32_t block_id_54804;\n    int32_t global_tid_54802;\n    int64_t phys_tid_46969;\n    int32_t chunk_sizze_32b_54807;\n    int64_t byte_offsets_54808;\n    int64_t warp_byte_offset_54809;\n    __local unsigned char *local_mem_54810;\n    int64_t trans_arr_len_54811;\n    int64_t phys_block_id_54817;\n    int64_t virtloop_bound_54818;\n    \n    local_tid_54803 = get_local_id(0);\n    tblock_sizze_54806 = get_local_size(0);\n    wave_sizze_54805 = LOCKSTEP_WIDTH;\n    block_id_54804 = get_tblock_id(0);\n    global_tid_54802 = block_id_54804 * tblock_sizze_54806 + local_tid_54803;\n    phys_tid_46969 = sext_i32_i64(global_tid_54802);\n    chunk_sizze_32b_54807 = sext_i64_i32(chunk_sizze_54791);\n    byte_offsets_54808 = segscan_tblock_sizze_46964 * (int64_t) 8;\n    warp_byte_offset_54809 = (int64_t) 288;\n    // Allocate reusable shared memory\n    { }\n    local_mem_54810 = (__local unsigned char *) local_mem_54810_backing_0;\n    trans_arr_len_54811 = chunk_sizze_54791 * segscan_tblock_sizze_46964;\n    phys_block_id_54817 = get_tblock_id(0);\n    virtloop_bound_54818 = sdiv_up64(num_virt_blocks_54792 - phys_block_id_54817, num_tblocks_46966);\n    for (int64_t virtloop_i",
                                    "_54819 = 0; virtloop_i_54819 < virtloop_bound_54818; virtloop_i_54819++) {\n        int64_t dynamic_id_54820;\n        int64_t block_offset_54821;\n        int64_t sgm_idx_54822;\n        int32_t boundary_54823;\n        int32_t segsizze_compact_54824;\n        int64_t private_mem_54825[chunk_sizze_54791];\n        int64_t thd_offset_54827;\n        int64_t acc_54843;\n        int64_t prefix_54853;\n        bool block_new_sgm_54854;\n        \n        // First thread in block fetches this block's dynamic_id\n        {\n            if (local_tid_54803 == 0) {\n                dynamic_id_54820 = atomic_add_i32_global(&((volatile __global int *) global_dynid_mem_54800)[(int64_t) 0], (int) 1);\n                // Set dynamic id for this block\n                {\n                    ((__local int64_t *) local_mem_54810)[(int64_t) 0] = dynamic_id_54820;\n                }\n                // First thread in last (virtual) block resets global dynamic_id\n                {\n                    if (dynamic_id_54820 == num_virt_blocks_54792 - (int64_t) 1) {\n                        ((__global int32_t *) global_dynid_mem_54800)[(int64_t) 0] = 0;\n                    }\n                }\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        dynamic_id_54820 = ((__local int32_t *) local_mem_54810)[(int64_t) 0];\n        barrier(CLK_LOCAL_MEM_FENCE);\n        block_offset_54821 = dynamic_id_54820 * chunk_sizze_54791 * segscan_tblock_sizze_46964;\n        sgm_idx_54822 = smod64(block_offset_54821, dz2082U_36803);\n        boundary_54823 = sext_i64_i32(smin64(chunk_sizze_54791 * segscan_tblock_sizze_46964, dz2082U_36803 - sgm_idx_54822));\n        segsizze_compact_54824 = sext_i64_i32(smin64(chunk_sizze_54791 * segscan_tblock_sizze_46964, dz2082U_36803));\n        thd_offset_54827 = block_offset_54821 + sext_i32_i64(local_tid_54803);\n        // Load and map\n        {\n            for (int64_t i_54828 = 0; i_54828 < chunk_sizze_54791; i_54828++) {\n                int64_t virt_tid_54829 = thd_offset", "_54827 + i_54828 * segscan_tblock_sizze_46964;\n                int64_t slice_54830 = dz2082U_36803;\n                int64_t gtid_46968 = virt_tid_54829;\n                int64_t remnant_54831 = virt_tid_54829 - gtid_46968;\n                \n                if (slt64(virt_tid_54829, dz2082U_36803)) {\n                    bool y_45051 = slt64(gtid_46968, dz2081U_36802);\n                    bool index_certs_45053;\n                    \n                    if (!y_45051) {\n                        {\n                            if (atomic_cmpxchg_i32_global(global_failure, -1, 20) == -1) {\n                                global_failure_args[0] = (int64_t) gtid_46968;\n                                global_failure_args[1] = (int64_t) dz2081U_36802;\n                                ;\n                            }\n                            local_failure = 1;\n                            goto error_0;\n                        }\n                    }\n                    \n                    double zm_res_53188 = ((__global double *) mem_53560)[(int64_t) 0];\n                    double lifted_lambda_res_45049 = ((__global double *) clProc_mem_53514)[gtid_46968];\n                    int64_t tmp_45054 = ((__global int64_t *) clProc_mem_53513)[gtid_46968];\n                    bool zgze_res_45058 = zm_res_53188 <= lifted_lambda_res_45049;\n                    bool cond_45059;\n                    \n                    if (zgze_res_45058) {\n                        double plus_arg0_45322 = ((__global double *) current_partition_mem_53527)[(int64_t) 0];\n                        double zp_res_45323 = zt_res_43632 + plus_arg0_45322;\n                        bool zlze_res_45324 = lifted_lambda_res_45049 <= zp_res_45323;\n                        \n                        cond_45059 = zlze_res_45324;\n                    } else {\n                        cond_45059 = 0;\n                    }\n                    \n                    bool lifted_lambda_res_45063;\n                    \n                    if ", "(cond_45059) {\n                        double lifted_lambda_res_45050 = ((__global double *) clProc_mem_53515)[gtid_46968];\n                        double minus_arg0_45328 = ((__global double *) current_partition_mem_53528)[(int64_t) 1];\n                        double zm_res_45329 = minus_arg0_45328 - zt_res_43632;\n                        bool zgze_res_45330 = zm_res_45329 <= lifted_lambda_res_45050;\n                        bool lifted_lambda_res_t_res_45331;\n                        \n                        if (zgze_res_45330) {\n                            double plus_arg0_45332 = ((__global double *) current_partition_mem_53527)[(int64_t) 1];\n                            double zp_res_45333 = zt_res_43632 + plus_arg0_45332;\n                            bool zlze_res_45334 = lifted_lambda_res_45050 <= zp_res_45333;\n                            \n                            lifted_lambda_res_t_res_45331 = zlze_res_45334;\n                        } else {\n                            lifted_lambda_res_t_res_45331 = 0;\n                        }\n                        lifted_lambda_res_45063 = lifted_lambda_res_t_res_45331;\n                    } else {\n                        lifted_lambda_res_45063 = 0;\n                    }\n                    \n                    int64_t defunc_0_f_res_45071 = btoi_bool_i64(lifted_lambda_res_45063);\n                    \n                    ((__global int64_t *) mem_53566)[gtid_46968] = defunc_0_f_res_45071;\n                    ((__global int64_t *) mem_53568)[gtid_46968] = tmp_45054;\n                    private_mem_54825[i_54828] = defunc_0_f_res_45071;\n                } else {\n                    private_mem_54825[i_54828] = (int64_t) 0;\n                }\n            }\n        }\n        \n      error_0:\n        barrier(CLK_LOCAL_MEM_FENCE);\n        if (local_failure)\n            return;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        // Transpose scan inputs\n        {\n            for (int64_t i_54832 = 0; i_54832 < chunk_sizze_54791; i_5483",
                                    "2++) {\n                int64_t sharedIdx_54833 = sext_i32_i64(local_tid_54803) + i_54832 * segscan_tblock_sizze_46964;\n                int64_t tmp_54834 = private_mem_54825[i_54832];\n                \n                ((__local int64_t *) local_mem_54810)[sharedIdx_54833] = tmp_54834;\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            for (int64_t i_54835 = 0; i_54835 < chunk_sizze_54791; i_54835++) {\n                int64_t sharedIdx_54836 = sext_i32_i64(local_tid_54803) * chunk_sizze_54791 + i_54835;\n                int64_t tmp_54837 = ((__local int64_t *) local_mem_54810)[sharedIdx_54836];\n                \n                private_mem_54825[i_54835] = tmp_54837;\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n        }\n        // Per thread scan\n        {\n            for (int64_t i_54838 = 0; i_54838 < chunk_sizze_54791 - (int64_t) 1; i_54838++) {\n                int64_t eta_p_43721;\n                int64_t eta_p_43722;\n                \n                eta_p_43721 = private_mem_54825[i_54838];\n                eta_p_43722 = private_mem_54825[i_54838 + (int64_t) 1];\n                \n                int64_t defunc_0_op_res_43723 = add64(eta_p_43721, eta_p_43722);\n                \n                private_mem_54825[i_54838 + (int64_t) 1] = defunc_0_op_res_43723;\n            }\n        }\n        // Publish results in shared memory\n        {\n            int64_t tmp_54839 = private_mem_54825[chunk_sizze_54791 - (int64_t) 1];\n            \n            ((__local int64_t *) local_mem_54810)[sext_i32_i64(local_tid_54803)] = tmp_54839;\n            barrier(CLK_LOCAL_MEM_FENCE);\n        }\n        // Scan results (with warp scan)\n        {\n            int64_t eta_p_54840;\n            int64_t eta_p_54841;\n            int64_t eta_p_54844;\n            int64_t eta_p_54845;\n            bool ltid_in_bounds_54847 = slt64(sext_i32_i64(local_tid_54803), num_virt_threads_54793);\n            int32_t skip_threads_54848;\n            \n            // read input for in-block", " scan\n            {\n                if (ltid_in_bounds_54847) {\n                    eta_p_54841 = ((volatile __local int64_t *) local_mem_54810)[sext_i32_i64(local_tid_54803)];\n                    if ((local_tid_54803 - squot32(local_tid_54803, 32) * 32) == 0) {\n                        eta_p_54840 = eta_p_54841;\n                    }\n                }\n            }\n            // in-block scan (hopefully no barriers needed)\n            {\n                skip_threads_54848 = 1;\n                while (slt32(skip_threads_54848, 32)) {\n                    bool thread_active_54849 = sle32(skip_threads_54848, local_tid_54803 - squot32(local_tid_54803, 32) * 32) && ltid_in_bounds_54847;\n                    \n                    if (thread_active_54849) {\n                        // read operands\n                        {\n                            eta_p_54840 = ((volatile __local int64_t *) local_mem_54810)[sext_i32_i64(local_tid_54803) - sext_i32_i64(skip_threads_54848)];\n                        }\n                    }\n                    // perform operation\n                    {\n                        if (thread_active_54849) {\n                            int64_t defunc_0_op_res_54842 = add64(eta_p_54840, eta_p_54841);\n                            \n                            eta_p_54840 = defunc_0_op_res_54842;\n                        }\n                    }\n                    if (sle32(wave_sizze_54805, skip_threads_54848)) {\n                        barrier(CLK_LOCAL_MEM_FENCE);\n                    }\n                    if (thread_active_54849) {\n                        // write result\n                        {\n                            ((volatile __local int64_t *) local_mem_54810)[sext_i32_i64(local_tid_54803)] = eta_p_54840;\n                            eta_p_54841 = eta_p_54840;\n                        }\n                    }\n                    if (sle32(wave_sizze_54805, skip_threads_54848)) {\n                        barrier(CLK_LOCAL_MEM_FENCE);\n              ", "      }\n                    skip_threads_54848 *= 2;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // last thread of block 'i' writes its result to offset 'i'\n            {\n                if ((local_tid_54803 - squot32(local_tid_54803, 32) * 32) == 31 && ltid_in_bounds_54847) {\n                    ((volatile __local int64_t *) local_mem_54810)[sext_i32_i64(squot32(local_tid_54803, 32))] = eta_p_54840;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // scan the first block, after which offset 'i' contains carry-in for block 'i+1'\n            {\n                int32_t skip_threads_54850;\n                \n                // read input for in-block scan\n                {\n                    if (squot32(local_tid_54803, 32) == 0 && ltid_in_bounds_54847) {\n                        eta_p_54845 = ((volatile __local int64_t *) local_mem_54810)[sext_i32_i64(local_tid_54803)];\n                        if ((local_tid_54803 - squot32(local_tid_54803, 32) * 32) == 0) {\n                            eta_p_54844 = eta_p_54845;\n                        }\n                    }\n                }\n                // in-block scan (hopefully no barriers needed)\n                {\n                    skip_threads_54850 = 1;\n                    while (slt32(skip_threads_54850, 32)) {\n                        bool thread_active_54851 = sle32(skip_threads_54850, local_tid_54803 - squot32(local_tid_54803, 32) * 32) && (squot32(local_tid_54803, 32) == 0 && ltid_in_bounds_54847);\n                        \n                        if (thread_active_54851) {\n                            // read operands\n                            {\n                                eta_p_54844 = ((volatile __local int64_t *) local_mem_54810)[sext_i32_i64(local_tid_54803) - sext_i32_i64(skip_threads_54850)];\n                            }\n                        }\n                        // perform operation\n                        {\n              ",
                                    "              if (thread_active_54851) {\n                                int64_t defunc_0_op_res_54846 = add64(eta_p_54844, eta_p_54845);\n                                \n                                eta_p_54844 = defunc_0_op_res_54846;\n                            }\n                        }\n                        if (sle32(wave_sizze_54805, skip_threads_54850)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        if (thread_active_54851) {\n                            // write result\n                            {\n                                ((volatile __local int64_t *) local_mem_54810)[sext_i32_i64(local_tid_54803)] = eta_p_54844;\n                                eta_p_54845 = eta_p_54844;\n                            }\n                        }\n                        if (sle32(wave_sizze_54805, skip_threads_54850)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        skip_threads_54850 *= 2;\n                    }\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            \n            bool no_carry_in_54852 = squot32(local_tid_54803, 32) == 0 || !ltid_in_bounds_54847;\n            \n            // carry-in for every block except the first\n            {\n                // read operands\n                {\n                    if (!no_carry_in_54852) {\n                        eta_p_54841 = eta_p_54840;\n                        eta_p_54840 = ((__local int64_t *) local_mem_54810)[sext_i32_i64(squot32(local_tid_54803, 32)) - (int64_t) 1];\n                    }\n                }\n                // perform operation\n                {\n                    if (!no_carry_in_54852) {\n                        int64_t defunc_0_op_res_54842 = add64(eta_p_54840, eta_p_54841);\n                        \n                        eta_p_54840 = defunc_0_op_res_54842;\n                    }\n                }\n                // write final result\n     ", "           {\n                    if (!no_carry_in_54852) {\n                        ((__local int64_t *) local_mem_54810)[sext_i32_i64(local_tid_54803)] = eta_p_54840;\n                    }\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // restore correct values for first block\n            {\n                if (squot32(local_tid_54803, 32) == 0 && ltid_in_bounds_54847) {\n                    ((__local int64_t *) local_mem_54810)[sext_i32_i64(local_tid_54803)] = eta_p_54841;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            barrier(CLK_LOCAL_MEM_FENCE);\n            if (local_tid_54803 == 0) {\n                acc_54843 = ((__local int64_t *) local_mem_54810)[segscan_tblock_sizze_46964 - (int64_t) 1];\n            } else {\n                acc_54843 = ((__local int64_t *) local_mem_54810)[sext_i32_i64(local_tid_54803) - (int64_t) 1];\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n        }\n        prefix_54853 = (int64_t) 0;\n        block_new_sgm_54854 = sgm_idx_54822 == (int64_t) 0;\n        // Perform lookback\n        {\n            if (block_new_sgm_54854 && local_tid_54803 == 0) {\n                ((volatile __global int64_t *) incprefixes_mem_54798)[dynamic_id_54820] = acc_54843;\n                mem_fence_global();\n                ((volatile __global int8_t *) status_flags_mem_54794)[dynamic_id_54820] = (int8_t) 2;\n                acc_54843 = (int64_t) 0;\n            }\n            if (!block_new_sgm_54854 && slt32(local_tid_54803, wave_sizze_54805)) {\n                if (local_tid_54803 == 0) {\n                    ((volatile __global int64_t *) aggregates_mem_54796)[dynamic_id_54820] = acc_54843;\n                    mem_fence_global();\n                    ((volatile __global int8_t *) status_flags_mem_54794)[dynamic_id_54820] = (int8_t) 1;\n                    \n                    int8_t tmp_54855 = ((volatile __global int8_t *) status_flags_mem_54794)[dynamic_id_54820 - (int64_t) 1];\n    ", "                \n                    ((volatile __local int8_t *) local_mem_54810)[(int64_t) 0] = tmp_54855;\n                }\n                mem_fence_local();\n                \n                int8_t status_54856 = ((__local int8_t *) local_mem_54810)[(int64_t) 0];\n                \n                if (status_54856 == (int8_t) 2) {\n                    if (local_tid_54803 == 0) {\n                        prefix_54853 = ((volatile __global int64_t *) incprefixes_mem_54798)[dynamic_id_54820 - (int64_t) 1];\n                    }\n                } else {\n                    int32_t readOffset_54857 = sext_i64_i32(dynamic_id_54820 - sext_i32_i64(wave_sizze_54805));\n                    \n                    while (slt32(wave_sizze_54805 * -1, readOffset_54857)) {\n                        int32_t read_i_54858 = readOffset_54857 + local_tid_54803;\n                        int64_t aggr_54859 = (int64_t) 0;\n                        int8_t flag_54860 = (int8_t) 0;\n                        \n                        if (sle32(0, read_i_54858)) {\n                            flag_54860 = ((volatile __global int8_t *) status_flags_mem_54794)[sext_i32_i64(read_i_54858)];\n                            if (flag_54860 == (int8_t) 2) {\n                                aggr_54859 = ((volatile __global int64_t *) incprefixes_mem_54798)[sext_i32_i64(read_i_54858)];\n                            } else if (flag_54860 == (int8_t) 1) {\n                                aggr_54859 = ((volatile __global int64_t *) aggregates_mem_54796)[sext_i32_i64(read_i_54858)];\n                            }\n                        }\n                        ((__local int64_t *) local_mem_54810)[(int64_t) 4 + sext_i32_i64(local_tid_54803)] = aggr_54859;\n                        ((__local int8_t *) local_mem_54810)[sext_i32_i64(local_tid_54803)] = flag_54860;\n                        flag_54860 = ((__local int8_t *) local_mem_54810)[sext_i32_i64(wave_sizze_54805) - (int64_t) 1];\n                        if (slt8(flag_54860, (in",
                                    "t8_t) 2)) {\n                            int8_t flg_x_54864;\n                            int8_t flg_y_54865;\n                            int64_t eta_p_54861;\n                            int64_t eta_p_54862;\n                            int32_t skip_threads_54866;\n                            \n                            // read input for in-block scan\n                            {\n                                flg_y_54865 = ((volatile __local int8_t *) local_mem_54810)[sext_i32_i64(local_tid_54803)];\n                                eta_p_54862 = ((volatile __local int64_t *) local_mem_54810)[(int64_t) 4 + sext_i32_i64(local_tid_54803)];\n                                if ((local_tid_54803 - squot32(local_tid_54803, 32) * 32) == 0) {\n                                    eta_p_54861 = eta_p_54862;\n                                    flg_x_54864 = flg_y_54865;\n                                }\n                            }\n                            // in-block scan (hopefully no barriers needed)\n                            {\n                                skip_threads_54866 = 1;\n                                while (slt32(skip_threads_54866, 32)) {\n                                    if (sle32(skip_threads_54866, local_tid_54803 - squot32(local_tid_54803, 32) * 32)) {\n                                        // read operands\n                                        {\n                                            flg_x_54864 = ((volatile __local int8_t *) local_mem_54810)[sext_i32_i64(local_tid_54803) - sext_i32_i64(skip_threads_54866)];\n                                            eta_p_54861 = ((volatile __local int64_t *) local_mem_54810)[(int64_t) 4 + (sext_i32_i64(local_tid_54803) - sext_i32_i64(skip_threads_54866))];\n                                        }\n                                        // perform operation\n                                        {\n                                            if (flg_y_54865 == (int8_t) 2 || flg_y_54865 == (int8_t) 0) {\n   ", "                                             flg_x_54864 = flg_y_54865;\n                                                eta_p_54861 = eta_p_54862;\n                                            } else {\n                                                int64_t defunc_0_op_res_54863 = add64(eta_p_54861, eta_p_54862);\n                                                \n                                                eta_p_54861 = defunc_0_op_res_54863;\n                                            }\n                                        }\n                                        // write result\n                                        {\n                                            ((volatile __local int8_t *) local_mem_54810)[sext_i32_i64(local_tid_54803)] = flg_x_54864;\n                                            flg_y_54865 = flg_x_54864;\n                                            ((volatile __local int64_t *) local_mem_54810)[(int64_t) 4 + sext_i32_i64(local_tid_54803)] = eta_p_54861;\n                                            eta_p_54862 = eta_p_54861;\n                                        }\n                                    }\n                                    skip_threads_54866 *= 2;\n                                }\n                            }\n                        }\n                        flag_54860 = ((__local int8_t *) local_mem_54810)[sext_i32_i64(wave_sizze_54805) - (int64_t) 1];\n                        aggr_54859 = ((__local int64_t *) local_mem_54810)[(int64_t) 4 + (sext_i32_i64(wave_sizze_54805) - (int64_t) 1)];\n                        if (flag_54860 == (int8_t) 2) {\n                            readOffset_54857 = wave_sizze_54805 * -1;\n                        } else if (flag_54860 == (int8_t) 1) {\n                            readOffset_54857 -= wave_sizze_54805;\n                        }\n                        if (slt8((int8_t) 0, flag_54860)) {\n                            int64_t eta_p_54867 = aggr_54859;\n                            int64_t eta_p_548", "68 = prefix_54853;\n                            int64_t defunc_0_op_res_54869 = add64(eta_p_54867, eta_p_54868);\n                            \n                            prefix_54853 = defunc_0_op_res_54869;\n                        }\n                        mem_fence_local();\n                    }\n                }\n                if (local_tid_54803 == 0) {\n                    if (boundary_54823 == sext_i64_i32(segscan_tblock_sizze_46964 * chunk_sizze_54791)) {\n                        int64_t eta_p_54870 = prefix_54853;\n                        int64_t eta_p_54871 = acc_54843;\n                        int64_t defunc_0_op_res_54872 = add64(eta_p_54870, eta_p_54871);\n                        \n                        ((volatile __global int64_t *) incprefixes_mem_54798)[dynamic_id_54820] = defunc_0_op_res_54872;\n                        mem_fence_global();\n                        ((volatile __global int8_t *) status_flags_mem_54794)[dynamic_id_54820] = (int8_t) 2;\n                    }\n                    ((__local int64_t *) local_mem_54810)[(int64_t) 4] = prefix_54853;\n                    acc_54843 = (int64_t) 0;\n                }\n            }\n            if (!(dynamic_id_54820 == (int64_t) 0)) {\n                barrier(CLK_LOCAL_MEM_FENCE);\n                prefix_54853 = ((__local int64_t *) local_mem_54810)[(int64_t) 4];\n                barrier(CLK_LOCAL_MEM_FENCE);\n            }\n        }\n        // Distribute results\n        {\n            int64_t eta_p_54873;\n            int64_t eta_p_54874;\n            int64_t eta_p_54876 = prefix_54853;\n            int64_t eta_p_54877 = acc_54843;\n            \n            if (slt32(local_tid_54803 * chunk_sizze_32b_54807, boundary_54823) && !block_new_sgm_54854) {\n                int64_t defunc_0_op_res_54878 = add64(eta_p_54876, eta_p_54877);\n                \n                eta_p_54873 = defunc_0_op_res_54878;\n            } else {\n                eta_p_54873 = acc_54843;\n            }\n            \n            int32_t stopping_po",
                                    "int_54879 = segsizze_compact_54824 - srem32(local_tid_54803 * chunk_sizze_32b_54807 - 1 + segsizze_compact_54824 - boundary_54823, segsizze_compact_54824);\n            \n            for (int64_t i_54880 = 0; i_54880 < chunk_sizze_54791; i_54880++) {\n                if (slt32(sext_i64_i32(i_54880), stopping_point_54879 - 1)) {\n                    eta_p_54874 = private_mem_54825[i_54880];\n                    \n                    int64_t defunc_0_op_res_54875 = add64(eta_p_54873, eta_p_54874);\n                    \n                    private_mem_54825[i_54880] = defunc_0_op_res_54875;\n                }\n            }\n        }\n        // Transpose scan output and Write it to global memory in coalesced fashion\n        {\n            for (int64_t i_54881 = 0; i_54881 < chunk_sizze_54791; i_54881++) {\n                int64_t sharedIdx_54882 = sext_i32_i64(local_tid_54803) * chunk_sizze_54791 + i_54881;\n                int64_t tmp_54883 = private_mem_54825[i_54881];\n                \n                ((__local int64_t *) local_mem_54810)[sharedIdx_54882] = tmp_54883;\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            for (int64_t i_54884 = 0; i_54884 < chunk_sizze_54791; i_54884++) {\n                int64_t flat_idx_54885 = thd_offset_54827 + i_54884 * segscan_tblock_sizze_46964;\n                int64_t slice_54886 = dz2082U_36803;\n                int64_t gtid_46968 = flat_idx_54885;\n                int64_t remnant_54887 = flat_idx_54885 - gtid_46968;\n                \n                if (slt64(flat_idx_54885, dz2082U_36803)) {\n                    int64_t tmp_54888 = ((__local int64_t *) local_mem_54810)[flat_idx_54885 - block_offset_54821];\n                    \n                    ((__global int64_t *) mem_53564)[gtid_46968] = tmp_54888;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n        }\n    }\n    \n  error_3:\n    return;\n    #undef segscan_tblock_sizze_46964\n    #undef chunk_sizze_54791\n}\nFUTHARK_KERNEL_SIZED(do_DBSCAN_doublezis", "egscan_46985_dim1, 1, 1)\nvoid do_DBSCAN_doublezisegscan_46985(__global int *global_failure, double clBase_36811, int64_t m_43734, int64_t num_tblocks_46982, int64_t num_virt_blocks_54908, int64_t num_virt_threads_54909, __global unsigned char *current_partition_mem_53527, __global unsigned char *current_partition_mem_53528, __global unsigned char *mem_53561, __global unsigned char *mem_53574, __global unsigned char *mem_53576, __global unsigned char *mem_53580, __global unsigned char *mem_53582, __global unsigned char *mem_53584, __global unsigned char *status_flags_mem_54910, __global unsigned char *aggregates_mem_54912, __global unsigned char *incprefixes_mem_54914, __global unsigned char *aggregates_mem_54916, __global unsigned char *incprefixes_mem_54918, __global unsigned char *global_dynid_mem_54920)\n{\n    #define segscan_tblock_sizze_46980 (do_DBSCAN_doublezisegscan_46985zisegscan_tblock_sizze_46980)\n    #define chunk_sizze_54907 (do_DBSCAN_doublezisegscan_46985zichunk_sizze_54907)\n    \n    volatile __local unsigned char *local_mem_54932_backing_0 = &shared_mem[0];\n    const int64_t local_mem_54932_backing_0_offset = 0 + (smax64(smax64((int64_t) 544, sdiv_up64((int64_t) 8 * segscan_tblock_sizze_46980, (int64_t) 8) * (int64_t) 8 + (int64_t) 8 * segscan_tblock_sizze_46980), smax64(chunk_sizze_54907 * segscan_tblock_sizze_46980 * (int64_t) 8, chunk_sizze_54907 * segscan_tblock_sizze_46980 * (int64_t) 8)) + srem64((int64_t) 8 - srem64(smax64(smax64((int64_t) 544, sdiv_up64((int64_t) 8 * segscan_tblock_sizze_46980, (int64_t) 8) * (int64_t) 8 + (int64_t) 8 * segscan_tblock_sizze_46980), smax64(chunk_sizze_54907 * segscan_tblock_sizze_46980 * (int64_t) 8, chunk_sizze_54907 * segscan_tblock_sizze_46980 * (int64_t) 8)), (int64_t) 8), (int64_t) 8));\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_54923;\n    int32_t tblock_sizze_54926;\n    int32_t wave_sizze_54925;\n    int32_t block_id_54924;\n    int32_t global_tid_54922;\n    int64_t phys_t", "id_46985;\n    int32_t chunk_sizze_32b_54927;\n    int64_t byte_offsets_54928;\n    int64_t byte_offsets_54929;\n    int64_t warp_byte_offset_54930;\n    int64_t warp_byte_offset_54931;\n    __local unsigned char *local_mem_54932;\n    int64_t trans_arr_len_54933;\n    int64_t phys_block_id_54942;\n    int64_t virtloop_bound_54943;\n    \n    local_tid_54923 = get_local_id(0);\n    tblock_sizze_54926 = get_local_size(0);\n    wave_sizze_54925 = LOCKSTEP_WIDTH;\n    block_id_54924 = get_tblock_id(0);\n    global_tid_54922 = block_id_54924 * tblock_sizze_54926 + local_tid_54923;\n    phys_tid_46985 = sext_i32_i64(global_tid_54922);\n    chunk_sizze_32b_54927 = sext_i64_i32(chunk_sizze_54907);\n    byte_offsets_54928 = segscan_tblock_sizze_46980 * (int64_t) 8;\n    byte_offsets_54929 = sdiv_up64(byte_offsets_54928, (int64_t) 8) * (int64_t) 8 + segscan_tblock_sizze_46980 * (int64_t) 8;\n    warp_byte_offset_54930 = (int64_t) 288;\n    warp_byte_offset_54931 = sdiv_up64(warp_byte_offset_54930, (int64_t) 8) * (int64_t) 8 + (int64_t) 256;\n    // Allocate reusable shared memory\n    { }\n    local_mem_54932 = (__local unsigned char *) local_mem_54932_backing_0;\n    trans_arr_len_54933 = chunk_sizze_54907 * segscan_tblock_sizze_46980;\n    phys_block_id_54942 = get_tblock_id(0);\n    virtloop_bound_54943 = sdiv_up64(num_virt_blocks_54908 - phys_block_id_54942, num_tblocks_46982);\n    for (int64_t virtloop_i_54944 = 0; virtloop_i_54944 < virtloop_bound_54943; virtloop_i_54944++) {\n        int64_t dynamic_id_54945;\n        int64_t block_offset_54946;\n        int64_t sgm_idx_54947;\n        int32_t boundary_54948;\n        int32_t segsizze_compact_54949;\n        int64_t private_mem_54950[chunk_sizze_54907];\n        int64_t private_mem_54952[chunk_sizze_54907];\n        int64_t thd_offset_54954;\n        int64_t acc_54980;\n        int64_t acc_54981;\n        int64_t prefix_54994;\n        int64_t prefix_54995;\n        bool block_new_sgm_54996;\n        \n        // First thread in block fetches this block's dyn",
                                    "amic_id\n        {\n            if (local_tid_54923 == 0) {\n                dynamic_id_54945 = atomic_add_i32_global(&((volatile __global int *) global_dynid_mem_54920)[(int64_t) 0], (int) 1);\n                // Set dynamic id for this block\n                {\n                    ((__local int64_t *) local_mem_54932)[(int64_t) 0] = dynamic_id_54945;\n                }\n                // First thread in last (virtual) block resets global dynamic_id\n                {\n                    if (dynamic_id_54945 == num_virt_blocks_54908 - (int64_t) 1) {\n                        ((__global int32_t *) global_dynid_mem_54920)[(int64_t) 0] = 0;\n                    }\n                }\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        dynamic_id_54945 = ((__local int32_t *) local_mem_54932)[(int64_t) 0];\n        barrier(CLK_LOCAL_MEM_FENCE);\n        block_offset_54946 = dynamic_id_54945 * chunk_sizze_54907 * segscan_tblock_sizze_46980;\n        sgm_idx_54947 = smod64(block_offset_54946, m_43734);\n        boundary_54948 = sext_i64_i32(smin64(chunk_sizze_54907 * segscan_tblock_sizze_46980, m_43734 - sgm_idx_54947));\n        segsizze_compact_54949 = sext_i64_i32(smin64(chunk_sizze_54907 * segscan_tblock_sizze_46980, m_43734));\n        thd_offset_54954 = block_offset_54946 + sext_i32_i64(local_tid_54923);\n        // Load and map\n        {\n            for (int64_t i_54955 = 0; i_54955 < chunk_sizze_54907; i_54955++) {\n                int64_t virt_tid_54956 = thd_offset_54954 + i_54955 * segscan_tblock_sizze_46980;\n                int64_t slice_54957 = m_43734;\n                int64_t gtid_46984 = virt_tid_54956;\n                int64_t remnant_54958 = virt_tid_54956 - gtid_46984;\n                \n                if (slt64(virt_tid_54956, m_43734)) {\n                    double zm_res_53192 = ((__global double *) mem_53561)[(int64_t) 0];\n                    double x_44985 = ((__global double *) mem_53576)[gtid_46984];\n                    bool zgze_res_44987 = zm_res_53192", " <= x_44985;\n                    bool cond_44988;\n                    \n                    if (zgze_res_44987) {\n                        double plus_arg0_45337 = ((__global double *) current_partition_mem_53527)[(int64_t) 0];\n                        double zp_res_45338 = clBase_36811 + plus_arg0_45337;\n                        bool zlze_res_45339 = x_44985 <= zp_res_45338;\n                        \n                        cond_44988 = zlze_res_45339;\n                    } else {\n                        cond_44988 = 0;\n                    }\n                    \n                    bool lifted_lambda_res_44992;\n                    \n                    if (cond_44988) {\n                        double x_44986 = ((__global double *) mem_53574)[gtid_46984];\n                        double minus_arg0_45343 = ((__global double *) current_partition_mem_53528)[(int64_t) 1];\n                        double zm_res_45344 = minus_arg0_45343 - clBase_36811;\n                        bool zgze_res_45345 = zm_res_45344 <= x_44986;\n                        bool lifted_lambda_res_t_res_45346;\n                        \n                        if (zgze_res_45345) {\n                            double plus_arg0_45347 = ((__global double *) current_partition_mem_53527)[(int64_t) 1];\n                            double zp_res_45348 = clBase_36811 + plus_arg0_45347;\n                            bool zlze_res_45349 = x_44986 <= zp_res_45348;\n                            \n                            lifted_lambda_res_t_res_45346 = zlze_res_45349;\n                        } else {\n                            lifted_lambda_res_t_res_45346 = 0;\n                        }\n                        lifted_lambda_res_44992 = lifted_lambda_res_t_res_45346;\n                    } else {\n                        lifted_lambda_res_44992 = 0;\n                    }\n                    \n                    bool cond_neg_45000 = !lifted_lambda_res_44992;\n                    int64_t defunc_0_lifted_pzq_res_45001 = btoi_bool_", "i64(cond_neg_45000);\n                    bool is_i_45002 = defunc_0_lifted_pzq_res_45001 == (int64_t) 0;\n                    int64_t part_res_45003 = btoi_bool_i64(is_i_45002);\n                    int64_t part_res_45004;\n                    int64_t part_res_45005;\n                    \n                    if (is_i_45002) {\n                        part_res_45004 = (int64_t) 0;\n                        part_res_45005 = (int64_t) 0;\n                    } else {\n                        bool is_i_45006 = defunc_0_lifted_pzq_res_45001 == (int64_t) 1;\n                        int64_t part_res_45007;\n                        \n                        if (is_i_45006) {\n                            part_res_45007 = (int64_t) 1;\n                        } else {\n                            part_res_45007 = (int64_t) 2;\n                        }\n                        \n                        int64_t part_res_45008 = btoi_bool_i64(is_i_45006);\n                        \n                        part_res_45004 = part_res_45007;\n                        part_res_45005 = part_res_45008;\n                    }\n                    ((__global int64_t *) mem_53584)[gtid_46984] = part_res_45004;\n                    private_mem_54950[i_54955] = part_res_45003;\n                    private_mem_54952[i_54955] = part_res_45005;\n                } else {\n                    private_mem_54950[i_54955] = (int64_t) 0;\n                    private_mem_54952[i_54955] = (int64_t) 0;\n                }\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        // Transpose scan inputs\n        {\n            for (int64_t i_54959 = 0; i_54959 < chunk_sizze_54907; i_54959++) {\n                int64_t sharedIdx_54960 = sext_i32_i64(local_tid_54923) + i_54959 * segscan_tblock_sizze_46980;\n                int64_t tmp_54961 = private_mem_54950[i_54959];\n                \n                ((__local int64_t *) local_mem_54932)[sharedIdx_54960] = tmp_54961;\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n ",
                                    "           for (int64_t i_54962 = 0; i_54962 < chunk_sizze_54907; i_54962++) {\n                int64_t sharedIdx_54963 = sext_i32_i64(local_tid_54923) * chunk_sizze_54907 + i_54962;\n                int64_t tmp_54964 = ((__local int64_t *) local_mem_54932)[sharedIdx_54963];\n                \n                private_mem_54950[i_54962] = tmp_54964;\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            for (int64_t i_54965 = 0; i_54965 < chunk_sizze_54907; i_54965++) {\n                int64_t sharedIdx_54966 = sext_i32_i64(local_tid_54923) + i_54965 * segscan_tblock_sizze_46980;\n                int64_t tmp_54967 = private_mem_54952[i_54965];\n                \n                ((__local int64_t *) local_mem_54932)[sharedIdx_54966] = tmp_54967;\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            for (int64_t i_54968 = 0; i_54968 < chunk_sizze_54907; i_54968++) {\n                int64_t sharedIdx_54969 = sext_i32_i64(local_tid_54923) * chunk_sizze_54907 + i_54968;\n                int64_t tmp_54970 = ((__local int64_t *) local_mem_54932)[sharedIdx_54969];\n                \n                private_mem_54952[i_54968] = tmp_54970;\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n        }\n        // Per thread scan\n        {\n            for (int64_t i_54971 = 0; i_54971 < chunk_sizze_54907 - (int64_t) 1; i_54971++) {\n                int64_t x_43800;\n                int64_t y_43802;\n                \n                x_43800 = private_mem_54950[i_54971];\n                y_43802 = private_mem_54950[i_54971 + (int64_t) 1];\n                \n                int64_t x_43801;\n                int64_t y_43803;\n                \n                x_43801 = private_mem_54952[i_54971];\n                y_43803 = private_mem_54952[i_54971 + (int64_t) 1];\n                \n                int64_t zz_43804 = x_43800 + y_43802;\n                int64_t zz_43805 = x_43801 + y_43803;\n                \n                private_mem_54950[i_54971 + (int64_t) 1] = zz_43804;\n ", "               private_mem_54952[i_54971 + (int64_t) 1] = zz_43805;\n            }\n        }\n        // Publish results in shared memory\n        {\n            int64_t tmp_54972 = private_mem_54950[chunk_sizze_54907 - (int64_t) 1];\n            \n            ((__local int64_t *) local_mem_54932)[sext_i32_i64(local_tid_54923)] = tmp_54972;\n            \n            int64_t tmp_54973 = private_mem_54952[chunk_sizze_54907 - (int64_t) 1];\n            \n            ((__local int64_t *) local_mem_54932)[squot64(byte_offsets_54928, (int64_t) 8) + sext_i32_i64(local_tid_54923)] = tmp_54973;\n            barrier(CLK_LOCAL_MEM_FENCE);\n        }\n        // Scan results (with warp scan)\n        {\n            int64_t x_54974;\n            int64_t x_54975;\n            int64_t y_54976;\n            int64_t y_54977;\n            int64_t x_54982;\n            int64_t x_54983;\n            int64_t y_54984;\n            int64_t y_54985;\n            bool ltid_in_bounds_54988 = slt64(sext_i32_i64(local_tid_54923), num_virt_threads_54909);\n            int32_t skip_threads_54989;\n            \n            // read input for in-block scan\n            {\n                if (ltid_in_bounds_54988) {\n                    y_54976 = ((volatile __local int64_t *) local_mem_54932)[sext_i32_i64(local_tid_54923)];\n                    y_54977 = ((volatile __local int64_t *) local_mem_54932)[squot64(byte_offsets_54928, (int64_t) 8) + sext_i32_i64(local_tid_54923)];\n                    if ((local_tid_54923 - squot32(local_tid_54923, 32) * 32) == 0) {\n                        x_54974 = y_54976;\n                        x_54975 = y_54977;\n                    }\n                }\n            }\n            // in-block scan (hopefully no barriers needed)\n            {\n                skip_threads_54989 = 1;\n                while (slt32(skip_threads_54989, 32)) {\n                    bool thread_active_54990 = sle32(skip_threads_54989, local_tid_54923 - squot32(local_tid_54923, 32) * 32) && ltid_in_bounds_54988;\n                ", "    \n                    if (thread_active_54990) {\n                        // read operands\n                        {\n                            x_54974 = ((volatile __local int64_t *) local_mem_54932)[sext_i32_i64(local_tid_54923) - sext_i32_i64(skip_threads_54989)];\n                            x_54975 = ((volatile __local int64_t *) local_mem_54932)[squot64(byte_offsets_54928, (int64_t) 8) + (sext_i32_i64(local_tid_54923) - sext_i32_i64(skip_threads_54989))];\n                        }\n                    }\n                    // perform operation\n                    {\n                        if (thread_active_54990) {\n                            int64_t zz_54978 = x_54974 + y_54976;\n                            int64_t zz_54979 = x_54975 + y_54977;\n                            \n                            x_54974 = zz_54978;\n                            x_54975 = zz_54979;\n                        }\n                    }\n                    if (sle32(wave_sizze_54925, skip_threads_54989)) {\n                        barrier(CLK_LOCAL_MEM_FENCE);\n                    }\n                    if (thread_active_54990) {\n                        // write result\n                        {\n                            ((volatile __local int64_t *) local_mem_54932)[sext_i32_i64(local_tid_54923)] = x_54974;\n                            y_54976 = x_54974;\n                            ((volatile __local int64_t *) local_mem_54932)[squot64(byte_offsets_54928, (int64_t) 8) + sext_i32_i64(local_tid_54923)] = x_54975;\n                            y_54977 = x_54975;\n                        }\n                    }\n                    if (sle32(wave_sizze_54925, skip_threads_54989)) {\n                        barrier(CLK_LOCAL_MEM_FENCE);\n                    }\n                    skip_threads_54989 *= 2;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // last thread of block 'i' writes its result to offset 'i'\n            {\n                if ((local_tid_549",
                                    "23 - squot32(local_tid_54923, 32) * 32) == 31 && ltid_in_bounds_54988) {\n                    ((volatile __local int64_t *) local_mem_54932)[sext_i32_i64(squot32(local_tid_54923, 32))] = x_54974;\n                    ((volatile __local int64_t *) local_mem_54932)[squot64(byte_offsets_54928, (int64_t) 8) + sext_i32_i64(squot32(local_tid_54923, 32))] = x_54975;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // scan the first block, after which offset 'i' contains carry-in for block 'i+1'\n            {\n                int32_t skip_threads_54991;\n                \n                // read input for in-block scan\n                {\n                    if (squot32(local_tid_54923, 32) == 0 && ltid_in_bounds_54988) {\n                        y_54984 = ((volatile __local int64_t *) local_mem_54932)[sext_i32_i64(local_tid_54923)];\n                        y_54985 = ((volatile __local int64_t *) local_mem_54932)[squot64(byte_offsets_54928, (int64_t) 8) + sext_i32_i64(local_tid_54923)];\n                        if ((local_tid_54923 - squot32(local_tid_54923, 32) * 32) == 0) {\n                            x_54982 = y_54984;\n                            x_54983 = y_54985;\n                        }\n                    }\n                }\n                // in-block scan (hopefully no barriers needed)\n                {\n                    skip_threads_54991 = 1;\n                    while (slt32(skip_threads_54991, 32)) {\n                        bool thread_active_54992 = sle32(skip_threads_54991, local_tid_54923 - squot32(local_tid_54923, 32) * 32) && (squot32(local_tid_54923, 32) == 0 && ltid_in_bounds_54988);\n                        \n                        if (thread_active_54992) {\n                            // read operands\n                            {\n                                x_54982 = ((volatile __local int64_t *) local_mem_54932)[sext_i32_i64(local_tid_54923) - sext_i32_i64(skip_threads_54991)];\n                                x_54983 ", "= ((volatile __local int64_t *) local_mem_54932)[squot64(byte_offsets_54928, (int64_t) 8) + (sext_i32_i64(local_tid_54923) - sext_i32_i64(skip_threads_54991))];\n                            }\n                        }\n                        // perform operation\n                        {\n                            if (thread_active_54992) {\n                                int64_t zz_54986 = x_54982 + y_54984;\n                                int64_t zz_54987 = x_54983 + y_54985;\n                                \n                                x_54982 = zz_54986;\n                                x_54983 = zz_54987;\n                            }\n                        }\n                        if (sle32(wave_sizze_54925, skip_threads_54991)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        if (thread_active_54992) {\n                            // write result\n                            {\n                                ((volatile __local int64_t *) local_mem_54932)[sext_i32_i64(local_tid_54923)] = x_54982;\n                                y_54984 = x_54982;\n                                ((volatile __local int64_t *) local_mem_54932)[squot64(byte_offsets_54928, (int64_t) 8) + sext_i32_i64(local_tid_54923)] = x_54983;\n                                y_54985 = x_54983;\n                            }\n                        }\n                        if (sle32(wave_sizze_54925, skip_threads_54991)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        skip_threads_54991 *= 2;\n                    }\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            \n            bool no_carry_in_54993 = squot32(local_tid_54923, 32) == 0 || !ltid_in_bounds_54988;\n            \n            // carry-in for every block except the first\n            {\n                // read operands\n                {\n                    if (!no_carry_in_54993) {\n  ", "                      y_54976 = x_54974;\n                        y_54977 = x_54975;\n                        x_54974 = ((__local int64_t *) local_mem_54932)[sext_i32_i64(squot32(local_tid_54923, 32)) - (int64_t) 1];\n                        x_54975 = ((__local int64_t *) local_mem_54932)[squot64(byte_offsets_54928, (int64_t) 8) + (sext_i32_i64(squot32(local_tid_54923, 32)) - (int64_t) 1)];\n                    }\n                }\n                // perform operation\n                {\n                    if (!no_carry_in_54993) {\n                        int64_t zz_54978 = x_54974 + y_54976;\n                        int64_t zz_54979 = x_54975 + y_54977;\n                        \n                        x_54974 = zz_54978;\n                        x_54975 = zz_54979;\n                    }\n                }\n                // write final result\n                {\n                    if (!no_carry_in_54993) {\n                        ((__local int64_t *) local_mem_54932)[sext_i32_i64(local_tid_54923)] = x_54974;\n                        ((__local int64_t *) local_mem_54932)[squot64(byte_offsets_54928, (int64_t) 8) + sext_i32_i64(local_tid_54923)] = x_54975;\n                    }\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // restore correct values for first block\n            {\n                if (squot32(local_tid_54923, 32) == 0 && ltid_in_bounds_54988) {\n                    ((__local int64_t *) local_mem_54932)[sext_i32_i64(local_tid_54923)] = y_54976;\n                    ((__local int64_t *) local_mem_54932)[squot64(byte_offsets_54928, (int64_t) 8) + sext_i32_i64(local_tid_54923)] = y_54977;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            barrier(CLK_LOCAL_MEM_FENCE);\n            if (local_tid_54923 == 0) {\n                acc_54980 = ((__local int64_t *) local_mem_54932)[segscan_tblock_sizze_46980 - (int64_t) 1];\n                acc_54981 = ((__local int64_t *) local_mem_54932)[squot64(byte_offset",
                                    "s_54928, (int64_t) 8) + (segscan_tblock_sizze_46980 - (int64_t) 1)];\n            } else {\n                acc_54980 = ((__local int64_t *) local_mem_54932)[sext_i32_i64(local_tid_54923) - (int64_t) 1];\n                acc_54981 = ((__local int64_t *) local_mem_54932)[squot64(byte_offsets_54928, (int64_t) 8) + (sext_i32_i64(local_tid_54923) - (int64_t) 1)];\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n        }\n        prefix_54994 = (int64_t) 0;\n        prefix_54995 = (int64_t) 0;\n        block_new_sgm_54996 = sgm_idx_54947 == (int64_t) 0;\n        // Perform lookback\n        {\n            if (block_new_sgm_54996 && local_tid_54923 == 0) {\n                ((volatile __global int64_t *) incprefixes_mem_54914)[dynamic_id_54945] = acc_54980;\n                ((volatile __global int64_t *) incprefixes_mem_54918)[dynamic_id_54945] = acc_54981;\n                mem_fence_global();\n                ((volatile __global int8_t *) status_flags_mem_54910)[dynamic_id_54945] = (int8_t) 2;\n                acc_54980 = (int64_t) 0;\n                acc_54981 = (int64_t) 0;\n            }\n            if (!block_new_sgm_54996 && slt32(local_tid_54923, wave_sizze_54925)) {\n                if (local_tid_54923 == 0) {\n                    ((volatile __global int64_t *) aggregates_mem_54912)[dynamic_id_54945] = acc_54980;\n                    ((volatile __global int64_t *) aggregates_mem_54916)[dynamic_id_54945] = acc_54981;\n                    mem_fence_global();\n                    ((volatile __global int8_t *) status_flags_mem_54910)[dynamic_id_54945] = (int8_t) 1;\n                    \n                    int8_t tmp_54997 = ((volatile __global int8_t *) status_flags_mem_54910)[dynamic_id_54945 - (int64_t) 1];\n                    \n                    ((volatile __local int8_t *) local_mem_54932)[(int64_t) 0] = tmp_54997;\n                }\n                mem_fence_local();\n                \n                int8_t status_54998 = ((__local int8_t *) local_mem_54932)[(int64_t) 0];\n     ", "           \n                if (status_54998 == (int8_t) 2) {\n                    if (local_tid_54923 == 0) {\n                        prefix_54994 = ((volatile __global int64_t *) incprefixes_mem_54914)[dynamic_id_54945 - (int64_t) 1];\n                        prefix_54995 = ((volatile __global int64_t *) incprefixes_mem_54918)[dynamic_id_54945 - (int64_t) 1];\n                    }\n                } else {\n                    int32_t readOffset_54999 = sext_i64_i32(dynamic_id_54945 - sext_i32_i64(wave_sizze_54925));\n                    \n                    while (slt32(wave_sizze_54925 * -1, readOffset_54999)) {\n                        int32_t read_i_55000 = readOffset_54999 + local_tid_54923;\n                        int64_t aggr_55001 = (int64_t) 0;\n                        int64_t aggr_55002 = (int64_t) 0;\n                        int8_t flag_55003 = (int8_t) 0;\n                        \n                        if (sle32(0, read_i_55000)) {\n                            flag_55003 = ((volatile __global int8_t *) status_flags_mem_54910)[sext_i32_i64(read_i_55000)];\n                            if (flag_55003 == (int8_t) 2) {\n                                aggr_55001 = ((volatile __global int64_t *) incprefixes_mem_54914)[sext_i32_i64(read_i_55000)];\n                                aggr_55002 = ((volatile __global int64_t *) incprefixes_mem_54918)[sext_i32_i64(read_i_55000)];\n                            } else if (flag_55003 == (int8_t) 1) {\n                                aggr_55001 = ((volatile __global int64_t *) aggregates_mem_54912)[sext_i32_i64(read_i_55000)];\n                                aggr_55002 = ((volatile __global int64_t *) aggregates_mem_54916)[sext_i32_i64(read_i_55000)];\n                            }\n                        }\n                        ((__local int64_t *) local_mem_54932)[(int64_t) 4 + sext_i32_i64(local_tid_54923)] = aggr_55001;\n                        ((__local int64_t *) local_mem_54932)[squot64(warp_byte_offset_54930, (int64_t) 8) + ", "sext_i32_i64(local_tid_54923)] = aggr_55002;\n                        ((__local int8_t *) local_mem_54932)[sext_i32_i64(local_tid_54923)] = flag_55003;\n                        flag_55003 = ((__local int8_t *) local_mem_54932)[sext_i32_i64(wave_sizze_54925) - (int64_t) 1];\n                        if (slt8(flag_55003, (int8_t) 2)) {\n                            int8_t flg_x_55010;\n                            int8_t flg_y_55011;\n                            int64_t x_55004;\n                            int64_t x_55005;\n                            int64_t y_55006;\n                            int64_t y_55007;\n                            int32_t skip_threads_55012;\n                            \n                            // read input for in-block scan\n                            {\n                                flg_y_55011 = ((volatile __local int8_t *) local_mem_54932)[sext_i32_i64(local_tid_54923)];\n                                y_55006 = ((volatile __local int64_t *) local_mem_54932)[(int64_t) 4 + sext_i32_i64(local_tid_54923)];\n                                y_55007 = ((volatile __local int64_t *) local_mem_54932)[squot64(warp_byte_offset_54930, (int64_t) 8) + sext_i32_i64(local_tid_54923)];\n                                if ((local_tid_54923 - squot32(local_tid_54923, 32) * 32) == 0) {\n                                    x_55004 = y_55006;\n                                    x_55005 = y_55007;\n                                    flg_x_55010 = flg_y_55011;\n                                }\n                            }\n                            // in-block scan (hopefully no barriers needed)\n                            {\n                                skip_threads_55012 = 1;\n                                while (slt32(skip_threads_55012, 32)) {\n                                    if (sle32(skip_threads_55012, local_tid_54923 - squot32(local_tid_54923, 32) * 32)) {\n                                        // read operands\n                                        {\n",
                                    "                                            flg_x_55010 = ((volatile __local int8_t *) local_mem_54932)[sext_i32_i64(local_tid_54923) - sext_i32_i64(skip_threads_55012)];\n                                            x_55004 = ((volatile __local int64_t *) local_mem_54932)[(int64_t) 4 + (sext_i32_i64(local_tid_54923) - sext_i32_i64(skip_threads_55012))];\n                                            x_55005 = ((volatile __local int64_t *) local_mem_54932)[squot64(warp_byte_offset_54930, (int64_t) 8) + (sext_i32_i64(local_tid_54923) - sext_i32_i64(skip_threads_55012))];\n                                        }\n                                        // perform operation\n                                        {\n                                            if (flg_y_55011 == (int8_t) 2 || flg_y_55011 == (int8_t) 0) {\n                                                flg_x_55010 = flg_y_55011;\n                                                x_55004 = y_55006;\n                                                x_55005 = y_55007;\n                                            } else {\n                                                int64_t zz_55008 = x_55004 + y_55006;\n                                                int64_t zz_55009 = x_55005 + y_55007;\n                                                \n                                                x_55004 = zz_55008;\n                                                x_55005 = zz_55009;\n                                            }\n                                        }\n                                        // write result\n                                        {\n                                            ((volatile __local int8_t *) local_mem_54932)[sext_i32_i64(local_tid_54923)] = flg_x_55010;\n                                            flg_y_55011 = flg_x_55010;\n                                            ((volatile __local int64_t *) local_mem_54932)[(int64_t) 4 + sext_i32_i64(local_tid_54923)] = x_55004;\n                  ", "                          y_55006 = x_55004;\n                                            ((volatile __local int64_t *) local_mem_54932)[squot64(warp_byte_offset_54930, (int64_t) 8) + sext_i32_i64(local_tid_54923)] = x_55005;\n                                            y_55007 = x_55005;\n                                        }\n                                    }\n                                    skip_threads_55012 *= 2;\n                                }\n                            }\n                        }\n                        flag_55003 = ((__local int8_t *) local_mem_54932)[sext_i32_i64(wave_sizze_54925) - (int64_t) 1];\n                        aggr_55001 = ((__local int64_t *) local_mem_54932)[(int64_t) 4 + (sext_i32_i64(wave_sizze_54925) - (int64_t) 1)];\n                        aggr_55002 = ((__local int64_t *) local_mem_54932)[squot64(warp_byte_offset_54930, (int64_t) 8) + (sext_i32_i64(wave_sizze_54925) - (int64_t) 1)];\n                        if (flag_55003 == (int8_t) 2) {\n                            readOffset_54999 = wave_sizze_54925 * -1;\n                        } else if (flag_55003 == (int8_t) 1) {\n                            readOffset_54999 -= wave_sizze_54925;\n                        }\n                        if (slt8((int8_t) 0, flag_55003)) {\n                            int64_t x_55013 = aggr_55001;\n                            int64_t x_55014 = aggr_55002;\n                            int64_t y_55015 = prefix_54994;\n                            int64_t y_55016 = prefix_54995;\n                            int64_t zz_55017 = x_55013 + y_55015;\n                            int64_t zz_55018 = x_55014 + y_55016;\n                            \n                            prefix_54994 = zz_55017;\n                            prefix_54995 = zz_55018;\n                        }\n                        mem_fence_local();\n                    }\n                }\n                if (local_tid_54923 == 0) {\n                    if (boundary_54948 == sext_i64_i32", "(segscan_tblock_sizze_46980 * chunk_sizze_54907)) {\n                        int64_t x_55019 = prefix_54994;\n                        int64_t x_55020 = prefix_54995;\n                        int64_t y_55021 = acc_54980;\n                        int64_t y_55022 = acc_54981;\n                        int64_t zz_55023 = x_55019 + y_55021;\n                        int64_t zz_55024 = x_55020 + y_55022;\n                        \n                        ((volatile __global int64_t *) incprefixes_mem_54914)[dynamic_id_54945] = zz_55023;\n                        ((volatile __global int64_t *) incprefixes_mem_54918)[dynamic_id_54945] = zz_55024;\n                        mem_fence_global();\n                        ((volatile __global int8_t *) status_flags_mem_54910)[dynamic_id_54945] = (int8_t) 2;\n                    }\n                    ((__local int64_t *) local_mem_54932)[(int64_t) 4] = prefix_54994;\n                    ((__local int64_t *) local_mem_54932)[squot64(warp_byte_offset_54930, (int64_t) 8)] = prefix_54995;\n                    acc_54980 = (int64_t) 0;\n                    acc_54981 = (int64_t) 0;\n                }\n            }\n            if (!(dynamic_id_54945 == (int64_t) 0)) {\n                barrier(CLK_LOCAL_MEM_FENCE);\n                prefix_54994 = ((__local int64_t *) local_mem_54932)[(int64_t) 4];\n                prefix_54995 = ((__local int64_t *) local_mem_54932)[squot64(warp_byte_offset_54930, (int64_t) 8)];\n                barrier(CLK_LOCAL_MEM_FENCE);\n            }\n        }\n        // Distribute results\n        {\n            int64_t x_55025;\n            int64_t y_55027;\n            int64_t x_55031 = prefix_54994;\n            int64_t y_55033 = acc_54980;\n            int64_t x_55026;\n            int64_t y_55028;\n            int64_t x_55032 = prefix_54995;\n            int64_t y_55034 = acc_54981;\n            \n            if (slt32(local_tid_54923 * chunk_sizze_32b_54927, boundary_54948) && !block_new_sgm_54996) {\n                int64_t zz_55035 = x_55031 + y",
                                    "_55033;\n                int64_t zz_55036 = x_55032 + y_55034;\n                \n                x_55025 = zz_55035;\n                x_55026 = zz_55036;\n            } else {\n                x_55025 = acc_54980;\n                x_55026 = acc_54981;\n            }\n            \n            int32_t stopping_point_55037 = segsizze_compact_54949 - srem32(local_tid_54923 * chunk_sizze_32b_54927 - 1 + segsizze_compact_54949 - boundary_54948, segsizze_compact_54949);\n            \n            for (int64_t i_55038 = 0; i_55038 < chunk_sizze_54907; i_55038++) {\n                if (slt32(sext_i64_i32(i_55038), stopping_point_55037 - 1)) {\n                    y_55027 = private_mem_54950[i_55038];\n                    y_55028 = private_mem_54952[i_55038];\n                    \n                    int64_t zz_55029 = x_55025 + y_55027;\n                    int64_t zz_55030 = x_55026 + y_55028;\n                    \n                    private_mem_54950[i_55038] = zz_55029;\n                    private_mem_54952[i_55038] = zz_55030;\n                }\n            }\n        }\n        // Transpose scan output and Write it to global memory in coalesced fashion\n        {\n            for (int64_t i_55039 = 0; i_55039 < chunk_sizze_54907; i_55039++) {\n                int64_t sharedIdx_55040 = sext_i32_i64(local_tid_54923) * chunk_sizze_54907 + i_55039;\n                int64_t tmp_55041 = private_mem_54950[i_55039];\n                \n                ((__local int64_t *) local_mem_54932)[sharedIdx_55040] = tmp_55041;\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            for (int64_t i_55042 = 0; i_55042 < chunk_sizze_54907; i_55042++) {\n                int64_t flat_idx_55043 = thd_offset_54954 + i_55042 * segscan_tblock_sizze_46980;\n                int64_t slice_55044 = m_43734;\n                int64_t gtid_46984 = flat_idx_55043;\n                int64_t remnant_55045 = flat_idx_55043 - gtid_46984;\n                \n                if (slt64(flat_idx_55043, m_43734)) {\n                   ", " int64_t tmp_55046 = ((__local int64_t *) local_mem_54932)[flat_idx_55043 - block_offset_54946];\n                    \n                    ((__global int64_t *) mem_53580)[gtid_46984] = tmp_55046;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            for (int64_t i_55047 = 0; i_55047 < chunk_sizze_54907; i_55047++) {\n                int64_t sharedIdx_55048 = sext_i32_i64(local_tid_54923) * chunk_sizze_54907 + i_55047;\n                int64_t tmp_55049 = private_mem_54952[i_55047];\n                \n                ((__local int64_t *) local_mem_54932)[sharedIdx_55048] = tmp_55049;\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            for (int64_t i_55050 = 0; i_55050 < chunk_sizze_54907; i_55050++) {\n                int64_t flat_idx_55051 = thd_offset_54954 + i_55050 * segscan_tblock_sizze_46980;\n                int64_t slice_55052 = m_43734;\n                int64_t gtid_46984 = flat_idx_55051;\n                int64_t remnant_55053 = flat_idx_55051 - gtid_46984;\n                \n                if (slt64(flat_idx_55051, m_43734)) {\n                    int64_t tmp_55054 = ((__local int64_t *) local_mem_54932)[flat_idx_55051 - block_offset_54946];\n                    \n                    ((__global int64_t *) mem_53582)[gtid_46984] = tmp_55054;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n        }\n    }\n    \n  error_3:\n    return;\n    #undef segscan_tblock_sizze_46980\n    #undef chunk_sizze_54907\n}\nFUTHARK_KERNEL_SIZED(do_DBSCAN_doublezisegscan_47001_dim1, 1, 1)\nvoid do_DBSCAN_doublezisegscan_47001(__global int *global_failure, int64_t clBase_36814, int64_t partition_sizze_43809, int64_t num_tblocks_46998, int64_t num_virt_blocks_55075, int64_t num_virt_threads_55076, __global unsigned char *ext_mem_53594, __global unsigned char *ext_mem_53601, __global unsigned char *ext_mem_53602, __global unsigned char *mem_53605, __global unsigned char *mem_53607, __global unsigned char *mem_53608, __global ", "unsigned char *status_flags_mem_55077, __global unsigned char *aggregates_mem_55079, __global unsigned char *incprefixes_mem_55081, __global unsigned char *global_dynid_mem_55083)\n{\n    #define segscan_tblock_sizze_46996 (do_DBSCAN_doublezisegscan_47001zisegscan_tblock_sizze_46996)\n    #define chunk_sizze_55074 (do_DBSCAN_doublezisegscan_47001zichunk_sizze_55074)\n    \n    volatile __local unsigned char *local_mem_55093_backing_0 = &shared_mem[0];\n    const int64_t local_mem_55093_backing_0_offset = 0 + (smax64(smax64((int64_t) 288, (int64_t) 8 * segscan_tblock_sizze_46996), chunk_sizze_55074 * segscan_tblock_sizze_46996 * (int64_t) 8) + srem64((int64_t) 8 - srem64(smax64(smax64((int64_t) 288, (int64_t) 8 * segscan_tblock_sizze_46996), chunk_sizze_55074 * segscan_tblock_sizze_46996 * (int64_t) 8), (int64_t) 8), (int64_t) 8));\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_55086;\n    int32_t tblock_sizze_55089;\n    int32_t wave_sizze_55088;\n    int32_t block_id_55087;\n    int32_t global_tid_55085;\n    int64_t phys_tid_47001;\n    int32_t chunk_sizze_32b_55090;\n    int64_t byte_offsets_55091;\n    int64_t warp_byte_offset_55092;\n    __local unsigned char *local_mem_55093;\n    int64_t trans_arr_len_55094;\n    int64_t phys_block_id_55100;\n    int64_t virtloop_bound_55101;\n    \n    local_tid_55086 = get_local_id(0);\n    tblock_sizze_55089 = get_local_size(0);\n    wave_sizze_55088 = LOCKSTEP_WIDTH;\n    block_id_55087 = get_tblock_id(0);\n    global_tid_55085 = block_id_55087 * tblock_sizze_55089 + local_tid_55086;\n    phys_tid_47001 = sext_i32_i64(global_tid_55085);\n    chunk_sizze_32b_55090 = sext_i64_i32(chunk_sizze_55074);\n    byte_offsets_55091 = segscan_tblock_sizze_46996 * (int64_t) 8;\n    warp_byte_offset_55092 = (int64_t) 288;\n    // Allocate reusable shared memory\n    { }\n    local_mem_55093 = (__local unsigned char *) local_mem_55093_backing_0;\n    trans_arr_len_55094 = chunk_sizze_55074 * segscan_tblock_sizze_46996;\n    phys_block_id_",
                                    "55100 = get_tblock_id(0);\n    virtloop_bound_55101 = sdiv_up64(num_virt_blocks_55075 - phys_block_id_55100, num_tblocks_46998);\n    for (int64_t virtloop_i_55102 = 0; virtloop_i_55102 < virtloop_bound_55101; virtloop_i_55102++) {\n        int64_t dynamic_id_55103;\n        int64_t block_offset_55104;\n        int64_t sgm_idx_55105;\n        int32_t boundary_55106;\n        int32_t segsizze_compact_55107;\n        int64_t private_mem_55108[chunk_sizze_55074];\n        int64_t thd_offset_55110;\n        int64_t acc_55126;\n        int64_t prefix_55136;\n        bool block_new_sgm_55137;\n        \n        // First thread in block fetches this block's dynamic_id\n        {\n            if (local_tid_55086 == 0) {\n                dynamic_id_55103 = atomic_add_i32_global(&((volatile __global int *) global_dynid_mem_55083)[(int64_t) 0], (int) 1);\n                // Set dynamic id for this block\n                {\n                    ((__local int64_t *) local_mem_55093)[(int64_t) 0] = dynamic_id_55103;\n                }\n                // First thread in last (virtual) block resets global dynamic_id\n                {\n                    if (dynamic_id_55103 == num_virt_blocks_55075 - (int64_t) 1) {\n                        ((__global int32_t *) global_dynid_mem_55083)[(int64_t) 0] = 0;\n                    }\n                }\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        dynamic_id_55103 = ((__local int32_t *) local_mem_55093)[(int64_t) 0];\n        barrier(CLK_LOCAL_MEM_FENCE);\n        block_offset_55104 = dynamic_id_55103 * chunk_sizze_55074 * segscan_tblock_sizze_46996;\n        sgm_idx_55105 = smod64(block_offset_55104, partition_sizze_43809);\n        boundary_55106 = sext_i64_i32(smin64(chunk_sizze_55074 * segscan_tblock_sizze_46996, partition_sizze_43809 - sgm_idx_55105));\n        segsizze_compact_55107 = sext_i64_i32(smin64(chunk_sizze_55074 * segscan_tblock_sizze_46996, partition_sizze_43809));\n        thd_offset_55110 = block_offset_55104 + sext_i32_i64(loca", "l_tid_55086);\n        // Load and map\n        {\n            for (int64_t i_55111 = 0; i_55111 < chunk_sizze_55074; i_55111++) {\n                int64_t virt_tid_55112 = thd_offset_55110 + i_55111 * segscan_tblock_sizze_46996;\n                int64_t slice_55113 = partition_sizze_43809;\n                int64_t gtid_47000 = virt_tid_55112;\n                int64_t remnant_55114 = virt_tid_55112 - gtid_47000;\n                \n                if (slt64(virt_tid_55112, partition_sizze_43809)) {\n                    int64_t eta_p_44970 = ((__global int64_t *) ext_mem_53602)[gtid_47000];\n                    int64_t eta_p_44971 = ((__global int64_t *) ext_mem_53601)[gtid_47000];\n                    int64_t eta_p_44972 = ((__global int64_t *) ext_mem_53594)[gtid_47000];\n                    int64_t lifted_lambda_res_44973 = sub64(eta_p_44970, (int64_t) 1);\n                    int64_t zp_lhs_44975 = add64(eta_p_44971, lifted_lambda_res_44973);\n                    int64_t lifted_lambda_res_44976 = add64(eta_p_44972, zp_lhs_44975);\n                    bool lifted_lambda_res_44978 = sle64(clBase_36814, lifted_lambda_res_44976);\n                    int64_t defunc_0_f_res_44980 = btoi_bool_i64(lifted_lambda_res_44978);\n                    \n                    ((__global int64_t *) mem_53607)[gtid_47000] = defunc_0_f_res_44980;\n                    ((__global bool *) mem_53608)[gtid_47000] = lifted_lambda_res_44978;\n                    private_mem_55108[i_55111] = defunc_0_f_res_44980;\n                } else {\n                    private_mem_55108[i_55111] = (int64_t) 0;\n                }\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        // Transpose scan inputs\n        {\n            for (int64_t i_55115 = 0; i_55115 < chunk_sizze_55074; i_55115++) {\n                int64_t sharedIdx_55116 = sext_i32_i64(local_tid_55086) + i_55115 * segscan_tblock_sizze_46996;\n                int64_t tmp_55117 = private_mem_55108[i_55115];\n                \n                ((__local ", "int64_t *) local_mem_55093)[sharedIdx_55116] = tmp_55117;\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            for (int64_t i_55118 = 0; i_55118 < chunk_sizze_55074; i_55118++) {\n                int64_t sharedIdx_55119 = sext_i32_i64(local_tid_55086) * chunk_sizze_55074 + i_55118;\n                int64_t tmp_55120 = ((__local int64_t *) local_mem_55093)[sharedIdx_55119];\n                \n                private_mem_55108[i_55118] = tmp_55120;\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n        }\n        // Per thread scan\n        {\n            for (int64_t i_55121 = 0; i_55121 < chunk_sizze_55074 - (int64_t) 1; i_55121++) {\n                int64_t eta_p_43896;\n                int64_t eta_p_43897;\n                \n                eta_p_43896 = private_mem_55108[i_55121];\n                eta_p_43897 = private_mem_55108[i_55121 + (int64_t) 1];\n                \n                int64_t defunc_0_op_res_43898 = add64(eta_p_43896, eta_p_43897);\n                \n                private_mem_55108[i_55121 + (int64_t) 1] = defunc_0_op_res_43898;\n            }\n        }\n        // Publish results in shared memory\n        {\n            int64_t tmp_55122 = private_mem_55108[chunk_sizze_55074 - (int64_t) 1];\n            \n            ((__local int64_t *) local_mem_55093)[sext_i32_i64(local_tid_55086)] = tmp_55122;\n            barrier(CLK_LOCAL_MEM_FENCE);\n        }\n        // Scan results (with warp scan)\n        {\n            int64_t eta_p_55123;\n            int64_t eta_p_55124;\n            int64_t eta_p_55127;\n            int64_t eta_p_55128;\n            bool ltid_in_bounds_55130 = slt64(sext_i32_i64(local_tid_55086), num_virt_threads_55076);\n            int32_t skip_threads_55131;\n            \n            // read input for in-block scan\n            {\n                if (ltid_in_bounds_55130) {\n                    eta_p_55124 = ((volatile __local int64_t *) local_mem_55093)[sext_i32_i64(local_tid_55086)];\n                    if ((local_tid_55086 - squot3",
                                    "2(local_tid_55086, 32) * 32) == 0) {\n                        eta_p_55123 = eta_p_55124;\n                    }\n                }\n            }\n            // in-block scan (hopefully no barriers needed)\n            {\n                skip_threads_55131 = 1;\n                while (slt32(skip_threads_55131, 32)) {\n                    bool thread_active_55132 = sle32(skip_threads_55131, local_tid_55086 - squot32(local_tid_55086, 32) * 32) && ltid_in_bounds_55130;\n                    \n                    if (thread_active_55132) {\n                        // read operands\n                        {\n                            eta_p_55123 = ((volatile __local int64_t *) local_mem_55093)[sext_i32_i64(local_tid_55086) - sext_i32_i64(skip_threads_55131)];\n                        }\n                    }\n                    // perform operation\n                    {\n                        if (thread_active_55132) {\n                            int64_t defunc_0_op_res_55125 = add64(eta_p_55123, eta_p_55124);\n                            \n                            eta_p_55123 = defunc_0_op_res_55125;\n                        }\n                    }\n                    if (sle32(wave_sizze_55088, skip_threads_55131)) {\n                        barrier(CLK_LOCAL_MEM_FENCE);\n                    }\n                    if (thread_active_55132) {\n                        // write result\n                        {\n                            ((volatile __local int64_t *) local_mem_55093)[sext_i32_i64(local_tid_55086)] = eta_p_55123;\n                            eta_p_55124 = eta_p_55123;\n                        }\n                    }\n                    if (sle32(wave_sizze_55088, skip_threads_55131)) {\n                        barrier(CLK_LOCAL_MEM_FENCE);\n                    }\n                    skip_threads_55131 *= 2;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // last thread of block 'i' writes its result to offset 'i'\n            {\n             ", "   if ((local_tid_55086 - squot32(local_tid_55086, 32) * 32) == 31 && ltid_in_bounds_55130) {\n                    ((volatile __local int64_t *) local_mem_55093)[sext_i32_i64(squot32(local_tid_55086, 32))] = eta_p_55123;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // scan the first block, after which offset 'i' contains carry-in for block 'i+1'\n            {\n                int32_t skip_threads_55133;\n                \n                // read input for in-block scan\n                {\n                    if (squot32(local_tid_55086, 32) == 0 && ltid_in_bounds_55130) {\n                        eta_p_55128 = ((volatile __local int64_t *) local_mem_55093)[sext_i32_i64(local_tid_55086)];\n                        if ((local_tid_55086 - squot32(local_tid_55086, 32) * 32) == 0) {\n                            eta_p_55127 = eta_p_55128;\n                        }\n                    }\n                }\n                // in-block scan (hopefully no barriers needed)\n                {\n                    skip_threads_55133 = 1;\n                    while (slt32(skip_threads_55133, 32)) {\n                        bool thread_active_55134 = sle32(skip_threads_55133, local_tid_55086 - squot32(local_tid_55086, 32) * 32) && (squot32(local_tid_55086, 32) == 0 && ltid_in_bounds_55130);\n                        \n                        if (thread_active_55134) {\n                            // read operands\n                            {\n                                eta_p_55127 = ((volatile __local int64_t *) local_mem_55093)[sext_i32_i64(local_tid_55086) - sext_i32_i64(skip_threads_55133)];\n                            }\n                        }\n                        // perform operation\n                        {\n                            if (thread_active_55134) {\n                                int64_t defunc_0_op_res_55129 = add64(eta_p_55127, eta_p_55128);\n                                \n                                eta_p_55127 = defunc_0_", "op_res_55129;\n                            }\n                        }\n                        if (sle32(wave_sizze_55088, skip_threads_55133)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        if (thread_active_55134) {\n                            // write result\n                            {\n                                ((volatile __local int64_t *) local_mem_55093)[sext_i32_i64(local_tid_55086)] = eta_p_55127;\n                                eta_p_55128 = eta_p_55127;\n                            }\n                        }\n                        if (sle32(wave_sizze_55088, skip_threads_55133)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        skip_threads_55133 *= 2;\n                    }\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            \n            bool no_carry_in_55135 = squot32(local_tid_55086, 32) == 0 || !ltid_in_bounds_55130;\n            \n            // carry-in for every block except the first\n            {\n                // read operands\n                {\n                    if (!no_carry_in_55135) {\n                        eta_p_55124 = eta_p_55123;\n                        eta_p_55123 = ((__local int64_t *) local_mem_55093)[sext_i32_i64(squot32(local_tid_55086, 32)) - (int64_t) 1];\n                    }\n                }\n                // perform operation\n                {\n                    if (!no_carry_in_55135) {\n                        int64_t defunc_0_op_res_55125 = add64(eta_p_55123, eta_p_55124);\n                        \n                        eta_p_55123 = defunc_0_op_res_55125;\n                    }\n                }\n                // write final result\n                {\n                    if (!no_carry_in_55135) {\n                        ((__local int64_t *) local_mem_55093)[sext_i32_i64(local_tid_55086)] = eta_p_55123;\n                    }\n                }\n            }\n     ",
                                    "       barrier(CLK_LOCAL_MEM_FENCE);\n            // restore correct values for first block\n            {\n                if (squot32(local_tid_55086, 32) == 0 && ltid_in_bounds_55130) {\n                    ((__local int64_t *) local_mem_55093)[sext_i32_i64(local_tid_55086)] = eta_p_55124;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            barrier(CLK_LOCAL_MEM_FENCE);\n            if (local_tid_55086 == 0) {\n                acc_55126 = ((__local int64_t *) local_mem_55093)[segscan_tblock_sizze_46996 - (int64_t) 1];\n            } else {\n                acc_55126 = ((__local int64_t *) local_mem_55093)[sext_i32_i64(local_tid_55086) - (int64_t) 1];\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n        }\n        prefix_55136 = (int64_t) 0;\n        block_new_sgm_55137 = sgm_idx_55105 == (int64_t) 0;\n        // Perform lookback\n        {\n            if (block_new_sgm_55137 && local_tid_55086 == 0) {\n                ((volatile __global int64_t *) incprefixes_mem_55081)[dynamic_id_55103] = acc_55126;\n                mem_fence_global();\n                ((volatile __global int8_t *) status_flags_mem_55077)[dynamic_id_55103] = (int8_t) 2;\n                acc_55126 = (int64_t) 0;\n            }\n            if (!block_new_sgm_55137 && slt32(local_tid_55086, wave_sizze_55088)) {\n                if (local_tid_55086 == 0) {\n                    ((volatile __global int64_t *) aggregates_mem_55079)[dynamic_id_55103] = acc_55126;\n                    mem_fence_global();\n                    ((volatile __global int8_t *) status_flags_mem_55077)[dynamic_id_55103] = (int8_t) 1;\n                    \n                    int8_t tmp_55138 = ((volatile __global int8_t *) status_flags_mem_55077)[dynamic_id_55103 - (int64_t) 1];\n                    \n                    ((volatile __local int8_t *) local_mem_55093)[(int64_t) 0] = tmp_55138;\n                }\n                mem_fence_local();\n                \n                int8_t status_55139 = ((__local", " int8_t *) local_mem_55093)[(int64_t) 0];\n                \n                if (status_55139 == (int8_t) 2) {\n                    if (local_tid_55086 == 0) {\n                        prefix_55136 = ((volatile __global int64_t *) incprefixes_mem_55081)[dynamic_id_55103 - (int64_t) 1];\n                    }\n                } else {\n                    int32_t readOffset_55140 = sext_i64_i32(dynamic_id_55103 - sext_i32_i64(wave_sizze_55088));\n                    \n                    while (slt32(wave_sizze_55088 * -1, readOffset_55140)) {\n                        int32_t read_i_55141 = readOffset_55140 + local_tid_55086;\n                        int64_t aggr_55142 = (int64_t) 0;\n                        int8_t flag_55143 = (int8_t) 0;\n                        \n                        if (sle32(0, read_i_55141)) {\n                            flag_55143 = ((volatile __global int8_t *) status_flags_mem_55077)[sext_i32_i64(read_i_55141)];\n                            if (flag_55143 == (int8_t) 2) {\n                                aggr_55142 = ((volatile __global int64_t *) incprefixes_mem_55081)[sext_i32_i64(read_i_55141)];\n                            } else if (flag_55143 == (int8_t) 1) {\n                                aggr_55142 = ((volatile __global int64_t *) aggregates_mem_55079)[sext_i32_i64(read_i_55141)];\n                            }\n                        }\n                        ((__local int64_t *) local_mem_55093)[(int64_t) 4 + sext_i32_i64(local_tid_55086)] = aggr_55142;\n                        ((__local int8_t *) local_mem_55093)[sext_i32_i64(local_tid_55086)] = flag_55143;\n                        flag_55143 = ((__local int8_t *) local_mem_55093)[sext_i32_i64(wave_sizze_55088) - (int64_t) 1];\n                        if (slt8(flag_55143, (int8_t) 2)) {\n                            int8_t flg_x_55147;\n                            int8_t flg_y_55148;\n                            int64_t eta_p_55144;\n                            int64_t eta_p_55145;\n                    ", "        int32_t skip_threads_55149;\n                            \n                            // read input for in-block scan\n                            {\n                                flg_y_55148 = ((volatile __local int8_t *) local_mem_55093)[sext_i32_i64(local_tid_55086)];\n                                eta_p_55145 = ((volatile __local int64_t *) local_mem_55093)[(int64_t) 4 + sext_i32_i64(local_tid_55086)];\n                                if ((local_tid_55086 - squot32(local_tid_55086, 32) * 32) == 0) {\n                                    eta_p_55144 = eta_p_55145;\n                                    flg_x_55147 = flg_y_55148;\n                                }\n                            }\n                            // in-block scan (hopefully no barriers needed)\n                            {\n                                skip_threads_55149 = 1;\n                                while (slt32(skip_threads_55149, 32)) {\n                                    if (sle32(skip_threads_55149, local_tid_55086 - squot32(local_tid_55086, 32) * 32)) {\n                                        // read operands\n                                        {\n                                            flg_x_55147 = ((volatile __local int8_t *) local_mem_55093)[sext_i32_i64(local_tid_55086) - sext_i32_i64(skip_threads_55149)];\n                                            eta_p_55144 = ((volatile __local int64_t *) local_mem_55093)[(int64_t) 4 + (sext_i32_i64(local_tid_55086) - sext_i32_i64(skip_threads_55149))];\n                                        }\n                                        // perform operation\n                                        {\n                                            if (flg_y_55148 == (int8_t) 2 || flg_y_55148 == (int8_t) 0) {\n                                                flg_x_55147 = flg_y_55148;\n                                                eta_p_55144 = eta_p_55145;\n                                            } else {\n                          ",
                                    "                      int64_t defunc_0_op_res_55146 = add64(eta_p_55144, eta_p_55145);\n                                                \n                                                eta_p_55144 = defunc_0_op_res_55146;\n                                            }\n                                        }\n                                        // write result\n                                        {\n                                            ((volatile __local int8_t *) local_mem_55093)[sext_i32_i64(local_tid_55086)] = flg_x_55147;\n                                            flg_y_55148 = flg_x_55147;\n                                            ((volatile __local int64_t *) local_mem_55093)[(int64_t) 4 + sext_i32_i64(local_tid_55086)] = eta_p_55144;\n                                            eta_p_55145 = eta_p_55144;\n                                        }\n                                    }\n                                    skip_threads_55149 *= 2;\n                                }\n                            }\n                        }\n                        flag_55143 = ((__local int8_t *) local_mem_55093)[sext_i32_i64(wave_sizze_55088) - (int64_t) 1];\n                        aggr_55142 = ((__local int64_t *) local_mem_55093)[(int64_t) 4 + (sext_i32_i64(wave_sizze_55088) - (int64_t) 1)];\n                        if (flag_55143 == (int8_t) 2) {\n                            readOffset_55140 = wave_sizze_55088 * -1;\n                        } else if (flag_55143 == (int8_t) 1) {\n                            readOffset_55140 -= wave_sizze_55088;\n                        }\n                        if (slt8((int8_t) 0, flag_55143)) {\n                            int64_t eta_p_55150 = aggr_55142;\n                            int64_t eta_p_55151 = prefix_55136;\n                            int64_t defunc_0_op_res_55152 = add64(eta_p_55150, eta_p_55151);\n                            \n                            prefix_55136 = defunc_0_op_res_55152;\n                   ", "     }\n                        mem_fence_local();\n                    }\n                }\n                if (local_tid_55086 == 0) {\n                    if (boundary_55106 == sext_i64_i32(segscan_tblock_sizze_46996 * chunk_sizze_55074)) {\n                        int64_t eta_p_55153 = prefix_55136;\n                        int64_t eta_p_55154 = acc_55126;\n                        int64_t defunc_0_op_res_55155 = add64(eta_p_55153, eta_p_55154);\n                        \n                        ((volatile __global int64_t *) incprefixes_mem_55081)[dynamic_id_55103] = defunc_0_op_res_55155;\n                        mem_fence_global();\n                        ((volatile __global int8_t *) status_flags_mem_55077)[dynamic_id_55103] = (int8_t) 2;\n                    }\n                    ((__local int64_t *) local_mem_55093)[(int64_t) 4] = prefix_55136;\n                    acc_55126 = (int64_t) 0;\n                }\n            }\n            if (!(dynamic_id_55103 == (int64_t) 0)) {\n                barrier(CLK_LOCAL_MEM_FENCE);\n                prefix_55136 = ((__local int64_t *) local_mem_55093)[(int64_t) 4];\n                barrier(CLK_LOCAL_MEM_FENCE);\n            }\n        }\n        // Distribute results\n        {\n            int64_t eta_p_55156;\n            int64_t eta_p_55157;\n            int64_t eta_p_55159 = prefix_55136;\n            int64_t eta_p_55160 = acc_55126;\n            \n            if (slt32(local_tid_55086 * chunk_sizze_32b_55090, boundary_55106) && !block_new_sgm_55137) {\n                int64_t defunc_0_op_res_55161 = add64(eta_p_55159, eta_p_55160);\n                \n                eta_p_55156 = defunc_0_op_res_55161;\n            } else {\n                eta_p_55156 = acc_55126;\n            }\n            \n            int32_t stopping_point_55162 = segsizze_compact_55107 - srem32(local_tid_55086 * chunk_sizze_32b_55090 - 1 + segsizze_compact_55107 - boundary_55106, segsizze_compact_55107);\n            \n            for (int64_t i_55163 = 0; i_55163 < chunk_siz", "ze_55074; i_55163++) {\n                if (slt32(sext_i64_i32(i_55163), stopping_point_55162 - 1)) {\n                    eta_p_55157 = private_mem_55108[i_55163];\n                    \n                    int64_t defunc_0_op_res_55158 = add64(eta_p_55156, eta_p_55157);\n                    \n                    private_mem_55108[i_55163] = defunc_0_op_res_55158;\n                }\n            }\n        }\n        // Transpose scan output and Write it to global memory in coalesced fashion\n        {\n            for (int64_t i_55164 = 0; i_55164 < chunk_sizze_55074; i_55164++) {\n                int64_t sharedIdx_55165 = sext_i32_i64(local_tid_55086) * chunk_sizze_55074 + i_55164;\n                int64_t tmp_55166 = private_mem_55108[i_55164];\n                \n                ((__local int64_t *) local_mem_55093)[sharedIdx_55165] = tmp_55166;\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            for (int64_t i_55167 = 0; i_55167 < chunk_sizze_55074; i_55167++) {\n                int64_t flat_idx_55168 = thd_offset_55110 + i_55167 * segscan_tblock_sizze_46996;\n                int64_t slice_55169 = partition_sizze_43809;\n                int64_t gtid_47000 = flat_idx_55168;\n                int64_t remnant_55170 = flat_idx_55168 - gtid_47000;\n                \n                if (slt64(flat_idx_55168, partition_sizze_43809)) {\n                    int64_t tmp_55171 = ((__local int64_t *) local_mem_55093)[flat_idx_55168 - block_offset_55104];\n                    \n                    ((__global int64_t *) mem_53605)[gtid_47000] = tmp_55171;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n        }\n    }\n    \n  error_3:\n    return;\n    #undef segscan_tblock_sizze_46996\n    #undef chunk_sizze_55074\n}\nFUTHARK_KERNEL_SIZED(do_DBSCAN_doublezisegscan_47049_dim1, 1, 1)\nvoid do_DBSCAN_doublezisegscan_47049(__global int *global_failure, int64_t n_36798, int64_t num_tblocks_47046, int64_t num_virt_blocks_55213, int64_t num_virt_threads_55214, __global un",
                                    "signed char *mem_53619, __global unsigned char *mem_53622, __global unsigned char *mem_53624, __global unsigned char *status_flags_mem_55215, __global unsigned char *aggregates_mem_55217, __global unsigned char *incprefixes_mem_55219, __global unsigned char *global_dynid_mem_55221)\n{\n    #define segscan_tblock_sizze_47044 (do_DBSCAN_doublezisegscan_47049zisegscan_tblock_sizze_47044)\n    #define chunk_sizze_55212 (do_DBSCAN_doublezisegscan_47049zichunk_sizze_55212)\n    \n    volatile __local unsigned char *local_mem_55231_backing_0 = &shared_mem[0];\n    const int64_t local_mem_55231_backing_0_offset = 0 + (smax64(smax64((int64_t) 288, (int64_t) 8 * segscan_tblock_sizze_47044), chunk_sizze_55212 * segscan_tblock_sizze_47044 * (int64_t) 8) + srem64((int64_t) 8 - srem64(smax64(smax64((int64_t) 288, (int64_t) 8 * segscan_tblock_sizze_47044), chunk_sizze_55212 * segscan_tblock_sizze_47044 * (int64_t) 8), (int64_t) 8), (int64_t) 8));\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_55224;\n    int32_t tblock_sizze_55227;\n    int32_t wave_sizze_55226;\n    int32_t block_id_55225;\n    int32_t global_tid_55223;\n    int64_t phys_tid_47049;\n    int32_t chunk_sizze_32b_55228;\n    int64_t byte_offsets_55229;\n    int64_t warp_byte_offset_55230;\n    __local unsigned char *local_mem_55231;\n    int64_t trans_arr_len_55232;\n    int64_t phys_block_id_55238;\n    int64_t virtloop_bound_55239;\n    \n    local_tid_55224 = get_local_id(0);\n    tblock_sizze_55227 = get_local_size(0);\n    wave_sizze_55226 = LOCKSTEP_WIDTH;\n    block_id_55225 = get_tblock_id(0);\n    global_tid_55223 = block_id_55225 * tblock_sizze_55227 + local_tid_55224;\n    phys_tid_47049 = sext_i32_i64(global_tid_55223);\n    chunk_sizze_32b_55228 = sext_i64_i32(chunk_sizze_55212);\n    byte_offsets_55229 = segscan_tblock_sizze_47044 * (int64_t) 8;\n    warp_byte_offset_55230 = (int64_t) 288;\n    // Allocate reusable shared memory\n    { }\n    local_mem_55231 = (__local unsigned char *) local_mem_55231_", "backing_0;\n    trans_arr_len_55232 = chunk_sizze_55212 * segscan_tblock_sizze_47044;\n    phys_block_id_55238 = get_tblock_id(0);\n    virtloop_bound_55239 = sdiv_up64(num_virt_blocks_55213 - phys_block_id_55238, num_tblocks_47046);\n    for (int64_t virtloop_i_55240 = 0; virtloop_i_55240 < virtloop_bound_55239; virtloop_i_55240++) {\n        int64_t dynamic_id_55241;\n        int64_t block_offset_55242;\n        int64_t sgm_idx_55243;\n        int32_t boundary_55244;\n        int32_t segsizze_compact_55245;\n        int64_t private_mem_55246[chunk_sizze_55212];\n        int64_t thd_offset_55248;\n        int64_t acc_55264;\n        int64_t prefix_55274;\n        bool block_new_sgm_55275;\n        \n        // First thread in block fetches this block's dynamic_id\n        {\n            if (local_tid_55224 == 0) {\n                dynamic_id_55241 = atomic_add_i32_global(&((volatile __global int *) global_dynid_mem_55221)[(int64_t) 0], (int) 1);\n                // Set dynamic id for this block\n                {\n                    ((__local int64_t *) local_mem_55231)[(int64_t) 0] = dynamic_id_55241;\n                }\n                // First thread in last (virtual) block resets global dynamic_id\n                {\n                    if (dynamic_id_55241 == num_virt_blocks_55213 - (int64_t) 1) {\n                        ((__global int32_t *) global_dynid_mem_55221)[(int64_t) 0] = 0;\n                    }\n                }\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        dynamic_id_55241 = ((__local int32_t *) local_mem_55231)[(int64_t) 0];\n        barrier(CLK_LOCAL_MEM_FENCE);\n        block_offset_55242 = dynamic_id_55241 * chunk_sizze_55212 * segscan_tblock_sizze_47044;\n        sgm_idx_55243 = smod64(block_offset_55242, n_36798);\n        boundary_55244 = sext_i64_i32(smin64(chunk_sizze_55212 * segscan_tblock_sizze_47044, n_36798 - sgm_idx_55243));\n        segsizze_compact_55245 = sext_i64_i32(smin64(chunk_sizze_55212 * segscan_tblock_sizze_47044, n_36798));\n    ", "    thd_offset_55248 = block_offset_55242 + sext_i32_i64(local_tid_55224);\n        // Load and map\n        {\n            for (int64_t i_55249 = 0; i_55249 < chunk_sizze_55212; i_55249++) {\n                int64_t virt_tid_55250 = thd_offset_55248 + i_55249 * segscan_tblock_sizze_47044;\n                int64_t slice_55251 = n_36798;\n                int64_t gtid_47048 = virt_tid_55250;\n                int64_t remnant_55252 = virt_tid_55250 - gtid_47048;\n                \n                if (slt64(virt_tid_55250, n_36798)) {\n                    bool eta_p_44921 = ((__global bool *) mem_53619)[gtid_47048];\n                    int64_t defunc_0_f_res_44922 = btoi_bool_i64(eta_p_44921);\n                    \n                    ((__global int64_t *) mem_53624)[gtid_47048] = defunc_0_f_res_44922;\n                    private_mem_55246[i_55249] = defunc_0_f_res_44922;\n                } else {\n                    private_mem_55246[i_55249] = (int64_t) 0;\n                }\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        // Transpose scan inputs\n        {\n            for (int64_t i_55253 = 0; i_55253 < chunk_sizze_55212; i_55253++) {\n                int64_t sharedIdx_55254 = sext_i32_i64(local_tid_55224) + i_55253 * segscan_tblock_sizze_47044;\n                int64_t tmp_55255 = private_mem_55246[i_55253];\n                \n                ((__local int64_t *) local_mem_55231)[sharedIdx_55254] = tmp_55255;\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            for (int64_t i_55256 = 0; i_55256 < chunk_sizze_55212; i_55256++) {\n                int64_t sharedIdx_55257 = sext_i32_i64(local_tid_55224) * chunk_sizze_55212 + i_55256;\n                int64_t tmp_55258 = ((__local int64_t *) local_mem_55231)[sharedIdx_55257];\n                \n                private_mem_55246[i_55256] = tmp_55258;\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n        }\n        // Per thread scan\n        {\n            for (int64_t i_55259 = 0; i_55259 < chunk_siz",
                                    "ze_55212 - (int64_t) 1; i_55259++) {\n                int64_t eta_p_43943;\n                int64_t eta_p_43944;\n                \n                eta_p_43943 = private_mem_55246[i_55259];\n                eta_p_43944 = private_mem_55246[i_55259 + (int64_t) 1];\n                \n                int64_t defunc_0_op_res_43945 = add64(eta_p_43943, eta_p_43944);\n                \n                private_mem_55246[i_55259 + (int64_t) 1] = defunc_0_op_res_43945;\n            }\n        }\n        // Publish results in shared memory\n        {\n            int64_t tmp_55260 = private_mem_55246[chunk_sizze_55212 - (int64_t) 1];\n            \n            ((__local int64_t *) local_mem_55231)[sext_i32_i64(local_tid_55224)] = tmp_55260;\n            barrier(CLK_LOCAL_MEM_FENCE);\n        }\n        // Scan results (with warp scan)\n        {\n            int64_t eta_p_55261;\n            int64_t eta_p_55262;\n            int64_t eta_p_55265;\n            int64_t eta_p_55266;\n            bool ltid_in_bounds_55268 = slt64(sext_i32_i64(local_tid_55224), num_virt_threads_55214);\n            int32_t skip_threads_55269;\n            \n            // read input for in-block scan\n            {\n                if (ltid_in_bounds_55268) {\n                    eta_p_55262 = ((volatile __local int64_t *) local_mem_55231)[sext_i32_i64(local_tid_55224)];\n                    if ((local_tid_55224 - squot32(local_tid_55224, 32) * 32) == 0) {\n                        eta_p_55261 = eta_p_55262;\n                    }\n                }\n            }\n            // in-block scan (hopefully no barriers needed)\n            {\n                skip_threads_55269 = 1;\n                while (slt32(skip_threads_55269, 32)) {\n                    bool thread_active_55270 = sle32(skip_threads_55269, local_tid_55224 - squot32(local_tid_55224, 32) * 32) && ltid_in_bounds_55268;\n                    \n                    if (thread_active_55270) {\n                        // read operands\n                        {\n                        ", "    eta_p_55261 = ((volatile __local int64_t *) local_mem_55231)[sext_i32_i64(local_tid_55224) - sext_i32_i64(skip_threads_55269)];\n                        }\n                    }\n                    // perform operation\n                    {\n                        if (thread_active_55270) {\n                            int64_t defunc_0_op_res_55263 = add64(eta_p_55261, eta_p_55262);\n                            \n                            eta_p_55261 = defunc_0_op_res_55263;\n                        }\n                    }\n                    if (sle32(wave_sizze_55226, skip_threads_55269)) {\n                        barrier(CLK_LOCAL_MEM_FENCE);\n                    }\n                    if (thread_active_55270) {\n                        // write result\n                        {\n                            ((volatile __local int64_t *) local_mem_55231)[sext_i32_i64(local_tid_55224)] = eta_p_55261;\n                            eta_p_55262 = eta_p_55261;\n                        }\n                    }\n                    if (sle32(wave_sizze_55226, skip_threads_55269)) {\n                        barrier(CLK_LOCAL_MEM_FENCE);\n                    }\n                    skip_threads_55269 *= 2;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // last thread of block 'i' writes its result to offset 'i'\n            {\n                if ((local_tid_55224 - squot32(local_tid_55224, 32) * 32) == 31 && ltid_in_bounds_55268) {\n                    ((volatile __local int64_t *) local_mem_55231)[sext_i32_i64(squot32(local_tid_55224, 32))] = eta_p_55261;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // scan the first block, after which offset 'i' contains carry-in for block 'i+1'\n            {\n                int32_t skip_threads_55271;\n                \n                // read input for in-block scan\n                {\n                    if (squot32(local_tid_55224, 32) == 0 && ltid_in_bounds_55268) {\n        ", "                eta_p_55266 = ((volatile __local int64_t *) local_mem_55231)[sext_i32_i64(local_tid_55224)];\n                        if ((local_tid_55224 - squot32(local_tid_55224, 32) * 32) == 0) {\n                            eta_p_55265 = eta_p_55266;\n                        }\n                    }\n                }\n                // in-block scan (hopefully no barriers needed)\n                {\n                    skip_threads_55271 = 1;\n                    while (slt32(skip_threads_55271, 32)) {\n                        bool thread_active_55272 = sle32(skip_threads_55271, local_tid_55224 - squot32(local_tid_55224, 32) * 32) && (squot32(local_tid_55224, 32) == 0 && ltid_in_bounds_55268);\n                        \n                        if (thread_active_55272) {\n                            // read operands\n                            {\n                                eta_p_55265 = ((volatile __local int64_t *) local_mem_55231)[sext_i32_i64(local_tid_55224) - sext_i32_i64(skip_threads_55271)];\n                            }\n                        }\n                        // perform operation\n                        {\n                            if (thread_active_55272) {\n                                int64_t defunc_0_op_res_55267 = add64(eta_p_55265, eta_p_55266);\n                                \n                                eta_p_55265 = defunc_0_op_res_55267;\n                            }\n                        }\n                        if (sle32(wave_sizze_55226, skip_threads_55271)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        if (thread_active_55272) {\n                            // write result\n                            {\n                                ((volatile __local int64_t *) local_mem_55231)[sext_i32_i64(local_tid_55224)] = eta_p_55265;\n                                eta_p_55266 = eta_p_55265;\n                            }\n                        }\n                        if (",
                                    "sle32(wave_sizze_55226, skip_threads_55271)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        skip_threads_55271 *= 2;\n                    }\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            \n            bool no_carry_in_55273 = squot32(local_tid_55224, 32) == 0 || !ltid_in_bounds_55268;\n            \n            // carry-in for every block except the first\n            {\n                // read operands\n                {\n                    if (!no_carry_in_55273) {\n                        eta_p_55262 = eta_p_55261;\n                        eta_p_55261 = ((__local int64_t *) local_mem_55231)[sext_i32_i64(squot32(local_tid_55224, 32)) - (int64_t) 1];\n                    }\n                }\n                // perform operation\n                {\n                    if (!no_carry_in_55273) {\n                        int64_t defunc_0_op_res_55263 = add64(eta_p_55261, eta_p_55262);\n                        \n                        eta_p_55261 = defunc_0_op_res_55263;\n                    }\n                }\n                // write final result\n                {\n                    if (!no_carry_in_55273) {\n                        ((__local int64_t *) local_mem_55231)[sext_i32_i64(local_tid_55224)] = eta_p_55261;\n                    }\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // restore correct values for first block\n            {\n                if (squot32(local_tid_55224, 32) == 0 && ltid_in_bounds_55268) {\n                    ((__local int64_t *) local_mem_55231)[sext_i32_i64(local_tid_55224)] = eta_p_55262;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            barrier(CLK_LOCAL_MEM_FENCE);\n            if (local_tid_55224 == 0) {\n                acc_55264 = ((__local int64_t *) local_mem_55231)[segscan_tblock_sizze_47044 - (int64_t) 1];\n            } else {\n                acc_55264 = ((__local int64_t ", "*) local_mem_55231)[sext_i32_i64(local_tid_55224) - (int64_t) 1];\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n        }\n        prefix_55274 = (int64_t) 0;\n        block_new_sgm_55275 = sgm_idx_55243 == (int64_t) 0;\n        // Perform lookback\n        {\n            if (block_new_sgm_55275 && local_tid_55224 == 0) {\n                ((volatile __global int64_t *) incprefixes_mem_55219)[dynamic_id_55241] = acc_55264;\n                mem_fence_global();\n                ((volatile __global int8_t *) status_flags_mem_55215)[dynamic_id_55241] = (int8_t) 2;\n                acc_55264 = (int64_t) 0;\n            }\n            if (!block_new_sgm_55275 && slt32(local_tid_55224, wave_sizze_55226)) {\n                if (local_tid_55224 == 0) {\n                    ((volatile __global int64_t *) aggregates_mem_55217)[dynamic_id_55241] = acc_55264;\n                    mem_fence_global();\n                    ((volatile __global int8_t *) status_flags_mem_55215)[dynamic_id_55241] = (int8_t) 1;\n                    \n                    int8_t tmp_55276 = ((volatile __global int8_t *) status_flags_mem_55215)[dynamic_id_55241 - (int64_t) 1];\n                    \n                    ((volatile __local int8_t *) local_mem_55231)[(int64_t) 0] = tmp_55276;\n                }\n                mem_fence_local();\n                \n                int8_t status_55277 = ((__local int8_t *) local_mem_55231)[(int64_t) 0];\n                \n                if (status_55277 == (int8_t) 2) {\n                    if (local_tid_55224 == 0) {\n                        prefix_55274 = ((volatile __global int64_t *) incprefixes_mem_55219)[dynamic_id_55241 - (int64_t) 1];\n                    }\n                } else {\n                    int32_t readOffset_55278 = sext_i64_i32(dynamic_id_55241 - sext_i32_i64(wave_sizze_55226));\n                    \n                    while (slt32(wave_sizze_55226 * -1, readOffset_55278)) {\n                        int32_t read_i_55279 = readOffset_55278 + local_tid_55224;", "\n                        int64_t aggr_55280 = (int64_t) 0;\n                        int8_t flag_55281 = (int8_t) 0;\n                        \n                        if (sle32(0, read_i_55279)) {\n                            flag_55281 = ((volatile __global int8_t *) status_flags_mem_55215)[sext_i32_i64(read_i_55279)];\n                            if (flag_55281 == (int8_t) 2) {\n                                aggr_55280 = ((volatile __global int64_t *) incprefixes_mem_55219)[sext_i32_i64(read_i_55279)];\n                            } else if (flag_55281 == (int8_t) 1) {\n                                aggr_55280 = ((volatile __global int64_t *) aggregates_mem_55217)[sext_i32_i64(read_i_55279)];\n                            }\n                        }\n                        ((__local int64_t *) local_mem_55231)[(int64_t) 4 + sext_i32_i64(local_tid_55224)] = aggr_55280;\n                        ((__local int8_t *) local_mem_55231)[sext_i32_i64(local_tid_55224)] = flag_55281;\n                        flag_55281 = ((__local int8_t *) local_mem_55231)[sext_i32_i64(wave_sizze_55226) - (int64_t) 1];\n                        if (slt8(flag_55281, (int8_t) 2)) {\n                            int8_t flg_x_55285;\n                            int8_t flg_y_55286;\n                            int64_t eta_p_55282;\n                            int64_t eta_p_55283;\n                            int32_t skip_threads_55287;\n                            \n                            // read input for in-block scan\n                            {\n                                flg_y_55286 = ((volatile __local int8_t *) local_mem_55231)[sext_i32_i64(local_tid_55224)];\n                                eta_p_55283 = ((volatile __local int64_t *) local_mem_55231)[(int64_t) 4 + sext_i32_i64(local_tid_55224)];\n                                if ((local_tid_55224 - squot32(local_tid_55224, 32) * 32) == 0) {\n                                    eta_p_55282 = eta_p_55283;\n                                    flg_x_5",
                                    "5285 = flg_y_55286;\n                                }\n                            }\n                            // in-block scan (hopefully no barriers needed)\n                            {\n                                skip_threads_55287 = 1;\n                                while (slt32(skip_threads_55287, 32)) {\n                                    if (sle32(skip_threads_55287, local_tid_55224 - squot32(local_tid_55224, 32) * 32)) {\n                                        // read operands\n                                        {\n                                            flg_x_55285 = ((volatile __local int8_t *) local_mem_55231)[sext_i32_i64(local_tid_55224) - sext_i32_i64(skip_threads_55287)];\n                                            eta_p_55282 = ((volatile __local int64_t *) local_mem_55231)[(int64_t) 4 + (sext_i32_i64(local_tid_55224) - sext_i32_i64(skip_threads_55287))];\n                                        }\n                                        // perform operation\n                                        {\n                                            if (flg_y_55286 == (int8_t) 2 || flg_y_55286 == (int8_t) 0) {\n                                                flg_x_55285 = flg_y_55286;\n                                                eta_p_55282 = eta_p_55283;\n                                            } else {\n                                                int64_t defunc_0_op_res_55284 = add64(eta_p_55282, eta_p_55283);\n                                                \n                                                eta_p_55282 = defunc_0_op_res_55284;\n                                            }\n                                        }\n                                        // write result\n                                        {\n                                            ((volatile __local int8_t *) local_mem_55231)[sext_i32_i64(local_tid_55224)] = flg_x_55285;\n                                            flg_y_55286 = flg_x_55285;\n        ", "                                    ((volatile __local int64_t *) local_mem_55231)[(int64_t) 4 + sext_i32_i64(local_tid_55224)] = eta_p_55282;\n                                            eta_p_55283 = eta_p_55282;\n                                        }\n                                    }\n                                    skip_threads_55287 *= 2;\n                                }\n                            }\n                        }\n                        flag_55281 = ((__local int8_t *) local_mem_55231)[sext_i32_i64(wave_sizze_55226) - (int64_t) 1];\n                        aggr_55280 = ((__local int64_t *) local_mem_55231)[(int64_t) 4 + (sext_i32_i64(wave_sizze_55226) - (int64_t) 1)];\n                        if (flag_55281 == (int8_t) 2) {\n                            readOffset_55278 = wave_sizze_55226 * -1;\n                        } else if (flag_55281 == (int8_t) 1) {\n                            readOffset_55278 -= wave_sizze_55226;\n                        }\n                        if (slt8((int8_t) 0, flag_55281)) {\n                            int64_t eta_p_55288 = aggr_55280;\n                            int64_t eta_p_55289 = prefix_55274;\n                            int64_t defunc_0_op_res_55290 = add64(eta_p_55288, eta_p_55289);\n                            \n                            prefix_55274 = defunc_0_op_res_55290;\n                        }\n                        mem_fence_local();\n                    }\n                }\n                if (local_tid_55224 == 0) {\n                    if (boundary_55244 == sext_i64_i32(segscan_tblock_sizze_47044 * chunk_sizze_55212)) {\n                        int64_t eta_p_55291 = prefix_55274;\n                        int64_t eta_p_55292 = acc_55264;\n                        int64_t defunc_0_op_res_55293 = add64(eta_p_55291, eta_p_55292);\n                        \n                        ((volatile __global int64_t *) incprefixes_mem_55219)[dynamic_id_55241] = defunc_0_op_res_55293;\n                        mem_fe", "nce_global();\n                        ((volatile __global int8_t *) status_flags_mem_55215)[dynamic_id_55241] = (int8_t) 2;\n                    }\n                    ((__local int64_t *) local_mem_55231)[(int64_t) 4] = prefix_55274;\n                    acc_55264 = (int64_t) 0;\n                }\n            }\n            if (!(dynamic_id_55241 == (int64_t) 0)) {\n                barrier(CLK_LOCAL_MEM_FENCE);\n                prefix_55274 = ((__local int64_t *) local_mem_55231)[(int64_t) 4];\n                barrier(CLK_LOCAL_MEM_FENCE);\n            }\n        }\n        // Distribute results\n        {\n            int64_t eta_p_55294;\n            int64_t eta_p_55295;\n            int64_t eta_p_55297 = prefix_55274;\n            int64_t eta_p_55298 = acc_55264;\n            \n            if (slt32(local_tid_55224 * chunk_sizze_32b_55228, boundary_55244) && !block_new_sgm_55275) {\n                int64_t defunc_0_op_res_55299 = add64(eta_p_55297, eta_p_55298);\n                \n                eta_p_55294 = defunc_0_op_res_55299;\n            } else {\n                eta_p_55294 = acc_55264;\n            }\n            \n            int32_t stopping_point_55300 = segsizze_compact_55245 - srem32(local_tid_55224 * chunk_sizze_32b_55228 - 1 + segsizze_compact_55245 - boundary_55244, segsizze_compact_55245);\n            \n            for (int64_t i_55301 = 0; i_55301 < chunk_sizze_55212; i_55301++) {\n                if (slt32(sext_i64_i32(i_55301), stopping_point_55300 - 1)) {\n                    eta_p_55295 = private_mem_55246[i_55301];\n                    \n                    int64_t defunc_0_op_res_55296 = add64(eta_p_55294, eta_p_55295);\n                    \n                    private_mem_55246[i_55301] = defunc_0_op_res_55296;\n                }\n            }\n        }\n        // Transpose scan output and Write it to global memory in coalesced fashion\n        {\n            for (int64_t i_55302 = 0; i_55302 < chunk_sizze_55212; i_55302++) {\n                int64_t sharedIdx_55303 = se",
                                    "xt_i32_i64(local_tid_55224) * chunk_sizze_55212 + i_55302;\n                int64_t tmp_55304 = private_mem_55246[i_55302];\n                \n                ((__local int64_t *) local_mem_55231)[sharedIdx_55303] = tmp_55304;\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            for (int64_t i_55305 = 0; i_55305 < chunk_sizze_55212; i_55305++) {\n                int64_t flat_idx_55306 = thd_offset_55248 + i_55305 * segscan_tblock_sizze_47044;\n                int64_t slice_55307 = n_36798;\n                int64_t gtid_47048 = flat_idx_55306;\n                int64_t remnant_55308 = flat_idx_55306 - gtid_47048;\n                \n                if (slt64(flat_idx_55306, n_36798)) {\n                    int64_t tmp_55309 = ((__local int64_t *) local_mem_55231)[flat_idx_55306 - block_offset_55242];\n                    \n                    ((__global int64_t *) mem_53622)[gtid_47048] = tmp_55309;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n        }\n    }\n    \n  error_3:\n    return;\n    #undef segscan_tblock_sizze_47044\n    #undef chunk_sizze_55212\n}\nFUTHARK_KERNEL_SIZED(do_DBSCAN_doublezisegscan_47065_dim1, 1, 1)\nvoid do_DBSCAN_doublezisegscan_47065(__global int *global_failure, int64_t m_43906, int64_t conc_tmp_43977, int64_t num_tblocks_47062, int64_t num_virt_blocks_55330, int64_t num_virt_threads_55331, __global unsigned char *mem_53610, __global unsigned char *mem_53628, __global unsigned char *mem_53638, __global unsigned char *mem_53640, __global unsigned char *status_flags_mem_55332, __global unsigned char *aggregates_mem_55334, __global unsigned char *incprefixes_mem_55336, __global unsigned char *global_dynid_mem_55338)\n{\n    #define segscan_tblock_sizze_47060 (do_DBSCAN_doublezisegscan_47065zisegscan_tblock_sizze_47060)\n    #define chunk_sizze_55329 (do_DBSCAN_doublezisegscan_47065zichunk_sizze_55329)\n    \n    volatile __local unsigned char *local_mem_55348_backing_0 = &shared_mem[0];\n    const int64_t local_mem_55348_bac", "king_0_offset = 0 + (smax64(smax64((int64_t) 288, (int64_t) 8 * segscan_tblock_sizze_47060), chunk_sizze_55329 * segscan_tblock_sizze_47060 * (int64_t) 8) + srem64((int64_t) 8 - srem64(smax64(smax64((int64_t) 288, (int64_t) 8 * segscan_tblock_sizze_47060), chunk_sizze_55329 * segscan_tblock_sizze_47060 * (int64_t) 8), (int64_t) 8), (int64_t) 8));\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_55341;\n    int32_t tblock_sizze_55344;\n    int32_t wave_sizze_55343;\n    int32_t block_id_55342;\n    int32_t global_tid_55340;\n    int64_t phys_tid_47065;\n    int32_t chunk_sizze_32b_55345;\n    int64_t byte_offsets_55346;\n    int64_t warp_byte_offset_55347;\n    __local unsigned char *local_mem_55348;\n    int64_t trans_arr_len_55349;\n    int64_t phys_block_id_55355;\n    int64_t virtloop_bound_55356;\n    \n    local_tid_55341 = get_local_id(0);\n    tblock_sizze_55344 = get_local_size(0);\n    wave_sizze_55343 = LOCKSTEP_WIDTH;\n    block_id_55342 = get_tblock_id(0);\n    global_tid_55340 = block_id_55342 * tblock_sizze_55344 + local_tid_55341;\n    phys_tid_47065 = sext_i32_i64(global_tid_55340);\n    chunk_sizze_32b_55345 = sext_i64_i32(chunk_sizze_55329);\n    byte_offsets_55346 = segscan_tblock_sizze_47060 * (int64_t) 8;\n    warp_byte_offset_55347 = (int64_t) 288;\n    // Allocate reusable shared memory\n    { }\n    local_mem_55348 = (__local unsigned char *) local_mem_55348_backing_0;\n    trans_arr_len_55349 = chunk_sizze_55329 * segscan_tblock_sizze_47060;\n    phys_block_id_55355 = get_tblock_id(0);\n    virtloop_bound_55356 = sdiv_up64(num_virt_blocks_55330 - phys_block_id_55355, num_tblocks_47062);\n    for (int64_t virtloop_i_55357 = 0; virtloop_i_55357 < virtloop_bound_55356; virtloop_i_55357++) {\n        int64_t dynamic_id_55358;\n        int64_t block_offset_55359;\n        int64_t sgm_idx_55360;\n        int32_t boundary_55361;\n        int32_t segsizze_compact_55362;\n        int64_t private_mem_55363[chunk_sizze_55329];\n        int64_t thd_offset_5536", "5;\n        int64_t acc_55381;\n        int64_t prefix_55391;\n        bool block_new_sgm_55392;\n        \n        // First thread in block fetches this block's dynamic_id\n        {\n            if (local_tid_55341 == 0) {\n                dynamic_id_55358 = atomic_add_i32_global(&((volatile __global int *) global_dynid_mem_55338)[(int64_t) 0], (int) 1);\n                // Set dynamic id for this block\n                {\n                    ((__local int64_t *) local_mem_55348)[(int64_t) 0] = dynamic_id_55358;\n                }\n                // First thread in last (virtual) block resets global dynamic_id\n                {\n                    if (dynamic_id_55358 == num_virt_blocks_55330 - (int64_t) 1) {\n                        ((__global int32_t *) global_dynid_mem_55338)[(int64_t) 0] = 0;\n                    }\n                }\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        dynamic_id_55358 = ((__local int32_t *) local_mem_55348)[(int64_t) 0];\n        barrier(CLK_LOCAL_MEM_FENCE);\n        block_offset_55359 = dynamic_id_55358 * chunk_sizze_55329 * segscan_tblock_sizze_47060;\n        sgm_idx_55360 = smod64(block_offset_55359, conc_tmp_43977);\n        boundary_55361 = sext_i64_i32(smin64(chunk_sizze_55329 * segscan_tblock_sizze_47060, conc_tmp_43977 - sgm_idx_55360));\n        segsizze_compact_55362 = sext_i64_i32(smin64(chunk_sizze_55329 * segscan_tblock_sizze_47060, conc_tmp_43977));\n        thd_offset_55365 = block_offset_55359 + sext_i32_i64(local_tid_55341);\n        // Load and map\n        {\n            for (int64_t i_55366 = 0; i_55366 < chunk_sizze_55329; i_55366++) {\n                int64_t virt_tid_55367 = thd_offset_55365 + i_55366 * segscan_tblock_sizze_47060;\n                int64_t slice_55368 = conc_tmp_43977;\n                int64_t gtid_47064 = virt_tid_55367;\n                int64_t remnant_55369 = virt_tid_55367 - gtid_47064;\n                \n                if (slt64(virt_tid_55367, conc_tmp_43977)) {\n                    bool inde",
                                    "x_concat_cmp_49807 = sle64(m_43906, gtid_47064);\n                    int64_t index_concat_branch_49811;\n                    \n                    if (index_concat_cmp_49807) {\n                        int64_t index_concat_i_49808 = sub64(gtid_47064, m_43906);\n                        int64_t index_concat_49809 = ((__global int64_t *) mem_53628)[index_concat_i_49808];\n                        \n                        index_concat_branch_49811 = index_concat_49809;\n                    } else {\n                        int64_t index_concat_49810 = ((__global int64_t *) mem_53610)[gtid_47064];\n                        \n                        index_concat_branch_49811 = index_concat_49810;\n                    }\n                    \n                    bool lifted_lambda_res_44888 = sle64((int64_t) 0, index_concat_branch_49811);\n                    int64_t defunc_0_f_res_44889 = btoi_bool_i64(lifted_lambda_res_44888);\n                    \n                    ((__global int64_t *) mem_53640)[gtid_47064] = defunc_0_f_res_44889;\n                    private_mem_55363[i_55366] = defunc_0_f_res_44889;\n                } else {\n                    private_mem_55363[i_55366] = (int64_t) 0;\n                }\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        // Transpose scan inputs\n        {\n            for (int64_t i_55370 = 0; i_55370 < chunk_sizze_55329; i_55370++) {\n                int64_t sharedIdx_55371 = sext_i32_i64(local_tid_55341) + i_55370 * segscan_tblock_sizze_47060;\n                int64_t tmp_55372 = private_mem_55363[i_55370];\n                \n                ((__local int64_t *) local_mem_55348)[sharedIdx_55371] = tmp_55372;\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            for (int64_t i_55373 = 0; i_55373 < chunk_sizze_55329; i_55373++) {\n                int64_t sharedIdx_55374 = sext_i32_i64(local_tid_55341) * chunk_sizze_55329 + i_55373;\n                int64_t tmp_55375 = ((__local int64_t *) local_mem_55348)[sharedIdx_55374];\n", "                \n                private_mem_55363[i_55373] = tmp_55375;\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n        }\n        // Per thread scan\n        {\n            for (int64_t i_55376 = 0; i_55376 < chunk_sizze_55329 - (int64_t) 1; i_55376++) {\n                int64_t eta_p_44151;\n                int64_t eta_p_44152;\n                \n                eta_p_44151 = private_mem_55363[i_55376];\n                eta_p_44152 = private_mem_55363[i_55376 + (int64_t) 1];\n                \n                int64_t defunc_0_op_res_44153 = add64(eta_p_44151, eta_p_44152);\n                \n                private_mem_55363[i_55376 + (int64_t) 1] = defunc_0_op_res_44153;\n            }\n        }\n        // Publish results in shared memory\n        {\n            int64_t tmp_55377 = private_mem_55363[chunk_sizze_55329 - (int64_t) 1];\n            \n            ((__local int64_t *) local_mem_55348)[sext_i32_i64(local_tid_55341)] = tmp_55377;\n            barrier(CLK_LOCAL_MEM_FENCE);\n        }\n        // Scan results (with warp scan)\n        {\n            int64_t eta_p_55378;\n            int64_t eta_p_55379;\n            int64_t eta_p_55382;\n            int64_t eta_p_55383;\n            bool ltid_in_bounds_55385 = slt64(sext_i32_i64(local_tid_55341), num_virt_threads_55331);\n            int32_t skip_threads_55386;\n            \n            // read input for in-block scan\n            {\n                if (ltid_in_bounds_55385) {\n                    eta_p_55379 = ((volatile __local int64_t *) local_mem_55348)[sext_i32_i64(local_tid_55341)];\n                    if ((local_tid_55341 - squot32(local_tid_55341, 32) * 32) == 0) {\n                        eta_p_55378 = eta_p_55379;\n                    }\n                }\n            }\n            // in-block scan (hopefully no barriers needed)\n            {\n                skip_threads_55386 = 1;\n                while (slt32(skip_threads_55386, 32)) {\n                    bool thread_active_55387 = sle32(skip_threads_55386, loca", "l_tid_55341 - squot32(local_tid_55341, 32) * 32) && ltid_in_bounds_55385;\n                    \n                    if (thread_active_55387) {\n                        // read operands\n                        {\n                            eta_p_55378 = ((volatile __local int64_t *) local_mem_55348)[sext_i32_i64(local_tid_55341) - sext_i32_i64(skip_threads_55386)];\n                        }\n                    }\n                    // perform operation\n                    {\n                        if (thread_active_55387) {\n                            int64_t defunc_0_op_res_55380 = add64(eta_p_55378, eta_p_55379);\n                            \n                            eta_p_55378 = defunc_0_op_res_55380;\n                        }\n                    }\n                    if (sle32(wave_sizze_55343, skip_threads_55386)) {\n                        barrier(CLK_LOCAL_MEM_FENCE);\n                    }\n                    if (thread_active_55387) {\n                        // write result\n                        {\n                            ((volatile __local int64_t *) local_mem_55348)[sext_i32_i64(local_tid_55341)] = eta_p_55378;\n                            eta_p_55379 = eta_p_55378;\n                        }\n                    }\n                    if (sle32(wave_sizze_55343, skip_threads_55386)) {\n                        barrier(CLK_LOCAL_MEM_FENCE);\n                    }\n                    skip_threads_55386 *= 2;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // last thread of block 'i' writes its result to offset 'i'\n            {\n                if ((local_tid_55341 - squot32(local_tid_55341, 32) * 32) == 31 && ltid_in_bounds_55385) {\n                    ((volatile __local int64_t *) local_mem_55348)[sext_i32_i64(squot32(local_tid_55341, 32))] = eta_p_55378;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // scan the first block, after which offset 'i' contains carry-in for block 'i+1'\n ",
                                    "           {\n                int32_t skip_threads_55388;\n                \n                // read input for in-block scan\n                {\n                    if (squot32(local_tid_55341, 32) == 0 && ltid_in_bounds_55385) {\n                        eta_p_55383 = ((volatile __local int64_t *) local_mem_55348)[sext_i32_i64(local_tid_55341)];\n                        if ((local_tid_55341 - squot32(local_tid_55341, 32) * 32) == 0) {\n                            eta_p_55382 = eta_p_55383;\n                        }\n                    }\n                }\n                // in-block scan (hopefully no barriers needed)\n                {\n                    skip_threads_55388 = 1;\n                    while (slt32(skip_threads_55388, 32)) {\n                        bool thread_active_55389 = sle32(skip_threads_55388, local_tid_55341 - squot32(local_tid_55341, 32) * 32) && (squot32(local_tid_55341, 32) == 0 && ltid_in_bounds_55385);\n                        \n                        if (thread_active_55389) {\n                            // read operands\n                            {\n                                eta_p_55382 = ((volatile __local int64_t *) local_mem_55348)[sext_i32_i64(local_tid_55341) - sext_i32_i64(skip_threads_55388)];\n                            }\n                        }\n                        // perform operation\n                        {\n                            if (thread_active_55389) {\n                                int64_t defunc_0_op_res_55384 = add64(eta_p_55382, eta_p_55383);\n                                \n                                eta_p_55382 = defunc_0_op_res_55384;\n                            }\n                        }\n                        if (sle32(wave_sizze_55343, skip_threads_55388)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        if (thread_active_55389) {\n                            // write result\n                            {\n                                ((v", "olatile __local int64_t *) local_mem_55348)[sext_i32_i64(local_tid_55341)] = eta_p_55382;\n                                eta_p_55383 = eta_p_55382;\n                            }\n                        }\n                        if (sle32(wave_sizze_55343, skip_threads_55388)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        skip_threads_55388 *= 2;\n                    }\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            \n            bool no_carry_in_55390 = squot32(local_tid_55341, 32) == 0 || !ltid_in_bounds_55385;\n            \n            // carry-in for every block except the first\n            {\n                // read operands\n                {\n                    if (!no_carry_in_55390) {\n                        eta_p_55379 = eta_p_55378;\n                        eta_p_55378 = ((__local int64_t *) local_mem_55348)[sext_i32_i64(squot32(local_tid_55341, 32)) - (int64_t) 1];\n                    }\n                }\n                // perform operation\n                {\n                    if (!no_carry_in_55390) {\n                        int64_t defunc_0_op_res_55380 = add64(eta_p_55378, eta_p_55379);\n                        \n                        eta_p_55378 = defunc_0_op_res_55380;\n                    }\n                }\n                // write final result\n                {\n                    if (!no_carry_in_55390) {\n                        ((__local int64_t *) local_mem_55348)[sext_i32_i64(local_tid_55341)] = eta_p_55378;\n                    }\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // restore correct values for first block\n            {\n                if (squot32(local_tid_55341, 32) == 0 && ltid_in_bounds_55385) {\n                    ((__local int64_t *) local_mem_55348)[sext_i32_i64(local_tid_55341)] = eta_p_55379;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            barrier(CLK_L", "OCAL_MEM_FENCE);\n            if (local_tid_55341 == 0) {\n                acc_55381 = ((__local int64_t *) local_mem_55348)[segscan_tblock_sizze_47060 - (int64_t) 1];\n            } else {\n                acc_55381 = ((__local int64_t *) local_mem_55348)[sext_i32_i64(local_tid_55341) - (int64_t) 1];\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n        }\n        prefix_55391 = (int64_t) 0;\n        block_new_sgm_55392 = sgm_idx_55360 == (int64_t) 0;\n        // Perform lookback\n        {\n            if (block_new_sgm_55392 && local_tid_55341 == 0) {\n                ((volatile __global int64_t *) incprefixes_mem_55336)[dynamic_id_55358] = acc_55381;\n                mem_fence_global();\n                ((volatile __global int8_t *) status_flags_mem_55332)[dynamic_id_55358] = (int8_t) 2;\n                acc_55381 = (int64_t) 0;\n            }\n            if (!block_new_sgm_55392 && slt32(local_tid_55341, wave_sizze_55343)) {\n                if (local_tid_55341 == 0) {\n                    ((volatile __global int64_t *) aggregates_mem_55334)[dynamic_id_55358] = acc_55381;\n                    mem_fence_global();\n                    ((volatile __global int8_t *) status_flags_mem_55332)[dynamic_id_55358] = (int8_t) 1;\n                    \n                    int8_t tmp_55393 = ((volatile __global int8_t *) status_flags_mem_55332)[dynamic_id_55358 - (int64_t) 1];\n                    \n                    ((volatile __local int8_t *) local_mem_55348)[(int64_t) 0] = tmp_55393;\n                }\n                mem_fence_local();\n                \n                int8_t status_55394 = ((__local int8_t *) local_mem_55348)[(int64_t) 0];\n                \n                if (status_55394 == (int8_t) 2) {\n                    if (local_tid_55341 == 0) {\n                        prefix_55391 = ((volatile __global int64_t *) incprefixes_mem_55336)[dynamic_id_55358 - (int64_t) 1];\n                    }\n                } else {\n                    int32_t readOffset_55395 = sext_i64_i32",
                                    "(dynamic_id_55358 - sext_i32_i64(wave_sizze_55343));\n                    \n                    while (slt32(wave_sizze_55343 * -1, readOffset_55395)) {\n                        int32_t read_i_55396 = readOffset_55395 + local_tid_55341;\n                        int64_t aggr_55397 = (int64_t) 0;\n                        int8_t flag_55398 = (int8_t) 0;\n                        \n                        if (sle32(0, read_i_55396)) {\n                            flag_55398 = ((volatile __global int8_t *) status_flags_mem_55332)[sext_i32_i64(read_i_55396)];\n                            if (flag_55398 == (int8_t) 2) {\n                                aggr_55397 = ((volatile __global int64_t *) incprefixes_mem_55336)[sext_i32_i64(read_i_55396)];\n                            } else if (flag_55398 == (int8_t) 1) {\n                                aggr_55397 = ((volatile __global int64_t *) aggregates_mem_55334)[sext_i32_i64(read_i_55396)];\n                            }\n                        }\n                        ((__local int64_t *) local_mem_55348)[(int64_t) 4 + sext_i32_i64(local_tid_55341)] = aggr_55397;\n                        ((__local int8_t *) local_mem_55348)[sext_i32_i64(local_tid_55341)] = flag_55398;\n                        flag_55398 = ((__local int8_t *) local_mem_55348)[sext_i32_i64(wave_sizze_55343) - (int64_t) 1];\n                        if (slt8(flag_55398, (int8_t) 2)) {\n                            int8_t flg_x_55402;\n                            int8_t flg_y_55403;\n                            int64_t eta_p_55399;\n                            int64_t eta_p_55400;\n                            int32_t skip_threads_55404;\n                            \n                            // read input for in-block scan\n                            {\n                                flg_y_55403 = ((volatile __local int8_t *) local_mem_55348)[sext_i32_i64(local_tid_55341)];\n                                eta_p_55400 = ((volatile __local int64_t *) local_mem_55348)[(int64_t) 4 + sex", "t_i32_i64(local_tid_55341)];\n                                if ((local_tid_55341 - squot32(local_tid_55341, 32) * 32) == 0) {\n                                    eta_p_55399 = eta_p_55400;\n                                    flg_x_55402 = flg_y_55403;\n                                }\n                            }\n                            // in-block scan (hopefully no barriers needed)\n                            {\n                                skip_threads_55404 = 1;\n                                while (slt32(skip_threads_55404, 32)) {\n                                    if (sle32(skip_threads_55404, local_tid_55341 - squot32(local_tid_55341, 32) * 32)) {\n                                        // read operands\n                                        {\n                                            flg_x_55402 = ((volatile __local int8_t *) local_mem_55348)[sext_i32_i64(local_tid_55341) - sext_i32_i64(skip_threads_55404)];\n                                            eta_p_55399 = ((volatile __local int64_t *) local_mem_55348)[(int64_t) 4 + (sext_i32_i64(local_tid_55341) - sext_i32_i64(skip_threads_55404))];\n                                        }\n                                        // perform operation\n                                        {\n                                            if (flg_y_55403 == (int8_t) 2 || flg_y_55403 == (int8_t) 0) {\n                                                flg_x_55402 = flg_y_55403;\n                                                eta_p_55399 = eta_p_55400;\n                                            } else {\n                                                int64_t defunc_0_op_res_55401 = add64(eta_p_55399, eta_p_55400);\n                                                \n                                                eta_p_55399 = defunc_0_op_res_55401;\n                                            }\n                                        }\n                                        // write result\n                        ", "                {\n                                            ((volatile __local int8_t *) local_mem_55348)[sext_i32_i64(local_tid_55341)] = flg_x_55402;\n                                            flg_y_55403 = flg_x_55402;\n                                            ((volatile __local int64_t *) local_mem_55348)[(int64_t) 4 + sext_i32_i64(local_tid_55341)] = eta_p_55399;\n                                            eta_p_55400 = eta_p_55399;\n                                        }\n                                    }\n                                    skip_threads_55404 *= 2;\n                                }\n                            }\n                        }\n                        flag_55398 = ((__local int8_t *) local_mem_55348)[sext_i32_i64(wave_sizze_55343) - (int64_t) 1];\n                        aggr_55397 = ((__local int64_t *) local_mem_55348)[(int64_t) 4 + (sext_i32_i64(wave_sizze_55343) - (int64_t) 1)];\n                        if (flag_55398 == (int8_t) 2) {\n                            readOffset_55395 = wave_sizze_55343 * -1;\n                        } else if (flag_55398 == (int8_t) 1) {\n                            readOffset_55395 -= wave_sizze_55343;\n                        }\n                        if (slt8((int8_t) 0, flag_55398)) {\n                            int64_t eta_p_55405 = aggr_55397;\n                            int64_t eta_p_55406 = prefix_55391;\n                            int64_t defunc_0_op_res_55407 = add64(eta_p_55405, eta_p_55406);\n                            \n                            prefix_55391 = defunc_0_op_res_55407;\n                        }\n                        mem_fence_local();\n                    }\n                }\n                if (local_tid_55341 == 0) {\n                    if (boundary_55361 == sext_i64_i32(segscan_tblock_sizze_47060 * chunk_sizze_55329)) {\n                        int64_t eta_p_55408 = prefix_55391;\n                        int64_t eta_p_55409 = acc_55381;\n                        int64_t ",
                                    "defunc_0_op_res_55410 = add64(eta_p_55408, eta_p_55409);\n                        \n                        ((volatile __global int64_t *) incprefixes_mem_55336)[dynamic_id_55358] = defunc_0_op_res_55410;\n                        mem_fence_global();\n                        ((volatile __global int8_t *) status_flags_mem_55332)[dynamic_id_55358] = (int8_t) 2;\n                    }\n                    ((__local int64_t *) local_mem_55348)[(int64_t) 4] = prefix_55391;\n                    acc_55381 = (int64_t) 0;\n                }\n            }\n            if (!(dynamic_id_55358 == (int64_t) 0)) {\n                barrier(CLK_LOCAL_MEM_FENCE);\n                prefix_55391 = ((__local int64_t *) local_mem_55348)[(int64_t) 4];\n                barrier(CLK_LOCAL_MEM_FENCE);\n            }\n        }\n        // Distribute results\n        {\n            int64_t eta_p_55411;\n            int64_t eta_p_55412;\n            int64_t eta_p_55414 = prefix_55391;\n            int64_t eta_p_55415 = acc_55381;\n            \n            if (slt32(local_tid_55341 * chunk_sizze_32b_55345, boundary_55361) && !block_new_sgm_55392) {\n                int64_t defunc_0_op_res_55416 = add64(eta_p_55414, eta_p_55415);\n                \n                eta_p_55411 = defunc_0_op_res_55416;\n            } else {\n                eta_p_55411 = acc_55381;\n            }\n            \n            int32_t stopping_point_55417 = segsizze_compact_55362 - srem32(local_tid_55341 * chunk_sizze_32b_55345 - 1 + segsizze_compact_55362 - boundary_55361, segsizze_compact_55362);\n            \n            for (int64_t i_55418 = 0; i_55418 < chunk_sizze_55329; i_55418++) {\n                if (slt32(sext_i64_i32(i_55418), stopping_point_55417 - 1)) {\n                    eta_p_55412 = private_mem_55363[i_55418];\n                    \n                    int64_t defunc_0_op_res_55413 = add64(eta_p_55411, eta_p_55412);\n                    \n                    private_mem_55363[i_55418] = defunc_0_op_res_55413;\n                }\n         ", "   }\n        }\n        // Transpose scan output and Write it to global memory in coalesced fashion\n        {\n            for (int64_t i_55419 = 0; i_55419 < chunk_sizze_55329; i_55419++) {\n                int64_t sharedIdx_55420 = sext_i32_i64(local_tid_55341) * chunk_sizze_55329 + i_55419;\n                int64_t tmp_55421 = private_mem_55363[i_55419];\n                \n                ((__local int64_t *) local_mem_55348)[sharedIdx_55420] = tmp_55421;\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            for (int64_t i_55422 = 0; i_55422 < chunk_sizze_55329; i_55422++) {\n                int64_t flat_idx_55423 = thd_offset_55365 + i_55422 * segscan_tblock_sizze_47060;\n                int64_t slice_55424 = conc_tmp_43977;\n                int64_t gtid_47064 = flat_idx_55423;\n                int64_t remnant_55425 = flat_idx_55423 - gtid_47064;\n                \n                if (slt64(flat_idx_55423, conc_tmp_43977)) {\n                    int64_t tmp_55426 = ((__local int64_t *) local_mem_55348)[flat_idx_55423 - block_offset_55359];\n                    \n                    ((__global int64_t *) mem_53638)[gtid_47064] = tmp_55426;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n        }\n    }\n    \n  error_3:\n    return;\n    #undef segscan_tblock_sizze_47060\n    #undef chunk_sizze_55329\n}\nFUTHARK_KERNEL_SIZED(do_DBSCAN_doublezisegscan_47325_dim1, 1, 1)\nvoid do_DBSCAN_doublezisegscan_47325(__global int *global_failure, int64_t conc_tmp_43977, int64_t num_tblocks_47322, int64_t num_virt_blocks_55573, int64_t num_virt_threads_55574, __global unsigned char *ext_mem_53727, __global unsigned char *mem_53730, __global unsigned char *status_flags_mem_55575, __global unsigned char *aggregates_mem_55577, __global unsigned char *incprefixes_mem_55579, __global unsigned char *global_dynid_mem_55581)\n{\n    #define segscan_tblock_sizze_47320 (do_DBSCAN_doublezisegscan_47325zisegscan_tblock_sizze_47320)\n    #define chunk_sizze_55572 (do_DBSCAN_", "doublezisegscan_47325zichunk_sizze_55572)\n    \n    volatile __local unsigned char *local_mem_55591_backing_0 = &shared_mem[0];\n    const int64_t local_mem_55591_backing_0_offset = 0 + (smax64(smax64((int64_t) 288, (int64_t) 8 * segscan_tblock_sizze_47320), chunk_sizze_55572 * segscan_tblock_sizze_47320 * (int64_t) 8) + srem64((int64_t) 8 - srem64(smax64(smax64((int64_t) 288, (int64_t) 8 * segscan_tblock_sizze_47320), chunk_sizze_55572 * segscan_tblock_sizze_47320 * (int64_t) 8), (int64_t) 8), (int64_t) 8));\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_55584;\n    int32_t tblock_sizze_55587;\n    int32_t wave_sizze_55586;\n    int32_t block_id_55585;\n    int32_t global_tid_55583;\n    int64_t phys_tid_47325;\n    int32_t chunk_sizze_32b_55588;\n    int64_t byte_offsets_55589;\n    int64_t warp_byte_offset_55590;\n    __local unsigned char *local_mem_55591;\n    int64_t trans_arr_len_55592;\n    int64_t phys_block_id_55598;\n    int64_t virtloop_bound_55599;\n    \n    local_tid_55584 = get_local_id(0);\n    tblock_sizze_55587 = get_local_size(0);\n    wave_sizze_55586 = LOCKSTEP_WIDTH;\n    block_id_55585 = get_tblock_id(0);\n    global_tid_55583 = block_id_55585 * tblock_sizze_55587 + local_tid_55584;\n    phys_tid_47325 = sext_i32_i64(global_tid_55583);\n    chunk_sizze_32b_55588 = sext_i64_i32(chunk_sizze_55572);\n    byte_offsets_55589 = segscan_tblock_sizze_47320 * (int64_t) 8;\n    warp_byte_offset_55590 = (int64_t) 288;\n    // Allocate reusable shared memory\n    { }\n    local_mem_55591 = (__local unsigned char *) local_mem_55591_backing_0;\n    trans_arr_len_55592 = chunk_sizze_55572 * segscan_tblock_sizze_47320;\n    phys_block_id_55598 = get_tblock_id(0);\n    virtloop_bound_55599 = sdiv_up64(num_virt_blocks_55573 - phys_block_id_55598, num_tblocks_47322);\n    for (int64_t virtloop_i_55600 = 0; virtloop_i_55600 < virtloop_bound_55599; virtloop_i_55600++) {\n        int64_t dynamic_id_55601;\n        int64_t block_offset_55602;\n        int64_t sgm_idx_",
                                    "55603;\n        int32_t boundary_55604;\n        int32_t segsizze_compact_55605;\n        int64_t private_mem_55606[chunk_sizze_55572];\n        int64_t thd_offset_55608;\n        int64_t acc_55624;\n        int64_t prefix_55634;\n        bool block_new_sgm_55635;\n        \n        // First thread in block fetches this block's dynamic_id\n        {\n            if (local_tid_55584 == 0) {\n                dynamic_id_55601 = atomic_add_i32_global(&((volatile __global int *) global_dynid_mem_55581)[(int64_t) 0], (int) 1);\n                // Set dynamic id for this block\n                {\n                    ((__local int64_t *) local_mem_55591)[(int64_t) 0] = dynamic_id_55601;\n                }\n                // First thread in last (virtual) block resets global dynamic_id\n                {\n                    if (dynamic_id_55601 == num_virt_blocks_55573 - (int64_t) 1) {\n                        ((__global int32_t *) global_dynid_mem_55581)[(int64_t) 0] = 0;\n                    }\n                }\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        dynamic_id_55601 = ((__local int32_t *) local_mem_55591)[(int64_t) 0];\n        barrier(CLK_LOCAL_MEM_FENCE);\n        block_offset_55602 = dynamic_id_55601 * chunk_sizze_55572 * segscan_tblock_sizze_47320;\n        sgm_idx_55603 = smod64(block_offset_55602, conc_tmp_43977);\n        boundary_55604 = sext_i64_i32(smin64(chunk_sizze_55572 * segscan_tblock_sizze_47320, conc_tmp_43977 - sgm_idx_55603));\n        segsizze_compact_55605 = sext_i64_i32(smin64(chunk_sizze_55572 * segscan_tblock_sizze_47320, conc_tmp_43977));\n        thd_offset_55608 = block_offset_55602 + sext_i32_i64(local_tid_55584);\n        // Load and map\n        {\n            for (int64_t i_55609 = 0; i_55609 < chunk_sizze_55572; i_55609++) {\n                int64_t virt_tid_55610 = thd_offset_55608 + i_55609 * segscan_tblock_sizze_47320;\n                int64_t slice_55611 = conc_tmp_43977;\n                int64_t gtid_47324 = virt_tid_55610;\n            ", "    int64_t remnant_55612 = virt_tid_55610 - gtid_47324;\n                \n                if (slt64(virt_tid_55610, conc_tmp_43977)) {\n                    int64_t eta_p_44906 = ((__global int64_t *) ext_mem_53727)[gtid_47324];\n                    bool defunc_0_f_res_44907 = gtid_47324 == eta_p_44906;\n                    int64_t lifted_lambda_res_44909 = btoi_bool_i64(defunc_0_f_res_44907);\n                    \n                    private_mem_55606[i_55609] = lifted_lambda_res_44909;\n                } else {\n                    private_mem_55606[i_55609] = (int64_t) 0;\n                }\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        // Transpose scan inputs\n        {\n            for (int64_t i_55613 = 0; i_55613 < chunk_sizze_55572; i_55613++) {\n                int64_t sharedIdx_55614 = sext_i32_i64(local_tid_55584) + i_55613 * segscan_tblock_sizze_47320;\n                int64_t tmp_55615 = private_mem_55606[i_55613];\n                \n                ((__local int64_t *) local_mem_55591)[sharedIdx_55614] = tmp_55615;\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            for (int64_t i_55616 = 0; i_55616 < chunk_sizze_55572; i_55616++) {\n                int64_t sharedIdx_55617 = sext_i32_i64(local_tid_55584) * chunk_sizze_55572 + i_55616;\n                int64_t tmp_55618 = ((__local int64_t *) local_mem_55591)[sharedIdx_55617];\n                \n                private_mem_55606[i_55616] = tmp_55618;\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n        }\n        // Per thread scan\n        {\n            for (int64_t i_55619 = 0; i_55619 < chunk_sizze_55572 - (int64_t) 1; i_55619++) {\n                int64_t eta_p_44099;\n                int64_t eta_p_44100;\n                \n                eta_p_44099 = private_mem_55606[i_55619];\n                eta_p_44100 = private_mem_55606[i_55619 + (int64_t) 1];\n                \n                int64_t defunc_0_op_res_44101 = add64(eta_p_44099, eta_p_44100);\n                \n        ", "        private_mem_55606[i_55619 + (int64_t) 1] = defunc_0_op_res_44101;\n            }\n        }\n        // Publish results in shared memory\n        {\n            int64_t tmp_55620 = private_mem_55606[chunk_sizze_55572 - (int64_t) 1];\n            \n            ((__local int64_t *) local_mem_55591)[sext_i32_i64(local_tid_55584)] = tmp_55620;\n            barrier(CLK_LOCAL_MEM_FENCE);\n        }\n        // Scan results (with warp scan)\n        {\n            int64_t eta_p_55621;\n            int64_t eta_p_55622;\n            int64_t eta_p_55625;\n            int64_t eta_p_55626;\n            bool ltid_in_bounds_55628 = slt64(sext_i32_i64(local_tid_55584), num_virt_threads_55574);\n            int32_t skip_threads_55629;\n            \n            // read input for in-block scan\n            {\n                if (ltid_in_bounds_55628) {\n                    eta_p_55622 = ((volatile __local int64_t *) local_mem_55591)[sext_i32_i64(local_tid_55584)];\n                    if ((local_tid_55584 - squot32(local_tid_55584, 32) * 32) == 0) {\n                        eta_p_55621 = eta_p_55622;\n                    }\n                }\n            }\n            // in-block scan (hopefully no barriers needed)\n            {\n                skip_threads_55629 = 1;\n                while (slt32(skip_threads_55629, 32)) {\n                    bool thread_active_55630 = sle32(skip_threads_55629, local_tid_55584 - squot32(local_tid_55584, 32) * 32) && ltid_in_bounds_55628;\n                    \n                    if (thread_active_55630) {\n                        // read operands\n                        {\n                            eta_p_55621 = ((volatile __local int64_t *) local_mem_55591)[sext_i32_i64(local_tid_55584) - sext_i32_i64(skip_threads_55629)];\n                        }\n                    }\n                    // perform operation\n                    {\n                        if (thread_active_55630) {\n                            int64_t defunc_0_op_res_55623 = add64(eta_p_55621, eta_p_55",
                                    "622);\n                            \n                            eta_p_55621 = defunc_0_op_res_55623;\n                        }\n                    }\n                    if (sle32(wave_sizze_55586, skip_threads_55629)) {\n                        barrier(CLK_LOCAL_MEM_FENCE);\n                    }\n                    if (thread_active_55630) {\n                        // write result\n                        {\n                            ((volatile __local int64_t *) local_mem_55591)[sext_i32_i64(local_tid_55584)] = eta_p_55621;\n                            eta_p_55622 = eta_p_55621;\n                        }\n                    }\n                    if (sle32(wave_sizze_55586, skip_threads_55629)) {\n                        barrier(CLK_LOCAL_MEM_FENCE);\n                    }\n                    skip_threads_55629 *= 2;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // last thread of block 'i' writes its result to offset 'i'\n            {\n                if ((local_tid_55584 - squot32(local_tid_55584, 32) * 32) == 31 && ltid_in_bounds_55628) {\n                    ((volatile __local int64_t *) local_mem_55591)[sext_i32_i64(squot32(local_tid_55584, 32))] = eta_p_55621;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // scan the first block, after which offset 'i' contains carry-in for block 'i+1'\n            {\n                int32_t skip_threads_55631;\n                \n                // read input for in-block scan\n                {\n                    if (squot32(local_tid_55584, 32) == 0 && ltid_in_bounds_55628) {\n                        eta_p_55626 = ((volatile __local int64_t *) local_mem_55591)[sext_i32_i64(local_tid_55584)];\n                        if ((local_tid_55584 - squot32(local_tid_55584, 32) * 32) == 0) {\n                            eta_p_55625 = eta_p_55626;\n                        }\n                    }\n                }\n                // in-block scan (hopefully no barriers neede", "d)\n                {\n                    skip_threads_55631 = 1;\n                    while (slt32(skip_threads_55631, 32)) {\n                        bool thread_active_55632 = sle32(skip_threads_55631, local_tid_55584 - squot32(local_tid_55584, 32) * 32) && (squot32(local_tid_55584, 32) == 0 && ltid_in_bounds_55628);\n                        \n                        if (thread_active_55632) {\n                            // read operands\n                            {\n                                eta_p_55625 = ((volatile __local int64_t *) local_mem_55591)[sext_i32_i64(local_tid_55584) - sext_i32_i64(skip_threads_55631)];\n                            }\n                        }\n                        // perform operation\n                        {\n                            if (thread_active_55632) {\n                                int64_t defunc_0_op_res_55627 = add64(eta_p_55625, eta_p_55626);\n                                \n                                eta_p_55625 = defunc_0_op_res_55627;\n                            }\n                        }\n                        if (sle32(wave_sizze_55586, skip_threads_55631)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        if (thread_active_55632) {\n                            // write result\n                            {\n                                ((volatile __local int64_t *) local_mem_55591)[sext_i32_i64(local_tid_55584)] = eta_p_55625;\n                                eta_p_55626 = eta_p_55625;\n                            }\n                        }\n                        if (sle32(wave_sizze_55586, skip_threads_55631)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        skip_threads_55631 *= 2;\n                    }\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            \n            bool no_carry_in_55633 = squot32(local_tid_55584, 32) == 0 || !ltid_in_bounds_55", "628;\n            \n            // carry-in for every block except the first\n            {\n                // read operands\n                {\n                    if (!no_carry_in_55633) {\n                        eta_p_55622 = eta_p_55621;\n                        eta_p_55621 = ((__local int64_t *) local_mem_55591)[sext_i32_i64(squot32(local_tid_55584, 32)) - (int64_t) 1];\n                    }\n                }\n                // perform operation\n                {\n                    if (!no_carry_in_55633) {\n                        int64_t defunc_0_op_res_55623 = add64(eta_p_55621, eta_p_55622);\n                        \n                        eta_p_55621 = defunc_0_op_res_55623;\n                    }\n                }\n                // write final result\n                {\n                    if (!no_carry_in_55633) {\n                        ((__local int64_t *) local_mem_55591)[sext_i32_i64(local_tid_55584)] = eta_p_55621;\n                    }\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // restore correct values for first block\n            {\n                if (squot32(local_tid_55584, 32) == 0 && ltid_in_bounds_55628) {\n                    ((__local int64_t *) local_mem_55591)[sext_i32_i64(local_tid_55584)] = eta_p_55622;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            barrier(CLK_LOCAL_MEM_FENCE);\n            if (local_tid_55584 == 0) {\n                acc_55624 = ((__local int64_t *) local_mem_55591)[segscan_tblock_sizze_47320 - (int64_t) 1];\n            } else {\n                acc_55624 = ((__local int64_t *) local_mem_55591)[sext_i32_i64(local_tid_55584) - (int64_t) 1];\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n        }\n        prefix_55634 = (int64_t) 0;\n        block_new_sgm_55635 = sgm_idx_55603 == (int64_t) 0;\n        // Perform lookback\n        {\n            if (block_new_sgm_55635 && local_tid_55584 == 0) {\n                ((volatile __global int64_t *) incpr",
                                    "efixes_mem_55579)[dynamic_id_55601] = acc_55624;\n                mem_fence_global();\n                ((volatile __global int8_t *) status_flags_mem_55575)[dynamic_id_55601] = (int8_t) 2;\n                acc_55624 = (int64_t) 0;\n            }\n            if (!block_new_sgm_55635 && slt32(local_tid_55584, wave_sizze_55586)) {\n                if (local_tid_55584 == 0) {\n                    ((volatile __global int64_t *) aggregates_mem_55577)[dynamic_id_55601] = acc_55624;\n                    mem_fence_global();\n                    ((volatile __global int8_t *) status_flags_mem_55575)[dynamic_id_55601] = (int8_t) 1;\n                    \n                    int8_t tmp_55636 = ((volatile __global int8_t *) status_flags_mem_55575)[dynamic_id_55601 - (int64_t) 1];\n                    \n                    ((volatile __local int8_t *) local_mem_55591)[(int64_t) 0] = tmp_55636;\n                }\n                mem_fence_local();\n                \n                int8_t status_55637 = ((__local int8_t *) local_mem_55591)[(int64_t) 0];\n                \n                if (status_55637 == (int8_t) 2) {\n                    if (local_tid_55584 == 0) {\n                        prefix_55634 = ((volatile __global int64_t *) incprefixes_mem_55579)[dynamic_id_55601 - (int64_t) 1];\n                    }\n                } else {\n                    int32_t readOffset_55638 = sext_i64_i32(dynamic_id_55601 - sext_i32_i64(wave_sizze_55586));\n                    \n                    while (slt32(wave_sizze_55586 * -1, readOffset_55638)) {\n                        int32_t read_i_55639 = readOffset_55638 + local_tid_55584;\n                        int64_t aggr_55640 = (int64_t) 0;\n                        int8_t flag_55641 = (int8_t) 0;\n                        \n                        if (sle32(0, read_i_55639)) {\n                            flag_55641 = ((volatile __global int8_t *) status_flags_mem_55575)[sext_i32_i64(read_i_55639)];\n                            if (flag_55641 == (int8_t) 2) {\n   ", "                             aggr_55640 = ((volatile __global int64_t *) incprefixes_mem_55579)[sext_i32_i64(read_i_55639)];\n                            } else if (flag_55641 == (int8_t) 1) {\n                                aggr_55640 = ((volatile __global int64_t *) aggregates_mem_55577)[sext_i32_i64(read_i_55639)];\n                            }\n                        }\n                        ((__local int64_t *) local_mem_55591)[(int64_t) 4 + sext_i32_i64(local_tid_55584)] = aggr_55640;\n                        ((__local int8_t *) local_mem_55591)[sext_i32_i64(local_tid_55584)] = flag_55641;\n                        flag_55641 = ((__local int8_t *) local_mem_55591)[sext_i32_i64(wave_sizze_55586) - (int64_t) 1];\n                        if (slt8(flag_55641, (int8_t) 2)) {\n                            int8_t flg_x_55645;\n                            int8_t flg_y_55646;\n                            int64_t eta_p_55642;\n                            int64_t eta_p_55643;\n                            int32_t skip_threads_55647;\n                            \n                            // read input for in-block scan\n                            {\n                                flg_y_55646 = ((volatile __local int8_t *) local_mem_55591)[sext_i32_i64(local_tid_55584)];\n                                eta_p_55643 = ((volatile __local int64_t *) local_mem_55591)[(int64_t) 4 + sext_i32_i64(local_tid_55584)];\n                                if ((local_tid_55584 - squot32(local_tid_55584, 32) * 32) == 0) {\n                                    eta_p_55642 = eta_p_55643;\n                                    flg_x_55645 = flg_y_55646;\n                                }\n                            }\n                            // in-block scan (hopefully no barriers needed)\n                            {\n                                skip_threads_55647 = 1;\n                                while (slt32(skip_threads_55647, 32)) {\n                                    if (sle32(skip_threads_5564", "7, local_tid_55584 - squot32(local_tid_55584, 32) * 32)) {\n                                        // read operands\n                                        {\n                                            flg_x_55645 = ((volatile __local int8_t *) local_mem_55591)[sext_i32_i64(local_tid_55584) - sext_i32_i64(skip_threads_55647)];\n                                            eta_p_55642 = ((volatile __local int64_t *) local_mem_55591)[(int64_t) 4 + (sext_i32_i64(local_tid_55584) - sext_i32_i64(skip_threads_55647))];\n                                        }\n                                        // perform operation\n                                        {\n                                            if (flg_y_55646 == (int8_t) 2 || flg_y_55646 == (int8_t) 0) {\n                                                flg_x_55645 = flg_y_55646;\n                                                eta_p_55642 = eta_p_55643;\n                                            } else {\n                                                int64_t defunc_0_op_res_55644 = add64(eta_p_55642, eta_p_55643);\n                                                \n                                                eta_p_55642 = defunc_0_op_res_55644;\n                                            }\n                                        }\n                                        // write result\n                                        {\n                                            ((volatile __local int8_t *) local_mem_55591)[sext_i32_i64(local_tid_55584)] = flg_x_55645;\n                                            flg_y_55646 = flg_x_55645;\n                                            ((volatile __local int64_t *) local_mem_55591)[(int64_t) 4 + sext_i32_i64(local_tid_55584)] = eta_p_55642;\n                                            eta_p_55643 = eta_p_55642;\n                                        }\n                                    }\n                                    skip_threads_55647 *= 2;\n                          ",
                                    "      }\n                            }\n                        }\n                        flag_55641 = ((__local int8_t *) local_mem_55591)[sext_i32_i64(wave_sizze_55586) - (int64_t) 1];\n                        aggr_55640 = ((__local int64_t *) local_mem_55591)[(int64_t) 4 + (sext_i32_i64(wave_sizze_55586) - (int64_t) 1)];\n                        if (flag_55641 == (int8_t) 2) {\n                            readOffset_55638 = wave_sizze_55586 * -1;\n                        } else if (flag_55641 == (int8_t) 1) {\n                            readOffset_55638 -= wave_sizze_55586;\n                        }\n                        if (slt8((int8_t) 0, flag_55641)) {\n                            int64_t eta_p_55648 = aggr_55640;\n                            int64_t eta_p_55649 = prefix_55634;\n                            int64_t defunc_0_op_res_55650 = add64(eta_p_55648, eta_p_55649);\n                            \n                            prefix_55634 = defunc_0_op_res_55650;\n                        }\n                        mem_fence_local();\n                    }\n                }\n                if (local_tid_55584 == 0) {\n                    if (boundary_55604 == sext_i64_i32(segscan_tblock_sizze_47320 * chunk_sizze_55572)) {\n                        int64_t eta_p_55651 = prefix_55634;\n                        int64_t eta_p_55652 = acc_55624;\n                        int64_t defunc_0_op_res_55653 = add64(eta_p_55651, eta_p_55652);\n                        \n                        ((volatile __global int64_t *) incprefixes_mem_55579)[dynamic_id_55601] = defunc_0_op_res_55653;\n                        mem_fence_global();\n                        ((volatile __global int8_t *) status_flags_mem_55575)[dynamic_id_55601] = (int8_t) 2;\n                    }\n                    ((__local int64_t *) local_mem_55591)[(int64_t) 4] = prefix_55634;\n                    acc_55624 = (int64_t) 0;\n                }\n            }\n            if (!(dynamic_id_55601 == (int64_t) 0)) {\n                b", "arrier(CLK_LOCAL_MEM_FENCE);\n                prefix_55634 = ((__local int64_t *) local_mem_55591)[(int64_t) 4];\n                barrier(CLK_LOCAL_MEM_FENCE);\n            }\n        }\n        // Distribute results\n        {\n            int64_t eta_p_55654;\n            int64_t eta_p_55655;\n            int64_t eta_p_55657 = prefix_55634;\n            int64_t eta_p_55658 = acc_55624;\n            \n            if (slt32(local_tid_55584 * chunk_sizze_32b_55588, boundary_55604) && !block_new_sgm_55635) {\n                int64_t defunc_0_op_res_55659 = add64(eta_p_55657, eta_p_55658);\n                \n                eta_p_55654 = defunc_0_op_res_55659;\n            } else {\n                eta_p_55654 = acc_55624;\n            }\n            \n            int32_t stopping_point_55660 = segsizze_compact_55605 - srem32(local_tid_55584 * chunk_sizze_32b_55588 - 1 + segsizze_compact_55605 - boundary_55604, segsizze_compact_55605);\n            \n            for (int64_t i_55661 = 0; i_55661 < chunk_sizze_55572; i_55661++) {\n                if (slt32(sext_i64_i32(i_55661), stopping_point_55660 - 1)) {\n                    eta_p_55655 = private_mem_55606[i_55661];\n                    \n                    int64_t defunc_0_op_res_55656 = add64(eta_p_55654, eta_p_55655);\n                    \n                    private_mem_55606[i_55661] = defunc_0_op_res_55656;\n                }\n            }\n        }\n        // Transpose scan output and Write it to global memory in coalesced fashion\n        {\n            for (int64_t i_55662 = 0; i_55662 < chunk_sizze_55572; i_55662++) {\n                int64_t sharedIdx_55663 = sext_i32_i64(local_tid_55584) * chunk_sizze_55572 + i_55662;\n                int64_t tmp_55664 = private_mem_55606[i_55662];\n                \n                ((__local int64_t *) local_mem_55591)[sharedIdx_55663] = tmp_55664;\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            for (int64_t i_55665 = 0; i_55665 < chunk_sizze_55572; i_55665++) {\n                int64", "_t flat_idx_55666 = thd_offset_55608 + i_55665 * segscan_tblock_sizze_47320;\n                int64_t slice_55667 = conc_tmp_43977;\n                int64_t gtid_47324 = flat_idx_55666;\n                int64_t remnant_55668 = flat_idx_55666 - gtid_47324;\n                \n                if (slt64(flat_idx_55666, conc_tmp_43977)) {\n                    int64_t tmp_55669 = ((__local int64_t *) local_mem_55591)[flat_idx_55666 - block_offset_55602];\n                    \n                    ((__global int64_t *) mem_53730)[gtid_47324] = tmp_55669;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n        }\n    }\n    \n  error_3:\n    return;\n    #undef segscan_tblock_sizze_47320\n    #undef chunk_sizze_55572\n}\nFUTHARK_KERNEL_SIZED(do_DBSCAN_doublezisegscan_47812_dim1, 1, 1)\nvoid do_DBSCAN_doublezisegscan_47812(__global int *global_failure, int64_t m_44164, int64_t num_tblocks_47808, int64_t num_virt_blocks_55876, int64_t num_virt_threads_55877, __global unsigned char *ext_mem_53873, __global unsigned char *mem_53878, __global unsigned char *status_flags_mem_55878, __global unsigned char *aggregates_mem_55880, __global unsigned char *incprefixes_mem_55882, __global unsigned char *global_dynid_mem_55884)\n{\n    #define segscan_tblock_sizze_47807 (do_DBSCAN_doublezisegscan_47812zisegscan_tblock_sizze_47807)\n    #define chunk_sizze_55875 (do_DBSCAN_doublezisegscan_47812zichunk_sizze_55875)\n    \n    volatile __local unsigned char *local_mem_55894_backing_0 = &shared_mem[0];\n    const int64_t local_mem_55894_backing_0_offset = 0 + (smax64(smax64((int64_t) 288, (int64_t) 8 * segscan_tblock_sizze_47807), chunk_sizze_55875 * segscan_tblock_sizze_47807 * (int64_t) 8) + srem64((int64_t) 8 - srem64(smax64(smax64((int64_t) 288, (int64_t) 8 * segscan_tblock_sizze_47807), chunk_sizze_55875 * segscan_tblock_sizze_47807 * (int64_t) 8), (int64_t) 8), (int64_t) 8));\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_55887;\n    int32_t tblock_sizz",
                                    "e_55890;\n    int32_t wave_sizze_55889;\n    int32_t block_id_55888;\n    int32_t global_tid_55886;\n    int64_t phys_tid_47812;\n    int32_t chunk_sizze_32b_55891;\n    int64_t byte_offsets_55892;\n    int64_t warp_byte_offset_55893;\n    __local unsigned char *local_mem_55894;\n    int64_t trans_arr_len_55895;\n    int64_t phys_block_id_55901;\n    int64_t virtloop_bound_55902;\n    \n    local_tid_55887 = get_local_id(0);\n    tblock_sizze_55890 = get_local_size(0);\n    wave_sizze_55889 = LOCKSTEP_WIDTH;\n    block_id_55888 = get_tblock_id(0);\n    global_tid_55886 = block_id_55888 * tblock_sizze_55890 + local_tid_55887;\n    phys_tid_47812 = sext_i32_i64(global_tid_55886);\n    chunk_sizze_32b_55891 = sext_i64_i32(chunk_sizze_55875);\n    byte_offsets_55892 = segscan_tblock_sizze_47807 * (int64_t) 8;\n    warp_byte_offset_55893 = (int64_t) 288;\n    // Allocate reusable shared memory\n    { }\n    local_mem_55894 = (__local unsigned char *) local_mem_55894_backing_0;\n    trans_arr_len_55895 = chunk_sizze_55875 * segscan_tblock_sizze_47807;\n    phys_block_id_55901 = get_tblock_id(0);\n    virtloop_bound_55902 = sdiv_up64(num_virt_blocks_55876 - phys_block_id_55901, num_tblocks_47808);\n    for (int64_t virtloop_i_55903 = 0; virtloop_i_55903 < virtloop_bound_55902; virtloop_i_55903++) {\n        int64_t dynamic_id_55904;\n        int64_t block_offset_55905;\n        int64_t sgm_idx_55906;\n        int32_t boundary_55907;\n        int32_t segsizze_compact_55908;\n        int64_t private_mem_55909[chunk_sizze_55875];\n        int64_t thd_offset_55911;\n        int64_t acc_55927;\n        int64_t prefix_55937;\n        bool block_new_sgm_55938;\n        \n        // First thread in block fetches this block's dynamic_id\n        {\n            if (local_tid_55887 == 0) {\n                dynamic_id_55904 = atomic_add_i32_global(&((volatile __global int *) global_dynid_mem_55884)[(int64_t) 0], (int) 1);\n                // Set dynamic id for this block\n                {\n                    ((__local int64_t *", ") local_mem_55894)[(int64_t) 0] = dynamic_id_55904;\n                }\n                // First thread in last (virtual) block resets global dynamic_id\n                {\n                    if (dynamic_id_55904 == num_virt_blocks_55876 - (int64_t) 1) {\n                        ((__global int32_t *) global_dynid_mem_55884)[(int64_t) 0] = 0;\n                    }\n                }\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        dynamic_id_55904 = ((__local int32_t *) local_mem_55894)[(int64_t) 0];\n        barrier(CLK_LOCAL_MEM_FENCE);\n        block_offset_55905 = dynamic_id_55904 * chunk_sizze_55875 * segscan_tblock_sizze_47807;\n        sgm_idx_55906 = smod64(block_offset_55905, m_44164);\n        boundary_55907 = sext_i64_i32(smin64(chunk_sizze_55875 * segscan_tblock_sizze_47807, m_44164 - sgm_idx_55906));\n        segsizze_compact_55908 = sext_i64_i32(smin64(chunk_sizze_55875 * segscan_tblock_sizze_47807, m_44164));\n        thd_offset_55911 = block_offset_55905 + sext_i32_i64(local_tid_55887);\n        // Load and map\n        {\n            for (int64_t i_55912 = 0; i_55912 < chunk_sizze_55875; i_55912++) {\n                int64_t virt_tid_55913 = thd_offset_55911 + i_55912 * segscan_tblock_sizze_47807;\n                int64_t slice_55914 = m_44164;\n                int64_t gtid_47811 = virt_tid_55913;\n                int64_t remnant_55915 = virt_tid_55913 - gtid_47811;\n                \n                if (slt64(virt_tid_55913, m_44164)) {\n                    int64_t x_47816 = ((__global int64_t *) ext_mem_53873)[gtid_47811];\n                    \n                    private_mem_55909[i_55912] = x_47816;\n                } else {\n                    private_mem_55909[i_55912] = (int64_t) 0;\n                }\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        // Transpose scan inputs\n        {\n            for (int64_t i_55916 = 0; i_55916 < chunk_sizze_55875; i_55916++) {\n                int64_t sharedIdx_55917 = sext_i32_i64(local_tid", "_55887) + i_55916 * segscan_tblock_sizze_47807;\n                int64_t tmp_55918 = private_mem_55909[i_55916];\n                \n                ((__local int64_t *) local_mem_55894)[sharedIdx_55917] = tmp_55918;\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            for (int64_t i_55919 = 0; i_55919 < chunk_sizze_55875; i_55919++) {\n                int64_t sharedIdx_55920 = sext_i32_i64(local_tid_55887) * chunk_sizze_55875 + i_55919;\n                int64_t tmp_55921 = ((__local int64_t *) local_mem_55894)[sharedIdx_55920];\n                \n                private_mem_55909[i_55919] = tmp_55921;\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n        }\n        // Per thread scan\n        {\n            for (int64_t i_55922 = 0; i_55922 < chunk_sizze_55875 - (int64_t) 1; i_55922++) {\n                int64_t eta_p_47813;\n                int64_t eta_p_47814;\n                \n                eta_p_47813 = private_mem_55909[i_55922];\n                eta_p_47814 = private_mem_55909[i_55922 + (int64_t) 1];\n                \n                int64_t defunc_0_op_res_47815 = add64(eta_p_47813, eta_p_47814);\n                \n                private_mem_55909[i_55922 + (int64_t) 1] = defunc_0_op_res_47815;\n            }\n        }\n        // Publish results in shared memory\n        {\n            int64_t tmp_55923 = private_mem_55909[chunk_sizze_55875 - (int64_t) 1];\n            \n            ((__local int64_t *) local_mem_55894)[sext_i32_i64(local_tid_55887)] = tmp_55923;\n            barrier(CLK_LOCAL_MEM_FENCE);\n        }\n        // Scan results (with warp scan)\n        {\n            int64_t eta_p_55924;\n            int64_t eta_p_55925;\n            int64_t eta_p_55928;\n            int64_t eta_p_55929;\n            bool ltid_in_bounds_55931 = slt64(sext_i32_i64(local_tid_55887), num_virt_threads_55877);\n            int32_t skip_threads_55932;\n            \n            // read input for in-block scan\n            {\n                if (ltid_in_bounds_55931) {\n       ",
                                    "             eta_p_55925 = ((volatile __local int64_t *) local_mem_55894)[sext_i32_i64(local_tid_55887)];\n                    if ((local_tid_55887 - squot32(local_tid_55887, 32) * 32) == 0) {\n                        eta_p_55924 = eta_p_55925;\n                    }\n                }\n            }\n            // in-block scan (hopefully no barriers needed)\n            {\n                skip_threads_55932 = 1;\n                while (slt32(skip_threads_55932, 32)) {\n                    bool thread_active_55933 = sle32(skip_threads_55932, local_tid_55887 - squot32(local_tid_55887, 32) * 32) && ltid_in_bounds_55931;\n                    \n                    if (thread_active_55933) {\n                        // read operands\n                        {\n                            eta_p_55924 = ((volatile __local int64_t *) local_mem_55894)[sext_i32_i64(local_tid_55887) - sext_i32_i64(skip_threads_55932)];\n                        }\n                    }\n                    // perform operation\n                    {\n                        if (thread_active_55933) {\n                            int64_t defunc_0_op_res_55926 = add64(eta_p_55924, eta_p_55925);\n                            \n                            eta_p_55924 = defunc_0_op_res_55926;\n                        }\n                    }\n                    if (sle32(wave_sizze_55889, skip_threads_55932)) {\n                        barrier(CLK_LOCAL_MEM_FENCE);\n                    }\n                    if (thread_active_55933) {\n                        // write result\n                        {\n                            ((volatile __local int64_t *) local_mem_55894)[sext_i32_i64(local_tid_55887)] = eta_p_55924;\n                            eta_p_55925 = eta_p_55924;\n                        }\n                    }\n                    if (sle32(wave_sizze_55889, skip_threads_55932)) {\n                        barrier(CLK_LOCAL_MEM_FENCE);\n                    }\n                    skip_threads_55932 *= 2;\n                }\n", "            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // last thread of block 'i' writes its result to offset 'i'\n            {\n                if ((local_tid_55887 - squot32(local_tid_55887, 32) * 32) == 31 && ltid_in_bounds_55931) {\n                    ((volatile __local int64_t *) local_mem_55894)[sext_i32_i64(squot32(local_tid_55887, 32))] = eta_p_55924;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // scan the first block, after which offset 'i' contains carry-in for block 'i+1'\n            {\n                int32_t skip_threads_55934;\n                \n                // read input for in-block scan\n                {\n                    if (squot32(local_tid_55887, 32) == 0 && ltid_in_bounds_55931) {\n                        eta_p_55929 = ((volatile __local int64_t *) local_mem_55894)[sext_i32_i64(local_tid_55887)];\n                        if ((local_tid_55887 - squot32(local_tid_55887, 32) * 32) == 0) {\n                            eta_p_55928 = eta_p_55929;\n                        }\n                    }\n                }\n                // in-block scan (hopefully no barriers needed)\n                {\n                    skip_threads_55934 = 1;\n                    while (slt32(skip_threads_55934, 32)) {\n                        bool thread_active_55935 = sle32(skip_threads_55934, local_tid_55887 - squot32(local_tid_55887, 32) * 32) && (squot32(local_tid_55887, 32) == 0 && ltid_in_bounds_55931);\n                        \n                        if (thread_active_55935) {\n                            // read operands\n                            {\n                                eta_p_55928 = ((volatile __local int64_t *) local_mem_55894)[sext_i32_i64(local_tid_55887) - sext_i32_i64(skip_threads_55934)];\n                            }\n                        }\n                        // perform operation\n                        {\n                            if (thread_active_55935) {\n                              ", "  int64_t defunc_0_op_res_55930 = add64(eta_p_55928, eta_p_55929);\n                                \n                                eta_p_55928 = defunc_0_op_res_55930;\n                            }\n                        }\n                        if (sle32(wave_sizze_55889, skip_threads_55934)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        if (thread_active_55935) {\n                            // write result\n                            {\n                                ((volatile __local int64_t *) local_mem_55894)[sext_i32_i64(local_tid_55887)] = eta_p_55928;\n                                eta_p_55929 = eta_p_55928;\n                            }\n                        }\n                        if (sle32(wave_sizze_55889, skip_threads_55934)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        skip_threads_55934 *= 2;\n                    }\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            \n            bool no_carry_in_55936 = squot32(local_tid_55887, 32) == 0 || !ltid_in_bounds_55931;\n            \n            // carry-in for every block except the first\n            {\n                // read operands\n                {\n                    if (!no_carry_in_55936) {\n                        eta_p_55925 = eta_p_55924;\n                        eta_p_55924 = ((__local int64_t *) local_mem_55894)[sext_i32_i64(squot32(local_tid_55887, 32)) - (int64_t) 1];\n                    }\n                }\n                // perform operation\n                {\n                    if (!no_carry_in_55936) {\n                        int64_t defunc_0_op_res_55926 = add64(eta_p_55924, eta_p_55925);\n                        \n                        eta_p_55924 = defunc_0_op_res_55926;\n                    }\n                }\n                // write final result\n                {\n                    if (!no_carry_in_55936) {\n            ",
                                    "            ((__local int64_t *) local_mem_55894)[sext_i32_i64(local_tid_55887)] = eta_p_55924;\n                    }\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // restore correct values for first block\n            {\n                if (squot32(local_tid_55887, 32) == 0 && ltid_in_bounds_55931) {\n                    ((__local int64_t *) local_mem_55894)[sext_i32_i64(local_tid_55887)] = eta_p_55925;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            barrier(CLK_LOCAL_MEM_FENCE);\n            if (local_tid_55887 == 0) {\n                acc_55927 = ((__local int64_t *) local_mem_55894)[segscan_tblock_sizze_47807 - (int64_t) 1];\n            } else {\n                acc_55927 = ((__local int64_t *) local_mem_55894)[sext_i32_i64(local_tid_55887) - (int64_t) 1];\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n        }\n        prefix_55937 = (int64_t) 0;\n        block_new_sgm_55938 = sgm_idx_55906 == (int64_t) 0;\n        // Perform lookback\n        {\n            if (block_new_sgm_55938 && local_tid_55887 == 0) {\n                ((volatile __global int64_t *) incprefixes_mem_55882)[dynamic_id_55904] = acc_55927;\n                mem_fence_global();\n                ((volatile __global int8_t *) status_flags_mem_55878)[dynamic_id_55904] = (int8_t) 2;\n                acc_55927 = (int64_t) 0;\n            }\n            if (!block_new_sgm_55938 && slt32(local_tid_55887, wave_sizze_55889)) {\n                if (local_tid_55887 == 0) {\n                    ((volatile __global int64_t *) aggregates_mem_55880)[dynamic_id_55904] = acc_55927;\n                    mem_fence_global();\n                    ((volatile __global int8_t *) status_flags_mem_55878)[dynamic_id_55904] = (int8_t) 1;\n                    \n                    int8_t tmp_55939 = ((volatile __global int8_t *) status_flags_mem_55878)[dynamic_id_55904 - (int64_t) 1];\n                    \n                    ((volatile __local int8_t *) local", "_mem_55894)[(int64_t) 0] = tmp_55939;\n                }\n                mem_fence_local();\n                \n                int8_t status_55940 = ((__local int8_t *) local_mem_55894)[(int64_t) 0];\n                \n                if (status_55940 == (int8_t) 2) {\n                    if (local_tid_55887 == 0) {\n                        prefix_55937 = ((volatile __global int64_t *) incprefixes_mem_55882)[dynamic_id_55904 - (int64_t) 1];\n                    }\n                } else {\n                    int32_t readOffset_55941 = sext_i64_i32(dynamic_id_55904 - sext_i32_i64(wave_sizze_55889));\n                    \n                    while (slt32(wave_sizze_55889 * -1, readOffset_55941)) {\n                        int32_t read_i_55942 = readOffset_55941 + local_tid_55887;\n                        int64_t aggr_55943 = (int64_t) 0;\n                        int8_t flag_55944 = (int8_t) 0;\n                        \n                        if (sle32(0, read_i_55942)) {\n                            flag_55944 = ((volatile __global int8_t *) status_flags_mem_55878)[sext_i32_i64(read_i_55942)];\n                            if (flag_55944 == (int8_t) 2) {\n                                aggr_55943 = ((volatile __global int64_t *) incprefixes_mem_55882)[sext_i32_i64(read_i_55942)];\n                            } else if (flag_55944 == (int8_t) 1) {\n                                aggr_55943 = ((volatile __global int64_t *) aggregates_mem_55880)[sext_i32_i64(read_i_55942)];\n                            }\n                        }\n                        ((__local int64_t *) local_mem_55894)[(int64_t) 4 + sext_i32_i64(local_tid_55887)] = aggr_55943;\n                        ((__local int8_t *) local_mem_55894)[sext_i32_i64(local_tid_55887)] = flag_55944;\n                        flag_55944 = ((__local int8_t *) local_mem_55894)[sext_i32_i64(wave_sizze_55889) - (int64_t) 1];\n                        if (slt8(flag_55944, (int8_t) 2)) {\n                            int8_t flg_x_55948;\n           ", "                 int8_t flg_y_55949;\n                            int64_t eta_p_55945;\n                            int64_t eta_p_55946;\n                            int32_t skip_threads_55950;\n                            \n                            // read input for in-block scan\n                            {\n                                flg_y_55949 = ((volatile __local int8_t *) local_mem_55894)[sext_i32_i64(local_tid_55887)];\n                                eta_p_55946 = ((volatile __local int64_t *) local_mem_55894)[(int64_t) 4 + sext_i32_i64(local_tid_55887)];\n                                if ((local_tid_55887 - squot32(local_tid_55887, 32) * 32) == 0) {\n                                    eta_p_55945 = eta_p_55946;\n                                    flg_x_55948 = flg_y_55949;\n                                }\n                            }\n                            // in-block scan (hopefully no barriers needed)\n                            {\n                                skip_threads_55950 = 1;\n                                while (slt32(skip_threads_55950, 32)) {\n                                    if (sle32(skip_threads_55950, local_tid_55887 - squot32(local_tid_55887, 32) * 32)) {\n                                        // read operands\n                                        {\n                                            flg_x_55948 = ((volatile __local int8_t *) local_mem_55894)[sext_i32_i64(local_tid_55887) - sext_i32_i64(skip_threads_55950)];\n                                            eta_p_55945 = ((volatile __local int64_t *) local_mem_55894)[(int64_t) 4 + (sext_i32_i64(local_tid_55887) - sext_i32_i64(skip_threads_55950))];\n                                        }\n                                        // perform operation\n                                        {\n                                            if (flg_y_55949 == (int8_t) 2 || flg_y_55949 == (int8_t) 0) {\n                                                flg_x_55948 = flg_y_55949;",
                                    "\n                                                eta_p_55945 = eta_p_55946;\n                                            } else {\n                                                int64_t defunc_0_op_res_55947 = add64(eta_p_55945, eta_p_55946);\n                                                \n                                                eta_p_55945 = defunc_0_op_res_55947;\n                                            }\n                                        }\n                                        // write result\n                                        {\n                                            ((volatile __local int8_t *) local_mem_55894)[sext_i32_i64(local_tid_55887)] = flg_x_55948;\n                                            flg_y_55949 = flg_x_55948;\n                                            ((volatile __local int64_t *) local_mem_55894)[(int64_t) 4 + sext_i32_i64(local_tid_55887)] = eta_p_55945;\n                                            eta_p_55946 = eta_p_55945;\n                                        }\n                                    }\n                                    skip_threads_55950 *= 2;\n                                }\n                            }\n                        }\n                        flag_55944 = ((__local int8_t *) local_mem_55894)[sext_i32_i64(wave_sizze_55889) - (int64_t) 1];\n                        aggr_55943 = ((__local int64_t *) local_mem_55894)[(int64_t) 4 + (sext_i32_i64(wave_sizze_55889) - (int64_t) 1)];\n                        if (flag_55944 == (int8_t) 2) {\n                            readOffset_55941 = wave_sizze_55889 * -1;\n                        } else if (flag_55944 == (int8_t) 1) {\n                            readOffset_55941 -= wave_sizze_55889;\n                        }\n                        if (slt8((int8_t) 0, flag_55944)) {\n                            int64_t eta_p_55951 = aggr_55943;\n                            int64_t eta_p_55952 = prefix_55937;\n                            int64_t defunc_0_op_res_", "55953 = add64(eta_p_55951, eta_p_55952);\n                            \n                            prefix_55937 = defunc_0_op_res_55953;\n                        }\n                        mem_fence_local();\n                    }\n                }\n                if (local_tid_55887 == 0) {\n                    if (boundary_55907 == sext_i64_i32(segscan_tblock_sizze_47807 * chunk_sizze_55875)) {\n                        int64_t eta_p_55954 = prefix_55937;\n                        int64_t eta_p_55955 = acc_55927;\n                        int64_t defunc_0_op_res_55956 = add64(eta_p_55954, eta_p_55955);\n                        \n                        ((volatile __global int64_t *) incprefixes_mem_55882)[dynamic_id_55904] = defunc_0_op_res_55956;\n                        mem_fence_global();\n                        ((volatile __global int8_t *) status_flags_mem_55878)[dynamic_id_55904] = (int8_t) 2;\n                    }\n                    ((__local int64_t *) local_mem_55894)[(int64_t) 4] = prefix_55937;\n                    acc_55927 = (int64_t) 0;\n                }\n            }\n            if (!(dynamic_id_55904 == (int64_t) 0)) {\n                barrier(CLK_LOCAL_MEM_FENCE);\n                prefix_55937 = ((__local int64_t *) local_mem_55894)[(int64_t) 4];\n                barrier(CLK_LOCAL_MEM_FENCE);\n            }\n        }\n        // Distribute results\n        {\n            int64_t eta_p_55957;\n            int64_t eta_p_55958;\n            int64_t eta_p_55960 = prefix_55937;\n            int64_t eta_p_55961 = acc_55927;\n            \n            if (slt32(local_tid_55887 * chunk_sizze_32b_55891, boundary_55907) && !block_new_sgm_55938) {\n                int64_t defunc_0_op_res_55962 = add64(eta_p_55960, eta_p_55961);\n                \n                eta_p_55957 = defunc_0_op_res_55962;\n            } else {\n                eta_p_55957 = acc_55927;\n            }\n            \n            int32_t stopping_point_55963 = segsizze_compact_55908 - srem32(local_tid_55887 * chunk_siz", "ze_32b_55891 - 1 + segsizze_compact_55908 - boundary_55907, segsizze_compact_55908);\n            \n            for (int64_t i_55964 = 0; i_55964 < chunk_sizze_55875; i_55964++) {\n                if (slt32(sext_i64_i32(i_55964), stopping_point_55963 - 1)) {\n                    eta_p_55958 = private_mem_55909[i_55964];\n                    \n                    int64_t defunc_0_op_res_55959 = add64(eta_p_55957, eta_p_55958);\n                    \n                    private_mem_55909[i_55964] = defunc_0_op_res_55959;\n                }\n            }\n        }\n        // Transpose scan output and Write it to global memory in coalesced fashion\n        {\n            for (int64_t i_55965 = 0; i_55965 < chunk_sizze_55875; i_55965++) {\n                int64_t sharedIdx_55966 = sext_i32_i64(local_tid_55887) * chunk_sizze_55875 + i_55965;\n                int64_t tmp_55967 = private_mem_55909[i_55965];\n                \n                ((__local int64_t *) local_mem_55894)[sharedIdx_55966] = tmp_55967;\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            for (int64_t i_55968 = 0; i_55968 < chunk_sizze_55875; i_55968++) {\n                int64_t flat_idx_55969 = thd_offset_55911 + i_55968 * segscan_tblock_sizze_47807;\n                int64_t slice_55970 = m_44164;\n                int64_t gtid_47811 = flat_idx_55969;\n                int64_t remnant_55971 = flat_idx_55969 - gtid_47811;\n                \n                if (slt64(flat_idx_55969, m_44164)) {\n                    int64_t tmp_55972 = ((__local int64_t *) local_mem_55894)[flat_idx_55969 - block_offset_55905];\n                    \n                    ((__global int64_t *) mem_53878)[gtid_47811] = tmp_55972;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n        }\n    }\n    \n  error_3:\n    return;\n    #undef segscan_tblock_sizze_47807\n    #undef chunk_sizze_55875\n}\nFUTHARK_KERNEL_SIZED(do_DBSCAN_doublezisegscan_48125_dim1, 1, 1)\nvoid do_DBSCAN_doublezisegscan_48125(__global int *global_",
                                    "failure, int64_t conc_tmp_43977, int64_t num_tblocks_48121, int64_t num_virt_blocks_56143, int64_t num_virt_threads_56144, __global unsigned char *ext_mem_53992, __global unsigned char *mem_53997, __global unsigned char *status_flags_mem_56145, __global unsigned char *aggregates_mem_56147, __global unsigned char *incprefixes_mem_56149, __global unsigned char *global_dynid_mem_56151)\n{\n    #define segscan_tblock_sizze_48120 (do_DBSCAN_doublezisegscan_48125zisegscan_tblock_sizze_48120)\n    #define chunk_sizze_56142 (do_DBSCAN_doublezisegscan_48125zichunk_sizze_56142)\n    \n    volatile __local unsigned char *local_mem_56161_backing_0 = &shared_mem[0];\n    const int64_t local_mem_56161_backing_0_offset = 0 + (smax64(smax64((int64_t) 288, (int64_t) 8 * segscan_tblock_sizze_48120), chunk_sizze_56142 * segscan_tblock_sizze_48120 * (int64_t) 8) + srem64((int64_t) 8 - srem64(smax64(smax64((int64_t) 288, (int64_t) 8 * segscan_tblock_sizze_48120), chunk_sizze_56142 * segscan_tblock_sizze_48120 * (int64_t) 8), (int64_t) 8), (int64_t) 8));\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_56154;\n    int32_t tblock_sizze_56157;\n    int32_t wave_sizze_56156;\n    int32_t block_id_56155;\n    int32_t global_tid_56153;\n    int64_t phys_tid_48125;\n    int32_t chunk_sizze_32b_56158;\n    int64_t byte_offsets_56159;\n    int64_t warp_byte_offset_56160;\n    __local unsigned char *local_mem_56161;\n    int64_t trans_arr_len_56162;\n    int64_t phys_block_id_56168;\n    int64_t virtloop_bound_56169;\n    \n    local_tid_56154 = get_local_id(0);\n    tblock_sizze_56157 = get_local_size(0);\n    wave_sizze_56156 = LOCKSTEP_WIDTH;\n    block_id_56155 = get_tblock_id(0);\n    global_tid_56153 = block_id_56155 * tblock_sizze_56157 + local_tid_56154;\n    phys_tid_48125 = sext_i32_i64(global_tid_56153);\n    chunk_sizze_32b_56158 = sext_i64_i32(chunk_sizze_56142);\n    byte_offsets_56159 = segscan_tblock_sizze_48120 * (int64_t) 8;\n    warp_byte_offset_56160 = (int64_t) 288;\n    // A", "llocate reusable shared memory\n    { }\n    local_mem_56161 = (__local unsigned char *) local_mem_56161_backing_0;\n    trans_arr_len_56162 = chunk_sizze_56142 * segscan_tblock_sizze_48120;\n    phys_block_id_56168 = get_tblock_id(0);\n    virtloop_bound_56169 = sdiv_up64(num_virt_blocks_56143 - phys_block_id_56168, num_tblocks_48121);\n    for (int64_t virtloop_i_56170 = 0; virtloop_i_56170 < virtloop_bound_56169; virtloop_i_56170++) {\n        int64_t dynamic_id_56171;\n        int64_t block_offset_56172;\n        int64_t sgm_idx_56173;\n        int32_t boundary_56174;\n        int32_t segsizze_compact_56175;\n        int64_t private_mem_56176[chunk_sizze_56142];\n        int64_t thd_offset_56178;\n        int64_t acc_56194;\n        int64_t prefix_56204;\n        bool block_new_sgm_56205;\n        \n        // First thread in block fetches this block's dynamic_id\n        {\n            if (local_tid_56154 == 0) {\n                dynamic_id_56171 = atomic_add_i32_global(&((volatile __global int *) global_dynid_mem_56151)[(int64_t) 0], (int) 1);\n                // Set dynamic id for this block\n                {\n                    ((__local int64_t *) local_mem_56161)[(int64_t) 0] = dynamic_id_56171;\n                }\n                // First thread in last (virtual) block resets global dynamic_id\n                {\n                    if (dynamic_id_56171 == num_virt_blocks_56143 - (int64_t) 1) {\n                        ((__global int32_t *) global_dynid_mem_56151)[(int64_t) 0] = 0;\n                    }\n                }\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        dynamic_id_56171 = ((__local int32_t *) local_mem_56161)[(int64_t) 0];\n        barrier(CLK_LOCAL_MEM_FENCE);\n        block_offset_56172 = dynamic_id_56171 * chunk_sizze_56142 * segscan_tblock_sizze_48120;\n        sgm_idx_56173 = smod64(block_offset_56172, conc_tmp_43977);\n        boundary_56174 = sext_i64_i32(smin64(chunk_sizze_56142 * segscan_tblock_sizze_48120, conc_tmp_43977 - sgm_idx_56173));", "\n        segsizze_compact_56175 = sext_i64_i32(smin64(chunk_sizze_56142 * segscan_tblock_sizze_48120, conc_tmp_43977));\n        thd_offset_56178 = block_offset_56172 + sext_i32_i64(local_tid_56154);\n        // Load and map\n        {\n            for (int64_t i_56179 = 0; i_56179 < chunk_sizze_56142; i_56179++) {\n                int64_t virt_tid_56180 = thd_offset_56178 + i_56179 * segscan_tblock_sizze_48120;\n                int64_t slice_56181 = conc_tmp_43977;\n                int64_t gtid_48124 = virt_tid_56180;\n                int64_t remnant_56182 = virt_tid_56180 - gtid_48124;\n                \n                if (slt64(virt_tid_56180, conc_tmp_43977)) {\n                    int64_t x_48129 = ((__global int64_t *) ext_mem_53992)[gtid_48124];\n                    \n                    private_mem_56176[i_56179] = x_48129;\n                } else {\n                    private_mem_56176[i_56179] = (int64_t) 0;\n                }\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        // Transpose scan inputs\n        {\n            for (int64_t i_56183 = 0; i_56183 < chunk_sizze_56142; i_56183++) {\n                int64_t sharedIdx_56184 = sext_i32_i64(local_tid_56154) + i_56183 * segscan_tblock_sizze_48120;\n                int64_t tmp_56185 = private_mem_56176[i_56183];\n                \n                ((__local int64_t *) local_mem_56161)[sharedIdx_56184] = tmp_56185;\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            for (int64_t i_56186 = 0; i_56186 < chunk_sizze_56142; i_56186++) {\n                int64_t sharedIdx_56187 = sext_i32_i64(local_tid_56154) * chunk_sizze_56142 + i_56186;\n                int64_t tmp_56188 = ((__local int64_t *) local_mem_56161)[sharedIdx_56187];\n                \n                private_mem_56176[i_56186] = tmp_56188;\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n        }\n        // Per thread scan\n        {\n            for (int64_t i_56189 = 0; i_56189 < chunk_sizze_56142 - (int64_t) 1; i_56189++) {\n",
                                    "                int64_t eta_p_48126;\n                int64_t eta_p_48127;\n                \n                eta_p_48126 = private_mem_56176[i_56189];\n                eta_p_48127 = private_mem_56176[i_56189 + (int64_t) 1];\n                \n                int64_t defunc_0_op_res_48128 = add64(eta_p_48126, eta_p_48127);\n                \n                private_mem_56176[i_56189 + (int64_t) 1] = defunc_0_op_res_48128;\n            }\n        }\n        // Publish results in shared memory\n        {\n            int64_t tmp_56190 = private_mem_56176[chunk_sizze_56142 - (int64_t) 1];\n            \n            ((__local int64_t *) local_mem_56161)[sext_i32_i64(local_tid_56154)] = tmp_56190;\n            barrier(CLK_LOCAL_MEM_FENCE);\n        }\n        // Scan results (with warp scan)\n        {\n            int64_t eta_p_56191;\n            int64_t eta_p_56192;\n            int64_t eta_p_56195;\n            int64_t eta_p_56196;\n            bool ltid_in_bounds_56198 = slt64(sext_i32_i64(local_tid_56154), num_virt_threads_56144);\n            int32_t skip_threads_56199;\n            \n            // read input for in-block scan\n            {\n                if (ltid_in_bounds_56198) {\n                    eta_p_56192 = ((volatile __local int64_t *) local_mem_56161)[sext_i32_i64(local_tid_56154)];\n                    if ((local_tid_56154 - squot32(local_tid_56154, 32) * 32) == 0) {\n                        eta_p_56191 = eta_p_56192;\n                    }\n                }\n            }\n            // in-block scan (hopefully no barriers needed)\n            {\n                skip_threads_56199 = 1;\n                while (slt32(skip_threads_56199, 32)) {\n                    bool thread_active_56200 = sle32(skip_threads_56199, local_tid_56154 - squot32(local_tid_56154, 32) * 32) && ltid_in_bounds_56198;\n                    \n                    if (thread_active_56200) {\n                        // read operands\n                        {\n                            eta_p_56191 = ((volatile __local ", "int64_t *) local_mem_56161)[sext_i32_i64(local_tid_56154) - sext_i32_i64(skip_threads_56199)];\n                        }\n                    }\n                    // perform operation\n                    {\n                        if (thread_active_56200) {\n                            int64_t defunc_0_op_res_56193 = add64(eta_p_56191, eta_p_56192);\n                            \n                            eta_p_56191 = defunc_0_op_res_56193;\n                        }\n                    }\n                    if (sle32(wave_sizze_56156, skip_threads_56199)) {\n                        barrier(CLK_LOCAL_MEM_FENCE);\n                    }\n                    if (thread_active_56200) {\n                        // write result\n                        {\n                            ((volatile __local int64_t *) local_mem_56161)[sext_i32_i64(local_tid_56154)] = eta_p_56191;\n                            eta_p_56192 = eta_p_56191;\n                        }\n                    }\n                    if (sle32(wave_sizze_56156, skip_threads_56199)) {\n                        barrier(CLK_LOCAL_MEM_FENCE);\n                    }\n                    skip_threads_56199 *= 2;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // last thread of block 'i' writes its result to offset 'i'\n            {\n                if ((local_tid_56154 - squot32(local_tid_56154, 32) * 32) == 31 && ltid_in_bounds_56198) {\n                    ((volatile __local int64_t *) local_mem_56161)[sext_i32_i64(squot32(local_tid_56154, 32))] = eta_p_56191;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // scan the first block, after which offset 'i' contains carry-in for block 'i+1'\n            {\n                int32_t skip_threads_56201;\n                \n                // read input for in-block scan\n                {\n                    if (squot32(local_tid_56154, 32) == 0 && ltid_in_bounds_56198) {\n                        eta_p_56196 = ((volat", "ile __local int64_t *) local_mem_56161)[sext_i32_i64(local_tid_56154)];\n                        if ((local_tid_56154 - squot32(local_tid_56154, 32) * 32) == 0) {\n                            eta_p_56195 = eta_p_56196;\n                        }\n                    }\n                }\n                // in-block scan (hopefully no barriers needed)\n                {\n                    skip_threads_56201 = 1;\n                    while (slt32(skip_threads_56201, 32)) {\n                        bool thread_active_56202 = sle32(skip_threads_56201, local_tid_56154 - squot32(local_tid_56154, 32) * 32) && (squot32(local_tid_56154, 32) == 0 && ltid_in_bounds_56198);\n                        \n                        if (thread_active_56202) {\n                            // read operands\n                            {\n                                eta_p_56195 = ((volatile __local int64_t *) local_mem_56161)[sext_i32_i64(local_tid_56154) - sext_i32_i64(skip_threads_56201)];\n                            }\n                        }\n                        // perform operation\n                        {\n                            if (thread_active_56202) {\n                                int64_t defunc_0_op_res_56197 = add64(eta_p_56195, eta_p_56196);\n                                \n                                eta_p_56195 = defunc_0_op_res_56197;\n                            }\n                        }\n                        if (sle32(wave_sizze_56156, skip_threads_56201)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        if (thread_active_56202) {\n                            // write result\n                            {\n                                ((volatile __local int64_t *) local_mem_56161)[sext_i32_i64(local_tid_56154)] = eta_p_56195;\n                                eta_p_56196 = eta_p_56195;\n                            }\n                        }\n                        if (sle32(wave_sizze_56156, skip_threads_",
                                    "56201)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        skip_threads_56201 *= 2;\n                    }\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            \n            bool no_carry_in_56203 = squot32(local_tid_56154, 32) == 0 || !ltid_in_bounds_56198;\n            \n            // carry-in for every block except the first\n            {\n                // read operands\n                {\n                    if (!no_carry_in_56203) {\n                        eta_p_56192 = eta_p_56191;\n                        eta_p_56191 = ((__local int64_t *) local_mem_56161)[sext_i32_i64(squot32(local_tid_56154, 32)) - (int64_t) 1];\n                    }\n                }\n                // perform operation\n                {\n                    if (!no_carry_in_56203) {\n                        int64_t defunc_0_op_res_56193 = add64(eta_p_56191, eta_p_56192);\n                        \n                        eta_p_56191 = defunc_0_op_res_56193;\n                    }\n                }\n                // write final result\n                {\n                    if (!no_carry_in_56203) {\n                        ((__local int64_t *) local_mem_56161)[sext_i32_i64(local_tid_56154)] = eta_p_56191;\n                    }\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // restore correct values for first block\n            {\n                if (squot32(local_tid_56154, 32) == 0 && ltid_in_bounds_56198) {\n                    ((__local int64_t *) local_mem_56161)[sext_i32_i64(local_tid_56154)] = eta_p_56192;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            barrier(CLK_LOCAL_MEM_FENCE);\n            if (local_tid_56154 == 0) {\n                acc_56194 = ((__local int64_t *) local_mem_56161)[segscan_tblock_sizze_48120 - (int64_t) 1];\n            } else {\n                acc_56194 = ((__local int64_t *) local_mem_56161)[sext_i32_i64(loca", "l_tid_56154) - (int64_t) 1];\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n        }\n        prefix_56204 = (int64_t) 0;\n        block_new_sgm_56205 = sgm_idx_56173 == (int64_t) 0;\n        // Perform lookback\n        {\n            if (block_new_sgm_56205 && local_tid_56154 == 0) {\n                ((volatile __global int64_t *) incprefixes_mem_56149)[dynamic_id_56171] = acc_56194;\n                mem_fence_global();\n                ((volatile __global int8_t *) status_flags_mem_56145)[dynamic_id_56171] = (int8_t) 2;\n                acc_56194 = (int64_t) 0;\n            }\n            if (!block_new_sgm_56205 && slt32(local_tid_56154, wave_sizze_56156)) {\n                if (local_tid_56154 == 0) {\n                    ((volatile __global int64_t *) aggregates_mem_56147)[dynamic_id_56171] = acc_56194;\n                    mem_fence_global();\n                    ((volatile __global int8_t *) status_flags_mem_56145)[dynamic_id_56171] = (int8_t) 1;\n                    \n                    int8_t tmp_56206 = ((volatile __global int8_t *) status_flags_mem_56145)[dynamic_id_56171 - (int64_t) 1];\n                    \n                    ((volatile __local int8_t *) local_mem_56161)[(int64_t) 0] = tmp_56206;\n                }\n                mem_fence_local();\n                \n                int8_t status_56207 = ((__local int8_t *) local_mem_56161)[(int64_t) 0];\n                \n                if (status_56207 == (int8_t) 2) {\n                    if (local_tid_56154 == 0) {\n                        prefix_56204 = ((volatile __global int64_t *) incprefixes_mem_56149)[dynamic_id_56171 - (int64_t) 1];\n                    }\n                } else {\n                    int32_t readOffset_56208 = sext_i64_i32(dynamic_id_56171 - sext_i32_i64(wave_sizze_56156));\n                    \n                    while (slt32(wave_sizze_56156 * -1, readOffset_56208)) {\n                        int32_t read_i_56209 = readOffset_56208 + local_tid_56154;\n                        int64_t aggr", "_56210 = (int64_t) 0;\n                        int8_t flag_56211 = (int8_t) 0;\n                        \n                        if (sle32(0, read_i_56209)) {\n                            flag_56211 = ((volatile __global int8_t *) status_flags_mem_56145)[sext_i32_i64(read_i_56209)];\n                            if (flag_56211 == (int8_t) 2) {\n                                aggr_56210 = ((volatile __global int64_t *) incprefixes_mem_56149)[sext_i32_i64(read_i_56209)];\n                            } else if (flag_56211 == (int8_t) 1) {\n                                aggr_56210 = ((volatile __global int64_t *) aggregates_mem_56147)[sext_i32_i64(read_i_56209)];\n                            }\n                        }\n                        ((__local int64_t *) local_mem_56161)[(int64_t) 4 + sext_i32_i64(local_tid_56154)] = aggr_56210;\n                        ((__local int8_t *) local_mem_56161)[sext_i32_i64(local_tid_56154)] = flag_56211;\n                        flag_56211 = ((__local int8_t *) local_mem_56161)[sext_i32_i64(wave_sizze_56156) - (int64_t) 1];\n                        if (slt8(flag_56211, (int8_t) 2)) {\n                            int8_t flg_x_56215;\n                            int8_t flg_y_56216;\n                            int64_t eta_p_56212;\n                            int64_t eta_p_56213;\n                            int32_t skip_threads_56217;\n                            \n                            // read input for in-block scan\n                            {\n                                flg_y_56216 = ((volatile __local int8_t *) local_mem_56161)[sext_i32_i64(local_tid_56154)];\n                                eta_p_56213 = ((volatile __local int64_t *) local_mem_56161)[(int64_t) 4 + sext_i32_i64(local_tid_56154)];\n                                if ((local_tid_56154 - squot32(local_tid_56154, 32) * 32) == 0) {\n                                    eta_p_56212 = eta_p_56213;\n                                    flg_x_56215 = flg_y_56216;\n                 ",
                                    "               }\n                            }\n                            // in-block scan (hopefully no barriers needed)\n                            {\n                                skip_threads_56217 = 1;\n                                while (slt32(skip_threads_56217, 32)) {\n                                    if (sle32(skip_threads_56217, local_tid_56154 - squot32(local_tid_56154, 32) * 32)) {\n                                        // read operands\n                                        {\n                                            flg_x_56215 = ((volatile __local int8_t *) local_mem_56161)[sext_i32_i64(local_tid_56154) - sext_i32_i64(skip_threads_56217)];\n                                            eta_p_56212 = ((volatile __local int64_t *) local_mem_56161)[(int64_t) 4 + (sext_i32_i64(local_tid_56154) - sext_i32_i64(skip_threads_56217))];\n                                        }\n                                        // perform operation\n                                        {\n                                            if (flg_y_56216 == (int8_t) 2 || flg_y_56216 == (int8_t) 0) {\n                                                flg_x_56215 = flg_y_56216;\n                                                eta_p_56212 = eta_p_56213;\n                                            } else {\n                                                int64_t defunc_0_op_res_56214 = add64(eta_p_56212, eta_p_56213);\n                                                \n                                                eta_p_56212 = defunc_0_op_res_56214;\n                                            }\n                                        }\n                                        // write result\n                                        {\n                                            ((volatile __local int8_t *) local_mem_56161)[sext_i32_i64(local_tid_56154)] = flg_x_56215;\n                                            flg_y_56216 = flg_x_56215;\n                                            (", "(volatile __local int64_t *) local_mem_56161)[(int64_t) 4 + sext_i32_i64(local_tid_56154)] = eta_p_56212;\n                                            eta_p_56213 = eta_p_56212;\n                                        }\n                                    }\n                                    skip_threads_56217 *= 2;\n                                }\n                            }\n                        }\n                        flag_56211 = ((__local int8_t *) local_mem_56161)[sext_i32_i64(wave_sizze_56156) - (int64_t) 1];\n                        aggr_56210 = ((__local int64_t *) local_mem_56161)[(int64_t) 4 + (sext_i32_i64(wave_sizze_56156) - (int64_t) 1)];\n                        if (flag_56211 == (int8_t) 2) {\n                            readOffset_56208 = wave_sizze_56156 * -1;\n                        } else if (flag_56211 == (int8_t) 1) {\n                            readOffset_56208 -= wave_sizze_56156;\n                        }\n                        if (slt8((int8_t) 0, flag_56211)) {\n                            int64_t eta_p_56218 = aggr_56210;\n                            int64_t eta_p_56219 = prefix_56204;\n                            int64_t defunc_0_op_res_56220 = add64(eta_p_56218, eta_p_56219);\n                            \n                            prefix_56204 = defunc_0_op_res_56220;\n                        }\n                        mem_fence_local();\n                    }\n                }\n                if (local_tid_56154 == 0) {\n                    if (boundary_56174 == sext_i64_i32(segscan_tblock_sizze_48120 * chunk_sizze_56142)) {\n                        int64_t eta_p_56221 = prefix_56204;\n                        int64_t eta_p_56222 = acc_56194;\n                        int64_t defunc_0_op_res_56223 = add64(eta_p_56221, eta_p_56222);\n                        \n                        ((volatile __global int64_t *) incprefixes_mem_56149)[dynamic_id_56171] = defunc_0_op_res_56223;\n                        mem_fence_global();\n                       ", " ((volatile __global int8_t *) status_flags_mem_56145)[dynamic_id_56171] = (int8_t) 2;\n                    }\n                    ((__local int64_t *) local_mem_56161)[(int64_t) 4] = prefix_56204;\n                    acc_56194 = (int64_t) 0;\n                }\n            }\n            if (!(dynamic_id_56171 == (int64_t) 0)) {\n                barrier(CLK_LOCAL_MEM_FENCE);\n                prefix_56204 = ((__local int64_t *) local_mem_56161)[(int64_t) 4];\n                barrier(CLK_LOCAL_MEM_FENCE);\n            }\n        }\n        // Distribute results\n        {\n            int64_t eta_p_56224;\n            int64_t eta_p_56225;\n            int64_t eta_p_56227 = prefix_56204;\n            int64_t eta_p_56228 = acc_56194;\n            \n            if (slt32(local_tid_56154 * chunk_sizze_32b_56158, boundary_56174) && !block_new_sgm_56205) {\n                int64_t defunc_0_op_res_56229 = add64(eta_p_56227, eta_p_56228);\n                \n                eta_p_56224 = defunc_0_op_res_56229;\n            } else {\n                eta_p_56224 = acc_56194;\n            }\n            \n            int32_t stopping_point_56230 = segsizze_compact_56175 - srem32(local_tid_56154 * chunk_sizze_32b_56158 - 1 + segsizze_compact_56175 - boundary_56174, segsizze_compact_56175);\n            \n            for (int64_t i_56231 = 0; i_56231 < chunk_sizze_56142; i_56231++) {\n                if (slt32(sext_i64_i32(i_56231), stopping_point_56230 - 1)) {\n                    eta_p_56225 = private_mem_56176[i_56231];\n                    \n                    int64_t defunc_0_op_res_56226 = add64(eta_p_56224, eta_p_56225);\n                    \n                    private_mem_56176[i_56231] = defunc_0_op_res_56226;\n                }\n            }\n        }\n        // Transpose scan output and Write it to global memory in coalesced fashion\n        {\n            for (int64_t i_56232 = 0; i_56232 < chunk_sizze_56142; i_56232++) {\n                int64_t sharedIdx_56233 = sext_i32_i64(local_tid_56154) * chunk_s",
                                    "izze_56142 + i_56232;\n                int64_t tmp_56234 = private_mem_56176[i_56232];\n                \n                ((__local int64_t *) local_mem_56161)[sharedIdx_56233] = tmp_56234;\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            for (int64_t i_56235 = 0; i_56235 < chunk_sizze_56142; i_56235++) {\n                int64_t flat_idx_56236 = thd_offset_56178 + i_56235 * segscan_tblock_sizze_48120;\n                int64_t slice_56237 = conc_tmp_43977;\n                int64_t gtid_48124 = flat_idx_56236;\n                int64_t remnant_56238 = flat_idx_56236 - gtid_48124;\n                \n                if (slt64(flat_idx_56236, conc_tmp_43977)) {\n                    int64_t tmp_56239 = ((__local int64_t *) local_mem_56161)[flat_idx_56236 - block_offset_56172];\n                    \n                    ((__global int64_t *) mem_53997)[gtid_48124] = tmp_56239;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n        }\n    }\n    \n  error_3:\n    return;\n    #undef segscan_tblock_sizze_48120\n    #undef chunk_sizze_56142\n}\nFUTHARK_KERNEL_SIZED(do_DBSCAN_doublezisegscan_48902_dim1, 1, 1)\nvoid do_DBSCAN_doublezisegscan_48902(__global int *global_failure, int64_t m_44319, int64_t num_tblocks_48898, int64_t num_virt_blocks_56417, int64_t num_virt_threads_56418, __global unsigned char *ext_mem_54242, __global unsigned char *mem_54247, __global unsigned char *status_flags_mem_56419, __global unsigned char *aggregates_mem_56421, __global unsigned char *incprefixes_mem_56423, __global unsigned char *global_dynid_mem_56425)\n{\n    #define segscan_tblock_sizze_48897 (do_DBSCAN_doublezisegscan_48902zisegscan_tblock_sizze_48897)\n    #define chunk_sizze_56416 (do_DBSCAN_doublezisegscan_48902zichunk_sizze_56416)\n    \n    volatile __local unsigned char *local_mem_56435_backing_0 = &shared_mem[0];\n    const int64_t local_mem_56435_backing_0_offset = 0 + (smax64(smax64((int64_t) 288, (int64_t) 8 * segscan_tblock_sizze_48897), chunk_sizze_56416 * ", "segscan_tblock_sizze_48897 * (int64_t) 8) + srem64((int64_t) 8 - srem64(smax64(smax64((int64_t) 288, (int64_t) 8 * segscan_tblock_sizze_48897), chunk_sizze_56416 * segscan_tblock_sizze_48897 * (int64_t) 8), (int64_t) 8), (int64_t) 8));\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_56428;\n    int32_t tblock_sizze_56431;\n    int32_t wave_sizze_56430;\n    int32_t block_id_56429;\n    int32_t global_tid_56427;\n    int64_t phys_tid_48902;\n    int32_t chunk_sizze_32b_56432;\n    int64_t byte_offsets_56433;\n    int64_t warp_byte_offset_56434;\n    __local unsigned char *local_mem_56435;\n    int64_t trans_arr_len_56436;\n    int64_t phys_block_id_56442;\n    int64_t virtloop_bound_56443;\n    \n    local_tid_56428 = get_local_id(0);\n    tblock_sizze_56431 = get_local_size(0);\n    wave_sizze_56430 = LOCKSTEP_WIDTH;\n    block_id_56429 = get_tblock_id(0);\n    global_tid_56427 = block_id_56429 * tblock_sizze_56431 + local_tid_56428;\n    phys_tid_48902 = sext_i32_i64(global_tid_56427);\n    chunk_sizze_32b_56432 = sext_i64_i32(chunk_sizze_56416);\n    byte_offsets_56433 = segscan_tblock_sizze_48897 * (int64_t) 8;\n    warp_byte_offset_56434 = (int64_t) 288;\n    // Allocate reusable shared memory\n    { }\n    local_mem_56435 = (__local unsigned char *) local_mem_56435_backing_0;\n    trans_arr_len_56436 = chunk_sizze_56416 * segscan_tblock_sizze_48897;\n    phys_block_id_56442 = get_tblock_id(0);\n    virtloop_bound_56443 = sdiv_up64(num_virt_blocks_56417 - phys_block_id_56442, num_tblocks_48898);\n    for (int64_t virtloop_i_56444 = 0; virtloop_i_56444 < virtloop_bound_56443; virtloop_i_56444++) {\n        int64_t dynamic_id_56445;\n        int64_t block_offset_56446;\n        int64_t sgm_idx_56447;\n        int32_t boundary_56448;\n        int32_t segsizze_compact_56449;\n        int64_t private_mem_56450[chunk_sizze_56416];\n        int64_t thd_offset_56452;\n        int64_t acc_56468;\n        int64_t prefix_56478;\n        bool block_new_sgm_56479;\n        \n        //", " First thread in block fetches this block's dynamic_id\n        {\n            if (local_tid_56428 == 0) {\n                dynamic_id_56445 = atomic_add_i32_global(&((volatile __global int *) global_dynid_mem_56425)[(int64_t) 0], (int) 1);\n                // Set dynamic id for this block\n                {\n                    ((__local int64_t *) local_mem_56435)[(int64_t) 0] = dynamic_id_56445;\n                }\n                // First thread in last (virtual) block resets global dynamic_id\n                {\n                    if (dynamic_id_56445 == num_virt_blocks_56417 - (int64_t) 1) {\n                        ((__global int32_t *) global_dynid_mem_56425)[(int64_t) 0] = 0;\n                    }\n                }\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        dynamic_id_56445 = ((__local int32_t *) local_mem_56435)[(int64_t) 0];\n        barrier(CLK_LOCAL_MEM_FENCE);\n        block_offset_56446 = dynamic_id_56445 * chunk_sizze_56416 * segscan_tblock_sizze_48897;\n        sgm_idx_56447 = smod64(block_offset_56446, m_44319);\n        boundary_56448 = sext_i64_i32(smin64(chunk_sizze_56416 * segscan_tblock_sizze_48897, m_44319 - sgm_idx_56447));\n        segsizze_compact_56449 = sext_i64_i32(smin64(chunk_sizze_56416 * segscan_tblock_sizze_48897, m_44319));\n        thd_offset_56452 = block_offset_56446 + sext_i32_i64(local_tid_56428);\n        // Load and map\n        {\n            for (int64_t i_56453 = 0; i_56453 < chunk_sizze_56416; i_56453++) {\n                int64_t virt_tid_56454 = thd_offset_56452 + i_56453 * segscan_tblock_sizze_48897;\n                int64_t slice_56455 = m_44319;\n                int64_t gtid_48901 = virt_tid_56454;\n                int64_t remnant_56456 = virt_tid_56454 - gtid_48901;\n                \n                if (slt64(virt_tid_56454, m_44319)) {\n                    int64_t x_48906 = ((__global int64_t *) ext_mem_54242)[gtid_48901];\n                    \n                    private_mem_56450[i_56453] = x_48906;\n          ",
                                    "      } else {\n                    private_mem_56450[i_56453] = (int64_t) 0;\n                }\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        // Transpose scan inputs\n        {\n            for (int64_t i_56457 = 0; i_56457 < chunk_sizze_56416; i_56457++) {\n                int64_t sharedIdx_56458 = sext_i32_i64(local_tid_56428) + i_56457 * segscan_tblock_sizze_48897;\n                int64_t tmp_56459 = private_mem_56450[i_56457];\n                \n                ((__local int64_t *) local_mem_56435)[sharedIdx_56458] = tmp_56459;\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            for (int64_t i_56460 = 0; i_56460 < chunk_sizze_56416; i_56460++) {\n                int64_t sharedIdx_56461 = sext_i32_i64(local_tid_56428) * chunk_sizze_56416 + i_56460;\n                int64_t tmp_56462 = ((__local int64_t *) local_mem_56435)[sharedIdx_56461];\n                \n                private_mem_56450[i_56460] = tmp_56462;\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n        }\n        // Per thread scan\n        {\n            for (int64_t i_56463 = 0; i_56463 < chunk_sizze_56416 - (int64_t) 1; i_56463++) {\n                int64_t eta_p_48903;\n                int64_t eta_p_48904;\n                \n                eta_p_48903 = private_mem_56450[i_56463];\n                eta_p_48904 = private_mem_56450[i_56463 + (int64_t) 1];\n                \n                int64_t defunc_0_op_res_48905 = add64(eta_p_48903, eta_p_48904);\n                \n                private_mem_56450[i_56463 + (int64_t) 1] = defunc_0_op_res_48905;\n            }\n        }\n        // Publish results in shared memory\n        {\n            int64_t tmp_56464 = private_mem_56450[chunk_sizze_56416 - (int64_t) 1];\n            \n            ((__local int64_t *) local_mem_56435)[sext_i32_i64(local_tid_56428)] = tmp_56464;\n            barrier(CLK_LOCAL_MEM_FENCE);\n        }\n        // Scan results (with warp scan)\n        {\n            int64_t eta_p_56465;\n            int64_t", " eta_p_56466;\n            int64_t eta_p_56469;\n            int64_t eta_p_56470;\n            bool ltid_in_bounds_56472 = slt64(sext_i32_i64(local_tid_56428), num_virt_threads_56418);\n            int32_t skip_threads_56473;\n            \n            // read input for in-block scan\n            {\n                if (ltid_in_bounds_56472) {\n                    eta_p_56466 = ((volatile __local int64_t *) local_mem_56435)[sext_i32_i64(local_tid_56428)];\n                    if ((local_tid_56428 - squot32(local_tid_56428, 32) * 32) == 0) {\n                        eta_p_56465 = eta_p_56466;\n                    }\n                }\n            }\n            // in-block scan (hopefully no barriers needed)\n            {\n                skip_threads_56473 = 1;\n                while (slt32(skip_threads_56473, 32)) {\n                    bool thread_active_56474 = sle32(skip_threads_56473, local_tid_56428 - squot32(local_tid_56428, 32) * 32) && ltid_in_bounds_56472;\n                    \n                    if (thread_active_56474) {\n                        // read operands\n                        {\n                            eta_p_56465 = ((volatile __local int64_t *) local_mem_56435)[sext_i32_i64(local_tid_56428) - sext_i32_i64(skip_threads_56473)];\n                        }\n                    }\n                    // perform operation\n                    {\n                        if (thread_active_56474) {\n                            int64_t defunc_0_op_res_56467 = add64(eta_p_56465, eta_p_56466);\n                            \n                            eta_p_56465 = defunc_0_op_res_56467;\n                        }\n                    }\n                    if (sle32(wave_sizze_56430, skip_threads_56473)) {\n                        barrier(CLK_LOCAL_MEM_FENCE);\n                    }\n                    if (thread_active_56474) {\n                        // write result\n                        {\n                            ((volatile __local int64_t *) local_mem_56435)[sext_i32_i64(lo", "cal_tid_56428)] = eta_p_56465;\n                            eta_p_56466 = eta_p_56465;\n                        }\n                    }\n                    if (sle32(wave_sizze_56430, skip_threads_56473)) {\n                        barrier(CLK_LOCAL_MEM_FENCE);\n                    }\n                    skip_threads_56473 *= 2;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // last thread of block 'i' writes its result to offset 'i'\n            {\n                if ((local_tid_56428 - squot32(local_tid_56428, 32) * 32) == 31 && ltid_in_bounds_56472) {\n                    ((volatile __local int64_t *) local_mem_56435)[sext_i32_i64(squot32(local_tid_56428, 32))] = eta_p_56465;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // scan the first block, after which offset 'i' contains carry-in for block 'i+1'\n            {\n                int32_t skip_threads_56475;\n                \n                // read input for in-block scan\n                {\n                    if (squot32(local_tid_56428, 32) == 0 && ltid_in_bounds_56472) {\n                        eta_p_56470 = ((volatile __local int64_t *) local_mem_56435)[sext_i32_i64(local_tid_56428)];\n                        if ((local_tid_56428 - squot32(local_tid_56428, 32) * 32) == 0) {\n                            eta_p_56469 = eta_p_56470;\n                        }\n                    }\n                }\n                // in-block scan (hopefully no barriers needed)\n                {\n                    skip_threads_56475 = 1;\n                    while (slt32(skip_threads_56475, 32)) {\n                        bool thread_active_56476 = sle32(skip_threads_56475, local_tid_56428 - squot32(local_tid_56428, 32) * 32) && (squot32(local_tid_56428, 32) == 0 && ltid_in_bounds_56472);\n                        \n                        if (thread_active_56476) {\n                            // read operands\n                            {\n                            ",
                                    "    eta_p_56469 = ((volatile __local int64_t *) local_mem_56435)[sext_i32_i64(local_tid_56428) - sext_i32_i64(skip_threads_56475)];\n                            }\n                        }\n                        // perform operation\n                        {\n                            if (thread_active_56476) {\n                                int64_t defunc_0_op_res_56471 = add64(eta_p_56469, eta_p_56470);\n                                \n                                eta_p_56469 = defunc_0_op_res_56471;\n                            }\n                        }\n                        if (sle32(wave_sizze_56430, skip_threads_56475)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        if (thread_active_56476) {\n                            // write result\n                            {\n                                ((volatile __local int64_t *) local_mem_56435)[sext_i32_i64(local_tid_56428)] = eta_p_56469;\n                                eta_p_56470 = eta_p_56469;\n                            }\n                        }\n                        if (sle32(wave_sizze_56430, skip_threads_56475)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        skip_threads_56475 *= 2;\n                    }\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            \n            bool no_carry_in_56477 = squot32(local_tid_56428, 32) == 0 || !ltid_in_bounds_56472;\n            \n            // carry-in for every block except the first\n            {\n                // read operands\n                {\n                    if (!no_carry_in_56477) {\n                        eta_p_56466 = eta_p_56465;\n                        eta_p_56465 = ((__local int64_t *) local_mem_56435)[sext_i32_i64(squot32(local_tid_56428, 32)) - (int64_t) 1];\n                    }\n                }\n                // perform operation\n                {\n                    if (!no_car", "ry_in_56477) {\n                        int64_t defunc_0_op_res_56467 = add64(eta_p_56465, eta_p_56466);\n                        \n                        eta_p_56465 = defunc_0_op_res_56467;\n                    }\n                }\n                // write final result\n                {\n                    if (!no_carry_in_56477) {\n                        ((__local int64_t *) local_mem_56435)[sext_i32_i64(local_tid_56428)] = eta_p_56465;\n                    }\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // restore correct values for first block\n            {\n                if (squot32(local_tid_56428, 32) == 0 && ltid_in_bounds_56472) {\n                    ((__local int64_t *) local_mem_56435)[sext_i32_i64(local_tid_56428)] = eta_p_56466;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            barrier(CLK_LOCAL_MEM_FENCE);\n            if (local_tid_56428 == 0) {\n                acc_56468 = ((__local int64_t *) local_mem_56435)[segscan_tblock_sizze_48897 - (int64_t) 1];\n            } else {\n                acc_56468 = ((__local int64_t *) local_mem_56435)[sext_i32_i64(local_tid_56428) - (int64_t) 1];\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n        }\n        prefix_56478 = (int64_t) 0;\n        block_new_sgm_56479 = sgm_idx_56447 == (int64_t) 0;\n        // Perform lookback\n        {\n            if (block_new_sgm_56479 && local_tid_56428 == 0) {\n                ((volatile __global int64_t *) incprefixes_mem_56423)[dynamic_id_56445] = acc_56468;\n                mem_fence_global();\n                ((volatile __global int8_t *) status_flags_mem_56419)[dynamic_id_56445] = (int8_t) 2;\n                acc_56468 = (int64_t) 0;\n            }\n            if (!block_new_sgm_56479 && slt32(local_tid_56428, wave_sizze_56430)) {\n                if (local_tid_56428 == 0) {\n                    ((volatile __global int64_t *) aggregates_mem_56421)[dynamic_id_56445] = acc_56468;\n                    mem_", "fence_global();\n                    ((volatile __global int8_t *) status_flags_mem_56419)[dynamic_id_56445] = (int8_t) 1;\n                    \n                    int8_t tmp_56480 = ((volatile __global int8_t *) status_flags_mem_56419)[dynamic_id_56445 - (int64_t) 1];\n                    \n                    ((volatile __local int8_t *) local_mem_56435)[(int64_t) 0] = tmp_56480;\n                }\n                mem_fence_local();\n                \n                int8_t status_56481 = ((__local int8_t *) local_mem_56435)[(int64_t) 0];\n                \n                if (status_56481 == (int8_t) 2) {\n                    if (local_tid_56428 == 0) {\n                        prefix_56478 = ((volatile __global int64_t *) incprefixes_mem_56423)[dynamic_id_56445 - (int64_t) 1];\n                    }\n                } else {\n                    int32_t readOffset_56482 = sext_i64_i32(dynamic_id_56445 - sext_i32_i64(wave_sizze_56430));\n                    \n                    while (slt32(wave_sizze_56430 * -1, readOffset_56482)) {\n                        int32_t read_i_56483 = readOffset_56482 + local_tid_56428;\n                        int64_t aggr_56484 = (int64_t) 0;\n                        int8_t flag_56485 = (int8_t) 0;\n                        \n                        if (sle32(0, read_i_56483)) {\n                            flag_56485 = ((volatile __global int8_t *) status_flags_mem_56419)[sext_i32_i64(read_i_56483)];\n                            if (flag_56485 == (int8_t) 2) {\n                                aggr_56484 = ((volatile __global int64_t *) incprefixes_mem_56423)[sext_i32_i64(read_i_56483)];\n                            } else if (flag_56485 == (int8_t) 1) {\n                                aggr_56484 = ((volatile __global int64_t *) aggregates_mem_56421)[sext_i32_i64(read_i_56483)];\n                            }\n                        }\n                        ((__local int64_t *) local_mem_56435)[(int64_t) 4 + sext_i32_i64(local_tid_56428)] = aggr_56484;\n  ",
                                    "                      ((__local int8_t *) local_mem_56435)[sext_i32_i64(local_tid_56428)] = flag_56485;\n                        flag_56485 = ((__local int8_t *) local_mem_56435)[sext_i32_i64(wave_sizze_56430) - (int64_t) 1];\n                        if (slt8(flag_56485, (int8_t) 2)) {\n                            int8_t flg_x_56489;\n                            int8_t flg_y_56490;\n                            int64_t eta_p_56486;\n                            int64_t eta_p_56487;\n                            int32_t skip_threads_56491;\n                            \n                            // read input for in-block scan\n                            {\n                                flg_y_56490 = ((volatile __local int8_t *) local_mem_56435)[sext_i32_i64(local_tid_56428)];\n                                eta_p_56487 = ((volatile __local int64_t *) local_mem_56435)[(int64_t) 4 + sext_i32_i64(local_tid_56428)];\n                                if ((local_tid_56428 - squot32(local_tid_56428, 32) * 32) == 0) {\n                                    eta_p_56486 = eta_p_56487;\n                                    flg_x_56489 = flg_y_56490;\n                                }\n                            }\n                            // in-block scan (hopefully no barriers needed)\n                            {\n                                skip_threads_56491 = 1;\n                                while (slt32(skip_threads_56491, 32)) {\n                                    if (sle32(skip_threads_56491, local_tid_56428 - squot32(local_tid_56428, 32) * 32)) {\n                                        // read operands\n                                        {\n                                            flg_x_56489 = ((volatile __local int8_t *) local_mem_56435)[sext_i32_i64(local_tid_56428) - sext_i32_i64(skip_threads_56491)];\n                                            eta_p_56486 = ((volatile __local int64_t *) local_mem_56435)[(int64_t) 4 + (sext_i32_i64(local_tid_56428) - sext_i32_i64(skip", "_threads_56491))];\n                                        }\n                                        // perform operation\n                                        {\n                                            if (flg_y_56490 == (int8_t) 2 || flg_y_56490 == (int8_t) 0) {\n                                                flg_x_56489 = flg_y_56490;\n                                                eta_p_56486 = eta_p_56487;\n                                            } else {\n                                                int64_t defunc_0_op_res_56488 = add64(eta_p_56486, eta_p_56487);\n                                                \n                                                eta_p_56486 = defunc_0_op_res_56488;\n                                            }\n                                        }\n                                        // write result\n                                        {\n                                            ((volatile __local int8_t *) local_mem_56435)[sext_i32_i64(local_tid_56428)] = flg_x_56489;\n                                            flg_y_56490 = flg_x_56489;\n                                            ((volatile __local int64_t *) local_mem_56435)[(int64_t) 4 + sext_i32_i64(local_tid_56428)] = eta_p_56486;\n                                            eta_p_56487 = eta_p_56486;\n                                        }\n                                    }\n                                    skip_threads_56491 *= 2;\n                                }\n                            }\n                        }\n                        flag_56485 = ((__local int8_t *) local_mem_56435)[sext_i32_i64(wave_sizze_56430) - (int64_t) 1];\n                        aggr_56484 = ((__local int64_t *) local_mem_56435)[(int64_t) 4 + (sext_i32_i64(wave_sizze_56430) - (int64_t) 1)];\n                        if (flag_56485 == (int8_t) 2) {\n                            readOffset_56482 = wave_sizze_56430 * -1;\n                        } else if (flag_56485 == ", "(int8_t) 1) {\n                            readOffset_56482 -= wave_sizze_56430;\n                        }\n                        if (slt8((int8_t) 0, flag_56485)) {\n                            int64_t eta_p_56492 = aggr_56484;\n                            int64_t eta_p_56493 = prefix_56478;\n                            int64_t defunc_0_op_res_56494 = add64(eta_p_56492, eta_p_56493);\n                            \n                            prefix_56478 = defunc_0_op_res_56494;\n                        }\n                        mem_fence_local();\n                    }\n                }\n                if (local_tid_56428 == 0) {\n                    if (boundary_56448 == sext_i64_i32(segscan_tblock_sizze_48897 * chunk_sizze_56416)) {\n                        int64_t eta_p_56495 = prefix_56478;\n                        int64_t eta_p_56496 = acc_56468;\n                        int64_t defunc_0_op_res_56497 = add64(eta_p_56495, eta_p_56496);\n                        \n                        ((volatile __global int64_t *) incprefixes_mem_56423)[dynamic_id_56445] = defunc_0_op_res_56497;\n                        mem_fence_global();\n                        ((volatile __global int8_t *) status_flags_mem_56419)[dynamic_id_56445] = (int8_t) 2;\n                    }\n                    ((__local int64_t *) local_mem_56435)[(int64_t) 4] = prefix_56478;\n                    acc_56468 = (int64_t) 0;\n                }\n            }\n            if (!(dynamic_id_56445 == (int64_t) 0)) {\n                barrier(CLK_LOCAL_MEM_FENCE);\n                prefix_56478 = ((__local int64_t *) local_mem_56435)[(int64_t) 4];\n                barrier(CLK_LOCAL_MEM_FENCE);\n            }\n        }\n        // Distribute results\n        {\n            int64_t eta_p_56498;\n            int64_t eta_p_56499;\n            int64_t eta_p_56501 = prefix_56478;\n            int64_t eta_p_56502 = acc_56468;\n            \n            if (slt32(local_tid_56428 * chunk_sizze_32b_56432, boundary_56448) && !block_new_sgm_56479) ",
                                    "{\n                int64_t defunc_0_op_res_56503 = add64(eta_p_56501, eta_p_56502);\n                \n                eta_p_56498 = defunc_0_op_res_56503;\n            } else {\n                eta_p_56498 = acc_56468;\n            }\n            \n            int32_t stopping_point_56504 = segsizze_compact_56449 - srem32(local_tid_56428 * chunk_sizze_32b_56432 - 1 + segsizze_compact_56449 - boundary_56448, segsizze_compact_56449);\n            \n            for (int64_t i_56505 = 0; i_56505 < chunk_sizze_56416; i_56505++) {\n                if (slt32(sext_i64_i32(i_56505), stopping_point_56504 - 1)) {\n                    eta_p_56499 = private_mem_56450[i_56505];\n                    \n                    int64_t defunc_0_op_res_56500 = add64(eta_p_56498, eta_p_56499);\n                    \n                    private_mem_56450[i_56505] = defunc_0_op_res_56500;\n                }\n            }\n        }\n        // Transpose scan output and Write it to global memory in coalesced fashion\n        {\n            for (int64_t i_56506 = 0; i_56506 < chunk_sizze_56416; i_56506++) {\n                int64_t sharedIdx_56507 = sext_i32_i64(local_tid_56428) * chunk_sizze_56416 + i_56506;\n                int64_t tmp_56508 = private_mem_56450[i_56506];\n                \n                ((__local int64_t *) local_mem_56435)[sharedIdx_56507] = tmp_56508;\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            for (int64_t i_56509 = 0; i_56509 < chunk_sizze_56416; i_56509++) {\n                int64_t flat_idx_56510 = thd_offset_56452 + i_56509 * segscan_tblock_sizze_48897;\n                int64_t slice_56511 = m_44319;\n                int64_t gtid_48901 = flat_idx_56510;\n                int64_t remnant_56512 = flat_idx_56510 - gtid_48901;\n                \n                if (slt64(flat_idx_56510, m_44319)) {\n                    int64_t tmp_56513 = ((__local int64_t *) local_mem_56435)[flat_idx_56510 - block_offset_56446];\n                    \n                    ((__global int64_t *) me", "m_54247)[gtid_48901] = tmp_56513;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n        }\n    }\n    \n  error_3:\n    return;\n    #undef segscan_tblock_sizze_48897\n    #undef chunk_sizze_56416\n}\nFUTHARK_KERNEL_SIZED(get_num_neighbours_against_10103zisegmap_49384_dim1, 1, 1)\nvoid get_num_neighbours_against_10103zisegmap_49384(__global int *global_failure, int8_t angle_t_29598, int64_t inf_29626, int64_t dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_29632, __global unsigned char *dat1_mem_53506, __global unsigned char *dat1_mem_53507, __global unsigned char *mem_53517, __global unsigned char *mem_53519, __global unsigned char *mem_53521)\n{\n    #define segmap_tblock_sizze_49378 (get_num_neighbours_against_10103zisegmap_49384zisegmap_tblock_sizze_49378)\n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_54583;\n    int32_t tblock_sizze_54586;\n    int32_t wave_sizze_54585;\n    int32_t block_id_54584;\n    int32_t global_tid_54582;\n    int64_t phys_tid_49384;\n    int64_t global_tid_54587;\n    int64_t slice_54588;\n    int64_t gtid_49383;\n    int64_t remnant_54589;\n    \n    local_tid_54583 = get_local_id(0);\n    tblock_sizze_54586 = get_local_size(0);\n    wave_sizze_54585 = LOCKSTEP_WIDTH;\n    block_id_54584 = get_tblock_id(0);\n    global_tid_54582 = block_id_54584 * tblock_sizze_54586 + local_tid_54583;\n    phys_tid_49384 = sext_i32_i64(global_tid_54582);\n    global_tid_54587 = sext_i32_i64(block_id_54584) * segmap_tblock_sizze_49378 + sext_i32_i64(local_tid_54583);\n    slice_54588 = dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_29632;\n    gtid_49383 = global_tid_54587;\n    remnant_54589 = global_tid_54587 - gtid_49383;\n    if (slt64(gtid_49383, dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_29632)) {\n        int64_t slice_49680;\n        double eta_p_49385;\n        double eta_p_49386;\n        double zt_res_49387;\n        double zt_res_49388;\n        double zs_res_49389;\n        double zs_res_49390;\n        double d_haversine_res_49391;\n        double d_haversine_r", "es_49392;\n        double cos_res_49393;\n        \n        slice_49680 = inf_29626 + gtid_49383;\n        eta_p_49385 = ((__global double *) dat1_mem_53506)[slice_49680];\n        eta_p_49386 = ((__global double *) dat1_mem_53507)[slice_49680];\n        zt_res_49387 = 3.141592653589793 * eta_p_49385;\n        zt_res_49388 = 3.141592653589793 * eta_p_49386;\n        zs_res_49389 = zt_res_49387 / 180.0;\n        zs_res_49390 = zt_res_49388 / 180.0;\n        if (angle_t_29598 == (int8_t) 1) {\n            d_haversine_res_49391 = eta_p_49385;\n        } else {\n            d_haversine_res_49391 = zs_res_49389;\n        }\n        if (angle_t_29598 == (int8_t) 1) {\n            d_haversine_res_49392 = eta_p_49386;\n        } else {\n            d_haversine_res_49392 = zs_res_49390;\n        }\n        cos_res_49393 = futrts_cos64(d_haversine_res_49391);\n        ((__global double *) mem_53517)[gtid_49383] = d_haversine_res_49391;\n        ((__global double *) mem_53519)[gtid_49383] = d_haversine_res_49392;\n        ((__global double *) mem_53521)[gtid_49383] = cos_res_49393;\n    }\n    \n  error_0:\n    return;\n    #undef segmap_tblock_sizze_49378\n}\nFUTHARK_KERNEL_SIZED(get_num_neighbours_against_10103zisegmap_intrablock_49824_dim1, 1, 1)\nvoid get_num_neighbours_against_10103zisegmap_intrablock_49824(__global int *global_failure, int64_t n2_29591, double eps_29596, int8_t dist_t_29597, int8_t angle_t_29598, double radius_29599, int64_t inf_29626, int64_t dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_29632, int64_t ldim_49827, int64_t num_whole_tiles_49871, int64_t residual_input_50060, unsigned char cond_50061_bits, int64_t binop_x_50074, __global unsigned char *dat1_mem_53506, __global unsigned char *dat1_mem_53507, __global unsigned char *dat2_mem_53508, __global unsigned char *dat2_mem_53509, __global unsigned char *mem_53511)\n{\n    bool cond_50061 = cond_50061_bits;\n    \n    #define tile_sizze_49826 (get_num_neighbours_against_10103zisegmap_intrablock_49824zitile_sizze_49826)\n    #define bytes_53551 (ge",
                                    "t_num_neighbours_against_10103zisegmap_intrablock_49824zibytes_53551)\n    \n    volatile __local unsigned char *color_54517_backing_1 = &shared_mem[0];\n    const int64_t color_54517_backing_1_offset = 0 + (bytes_53551 + srem64((int64_t) 8 - srem64(bytes_53551, (int64_t) 8), (int64_t) 8));\n    volatile __local unsigned char *color_54516_backing_0 = &shared_mem[color_54517_backing_1_offset];\n    const int64_t color_54516_backing_0_offset = color_54517_backing_1_offset + (bytes_53551 + srem64((int64_t) 8 - srem64(bytes_53551, (int64_t) 8), (int64_t) 8));\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_54567;\n    int32_t tblock_sizze_54570;\n    int32_t wave_sizze_54569;\n    int32_t block_id_54568;\n    int32_t global_tid_54566;\n    int64_t gid_flat_49824;\n    int64_t slice_54572;\n    int64_t ltid_pre_54571;\n    int64_t remnant_54573;\n    int64_t slice_54574;\n    int64_t gid_49823;\n    int64_t remnant_54575;\n    __local unsigned char *color_54516;\n    __local unsigned char *color_54517;\n    int64_t binop_x_49842;\n    double mem_53529[1];\n    double mem_53533[1];\n    double mem_53537[1];\n    double mem_53541[1];\n    double mem_53545[1];\n    int64_t ltid_flat_49829;\n    int64_t ltid_49828;\n    int64_t gtid_49843;\n    bool cond_49844;\n    double pre_49845;\n    double pre_49846;\n    double pre_49847;\n    double pre_49848;\n    double pre_49849;\n    int64_t mem_53549[1];\n    int64_t ltid_flat_49873;\n    int64_t ltid_49872;\n    int64_t ext_mem_53559[1];\n    int64_t mem_param_53550[1];\n    int64_t mem_53567[1];\n    int64_t ext_mem_53568[1];\n    \n    local_tid_54567 = get_local_id(0);\n    tblock_sizze_54570 = get_local_size(0);\n    wave_sizze_54569 = LOCKSTEP_WIDTH;\n    block_id_54568 = get_tblock_id(0);\n    global_tid_54566 = block_id_54568 * tblock_sizze_54570 + local_tid_54567;\n    gid_flat_49824 = sext_i32_i64(block_id_54568);\n    slice_54572 = tile_sizze_49826;\n    ltid_pre_54571 = sext_i32_i64(local_tid_54567);\n    remnant_54573 = sext_i32_i64(lo", "cal_tid_54567) - ltid_pre_54571;\n    slice_54574 = ldim_49827;\n    gid_49823 = sext_i32_i64(block_id_54568);\n    remnant_54575 = sext_i32_i64(block_id_54568) - gid_49823;\n    color_54516 = (__local unsigned char *) color_54516_backing_0;\n    color_54517 = (__local unsigned char *) color_54517_backing_1;\n    binop_x_49842 = gid_49823 * tile_sizze_49826;\n    ltid_flat_49829 = sext_i32_i64(local_tid_54567);\n    ltid_49828 = sext_i32_i64(sext_i64_i32(ltid_pre_54571));\n    gtid_49843 = ltid_49828 + binop_x_49842;\n    cond_49844 = slt64(gtid_49843, dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_29632);\n    if (cond_49844) {\n        int64_t slice_49850;\n        double eta_p_49851;\n        double eta_p_49853;\n        double zt_res_49854;\n        double zt_res_49855;\n        double zs_res_49856;\n        double zs_res_49857;\n        double d_haversine_res_49858;\n        double d_haversine_res_49859;\n        double cos_res_49860;\n        \n        slice_49850 = inf_29626 + gtid_49843;\n        eta_p_49851 = ((__global double *) dat1_mem_53506)[slice_49850];\n        eta_p_49853 = ((__global double *) dat1_mem_53507)[slice_49850];\n        zt_res_49854 = 3.141592653589793 * eta_p_49851;\n        zt_res_49855 = 3.141592653589793 * eta_p_49853;\n        zs_res_49856 = zt_res_49854 / 180.0;\n        zs_res_49857 = zt_res_49855 / 180.0;\n        if (angle_t_29598 == (int8_t) 1) {\n            d_haversine_res_49858 = eta_p_49851;\n        } else {\n            d_haversine_res_49858 = zs_res_49856;\n        }\n        if (angle_t_29598 == (int8_t) 1) {\n            d_haversine_res_49859 = eta_p_49853;\n        } else {\n            d_haversine_res_49859 = zs_res_49857;\n        }\n        cos_res_49860 = futrts_cos64(d_haversine_res_49858);\n        pre_49845 = eta_p_49851;\n        pre_49846 = eta_p_49853;\n        pre_49847 = d_haversine_res_49858;\n        pre_49848 = d_haversine_res_49859;\n        pre_49849 = cos_res_49860;\n    } else {\n        pre_49845 = 0.0;\n        pre_49846 = 0.0;\n        pre_49847 = 0.0;\n   ", "     pre_49848 = 0.0;\n        pre_49849 = 0.0;\n    }\n    mem_53529[(int64_t) 0] = pre_49845;\n    mem_53533[(int64_t) 0] = pre_49846;\n    mem_53537[(int64_t) 0] = pre_49847;\n    mem_53541[(int64_t) 0] = pre_49848;\n    mem_53545[(int64_t) 0] = pre_49849;\n    barrier(CLK_LOCAL_MEM_FENCE);\n    ltid_flat_49873 = sext_i32_i64(local_tid_54567);\n    ltid_49872 = sext_i32_i64(sext_i64_i32(ltid_pre_54571));\n    mem_53549[(int64_t) 0] = (int64_t) 0;\n    barrier(CLK_LOCAL_MEM_FENCE);\n    barrier(CLK_LOCAL_MEM_FENCE);\n    for (int32_t i_2 = 0; i_2 < 1; i_2++)\n        mem_param_53550[i_2] = mem_53549[i_2];\n    for (int64_t tile_id_49879 = 0; tile_id_49879 < num_whole_tiles_49871; tile_id_49879++) {\n        int64_t binop_x_49965;\n        int64_t ltid_flat_49964;\n        int64_t ltid_49963;\n        int64_t j_49966;\n        bool cond_49974;\n        double pre1d_49975;\n        double pre1d_49976;\n        int64_t mem_53558[1];\n        int64_t ltid_flat_49983;\n        int64_t ltid_49982;\n        int64_t gtid_49985;\n        int64_t acc_49991;\n        bool cond_49992;\n        int64_t acc_49993;\n        int64_t mem_param_tmp_54576[1];\n        \n        binop_x_49965 = tile_sizze_49826 * tile_id_49879;\n        ltid_flat_49964 = sext_i32_i64(local_tid_54567);\n        ltid_49963 = sext_i32_i64(sext_i64_i32(ltid_pre_54571));\n        j_49966 = ltid_49963 + binop_x_49965;\n        cond_49974 = slt64(j_49966, n2_29591);\n        if (cond_49974) {\n            double tile_elem_49977;\n            double tile_elem_49978;\n            \n            tile_elem_49977 = ((__global double *) dat2_mem_53508)[j_49966];\n            tile_elem_49978 = ((__global double *) dat2_mem_53509)[j_49966];\n            pre1d_49975 = tile_elem_49977;\n            pre1d_49976 = tile_elem_49978;\n        } else {\n            pre1d_49975 = 0.0;\n            pre1d_49976 = 0.0;\n        }\n        ((__local double *) color_54516)[ltid_49963] = pre1d_49975;\n        ((__local double *) color_54517)[ltid_49963] = pre1d_49976;\n        barr",
                                    "ier(CLK_LOCAL_MEM_FENCE);\n        ltid_flat_49983 = sext_i32_i64(local_tid_54567);\n        ltid_49982 = sext_i32_i64(sext_i64_i32(ltid_pre_54571));\n        gtid_49985 = binop_x_49842 + ltid_49982;\n        acc_49991 = mem_param_53550[(int64_t) 0];\n        cond_49992 = slt64(gtid_49985, dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_29632);\n        if (cond_49992) {\n            double eta_p_49986;\n            double eta_p_49987;\n            double d_haversine_res_49988;\n            double d_haversine_res_49989;\n            double cos_res_49990;\n            int64_t x_49994;\n            int64_t redout_53108;\n            \n            eta_p_49986 = mem_53529[(int64_t) 0];\n            eta_p_49987 = mem_53533[(int64_t) 0];\n            d_haversine_res_49988 = mem_53537[(int64_t) 0];\n            d_haversine_res_49989 = mem_53541[(int64_t) 0];\n            cos_res_49990 = mem_53545[(int64_t) 0];\n            redout_53108 = acc_49991;\n            for (int64_t i_53109 = 0; i_53109 < tile_sizze_49826; i_53109++) {\n                double eta_p_49995;\n                double eta_p_49996;\n                double dist_res_49997;\n                bool zlze_res_50022;\n                int64_t bool_res_50023;\n                int64_t zp_res_50026;\n                int64_t redout_tmp_54578;\n                \n                eta_p_49995 = ((__local double *) color_54516)[i_53109];\n                eta_p_49996 = ((__local double *) color_54517)[i_53109];\n                if (dist_t_29597 == (int8_t) 0) {\n                    double zm_res_49998;\n                    double zm_res_49999;\n                    double hypot_res_50000;\n                    \n                    zm_res_49998 = eta_p_49987 - eta_p_49996;\n                    zm_res_49999 = eta_p_49986 - eta_p_49995;\n                    hypot_res_50000 = futrts_hypot64(zm_res_49999, zm_res_49998);\n                    dist_res_49997 = hypot_res_50000;\n                } else {\n                    double d_haversine_res_50001;\n                    double d_haversi", "ne_res_50002;\n                    double zm_res_50007;\n                    double cos_res_50008;\n                    double zm_res_50009;\n                    double cos_res_50010;\n                    double zt_res_50011;\n                    double zm_res_50012;\n                    double zm_res_50013;\n                    double zt_res_50014;\n                    double zp_res_50015;\n                    double zs_res_50016;\n                    double min_res_50017;\n                    double zt_res_50018;\n                    double zm_res_50019;\n                    double acos_res_50020;\n                    double zt_res_50021;\n                    \n                    if (angle_t_29598 == (int8_t) 1) {\n                        d_haversine_res_50001 = eta_p_49995;\n                        d_haversine_res_50002 = eta_p_49996;\n                    } else {\n                        double zt_res_50003;\n                        double zs_res_50004;\n                        double zt_res_50005;\n                        double zs_res_50006;\n                        \n                        zt_res_50003 = 3.141592653589793 * eta_p_49995;\n                        zs_res_50004 = zt_res_50003 / 180.0;\n                        zt_res_50005 = 3.141592653589793 * eta_p_49996;\n                        zs_res_50006 = zt_res_50005 / 180.0;\n                        d_haversine_res_50001 = zs_res_50004;\n                        d_haversine_res_50002 = zs_res_50006;\n                    }\n                    zm_res_50007 = d_haversine_res_49988 - d_haversine_res_50001;\n                    cos_res_50008 = futrts_cos64(zm_res_50007);\n                    zm_res_50009 = 1.0 - cos_res_50008;\n                    cos_res_50010 = futrts_cos64(d_haversine_res_50001);\n                    zt_res_50011 = cos_res_49990 * cos_res_50010;\n                    zm_res_50012 = d_haversine_res_49989 - d_haversine_res_50002;\n                    zm_res_50013 = 1.0 - zm_res_50012;\n                    zt_res_50014 = zt_res_50", "011 * zm_res_50013;\n                    zp_res_50015 = zm_res_50009 + zt_res_50014;\n                    zs_res_50016 = zp_res_50015 / 2.0;\n                    min_res_50017 = fmin64(1.0, zs_res_50016);\n                    zt_res_50018 = 2.0 * min_res_50017;\n                    zm_res_50019 = 1.0 - zt_res_50018;\n                    acos_res_50020 = futrts_acos64(zm_res_50019);\n                    zt_res_50021 = radius_29599 * acos_res_50020;\n                    dist_res_49997 = zt_res_50021;\n                }\n                zlze_res_50022 = dist_res_49997 <= eps_29596;\n                bool_res_50023 = btoi_bool_i64(zlze_res_50022);\n                zp_res_50026 = add64(bool_res_50023, redout_53108);\n                redout_tmp_54578 = zp_res_50026;\n                redout_53108 = redout_tmp_54578;\n            }\n            x_49994 = redout_53108;\n            acc_49993 = x_49994;\n        } else {\n            acc_49993 = acc_49991;\n        }\n        mem_53558[(int64_t) 0] = acc_49993;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        for (int32_t i_3 = 0; i_3 < 1; i_3++)\n            mem_param_tmp_54576[i_3] = mem_53558[i_3];\n        for (int32_t i_4 = 0; i_4 < 1; i_4++)\n            mem_param_53550[i_4] = mem_param_tmp_54576[i_4];\n    }\n    for (int32_t i_5 = 0; i_5 < 1; i_5++)\n        ext_mem_53559[i_5] = mem_param_53550[i_5];\n    barrier(CLK_LOCAL_MEM_FENCE);\n    if (cond_50061) {\n        for (int32_t i_6 = 0; i_6 < 1; i_6++)\n            ext_mem_53568[i_6] = ext_mem_53559[i_6];\n    } else {\n        int64_t ltid_flat_50063;\n        int64_t ltid_50062;\n        int64_t j_50075;\n        bool cond_50083;\n        double pre1d_50084;\n        double pre1d_50085;\n        int64_t ltid_flat_50095;\n        int64_t ltid_50094;\n        int64_t gtid_50102;\n        int64_t acc_50108;\n        bool cond_50109;\n        int64_t acc_50110;\n        \n        ltid_flat_50063 = sext_i32_i64(local_tid_54567);\n        ltid_50062 = sext_i32_i64(sext_i64_i32(ltid_pre_54571));\n        j_50075 = ltid_500",
                                    "62 + binop_x_50074;\n        cond_50083 = slt64(j_50075, n2_29591);\n        if (cond_50083) {\n            double tile_elem_50086;\n            double tile_elem_50087;\n            \n            tile_elem_50086 = ((__global double *) dat2_mem_53508)[j_50075];\n            tile_elem_50087 = ((__global double *) dat2_mem_53509)[j_50075];\n            pre1d_50084 = tile_elem_50086;\n            pre1d_50085 = tile_elem_50087;\n        } else {\n            pre1d_50084 = 0.0;\n            pre1d_50085 = 0.0;\n        }\n        ((__local double *) color_54517)[ltid_50062] = pre1d_50084;\n        ((__local double *) color_54516)[ltid_50062] = pre1d_50085;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        ltid_flat_50095 = sext_i32_i64(local_tid_54567);\n        ltid_50094 = sext_i32_i64(sext_i64_i32(ltid_pre_54571));\n        gtid_50102 = binop_x_49842 + ltid_50094;\n        acc_50108 = ext_mem_53559[(int64_t) 0];\n        cond_50109 = slt64(gtid_50102, dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_29632);\n        if (cond_50109) {\n            double eta_p_50103;\n            double eta_p_50104;\n            double d_haversine_res_50105;\n            double d_haversine_res_50106;\n            double cos_res_50107;\n            int64_t x_50111;\n            int64_t redout_53110;\n            \n            eta_p_50103 = mem_53529[(int64_t) 0];\n            eta_p_50104 = mem_53533[(int64_t) 0];\n            d_haversine_res_50105 = mem_53537[(int64_t) 0];\n            d_haversine_res_50106 = mem_53541[(int64_t) 0];\n            cos_res_50107 = mem_53545[(int64_t) 0];\n            redout_53110 = acc_50108;\n            for (int64_t i_53111 = 0; i_53111 < residual_input_50060; i_53111++) {\n                double eta_p_50112;\n                double eta_p_50113;\n                double dist_res_50114;\n                bool zlze_res_50139;\n                int64_t bool_res_50140;\n                int64_t zp_res_50143;\n                int64_t redout_tmp_54579;\n                \n                eta_p_50112 = ((__local double *) color_5", "4517)[i_53111];\n                eta_p_50113 = ((__local double *) color_54516)[i_53111];\n                if (dist_t_29597 == (int8_t) 0) {\n                    double zm_res_50115;\n                    double zm_res_50116;\n                    double hypot_res_50117;\n                    \n                    zm_res_50115 = eta_p_50104 - eta_p_50113;\n                    zm_res_50116 = eta_p_50103 - eta_p_50112;\n                    hypot_res_50117 = futrts_hypot64(zm_res_50116, zm_res_50115);\n                    dist_res_50114 = hypot_res_50117;\n                } else {\n                    double d_haversine_res_50118;\n                    double d_haversine_res_50119;\n                    double zm_res_50124;\n                    double cos_res_50125;\n                    double zm_res_50126;\n                    double cos_res_50127;\n                    double zt_res_50128;\n                    double zm_res_50129;\n                    double zm_res_50130;\n                    double zt_res_50131;\n                    double zp_res_50132;\n                    double zs_res_50133;\n                    double min_res_50134;\n                    double zt_res_50135;\n                    double zm_res_50136;\n                    double acos_res_50137;\n                    double zt_res_50138;\n                    \n                    if (angle_t_29598 == (int8_t) 1) {\n                        d_haversine_res_50118 = eta_p_50112;\n                        d_haversine_res_50119 = eta_p_50113;\n                    } else {\n                        double zt_res_50120;\n                        double zs_res_50121;\n                        double zt_res_50122;\n                        double zs_res_50123;\n                        \n                        zt_res_50120 = 3.141592653589793 * eta_p_50112;\n                        zs_res_50121 = zt_res_50120 / 180.0;\n                        zt_res_50122 = 3.141592653589793 * eta_p_50113;\n                        zs_res_50123 = zt_res_50122 / 180.0;\n           ", "             d_haversine_res_50118 = zs_res_50121;\n                        d_haversine_res_50119 = zs_res_50123;\n                    }\n                    zm_res_50124 = d_haversine_res_50105 - d_haversine_res_50118;\n                    cos_res_50125 = futrts_cos64(zm_res_50124);\n                    zm_res_50126 = 1.0 - cos_res_50125;\n                    cos_res_50127 = futrts_cos64(d_haversine_res_50118);\n                    zt_res_50128 = cos_res_50107 * cos_res_50127;\n                    zm_res_50129 = d_haversine_res_50106 - d_haversine_res_50119;\n                    zm_res_50130 = 1.0 - zm_res_50129;\n                    zt_res_50131 = zt_res_50128 * zm_res_50130;\n                    zp_res_50132 = zm_res_50126 + zt_res_50131;\n                    zs_res_50133 = zp_res_50132 / 2.0;\n                    min_res_50134 = fmin64(1.0, zs_res_50133);\n                    zt_res_50135 = 2.0 * min_res_50134;\n                    zm_res_50136 = 1.0 - zt_res_50135;\n                    acos_res_50137 = futrts_acos64(zm_res_50136);\n                    zt_res_50138 = radius_29599 * acos_res_50137;\n                    dist_res_50114 = zt_res_50138;\n                }\n                zlze_res_50139 = dist_res_50114 <= eps_29596;\n                bool_res_50140 = btoi_bool_i64(zlze_res_50139);\n                zp_res_50143 = add64(bool_res_50140, redout_53110);\n                redout_tmp_54579 = zp_res_50143;\n                redout_53110 = redout_tmp_54579;\n            }\n            x_50111 = redout_53110;\n            acc_50110 = x_50111;\n        } else {\n            acc_50110 = acc_50108;\n        }\n        mem_53567[(int64_t) 0] = acc_50110;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        for (int32_t i_7 = 0; i_7 < 1; i_7++)\n            ext_mem_53568[i_7] = mem_53567[i_7];\n    }\n    if (slt64(sext_i32_i64(local_tid_54567) + tile_sizze_49826 * sext_i32_i64(block_id_54568), dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_29632)) {\n        int64_t tmp_54580 = ext_mem_53568[(int64_t) 0];\n        \n     ",
                                    "   ((__global int64_t *) mem_53511)[inf_29626 + (sext_i32_i64(local_tid_54567) + tile_sizze_49826 * sext_i32_i64(block_id_54568))] = tmp_54580;\n    }\n    \n  error_8:\n    return;\n    #undef tile_sizze_49826\n    #undef bytes_53551\n}\nFUTHARK_KERNEL_SIZED(get_num_neighbours_against_10103zisegred_large_49402_dim1, 1, 1)\nvoid get_num_neighbours_against_10103zisegred_large_49402(__global int *global_failure, int64_t n2_29591, double eps_29596, int8_t dist_t_29597, int8_t angle_t_29598, double radius_29599, int64_t inf_29626, int64_t dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_29632, int64_t num_tblocks_49397, unsigned char x_53480_bits, int64_t blocks_per_segment_54619, int64_t q_54620, int64_t num_virtblocks_54621, int64_t threads_per_segment_54622, __global unsigned char *dat1_mem_53506, __global unsigned char *dat1_mem_53507, __global unsigned char *dat2_mem_53508, __global unsigned char *dat2_mem_53509, __global unsigned char *mem_53511, __global unsigned char *mem_53517, __global unsigned char *mem_53519, __global unsigned char *mem_53521, __global unsigned char *segred_tmp_mem_54623, __global unsigned char *counters_mem_54625)\n{\n    bool x_53480 = x_53480_bits;\n    \n    #define segred_tblock_sizze_49396 (get_num_neighbours_against_10103zisegred_large_49402zisegred_tblock_sizze_49396)\n    #define chunk_sizze_54590 (get_num_neighbours_against_10103zisegred_large_49402zichunk_sizze_54590)\n    \n    volatile __local unsigned char *sync_arr_mem_54654_backing_1 = &shared_mem[0];\n    const int64_t sync_arr_mem_54654_backing_1_offset = 0 + 8;\n    volatile __local unsigned char *red_arr_i64_mem_54652_backing_0 = &shared_mem[sync_arr_mem_54654_backing_1_offset];\n    const int64_t red_arr_i64_mem_54652_backing_0_offset = sync_arr_mem_54654_backing_1_offset + ((int64_t) 8 * segred_tblock_sizze_49396 + srem64((int64_t) 8 - srem64((int64_t) 8 * segred_tblock_sizze_49396, (int64_t) 8), (int64_t) 8));\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_54648;\n    int3", "2_t tblock_sizze_54651;\n    int32_t wave_sizze_54650;\n    int32_t block_id_54649;\n    int32_t global_tid_54647;\n    int64_t phys_tid_49402;\n    __local unsigned char *red_arr_i64_mem_54652;\n    __local unsigned char *sync_arr_mem_54654;\n    int32_t phys_tblock_id_54656;\n    int32_t iterations_54657;\n    \n    local_tid_54648 = get_local_id(0);\n    tblock_sizze_54651 = get_local_size(0);\n    wave_sizze_54650 = LOCKSTEP_WIDTH;\n    block_id_54649 = get_tblock_id(0);\n    global_tid_54647 = block_id_54649 * tblock_sizze_54651 + local_tid_54648;\n    phys_tid_49402 = sext_i32_i64(global_tid_54647);\n    red_arr_i64_mem_54652 = (__local unsigned char *) red_arr_i64_mem_54652_backing_0;\n    sync_arr_mem_54654 = (__local unsigned char *) sync_arr_mem_54654_backing_1;\n    phys_tblock_id_54656 = get_tblock_id(0);\n    iterations_54657 = sdiv_up32(sext_i64_i32(num_virtblocks_54621) - phys_tblock_id_54656, sext_i64_i32(num_tblocks_49397));\n    for (int32_t i_54658 = 0; i_54658 < iterations_54657; i_54658++) {\n        int32_t virt_tblock_id_54659;\n        int64_t flat_segment_id_54660;\n        int64_t global_tid_54661;\n        int64_t slice_54662;\n        int64_t gtid_49400;\n        int64_t remnant_54663;\n        int64_t gtid_49401;\n        int64_t eta_p_block_res_acc_54664;\n        int64_t eta_p_49403;\n        int64_t eta_p_49404;\n        int64_t tblock_id_in_segment_54668;\n        int64_t block_base_offset_54669;\n        int32_t offset_54672;\n        int32_t skip_waves_54673;\n        int64_t eta_p_54665;\n        int64_t eta_p_54666;\n        \n        virt_tblock_id_54659 = phys_tblock_id_54656 + i_54658 * sext_i64_i32(num_tblocks_49397);\n        flat_segment_id_54660 = squot64(sext_i32_i64(virt_tblock_id_54659), blocks_per_segment_54619);\n        global_tid_54661 = srem64(sext_i32_i64(virt_tblock_id_54659) * segred_tblock_sizze_49396 + sext_i32_i64(local_tid_54648), threads_per_segment_54622);\n        slice_54662 = dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_29632;\n        gtid_49400 = flat_s", "egment_id_54660;\n        remnant_54663 = flat_segment_id_54660 - gtid_49400;\n        // ne-initialise the outer (per-block) accumulator(s)\n        {\n            eta_p_block_res_acc_54664 = (int64_t) 0;\n        }\n        tblock_id_in_segment_54668 = squot64(global_tid_54661, segred_tblock_sizze_49396);\n        block_base_offset_54669 = tblock_id_in_segment_54668 * q_54620 * segred_tblock_sizze_49396;\n        for (int64_t i_54670 = 0; i_54670 < q_54620; i_54670++) {\n            int64_t block_offset_54671 = block_base_offset_54669 + i_54670 * segred_tblock_sizze_49396;\n            \n            gtid_49401 = global_tid_54661 + threads_per_segment_54622 * i_54670;\n            if (slt64(gtid_49401, n2_29591)) {\n                // apply map function(s)\n                {\n                    // apply map function\n                    {\n                        int64_t slice_49678 = inf_29626 + gtid_49400;\n                        double eta_p_49411 = ((__global double *) dat2_mem_53508)[gtid_49401];\n                        double eta_p_49412 = ((__global double *) dat2_mem_53509)[gtid_49401];\n                        double d_haversine_res_49408;\n                        \n                        if (x_53480) {\n                            double x_53482 = ((__global double *) mem_53517)[gtid_49400];\n                            \n                            d_haversine_res_49408 = x_53482;\n                        } else {\n                            d_haversine_res_49408 = 0.0;\n                        }\n                        \n                        double d_haversine_res_49409;\n                        \n                        if (x_53480) {\n                            double x_53484 = ((__global double *) mem_53519)[gtid_49400];\n                            \n                            d_haversine_res_49409 = x_53484;\n                        } else {\n                            d_haversine_res_49409 = 0.0;\n                        }\n                        \n                        d",
                                    "ouble cos_res_49410;\n                        \n                        if (x_53480) {\n                            double x_53486 = ((__global double *) mem_53521)[gtid_49400];\n                            \n                            cos_res_49410 = x_53486;\n                        } else {\n                            cos_res_49410 = 0.0;\n                        }\n                        \n                        double dist_res_49413;\n                        \n                        if (dist_t_29597 == (int8_t) 0) {\n                            double eta_p_49406 = ((__global double *) dat1_mem_53506)[slice_49678];\n                            double eta_p_49407 = ((__global double *) dat1_mem_53507)[slice_49678];\n                            double zm_res_49414 = eta_p_49407 - eta_p_49412;\n                            double zm_res_49415 = eta_p_49406 - eta_p_49411;\n                            double hypot_res_49416 = futrts_hypot64(zm_res_49415, zm_res_49414);\n                            \n                            dist_res_49413 = hypot_res_49416;\n                        } else {\n                            double d_haversine_res_49417;\n                            double d_haversine_res_49418;\n                            \n                            if (angle_t_29598 == (int8_t) 1) {\n                                d_haversine_res_49417 = eta_p_49411;\n                                d_haversine_res_49418 = eta_p_49412;\n                            } else {\n                                double zt_res_49419 = 3.141592653589793 * eta_p_49411;\n                                double zs_res_49420 = zt_res_49419 / 180.0;\n                                double zt_res_49421 = 3.141592653589793 * eta_p_49412;\n                                double zs_res_49422 = zt_res_49421 / 180.0;\n                                \n                                d_haversine_res_49417 = zs_res_49420;\n                                d_haversine_res_49418 = zs_res_49422;\n                       ", "     }\n                            \n                            double zm_res_49423 = d_haversine_res_49408 - d_haversine_res_49417;\n                            double cos_res_49424 = futrts_cos64(zm_res_49423);\n                            double zm_res_49425 = 1.0 - cos_res_49424;\n                            double cos_res_49426 = futrts_cos64(d_haversine_res_49417);\n                            double zt_res_49427 = cos_res_49410 * cos_res_49426;\n                            double zm_res_49428 = d_haversine_res_49409 - d_haversine_res_49418;\n                            double zm_res_49429 = 1.0 - zm_res_49428;\n                            double zt_res_49430 = zt_res_49427 * zm_res_49429;\n                            double zp_res_49431 = zm_res_49425 + zt_res_49430;\n                            double zs_res_49432 = zp_res_49431 / 2.0;\n                            double min_res_49433 = fmin64(1.0, zs_res_49432);\n                            double zt_res_49434 = 2.0 * min_res_49433;\n                            double zm_res_49435 = 1.0 - zt_res_49434;\n                            double acos_res_49436 = futrts_acos64(zm_res_49435);\n                            double zt_res_49437 = radius_29599 * acos_res_49436;\n                            \n                            dist_res_49413 = zt_res_49437;\n                        }\n                        \n                        bool zlze_res_49438 = dist_res_49413 <= eps_29596;\n                        int64_t bool_res_49439 = btoi_bool_i64(zlze_res_49438);\n                        \n                        // load accumulator(s)\n                        {\n                            eta_p_49403 = eta_p_block_res_acc_54664;\n                        }\n                        // load next value(s)\n                        {\n                            eta_p_49404 = bool_res_49439;\n                        }\n                        // apply reduction operator(s)\n                        {\n                            int64_t zp_res_49405", " = add64(eta_p_49403, eta_p_49404);\n                            \n                            // store in accumulator(s)\n                            {\n                                eta_p_block_res_acc_54664 = zp_res_49405;\n                            }\n                        }\n                    }\n                }\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        // store accs. prims go in lmem; non-prims in params (in global mem)\n        {\n            ((__local int64_t *) red_arr_i64_mem_54652)[sext_i32_i64(local_tid_54648)] = eta_p_block_res_acc_54664;\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        skip_waves_54673 = 1;\n        offset_54672 = 0;\n        // participating threads read initial accumulator\n        {\n            if (slt32(local_tid_54648, sext_i64_i32(segred_tblock_sizze_49396))) {\n                eta_p_54665 = ((__local int64_t *) red_arr_i64_mem_54652)[sext_i32_i64(local_tid_54648 + offset_54672)];\n            }\n        }\n        offset_54672 = 1;\n        while (slt32(offset_54672, wave_sizze_54650)) {\n            if (slt32(local_tid_54648 + offset_54672, sext_i64_i32(segred_tblock_sizze_49396)) && ((local_tid_54648 - squot32(local_tid_54648, wave_sizze_54650) * wave_sizze_54650) & (2 * offset_54672 - 1)) == 0) {\n                // read array element\n                {\n                    eta_p_54666 = ((volatile __local int64_t *) red_arr_i64_mem_54652)[sext_i32_i64(local_tid_54648 + offset_54672)];\n                }\n                // apply reduction operation\n                {\n                    int64_t zp_res_54667 = add64(eta_p_54665, eta_p_54666);\n                    \n                    eta_p_54665 = zp_res_54667;\n                }\n                // write result of operation\n                {\n                    ((volatile __local int64_t *) red_arr_i64_mem_54652)[sext_i32_i64(local_tid_54648)] = eta_p_54665;\n                }\n            }\n            offset_54672 *= 2;\n        }\n        while (slt32(skip_wav",
                                    "es_54673, squot32(sext_i64_i32(segred_tblock_sizze_49396) + wave_sizze_54650 - 1, wave_sizze_54650))) {\n            barrier(CLK_LOCAL_MEM_FENCE);\n            offset_54672 = skip_waves_54673 * wave_sizze_54650;\n            if (slt32(local_tid_54648 + offset_54672, sext_i64_i32(segred_tblock_sizze_49396)) && ((local_tid_54648 - squot32(local_tid_54648, wave_sizze_54650) * wave_sizze_54650) == 0 && (squot32(local_tid_54648, wave_sizze_54650) & (2 * skip_waves_54673 - 1)) == 0)) {\n                // read array element\n                {\n                    eta_p_54666 = ((__local int64_t *) red_arr_i64_mem_54652)[sext_i32_i64(local_tid_54648 + offset_54672)];\n                }\n                // apply reduction operation\n                {\n                    int64_t zp_res_54667 = add64(eta_p_54665, eta_p_54666);\n                    \n                    eta_p_54665 = zp_res_54667;\n                }\n                // write result of operation\n                {\n                    ((__local int64_t *) red_arr_i64_mem_54652)[sext_i32_i64(local_tid_54648)] = eta_p_54665;\n                }\n            }\n            skip_waves_54673 *= 2;\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        barrier(CLK_LOCAL_MEM_FENCE);\n        // thread 0 updates per-block acc(s); rest reset to ne\n        {\n            if (sext_i32_i64(local_tid_54648) == (int64_t) 0) {\n                eta_p_block_res_acc_54664 = eta_p_54665;\n            } else {\n                eta_p_block_res_acc_54664 = (int64_t) 0;\n            }\n        }\n        if (blocks_per_segment_54619 == (int64_t) 1) {\n            // first thread in block saves final result to memory\n            {\n                if (local_tid_54648 == 0) {\n                    ((__global int64_t *) mem_53511)[inf_29626 + gtid_49400] = eta_p_block_res_acc_54664;\n                }\n            }\n        } else {\n            int32_t old_counter_54674;\n            bool is_last_block_54675;\n            \n            // first thread in block saves bloc", "k result to global memory\n            {\n                if (local_tid_54648 == 0) {\n                    ((__global int64_t *) segred_tmp_mem_54623)[sext_i32_i64(virt_tblock_id_54659)] = eta_p_block_res_acc_54664;\n                    mem_fence_global();\n                    old_counter_54674 = atomic_add_i32_global(&((volatile __global int *) counters_mem_54625)[srem64(flat_segment_id_54660, (int64_t) 20480)], (int) 1);\n                    ((__local bool *) sync_arr_mem_54654)[(int64_t) 0] = old_counter_54674 == sext_i64_i32(blocks_per_segment_54619 - (int64_t) 1);\n                }\n            }\n            barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n            is_last_block_54675 = ((__local bool *) sync_arr_mem_54654)[(int64_t) 0];\n            if (is_last_block_54675) {\n                if (local_tid_54648 == 0) {\n                    old_counter_54674 = atomic_add_i32_global(&((volatile __global int *) counters_mem_54625)[srem64(flat_segment_id_54660, (int64_t) 20480)], (int) sext_i64_i32((int64_t) 0 - blocks_per_segment_54619));\n                }\n                // read in the per-block-results\n                {\n                    int64_t read_per_thread_54676 = sdiv_up64(blocks_per_segment_54619, segred_tblock_sizze_49396);\n                    \n                    eta_p_49403 = (int64_t) 0;\n                    for (int64_t i_54677 = 0; i_54677 < read_per_thread_54676; i_54677++) {\n                        int64_t block_res_id_54678 = sext_i32_i64(local_tid_54648) * read_per_thread_54676 + i_54677;\n                        int64_t index_of_block_res_54679 = flat_segment_id_54660 * blocks_per_segment_54619 + block_res_id_54678;\n                        \n                        if (slt64(block_res_id_54678, blocks_per_segment_54619)) {\n                            eta_p_49404 = ((__global int64_t *) segred_tmp_mem_54623)[index_of_block_res_54679];\n                            \n                            int64_t zp_res_49405 = add64(eta_p_49403, eta_p_49404);\n ", "                           \n                            eta_p_49403 = zp_res_49405;\n                        }\n                    }\n                }\n                ((__local int64_t *) red_arr_i64_mem_54652)[sext_i32_i64(local_tid_54648)] = eta_p_49403;\n                barrier(CLK_LOCAL_MEM_FENCE);\n                // reduce the per-block results\n                {\n                    int32_t offset_54680;\n                    int32_t skip_waves_54681 = 1;\n                    int64_t eta_p_54665;\n                    int64_t eta_p_54666;\n                    \n                    offset_54680 = 0;\n                    // participating threads read initial accumulator\n                    {\n                        if (slt32(local_tid_54648, sext_i64_i32(segred_tblock_sizze_49396))) {\n                            eta_p_54665 = ((__local int64_t *) red_arr_i64_mem_54652)[sext_i32_i64(local_tid_54648 + offset_54680)];\n                        }\n                    }\n                    offset_54680 = 1;\n                    while (slt32(offset_54680, wave_sizze_54650)) {\n                        if (slt32(local_tid_54648 + offset_54680, sext_i64_i32(segred_tblock_sizze_49396)) && ((local_tid_54648 - squot32(local_tid_54648, wave_sizze_54650) * wave_sizze_54650) & (2 * offset_54680 - 1)) == 0) {\n                            // read array element\n                            {\n                                eta_p_54666 = ((volatile __local int64_t *) red_arr_i64_mem_54652)[sext_i32_i64(local_tid_54648 + offset_54680)];\n                            }\n                            // apply reduction operation\n                            {\n                                int64_t zp_res_54667 = add64(eta_p_54665, eta_p_54666);\n                                \n                                eta_p_54665 = zp_res_54667;\n                            }\n                            // write result of operation\n                            {\n                                ((volatile __local int64_",
                                    "t *) red_arr_i64_mem_54652)[sext_i32_i64(local_tid_54648)] = eta_p_54665;\n                            }\n                        }\n                        offset_54680 *= 2;\n                    }\n                    while (slt32(skip_waves_54681, squot32(sext_i64_i32(segred_tblock_sizze_49396) + wave_sizze_54650 - 1, wave_sizze_54650))) {\n                        barrier(CLK_LOCAL_MEM_FENCE);\n                        offset_54680 = skip_waves_54681 * wave_sizze_54650;\n                        if (slt32(local_tid_54648 + offset_54680, sext_i64_i32(segred_tblock_sizze_49396)) && ((local_tid_54648 - squot32(local_tid_54648, wave_sizze_54650) * wave_sizze_54650) == 0 && (squot32(local_tid_54648, wave_sizze_54650) & (2 * skip_waves_54681 - 1)) == 0)) {\n                            // read array element\n                            {\n                                eta_p_54666 = ((__local int64_t *) red_arr_i64_mem_54652)[sext_i32_i64(local_tid_54648 + offset_54680)];\n                            }\n                            // apply reduction operation\n                            {\n                                int64_t zp_res_54667 = add64(eta_p_54665, eta_p_54666);\n                                \n                                eta_p_54665 = zp_res_54667;\n                            }\n                            // write result of operation\n                            {\n                                ((__local int64_t *) red_arr_i64_mem_54652)[sext_i32_i64(local_tid_54648)] = eta_p_54665;\n                            }\n                        }\n                        skip_waves_54681 *= 2;\n                    }\n                    barrier(CLK_LOCAL_MEM_FENCE);\n                    // and back to memory with the final result\n                    {\n                        if (local_tid_54648 == 0) {\n                            ((__global int64_t *) mem_53511)[inf_29626 + gtid_49400] = eta_p_54665;\n                        }\n                    }\n                }\n            }", "\n        }\n        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    }\n    \n  error_6:\n    return;\n    #undef segred_tblock_sizze_49396\n    #undef chunk_sizze_54590\n}\nFUTHARK_KERNEL_SIZED(get_num_neighbours_against_10103zisegred_small_49402_dim1, 1, 1)\nvoid get_num_neighbours_against_10103zisegred_small_49402(__global int *global_failure, int64_t n2_29591, double eps_29596, int8_t dist_t_29597, int8_t angle_t_29598, double radius_29599, int64_t inf_29626, int64_t dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_29632, int64_t num_tblocks_49397, unsigned char x_53480_bits, int64_t segment_sizze_nonzzero_54591, __global unsigned char *dat1_mem_53506, __global unsigned char *dat1_mem_53507, __global unsigned char *dat2_mem_53508, __global unsigned char *dat2_mem_53509, __global unsigned char *mem_53511, __global unsigned char *mem_53517, __global unsigned char *mem_53519, __global unsigned char *mem_53521)\n{\n    bool x_53480 = x_53480_bits;\n    \n    #define segred_tblock_sizze_49396 (get_num_neighbours_against_10103zisegred_small_49402zisegred_tblock_sizze_49396)\n    \n    volatile __local unsigned char *red_arr_i64_mem_54598_backing_0 = &shared_mem[0];\n    const int64_t red_arr_i64_mem_54598_backing_0_offset = 0 + ((int64_t) 8 * segred_tblock_sizze_49396 + srem64((int64_t) 8 - srem64((int64_t) 8 * segred_tblock_sizze_49396, (int64_t) 8), (int64_t) 8));\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_54594;\n    int32_t tblock_sizze_54597;\n    int32_t wave_sizze_54596;\n    int32_t block_id_54595;\n    int32_t global_tid_54593;\n    int64_t phys_tid_49402;\n    __local unsigned char *red_arr_i64_mem_54598;\n    int32_t phys_tblock_id_54600;\n    int32_t iterations_54601;\n    \n    local_tid_54594 = get_local_id(0);\n    tblock_sizze_54597 = get_local_size(0);\n    wave_sizze_54596 = LOCKSTEP_WIDTH;\n    block_id_54595 = get_tblock_id(0);\n    global_tid_54593 = block_id_54595 * tblock_sizze_54597 + local_tid_54594;\n    phys_tid_49402 = sext_i32_i64(global_tid_", "54593);\n    red_arr_i64_mem_54598 = (__local unsigned char *) red_arr_i64_mem_54598_backing_0;\n    phys_tblock_id_54600 = get_tblock_id(0);\n    iterations_54601 = sdiv_up32(sext_i64_i32(sdiv_up64(dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_29632, squot64(segred_tblock_sizze_49396, segment_sizze_nonzzero_54591))) - phys_tblock_id_54600, sext_i64_i32(num_tblocks_49397));\n    for (int32_t i_54602 = 0; i_54602 < iterations_54601; i_54602++) {\n        int32_t virt_tblock_id_54603;\n        int64_t slice_54604;\n        int64_t gtid_49400;\n        int64_t remnant_54605;\n        int64_t gtid_49401;\n        \n        virt_tblock_id_54603 = phys_tblock_id_54600 + i_54602 * sext_i64_i32(num_tblocks_49397);\n        slice_54604 = dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_29632;\n        gtid_49400 = squot64(sext_i32_i64(local_tid_54594), segment_sizze_nonzzero_54591) + sext_i32_i64(virt_tblock_id_54603) * squot64(segred_tblock_sizze_49396, segment_sizze_nonzzero_54591);\n        remnant_54605 = squot64(sext_i32_i64(local_tid_54594), segment_sizze_nonzzero_54591) + sext_i32_i64(virt_tblock_id_54603) * squot64(segred_tblock_sizze_49396, segment_sizze_nonzzero_54591) - gtid_49400;\n        gtid_49401 = srem64(sext_i32_i64(local_tid_54594), n2_29591);\n        // apply map function if in bounds\n        {\n            if (slt64((int64_t) 0, n2_29591) && (slt64(gtid_49400, dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_29632) && slt64(sext_i32_i64(local_tid_54594), n2_29591 * squot64(segred_tblock_sizze_49396, segment_sizze_nonzzero_54591)))) {\n                // apply map function\n                {\n                    int64_t slice_49678 = inf_29626 + gtid_49400;\n                    double eta_p_49411 = ((__global double *) dat2_mem_53508)[gtid_49401];\n                    double eta_p_49412 = ((__global double *) dat2_mem_53509)[gtid_49401];\n                    double d_haversine_res_49408;\n                    \n                    if (x_53480) {\n                        double x_53482 = ((__global double *) mem_53517)[gti",
                                    "d_49400];\n                        \n                        d_haversine_res_49408 = x_53482;\n                    } else {\n                        d_haversine_res_49408 = 0.0;\n                    }\n                    \n                    double d_haversine_res_49409;\n                    \n                    if (x_53480) {\n                        double x_53484 = ((__global double *) mem_53519)[gtid_49400];\n                        \n                        d_haversine_res_49409 = x_53484;\n                    } else {\n                        d_haversine_res_49409 = 0.0;\n                    }\n                    \n                    double cos_res_49410;\n                    \n                    if (x_53480) {\n                        double x_53486 = ((__global double *) mem_53521)[gtid_49400];\n                        \n                        cos_res_49410 = x_53486;\n                    } else {\n                        cos_res_49410 = 0.0;\n                    }\n                    \n                    double dist_res_49413;\n                    \n                    if (dist_t_29597 == (int8_t) 0) {\n                        double eta_p_49406 = ((__global double *) dat1_mem_53506)[slice_49678];\n                        double eta_p_49407 = ((__global double *) dat1_mem_53507)[slice_49678];\n                        double zm_res_49414 = eta_p_49407 - eta_p_49412;\n                        double zm_res_49415 = eta_p_49406 - eta_p_49411;\n                        double hypot_res_49416 = futrts_hypot64(zm_res_49415, zm_res_49414);\n                        \n                        dist_res_49413 = hypot_res_49416;\n                    } else {\n                        double d_haversine_res_49417;\n                        double d_haversine_res_49418;\n                        \n                        if (angle_t_29598 == (int8_t) 1) {\n                            d_haversine_res_49417 = eta_p_49411;\n                            d_haversine_res_49418 = eta_p_49412;\n                        } ", "else {\n                            double zt_res_49419 = 3.141592653589793 * eta_p_49411;\n                            double zs_res_49420 = zt_res_49419 / 180.0;\n                            double zt_res_49421 = 3.141592653589793 * eta_p_49412;\n                            double zs_res_49422 = zt_res_49421 / 180.0;\n                            \n                            d_haversine_res_49417 = zs_res_49420;\n                            d_haversine_res_49418 = zs_res_49422;\n                        }\n                        \n                        double zm_res_49423 = d_haversine_res_49408 - d_haversine_res_49417;\n                        double cos_res_49424 = futrts_cos64(zm_res_49423);\n                        double zm_res_49425 = 1.0 - cos_res_49424;\n                        double cos_res_49426 = futrts_cos64(d_haversine_res_49417);\n                        double zt_res_49427 = cos_res_49410 * cos_res_49426;\n                        double zm_res_49428 = d_haversine_res_49409 - d_haversine_res_49418;\n                        double zm_res_49429 = 1.0 - zm_res_49428;\n                        double zt_res_49430 = zt_res_49427 * zm_res_49429;\n                        double zp_res_49431 = zm_res_49425 + zt_res_49430;\n                        double zs_res_49432 = zp_res_49431 / 2.0;\n                        double min_res_49433 = fmin64(1.0, zs_res_49432);\n                        double zt_res_49434 = 2.0 * min_res_49433;\n                        double zm_res_49435 = 1.0 - zt_res_49434;\n                        double acos_res_49436 = futrts_acos64(zm_res_49435);\n                        double zt_res_49437 = radius_29599 * acos_res_49436;\n                        \n                        dist_res_49413 = zt_res_49437;\n                    }\n                    \n                    bool zlze_res_49438 = dist_res_49413 <= eps_29596;\n                    int64_t bool_res_49439 = btoi_bool_i64(zlze_res_49438);\n                    \n                    // save results to be reduce", "d\n                    {\n                        ((__local int64_t *) red_arr_i64_mem_54598)[sext_i32_i64(local_tid_54594)] = bool_res_49439;\n                    }\n                }\n            } else {\n                ((__local int64_t *) red_arr_i64_mem_54598)[sext_i32_i64(local_tid_54594)] = (int64_t) 0;\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        if (slt64((int64_t) 0, n2_29591)) {\n            // perform segmented scan to imitate reduction\n            {\n                int64_t eta_p_49403;\n                int64_t eta_p_49404;\n                int64_t eta_p_54606;\n                int64_t eta_p_54607;\n                bool ltid_in_bounds_54609 = slt64(sext_i32_i64(local_tid_54594), n2_29591 * squot64(segred_tblock_sizze_49396, segment_sizze_nonzzero_54591));\n                int32_t skip_threads_54610;\n                \n                // read input for in-block scan\n                {\n                    if (ltid_in_bounds_54609) {\n                        eta_p_49404 = ((volatile __local int64_t *) red_arr_i64_mem_54598)[sext_i32_i64(local_tid_54594)];\n                        if ((local_tid_54594 - squot32(local_tid_54594, 32) * 32) == 0) {\n                            eta_p_49403 = eta_p_49404;\n                        }\n                    }\n                }\n                // in-block scan (hopefully no barriers needed)\n                {\n                    skip_threads_54610 = 1;\n                    while (slt32(skip_threads_54610, 32)) {\n                        bool thread_active_54611 = sle32(skip_threads_54610, local_tid_54594 - squot32(local_tid_54594, 32) * 32) && ltid_in_bounds_54609;\n                        \n                        if (thread_active_54611) {\n                            // read operands\n                            {\n                                eta_p_49403 = ((volatile __local int64_t *) red_arr_i64_mem_54598)[sext_i32_i64(local_tid_54594) - sext_i32_i64(skip_threads_54610)];\n                            }\n         ",
                                    "               }\n                        // perform operation\n                        {\n                            bool inactive_54612 = slt64(srem64(sext_i32_i64(local_tid_54594), n2_29591), sext_i32_i64(local_tid_54594) - sext_i32_i64(local_tid_54594 - skip_threads_54610));\n                            \n                            if (thread_active_54611 && inactive_54612) {\n                                eta_p_49403 = eta_p_49404;\n                            }\n                            if (thread_active_54611) {\n                                if (!inactive_54612) {\n                                    int64_t zp_res_49405 = add64(eta_p_49403, eta_p_49404);\n                                    \n                                    eta_p_49403 = zp_res_49405;\n                                }\n                            }\n                        }\n                        if (sle32(wave_sizze_54596, skip_threads_54610)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        if (thread_active_54611) {\n                            // write result\n                            {\n                                ((volatile __local int64_t *) red_arr_i64_mem_54598)[sext_i32_i64(local_tid_54594)] = eta_p_49403;\n                                eta_p_49404 = eta_p_49403;\n                            }\n                        }\n                        if (sle32(wave_sizze_54596, skip_threads_54610)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        skip_threads_54610 *= 2;\n                    }\n                }\n                barrier(CLK_LOCAL_MEM_FENCE);\n                // last thread of block 'i' writes its result to offset 'i'\n                {\n                    if ((local_tid_54594 - squot32(local_tid_54594, 32) * 32) == 31 && ltid_in_bounds_54609) {\n                        ((volatile __local int64_t *) red_arr_i64_mem_54598)[sext_i32_i64(squot32(local_tid_5", "4594, 32))] = eta_p_49403;\n                    }\n                }\n                barrier(CLK_LOCAL_MEM_FENCE);\n                // scan the first block, after which offset 'i' contains carry-in for block 'i+1'\n                {\n                    int32_t skip_threads_54613;\n                    \n                    // read input for in-block scan\n                    {\n                        if (squot32(local_tid_54594, 32) == 0 && ltid_in_bounds_54609) {\n                            eta_p_54607 = ((volatile __local int64_t *) red_arr_i64_mem_54598)[sext_i32_i64(local_tid_54594)];\n                            if ((local_tid_54594 - squot32(local_tid_54594, 32) * 32) == 0) {\n                                eta_p_54606 = eta_p_54607;\n                            }\n                        }\n                    }\n                    // in-block scan (hopefully no barriers needed)\n                    {\n                        skip_threads_54613 = 1;\n                        while (slt32(skip_threads_54613, 32)) {\n                            bool thread_active_54614 = sle32(skip_threads_54613, local_tid_54594 - squot32(local_tid_54594, 32) * 32) && (squot32(local_tid_54594, 32) == 0 && ltid_in_bounds_54609);\n                            \n                            if (thread_active_54614) {\n                                // read operands\n                                {\n                                    eta_p_54606 = ((volatile __local int64_t *) red_arr_i64_mem_54598)[sext_i32_i64(local_tid_54594) - sext_i32_i64(skip_threads_54613)];\n                                }\n                            }\n                            // perform operation\n                            {\n                                bool inactive_54615 = slt64(srem64(sext_i32_i64(local_tid_54594 * 32 + 32 - 1), n2_29591), sext_i32_i64(local_tid_54594 * 32 + 32 - 1) - sext_i32_i64((local_tid_54594 - skip_threads_54613) * 32 + 32 - 1));\n                                \n                              ", "  if (thread_active_54614 && inactive_54615) {\n                                    eta_p_54606 = eta_p_54607;\n                                }\n                                if (thread_active_54614) {\n                                    if (!inactive_54615) {\n                                        int64_t zp_res_54608 = add64(eta_p_54606, eta_p_54607);\n                                        \n                                        eta_p_54606 = zp_res_54608;\n                                    }\n                                }\n                            }\n                            if (sle32(wave_sizze_54596, skip_threads_54613)) {\n                                barrier(CLK_LOCAL_MEM_FENCE);\n                            }\n                            if (thread_active_54614) {\n                                // write result\n                                {\n                                    ((volatile __local int64_t *) red_arr_i64_mem_54598)[sext_i32_i64(local_tid_54594)] = eta_p_54606;\n                                    eta_p_54607 = eta_p_54606;\n                                }\n                            }\n                            if (sle32(wave_sizze_54596, skip_threads_54613)) {\n                                barrier(CLK_LOCAL_MEM_FENCE);\n                            }\n                            skip_threads_54613 *= 2;\n                        }\n                    }\n                }\n                barrier(CLK_LOCAL_MEM_FENCE);\n                \n                bool no_carry_in_54616 = squot32(local_tid_54594, 32) == 0 || !ltid_in_bounds_54609;\n                \n                // carry-in for every block except the first\n                {\n                    // read operands\n                    {\n                        if (!no_carry_in_54616) {\n                            eta_p_49404 = eta_p_49403;\n                            eta_p_49403 = ((__local int64_t *) red_arr_i64_mem_54598)[sext_i32_i64(squot32(local_tid_54594, 32)) - (int64_t) 1];\n  ",
                                    "                      }\n                    }\n                    // perform operation\n                    {\n                        bool inactive_54617 = slt64(srem64(sext_i32_i64(local_tid_54594), n2_29591), sext_i32_i64(local_tid_54594) - sext_i32_i64(squot32(local_tid_54594, 32) * 32 - 1));\n                        \n                        if (!no_carry_in_54616) {\n                            if (inactive_54617) {\n                                eta_p_49403 = eta_p_49404;\n                            }\n                        }\n                        if (!no_carry_in_54616) {\n                            if (!inactive_54617) {\n                                int64_t zp_res_49405 = add64(eta_p_49403, eta_p_49404);\n                                \n                                eta_p_49403 = zp_res_49405;\n                            }\n                        }\n                    }\n                    // write final result\n                    {\n                        if (!no_carry_in_54616) {\n                            ((__local int64_t *) red_arr_i64_mem_54598)[sext_i32_i64(local_tid_54594)] = eta_p_49403;\n                        }\n                    }\n                }\n                barrier(CLK_LOCAL_MEM_FENCE);\n                // restore correct values for first block\n                {\n                    if (squot32(local_tid_54594, 32) == 0 && ltid_in_bounds_54609) {\n                        ((__local int64_t *) red_arr_i64_mem_54598)[sext_i32_i64(local_tid_54594)] = eta_p_49404;\n                    }\n                }\n                barrier(CLK_LOCAL_MEM_FENCE);\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        // save final values of segments\n        {\n            if (slt64(sext_i32_i64(virt_tblock_id_54603) * squot64(segred_tblock_sizze_49396, segment_sizze_nonzzero_54591) + sext_i32_i64(local_tid_54594), dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_29632) && slt64(sext_i32_i64(local_tid_54594), squot64(segred_tblock_sizze_49396, segment_sizze", "_nonzzero_54591))) {\n                int64_t tmp_54618 = ((__local int64_t *) red_arr_i64_mem_54598)[(sext_i32_i64(local_tid_54594) + (int64_t) 1) * segment_sizze_nonzzero_54591 - (int64_t) 1];\n                \n                ((__global int64_t *) mem_53511)[inf_29626 + (sext_i32_i64(virt_tblock_id_54603) * squot64(segred_tblock_sizze_49396, segment_sizze_nonzzero_54591) + sext_i32_i64(local_tid_54594))] = tmp_54618;\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    }\n    \n  error_3:\n    return;\n    #undef segred_tblock_sizze_49396\n}\nFUTHARK_KERNEL_SIZED(get_num_neighbours_against_10106zisegmap_49618_dim1, 1, 1)\nvoid get_num_neighbours_against_10106zisegmap_49618(__global int *global_failure, int8_t angle_t_29859, int64_t inf_29887, int64_t dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_29893, __global unsigned char *dat1_mem_53506, __global unsigned char *dat1_mem_53507, __global unsigned char *mem_53517, __global unsigned char *mem_53519, __global unsigned char *mem_53521)\n{\n    #define segmap_tblock_sizze_49612 (get_num_neighbours_against_10106zisegmap_49618zisegmap_tblock_sizze_49612)\n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_54583;\n    int32_t tblock_sizze_54586;\n    int32_t wave_sizze_54585;\n    int32_t block_id_54584;\n    int32_t global_tid_54582;\n    int64_t phys_tid_49618;\n    int64_t global_tid_54587;\n    int64_t slice_54588;\n    int64_t gtid_49617;\n    int64_t remnant_54589;\n    \n    local_tid_54583 = get_local_id(0);\n    tblock_sizze_54586 = get_local_size(0);\n    wave_sizze_54585 = LOCKSTEP_WIDTH;\n    block_id_54584 = get_tblock_id(0);\n    global_tid_54582 = block_id_54584 * tblock_sizze_54586 + local_tid_54583;\n    phys_tid_49618 = sext_i32_i64(global_tid_54582);\n    global_tid_54587 = sext_i32_i64(block_id_54584) * segmap_tblock_sizze_49612 + sext_i32_i64(local_tid_54583);\n    slice_54588 = dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_29893;\n    gtid_49617 = global_ti", "d_54587;\n    remnant_54589 = global_tid_54587 - gtid_49617;\n    if (slt64(gtid_49617, dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_29893)) {\n        int64_t slice_49680;\n        double eta_p_49619;\n        double eta_p_49620;\n        double zt_res_49621;\n        double zt_res_49622;\n        double zs_res_49623;\n        double zs_res_49624;\n        double d_haversine_res_49625;\n        double d_haversine_res_49626;\n        double cos_res_49627;\n        \n        slice_49680 = inf_29887 + gtid_49617;\n        eta_p_49619 = ((__global double *) dat1_mem_53506)[slice_49680];\n        eta_p_49620 = ((__global double *) dat1_mem_53507)[slice_49680];\n        zt_res_49621 = 3.141592653589793 * eta_p_49619;\n        zt_res_49622 = 3.141592653589793 * eta_p_49620;\n        zs_res_49623 = zt_res_49621 / 180.0;\n        zs_res_49624 = zt_res_49622 / 180.0;\n        if (angle_t_29859 == (int8_t) 1) {\n            d_haversine_res_49625 = eta_p_49619;\n        } else {\n            d_haversine_res_49625 = zs_res_49623;\n        }\n        if (angle_t_29859 == (int8_t) 1) {\n            d_haversine_res_49626 = eta_p_49620;\n        } else {\n            d_haversine_res_49626 = zs_res_49624;\n        }\n        cos_res_49627 = futrts_cos64(d_haversine_res_49625);\n        ((__global double *) mem_53517)[gtid_49617] = d_haversine_res_49625;\n        ((__global double *) mem_53519)[gtid_49617] = d_haversine_res_49626;\n        ((__global double *) mem_53521)[gtid_49617] = cos_res_49627;\n    }\n    \n  error_0:\n    return;\n    #undef segmap_tblock_sizze_49612\n}\nFUTHARK_KERNEL_SIZED(get_num_neighbours_against_10106zisegmap_intrablock_49824_dim1, 1, 1)\nvoid get_num_neighbours_against_10106zisegmap_intrablock_49824(__global int *global_failure, int64_t n2_29852, double eps_29857, int8_t dist_t_29858, int8_t angle_t_29859, double radius_29860, int64_t inf_29887, int64_t dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_29893, int64_t ldim_49827, int64_t num_whole_tiles_49871, int64_t residual_input_50060, unsigned char cond_50061_bits, i",
                                    "nt64_t binop_x_50074, __global unsigned char *dat1_mem_53506, __global unsigned char *dat1_mem_53507, __global unsigned char *dat2_mem_53508, __global unsigned char *dat2_mem_53509, __global unsigned char *mem_53511)\n{\n    bool cond_50061 = cond_50061_bits;\n    \n    #define tile_sizze_49826 (get_num_neighbours_against_10106zisegmap_intrablock_49824zitile_sizze_49826)\n    #define bytes_53551 (get_num_neighbours_against_10106zisegmap_intrablock_49824zibytes_53551)\n    \n    volatile __local unsigned char *color_54517_backing_1 = &shared_mem[0];\n    const int64_t color_54517_backing_1_offset = 0 + (bytes_53551 + srem64((int64_t) 8 - srem64(bytes_53551, (int64_t) 8), (int64_t) 8));\n    volatile __local unsigned char *color_54516_backing_0 = &shared_mem[color_54517_backing_1_offset];\n    const int64_t color_54516_backing_0_offset = color_54517_backing_1_offset + (bytes_53551 + srem64((int64_t) 8 - srem64(bytes_53551, (int64_t) 8), (int64_t) 8));\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_54567;\n    int32_t tblock_sizze_54570;\n    int32_t wave_sizze_54569;\n    int32_t block_id_54568;\n    int32_t global_tid_54566;\n    int64_t gid_flat_49824;\n    int64_t slice_54572;\n    int64_t ltid_pre_54571;\n    int64_t remnant_54573;\n    int64_t slice_54574;\n    int64_t gid_49823;\n    int64_t remnant_54575;\n    __local unsigned char *color_54516;\n    __local unsigned char *color_54517;\n    int64_t binop_x_49842;\n    double mem_53529[1];\n    double mem_53533[1];\n    double mem_53537[1];\n    double mem_53541[1];\n    double mem_53545[1];\n    int64_t ltid_flat_49829;\n    int64_t ltid_49828;\n    int64_t gtid_49843;\n    bool cond_49844;\n    double pre_49845;\n    double pre_49846;\n    double pre_49847;\n    double pre_49848;\n    double pre_49849;\n    int64_t mem_53549[1];\n    int64_t ltid_flat_49873;\n    int64_t ltid_49872;\n    int64_t ext_mem_53559[1];\n    int64_t mem_param_53550[1];\n    int64_t mem_53567[1];\n    int64_t ext_mem_53568[1];\n    \n    local_tid_54", "567 = get_local_id(0);\n    tblock_sizze_54570 = get_local_size(0);\n    wave_sizze_54569 = LOCKSTEP_WIDTH;\n    block_id_54568 = get_tblock_id(0);\n    global_tid_54566 = block_id_54568 * tblock_sizze_54570 + local_tid_54567;\n    gid_flat_49824 = sext_i32_i64(block_id_54568);\n    slice_54572 = tile_sizze_49826;\n    ltid_pre_54571 = sext_i32_i64(local_tid_54567);\n    remnant_54573 = sext_i32_i64(local_tid_54567) - ltid_pre_54571;\n    slice_54574 = ldim_49827;\n    gid_49823 = sext_i32_i64(block_id_54568);\n    remnant_54575 = sext_i32_i64(block_id_54568) - gid_49823;\n    color_54516 = (__local unsigned char *) color_54516_backing_0;\n    color_54517 = (__local unsigned char *) color_54517_backing_1;\n    binop_x_49842 = gid_49823 * tile_sizze_49826;\n    ltid_flat_49829 = sext_i32_i64(local_tid_54567);\n    ltid_49828 = sext_i32_i64(sext_i64_i32(ltid_pre_54571));\n    gtid_49843 = ltid_49828 + binop_x_49842;\n    cond_49844 = slt64(gtid_49843, dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_29893);\n    if (cond_49844) {\n        int64_t slice_49850;\n        double eta_p_49851;\n        double eta_p_49853;\n        double zt_res_49854;\n        double zt_res_49855;\n        double zs_res_49856;\n        double zs_res_49857;\n        double d_haversine_res_49858;\n        double d_haversine_res_49859;\n        double cos_res_49860;\n        \n        slice_49850 = inf_29887 + gtid_49843;\n        eta_p_49851 = ((__global double *) dat1_mem_53506)[slice_49850];\n        eta_p_49853 = ((__global double *) dat1_mem_53507)[slice_49850];\n        zt_res_49854 = 3.141592653589793 * eta_p_49851;\n        zt_res_49855 = 3.141592653589793 * eta_p_49853;\n        zs_res_49856 = zt_res_49854 / 180.0;\n        zs_res_49857 = zt_res_49855 / 180.0;\n        if (angle_t_29859 == (int8_t) 1) {\n            d_haversine_res_49858 = eta_p_49851;\n        } else {\n            d_haversine_res_49858 = zs_res_49856;\n        }\n        if (angle_t_29859 == (int8_t) 1) {\n            d_haversine_res_49859 = eta_p_49853;\n        } else {\n  ", "          d_haversine_res_49859 = zs_res_49857;\n        }\n        cos_res_49860 = futrts_cos64(d_haversine_res_49858);\n        pre_49845 = eta_p_49851;\n        pre_49846 = eta_p_49853;\n        pre_49847 = d_haversine_res_49858;\n        pre_49848 = d_haversine_res_49859;\n        pre_49849 = cos_res_49860;\n    } else {\n        pre_49845 = 0.0;\n        pre_49846 = 0.0;\n        pre_49847 = 0.0;\n        pre_49848 = 0.0;\n        pre_49849 = 0.0;\n    }\n    mem_53529[(int64_t) 0] = pre_49845;\n    mem_53533[(int64_t) 0] = pre_49846;\n    mem_53537[(int64_t) 0] = pre_49847;\n    mem_53541[(int64_t) 0] = pre_49848;\n    mem_53545[(int64_t) 0] = pre_49849;\n    barrier(CLK_LOCAL_MEM_FENCE);\n    ltid_flat_49873 = sext_i32_i64(local_tid_54567);\n    ltid_49872 = sext_i32_i64(sext_i64_i32(ltid_pre_54571));\n    mem_53549[(int64_t) 0] = (int64_t) 0;\n    barrier(CLK_LOCAL_MEM_FENCE);\n    barrier(CLK_LOCAL_MEM_FENCE);\n    for (int32_t i_2 = 0; i_2 < 1; i_2++)\n        mem_param_53550[i_2] = mem_53549[i_2];\n    for (int64_t tile_id_49879 = 0; tile_id_49879 < num_whole_tiles_49871; tile_id_49879++) {\n        int64_t binop_x_49965;\n        int64_t ltid_flat_49964;\n        int64_t ltid_49963;\n        int64_t j_49966;\n        bool cond_49974;\n        double pre1d_49975;\n        double pre1d_49976;\n        int64_t mem_53558[1];\n        int64_t ltid_flat_49983;\n        int64_t ltid_49982;\n        int64_t gtid_49985;\n        int64_t acc_49991;\n        bool cond_49992;\n        int64_t acc_49993;\n        int64_t mem_param_tmp_54576[1];\n        \n        binop_x_49965 = tile_sizze_49826 * tile_id_49879;\n        ltid_flat_49964 = sext_i32_i64(local_tid_54567);\n        ltid_49963 = sext_i32_i64(sext_i64_i32(ltid_pre_54571));\n        j_49966 = ltid_49963 + binop_x_49965;\n        cond_49974 = slt64(j_49966, n2_29852);\n        if (cond_49974) {\n            double tile_elem_49977;\n            double tile_elem_49978;\n            \n            tile_elem_49977 = ((__global double *) dat2_mem_53508)[j_49966];\n   ",
                                    "         tile_elem_49978 = ((__global double *) dat2_mem_53509)[j_49966];\n            pre1d_49975 = tile_elem_49977;\n            pre1d_49976 = tile_elem_49978;\n        } else {\n            pre1d_49975 = 0.0;\n            pre1d_49976 = 0.0;\n        }\n        ((__local double *) color_54516)[ltid_49963] = pre1d_49975;\n        ((__local double *) color_54517)[ltid_49963] = pre1d_49976;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        ltid_flat_49983 = sext_i32_i64(local_tid_54567);\n        ltid_49982 = sext_i32_i64(sext_i64_i32(ltid_pre_54571));\n        gtid_49985 = binop_x_49842 + ltid_49982;\n        acc_49991 = mem_param_53550[(int64_t) 0];\n        cond_49992 = slt64(gtid_49985, dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_29893);\n        if (cond_49992) {\n            double eta_p_49986;\n            double eta_p_49987;\n            double d_haversine_res_49988;\n            double d_haversine_res_49989;\n            double cos_res_49990;\n            int64_t x_49994;\n            int64_t redout_53108;\n            \n            eta_p_49986 = mem_53529[(int64_t) 0];\n            eta_p_49987 = mem_53533[(int64_t) 0];\n            d_haversine_res_49988 = mem_53537[(int64_t) 0];\n            d_haversine_res_49989 = mem_53541[(int64_t) 0];\n            cos_res_49990 = mem_53545[(int64_t) 0];\n            redout_53108 = acc_49991;\n            for (int64_t i_53109 = 0; i_53109 < tile_sizze_49826; i_53109++) {\n                double eta_p_49995;\n                double eta_p_49996;\n                double dist_res_49997;\n                bool zlze_res_50022;\n                int64_t bool_res_50023;\n                int64_t zp_res_50026;\n                int64_t redout_tmp_54578;\n                \n                eta_p_49995 = ((__local double *) color_54516)[i_53109];\n                eta_p_49996 = ((__local double *) color_54517)[i_53109];\n                if (dist_t_29858 == (int8_t) 0) {\n                    double zm_res_49998;\n                    double zm_res_49999;\n                    double hypot_res_50", "000;\n                    \n                    zm_res_49998 = eta_p_49987 - eta_p_49996;\n                    zm_res_49999 = eta_p_49986 - eta_p_49995;\n                    hypot_res_50000 = futrts_hypot64(zm_res_49999, zm_res_49998);\n                    dist_res_49997 = hypot_res_50000;\n                } else {\n                    double d_haversine_res_50001;\n                    double d_haversine_res_50002;\n                    double zm_res_50007;\n                    double cos_res_50008;\n                    double zm_res_50009;\n                    double cos_res_50010;\n                    double zt_res_50011;\n                    double zm_res_50012;\n                    double zm_res_50013;\n                    double zt_res_50014;\n                    double zp_res_50015;\n                    double zs_res_50016;\n                    double min_res_50017;\n                    double zt_res_50018;\n                    double zm_res_50019;\n                    double acos_res_50020;\n                    double zt_res_50021;\n                    \n                    if (angle_t_29859 == (int8_t) 1) {\n                        d_haversine_res_50001 = eta_p_49995;\n                        d_haversine_res_50002 = eta_p_49996;\n                    } else {\n                        double zt_res_50003;\n                        double zs_res_50004;\n                        double zt_res_50005;\n                        double zs_res_50006;\n                        \n                        zt_res_50003 = 3.141592653589793 * eta_p_49995;\n                        zs_res_50004 = zt_res_50003 / 180.0;\n                        zt_res_50005 = 3.141592653589793 * eta_p_49996;\n                        zs_res_50006 = zt_res_50005 / 180.0;\n                        d_haversine_res_50001 = zs_res_50004;\n                        d_haversine_res_50002 = zs_res_50006;\n                    }\n                    zm_res_50007 = d_haversine_res_49988 - d_haversine_res_50001;\n                    cos_res_50008 = futrts_", "cos64(zm_res_50007);\n                    zm_res_50009 = 1.0 - cos_res_50008;\n                    cos_res_50010 = futrts_cos64(d_haversine_res_50001);\n                    zt_res_50011 = cos_res_49990 * cos_res_50010;\n                    zm_res_50012 = d_haversine_res_49989 - d_haversine_res_50002;\n                    zm_res_50013 = 1.0 - zm_res_50012;\n                    zt_res_50014 = zt_res_50011 * zm_res_50013;\n                    zp_res_50015 = zm_res_50009 + zt_res_50014;\n                    zs_res_50016 = zp_res_50015 / 2.0;\n                    min_res_50017 = fmin64(1.0, zs_res_50016);\n                    zt_res_50018 = 2.0 * min_res_50017;\n                    zm_res_50019 = 1.0 - zt_res_50018;\n                    acos_res_50020 = futrts_acos64(zm_res_50019);\n                    zt_res_50021 = radius_29860 * acos_res_50020;\n                    dist_res_49997 = zt_res_50021;\n                }\n                zlze_res_50022 = dist_res_49997 <= eps_29857;\n                bool_res_50023 = btoi_bool_i64(zlze_res_50022);\n                zp_res_50026 = add64(bool_res_50023, redout_53108);\n                redout_tmp_54578 = zp_res_50026;\n                redout_53108 = redout_tmp_54578;\n            }\n            x_49994 = redout_53108;\n            acc_49993 = x_49994;\n        } else {\n            acc_49993 = acc_49991;\n        }\n        mem_53558[(int64_t) 0] = acc_49993;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        for (int32_t i_3 = 0; i_3 < 1; i_3++)\n            mem_param_tmp_54576[i_3] = mem_53558[i_3];\n        for (int32_t i_4 = 0; i_4 < 1; i_4++)\n            mem_param_53550[i_4] = mem_param_tmp_54576[i_4];\n    }\n    for (int32_t i_5 = 0; i_5 < 1; i_5++)\n        ext_mem_53559[i_5] = mem_param_53550[i_5];\n    barrier(CLK_LOCAL_MEM_FENCE);\n    if (cond_50061) {\n        for (int32_t i_6 = 0; i_6 < 1; i_6++)\n            ext_mem_53568[i_6] = ext_mem_53559[i_6];\n    } else {\n        int64_t ltid_flat_50063;\n        int64_t ltid_50062;\n        int64_t j_50075;\n        b",
                                    "ool cond_50083;\n        double pre1d_50084;\n        double pre1d_50085;\n        int64_t ltid_flat_50095;\n        int64_t ltid_50094;\n        int64_t gtid_50102;\n        int64_t acc_50108;\n        bool cond_50109;\n        int64_t acc_50110;\n        \n        ltid_flat_50063 = sext_i32_i64(local_tid_54567);\n        ltid_50062 = sext_i32_i64(sext_i64_i32(ltid_pre_54571));\n        j_50075 = ltid_50062 + binop_x_50074;\n        cond_50083 = slt64(j_50075, n2_29852);\n        if (cond_50083) {\n            double tile_elem_50086;\n            double tile_elem_50087;\n            \n            tile_elem_50086 = ((__global double *) dat2_mem_53508)[j_50075];\n            tile_elem_50087 = ((__global double *) dat2_mem_53509)[j_50075];\n            pre1d_50084 = tile_elem_50086;\n            pre1d_50085 = tile_elem_50087;\n        } else {\n            pre1d_50084 = 0.0;\n            pre1d_50085 = 0.0;\n        }\n        ((__local double *) color_54517)[ltid_50062] = pre1d_50084;\n        ((__local double *) color_54516)[ltid_50062] = pre1d_50085;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        ltid_flat_50095 = sext_i32_i64(local_tid_54567);\n        ltid_50094 = sext_i32_i64(sext_i64_i32(ltid_pre_54571));\n        gtid_50102 = binop_x_49842 + ltid_50094;\n        acc_50108 = ext_mem_53559[(int64_t) 0];\n        cond_50109 = slt64(gtid_50102, dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_29893);\n        if (cond_50109) {\n            double eta_p_50103;\n            double eta_p_50104;\n            double d_haversine_res_50105;\n            double d_haversine_res_50106;\n            double cos_res_50107;\n            int64_t x_50111;\n            int64_t redout_53110;\n            \n            eta_p_50103 = mem_53529[(int64_t) 0];\n            eta_p_50104 = mem_53533[(int64_t) 0];\n            d_haversine_res_50105 = mem_53537[(int64_t) 0];\n            d_haversine_res_50106 = mem_53541[(int64_t) 0];\n            cos_res_50107 = mem_53545[(int64_t) 0];\n            redout_53110 = acc_50108;\n            for (int64_t i_5", "3111 = 0; i_53111 < residual_input_50060; i_53111++) {\n                double eta_p_50112;\n                double eta_p_50113;\n                double dist_res_50114;\n                bool zlze_res_50139;\n                int64_t bool_res_50140;\n                int64_t zp_res_50143;\n                int64_t redout_tmp_54579;\n                \n                eta_p_50112 = ((__local double *) color_54517)[i_53111];\n                eta_p_50113 = ((__local double *) color_54516)[i_53111];\n                if (dist_t_29858 == (int8_t) 0) {\n                    double zm_res_50115;\n                    double zm_res_50116;\n                    double hypot_res_50117;\n                    \n                    zm_res_50115 = eta_p_50104 - eta_p_50113;\n                    zm_res_50116 = eta_p_50103 - eta_p_50112;\n                    hypot_res_50117 = futrts_hypot64(zm_res_50116, zm_res_50115);\n                    dist_res_50114 = hypot_res_50117;\n                } else {\n                    double d_haversine_res_50118;\n                    double d_haversine_res_50119;\n                    double zm_res_50124;\n                    double cos_res_50125;\n                    double zm_res_50126;\n                    double cos_res_50127;\n                    double zt_res_50128;\n                    double zm_res_50129;\n                    double zm_res_50130;\n                    double zt_res_50131;\n                    double zp_res_50132;\n                    double zs_res_50133;\n                    double min_res_50134;\n                    double zt_res_50135;\n                    double zm_res_50136;\n                    double acos_res_50137;\n                    double zt_res_50138;\n                    \n                    if (angle_t_29859 == (int8_t) 1) {\n                        d_haversine_res_50118 = eta_p_50112;\n                        d_haversine_res_50119 = eta_p_50113;\n                    } else {\n                        double zt_res_50120;\n                        double zs_res_50", "121;\n                        double zt_res_50122;\n                        double zs_res_50123;\n                        \n                        zt_res_50120 = 3.141592653589793 * eta_p_50112;\n                        zs_res_50121 = zt_res_50120 / 180.0;\n                        zt_res_50122 = 3.141592653589793 * eta_p_50113;\n                        zs_res_50123 = zt_res_50122 / 180.0;\n                        d_haversine_res_50118 = zs_res_50121;\n                        d_haversine_res_50119 = zs_res_50123;\n                    }\n                    zm_res_50124 = d_haversine_res_50105 - d_haversine_res_50118;\n                    cos_res_50125 = futrts_cos64(zm_res_50124);\n                    zm_res_50126 = 1.0 - cos_res_50125;\n                    cos_res_50127 = futrts_cos64(d_haversine_res_50118);\n                    zt_res_50128 = cos_res_50107 * cos_res_50127;\n                    zm_res_50129 = d_haversine_res_50106 - d_haversine_res_50119;\n                    zm_res_50130 = 1.0 - zm_res_50129;\n                    zt_res_50131 = zt_res_50128 * zm_res_50130;\n                    zp_res_50132 = zm_res_50126 + zt_res_50131;\n                    zs_res_50133 = zp_res_50132 / 2.0;\n                    min_res_50134 = fmin64(1.0, zs_res_50133);\n                    zt_res_50135 = 2.0 * min_res_50134;\n                    zm_res_50136 = 1.0 - zt_res_50135;\n                    acos_res_50137 = futrts_acos64(zm_res_50136);\n                    zt_res_50138 = radius_29860 * acos_res_50137;\n                    dist_res_50114 = zt_res_50138;\n                }\n                zlze_res_50139 = dist_res_50114 <= eps_29857;\n                bool_res_50140 = btoi_bool_i64(zlze_res_50139);\n                zp_res_50143 = add64(bool_res_50140, redout_53110);\n                redout_tmp_54579 = zp_res_50143;\n                redout_53110 = redout_tmp_54579;\n            }\n            x_50111 = redout_53110;\n            acc_50110 = x_50111;\n        } else {\n            acc_50110 = acc_50108;\n     ",
                                    "   }\n        mem_53567[(int64_t) 0] = acc_50110;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        for (int32_t i_7 = 0; i_7 < 1; i_7++)\n            ext_mem_53568[i_7] = mem_53567[i_7];\n    }\n    if (slt64(sext_i32_i64(local_tid_54567) + tile_sizze_49826 * sext_i32_i64(block_id_54568), dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_29893)) {\n        int64_t tmp_54580 = ext_mem_53568[(int64_t) 0];\n        \n        ((__global int64_t *) mem_53511)[inf_29887 + (sext_i32_i64(local_tid_54567) + tile_sizze_49826 * sext_i32_i64(block_id_54568))] = tmp_54580;\n    }\n    \n  error_8:\n    return;\n    #undef tile_sizze_49826\n    #undef bytes_53551\n}\nFUTHARK_KERNEL_SIZED(get_num_neighbours_against_10106zisegred_large_49636_dim1, 1, 1)\nvoid get_num_neighbours_against_10106zisegred_large_49636(__global int *global_failure, int64_t n2_29852, double eps_29857, int8_t dist_t_29858, int8_t angle_t_29859, double radius_29860, int64_t inf_29887, int64_t dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_29893, int64_t num_tblocks_49631, unsigned char x_53480_bits, int64_t blocks_per_segment_54619, int64_t q_54620, int64_t num_virtblocks_54621, int64_t threads_per_segment_54622, __global unsigned char *dat1_mem_53506, __global unsigned char *dat1_mem_53507, __global unsigned char *dat2_mem_53508, __global unsigned char *dat2_mem_53509, __global unsigned char *mem_53511, __global unsigned char *mem_53517, __global unsigned char *mem_53519, __global unsigned char *mem_53521, __global unsigned char *segred_tmp_mem_54623, __global unsigned char *counters_mem_54625)\n{\n    bool x_53480 = x_53480_bits;\n    \n    #define segred_tblock_sizze_49630 (get_num_neighbours_against_10106zisegred_large_49636zisegred_tblock_sizze_49630)\n    #define chunk_sizze_54590 (get_num_neighbours_against_10106zisegred_large_49636zichunk_sizze_54590)\n    \n    volatile __local unsigned char *sync_arr_mem_54654_backing_1 = &shared_mem[0];\n    const int64_t sync_arr_mem_54654_backing_1_offset = 0 + 8;\n    volatile __local unsigned char *red_arr_i64_mem_54", "652_backing_0 = &shared_mem[sync_arr_mem_54654_backing_1_offset];\n    const int64_t red_arr_i64_mem_54652_backing_0_offset = sync_arr_mem_54654_backing_1_offset + ((int64_t) 8 * segred_tblock_sizze_49630 + srem64((int64_t) 8 - srem64((int64_t) 8 * segred_tblock_sizze_49630, (int64_t) 8), (int64_t) 8));\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_54648;\n    int32_t tblock_sizze_54651;\n    int32_t wave_sizze_54650;\n    int32_t block_id_54649;\n    int32_t global_tid_54647;\n    int64_t phys_tid_49636;\n    __local unsigned char *red_arr_i64_mem_54652;\n    __local unsigned char *sync_arr_mem_54654;\n    int32_t phys_tblock_id_54656;\n    int32_t iterations_54657;\n    \n    local_tid_54648 = get_local_id(0);\n    tblock_sizze_54651 = get_local_size(0);\n    wave_sizze_54650 = LOCKSTEP_WIDTH;\n    block_id_54649 = get_tblock_id(0);\n    global_tid_54647 = block_id_54649 * tblock_sizze_54651 + local_tid_54648;\n    phys_tid_49636 = sext_i32_i64(global_tid_54647);\n    red_arr_i64_mem_54652 = (__local unsigned char *) red_arr_i64_mem_54652_backing_0;\n    sync_arr_mem_54654 = (__local unsigned char *) sync_arr_mem_54654_backing_1;\n    phys_tblock_id_54656 = get_tblock_id(0);\n    iterations_54657 = sdiv_up32(sext_i64_i32(num_virtblocks_54621) - phys_tblock_id_54656, sext_i64_i32(num_tblocks_49631));\n    for (int32_t i_54658 = 0; i_54658 < iterations_54657; i_54658++) {\n        int32_t virt_tblock_id_54659;\n        int64_t flat_segment_id_54660;\n        int64_t global_tid_54661;\n        int64_t slice_54662;\n        int64_t gtid_49634;\n        int64_t remnant_54663;\n        int64_t gtid_49635;\n        int64_t eta_p_block_res_acc_54664;\n        int64_t eta_p_49637;\n        int64_t eta_p_49638;\n        int64_t tblock_id_in_segment_54668;\n        int64_t block_base_offset_54669;\n        int32_t offset_54672;\n        int32_t skip_waves_54673;\n        int64_t eta_p_54665;\n        int64_t eta_p_54666;\n        \n        virt_tblock_id_54659 = phys_tblock_id_54656", " + i_54658 * sext_i64_i32(num_tblocks_49631);\n        flat_segment_id_54660 = squot64(sext_i32_i64(virt_tblock_id_54659), blocks_per_segment_54619);\n        global_tid_54661 = srem64(sext_i32_i64(virt_tblock_id_54659) * segred_tblock_sizze_49630 + sext_i32_i64(local_tid_54648), threads_per_segment_54622);\n        slice_54662 = dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_29893;\n        gtid_49634 = flat_segment_id_54660;\n        remnant_54663 = flat_segment_id_54660 - gtid_49634;\n        // ne-initialise the outer (per-block) accumulator(s)\n        {\n            eta_p_block_res_acc_54664 = (int64_t) 0;\n        }\n        tblock_id_in_segment_54668 = squot64(global_tid_54661, segred_tblock_sizze_49630);\n        block_base_offset_54669 = tblock_id_in_segment_54668 * q_54620 * segred_tblock_sizze_49630;\n        for (int64_t i_54670 = 0; i_54670 < q_54620; i_54670++) {\n            int64_t block_offset_54671 = block_base_offset_54669 + i_54670 * segred_tblock_sizze_49630;\n            \n            gtid_49635 = global_tid_54661 + threads_per_segment_54622 * i_54670;\n            if (slt64(gtid_49635, n2_29852)) {\n                // apply map function(s)\n                {\n                    // apply map function\n                    {\n                        int64_t slice_49678 = inf_29887 + gtid_49634;\n                        double eta_p_49645 = ((__global double *) dat2_mem_53508)[gtid_49635];\n                        double eta_p_49646 = ((__global double *) dat2_mem_53509)[gtid_49635];\n                        double d_haversine_res_49642;\n                        \n                        if (x_53480) {\n                            double x_53482 = ((__global double *) mem_53517)[gtid_49634];\n                            \n                            d_haversine_res_49642 = x_53482;\n                        } else {\n                            d_haversine_res_49642 = 0.0;\n                        }\n                        \n                        double d_haversine_res_49643;\n             ",
                                    "           \n                        if (x_53480) {\n                            double x_53484 = ((__global double *) mem_53519)[gtid_49634];\n                            \n                            d_haversine_res_49643 = x_53484;\n                        } else {\n                            d_haversine_res_49643 = 0.0;\n                        }\n                        \n                        double cos_res_49644;\n                        \n                        if (x_53480) {\n                            double x_53486 = ((__global double *) mem_53521)[gtid_49634];\n                            \n                            cos_res_49644 = x_53486;\n                        } else {\n                            cos_res_49644 = 0.0;\n                        }\n                        \n                        double dist_res_49647;\n                        \n                        if (dist_t_29858 == (int8_t) 0) {\n                            double eta_p_49640 = ((__global double *) dat1_mem_53506)[slice_49678];\n                            double eta_p_49641 = ((__global double *) dat1_mem_53507)[slice_49678];\n                            double zm_res_49648 = eta_p_49641 - eta_p_49646;\n                            double zm_res_49649 = eta_p_49640 - eta_p_49645;\n                            double hypot_res_49650 = futrts_hypot64(zm_res_49649, zm_res_49648);\n                            \n                            dist_res_49647 = hypot_res_49650;\n                        } else {\n                            double d_haversine_res_49651;\n                            double d_haversine_res_49652;\n                            \n                            if (angle_t_29859 == (int8_t) 1) {\n                                d_haversine_res_49651 = eta_p_49645;\n                                d_haversine_res_49652 = eta_p_49646;\n                            } else {\n                                double zt_res_49653 = 3.141592653589793 * eta_p_49645;\n                                double", " zs_res_49654 = zt_res_49653 / 180.0;\n                                double zt_res_49655 = 3.141592653589793 * eta_p_49646;\n                                double zs_res_49656 = zt_res_49655 / 180.0;\n                                \n                                d_haversine_res_49651 = zs_res_49654;\n                                d_haversine_res_49652 = zs_res_49656;\n                            }\n                            \n                            double zm_res_49657 = d_haversine_res_49642 - d_haversine_res_49651;\n                            double cos_res_49658 = futrts_cos64(zm_res_49657);\n                            double zm_res_49659 = 1.0 - cos_res_49658;\n                            double cos_res_49660 = futrts_cos64(d_haversine_res_49651);\n                            double zt_res_49661 = cos_res_49644 * cos_res_49660;\n                            double zm_res_49662 = d_haversine_res_49643 - d_haversine_res_49652;\n                            double zm_res_49663 = 1.0 - zm_res_49662;\n                            double zt_res_49664 = zt_res_49661 * zm_res_49663;\n                            double zp_res_49665 = zm_res_49659 + zt_res_49664;\n                            double zs_res_49666 = zp_res_49665 / 2.0;\n                            double min_res_49667 = fmin64(1.0, zs_res_49666);\n                            double zt_res_49668 = 2.0 * min_res_49667;\n                            double zm_res_49669 = 1.0 - zt_res_49668;\n                            double acos_res_49670 = futrts_acos64(zm_res_49669);\n                            double zt_res_49671 = radius_29860 * acos_res_49670;\n                            \n                            dist_res_49647 = zt_res_49671;\n                        }\n                        \n                        bool zlze_res_49672 = dist_res_49647 <= eps_29857;\n                        int64_t bool_res_49673 = btoi_bool_i64(zlze_res_49672);\n                        \n                        // load accumulator(s)\n         ", "               {\n                            eta_p_49637 = eta_p_block_res_acc_54664;\n                        }\n                        // load next value(s)\n                        {\n                            eta_p_49638 = bool_res_49673;\n                        }\n                        // apply reduction operator(s)\n                        {\n                            int64_t zp_res_49639 = add64(eta_p_49637, eta_p_49638);\n                            \n                            // store in accumulator(s)\n                            {\n                                eta_p_block_res_acc_54664 = zp_res_49639;\n                            }\n                        }\n                    }\n                }\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        // store accs. prims go in lmem; non-prims in params (in global mem)\n        {\n            ((__local int64_t *) red_arr_i64_mem_54652)[sext_i32_i64(local_tid_54648)] = eta_p_block_res_acc_54664;\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        skip_waves_54673 = 1;\n        offset_54672 = 0;\n        // participating threads read initial accumulator\n        {\n            if (slt32(local_tid_54648, sext_i64_i32(segred_tblock_sizze_49630))) {\n                eta_p_54665 = ((__local int64_t *) red_arr_i64_mem_54652)[sext_i32_i64(local_tid_54648 + offset_54672)];\n            }\n        }\n        offset_54672 = 1;\n        while (slt32(offset_54672, wave_sizze_54650)) {\n            if (slt32(local_tid_54648 + offset_54672, sext_i64_i32(segred_tblock_sizze_49630)) && ((local_tid_54648 - squot32(local_tid_54648, wave_sizze_54650) * wave_sizze_54650) & (2 * offset_54672 - 1)) == 0) {\n                // read array element\n                {\n                    eta_p_54666 = ((volatile __local int64_t *) red_arr_i64_mem_54652)[sext_i32_i64(local_tid_54648 + offset_54672)];\n                }\n                // apply reduction operation\n                {\n                    int64_t zp_res_54667 = add64(e",
                                    "ta_p_54665, eta_p_54666);\n                    \n                    eta_p_54665 = zp_res_54667;\n                }\n                // write result of operation\n                {\n                    ((volatile __local int64_t *) red_arr_i64_mem_54652)[sext_i32_i64(local_tid_54648)] = eta_p_54665;\n                }\n            }\n            offset_54672 *= 2;\n        }\n        while (slt32(skip_waves_54673, squot32(sext_i64_i32(segred_tblock_sizze_49630) + wave_sizze_54650 - 1, wave_sizze_54650))) {\n            barrier(CLK_LOCAL_MEM_FENCE);\n            offset_54672 = skip_waves_54673 * wave_sizze_54650;\n            if (slt32(local_tid_54648 + offset_54672, sext_i64_i32(segred_tblock_sizze_49630)) && ((local_tid_54648 - squot32(local_tid_54648, wave_sizze_54650) * wave_sizze_54650) == 0 && (squot32(local_tid_54648, wave_sizze_54650) & (2 * skip_waves_54673 - 1)) == 0)) {\n                // read array element\n                {\n                    eta_p_54666 = ((__local int64_t *) red_arr_i64_mem_54652)[sext_i32_i64(local_tid_54648 + offset_54672)];\n                }\n                // apply reduction operation\n                {\n                    int64_t zp_res_54667 = add64(eta_p_54665, eta_p_54666);\n                    \n                    eta_p_54665 = zp_res_54667;\n                }\n                // write result of operation\n                {\n                    ((__local int64_t *) red_arr_i64_mem_54652)[sext_i32_i64(local_tid_54648)] = eta_p_54665;\n                }\n            }\n            skip_waves_54673 *= 2;\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        barrier(CLK_LOCAL_MEM_FENCE);\n        // thread 0 updates per-block acc(s); rest reset to ne\n        {\n            if (sext_i32_i64(local_tid_54648) == (int64_t) 0) {\n                eta_p_block_res_acc_54664 = eta_p_54665;\n            } else {\n                eta_p_block_res_acc_54664 = (int64_t) 0;\n            }\n        }\n        if (blocks_per_segment_54619 == (int64_t) 1) {\n            // firs", "t thread in block saves final result to memory\n            {\n                if (local_tid_54648 == 0) {\n                    ((__global int64_t *) mem_53511)[inf_29887 + gtid_49634] = eta_p_block_res_acc_54664;\n                }\n            }\n        } else {\n            int32_t old_counter_54674;\n            bool is_last_block_54675;\n            \n            // first thread in block saves block result to global memory\n            {\n                if (local_tid_54648 == 0) {\n                    ((__global int64_t *) segred_tmp_mem_54623)[sext_i32_i64(virt_tblock_id_54659)] = eta_p_block_res_acc_54664;\n                    mem_fence_global();\n                    old_counter_54674 = atomic_add_i32_global(&((volatile __global int *) counters_mem_54625)[srem64(flat_segment_id_54660, (int64_t) 20480)], (int) 1);\n                    ((__local bool *) sync_arr_mem_54654)[(int64_t) 0] = old_counter_54674 == sext_i64_i32(blocks_per_segment_54619 - (int64_t) 1);\n                }\n            }\n            barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n            is_last_block_54675 = ((__local bool *) sync_arr_mem_54654)[(int64_t) 0];\n            if (is_last_block_54675) {\n                if (local_tid_54648 == 0) {\n                    old_counter_54674 = atomic_add_i32_global(&((volatile __global int *) counters_mem_54625)[srem64(flat_segment_id_54660, (int64_t) 20480)], (int) sext_i64_i32((int64_t) 0 - blocks_per_segment_54619));\n                }\n                // read in the per-block-results\n                {\n                    int64_t read_per_thread_54676 = sdiv_up64(blocks_per_segment_54619, segred_tblock_sizze_49630);\n                    \n                    eta_p_49637 = (int64_t) 0;\n                    for (int64_t i_54677 = 0; i_54677 < read_per_thread_54676; i_54677++) {\n                        int64_t block_res_id_54678 = sext_i32_i64(local_tid_54648) * read_per_thread_54676 + i_54677;\n                        int64_t index_of_block_res_54679 = flat_segm", "ent_id_54660 * blocks_per_segment_54619 + block_res_id_54678;\n                        \n                        if (slt64(block_res_id_54678, blocks_per_segment_54619)) {\n                            eta_p_49638 = ((__global int64_t *) segred_tmp_mem_54623)[index_of_block_res_54679];\n                            \n                            int64_t zp_res_49639 = add64(eta_p_49637, eta_p_49638);\n                            \n                            eta_p_49637 = zp_res_49639;\n                        }\n                    }\n                }\n                ((__local int64_t *) red_arr_i64_mem_54652)[sext_i32_i64(local_tid_54648)] = eta_p_49637;\n                barrier(CLK_LOCAL_MEM_FENCE);\n                // reduce the per-block results\n                {\n                    int32_t offset_54680;\n                    int32_t skip_waves_54681 = 1;\n                    int64_t eta_p_54665;\n                    int64_t eta_p_54666;\n                    \n                    offset_54680 = 0;\n                    // participating threads read initial accumulator\n                    {\n                        if (slt32(local_tid_54648, sext_i64_i32(segred_tblock_sizze_49630))) {\n                            eta_p_54665 = ((__local int64_t *) red_arr_i64_mem_54652)[sext_i32_i64(local_tid_54648 + offset_54680)];\n                        }\n                    }\n                    offset_54680 = 1;\n                    while (slt32(offset_54680, wave_sizze_54650)) {\n                        if (slt32(local_tid_54648 + offset_54680, sext_i64_i32(segred_tblock_sizze_49630)) && ((local_tid_54648 - squot32(local_tid_54648, wave_sizze_54650) * wave_sizze_54650) & (2 * offset_54680 - 1)) == 0) {\n                            // read array element\n                            {\n                                eta_p_54666 = ((volatile __local int64_t *) red_arr_i64_mem_54652)[sext_i32_i64(local_tid_54648 + offset_54680)];\n                            }\n                            // apply reductio",
                                    "n operation\n                            {\n                                int64_t zp_res_54667 = add64(eta_p_54665, eta_p_54666);\n                                \n                                eta_p_54665 = zp_res_54667;\n                            }\n                            // write result of operation\n                            {\n                                ((volatile __local int64_t *) red_arr_i64_mem_54652)[sext_i32_i64(local_tid_54648)] = eta_p_54665;\n                            }\n                        }\n                        offset_54680 *= 2;\n                    }\n                    while (slt32(skip_waves_54681, squot32(sext_i64_i32(segred_tblock_sizze_49630) + wave_sizze_54650 - 1, wave_sizze_54650))) {\n                        barrier(CLK_LOCAL_MEM_FENCE);\n                        offset_54680 = skip_waves_54681 * wave_sizze_54650;\n                        if (slt32(local_tid_54648 + offset_54680, sext_i64_i32(segred_tblock_sizze_49630)) && ((local_tid_54648 - squot32(local_tid_54648, wave_sizze_54650) * wave_sizze_54650) == 0 && (squot32(local_tid_54648, wave_sizze_54650) & (2 * skip_waves_54681 - 1)) == 0)) {\n                            // read array element\n                            {\n                                eta_p_54666 = ((__local int64_t *) red_arr_i64_mem_54652)[sext_i32_i64(local_tid_54648 + offset_54680)];\n                            }\n                            // apply reduction operation\n                            {\n                                int64_t zp_res_54667 = add64(eta_p_54665, eta_p_54666);\n                                \n                                eta_p_54665 = zp_res_54667;\n                            }\n                            // write result of operation\n                            {\n                                ((__local int64_t *) red_arr_i64_mem_54652)[sext_i32_i64(local_tid_54648)] = eta_p_54665;\n                            }\n                        }\n                        skip_waves_5468", "1 *= 2;\n                    }\n                    barrier(CLK_LOCAL_MEM_FENCE);\n                    // and back to memory with the final result\n                    {\n                        if (local_tid_54648 == 0) {\n                            ((__global int64_t *) mem_53511)[inf_29887 + gtid_49634] = eta_p_54665;\n                        }\n                    }\n                }\n            }\n        }\n        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    }\n    \n  error_6:\n    return;\n    #undef segred_tblock_sizze_49630\n    #undef chunk_sizze_54590\n}\nFUTHARK_KERNEL_SIZED(get_num_neighbours_against_10106zisegred_small_49636_dim1, 1, 1)\nvoid get_num_neighbours_against_10106zisegred_small_49636(__global int *global_failure, int64_t n2_29852, double eps_29857, int8_t dist_t_29858, int8_t angle_t_29859, double radius_29860, int64_t inf_29887, int64_t dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_29893, int64_t num_tblocks_49631, unsigned char x_53480_bits, int64_t segment_sizze_nonzzero_54591, __global unsigned char *dat1_mem_53506, __global unsigned char *dat1_mem_53507, __global unsigned char *dat2_mem_53508, __global unsigned char *dat2_mem_53509, __global unsigned char *mem_53511, __global unsigned char *mem_53517, __global unsigned char *mem_53519, __global unsigned char *mem_53521)\n{\n    bool x_53480 = x_53480_bits;\n    \n    #define segred_tblock_sizze_49630 (get_num_neighbours_against_10106zisegred_small_49636zisegred_tblock_sizze_49630)\n    \n    volatile __local unsigned char *red_arr_i64_mem_54598_backing_0 = &shared_mem[0];\n    const int64_t red_arr_i64_mem_54598_backing_0_offset = 0 + ((int64_t) 8 * segred_tblock_sizze_49630 + srem64((int64_t) 8 - srem64((int64_t) 8 * segred_tblock_sizze_49630, (int64_t) 8), (int64_t) 8));\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_54594;\n    int32_t tblock_sizze_54597;\n    int32_t wave_sizze_54596;\n    int32_t block_id_54595;\n    int32_t global_tid_54593;\n    int64_t phys_tid_49636;\n    __", "local unsigned char *red_arr_i64_mem_54598;\n    int32_t phys_tblock_id_54600;\n    int32_t iterations_54601;\n    \n    local_tid_54594 = get_local_id(0);\n    tblock_sizze_54597 = get_local_size(0);\n    wave_sizze_54596 = LOCKSTEP_WIDTH;\n    block_id_54595 = get_tblock_id(0);\n    global_tid_54593 = block_id_54595 * tblock_sizze_54597 + local_tid_54594;\n    phys_tid_49636 = sext_i32_i64(global_tid_54593);\n    red_arr_i64_mem_54598 = (__local unsigned char *) red_arr_i64_mem_54598_backing_0;\n    phys_tblock_id_54600 = get_tblock_id(0);\n    iterations_54601 = sdiv_up32(sext_i64_i32(sdiv_up64(dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_29893, squot64(segred_tblock_sizze_49630, segment_sizze_nonzzero_54591))) - phys_tblock_id_54600, sext_i64_i32(num_tblocks_49631));\n    for (int32_t i_54602 = 0; i_54602 < iterations_54601; i_54602++) {\n        int32_t virt_tblock_id_54603;\n        int64_t slice_54604;\n        int64_t gtid_49634;\n        int64_t remnant_54605;\n        int64_t gtid_49635;\n        \n        virt_tblock_id_54603 = phys_tblock_id_54600 + i_54602 * sext_i64_i32(num_tblocks_49631);\n        slice_54604 = dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_29893;\n        gtid_49634 = squot64(sext_i32_i64(local_tid_54594), segment_sizze_nonzzero_54591) + sext_i32_i64(virt_tblock_id_54603) * squot64(segred_tblock_sizze_49630, segment_sizze_nonzzero_54591);\n        remnant_54605 = squot64(sext_i32_i64(local_tid_54594), segment_sizze_nonzzero_54591) + sext_i32_i64(virt_tblock_id_54603) * squot64(segred_tblock_sizze_49630, segment_sizze_nonzzero_54591) - gtid_49634;\n        gtid_49635 = srem64(sext_i32_i64(local_tid_54594), n2_29852);\n        // apply map function if in bounds\n        {\n            if (slt64((int64_t) 0, n2_29852) && (slt64(gtid_49634, dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_29893) && slt64(sext_i32_i64(local_tid_54594), n2_29852 * squot64(segred_tblock_sizze_49630, segment_sizze_nonzzero_54591)))) {\n                // apply map function\n                {\n                    int64_t slice",
                                    "_49678 = inf_29887 + gtid_49634;\n                    double eta_p_49645 = ((__global double *) dat2_mem_53508)[gtid_49635];\n                    double eta_p_49646 = ((__global double *) dat2_mem_53509)[gtid_49635];\n                    double d_haversine_res_49642;\n                    \n                    if (x_53480) {\n                        double x_53482 = ((__global double *) mem_53517)[gtid_49634];\n                        \n                        d_haversine_res_49642 = x_53482;\n                    } else {\n                        d_haversine_res_49642 = 0.0;\n                    }\n                    \n                    double d_haversine_res_49643;\n                    \n                    if (x_53480) {\n                        double x_53484 = ((__global double *) mem_53519)[gtid_49634];\n                        \n                        d_haversine_res_49643 = x_53484;\n                    } else {\n                        d_haversine_res_49643 = 0.0;\n                    }\n                    \n                    double cos_res_49644;\n                    \n                    if (x_53480) {\n                        double x_53486 = ((__global double *) mem_53521)[gtid_49634];\n                        \n                        cos_res_49644 = x_53486;\n                    } else {\n                        cos_res_49644 = 0.0;\n                    }\n                    \n                    double dist_res_49647;\n                    \n                    if (dist_t_29858 == (int8_t) 0) {\n                        double eta_p_49640 = ((__global double *) dat1_mem_53506)[slice_49678];\n                        double eta_p_49641 = ((__global double *) dat1_mem_53507)[slice_49678];\n                        double zm_res_49648 = eta_p_49641 - eta_p_49646;\n                        double zm_res_49649 = eta_p_49640 - eta_p_49645;\n                        double hypot_res_49650 = futrts_hypot64(zm_res_49649, zm_res_49648);\n                        \n                        dist_res_49647", " = hypot_res_49650;\n                    } else {\n                        double d_haversine_res_49651;\n                        double d_haversine_res_49652;\n                        \n                        if (angle_t_29859 == (int8_t) 1) {\n                            d_haversine_res_49651 = eta_p_49645;\n                            d_haversine_res_49652 = eta_p_49646;\n                        } else {\n                            double zt_res_49653 = 3.141592653589793 * eta_p_49645;\n                            double zs_res_49654 = zt_res_49653 / 180.0;\n                            double zt_res_49655 = 3.141592653589793 * eta_p_49646;\n                            double zs_res_49656 = zt_res_49655 / 180.0;\n                            \n                            d_haversine_res_49651 = zs_res_49654;\n                            d_haversine_res_49652 = zs_res_49656;\n                        }\n                        \n                        double zm_res_49657 = d_haversine_res_49642 - d_haversine_res_49651;\n                        double cos_res_49658 = futrts_cos64(zm_res_49657);\n                        double zm_res_49659 = 1.0 - cos_res_49658;\n                        double cos_res_49660 = futrts_cos64(d_haversine_res_49651);\n                        double zt_res_49661 = cos_res_49644 * cos_res_49660;\n                        double zm_res_49662 = d_haversine_res_49643 - d_haversine_res_49652;\n                        double zm_res_49663 = 1.0 - zm_res_49662;\n                        double zt_res_49664 = zt_res_49661 * zm_res_49663;\n                        double zp_res_49665 = zm_res_49659 + zt_res_49664;\n                        double zs_res_49666 = zp_res_49665 / 2.0;\n                        double min_res_49667 = fmin64(1.0, zs_res_49666);\n                        double zt_res_49668 = 2.0 * min_res_49667;\n                        double zm_res_49669 = 1.0 - zt_res_49668;\n                        double acos_res_49670 = futrts_acos64(zm_res_49669);\n                   ", "     double zt_res_49671 = radius_29860 * acos_res_49670;\n                        \n                        dist_res_49647 = zt_res_49671;\n                    }\n                    \n                    bool zlze_res_49672 = dist_res_49647 <= eps_29857;\n                    int64_t bool_res_49673 = btoi_bool_i64(zlze_res_49672);\n                    \n                    // save results to be reduced\n                    {\n                        ((__local int64_t *) red_arr_i64_mem_54598)[sext_i32_i64(local_tid_54594)] = bool_res_49673;\n                    }\n                }\n            } else {\n                ((__local int64_t *) red_arr_i64_mem_54598)[sext_i32_i64(local_tid_54594)] = (int64_t) 0;\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        if (slt64((int64_t) 0, n2_29852)) {\n            // perform segmented scan to imitate reduction\n            {\n                int64_t eta_p_49637;\n                int64_t eta_p_49638;\n                int64_t eta_p_54606;\n                int64_t eta_p_54607;\n                bool ltid_in_bounds_54609 = slt64(sext_i32_i64(local_tid_54594), n2_29852 * squot64(segred_tblock_sizze_49630, segment_sizze_nonzzero_54591));\n                int32_t skip_threads_54610;\n                \n                // read input for in-block scan\n                {\n                    if (ltid_in_bounds_54609) {\n                        eta_p_49638 = ((volatile __local int64_t *) red_arr_i64_mem_54598)[sext_i32_i64(local_tid_54594)];\n                        if ((local_tid_54594 - squot32(local_tid_54594, 32) * 32) == 0) {\n                            eta_p_49637 = eta_p_49638;\n                        }\n                    }\n                }\n                // in-block scan (hopefully no barriers needed)\n                {\n                    skip_threads_54610 = 1;\n                    while (slt32(skip_threads_54610, 32)) {\n                        bool thread_active_54611 = sle32(skip_threads_54610, local_tid_54594 - squot32(local_tid_5",
                                    "4594, 32) * 32) && ltid_in_bounds_54609;\n                        \n                        if (thread_active_54611) {\n                            // read operands\n                            {\n                                eta_p_49637 = ((volatile __local int64_t *) red_arr_i64_mem_54598)[sext_i32_i64(local_tid_54594) - sext_i32_i64(skip_threads_54610)];\n                            }\n                        }\n                        // perform operation\n                        {\n                            bool inactive_54612 = slt64(srem64(sext_i32_i64(local_tid_54594), n2_29852), sext_i32_i64(local_tid_54594) - sext_i32_i64(local_tid_54594 - skip_threads_54610));\n                            \n                            if (thread_active_54611 && inactive_54612) {\n                                eta_p_49637 = eta_p_49638;\n                            }\n                            if (thread_active_54611) {\n                                if (!inactive_54612) {\n                                    int64_t zp_res_49639 = add64(eta_p_49637, eta_p_49638);\n                                    \n                                    eta_p_49637 = zp_res_49639;\n                                }\n                            }\n                        }\n                        if (sle32(wave_sizze_54596, skip_threads_54610)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        if (thread_active_54611) {\n                            // write result\n                            {\n                                ((volatile __local int64_t *) red_arr_i64_mem_54598)[sext_i32_i64(local_tid_54594)] = eta_p_49637;\n                                eta_p_49638 = eta_p_49637;\n                            }\n                        }\n                        if (sle32(wave_sizze_54596, skip_threads_54610)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        skip_threads_54610 *= 2;\n   ", "                 }\n                }\n                barrier(CLK_LOCAL_MEM_FENCE);\n                // last thread of block 'i' writes its result to offset 'i'\n                {\n                    if ((local_tid_54594 - squot32(local_tid_54594, 32) * 32) == 31 && ltid_in_bounds_54609) {\n                        ((volatile __local int64_t *) red_arr_i64_mem_54598)[sext_i32_i64(squot32(local_tid_54594, 32))] = eta_p_49637;\n                    }\n                }\n                barrier(CLK_LOCAL_MEM_FENCE);\n                // scan the first block, after which offset 'i' contains carry-in for block 'i+1'\n                {\n                    int32_t skip_threads_54613;\n                    \n                    // read input for in-block scan\n                    {\n                        if (squot32(local_tid_54594, 32) == 0 && ltid_in_bounds_54609) {\n                            eta_p_54607 = ((volatile __local int64_t *) red_arr_i64_mem_54598)[sext_i32_i64(local_tid_54594)];\n                            if ((local_tid_54594 - squot32(local_tid_54594, 32) * 32) == 0) {\n                                eta_p_54606 = eta_p_54607;\n                            }\n                        }\n                    }\n                    // in-block scan (hopefully no barriers needed)\n                    {\n                        skip_threads_54613 = 1;\n                        while (slt32(skip_threads_54613, 32)) {\n                            bool thread_active_54614 = sle32(skip_threads_54613, local_tid_54594 - squot32(local_tid_54594, 32) * 32) && (squot32(local_tid_54594, 32) == 0 && ltid_in_bounds_54609);\n                            \n                            if (thread_active_54614) {\n                                // read operands\n                                {\n                                    eta_p_54606 = ((volatile __local int64_t *) red_arr_i64_mem_54598)[sext_i32_i64(local_tid_54594) - sext_i32_i64(skip_threads_54613)];\n                                }\n             ", "               }\n                            // perform operation\n                            {\n                                bool inactive_54615 = slt64(srem64(sext_i32_i64(local_tid_54594 * 32 + 32 - 1), n2_29852), sext_i32_i64(local_tid_54594 * 32 + 32 - 1) - sext_i32_i64((local_tid_54594 - skip_threads_54613) * 32 + 32 - 1));\n                                \n                                if (thread_active_54614 && inactive_54615) {\n                                    eta_p_54606 = eta_p_54607;\n                                }\n                                if (thread_active_54614) {\n                                    if (!inactive_54615) {\n                                        int64_t zp_res_54608 = add64(eta_p_54606, eta_p_54607);\n                                        \n                                        eta_p_54606 = zp_res_54608;\n                                    }\n                                }\n                            }\n                            if (sle32(wave_sizze_54596, skip_threads_54613)) {\n                                barrier(CLK_LOCAL_MEM_FENCE);\n                            }\n                            if (thread_active_54614) {\n                                // write result\n                                {\n                                    ((volatile __local int64_t *) red_arr_i64_mem_54598)[sext_i32_i64(local_tid_54594)] = eta_p_54606;\n                                    eta_p_54607 = eta_p_54606;\n                                }\n                            }\n                            if (sle32(wave_sizze_54596, skip_threads_54613)) {\n                                barrier(CLK_LOCAL_MEM_FENCE);\n                            }\n                            skip_threads_54613 *= 2;\n                        }\n                    }\n                }\n                barrier(CLK_LOCAL_MEM_FENCE);\n                \n                bool no_carry_in_54616 = squot32(local_tid_54594, 32) == 0 || !ltid_in_bounds_54609;\n          ",
                                    "      \n                // carry-in for every block except the first\n                {\n                    // read operands\n                    {\n                        if (!no_carry_in_54616) {\n                            eta_p_49638 = eta_p_49637;\n                            eta_p_49637 = ((__local int64_t *) red_arr_i64_mem_54598)[sext_i32_i64(squot32(local_tid_54594, 32)) - (int64_t) 1];\n                        }\n                    }\n                    // perform operation\n                    {\n                        bool inactive_54617 = slt64(srem64(sext_i32_i64(local_tid_54594), n2_29852), sext_i32_i64(local_tid_54594) - sext_i32_i64(squot32(local_tid_54594, 32) * 32 - 1));\n                        \n                        if (!no_carry_in_54616) {\n                            if (inactive_54617) {\n                                eta_p_49637 = eta_p_49638;\n                            }\n                        }\n                        if (!no_carry_in_54616) {\n                            if (!inactive_54617) {\n                                int64_t zp_res_49639 = add64(eta_p_49637, eta_p_49638);\n                                \n                                eta_p_49637 = zp_res_49639;\n                            }\n                        }\n                    }\n                    // write final result\n                    {\n                        if (!no_carry_in_54616) {\n                            ((__local int64_t *) red_arr_i64_mem_54598)[sext_i32_i64(local_tid_54594)] = eta_p_49637;\n                        }\n                    }\n                }\n                barrier(CLK_LOCAL_MEM_FENCE);\n                // restore correct values for first block\n                {\n                    if (squot32(local_tid_54594, 32) == 0 && ltid_in_bounds_54609) {\n                        ((__local int64_t *) red_arr_i64_mem_54598)[sext_i32_i64(local_tid_54594)] = eta_p_49638;\n                    }\n                }\n                barrier(CLK_LOCAL_MEM_FENCE);\n  ", "          }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        // save final values of segments\n        {\n            if (slt64(sext_i32_i64(virt_tblock_id_54603) * squot64(segred_tblock_sizze_49630, segment_sizze_nonzzero_54591) + sext_i32_i64(local_tid_54594), dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_29893) && slt64(sext_i32_i64(local_tid_54594), squot64(segred_tblock_sizze_49630, segment_sizze_nonzzero_54591))) {\n                int64_t tmp_54618 = ((__local int64_t *) red_arr_i64_mem_54598)[(sext_i32_i64(local_tid_54594) + (int64_t) 1) * segment_sizze_nonzzero_54591 - (int64_t) 1];\n                \n                ((__global int64_t *) mem_53511)[inf_29887 + (sext_i32_i64(virt_tblock_id_54603) * squot64(segred_tblock_sizze_49630, segment_sizze_nonzzero_54591) + sext_i32_i64(local_tid_54594))] = tmp_54618;\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    }\n    \n  error_3:\n    return;\n    #undef segred_tblock_sizze_49630\n}\nFUTHARK_KERNEL_SIZED(make_collisions_compact_doublezisegmap_45656_dim1, 1, 1)\nvoid make_collisions_compact_doublezisegmap_45656(__global int *global_failure, int64_t dz2084U_37611, int64_t m_39959, int64_t num_tblocks_45661, int32_t virt_num_tblocks_54752, __global unsigned char *chain_collisions_mem_53506, __global unsigned char *chain_collisions_mem_53507, __global unsigned char *mem_53635, __global unsigned char *mem_53637, __global unsigned char *mem_53639, __global unsigned char *mem_53641)\n{\n    #define segmap_tblock_sizze_45659 (make_collisions_compact_doublezisegmap_45656zisegmap_tblock_sizze_45659)\n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_54754;\n    int32_t tblock_sizze_54757;\n    int32_t wave_sizze_54756;\n    int32_t block_id_54755;\n    int32_t global_tid_54753;\n    int64_t phys_tid_45656;\n    int32_t phys_tblock_id_54758;\n    int32_t iterations_54759;\n    \n    local_tid_54754 = get_local_id(0);\n    tblock_sizze_54757 = get_local", "_size(0);\n    wave_sizze_54756 = LOCKSTEP_WIDTH;\n    block_id_54755 = get_tblock_id(0);\n    global_tid_54753 = block_id_54755 * tblock_sizze_54757 + local_tid_54754;\n    phys_tid_45656 = sext_i32_i64(global_tid_54753);\n    phys_tblock_id_54758 = get_tblock_id(0);\n    iterations_54759 = sdiv_up32(virt_num_tblocks_54752 - phys_tblock_id_54758, sext_i64_i32(num_tblocks_45661));\n    for (int32_t i_54760 = 0; i_54760 < iterations_54759; i_54760++) {\n        int32_t virt_tblock_id_54761;\n        int64_t global_tid_54762;\n        int64_t slice_54763;\n        int64_t write_i_45655;\n        int64_t remnant_54764;\n        \n        virt_tblock_id_54761 = phys_tblock_id_54758 + i_54760 * sext_i64_i32(num_tblocks_45661);\n        global_tid_54762 = sext_i32_i64(virt_tblock_id_54761) * segmap_tblock_sizze_45659 + sext_i32_i64(local_tid_54754);\n        slice_54763 = dz2084U_37611;\n        write_i_45655 = global_tid_54762;\n        remnant_54764 = global_tid_54762 - write_i_45655;\n        if (slt64(write_i_45655, dz2084U_37611)) {\n            int64_t eta_p_44714;\n            int64_t write_value_44716;\n            int64_t write_value_44717;\n            bool cond_44718;\n            int64_t lifted_lambda_res_44719;\n            \n            eta_p_44714 = ((__global int64_t *) mem_53637)[write_i_45655];\n            write_value_44716 = ((__global int64_t *) chain_collisions_mem_53506)[write_i_45655];\n            write_value_44717 = ((__global int64_t *) chain_collisions_mem_53507)[write_i_45655];\n            cond_44718 = eta_p_44714 == (int64_t) 1;\n            if (cond_44718) {\n                int64_t eta_p_44715;\n                int64_t lifted_lambda_res_t_res_44751;\n                \n                eta_p_44715 = ((__global int64_t *) mem_53635)[write_i_45655];\n                lifted_lambda_res_t_res_44751 = sub64(eta_p_44715, (int64_t) 1);\n                lifted_lambda_res_44719 = lifted_lambda_res_t_res_44751;\n            } else {\n                lifted_lambda_res_44719 = (int64_t) -1;\n",
                                    "            }\n            if (sle64((int64_t) 0, lifted_lambda_res_44719) && slt64(lifted_lambda_res_44719, m_39959)) {\n                ((__global int64_t *) mem_53641)[lifted_lambda_res_44719] = write_value_44716;\n            }\n            if (sle64((int64_t) 0, lifted_lambda_res_44719) && slt64(lifted_lambda_res_44719, m_39959)) {\n                ((__global int64_t *) mem_53639)[lifted_lambda_res_44719] = write_value_44717;\n            }\n        }\n        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    }\n    \n  error_1:\n    return;\n    #undef segmap_tblock_sizze_45659\n}\nFUTHARK_KERNEL_SIZED(make_collisions_compact_doublezisegmap_intrablock_49824_dim1, 1, 1)\nvoid make_collisions_compact_doublezisegmap_intrablock_49824(__global int *global_failure, int failure_is_an_option, __global int64_t *global_failure_args, int64_t dz2084U_37611, int64_t inf_39884, int64_t dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_39887, int64_t ldim_49827, int64_t num_whole_tiles_49852, int64_t residual_input_50004, unsigned char cond_50005_bits, int64_t binop_x_50018, __global unsigned char *chain_collisions_mem_53506, __global unsigned char *chain_collisions_mem_53507, __global unsigned char *mem_53533)\n{\n    bool cond_50005 = cond_50005_bits;\n    \n    #define tile_sizze_49826 (make_collisions_compact_doublezisegmap_intrablock_49824zitile_sizze_49826)\n    #define bytes_53602 (make_collisions_compact_doublezisegmap_intrablock_49824zibytes_53602)\n    \n    volatile __local unsigned char *color_54517_backing_1 = &shared_mem[0];\n    const int64_t color_54517_backing_1_offset = 0 + (bytes_53602 + srem64((int64_t) 8 - srem64(bytes_53602, (int64_t) 8), (int64_t) 8));\n    volatile __local unsigned char *color_54516_backing_0 = &shared_mem[color_54517_backing_1_offset];\n    const int64_t color_54516_backing_0_offset = color_54517_backing_1_offset + (bytes_53602 + srem64((int64_t) 8 - srem64(bytes_53602, (int64_t) 8), (int64_t) 8));\n    volatile __local int local_failure;\n    \n    if (failure_is_an_op", "tion) {\n        int failed = *global_failure >= 0;\n        \n        if (failed)\n            return;\n    }\n    local_failure = 0;\n    barrier(CLK_LOCAL_MEM_FENCE);\n    \n    int32_t local_tid_54568;\n    int32_t tblock_sizze_54571;\n    int32_t wave_sizze_54570;\n    int32_t block_id_54569;\n    int32_t global_tid_54567;\n    int64_t gid_flat_49824;\n    int64_t slice_54573;\n    int64_t ltid_pre_54572;\n    int64_t remnant_54574;\n    int64_t slice_54575;\n    int64_t gid_49823;\n    int64_t remnant_54576;\n    __local unsigned char *color_54516;\n    __local unsigned char *color_54517;\n    int64_t binop_x_49836;\n    int64_t mem_53587[1];\n    int64_t mem_53591[1];\n    int64_t ltid_flat_49829;\n    int64_t ltid_49828;\n    int64_t gtid_49837;\n    bool cond_49838;\n    int64_t pre_49839;\n    int64_t pre_49840;\n    int64_t mem_53595[1];\n    int64_t mem_53599[1];\n    int64_t ltid_flat_49854;\n    int64_t ltid_49853;\n    int64_t gtid_49862;\n    bool cond_49863;\n    int64_t neutral_49864;\n    int64_t neutral_49865;\n    int64_t ext_mem_53615[1];\n    int64_t ext_mem_53614[1];\n    int64_t mem_param_53600[1];\n    int64_t mem_param_53601[1];\n    int64_t mem_53623[1];\n    int64_t ext_mem_53624[1];\n    bool mem_53627[1];\n    int64_t ltid_flat_50076;\n    int64_t ltid_50075;\n    int64_t gtid_50082;\n    bool cond_50085;\n    bool postlude_50086;\n    \n    local_tid_54568 = get_local_id(0);\n    tblock_sizze_54571 = get_local_size(0);\n    wave_sizze_54570 = LOCKSTEP_WIDTH;\n    block_id_54569 = get_tblock_id(0);\n    global_tid_54567 = block_id_54569 * tblock_sizze_54571 + local_tid_54568;\n    gid_flat_49824 = sext_i32_i64(block_id_54569);\n    slice_54573 = tile_sizze_49826;\n    ltid_pre_54572 = sext_i32_i64(local_tid_54568);\n    remnant_54574 = sext_i32_i64(local_tid_54568) - ltid_pre_54572;\n    slice_54575 = ldim_49827;\n    gid_49823 = sext_i32_i64(block_id_54569);\n    remnant_54576 = sext_i32_i64(block_id_54569) - gid_49823;\n    color_54516 = (__local unsigned char *) color_54516_backing_0;\n    color_5", "4517 = (__local unsigned char *) color_54517_backing_1;\n    binop_x_49836 = gid_49823 * tile_sizze_49826;\n    ltid_flat_49829 = sext_i32_i64(local_tid_54568);\n    ltid_49828 = sext_i32_i64(sext_i64_i32(ltid_pre_54572));\n    gtid_49837 = ltid_49828 + binop_x_49836;\n    cond_49838 = slt64(gtid_49837, dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_39887);\n    if (cond_49838) {\n        int64_t index_primexp_49841;\n        bool x_49842;\n        bool y_49843;\n        bool bounds_check_49844;\n        bool index_certs_49845;\n        int64_t lifted_lambda_res_49846;\n        int64_t lifted_lambda_res_49847;\n        \n        index_primexp_49841 = add64(inf_39884, gtid_49837);\n        x_49842 = sle64((int64_t) 0, index_primexp_49841);\n        y_49843 = slt64(index_primexp_49841, dz2084U_37611);\n        bounds_check_49844 = x_49842 && y_49843;\n        if (!bounds_check_49844) {\n            {\n                if (atomic_cmpxchg_i32_global(global_failure, -1, 22) == -1) {\n                    global_failure_args[0] = (int64_t) index_primexp_49841;\n                    global_failure_args[1] = (int64_t) dz2084U_37611;\n                    ;\n                }\n                local_failure = 1;\n                goto error_0;\n            }\n        }\n        lifted_lambda_res_49846 = ((__global int64_t *) chain_collisions_mem_53506)[index_primexp_49841];\n        lifted_lambda_res_49847 = ((__global int64_t *) chain_collisions_mem_53507)[index_primexp_49841];\n        pre_49839 = lifted_lambda_res_49846;\n        pre_49840 = lifted_lambda_res_49847;\n    } else {\n        pre_49839 = (int64_t) 0;\n        pre_49840 = (int64_t) 0;\n    }\n    mem_53587[(int64_t) 0] = pre_49839;\n    mem_53591[(int64_t) 0] = pre_49840;\n    \n  error_0:\n    barrier(CLK_LOCAL_MEM_FENCE);\n    if (local_failure)\n        return;\n    barrier(CLK_LOCAL_MEM_FENCE);\n    ltid_flat_49854 = sext_i32_i64(local_tid_54568);\n    ltid_49853 = sext_i32_i64(sext_i64_i32(ltid_pre_54572));\n    gtid_49862 = binop_x_49836 + ltid_49853;\n    cond_49863 = s",
                                    "lt64(gtid_49862, dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_39887);\n    if (cond_49863) {\n        int64_t lifted_lambda_res_49866;\n        int64_t lifted_lambda_res_49867;\n        \n        lifted_lambda_res_49866 = mem_53587[(int64_t) 0];\n        lifted_lambda_res_49867 = mem_53591[(int64_t) 0];\n        neutral_49864 = lifted_lambda_res_49866;\n        neutral_49865 = lifted_lambda_res_49867;\n    } else {\n        neutral_49864 = (int64_t) 0;\n        neutral_49865 = (int64_t) 0;\n    }\n    mem_53595[(int64_t) 0] = neutral_49864;\n    mem_53599[(int64_t) 0] = neutral_49865;\n    barrier(CLK_LOCAL_MEM_FENCE);\n    barrier(CLK_LOCAL_MEM_FENCE);\n    for (int32_t i_2 = 0; i_2 < 1; i_2++)\n        mem_param_53600[i_2] = mem_53595[i_2];\n    for (int32_t i_3 = 0; i_3 < 1; i_3++)\n        mem_param_53601[i_3] = mem_53599[i_3];\n    for (int64_t tile_id_49874 = 0; tile_id_49874 < num_whole_tiles_49852; tile_id_49874++) {\n        int64_t binop_x_49944;\n        int64_t ltid_flat_49943;\n        int64_t ltid_49942;\n        int64_t j_49945;\n        bool cond_49950;\n        int64_t pre1d_49951;\n        int64_t pre1d_49952;\n        int64_t mem_53609[1];\n        int64_t mem_53613[1];\n        int64_t ltid_flat_49960;\n        int64_t ltid_49959;\n        int64_t gtid_49962;\n        int64_t acc_49965;\n        int64_t acc_49966;\n        bool cond_49967;\n        int64_t acc_49968;\n        int64_t acc_49969;\n        int64_t mem_param_tmp_54577[1];\n        int64_t mem_param_tmp_54578[1];\n        \n        binop_x_49944 = tile_sizze_49826 * tile_id_49874;\n        ltid_flat_49943 = sext_i32_i64(local_tid_54568);\n        ltid_49942 = sext_i32_i64(sext_i64_i32(ltid_pre_54572));\n        j_49945 = ltid_49942 + binop_x_49944;\n        cond_49950 = slt64(j_49945, dz2084U_37611);\n        if (cond_49950) {\n            int64_t tile_elem_49953;\n            int64_t tile_elem_49954;\n            \n            tile_elem_49953 = ((__global int64_t *) chain_collisions_mem_53506)[j_49945];\n            tile_elem_49954 = ((__global ", "int64_t *) chain_collisions_mem_53507)[j_49945];\n            pre1d_49951 = tile_elem_49953;\n            pre1d_49952 = tile_elem_49954;\n        } else {\n            pre1d_49951 = (int64_t) 0;\n            pre1d_49952 = (int64_t) 0;\n        }\n        ((__local int64_t *) color_54517)[ltid_49942] = pre1d_49951;\n        ((__local int64_t *) color_54516)[ltid_49942] = pre1d_49952;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        ltid_flat_49960 = sext_i32_i64(local_tid_54568);\n        ltid_49959 = sext_i32_i64(sext_i64_i32(ltid_pre_54572));\n        gtid_49962 = binop_x_49836 + ltid_49959;\n        acc_49965 = mem_param_53600[(int64_t) 0];\n        acc_49966 = mem_param_53601[(int64_t) 0];\n        cond_49967 = slt64(gtid_49962, dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_39887);\n        if (cond_49967) {\n            int64_t lifted_lambda_res_49963;\n            int64_t x_49970;\n            int64_t x_49971;\n            int64_t redout_53108;\n            int64_t redout_53109;\n            \n            lifted_lambda_res_49963 = mem_53587[(int64_t) 0];\n            redout_53108 = acc_49965;\n            redout_53109 = acc_49966;\n            for (int64_t i_53110 = 0; i_53110 < tile_sizze_49826; i_53110++) {\n                int64_t x_49972;\n                int64_t x_49973;\n                bool cond_49978;\n                bool cond_49979;\n                bool cond_49980;\n                bool cond_f_res_t_res_49981;\n                bool x_49982;\n                bool y_49983;\n                bool cond_49984;\n                int64_t lifted_lambda_res_49985;\n                int64_t lifted_lambda_res_49986;\n                int64_t redout_tmp_54581;\n                int64_t redout_tmp_54582;\n                \n                x_49972 = ((__local int64_t *) color_54517)[i_53110];\n                x_49973 = ((__local int64_t *) color_54516)[i_53110];\n                cond_49978 = redout_53108 == lifted_lambda_res_49963;\n                cond_49979 = !cond_49978;\n                cond_49980 = x_49972 == lifted_lamb", "da_res_49963;\n                cond_f_res_t_res_49981 = slt64(x_49973, redout_53109);\n                x_49982 = cond_49980 && cond_f_res_t_res_49981;\n                y_49983 = cond_49978 && x_49982;\n                cond_49984 = cond_49979 || y_49983;\n                if (cond_49984) {\n                    lifted_lambda_res_49985 = x_49972;\n                } else {\n                    lifted_lambda_res_49985 = redout_53108;\n                }\n                if (cond_49984) {\n                    lifted_lambda_res_49986 = x_49973;\n                } else {\n                    lifted_lambda_res_49986 = redout_53109;\n                }\n                redout_tmp_54581 = lifted_lambda_res_49985;\n                redout_tmp_54582 = lifted_lambda_res_49986;\n                redout_53108 = redout_tmp_54581;\n                redout_53109 = redout_tmp_54582;\n            }\n            x_49970 = redout_53108;\n            x_49971 = redout_53109;\n            acc_49968 = x_49970;\n            acc_49969 = x_49971;\n        } else {\n            acc_49968 = acc_49965;\n            acc_49969 = acc_49966;\n        }\n        mem_53609[(int64_t) 0] = acc_49968;\n        mem_53613[(int64_t) 0] = acc_49969;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        for (int32_t i_4 = 0; i_4 < 1; i_4++)\n            mem_param_tmp_54577[i_4] = mem_53609[i_4];\n        for (int32_t i_5 = 0; i_5 < 1; i_5++)\n            mem_param_tmp_54578[i_5] = mem_53613[i_5];\n        for (int32_t i_6 = 0; i_6 < 1; i_6++)\n            mem_param_53600[i_6] = mem_param_tmp_54577[i_6];\n        for (int32_t i_7 = 0; i_7 < 1; i_7++)\n            mem_param_53601[i_7] = mem_param_tmp_54578[i_7];\n    }\n    for (int32_t i_8 = 0; i_8 < 1; i_8++)\n        ext_mem_53615[i_8] = mem_param_53600[i_8];\n    for (int32_t i_9 = 0; i_9 < 1; i_9++)\n        ext_mem_53614[i_9] = mem_param_53601[i_9];\n    barrier(CLK_LOCAL_MEM_FENCE);\n    if (cond_50005) {\n        for (int32_t i_10 = 0; i_10 < 1; i_10++)\n            ext_mem_53624[i_10] = ext_mem_53614[i_10];\n    }",
                                    " else {\n        int64_t ltid_flat_50007;\n        int64_t ltid_50006;\n        int64_t j_50019;\n        bool cond_50024;\n        int64_t pre1d_50025;\n        int64_t pre1d_50026;\n        int64_t ltid_flat_50036;\n        int64_t ltid_50035;\n        int64_t gtid_50046;\n        int64_t acc_50050;\n        bool cond_50051;\n        int64_t acc_50053;\n        \n        ltid_flat_50007 = sext_i32_i64(local_tid_54568);\n        ltid_50006 = sext_i32_i64(sext_i64_i32(ltid_pre_54572));\n        j_50019 = ltid_50006 + binop_x_50018;\n        cond_50024 = slt64(j_50019, dz2084U_37611);\n        if (cond_50024) {\n            int64_t tile_elem_50027;\n            int64_t tile_elem_50028;\n            \n            tile_elem_50027 = ((__global int64_t *) chain_collisions_mem_53506)[j_50019];\n            tile_elem_50028 = ((__global int64_t *) chain_collisions_mem_53507)[j_50019];\n            pre1d_50025 = tile_elem_50027;\n            pre1d_50026 = tile_elem_50028;\n        } else {\n            pre1d_50025 = (int64_t) 0;\n            pre1d_50026 = (int64_t) 0;\n        }\n        ((__local int64_t *) color_54517)[ltid_50006] = pre1d_50025;\n        ((__local int64_t *) color_54516)[ltid_50006] = pre1d_50026;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        ltid_flat_50036 = sext_i32_i64(local_tid_54568);\n        ltid_50035 = sext_i32_i64(sext_i64_i32(ltid_pre_54572));\n        gtid_50046 = binop_x_49836 + ltid_50035;\n        acc_50050 = ext_mem_53614[(int64_t) 0];\n        cond_50051 = slt64(gtid_50046, dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_39887);\n        if (cond_50051) {\n            int64_t lifted_lambda_res_50047;\n            int64_t acc_50049;\n            int64_t x_50054;\n            int64_t x_50055;\n            int64_t redout_53111;\n            int64_t redout_53112;\n            \n            lifted_lambda_res_50047 = mem_53587[(int64_t) 0];\n            acc_50049 = ext_mem_53615[(int64_t) 0];\n            redout_53111 = acc_50049;\n            redout_53112 = acc_50050;\n            for (int64_t i_53113 = ", "0; i_53113 < residual_input_50004; i_53113++) {\n                int64_t x_50056;\n                int64_t x_50057;\n                bool cond_50062;\n                bool cond_50063;\n                bool cond_50064;\n                bool cond_f_res_t_res_50065;\n                bool x_50066;\n                bool y_50067;\n                bool cond_50068;\n                int64_t lifted_lambda_res_50069;\n                int64_t lifted_lambda_res_50070;\n                int64_t redout_tmp_54583;\n                int64_t redout_tmp_54584;\n                \n                x_50056 = ((__local int64_t *) color_54517)[i_53113];\n                x_50057 = ((__local int64_t *) color_54516)[i_53113];\n                cond_50062 = redout_53111 == lifted_lambda_res_50047;\n                cond_50063 = !cond_50062;\n                cond_50064 = x_50056 == lifted_lambda_res_50047;\n                cond_f_res_t_res_50065 = slt64(x_50057, redout_53112);\n                x_50066 = cond_50064 && cond_f_res_t_res_50065;\n                y_50067 = cond_50062 && x_50066;\n                cond_50068 = cond_50063 || y_50067;\n                if (cond_50068) {\n                    lifted_lambda_res_50069 = x_50056;\n                } else {\n                    lifted_lambda_res_50069 = redout_53111;\n                }\n                if (cond_50068) {\n                    lifted_lambda_res_50070 = x_50057;\n                } else {\n                    lifted_lambda_res_50070 = redout_53112;\n                }\n                redout_tmp_54583 = lifted_lambda_res_50069;\n                redout_tmp_54584 = lifted_lambda_res_50070;\n                redout_53111 = redout_tmp_54583;\n                redout_53112 = redout_tmp_54584;\n            }\n            x_50054 = redout_53111;\n            x_50055 = redout_53112;\n            acc_50053 = x_50055;\n        } else {\n            acc_50053 = acc_50050;\n        }\n        mem_53623[(int64_t) 0] = acc_50053;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        for (int32_t i_11 = 0; i", "_11 < 1; i_11++)\n            ext_mem_53624[i_11] = mem_53623[i_11];\n    }\n    ltid_flat_50076 = sext_i32_i64(local_tid_54568);\n    ltid_50075 = sext_i32_i64(sext_i64_i32(ltid_pre_54572));\n    gtid_50082 = binop_x_49836 + ltid_50075;\n    cond_50085 = slt64(gtid_50082, dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_39887);\n    if (cond_50085) {\n        int64_t defunc_0_f_res_50084;\n        int64_t lifted_lambda_res_50088;\n        bool lifted_lambda_res_50089;\n        \n        defunc_0_f_res_50084 = ext_mem_53624[(int64_t) 0];\n        lifted_lambda_res_50088 = mem_53591[(int64_t) 0];\n        lifted_lambda_res_50089 = defunc_0_f_res_50084 == lifted_lambda_res_50088;\n        postlude_50086 = lifted_lambda_res_50089;\n    } else {\n        postlude_50086 = 0;\n    }\n    mem_53627[(int64_t) 0] = postlude_50086;\n    barrier(CLK_LOCAL_MEM_FENCE);\n    if (slt64(sext_i32_i64(local_tid_54568) + tile_sizze_49826 * sext_i32_i64(block_id_54569), dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_39887)) {\n        bool tmp_54585 = mem_53627[(int64_t) 0];\n        \n        ((__global bool *) mem_53533)[inf_39884 + (sext_i32_i64(local_tid_54568) + tile_sizze_49826 * sext_i32_i64(block_id_54569))] = tmp_54585;\n    }\n    \n  error_9:\n    return;\n    #undef tile_sizze_49826\n    #undef bytes_53602\n}\nFUTHARK_KERNEL_SIZED(make_collisions_compact_doublezisegmap_intrablock_50093_dim1, 1, 1)\nvoid make_collisions_compact_doublezisegmap_intrablock_50093(__global int *global_failure, int failure_is_an_option, __global int64_t *global_failure_args, int64_t dz2084U_37611, int64_t inf_39884, int64_t dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_39887, int64_t ldim_50096, int64_t num_whole_tiles_50121, int64_t residual_input_50273, unsigned char cond_50274_bits, int64_t binop_x_50287, __global unsigned char *chain_collisions_mem_53506, __global unsigned char *chain_collisions_mem_53507, __global unsigned char *mem_53533)\n{\n    bool cond_50274 = cond_50274_bits;\n    \n    #define tile_sizze_50095 (make_collisions_compact_doublezisegmap_intrablock_",
                                    "50093zitile_sizze_50095)\n    #define bytes_53556 (make_collisions_compact_doublezisegmap_intrablock_50093zibytes_53556)\n    \n    volatile __local unsigned char *color_54519_backing_1 = &shared_mem[0];\n    const int64_t color_54519_backing_1_offset = 0 + (bytes_53556 + srem64((int64_t) 8 - srem64(bytes_53556, (int64_t) 8), (int64_t) 8));\n    volatile __local unsigned char *color_54518_backing_0 = &shared_mem[color_54519_backing_1_offset];\n    const int64_t color_54518_backing_0_offset = color_54519_backing_1_offset + (bytes_53556 + srem64((int64_t) 8 - srem64(bytes_53556, (int64_t) 8), (int64_t) 8));\n    volatile __local int local_failure;\n    \n    if (failure_is_an_option) {\n        int failed = *global_failure >= 0;\n        \n        if (failed)\n            return;\n    }\n    local_failure = 0;\n    barrier(CLK_LOCAL_MEM_FENCE);\n    \n    int32_t local_tid_54589;\n    int32_t tblock_sizze_54592;\n    int32_t wave_sizze_54591;\n    int32_t block_id_54590;\n    int32_t global_tid_54588;\n    int64_t gid_flat_50093;\n    int64_t slice_54594;\n    int64_t ltid_pre_54593;\n    int64_t remnant_54595;\n    int64_t slice_54596;\n    int64_t gid_50092;\n    int64_t remnant_54597;\n    __local unsigned char *color_54518;\n    __local unsigned char *color_54519;\n    int64_t binop_x_50105;\n    int64_t mem_53541[1];\n    int64_t mem_53545[1];\n    int64_t ltid_flat_50098;\n    int64_t ltid_50097;\n    int64_t gtid_50106;\n    bool cond_50107;\n    int64_t pre_50108;\n    int64_t pre_50109;\n    int64_t mem_53549[1];\n    int64_t mem_53553[1];\n    int64_t ltid_flat_50123;\n    int64_t ltid_50122;\n    int64_t gtid_50131;\n    bool cond_50132;\n    int64_t neutral_50133;\n    int64_t neutral_50134;\n    int64_t ext_mem_53569[1];\n    int64_t ext_mem_53568[1];\n    int64_t mem_param_53554[1];\n    int64_t mem_param_53555[1];\n    int64_t mem_53577[1];\n    int64_t ext_mem_53578[1];\n    bool mem_53581[1];\n    int64_t ltid_flat_50345;\n    int64_t ltid_50344;\n    int64_t gtid_50351;\n    bool cond_50354;\n    bool postlud", "e_50355;\n    \n    local_tid_54589 = get_local_id(0);\n    tblock_sizze_54592 = get_local_size(0);\n    wave_sizze_54591 = LOCKSTEP_WIDTH;\n    block_id_54590 = get_tblock_id(0);\n    global_tid_54588 = block_id_54590 * tblock_sizze_54592 + local_tid_54589;\n    gid_flat_50093 = sext_i32_i64(block_id_54590);\n    slice_54594 = tile_sizze_50095;\n    ltid_pre_54593 = sext_i32_i64(local_tid_54589);\n    remnant_54595 = sext_i32_i64(local_tid_54589) - ltid_pre_54593;\n    slice_54596 = ldim_50096;\n    gid_50092 = sext_i32_i64(block_id_54590);\n    remnant_54597 = sext_i32_i64(block_id_54590) - gid_50092;\n    color_54518 = (__local unsigned char *) color_54518_backing_0;\n    color_54519 = (__local unsigned char *) color_54519_backing_1;\n    binop_x_50105 = gid_50092 * tile_sizze_50095;\n    ltid_flat_50098 = sext_i32_i64(local_tid_54589);\n    ltid_50097 = sext_i32_i64(sext_i64_i32(ltid_pre_54593));\n    gtid_50106 = ltid_50097 + binop_x_50105;\n    cond_50107 = slt64(gtid_50106, dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_39887);\n    if (cond_50107) {\n        int64_t index_primexp_50110;\n        bool x_50111;\n        bool y_50112;\n        bool bounds_check_50113;\n        bool index_certs_50114;\n        int64_t lifted_lambda_res_50115;\n        int64_t lifted_lambda_res_50116;\n        \n        index_primexp_50110 = add64(inf_39884, gtid_50106);\n        x_50111 = sle64((int64_t) 0, index_primexp_50110);\n        y_50112 = slt64(index_primexp_50110, dz2084U_37611);\n        bounds_check_50113 = x_50111 && y_50112;\n        if (!bounds_check_50113) {\n            {\n                if (atomic_cmpxchg_i32_global(global_failure, -1, 23) == -1) {\n                    global_failure_args[0] = (int64_t) index_primexp_50110;\n                    global_failure_args[1] = (int64_t) dz2084U_37611;\n                    ;\n                }\n                local_failure = 1;\n                goto error_0;\n            }\n        }\n        lifted_lambda_res_50115 = ((__global int64_t *) chain_collisions_mem_53506)[index_p", "rimexp_50110];\n        lifted_lambda_res_50116 = ((__global int64_t *) chain_collisions_mem_53507)[index_primexp_50110];\n        pre_50108 = lifted_lambda_res_50115;\n        pre_50109 = lifted_lambda_res_50116;\n    } else {\n        pre_50108 = (int64_t) 0;\n        pre_50109 = (int64_t) 0;\n    }\n    mem_53541[(int64_t) 0] = pre_50108;\n    mem_53545[(int64_t) 0] = pre_50109;\n    \n  error_0:\n    barrier(CLK_LOCAL_MEM_FENCE);\n    if (local_failure)\n        return;\n    barrier(CLK_LOCAL_MEM_FENCE);\n    ltid_flat_50123 = sext_i32_i64(local_tid_54589);\n    ltid_50122 = sext_i32_i64(sext_i64_i32(ltid_pre_54593));\n    gtid_50131 = binop_x_50105 + ltid_50122;\n    cond_50132 = slt64(gtid_50131, dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_39887);\n    if (cond_50132) {\n        int64_t lifted_lambda_res_50135;\n        int64_t lifted_lambda_res_50136;\n        \n        lifted_lambda_res_50135 = mem_53541[(int64_t) 0];\n        lifted_lambda_res_50136 = mem_53545[(int64_t) 0];\n        neutral_50133 = lifted_lambda_res_50135;\n        neutral_50134 = lifted_lambda_res_50136;\n    } else {\n        neutral_50133 = (int64_t) 0;\n        neutral_50134 = (int64_t) 0;\n    }\n    mem_53549[(int64_t) 0] = neutral_50133;\n    mem_53553[(int64_t) 0] = neutral_50134;\n    barrier(CLK_LOCAL_MEM_FENCE);\n    barrier(CLK_LOCAL_MEM_FENCE);\n    for (int32_t i_2 = 0; i_2 < 1; i_2++)\n        mem_param_53554[i_2] = mem_53549[i_2];\n    for (int32_t i_3 = 0; i_3 < 1; i_3++)\n        mem_param_53555[i_3] = mem_53553[i_3];\n    for (int64_t tile_id_50143 = 0; tile_id_50143 < num_whole_tiles_50121; tile_id_50143++) {\n        int64_t binop_x_50213;\n        int64_t ltid_flat_50212;\n        int64_t ltid_50211;\n        int64_t j_50214;\n        bool cond_50219;\n        int64_t pre1d_50220;\n        int64_t pre1d_50221;\n        int64_t mem_53563[1];\n        int64_t mem_53567[1];\n        int64_t ltid_flat_50229;\n        int64_t ltid_50228;\n        int64_t gtid_50231;\n        int64_t acc_50234;\n        int64_t acc_50235;\n        bool c",
                                    "ond_50236;\n        int64_t acc_50237;\n        int64_t acc_50238;\n        int64_t mem_param_tmp_54598[1];\n        int64_t mem_param_tmp_54599[1];\n        \n        binop_x_50213 = tile_sizze_50095 * tile_id_50143;\n        ltid_flat_50212 = sext_i32_i64(local_tid_54589);\n        ltid_50211 = sext_i32_i64(sext_i64_i32(ltid_pre_54593));\n        j_50214 = ltid_50211 + binop_x_50213;\n        cond_50219 = slt64(j_50214, dz2084U_37611);\n        if (cond_50219) {\n            int64_t tile_elem_50222;\n            int64_t tile_elem_50223;\n            \n            tile_elem_50222 = ((__global int64_t *) chain_collisions_mem_53506)[j_50214];\n            tile_elem_50223 = ((__global int64_t *) chain_collisions_mem_53507)[j_50214];\n            pre1d_50220 = tile_elem_50222;\n            pre1d_50221 = tile_elem_50223;\n        } else {\n            pre1d_50220 = (int64_t) 0;\n            pre1d_50221 = (int64_t) 0;\n        }\n        ((__local int64_t *) color_54519)[ltid_50211] = pre1d_50220;\n        ((__local int64_t *) color_54518)[ltid_50211] = pre1d_50221;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        ltid_flat_50229 = sext_i32_i64(local_tid_54589);\n        ltid_50228 = sext_i32_i64(sext_i64_i32(ltid_pre_54593));\n        gtid_50231 = binop_x_50105 + ltid_50228;\n        acc_50234 = mem_param_53554[(int64_t) 0];\n        acc_50235 = mem_param_53555[(int64_t) 0];\n        cond_50236 = slt64(gtid_50231, dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_39887);\n        if (cond_50236) {\n            int64_t lifted_lambda_res_50232;\n            int64_t x_50239;\n            int64_t x_50240;\n            int64_t redout_53114;\n            int64_t redout_53115;\n            \n            lifted_lambda_res_50232 = mem_53541[(int64_t) 0];\n            redout_53114 = acc_50234;\n            redout_53115 = acc_50235;\n            for (int64_t i_53116 = 0; i_53116 < tile_sizze_50095; i_53116++) {\n                int64_t x_50241;\n                int64_t x_50242;\n                bool cond_50247;\n                bool cond_5024", "8;\n                bool cond_50249;\n                bool cond_f_res_t_res_50250;\n                bool x_50251;\n                bool y_50252;\n                bool cond_50253;\n                int64_t lifted_lambda_res_50254;\n                int64_t lifted_lambda_res_50255;\n                int64_t redout_tmp_54602;\n                int64_t redout_tmp_54603;\n                \n                x_50241 = ((__local int64_t *) color_54519)[i_53116];\n                x_50242 = ((__local int64_t *) color_54518)[i_53116];\n                cond_50247 = redout_53114 == lifted_lambda_res_50232;\n                cond_50248 = !cond_50247;\n                cond_50249 = x_50241 == lifted_lambda_res_50232;\n                cond_f_res_t_res_50250 = slt64(x_50242, redout_53115);\n                x_50251 = cond_50249 && cond_f_res_t_res_50250;\n                y_50252 = cond_50247 && x_50251;\n                cond_50253 = cond_50248 || y_50252;\n                if (cond_50253) {\n                    lifted_lambda_res_50254 = x_50241;\n                } else {\n                    lifted_lambda_res_50254 = redout_53114;\n                }\n                if (cond_50253) {\n                    lifted_lambda_res_50255 = x_50242;\n                } else {\n                    lifted_lambda_res_50255 = redout_53115;\n                }\n                redout_tmp_54602 = lifted_lambda_res_50254;\n                redout_tmp_54603 = lifted_lambda_res_50255;\n                redout_53114 = redout_tmp_54602;\n                redout_53115 = redout_tmp_54603;\n            }\n            x_50239 = redout_53114;\n            x_50240 = redout_53115;\n            acc_50237 = x_50239;\n            acc_50238 = x_50240;\n        } else {\n            acc_50237 = acc_50234;\n            acc_50238 = acc_50235;\n        }\n        mem_53563[(int64_t) 0] = acc_50237;\n        mem_53567[(int64_t) 0] = acc_50238;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        for (int32_t i_4 = 0; i_4 < 1; i_4++)\n            mem_param_tmp_54598[i_4] = mem_53563[i_", "4];\n        for (int32_t i_5 = 0; i_5 < 1; i_5++)\n            mem_param_tmp_54599[i_5] = mem_53567[i_5];\n        for (int32_t i_6 = 0; i_6 < 1; i_6++)\n            mem_param_53554[i_6] = mem_param_tmp_54598[i_6];\n        for (int32_t i_7 = 0; i_7 < 1; i_7++)\n            mem_param_53555[i_7] = mem_param_tmp_54599[i_7];\n    }\n    for (int32_t i_8 = 0; i_8 < 1; i_8++)\n        ext_mem_53569[i_8] = mem_param_53554[i_8];\n    for (int32_t i_9 = 0; i_9 < 1; i_9++)\n        ext_mem_53568[i_9] = mem_param_53555[i_9];\n    barrier(CLK_LOCAL_MEM_FENCE);\n    if (cond_50274) {\n        for (int32_t i_10 = 0; i_10 < 1; i_10++)\n            ext_mem_53578[i_10] = ext_mem_53568[i_10];\n    } else {\n        int64_t ltid_flat_50276;\n        int64_t ltid_50275;\n        int64_t j_50288;\n        bool cond_50293;\n        int64_t pre1d_50294;\n        int64_t pre1d_50295;\n        int64_t ltid_flat_50305;\n        int64_t ltid_50304;\n        int64_t gtid_50315;\n        int64_t acc_50319;\n        bool cond_50320;\n        int64_t acc_50322;\n        \n        ltid_flat_50276 = sext_i32_i64(local_tid_54589);\n        ltid_50275 = sext_i32_i64(sext_i64_i32(ltid_pre_54593));\n        j_50288 = ltid_50275 + binop_x_50287;\n        cond_50293 = slt64(j_50288, dz2084U_37611);\n        if (cond_50293) {\n            int64_t tile_elem_50296;\n            int64_t tile_elem_50297;\n            \n            tile_elem_50296 = ((__global int64_t *) chain_collisions_mem_53506)[j_50288];\n            tile_elem_50297 = ((__global int64_t *) chain_collisions_mem_53507)[j_50288];\n            pre1d_50294 = tile_elem_50296;\n            pre1d_50295 = tile_elem_50297;\n        } else {\n            pre1d_50294 = (int64_t) 0;\n            pre1d_50295 = (int64_t) 0;\n        }\n        ((__local int64_t *) color_54519)[ltid_50275] = pre1d_50294;\n        ((__local int64_t *) color_54518)[ltid_50275] = pre1d_50295;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        ltid_flat_50305 = sext_i32_i64(local_tid_54589);\n        ltid_50304 = sext_i32_i64",
                                    "(sext_i64_i32(ltid_pre_54593));\n        gtid_50315 = binop_x_50105 + ltid_50304;\n        acc_50319 = ext_mem_53568[(int64_t) 0];\n        cond_50320 = slt64(gtid_50315, dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_39887);\n        if (cond_50320) {\n            int64_t lifted_lambda_res_50316;\n            int64_t acc_50318;\n            int64_t x_50323;\n            int64_t x_50324;\n            int64_t redout_53117;\n            int64_t redout_53118;\n            \n            lifted_lambda_res_50316 = mem_53541[(int64_t) 0];\n            acc_50318 = ext_mem_53569[(int64_t) 0];\n            redout_53117 = acc_50318;\n            redout_53118 = acc_50319;\n            for (int64_t i_53119 = 0; i_53119 < residual_input_50273; i_53119++) {\n                int64_t x_50325;\n                int64_t x_50326;\n                bool cond_50331;\n                bool cond_50332;\n                bool cond_50333;\n                bool cond_f_res_t_res_50334;\n                bool x_50335;\n                bool y_50336;\n                bool cond_50337;\n                int64_t lifted_lambda_res_50338;\n                int64_t lifted_lambda_res_50339;\n                int64_t redout_tmp_54604;\n                int64_t redout_tmp_54605;\n                \n                x_50325 = ((__local int64_t *) color_54519)[i_53119];\n                x_50326 = ((__local int64_t *) color_54518)[i_53119];\n                cond_50331 = redout_53117 == lifted_lambda_res_50316;\n                cond_50332 = !cond_50331;\n                cond_50333 = x_50325 == lifted_lambda_res_50316;\n                cond_f_res_t_res_50334 = slt64(x_50326, redout_53118);\n                x_50335 = cond_50333 && cond_f_res_t_res_50334;\n                y_50336 = cond_50331 && x_50335;\n                cond_50337 = cond_50332 || y_50336;\n                if (cond_50337) {\n                    lifted_lambda_res_50338 = x_50325;\n                } else {\n                    lifted_lambda_res_50338 = redout_53117;\n                }\n                if (cond_5033", "7) {\n                    lifted_lambda_res_50339 = x_50326;\n                } else {\n                    lifted_lambda_res_50339 = redout_53118;\n                }\n                redout_tmp_54604 = lifted_lambda_res_50338;\n                redout_tmp_54605 = lifted_lambda_res_50339;\n                redout_53117 = redout_tmp_54604;\n                redout_53118 = redout_tmp_54605;\n            }\n            x_50323 = redout_53117;\n            x_50324 = redout_53118;\n            acc_50322 = x_50324;\n        } else {\n            acc_50322 = acc_50319;\n        }\n        mem_53577[(int64_t) 0] = acc_50322;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        for (int32_t i_11 = 0; i_11 < 1; i_11++)\n            ext_mem_53578[i_11] = mem_53577[i_11];\n    }\n    ltid_flat_50345 = sext_i32_i64(local_tid_54589);\n    ltid_50344 = sext_i32_i64(sext_i64_i32(ltid_pre_54593));\n    gtid_50351 = binop_x_50105 + ltid_50344;\n    cond_50354 = slt64(gtid_50351, dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_39887);\n    if (cond_50354) {\n        int64_t defunc_0_f_res_50353;\n        int64_t lifted_lambda_res_50357;\n        bool lifted_lambda_res_50358;\n        \n        defunc_0_f_res_50353 = ext_mem_53578[(int64_t) 0];\n        lifted_lambda_res_50357 = mem_53545[(int64_t) 0];\n        lifted_lambda_res_50358 = defunc_0_f_res_50353 == lifted_lambda_res_50357;\n        postlude_50355 = lifted_lambda_res_50358;\n    } else {\n        postlude_50355 = 0;\n    }\n    mem_53581[(int64_t) 0] = postlude_50355;\n    barrier(CLK_LOCAL_MEM_FENCE);\n    if (slt64(sext_i32_i64(local_tid_54589) + tile_sizze_50095 * sext_i32_i64(block_id_54590), dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_39887)) {\n        bool tmp_54606 = mem_53581[(int64_t) 0];\n        \n        ((__global bool *) mem_53533)[inf_39884 + (sext_i32_i64(local_tid_54589) + tile_sizze_50095 * sext_i32_i64(block_id_54590))] = tmp_54606;\n    }\n    \n  error_9:\n    return;\n    #undef tile_sizze_50095\n    #undef bytes_53556\n}\nFUTHARK_KERNEL_SIZED(make_collisions_compact_doublezisegscan", "_45654_dim1, 1, 1)\nvoid make_collisions_compact_doublezisegscan_45654(__global int *global_failure, int64_t dz2084U_37611, int64_t num_tblocks_45651, int64_t num_virt_blocks_54614, int64_t num_virt_threads_54615, __global unsigned char *mem_53533, __global unsigned char *mem_53635, __global unsigned char *mem_53637, __global unsigned char *status_flags_mem_54616, __global unsigned char *aggregates_mem_54638, __global unsigned char *incprefixes_mem_54640, __global unsigned char *global_dynid_mem_54642)\n{\n    #define segscan_tblock_sizze_45649 (make_collisions_compact_doublezisegscan_45654zisegscan_tblock_sizze_45649)\n    #define chunk_sizze_54613 (make_collisions_compact_doublezisegscan_45654zichunk_sizze_54613)\n    \n    volatile __local unsigned char *local_mem_54672_backing_0 = &shared_mem[0];\n    const int64_t local_mem_54672_backing_0_offset = 0 + (smax64(smax64((int64_t) 288, (int64_t) 8 * segscan_tblock_sizze_45649), chunk_sizze_54613 * segscan_tblock_sizze_45649 * (int64_t) 8) + srem64((int64_t) 8 - srem64(smax64(smax64((int64_t) 288, (int64_t) 8 * segscan_tblock_sizze_45649), chunk_sizze_54613 * segscan_tblock_sizze_45649 * (int64_t) 8), (int64_t) 8), (int64_t) 8));\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_54665;\n    int32_t tblock_sizze_54668;\n    int32_t wave_sizze_54667;\n    int32_t block_id_54666;\n    int32_t global_tid_54664;\n    int64_t phys_tid_45654;\n    int32_t chunk_sizze_32b_54669;\n    int64_t byte_offsets_54670;\n    int64_t warp_byte_offset_54671;\n    __local unsigned char *local_mem_54672;\n    int64_t trans_arr_len_54673;\n    int64_t phys_block_id_54679;\n    int64_t virtloop_bound_54680;\n    \n    local_tid_54665 = get_local_id(0);\n    tblock_sizze_54668 = get_local_size(0);\n    wave_sizze_54667 = LOCKSTEP_WIDTH;\n    block_id_54666 = get_tblock_id(0);\n    global_tid_54664 = block_id_54666 * tblock_sizze_54668 + local_tid_54665;\n    phys_tid_45654 = sext_i32_i64(global_tid_54664);\n    chunk_sizze_32b_54669 = sex",
                                    "t_i64_i32(chunk_sizze_54613);\n    byte_offsets_54670 = segscan_tblock_sizze_45649 * (int64_t) 8;\n    warp_byte_offset_54671 = (int64_t) 288;\n    // Allocate reusable shared memory\n    { }\n    local_mem_54672 = (__local unsigned char *) local_mem_54672_backing_0;\n    trans_arr_len_54673 = chunk_sizze_54613 * segscan_tblock_sizze_45649;\n    phys_block_id_54679 = get_tblock_id(0);\n    virtloop_bound_54680 = sdiv_up64(num_virt_blocks_54614 - phys_block_id_54679, num_tblocks_45651);\n    for (int64_t virtloop_i_54681 = 0; virtloop_i_54681 < virtloop_bound_54680; virtloop_i_54681++) {\n        int64_t dynamic_id_54682;\n        int64_t block_offset_54683;\n        int64_t sgm_idx_54684;\n        int32_t boundary_54685;\n        int32_t segsizze_compact_54686;\n        int64_t private_mem_54687[chunk_sizze_54613];\n        int64_t thd_offset_54689;\n        int64_t acc_54705;\n        int64_t prefix_54715;\n        bool block_new_sgm_54716;\n        \n        // First thread in block fetches this block's dynamic_id\n        {\n            if (local_tid_54665 == 0) {\n                dynamic_id_54682 = atomic_add_i32_global(&((volatile __global int *) global_dynid_mem_54642)[(int64_t) 0], (int) 1);\n                // Set dynamic id for this block\n                {\n                    ((__local int64_t *) local_mem_54672)[(int64_t) 0] = dynamic_id_54682;\n                }\n                // First thread in last (virtual) block resets global dynamic_id\n                {\n                    if (dynamic_id_54682 == num_virt_blocks_54614 - (int64_t) 1) {\n                        ((__global int32_t *) global_dynid_mem_54642)[(int64_t) 0] = 0;\n                    }\n                }\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        dynamic_id_54682 = ((__local int32_t *) local_mem_54672)[(int64_t) 0];\n        barrier(CLK_LOCAL_MEM_FENCE);\n        block_offset_54683 = dynamic_id_54682 * chunk_sizze_54613 * segscan_tblock_sizze_45649;\n        sgm_idx_54684 = smod64(block_offset_5", "4683, dz2084U_37611);\n        boundary_54685 = sext_i64_i32(smin64(chunk_sizze_54613 * segscan_tblock_sizze_45649, dz2084U_37611 - sgm_idx_54684));\n        segsizze_compact_54686 = sext_i64_i32(smin64(chunk_sizze_54613 * segscan_tblock_sizze_45649, dz2084U_37611));\n        thd_offset_54689 = block_offset_54683 + sext_i32_i64(local_tid_54665);\n        // Load and map\n        {\n            for (int64_t i_54690 = 0; i_54690 < chunk_sizze_54613; i_54690++) {\n                int64_t virt_tid_54691 = thd_offset_54689 + i_54690 * segscan_tblock_sizze_45649;\n                int64_t slice_54692 = dz2084U_37611;\n                int64_t gtid_45653 = virt_tid_54691;\n                int64_t remnant_54693 = virt_tid_54691 - gtid_45653;\n                \n                if (slt64(virt_tid_54691, dz2084U_37611)) {\n                    bool tmp_44734 = ((__global bool *) mem_53533)[gtid_45653];\n                    int64_t defunc_0_f_res_44740 = btoi_bool_i64(tmp_44734);\n                    \n                    ((__global int64_t *) mem_53637)[gtid_45653] = defunc_0_f_res_44740;\n                    private_mem_54687[i_54690] = defunc_0_f_res_44740;\n                } else {\n                    private_mem_54687[i_54690] = (int64_t) 0;\n                }\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        // Transpose scan inputs\n        {\n            for (int64_t i_54694 = 0; i_54694 < chunk_sizze_54613; i_54694++) {\n                int64_t sharedIdx_54695 = sext_i32_i64(local_tid_54665) + i_54694 * segscan_tblock_sizze_45649;\n                int64_t tmp_54696 = private_mem_54687[i_54694];\n                \n                ((__local int64_t *) local_mem_54672)[sharedIdx_54695] = tmp_54696;\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            for (int64_t i_54697 = 0; i_54697 < chunk_sizze_54613; i_54697++) {\n                int64_t sharedIdx_54698 = sext_i32_i64(local_tid_54665) * chunk_sizze_54613 + i_54697;\n                int64_t tmp_54699 = ((__local i", "nt64_t *) local_mem_54672)[sharedIdx_54698];\n                \n                private_mem_54687[i_54697] = tmp_54699;\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n        }\n        // Per thread scan\n        {\n            for (int64_t i_54700 = 0; i_54700 < chunk_sizze_54613 - (int64_t) 1; i_54700++) {\n                int64_t eta_p_39948;\n                int64_t eta_p_39949;\n                \n                eta_p_39948 = private_mem_54687[i_54700];\n                eta_p_39949 = private_mem_54687[i_54700 + (int64_t) 1];\n                \n                int64_t defunc_0_op_res_39950 = add64(eta_p_39948, eta_p_39949);\n                \n                private_mem_54687[i_54700 + (int64_t) 1] = defunc_0_op_res_39950;\n            }\n        }\n        // Publish results in shared memory\n        {\n            int64_t tmp_54701 = private_mem_54687[chunk_sizze_54613 - (int64_t) 1];\n            \n            ((__local int64_t *) local_mem_54672)[sext_i32_i64(local_tid_54665)] = tmp_54701;\n            barrier(CLK_LOCAL_MEM_FENCE);\n        }\n        // Scan results (with warp scan)\n        {\n            int64_t eta_p_54702;\n            int64_t eta_p_54703;\n            int64_t eta_p_54706;\n            int64_t eta_p_54707;\n            bool ltid_in_bounds_54709 = slt64(sext_i32_i64(local_tid_54665), num_virt_threads_54615);\n            int32_t skip_threads_54710;\n            \n            // read input for in-block scan\n            {\n                if (ltid_in_bounds_54709) {\n                    eta_p_54703 = ((volatile __local int64_t *) local_mem_54672)[sext_i32_i64(local_tid_54665)];\n                    if ((local_tid_54665 - squot32(local_tid_54665, 32) * 32) == 0) {\n                        eta_p_54702 = eta_p_54703;\n                    }\n                }\n            }\n            // in-block scan (hopefully no barriers needed)\n            {\n                skip_threads_54710 = 1;\n                while (slt32(skip_threads_54710, 32)) {\n                    bool thread_",
                                    "active_54711 = sle32(skip_threads_54710, local_tid_54665 - squot32(local_tid_54665, 32) * 32) && ltid_in_bounds_54709;\n                    \n                    if (thread_active_54711) {\n                        // read operands\n                        {\n                            eta_p_54702 = ((volatile __local int64_t *) local_mem_54672)[sext_i32_i64(local_tid_54665) - sext_i32_i64(skip_threads_54710)];\n                        }\n                    }\n                    // perform operation\n                    {\n                        if (thread_active_54711) {\n                            int64_t defunc_0_op_res_54704 = add64(eta_p_54702, eta_p_54703);\n                            \n                            eta_p_54702 = defunc_0_op_res_54704;\n                        }\n                    }\n                    if (sle32(wave_sizze_54667, skip_threads_54710)) {\n                        barrier(CLK_LOCAL_MEM_FENCE);\n                    }\n                    if (thread_active_54711) {\n                        // write result\n                        {\n                            ((volatile __local int64_t *) local_mem_54672)[sext_i32_i64(local_tid_54665)] = eta_p_54702;\n                            eta_p_54703 = eta_p_54702;\n                        }\n                    }\n                    if (sle32(wave_sizze_54667, skip_threads_54710)) {\n                        barrier(CLK_LOCAL_MEM_FENCE);\n                    }\n                    skip_threads_54710 *= 2;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // last thread of block 'i' writes its result to offset 'i'\n            {\n                if ((local_tid_54665 - squot32(local_tid_54665, 32) * 32) == 31 && ltid_in_bounds_54709) {\n                    ((volatile __local int64_t *) local_mem_54672)[sext_i32_i64(squot32(local_tid_54665, 32))] = eta_p_54702;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // scan the first block, after which o", "ffset 'i' contains carry-in for block 'i+1'\n            {\n                int32_t skip_threads_54712;\n                \n                // read input for in-block scan\n                {\n                    if (squot32(local_tid_54665, 32) == 0 && ltid_in_bounds_54709) {\n                        eta_p_54707 = ((volatile __local int64_t *) local_mem_54672)[sext_i32_i64(local_tid_54665)];\n                        if ((local_tid_54665 - squot32(local_tid_54665, 32) * 32) == 0) {\n                            eta_p_54706 = eta_p_54707;\n                        }\n                    }\n                }\n                // in-block scan (hopefully no barriers needed)\n                {\n                    skip_threads_54712 = 1;\n                    while (slt32(skip_threads_54712, 32)) {\n                        bool thread_active_54713 = sle32(skip_threads_54712, local_tid_54665 - squot32(local_tid_54665, 32) * 32) && (squot32(local_tid_54665, 32) == 0 && ltid_in_bounds_54709);\n                        \n                        if (thread_active_54713) {\n                            // read operands\n                            {\n                                eta_p_54706 = ((volatile __local int64_t *) local_mem_54672)[sext_i32_i64(local_tid_54665) - sext_i32_i64(skip_threads_54712)];\n                            }\n                        }\n                        // perform operation\n                        {\n                            if (thread_active_54713) {\n                                int64_t defunc_0_op_res_54708 = add64(eta_p_54706, eta_p_54707);\n                                \n                                eta_p_54706 = defunc_0_op_res_54708;\n                            }\n                        }\n                        if (sle32(wave_sizze_54667, skip_threads_54712)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        if (thread_active_54713) {\n                            // write result\n                    ", "        {\n                                ((volatile __local int64_t *) local_mem_54672)[sext_i32_i64(local_tid_54665)] = eta_p_54706;\n                                eta_p_54707 = eta_p_54706;\n                            }\n                        }\n                        if (sle32(wave_sizze_54667, skip_threads_54712)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        skip_threads_54712 *= 2;\n                    }\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            \n            bool no_carry_in_54714 = squot32(local_tid_54665, 32) == 0 || !ltid_in_bounds_54709;\n            \n            // carry-in for every block except the first\n            {\n                // read operands\n                {\n                    if (!no_carry_in_54714) {\n                        eta_p_54703 = eta_p_54702;\n                        eta_p_54702 = ((__local int64_t *) local_mem_54672)[sext_i32_i64(squot32(local_tid_54665, 32)) - (int64_t) 1];\n                    }\n                }\n                // perform operation\n                {\n                    if (!no_carry_in_54714) {\n                        int64_t defunc_0_op_res_54704 = add64(eta_p_54702, eta_p_54703);\n                        \n                        eta_p_54702 = defunc_0_op_res_54704;\n                    }\n                }\n                // write final result\n                {\n                    if (!no_carry_in_54714) {\n                        ((__local int64_t *) local_mem_54672)[sext_i32_i64(local_tid_54665)] = eta_p_54702;\n                    }\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // restore correct values for first block\n            {\n                if (squot32(local_tid_54665, 32) == 0 && ltid_in_bounds_54709) {\n                    ((__local int64_t *) local_mem_54672)[sext_i32_i64(local_tid_54665)] = eta_p_54703;\n                }\n            }\n            barrier(CL",
                                    "K_LOCAL_MEM_FENCE);\n            barrier(CLK_LOCAL_MEM_FENCE);\n            if (local_tid_54665 == 0) {\n                acc_54705 = ((__local int64_t *) local_mem_54672)[segscan_tblock_sizze_45649 - (int64_t) 1];\n            } else {\n                acc_54705 = ((__local int64_t *) local_mem_54672)[sext_i32_i64(local_tid_54665) - (int64_t) 1];\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n        }\n        prefix_54715 = (int64_t) 0;\n        block_new_sgm_54716 = sgm_idx_54684 == (int64_t) 0;\n        // Perform lookback\n        {\n            if (block_new_sgm_54716 && local_tid_54665 == 0) {\n                ((volatile __global int64_t *) incprefixes_mem_54640)[dynamic_id_54682] = acc_54705;\n                mem_fence_global();\n                ((volatile __global int8_t *) status_flags_mem_54616)[dynamic_id_54682] = (int8_t) 2;\n                acc_54705 = (int64_t) 0;\n            }\n            if (!block_new_sgm_54716 && slt32(local_tid_54665, wave_sizze_54667)) {\n                if (local_tid_54665 == 0) {\n                    ((volatile __global int64_t *) aggregates_mem_54638)[dynamic_id_54682] = acc_54705;\n                    mem_fence_global();\n                    ((volatile __global int8_t *) status_flags_mem_54616)[dynamic_id_54682] = (int8_t) 1;\n                    \n                    int8_t tmp_54717 = ((volatile __global int8_t *) status_flags_mem_54616)[dynamic_id_54682 - (int64_t) 1];\n                    \n                    ((volatile __local int8_t *) local_mem_54672)[(int64_t) 0] = tmp_54717;\n                }\n                mem_fence_local();\n                \n                int8_t status_54718 = ((__local int8_t *) local_mem_54672)[(int64_t) 0];\n                \n                if (status_54718 == (int8_t) 2) {\n                    if (local_tid_54665 == 0) {\n                        prefix_54715 = ((volatile __global int64_t *) incprefixes_mem_54640)[dynamic_id_54682 - (int64_t) 1];\n                    }\n                } else {\n              ", "      int32_t readOffset_54719 = sext_i64_i32(dynamic_id_54682 - sext_i32_i64(wave_sizze_54667));\n                    \n                    while (slt32(wave_sizze_54667 * -1, readOffset_54719)) {\n                        int32_t read_i_54720 = readOffset_54719 + local_tid_54665;\n                        int64_t aggr_54721 = (int64_t) 0;\n                        int8_t flag_54722 = (int8_t) 0;\n                        \n                        if (sle32(0, read_i_54720)) {\n                            flag_54722 = ((volatile __global int8_t *) status_flags_mem_54616)[sext_i32_i64(read_i_54720)];\n                            if (flag_54722 == (int8_t) 2) {\n                                aggr_54721 = ((volatile __global int64_t *) incprefixes_mem_54640)[sext_i32_i64(read_i_54720)];\n                            } else if (flag_54722 == (int8_t) 1) {\n                                aggr_54721 = ((volatile __global int64_t *) aggregates_mem_54638)[sext_i32_i64(read_i_54720)];\n                            }\n                        }\n                        ((__local int64_t *) local_mem_54672)[(int64_t) 4 + sext_i32_i64(local_tid_54665)] = aggr_54721;\n                        ((__local int8_t *) local_mem_54672)[sext_i32_i64(local_tid_54665)] = flag_54722;\n                        flag_54722 = ((__local int8_t *) local_mem_54672)[sext_i32_i64(wave_sizze_54667) - (int64_t) 1];\n                        if (slt8(flag_54722, (int8_t) 2)) {\n                            int8_t flg_x_54726;\n                            int8_t flg_y_54727;\n                            int64_t eta_p_54723;\n                            int64_t eta_p_54724;\n                            int32_t skip_threads_54728;\n                            \n                            // read input for in-block scan\n                            {\n                                flg_y_54727 = ((volatile __local int8_t *) local_mem_54672)[sext_i32_i64(local_tid_54665)];\n                                eta_p_54724 = ((volatile __local ", "int64_t *) local_mem_54672)[(int64_t) 4 + sext_i32_i64(local_tid_54665)];\n                                if ((local_tid_54665 - squot32(local_tid_54665, 32) * 32) == 0) {\n                                    eta_p_54723 = eta_p_54724;\n                                    flg_x_54726 = flg_y_54727;\n                                }\n                            }\n                            // in-block scan (hopefully no barriers needed)\n                            {\n                                skip_threads_54728 = 1;\n                                while (slt32(skip_threads_54728, 32)) {\n                                    if (sle32(skip_threads_54728, local_tid_54665 - squot32(local_tid_54665, 32) * 32)) {\n                                        // read operands\n                                        {\n                                            flg_x_54726 = ((volatile __local int8_t *) local_mem_54672)[sext_i32_i64(local_tid_54665) - sext_i32_i64(skip_threads_54728)];\n                                            eta_p_54723 = ((volatile __local int64_t *) local_mem_54672)[(int64_t) 4 + (sext_i32_i64(local_tid_54665) - sext_i32_i64(skip_threads_54728))];\n                                        }\n                                        // perform operation\n                                        {\n                                            if (flg_y_54727 == (int8_t) 2 || flg_y_54727 == (int8_t) 0) {\n                                                flg_x_54726 = flg_y_54727;\n                                                eta_p_54723 = eta_p_54724;\n                                            } else {\n                                                int64_t defunc_0_op_res_54725 = add64(eta_p_54723, eta_p_54724);\n                                                \n                                                eta_p_54723 = defunc_0_op_res_54725;\n                                            }\n                                        }\n                                   ",
                                    "     // write result\n                                        {\n                                            ((volatile __local int8_t *) local_mem_54672)[sext_i32_i64(local_tid_54665)] = flg_x_54726;\n                                            flg_y_54727 = flg_x_54726;\n                                            ((volatile __local int64_t *) local_mem_54672)[(int64_t) 4 + sext_i32_i64(local_tid_54665)] = eta_p_54723;\n                                            eta_p_54724 = eta_p_54723;\n                                        }\n                                    }\n                                    skip_threads_54728 *= 2;\n                                }\n                            }\n                        }\n                        flag_54722 = ((__local int8_t *) local_mem_54672)[sext_i32_i64(wave_sizze_54667) - (int64_t) 1];\n                        aggr_54721 = ((__local int64_t *) local_mem_54672)[(int64_t) 4 + (sext_i32_i64(wave_sizze_54667) - (int64_t) 1)];\n                        if (flag_54722 == (int8_t) 2) {\n                            readOffset_54719 = wave_sizze_54667 * -1;\n                        } else if (flag_54722 == (int8_t) 1) {\n                            readOffset_54719 -= wave_sizze_54667;\n                        }\n                        if (slt8((int8_t) 0, flag_54722)) {\n                            int64_t eta_p_54729 = aggr_54721;\n                            int64_t eta_p_54730 = prefix_54715;\n                            int64_t defunc_0_op_res_54731 = add64(eta_p_54729, eta_p_54730);\n                            \n                            prefix_54715 = defunc_0_op_res_54731;\n                        }\n                        mem_fence_local();\n                    }\n                }\n                if (local_tid_54665 == 0) {\n                    if (boundary_54685 == sext_i64_i32(segscan_tblock_sizze_45649 * chunk_sizze_54613)) {\n                        int64_t eta_p_54732 = prefix_54715;\n                        int64_t eta_p_54733 ", "= acc_54705;\n                        int64_t defunc_0_op_res_54734 = add64(eta_p_54732, eta_p_54733);\n                        \n                        ((volatile __global int64_t *) incprefixes_mem_54640)[dynamic_id_54682] = defunc_0_op_res_54734;\n                        mem_fence_global();\n                        ((volatile __global int8_t *) status_flags_mem_54616)[dynamic_id_54682] = (int8_t) 2;\n                    }\n                    ((__local int64_t *) local_mem_54672)[(int64_t) 4] = prefix_54715;\n                    acc_54705 = (int64_t) 0;\n                }\n            }\n            if (!(dynamic_id_54682 == (int64_t) 0)) {\n                barrier(CLK_LOCAL_MEM_FENCE);\n                prefix_54715 = ((__local int64_t *) local_mem_54672)[(int64_t) 4];\n                barrier(CLK_LOCAL_MEM_FENCE);\n            }\n        }\n        // Distribute results\n        {\n            int64_t eta_p_54735;\n            int64_t eta_p_54736;\n            int64_t eta_p_54738 = prefix_54715;\n            int64_t eta_p_54739 = acc_54705;\n            \n            if (slt32(local_tid_54665 * chunk_sizze_32b_54669, boundary_54685) && !block_new_sgm_54716) {\n                int64_t defunc_0_op_res_54740 = add64(eta_p_54738, eta_p_54739);\n                \n                eta_p_54735 = defunc_0_op_res_54740;\n            } else {\n                eta_p_54735 = acc_54705;\n            }\n            \n            int32_t stopping_point_54741 = segsizze_compact_54686 - srem32(local_tid_54665 * chunk_sizze_32b_54669 - 1 + segsizze_compact_54686 - boundary_54685, segsizze_compact_54686);\n            \n            for (int64_t i_54742 = 0; i_54742 < chunk_sizze_54613; i_54742++) {\n                if (slt32(sext_i64_i32(i_54742), stopping_point_54741 - 1)) {\n                    eta_p_54736 = private_mem_54687[i_54742];\n                    \n                    int64_t defunc_0_op_res_54737 = add64(eta_p_54735, eta_p_54736);\n                    \n                    private_mem_54687[i_54742] = defun", "c_0_op_res_54737;\n                }\n            }\n        }\n        // Transpose scan output and Write it to global memory in coalesced fashion\n        {\n            for (int64_t i_54743 = 0; i_54743 < chunk_sizze_54613; i_54743++) {\n                int64_t sharedIdx_54744 = sext_i32_i64(local_tid_54665) * chunk_sizze_54613 + i_54743;\n                int64_t tmp_54745 = private_mem_54687[i_54743];\n                \n                ((__local int64_t *) local_mem_54672)[sharedIdx_54744] = tmp_54745;\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            for (int64_t i_54746 = 0; i_54746 < chunk_sizze_54613; i_54746++) {\n                int64_t flat_idx_54747 = thd_offset_54689 + i_54746 * segscan_tblock_sizze_45649;\n                int64_t slice_54748 = dz2084U_37611;\n                int64_t gtid_45653 = flat_idx_54747;\n                int64_t remnant_54749 = flat_idx_54747 - gtid_45653;\n                \n                if (slt64(flat_idx_54747, dz2084U_37611)) {\n                    int64_t tmp_54750 = ((__local int64_t *) local_mem_54672)[flat_idx_54747 - block_offset_54683];\n                    \n                    ((__global int64_t *) mem_53635)[gtid_45653] = tmp_54750;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n        }\n    }\n    \n  error_3:\n    return;\n    #undef segscan_tblock_sizze_45649\n    #undef chunk_sizze_54613\n}\nFUTHARK_KERNEL_SIZED(mk_dbcHandler_doublezigpuseq_54642_dim1, 1, 1)\nvoid mk_dbcHandler_doublezigpuseq_54642(__global int *global_failure, double min_x_23482, double min_y_23483, double max_x_23484, double max_y_23485, int64_t parts_x_23486, int64_t parts_y_23487, double zs_res_39213, double zs_res_39216, __global unsigned char *mem_53529, __global unsigned char *mem_53530, __global unsigned char *mem_53531, __global unsigned char *mem_53532, __global unsigned char *mem_53533, __global unsigned char *mem_53534, __global unsigned char *mem_53535, __global unsigned char *mem_53536)\n{\n    if (*global_failur",
                                    "e >= 0)\n        return;\n    \n    int32_t local_tid_54644;\n    int32_t tblock_sizze_54647;\n    int32_t wave_sizze_54646;\n    int32_t block_id_54645;\n    int32_t global_tid_54643;\n    int64_t tid_54642;\n    \n    local_tid_54644 = get_local_id(0);\n    tblock_sizze_54647 = get_local_size(0);\n    wave_sizze_54646 = LOCKSTEP_WIDTH;\n    block_id_54645 = get_tblock_id(0);\n    global_tid_54643 = block_id_54645 * tblock_sizze_54647 + local_tid_54644;\n    tid_54642 = sext_i32_i64(global_tid_54643);\n    ((__global double *) mem_53529)[(int64_t) 0] = min_x_23482;\n    ((__global double *) mem_53529)[(int64_t) 1] = min_y_23483;\n    ((__global double *) mem_53530)[(int64_t) 0] = max_x_23484;\n    ((__global double *) mem_53530)[(int64_t) 1] = max_y_23485;\n    ((__global double *) mem_53531)[(int64_t) 0] = zs_res_39213;\n    ((__global double *) mem_53531)[(int64_t) 1] = zs_res_39216;\n    ((__global int64_t *) mem_53532)[(int64_t) 0] = parts_x_23486;\n    ((__global int64_t *) mem_53532)[(int64_t) 1] = parts_y_23487;\n    for (int64_t i_0 = 0; i_0 < (int64_t) 2; i_0++) {\n        ((__global double *) mem_53533)[i_0] = ((__global double *) mem_53529)[i_0];\n    }\n    for (int64_t i_0 = 0; i_0 < (int64_t) 2; i_0++) {\n        ((__global double *) mem_53534)[i_0] = ((__global double *) mem_53530)[i_0];\n    }\n    for (int64_t i_0 = 0; i_0 < (int64_t) 2; i_0++) {\n        ((__global double *) mem_53535)[i_0] = ((__global double *) mem_53531)[i_0];\n    }\n    for (int64_t i_0 = 0; i_0 < (int64_t) 2; i_0++) {\n        ((__global int64_t *) mem_53536)[i_0] = ((__global int64_t *) mem_53532)[i_0];\n    }\n    \n  error_0:\n    return;\n}\nFUTHARK_KERNEL_SIZED(next_partition_to_read_doublezigpuseq_54544_dim1, 1, 1)\nvoid next_partition_to_read_doublezigpuseq_54544(__global int *global_failure, __global unsigned char *clProc_mem_53517, __global unsigned char *mem_53546)\n{\n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_54546;\n    int32_t tblock_sizze_54549;\n    int32_t wave_sizze_54548", ";\n    int32_t block_id_54547;\n    int32_t global_tid_54545;\n    int64_t tid_54544;\n    int64_t next_partition_to_read_res_f_res_t_res_53183;\n    \n    local_tid_54546 = get_local_id(0);\n    tblock_sizze_54549 = get_local_size(0);\n    wave_sizze_54548 = LOCKSTEP_WIDTH;\n    block_id_54547 = get_tblock_id(0);\n    global_tid_54545 = block_id_54547 * tblock_sizze_54549 + local_tid_54546;\n    tid_54544 = sext_i32_i64(global_tid_54545);\n    next_partition_to_read_res_f_res_t_res_53183 = ((__global int64_t *) clProc_mem_53517)[(int64_t) 0];\n    ((__global int64_t *) mem_53546)[(int64_t) 0] = next_partition_to_read_res_f_res_t_res_53183;\n    \n  error_0:\n    return;\n}\nFUTHARK_KERNEL_SIZED(next_partition_to_read_doublezigpuseq_54757_dim1, 1, 1)\nvoid next_partition_to_read_doublezigpuseq_54757(__global int *global_failure, __global unsigned char *mem_53542, __global unsigned char *mem_53544)\n{\n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_54759;\n    int32_t tblock_sizze_54762;\n    int32_t wave_sizze_54761;\n    int32_t block_id_54760;\n    int32_t global_tid_54758;\n    int64_t tid_54757;\n    int64_t next_partition_to_read_res_f_res_f_res_t_res_53185;\n    \n    local_tid_54759 = get_local_id(0);\n    tblock_sizze_54762 = get_local_size(0);\n    wave_sizze_54761 = LOCKSTEP_WIDTH;\n    block_id_54760 = get_tblock_id(0);\n    global_tid_54758 = block_id_54760 * tblock_sizze_54762 + local_tid_54759;\n    tid_54757 = sext_i32_i64(global_tid_54758);\n    next_partition_to_read_res_f_res_f_res_t_res_53185 = ((__global int64_t *) mem_53542)[(int64_t) 0];\n    ((__global int64_t *) mem_53544)[(int64_t) 0] = next_partition_to_read_res_f_res_f_res_t_res_53185;\n    \n  error_0:\n    return;\n}\nFUTHARK_KERNEL_SIZED(next_partition_to_read_doublezisegmap_45493_dim1, 1, 1)\nvoid next_partition_to_read_doublezisegmap_45493(__global int *global_failure, int64_t part_no_24090, int64_t m_44900, int64_t num_tblocks_45498, int32_t virt_num_tblocks_54744, __global unsigned char *mem_53538,", " __global unsigned char *mem_53540, __global unsigned char *mem_53542)\n{\n    #define segmap_tblock_sizze_45496 (next_partition_to_read_doublezisegmap_45493zisegmap_tblock_sizze_45496)\n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_54746;\n    int32_t tblock_sizze_54749;\n    int32_t wave_sizze_54748;\n    int32_t block_id_54747;\n    int32_t global_tid_54745;\n    int64_t phys_tid_45493;\n    int32_t phys_tblock_id_54750;\n    int32_t iterations_54751;\n    \n    local_tid_54746 = get_local_id(0);\n    tblock_sizze_54749 = get_local_size(0);\n    wave_sizze_54748 = LOCKSTEP_WIDTH;\n    block_id_54747 = get_tblock_id(0);\n    global_tid_54745 = block_id_54747 * tblock_sizze_54749 + local_tid_54746;\n    phys_tid_45493 = sext_i32_i64(global_tid_54745);\n    phys_tblock_id_54750 = get_tblock_id(0);\n    iterations_54751 = sdiv_up32(virt_num_tblocks_54744 - phys_tblock_id_54750, sext_i64_i32(num_tblocks_45498));\n    for (int32_t i_54752 = 0; i_54752 < iterations_54751; i_54752++) {\n        int32_t virt_tblock_id_54753;\n        int64_t global_tid_54754;\n        int64_t slice_54755;\n        int64_t write_i_45492;\n        int64_t remnant_54756;\n        \n        virt_tblock_id_54753 = phys_tblock_id_54750 + i_54752 * sext_i64_i32(num_tblocks_45498);\n        global_tid_54754 = sext_i32_i64(virt_tblock_id_54753) * segmap_tblock_sizze_45496 + sext_i32_i64(local_tid_54746);\n        slice_54755 = part_no_24090;\n        write_i_45492 = global_tid_54754;\n        remnant_54756 = global_tid_54754 - write_i_45492;\n        if (slt64(write_i_45492, part_no_24090)) {\n            int64_t eta_p_44914;\n            bool cond_44917;\n            int64_t lifted_lambda_res_44918;\n            \n            eta_p_44914 = ((__global int64_t *) mem_53540)[write_i_45492];\n            cond_44917 = eta_p_44914 == (int64_t) 1;\n            if (cond_44917) {\n                int64_t eta_p_44915;\n                int64_t lifted_lambda_res_t_res_44919;\n                \n                eta_p_44915 = ",
                                    "((__global int64_t *) mem_53538)[write_i_45492];\n                lifted_lambda_res_t_res_44919 = sub64(eta_p_44915, (int64_t) 1);\n                lifted_lambda_res_44918 = lifted_lambda_res_t_res_44919;\n            } else {\n                lifted_lambda_res_44918 = (int64_t) -1;\n            }\n            if (sle64((int64_t) 0, lifted_lambda_res_44918) && slt64(lifted_lambda_res_44918, m_44900)) {\n                ((__global int64_t *) mem_53542)[lifted_lambda_res_44918] = write_i_45492;\n            }\n        }\n        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    }\n    \n  error_1:\n    return;\n    #undef segmap_tblock_sizze_45496\n}\nFUTHARK_KERNEL_SIZED(next_partition_to_read_doublezisegred_nonseg_45483_dim1, 1, 1)\nvoid next_partition_to_read_doublezisegred_nonseg_45483(__global int *global_failure, int64_t part_no_24090, int64_t num_tblocks_45478, int64_t num_threads_54575, __global unsigned char *clProc_mem_53516, __global unsigned char *mem_53534, __global unsigned char *counters_mem_54551, __global unsigned char *segred_tmp_mem_54573)\n{\n    #define segred_tblock_sizze_45476 (next_partition_to_read_doublezisegred_nonseg_45483zisegred_tblock_sizze_45476)\n    #define chunk_sizze_54550 (next_partition_to_read_doublezisegred_nonseg_45483zichunk_sizze_54550)\n    \n    volatile __local unsigned char *sync_arr_mem_54583_backing_1 = &shared_mem[0];\n    const int64_t sync_arr_mem_54583_backing_1_offset = 0 + 8;\n    volatile __local unsigned char *red_arr_i64_mem_54581_backing_0 = &shared_mem[sync_arr_mem_54583_backing_1_offset];\n    const int64_t red_arr_i64_mem_54581_backing_0_offset = sync_arr_mem_54583_backing_1_offset + ((int64_t) 8 * segred_tblock_sizze_45476 + srem64((int64_t) 8 - srem64((int64_t) 8 * segred_tblock_sizze_45476, (int64_t) 8), (int64_t) 8));\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_54577;\n    int32_t tblock_sizze_54580;\n    int32_t wave_sizze_54579;\n    int32_t block_id_54578;\n    int32_t global_tid_54576;\n ", "   int64_t phys_tid_45483;\n    __local unsigned char *red_arr_i64_mem_54581;\n    __local unsigned char *sync_arr_mem_54583;\n    int64_t dummy_45481;\n    int64_t gtid_45482;\n    int64_t q_54585;\n    int64_t eta_p_block_res_acc_54586;\n    int64_t eta_p_39879;\n    int64_t eta_p_39880;\n    int64_t tblock_id_in_segment_54590;\n    int64_t block_base_offset_54591;\n    int32_t offset_54594;\n    int32_t skip_waves_54595;\n    int64_t eta_p_54587;\n    int64_t eta_p_54588;\n    int32_t old_counter_54596;\n    bool is_last_block_54597;\n    \n    local_tid_54577 = get_local_id(0);\n    tblock_sizze_54580 = get_local_size(0);\n    wave_sizze_54579 = LOCKSTEP_WIDTH;\n    block_id_54578 = get_tblock_id(0);\n    global_tid_54576 = block_id_54578 * tblock_sizze_54580 + local_tid_54577;\n    phys_tid_45483 = sext_i32_i64(global_tid_54576);\n    red_arr_i64_mem_54581 = (__local unsigned char *) red_arr_i64_mem_54581_backing_0;\n    sync_arr_mem_54583 = (__local unsigned char *) sync_arr_mem_54583_backing_1;\n    dummy_45481 = (int64_t) 0;\n    gtid_45482 = (int64_t) 0;\n    q_54585 = sdiv_up64(part_no_24090, sext_i32_i64(sext_i64_i32(segred_tblock_sizze_45476 * num_tblocks_45478)) * chunk_sizze_54550);\n    // ne-initialise the outer (per-block) accumulator(s)\n    {\n        eta_p_block_res_acc_54586 = (int64_t) 0;\n    }\n    tblock_id_in_segment_54590 = squot64(phys_tid_45483, segred_tblock_sizze_45476);\n    block_base_offset_54591 = tblock_id_in_segment_54590 * q_54585 * segred_tblock_sizze_45476;\n    for (int64_t i_54592 = 0; i_54592 < q_54585; i_54592++) {\n        int64_t block_offset_54593 = block_base_offset_54591 + i_54592 * segred_tblock_sizze_45476;\n        \n        gtid_45482 = phys_tid_45483 + num_threads_54575 * i_54592;\n        if (slt64(gtid_45482, part_no_24090)) {\n            // apply map function(s)\n            {\n                // apply map function\n                {\n                    bool eta_p_44716 = ((__global bool *) clProc_mem_53516)[gtid_45482];\n                    bool lifte", "d_lambda_res_44717 = !eta_p_44716;\n                    int64_t bool_res_44718 = btoi_bool_i64(lifted_lambda_res_44717);\n                    \n                    // load accumulator(s)\n                    {\n                        eta_p_39879 = eta_p_block_res_acc_54586;\n                    }\n                    // load next value(s)\n                    {\n                        eta_p_39880 = bool_res_44718;\n                    }\n                    // apply reduction operator(s)\n                    {\n                        int64_t zp_res_39881 = add64(eta_p_39879, eta_p_39880);\n                        \n                        // store in accumulator(s)\n                        {\n                            eta_p_block_res_acc_54586 = zp_res_39881;\n                        }\n                    }\n                }\n            }\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // store accs. prims go in lmem; non-prims in params (in global mem)\n    {\n        ((__local int64_t *) red_arr_i64_mem_54581)[sext_i32_i64(local_tid_54577)] = eta_p_block_res_acc_54586;\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    skip_waves_54595 = 1;\n    offset_54594 = 0;\n    // participating threads read initial accumulator\n    {\n        if (slt32(local_tid_54577, sext_i64_i32(segred_tblock_sizze_45476))) {\n            eta_p_54587 = ((__local int64_t *) red_arr_i64_mem_54581)[sext_i32_i64(local_tid_54577 + offset_54594)];\n        }\n    }\n    offset_54594 = 1;\n    while (slt32(offset_54594, wave_sizze_54579)) {\n        if (slt32(local_tid_54577 + offset_54594, sext_i64_i32(segred_tblock_sizze_45476)) && ((local_tid_54577 - squot32(local_tid_54577, wave_sizze_54579) * wave_sizze_54579) & (2 * offset_54594 - 1)) == 0) {\n            // read array element\n            {\n                eta_p_54588 = ((volatile __local int64_t *) red_arr_i64_mem_54581)[sext_i32_i64(local_tid_54577 + offset_54594)];\n            }\n            // apply reduction operation\n            {\n                int64_t zp_re",
                                    "s_54589 = add64(eta_p_54587, eta_p_54588);\n                \n                eta_p_54587 = zp_res_54589;\n            }\n            // write result of operation\n            {\n                ((volatile __local int64_t *) red_arr_i64_mem_54581)[sext_i32_i64(local_tid_54577)] = eta_p_54587;\n            }\n        }\n        offset_54594 *= 2;\n    }\n    while (slt32(skip_waves_54595, squot32(sext_i64_i32(segred_tblock_sizze_45476) + wave_sizze_54579 - 1, wave_sizze_54579))) {\n        barrier(CLK_LOCAL_MEM_FENCE);\n        offset_54594 = skip_waves_54595 * wave_sizze_54579;\n        if (slt32(local_tid_54577 + offset_54594, sext_i64_i32(segred_tblock_sizze_45476)) && ((local_tid_54577 - squot32(local_tid_54577, wave_sizze_54579) * wave_sizze_54579) == 0 && (squot32(local_tid_54577, wave_sizze_54579) & (2 * skip_waves_54595 - 1)) == 0)) {\n            // read array element\n            {\n                eta_p_54588 = ((__local int64_t *) red_arr_i64_mem_54581)[sext_i32_i64(local_tid_54577 + offset_54594)];\n            }\n            // apply reduction operation\n            {\n                int64_t zp_res_54589 = add64(eta_p_54587, eta_p_54588);\n                \n                eta_p_54587 = zp_res_54589;\n            }\n            // write result of operation\n            {\n                ((__local int64_t *) red_arr_i64_mem_54581)[sext_i32_i64(local_tid_54577)] = eta_p_54587;\n            }\n        }\n        skip_waves_54595 *= 2;\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // thread 0 updates per-block acc(s); rest reset to ne\n    {\n        if (sext_i32_i64(local_tid_54577) == (int64_t) 0) {\n            eta_p_block_res_acc_54586 = eta_p_54587;\n        } else {\n            eta_p_block_res_acc_54586 = (int64_t) 0;\n        }\n    }\n    // first thread in block saves block result to global memory\n    {\n        if (local_tid_54577 == 0) {\n            ((__global int64_t *) segred_tmp_mem_54573)[sext_i32_i64(block_id_54578)] = eta_p_block_res_acc_54586;", "\n            mem_fence_global();\n            old_counter_54596 = atomic_add_i32_global(&((volatile __global int *) counters_mem_54551)[(int64_t) 0], (int) 1);\n            ((__local bool *) sync_arr_mem_54583)[(int64_t) 0] = old_counter_54596 == sext_i64_i32(num_tblocks_45478 - (int64_t) 1);\n        }\n    }\n    barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    is_last_block_54597 = ((__local bool *) sync_arr_mem_54583)[(int64_t) 0];\n    if (is_last_block_54597) {\n        if (local_tid_54577 == 0) {\n            old_counter_54596 = atomic_add_i32_global(&((volatile __global int *) counters_mem_54551)[(int64_t) 0], (int) sext_i64_i32((int64_t) 0 - num_tblocks_45478));\n        }\n        // read in the per-block-results\n        {\n            int64_t read_per_thread_54598 = sdiv_up64(num_tblocks_45478, segred_tblock_sizze_45476);\n            \n            eta_p_39879 = (int64_t) 0;\n            for (int64_t i_54599 = 0; i_54599 < read_per_thread_54598; i_54599++) {\n                int64_t block_res_id_54600 = sext_i32_i64(local_tid_54577) * read_per_thread_54598 + i_54599;\n                int64_t index_of_block_res_54601 = block_res_id_54600;\n                \n                if (slt64(block_res_id_54600, num_tblocks_45478)) {\n                    eta_p_39880 = ((__global int64_t *) segred_tmp_mem_54573)[index_of_block_res_54601];\n                    \n                    int64_t zp_res_39881 = add64(eta_p_39879, eta_p_39880);\n                    \n                    eta_p_39879 = zp_res_39881;\n                }\n            }\n        }\n        ((__local int64_t *) red_arr_i64_mem_54581)[sext_i32_i64(local_tid_54577)] = eta_p_39879;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        // reduce the per-block results\n        {\n            int32_t offset_54602;\n            int32_t skip_waves_54603 = 1;\n            int64_t eta_p_54587;\n            int64_t eta_p_54588;\n            \n            offset_54602 = 0;\n            // participating threads read initial accumulator\n          ", "  {\n                if (slt32(local_tid_54577, sext_i64_i32(segred_tblock_sizze_45476))) {\n                    eta_p_54587 = ((__local int64_t *) red_arr_i64_mem_54581)[sext_i32_i64(local_tid_54577 + offset_54602)];\n                }\n            }\n            offset_54602 = 1;\n            while (slt32(offset_54602, wave_sizze_54579)) {\n                if (slt32(local_tid_54577 + offset_54602, sext_i64_i32(segred_tblock_sizze_45476)) && ((local_tid_54577 - squot32(local_tid_54577, wave_sizze_54579) * wave_sizze_54579) & (2 * offset_54602 - 1)) == 0) {\n                    // read array element\n                    {\n                        eta_p_54588 = ((volatile __local int64_t *) red_arr_i64_mem_54581)[sext_i32_i64(local_tid_54577 + offset_54602)];\n                    }\n                    // apply reduction operation\n                    {\n                        int64_t zp_res_54589 = add64(eta_p_54587, eta_p_54588);\n                        \n                        eta_p_54587 = zp_res_54589;\n                    }\n                    // write result of operation\n                    {\n                        ((volatile __local int64_t *) red_arr_i64_mem_54581)[sext_i32_i64(local_tid_54577)] = eta_p_54587;\n                    }\n                }\n                offset_54602 *= 2;\n            }\n            while (slt32(skip_waves_54603, squot32(sext_i64_i32(segred_tblock_sizze_45476) + wave_sizze_54579 - 1, wave_sizze_54579))) {\n                barrier(CLK_LOCAL_MEM_FENCE);\n                offset_54602 = skip_waves_54603 * wave_sizze_54579;\n                if (slt32(local_tid_54577 + offset_54602, sext_i64_i32(segred_tblock_sizze_45476)) && ((local_tid_54577 - squot32(local_tid_54577, wave_sizze_54579) * wave_sizze_54579) == 0 && (squot32(local_tid_54577, wave_sizze_54579) & (2 * skip_waves_54603 - 1)) == 0)) {\n                    // read array element\n                    {\n                        eta_p_54588 = ((__local int64_t *) red_arr_i64_mem_54581)[sext_i32_i64(",
                                    "local_tid_54577 + offset_54602)];\n                    }\n                    // apply reduction operation\n                    {\n                        int64_t zp_res_54589 = add64(eta_p_54587, eta_p_54588);\n                        \n                        eta_p_54587 = zp_res_54589;\n                    }\n                    // write result of operation\n                    {\n                        ((__local int64_t *) red_arr_i64_mem_54581)[sext_i32_i64(local_tid_54577)] = eta_p_54587;\n                    }\n                }\n                skip_waves_54603 *= 2;\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // and back to memory with the final result\n            {\n                if (local_tid_54577 == 0) {\n                    ((__global int64_t *) mem_53534)[(int64_t) 0] = eta_p_54587;\n                }\n            }\n        }\n    }\n    \n  error_5:\n    return;\n    #undef segred_tblock_sizze_45476\n    #undef chunk_sizze_54550\n}\nFUTHARK_KERNEL_SIZED(next_partition_to_read_doublezisegscan_45491_dim1, 1, 1)\nvoid next_partition_to_read_doublezisegscan_45491(__global int *global_failure, int64_t part_no_24090, int64_t num_tblocks_45488, int64_t num_virt_blocks_54609, int64_t num_virt_threads_54610, __global unsigned char *clProc_mem_53516, __global unsigned char *mem_53538, __global unsigned char *mem_53540, __global unsigned char *status_flags_mem_54611, __global unsigned char *aggregates_mem_54633, __global unsigned char *incprefixes_mem_54635, __global unsigned char *global_dynid_mem_54637)\n{\n    #define segscan_tblock_sizze_45486 (next_partition_to_read_doublezisegscan_45491zisegscan_tblock_sizze_45486)\n    #define chunk_sizze_54608 (next_partition_to_read_doublezisegscan_45491zichunk_sizze_54608)\n    \n    volatile __local unsigned char *local_mem_54647_backing_0 = &shared_mem[0];\n    const int64_t local_mem_54647_backing_0_offset = 0 + (smax64(smax64((int64_t) 288, (int64_t) 8 * segscan_tblock_sizze_45486), chunk_sizze_54608 * segscan_tblock_s", "izze_45486 * (int64_t) 8) + srem64((int64_t) 8 - srem64(smax64(smax64((int64_t) 288, (int64_t) 8 * segscan_tblock_sizze_45486), chunk_sizze_54608 * segscan_tblock_sizze_45486 * (int64_t) 8), (int64_t) 8), (int64_t) 8));\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_54640;\n    int32_t tblock_sizze_54643;\n    int32_t wave_sizze_54642;\n    int32_t block_id_54641;\n    int32_t global_tid_54639;\n    int64_t phys_tid_45491;\n    int32_t chunk_sizze_32b_54644;\n    int64_t byte_offsets_54645;\n    int64_t warp_byte_offset_54646;\n    __local unsigned char *local_mem_54647;\n    int64_t trans_arr_len_54648;\n    int64_t phys_block_id_54654;\n    int64_t virtloop_bound_54655;\n    \n    local_tid_54640 = get_local_id(0);\n    tblock_sizze_54643 = get_local_size(0);\n    wave_sizze_54642 = LOCKSTEP_WIDTH;\n    block_id_54641 = get_tblock_id(0);\n    global_tid_54639 = block_id_54641 * tblock_sizze_54643 + local_tid_54640;\n    phys_tid_45491 = sext_i32_i64(global_tid_54639);\n    chunk_sizze_32b_54644 = sext_i64_i32(chunk_sizze_54608);\n    byte_offsets_54645 = segscan_tblock_sizze_45486 * (int64_t) 8;\n    warp_byte_offset_54646 = (int64_t) 288;\n    // Allocate reusable shared memory\n    { }\n    local_mem_54647 = (__local unsigned char *) local_mem_54647_backing_0;\n    trans_arr_len_54648 = chunk_sizze_54608 * segscan_tblock_sizze_45486;\n    phys_block_id_54654 = get_tblock_id(0);\n    virtloop_bound_54655 = sdiv_up64(num_virt_blocks_54609 - phys_block_id_54654, num_tblocks_45488);\n    for (int64_t virtloop_i_54656 = 0; virtloop_i_54656 < virtloop_bound_54655; virtloop_i_54656++) {\n        int64_t dynamic_id_54657;\n        int64_t block_offset_54658;\n        int64_t sgm_idx_54659;\n        int32_t boundary_54660;\n        int32_t segsizze_compact_54661;\n        int64_t private_mem_54662[chunk_sizze_54608];\n        int64_t thd_offset_54664;\n        int64_t acc_54680;\n        int64_t prefix_54690;\n        bool block_new_sgm_54691;\n        \n        // First thread in", " block fetches this block's dynamic_id\n        {\n            if (local_tid_54640 == 0) {\n                dynamic_id_54657 = atomic_add_i32_global(&((volatile __global int *) global_dynid_mem_54637)[(int64_t) 0], (int) 1);\n                // Set dynamic id for this block\n                {\n                    ((__local int64_t *) local_mem_54647)[(int64_t) 0] = dynamic_id_54657;\n                }\n                // First thread in last (virtual) block resets global dynamic_id\n                {\n                    if (dynamic_id_54657 == num_virt_blocks_54609 - (int64_t) 1) {\n                        ((__global int32_t *) global_dynid_mem_54637)[(int64_t) 0] = 0;\n                    }\n                }\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        dynamic_id_54657 = ((__local int32_t *) local_mem_54647)[(int64_t) 0];\n        barrier(CLK_LOCAL_MEM_FENCE);\n        block_offset_54658 = dynamic_id_54657 * chunk_sizze_54608 * segscan_tblock_sizze_45486;\n        sgm_idx_54659 = smod64(block_offset_54658, part_no_24090);\n        boundary_54660 = sext_i64_i32(smin64(chunk_sizze_54608 * segscan_tblock_sizze_45486, part_no_24090 - sgm_idx_54659));\n        segsizze_compact_54661 = sext_i64_i32(smin64(chunk_sizze_54608 * segscan_tblock_sizze_45486, part_no_24090));\n        thd_offset_54664 = block_offset_54658 + sext_i32_i64(local_tid_54640);\n        // Load and map\n        {\n            for (int64_t i_54665 = 0; i_54665 < chunk_sizze_54608; i_54665++) {\n                int64_t virt_tid_54666 = thd_offset_54664 + i_54665 * segscan_tblock_sizze_45486;\n                int64_t slice_54667 = part_no_24090;\n                int64_t gtid_45490 = virt_tid_54666;\n                int64_t remnant_54668 = virt_tid_54666 - gtid_45490;\n                \n                if (slt64(virt_tid_54666, part_no_24090)) {\n                    bool eta_p_44884 = ((__global bool *) clProc_mem_53516)[gtid_45490];\n                    bool lifted_lambda_res_44885 = !eta_p_44884;\n         ",
                                    "           int64_t defunc_0_f_res_44886 = btoi_bool_i64(lifted_lambda_res_44885);\n                    \n                    ((__global int64_t *) mem_53540)[gtid_45490] = defunc_0_f_res_44886;\n                    private_mem_54662[i_54665] = defunc_0_f_res_44886;\n                } else {\n                    private_mem_54662[i_54665] = (int64_t) 0;\n                }\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        // Transpose scan inputs\n        {\n            for (int64_t i_54669 = 0; i_54669 < chunk_sizze_54608; i_54669++) {\n                int64_t sharedIdx_54670 = sext_i32_i64(local_tid_54640) + i_54669 * segscan_tblock_sizze_45486;\n                int64_t tmp_54671 = private_mem_54662[i_54669];\n                \n                ((__local int64_t *) local_mem_54647)[sharedIdx_54670] = tmp_54671;\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            for (int64_t i_54672 = 0; i_54672 < chunk_sizze_54608; i_54672++) {\n                int64_t sharedIdx_54673 = sext_i32_i64(local_tid_54640) * chunk_sizze_54608 + i_54672;\n                int64_t tmp_54674 = ((__local int64_t *) local_mem_54647)[sharedIdx_54673];\n                \n                private_mem_54662[i_54672] = tmp_54674;\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n        }\n        // Per thread scan\n        {\n            for (int64_t i_54675 = 0; i_54675 < chunk_sizze_54608 - (int64_t) 1; i_54675++) {\n                int64_t eta_p_44887;\n                int64_t eta_p_44888;\n                \n                eta_p_44887 = private_mem_54662[i_54675];\n                eta_p_44888 = private_mem_54662[i_54675 + (int64_t) 1];\n                \n                int64_t defunc_0_op_res_44889 = add64(eta_p_44887, eta_p_44888);\n                \n                private_mem_54662[i_54675 + (int64_t) 1] = defunc_0_op_res_44889;\n            }\n        }\n        // Publish results in shared memory\n        {\n            int64_t tmp_54676 = private_mem_54662[chunk_sizze_54608 - (in", "t64_t) 1];\n            \n            ((__local int64_t *) local_mem_54647)[sext_i32_i64(local_tid_54640)] = tmp_54676;\n            barrier(CLK_LOCAL_MEM_FENCE);\n        }\n        // Scan results (with warp scan)\n        {\n            int64_t eta_p_54677;\n            int64_t eta_p_54678;\n            int64_t eta_p_54681;\n            int64_t eta_p_54682;\n            bool ltid_in_bounds_54684 = slt64(sext_i32_i64(local_tid_54640), num_virt_threads_54610);\n            int32_t skip_threads_54685;\n            \n            // read input for in-block scan\n            {\n                if (ltid_in_bounds_54684) {\n                    eta_p_54678 = ((volatile __local int64_t *) local_mem_54647)[sext_i32_i64(local_tid_54640)];\n                    if ((local_tid_54640 - squot32(local_tid_54640, 32) * 32) == 0) {\n                        eta_p_54677 = eta_p_54678;\n                    }\n                }\n            }\n            // in-block scan (hopefully no barriers needed)\n            {\n                skip_threads_54685 = 1;\n                while (slt32(skip_threads_54685, 32)) {\n                    bool thread_active_54686 = sle32(skip_threads_54685, local_tid_54640 - squot32(local_tid_54640, 32) * 32) && ltid_in_bounds_54684;\n                    \n                    if (thread_active_54686) {\n                        // read operands\n                        {\n                            eta_p_54677 = ((volatile __local int64_t *) local_mem_54647)[sext_i32_i64(local_tid_54640) - sext_i32_i64(skip_threads_54685)];\n                        }\n                    }\n                    // perform operation\n                    {\n                        if (thread_active_54686) {\n                            int64_t defunc_0_op_res_54679 = add64(eta_p_54677, eta_p_54678);\n                            \n                            eta_p_54677 = defunc_0_op_res_54679;\n                        }\n                    }\n                    if (sle32(wave_sizze_54642, skip_threads_54685)) {\n      ", "                  barrier(CLK_LOCAL_MEM_FENCE);\n                    }\n                    if (thread_active_54686) {\n                        // write result\n                        {\n                            ((volatile __local int64_t *) local_mem_54647)[sext_i32_i64(local_tid_54640)] = eta_p_54677;\n                            eta_p_54678 = eta_p_54677;\n                        }\n                    }\n                    if (sle32(wave_sizze_54642, skip_threads_54685)) {\n                        barrier(CLK_LOCAL_MEM_FENCE);\n                    }\n                    skip_threads_54685 *= 2;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // last thread of block 'i' writes its result to offset 'i'\n            {\n                if ((local_tid_54640 - squot32(local_tid_54640, 32) * 32) == 31 && ltid_in_bounds_54684) {\n                    ((volatile __local int64_t *) local_mem_54647)[sext_i32_i64(squot32(local_tid_54640, 32))] = eta_p_54677;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // scan the first block, after which offset 'i' contains carry-in for block 'i+1'\n            {\n                int32_t skip_threads_54687;\n                \n                // read input for in-block scan\n                {\n                    if (squot32(local_tid_54640, 32) == 0 && ltid_in_bounds_54684) {\n                        eta_p_54682 = ((volatile __local int64_t *) local_mem_54647)[sext_i32_i64(local_tid_54640)];\n                        if ((local_tid_54640 - squot32(local_tid_54640, 32) * 32) == 0) {\n                            eta_p_54681 = eta_p_54682;\n                        }\n                    }\n                }\n                // in-block scan (hopefully no barriers needed)\n                {\n                    skip_threads_54687 = 1;\n                    while (slt32(skip_threads_54687, 32)) {\n                        bool thread_active_54688 = sle32(skip_threads_54687, local_tid_54640 - squot",
                                    "32(local_tid_54640, 32) * 32) && (squot32(local_tid_54640, 32) == 0 && ltid_in_bounds_54684);\n                        \n                        if (thread_active_54688) {\n                            // read operands\n                            {\n                                eta_p_54681 = ((volatile __local int64_t *) local_mem_54647)[sext_i32_i64(local_tid_54640) - sext_i32_i64(skip_threads_54687)];\n                            }\n                        }\n                        // perform operation\n                        {\n                            if (thread_active_54688) {\n                                int64_t defunc_0_op_res_54683 = add64(eta_p_54681, eta_p_54682);\n                                \n                                eta_p_54681 = defunc_0_op_res_54683;\n                            }\n                        }\n                        if (sle32(wave_sizze_54642, skip_threads_54687)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        if (thread_active_54688) {\n                            // write result\n                            {\n                                ((volatile __local int64_t *) local_mem_54647)[sext_i32_i64(local_tid_54640)] = eta_p_54681;\n                                eta_p_54682 = eta_p_54681;\n                            }\n                        }\n                        if (sle32(wave_sizze_54642, skip_threads_54687)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        skip_threads_54687 *= 2;\n                    }\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            \n            bool no_carry_in_54689 = squot32(local_tid_54640, 32) == 0 || !ltid_in_bounds_54684;\n            \n            // carry-in for every block except the first\n            {\n                // read operands\n                {\n                    if (!no_carry_in_54689) {\n                        eta_p_54678 = e", "ta_p_54677;\n                        eta_p_54677 = ((__local int64_t *) local_mem_54647)[sext_i32_i64(squot32(local_tid_54640, 32)) - (int64_t) 1];\n                    }\n                }\n                // perform operation\n                {\n                    if (!no_carry_in_54689) {\n                        int64_t defunc_0_op_res_54679 = add64(eta_p_54677, eta_p_54678);\n                        \n                        eta_p_54677 = defunc_0_op_res_54679;\n                    }\n                }\n                // write final result\n                {\n                    if (!no_carry_in_54689) {\n                        ((__local int64_t *) local_mem_54647)[sext_i32_i64(local_tid_54640)] = eta_p_54677;\n                    }\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // restore correct values for first block\n            {\n                if (squot32(local_tid_54640, 32) == 0 && ltid_in_bounds_54684) {\n                    ((__local int64_t *) local_mem_54647)[sext_i32_i64(local_tid_54640)] = eta_p_54678;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            barrier(CLK_LOCAL_MEM_FENCE);\n            if (local_tid_54640 == 0) {\n                acc_54680 = ((__local int64_t *) local_mem_54647)[segscan_tblock_sizze_45486 - (int64_t) 1];\n            } else {\n                acc_54680 = ((__local int64_t *) local_mem_54647)[sext_i32_i64(local_tid_54640) - (int64_t) 1];\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n        }\n        prefix_54690 = (int64_t) 0;\n        block_new_sgm_54691 = sgm_idx_54659 == (int64_t) 0;\n        // Perform lookback\n        {\n            if (block_new_sgm_54691 && local_tid_54640 == 0) {\n                ((volatile __global int64_t *) incprefixes_mem_54635)[dynamic_id_54657] = acc_54680;\n                mem_fence_global();\n                ((volatile __global int8_t *) status_flags_mem_54611)[dynamic_id_54657] = (int8_t) 2;\n                acc_54680 = (int64_t) ", "0;\n            }\n            if (!block_new_sgm_54691 && slt32(local_tid_54640, wave_sizze_54642)) {\n                if (local_tid_54640 == 0) {\n                    ((volatile __global int64_t *) aggregates_mem_54633)[dynamic_id_54657] = acc_54680;\n                    mem_fence_global();\n                    ((volatile __global int8_t *) status_flags_mem_54611)[dynamic_id_54657] = (int8_t) 1;\n                    \n                    int8_t tmp_54692 = ((volatile __global int8_t *) status_flags_mem_54611)[dynamic_id_54657 - (int64_t) 1];\n                    \n                    ((volatile __local int8_t *) local_mem_54647)[(int64_t) 0] = tmp_54692;\n                }\n                mem_fence_local();\n                \n                int8_t status_54693 = ((__local int8_t *) local_mem_54647)[(int64_t) 0];\n                \n                if (status_54693 == (int8_t) 2) {\n                    if (local_tid_54640 == 0) {\n                        prefix_54690 = ((volatile __global int64_t *) incprefixes_mem_54635)[dynamic_id_54657 - (int64_t) 1];\n                    }\n                } else {\n                    int32_t readOffset_54694 = sext_i64_i32(dynamic_id_54657 - sext_i32_i64(wave_sizze_54642));\n                    \n                    while (slt32(wave_sizze_54642 * -1, readOffset_54694)) {\n                        int32_t read_i_54695 = readOffset_54694 + local_tid_54640;\n                        int64_t aggr_54696 = (int64_t) 0;\n                        int8_t flag_54697 = (int8_t) 0;\n                        \n                        if (sle32(0, read_i_54695)) {\n                            flag_54697 = ((volatile __global int8_t *) status_flags_mem_54611)[sext_i32_i64(read_i_54695)];\n                            if (flag_54697 == (int8_t) 2) {\n                                aggr_54696 = ((volatile __global int64_t *) incprefixes_mem_54635)[sext_i32_i64(read_i_54695)];\n                            } else if (flag_54697 == (int8_t) 1) {\n                                a",
                                    "ggr_54696 = ((volatile __global int64_t *) aggregates_mem_54633)[sext_i32_i64(read_i_54695)];\n                            }\n                        }\n                        ((__local int64_t *) local_mem_54647)[(int64_t) 4 + sext_i32_i64(local_tid_54640)] = aggr_54696;\n                        ((__local int8_t *) local_mem_54647)[sext_i32_i64(local_tid_54640)] = flag_54697;\n                        flag_54697 = ((__local int8_t *) local_mem_54647)[sext_i32_i64(wave_sizze_54642) - (int64_t) 1];\n                        if (slt8(flag_54697, (int8_t) 2)) {\n                            int8_t flg_x_54701;\n                            int8_t flg_y_54702;\n                            int64_t eta_p_54698;\n                            int64_t eta_p_54699;\n                            int32_t skip_threads_54703;\n                            \n                            // read input for in-block scan\n                            {\n                                flg_y_54702 = ((volatile __local int8_t *) local_mem_54647)[sext_i32_i64(local_tid_54640)];\n                                eta_p_54699 = ((volatile __local int64_t *) local_mem_54647)[(int64_t) 4 + sext_i32_i64(local_tid_54640)];\n                                if ((local_tid_54640 - squot32(local_tid_54640, 32) * 32) == 0) {\n                                    eta_p_54698 = eta_p_54699;\n                                    flg_x_54701 = flg_y_54702;\n                                }\n                            }\n                            // in-block scan (hopefully no barriers needed)\n                            {\n                                skip_threads_54703 = 1;\n                                while (slt32(skip_threads_54703, 32)) {\n                                    if (sle32(skip_threads_54703, local_tid_54640 - squot32(local_tid_54640, 32) * 32)) {\n                                        // read operands\n                                        {\n                                            flg_x_54701 = ((volatil", "e __local int8_t *) local_mem_54647)[sext_i32_i64(local_tid_54640) - sext_i32_i64(skip_threads_54703)];\n                                            eta_p_54698 = ((volatile __local int64_t *) local_mem_54647)[(int64_t) 4 + (sext_i32_i64(local_tid_54640) - sext_i32_i64(skip_threads_54703))];\n                                        }\n                                        // perform operation\n                                        {\n                                            if (flg_y_54702 == (int8_t) 2 || flg_y_54702 == (int8_t) 0) {\n                                                flg_x_54701 = flg_y_54702;\n                                                eta_p_54698 = eta_p_54699;\n                                            } else {\n                                                int64_t defunc_0_op_res_54700 = add64(eta_p_54698, eta_p_54699);\n                                                \n                                                eta_p_54698 = defunc_0_op_res_54700;\n                                            }\n                                        }\n                                        // write result\n                                        {\n                                            ((volatile __local int8_t *) local_mem_54647)[sext_i32_i64(local_tid_54640)] = flg_x_54701;\n                                            flg_y_54702 = flg_x_54701;\n                                            ((volatile __local int64_t *) local_mem_54647)[(int64_t) 4 + sext_i32_i64(local_tid_54640)] = eta_p_54698;\n                                            eta_p_54699 = eta_p_54698;\n                                        }\n                                    }\n                                    skip_threads_54703 *= 2;\n                                }\n                            }\n                        }\n                        flag_54697 = ((__local int8_t *) local_mem_54647)[sext_i32_i64(wave_sizze_54642) - (int64_t) 1];\n                        aggr_54696 = ((_", "_local int64_t *) local_mem_54647)[(int64_t) 4 + (sext_i32_i64(wave_sizze_54642) - (int64_t) 1)];\n                        if (flag_54697 == (int8_t) 2) {\n                            readOffset_54694 = wave_sizze_54642 * -1;\n                        } else if (flag_54697 == (int8_t) 1) {\n                            readOffset_54694 -= wave_sizze_54642;\n                        }\n                        if (slt8((int8_t) 0, flag_54697)) {\n                            int64_t eta_p_54704 = aggr_54696;\n                            int64_t eta_p_54705 = prefix_54690;\n                            int64_t defunc_0_op_res_54706 = add64(eta_p_54704, eta_p_54705);\n                            \n                            prefix_54690 = defunc_0_op_res_54706;\n                        }\n                        mem_fence_local();\n                    }\n                }\n                if (local_tid_54640 == 0) {\n                    if (boundary_54660 == sext_i64_i32(segscan_tblock_sizze_45486 * chunk_sizze_54608)) {\n                        int64_t eta_p_54707 = prefix_54690;\n                        int64_t eta_p_54708 = acc_54680;\n                        int64_t defunc_0_op_res_54709 = add64(eta_p_54707, eta_p_54708);\n                        \n                        ((volatile __global int64_t *) incprefixes_mem_54635)[dynamic_id_54657] = defunc_0_op_res_54709;\n                        mem_fence_global();\n                        ((volatile __global int8_t *) status_flags_mem_54611)[dynamic_id_54657] = (int8_t) 2;\n                    }\n                    ((__local int64_t *) local_mem_54647)[(int64_t) 4] = prefix_54690;\n                    acc_54680 = (int64_t) 0;\n                }\n            }\n            if (!(dynamic_id_54657 == (int64_t) 0)) {\n                barrier(CLK_LOCAL_MEM_FENCE);\n                prefix_54690 = ((__local int64_t *) local_mem_54647)[(int64_t) 4];\n                barrier(CLK_LOCAL_MEM_FENCE);\n            }\n        }\n        // Distribute results\n        {\n   ",
                                    "         int64_t eta_p_54710;\n            int64_t eta_p_54711;\n            int64_t eta_p_54713 = prefix_54690;\n            int64_t eta_p_54714 = acc_54680;\n            \n            if (slt32(local_tid_54640 * chunk_sizze_32b_54644, boundary_54660) && !block_new_sgm_54691) {\n                int64_t defunc_0_op_res_54715 = add64(eta_p_54713, eta_p_54714);\n                \n                eta_p_54710 = defunc_0_op_res_54715;\n            } else {\n                eta_p_54710 = acc_54680;\n            }\n            \n            int32_t stopping_point_54716 = segsizze_compact_54661 - srem32(local_tid_54640 * chunk_sizze_32b_54644 - 1 + segsizze_compact_54661 - boundary_54660, segsizze_compact_54661);\n            \n            for (int64_t i_54717 = 0; i_54717 < chunk_sizze_54608; i_54717++) {\n                if (slt32(sext_i64_i32(i_54717), stopping_point_54716 - 1)) {\n                    eta_p_54711 = private_mem_54662[i_54717];\n                    \n                    int64_t defunc_0_op_res_54712 = add64(eta_p_54710, eta_p_54711);\n                    \n                    private_mem_54662[i_54717] = defunc_0_op_res_54712;\n                }\n            }\n        }\n        // Transpose scan output and Write it to global memory in coalesced fashion\n        {\n            for (int64_t i_54718 = 0; i_54718 < chunk_sizze_54608; i_54718++) {\n                int64_t sharedIdx_54719 = sext_i32_i64(local_tid_54640) * chunk_sizze_54608 + i_54718;\n                int64_t tmp_54720 = private_mem_54662[i_54718];\n                \n                ((__local int64_t *) local_mem_54647)[sharedIdx_54719] = tmp_54720;\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            for (int64_t i_54721 = 0; i_54721 < chunk_sizze_54608; i_54721++) {\n                int64_t flat_idx_54722 = thd_offset_54664 + i_54721 * segscan_tblock_sizze_45486;\n                int64_t slice_54723 = part_no_24090;\n                int64_t gtid_45490 = flat_idx_54722;\n                int64_t remnant_54724 = fl", "at_idx_54722 - gtid_45490;\n                \n                if (slt64(flat_idx_54722, part_no_24090)) {\n                    int64_t tmp_54725 = ((__local int64_t *) local_mem_54647)[flat_idx_54722 - block_offset_54658];\n                    \n                    ((__global int64_t *) mem_53538)[gtid_45490] = tmp_54725;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n        }\n    }\n    \n  error_3:\n    return;\n    #undef segscan_tblock_sizze_45486\n    #undef chunk_sizze_54608\n}\nFUTHARK_KERNEL_SIZED(rectify_partition_ids_doublezisegmap_intrablock_49824_dim1, 1, 1)\nvoid rectify_partition_ids_doublezisegmap_intrablock_49824(__global int *global_failure, int64_t dz2081Uz2080U_37953, int64_t inf_39845, int64_t dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_39848, int64_t ldim_49827, int64_t num_whole_tiles_49842, int64_t residual_input_49989, unsigned char cond_49990_bits, int64_t binop_x_50003, __global unsigned char *partition_ids_mem_53506, __global unsigned char *chain_id_mem_53507, __global unsigned char *replaceWith_mem_53508, __global unsigned char *mem_53510)\n{\n    bool cond_49990 = cond_49990_bits;\n    \n    #define tile_sizze_49826 (rectify_partition_ids_doublezisegmap_intrablock_49824zitile_sizze_49826)\n    #define bytes_53569 (rectify_partition_ids_doublezisegmap_intrablock_49824zibytes_53569)\n    \n    volatile __local unsigned char *color_54517_backing_1 = &shared_mem[0];\n    const int64_t color_54517_backing_1_offset = 0 + (bytes_53569 + srem64((int64_t) 8 - srem64(bytes_53569, (int64_t) 8), (int64_t) 8));\n    volatile __local unsigned char *color_54516_backing_0 = &shared_mem[color_54517_backing_1_offset];\n    const int64_t color_54516_backing_0_offset = color_54517_backing_1_offset + (bytes_53569 + srem64((int64_t) 8 - srem64(bytes_53569, (int64_t) 8), (int64_t) 8));\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_54546;\n    int32_t tblock_sizze_54549;\n    int32_t wave_sizze_54548;\n    int32_t block_id_54547;\n    int", "32_t global_tid_54545;\n    int64_t gid_flat_49824;\n    int64_t slice_54551;\n    int64_t ltid_pre_54550;\n    int64_t remnant_54552;\n    int64_t slice_54553;\n    int64_t gid_49823;\n    int64_t remnant_54554;\n    __local unsigned char *color_54516;\n    __local unsigned char *color_54517;\n    int64_t binop_x_49834;\n    int64_t mem_53558[1];\n    int64_t ltid_flat_49829;\n    int64_t ltid_49828;\n    int64_t gtid_49835;\n    bool cond_49836;\n    int64_t pre_49837;\n    int64_t mem_53562[1];\n    int64_t mem_53566[1];\n    int64_t ltid_flat_49844;\n    int64_t ltid_49843;\n    int64_t gtid_49852;\n    bool cond_49853;\n    int64_t neutral_49854;\n    int64_t neutral_49855;\n    int64_t ext_mem_53582[1];\n    int64_t ext_mem_53581[1];\n    int64_t mem_param_53567[1];\n    int64_t mem_param_53568[1];\n    int64_t mem_53590[1];\n    int64_t ext_mem_53591[1];\n    \n    local_tid_54546 = get_local_id(0);\n    tblock_sizze_54549 = get_local_size(0);\n    wave_sizze_54548 = LOCKSTEP_WIDTH;\n    block_id_54547 = get_tblock_id(0);\n    global_tid_54545 = block_id_54547 * tblock_sizze_54549 + local_tid_54546;\n    gid_flat_49824 = sext_i32_i64(block_id_54547);\n    slice_54551 = tile_sizze_49826;\n    ltid_pre_54550 = sext_i32_i64(local_tid_54546);\n    remnant_54552 = sext_i32_i64(local_tid_54546) - ltid_pre_54550;\n    slice_54553 = ldim_49827;\n    gid_49823 = sext_i32_i64(block_id_54547);\n    remnant_54554 = sext_i32_i64(block_id_54547) - gid_49823;\n    color_54516 = (__local unsigned char *) color_54516_backing_0;\n    color_54517 = (__local unsigned char *) color_54517_backing_1;\n    binop_x_49834 = gid_49823 * tile_sizze_49826;\n    ltid_flat_49829 = sext_i32_i64(local_tid_54546);\n    ltid_49828 = sext_i32_i64(sext_i64_i32(ltid_pre_54550));\n    gtid_49835 = ltid_49828 + binop_x_49834;\n    cond_49836 = slt64(gtid_49835, dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_39848);\n    if (cond_49836) {\n        int64_t slice_49838;\n        int64_t eta_p_49839;\n        \n        slice_49838 = inf_39845 + gtid_49835;\n        eta_",
                                    "p_49839 = ((__global int64_t *) partition_ids_mem_53506)[slice_49838];\n        pre_49837 = eta_p_49839;\n    } else {\n        pre_49837 = (int64_t) 0;\n    }\n    mem_53558[(int64_t) 0] = pre_49837;\n    barrier(CLK_LOCAL_MEM_FENCE);\n    ltid_flat_49844 = sext_i32_i64(local_tid_54546);\n    ltid_49843 = sext_i32_i64(sext_i64_i32(ltid_pre_54550));\n    gtid_49852 = binop_x_49834 + ltid_49843;\n    cond_49853 = slt64(gtid_49852, dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_39848);\n    if (cond_49853) {\n        int64_t eta_p_49856 = mem_53558[(int64_t) 0];\n        \n        neutral_49854 = eta_p_49856;\n        neutral_49855 = eta_p_49856;\n    } else {\n        neutral_49854 = (int64_t) 0;\n        neutral_49855 = (int64_t) 0;\n    }\n    mem_53562[(int64_t) 0] = neutral_49854;\n    mem_53566[(int64_t) 0] = neutral_49855;\n    barrier(CLK_LOCAL_MEM_FENCE);\n    barrier(CLK_LOCAL_MEM_FENCE);\n    for (int32_t i_2 = 0; i_2 < 1; i_2++)\n        mem_param_53567[i_2] = mem_53562[i_2];\n    for (int32_t i_3 = 0; i_3 < 1; i_3++)\n        mem_param_53568[i_3] = mem_53566[i_3];\n    for (int64_t tile_id_49863 = 0; tile_id_49863 < num_whole_tiles_49842; tile_id_49863++) {\n        int64_t binop_x_49931;\n        int64_t ltid_flat_49930;\n        int64_t ltid_49929;\n        int64_t j_49932;\n        bool cond_49936;\n        int64_t pre1d_49937;\n        int64_t pre1d_49938;\n        int64_t mem_53576[1];\n        int64_t mem_53580[1];\n        int64_t ltid_flat_49946;\n        int64_t ltid_49945;\n        int64_t gtid_49948;\n        int64_t acc_49950;\n        int64_t acc_49951;\n        bool cond_49952;\n        int64_t acc_49953;\n        int64_t acc_49954;\n        int64_t mem_param_tmp_54555[1];\n        int64_t mem_param_tmp_54556[1];\n        \n        binop_x_49931 = tile_sizze_49826 * tile_id_49863;\n        ltid_flat_49930 = sext_i32_i64(local_tid_54546);\n        ltid_49929 = sext_i32_i64(sext_i64_i32(ltid_pre_54550));\n        j_49932 = ltid_49929 + binop_x_49931;\n        cond_49936 = slt64(j_49932, dz2081Uz2080U_37953);", "\n        if (cond_49936) {\n            int64_t tile_elem_49939;\n            int64_t tile_elem_49940;\n            \n            tile_elem_49939 = ((__global int64_t *) chain_id_mem_53507)[j_49932];\n            tile_elem_49940 = ((__global int64_t *) replaceWith_mem_53508)[j_49932];\n            pre1d_49937 = tile_elem_49939;\n            pre1d_49938 = tile_elem_49940;\n        } else {\n            pre1d_49937 = (int64_t) 0;\n            pre1d_49938 = (int64_t) 0;\n        }\n        ((__local int64_t *) color_54517)[ltid_49929] = pre1d_49937;\n        ((__local int64_t *) color_54516)[ltid_49929] = pre1d_49938;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        ltid_flat_49946 = sext_i32_i64(local_tid_54546);\n        ltid_49945 = sext_i32_i64(sext_i64_i32(ltid_pre_54550));\n        gtid_49948 = binop_x_49834 + ltid_49945;\n        acc_49950 = mem_param_53567[(int64_t) 0];\n        acc_49951 = mem_param_53568[(int64_t) 0];\n        cond_49952 = slt64(gtid_49948, dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_39848);\n        if (cond_49952) {\n            int64_t eta_p_49949;\n            int64_t x_49955;\n            int64_t x_49956;\n            int64_t redout_53108;\n            int64_t redout_53109;\n            \n            eta_p_49949 = mem_53558[(int64_t) 0];\n            redout_53108 = acc_49950;\n            redout_53109 = acc_49951;\n            for (int64_t i_53110 = 0; i_53110 < tile_sizze_49826; i_53110++) {\n                int64_t x_49957;\n                bool cond_49963;\n                bool cond_49964;\n                bool cond_49965;\n                bool cond_f_res_t_res_49966;\n                bool x_49967;\n                bool y_49968;\n                bool cond_49969;\n                int64_t lifted_lambda_res_49970;\n                int64_t lifted_lambda_res_49971;\n                int64_t redout_tmp_54559;\n                int64_t redout_tmp_54560;\n                \n                x_49957 = ((__local int64_t *) color_54517)[i_53110];\n                cond_49963 = redout_53108 == eta_p_49949;\n", "                cond_49964 = !cond_49963;\n                cond_49965 = x_49957 == eta_p_49949;\n                cond_f_res_t_res_49966 = redout_53109 == eta_p_49949;\n                x_49967 = cond_49965 && cond_f_res_t_res_49966;\n                y_49968 = cond_49963 && x_49967;\n                cond_49969 = cond_49964 || y_49968;\n                if (cond_49969) {\n                    lifted_lambda_res_49970 = x_49957;\n                } else {\n                    lifted_lambda_res_49970 = redout_53108;\n                }\n                if (cond_49969) {\n                    int64_t x_49958 = ((__local int64_t *) color_54516)[i_53110];\n                    \n                    lifted_lambda_res_49971 = x_49958;\n                } else {\n                    lifted_lambda_res_49971 = redout_53109;\n                }\n                redout_tmp_54559 = lifted_lambda_res_49970;\n                redout_tmp_54560 = lifted_lambda_res_49971;\n                redout_53108 = redout_tmp_54559;\n                redout_53109 = redout_tmp_54560;\n            }\n            x_49955 = redout_53108;\n            x_49956 = redout_53109;\n            acc_49953 = x_49955;\n            acc_49954 = x_49956;\n        } else {\n            acc_49953 = acc_49950;\n            acc_49954 = acc_49951;\n        }\n        mem_53576[(int64_t) 0] = acc_49953;\n        mem_53580[(int64_t) 0] = acc_49954;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        for (int32_t i_4 = 0; i_4 < 1; i_4++)\n            mem_param_tmp_54555[i_4] = mem_53576[i_4];\n        for (int32_t i_5 = 0; i_5 < 1; i_5++)\n            mem_param_tmp_54556[i_5] = mem_53580[i_5];\n        for (int32_t i_6 = 0; i_6 < 1; i_6++)\n            mem_param_53567[i_6] = mem_param_tmp_54555[i_6];\n        for (int32_t i_7 = 0; i_7 < 1; i_7++)\n            mem_param_53568[i_7] = mem_param_tmp_54556[i_7];\n    }\n    for (int32_t i_8 = 0; i_8 < 1; i_8++)\n        ext_mem_53582[i_8] = mem_param_53567[i_8];\n    for (int32_t i_9 = 0; i_9 < 1; i_9++)\n        ext_mem_53581[i_9] = mem_",
                                    "param_53568[i_9];\n    barrier(CLK_LOCAL_MEM_FENCE);\n    if (cond_49990) {\n        for (int32_t i_10 = 0; i_10 < 1; i_10++)\n            ext_mem_53591[i_10] = ext_mem_53581[i_10];\n    } else {\n        int64_t ltid_flat_49992;\n        int64_t ltid_49991;\n        int64_t j_50004;\n        bool cond_50008;\n        int64_t pre1d_50009;\n        int64_t pre1d_50010;\n        int64_t ltid_flat_50020;\n        int64_t ltid_50019;\n        int64_t gtid_50030;\n        int64_t acc_50033;\n        bool cond_50034;\n        int64_t acc_50036;\n        \n        ltid_flat_49992 = sext_i32_i64(local_tid_54546);\n        ltid_49991 = sext_i32_i64(sext_i64_i32(ltid_pre_54550));\n        j_50004 = ltid_49991 + binop_x_50003;\n        cond_50008 = slt64(j_50004, dz2081Uz2080U_37953);\n        if (cond_50008) {\n            int64_t tile_elem_50011;\n            int64_t tile_elem_50012;\n            \n            tile_elem_50011 = ((__global int64_t *) chain_id_mem_53507)[j_50004];\n            tile_elem_50012 = ((__global int64_t *) replaceWith_mem_53508)[j_50004];\n            pre1d_50009 = tile_elem_50011;\n            pre1d_50010 = tile_elem_50012;\n        } else {\n            pre1d_50009 = (int64_t) 0;\n            pre1d_50010 = (int64_t) 0;\n        }\n        ((__local int64_t *) color_54517)[ltid_49991] = pre1d_50009;\n        ((__local int64_t *) color_54516)[ltid_49991] = pre1d_50010;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        ltid_flat_50020 = sext_i32_i64(local_tid_54546);\n        ltid_50019 = sext_i32_i64(sext_i64_i32(ltid_pre_54550));\n        gtid_50030 = binop_x_49834 + ltid_50019;\n        acc_50033 = ext_mem_53581[(int64_t) 0];\n        cond_50034 = slt64(gtid_50030, dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_39848);\n        if (cond_50034) {\n            int64_t eta_p_50031;\n            int64_t acc_50032;\n            int64_t x_50037;\n            int64_t x_50038;\n            int64_t redout_53111;\n            int64_t redout_53112;\n            \n            eta_p_50031 = mem_53558[(int64_t) 0];\n           ", " acc_50032 = ext_mem_53582[(int64_t) 0];\n            redout_53111 = acc_50032;\n            redout_53112 = acc_50033;\n            for (int64_t i_53113 = 0; i_53113 < residual_input_49989; i_53113++) {\n                int64_t x_50039;\n                bool cond_50045;\n                bool cond_50046;\n                bool cond_50047;\n                bool cond_f_res_t_res_50048;\n                bool x_50049;\n                bool y_50050;\n                bool cond_50051;\n                int64_t lifted_lambda_res_50052;\n                int64_t lifted_lambda_res_50053;\n                int64_t redout_tmp_54561;\n                int64_t redout_tmp_54562;\n                \n                x_50039 = ((__local int64_t *) color_54517)[i_53113];\n                cond_50045 = redout_53111 == eta_p_50031;\n                cond_50046 = !cond_50045;\n                cond_50047 = x_50039 == eta_p_50031;\n                cond_f_res_t_res_50048 = redout_53112 == eta_p_50031;\n                x_50049 = cond_50047 && cond_f_res_t_res_50048;\n                y_50050 = cond_50045 && x_50049;\n                cond_50051 = cond_50046 || y_50050;\n                if (cond_50051) {\n                    lifted_lambda_res_50052 = x_50039;\n                } else {\n                    lifted_lambda_res_50052 = redout_53111;\n                }\n                if (cond_50051) {\n                    int64_t x_50040 = ((__local int64_t *) color_54516)[i_53113];\n                    \n                    lifted_lambda_res_50053 = x_50040;\n                } else {\n                    lifted_lambda_res_50053 = redout_53112;\n                }\n                redout_tmp_54561 = lifted_lambda_res_50052;\n                redout_tmp_54562 = lifted_lambda_res_50053;\n                redout_53111 = redout_tmp_54561;\n                redout_53112 = redout_tmp_54562;\n            }\n            x_50037 = redout_53111;\n            x_50038 = redout_53112;\n            acc_50036 = x_50038;\n        } else {\n            acc_50036 = acc_5003", "3;\n        }\n        mem_53590[(int64_t) 0] = acc_50036;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        for (int32_t i_11 = 0; i_11 < 1; i_11++)\n            ext_mem_53591[i_11] = mem_53590[i_11];\n    }\n    if (slt64(sext_i32_i64(local_tid_54546) + tile_sizze_49826 * sext_i32_i64(block_id_54547), dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_39848)) {\n        int64_t tmp_54563 = ext_mem_53591[(int64_t) 0];\n        \n        ((__global int64_t *) mem_53510)[inf_39845 + (sext_i32_i64(local_tid_54546) + tile_sizze_49826 * sext_i32_i64(block_id_54547))] = tmp_54563;\n    }\n    \n  error_8:\n    return;\n    #undef tile_sizze_49826\n    #undef bytes_53569\n}\nFUTHARK_KERNEL_SIZED(rectify_partition_ids_doublezisegmap_intrablock_50068_dim1, 1, 1)\nvoid rectify_partition_ids_doublezisegmap_intrablock_50068(__global int *global_failure, int64_t dz2081Uz2080U_37953, int64_t inf_39845, int64_t dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_39848, int64_t ldim_50071, int64_t num_whole_tiles_50086, int64_t residual_input_50233, unsigned char cond_50234_bits, int64_t binop_x_50247, __global unsigned char *partition_ids_mem_53506, __global unsigned char *chain_id_mem_53507, __global unsigned char *replaceWith_mem_53508, __global unsigned char *mem_53510)\n{\n    bool cond_50234 = cond_50234_bits;\n    \n    #define tile_sizze_50070 (rectify_partition_ids_doublezisegmap_intrablock_50068zitile_sizze_50070)\n    #define bytes_53529 (rectify_partition_ids_doublezisegmap_intrablock_50068zibytes_53529)\n    \n    volatile __local unsigned char *color_54519_backing_1 = &shared_mem[0];\n    const int64_t color_54519_backing_1_offset = 0 + (bytes_53529 + srem64((int64_t) 8 - srem64(bytes_53529, (int64_t) 8), (int64_t) 8));\n    volatile __local unsigned char *color_54518_backing_0 = &shared_mem[color_54519_backing_1_offset];\n    const int64_t color_54518_backing_0_offset = color_54519_backing_1_offset + (bytes_53529 + srem64((int64_t) 8 - srem64(bytes_53529, (int64_t) 8), (int64_t) 8));\n    \n    if (*global_failure >= 0)\n        retu",
                                    "rn;\n    \n    int32_t local_tid_54567;\n    int32_t tblock_sizze_54570;\n    int32_t wave_sizze_54569;\n    int32_t block_id_54568;\n    int32_t global_tid_54566;\n    int64_t gid_flat_50068;\n    int64_t slice_54572;\n    int64_t ltid_pre_54571;\n    int64_t remnant_54573;\n    int64_t slice_54574;\n    int64_t gid_50067;\n    int64_t remnant_54575;\n    __local unsigned char *color_54518;\n    __local unsigned char *color_54519;\n    int64_t binop_x_50078;\n    int64_t mem_53518[1];\n    int64_t ltid_flat_50073;\n    int64_t ltid_50072;\n    int64_t gtid_50079;\n    bool cond_50080;\n    int64_t pre_50081;\n    int64_t mem_53522[1];\n    int64_t mem_53526[1];\n    int64_t ltid_flat_50088;\n    int64_t ltid_50087;\n    int64_t gtid_50096;\n    bool cond_50097;\n    int64_t neutral_50098;\n    int64_t neutral_50099;\n    int64_t ext_mem_53542[1];\n    int64_t ext_mem_53541[1];\n    int64_t mem_param_53527[1];\n    int64_t mem_param_53528[1];\n    int64_t mem_53550[1];\n    int64_t ext_mem_53551[1];\n    \n    local_tid_54567 = get_local_id(0);\n    tblock_sizze_54570 = get_local_size(0);\n    wave_sizze_54569 = LOCKSTEP_WIDTH;\n    block_id_54568 = get_tblock_id(0);\n    global_tid_54566 = block_id_54568 * tblock_sizze_54570 + local_tid_54567;\n    gid_flat_50068 = sext_i32_i64(block_id_54568);\n    slice_54572 = tile_sizze_50070;\n    ltid_pre_54571 = sext_i32_i64(local_tid_54567);\n    remnant_54573 = sext_i32_i64(local_tid_54567) - ltid_pre_54571;\n    slice_54574 = ldim_50071;\n    gid_50067 = sext_i32_i64(block_id_54568);\n    remnant_54575 = sext_i32_i64(block_id_54568) - gid_50067;\n    color_54518 = (__local unsigned char *) color_54518_backing_0;\n    color_54519 = (__local unsigned char *) color_54519_backing_1;\n    binop_x_50078 = gid_50067 * tile_sizze_50070;\n    ltid_flat_50073 = sext_i32_i64(local_tid_54567);\n    ltid_50072 = sext_i32_i64(sext_i64_i32(ltid_pre_54571));\n    gtid_50079 = ltid_50072 + binop_x_50078;\n    cond_50080 = slt64(gtid_50079, dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_39848);\n    if (cond", "_50080) {\n        int64_t slice_50082;\n        int64_t eta_p_50083;\n        \n        slice_50082 = inf_39845 + gtid_50079;\n        eta_p_50083 = ((__global int64_t *) partition_ids_mem_53506)[slice_50082];\n        pre_50081 = eta_p_50083;\n    } else {\n        pre_50081 = (int64_t) 0;\n    }\n    mem_53518[(int64_t) 0] = pre_50081;\n    barrier(CLK_LOCAL_MEM_FENCE);\n    ltid_flat_50088 = sext_i32_i64(local_tid_54567);\n    ltid_50087 = sext_i32_i64(sext_i64_i32(ltid_pre_54571));\n    gtid_50096 = binop_x_50078 + ltid_50087;\n    cond_50097 = slt64(gtid_50096, dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_39848);\n    if (cond_50097) {\n        int64_t eta_p_50100 = mem_53518[(int64_t) 0];\n        \n        neutral_50098 = eta_p_50100;\n        neutral_50099 = eta_p_50100;\n    } else {\n        neutral_50098 = (int64_t) 0;\n        neutral_50099 = (int64_t) 0;\n    }\n    mem_53522[(int64_t) 0] = neutral_50098;\n    mem_53526[(int64_t) 0] = neutral_50099;\n    barrier(CLK_LOCAL_MEM_FENCE);\n    barrier(CLK_LOCAL_MEM_FENCE);\n    for (int32_t i_2 = 0; i_2 < 1; i_2++)\n        mem_param_53527[i_2] = mem_53522[i_2];\n    for (int32_t i_3 = 0; i_3 < 1; i_3++)\n        mem_param_53528[i_3] = mem_53526[i_3];\n    for (int64_t tile_id_50107 = 0; tile_id_50107 < num_whole_tiles_50086; tile_id_50107++) {\n        int64_t binop_x_50175;\n        int64_t ltid_flat_50174;\n        int64_t ltid_50173;\n        int64_t j_50176;\n        bool cond_50180;\n        int64_t pre1d_50181;\n        int64_t pre1d_50182;\n        int64_t mem_53536[1];\n        int64_t mem_53540[1];\n        int64_t ltid_flat_50190;\n        int64_t ltid_50189;\n        int64_t gtid_50192;\n        int64_t acc_50194;\n        int64_t acc_50195;\n        bool cond_50196;\n        int64_t acc_50197;\n        int64_t acc_50198;\n        int64_t mem_param_tmp_54576[1];\n        int64_t mem_param_tmp_54577[1];\n        \n        binop_x_50175 = tile_sizze_50070 * tile_id_50107;\n        ltid_flat_50174 = sext_i32_i64(local_tid_54567);\n        ltid_50173 = sext_i32_i64", "(sext_i64_i32(ltid_pre_54571));\n        j_50176 = ltid_50173 + binop_x_50175;\n        cond_50180 = slt64(j_50176, dz2081Uz2080U_37953);\n        if (cond_50180) {\n            int64_t tile_elem_50183;\n            int64_t tile_elem_50184;\n            \n            tile_elem_50183 = ((__global int64_t *) chain_id_mem_53507)[j_50176];\n            tile_elem_50184 = ((__global int64_t *) replaceWith_mem_53508)[j_50176];\n            pre1d_50181 = tile_elem_50183;\n            pre1d_50182 = tile_elem_50184;\n        } else {\n            pre1d_50181 = (int64_t) 0;\n            pre1d_50182 = (int64_t) 0;\n        }\n        ((__local int64_t *) color_54519)[ltid_50173] = pre1d_50181;\n        ((__local int64_t *) color_54518)[ltid_50173] = pre1d_50182;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        ltid_flat_50190 = sext_i32_i64(local_tid_54567);\n        ltid_50189 = sext_i32_i64(sext_i64_i32(ltid_pre_54571));\n        gtid_50192 = binop_x_50078 + ltid_50189;\n        acc_50194 = mem_param_53527[(int64_t) 0];\n        acc_50195 = mem_param_53528[(int64_t) 0];\n        cond_50196 = slt64(gtid_50192, dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_39848);\n        if (cond_50196) {\n            int64_t eta_p_50193;\n            int64_t x_50199;\n            int64_t x_50200;\n            int64_t redout_53114;\n            int64_t redout_53115;\n            \n            eta_p_50193 = mem_53518[(int64_t) 0];\n            redout_53114 = acc_50194;\n            redout_53115 = acc_50195;\n            for (int64_t i_53116 = 0; i_53116 < tile_sizze_50070; i_53116++) {\n                int64_t x_50201;\n                bool cond_50207;\n                bool cond_50208;\n                bool cond_50209;\n                bool cond_f_res_t_res_50210;\n                bool x_50211;\n                bool y_50212;\n                bool cond_50213;\n                int64_t lifted_lambda_res_50214;\n                int64_t lifted_lambda_res_50215;\n                int64_t redout_tmp_54580;\n                int64_t redout_tmp_54581;\n          ",
                                    "      \n                x_50201 = ((__local int64_t *) color_54519)[i_53116];\n                cond_50207 = redout_53114 == eta_p_50193;\n                cond_50208 = !cond_50207;\n                cond_50209 = x_50201 == eta_p_50193;\n                cond_f_res_t_res_50210 = redout_53115 == eta_p_50193;\n                x_50211 = cond_50209 && cond_f_res_t_res_50210;\n                y_50212 = cond_50207 && x_50211;\n                cond_50213 = cond_50208 || y_50212;\n                if (cond_50213) {\n                    lifted_lambda_res_50214 = x_50201;\n                } else {\n                    lifted_lambda_res_50214 = redout_53114;\n                }\n                if (cond_50213) {\n                    int64_t x_50202 = ((__local int64_t *) color_54518)[i_53116];\n                    \n                    lifted_lambda_res_50215 = x_50202;\n                } else {\n                    lifted_lambda_res_50215 = redout_53115;\n                }\n                redout_tmp_54580 = lifted_lambda_res_50214;\n                redout_tmp_54581 = lifted_lambda_res_50215;\n                redout_53114 = redout_tmp_54580;\n                redout_53115 = redout_tmp_54581;\n            }\n            x_50199 = redout_53114;\n            x_50200 = redout_53115;\n            acc_50197 = x_50199;\n            acc_50198 = x_50200;\n        } else {\n            acc_50197 = acc_50194;\n            acc_50198 = acc_50195;\n        }\n        mem_53536[(int64_t) 0] = acc_50197;\n        mem_53540[(int64_t) 0] = acc_50198;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        for (int32_t i_4 = 0; i_4 < 1; i_4++)\n            mem_param_tmp_54576[i_4] = mem_53536[i_4];\n        for (int32_t i_5 = 0; i_5 < 1; i_5++)\n            mem_param_tmp_54577[i_5] = mem_53540[i_5];\n        for (int32_t i_6 = 0; i_6 < 1; i_6++)\n            mem_param_53527[i_6] = mem_param_tmp_54576[i_6];\n        for (int32_t i_7 = 0; i_7 < 1; i_7++)\n            mem_param_53528[i_7] = mem_param_tmp_54577[i_7];\n    }\n    for (int32_t i_8 = 0; i_8 < 1", "; i_8++)\n        ext_mem_53542[i_8] = mem_param_53527[i_8];\n    for (int32_t i_9 = 0; i_9 < 1; i_9++)\n        ext_mem_53541[i_9] = mem_param_53528[i_9];\n    barrier(CLK_LOCAL_MEM_FENCE);\n    if (cond_50234) {\n        for (int32_t i_10 = 0; i_10 < 1; i_10++)\n            ext_mem_53551[i_10] = ext_mem_53541[i_10];\n    } else {\n        int64_t ltid_flat_50236;\n        int64_t ltid_50235;\n        int64_t j_50248;\n        bool cond_50252;\n        int64_t pre1d_50253;\n        int64_t pre1d_50254;\n        int64_t ltid_flat_50264;\n        int64_t ltid_50263;\n        int64_t gtid_50274;\n        int64_t acc_50277;\n        bool cond_50278;\n        int64_t acc_50280;\n        \n        ltid_flat_50236 = sext_i32_i64(local_tid_54567);\n        ltid_50235 = sext_i32_i64(sext_i64_i32(ltid_pre_54571));\n        j_50248 = ltid_50235 + binop_x_50247;\n        cond_50252 = slt64(j_50248, dz2081Uz2080U_37953);\n        if (cond_50252) {\n            int64_t tile_elem_50255;\n            int64_t tile_elem_50256;\n            \n            tile_elem_50255 = ((__global int64_t *) chain_id_mem_53507)[j_50248];\n            tile_elem_50256 = ((__global int64_t *) replaceWith_mem_53508)[j_50248];\n            pre1d_50253 = tile_elem_50255;\n            pre1d_50254 = tile_elem_50256;\n        } else {\n            pre1d_50253 = (int64_t) 0;\n            pre1d_50254 = (int64_t) 0;\n        }\n        ((__local int64_t *) color_54519)[ltid_50235] = pre1d_50253;\n        ((__local int64_t *) color_54518)[ltid_50235] = pre1d_50254;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        ltid_flat_50264 = sext_i32_i64(local_tid_54567);\n        ltid_50263 = sext_i32_i64(sext_i64_i32(ltid_pre_54571));\n        gtid_50274 = binop_x_50078 + ltid_50263;\n        acc_50277 = ext_mem_53541[(int64_t) 0];\n        cond_50278 = slt64(gtid_50274, dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_39848);\n        if (cond_50278) {\n            int64_t eta_p_50275;\n            int64_t acc_50276;\n            int64_t x_50281;\n            int64_t x_50282;\n       ", "     int64_t redout_53117;\n            int64_t redout_53118;\n            \n            eta_p_50275 = mem_53518[(int64_t) 0];\n            acc_50276 = ext_mem_53542[(int64_t) 0];\n            redout_53117 = acc_50276;\n            redout_53118 = acc_50277;\n            for (int64_t i_53119 = 0; i_53119 < residual_input_50233; i_53119++) {\n                int64_t x_50283;\n                bool cond_50289;\n                bool cond_50290;\n                bool cond_50291;\n                bool cond_f_res_t_res_50292;\n                bool x_50293;\n                bool y_50294;\n                bool cond_50295;\n                int64_t lifted_lambda_res_50296;\n                int64_t lifted_lambda_res_50297;\n                int64_t redout_tmp_54582;\n                int64_t redout_tmp_54583;\n                \n                x_50283 = ((__local int64_t *) color_54519)[i_53119];\n                cond_50289 = redout_53117 == eta_p_50275;\n                cond_50290 = !cond_50289;\n                cond_50291 = x_50283 == eta_p_50275;\n                cond_f_res_t_res_50292 = redout_53118 == eta_p_50275;\n                x_50293 = cond_50291 && cond_f_res_t_res_50292;\n                y_50294 = cond_50289 && x_50293;\n                cond_50295 = cond_50290 || y_50294;\n                if (cond_50295) {\n                    lifted_lambda_res_50296 = x_50283;\n                } else {\n                    lifted_lambda_res_50296 = redout_53117;\n                }\n                if (cond_50295) {\n                    int64_t x_50284 = ((__local int64_t *) color_54518)[i_53119];\n                    \n                    lifted_lambda_res_50297 = x_50284;\n                } else {\n                    lifted_lambda_res_50297 = redout_53118;\n                }\n                redout_tmp_54582 = lifted_lambda_res_50296;\n                redout_tmp_54583 = lifted_lambda_res_50297;\n                redout_53117 = redout_tmp_54582;\n                redout_53118 = redout_tmp_54583;\n            }\n            x_50281", " = redout_53117;\n            x_50282 = redout_53118;\n            acc_50280 = x_50282;\n        } else {\n            acc_50280 = acc_50277;\n        }\n        mem_53550[(int64_t) 0] = acc_50280;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        for (int32_t i_11 = 0; i_11 < 1; i_11++)\n            ext_mem_53551[i_11] = mem_53550[i_11];\n    }\n    if (slt64(sext_i32_i64(local_tid_54567) + tile_sizze_50070 * sext_i32_i64(block_id_54568), dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_39848)) {\n        int64_t tmp_54584 = ext_mem_53551[(int64_t) 0];\n        \n        ((__global int64_t *) mem_53510)[inf_39845 + (sext_i32_i64(local_tid_54567) + tile_sizze_50070 * sext_i32_i64(block_id_54568))] = tmp_54584;\n    }\n    \n  error_8:\n    return;\n    #undef tile_sizze_50070\n    #undef bytes_53529\n}\n", NULL};
// Start of gpu_prototypes.h

// Constants used for transpositions.  In principle these should be configurable.
#define TR_BLOCK_DIM 16
#define TR_TILE_DIM (TR_BLOCK_DIM*2)
#define TR_ELEMS_PER_THREAD 8

// Config stuff included in every GPU backend.
struct gpu_config {
  size_t default_block_size;
  size_t default_grid_size;
  size_t default_tile_size;
  size_t default_reg_tile_size;
  size_t default_cache;
  size_t default_shared_memory;
  size_t default_registers;
  size_t default_threshold;

  int default_block_size_changed;
  int default_grid_size_changed;
  int default_tile_size_changed;
};

// The following are dummy sizes that mean the concrete defaults
// will be set during initialisation via hardware-inspection-based
// heuristics.
struct gpu_config gpu_config_initial = {
  0
};

// Must be defined by the user.
static int gpu_macros(struct futhark_context *ctx, char*** names, int64_t** values);

static void gpu_init_log(struct futhark_context *ctx);
struct builtin_kernels* init_builtin_kernels(struct futhark_context* ctx);
void free_builtin_kernels(struct futhark_context* ctx, struct builtin_kernels* kernels);
static int gpu_free_all(struct futhark_context *ctx);

// End of gpu_prototypes.h

// Start of backends/cuda.h.

// Forward declarations.
// Invoked by setup_opencl() after the platform and device has been
// found, but before the program is loaded.  Its intended use is to
// tune constants based on the selected platform and device.
static void set_tuning_params(struct futhark_context* ctx);
static char* get_failure_msg(int failure_idx, int64_t args[]);

#define CUDA_SUCCEED_FATAL(x) cuda_api_succeed_fatal(x, #x, __FILE__, __LINE__)
#define CUDA_SUCCEED_NONFATAL(x) cuda_api_succeed_nonfatal(x, #x, __FILE__, __LINE__)
#define NVRTC_SUCCEED_FATAL(x) nvrtc_api_succeed_fatal(x, #x, __FILE__, __LINE__)
#define NVRTC_SUCCEED_NONFATAL(x) nvrtc_api_succeed_nonfatal(x, #x, __FILE__, __LINE__)
// Take care not to override an existing error.
#define CUDA_SUCCEED_OR_RETURN(e) {             \
    char *serror = CUDA_SUCCEED_NONFATAL(e);    \
    if (serror) {                               \
      if (!ctx->error) {                        \
        ctx->error = serror;                    \
      } else {                                  \
        free(serror);                           \
      }                                         \
      return bad;                               \
    }                                           \
  }

// CUDA_SUCCEED_OR_RETURN returns the value of the variable 'bad' in
// scope.  By default, it will be this one.  Create a local variable
// of some other type if needed.  This is a bit of a hack, but it
// saves effort in the code generator.
static const int bad = 1;

static inline void cuda_api_succeed_fatal(CUresult res, const char *call,
                                          const char *file, int line) {
  if (res != CUDA_SUCCESS) {
    const char *err_str;
    cuGetErrorString(res, &err_str);
    if (err_str == NULL) { err_str = "Unknown"; }
    futhark_panic(-1, "%s:%d: CUDA call\n  %s\nfailed with error code %d (%s)\n",
                  file, line, call, res, err_str);
  }
}

static char* cuda_api_succeed_nonfatal(CUresult res, const char *call,
                                       const char *file, int line) {
  if (res != CUDA_SUCCESS) {
    const char *err_str;
    cuGetErrorString(res, &err_str);
    if (err_str == NULL) { err_str = "Unknown"; }
    return msgprintf("%s:%d: CUDA call\n  %s\nfailed with error code %d (%s)\n",
                     file, line, call, res, err_str);
  } else {
    return NULL;
  }
}

static inline void nvrtc_api_succeed_fatal(nvrtcResult res, const char *call,
                                           const char *file, int line) {
  if (res != NVRTC_SUCCESS) {
    const char *err_str = nvrtcGetErrorString(res);
    futhark_panic(-1, "%s:%d: NVRTC call\n  %s\nfailed with error code %d (%s)\n",
                  file, line, call, res, err_str);
  }
}

static char* nvrtc_api_succeed_nonfatal(nvrtcResult res, const char *call,
                                        const char *file, int line) {
  if (res != NVRTC_SUCCESS) {
    const char *err_str = nvrtcGetErrorString(res);
    return msgprintf("%s:%d: NVRTC call\n  %s\nfailed with error code %d (%s)\n",
                     file, line, call, res, err_str);
  } else {
    return NULL;
  }
}

struct futhark_context_config {
  int in_use;
  int debugging;
  int profiling;
  int logging;
  char* cache_fname;
  int num_tuning_params;
  int64_t *tuning_params;
  const char** tuning_param_names;
  const char** tuning_param_vars;
  const char** tuning_param_classes;
  // Uniform fields above.

  char* program;
  int num_nvrtc_opts;
  char* *nvrtc_opts;

  char* preferred_device;
  int preferred_device_num;

  int unified_memory;

  char* dump_ptx_to;
  char* load_ptx_from;

  struct gpu_config gpu;
};

static void backend_context_config_setup(struct futhark_context_config *cfg) {
  cfg->num_nvrtc_opts = 0;
  cfg->nvrtc_opts = (char**) malloc(sizeof(char*));
  cfg->nvrtc_opts[0] = NULL;

  cfg->program = strconcat(gpu_program);

  cfg->preferred_device_num = 0;
  cfg->preferred_device = strdup("");

  cfg->dump_ptx_to = NULL;
  cfg->load_ptx_from = NULL;

  cfg->unified_memory = 2;

  cfg->gpu = gpu_config_initial;
  cfg->gpu.default_block_size = 256;
  cfg->gpu.default_tile_size = 32;
  cfg->gpu.default_reg_tile_size = 2;
  cfg->gpu.default_threshold = 32*1024;
}

static void backend_context_config_teardown(struct futhark_context_config* cfg) {
  for (int i = 0; i < cfg->num_nvrtc_opts; i++) {
    free(cfg->nvrtc_opts[i]);
  }
  free(cfg->nvrtc_opts);
  free(cfg->dump_ptx_to);
  free(cfg->load_ptx_from);
  free(cfg->preferred_device);
  free(cfg->program);
}

void futhark_context_config_add_nvrtc_option(struct futhark_context_config *cfg, const char *opt) {
  cfg->nvrtc_opts[cfg->num_nvrtc_opts] = strdup(opt);
  cfg->num_nvrtc_opts++;
  cfg->nvrtc_opts = (char **) realloc(cfg->nvrtc_opts, (cfg->num_nvrtc_opts + 1) * sizeof(char *));
  cfg->nvrtc_opts[cfg->num_nvrtc_opts] = NULL;
}

void futhark_context_config_set_device(struct futhark_context_config *cfg, const char *s) {
  int x = 0;
  if (*s == '#') {
    s++;
    while (isdigit(*s)) {
      x = x * 10 + (*s++)-'0';
    }
    // Skip trailing spaces.
    while (isspace(*s)) {
      s++;
    }
  }
  free(cfg->preferred_device);
  cfg->preferred_device = strdup(s);
  cfg->preferred_device_num = x;
}

const char* futhark_context_config_get_program(struct futhark_context_config *cfg) {
  return cfg->program;
}

void futhark_context_config_set_program(struct futhark_context_config *cfg, const char *s) {
  free(cfg->program);
  cfg->program = strdup(s);
}

void futhark_context_config_dump_ptx_to(struct futhark_context_config *cfg, const char *path) {
  free(cfg->dump_ptx_to);
  cfg->dump_ptx_to = strdup(path);
}

void futhark_context_config_load_ptx_from(struct futhark_context_config *cfg, const char *path) {
  free(cfg->load_ptx_from);
  cfg->load_ptx_from = strdup(path);
}

void futhark_context_config_set_unified_memory(struct futhark_context_config* cfg, int flag) {
  cfg->unified_memory = flag;
}

// A record of something that happened.
struct profiling_record {
  cudaEvent_t *events; // Points to two events.
  const char *name;
};

struct futhark_context {
  struct futhark_context_config* cfg;
  int detail_memory;
  int debugging;
  int profiling;
  int profiling_paused;
  int logging;
  lock_t lock;
  char *error;
  lock_t error_lock;
  FILE *log;
  struct constants *constants;
  struct free_list free_list;
  struct event_list event_list;
  int64_t peak_mem_usage_default;
  int64_t cur_mem_usage_default;
  struct program* program;
  bool program_initialised;
  // Uniform fields above.

  CUdeviceptr global_failure;
  CUdeviceptr global_failure_args;
  struct tuning_params tuning_params;
  // True if a potentially failing kernel has been enqueued.
  int32_t failure_is_an_option;
  int total_runs;
  long int total_runtime;
  int64_t peak_mem_usage_device;
  int64_t cur_mem_usage_device;

  CUdevice dev;
  CUcontext cu_ctx;
  CUmodule module;
  CUstream stream;

  struct free_list gpu_free_list;

  size_t max_thread_block_size;
  size_t max_grid_size;
  size_t max_tile_size;
  size_t max_threshold;
  size_t max_shared_memory;
  size_t max_bespoke;
  size_t max_registers;
  size_t max_cache;

  size_t lockstep_width;

  struct builtin_kernels* kernels;
};

#define CU_DEV_ATTR(x) (CU_DEVICE_ATTRIBUTE_##x)
#define device_query(dev,attrib) _device_query(dev, CU_DEV_ATTR(attrib))
static int _device_query(CUdevice dev, CUdevice_attribute attrib) {
  int val;
  CUDA_SUCCEED_FATAL(cuDeviceGetAttribute(&val, attrib, dev));
  return val;
}

#define CU_FUN_ATTR(x) (CU_FUNC_ATTRIBUTE_##x)
#define function_query(fn,attrib) _function_query(dev, CU_FUN_ATTR(attrib))
static int _function_query(CUfunction dev, CUfunction_attribute attrib) {
  int val;
  CUDA_SUCCEED_FATAL(cuFuncGetAttribute(&val, attrib, dev));
  return val;
}

static int cuda_device_setup(struct futhark_context *ctx) {
  struct futhark_context_config *cfg = ctx->cfg;
  char name[256];
  int count, chosen = -1, best_cc = -1;
  int cc_major_best = 0, cc_minor_best = 0;
  int cc_major = 0, cc_minor = 0;
  CUdevice dev;

  CUDA_SUCCEED_FATAL(cuDeviceGetCount(&count));
  if (count == 0) { return 1; }

  int num_device_matches = 0;

  // XXX: Current device selection policy is to choose the device with the
  // highest compute capability (if no preferred device is set).
  // This should maybe be changed, since greater compute capability is not
  // necessarily an indicator of better performance.
  for (int i = 0; i < count; i++) {
    CUDA_SUCCEED_FATAL(cuDeviceGet(&dev, i));

    cc_major = device_query(dev, COMPUTE_CAPABILITY_MAJOR);
    cc_minor = device_query(dev, COMPUTE_CAPABILITY_MINOR);

    CUDA_SUCCEED_FATAL(cuDeviceGetName(name, sizeof(name) - 1, dev));
    name[sizeof(name) - 1] = 0;

    if (cfg->logging) {
      fprintf(ctx->log, "Device #%d: name=\"%s\", compute capability=%d.%d\n",
              i, name, cc_major, cc_minor);
    }

    if (device_query(dev, COMPUTE_MODE) == CU_COMPUTEMODE_PROHIBITED) {
      if (cfg->logging) {
        fprintf(ctx->log, "Device #%d is compute-prohibited, ignoring\n", i);
      }
      continue;
    }

    if (best_cc == -1 || cc_major > cc_major_best ||
        (cc_major == cc_major_best && cc_minor > cc_minor_best)) {
      best_cc = i;
      cc_major_best = cc_major;
      cc_minor_best = cc_minor;
    }

    if (strstr(name, cfg->preferred_device) != NULL &&
        num_device_matches++ == cfg->preferred_device_num) {
      chosen = i;
      break;
    }
  }

  if (chosen == -1) { chosen = best_cc; }
  if (chosen == -1) { return 1; }

  if (cfg->logging) {
    fprintf(ctx->log, "Using device #%d\n", chosen);
  }

  CUDA_SUCCEED_FATAL(cuDeviceGet(&ctx->dev, chosen));
  return 0;
}

static const char *cuda_nvrtc_get_arch(CUdevice dev) {
  static struct {
    int major;
    int minor;
    const char *arch_str;
  } const x[] = {
    { 3, 0, "compute_30" },
    { 3, 2, "compute_32" },
    { 3, 5, "compute_35" },
    { 3, 7, "compute_37" },
    { 5, 0, "compute_50" },
    { 5, 2, "compute_52" },
    { 5, 3, "compute_53" },
    { 6, 0, "compute_60" },
    { 6, 1, "compute_61" },
    { 6, 2, "compute_62" },
    { 7, 0, "compute_70" },
    { 7, 2, "compute_72" },
    { 7, 5, "compute_75" },
    { 8, 0, "compute_80" },
    { 8, 6, "compute_80" },
    { 8, 7, "compute_80" }
  };

  int major = device_query(dev, COMPUTE_CAPABILITY_MAJOR);
  int minor = device_query(dev, COMPUTE_CAPABILITY_MINOR);

  int chosen = -1;
  int num_archs = sizeof(x)/sizeof(x[0]);
  for (int i = 0; i < num_archs; i++) {
    if (x[i].major < major || (x[i].major == major && x[i].minor <= minor)) {
      chosen = i;
    } else {
      break;
    }
  }

  if (chosen == -1) {
    futhark_panic(-1, "Unsupported compute capability %d.%d\n", major, minor);
  }

  if (x[chosen].major != major || x[chosen].minor != minor) {
    fprintf(stderr,
            "Warning: device compute capability is %d.%d, but newest supported by Futhark is %d.%d.\n",
            major, minor, x[chosen].major, x[chosen].minor);
  }

  return x[chosen].arch_str;
}

static void cuda_nvrtc_mk_build_options(struct futhark_context *ctx, const char *extra_opts[],
                                        char*** opts_out, size_t *n_opts) {
  int arch_set = 0, num_extra_opts;
  struct futhark_context_config *cfg = ctx->cfg;

  char** macro_names;
  int64_t* macro_vals;
  int num_macros = gpu_macros(ctx, &macro_names, &macro_vals);

  // nvrtc cannot handle multiple -arch options.  Hence, if one of the
  // extra_opts is -arch, we have to be careful not to do our usual
  // automatic generation.
  for (num_extra_opts = 0; extra_opts[num_extra_opts] != NULL; num_extra_opts++) {
    if (strstr(extra_opts[num_extra_opts], "-arch")
        == extra_opts[num_extra_opts] ||
        strstr(extra_opts[num_extra_opts], "--gpu-architecture")
        == extra_opts[num_extra_opts]) {
      arch_set = 1;
    }
  }

  size_t i = 0, n_opts_alloc = 20 + num_macros + num_extra_opts + cfg->num_tuning_params;
  char **opts = (char**) malloc(n_opts_alloc * sizeof(char *));
  if (!arch_set) {
    opts[i++] = strdup("-arch");
    opts[i++] = strdup(cuda_nvrtc_get_arch(ctx->dev));
  }
  opts[i++] = strdup("-default-device");
  if (cfg->debugging) {
    opts[i++] = strdup("-G");
    opts[i++] = strdup("-lineinfo");
  } else {
    opts[i++] = strdup("--disable-warnings");
  }
  opts[i++] = msgprintf("-D%s=%d",
                        "max_thread_block_size",
                        (int)ctx->max_thread_block_size);
  opts[i++] = msgprintf("-D%s=%d",
                        "max_shared_memory",
                        (int)ctx->max_shared_memory);
  opts[i++] = msgprintf("-D%s=%d",
                        "max_registers",
                        (int)ctx->max_registers);

  for (int j = 0; j < num_macros; j++) {
    opts[i++] = msgprintf("-D%s=%zu", macro_names[j], macro_vals[j]);
  }

  for (int j = 0; j < cfg->num_tuning_params; j++) {
    opts[i++] = msgprintf("-D%s=%zu", cfg->tuning_param_vars[j],
                          cfg->tuning_params[j]);
  }
  opts[i++] = msgprintf("-DLOCKSTEP_WIDTH=%zu", ctx->lockstep_width);
  opts[i++] = msgprintf("-DMAX_THREADS_PER_BLOCK=%zu", ctx->max_thread_block_size);

  // Time for the best lines of the code in the entire compiler.
  if (getenv("CUDA_HOME") != NULL) {
    opts[i++] = msgprintf("-I%s/include", getenv("CUDA_HOME"));
  }
  if (getenv("CUDA_ROOT") != NULL) {
    opts[i++] = msgprintf("-I%s/include", getenv("CUDA_ROOT"));
  }
  if (getenv("CUDA_PATH") != NULL) {
    opts[i++] = msgprintf("-I%s/include", getenv("CUDA_PATH"));
  }
  opts[i++] = msgprintf("-I/usr/local/cuda/include");
  opts[i++] = msgprintf("-I/usr/include");

  for (int j = 0; extra_opts[j] != NULL; j++) {
    opts[i++] = strdup(extra_opts[j]);
  }

  opts[i++] = msgprintf("-DTR_BLOCK_DIM=%d", TR_BLOCK_DIM);
  opts[i++] = msgprintf("-DTR_TILE_DIM=%d", TR_TILE_DIM);
  opts[i++] = msgprintf("-DTR_ELEMS_PER_THREAD=%d", TR_ELEMS_PER_THREAD);

  free(macro_names);
  free(macro_vals);

  *n_opts = i;
  *opts_out = opts;
}

static char* cuda_nvrtc_build(const char *src, const char *opts[], size_t n_opts,
                              char **ptx) {
  nvrtcProgram prog;
  char *problem = NULL;

  problem = NVRTC_SUCCEED_NONFATAL(nvrtcCreateProgram(&prog, src, "futhark-cuda", 0, NULL, NULL));

  if (problem) {
    return problem;
  }

  nvrtcResult res = nvrtcCompileProgram(prog, n_opts, opts);
  if (res != NVRTC_SUCCESS) {
    size_t log_size;
    if (nvrtcGetProgramLogSize(prog, &log_size) == NVRTC_SUCCESS) {
      char *log = (char*) malloc(log_size);
      if (nvrtcGetProgramLog(prog, log) == NVRTC_SUCCESS) {
        problem = msgprintf("NVRTC compilation failed.\n\n%s\n", log);
      } else {
        problem = msgprintf("Could not retrieve compilation log\n");
      }
      free(log);
    }
    return problem;
  }

  size_t ptx_size;
  NVRTC_SUCCEED_FATAL(nvrtcGetPTXSize(prog, &ptx_size));
  *ptx = (char*) malloc(ptx_size);
  NVRTC_SUCCEED_FATAL(nvrtcGetPTX(prog, *ptx));

  NVRTC_SUCCEED_FATAL(nvrtcDestroyProgram(&prog));

  return NULL;
}

static void cuda_load_ptx_from_cache(struct futhark_context_config *cfg,
                                     const char *src,
                                     const char *opts[], size_t n_opts,
                                     struct cache_hash *h, const char *cache_fname,
                                     char **ptx) {
  if (cfg->logging) {
    fprintf(stderr, "Restoring cache from from %s...\n", cache_fname);
  }
  cache_hash_init(h);
  for (size_t i = 0; i < n_opts; i++) {
    cache_hash(h, opts[i], strlen(opts[i]));
  }
  cache_hash(h, src, strlen(src));
  size_t ptxsize;
  errno = 0;
  if (cache_restore(cache_fname, h, (unsigned char**)ptx, &ptxsize) != 0) {
    if (cfg->logging) {
      fprintf(stderr, "Failed to restore cache (errno: %s)\n", strerror(errno));
    }
  }
}

static void cuda_size_setup(struct futhark_context *ctx)
{
  struct futhark_context_config *cfg = ctx->cfg;
  if (cfg->gpu.default_block_size > ctx->max_thread_block_size) {
    if (cfg->gpu.default_block_size_changed) {
      fprintf(stderr,
              "Note: Device limits default block size to %zu (down from %zu).\n",
              ctx->max_thread_block_size, cfg->gpu.default_block_size);
    }
    cfg->gpu.default_block_size = ctx->max_thread_block_size;
  }
  if (cfg->gpu.default_grid_size > ctx->max_grid_size) {
    if (cfg->gpu.default_grid_size_changed) {
      fprintf(stderr,
              "Note: Device limits default grid size to %zu (down from %zu).\n",
              ctx->max_grid_size, cfg->gpu.default_grid_size);
    }
    cfg->gpu.default_grid_size = ctx->max_grid_size;
  }
  if (cfg->gpu.default_tile_size > ctx->max_tile_size) {
    if (cfg->gpu.default_tile_size_changed) {
      fprintf(stderr,
              "Note: Device limits default tile size to %zu (down from %zu).\n",
              ctx->max_tile_size, cfg->gpu.default_tile_size);
    }
    cfg->gpu.default_tile_size = ctx->max_tile_size;
  }

  if (!cfg->gpu.default_grid_size_changed) {
    cfg->gpu.default_grid_size =
      (device_query(ctx->dev, MULTIPROCESSOR_COUNT) *
       device_query(ctx->dev, MAX_THREADS_PER_MULTIPROCESSOR))
      / cfg->gpu.default_block_size;
  }

  for (int i = 0; i < cfg->num_tuning_params; i++) {
    const char *size_class = cfg->tuning_param_classes[i];
    int64_t *size_value = &cfg->tuning_params[i];
    const char* size_name = cfg->tuning_param_names[i];
    int64_t max_value = 0, default_value = 0;

    if (strstr(size_class, "thread_block_size") == size_class) {
      max_value = ctx->max_thread_block_size;
      default_value = cfg->gpu.default_block_size;
    } else if (strstr(size_class, "grid_size") == size_class) {
      max_value = ctx->max_grid_size;
      default_value = cfg->gpu.default_grid_size;
      // XXX: as a quick and dirty hack, use twice as many threads for
      // histograms by default.  We really should just be smarter
      // about sizes somehow.
      if (strstr(size_name, ".seghist_") != NULL) {
        default_value *= 2;
      }
    } else if (strstr(size_class, "tile_size") == size_class) {
      max_value = ctx->max_tile_size;
      default_value = cfg->gpu.default_tile_size;
    } else if (strstr(size_class, "reg_tile_size") == size_class) {
      max_value = 0; // No limit.
      default_value = cfg->gpu.default_reg_tile_size;
    } else if (strstr(size_class, "shared_memory") == size_class) {
      max_value = ctx->max_shared_memory;
      default_value = ctx->max_shared_memory;
    } else if (strstr(size_class, "cache") == size_class) {
      max_value = ctx->max_cache;
      default_value = ctx->max_cache;
    } else if (strstr(size_class, "threshold") == size_class) {
      // Threshold can be as large as it takes.
      default_value = cfg->gpu.default_threshold;
    } else {
      // Bespoke sizes have no limit or default.
    }

    if (*size_value == 0) {
      *size_value = default_value;
    } else if (max_value > 0 && *size_value > max_value) {
      fprintf(stderr, "Note: Device limits %s to %zu (down from %zu)\n",
              size_name, max_value, *size_value);
      *size_value = max_value;
    }
  }
}

static char* cuda_module_setup(struct futhark_context *ctx,
                               const char *src,
                               const char *extra_opts[],
                               const char* cache_fname) {
  char *ptx = NULL;
  struct futhark_context_config *cfg = ctx->cfg;

  if (cfg->load_ptx_from) {
    ptx = slurp_file(cfg->load_ptx_from, NULL);
  }

  char **opts;
  size_t n_opts;
  cuda_nvrtc_mk_build_options(ctx, extra_opts, &opts, &n_opts);

  if (cfg->logging) {
    fprintf(stderr, "NVRTC compile options:\n");
    for (size_t j = 0; j < n_opts; j++) {
      fprintf(stderr, "\t%s\n", opts[j]);
    }
    fprintf(stderr, "\n");
  }

  struct cache_hash h;
  int loaded_ptx_from_cache = 0;
  if (cache_fname != NULL) {
    cuda_load_ptx_from_cache(cfg, src, (const char**)opts, n_opts, &h, cache_fname, &ptx);

    if (ptx != NULL) {
      if (cfg->logging) {
        fprintf(stderr, "Restored PTX from cache; now loading module...\n");
      }
      if (cuModuleLoadData(&ctx->module, ptx) == CUDA_SUCCESS) {
        if (cfg->logging) {
          fprintf(stderr, "Success!\n");
        }
        loaded_ptx_from_cache = 1;
      } else {
        if (cfg->logging) {
          fprintf(stderr, "Failed!\n");
        }
        free(ptx);
        ptx = NULL;
      }
    }
  }

  if (ptx == NULL) {
    char* problem = cuda_nvrtc_build(src, (const char**)opts, n_opts, &ptx);
    if (problem != NULL) {
      return problem;
    }
  }

  if (cfg->dump_ptx_to != NULL) {
    dump_file(cfg->dump_ptx_to, ptx, strlen(ptx));
  }

  if (!loaded_ptx_from_cache) {
    CUDA_SUCCEED_FATAL(cuModuleLoadData(&ctx->module, ptx));
  }

  if (cache_fname != NULL && !loaded_ptx_from_cache) {
    if (cfg->logging) {
      fprintf(stderr, "Caching PTX in %s...\n", cache_fname);
    }
    errno = 0;
    if (cache_store(cache_fname, &h, (const unsigned char*)ptx, strlen(ptx)) != 0) {
      fprintf(stderr, "Failed to cache PTX: %s\n", strerror(errno));
    }
  }

  for (size_t i = 0; i < n_opts; i++) {
    free((char *)opts[i]);
  }
  free(opts);
  free(ptx);

  return NULL;
}

struct cuda_event {
  cudaEvent_t start;
  cudaEvent_t end;
};

static struct cuda_event* cuda_event_new(struct futhark_context* ctx) {
  if (ctx->profiling && !ctx->profiling_paused) {
    struct cuda_event* e = malloc(sizeof(struct cuda_event));
    cudaEventCreate(&e->start);
    cudaEventCreate(&e->end);
    return e;
  } else {
    return NULL;
  }
}

static int cuda_event_report(struct str_builder* sb, struct cuda_event* e) {
  float ms;
  CUresult err;
  if ((err = cuEventElapsedTime(&ms, e->start, e->end)) != CUDA_SUCCESS) {
    return err;
  }

  // CUDA provides milisecond resolution, but we want microseconds.
  str_builder(sb, ",\"duration\":%f", ms*1000);

  if ((err = cuEventDestroy(e->start)) != CUDA_SUCCESS) {
    return 1;
  }

  if ((err = cuEventDestroy(e->end)) != CUDA_SUCCESS) {
    return 1;
  }

  free(e);

  return 0;
}

int futhark_context_sync(struct futhark_context* ctx) {
  CUDA_SUCCEED_OR_RETURN(cuCtxPushCurrent(ctx->cu_ctx));
  CUDA_SUCCEED_OR_RETURN(cuCtxSynchronize());
  if (ctx->failure_is_an_option) {
    // Check for any delayed error.
    int32_t failure_idx;
    CUDA_SUCCEED_OR_RETURN(
                           cuMemcpyDtoH(&failure_idx,
                                        ctx->global_failure,
                                        sizeof(int32_t)));
    ctx->failure_is_an_option = 0;

    if (failure_idx >= 0) {
      // We have to clear global_failure so that the next entry point
      // is not considered a failure from the start.
      int32_t no_failure = -1;
      CUDA_SUCCEED_OR_RETURN(
                             cuMemcpyHtoD(ctx->global_failure,
                                          &no_failure,
                                          sizeof(int32_t)));

      int64_t args[max_failure_args+1];
      CUDA_SUCCEED_OR_RETURN(
                             cuMemcpyDtoH(&args,
                                          ctx->global_failure_args,
                                          sizeof(args)));

      ctx->error = get_failure_msg(failure_idx, args);

      return FUTHARK_PROGRAM_ERROR;
    }
  }

  CUDA_SUCCEED_OR_RETURN(cuCtxPopCurrent(&ctx->cu_ctx));
  return 0;
}

struct builtin_kernels* init_builtin_kernels(struct futhark_context* ctx);
void free_builtin_kernels(struct futhark_context* ctx, struct builtin_kernels* kernels);

int backend_context_setup(struct futhark_context* ctx) {
  ctx->failure_is_an_option = 0;
  ctx->total_runs = 0;
  ctx->total_runtime = 0;
  ctx->peak_mem_usage_device = 0;
  ctx->cur_mem_usage_device = 0;
  ctx->kernels = NULL;

  CUDA_SUCCEED_FATAL(cuInit(0));
  if (cuda_device_setup(ctx) != 0) {
    futhark_panic(-1, "No suitable CUDA device found.\n");
  }
  CUDA_SUCCEED_FATAL(cuCtxCreate(&ctx->cu_ctx, 0, ctx->dev));

  free_list_init(&ctx->gpu_free_list);

  if (ctx->cfg->unified_memory == 2) {
    ctx->cfg->unified_memory = device_query(ctx->dev, MANAGED_MEMORY);
  }

  if (ctx->cfg->logging) {
    if (ctx->cfg->unified_memory) {
      fprintf(ctx->log, "Using managed memory\n");
    } else {
      fprintf(ctx->log, "Using unmanaged memory\n");
    }
  }

  ctx->max_thread_block_size = device_query(ctx->dev, MAX_THREADS_PER_BLOCK);
  ctx->max_grid_size = device_query(ctx->dev, MAX_GRID_DIM_X);
  ctx->max_tile_size = sqrt(ctx->max_thread_block_size);
  ctx->max_threshold = 1U<<31; // No limit.
  ctx->max_bespoke = 1U<<31; // No limit.

  if (ctx->cfg->gpu.default_registers != 0) {
    ctx->max_registers = ctx->cfg->gpu.default_registers;
  } else {
    ctx->max_registers = device_query(ctx->dev, MAX_REGISTERS_PER_BLOCK);
  }

  if (ctx->cfg->gpu.default_shared_memory != 0) {
    ctx->max_shared_memory = ctx->cfg->gpu.default_shared_memory;
  } else {
    // MAX_SHARED_MEMORY_PER_BLOCK gives bogus numbers (48KiB); probably
    // for backwards compatibility.  Add _OPTIN and you seem to get the
    // right number.
    ctx->max_shared_memory = device_query(ctx->dev, MAX_SHARED_MEMORY_PER_BLOCK_OPTIN);
#if CUDART_VERSION >= 12000
    ctx->max_shared_memory -= device_query(ctx->dev, RESERVED_SHARED_MEMORY_PER_BLOCK);
#endif
  }

  if (ctx->cfg->gpu.default_cache != 0) {
    ctx->max_cache = ctx->cfg->gpu.default_cache;
  } else {
    ctx->max_cache = device_query(ctx->dev, L2_CACHE_SIZE);
  }

  ctx->lockstep_width = device_query(ctx->dev, WARP_SIZE);
  CUDA_SUCCEED_FATAL(cuStreamCreate(&ctx->stream, CU_STREAM_DEFAULT));
  cuda_size_setup(ctx);

  gpu_init_log(ctx);

  ctx->error = cuda_module_setup(ctx,
                                 ctx->cfg->program,
                                 (const char**)ctx->cfg->nvrtc_opts,
                                 ctx->cfg->cache_fname);

  if (ctx->error != NULL) {
    futhark_panic(1, "During CUDA initialisation:\n%s\n", ctx->error);
  }

  int32_t no_error = -1;
  CUDA_SUCCEED_FATAL(cuMemAlloc(&ctx->global_failure, sizeof(no_error)));
  CUDA_SUCCEED_FATAL(cuMemcpyHtoD(ctx->global_failure, &no_error, sizeof(no_error)));
  // The +1 is to avoid zero-byte allocations.
  CUDA_SUCCEED_FATAL(cuMemAlloc(&ctx->global_failure_args, sizeof(int64_t)*(max_failure_args+1)));

  if ((ctx->kernels = init_builtin_kernels(ctx)) == NULL) {
    return 1;
  }

  return 0;
}

void backend_context_teardown(struct futhark_context* ctx) {
  if (ctx->kernels != NULL) {
    free_builtin_kernels(ctx, ctx->kernels);
    cuMemFree(ctx->global_failure);
    cuMemFree(ctx->global_failure_args);
    CUDA_SUCCEED_FATAL(gpu_free_all(ctx));
    CUDA_SUCCEED_FATAL(cuStreamDestroy(ctx->stream));
    CUDA_SUCCEED_FATAL(cuModuleUnload(ctx->module));
    CUDA_SUCCEED_FATAL(cuCtxDestroy(ctx->cu_ctx));
  }
  free_list_destroy(&ctx->gpu_free_list);
}

// GPU ABSTRACTION LAYER

// Types.

typedef CUfunction gpu_kernel;
typedef CUdeviceptr gpu_mem;

static void gpu_create_kernel(struct futhark_context *ctx,
                              gpu_kernel* kernel,
                              const char* name) {
  if (ctx->debugging) {
    fprintf(ctx->log, "Creating kernel %s.\n", name);
  }
  CUDA_SUCCEED_FATAL(cuModuleGetFunction(kernel, ctx->module, name));
  // Unless the below is set, the kernel is limited to 48KiB of memory.
  CUDA_SUCCEED_FATAL(cuFuncSetAttribute(*kernel,
                                        cudaFuncAttributeMaxDynamicSharedMemorySize,
                                        ctx->max_shared_memory));
}

static void gpu_free_kernel(struct futhark_context *ctx,
                            gpu_kernel kernel) {
  (void)ctx;
  (void)kernel;
}

static int gpu_scalar_to_device(struct futhark_context* ctx,
                                gpu_mem dst, size_t offset, size_t size,
                                void *src) {
  struct cuda_event *event = cuda_event_new(ctx);
  if (event != NULL) {
    add_event(ctx,
              "copy_scalar_to_dev",
              strdup(""),
              event,
              (event_report_fn)cuda_event_report);
    CUDA_SUCCEED_FATAL(cuEventRecord(event->start, ctx->stream));
  }
  CUDA_SUCCEED_OR_RETURN(cuMemcpyHtoD(dst + offset, src, size));
  if (event != NULL) {
    CUDA_SUCCEED_FATAL(cuEventRecord(event->end, ctx->stream));
  }
  return FUTHARK_SUCCESS;
}

static int gpu_scalar_from_device(struct futhark_context* ctx,
                                  void *dst,
                                  gpu_mem src, size_t offset, size_t size) {
  struct cuda_event *event = cuda_event_new(ctx);
  if (event != NULL) {
    add_event(ctx,
              "copy_scalar_from_dev",
              strdup(""),
              event,
              (event_report_fn)cuda_event_report);
    CUDA_SUCCEED_FATAL(cuEventRecord(event->start, ctx->stream));
  }
  CUDA_SUCCEED_OR_RETURN(cuMemcpyDtoH(dst, src + offset, size));
  if (event != NULL) {
    CUDA_SUCCEED_FATAL(cuEventRecord(event->end, ctx->stream));
  }
  return FUTHARK_SUCCESS;
}

static int gpu_memcpy(struct futhark_context* ctx,
                      gpu_mem dst, int64_t dst_offset,
                      gpu_mem src, int64_t src_offset,
                      int64_t nbytes) {
  struct cuda_event *event = cuda_event_new(ctx);
  if (event != NULL) {
    add_event(ctx,
              "copy_dev_to_dev",
              strdup(""),
              event,
              (event_report_fn)cuda_event_report);
    CUDA_SUCCEED_FATAL(cuEventRecord(event->start, ctx->stream));
  }
  CUDA_SUCCEED_OR_RETURN(cuMemcpyAsync(dst+dst_offset, src+src_offset, nbytes, ctx->stream));
  if (event != NULL) {
    CUDA_SUCCEED_FATAL(cuEventRecord(event->end, ctx->stream));
  }
  return FUTHARK_SUCCESS;
}

static int memcpy_host2gpu(struct futhark_context* ctx, bool sync,
                           gpu_mem dst, int64_t dst_offset,
                           const unsigned char* src, int64_t src_offset,
                           int64_t nbytes) {
  if (nbytes > 0) {
    struct cuda_event *event = cuda_event_new(ctx);
    if (event != NULL) {
      add_event(ctx,
                "copy_host_to_dev",
                strdup(""),
                event,
                (event_report_fn)cuda_event_report);
      CUDA_SUCCEED_FATAL(cuEventRecord(event->start, ctx->stream));
    }
    if (sync) {
      CUDA_SUCCEED_OR_RETURN
        (cuMemcpyHtoD(dst + dst_offset, src + src_offset, nbytes));
    } else {
      CUDA_SUCCEED_OR_RETURN
        (cuMemcpyHtoDAsync(dst + dst_offset, src + src_offset, nbytes, ctx->stream));
    }
    if (event != NULL) {
      CUDA_SUCCEED_FATAL(cuEventRecord(event->end, ctx->stream));
    }
  }
  return FUTHARK_SUCCESS;
}

static int memcpy_gpu2host(struct futhark_context* ctx, bool sync,
                           unsigned char* dst, int64_t dst_offset,
                           gpu_mem src, int64_t src_offset,
                           int64_t nbytes) {
  if (nbytes > 0) {
    struct cuda_event *event = cuda_event_new(ctx);
    if (event != NULL) {
      add_event(ctx,
                "copy_dev_to_host",
                strdup(""),
                event,
                (event_report_fn)cuda_event_report);
      CUDA_SUCCEED_FATAL(cuEventRecord(event->start, ctx->stream));
    }
    if (sync) {
      CUDA_SUCCEED_OR_RETURN
        (cuMemcpyDtoH(dst + dst_offset, src + src_offset, nbytes));
    } else {
      CUDA_SUCCEED_OR_RETURN
        (cuMemcpyDtoHAsync(dst + dst_offset, src + src_offset, nbytes, ctx->stream));
    }
    if (event != NULL) {
      CUDA_SUCCEED_FATAL(cuEventRecord(event->end, ctx->stream));
    }
    if (sync &&
        ctx->failure_is_an_option &&
        futhark_context_sync(ctx) != 0) {
      return 1;
    }
  }
  return FUTHARK_SUCCESS;
}

static int gpu_launch_kernel(struct futhark_context* ctx,
                             gpu_kernel kernel, const char *name,
                             const int32_t grid[3],
                             const int32_t block[3],
                             unsigned int shared_mem_bytes,
                             int num_args,
                             void* args[num_args],
                             size_t args_sizes[num_args]) {
  (void) args_sizes;

  if (shared_mem_bytes > ctx->max_shared_memory) {
    set_error(ctx, msgprintf("Kernel %s with %d bytes of memory exceeds device limit of %d\n",
                             name, shared_mem_bytes, (int)ctx->max_shared_memory));
    return 1;
  }

  int64_t time_start = 0, time_end = 0;
  if (ctx->debugging) {
    time_start = get_wall_time();
  }

  struct cuda_event *event = cuda_event_new(ctx);

  if (event != NULL) {
    CUDA_SUCCEED_FATAL(cuEventRecord(event->start, ctx->stream));
    add_event(ctx,
              name,
              msgprintf("Kernel %s with\n"
                        "  grid=(%d,%d,%d)\n"
                        "  block=(%d,%d,%d)\n"
                        "  shared memory=%d",
                        name,
                        grid[0], grid[1], grid[2],
                        block[0], block[1], block[2],
                        shared_mem_bytes),
              event,
              (event_report_fn)cuda_event_report);
  }

  CUDA_SUCCEED_OR_RETURN
    (cuLaunchKernel(kernel,
                    grid[0], grid[1], grid[2],
                    block[0], block[1], block[2],
                    shared_mem_bytes, ctx->stream,
                    args, NULL));

  if (event != NULL) {
    CUDA_SUCCEED_FATAL(cuEventRecord(event->end, ctx->stream));
  }

  if (ctx->debugging) {
    CUDA_SUCCEED_FATAL(cuCtxSynchronize());
    time_end = get_wall_time();
    long int time_diff = time_end - time_start;
    fprintf(ctx->log, "  runtime: %ldus\n", time_diff);
  }
  if (ctx->logging) {
    fprintf(ctx->log, "\n");
  }

  return FUTHARK_SUCCESS;
}

static int gpu_alloc_actual(struct futhark_context *ctx, size_t size, gpu_mem *mem_out) {
  CUresult res;
  if (ctx->cfg->unified_memory) {
    res = cuMemAllocManaged(mem_out, size, CU_MEM_ATTACH_GLOBAL);
  } else {
    res = cuMemAlloc(mem_out, size);
  }

  if (res == CUDA_ERROR_OUT_OF_MEMORY) {
    return FUTHARK_OUT_OF_MEMORY;
  }

  CUDA_SUCCEED_OR_RETURN(res);
  return FUTHARK_SUCCESS;
}

static int gpu_free_actual(struct futhark_context *ctx, gpu_mem mem) {
  (void)ctx;
  CUDA_SUCCEED_OR_RETURN(cuMemFree(mem));
  return FUTHARK_SUCCESS;
}

// End of backends/cuda.h.

// Start of gpu.h

// Generic functions that use our tiny GPU abstraction layer.  The
// entire context must be defined before this header is included.  In
// particular we expect the following functions to be available:

static int gpu_free_actual(struct futhark_context *ctx, gpu_mem mem);
static int gpu_alloc_actual(struct futhark_context *ctx, size_t size, gpu_mem *mem_out);
int gpu_launch_kernel(struct futhark_context* ctx,
                      gpu_kernel kernel, const char *name,
                      const int32_t grid[3],
                      const int32_t block[3],
                      unsigned int shared_mem_bytes,
                      int num_args,
                      void* args[num_args],
                      size_t args_sizes[num_args]);
int gpu_memcpy(struct futhark_context* ctx,
               gpu_mem dst, int64_t dst_offset,
               gpu_mem src, int64_t src_offset,
               int64_t nbytes);
int gpu_scalar_from_device(struct futhark_context* ctx,
                           void *dst,
                           gpu_mem src, size_t offset, size_t size);
int gpu_scalar_to_device(struct futhark_context* ctx,
                         gpu_mem dst, size_t offset, size_t size,
                         void *src);
void gpu_create_kernel(struct futhark_context *ctx,
                       gpu_kernel* kernel,
                       const char* name);

static void gpu_init_log(struct futhark_context *ctx) {
  if (ctx->cfg->logging) {
    fprintf(ctx->log, "Default block size: %ld\n", (long)ctx->cfg->gpu.default_block_size);
    fprintf(ctx->log, "Default grid size: %ld\n", (long)ctx->cfg->gpu.default_grid_size);
    fprintf(ctx->log, "Default tile size: %ld\n", (long)ctx->cfg->gpu.default_tile_size);
    fprintf(ctx->log, "Default register tile size: %ld\n", (long)ctx->cfg->gpu.default_reg_tile_size);
    fprintf(ctx->log, "Default cache: %ld\n", (long)ctx->cfg->gpu.default_cache);
    fprintf(ctx->log, "Default registers: %ld\n", (long)ctx->cfg->gpu.default_registers);
    fprintf(ctx->log, "Default threshold: %ld\n", (long)ctx->cfg->gpu.default_threshold);
    fprintf(ctx->log, "Max thread block size: %ld\n", (long)ctx->max_thread_block_size);
    fprintf(ctx->log, "Max grid size: %ld\n", (long)ctx->max_grid_size);
    fprintf(ctx->log, "Max tile size: %ld\n", (long)ctx->max_tile_size);
    fprintf(ctx->log, "Max threshold: %ld\n", (long)ctx->max_threshold);
    fprintf(ctx->log, "Max shared memory: %ld\n", (long)ctx->max_shared_memory);
    fprintf(ctx->log, "Max registers: %ld\n", (long)ctx->max_registers);
    fprintf(ctx->log, "Max cache: %ld\n", (long)ctx->max_cache);
    fprintf(ctx->log, "Lockstep width: %ld\n", (long)ctx->lockstep_width);
  }
}

// Generic GPU command line options.

void futhark_context_config_set_default_thread_block_size(struct futhark_context_config *cfg, int size) {
  cfg->gpu.default_block_size = size;
  cfg->gpu.default_block_size_changed = 1;
}

void futhark_context_config_set_default_group_size(struct futhark_context_config *cfg, int size) {
  futhark_context_config_set_default_thread_block_size(cfg, size);
}

void futhark_context_config_set_default_grid_size(struct futhark_context_config *cfg, int num) {
  cfg->gpu.default_grid_size = num;
  cfg->gpu.default_grid_size_changed = 1;
}

void futhark_context_config_set_default_num_groups(struct futhark_context_config *cfg, int num) {
  futhark_context_config_set_default_grid_size(cfg, num);
}

void futhark_context_config_set_default_tile_size(struct futhark_context_config *cfg, int size) {
  cfg->gpu.default_tile_size = size;
  cfg->gpu.default_tile_size_changed = 1;
}

void futhark_context_config_set_default_reg_tile_size(struct futhark_context_config *cfg, int size) {
  cfg->gpu.default_reg_tile_size = size;
}

void futhark_context_config_set_default_cache(struct futhark_context_config *cfg, int size) {
  cfg->gpu.default_cache = size;
}

void futhark_context_config_set_default_registers(struct futhark_context_config *cfg, int size) {
  cfg->gpu.default_registers = size;
}

void futhark_context_config_set_default_threshold(struct futhark_context_config *cfg, int size) {
  cfg->gpu.default_threshold = size;
}

int futhark_context_config_set_tuning_param(struct futhark_context_config *cfg,
                                            const char *param_name,
                                            size_t new_value) {
  for (int i = 0; i < cfg->num_tuning_params; i++) {
    if (strcmp(param_name, cfg->tuning_param_names[i]) == 0) {
      cfg->tuning_params[i] = new_value;
      return 0;
    }
  }
  if (strcmp(param_name, "default_thread_block_size") == 0 ||
      strcmp(param_name, "default_group_size") == 0) {
    cfg->gpu.default_block_size = new_value;
    return 0;
  }
  if (strcmp(param_name, "default_grid_size") == 0 ||
      strcmp(param_name, "default_num_groups") == 0) {
    cfg->gpu.default_grid_size = new_value;
    return 0;
  }
  if (strcmp(param_name, "default_threshold") == 0) {
    cfg->gpu.default_threshold = new_value;
    return 0;
  }
  if (strcmp(param_name, "default_tile_size") == 0) {
    cfg->gpu.default_tile_size = new_value;
    return 0;
  }
  if (strcmp(param_name, "default_reg_tile_size") == 0) {
    cfg->gpu.default_reg_tile_size = new_value;
    return 0;
  }
  if (strcmp(param_name, "default_cache") == 0) {
    cfg->gpu.default_cache = new_value;
    return 0;
  }
  if (strcmp(param_name, "default_shared_memory") == 0) {
    cfg->gpu.default_shared_memory = new_value;
    return 0;
  }

  return 1;
}

// End of GPU command line optiopns.

// Max number of thead blocks we allow along the second or third
// dimension for transpositions.
#define MAX_TR_THREAD_BLOCKS 65535

struct builtin_kernels {
  // We have a lot of ways to transpose arrays.
  gpu_kernel map_transpose_1b;
  gpu_kernel map_transpose_1b_low_height;
  gpu_kernel map_transpose_1b_low_width;
  gpu_kernel map_transpose_1b_small;
  gpu_kernel map_transpose_1b_large;
  gpu_kernel map_transpose_2b;
  gpu_kernel map_transpose_2b_low_height;
  gpu_kernel map_transpose_2b_low_width;
  gpu_kernel map_transpose_2b_small;
  gpu_kernel map_transpose_2b_large;
  gpu_kernel map_transpose_4b;
  gpu_kernel map_transpose_4b_low_height;
  gpu_kernel map_transpose_4b_low_width;
  gpu_kernel map_transpose_4b_small;
  gpu_kernel map_transpose_4b_large;
  gpu_kernel map_transpose_8b;
  gpu_kernel map_transpose_8b_low_height;
  gpu_kernel map_transpose_8b_low_width;
  gpu_kernel map_transpose_8b_small;
  gpu_kernel map_transpose_8b_large;

  // And a few ways of copying.
  gpu_kernel lmad_copy_1b;
  gpu_kernel lmad_copy_2b;
  gpu_kernel lmad_copy_4b;
  gpu_kernel lmad_copy_8b;
};

struct builtin_kernels* init_builtin_kernels(struct futhark_context* ctx) {
  struct builtin_kernels *kernels = malloc(sizeof(struct builtin_kernels));
  gpu_create_kernel(ctx, &kernels->map_transpose_1b, "map_transpose_1b");
  gpu_create_kernel(ctx, &kernels->map_transpose_1b_large, "map_transpose_1b_large");
  gpu_create_kernel(ctx, &kernels->map_transpose_1b_low_height, "map_transpose_1b_low_height");
  gpu_create_kernel(ctx, &kernels->map_transpose_1b_low_width, "map_transpose_1b_low_width");
  gpu_create_kernel(ctx, &kernels->map_transpose_1b_small, "map_transpose_1b_small");

  gpu_create_kernel(ctx, &kernels->map_transpose_2b, "map_transpose_2b");
  gpu_create_kernel(ctx, &kernels->map_transpose_2b_large, "map_transpose_2b_large");
  gpu_create_kernel(ctx, &kernels->map_transpose_2b_low_height, "map_transpose_2b_low_height");
  gpu_create_kernel(ctx, &kernels->map_transpose_2b_low_width, "map_transpose_2b_low_width");
  gpu_create_kernel(ctx, &kernels->map_transpose_2b_small, "map_transpose_2b_small");

  gpu_create_kernel(ctx, &kernels->map_transpose_4b, "map_transpose_4b");
  gpu_create_kernel(ctx, &kernels->map_transpose_4b_large, "map_transpose_4b_large");
  gpu_create_kernel(ctx, &kernels->map_transpose_4b_low_height, "map_transpose_4b_low_height");
  gpu_create_kernel(ctx, &kernels->map_transpose_4b_low_width, "map_transpose_4b_low_width");
  gpu_create_kernel(ctx, &kernels->map_transpose_4b_small, "map_transpose_4b_small");

  gpu_create_kernel(ctx, &kernels->map_transpose_8b, "map_transpose_8b");
  gpu_create_kernel(ctx, &kernels->map_transpose_8b_large, "map_transpose_8b_large");
  gpu_create_kernel(ctx, &kernels->map_transpose_8b_low_height, "map_transpose_8b_low_height");
  gpu_create_kernel(ctx, &kernels->map_transpose_8b_low_width, "map_transpose_8b_low_width");
  gpu_create_kernel(ctx, &kernels->map_transpose_8b_small, "map_transpose_8b_small");

  gpu_create_kernel(ctx, &kernels->lmad_copy_1b, "lmad_copy_1b");
  gpu_create_kernel(ctx, &kernels->lmad_copy_2b, "lmad_copy_2b");
  gpu_create_kernel(ctx, &kernels->lmad_copy_4b, "lmad_copy_4b");
  gpu_create_kernel(ctx, &kernels->lmad_copy_8b, "lmad_copy_8b");

  return kernels;
}

void free_builtin_kernels(struct futhark_context* ctx, struct builtin_kernels* kernels) {
  gpu_free_kernel(ctx, kernels->map_transpose_1b);
  gpu_free_kernel(ctx, kernels->map_transpose_1b_large);
  gpu_free_kernel(ctx, kernels->map_transpose_1b_low_height);
  gpu_free_kernel(ctx, kernels->map_transpose_1b_low_width);
  gpu_free_kernel(ctx, kernels->map_transpose_1b_small);

  gpu_free_kernel(ctx, kernels->map_transpose_2b);
  gpu_free_kernel(ctx, kernels->map_transpose_2b_large);
  gpu_free_kernel(ctx, kernels->map_transpose_2b_low_height);
  gpu_free_kernel(ctx, kernels->map_transpose_2b_low_width);
  gpu_free_kernel(ctx, kernels->map_transpose_2b_small);

  gpu_free_kernel(ctx, kernels->map_transpose_4b);
  gpu_free_kernel(ctx, kernels->map_transpose_4b_large);
  gpu_free_kernel(ctx, kernels->map_transpose_4b_low_height);
  gpu_free_kernel(ctx, kernels->map_transpose_4b_low_width);
  gpu_free_kernel(ctx, kernels->map_transpose_4b_small);

  gpu_free_kernel(ctx, kernels->map_transpose_8b);
  gpu_free_kernel(ctx, kernels->map_transpose_8b_large);
  gpu_free_kernel(ctx, kernels->map_transpose_8b_low_height);
  gpu_free_kernel(ctx, kernels->map_transpose_8b_low_width);
  gpu_free_kernel(ctx, kernels->map_transpose_8b_small);

  gpu_free_kernel(ctx, kernels->lmad_copy_1b);
  gpu_free_kernel(ctx, kernels->lmad_copy_2b);
  gpu_free_kernel(ctx, kernels->lmad_copy_4b);
  gpu_free_kernel(ctx, kernels->lmad_copy_8b);

  free(kernels);
}

static int gpu_alloc(struct futhark_context *ctx, FILE *log,
                     size_t min_size, const char *tag,
                     gpu_mem *mem_out, size_t *size_out) {
  if (min_size < sizeof(int)) {
    min_size = sizeof(int);
  }

  gpu_mem* memptr;
  if (free_list_find(&ctx->gpu_free_list, min_size, tag, size_out, (fl_mem*)&memptr) == 0) {
    // Successfully found a free block.  Is it big enough?
    if (*size_out >= min_size) {
      if (ctx->cfg->debugging) {
        fprintf(log, "No need to allocate: Found a block in the free list.\n");
      }
      *mem_out = *memptr;
      free(memptr);
      return FUTHARK_SUCCESS;
    } else {
      if (ctx->cfg->debugging) {
        fprintf(log, "Found a free block, but it was too small.\n");
      }
      int error = gpu_free_actual(ctx, *memptr);
      free(memptr);
      if (error != FUTHARK_SUCCESS) {
        return error;
      }
    }
  }

  *size_out = min_size;

  // We have to allocate a new block from the driver.  If the
  // allocation does not succeed, then we might be in an out-of-memory
  // situation.  We now start freeing things from the free list until
  // we think we have freed enough that the allocation will succeed.
  // Since we don't know how far the allocation is from fitting, we
  // have to check after every deallocation.  This might be pretty
  // expensive.  Let's hope that this case is hit rarely.

  if (ctx->cfg->debugging) {
    fprintf(log, "Actually allocating the desired block.\n");
  }

  int error = gpu_alloc_actual(ctx, min_size, mem_out);

  while (error == FUTHARK_OUT_OF_MEMORY) {
    if (ctx->cfg->debugging) {
      fprintf(log, "Out of GPU memory: releasing entry from the free list...\n");
    }
    gpu_mem* memptr;
    if (free_list_first(&ctx->gpu_free_list, (fl_mem*)&memptr) == 0) {
      gpu_mem mem = *memptr;
      free(memptr);
      error = gpu_free_actual(ctx, mem);
      if (error != FUTHARK_SUCCESS) {
        return error;
      }
    } else {
      break;
    }
    error = gpu_alloc_actual(ctx, min_size, mem_out);
  }

  return error;
}

static int gpu_free(struct futhark_context *ctx,
                    gpu_mem mem, size_t size, const char *tag) {
  gpu_mem* memptr = malloc(sizeof(gpu_mem));
  *memptr = mem;
  free_list_insert(&ctx->gpu_free_list, size, (fl_mem)memptr, tag);
  return FUTHARK_SUCCESS;
}

static int gpu_free_all(struct futhark_context *ctx) {
  free_list_pack(&ctx->gpu_free_list);
  gpu_mem* memptr;
  while (free_list_first(&ctx->gpu_free_list, (fl_mem*)&memptr) == 0) {
    gpu_mem mem = *memptr;
    free(memptr);
    int error = gpu_free_actual(ctx, mem);
    if (error != FUTHARK_SUCCESS) {
      return error;
    }
  }

  return FUTHARK_SUCCESS;
}

static int gpu_map_transpose(struct futhark_context* ctx,
                             gpu_kernel kernel_default,
                             gpu_kernel kernel_low_height,
                             gpu_kernel kernel_low_width,
                             gpu_kernel kernel_small,
                             gpu_kernel kernel_large,
                             const char *name, size_t elem_size,
                             gpu_mem dst, int64_t dst_offset,
                             gpu_mem src, int64_t src_offset,
                             int64_t k, int64_t n, int64_t m) {
  int64_t mulx = TR_BLOCK_DIM / n;
  int64_t muly = TR_BLOCK_DIM / m;
  int32_t mulx32 = mulx;
  int32_t muly32 = muly;
  int32_t k32 = k;
  int32_t n32 = n;
  int32_t m32 = m;

  gpu_kernel kernel = kernel_default;
  int32_t grid[3];
  int32_t block[3];

  void* args[11];
  size_t args_sizes[11] = {
    sizeof(gpu_mem), sizeof(int64_t),
    sizeof(gpu_mem), sizeof(int64_t),
    sizeof(int32_t),
    sizeof(int32_t),
    sizeof(int32_t),
    sizeof(int32_t),
    sizeof(int32_t)
  };

  args[0] = &dst;
  args[1] = &dst_offset;
  args[2] = &src;
  args[3] = &src_offset;
  args[7] = &mulx;
  args[8] = &muly;

  if (dst_offset + k * n * m <= 2147483647L &&
      src_offset + k * n * m <= 2147483647L) {
    if (m <= TR_BLOCK_DIM/2 && n <= TR_BLOCK_DIM/2) {
      if (ctx->logging) { fprintf(ctx->log, "Using small kernel\n"); }
      kernel = kernel_small;
      grid[0] = ((k * n * m) + (TR_BLOCK_DIM*TR_BLOCK_DIM) - 1) / (TR_BLOCK_DIM*TR_BLOCK_DIM);
      grid[1] = 1;
      grid[2] = 1;
      block[0] = TR_BLOCK_DIM*TR_BLOCK_DIM;
      block[1] = 1;
      block[2] = 1;
    } else if (m <= TR_BLOCK_DIM/2 && TR_BLOCK_DIM < n) {
      if (ctx->logging) { fprintf(ctx->log, "Using low-width kernel\n"); }
      kernel = kernel_low_width;
      int64_t x_elems = m;
      int64_t y_elems = (n + muly - 1) / muly;
      grid[0] = (x_elems + TR_BLOCK_DIM - 1) / TR_BLOCK_DIM;
      grid[1] = (y_elems + TR_BLOCK_DIM - 1) / TR_BLOCK_DIM;
      grid[2] = k;
      block[0] = TR_BLOCK_DIM;
      block[1] = TR_BLOCK_DIM;
      block[2] = 1;
    } else if (n <= TR_BLOCK_DIM/2 && TR_BLOCK_DIM < m) {
      if (ctx->logging) { fprintf(ctx->log, "Using low-height kernel\n"); }
      kernel = kernel_low_height;
      int64_t x_elems = (m + mulx - 1) / mulx;
      int64_t y_elems = n;
      grid[0] = (x_elems + TR_BLOCK_DIM - 1) / TR_BLOCK_DIM;
      grid[1] = (y_elems + TR_BLOCK_DIM - 1) / TR_BLOCK_DIM;
      grid[2] = k;
      block[0] = TR_BLOCK_DIM;
      block[1] = TR_BLOCK_DIM;
      block[2] = 1;
    } else {
      if (ctx->logging) { fprintf(ctx->log, "Using default kernel\n"); }
      kernel = kernel_default;
      grid[0] = (m+TR_TILE_DIM-1)/TR_TILE_DIM;
      grid[1] = (n+TR_TILE_DIM-1)/TR_TILE_DIM;
      grid[2] = k;
      block[0] = TR_TILE_DIM;
      block[1] = TR_TILE_DIM/TR_ELEMS_PER_THREAD;
      block[2] = 1;
    }
    args[4] = &k32;
    args[5] = &m32;
    args[6] = &n32;
    args[7] = &mulx32;
    args[8] = &muly32;
  } else {
    if (ctx->logging) { fprintf(ctx->log, "Using large kernel\n"); }
    kernel = kernel_large;
    grid[0] = (m+TR_TILE_DIM-1)/TR_TILE_DIM;
    grid[1] = (n+TR_TILE_DIM-1)/TR_TILE_DIM;
    grid[2] = k;
    block[0] = TR_TILE_DIM;
    block[1] = TR_TILE_DIM/TR_ELEMS_PER_THREAD;
    block[2] = 1;
    args[4] = &k;
    args[5] = &m;
    args[6] = &n;
    args[7] = &mulx;
    args[8] = &muly;
    args_sizes[4] = sizeof(int64_t);
    args_sizes[5] = sizeof(int64_t);
    args_sizes[6] = sizeof(int64_t);
    args_sizes[7] = sizeof(int64_t);
    args_sizes[8] = sizeof(int64_t);
  }

  // Cap the number of thead blocks we launch and figure out how many
  // repeats we need alongside each dimension.
  int32_t repeat_1 = grid[1] / MAX_TR_THREAD_BLOCKS;
  int32_t repeat_2 = grid[2] / MAX_TR_THREAD_BLOCKS;
  grid[1] = repeat_1 > 0 ? MAX_TR_THREAD_BLOCKS : grid[1];
  grid[2] = repeat_2 > 0 ? MAX_TR_THREAD_BLOCKS : grid[2];
  args[9] = &repeat_1;
  args[10] = &repeat_2;
  args_sizes[9] = sizeof(repeat_1);
  args_sizes[10] = sizeof(repeat_2);

  if (ctx->logging) {
    fprintf(ctx->log, "\n");
  }

  return gpu_launch_kernel(ctx, kernel, name, grid, block,
                           TR_TILE_DIM*(TR_TILE_DIM+1)*elem_size,
                           sizeof(args)/sizeof(args[0]), args, args_sizes);
}

#define GEN_MAP_TRANSPOSE_GPU2GPU(NAME, ELEM_TYPE)                      \
  static int map_transpose_gpu2gpu_##NAME                               \
  (struct futhark_context* ctx,                                         \
   gpu_mem dst, int64_t dst_offset,                                     \
   gpu_mem src, int64_t src_offset,                                     \
   int64_t k, int64_t m, int64_t n)                                     \
  {                                                                     \
    return                                                              \
      gpu_map_transpose                                                 \
      (ctx,                                                             \
       ctx->kernels->map_transpose_##NAME,                              \
       ctx->kernels->map_transpose_##NAME##_low_height,                 \
       ctx->kernels->map_transpose_##NAME##_low_width,                  \
       ctx->kernels->map_transpose_##NAME##_small,                      \
       ctx->kernels->map_transpose_##NAME##_large,                      \
       "map_transpose_" #NAME, sizeof(ELEM_TYPE),                       \
       dst, dst_offset, src, src_offset,                                \
       k, n, m);                                                        \
  }

static int gpu_lmad_copy(struct futhark_context* ctx,
                         gpu_kernel kernel, int r,
                         gpu_mem dst, int64_t dst_offset, int64_t dst_strides[r],
                         gpu_mem src, int64_t src_offset, int64_t src_strides[r],
                         int64_t shape[r]) {
  if (r > 8) {
    set_error(ctx, strdup("Futhark runtime limitation:\nCannot copy array of greater than rank 8.\n"));
    return 1;
  }

  int64_t n = 1;
  for (int i = 0; i < r; i++) { n *= shape[i]; }

  void* args[6+(8*3)];
  size_t args_sizes[6+(8*3)];

  args[0] = &dst;
  args_sizes[0] = sizeof(gpu_mem);
  args[1] = &dst_offset;
  args_sizes[1] = sizeof(dst_offset);
  args[2] = &src;
  args_sizes[2] = sizeof(gpu_mem);
  args[3] = &src_offset;
  args_sizes[3] = sizeof(src_offset);
  args[4] = &n;
  args_sizes[4] = sizeof(n);
  args[5] = &r;
  args_sizes[5] = sizeof(r);

  int64_t zero = 0;

  for (int i = 0; i < 8; i++) {
    args_sizes[6+i*3] = sizeof(int64_t);
    args_sizes[6+i*3+1] = sizeof(int64_t);
    args_sizes[6+i*3+2] = sizeof(int64_t);
    if (i < r) {
      args[6+i*3] = &shape[i];
      args[6+i*3+1] = &dst_strides[i];
      args[6+i*3+2] = &src_strides[i];
    } else {
      args[6+i*3] = &zero;
      args[6+i*3+1] = &zero;
      args[6+i*3+2] = &zero;
    }
  }
  const size_t w = 256; // XXX: hardcoded thread block size.

  return gpu_launch_kernel(ctx, kernel, "copy_lmad_dev_to_dev",
                           (const int32_t[3]) {(n+w-1)/w,1,1},
                           (const int32_t[3]) {w,1,1},
                           0, 6+(8*3), args, args_sizes);
}

#define GEN_LMAD_COPY_ELEMENTS_GPU2GPU(NAME, ELEM_TYPE)                 \
  static int lmad_copy_elements_gpu2gpu_##NAME                          \
  (struct futhark_context* ctx,                                         \
   int r,                                                               \
   gpu_mem dst, int64_t dst_offset, int64_t dst_strides[r],             \
   gpu_mem src, int64_t src_offset, int64_t src_strides[r],             \
   int64_t shape[r]) {                                                  \
    return gpu_lmad_copy(ctx, ctx->kernels->lmad_copy_##NAME, r,        \
                         dst, dst_offset, dst_strides,                  \
                         src, src_offset, src_strides,                  \
                         shape);                                        \
  }                                                                     \

#define GEN_LMAD_COPY_GPU2GPU(NAME, ELEM_TYPE)                          \
  static int lmad_copy_gpu2gpu_##NAME                                   \
  (struct futhark_context* ctx,                                         \
   int r,                                                               \
   gpu_mem dst, int64_t dst_offset, int64_t dst_strides[r],             \
   gpu_mem src, int64_t src_offset, int64_t src_strides[r],             \
   int64_t shape[r]) {                                                  \
    log_copy(ctx, "GPU to GPU", r, dst_offset, dst_strides,             \
             src_offset, src_strides, shape);                           \
    int64_t size = 1;                                                   \
    for (int i = 0; i < r; i++) { size *= shape[i]; }                   \
    if (size == 0) { return FUTHARK_SUCCESS; }                          \
    int64_t k, n, m;                                                    \
    if (lmad_map_tr(&k, &n, &m,                                         \
                       r, dst_strides, src_strides, shape)) {           \
      log_transpose(ctx, k, n, m);                                      \
      return map_transpose_gpu2gpu_##NAME                               \
        (ctx, dst, dst_offset, src, src_offset, k, n, m);               \
    } else if (lmad_memcpyable(r, dst_strides, src_strides, shape)) {   \
      if (ctx->logging) {fprintf(ctx->log, "## Flat copy\n\n");}        \
      return gpu_memcpy(ctx,                                            \
                        dst, dst_offset*sizeof(ELEM_TYPE),              \
                        src, src_offset*sizeof(ELEM_TYPE),              \
                        size * sizeof(ELEM_TYPE));                      \
    } else {                                                            \
      if (ctx->logging) {fprintf(ctx->log, "## General copy\n\n");}     \
      return lmad_copy_elements_gpu2gpu_##NAME                          \
        (ctx, r,                                                        \
         dst, dst_offset, dst_strides,                                  \
         src, src_offset, src_strides,                                  \
         shape);                                                        \
    }                                                                   \
  }

static int
lmad_copy_elements_host2gpu(struct futhark_context *ctx, size_t elem_size,
                            int r,
                            gpu_mem dst, int64_t dst_offset, int64_t dst_strides[r],
                            unsigned char* src, int64_t src_offset, int64_t src_strides[r],
                            int64_t shape[r]) {
  (void)ctx; (void)elem_size; (void)r;
  (void)dst; (void)dst_offset; (void)dst_strides;
  (void)src; (void)src_offset; (void)src_strides;
  (void)shape;
  set_error(ctx, strdup("Futhark runtime limitation:\nCannot copy unstructured array from host to GPU.\n"));
  return 1;
}

static int
lmad_copy_elements_gpu2host (struct futhark_context *ctx, size_t elem_size,
                             int r,
                             unsigned char* dst, int64_t dst_offset, int64_t dst_strides[r],
                             gpu_mem src, int64_t src_offset, int64_t src_strides[r],
                             int64_t shape[r]) {
  (void)ctx; (void)elem_size; (void)r;
  (void)dst; (void)dst_offset; (void)dst_strides;
  (void)src; (void)src_offset; (void)src_strides;
  (void)shape;
  set_error(ctx, strdup("Futhark runtime limitation:\nCannot copy unstructured array from GPU to host.\n"));
  return 1;
}

#define GEN_LMAD_COPY_ELEMENTS_HOSTGPU(NAME, ELEM_TYPE)                 \
  static int lmad_copy_elements_gpu2gpu_##NAME                          \
  (struct futhark_context* ctx,                                         \
   int r,                                                               \
   gpu_mem dst, int64_t dst_offset, int64_t dst_strides[r],             \
   gpu_mem src, int64_t src_offset, int64_t src_strides[r],             \
   int64_t shape[r]) {                                                  \
    return (ctx, ctx->kernels->lmad_copy_##NAME, r,                     \
                         dst, dst_offset, dst_strides,                  \
                         src, src_offset, src_strides,                  \
                         shape);                                        \
  }                                                                     \


static int lmad_copy_host2gpu(struct futhark_context* ctx, size_t elem_size, bool sync,
                              int r,
                              gpu_mem dst, int64_t dst_offset, int64_t dst_strides[r],
                              unsigned char* src, int64_t src_offset, int64_t src_strides[r],
                              int64_t shape[r]) {
  log_copy(ctx, "Host to GPU", r, dst_offset, dst_strides,
           src_offset, src_strides, shape);
  int64_t size = elem_size;
  for (int i = 0; i < r; i++) { size *= shape[i]; }
  if (size == 0) { return FUTHARK_SUCCESS; }
  int64_t k, n, m;
  if (lmad_memcpyable(r, dst_strides, src_strides, shape)) {
    if (ctx->logging) {fprintf(ctx->log, "## Flat copy\n\n");}
    return memcpy_host2gpu(ctx, sync,
                           dst, dst_offset*elem_size,
                           src, src_offset*elem_size,
                           size);
  } else {
    if (ctx->logging) {fprintf(ctx->log, "## General copy\n\n");}
    int error;
    error = lmad_copy_elements_host2gpu
      (ctx, elem_size, r,
       dst, dst_offset, dst_strides,
       src, src_offset, src_strides,
       shape);
    if (error == 0 && sync) {
      error = futhark_context_sync(ctx);
    }
    return error;
  }
}

static int lmad_copy_gpu2host(struct futhark_context* ctx, size_t elem_size, bool sync,
                              int r,
                              unsigned char* dst, int64_t dst_offset, int64_t dst_strides[r],
                              gpu_mem src, int64_t src_offset, int64_t src_strides[r],
                              int64_t shape[r]) {
  log_copy(ctx, "Host to GPU", r, dst_offset, dst_strides,
           src_offset, src_strides, shape);
  int64_t size = elem_size;
  for (int i = 0; i < r; i++) { size *= shape[i]; }
  if (size == 0) { return FUTHARK_SUCCESS; }
  int64_t k, n, m;
  if (lmad_memcpyable(r, dst_strides, src_strides, shape)) {
    if (ctx->logging) {fprintf(ctx->log, "## Flat copy\n\n");}
    return memcpy_gpu2host(ctx, sync,
                           dst, dst_offset*elem_size,
                           src, src_offset*elem_size,
                           size);
  } else {
    if (ctx->logging) {fprintf(ctx->log, "## General copy\n\n");}
    int error;
    error = lmad_copy_elements_gpu2host
      (ctx, elem_size, r,
       dst, dst_offset, dst_strides,
       src, src_offset, src_strides,
       shape);
    if (error == 0 && sync) {
      error = futhark_context_sync(ctx);
    }
    return error;
  }
}

GEN_MAP_TRANSPOSE_GPU2GPU(1b, uint8_t)
GEN_MAP_TRANSPOSE_GPU2GPU(2b, uint16_t)
GEN_MAP_TRANSPOSE_GPU2GPU(4b, uint32_t)
GEN_MAP_TRANSPOSE_GPU2GPU(8b, uint64_t)

GEN_LMAD_COPY_ELEMENTS_GPU2GPU(1b, uint8_t)
GEN_LMAD_COPY_ELEMENTS_GPU2GPU(2b, uint16_t)
GEN_LMAD_COPY_ELEMENTS_GPU2GPU(4b, uint32_t)
GEN_LMAD_COPY_ELEMENTS_GPU2GPU(8b, uint64_t)

GEN_LMAD_COPY_GPU2GPU(1b, uint8_t)
GEN_LMAD_COPY_GPU2GPU(2b, uint16_t)
GEN_LMAD_COPY_GPU2GPU(4b, uint32_t)
GEN_LMAD_COPY_GPU2GPU(8b, uint64_t)

// End of gpu.h

static int gpu_macros(struct futhark_context *ctx, char ***names_out, int64_t **values_out)
{
    int num_macros = 228;
    char **names = malloc(num_macros * sizeof(char *));
    int64_t *values = malloc(num_macros * sizeof(int64_t));
    
    {
        names[0] = "get_num_neighbours_against_10106zisegred_large_49636_dim1";
        values[0] = *ctx->tuning_params.get_num_neighbours_against_10106zisegred_tblock_sizze_49547;
    }
    {
        names[1] = "get_num_neighbours_against_10106zisegred_large_49636zisegred_tblock_sizze_49630";
        values[1] = *ctx->tuning_params.get_num_neighbours_against_10106zisegred_tblock_sizze_49547;
    }
    {
        names[2] = "get_num_neighbours_against_10106zisegred_large_49636zichunk_sizze_54590";
        values[2] = (int64_t) 1;
    }
    {
        names[3] = "get_num_neighbours_against_10106zisegred_small_49636_dim1";
        values[3] = *ctx->tuning_params.get_num_neighbours_against_10106zisegred_tblock_sizze_49547;
    }
    {
        names[4] = "get_num_neighbours_against_10106zisegred_small_49636zisegred_tblock_sizze_49630";
        values[4] = *ctx->tuning_params.get_num_neighbours_against_10106zisegred_tblock_sizze_49547;
    }
    {
        names[5] = "get_num_neighbours_against_10106zisegmap_49618_dim1";
        values[5] = *ctx->tuning_params.get_num_neighbours_against_10106zisegmap_tblock_sizze_49597;
    }
    {
        names[6] = "get_num_neighbours_against_10106zisegmap_49618zisegmap_tblock_sizze_49612";
        values[6] = *ctx->tuning_params.get_num_neighbours_against_10106zisegmap_tblock_sizze_49597;
    }
    {
        names[7] = "get_num_neighbours_against_10106zisegmap_intrablock_49824_dim1";
        values[7] = *ctx->tuning_params.get_num_neighbours_against_10106zitile_sizze_49825;
    }
    {
        names[8] = "get_num_neighbours_against_10106zisegmap_intrablock_49824zitile_sizze_49826";
        values[8] = *ctx->tuning_params.get_num_neighbours_against_10106zitile_sizze_49825;
    }
    {
        names[9] = "get_num_neighbours_against_10106zisegmap_intrablock_49824zibytes_53551";
        values[9] = (int64_t) 8 * *ctx->tuning_params.get_num_neighbours_against_10106zitile_sizze_49825;
    }
    {
        names[10] = "get_num_neighbours_against_10103zisegred_large_49402_dim1";
        values[10] = *ctx->tuning_params.get_num_neighbours_against_10103zisegred_tblock_sizze_49313;
    }
    {
        names[11] = "get_num_neighbours_against_10103zisegred_large_49402zisegred_tblock_sizze_49396";
        values[11] = *ctx->tuning_params.get_num_neighbours_against_10103zisegred_tblock_sizze_49313;
    }
    {
        names[12] = "get_num_neighbours_against_10103zisegred_large_49402zichunk_sizze_54590";
        values[12] = (int64_t) 1;
    }
    {
        names[13] = "get_num_neighbours_against_10103zisegred_small_49402_dim1";
        values[13] = *ctx->tuning_params.get_num_neighbours_against_10103zisegred_tblock_sizze_49313;
    }
    {
        names[14] = "get_num_neighbours_against_10103zisegred_small_49402zisegred_tblock_sizze_49396";
        values[14] = *ctx->tuning_params.get_num_neighbours_against_10103zisegred_tblock_sizze_49313;
    }
    {
        names[15] = "get_num_neighbours_against_10103zisegmap_49384_dim1";
        values[15] = *ctx->tuning_params.get_num_neighbours_against_10103zisegmap_tblock_sizze_49363;
    }
    {
        names[16] = "get_num_neighbours_against_10103zisegmap_49384zisegmap_tblock_sizze_49378";
        values[16] = *ctx->tuning_params.get_num_neighbours_against_10103zisegmap_tblock_sizze_49363;
    }
    {
        names[17] = "get_num_neighbours_against_10103zisegmap_intrablock_49824_dim1";
        values[17] = *ctx->tuning_params.get_num_neighbours_against_10103zitile_sizze_49825;
    }
    {
        names[18] = "get_num_neighbours_against_10103zisegmap_intrablock_49824zitile_sizze_49826";
        values[18] = *ctx->tuning_params.get_num_neighbours_against_10103zitile_sizze_49825;
    }
    {
        names[19] = "get_num_neighbours_against_10103zisegmap_intrablock_49824zibytes_53551";
        values[19] = (int64_t) 8 * *ctx->tuning_params.get_num_neighbours_against_10103zitile_sizze_49825;
    }
    {
        names[20] = "rectify_partition_ids_doublezisegmap_intrablock_50068_dim1";
        values[20] = *ctx->tuning_params.rectify_partition_ids_doublezitile_sizze_50069;
    }
    {
        names[21] = "rectify_partition_ids_doublezisegmap_intrablock_50068zitile_sizze_50070";
        values[21] = *ctx->tuning_params.rectify_partition_ids_doublezitile_sizze_50069;
    }
    {
        names[22] = "rectify_partition_ids_doublezisegmap_intrablock_50068zibytes_53529";
        values[22] = (int64_t) 8 * *ctx->tuning_params.rectify_partition_ids_doublezitile_sizze_50069;
    }
    {
        names[23] = "rectify_partition_ids_doublezisegmap_intrablock_49824_dim1";
        values[23] = *ctx->tuning_params.rectify_partition_ids_doublezitile_sizze_49825;
    }
    {
        names[24] = "rectify_partition_ids_doublezisegmap_intrablock_49824zitile_sizze_49826";
        values[24] = *ctx->tuning_params.rectify_partition_ids_doublezitile_sizze_49825;
    }
    {
        names[25] = "rectify_partition_ids_doublezisegmap_intrablock_49824zibytes_53569";
        values[25] = (int64_t) 8 * *ctx->tuning_params.rectify_partition_ids_doublezitile_sizze_49825;
    }
    {
        names[26] = "next_partition_to_read_doublezigpuseq_54757_dim1";
        values[26] = (int64_t) 1;
    }
    {
        names[27] = "next_partition_to_read_doublezisegmap_45493_dim1";
        values[27] = *ctx->tuning_params.next_partition_to_read_doublezisegmap_tblock_sizze_45495;
    }
    {
        names[28] = "next_partition_to_read_doublezisegmap_45493zisegmap_tblock_sizze_45496";
        values[28] = *ctx->tuning_params.next_partition_to_read_doublezisegmap_tblock_sizze_45495;
    }
    {
        names[29] = "next_partition_to_read_doublezisegscan_45491_dim1";
        values[29] = *ctx->tuning_params.next_partition_to_read_doublezisegscan_tblock_sizze_45485;
    }
    {
        names[30] = "next_partition_to_read_doublezisegscan_45491zisegscan_tblock_sizze_45486";
        values[30] = *ctx->tuning_params.next_partition_to_read_doublezisegscan_tblock_sizze_45485;
    }
    {
        names[31] = "next_partition_to_read_doublezisegscan_45491zichunk_sizze_54608";
        values[31] = smax64((int64_t) 1, smin64(squot64(squot64(ctx->max_shared_memory, ctx->max_thread_block_size), (int64_t) 8), squot64(squot64(ctx->max_registers, ctx->max_thread_block_size) - (int64_t) 1 - squot64(smax64((int64_t) 4, (int64_t) 8), (int64_t) 4), (int64_t) 2 * squot64(smax64((int64_t) 4, (int64_t) 8), (int64_t) 4))));
    }
    {
        names[32] = "next_partition_to_read_doublezisegred_nonseg_45483_dim1";
        values[32] = *ctx->tuning_params.next_partition_to_read_doublezisegred_tblock_sizze_45475;
    }
    {
        names[33] = "next_partition_to_read_doublezisegred_nonseg_45483zisegred_tblock_sizze_45476";
        values[33] = *ctx->tuning_params.next_partition_to_read_doublezisegred_tblock_sizze_45475;
    }
    {
        names[34] = "next_partition_to_read_doublezisegred_nonseg_45483zichunk_sizze_54550";
        values[34] = (int64_t) 1;
    }
    {
        names[35] = "next_partition_to_read_doublezigpuseq_54544_dim1";
        values[35] = (int64_t) 1;
    }
    {
        names[36] = "mk_dbcHandler_doublezigpuseq_54642_dim1";
        values[36] = (int64_t) 1;
    }
    {
        names[37] = "make_collisions_compact_doublezisegmap_45656_dim1";
        values[37] = *ctx->tuning_params.make_collisions_compact_doublezisegmap_tblock_sizze_45658;
    }
    {
        names[38] = "make_collisions_compact_doublezisegmap_45656zisegmap_tblock_sizze_45659";
        values[38] = *ctx->tuning_params.make_collisions_compact_doublezisegmap_tblock_sizze_45658;
    }
    {
        names[39] = "make_collisions_compact_doublezisegscan_45654_dim1";
        values[39] = *ctx->tuning_params.make_collisions_compact_doublezisegscan_tblock_sizze_45648;
    }
    {
        names[40] = "make_collisions_compact_doublezisegscan_45654zisegscan_tblock_sizze_45649";
        values[40] = *ctx->tuning_params.make_collisions_compact_doublezisegscan_tblock_sizze_45648;
    }
    {
        names[41] = "make_collisions_compact_doublezisegscan_45654zichunk_sizze_54613";
        values[41] = smax64((int64_t) 1, smin64(squot64(squot64(ctx->max_shared_memory, ctx->max_thread_block_size), (int64_t) 8), squot64(squot64(ctx->max_registers, ctx->max_thread_block_size) - (int64_t) 1 - squot64(smax64((int64_t) 4, (int64_t) 8), (int64_t) 4), (int64_t) 2 * squot64(smax64((int64_t) 4, (int64_t) 8), (int64_t) 4))));
    }
    {
        names[42] = "make_collisions_compact_doublezisegmap_intrablock_50093_dim1";
        values[42] = *ctx->tuning_params.make_collisions_compact_doublezitile_sizze_50094;
    }
    {
        names[43] = "make_collisions_compact_doublezisegmap_intrablock_50093zitile_sizze_50095";
        values[43] = *ctx->tuning_params.make_collisions_compact_doublezitile_sizze_50094;
    }
    {
        names[44] = "make_collisions_compact_doublezisegmap_intrablock_50093zibytes_53556";
        values[44] = (int64_t) 8 * *ctx->tuning_params.make_collisions_compact_doublezitile_sizze_50094;
    }
    {
        names[45] = "make_collisions_compact_doublezisegmap_intrablock_49824_dim1";
        values[45] = *ctx->tuning_params.make_collisions_compact_doublezitile_sizze_49825;
    }
    {
        names[46] = "make_collisions_compact_doublezisegmap_intrablock_49824zitile_sizze_49826";
        values[46] = *ctx->tuning_params.make_collisions_compact_doublezitile_sizze_49825;
    }
    {
        names[47] = "make_collisions_compact_doublezisegmap_intrablock_49824zibytes_53602";
        values[47] = (int64_t) 8 * *ctx->tuning_params.make_collisions_compact_doublezitile_sizze_49825;
    }
    {
        names[48] = "do_DBSCAN_doublezigpuseq_56885_dim1";
        values[48] = (int64_t) 1;
    }
    {
        names[49] = "do_DBSCAN_doublezisegred_nonseg_49206_dim1";
        values[49] = *ctx->tuning_params.do_DBSCAN_doublezisegred_tblock_sizze_49198;
    }
    {
        names[50] = "do_DBSCAN_doublezisegred_nonseg_49206zisegred_tblock_sizze_49199";
        values[50] = *ctx->tuning_params.do_DBSCAN_doublezisegred_tblock_sizze_49198;
    }
    {
        names[51] = "do_DBSCAN_doublezisegred_nonseg_49206zichunk_sizze_56849";
        values[51] = (int64_t) 1;
    }
    {
        names[52] = "do_DBSCAN_doublezisegred_nonseg_49196_dim1";
        values[52] = *ctx->tuning_params.do_DBSCAN_doublezisegred_tblock_sizze_49188;
    }
    {
        names[53] = "do_DBSCAN_doublezisegred_nonseg_49196zisegred_tblock_sizze_49189";
        values[53] = *ctx->tuning_params.do_DBSCAN_doublezisegred_tblock_sizze_49188;
    }
    {
        names[54] = "do_DBSCAN_doublezisegred_nonseg_49196zichunk_sizze_56814";
        values[54] = (int64_t) 1;
    }
    {
        names[55] = "do_DBSCAN_doublezisegred_large_49140_dim1";
        values[55] = *ctx->tuning_params.do_DBSCAN_doublezisegred_tblock_sizze_49042;
    }
    {
        names[56] = "do_DBSCAN_doublezisegred_large_49140zisegred_tblock_sizze_49133";
        values[56] = *ctx->tuning_params.do_DBSCAN_doublezisegred_tblock_sizze_49042;
    }
    {
        names[57] = "do_DBSCAN_doublezisegred_large_49140zichunk_sizze_56715";
        values[57] = (int64_t) 1;
    }
    {
        names[58] = "do_DBSCAN_doublezisegred_small_49140_dim1";
        values[58] = *ctx->tuning_params.do_DBSCAN_doublezisegred_tblock_sizze_49042;
    }
    {
        names[59] = "do_DBSCAN_doublezisegred_small_49140zisegred_tblock_sizze_49133";
        values[59] = *ctx->tuning_params.do_DBSCAN_doublezisegred_tblock_sizze_49042;
    }
    {
        names[60] = "do_DBSCAN_doublezisegmap_49121_dim1";
        values[60] = *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_49100;
    }
    {
        names[61] = "do_DBSCAN_doublezisegmap_49121zisegmap_tblock_sizze_49115";
        values[61] = *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_49100;
    }
    {
        names[62] = "do_DBSCAN_doublezisegmap_intrablock_52645_dim1";
        values[62] = *ctx->tuning_params.do_DBSCAN_doublezitile_sizze_52646;
    }
    {
        names[63] = "do_DBSCAN_doublezisegmap_intrablock_52645zitile_sizze_52647";
        values[63] = *ctx->tuning_params.do_DBSCAN_doublezitile_sizze_52646;
    }
    {
        names[64] = "do_DBSCAN_doublezisegmap_intrablock_52645zibytes_54306";
        values[64] = (int64_t) 8 * *ctx->tuning_params.do_DBSCAN_doublezitile_sizze_52646;
    }
    {
        names[65] = "do_DBSCAN_doublezisegmap_48910_dim1";
        values[65] = *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_48912;
    }
    {
        names[66] = "do_DBSCAN_doublezisegmap_48910zisegmap_tblock_sizze_48913";
        values[66] = *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_48912;
    }
    {
        names[67] = "do_DBSCAN_doublezisegmap_48450_dim1";
        values[67] = *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_48452;
    }
    {
        names[68] = "do_DBSCAN_doublezisegmap_48450zisegmap_tblock_sizze_48453";
        values[68] = *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_48452;
    }
    {
        names[69] = "do_DBSCAN_doublezisegred_large_48402_dim1";
        values[69] = *ctx->tuning_params.do_DBSCAN_doublezisegred_tblock_sizze_48304;
    }
    {
        names[70] = "do_DBSCAN_doublezisegred_large_48402zisegred_tblock_sizze_48395";
        values[70] = *ctx->tuning_params.do_DBSCAN_doublezisegred_tblock_sizze_48304;
    }
    {
        names[71] = "do_DBSCAN_doublezisegred_large_48402zichunk_sizze_56556";
        values[71] = (int64_t) 1;
    }
    {
        names[72] = "do_DBSCAN_doublezisegred_small_48402_dim1";
        values[72] = *ctx->tuning_params.do_DBSCAN_doublezisegred_tblock_sizze_48304;
    }
    {
        names[73] = "do_DBSCAN_doublezisegred_small_48402zisegred_tblock_sizze_48395";
        values[73] = *ctx->tuning_params.do_DBSCAN_doublezisegred_tblock_sizze_48304;
    }
    {
        names[74] = "do_DBSCAN_doublezisegmap_48383_dim1";
        values[74] = *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_48362;
    }
    {
        names[75] = "do_DBSCAN_doublezisegmap_48383zisegmap_tblock_sizze_48377";
        values[75] = *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_48362;
    }
    {
        names[76] = "do_DBSCAN_doublezisegmap_intrablock_51472_dim1";
        values[76] = *ctx->tuning_params.do_DBSCAN_doublezitile_sizze_51473;
    }
    {
        names[77] = "do_DBSCAN_doublezisegmap_intrablock_51472zitile_sizze_51474";
        values[77] = *ctx->tuning_params.do_DBSCAN_doublezitile_sizze_51473;
    }
    {
        names[78] = "do_DBSCAN_doublezisegmap_intrablock_51472zibytes_54059";
        values[78] = (int64_t) 8 * *ctx->tuning_params.do_DBSCAN_doublezitile_sizze_51473;
    }
    {
        names[79] = "do_DBSCAN_doublezisegmap_48163_dim1";
        values[79] = *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_48136;
    }
    {
        names[80] = "do_DBSCAN_doublezisegmap_48163zisegmap_tblock_sizze_48157";
        values[80] = *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_48136;
    }
    {
        names[81] = "do_DBSCAN_doublezisegscan_48902_dim1";
        values[81] = *ctx->tuning_params.do_DBSCAN_doublezisegscan_tblock_sizze_48778;
    }
    {
        names[82] = "do_DBSCAN_doublezisegscan_48902zisegscan_tblock_sizze_48897";
        values[82] = *ctx->tuning_params.do_DBSCAN_doublezisegscan_tblock_sizze_48778;
    }
    {
        names[83] = "do_DBSCAN_doublezisegscan_48902zichunk_sizze_56416";
        values[83] = smax64((int64_t) 1, smin64(squot64(squot64(ctx->max_shared_memory, ctx->max_thread_block_size), (int64_t) 8), squot64(squot64(ctx->max_registers, ctx->max_thread_block_size) - (int64_t) 1 - squot64(smax64((int64_t) 4, (int64_t) 8), (int64_t) 4), (int64_t) 2 * squot64(smax64((int64_t) 4, (int64_t) 8), (int64_t) 4))));
    }
    {
        names[84] = "do_DBSCAN_doublezisegmap_intrablock_52263_dim1";
        values[84] = *ctx->tuning_params.do_DBSCAN_doublezitile_sizze_52264;
    }
    {
        names[85] = "do_DBSCAN_doublezisegmap_intrablock_52263zitile_sizze_52265";
        values[85] = *ctx->tuning_params.do_DBSCAN_doublezitile_sizze_52264;
    }
    {
        names[86] = "do_DBSCAN_doublezisegmap_intrablock_52263zibytes_54122";
        values[86] = (int64_t) 8 * *ctx->tuning_params.do_DBSCAN_doublezitile_sizze_52264;
    }
    {
        names[87] = "do_DBSCAN_doublezisegmap_intrablock_51881_dim1";
        values[87] = *ctx->tuning_params.do_DBSCAN_doublezitile_sizze_51882;
    }
    {
        names[88] = "do_DBSCAN_doublezisegmap_intrablock_51881zitile_sizze_51883";
        values[88] = *ctx->tuning_params.do_DBSCAN_doublezitile_sizze_51882;
    }
    {
        names[89] = "do_DBSCAN_doublezisegmap_intrablock_51881zibytes_54194";
        values[89] = (int64_t) 8 * *ctx->tuning_params.do_DBSCAN_doublezitile_sizze_51882;
    }
    {
        names[90] = "do_DBSCAN_doublezisegmap_48458_dim1";
        values[90] = *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_48460;
    }
    {
        names[91] = "do_DBSCAN_doublezisegmap_48458zisegmap_tblock_sizze_48461";
        values[91] = *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_48460;
    }
    {
        names[92] = "do_DBSCAN_doublezisegscan_48125_dim1";
        values[92] = *ctx->tuning_params.do_DBSCAN_doublezisegscan_tblock_sizze_48037;
    }
    {
        names[93] = "do_DBSCAN_doublezisegscan_48125zisegscan_tblock_sizze_48120";
        values[93] = *ctx->tuning_params.do_DBSCAN_doublezisegscan_tblock_sizze_48037;
    }
    {
        names[94] = "do_DBSCAN_doublezisegscan_48125zichunk_sizze_56142";
        values[94] = smax64((int64_t) 1, smin64(squot64(squot64(ctx->max_shared_memory, ctx->max_thread_block_size), (int64_t) 8), squot64(squot64(ctx->max_registers, ctx->max_thread_block_size) - (int64_t) 1 - squot64(smax64((int64_t) 4, (int64_t) 8), (int64_t) 4), (int64_t) 2 * squot64(smax64((int64_t) 4, (int64_t) 8), (int64_t) 4))));
    }
    {
        names[95] = "do_DBSCAN_doublezisegmap_intrablock_51193_dim1";
        values[95] = *ctx->tuning_params.do_DBSCAN_doublezitile_sizze_51194;
    }
    {
        names[96] = "do_DBSCAN_doublezisegmap_intrablock_51193zitile_sizze_51195";
        values[96] = *ctx->tuning_params.do_DBSCAN_doublezitile_sizze_51194;
    }
    {
        names[97] = "do_DBSCAN_doublezisegmap_intrablock_51193zibytes_53906";
        values[97] = (int64_t) 8 * *ctx->tuning_params.do_DBSCAN_doublezitile_sizze_51194;
    }
    {
        names[98] = "do_DBSCAN_doublezisegmap_intrablock_50914_dim1";
        values[98] = *ctx->tuning_params.do_DBSCAN_doublezitile_sizze_50915;
    }
    {
        names[99] = "do_DBSCAN_doublezisegmap_intrablock_50914zitile_sizze_50916";
        values[99] = *ctx->tuning_params.do_DBSCAN_doublezitile_sizze_50915;
    }
    {
        names[100] = "do_DBSCAN_doublezisegmap_intrablock_50914zibytes_53956";
        values[100] = (int64_t) 8 * *ctx->tuning_params.do_DBSCAN_doublezitile_sizze_50915;
    }
    {
        names[101] = "do_DBSCAN_doublezisegmap_47820_dim1";
        values[101] = *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_47822;
    }
    {
        names[102] = "do_DBSCAN_doublezisegmap_47820zisegmap_tblock_sizze_47823";
        values[102] = *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_47822;
    }
    {
        names[103] = "do_DBSCAN_doublezisegscan_47812_dim1";
        values[103] = *ctx->tuning_params.do_DBSCAN_doublezisegscan_tblock_sizze_47706;
    }
    {
        names[104] = "do_DBSCAN_doublezisegscan_47812zisegscan_tblock_sizze_47807";
        values[104] = *ctx->tuning_params.do_DBSCAN_doublezisegscan_tblock_sizze_47706;
    }
    {
        names[105] = "do_DBSCAN_doublezisegscan_47812zichunk_sizze_55875";
        values[105] = smax64((int64_t) 1, smin64(squot64(squot64(ctx->max_shared_memory, ctx->max_thread_block_size), (int64_t) 8), squot64(squot64(ctx->max_registers, ctx->max_thread_block_size) - (int64_t) 1 - squot64(smax64((int64_t) 4, (int64_t) 8), (int64_t) 4), (int64_t) 2 * squot64(smax64((int64_t) 4, (int64_t) 8), (int64_t) 4))));
    }
    {
        names[106] = "do_DBSCAN_doublezisegmap_intrablock_50559_dim1";
        values[106] = *ctx->tuning_params.do_DBSCAN_doublezitile_sizze_50560;
    }
    {
        names[107] = "do_DBSCAN_doublezisegmap_intrablock_50559zitile_sizze_50561";
        values[107] = *ctx->tuning_params.do_DBSCAN_doublezitile_sizze_50560;
    }
    {
        names[108] = "do_DBSCAN_doublezisegmap_intrablock_50559zibytes_53773";
        values[108] = (int64_t) 8 * *ctx->tuning_params.do_DBSCAN_doublezitile_sizze_50560;
    }
    {
        names[109] = "do_DBSCAN_doublezisegmap_intrablock_50204_dim1";
        values[109] = *ctx->tuning_params.do_DBSCAN_doublezitile_sizze_50205;
    }
    {
        names[110] = "do_DBSCAN_doublezisegmap_intrablock_50204zitile_sizze_50206";
        values[110] = *ctx->tuning_params.do_DBSCAN_doublezitile_sizze_50205;
    }
    {
        names[111] = "do_DBSCAN_doublezisegmap_intrablock_50204zibytes_53835";
        values[111] = (int64_t) 8 * *ctx->tuning_params.do_DBSCAN_doublezitile_sizze_50205;
    }
    {
        names[112] = "do_DBSCAN_doublezisegmap_47407_dim1";
        values[112] = *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_47409;
    }
    {
        names[113] = "do_DBSCAN_doublezisegmap_47407zisegmap_tblock_sizze_47410";
        values[113] = *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_47409;
    }
    {
        names[114] = "do_DBSCAN_doublezisegmap_47403_dim1";
        values[114] = *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_47391;
    }
    {
        names[115] = "do_DBSCAN_doublezisegmap_47403zisegmap_tblock_sizze_47399";
        values[115] = *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_47391;
    }
    {
        names[116] = "do_DBSCAN_doublezisegmap_47376_dim1";
        values[116] = *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_47355;
    }
    {
        names[117] = "do_DBSCAN_doublezisegmap_47376zisegmap_tblock_sizze_47372";
        values[117] = *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_47355;
    }
    {
        names[118] = "do_DBSCAN_doublezisegmap_47345_dim1";
        values[118] = *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_47329;
    }
    {
        names[119] = "do_DBSCAN_doublezisegmap_47345zisegmap_tblock_sizze_47341";
        values[119] = *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_47329;
    }
    {
        names[120] = "do_DBSCAN_doublezisegscan_47325_dim1";
        values[120] = *ctx->tuning_params.do_DBSCAN_doublezisegscan_tblock_sizze_47319;
    }
    {
        names[121] = "do_DBSCAN_doublezisegscan_47325zisegscan_tblock_sizze_47320";
        values[121] = *ctx->tuning_params.do_DBSCAN_doublezisegscan_tblock_sizze_47319;
    }
    {
        names[122] = "do_DBSCAN_doublezisegscan_47325zichunk_sizze_55572";
        values[122] = smax64((int64_t) 1, smin64(squot64(squot64(ctx->max_shared_memory, ctx->max_thread_block_size), (int64_t) 8), squot64(squot64(ctx->max_registers, ctx->max_thread_block_size) - (int64_t) 1 - squot64(smax64((int64_t) 4, (int64_t) 8), (int64_t) 4), (int64_t) 2 * squot64(smax64((int64_t) 4, (int64_t) 8), (int64_t) 4))));
    }
    {
        names[123] = "do_DBSCAN_doublezisegred_nonseg_47317_dim1";
        values[123] = *ctx->tuning_params.do_DBSCAN_doublezisegred_tblock_sizze_47309;
    }
    {
        names[124] = "do_DBSCAN_doublezisegred_nonseg_47317zisegred_tblock_sizze_47310";
        values[124] = *ctx->tuning_params.do_DBSCAN_doublezisegred_tblock_sizze_47309;
    }
    {
        names[125] = "do_DBSCAN_doublezisegred_nonseg_47317zichunk_sizze_55533";
        values[125] = (int64_t) 1;
    }
    {
        names[126] = "do_DBSCAN_doublezisegred_large_47267_dim1";
        values[126] = *ctx->tuning_params.do_DBSCAN_doublezisegred_tblock_sizze_47176;
    }
    {
        names[127] = "do_DBSCAN_doublezisegred_large_47267zisegred_tblock_sizze_47261";
        values[127] = *ctx->tuning_params.do_DBSCAN_doublezisegred_tblock_sizze_47176;
    }
    {
        names[128] = "do_DBSCAN_doublezisegred_large_47267zichunk_sizze_55460";
        values[128] = (int64_t) 1;
    }
    {
        names[129] = "do_DBSCAN_doublezisegred_small_47267_dim1";
        values[129] = *ctx->tuning_params.do_DBSCAN_doublezisegred_tblock_sizze_47176;
    }
    {
        names[130] = "do_DBSCAN_doublezisegred_small_47267zisegred_tblock_sizze_47261";
        values[130] = *ctx->tuning_params.do_DBSCAN_doublezisegred_tblock_sizze_47176;
    }
    {
        names[131] = "do_DBSCAN_doublezisegmap_47249_dim1";
        values[131] = *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_47228;
    }
    {
        names[132] = "do_DBSCAN_doublezisegmap_47249zisegmap_tblock_sizze_47243";
        values[132] = *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_47228;
    }
    {
        names[133] = "do_DBSCAN_doublezisegmap_intrablock_49824_dim1";
        values[133] = *ctx->tuning_params.do_DBSCAN_doublezitile_sizze_49825;
    }
    {
        names[134] = "do_DBSCAN_doublezisegmap_intrablock_49824zitile_sizze_49826";
        values[134] = *ctx->tuning_params.do_DBSCAN_doublezitile_sizze_49825;
    }
    {
        names[135] = "do_DBSCAN_doublezisegmap_intrablock_49824zibytes_53693";
        values[135] = (int64_t) 8 * *ctx->tuning_params.do_DBSCAN_doublezitile_sizze_49825;
    }
    {
        names[136] = "do_DBSCAN_doublezisegscan_47065_dim1";
        values[136] = *ctx->tuning_params.do_DBSCAN_doublezisegscan_tblock_sizze_47059;
    }
    {
        names[137] = "do_DBSCAN_doublezisegscan_47065zisegscan_tblock_sizze_47060";
        values[137] = *ctx->tuning_params.do_DBSCAN_doublezisegscan_tblock_sizze_47059;
    }
    {
        names[138] = "do_DBSCAN_doublezisegscan_47065zichunk_sizze_55329";
        values[138] = smax64((int64_t) 1, smin64(squot64(squot64(ctx->max_shared_memory, ctx->max_thread_block_size), (int64_t) 8), squot64(squot64(ctx->max_registers, ctx->max_thread_block_size) - (int64_t) 1 - squot64(smax64((int64_t) 4, (int64_t) 8), (int64_t) 4), (int64_t) 2 * squot64(smax64((int64_t) 4, (int64_t) 8), (int64_t) 4))));
    }
    {
        names[139] = "do_DBSCAN_doublezisegmap_47051_dim1";
        values[139] = *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_47053;
    }
    {
        names[140] = "do_DBSCAN_doublezisegmap_47051zisegmap_tblock_sizze_47054";
        values[140] = *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_47053;
    }
    {
        names[141] = "do_DBSCAN_doublezisegscan_47049_dim1";
        values[141] = *ctx->tuning_params.do_DBSCAN_doublezisegscan_tblock_sizze_47043;
    }
    {
        names[142] = "do_DBSCAN_doublezisegscan_47049zisegscan_tblock_sizze_47044";
        values[142] = *ctx->tuning_params.do_DBSCAN_doublezisegscan_tblock_sizze_47043;
    }
    {
        names[143] = "do_DBSCAN_doublezisegscan_47049zichunk_sizze_55212";
        values[143] = smax64((int64_t) 1, smin64(squot64(squot64(ctx->max_shared_memory, ctx->max_thread_block_size), (int64_t) 8), squot64(squot64(ctx->max_registers, ctx->max_thread_block_size) - (int64_t) 1 - squot64(smax64((int64_t) 4, (int64_t) 8), (int64_t) 4), (int64_t) 2 * squot64(smax64((int64_t) 4, (int64_t) 8), (int64_t) 4))));
    }
    {
        names[144] = "do_DBSCAN_doublezisegmap_47036_dim1";
        values[144] = *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_47021;
    }
    {
        names[145] = "do_DBSCAN_doublezisegmap_47036zisegmap_tblock_sizze_47032";
        values[145] = *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_47021;
    }
    {
        names[146] = "do_DBSCAN_doublezisegmap_47011_dim1";
        values[146] = *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_47013;
    }
    {
        names[147] = "do_DBSCAN_doublezisegmap_47011zisegmap_tblock_sizze_47014";
        values[147] = *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_47013;
    }
    {
        names[148] = "do_DBSCAN_doublezisegmap_47003_dim1";
        values[148] = *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_47005;
    }
    {
        names[149] = "do_DBSCAN_doublezisegmap_47003zisegmap_tblock_sizze_47006";
        values[149] = *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_47005;
    }
    {
        names[150] = "do_DBSCAN_doublezisegscan_47001_dim1";
        values[150] = *ctx->tuning_params.do_DBSCAN_doublezisegscan_tblock_sizze_46995;
    }
    {
        names[151] = "do_DBSCAN_doublezisegscan_47001zisegscan_tblock_sizze_46996";
        values[151] = *ctx->tuning_params.do_DBSCAN_doublezisegscan_tblock_sizze_46995;
    }
    {
        names[152] = "do_DBSCAN_doublezisegscan_47001zichunk_sizze_55074";
        values[152] = smax64((int64_t) 1, smin64(squot64(squot64(ctx->max_shared_memory, ctx->max_thread_block_size), (int64_t) 8), squot64(squot64(ctx->max_registers, ctx->max_thread_block_size) - (int64_t) 1 - squot64(smax64((int64_t) 4, (int64_t) 8), (int64_t) 4), (int64_t) 2 * squot64(smax64((int64_t) 4, (int64_t) 8), (int64_t) 4))));
    }
    {
        names[153] = "do_DBSCAN_doublezisegmap_46987_dim1";
        values[153] = *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_46989;
    }
    {
        names[154] = "do_DBSCAN_doublezisegmap_46987zisegmap_tblock_sizze_46990";
        values[154] = *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_46989;
    }
    {
        names[155] = "do_DBSCAN_doublezisegscan_46985_dim1";
        values[155] = *ctx->tuning_params.do_DBSCAN_doublezisegscan_tblock_sizze_46979;
    }
    {
        names[156] = "do_DBSCAN_doublezisegscan_46985zisegscan_tblock_sizze_46980";
        values[156] = *ctx->tuning_params.do_DBSCAN_doublezisegscan_tblock_sizze_46979;
    }
    {
        names[157] = "do_DBSCAN_doublezisegscan_46985zichunk_sizze_54907";
        values[157] = smax64((int64_t) 1, smin64(squot64(squot64(ctx->max_shared_memory, ctx->max_thread_block_size), (int64_t) 8), squot64(squot64(ctx->max_registers, ctx->max_thread_block_size) - (int64_t) 1 - squot64(smax64((int64_t) 4, (int64_t) 8) + smax64((int64_t) 4, (int64_t) 8), (int64_t) 4), (int64_t) 2 * squot64(smax64((int64_t) 4, (int64_t) 8) + smax64((int64_t) 4, (int64_t) 8), (int64_t) 4))));
    }
    {
        names[158] = "do_DBSCAN_doublezisegmap_46971_dim1";
        values[158] = *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_46973;
    }
    {
        names[159] = "do_DBSCAN_doublezisegmap_46971zisegmap_tblock_sizze_46974";
        values[159] = *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_46973;
    }
    {
        names[160] = "do_DBSCAN_doublezisegscan_46969_dim1";
        values[160] = *ctx->tuning_params.do_DBSCAN_doublezisegscan_tblock_sizze_46963;
    }
    {
        names[161] = "do_DBSCAN_doublezisegscan_46969zisegscan_tblock_sizze_46964";
        values[161] = *ctx->tuning_params.do_DBSCAN_doublezisegscan_tblock_sizze_46963;
    }
    {
        names[162] = "do_DBSCAN_doublezisegscan_46969zichunk_sizze_54791";
        values[162] = smax64((int64_t) 1, smin64(squot64(squot64(ctx->max_shared_memory, ctx->max_thread_block_size), (int64_t) 8), squot64(squot64(ctx->max_registers, ctx->max_thread_block_size) - (int64_t) 1 - squot64(smax64((int64_t) 4, (int64_t) 8), (int64_t) 4), (int64_t) 2 * squot64(smax64((int64_t) 4, (int64_t) 8), (int64_t) 4))));
    }
    {
        names[163] = "do_DBSCAN_doublezigpuseq_54781_dim1";
        values[163] = (int64_t) 1;
    }
    {
        names[164] = "do_DBSCAN_doublezisegmap_46955_dim1";
        values[164] = *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_46957;
    }
    {
        names[165] = "do_DBSCAN_doublezisegmap_46955zisegmap_tblock_sizze_46958";
        values[165] = *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_46957;
    }
    {
        names[166] = "do_DBSCAN_doublezisegscan_46953_dim1";
        values[166] = *ctx->tuning_params.do_DBSCAN_doublezisegscan_tblock_sizze_46947;
    }
    {
        names[167] = "do_DBSCAN_doublezisegscan_46953zisegscan_tblock_sizze_46948";
        values[167] = *ctx->tuning_params.do_DBSCAN_doublezisegscan_tblock_sizze_46947;
    }
    {
        names[168] = "do_DBSCAN_doublezisegscan_46953zichunk_sizze_54587";
        values[168] = smax64((int64_t) 1, smin64(squot64(squot64(ctx->max_shared_memory, ctx->max_thread_block_size), (int64_t) 8), squot64(squot64(ctx->max_registers, ctx->max_thread_block_size) - (int64_t) 1 - squot64(smax64((int64_t) 4, (int64_t) 8), (int64_t) 4), (int64_t) 2 * squot64(smax64((int64_t) 4, (int64_t) 8), (int64_t) 4))));
    }
    {
        names[169] = "add_next_partition_doublezigpuseq_55663_dim1";
        values[169] = (int64_t) 1;
    }
    {
        names[170] = "add_next_partition_doublezisegmap_46923_dim1";
        values[170] = *ctx->tuning_params.add_next_partition_doublezisegmap_tblock_sizze_46889;
    }
    {
        names[171] = "add_next_partition_doublezisegmap_46923zisegmap_tblock_sizze_46917";
        values[171] = *ctx->tuning_params.add_next_partition_doublezisegmap_tblock_sizze_46889;
    }
    {
        names[172] = "add_next_partition_doublezisegmap_46855_dim1";
        values[172] = *ctx->tuning_params.add_next_partition_doublezisegmap_tblock_sizze_46812;
    }
    {
        names[173] = "add_next_partition_doublezisegmap_46855zisegmap_tblock_sizze_46848";
        values[173] = *ctx->tuning_params.add_next_partition_doublezisegmap_tblock_sizze_46812;
    }
    {
        names[174] = "add_next_partition_doublezisegmap_46802_dim1";
        values[174] = *ctx->tuning_params.add_next_partition_doublezisegmap_tblock_sizze_46804;
    }
    {
        names[175] = "add_next_partition_doublezisegmap_46802zisegmap_tblock_sizze_46805";
        values[175] = *ctx->tuning_params.add_next_partition_doublezisegmap_tblock_sizze_46804;
    }
    {
        names[176] = "add_next_partition_doublezisegmap_46736_dim1";
        values[176] = *ctx->tuning_params.add_next_partition_doublezisegmap_tblock_sizze_46686;
    }
    {
        names[177] = "add_next_partition_doublezisegmap_46736zisegmap_tblock_sizze_46732";
        values[177] = *ctx->tuning_params.add_next_partition_doublezisegmap_tblock_sizze_46686;
    }
    {
        names[178] = "add_next_partition_doublezisegred_large_46644_dim1";
        values[178] = *ctx->tuning_params.add_next_partition_doublezisegred_tblock_sizze_46589;
    }
    {
        names[179] = "add_next_partition_doublezisegred_large_46644zisegred_tblock_sizze_46638";
        values[179] = *ctx->tuning_params.add_next_partition_doublezisegred_tblock_sizze_46589;
    }
    {
        names[180] = "add_next_partition_doublezisegred_large_46644zichunk_sizze_55546";
        values[180] = (int64_t) 1;
    }
    {
        names[181] = "add_next_partition_doublezisegred_small_46644_dim1";
        values[181] = *ctx->tuning_params.add_next_partition_doublezisegred_tblock_sizze_46589;
    }
    {
        names[182] = "add_next_partition_doublezisegred_small_46644zisegred_tblock_sizze_46638";
        values[182] = *ctx->tuning_params.add_next_partition_doublezisegred_tblock_sizze_46589;
    }
    {
        names[183] = "add_next_partition_doublezisegmap_intrablock_50036_dim1";
        values[183] = *ctx->tuning_params.add_next_partition_doublezitile_sizze_50037;
    }
    {
        names[184] = "add_next_partition_doublezisegmap_intrablock_50036zitile_sizze_50038";
        values[184] = *ctx->tuning_params.add_next_partition_doublezitile_sizze_50037;
    }
    {
        names[185] = "add_next_partition_doublezisegmap_intrablock_50036zinum_whole_tiles_50059";
        values[185] = squot_safe64((int64_t) 8, *ctx->tuning_params.add_next_partition_doublezitile_sizze_50037);
    }
    {
        names[186] = "add_next_partition_doublezisegmap_intrablock_50036ziresidual_input_50234";
        values[186] = srem_safe64((int64_t) 8, *ctx->tuning_params.add_next_partition_doublezitile_sizze_50037);
    }
    {
        names[187] = "add_next_partition_doublezisegmap_intrablock_50036zicond_50235";
        values[187] = srem_safe64((int64_t) 8, *ctx->tuning_params.add_next_partition_doublezitile_sizze_50037) == (int64_t) 0;
    }
    {
        names[188] = "add_next_partition_doublezisegmap_intrablock_50036zibinop_x_50245";
        values[188] = *ctx->tuning_params.add_next_partition_doublezitile_sizze_50037 * squot_safe64((int64_t) 8, *ctx->tuning_params.add_next_partition_doublezitile_sizze_50037);
    }
    {
        names[189] = "add_next_partition_doublezisegmap_intrablock_50036zibytes_53686";
        values[189] = (int64_t) 8 * *ctx->tuning_params.add_next_partition_doublezitile_sizze_50037;
    }
    {
        names[190] = "add_next_partition_doublezisegmap_46487_dim1";
        values[190] = *ctx->tuning_params.add_next_partition_doublezisegmap_tblock_sizze_46489;
    }
    {
        names[191] = "add_next_partition_doublezisegmap_46487zisegmap_tblock_sizze_46490";
        values[191] = *ctx->tuning_params.add_next_partition_doublezisegmap_tblock_sizze_46489;
    }
    {
        names[192] = "add_next_partition_doublezisegscan_46800_dim1";
        values[192] = *ctx->tuning_params.add_next_partition_doublezisegscan_tblock_sizze_46794;
    }
    {
        names[193] = "add_next_partition_doublezisegscan_46800zisegscan_tblock_sizze_46795";
        values[193] = *ctx->tuning_params.add_next_partition_doublezisegscan_tblock_sizze_46794;
    }
    {
        names[194] = "add_next_partition_doublezisegscan_46800zichunk_sizze_55321";
        values[194] = smax64((int64_t) 1, smin64(squot64(squot64(ctx->max_shared_memory, ctx->max_thread_block_size), (int64_t) 8), squot64(squot64(ctx->max_registers, ctx->max_thread_block_size) - (int64_t) 1 - squot64(smax64((int64_t) 4, (int64_t) 8) + smax64((int64_t) 4, (int64_t) 8), (int64_t) 4), (int64_t) 2 * squot64(smax64((int64_t) 4, (int64_t) 8) + smax64((int64_t) 4, (int64_t) 8), (int64_t) 4))));
    }
    {
        names[195] = "add_next_partition_doublezisegscan_46485_dim1";
        values[195] = *ctx->tuning_params.add_next_partition_doublezisegscan_tblock_sizze_46479;
    }
    {
        names[196] = "add_next_partition_doublezisegscan_46485zisegscan_tblock_sizze_46480";
        values[196] = *ctx->tuning_params.add_next_partition_doublezisegscan_tblock_sizze_46479;
    }
    {
        names[197] = "add_next_partition_doublezisegscan_46485zichunk_sizze_55219";
        values[197] = smax64((int64_t) 1, smin64(squot64(squot64(ctx->max_shared_memory, ctx->max_thread_block_size), (int64_t) 8), squot64(squot64(ctx->max_registers, ctx->max_thread_block_size) - (int64_t) 1 - squot64(smax64((int64_t) 4, (int64_t) 8), (int64_t) 4), (int64_t) 2 * squot64(smax64((int64_t) 4, (int64_t) 8), (int64_t) 4))));
    }
    {
        names[198] = "add_next_partition_doublezisegmap_46471_dim1";
        values[198] = *ctx->tuning_params.add_next_partition_doublezisegmap_tblock_sizze_46473;
    }
    {
        names[199] = "add_next_partition_doublezisegmap_46471zisegmap_tblock_sizze_46474";
        values[199] = *ctx->tuning_params.add_next_partition_doublezisegmap_tblock_sizze_46473;
    }
    {
        names[200] = "add_next_partition_doublezisegscan_46461_dim1";
        values[200] = *ctx->tuning_params.add_next_partition_doublezisegscan_tblock_sizze_46228;
    }
    {
        names[201] = "add_next_partition_doublezisegscan_46461zisegscan_tblock_sizze_46456";
        values[201] = *ctx->tuning_params.add_next_partition_doublezisegscan_tblock_sizze_46228;
    }
    {
        names[202] = "add_next_partition_doublezisegscan_46461zichunk_sizze_55103";
        values[202] = smax64((int64_t) 1, smin64(squot64(squot64(ctx->max_shared_memory, ctx->max_thread_block_size), (int64_t) 8), squot64(squot64(ctx->max_registers, ctx->max_thread_block_size) - (int64_t) 1 - squot64(smax64((int64_t) 4, (int64_t) 8), (int64_t) 4), (int64_t) 2 * squot64(smax64((int64_t) 4, (int64_t) 8), (int64_t) 4))));
    }
    {
        names[203] = "add_next_partition_doublezisegmap_46408_dim1";
        values[203] = *ctx->tuning_params.add_next_partition_doublezisegmap_tblock_sizze_46063;
    }
    {
        names[204] = "add_next_partition_doublezisegmap_46408zisegmap_tblock_sizze_46403";
        values[204] = *ctx->tuning_params.add_next_partition_doublezisegmap_tblock_sizze_46063;
    }
    {
        names[205] = "add_next_partition_doublezisegred_large_46395_dim1";
        values[205] = *ctx->tuning_params.add_next_partition_doublezisegred_tblock_sizze_46113;
    }
    {
        names[206] = "add_next_partition_doublezisegred_large_46395zisegred_tblock_sizze_46389";
        values[206] = *ctx->tuning_params.add_next_partition_doublezisegred_tblock_sizze_46113;
    }
    {
        names[207] = "add_next_partition_doublezisegred_large_46395zichunk_sizze_55015";
        values[207] = (int64_t) 1;
    }
    {
        names[208] = "add_next_partition_doublezisegred_small_46395_dim1";
        values[208] = *ctx->tuning_params.add_next_partition_doublezisegred_tblock_sizze_46113;
    }
    {
        names[209] = "add_next_partition_doublezisegred_small_46395zisegred_tblock_sizze_46389";
        values[209] = *ctx->tuning_params.add_next_partition_doublezisegred_tblock_sizze_46113;
    }
    {
        names[210] = "add_next_partition_doublezisegmap_46379_dim1";
        values[210] = *ctx->tuning_params.add_next_partition_doublezisegmap_tblock_sizze_46132;
    }
    {
        names[211] = "add_next_partition_doublezisegmap_46379zisegmap_tblock_sizze_46375";
        values[211] = *ctx->tuning_params.add_next_partition_doublezisegmap_tblock_sizze_46132;
    }
    {
        names[212] = "add_next_partition_doublezisegmap_intrablock_49824_dim1";
        values[212] = *ctx->tuning_params.add_next_partition_doublezitile_sizze_49825;
    }
    {
        names[213] = "add_next_partition_doublezisegmap_intrablock_49824zitile_sizze_49826";
        values[213] = *ctx->tuning_params.add_next_partition_doublezitile_sizze_49825;
    }
    {
        names[214] = "add_next_partition_doublezisegmap_intrablock_49824zildim_49827";
        values[214] = sdiv_up_safe64((int64_t) 8, *ctx->tuning_params.add_next_partition_doublezitile_sizze_49825);
    }
    {
        names[215] = "add_next_partition_doublezisegmap_intrablock_49824zibytes_53617";
        values[215] = (int64_t) 8 * *ctx->tuning_params.add_next_partition_doublezitile_sizze_49825;
    }
    {
        names[216] = "add_next_partition_doublezigpuseq_54852_dim1";
        values[216] = (int64_t) 1;
    }
    {
        names[217] = "add_next_partition_doublezigpuseq_54845_dim1";
        values[217] = (int64_t) 1;
    }
    {
        names[218] = "add_next_partition_doublezigpuseq_54839_dim1";
        values[218] = (int64_t) 1;
    }
    {
        names[219] = "add_next_partition_doublezigpuseq_54833_dim1";
        values[219] = (int64_t) 1;
    }
    {
        names[220] = "add_next_partition_doublezigpuseq_54827_dim1";
        values[220] = (int64_t) 1;
    }
    {
        names[221] = "add_next_partition_doublezigpuseq_54821_dim1";
        values[221] = (int64_t) 1;
    }
    {
        names[222] = "add_next_partition_doublezigpuseq_54795_dim1";
        values[222] = (int64_t) 1;
    }
    {
        names[223] = "add_next_partition_doublezisegmap_46786_dim1";
        values[223] = *ctx->tuning_params.add_next_partition_doublezisegmap_tblock_sizze_46788;
    }
    {
        names[224] = "add_next_partition_doublezisegmap_46786zisegmap_tblock_sizze_46789";
        values[224] = *ctx->tuning_params.add_next_partition_doublezisegmap_tblock_sizze_46788;
    }
    {
        names[225] = "add_next_partition_doublezisegscan_46784_dim1";
        values[225] = *ctx->tuning_params.add_next_partition_doublezisegscan_tblock_sizze_46778;
    }
    {
        names[226] = "add_next_partition_doublezisegscan_46784zisegscan_tblock_sizze_46779";
        values[226] = *ctx->tuning_params.add_next_partition_doublezisegscan_tblock_sizze_46778;
    }
    {
        names[227] = "add_next_partition_doublezisegscan_46784zichunk_sizze_54593";
        values[227] = smax64((int64_t) 1, smin64(squot64(squot64(ctx->max_shared_memory, ctx->max_thread_block_size), (int64_t) 8), squot64(squot64(ctx->max_registers, ctx->max_thread_block_size) - (int64_t) 1 - squot64(smax64((int64_t) 4, (int64_t) 8) + smax64((int64_t) 4, (int64_t) 8), (int64_t) 4), (int64_t) 2 * squot64(smax64((int64_t) 4, (int64_t) 8) + smax64((int64_t) 4, (int64_t) 8), (int64_t) 4))));
    }
    *names_out = names;
    *values_out = values;
    return num_macros;
}
static char *get_failure_msg(int failure_idx, int64_t args[])
{
    (void) args;
    switch (failure_idx) {
        
      case 0:
        {
            return msgprintf("division by zero\n-> #0  ft_libs/ftDBSCAN_plus.fut:254:43-67\n   #1  ft_libs/ftDBSCAN_plus.fut:877:18-882:84\n   #2  ft_libs/ftDBSCAN_plus.fut:876:9-882:84\n");
            break;
        }
        
      case 1:
        {
            return msgprintf("division by zero\n-> #0  ft_libs/ftDBSCAN_plus.fut:405:87-111\n   #1  /prelude/functional.fut:9:44-45\n   #2  ft_libs/ftDBSCAN_plus.fut:877:18-882:84\n   #3  ft_libs/ftDBSCAN_plus.fut:876:9-882:84\n");
            break;
        }
        
      case 2:
        {
            return msgprintf("Index [%lld] out of bounds for array of shape [%lld].\n-> #0  ft_libs/ftDBSCAN_plus.fut:282:76-99\n   #1  /prelude/functional.fut:9:44-45\n   #2  ft_libs/ftDBSCAN_plus.fut:282:56-101\n   #3  ft_libs/ftDBSCAN_plus.fut:877:18-882:84\n   #4  ft_libs/ftDBSCAN_plus.fut:876:9-882:84\n", args[0], args[1]);
            break;
        }
        
      case 3:
        {
            return msgprintf("division by zero\n-> #0  ft_libs/ftDBSCAN_plus.fut:317:56-80\n   #1  /prelude/functional.fut:9:44-45\n   #2  ft_libs/ftDBSCAN_plus.fut:877:18-882:84\n   #3  ft_libs/ftDBSCAN_plus.fut:876:9-882:84\n");
            break;
        }
        
      case 4:
        {
            return msgprintf("Index [%lld] out of bounds for array of shape [%lld].\n-> #0  ft_libs/ftDBSCAN_plus.fut:282:76-99\n   #1  /prelude/functional.fut:9:44-45\n   #2  ft_libs/ftDBSCAN_plus.fut:282:56-101\n   #3  ft_libs/ftDBSCAN_plus.fut:877:18-882:84\n   #4  ft_libs/ftDBSCAN_plus.fut:876:9-882:84\n", args[0], args[1]);
            break;
        }
        
      case 5:
        {
            return msgprintf("division by zero\n-> #0  ft_libs/ftDBSCAN_plus.fut:317:56-80\n   #1  /prelude/functional.fut:9:44-45\n   #2  ft_libs/ftDBSCAN_plus.fut:877:18-882:84\n   #3  ft_libs/ftDBSCAN_plus.fut:876:9-882:84\n");
            break;
        }
        
      case 6:
        {
            return msgprintf("Index [%lld] out of bounds for array of shape [%lld].\n-> #0  ft_libs/ftDBSCAN_plus.fut:282:76-99\n   #1  /prelude/functional.fut:9:44-45\n   #2  ft_libs/ftDBSCAN_plus.fut:282:56-101\n   #3  ft_libs/ftDBSCAN_plus.fut:877:18-882:84\n   #4  ft_libs/ftDBSCAN_plus.fut:876:9-882:84\n", args[0], args[1]);
            break;
        }
        
      case 7:
        {
            return msgprintf("division by zero\n-> #0  ft_libs/ftDBSCAN_plus.fut:317:56-80\n   #1  /prelude/functional.fut:9:44-45\n   #2  ft_libs/ftDBSCAN_plus.fut:877:18-882:84\n   #3  ft_libs/ftDBSCAN_plus.fut:876:9-882:84\n");
            break;
        }
        
      case 8:
        {
            return msgprintf("Index [%lld] out of bounds for array of shape [%lld].\n-> #0  ft_libs/ftDBSCAN_plus.fut:334:53-75\n   #1  /prelude/soacs.fut:255:31-32\n   #2  /prelude/soacs.fut:255:48-50\n   #3  /prelude/functional.fut:9:44-45\n   #4  ft_libs/ftDBSCAN_plus.fut:877:18-882:84\n   #5  ft_libs/ftDBSCAN_plus.fut:876:9-882:84\n", args[0], args[1]);
            break;
        }
        
      case 9:
        {
            return msgprintf("Index [%lld] out of bounds for array of shape [%lld].\n-> #0  ft_libs/ftDBSCAN_plus.fut:404:79-110\n   #1  /prelude/functional.fut:9:44-45\n   #2  ft_libs/ftDBSCAN_plus.fut:877:18-882:84\n   #3  ft_libs/ftDBSCAN_plus.fut:876:9-882:84\n", args[0], args[1]);
            break;
        }
        
      case 10:
        {
            return msgprintf("division by zero\n-> #0  ft_libs/ftDBSCAN_plus.fut:340:56-80\n   #1  /prelude/soacs.fut:205:28-30\n   #2  /prelude/functional.fut:9:44-45\n   #3  ft_libs/ftDBSCAN_plus.fut:338:43-350:34\n   #4  /prelude/functional.fut:9:44-45\n   #5  ft_libs/ftDBSCAN_plus.fut:877:18-882:84\n   #6  ft_libs/ftDBSCAN_plus.fut:876:9-882:84\n");
            break;
        }
        
      case 11:
        {
            return msgprintf("division by zero\n-> #0  ft_libs/ftDBSCAN_plus.fut:340:56-80\n   #1  /prelude/soacs.fut:205:28-30\n   #2  /prelude/functional.fut:9:44-45\n   #3  ft_libs/ftDBSCAN_plus.fut:338:43-350:34\n   #4  /prelude/functional.fut:9:44-45\n   #5  ft_libs/ftDBSCAN_plus.fut:877:18-882:84\n   #6  ft_libs/ftDBSCAN_plus.fut:876:9-882:84\n");
            break;
        }
        
      case 12:
        {
            return msgprintf("division by zero\n-> #0  ft_libs/ftDBSCAN_plus.fut:340:56-80\n   #1  /prelude/soacs.fut:205:28-30\n   #2  /prelude/functional.fut:9:44-45\n   #3  ft_libs/ftDBSCAN_plus.fut:338:43-350:34\n   #4  /prelude/functional.fut:9:44-45\n   #5  ft_libs/ftDBSCAN_plus.fut:877:18-882:84\n   #6  ft_libs/ftDBSCAN_plus.fut:876:9-882:84\n");
            break;
        }
        
      case 13:
        {
            return msgprintf("division by zero\n-> #0  ft_libs/ftDBSCAN_plus.fut:340:56-80\n   #1  /prelude/soacs.fut:205:28-30\n   #2  /prelude/functional.fut:9:44-45\n   #3  ft_libs/ftDBSCAN_plus.fut:338:43-350:34\n   #4  /prelude/functional.fut:9:44-45\n   #5  ft_libs/ftDBSCAN_plus.fut:877:18-882:84\n   #6  ft_libs/ftDBSCAN_plus.fut:876:9-882:84\n");
            break;
        }
        
      case 14:
        {
            return msgprintf("division by zero\n-> #0  ft_libs/ftDBSCAN_plus.fut:357:64-88\n   #1  /prelude/soacs.fut:205:28-30\n   #2  /prelude/functional.fut:9:44-45\n   #3  ft_libs/ftDBSCAN_plus.fut:355:52-367:42\n   #4  /prelude/functional.fut:9:44-45\n   #5  ft_libs/ftDBSCAN_plus.fut:877:18-882:84\n   #6  ft_libs/ftDBSCAN_plus.fut:876:9-882:84\n");
            break;
        }
        
      case 15:
        {
            return msgprintf("Index [%lld] out of bounds for array of shape [%lld].\n-> #0  ft_libs/ftDBSCAN_plus.fut:424:60-72\n   #1  /prelude/functional.fut:9:44-45\n   #2  ft_libs/ftDBSCAN_plus.fut:424:44-102\n   #3  ft_libs/ftDBSCAN_plus.fut:877:18-882:84\n   #4  ft_libs/ftDBSCAN_plus.fut:876:9-882:84\n", args[0], args[1]);
            break;
        }
        
      case 16:
        {
            return msgprintf("Index [%lld] out of bounds for array of shape [%lld].\n-> #0  ft_libs/ftDBSCAN_plus.fut:424:74-86\n   #1  /prelude/functional.fut:9:44-45\n   #2  ft_libs/ftDBSCAN_plus.fut:424:44-102\n   #3  ft_libs/ftDBSCAN_plus.fut:877:18-882:84\n   #4  ft_libs/ftDBSCAN_plus.fut:876:9-882:84\n", args[0], args[1]);
            break;
        }
        
      case 17:
        {
            return msgprintf("Index [%lld] out of bounds for array of shape [%lld].\n-> #0  ft_libs/ftDBSCAN_plus.fut:424:88-100\n   #1  /prelude/functional.fut:9:44-45\n   #2  ft_libs/ftDBSCAN_plus.fut:424:44-102\n   #3  ft_libs/ftDBSCAN_plus.fut:877:18-882:84\n   #4  ft_libs/ftDBSCAN_plus.fut:876:9-882:84\n", args[0], args[1]);
            break;
        }
        
      case 18:
        {
            return msgprintf("Index [%lld] out of bounds for array of shape [%lld].\n-> #0  ft_libs/ftDBSCAN_plus.fut:428:60-72\n   #1  /prelude/functional.fut:9:44-45\n   #2  ft_libs/ftDBSCAN_plus.fut:428:44-88\n   #3  ft_libs/ftDBSCAN_plus.fut:877:18-882:84\n   #4  ft_libs/ftDBSCAN_plus.fut:876:9-882:84\n", args[0], args[1]);
            break;
        }
        
      case 19:
        {
            return msgprintf("Index [%lld] out of bounds for array of shape [%lld].\n-> #0  ft_libs/ftDBSCAN_plus.fut:428:74-86\n   #1  /prelude/functional.fut:9:44-45\n   #2  ft_libs/ftDBSCAN_plus.fut:428:44-88\n   #3  ft_libs/ftDBSCAN_plus.fut:877:18-882:84\n   #4  ft_libs/ftDBSCAN_plus.fut:876:9-882:84\n", args[0], args[1]);
            break;
        }
        
      case 20:
        {
            return msgprintf("Index [%lld] out of bounds for array of shape [%lld].\n-> #0  ft_libs/ftDBSCAN_plus.fut:681:103-125\n   #1  /prelude/functional.fut:9:44-45\n   #2  ft_libs/ftDBSCAN_plus.fut:681:44-130\n   #3  ft_libs/ftDBSCAN_plus.fut:890:18-893:67\n   #4  ft_libs/ftDBSCAN_plus.fut:889:9-893:67\n", args[0], args[1]);
            break;
        }
        
      case 21:
        {
            return msgprintf("Index [%lld] out of bounds for array of shape [%lld].\n-> #0  ft_libs/ftbasics.fut:35:14-19\n   #1  /prelude/functional.fut:9:44-45\n   #2  ft_libs/ftbasics.fut:33:10-37:8\n   #3  ft_libs/ftDBSCAN_plus.fut:890:18-893:67\n   #4  ft_libs/ftDBSCAN_plus.fut:889:9-893:67\n", args[0], args[1]);
            break;
        }
        
      case 22:
        {
            return msgprintf("Index [%lld] out of bounds for array of shape [%lld].\n-> #0  ft_libs/ftDBSCAN_plus.fut:804:66-71\n   #1  /prelude/functional.fut:9:44-45\n   #2  ft_libs/ftDBSCAN_plus.fut:896:18-898:58\n   #3  ft_libs/ftDBSCAN_plus.fut:895:9-898:68\n", args[0], args[1]);
            break;
        }
        
      case 23:
        {
            return msgprintf("Index [%lld] out of bounds for array of shape [%lld].\n-> #0  ft_libs/ftDBSCAN_plus.fut:804:66-71\n   #1  /prelude/functional.fut:9:44-45\n   #2  ft_libs/ftDBSCAN_plus.fut:896:18-898:58\n   #3  ft_libs/ftDBSCAN_plus.fut:895:9-898:68\n", args[0], args[1]);
            break;
        }
    }
    return strdup("Unknown error.  This is a compiler bug.");
}
struct program {
    int dummy;
    gpu_kernel add_next_partition_doublezigpuseq_54795;
    gpu_kernel add_next_partition_doublezigpuseq_54821;
    gpu_kernel add_next_partition_doublezigpuseq_54827;
    gpu_kernel add_next_partition_doublezigpuseq_54833;
    gpu_kernel add_next_partition_doublezigpuseq_54839;
    gpu_kernel add_next_partition_doublezigpuseq_54845;
    gpu_kernel add_next_partition_doublezigpuseq_54852;
    gpu_kernel add_next_partition_doublezigpuseq_55663;
    gpu_kernel add_next_partition_doublezisegmap_46379;
    gpu_kernel add_next_partition_doublezisegmap_46408;
    gpu_kernel add_next_partition_doublezisegmap_46471;
    gpu_kernel add_next_partition_doublezisegmap_46487;
    gpu_kernel add_next_partition_doublezisegmap_46736;
    gpu_kernel add_next_partition_doublezisegmap_46786;
    gpu_kernel add_next_partition_doublezisegmap_46802;
    gpu_kernel add_next_partition_doublezisegmap_46855;
    gpu_kernel add_next_partition_doublezisegmap_46923;
    gpu_kernel add_next_partition_doublezisegmap_intrablock_46316;
    gpu_kernel add_next_partition_doublezisegmap_intrablock_49824;
    gpu_kernel add_next_partition_doublezisegmap_intrablock_50036;
    gpu_kernel add_next_partition_doublezisegred_large_46395;
    gpu_kernel add_next_partition_doublezisegred_large_46644;
    gpu_kernel add_next_partition_doublezisegred_small_46395;
    gpu_kernel add_next_partition_doublezisegred_small_46644;
    gpu_kernel add_next_partition_doublezisegscan_46461;
    gpu_kernel add_next_partition_doublezisegscan_46485;
    gpu_kernel add_next_partition_doublezisegscan_46784;
    gpu_kernel add_next_partition_doublezisegscan_46800;
    gpu_kernel builtinzhiota_i64ziiota_i64_54730;
    gpu_kernel builtinzhreplicate_boolzireplicate_55479;
    gpu_kernel builtinzhreplicate_f64zireplicate_54806;
    gpu_kernel builtinzhreplicate_i32zireplicate_54632;
    gpu_kernel builtinzhreplicate_i64zireplicate_54547;
    gpu_kernel builtinzhreplicate_i8zireplicate_54597;
    gpu_kernel do_DBSCAN_doublezigpuseq_54781;
    gpu_kernel do_DBSCAN_doublezigpuseq_56885;
    gpu_kernel do_DBSCAN_doublezisegmap_46955;
    gpu_kernel do_DBSCAN_doublezisegmap_46971;
    gpu_kernel do_DBSCAN_doublezisegmap_46987;
    gpu_kernel do_DBSCAN_doublezisegmap_47003;
    gpu_kernel do_DBSCAN_doublezisegmap_47011;
    gpu_kernel do_DBSCAN_doublezisegmap_47036;
    gpu_kernel do_DBSCAN_doublezisegmap_47051;
    gpu_kernel do_DBSCAN_doublezisegmap_47249;
    gpu_kernel do_DBSCAN_doublezisegmap_47345;
    gpu_kernel do_DBSCAN_doublezisegmap_47376;
    gpu_kernel do_DBSCAN_doublezisegmap_47403;
    gpu_kernel do_DBSCAN_doublezisegmap_47407;
    gpu_kernel do_DBSCAN_doublezisegmap_47820;
    gpu_kernel do_DBSCAN_doublezisegmap_48163;
    gpu_kernel do_DBSCAN_doublezisegmap_48383;
    gpu_kernel do_DBSCAN_doublezisegmap_48450;
    gpu_kernel do_DBSCAN_doublezisegmap_48458;
    gpu_kernel do_DBSCAN_doublezisegmap_48910;
    gpu_kernel do_DBSCAN_doublezisegmap_49121;
    gpu_kernel do_DBSCAN_doublezisegmap_intrablock_49824;
    gpu_kernel do_DBSCAN_doublezisegmap_intrablock_50204;
    gpu_kernel do_DBSCAN_doublezisegmap_intrablock_50559;
    gpu_kernel do_DBSCAN_doublezisegmap_intrablock_50914;
    gpu_kernel do_DBSCAN_doublezisegmap_intrablock_51193;
    gpu_kernel do_DBSCAN_doublezisegmap_intrablock_51472;
    gpu_kernel do_DBSCAN_doublezisegmap_intrablock_51881;
    gpu_kernel do_DBSCAN_doublezisegmap_intrablock_52263;
    gpu_kernel do_DBSCAN_doublezisegmap_intrablock_52645;
    gpu_kernel do_DBSCAN_doublezisegred_large_47267;
    gpu_kernel do_DBSCAN_doublezisegred_large_48402;
    gpu_kernel do_DBSCAN_doublezisegred_large_49140;
    gpu_kernel do_DBSCAN_doublezisegred_nonseg_47317;
    gpu_kernel do_DBSCAN_doublezisegred_nonseg_49196;
    gpu_kernel do_DBSCAN_doublezisegred_nonseg_49206;
    gpu_kernel do_DBSCAN_doublezisegred_small_47267;
    gpu_kernel do_DBSCAN_doublezisegred_small_48402;
    gpu_kernel do_DBSCAN_doublezisegred_small_49140;
    gpu_kernel do_DBSCAN_doublezisegscan_46953;
    gpu_kernel do_DBSCAN_doublezisegscan_46969;
    gpu_kernel do_DBSCAN_doublezisegscan_46985;
    gpu_kernel do_DBSCAN_doublezisegscan_47001;
    gpu_kernel do_DBSCAN_doublezisegscan_47049;
    gpu_kernel do_DBSCAN_doublezisegscan_47065;
    gpu_kernel do_DBSCAN_doublezisegscan_47325;
    gpu_kernel do_DBSCAN_doublezisegscan_47812;
    gpu_kernel do_DBSCAN_doublezisegscan_48125;
    gpu_kernel do_DBSCAN_doublezisegscan_48902;
    gpu_kernel get_num_neighbours_against_10103zisegmap_49384;
    gpu_kernel get_num_neighbours_against_10103zisegmap_intrablock_49824;
    gpu_kernel get_num_neighbours_against_10103zisegred_large_49402;
    gpu_kernel get_num_neighbours_against_10103zisegred_small_49402;
    gpu_kernel get_num_neighbours_against_10106zisegmap_49618;
    gpu_kernel get_num_neighbours_against_10106zisegmap_intrablock_49824;
    gpu_kernel get_num_neighbours_against_10106zisegred_large_49636;
    gpu_kernel get_num_neighbours_against_10106zisegred_small_49636;
    gpu_kernel make_collisions_compact_doublezisegmap_45656;
    gpu_kernel make_collisions_compact_doublezisegmap_intrablock_49824;
    gpu_kernel make_collisions_compact_doublezisegmap_intrablock_50093;
    gpu_kernel make_collisions_compact_doublezisegscan_45654;
    gpu_kernel mk_dbcHandler_doublezigpuseq_54642;
    gpu_kernel next_partition_to_read_doublezigpuseq_54544;
    gpu_kernel next_partition_to_read_doublezigpuseq_54757;
    gpu_kernel next_partition_to_read_doublezisegmap_45493;
    gpu_kernel next_partition_to_read_doublezisegred_nonseg_45483;
    gpu_kernel next_partition_to_read_doublezisegscan_45491;
    gpu_kernel rectify_partition_ids_doublezisegmap_intrablock_49824;
    gpu_kernel rectify_partition_ids_doublezisegmap_intrablock_50068;
};
static void setup_program(struct futhark_context *ctx)
{
    (void) ctx;
    
    int error = 0;
    
    (void) error;
    ctx->program = malloc(sizeof(struct program));
    gpu_create_kernel(ctx, &ctx->program->add_next_partition_doublezigpuseq_54795, "add_next_partition_doublezigpuseq_54795");
    gpu_create_kernel(ctx, &ctx->program->add_next_partition_doublezigpuseq_54821, "add_next_partition_doublezigpuseq_54821");
    gpu_create_kernel(ctx, &ctx->program->add_next_partition_doublezigpuseq_54827, "add_next_partition_doublezigpuseq_54827");
    gpu_create_kernel(ctx, &ctx->program->add_next_partition_doublezigpuseq_54833, "add_next_partition_doublezigpuseq_54833");
    gpu_create_kernel(ctx, &ctx->program->add_next_partition_doublezigpuseq_54839, "add_next_partition_doublezigpuseq_54839");
    gpu_create_kernel(ctx, &ctx->program->add_next_partition_doublezigpuseq_54845, "add_next_partition_doublezigpuseq_54845");
    gpu_create_kernel(ctx, &ctx->program->add_next_partition_doublezigpuseq_54852, "add_next_partition_doublezigpuseq_54852");
    gpu_create_kernel(ctx, &ctx->program->add_next_partition_doublezigpuseq_55663, "add_next_partition_doublezigpuseq_55663");
    gpu_create_kernel(ctx, &ctx->program->add_next_partition_doublezisegmap_46379, "add_next_partition_doublezisegmap_46379");
    gpu_create_kernel(ctx, &ctx->program->add_next_partition_doublezisegmap_46408, "add_next_partition_doublezisegmap_46408");
    gpu_create_kernel(ctx, &ctx->program->add_next_partition_doublezisegmap_46471, "add_next_partition_doublezisegmap_46471");
    gpu_create_kernel(ctx, &ctx->program->add_next_partition_doublezisegmap_46487, "add_next_partition_doublezisegmap_46487");
    gpu_create_kernel(ctx, &ctx->program->add_next_partition_doublezisegmap_46736, "add_next_partition_doublezisegmap_46736");
    gpu_create_kernel(ctx, &ctx->program->add_next_partition_doublezisegmap_46786, "add_next_partition_doublezisegmap_46786");
    gpu_create_kernel(ctx, &ctx->program->add_next_partition_doublezisegmap_46802, "add_next_partition_doublezisegmap_46802");
    gpu_create_kernel(ctx, &ctx->program->add_next_partition_doublezisegmap_46855, "add_next_partition_doublezisegmap_46855");
    gpu_create_kernel(ctx, &ctx->program->add_next_partition_doublezisegmap_46923, "add_next_partition_doublezisegmap_46923");
    gpu_create_kernel(ctx, &ctx->program->add_next_partition_doublezisegmap_intrablock_46316, "add_next_partition_doublezisegmap_intrablock_46316");
    gpu_create_kernel(ctx, &ctx->program->add_next_partition_doublezisegmap_intrablock_49824, "add_next_partition_doublezisegmap_intrablock_49824");
    gpu_create_kernel(ctx, &ctx->program->add_next_partition_doublezisegmap_intrablock_50036, "add_next_partition_doublezisegmap_intrablock_50036");
    gpu_create_kernel(ctx, &ctx->program->add_next_partition_doublezisegred_large_46395, "add_next_partition_doublezisegred_large_46395");
    gpu_create_kernel(ctx, &ctx->program->add_next_partition_doublezisegred_large_46644, "add_next_partition_doublezisegred_large_46644");
    gpu_create_kernel(ctx, &ctx->program->add_next_partition_doublezisegred_small_46395, "add_next_partition_doublezisegred_small_46395");
    gpu_create_kernel(ctx, &ctx->program->add_next_partition_doublezisegred_small_46644, "add_next_partition_doublezisegred_small_46644");
    gpu_create_kernel(ctx, &ctx->program->add_next_partition_doublezisegscan_46461, "add_next_partition_doublezisegscan_46461");
    gpu_create_kernel(ctx, &ctx->program->add_next_partition_doublezisegscan_46485, "add_next_partition_doublezisegscan_46485");
    gpu_create_kernel(ctx, &ctx->program->add_next_partition_doublezisegscan_46784, "add_next_partition_doublezisegscan_46784");
    gpu_create_kernel(ctx, &ctx->program->add_next_partition_doublezisegscan_46800, "add_next_partition_doublezisegscan_46800");
    gpu_create_kernel(ctx, &ctx->program->builtinzhiota_i64ziiota_i64_54730, "builtinzhiota_i64ziiota_i64_54730");
    gpu_create_kernel(ctx, &ctx->program->builtinzhreplicate_boolzireplicate_55479, "builtinzhreplicate_boolzireplicate_55479");
    gpu_create_kernel(ctx, &ctx->program->builtinzhreplicate_f64zireplicate_54806, "builtinzhreplicate_f64zireplicate_54806");
    gpu_create_kernel(ctx, &ctx->program->builtinzhreplicate_i32zireplicate_54632, "builtinzhreplicate_i32zireplicate_54632");
    gpu_create_kernel(ctx, &ctx->program->builtinzhreplicate_i64zireplicate_54547, "builtinzhreplicate_i64zireplicate_54547");
    gpu_create_kernel(ctx, &ctx->program->builtinzhreplicate_i8zireplicate_54597, "builtinzhreplicate_i8zireplicate_54597");
    gpu_create_kernel(ctx, &ctx->program->do_DBSCAN_doublezigpuseq_54781, "do_DBSCAN_doublezigpuseq_54781");
    gpu_create_kernel(ctx, &ctx->program->do_DBSCAN_doublezigpuseq_56885, "do_DBSCAN_doublezigpuseq_56885");
    gpu_create_kernel(ctx, &ctx->program->do_DBSCAN_doublezisegmap_46955, "do_DBSCAN_doublezisegmap_46955");
    gpu_create_kernel(ctx, &ctx->program->do_DBSCAN_doublezisegmap_46971, "do_DBSCAN_doublezisegmap_46971");
    gpu_create_kernel(ctx, &ctx->program->do_DBSCAN_doublezisegmap_46987, "do_DBSCAN_doublezisegmap_46987");
    gpu_create_kernel(ctx, &ctx->program->do_DBSCAN_doublezisegmap_47003, "do_DBSCAN_doublezisegmap_47003");
    gpu_create_kernel(ctx, &ctx->program->do_DBSCAN_doublezisegmap_47011, "do_DBSCAN_doublezisegmap_47011");
    gpu_create_kernel(ctx, &ctx->program->do_DBSCAN_doublezisegmap_47036, "do_DBSCAN_doublezisegmap_47036");
    gpu_create_kernel(ctx, &ctx->program->do_DBSCAN_doublezisegmap_47051, "do_DBSCAN_doublezisegmap_47051");
    gpu_create_kernel(ctx, &ctx->program->do_DBSCAN_doublezisegmap_47249, "do_DBSCAN_doublezisegmap_47249");
    gpu_create_kernel(ctx, &ctx->program->do_DBSCAN_doublezisegmap_47345, "do_DBSCAN_doublezisegmap_47345");
    gpu_create_kernel(ctx, &ctx->program->do_DBSCAN_doublezisegmap_47376, "do_DBSCAN_doublezisegmap_47376");
    gpu_create_kernel(ctx, &ctx->program->do_DBSCAN_doublezisegmap_47403, "do_DBSCAN_doublezisegmap_47403");
    gpu_create_kernel(ctx, &ctx->program->do_DBSCAN_doublezisegmap_47407, "do_DBSCAN_doublezisegmap_47407");
    gpu_create_kernel(ctx, &ctx->program->do_DBSCAN_doublezisegmap_47820, "do_DBSCAN_doublezisegmap_47820");
    gpu_create_kernel(ctx, &ctx->program->do_DBSCAN_doublezisegmap_48163, "do_DBSCAN_doublezisegmap_48163");
    gpu_create_kernel(ctx, &ctx->program->do_DBSCAN_doublezisegmap_48383, "do_DBSCAN_doublezisegmap_48383");
    gpu_create_kernel(ctx, &ctx->program->do_DBSCAN_doublezisegmap_48450, "do_DBSCAN_doublezisegmap_48450");
    gpu_create_kernel(ctx, &ctx->program->do_DBSCAN_doublezisegmap_48458, "do_DBSCAN_doublezisegmap_48458");
    gpu_create_kernel(ctx, &ctx->program->do_DBSCAN_doublezisegmap_48910, "do_DBSCAN_doublezisegmap_48910");
    gpu_create_kernel(ctx, &ctx->program->do_DBSCAN_doublezisegmap_49121, "do_DBSCAN_doublezisegmap_49121");
    gpu_create_kernel(ctx, &ctx->program->do_DBSCAN_doublezisegmap_intrablock_49824, "do_DBSCAN_doublezisegmap_intrablock_49824");
    gpu_create_kernel(ctx, &ctx->program->do_DBSCAN_doublezisegmap_intrablock_50204, "do_DBSCAN_doublezisegmap_intrablock_50204");
    gpu_create_kernel(ctx, &ctx->program->do_DBSCAN_doublezisegmap_intrablock_50559, "do_DBSCAN_doublezisegmap_intrablock_50559");
    gpu_create_kernel(ctx, &ctx->program->do_DBSCAN_doublezisegmap_intrablock_50914, "do_DBSCAN_doublezisegmap_intrablock_50914");
    gpu_create_kernel(ctx, &ctx->program->do_DBSCAN_doublezisegmap_intrablock_51193, "do_DBSCAN_doublezisegmap_intrablock_51193");
    gpu_create_kernel(ctx, &ctx->program->do_DBSCAN_doublezisegmap_intrablock_51472, "do_DBSCAN_doublezisegmap_intrablock_51472");
    gpu_create_kernel(ctx, &ctx->program->do_DBSCAN_doublezisegmap_intrablock_51881, "do_DBSCAN_doublezisegmap_intrablock_51881");
    gpu_create_kernel(ctx, &ctx->program->do_DBSCAN_doublezisegmap_intrablock_52263, "do_DBSCAN_doublezisegmap_intrablock_52263");
    gpu_create_kernel(ctx, &ctx->program->do_DBSCAN_doublezisegmap_intrablock_52645, "do_DBSCAN_doublezisegmap_intrablock_52645");
    gpu_create_kernel(ctx, &ctx->program->do_DBSCAN_doublezisegred_large_47267, "do_DBSCAN_doublezisegred_large_47267");
    gpu_create_kernel(ctx, &ctx->program->do_DBSCAN_doublezisegred_large_48402, "do_DBSCAN_doublezisegred_large_48402");
    gpu_create_kernel(ctx, &ctx->program->do_DBSCAN_doublezisegred_large_49140, "do_DBSCAN_doublezisegred_large_49140");
    gpu_create_kernel(ctx, &ctx->program->do_DBSCAN_doublezisegred_nonseg_47317, "do_DBSCAN_doublezisegred_nonseg_47317");
    gpu_create_kernel(ctx, &ctx->program->do_DBSCAN_doublezisegred_nonseg_49196, "do_DBSCAN_doublezisegred_nonseg_49196");
    gpu_create_kernel(ctx, &ctx->program->do_DBSCAN_doublezisegred_nonseg_49206, "do_DBSCAN_doublezisegred_nonseg_49206");
    gpu_create_kernel(ctx, &ctx->program->do_DBSCAN_doublezisegred_small_47267, "do_DBSCAN_doublezisegred_small_47267");
    gpu_create_kernel(ctx, &ctx->program->do_DBSCAN_doublezisegred_small_48402, "do_DBSCAN_doublezisegred_small_48402");
    gpu_create_kernel(ctx, &ctx->program->do_DBSCAN_doublezisegred_small_49140, "do_DBSCAN_doublezisegred_small_49140");
    gpu_create_kernel(ctx, &ctx->program->do_DBSCAN_doublezisegscan_46953, "do_DBSCAN_doublezisegscan_46953");
    gpu_create_kernel(ctx, &ctx->program->do_DBSCAN_doublezisegscan_46969, "do_DBSCAN_doublezisegscan_46969");
    gpu_create_kernel(ctx, &ctx->program->do_DBSCAN_doublezisegscan_46985, "do_DBSCAN_doublezisegscan_46985");
    gpu_create_kernel(ctx, &ctx->program->do_DBSCAN_doublezisegscan_47001, "do_DBSCAN_doublezisegscan_47001");
    gpu_create_kernel(ctx, &ctx->program->do_DBSCAN_doublezisegscan_47049, "do_DBSCAN_doublezisegscan_47049");
    gpu_create_kernel(ctx, &ctx->program->do_DBSCAN_doublezisegscan_47065, "do_DBSCAN_doublezisegscan_47065");
    gpu_create_kernel(ctx, &ctx->program->do_DBSCAN_doublezisegscan_47325, "do_DBSCAN_doublezisegscan_47325");
    gpu_create_kernel(ctx, &ctx->program->do_DBSCAN_doublezisegscan_47812, "do_DBSCAN_doublezisegscan_47812");
    gpu_create_kernel(ctx, &ctx->program->do_DBSCAN_doublezisegscan_48125, "do_DBSCAN_doublezisegscan_48125");
    gpu_create_kernel(ctx, &ctx->program->do_DBSCAN_doublezisegscan_48902, "do_DBSCAN_doublezisegscan_48902");
    gpu_create_kernel(ctx, &ctx->program->get_num_neighbours_against_10103zisegmap_49384, "get_num_neighbours_against_10103zisegmap_49384");
    gpu_create_kernel(ctx, &ctx->program->get_num_neighbours_against_10103zisegmap_intrablock_49824, "get_num_neighbours_against_10103zisegmap_intrablock_49824");
    gpu_create_kernel(ctx, &ctx->program->get_num_neighbours_against_10103zisegred_large_49402, "get_num_neighbours_against_10103zisegred_large_49402");
    gpu_create_kernel(ctx, &ctx->program->get_num_neighbours_against_10103zisegred_small_49402, "get_num_neighbours_against_10103zisegred_small_49402");
    gpu_create_kernel(ctx, &ctx->program->get_num_neighbours_against_10106zisegmap_49618, "get_num_neighbours_against_10106zisegmap_49618");
    gpu_create_kernel(ctx, &ctx->program->get_num_neighbours_against_10106zisegmap_intrablock_49824, "get_num_neighbours_against_10106zisegmap_intrablock_49824");
    gpu_create_kernel(ctx, &ctx->program->get_num_neighbours_against_10106zisegred_large_49636, "get_num_neighbours_against_10106zisegred_large_49636");
    gpu_create_kernel(ctx, &ctx->program->get_num_neighbours_against_10106zisegred_small_49636, "get_num_neighbours_against_10106zisegred_small_49636");
    gpu_create_kernel(ctx, &ctx->program->make_collisions_compact_doublezisegmap_45656, "make_collisions_compact_doublezisegmap_45656");
    gpu_create_kernel(ctx, &ctx->program->make_collisions_compact_doublezisegmap_intrablock_49824, "make_collisions_compact_doublezisegmap_intrablock_49824");
    gpu_create_kernel(ctx, &ctx->program->make_collisions_compact_doublezisegmap_intrablock_50093, "make_collisions_compact_doublezisegmap_intrablock_50093");
    gpu_create_kernel(ctx, &ctx->program->make_collisions_compact_doublezisegscan_45654, "make_collisions_compact_doublezisegscan_45654");
    gpu_create_kernel(ctx, &ctx->program->mk_dbcHandler_doublezigpuseq_54642, "mk_dbcHandler_doublezigpuseq_54642");
    gpu_create_kernel(ctx, &ctx->program->next_partition_to_read_doublezigpuseq_54544, "next_partition_to_read_doublezigpuseq_54544");
    gpu_create_kernel(ctx, &ctx->program->next_partition_to_read_doublezigpuseq_54757, "next_partition_to_read_doublezigpuseq_54757");
    gpu_create_kernel(ctx, &ctx->program->next_partition_to_read_doublezisegmap_45493, "next_partition_to_read_doublezisegmap_45493");
    gpu_create_kernel(ctx, &ctx->program->next_partition_to_read_doublezisegred_nonseg_45483, "next_partition_to_read_doublezisegred_nonseg_45483");
    gpu_create_kernel(ctx, &ctx->program->next_partition_to_read_doublezisegscan_45491, "next_partition_to_read_doublezisegscan_45491");
    gpu_create_kernel(ctx, &ctx->program->rectify_partition_ids_doublezisegmap_intrablock_49824, "rectify_partition_ids_doublezisegmap_intrablock_49824");
    gpu_create_kernel(ctx, &ctx->program->rectify_partition_ids_doublezisegmap_intrablock_50068, "rectify_partition_ids_doublezisegmap_intrablock_50068");
}
static void teardown_program(struct futhark_context *ctx)
{
    (void) ctx;
    
    int error = 0;
    
    (void) error;
    gpu_free_kernel(ctx, ctx->program->add_next_partition_doublezigpuseq_54795);
    gpu_free_kernel(ctx, ctx->program->add_next_partition_doublezigpuseq_54821);
    gpu_free_kernel(ctx, ctx->program->add_next_partition_doublezigpuseq_54827);
    gpu_free_kernel(ctx, ctx->program->add_next_partition_doublezigpuseq_54833);
    gpu_free_kernel(ctx, ctx->program->add_next_partition_doublezigpuseq_54839);
    gpu_free_kernel(ctx, ctx->program->add_next_partition_doublezigpuseq_54845);
    gpu_free_kernel(ctx, ctx->program->add_next_partition_doublezigpuseq_54852);
    gpu_free_kernel(ctx, ctx->program->add_next_partition_doublezigpuseq_55663);
    gpu_free_kernel(ctx, ctx->program->add_next_partition_doublezisegmap_46379);
    gpu_free_kernel(ctx, ctx->program->add_next_partition_doublezisegmap_46408);
    gpu_free_kernel(ctx, ctx->program->add_next_partition_doublezisegmap_46471);
    gpu_free_kernel(ctx, ctx->program->add_next_partition_doublezisegmap_46487);
    gpu_free_kernel(ctx, ctx->program->add_next_partition_doublezisegmap_46736);
    gpu_free_kernel(ctx, ctx->program->add_next_partition_doublezisegmap_46786);
    gpu_free_kernel(ctx, ctx->program->add_next_partition_doublezisegmap_46802);
    gpu_free_kernel(ctx, ctx->program->add_next_partition_doublezisegmap_46855);
    gpu_free_kernel(ctx, ctx->program->add_next_partition_doublezisegmap_46923);
    gpu_free_kernel(ctx, ctx->program->add_next_partition_doublezisegmap_intrablock_46316);
    gpu_free_kernel(ctx, ctx->program->add_next_partition_doublezisegmap_intrablock_49824);
    gpu_free_kernel(ctx, ctx->program->add_next_partition_doublezisegmap_intrablock_50036);
    gpu_free_kernel(ctx, ctx->program->add_next_partition_doublezisegred_large_46395);
    gpu_free_kernel(ctx, ctx->program->add_next_partition_doublezisegred_large_46644);
    gpu_free_kernel(ctx, ctx->program->add_next_partition_doublezisegred_small_46395);
    gpu_free_kernel(ctx, ctx->program->add_next_partition_doublezisegred_small_46644);
    gpu_free_kernel(ctx, ctx->program->add_next_partition_doublezisegscan_46461);
    gpu_free_kernel(ctx, ctx->program->add_next_partition_doublezisegscan_46485);
    gpu_free_kernel(ctx, ctx->program->add_next_partition_doublezisegscan_46784);
    gpu_free_kernel(ctx, ctx->program->add_next_partition_doublezisegscan_46800);
    gpu_free_kernel(ctx, ctx->program->builtinzhiota_i64ziiota_i64_54730);
    gpu_free_kernel(ctx, ctx->program->builtinzhreplicate_boolzireplicate_55479);
    gpu_free_kernel(ctx, ctx->program->builtinzhreplicate_f64zireplicate_54806);
    gpu_free_kernel(ctx, ctx->program->builtinzhreplicate_i32zireplicate_54632);
    gpu_free_kernel(ctx, ctx->program->builtinzhreplicate_i64zireplicate_54547);
    gpu_free_kernel(ctx, ctx->program->builtinzhreplicate_i8zireplicate_54597);
    gpu_free_kernel(ctx, ctx->program->do_DBSCAN_doublezigpuseq_54781);
    gpu_free_kernel(ctx, ctx->program->do_DBSCAN_doublezigpuseq_56885);
    gpu_free_kernel(ctx, ctx->program->do_DBSCAN_doublezisegmap_46955);
    gpu_free_kernel(ctx, ctx->program->do_DBSCAN_doublezisegmap_46971);
    gpu_free_kernel(ctx, ctx->program->do_DBSCAN_doublezisegmap_46987);
    gpu_free_kernel(ctx, ctx->program->do_DBSCAN_doublezisegmap_47003);
    gpu_free_kernel(ctx, ctx->program->do_DBSCAN_doublezisegmap_47011);
    gpu_free_kernel(ctx, ctx->program->do_DBSCAN_doublezisegmap_47036);
    gpu_free_kernel(ctx, ctx->program->do_DBSCAN_doublezisegmap_47051);
    gpu_free_kernel(ctx, ctx->program->do_DBSCAN_doublezisegmap_47249);
    gpu_free_kernel(ctx, ctx->program->do_DBSCAN_doublezisegmap_47345);
    gpu_free_kernel(ctx, ctx->program->do_DBSCAN_doublezisegmap_47376);
    gpu_free_kernel(ctx, ctx->program->do_DBSCAN_doublezisegmap_47403);
    gpu_free_kernel(ctx, ctx->program->do_DBSCAN_doublezisegmap_47407);
    gpu_free_kernel(ctx, ctx->program->do_DBSCAN_doublezisegmap_47820);
    gpu_free_kernel(ctx, ctx->program->do_DBSCAN_doublezisegmap_48163);
    gpu_free_kernel(ctx, ctx->program->do_DBSCAN_doublezisegmap_48383);
    gpu_free_kernel(ctx, ctx->program->do_DBSCAN_doublezisegmap_48450);
    gpu_free_kernel(ctx, ctx->program->do_DBSCAN_doublezisegmap_48458);
    gpu_free_kernel(ctx, ctx->program->do_DBSCAN_doublezisegmap_48910);
    gpu_free_kernel(ctx, ctx->program->do_DBSCAN_doublezisegmap_49121);
    gpu_free_kernel(ctx, ctx->program->do_DBSCAN_doublezisegmap_intrablock_49824);
    gpu_free_kernel(ctx, ctx->program->do_DBSCAN_doublezisegmap_intrablock_50204);
    gpu_free_kernel(ctx, ctx->program->do_DBSCAN_doublezisegmap_intrablock_50559);
    gpu_free_kernel(ctx, ctx->program->do_DBSCAN_doublezisegmap_intrablock_50914);
    gpu_free_kernel(ctx, ctx->program->do_DBSCAN_doublezisegmap_intrablock_51193);
    gpu_free_kernel(ctx, ctx->program->do_DBSCAN_doublezisegmap_intrablock_51472);
    gpu_free_kernel(ctx, ctx->program->do_DBSCAN_doublezisegmap_intrablock_51881);
    gpu_free_kernel(ctx, ctx->program->do_DBSCAN_doublezisegmap_intrablock_52263);
    gpu_free_kernel(ctx, ctx->program->do_DBSCAN_doublezisegmap_intrablock_52645);
    gpu_free_kernel(ctx, ctx->program->do_DBSCAN_doublezisegred_large_47267);
    gpu_free_kernel(ctx, ctx->program->do_DBSCAN_doublezisegred_large_48402);
    gpu_free_kernel(ctx, ctx->program->do_DBSCAN_doublezisegred_large_49140);
    gpu_free_kernel(ctx, ctx->program->do_DBSCAN_doublezisegred_nonseg_47317);
    gpu_free_kernel(ctx, ctx->program->do_DBSCAN_doublezisegred_nonseg_49196);
    gpu_free_kernel(ctx, ctx->program->do_DBSCAN_doublezisegred_nonseg_49206);
    gpu_free_kernel(ctx, ctx->program->do_DBSCAN_doublezisegred_small_47267);
    gpu_free_kernel(ctx, ctx->program->do_DBSCAN_doublezisegred_small_48402);
    gpu_free_kernel(ctx, ctx->program->do_DBSCAN_doublezisegred_small_49140);
    gpu_free_kernel(ctx, ctx->program->do_DBSCAN_doublezisegscan_46953);
    gpu_free_kernel(ctx, ctx->program->do_DBSCAN_doublezisegscan_46969);
    gpu_free_kernel(ctx, ctx->program->do_DBSCAN_doublezisegscan_46985);
    gpu_free_kernel(ctx, ctx->program->do_DBSCAN_doublezisegscan_47001);
    gpu_free_kernel(ctx, ctx->program->do_DBSCAN_doublezisegscan_47049);
    gpu_free_kernel(ctx, ctx->program->do_DBSCAN_doublezisegscan_47065);
    gpu_free_kernel(ctx, ctx->program->do_DBSCAN_doublezisegscan_47325);
    gpu_free_kernel(ctx, ctx->program->do_DBSCAN_doublezisegscan_47812);
    gpu_free_kernel(ctx, ctx->program->do_DBSCAN_doublezisegscan_48125);
    gpu_free_kernel(ctx, ctx->program->do_DBSCAN_doublezisegscan_48902);
    gpu_free_kernel(ctx, ctx->program->get_num_neighbours_against_10103zisegmap_49384);
    gpu_free_kernel(ctx, ctx->program->get_num_neighbours_against_10103zisegmap_intrablock_49824);
    gpu_free_kernel(ctx, ctx->program->get_num_neighbours_against_10103zisegred_large_49402);
    gpu_free_kernel(ctx, ctx->program->get_num_neighbours_against_10103zisegred_small_49402);
    gpu_free_kernel(ctx, ctx->program->get_num_neighbours_against_10106zisegmap_49618);
    gpu_free_kernel(ctx, ctx->program->get_num_neighbours_against_10106zisegmap_intrablock_49824);
    gpu_free_kernel(ctx, ctx->program->get_num_neighbours_against_10106zisegred_large_49636);
    gpu_free_kernel(ctx, ctx->program->get_num_neighbours_against_10106zisegred_small_49636);
    gpu_free_kernel(ctx, ctx->program->make_collisions_compact_doublezisegmap_45656);
    gpu_free_kernel(ctx, ctx->program->make_collisions_compact_doublezisegmap_intrablock_49824);
    gpu_free_kernel(ctx, ctx->program->make_collisions_compact_doublezisegmap_intrablock_50093);
    gpu_free_kernel(ctx, ctx->program->make_collisions_compact_doublezisegscan_45654);
    gpu_free_kernel(ctx, ctx->program->mk_dbcHandler_doublezigpuseq_54642);
    gpu_free_kernel(ctx, ctx->program->next_partition_to_read_doublezigpuseq_54544);
    gpu_free_kernel(ctx, ctx->program->next_partition_to_read_doublezigpuseq_54757);
    gpu_free_kernel(ctx, ctx->program->next_partition_to_read_doublezisegmap_45493);
    gpu_free_kernel(ctx, ctx->program->next_partition_to_read_doublezisegred_nonseg_45483);
    gpu_free_kernel(ctx, ctx->program->next_partition_to_read_doublezisegscan_45491);
    gpu_free_kernel(ctx, ctx->program->rectify_partition_ids_doublezisegmap_intrablock_49824);
    gpu_free_kernel(ctx, ctx->program->rectify_partition_ids_doublezisegmap_intrablock_50068);
    free(ctx->program);
}
static void set_tuning_params(struct futhark_context *ctx)
{
    (void) ctx;
    ctx->tuning_params.add_next_partition_doublezisegmap_num_tblocks_46475 = &ctx->cfg->tuning_params[0];
    ctx->tuning_params.add_next_partition_doublezisegmap_num_tblocks_46491 = &ctx->cfg->tuning_params[1];
    ctx->tuning_params.add_next_partition_doublezisegmap_num_tblocks_46790 = &ctx->cfg->tuning_params[2];
    ctx->tuning_params.add_next_partition_doublezisegmap_num_tblocks_46806 = &ctx->cfg->tuning_params[3];
    ctx->tuning_params.add_next_partition_doublezisegmap_tblock_sizze_46063 = &ctx->cfg->tuning_params[4];
    ctx->tuning_params.add_next_partition_doublezisegmap_tblock_sizze_46132 = &ctx->cfg->tuning_params[5];
    ctx->tuning_params.add_next_partition_doublezisegmap_tblock_sizze_46473 = &ctx->cfg->tuning_params[6];
    ctx->tuning_params.add_next_partition_doublezisegmap_tblock_sizze_46489 = &ctx->cfg->tuning_params[7];
    ctx->tuning_params.add_next_partition_doublezisegmap_tblock_sizze_46686 = &ctx->cfg->tuning_params[8];
    ctx->tuning_params.add_next_partition_doublezisegmap_tblock_sizze_46788 = &ctx->cfg->tuning_params[9];
    ctx->tuning_params.add_next_partition_doublezisegmap_tblock_sizze_46804 = &ctx->cfg->tuning_params[10];
    ctx->tuning_params.add_next_partition_doublezisegmap_tblock_sizze_46812 = &ctx->cfg->tuning_params[11];
    ctx->tuning_params.add_next_partition_doublezisegmap_tblock_sizze_46889 = &ctx->cfg->tuning_params[12];
    ctx->tuning_params.add_next_partition_doublezisegred_num_tblocks_46115 = &ctx->cfg->tuning_params[13];
    ctx->tuning_params.add_next_partition_doublezisegred_num_tblocks_46591 = &ctx->cfg->tuning_params[14];
    ctx->tuning_params.add_next_partition_doublezisegred_tblock_sizze_46113 = &ctx->cfg->tuning_params[15];
    ctx->tuning_params.add_next_partition_doublezisegred_tblock_sizze_46589 = &ctx->cfg->tuning_params[16];
    ctx->tuning_params.add_next_partition_doublezisegscan_num_tblocks_45773 = &ctx->cfg->tuning_params[17];
    ctx->tuning_params.add_next_partition_doublezisegscan_num_tblocks_46230 = &ctx->cfg->tuning_params[18];
    ctx->tuning_params.add_next_partition_doublezisegscan_num_tblocks_46481 = &ctx->cfg->tuning_params[19];
    ctx->tuning_params.add_next_partition_doublezisegscan_num_tblocks_46780 = &ctx->cfg->tuning_params[20];
    ctx->tuning_params.add_next_partition_doublezisegscan_num_tblocks_46796 = &ctx->cfg->tuning_params[21];
    ctx->tuning_params.add_next_partition_doublezisegscan_tblock_sizze_45771 = &ctx->cfg->tuning_params[22];
    ctx->tuning_params.add_next_partition_doublezisegscan_tblock_sizze_46228 = &ctx->cfg->tuning_params[23];
    ctx->tuning_params.add_next_partition_doublezisegscan_tblock_sizze_46479 = &ctx->cfg->tuning_params[24];
    ctx->tuning_params.add_next_partition_doublezisegscan_tblock_sizze_46778 = &ctx->cfg->tuning_params[25];
    ctx->tuning_params.add_next_partition_doublezisegscan_tblock_sizze_46794 = &ctx->cfg->tuning_params[26];
    ctx->tuning_params.add_next_partition_doublezisuff_intra_par_2 = &ctx->cfg->tuning_params[27];
    ctx->tuning_params.add_next_partition_doublezisuff_outer_par_1 = &ctx->cfg->tuning_params[28];
    ctx->tuning_params.add_next_partition_doublezisuff_outer_par_3 = &ctx->cfg->tuning_params[29];
    ctx->tuning_params.add_next_partition_doublezisuff_outer_screma_0 = &ctx->cfg->tuning_params[30];
    ctx->tuning_params.add_next_partition_doublezitile_sizze_49825 = &ctx->cfg->tuning_params[31];
    ctx->tuning_params.add_next_partition_doublezitile_sizze_50037 = &ctx->cfg->tuning_params[32];
    ctx->tuning_params.builtinzhiota_i64zitblock_sizze_54734 = &ctx->cfg->tuning_params[33];
    ctx->tuning_params.builtinzhreplicate_boolzitblock_sizze_55483 = &ctx->cfg->tuning_params[34];
    ctx->tuning_params.builtinzhreplicate_f64zitblock_sizze_54810 = &ctx->cfg->tuning_params[35];
    ctx->tuning_params.builtinzhreplicate_i32zitblock_sizze_54636 = &ctx->cfg->tuning_params[36];
    ctx->tuning_params.builtinzhreplicate_i64zitblock_sizze_54551 = &ctx->cfg->tuning_params[37];
    ctx->tuning_params.builtinzhreplicate_i8zitblock_sizze_54601 = &ctx->cfg->tuning_params[38];
    ctx->tuning_params.do_DBSCAN_doublezisegmap_num_tblocks_46959 = &ctx->cfg->tuning_params[39];
    ctx->tuning_params.do_DBSCAN_doublezisegmap_num_tblocks_46975 = &ctx->cfg->tuning_params[40];
    ctx->tuning_params.do_DBSCAN_doublezisegmap_num_tblocks_46991 = &ctx->cfg->tuning_params[41];
    ctx->tuning_params.do_DBSCAN_doublezisegmap_num_tblocks_47007 = &ctx->cfg->tuning_params[42];
    ctx->tuning_params.do_DBSCAN_doublezisegmap_num_tblocks_47015 = &ctx->cfg->tuning_params[43];
    ctx->tuning_params.do_DBSCAN_doublezisegmap_num_tblocks_47055 = &ctx->cfg->tuning_params[44];
    ctx->tuning_params.do_DBSCAN_doublezisegmap_num_tblocks_47411 = &ctx->cfg->tuning_params[45];
    ctx->tuning_params.do_DBSCAN_doublezisegmap_num_tblocks_47824 = &ctx->cfg->tuning_params[46];
    ctx->tuning_params.do_DBSCAN_doublezisegmap_num_tblocks_48454 = &ctx->cfg->tuning_params[47];
    ctx->tuning_params.do_DBSCAN_doublezisegmap_num_tblocks_48462 = &ctx->cfg->tuning_params[48];
    ctx->tuning_params.do_DBSCAN_doublezisegmap_num_tblocks_48914 = &ctx->cfg->tuning_params[49];
    ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_46957 = &ctx->cfg->tuning_params[50];
    ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_46973 = &ctx->cfg->tuning_params[51];
    ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_46989 = &ctx->cfg->tuning_params[52];
    ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_47005 = &ctx->cfg->tuning_params[53];
    ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_47013 = &ctx->cfg->tuning_params[54];
    ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_47021 = &ctx->cfg->tuning_params[55];
    ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_47053 = &ctx->cfg->tuning_params[56];
    ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_47228 = &ctx->cfg->tuning_params[57];
    ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_47329 = &ctx->cfg->tuning_params[58];
    ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_47355 = &ctx->cfg->tuning_params[59];
    ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_47391 = &ctx->cfg->tuning_params[60];
    ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_47409 = &ctx->cfg->tuning_params[61];
    ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_47822 = &ctx->cfg->tuning_params[62];
    ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_48136 = &ctx->cfg->tuning_params[63];
    ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_48362 = &ctx->cfg->tuning_params[64];
    ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_48452 = &ctx->cfg->tuning_params[65];
    ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_48460 = &ctx->cfg->tuning_params[66];
    ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_48912 = &ctx->cfg->tuning_params[67];
    ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_49100 = &ctx->cfg->tuning_params[68];
    ctx->tuning_params.do_DBSCAN_doublezisegred_num_tblocks_47178 = &ctx->cfg->tuning_params[69];
    ctx->tuning_params.do_DBSCAN_doublezisegred_num_tblocks_47311 = &ctx->cfg->tuning_params[70];
    ctx->tuning_params.do_DBSCAN_doublezisegred_num_tblocks_48306 = &ctx->cfg->tuning_params[71];
    ctx->tuning_params.do_DBSCAN_doublezisegred_num_tblocks_49044 = &ctx->cfg->tuning_params[72];
    ctx->tuning_params.do_DBSCAN_doublezisegred_num_tblocks_49190 = &ctx->cfg->tuning_params[73];
    ctx->tuning_params.do_DBSCAN_doublezisegred_num_tblocks_49200 = &ctx->cfg->tuning_params[74];
    ctx->tuning_params.do_DBSCAN_doublezisegred_tblock_sizze_47176 = &ctx->cfg->tuning_params[75];
    ctx->tuning_params.do_DBSCAN_doublezisegred_tblock_sizze_47309 = &ctx->cfg->tuning_params[76];
    ctx->tuning_params.do_DBSCAN_doublezisegred_tblock_sizze_48304 = &ctx->cfg->tuning_params[77];
    ctx->tuning_params.do_DBSCAN_doublezisegred_tblock_sizze_49042 = &ctx->cfg->tuning_params[78];
    ctx->tuning_params.do_DBSCAN_doublezisegred_tblock_sizze_49188 = &ctx->cfg->tuning_params[79];
    ctx->tuning_params.do_DBSCAN_doublezisegred_tblock_sizze_49198 = &ctx->cfg->tuning_params[80];
    ctx->tuning_params.do_DBSCAN_doublezisegscan_num_tblocks_46949 = &ctx->cfg->tuning_params[81];
    ctx->tuning_params.do_DBSCAN_doublezisegscan_num_tblocks_46965 = &ctx->cfg->tuning_params[82];
    ctx->tuning_params.do_DBSCAN_doublezisegscan_num_tblocks_46981 = &ctx->cfg->tuning_params[83];
    ctx->tuning_params.do_DBSCAN_doublezisegscan_num_tblocks_46997 = &ctx->cfg->tuning_params[84];
    ctx->tuning_params.do_DBSCAN_doublezisegscan_num_tblocks_47045 = &ctx->cfg->tuning_params[85];
    ctx->tuning_params.do_DBSCAN_doublezisegscan_num_tblocks_47061 = &ctx->cfg->tuning_params[86];
    ctx->tuning_params.do_DBSCAN_doublezisegscan_num_tblocks_47321 = &ctx->cfg->tuning_params[87];
    ctx->tuning_params.do_DBSCAN_doublezisegscan_num_tblocks_47448 = &ctx->cfg->tuning_params[88];
    ctx->tuning_params.do_DBSCAN_doublezisegscan_num_tblocks_47708 = &ctx->cfg->tuning_params[89];
    ctx->tuning_params.do_DBSCAN_doublezisegscan_num_tblocks_47832 = &ctx->cfg->tuning_params[90];
    ctx->tuning_params.do_DBSCAN_doublezisegscan_num_tblocks_48039 = &ctx->cfg->tuning_params[91];
    ctx->tuning_params.do_DBSCAN_doublezisegscan_num_tblocks_48470 = &ctx->cfg->tuning_params[92];
    ctx->tuning_params.do_DBSCAN_doublezisegscan_num_tblocks_48780 = &ctx->cfg->tuning_params[93];
    ctx->tuning_params.do_DBSCAN_doublezisegscan_tblock_sizze_46947 = &ctx->cfg->tuning_params[94];
    ctx->tuning_params.do_DBSCAN_doublezisegscan_tblock_sizze_46963 = &ctx->cfg->tuning_params[95];
    ctx->tuning_params.do_DBSCAN_doublezisegscan_tblock_sizze_46979 = &ctx->cfg->tuning_params[96];
    ctx->tuning_params.do_DBSCAN_doublezisegscan_tblock_sizze_46995 = &ctx->cfg->tuning_params[97];
    ctx->tuning_params.do_DBSCAN_doublezisegscan_tblock_sizze_47043 = &ctx->cfg->tuning_params[98];
    ctx->tuning_params.do_DBSCAN_doublezisegscan_tblock_sizze_47059 = &ctx->cfg->tuning_params[99];
    ctx->tuning_params.do_DBSCAN_doublezisegscan_tblock_sizze_47319 = &ctx->cfg->tuning_params[100];
    ctx->tuning_params.do_DBSCAN_doublezisegscan_tblock_sizze_47446 = &ctx->cfg->tuning_params[101];
    ctx->tuning_params.do_DBSCAN_doublezisegscan_tblock_sizze_47706 = &ctx->cfg->tuning_params[102];
    ctx->tuning_params.do_DBSCAN_doublezisegscan_tblock_sizze_47830 = &ctx->cfg->tuning_params[103];
    ctx->tuning_params.do_DBSCAN_doublezisegscan_tblock_sizze_48037 = &ctx->cfg->tuning_params[104];
    ctx->tuning_params.do_DBSCAN_doublezisegscan_tblock_sizze_48468 = &ctx->cfg->tuning_params[105];
    ctx->tuning_params.do_DBSCAN_doublezisegscan_tblock_sizze_48778 = &ctx->cfg->tuning_params[106];
    ctx->tuning_params.do_DBSCAN_doublezisuff_outer_par_0 = &ctx->cfg->tuning_params[107];
    ctx->tuning_params.do_DBSCAN_doublezisuff_outer_par_2 = &ctx->cfg->tuning_params[108];
    ctx->tuning_params.do_DBSCAN_doublezisuff_outer_par_4 = &ctx->cfg->tuning_params[109];
    ctx->tuning_params.do_DBSCAN_doublezisuff_outer_par_5 = &ctx->cfg->tuning_params[110];
    ctx->tuning_params.do_DBSCAN_doublezisuff_outer_par_7 = &ctx->cfg->tuning_params[111];
    ctx->tuning_params.do_DBSCAN_doublezisuff_outer_par_8 = &ctx->cfg->tuning_params[112];
    ctx->tuning_params.do_DBSCAN_doublezisuff_outer_screma_1 = &ctx->cfg->tuning_params[113];
    ctx->tuning_params.do_DBSCAN_doublezisuff_outer_screma_3 = &ctx->cfg->tuning_params[114];
    ctx->tuning_params.do_DBSCAN_doublezisuff_outer_screma_6 = &ctx->cfg->tuning_params[115];
    ctx->tuning_params.do_DBSCAN_doublezitile_sizze_49825 = &ctx->cfg->tuning_params[116];
    ctx->tuning_params.do_DBSCAN_doublezitile_sizze_50205 = &ctx->cfg->tuning_params[117];
    ctx->tuning_params.do_DBSCAN_doublezitile_sizze_50560 = &ctx->cfg->tuning_params[118];
    ctx->tuning_params.do_DBSCAN_doublezitile_sizze_50915 = &ctx->cfg->tuning_params[119];
    ctx->tuning_params.do_DBSCAN_doublezitile_sizze_51194 = &ctx->cfg->tuning_params[120];
    ctx->tuning_params.do_DBSCAN_doublezitile_sizze_51473 = &ctx->cfg->tuning_params[121];
    ctx->tuning_params.do_DBSCAN_doublezitile_sizze_51882 = &ctx->cfg->tuning_params[122];
    ctx->tuning_params.do_DBSCAN_doublezitile_sizze_52264 = &ctx->cfg->tuning_params[123];
    ctx->tuning_params.do_DBSCAN_doublezitile_sizze_52646 = &ctx->cfg->tuning_params[124];
    ctx->tuning_params.get_num_neighbours_against_10103zisegmap_tblock_sizze_49363 = &ctx->cfg->tuning_params[125];
    ctx->tuning_params.get_num_neighbours_against_10103zisegred_num_tblocks_49315 = &ctx->cfg->tuning_params[126];
    ctx->tuning_params.get_num_neighbours_against_10103zisegred_tblock_sizze_49313 = &ctx->cfg->tuning_params[127];
    ctx->tuning_params.get_num_neighbours_against_10103zisuff_outer_par_0 = &ctx->cfg->tuning_params[128];
    ctx->tuning_params.get_num_neighbours_against_10103zitile_sizze_49825 = &ctx->cfg->tuning_params[129];
    ctx->tuning_params.get_num_neighbours_against_10106zisegmap_tblock_sizze_49597 = &ctx->cfg->tuning_params[130];
    ctx->tuning_params.get_num_neighbours_against_10106zisegred_num_tblocks_49549 = &ctx->cfg->tuning_params[131];
    ctx->tuning_params.get_num_neighbours_against_10106zisegred_tblock_sizze_49547 = &ctx->cfg->tuning_params[132];
    ctx->tuning_params.get_num_neighbours_against_10106zisuff_outer_par_0 = &ctx->cfg->tuning_params[133];
    ctx->tuning_params.get_num_neighbours_against_10106zitile_sizze_49825 = &ctx->cfg->tuning_params[134];
    ctx->tuning_params.make_collisions_compact_doublezisegmap_num_tblocks_45660 = &ctx->cfg->tuning_params[135];
    ctx->tuning_params.make_collisions_compact_doublezisegmap_tblock_sizze_45658 = &ctx->cfg->tuning_params[136];
    ctx->tuning_params.make_collisions_compact_doublezisegscan_num_tblocks_45650 = &ctx->cfg->tuning_params[137];
    ctx->tuning_params.make_collisions_compact_doublezisegscan_tblock_sizze_45648 = &ctx->cfg->tuning_params[138];
    ctx->tuning_params.make_collisions_compact_doublezisuff_outer_par_0 = &ctx->cfg->tuning_params[139];
    ctx->tuning_params.make_collisions_compact_doublezitile_sizze_49825 = &ctx->cfg->tuning_params[140];
    ctx->tuning_params.make_collisions_compact_doublezitile_sizze_50094 = &ctx->cfg->tuning_params[141];
    ctx->tuning_params.next_partition_to_read_doublezisegmap_num_tblocks_45497 = &ctx->cfg->tuning_params[142];
    ctx->tuning_params.next_partition_to_read_doublezisegmap_tblock_sizze_45495 = &ctx->cfg->tuning_params[143];
    ctx->tuning_params.next_partition_to_read_doublezisegred_num_tblocks_45477 = &ctx->cfg->tuning_params[144];
    ctx->tuning_params.next_partition_to_read_doublezisegred_tblock_sizze_45475 = &ctx->cfg->tuning_params[145];
    ctx->tuning_params.next_partition_to_read_doublezisegscan_num_tblocks_45487 = &ctx->cfg->tuning_params[146];
    ctx->tuning_params.next_partition_to_read_doublezisegscan_tblock_sizze_45485 = &ctx->cfg->tuning_params[147];
    ctx->tuning_params.rectify_partition_ids_doublezisuff_outer_par_0 = &ctx->cfg->tuning_params[148];
    ctx->tuning_params.rectify_partition_ids_doublezitile_sizze_49825 = &ctx->cfg->tuning_params[149];
    ctx->tuning_params.rectify_partition_ids_doublezitile_sizze_50069 = &ctx->cfg->tuning_params[150];
}
int memblock_unref_device(struct futhark_context *ctx, struct memblock_device *block, const char *desc)
{
    if (block->references != NULL) {
        *block->references -= 1;
        if (ctx->detail_memory)
            fprintf(ctx->log, "Unreferencing block %s (allocated as %s) in %s: %d references remaining.\n", desc, block->desc, "space 'device'", *block->references);
        if (*block->references == 0) {
            ctx->cur_mem_usage_device -= block->size;
            (void) gpu_free(ctx, block->mem, block->size, desc);
            free(block->references);
            if (ctx->detail_memory)
                fprintf(ctx->log, "%lld bytes freed (now allocated: %lld bytes)\n", (long long) block->size, (long long) ctx->cur_mem_usage_device);
        }
        block->references = NULL;
    }
    return 0;
}
int memblock_alloc_device(struct futhark_context *ctx, struct memblock_device *block, int64_t size, const char *desc)
{
    if (size < 0)
        futhark_panic(1, "Negative allocation of %lld bytes attempted for %s in %s.\n", (long long) size, desc, "space 'device'", ctx->cur_mem_usage_device);
    
    int ret = memblock_unref_device(ctx, block, desc);
    
    if (ret != FUTHARK_SUCCESS)
        return ret;
    if (ctx->detail_memory)
        fprintf(ctx->log, "Allocating %lld bytes for %s in %s (currently allocated: %lld bytes).\n", (long long) size, desc, "space 'device'", (long long) ctx->cur_mem_usage_device);
    (void) gpu_alloc(ctx, ctx->log, (size_t) size, desc, &block->mem, (size_t *) &size);
    if (ctx->error == NULL) {
        block->references = (int *) malloc(sizeof(int));
        *block->references = 1;
        block->size = size;
        block->desc = desc;
        
        long long new_usage = ctx->cur_mem_usage_device + size;
        
        if (ctx->detail_memory)
            fprintf(ctx->log, "Received block of %lld bytes; now allocated: %lld bytes", (long long) block->size, new_usage);
        ctx->cur_mem_usage_device = new_usage;
        if (new_usage > ctx->peak_mem_usage_device) {
            ctx->peak_mem_usage_device = new_usage;
            if (ctx->detail_memory)
                fprintf(ctx->log, " (new peak).\n");
        } else if (ctx->detail_memory)
            fprintf(ctx->log, ".\n");
        return FUTHARK_SUCCESS;
    } else {
        // We are naively assuming that any memory allocation error is due to OOM.
        lock_lock(&ctx->error_lock);
        
        char *old_error = ctx->error;
        
        ctx->error = msgprintf("Failed to allocate memory in %s.\nAttempted allocation: %12lld bytes\nCurrently allocated:  %12lld bytes\n%s", "space 'device'", (long long) size, (long long) ctx->cur_mem_usage_device, old_error);
        free(old_error);
        lock_unlock(&ctx->error_lock);
        return FUTHARK_OUT_OF_MEMORY;
    }
}
int memblock_set_device(struct futhark_context *ctx, struct memblock_device *lhs, struct memblock_device *rhs, const char *lhs_desc)
{
    int ret = memblock_unref_device(ctx, lhs, lhs_desc);
    
    if (rhs->references != NULL)
        (*rhs->references)++;
    *lhs = *rhs;
    return ret;
}
int memblock_unref(struct futhark_context *ctx, struct memblock *block, const char *desc)
{
    if (block->references != NULL) {
        *block->references -= 1;
        if (ctx->detail_memory)
            fprintf(ctx->log, "Unreferencing block %s (allocated as %s) in %s: %d references remaining.\n", desc, block->desc, "default space", *block->references);
        if (*block->references == 0) {
            ctx->cur_mem_usage_default -= block->size;
            host_free(ctx, (size_t) block->size, desc, (void *) block->mem);
            free(block->references);
            if (ctx->detail_memory)
                fprintf(ctx->log, "%lld bytes freed (now allocated: %lld bytes)\n", (long long) block->size, (long long) ctx->cur_mem_usage_default);
        }
        block->references = NULL;
    }
    return 0;
}
int memblock_alloc(struct futhark_context *ctx, struct memblock *block, int64_t size, const char *desc)
{
    if (size < 0)
        futhark_panic(1, "Negative allocation of %lld bytes attempted for %s in %s.\n", (long long) size, desc, "default space", ctx->cur_mem_usage_default);
    
    int ret = memblock_unref(ctx, block, desc);
    
    if (ret != FUTHARK_SUCCESS)
        return ret;
    if (ctx->detail_memory)
        fprintf(ctx->log, "Allocating %lld bytes for %s in %s (currently allocated: %lld bytes).\n", (long long) size, desc, "default space", (long long) ctx->cur_mem_usage_default);
    host_alloc(ctx, (size_t) size, desc, (size_t *) &size, (void *) &block->mem);
    if (ctx->error == NULL) {
        block->references = (int *) malloc(sizeof(int));
        *block->references = 1;
        block->size = size;
        block->desc = desc;
        
        long long new_usage = ctx->cur_mem_usage_default + size;
        
        if (ctx->detail_memory)
            fprintf(ctx->log, "Received block of %lld bytes; now allocated: %lld bytes", (long long) block->size, new_usage);
        ctx->cur_mem_usage_default = new_usage;
        if (new_usage > ctx->peak_mem_usage_default) {
            ctx->peak_mem_usage_default = new_usage;
            if (ctx->detail_memory)
                fprintf(ctx->log, " (new peak).\n");
        } else if (ctx->detail_memory)
            fprintf(ctx->log, ".\n");
        return FUTHARK_SUCCESS;
    } else {
        // We are naively assuming that any memory allocation error is due to OOM.
        lock_lock(&ctx->error_lock);
        
        char *old_error = ctx->error;
        
        ctx->error = msgprintf("Failed to allocate memory in %s.\nAttempted allocation: %12lld bytes\nCurrently allocated:  %12lld bytes\n%s", "default space", (long long) size, (long long) ctx->cur_mem_usage_default, old_error);
        free(old_error);
        lock_unlock(&ctx->error_lock);
        return FUTHARK_OUT_OF_MEMORY;
    }
}
int memblock_set(struct futhark_context *ctx, struct memblock *lhs, struct memblock *rhs, const char *lhs_desc)
{
    int ret = memblock_unref(ctx, lhs, lhs_desc);
    
    if (rhs->references != NULL)
        (*rhs->references)++;
    *lhs = *rhs;
    return ret;
}
char *futhark_context_report(struct futhark_context *ctx)
{
    if (futhark_context_sync(ctx) != 0)
        return NULL;
    
    struct str_builder builder;
    
    str_builder_init(&builder);
    str_builder_char(&builder, '{');
    str_builder_str(&builder, "\"memory\":{");
    str_builder(&builder, "\"space 'device'\": %lld", (long long) ctx->peak_mem_usage_device);
    str_builder_char(&builder, ',');
    str_builder(&builder, "\"default space\": %lld", (long long) ctx->peak_mem_usage_default);
    str_builder_str(&builder, "},\"events\":[");
    if (report_events_in_list(&ctx->event_list, &builder) != 0) {
        free(builder.str);
        return NULL;
    } else {
        str_builder_str(&builder, "]}");
        return builder.str;
    }
}
int futhark_context_clear_caches(struct futhark_context *ctx)
{
    lock_lock(&ctx->lock);
    CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
    ctx->peak_mem_usage_device = 0;
    ctx->peak_mem_usage_default = 0;
    if (ctx->error == NULL)
        gpu_free_all(ctx);
    CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
    lock_unlock(&ctx->lock);
    return ctx->error != NULL;
}

// Start of context.h

// Internal functions.

static void set_error(struct futhark_context* ctx, char *error) {
  lock_lock(&ctx->error_lock);
  if (ctx->error == NULL) {
    ctx->error = error;
  } else {
    free(error);
  }
  lock_unlock(&ctx->error_lock);
}

// XXX: should be static, but used in ispc_util.h
void lexical_realloc_error(struct futhark_context* ctx, size_t new_size) {
  set_error(ctx,
            msgprintf("Failed to allocate memory.\nAttempted allocation: %12lld bytes\n",
                      (long long) new_size));
}

static int lexical_realloc(struct futhark_context *ctx,
                           unsigned char **ptr,
                           int64_t *old_size,
                           int64_t new_size) {
  unsigned char *new = realloc(*ptr, (size_t)new_size);
  if (new == NULL) {
    lexical_realloc_error(ctx, new_size);
    return FUTHARK_OUT_OF_MEMORY;
  } else {
    *ptr = new;
    *old_size = new_size;
    return FUTHARK_SUCCESS;
  }
}

static void free_all_in_free_list(struct futhark_context* ctx) {
  fl_mem mem;
  free_list_pack(&ctx->free_list);
  while (free_list_first(&ctx->free_list, (fl_mem*)&mem) == 0) {
    free((void*)mem);
  }
}

static int is_small_alloc(size_t size) {
  return size < 1024*1024;
}

static void host_alloc(struct futhark_context* ctx,
                       size_t size, const char* tag, size_t* size_out, void** mem_out) {
  if (is_small_alloc(size) || free_list_find(&ctx->free_list, size, tag, size_out, (fl_mem*)mem_out) != 0) {
    *size_out = size;
    *mem_out = malloc(size);
  }
}

static void host_free(struct futhark_context* ctx,
                      size_t size, const char* tag, void* mem) {
  // Small allocations are handled by malloc()s own free list.  The
  // threshold here is kind of arbitrary, but seems to work OK.
  // Larger allocations are mmap()ed/munmapped() every time, which is
  // very slow, and Futhark programs tend to use a few very large
  // allocations.
  if (is_small_alloc(size)) {
    free(mem);
  } else {
    free_list_insert(&ctx->free_list, size, (fl_mem)mem, tag);
  }
}

static void add_event(struct futhark_context* ctx,
                      const char* name,
                      char* description,
                      void* data,
                      event_report_fn f) {
  if (ctx->logging) {
    fprintf(ctx->log, "Event: %s\n%s\n", name, description);
  }
  add_event_to_list(&ctx->event_list, name, description, data, f);
}

char *futhark_context_get_error(struct futhark_context *ctx) {
  char *error = ctx->error;
  ctx->error = NULL;
  return error;
}

void futhark_context_config_set_debugging(struct futhark_context_config *cfg, int flag) {
    cfg->profiling = cfg->logging = cfg->debugging = flag;
}

void futhark_context_config_set_profiling(struct futhark_context_config *cfg, int flag) {
    cfg->profiling = flag;
}

void futhark_context_config_set_logging(struct futhark_context_config *cfg, int flag) {
    cfg->logging = flag;
}

void futhark_context_config_set_cache_file(struct futhark_context_config *cfg, const char *f) {
  cfg->cache_fname = strdup(f);
}

int futhark_get_tuning_param_count(void) {
  return num_tuning_params;
}

const char *futhark_get_tuning_param_name(int i) {
  return tuning_param_names[i];
}

const char *futhark_get_tuning_param_class(int i) {
    return tuning_param_classes[i];
}

void futhark_context_set_logging_file(struct futhark_context *ctx, FILE *f){
  ctx->log = f;
}

void futhark_context_pause_profiling(struct futhark_context *ctx) {
  ctx->profiling_paused = 1;
}

void futhark_context_unpause_profiling(struct futhark_context *ctx) {
  ctx->profiling_paused = 0;
}

struct futhark_context_config* futhark_context_config_new(void) {
  struct futhark_context_config* cfg = malloc(sizeof(struct futhark_context_config));
  if (cfg == NULL) {
    return NULL;
  }
  cfg->in_use = 0;
  cfg->debugging = 0;
  cfg->profiling = 0;
  cfg->logging = 0;
  cfg->cache_fname = NULL;
  cfg->num_tuning_params = num_tuning_params;
  cfg->tuning_params = malloc(cfg->num_tuning_params * sizeof(int64_t));
  memcpy(cfg->tuning_params, tuning_param_defaults,
         cfg->num_tuning_params * sizeof(int64_t));
  cfg->tuning_param_names = tuning_param_names;
  cfg->tuning_param_vars = tuning_param_vars;
  cfg->tuning_param_classes = tuning_param_classes;
  backend_context_config_setup(cfg);
  return cfg;
}

void futhark_context_config_free(struct futhark_context_config* cfg) {
  assert(!cfg->in_use);
  backend_context_config_teardown(cfg);
  free(cfg->cache_fname);
  free(cfg->tuning_params);
  free(cfg);
}

struct futhark_context* futhark_context_new(struct futhark_context_config* cfg) {
  struct futhark_context* ctx = malloc(sizeof(struct futhark_context));
  if (ctx == NULL) {
    return NULL;
  }
  assert(!cfg->in_use);
  ctx->cfg = cfg;
  ctx->cfg->in_use = 1;
  ctx->program_initialised = false;
  create_lock(&ctx->error_lock);
  create_lock(&ctx->lock);
  free_list_init(&ctx->free_list);
  event_list_init(&ctx->event_list);
  ctx->peak_mem_usage_default = 0;
  ctx->cur_mem_usage_default = 0;
  ctx->constants = malloc(sizeof(struct constants));
  ctx->debugging = cfg->debugging;
  ctx->logging = cfg->logging;
  ctx->detail_memory = cfg->logging;
  ctx->profiling = cfg->profiling;
  ctx->profiling_paused = 0;
  ctx->error = NULL;
  ctx->log = stderr;
  set_tuning_params(ctx);
  if (backend_context_setup(ctx) == 0) {
    setup_program(ctx);
    init_constants(ctx);
    ctx->program_initialised = true;
    (void)futhark_context_clear_caches(ctx);
    (void)futhark_context_sync(ctx);
  }
  return ctx;
}

void futhark_context_free(struct futhark_context* ctx) {
  if (ctx->program_initialised) {
    free_constants(ctx);
    teardown_program(ctx);
  }
  backend_context_teardown(ctx);
  free_all_in_free_list(ctx);
  free_list_destroy(&ctx->free_list);
  event_list_free(&ctx->event_list);
  free(ctx->constants);
  free(ctx->error);
  free_lock(&ctx->lock);
  free_lock(&ctx->error_lock);
  ctx->cfg->in_use = 0;
  free(ctx);
}

// End of context.h

// Start of copy.h

// Cache-oblivious map-transpose function.
#define GEN_MAP_TRANSPOSE(NAME, ELEM_TYPE)                              \
  static void map_transpose_##NAME                                      \
  (ELEM_TYPE* dst, ELEM_TYPE* src,                                      \
   int64_t k, int64_t m, int64_t n,                                     \
   int64_t cb, int64_t ce, int64_t rb, int64_t re)                      \
  {                                                                     \
  int32_t r = re - rb;                                                  \
  int32_t c = ce - cb;                                                  \
  if (k == 1) {                                                         \
    if (r <= 64 && c <= 64) {                                           \
      for (int64_t j = 0; j < c; j++) {                                 \
        for (int64_t i = 0; i < r; i++) {                               \
          dst[(j + cb) * n + (i + rb)] = src[(i + rb) * m + (j + cb)];  \
        }                                                               \
      }                                                                 \
    } else if (c <= r) {                                                \
      map_transpose_##NAME(dst, src, k, m, n, cb, ce, rb, rb + r/2);    \
      map_transpose_##NAME(dst, src, k, m, n, cb, ce, rb + r/2, re);    \
    } else {                                                            \
      map_transpose_##NAME(dst, src, k, m, n, cb, cb + c/2, rb, re);    \
      map_transpose_##NAME(dst, src, k, m, n, cb + c/2, ce, rb, re);    \
    }                                                                   \
  } else {                                                              \
  for (int64_t i = 0; i < k; i++) {                                     \
    map_transpose_##NAME(dst + i * m * n, src + i * m * n, 1, m, n, cb, ce, rb, re); \
  }\
} \
}

// Straightforward LMAD copy function.
#define GEN_LMAD_COPY_ELEMENTS(NAME, ELEM_TYPE)                         \
  static void lmad_copy_elements_##NAME(int r,                          \
                                        ELEM_TYPE* dst, int64_t dst_strides[r], \
                                        ELEM_TYPE *src, int64_t src_strides[r], \
                                        int64_t shape[r]) {             \
    if (r == 1) {                                                       \
      for (int i = 0; i < shape[0]; i++) {                              \
        dst[i*dst_strides[0]] = src[i*src_strides[0]];                  \
      }                                                                 \
    } else if (r > 1) {                                                 \
      for (int i = 0; i < shape[0]; i++) {                              \
        lmad_copy_elements_##NAME(r-1,                                  \
                                  dst+i*dst_strides[0], dst_strides+1,  \
                                  src+i*src_strides[0], src_strides+1,  \
                                  shape+1);                             \
      }                                                                 \
    }                                                                   \
  }                                                                     \

// Check whether this LMAD can be seen as a transposed 2D array.  This
// is done by checking every possible splitting point.
static bool lmad_is_tr(int64_t *n_out, int64_t *m_out,
                       int r,
                       const int64_t strides[r],
                       const int64_t shape[r]) {
  for (int i = 1; i < r; i++) {
    int n = 1, m = 1;
    bool ok = true;
    int64_t expected = 1;
    // Check strides before 'i'.
    for (int j = i-1; j >= 0; j--) {
      ok = ok && strides[j] == expected;
      expected *= shape[j];
      n *= shape[j];
    }
    // Check strides after 'i'.
    for (int j = r-1; j >= i; j--) {
      ok = ok && strides[j] == expected;
      expected *= shape[j];
      m *= shape[j];
    }
    if (ok) {
      *n_out = n;
      *m_out = m;
      return true;
    }
  }
  return false;
}

// This function determines whether the a 'dst' LMAD is row-major and
// 'src' LMAD is column-major.  Both LMADs are for arrays of the same
// shape.  Both LMADs are allowed to have additional dimensions "on
// top".  Essentially, this function determines whether a copy from
// 'src' to 'dst' is a "map(transpose)" that we know how to implement
// efficiently.  The LMADs can have arbitrary rank, and the main
// challenge here is checking whether the src LMAD actually
// corresponds to a 2D column-major layout by morally collapsing
// dimensions.  There is a lot of looping here, but the actual trip
// count is going to be very low in practice.
//
// Returns true if this is indeed a map(transpose), and writes the
// number of arrays, and moral array size to appropriate output
// parameters.
static bool lmad_map_tr(int64_t *num_arrays_out, int64_t *n_out, int64_t *m_out,
                        int r,
                        const int64_t dst_strides[r],
                        const int64_t src_strides[r],
                        const int64_t shape[r]) {
  int64_t rowmajor_strides[r];
  rowmajor_strides[r-1] = 1;

  for (int i = r-2; i >= 0; i--) {
    rowmajor_strides[i] = rowmajor_strides[i+1] * shape[i+1];
  }

  // map_r will be the number of mapped dimensions on top.
  int map_r = 0;
  int64_t num_arrays = 1;
  for (int i = 0; i < r; i++) {
    if (dst_strides[i] != rowmajor_strides[i] ||
        src_strides[i] != rowmajor_strides[i]) {
      break;
    } else {
      num_arrays *= shape[i];
      map_r++;
    }
  }

  *num_arrays_out = num_arrays;

  if (r==map_r) {
    return false;
  }

  if (memcmp(&rowmajor_strides[map_r],
             &dst_strides[map_r],
             sizeof(int64_t)*(r-map_r)) == 0) {
    return lmad_is_tr(n_out, m_out, r-map_r, src_strides+map_r, shape+map_r);
  } else if (memcmp(&rowmajor_strides[map_r],
                    &src_strides[map_r],
                    sizeof(int64_t)*(r-map_r)) == 0) {
    return lmad_is_tr(m_out, n_out, r-map_r, dst_strides+map_r, shape+map_r);
  }
  return false;
}

// Check if the strides correspond to row-major strides of *any*
// permutation of the shape.  This is done by recursive search with
// backtracking.  This is worst-case exponential, but hopefully the
// arrays we encounter do not have that many dimensions.
static bool lmad_contiguous_search(int checked, int64_t expected,
                                   int r,
                                   int64_t strides[r], int64_t shape[r], bool used[r]) {
  for (int i = 0; i < r; i++) {
    for (int j = 0; j < r; j++) {
      if (!used[j] && strides[j] == expected && strides[j] >= 0) {
        used[j] = true;
        if (checked+1 == r ||
            lmad_contiguous_search(checked+1, expected * shape[j], r, strides, shape, used)) {
          return true;
        }
        used[j] = false;
      }
    }
  }
  return false;
}

// Does this LMAD correspond to an array with positive strides and no
// holes?
static bool lmad_contiguous(int r, int64_t strides[r], int64_t shape[r]) {
  bool used[r];
  for (int i = 0; i < r; i++) {
    used[i] = false;
  }
  return lmad_contiguous_search(0, 1, r, strides, shape, used);
}

// Does this copy correspond to something that could be done with a
// memcpy()-like operation?  I.e. do the LMADs actually represent the
// same in-memory layout and are they contiguous?
static bool lmad_memcpyable(int r,
                            int64_t dst_strides[r], int64_t src_strides[r], int64_t shape[r]) {
  if (!lmad_contiguous(r, dst_strides, shape)) {
    return false;
  }
  for (int i = 0; i < r; i++) {
    if (dst_strides[i] != src_strides[i] && shape[i] != 1) {
      return false;
    }
  }
  return true;
}


static void log_copy(struct futhark_context* ctx,
                     const char *kind, int r,
                     int64_t dst_offset, int64_t dst_strides[r],
                     int64_t src_offset, int64_t src_strides[r],
                     int64_t shape[r]) {
  if (ctx->logging) {
    fprintf(ctx->log, "\n# Copy %s\n", kind);
    fprintf(ctx->log, "Shape: ");
    for (int i = 0; i < r; i++) { fprintf(ctx->log, "[%ld]", (long int)shape[i]); }
    fprintf(ctx->log, "\n");
    fprintf(ctx->log, "Dst offset: %ld\n", (long int)dst_offset);
    fprintf(ctx->log, "Dst strides:");
    for (int i = 0; i < r; i++) { fprintf(ctx->log, " %ld", (long int)dst_strides[i]); }
    fprintf(ctx->log, "\n");
    fprintf(ctx->log, "Src offset: %ld\n", (long int)src_offset);
    fprintf(ctx->log, "Src strides:");
    for (int i = 0; i < r; i++) { fprintf(ctx->log, " %ld", (long int)src_strides[i]); }
    fprintf(ctx->log, "\n");
  }
}

static void log_transpose(struct futhark_context* ctx,
                          int64_t k, int64_t n, int64_t m) {
  if (ctx->logging) {
    fprintf(ctx->log, "## Transpose\n");
    fprintf(ctx->log, "Arrays     : %ld\n", (long int)k);
    fprintf(ctx->log, "X elements : %ld\n", (long int)m);
    fprintf(ctx->log, "Y elements : %ld\n", (long int)n);
    fprintf(ctx->log, "\n");
  }
}

#define GEN_LMAD_COPY(NAME, ELEM_TYPE)                                  \
  static void lmad_copy_##NAME                                          \
  (struct futhark_context *ctx, int r,                                  \
   ELEM_TYPE* dst, int64_t dst_offset, int64_t dst_strides[r],          \
   ELEM_TYPE *src, int64_t src_offset, int64_t src_strides[r],          \
   int64_t shape[r]) {                                                  \
    log_copy(ctx, "CPU to CPU", r, dst_offset, dst_strides,             \
             src_offset, src_strides, shape);                           \
    int64_t size = 1;                                                   \
    for (int i = 0; i < r; i++) { size *= shape[i]; }                   \
    if (size == 0) { return; }                                          \
    int64_t k, n, m;                                                    \
    if (lmad_map_tr(&k, &n, &m,                                         \
                    r, dst_strides, src_strides, shape)) {              \
      log_transpose(ctx, k, n, m);                                      \
      map_transpose_##NAME                                              \
        (dst+dst_offset, src+src_offset, k, n, m, 0, n, 0, m);          \
    } else if (lmad_memcpyable(r, dst_strides, src_strides, shape)) {   \
      if (ctx->logging) {fprintf(ctx->log, "## Flat copy\n\n");}          \
      memcpy(dst+dst_offset, src+src_offset, size*sizeof(*dst));        \
    } else {                                                            \
      if (ctx->logging) {fprintf(ctx->log, "## General copy\n\n");}       \
      lmad_copy_elements_##NAME                                         \
        (r,                                                             \
         dst+dst_offset, dst_strides,                                   \
         src+src_offset, src_strides, shape);                           \
    }                                                                   \
  }

GEN_MAP_TRANSPOSE(1b, uint8_t)
GEN_MAP_TRANSPOSE(2b, uint16_t)
GEN_MAP_TRANSPOSE(4b, uint32_t)
GEN_MAP_TRANSPOSE(8b, uint64_t)

GEN_LMAD_COPY_ELEMENTS(1b, uint8_t)
GEN_LMAD_COPY_ELEMENTS(2b, uint16_t)
GEN_LMAD_COPY_ELEMENTS(4b, uint32_t)
GEN_LMAD_COPY_ELEMENTS(8b, uint64_t)

GEN_LMAD_COPY(1b, uint8_t)
GEN_LMAD_COPY(2b, uint16_t)
GEN_LMAD_COPY(4b, uint32_t)
GEN_LMAD_COPY(8b, uint64_t)

// End of copy.h

#define FUTHARK_FUN_ATTR static

FUTHARK_FUN_ATTR int futrts_builtinzhiota_i64(struct futhark_context *ctx, struct memblock_device mem_54725, int64_t n_54726, int64_t x_54727, int64_t s_54728);
FUTHARK_FUN_ATTR int futrts_builtinzhreplicate_bool(struct futhark_context *ctx, struct memblock_device mem_55474, int64_t num_elems_55475, bool val_55476);
FUTHARK_FUN_ATTR int futrts_builtinzhreplicate_f64(struct futhark_context *ctx, struct memblock_device mem_54801, int64_t num_elems_54802, double val_54803);
FUTHARK_FUN_ATTR int futrts_builtinzhreplicate_i32(struct futhark_context *ctx, struct memblock_device mem_54627, int64_t num_elems_54628, int32_t val_54629);
FUTHARK_FUN_ATTR int futrts_builtinzhreplicate_i64(struct futhark_context *ctx, struct memblock_device mem_54542, int64_t num_elems_54543, int64_t val_54544);
FUTHARK_FUN_ATTR int futrts_builtinzhreplicate_i8(struct futhark_context *ctx, struct memblock_device mem_54592, int64_t num_elems_54593, int8_t val_54594);
FUTHARK_FUN_ATTR int futrts_entry_add_next_partition_double(struct futhark_context *ctx, struct memblock_device *mem_out_p_56891, struct memblock_device *mem_out_p_56892, struct memblock_device *mem_out_p_56893, struct memblock_device *mem_out_p_56894, struct memblock_device *mem_out_p_56895, struct memblock_device *mem_out_p_56896, struct memblock_device *mem_out_p_56897, struct memblock_device *mem_out_p_56898, struct memblock_device *mem_out_p_56899, struct memblock_device *mem_out_p_56900, struct memblock_device *mem_out_p_56901, struct memblock_device *mem_out_p_56902, struct memblock_device *mem_out_p_56903, struct memblock_device *mem_out_p_56904, struct memblock_device *mem_out_p_56905, struct memblock_device *mem_out_p_56906, struct memblock_device *mem_out_p_56907, struct memblock_device *mem_out_p_56908, struct memblock_device *mem_out_p_56909, struct memblock_device *mem_out_p_56910, struct memblock_device *mem_out_p_56911, struct memblock_device *mem_out_p_56912, struct memblock_device *mem_out_p_56913, struct memblock_device *mem_out_p_56914, struct memblock_device *mem_out_p_56915, struct memblock_device *mem_out_p_56916, struct memblock_device *mem_out_p_56917, int64_t *out_prim_out_56918, int64_t *out_prim_out_56919, int64_t *out_prim_out_56920, int8_t *out_prim_out_56921, int8_t *out_prim_out_56922, double *out_prim_out_56923, int64_t *out_prim_out_56924, int64_t *out_prim_out_56925, double *out_prim_out_56926, int64_t *out_prim_out_56927, int64_t *out_prim_out_56928, int64_t *out_prim_out_56929, int64_t *out_prim_out_56930, int64_t *out_prim_out_56931, int64_t *out_prim_out_56932, int64_t *out_prim_out_56933, struct memblock_device chain_collisions_mem_53506, struct memblock_device chain_collisions_mem_53507, struct memblock_device clBase_mem_53508, struct memblock_device clBase_mem_53509, struct memblock_device clBase_mem_53510, struct memblock_device clBase_mem_53511, struct memblock_device clProc_mem_53512, struct memblock_device clProc_mem_53513, struct memblock_device clProc_mem_53514, struct memblock_device clProc_mem_53515, struct memblock_device clProc_mem_53516, struct memblock_device clProc_mem_53517, struct memblock_device current_partition_mem_53518, struct memblock_device current_partition_mem_53519, struct memblock_device current_partition_mem_53520, struct memblock_device current_partition_mem_53521, struct memblock_device current_partition_mem_53522, struct memblock_device current_partition_mem_53523, struct memblock_device current_partition_mem_53524, struct memblock_device current_partition_mem_53525, struct memblock_device current_partition_mem_53526, struct memblock_device current_partition_mem_53527, struct memblock_device current_partition_mem_53528, struct memblock_device current_partition_mem_53529, struct memblock_device toFlush_dat_mem_53530, struct memblock_device toFlush_dat_mem_53531, struct memblock_device toFlush_ids_mem_53532, struct memblock_device new_xs_mem_53533, struct memblock_device new_ys_mem_53534, int64_t n_old_28413, int64_t part_no_28414, int64_t dz2084U_28415, int64_t dz2080U_28416, int64_t dz2081U_28417, int64_t dz2082U_28418, int64_t dz2083U_28419, int64_t dz2085U_28420, int64_t dz2086U_28421, int64_t n_new_28422, int8_t clBase_28425, int8_t clBase_28426, double clBase_28427, int64_t clBase_28428, int64_t clBase_28430, double clBase_28433, int64_t clBase_28435, int64_t clProc_28440, int64_t clProc_28441, int64_t clProc_28442, int64_t clProc_28444, int64_t clProc_28445, int64_t current_partition_28459, int64_t new_id_28463);
FUTHARK_FUN_ATTR int futrts_entry_do_DBSCAN_double(struct futhark_context *ctx, struct memblock_device *mem_out_p_56939, struct memblock_device *mem_out_p_56940, struct memblock_device *mem_out_p_56941, struct memblock_device *mem_out_p_56942, struct memblock_device *mem_out_p_56943, struct memblock_device *mem_out_p_56944, struct memblock_device *mem_out_p_56945, struct memblock_device *mem_out_p_56946, struct memblock_device *mem_out_p_56947, struct memblock_device *mem_out_p_56948, struct memblock_device *mem_out_p_56949, struct memblock_device *mem_out_p_56950, struct memblock_device *mem_out_p_56951, struct memblock_device *mem_out_p_56952, struct memblock_device *mem_out_p_56953, struct memblock_device *mem_out_p_56954, struct memblock_device *mem_out_p_56955, struct memblock_device *mem_out_p_56956, struct memblock_device *mem_out_p_56957, struct memblock_device *mem_out_p_56958, struct memblock_device *mem_out_p_56959, struct memblock_device *mem_out_p_56960, struct memblock_device *mem_out_p_56961, struct memblock_device *mem_out_p_56962, struct memblock_device *mem_out_p_56963, struct memblock_device *mem_out_p_56964, struct memblock_device *mem_out_p_56965, int64_t *out_prim_out_56966, int8_t *out_prim_out_56967, int8_t *out_prim_out_56968, double *out_prim_out_56969, int64_t *out_prim_out_56970, int64_t *out_prim_out_56971, double *out_prim_out_56972, int64_t *out_prim_out_56973, int64_t *out_prim_out_56974, int64_t *out_prim_out_56975, int64_t *out_prim_out_56976, int64_t *out_prim_out_56977, int64_t *out_prim_out_56978, int64_t *out_prim_out_56979, struct memblock_device chain_collisions_mem_53506, struct memblock_device chain_collisions_mem_53507, struct memblock_device clBase_mem_53508, struct memblock_device clBase_mem_53509, struct memblock_device clBase_mem_53510, struct memblock_device clBase_mem_53511, struct memblock_device clProc_mem_53512, struct memblock_device clProc_mem_53513, struct memblock_device clProc_mem_53514, struct memblock_device clProc_mem_53515, struct memblock_device clProc_mem_53516, struct memblock_device clProc_mem_53517, struct memblock_device current_partition_mem_53518, struct memblock_device current_partition_mem_53519, struct memblock_device current_partition_mem_53520, struct memblock_device current_partition_mem_53521, struct memblock_device current_partition_mem_53522, struct memblock_device current_partition_mem_53523, struct memblock_device current_partition_mem_53524, struct memblock_device current_partition_mem_53525, struct memblock_device current_partition_mem_53526, struct memblock_device current_partition_mem_53527, struct memblock_device current_partition_mem_53528, struct memblock_device current_partition_mem_53529, struct memblock_device toFlush_dat_mem_53530, struct memblock_device toFlush_dat_mem_53531, struct memblock_device toFlush_ids_mem_53532, int64_t n_36798, int64_t part_no_36799, int64_t dz2084U_36800, int64_t dz2080U_36801, int64_t dz2081U_36802, int64_t dz2082U_36803, int64_t dz2083U_36804, int64_t dz2085U_36805, int64_t dz2086U_36806, int8_t clBase_36809, int8_t clBase_36810, double clBase_36811, int64_t clBase_36812, int64_t clBase_36814, double clBase_36817, int64_t clBase_36819, int64_t clProc_36824, int64_t clProc_36825, int64_t clProc_36826, int64_t clProc_36828, int64_t clProc_36829, int64_t current_partition_36843, int64_t gather_psizze_36847);
FUTHARK_FUN_ATTR int futrts_entry_flush_dat_double(struct futhark_context *ctx, struct memblock_device *mem_out_p_56991, struct memblock_device *mem_out_p_56992, struct memblock_device *mem_out_p_56993, struct memblock_device chain_collisions_mem_53506, struct memblock_device chain_collisions_mem_53507, struct memblock_device clBase_mem_53508, struct memblock_device clBase_mem_53509, struct memblock_device clBase_mem_53510, struct memblock_device clBase_mem_53511, struct memblock_device clProc_mem_53512, struct memblock_device clProc_mem_53513, struct memblock_device clProc_mem_53514, struct memblock_device clProc_mem_53515, struct memblock_device clProc_mem_53516, struct memblock_device clProc_mem_53517, struct memblock_device current_partition_mem_53518, struct memblock_device current_partition_mem_53519, struct memblock_device current_partition_mem_53520, struct memblock_device current_partition_mem_53521, struct memblock_device current_partition_mem_53522, struct memblock_device current_partition_mem_53523, struct memblock_device current_partition_mem_53524, struct memblock_device current_partition_mem_53525, struct memblock_device current_partition_mem_53526, struct memblock_device current_partition_mem_53527, struct memblock_device current_partition_mem_53528, struct memblock_device current_partition_mem_53529, struct memblock_device toFlush_dat_mem_53530, struct memblock_device toFlush_dat_mem_53531, struct memblock_device toFlush_ids_mem_53532, int64_t n_28651, int64_t part_no_28652, int64_t dz2084U_28653, int64_t dz2080U_28654, int64_t dz2081U_28655, int64_t dz2082U_28656, int64_t dz2083U_28657, int64_t dz2085U_28658, int64_t dz2086U_28659, int8_t clBase_28662, int8_t clBase_28663, double clBase_28664, int64_t clBase_28665, int64_t clBase_28667, double clBase_28670, int64_t clBase_28672, int64_t clProc_28677, int64_t clProc_28678, int64_t clProc_28679, int64_t clProc_28681, int64_t clProc_28682, int64_t current_partition_28696);
FUTHARK_FUN_ATTR int futrts_entry_make_collisions_compact_double(struct futhark_context *ctx, struct memblock_device *mem_out_p_56994, struct memblock_device *mem_out_p_56995, int64_t *out_prim_out_56996, struct memblock_device chain_collisions_mem_53506, struct memblock_device chain_collisions_mem_53507, struct memblock_device clBase_mem_53508, struct memblock_device clBase_mem_53509, struct memblock_device clBase_mem_53510, struct memblock_device clBase_mem_53511, struct memblock_device clProc_mem_53512, struct memblock_device clProc_mem_53513, struct memblock_device clProc_mem_53514, struct memblock_device clProc_mem_53515, struct memblock_device clProc_mem_53516, struct memblock_device clProc_mem_53517, struct memblock_device current_partition_mem_53518, struct memblock_device current_partition_mem_53519, struct memblock_device current_partition_mem_53520, struct memblock_device current_partition_mem_53521, struct memblock_device current_partition_mem_53522, struct memblock_device current_partition_mem_53523, struct memblock_device current_partition_mem_53524, struct memblock_device current_partition_mem_53525, struct memblock_device current_partition_mem_53526, struct memblock_device current_partition_mem_53527, struct memblock_device current_partition_mem_53528, struct memblock_device current_partition_mem_53529, struct memblock_device toFlush_dat_mem_53530, struct memblock_device toFlush_dat_mem_53531, struct memblock_device toFlush_ids_mem_53532, int64_t n_37609, int64_t part_no_37610, int64_t dz2084U_37611, int64_t dz2080U_37612, int64_t dz2081U_37613, int64_t dz2082U_37614, int64_t dz2083U_37615, int64_t dz2085U_37616, int64_t dz2086U_37617, int8_t clBase_37620, int8_t clBase_37621, double clBase_37622, int64_t clBase_37623, int64_t clBase_37625, double clBase_37628, int64_t clBase_37630, int64_t clProc_37635, int64_t clProc_37636, int64_t clProc_37637, int64_t clProc_37639, int64_t clProc_37640, int64_t current_partition_37654);
FUTHARK_FUN_ATTR int futrts_entry_mk_dbcHandler_double(struct futhark_context *ctx, struct memblock_device *mem_out_p_56998, struct memblock_device *mem_out_p_56999, struct memblock_device *mem_out_p_57000, struct memblock_device *mem_out_p_57001, struct memblock_device *mem_out_p_57002, struct memblock_device *mem_out_p_57003, struct memblock_device *mem_out_p_57004, struct memblock_device *mem_out_p_57005, struct memblock_device *mem_out_p_57006, struct memblock_device *mem_out_p_57007, struct memblock_device *mem_out_p_57008, struct memblock_device *mem_out_p_57009, struct memblock_device *mem_out_p_57010, struct memblock_device *mem_out_p_57011, struct memblock_device *mem_out_p_57012, struct memblock_device *mem_out_p_57013, struct memblock_device *mem_out_p_57014, struct memblock_device *mem_out_p_57015, struct memblock_device *mem_out_p_57016, struct memblock_device *mem_out_p_57017, struct memblock_device *mem_out_p_57018, struct memblock_device *mem_out_p_57019, struct memblock_device *mem_out_p_57020, struct memblock_device *mem_out_p_57021, struct memblock_device *mem_out_p_57022, struct memblock_device *mem_out_p_57023, struct memblock_device *mem_out_p_57024, int64_t *out_prim_out_57025, int8_t *out_prim_out_57026, int8_t *out_prim_out_57027, double *out_prim_out_57028, int64_t *out_prim_out_57029, int64_t *out_prim_out_57030, double *out_prim_out_57031, int64_t *out_prim_out_57032, int64_t *out_prim_out_57033, int64_t *out_prim_out_57034, int64_t *out_prim_out_57035, int64_t *out_prim_out_57036, int64_t *out_prim_out_57037, int64_t *out_prim_out_57038, double min_x_23482, double min_y_23483, double max_x_23484, double max_y_23485, int64_t parts_x_23486, int64_t parts_y_23487, bool isEuclidean_23488, bool isRadians_23489, double radius_23490, double eps_23491, int64_t minPts_23492, int64_t m_sizze_23493);
FUTHARK_FUN_ATTR int futrts_entry_next_partition_to_read_double(struct futhark_context *ctx, int64_t *out_prim_out_57039, struct memblock_device chain_collisions_mem_53506, struct memblock_device chain_collisions_mem_53507, struct memblock_device clBase_mem_53508, struct memblock_device clBase_mem_53509, struct memblock_device clBase_mem_53510, struct memblock_device clBase_mem_53511, struct memblock_device clProc_mem_53512, struct memblock_device clProc_mem_53513, struct memblock_device clProc_mem_53514, struct memblock_device clProc_mem_53515, struct memblock_device clProc_mem_53516, struct memblock_device clProc_mem_53517, struct memblock_device current_partition_mem_53518, struct memblock_device current_partition_mem_53519, struct memblock_device current_partition_mem_53520, struct memblock_device current_partition_mem_53521, struct memblock_device current_partition_mem_53522, struct memblock_device current_partition_mem_53523, struct memblock_device current_partition_mem_53524, struct memblock_device current_partition_mem_53525, struct memblock_device current_partition_mem_53526, struct memblock_device current_partition_mem_53527, struct memblock_device current_partition_mem_53528, struct memblock_device current_partition_mem_53529, struct memblock_device toFlush_dat_mem_53530, struct memblock_device toFlush_dat_mem_53531, struct memblock_device toFlush_ids_mem_53532, int64_t n_24089, int64_t part_no_24090, int64_t dz2084U_24091, int64_t dz2080U_24092, int64_t dz2081U_24093, int64_t dz2082U_24094, int64_t dz2083U_24095, int64_t dz2085U_24096, int64_t dz2086U_24097, int8_t clBase_24100, int8_t clBase_24101, double clBase_24102, int64_t clBase_24103, int64_t clBase_24105, double clBase_24108, int64_t clBase_24110, int64_t clProc_24115, int64_t clProc_24116, int64_t clProc_24117, int64_t clProc_24119, int64_t clProc_24120, int64_t current_partition_24134);
FUTHARK_FUN_ATTR int futrts_entry_rectify_partition_ids_double(struct futhark_context *ctx, struct memblock_device *mem_out_p_57043, struct memblock_device partition_ids_mem_53506, struct memblock_device chain_id_mem_53507, struct memblock_device replaceWith_mem_53508, int64_t n_37952, int64_t dz2081Uz2080U_37953, int64_t dz2081Uz2081U_37954, int64_t m_sizze_37958);
FUTHARK_FUN_ATTR int futrts_get_num_neighbours_against_10103(struct futhark_context *ctx, struct memblock_device *mem_out_p_57044, struct memblock_device dat1_mem_53506, struct memblock_device dat1_mem_53507, struct memblock_device dat2_mem_53508, struct memblock_device dat2_mem_53509, int64_t n1_29590, int64_t n2_29591, double eps_29596, int8_t dist_t_29597, int8_t angle_t_29598, double radius_29599, int64_t m_sizze_29600);
FUTHARK_FUN_ATTR int futrts_get_num_neighbours_against_10106(struct futhark_context *ctx, struct memblock_device *mem_out_p_57045, struct memblock_device dat1_mem_53506, struct memblock_device dat1_mem_53507, struct memblock_device dat2_mem_53508, struct memblock_device dat2_mem_53509, int64_t n1_29851, int64_t n2_29852, double eps_29857, int8_t dist_t_29858, int8_t angle_t_29859, double radius_29860, int64_t m_sizze_29861);

static int init_constants(struct futhark_context *ctx)
{
    (void) ctx;
    
    int err = 0;
    
    #define counters_mem_54551 (ctx->constants->counters_mem_54551)
    #define counters_mem_54625 (ctx->constants->counters_mem_54625)
    #define counters_mem_55050 (ctx->constants->counters_mem_55050)
    #define counters_mem_55495 (ctx->constants->counters_mem_55495)
    #define counters_mem_55534 (ctx->constants->counters_mem_55534)
    #define counters_mem_55581 (ctx->constants->counters_mem_55581)
    #define counters_mem_56605 (ctx->constants->counters_mem_56605)
    #define counters_mem_56764 (ctx->constants->counters_mem_56764)
    #define counters_mem_56815 (ctx->constants->counters_mem_56815)
    #define counters_mem_56850 (ctx->constants->counters_mem_56850)
    #define global_dynid_mem_54616 (ctx->constants->global_dynid_mem_54616)
    #define global_dynid_mem_54626 (ctx->constants->global_dynid_mem_54626)
    #define global_dynid_mem_54637 (ctx->constants->global_dynid_mem_54637)
    #define global_dynid_mem_54642 (ctx->constants->global_dynid_mem_54642)
    #define global_dynid_mem_54800 (ctx->constants->global_dynid_mem_54800)
    #define global_dynid_mem_54871 (ctx->constants->global_dynid_mem_54871)
    #define global_dynid_mem_54920 (ctx->constants->global_dynid_mem_54920)
    #define global_dynid_mem_55083 (ctx->constants->global_dynid_mem_55083)
    #define global_dynid_mem_55112 (ctx->constants->global_dynid_mem_55112)
    #define global_dynid_mem_55221 (ctx->constants->global_dynid_mem_55221)
    #define global_dynid_mem_55228 (ctx->constants->global_dynid_mem_55228)
    #define global_dynid_mem_55334 (ctx->constants->global_dynid_mem_55334)
    #define global_dynid_mem_55338 (ctx->constants->global_dynid_mem_55338)
    #define global_dynid_mem_55581 (ctx->constants->global_dynid_mem_55581)
    #define global_dynid_mem_55728 (ctx->constants->global_dynid_mem_55728)
    #define global_dynid_mem_55884 (ctx->constants->global_dynid_mem_55884)
    #define global_dynid_mem_56002 (ctx->constants->global_dynid_mem_56002)
    #define global_dynid_mem_56151 (ctx->constants->global_dynid_mem_56151)
    #define global_dynid_mem_56269 (ctx->constants->global_dynid_mem_56269)
    #define global_dynid_mem_56425 (ctx->constants->global_dynid_mem_56425)
    counters_mem_54551.references = NULL;
    counters_mem_54625.references = NULL;
    counters_mem_55050.references = NULL;
    counters_mem_55495.references = NULL;
    counters_mem_55534.references = NULL;
    counters_mem_55581.references = NULL;
    counters_mem_56605.references = NULL;
    counters_mem_56764.references = NULL;
    counters_mem_56815.references = NULL;
    counters_mem_56850.references = NULL;
    global_dynid_mem_54616.references = NULL;
    global_dynid_mem_54626.references = NULL;
    global_dynid_mem_54637.references = NULL;
    global_dynid_mem_54642.references = NULL;
    global_dynid_mem_54800.references = NULL;
    global_dynid_mem_54871.references = NULL;
    global_dynid_mem_54920.references = NULL;
    global_dynid_mem_55083.references = NULL;
    global_dynid_mem_55112.references = NULL;
    global_dynid_mem_55221.references = NULL;
    global_dynid_mem_55228.references = NULL;
    global_dynid_mem_55334.references = NULL;
    global_dynid_mem_55338.references = NULL;
    global_dynid_mem_55581.references = NULL;
    global_dynid_mem_55728.references = NULL;
    global_dynid_mem_55884.references = NULL;
    global_dynid_mem_56002.references = NULL;
    global_dynid_mem_56151.references = NULL;
    global_dynid_mem_56269.references = NULL;
    global_dynid_mem_56425.references = NULL;
    if (memblock_alloc_device(ctx, &counters_mem_54551, (int64_t) 80, "counters_mem_54551")) {
        err = 1;
        goto cleanup;
    }
    if (futrts_builtinzhreplicate_i32(ctx, counters_mem_54551, (int64_t) 20, 0) != 0) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &global_dynid_mem_54637, (int64_t) 4, "global_dynid_mem_54637")) {
        err = 1;
        goto cleanup;
    }
    if (futrts_builtinzhreplicate_i32(ctx, global_dynid_mem_54637, (int64_t) 1, 0) != 0) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &global_dynid_mem_54642, (int64_t) 4, "global_dynid_mem_54642")) {
        err = 1;
        goto cleanup;
    }
    if (futrts_builtinzhreplicate_i32(ctx, global_dynid_mem_54642, (int64_t) 1, 0) != 0) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &global_dynid_mem_54626, (int64_t) 4, "global_dynid_mem_54626")) {
        err = 1;
        goto cleanup;
    }
    if (futrts_builtinzhreplicate_i32(ctx, global_dynid_mem_54626, (int64_t) 1, 0) != 0) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &global_dynid_mem_54871, (int64_t) 4, "global_dynid_mem_54871")) {
        err = 1;
        goto cleanup;
    }
    if (futrts_builtinzhreplicate_i32(ctx, global_dynid_mem_54871, (int64_t) 1, 0) != 0) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &counters_mem_55050, (int64_t) 81920, "counters_mem_55050")) {
        err = 1;
        goto cleanup;
    }
    if (futrts_builtinzhreplicate_i32(ctx, counters_mem_55050, (int64_t) 20480, 0) != 0) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &global_dynid_mem_55112, (int64_t) 4, "global_dynid_mem_55112")) {
        err = 1;
        goto cleanup;
    }
    if (futrts_builtinzhreplicate_i32(ctx, global_dynid_mem_55112, (int64_t) 1, 0) != 0) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &global_dynid_mem_55228, (int64_t) 4, "global_dynid_mem_55228")) {
        err = 1;
        goto cleanup;
    }
    if (futrts_builtinzhreplicate_i32(ctx, global_dynid_mem_55228, (int64_t) 1, 0) != 0) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &global_dynid_mem_55334, (int64_t) 4, "global_dynid_mem_55334")) {
        err = 1;
        goto cleanup;
    }
    if (futrts_builtinzhreplicate_i32(ctx, global_dynid_mem_55334, (int64_t) 1, 0) != 0) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &counters_mem_55581, (int64_t) 81920, "counters_mem_55581")) {
        err = 1;
        goto cleanup;
    }
    if (futrts_builtinzhreplicate_i32(ctx, counters_mem_55581, (int64_t) 20480, 0) != 0) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &global_dynid_mem_54616, (int64_t) 4, "global_dynid_mem_54616")) {
        err = 1;
        goto cleanup;
    }
    if (futrts_builtinzhreplicate_i32(ctx, global_dynid_mem_54616, (int64_t) 1, 0) != 0) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &global_dynid_mem_54800, (int64_t) 4, "global_dynid_mem_54800")) {
        err = 1;
        goto cleanup;
    }
    if (futrts_builtinzhreplicate_i32(ctx, global_dynid_mem_54800, (int64_t) 1, 0) != 0) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &global_dynid_mem_54920, (int64_t) 4, "global_dynid_mem_54920")) {
        err = 1;
        goto cleanup;
    }
    if (futrts_builtinzhreplicate_i32(ctx, global_dynid_mem_54920, (int64_t) 1, 0) != 0) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &global_dynid_mem_55083, (int64_t) 4, "global_dynid_mem_55083")) {
        err = 1;
        goto cleanup;
    }
    if (futrts_builtinzhreplicate_i32(ctx, global_dynid_mem_55083, (int64_t) 1, 0) != 0) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &global_dynid_mem_55221, (int64_t) 4, "global_dynid_mem_55221")) {
        err = 1;
        goto cleanup;
    }
    if (futrts_builtinzhreplicate_i32(ctx, global_dynid_mem_55221, (int64_t) 1, 0) != 0) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &global_dynid_mem_55338, (int64_t) 4, "global_dynid_mem_55338")) {
        err = 1;
        goto cleanup;
    }
    if (futrts_builtinzhreplicate_i32(ctx, global_dynid_mem_55338, (int64_t) 1, 0) != 0) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &counters_mem_55495, (int64_t) 81920, "counters_mem_55495")) {
        err = 1;
        goto cleanup;
    }
    if (futrts_builtinzhreplicate_i32(ctx, counters_mem_55495, (int64_t) 20480, 0) != 0) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &counters_mem_55534, (int64_t) 80, "counters_mem_55534")) {
        err = 1;
        goto cleanup;
    }
    if (futrts_builtinzhreplicate_i32(ctx, counters_mem_55534, (int64_t) 20, 0) != 0) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &global_dynid_mem_55581, (int64_t) 4, "global_dynid_mem_55581")) {
        err = 1;
        goto cleanup;
    }
    if (futrts_builtinzhreplicate_i32(ctx, global_dynid_mem_55581, (int64_t) 1, 0) != 0) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &global_dynid_mem_55728, (int64_t) 4, "global_dynid_mem_55728")) {
        err = 1;
        goto cleanup;
    }
    if (futrts_builtinzhreplicate_i32(ctx, global_dynid_mem_55728, (int64_t) 1, 0) != 0) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &global_dynid_mem_55884, (int64_t) 4, "global_dynid_mem_55884")) {
        err = 1;
        goto cleanup;
    }
    if (futrts_builtinzhreplicate_i32(ctx, global_dynid_mem_55884, (int64_t) 1, 0) != 0) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &global_dynid_mem_56002, (int64_t) 4, "global_dynid_mem_56002")) {
        err = 1;
        goto cleanup;
    }
    if (futrts_builtinzhreplicate_i32(ctx, global_dynid_mem_56002, (int64_t) 1, 0) != 0) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &global_dynid_mem_56151, (int64_t) 4, "global_dynid_mem_56151")) {
        err = 1;
        goto cleanup;
    }
    if (futrts_builtinzhreplicate_i32(ctx, global_dynid_mem_56151, (int64_t) 1, 0) != 0) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &global_dynid_mem_56269, (int64_t) 4, "global_dynid_mem_56269")) {
        err = 1;
        goto cleanup;
    }
    if (futrts_builtinzhreplicate_i32(ctx, global_dynid_mem_56269, (int64_t) 1, 0) != 0) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &global_dynid_mem_56425, (int64_t) 4, "global_dynid_mem_56425")) {
        err = 1;
        goto cleanup;
    }
    if (futrts_builtinzhreplicate_i32(ctx, global_dynid_mem_56425, (int64_t) 1, 0) != 0) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &counters_mem_56605, (int64_t) 81920, "counters_mem_56605")) {
        err = 1;
        goto cleanup;
    }
    if (futrts_builtinzhreplicate_i32(ctx, counters_mem_56605, (int64_t) 20480, 0) != 0) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &counters_mem_56764, (int64_t) 81920, "counters_mem_56764")) {
        err = 1;
        goto cleanup;
    }
    if (futrts_builtinzhreplicate_i32(ctx, counters_mem_56764, (int64_t) 20480, 0) != 0) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &counters_mem_56815, (int64_t) 80, "counters_mem_56815")) {
        err = 1;
        goto cleanup;
    }
    if (futrts_builtinzhreplicate_i32(ctx, counters_mem_56815, (int64_t) 20, 0) != 0) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &counters_mem_56850, (int64_t) 80, "counters_mem_56850")) {
        err = 1;
        goto cleanup;
    }
    if (futrts_builtinzhreplicate_i32(ctx, counters_mem_56850, (int64_t) 20, 0) != 0) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &counters_mem_54625, (int64_t) 81920, "counters_mem_54625")) {
        err = 1;
        goto cleanup;
    }
    if (futrts_builtinzhreplicate_i32(ctx, counters_mem_54625, (int64_t) 20480, 0) != 0) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &counters_mem_54625, (int64_t) 81920, "counters_mem_54625")) {
        err = 1;
        goto cleanup;
    }
    if (futrts_builtinzhreplicate_i32(ctx, counters_mem_54625, (int64_t) 20480, 0) != 0) {
        err = 1;
        goto cleanup;
    }
    #undef counters_mem_54551
    #undef counters_mem_54625
    #undef counters_mem_55050
    #undef counters_mem_55495
    #undef counters_mem_55534
    #undef counters_mem_55581
    #undef counters_mem_56605
    #undef counters_mem_56764
    #undef counters_mem_56815
    #undef counters_mem_56850
    #undef global_dynid_mem_54616
    #undef global_dynid_mem_54626
    #undef global_dynid_mem_54637
    #undef global_dynid_mem_54642
    #undef global_dynid_mem_54800
    #undef global_dynid_mem_54871
    #undef global_dynid_mem_54920
    #undef global_dynid_mem_55083
    #undef global_dynid_mem_55112
    #undef global_dynid_mem_55221
    #undef global_dynid_mem_55228
    #undef global_dynid_mem_55334
    #undef global_dynid_mem_55338
    #undef global_dynid_mem_55581
    #undef global_dynid_mem_55728
    #undef global_dynid_mem_55884
    #undef global_dynid_mem_56002
    #undef global_dynid_mem_56151
    #undef global_dynid_mem_56269
    #undef global_dynid_mem_56425
    
  cleanup:
    return err;
}
static int free_constants(struct futhark_context *ctx)
{
    (void) ctx;
    if (memblock_unref_device(ctx, &ctx->constants->counters_mem_54551, "ctx->constants->counters_mem_54551") != 0)
        return 1;
    if (memblock_unref_device(ctx, &ctx->constants->counters_mem_54625, "ctx->constants->counters_mem_54625") != 0)
        return 1;
    if (memblock_unref_device(ctx, &ctx->constants->counters_mem_55050, "ctx->constants->counters_mem_55050") != 0)
        return 1;
    if (memblock_unref_device(ctx, &ctx->constants->counters_mem_55495, "ctx->constants->counters_mem_55495") != 0)
        return 1;
    if (memblock_unref_device(ctx, &ctx->constants->counters_mem_55534, "ctx->constants->counters_mem_55534") != 0)
        return 1;
    if (memblock_unref_device(ctx, &ctx->constants->counters_mem_55581, "ctx->constants->counters_mem_55581") != 0)
        return 1;
    if (memblock_unref_device(ctx, &ctx->constants->counters_mem_56605, "ctx->constants->counters_mem_56605") != 0)
        return 1;
    if (memblock_unref_device(ctx, &ctx->constants->counters_mem_56764, "ctx->constants->counters_mem_56764") != 0)
        return 1;
    if (memblock_unref_device(ctx, &ctx->constants->counters_mem_56815, "ctx->constants->counters_mem_56815") != 0)
        return 1;
    if (memblock_unref_device(ctx, &ctx->constants->counters_mem_56850, "ctx->constants->counters_mem_56850") != 0)
        return 1;
    if (memblock_unref_device(ctx, &ctx->constants->global_dynid_mem_54616, "ctx->constants->global_dynid_mem_54616") != 0)
        return 1;
    if (memblock_unref_device(ctx, &ctx->constants->global_dynid_mem_54626, "ctx->constants->global_dynid_mem_54626") != 0)
        return 1;
    if (memblock_unref_device(ctx, &ctx->constants->global_dynid_mem_54637, "ctx->constants->global_dynid_mem_54637") != 0)
        return 1;
    if (memblock_unref_device(ctx, &ctx->constants->global_dynid_mem_54642, "ctx->constants->global_dynid_mem_54642") != 0)
        return 1;
    if (memblock_unref_device(ctx, &ctx->constants->global_dynid_mem_54800, "ctx->constants->global_dynid_mem_54800") != 0)
        return 1;
    if (memblock_unref_device(ctx, &ctx->constants->global_dynid_mem_54871, "ctx->constants->global_dynid_mem_54871") != 0)
        return 1;
    if (memblock_unref_device(ctx, &ctx->constants->global_dynid_mem_54920, "ctx->constants->global_dynid_mem_54920") != 0)
        return 1;
    if (memblock_unref_device(ctx, &ctx->constants->global_dynid_mem_55083, "ctx->constants->global_dynid_mem_55083") != 0)
        return 1;
    if (memblock_unref_device(ctx, &ctx->constants->global_dynid_mem_55112, "ctx->constants->global_dynid_mem_55112") != 0)
        return 1;
    if (memblock_unref_device(ctx, &ctx->constants->global_dynid_mem_55221, "ctx->constants->global_dynid_mem_55221") != 0)
        return 1;
    if (memblock_unref_device(ctx, &ctx->constants->global_dynid_mem_55228, "ctx->constants->global_dynid_mem_55228") != 0)
        return 1;
    if (memblock_unref_device(ctx, &ctx->constants->global_dynid_mem_55334, "ctx->constants->global_dynid_mem_55334") != 0)
        return 1;
    if (memblock_unref_device(ctx, &ctx->constants->global_dynid_mem_55338, "ctx->constants->global_dynid_mem_55338") != 0)
        return 1;
    if (memblock_unref_device(ctx, &ctx->constants->global_dynid_mem_55581, "ctx->constants->global_dynid_mem_55581") != 0)
        return 1;
    if (memblock_unref_device(ctx, &ctx->constants->global_dynid_mem_55728, "ctx->constants->global_dynid_mem_55728") != 0)
        return 1;
    if (memblock_unref_device(ctx, &ctx->constants->global_dynid_mem_55884, "ctx->constants->global_dynid_mem_55884") != 0)
        return 1;
    if (memblock_unref_device(ctx, &ctx->constants->global_dynid_mem_56002, "ctx->constants->global_dynid_mem_56002") != 0)
        return 1;
    if (memblock_unref_device(ctx, &ctx->constants->global_dynid_mem_56151, "ctx->constants->global_dynid_mem_56151") != 0)
        return 1;
    if (memblock_unref_device(ctx, &ctx->constants->global_dynid_mem_56269, "ctx->constants->global_dynid_mem_56269") != 0)
        return 1;
    if (memblock_unref_device(ctx, &ctx->constants->global_dynid_mem_56425, "ctx->constants->global_dynid_mem_56425") != 0)
        return 1;
    return 0;
}
static int gpu_kernel_builtinzhiota_i64ziiota_i64_54730(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int64_t arg0, int64_t arg1, int64_t arg2, int64_t arg3, int64_t arg4, gpu_mem arg5)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[6] = {&arg0, &arg1, &arg2, &arg3, &arg4, &arg5};
        size_t args_sizes[6] = {sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5)};
        
        return gpu_launch_kernel(ctx, ctx->program->builtinzhiota_i64ziiota_i64_54730, "builtin#iota_i64.iota_i64_54730", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 6, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_builtinzhreplicate_boolzireplicate_55479(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int64_t arg0, bool arg1, int64_t arg2, int64_t arg3, int64_t arg4, gpu_mem arg5)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[6] = {&arg0, &arg1, &arg2, &arg3, &arg4, &arg5};
        size_t args_sizes[6] = {sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5)};
        
        return gpu_launch_kernel(ctx, ctx->program->builtinzhreplicate_boolzireplicate_55479, "builtin#replicate_bool.replicate_55479", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 6, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_builtinzhreplicate_f64zireplicate_54806(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int64_t arg0, double arg1, int64_t arg2, int64_t arg3, int64_t arg4, gpu_mem arg5)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[6] = {&arg0, &arg1, &arg2, &arg3, &arg4, &arg5};
        size_t args_sizes[6] = {sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5)};
        
        return gpu_launch_kernel(ctx, ctx->program->builtinzhreplicate_f64zireplicate_54806, "builtin#replicate_f64.replicate_54806", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 6, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_builtinzhreplicate_i32zireplicate_54632(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int64_t arg0, int32_t arg1, int64_t arg2, int64_t arg3, int64_t arg4, gpu_mem arg5)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[6] = {&arg0, &arg1, &arg2, &arg3, &arg4, &arg5};
        size_t args_sizes[6] = {sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5)};
        
        return gpu_launch_kernel(ctx, ctx->program->builtinzhreplicate_i32zireplicate_54632, "builtin#replicate_i32.replicate_54632", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 6, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_builtinzhreplicate_i64zireplicate_54547(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int64_t arg0, int64_t arg1, int64_t arg2, int64_t arg3, int64_t arg4, gpu_mem arg5)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[6] = {&arg0, &arg1, &arg2, &arg3, &arg4, &arg5};
        size_t args_sizes[6] = {sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5)};
        
        return gpu_launch_kernel(ctx, ctx->program->builtinzhreplicate_i64zireplicate_54547, "builtin#replicate_i64.replicate_54547", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 6, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_builtinzhreplicate_i8zireplicate_54597(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int64_t arg0, int8_t arg1, int64_t arg2, int64_t arg3, int64_t arg4, gpu_mem arg5)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[6] = {&arg0, &arg1, &arg2, &arg3, &arg4, &arg5};
        size_t args_sizes[6] = {sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5)};
        
        return gpu_launch_kernel(ctx, ctx->program->builtinzhreplicate_i8zireplicate_54597, "builtin#replicate_i8.replicate_54597", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 6, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_add_next_partition_doublezisegscan_46784(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int64_t arg0, int64_t arg1, int64_t arg2, int64_t arg3, gpu_mem arg4, gpu_mem arg5, gpu_mem arg6, gpu_mem arg7, gpu_mem arg8, gpu_mem arg9, gpu_mem arg10, gpu_mem arg11, gpu_mem arg12, gpu_mem arg13)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[15] = {&ctx->global_failure, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6, &arg7, &arg8, &arg9, &arg10, &arg11, &arg12, &arg13};
        size_t args_sizes[15] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6), sizeof(arg7), sizeof(arg8), sizeof(arg9), sizeof(arg10), sizeof(arg11), sizeof(arg12), sizeof(arg13)};
        
        return gpu_launch_kernel(ctx, ctx->program->add_next_partition_doublezisegscan_46784, "add_next_partition_double.segscan_46784", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 15, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_add_next_partition_doublezisegmap_46786(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int64_t arg0, int64_t arg1, int64_t arg2, int32_t arg3, gpu_mem arg4, gpu_mem arg5, gpu_mem arg6, gpu_mem arg7, gpu_mem arg8, gpu_mem arg9, gpu_mem arg10, gpu_mem arg11, gpu_mem arg12, gpu_mem arg13, gpu_mem arg14)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[16] = {&ctx->global_failure, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6, &arg7, &arg8, &arg9, &arg10, &arg11, &arg12, &arg13, &arg14};
        size_t args_sizes[16] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6), sizeof(arg7), sizeof(arg8), sizeof(arg9), sizeof(arg10), sizeof(arg11), sizeof(arg12), sizeof(arg13), sizeof(arg14)};
        
        return gpu_launch_kernel(ctx, ctx->program->add_next_partition_doublezisegmap_46786, "add_next_partition_double.segmap_46786", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 16, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_add_next_partition_doublezigpuseq_54795(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, gpu_mem arg0, gpu_mem arg1)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[3] = {&ctx->global_failure, &arg0, &arg1};
        size_t args_sizes[3] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1)};
        
        return gpu_launch_kernel(ctx, ctx->program->add_next_partition_doublezigpuseq_54795, "add_next_partition_double.gpuseq_54795", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 3, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_add_next_partition_doublezigpuseq_54821(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, gpu_mem arg0, gpu_mem arg1)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[3] = {&ctx->global_failure, &arg0, &arg1};
        size_t args_sizes[3] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1)};
        
        return gpu_launch_kernel(ctx, ctx->program->add_next_partition_doublezigpuseq_54821, "add_next_partition_double.gpuseq_54821", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 3, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_add_next_partition_doublezigpuseq_54827(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, gpu_mem arg0, gpu_mem arg1)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[3] = {&ctx->global_failure, &arg0, &arg1};
        size_t args_sizes[3] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1)};
        
        return gpu_launch_kernel(ctx, ctx->program->add_next_partition_doublezigpuseq_54827, "add_next_partition_double.gpuseq_54827", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 3, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_add_next_partition_doublezigpuseq_54833(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, gpu_mem arg0, gpu_mem arg1)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[3] = {&ctx->global_failure, &arg0, &arg1};
        size_t args_sizes[3] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1)};
        
        return gpu_launch_kernel(ctx, ctx->program->add_next_partition_doublezigpuseq_54833, "add_next_partition_double.gpuseq_54833", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 3, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_add_next_partition_doublezigpuseq_54839(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, gpu_mem arg0, gpu_mem arg1)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[3] = {&ctx->global_failure, &arg0, &arg1};
        size_t args_sizes[3] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1)};
        
        return gpu_launch_kernel(ctx, ctx->program->add_next_partition_doublezigpuseq_54839, "add_next_partition_double.gpuseq_54839", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 3, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_add_next_partition_doublezigpuseq_54845(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, gpu_mem arg0, gpu_mem arg1)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[3] = {&ctx->global_failure, &arg0, &arg1};
        size_t args_sizes[3] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1)};
        
        return gpu_launch_kernel(ctx, ctx->program->add_next_partition_doublezigpuseq_54845, "add_next_partition_double.gpuseq_54845", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 3, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_add_next_partition_doublezigpuseq_54852(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int64_t arg0, bool arg1, gpu_mem arg2, gpu_mem arg3, gpu_mem arg4, gpu_mem arg5, gpu_mem arg6, gpu_mem arg7, gpu_mem arg8, gpu_mem arg9, gpu_mem arg10, gpu_mem arg11, gpu_mem arg12, gpu_mem arg13, gpu_mem arg14, gpu_mem arg15, gpu_mem arg16, gpu_mem arg17, gpu_mem arg18, gpu_mem arg19, gpu_mem arg20)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[24] = {&ctx->global_failure, &ctx->failure_is_an_option, &ctx->global_failure_args, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6, &arg7, &arg8, &arg9, &arg10, &arg11, &arg12, &arg13, &arg14, &arg15, &arg16, &arg17, &arg18, &arg19, &arg20};
        size_t args_sizes[24] = {sizeof(ctx->global_failure), sizeof(ctx->failure_is_an_option), sizeof(ctx->global_failure_args), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6), sizeof(arg7), sizeof(arg8), sizeof(arg9), sizeof(arg10), sizeof(arg11), sizeof(arg12), sizeof(arg13), sizeof(arg14), sizeof(arg15), sizeof(arg16), sizeof(arg17), sizeof(arg18), sizeof(arg19), sizeof(arg20)};
        
        return gpu_launch_kernel(ctx, ctx->program->add_next_partition_doublezigpuseq_54852, "add_next_partition_double.gpuseq_54852", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 24, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_add_next_partition_doublezisegmap_intrablock_49824(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int64_t arg0, int64_t arg1, int64_t arg2, double arg3, int64_t arg4, int64_t arg5, bool arg6, int64_t arg7, gpu_mem arg8, gpu_mem arg9, gpu_mem arg10, gpu_mem arg11, gpu_mem arg12, gpu_mem arg13, gpu_mem arg14, gpu_mem arg15, gpu_mem arg16, gpu_mem arg17, gpu_mem arg18)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[22] = {&ctx->global_failure, &ctx->failure_is_an_option, &ctx->global_failure_args, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6, &arg7, &arg8, &arg9, &arg10, &arg11, &arg12, &arg13, &arg14, &arg15, &arg16, &arg17, &arg18};
        size_t args_sizes[22] = {sizeof(ctx->global_failure), sizeof(ctx->failure_is_an_option), sizeof(ctx->global_failure_args), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6), sizeof(arg7), sizeof(arg8), sizeof(arg9), sizeof(arg10), sizeof(arg11), sizeof(arg12), sizeof(arg13), sizeof(arg14), sizeof(arg15), sizeof(arg16), sizeof(arg17), sizeof(arg18)};
        
        return gpu_launch_kernel(ctx, ctx->program->add_next_partition_doublezisegmap_intrablock_49824, "add_next_partition_double.segmap_intrablock_49824", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 22, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_add_next_partition_doublezisegmap_intrablock_46316(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int64_t arg0, int64_t arg1, int64_t arg2, double arg3, int64_t arg4, gpu_mem arg5, gpu_mem arg6, gpu_mem arg7, gpu_mem arg8, gpu_mem arg9, gpu_mem arg10, gpu_mem arg11, gpu_mem arg12, gpu_mem arg13, gpu_mem arg14, gpu_mem arg15)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[19] = {&ctx->global_failure, &ctx->failure_is_an_option, &ctx->global_failure_args, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6, &arg7, &arg8, &arg9, &arg10, &arg11, &arg12, &arg13, &arg14, &arg15};
        size_t args_sizes[19] = {sizeof(ctx->global_failure), sizeof(ctx->failure_is_an_option), sizeof(ctx->global_failure_args), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6), sizeof(arg7), sizeof(arg8), sizeof(arg9), sizeof(arg10), sizeof(arg11), sizeof(arg12), sizeof(arg13), sizeof(arg14), sizeof(arg15)};
        
        return gpu_launch_kernel(ctx, ctx->program->add_next_partition_doublezisegmap_intrablock_46316, "add_next_partition_double.segmap_intrablock_46316", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 19, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_add_next_partition_doublezisegmap_46379(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int64_t arg0, gpu_mem arg1, gpu_mem arg2, gpu_mem arg3)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[7] = {&ctx->global_failure, &ctx->failure_is_an_option, &ctx->global_failure_args, &arg0, &arg1, &arg2, &arg3};
        size_t args_sizes[7] = {sizeof(ctx->global_failure), sizeof(ctx->failure_is_an_option), sizeof(ctx->global_failure_args), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3)};
        
        return gpu_launch_kernel(ctx, ctx->program->add_next_partition_doublezisegmap_46379, "add_next_partition_double.segmap_46379", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 7, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_add_next_partition_doublezisegred_small_46395(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int64_t arg0, int64_t arg1, int64_t arg2, gpu_mem arg3, gpu_mem arg4, gpu_mem arg5)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[7] = {&ctx->global_failure, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5};
        size_t args_sizes[7] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5)};
        
        return gpu_launch_kernel(ctx, ctx->program->add_next_partition_doublezisegred_small_46395, "add_next_partition_double.segred_small_46395", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 7, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_add_next_partition_doublezisegred_large_46395(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int64_t arg0, int64_t arg1, int64_t arg2, int64_t arg3, int64_t arg4, int64_t arg5, gpu_mem arg6, gpu_mem arg7, gpu_mem arg8, gpu_mem arg9, gpu_mem arg10)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[12] = {&ctx->global_failure, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6, &arg7, &arg8, &arg9, &arg10};
        size_t args_sizes[12] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6), sizeof(arg7), sizeof(arg8), sizeof(arg9), sizeof(arg10)};
        
        return gpu_launch_kernel(ctx, ctx->program->add_next_partition_doublezisegred_large_46395, "add_next_partition_double.segred_large_46395", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 12, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_add_next_partition_doublezisegmap_46408(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int64_t arg0, double arg1, gpu_mem arg2, gpu_mem arg3, gpu_mem arg4, gpu_mem arg5, gpu_mem arg6, gpu_mem arg7, gpu_mem arg8, gpu_mem arg9, gpu_mem arg10)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[14] = {&ctx->global_failure, &ctx->failure_is_an_option, &ctx->global_failure_args, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6, &arg7, &arg8, &arg9, &arg10};
        size_t args_sizes[14] = {sizeof(ctx->global_failure), sizeof(ctx->failure_is_an_option), sizeof(ctx->global_failure_args), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6), sizeof(arg7), sizeof(arg8), sizeof(arg9), sizeof(arg10)};
        
        return gpu_launch_kernel(ctx, ctx->program->add_next_partition_doublezisegmap_46408, "add_next_partition_double.segmap_46408", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 14, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_add_next_partition_doublezisegscan_46461(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int64_t arg0, int64_t arg1, int64_t arg2, gpu_mem arg3, gpu_mem arg4, gpu_mem arg5, gpu_mem arg6, gpu_mem arg7, gpu_mem arg8)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[10] = {&ctx->global_failure, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6, &arg7, &arg8};
        size_t args_sizes[10] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6), sizeof(arg7), sizeof(arg8)};
        
        return gpu_launch_kernel(ctx, ctx->program->add_next_partition_doublezisegscan_46461, "add_next_partition_double.segscan_46461", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 10, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_add_next_partition_doublezisegmap_46471(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int64_t arg0, int64_t arg1, int32_t arg2, gpu_mem arg3, gpu_mem arg4, gpu_mem arg5, gpu_mem arg6)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[8] = {&ctx->global_failure, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6};
        size_t args_sizes[8] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6)};
        
        return gpu_launch_kernel(ctx, ctx->program->add_next_partition_doublezisegmap_46471, "add_next_partition_double.segmap_46471", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 8, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_add_next_partition_doublezisegscan_46485(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int64_t arg0, int64_t arg1, int64_t arg2, int64_t arg3, int64_t arg4, int64_t arg5, gpu_mem arg6, gpu_mem arg7, gpu_mem arg8, gpu_mem arg9, gpu_mem arg10, gpu_mem arg11, gpu_mem arg12, gpu_mem arg13, gpu_mem arg14)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[18] = {&ctx->global_failure, &ctx->failure_is_an_option, &ctx->global_failure_args, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6, &arg7, &arg8, &arg9, &arg10, &arg11, &arg12, &arg13, &arg14};
        size_t args_sizes[18] = {sizeof(ctx->global_failure), sizeof(ctx->failure_is_an_option), sizeof(ctx->global_failure_args), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6), sizeof(arg7), sizeof(arg8), sizeof(arg9), sizeof(arg10), sizeof(arg11), sizeof(arg12), sizeof(arg13), sizeof(arg14)};
        
        return gpu_launch_kernel(ctx, ctx->program->add_next_partition_doublezisegscan_46485, "add_next_partition_double.segscan_46485", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 18, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_add_next_partition_doublezisegscan_46800(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int64_t arg0, int64_t arg1, double arg2, int64_t arg3, bool arg4, int64_t arg5, int64_t arg6, int64_t arg7, gpu_mem arg8, gpu_mem arg9, gpu_mem arg10, gpu_mem arg11, gpu_mem arg12, gpu_mem arg13, gpu_mem arg14, gpu_mem arg15, gpu_mem arg16, gpu_mem arg17, gpu_mem arg18, gpu_mem arg19, gpu_mem arg20, gpu_mem arg21, gpu_mem arg22, gpu_mem arg23, gpu_mem arg24, gpu_mem arg25, gpu_mem arg26, gpu_mem arg27, gpu_mem arg28)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[32] = {&ctx->global_failure, &ctx->failure_is_an_option, &ctx->global_failure_args, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6, &arg7, &arg8, &arg9, &arg10, &arg11, &arg12, &arg13, &arg14, &arg15, &arg16, &arg17, &arg18, &arg19, &arg20, &arg21, &arg22, &arg23, &arg24, &arg25, &arg26, &arg27, &arg28};
        size_t args_sizes[32] = {sizeof(ctx->global_failure), sizeof(ctx->failure_is_an_option), sizeof(ctx->global_failure_args), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6), sizeof(arg7), sizeof(arg8), sizeof(arg9), sizeof(arg10), sizeof(arg11), sizeof(arg12), sizeof(arg13), sizeof(arg14), sizeof(arg15), sizeof(arg16), sizeof(arg17), sizeof(arg18), sizeof(arg19), sizeof(arg20), sizeof(arg21), sizeof(arg22), sizeof(arg23), sizeof(arg24), sizeof(arg25), sizeof(arg26), sizeof(arg27), sizeof(arg28)};
        
        return gpu_launch_kernel(ctx, ctx->program->add_next_partition_doublezisegscan_46800, "add_next_partition_double.segscan_46800", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 32, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_add_next_partition_doublezisegmap_46487(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int64_t arg0, int64_t arg1, int64_t arg2, int64_t arg3, int32_t arg4, gpu_mem arg5, gpu_mem arg6, gpu_mem arg7, gpu_mem arg8, gpu_mem arg9)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[11] = {&ctx->global_failure, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6, &arg7, &arg8, &arg9};
        size_t args_sizes[11] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6), sizeof(arg7), sizeof(arg8), sizeof(arg9)};
        
        return gpu_launch_kernel(ctx, ctx->program->add_next_partition_doublezisegmap_46487, "add_next_partition_double.segmap_46487", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 11, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_add_next_partition_doublezisegmap_intrablock_50036(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int64_t arg0, double arg1, int64_t arg2, gpu_mem arg3, gpu_mem arg4, gpu_mem arg5, gpu_mem arg6, gpu_mem arg7, gpu_mem arg8, gpu_mem arg9)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[13] = {&ctx->global_failure, &ctx->failure_is_an_option, &ctx->global_failure_args, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6, &arg7, &arg8, &arg9};
        size_t args_sizes[13] = {sizeof(ctx->global_failure), sizeof(ctx->failure_is_an_option), sizeof(ctx->global_failure_args), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6), sizeof(arg7), sizeof(arg8), sizeof(arg9)};
        
        return gpu_launch_kernel(ctx, ctx->program->add_next_partition_doublezisegmap_intrablock_50036, "add_next_partition_double.segmap_intrablock_50036", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 13, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_add_next_partition_doublezisegred_small_46644(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int64_t arg0, double arg1, int64_t arg2, int64_t arg3, gpu_mem arg4, gpu_mem arg5, gpu_mem arg6, gpu_mem arg7, gpu_mem arg8, gpu_mem arg9, gpu_mem arg10)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[14] = {&ctx->global_failure, &ctx->failure_is_an_option, &ctx->global_failure_args, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6, &arg7, &arg8, &arg9, &arg10};
        size_t args_sizes[14] = {sizeof(ctx->global_failure), sizeof(ctx->failure_is_an_option), sizeof(ctx->global_failure_args), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6), sizeof(arg7), sizeof(arg8), sizeof(arg9), sizeof(arg10)};
        
        return gpu_launch_kernel(ctx, ctx->program->add_next_partition_doublezisegred_small_46644, "add_next_partition_double.segred_small_46644", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 14, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_add_next_partition_doublezisegred_large_46644(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int64_t arg0, double arg1, int64_t arg2, int64_t arg3, int64_t arg4, int64_t arg5, int64_t arg6, gpu_mem arg7, gpu_mem arg8, gpu_mem arg9, gpu_mem arg10, gpu_mem arg11, gpu_mem arg12, gpu_mem arg13, gpu_mem arg14, gpu_mem arg15)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[19] = {&ctx->global_failure, &ctx->failure_is_an_option, &ctx->global_failure_args, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6, &arg7, &arg8, &arg9, &arg10, &arg11, &arg12, &arg13, &arg14, &arg15};
        size_t args_sizes[19] = {sizeof(ctx->global_failure), sizeof(ctx->failure_is_an_option), sizeof(ctx->global_failure_args), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6), sizeof(arg7), sizeof(arg8), sizeof(arg9), sizeof(arg10), sizeof(arg11), sizeof(arg12), sizeof(arg13), sizeof(arg14), sizeof(arg15)};
        
        return gpu_launch_kernel(ctx, ctx->program->add_next_partition_doublezisegred_large_46644, "add_next_partition_double.segred_large_46644", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 19, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_add_next_partition_doublezisegmap_46736(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int64_t arg0, double arg1, gpu_mem arg2, gpu_mem arg3, gpu_mem arg4, gpu_mem arg5, gpu_mem arg6, gpu_mem arg7, gpu_mem arg8, gpu_mem arg9)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[13] = {&ctx->global_failure, &ctx->failure_is_an_option, &ctx->global_failure_args, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6, &arg7, &arg8, &arg9};
        size_t args_sizes[13] = {sizeof(ctx->global_failure), sizeof(ctx->failure_is_an_option), sizeof(ctx->global_failure_args), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6), sizeof(arg7), sizeof(arg8), sizeof(arg9)};
        
        return gpu_launch_kernel(ctx, ctx->program->add_next_partition_doublezisegmap_46736, "add_next_partition_double.segmap_46736", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 13, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_add_next_partition_doublezisegmap_46802(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int64_t arg0, int64_t arg1, int64_t arg2, int32_t arg3, gpu_mem arg4, gpu_mem arg5, gpu_mem arg6, gpu_mem arg7)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[9] = {&ctx->global_failure, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6, &arg7};
        size_t args_sizes[9] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6), sizeof(arg7)};
        
        return gpu_launch_kernel(ctx, ctx->program->add_next_partition_doublezisegmap_46802, "add_next_partition_double.segmap_46802", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 9, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_add_next_partition_doublezisegmap_46855(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int64_t arg0, int64_t arg1, int64_t arg2, int64_t arg3, int64_t arg4, int64_t arg5, int64_t arg6, gpu_mem arg7, gpu_mem arg8, gpu_mem arg9, gpu_mem arg10, gpu_mem arg11, gpu_mem arg12, gpu_mem arg13, gpu_mem arg14, gpu_mem arg15, gpu_mem arg16, gpu_mem arg17, gpu_mem arg18, gpu_mem arg19)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[23] = {&ctx->global_failure, &ctx->failure_is_an_option, &ctx->global_failure_args, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6, &arg7, &arg8, &arg9, &arg10, &arg11, &arg12, &arg13, &arg14, &arg15, &arg16, &arg17, &arg18, &arg19};
        size_t args_sizes[23] = {sizeof(ctx->global_failure), sizeof(ctx->failure_is_an_option), sizeof(ctx->global_failure_args), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6), sizeof(arg7), sizeof(arg8), sizeof(arg9), sizeof(arg10), sizeof(arg11), sizeof(arg12), sizeof(arg13), sizeof(arg14), sizeof(arg15), sizeof(arg16), sizeof(arg17), sizeof(arg18), sizeof(arg19)};
        
        return gpu_launch_kernel(ctx, ctx->program->add_next_partition_doublezisegmap_46855, "add_next_partition_double.segmap_46855", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 23, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_add_next_partition_doublezisegmap_46923(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int64_t arg0, int64_t arg1, int64_t arg2, int64_t arg3, int64_t arg4, int64_t arg5, int64_t arg6, gpu_mem arg7, gpu_mem arg8, gpu_mem arg9, gpu_mem arg10, gpu_mem arg11, gpu_mem arg12, gpu_mem arg13, gpu_mem arg14, gpu_mem arg15, gpu_mem arg16)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[20] = {&ctx->global_failure, &ctx->failure_is_an_option, &ctx->global_failure_args, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6, &arg7, &arg8, &arg9, &arg10, &arg11, &arg12, &arg13, &arg14, &arg15, &arg16};
        size_t args_sizes[20] = {sizeof(ctx->global_failure), sizeof(ctx->failure_is_an_option), sizeof(ctx->global_failure_args), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6), sizeof(arg7), sizeof(arg8), sizeof(arg9), sizeof(arg10), sizeof(arg11), sizeof(arg12), sizeof(arg13), sizeof(arg14), sizeof(arg15), sizeof(arg16)};
        
        return gpu_launch_kernel(ctx, ctx->program->add_next_partition_doublezisegmap_46923, "add_next_partition_double.segmap_46923", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 20, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_add_next_partition_doublezigpuseq_55663(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, double arg0, gpu_mem arg1, gpu_mem arg2, gpu_mem arg3, gpu_mem arg4, gpu_mem arg5, gpu_mem arg6, gpu_mem arg7, gpu_mem arg8, gpu_mem arg9, gpu_mem arg10, gpu_mem arg11, gpu_mem arg12, gpu_mem arg13)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[15] = {&ctx->global_failure, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6, &arg7, &arg8, &arg9, &arg10, &arg11, &arg12, &arg13};
        size_t args_sizes[15] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6), sizeof(arg7), sizeof(arg8), sizeof(arg9), sizeof(arg10), sizeof(arg11), sizeof(arg12), sizeof(arg13)};
        
        return gpu_launch_kernel(ctx, ctx->program->add_next_partition_doublezigpuseq_55663, "add_next_partition_double.gpuseq_55663", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 15, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_do_DBSCAN_doublezisegscan_46953(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int64_t arg0, int64_t arg1, int64_t arg2, int64_t arg3, gpu_mem arg4, gpu_mem arg5, gpu_mem arg6, gpu_mem arg7, gpu_mem arg8, gpu_mem arg9, gpu_mem arg10)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[12] = {&ctx->global_failure, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6, &arg7, &arg8, &arg9, &arg10};
        size_t args_sizes[12] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6), sizeof(arg7), sizeof(arg8), sizeof(arg9), sizeof(arg10)};
        
        return gpu_launch_kernel(ctx, ctx->program->do_DBSCAN_doublezisegscan_46953, "do_DBSCAN_double.segscan_46953", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 12, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_do_DBSCAN_doublezisegmap_46955(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int64_t arg0, int64_t arg1, int64_t arg2, int32_t arg3, gpu_mem arg4, gpu_mem arg5, gpu_mem arg6, gpu_mem arg7, gpu_mem arg8, gpu_mem arg9, gpu_mem arg10)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[12] = {&ctx->global_failure, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6, &arg7, &arg8, &arg9, &arg10};
        size_t args_sizes[12] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6), sizeof(arg7), sizeof(arg8), sizeof(arg9), sizeof(arg10)};
        
        return gpu_launch_kernel(ctx, ctx->program->do_DBSCAN_doublezisegmap_46955, "do_DBSCAN_double.segmap_46955", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 12, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_do_DBSCAN_doublezigpuseq_54781(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, double arg0, double arg1, gpu_mem arg2, gpu_mem arg3, gpu_mem arg4)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[6] = {&ctx->global_failure, &arg0, &arg1, &arg2, &arg3, &arg4};
        size_t args_sizes[6] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4)};
        
        return gpu_launch_kernel(ctx, ctx->program->do_DBSCAN_doublezigpuseq_54781, "do_DBSCAN_double.gpuseq_54781", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 6, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_do_DBSCAN_doublezisegscan_46969(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int64_t arg0, int64_t arg1, double arg2, int64_t arg3, int64_t arg4, int64_t arg5, gpu_mem arg6, gpu_mem arg7, gpu_mem arg8, gpu_mem arg9, gpu_mem arg10, gpu_mem arg11, gpu_mem arg12, gpu_mem arg13, gpu_mem arg14, gpu_mem arg15, gpu_mem arg16, gpu_mem arg17, gpu_mem arg18)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[22] = {&ctx->global_failure, &ctx->failure_is_an_option, &ctx->global_failure_args, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6, &arg7, &arg8, &arg9, &arg10, &arg11, &arg12, &arg13, &arg14, &arg15, &arg16, &arg17, &arg18};
        size_t args_sizes[22] = {sizeof(ctx->global_failure), sizeof(ctx->failure_is_an_option), sizeof(ctx->global_failure_args), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6), sizeof(arg7), sizeof(arg8), sizeof(arg9), sizeof(arg10), sizeof(arg11), sizeof(arg12), sizeof(arg13), sizeof(arg14), sizeof(arg15), sizeof(arg16), sizeof(arg17), sizeof(arg18)};
        
        return gpu_launch_kernel(ctx, ctx->program->do_DBSCAN_doublezisegscan_46969, "do_DBSCAN_double.segscan_46969", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 22, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_do_DBSCAN_doublezisegmap_46971(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int64_t arg0, int64_t arg1, int64_t arg2, int32_t arg3, gpu_mem arg4, gpu_mem arg5, gpu_mem arg6, gpu_mem arg7, gpu_mem arg8, gpu_mem arg9, gpu_mem arg10, gpu_mem arg11, gpu_mem arg12)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[14] = {&ctx->global_failure, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6, &arg7, &arg8, &arg9, &arg10, &arg11, &arg12};
        size_t args_sizes[14] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6), sizeof(arg7), sizeof(arg8), sizeof(arg9), sizeof(arg10), sizeof(arg11), sizeof(arg12)};
        
        return gpu_launch_kernel(ctx, ctx->program->do_DBSCAN_doublezisegmap_46971, "do_DBSCAN_double.segmap_46971", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 14, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_do_DBSCAN_doublezisegscan_46985(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, double arg0, int64_t arg1, int64_t arg2, int64_t arg3, int64_t arg4, gpu_mem arg5, gpu_mem arg6, gpu_mem arg7, gpu_mem arg8, gpu_mem arg9, gpu_mem arg10, gpu_mem arg11, gpu_mem arg12, gpu_mem arg13, gpu_mem arg14, gpu_mem arg15, gpu_mem arg16, gpu_mem arg17, gpu_mem arg18)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[20] = {&ctx->global_failure, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6, &arg7, &arg8, &arg9, &arg10, &arg11, &arg12, &arg13, &arg14, &arg15, &arg16, &arg17, &arg18};
        size_t args_sizes[20] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6), sizeof(arg7), sizeof(arg8), sizeof(arg9), sizeof(arg10), sizeof(arg11), sizeof(arg12), sizeof(arg13), sizeof(arg14), sizeof(arg15), sizeof(arg16), sizeof(arg17), sizeof(arg18)};
        
        return gpu_launch_kernel(ctx, ctx->program->do_DBSCAN_doublezisegscan_46985, "do_DBSCAN_double.segscan_46985", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 20, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_do_DBSCAN_doublezisegmap_46987(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int64_t arg0, int64_t arg1, int64_t arg2, int32_t arg3, gpu_mem arg4, gpu_mem arg5, gpu_mem arg6, gpu_mem arg7, gpu_mem arg8, gpu_mem arg9, gpu_mem arg10, gpu_mem arg11, gpu_mem arg12, gpu_mem arg13, gpu_mem arg14)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[16] = {&ctx->global_failure, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6, &arg7, &arg8, &arg9, &arg10, &arg11, &arg12, &arg13, &arg14};
        size_t args_sizes[16] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6), sizeof(arg7), sizeof(arg8), sizeof(arg9), sizeof(arg10), sizeof(arg11), sizeof(arg12), sizeof(arg13), sizeof(arg14)};
        
        return gpu_launch_kernel(ctx, ctx->program->do_DBSCAN_doublezisegmap_46987, "do_DBSCAN_double.segmap_46987", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 16, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_do_DBSCAN_doublezisegscan_47001(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int64_t arg0, int64_t arg1, int64_t arg2, int64_t arg3, int64_t arg4, gpu_mem arg5, gpu_mem arg6, gpu_mem arg7, gpu_mem arg8, gpu_mem arg9, gpu_mem arg10, gpu_mem arg11, gpu_mem arg12, gpu_mem arg13, gpu_mem arg14)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[16] = {&ctx->global_failure, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6, &arg7, &arg8, &arg9, &arg10, &arg11, &arg12, &arg13, &arg14};
        size_t args_sizes[16] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6), sizeof(arg7), sizeof(arg8), sizeof(arg9), sizeof(arg10), sizeof(arg11), sizeof(arg12), sizeof(arg13), sizeof(arg14)};
        
        return gpu_launch_kernel(ctx, ctx->program->do_DBSCAN_doublezisegscan_47001, "do_DBSCAN_double.segscan_47001", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 16, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_do_DBSCAN_doublezisegmap_47003(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int64_t arg0, int64_t arg1, int64_t arg2, int32_t arg3, gpu_mem arg4, gpu_mem arg5, gpu_mem arg6, gpu_mem arg7, gpu_mem arg8, gpu_mem arg9, gpu_mem arg10, gpu_mem arg11)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[13] = {&ctx->global_failure, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6, &arg7, &arg8, &arg9, &arg10, &arg11};
        size_t args_sizes[13] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6), sizeof(arg7), sizeof(arg8), sizeof(arg9), sizeof(arg10), sizeof(arg11)};
        
        return gpu_launch_kernel(ctx, ctx->program->do_DBSCAN_doublezisegmap_47003, "do_DBSCAN_double.segmap_47003", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 13, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_do_DBSCAN_doublezisegmap_47011(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int64_t arg0, int64_t arg1, int64_t arg2, int32_t arg3, gpu_mem arg4, gpu_mem arg5, gpu_mem arg6)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[8] = {&ctx->global_failure, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6};
        size_t args_sizes[8] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6)};
        
        return gpu_launch_kernel(ctx, ctx->program->do_DBSCAN_doublezisegmap_47011, "do_DBSCAN_double.segmap_47011", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 8, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_do_DBSCAN_doublezisegmap_47036(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int64_t arg0, int64_t arg1, gpu_mem arg2, gpu_mem arg3, gpu_mem arg4)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[6] = {&ctx->global_failure, &arg0, &arg1, &arg2, &arg3, &arg4};
        size_t args_sizes[6] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4)};
        
        return gpu_launch_kernel(ctx, ctx->program->do_DBSCAN_doublezisegmap_47036, "do_DBSCAN_double.segmap_47036", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 6, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_do_DBSCAN_doublezisegscan_47049(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int64_t arg0, int64_t arg1, int64_t arg2, int64_t arg3, gpu_mem arg4, gpu_mem arg5, gpu_mem arg6, gpu_mem arg7, gpu_mem arg8, gpu_mem arg9, gpu_mem arg10)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[12] = {&ctx->global_failure, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6, &arg7, &arg8, &arg9, &arg10};
        size_t args_sizes[12] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6), sizeof(arg7), sizeof(arg8), sizeof(arg9), sizeof(arg10)};
        
        return gpu_launch_kernel(ctx, ctx->program->do_DBSCAN_doublezisegscan_47049, "do_DBSCAN_double.segscan_47049", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 12, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_do_DBSCAN_doublezisegmap_47051(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int64_t arg0, int64_t arg1, int64_t arg2, int32_t arg3, gpu_mem arg4, gpu_mem arg5, gpu_mem arg6, gpu_mem arg7, gpu_mem arg8, gpu_mem arg9, gpu_mem arg10)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[12] = {&ctx->global_failure, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6, &arg7, &arg8, &arg9, &arg10};
        size_t args_sizes[12] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6), sizeof(arg7), sizeof(arg8), sizeof(arg9), sizeof(arg10)};
        
        return gpu_launch_kernel(ctx, ctx->program->do_DBSCAN_doublezisegmap_47051, "do_DBSCAN_double.segmap_47051", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 12, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_do_DBSCAN_doublezisegscan_47065(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int64_t arg0, int64_t arg1, int64_t arg2, int64_t arg3, int64_t arg4, gpu_mem arg5, gpu_mem arg6, gpu_mem arg7, gpu_mem arg8, gpu_mem arg9, gpu_mem arg10, gpu_mem arg11, gpu_mem arg12)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[14] = {&ctx->global_failure, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6, &arg7, &arg8, &arg9, &arg10, &arg11, &arg12};
        size_t args_sizes[14] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6), sizeof(arg7), sizeof(arg8), sizeof(arg9), sizeof(arg10), sizeof(arg11), sizeof(arg12)};
        
        return gpu_launch_kernel(ctx, ctx->program->do_DBSCAN_doublezisegscan_47065, "do_DBSCAN_double.segscan_47065", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 14, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_do_DBSCAN_doublezisegmap_intrablock_49824(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int8_t arg0, int8_t arg1, double arg2, double arg3, int64_t arg4, int64_t arg5, int64_t arg6, int64_t arg7, int64_t arg8, int64_t arg9, int64_t arg10, bool arg11, int64_t arg12, gpu_mem arg13, gpu_mem arg14, gpu_mem arg15, gpu_mem arg16, gpu_mem arg17, gpu_mem arg18)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[20] = {&ctx->global_failure, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6, &arg7, &arg8, &arg9, &arg10, &arg11, &arg12, &arg13, &arg14, &arg15, &arg16, &arg17, &arg18};
        size_t args_sizes[20] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6), sizeof(arg7), sizeof(arg8), sizeof(arg9), sizeof(arg10), sizeof(arg11), sizeof(arg12), sizeof(arg13), sizeof(arg14), sizeof(arg15), sizeof(arg16), sizeof(arg17), sizeof(arg18)};
        
        return gpu_launch_kernel(ctx, ctx->program->do_DBSCAN_doublezisegmap_intrablock_49824, "do_DBSCAN_double.segmap_intrablock_49824", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 20, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_do_DBSCAN_doublezisegmap_47249(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int8_t arg0, int64_t arg1, int64_t arg2, int64_t arg3, gpu_mem arg4, gpu_mem arg5, gpu_mem arg6, gpu_mem arg7, gpu_mem arg8, gpu_mem arg9, gpu_mem arg10)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[12] = {&ctx->global_failure, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6, &arg7, &arg8, &arg9, &arg10};
        size_t args_sizes[12] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6), sizeof(arg7), sizeof(arg8), sizeof(arg9), sizeof(arg10)};
        
        return gpu_launch_kernel(ctx, ctx->program->do_DBSCAN_doublezisegmap_47249, "do_DBSCAN_double.segmap_47249", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 12, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_do_DBSCAN_doublezisegred_small_47267(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int8_t arg0, int8_t arg1, double arg2, double arg3, int64_t arg4, int64_t arg5, int64_t arg6, int64_t arg7, int64_t arg8, bool arg9, int64_t arg10, gpu_mem arg11, gpu_mem arg12, gpu_mem arg13, gpu_mem arg14, gpu_mem arg15, gpu_mem arg16, gpu_mem arg17, gpu_mem arg18, gpu_mem arg19)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[21] = {&ctx->global_failure, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6, &arg7, &arg8, &arg9, &arg10, &arg11, &arg12, &arg13, &arg14, &arg15, &arg16, &arg17, &arg18, &arg19};
        size_t args_sizes[21] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6), sizeof(arg7), sizeof(arg8), sizeof(arg9), sizeof(arg10), sizeof(arg11), sizeof(arg12), sizeof(arg13), sizeof(arg14), sizeof(arg15), sizeof(arg16), sizeof(arg17), sizeof(arg18), sizeof(arg19)};
        
        return gpu_launch_kernel(ctx, ctx->program->do_DBSCAN_doublezisegred_small_47267, "do_DBSCAN_double.segred_small_47267", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 21, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_do_DBSCAN_doublezisegred_large_47267(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int8_t arg0, int8_t arg1, double arg2, double arg3, int64_t arg4, int64_t arg5, int64_t arg6, int64_t arg7, int64_t arg8, bool arg9, int64_t arg10, int64_t arg11, int64_t arg12, int64_t arg13, gpu_mem arg14, gpu_mem arg15, gpu_mem arg16, gpu_mem arg17, gpu_mem arg18, gpu_mem arg19, gpu_mem arg20, gpu_mem arg21, gpu_mem arg22, gpu_mem arg23, gpu_mem arg24)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[26] = {&ctx->global_failure, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6, &arg7, &arg8, &arg9, &arg10, &arg11, &arg12, &arg13, &arg14, &arg15, &arg16, &arg17, &arg18, &arg19, &arg20, &arg21, &arg22, &arg23, &arg24};
        size_t args_sizes[26] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6), sizeof(arg7), sizeof(arg8), sizeof(arg9), sizeof(arg10), sizeof(arg11), sizeof(arg12), sizeof(arg13), sizeof(arg14), sizeof(arg15), sizeof(arg16), sizeof(arg17), sizeof(arg18), sizeof(arg19), sizeof(arg20), sizeof(arg21), sizeof(arg22), sizeof(arg23), sizeof(arg24)};
        
        return gpu_launch_kernel(ctx, ctx->program->do_DBSCAN_doublezisegred_large_47267, "do_DBSCAN_double.segred_large_47267", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 26, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_do_DBSCAN_doublezisegred_nonseg_47317(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int64_t arg0, int64_t arg1, int64_t arg2, gpu_mem arg3, gpu_mem arg4, gpu_mem arg5, gpu_mem arg6, gpu_mem arg7)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[9] = {&ctx->global_failure, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6, &arg7};
        size_t args_sizes[9] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6), sizeof(arg7)};
        
        return gpu_launch_kernel(ctx, ctx->program->do_DBSCAN_doublezisegred_nonseg_47317, "do_DBSCAN_double.segred_nonseg_47317", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 9, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_do_DBSCAN_doublezisegscan_47325(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int64_t arg0, int64_t arg1, int64_t arg2, int64_t arg3, gpu_mem arg4, gpu_mem arg5, gpu_mem arg6, gpu_mem arg7, gpu_mem arg8, gpu_mem arg9)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[11] = {&ctx->global_failure, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6, &arg7, &arg8, &arg9};
        size_t args_sizes[11] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6), sizeof(arg7), sizeof(arg8), sizeof(arg9)};
        
        return gpu_launch_kernel(ctx, ctx->program->do_DBSCAN_doublezisegscan_47325, "do_DBSCAN_double.segscan_47325", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 11, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_do_DBSCAN_doublezisegmap_47345(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int64_t arg0, gpu_mem arg1, gpu_mem arg2)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[4] = {&ctx->global_failure, &arg0, &arg1, &arg2};
        size_t args_sizes[4] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1), sizeof(arg2)};
        
        return gpu_launch_kernel(ctx, ctx->program->do_DBSCAN_doublezisegmap_47345, "do_DBSCAN_double.segmap_47345", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 4, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_do_DBSCAN_doublezisegmap_47376(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int64_t arg0, int64_t arg1, int64_t arg2, gpu_mem arg3, gpu_mem arg4, gpu_mem arg5, gpu_mem arg6)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[10] = {&ctx->global_failure, &ctx->failure_is_an_option, &ctx->global_failure_args, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6};
        size_t args_sizes[10] = {sizeof(ctx->global_failure), sizeof(ctx->failure_is_an_option), sizeof(ctx->global_failure_args), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6)};
        
        return gpu_launch_kernel(ctx, ctx->program->do_DBSCAN_doublezisegmap_47376, "do_DBSCAN_double.segmap_47376", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 10, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_do_DBSCAN_doublezisegmap_47403(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int64_t arg0, int64_t arg1, gpu_mem arg2, gpu_mem arg3)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[5] = {&ctx->global_failure, &arg0, &arg1, &arg2, &arg3};
        size_t args_sizes[5] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3)};
        
        return gpu_launch_kernel(ctx, ctx->program->do_DBSCAN_doublezisegmap_47403, "do_DBSCAN_double.segmap_47403", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 5, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_do_DBSCAN_doublezisegmap_47407(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int64_t arg0, int64_t arg1, int64_t arg2, int64_t arg3, int32_t arg4, gpu_mem arg5, gpu_mem arg6, gpu_mem arg7, gpu_mem arg8, gpu_mem arg9, gpu_mem arg10, gpu_mem arg11)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[13] = {&ctx->global_failure, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6, &arg7, &arg8, &arg9, &arg10, &arg11};
        size_t args_sizes[13] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6), sizeof(arg7), sizeof(arg8), sizeof(arg9), sizeof(arg10), sizeof(arg11)};
        
        return gpu_launch_kernel(ctx, ctx->program->do_DBSCAN_doublezisegmap_47407, "do_DBSCAN_double.segmap_47407", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 13, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_do_DBSCAN_doublezisegmap_intrablock_50204(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int64_t arg0, int64_t arg1, int64_t arg2, int64_t arg3, bool arg4, int64_t arg5, gpu_mem arg6, gpu_mem arg7, gpu_mem arg8)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[10] = {&ctx->global_failure, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6, &arg7, &arg8};
        size_t args_sizes[10] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6), sizeof(arg7), sizeof(arg8)};
        
        return gpu_launch_kernel(ctx, ctx->program->do_DBSCAN_doublezisegmap_intrablock_50204, "do_DBSCAN_double.segmap_intrablock_50204", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 10, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_do_DBSCAN_doublezisegmap_intrablock_50559(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int64_t arg0, int64_t arg1, int64_t arg2, int64_t arg3, bool arg4, int64_t arg5, gpu_mem arg6, gpu_mem arg7, gpu_mem arg8)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[10] = {&ctx->global_failure, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6, &arg7, &arg8};
        size_t args_sizes[10] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6), sizeof(arg7), sizeof(arg8)};
        
        return gpu_launch_kernel(ctx, ctx->program->do_DBSCAN_doublezisegmap_intrablock_50559, "do_DBSCAN_double.segmap_intrablock_50559", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 10, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_do_DBSCAN_doublezisegscan_47812(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int64_t arg0, int64_t arg1, int64_t arg2, int64_t arg3, gpu_mem arg4, gpu_mem arg5, gpu_mem arg6, gpu_mem arg7, gpu_mem arg8, gpu_mem arg9)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[11] = {&ctx->global_failure, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6, &arg7, &arg8, &arg9};
        size_t args_sizes[11] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6), sizeof(arg7), sizeof(arg8), sizeof(arg9)};
        
        return gpu_launch_kernel(ctx, ctx->program->do_DBSCAN_doublezisegscan_47812, "do_DBSCAN_double.segscan_47812", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 11, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_do_DBSCAN_doublezisegmap_47820(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int64_t arg0, int64_t arg1, int64_t arg2, int32_t arg3, gpu_mem arg4, gpu_mem arg5, gpu_mem arg6, gpu_mem arg7, gpu_mem arg8, gpu_mem arg9)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[11] = {&ctx->global_failure, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6, &arg7, &arg8, &arg9};
        size_t args_sizes[11] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6), sizeof(arg7), sizeof(arg8), sizeof(arg9)};
        
        return gpu_launch_kernel(ctx, ctx->program->do_DBSCAN_doublezisegmap_47820, "do_DBSCAN_double.segmap_47820", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 11, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_do_DBSCAN_doublezisegmap_intrablock_50914(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int64_t arg0, int64_t arg1, int64_t arg2, int64_t arg3, int64_t arg4, int64_t arg5, int64_t arg6, bool arg7, int64_t arg8, gpu_mem arg9, gpu_mem arg10, gpu_mem arg11, gpu_mem arg12, gpu_mem arg13, gpu_mem arg14, gpu_mem arg15)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[17] = {&ctx->global_failure, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6, &arg7, &arg8, &arg9, &arg10, &arg11, &arg12, &arg13, &arg14, &arg15};
        size_t args_sizes[17] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6), sizeof(arg7), sizeof(arg8), sizeof(arg9), sizeof(arg10), sizeof(arg11), sizeof(arg12), sizeof(arg13), sizeof(arg14), sizeof(arg15)};
        
        return gpu_launch_kernel(ctx, ctx->program->do_DBSCAN_doublezisegmap_intrablock_50914, "do_DBSCAN_double.segmap_intrablock_50914", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 17, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_do_DBSCAN_doublezisegmap_intrablock_51193(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int64_t arg0, int64_t arg1, int64_t arg2, int64_t arg3, int64_t arg4, int64_t arg5, int64_t arg6, bool arg7, int64_t arg8, gpu_mem arg9, gpu_mem arg10, gpu_mem arg11, gpu_mem arg12, gpu_mem arg13, gpu_mem arg14, gpu_mem arg15)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[17] = {&ctx->global_failure, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6, &arg7, &arg8, &arg9, &arg10, &arg11, &arg12, &arg13, &arg14, &arg15};
        size_t args_sizes[17] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6), sizeof(arg7), sizeof(arg8), sizeof(arg9), sizeof(arg10), sizeof(arg11), sizeof(arg12), sizeof(arg13), sizeof(arg14), sizeof(arg15)};
        
        return gpu_launch_kernel(ctx, ctx->program->do_DBSCAN_doublezisegmap_intrablock_51193, "do_DBSCAN_double.segmap_intrablock_51193", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 17, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_do_DBSCAN_doublezisegscan_48125(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int64_t arg0, int64_t arg1, int64_t arg2, int64_t arg3, gpu_mem arg4, gpu_mem arg5, gpu_mem arg6, gpu_mem arg7, gpu_mem arg8, gpu_mem arg9)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[11] = {&ctx->global_failure, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6, &arg7, &arg8, &arg9};
        size_t args_sizes[11] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6), sizeof(arg7), sizeof(arg8), sizeof(arg9)};
        
        return gpu_launch_kernel(ctx, ctx->program->do_DBSCAN_doublezisegscan_48125, "do_DBSCAN_double.segscan_48125", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 11, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_do_DBSCAN_doublezisegmap_48458(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int64_t arg0, int64_t arg1, int64_t arg2, int64_t arg3, int32_t arg4, gpu_mem arg5, gpu_mem arg6, gpu_mem arg7, gpu_mem arg8, gpu_mem arg9, gpu_mem arg10, gpu_mem arg11)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[13] = {&ctx->global_failure, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6, &arg7, &arg8, &arg9, &arg10, &arg11};
        size_t args_sizes[13] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6), sizeof(arg7), sizeof(arg8), sizeof(arg9), sizeof(arg10), sizeof(arg11)};
        
        return gpu_launch_kernel(ctx, ctx->program->do_DBSCAN_doublezisegmap_48458, "do_DBSCAN_double.segmap_48458", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 13, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_do_DBSCAN_doublezisegmap_intrablock_51881(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int64_t arg0, int64_t arg1, int64_t arg2, int64_t arg3, bool arg4, int64_t arg5, gpu_mem arg6, gpu_mem arg7, gpu_mem arg8)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[10] = {&ctx->global_failure, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6, &arg7, &arg8};
        size_t args_sizes[10] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6), sizeof(arg7), sizeof(arg8)};
        
        return gpu_launch_kernel(ctx, ctx->program->do_DBSCAN_doublezisegmap_intrablock_51881, "do_DBSCAN_double.segmap_intrablock_51881", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 10, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_do_DBSCAN_doublezisegmap_intrablock_52263(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int64_t arg0, int64_t arg1, int64_t arg2, int64_t arg3, bool arg4, int64_t arg5, gpu_mem arg6, gpu_mem arg7, gpu_mem arg8)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[10] = {&ctx->global_failure, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6, &arg7, &arg8};
        size_t args_sizes[10] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6), sizeof(arg7), sizeof(arg8)};
        
        return gpu_launch_kernel(ctx, ctx->program->do_DBSCAN_doublezisegmap_intrablock_52263, "do_DBSCAN_double.segmap_intrablock_52263", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 10, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_do_DBSCAN_doublezisegscan_48902(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int64_t arg0, int64_t arg1, int64_t arg2, int64_t arg3, gpu_mem arg4, gpu_mem arg5, gpu_mem arg6, gpu_mem arg7, gpu_mem arg8, gpu_mem arg9)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[11] = {&ctx->global_failure, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6, &arg7, &arg8, &arg9};
        size_t args_sizes[11] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6), sizeof(arg7), sizeof(arg8), sizeof(arg9)};
        
        return gpu_launch_kernel(ctx, ctx->program->do_DBSCAN_doublezisegscan_48902, "do_DBSCAN_double.segscan_48902", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 11, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_do_DBSCAN_doublezisegmap_48163(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int64_t arg0, int64_t arg1, gpu_mem arg2, gpu_mem arg3, gpu_mem arg4, gpu_mem arg5, gpu_mem arg6, gpu_mem arg7)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[9] = {&ctx->global_failure, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6, &arg7};
        size_t args_sizes[9] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6), sizeof(arg7)};
        
        return gpu_launch_kernel(ctx, ctx->program->do_DBSCAN_doublezisegmap_48163, "do_DBSCAN_double.segmap_48163", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 9, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_do_DBSCAN_doublezisegmap_intrablock_51472(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int8_t arg0, int8_t arg1, double arg2, double arg3, int64_t arg4, int64_t arg5, int64_t arg6, int64_t arg7, int64_t arg8, int64_t arg9, bool arg10, int64_t arg11, gpu_mem arg12, gpu_mem arg13, gpu_mem arg14, gpu_mem arg15, gpu_mem arg16, gpu_mem arg17)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[19] = {&ctx->global_failure, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6, &arg7, &arg8, &arg9, &arg10, &arg11, &arg12, &arg13, &arg14, &arg15, &arg16, &arg17};
        size_t args_sizes[19] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6), sizeof(arg7), sizeof(arg8), sizeof(arg9), sizeof(arg10), sizeof(arg11), sizeof(arg12), sizeof(arg13), sizeof(arg14), sizeof(arg15), sizeof(arg16), sizeof(arg17)};
        
        return gpu_launch_kernel(ctx, ctx->program->do_DBSCAN_doublezisegmap_intrablock_51472, "do_DBSCAN_double.segmap_intrablock_51472", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 19, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_do_DBSCAN_doublezisegmap_48383(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int8_t arg0, int64_t arg1, int64_t arg2, gpu_mem arg3, gpu_mem arg4, gpu_mem arg5, gpu_mem arg6, gpu_mem arg7)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[9] = {&ctx->global_failure, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6, &arg7};
        size_t args_sizes[9] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6), sizeof(arg7)};
        
        return gpu_launch_kernel(ctx, ctx->program->do_DBSCAN_doublezisegmap_48383, "do_DBSCAN_double.segmap_48383", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 9, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_do_DBSCAN_doublezisegred_small_48402(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int8_t arg0, int8_t arg1, double arg2, double arg3, int64_t arg4, int64_t arg5, int64_t arg6, int64_t arg7, bool arg8, int64_t arg9, gpu_mem arg10, gpu_mem arg11, gpu_mem arg12, gpu_mem arg13, gpu_mem arg14, gpu_mem arg15, gpu_mem arg16, gpu_mem arg17, gpu_mem arg18, gpu_mem arg19)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[21] = {&ctx->global_failure, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6, &arg7, &arg8, &arg9, &arg10, &arg11, &arg12, &arg13, &arg14, &arg15, &arg16, &arg17, &arg18, &arg19};
        size_t args_sizes[21] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6), sizeof(arg7), sizeof(arg8), sizeof(arg9), sizeof(arg10), sizeof(arg11), sizeof(arg12), sizeof(arg13), sizeof(arg14), sizeof(arg15), sizeof(arg16), sizeof(arg17), sizeof(arg18), sizeof(arg19)};
        
        return gpu_launch_kernel(ctx, ctx->program->do_DBSCAN_doublezisegred_small_48402, "do_DBSCAN_double.segred_small_48402", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 21, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_do_DBSCAN_doublezisegred_large_48402(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int8_t arg0, int8_t arg1, double arg2, double arg3, int64_t arg4, int64_t arg5, int64_t arg6, int64_t arg7, bool arg8, int64_t arg9, int64_t arg10, int64_t arg11, int64_t arg12, gpu_mem arg13, gpu_mem arg14, gpu_mem arg15, gpu_mem arg16, gpu_mem arg17, gpu_mem arg18, gpu_mem arg19, gpu_mem arg20, gpu_mem arg21, gpu_mem arg22, gpu_mem arg23, gpu_mem arg24, gpu_mem arg25)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[27] = {&ctx->global_failure, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6, &arg7, &arg8, &arg9, &arg10, &arg11, &arg12, &arg13, &arg14, &arg15, &arg16, &arg17, &arg18, &arg19, &arg20, &arg21, &arg22, &arg23, &arg24, &arg25};
        size_t args_sizes[27] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6), sizeof(arg7), sizeof(arg8), sizeof(arg9), sizeof(arg10), sizeof(arg11), sizeof(arg12), sizeof(arg13), sizeof(arg14), sizeof(arg15), sizeof(arg16), sizeof(arg17), sizeof(arg18), sizeof(arg19), sizeof(arg20), sizeof(arg21), sizeof(arg22), sizeof(arg23), sizeof(arg24), sizeof(arg25)};
        
        return gpu_launch_kernel(ctx, ctx->program->do_DBSCAN_doublezisegred_large_48402, "do_DBSCAN_double.segred_large_48402", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 27, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_do_DBSCAN_doublezisegmap_48450(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int64_t arg0, int64_t arg1, int64_t arg2, int64_t arg3, int32_t arg4, gpu_mem arg5, gpu_mem arg6, gpu_mem arg7, gpu_mem arg8, gpu_mem arg9)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[11] = {&ctx->global_failure, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6, &arg7, &arg8, &arg9};
        size_t args_sizes[11] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6), sizeof(arg7), sizeof(arg8), sizeof(arg9)};
        
        return gpu_launch_kernel(ctx, ctx->program->do_DBSCAN_doublezisegmap_48450, "do_DBSCAN_double.segmap_48450", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 11, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_do_DBSCAN_doublezisegmap_48910(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int64_t arg0, int64_t arg1, int64_t arg2, int32_t arg3, gpu_mem arg4, gpu_mem arg5, gpu_mem arg6, gpu_mem arg7, gpu_mem arg8, gpu_mem arg9)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[11] = {&ctx->global_failure, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6, &arg7, &arg8, &arg9};
        size_t args_sizes[11] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6), sizeof(arg7), sizeof(arg8), sizeof(arg9)};
        
        return gpu_launch_kernel(ctx, ctx->program->do_DBSCAN_doublezisegmap_48910, "do_DBSCAN_double.segmap_48910", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 11, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_do_DBSCAN_doublezisegmap_intrablock_52645(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int8_t arg0, int8_t arg1, double arg2, double arg3, int64_t arg4, int64_t arg5, int64_t arg6, int64_t arg7, int64_t arg8, int64_t arg9, bool arg10, int64_t arg11, gpu_mem arg12, gpu_mem arg13, gpu_mem arg14, gpu_mem arg15, gpu_mem arg16, gpu_mem arg17)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[19] = {&ctx->global_failure, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6, &arg7, &arg8, &arg9, &arg10, &arg11, &arg12, &arg13, &arg14, &arg15, &arg16, &arg17};
        size_t args_sizes[19] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6), sizeof(arg7), sizeof(arg8), sizeof(arg9), sizeof(arg10), sizeof(arg11), sizeof(arg12), sizeof(arg13), sizeof(arg14), sizeof(arg15), sizeof(arg16), sizeof(arg17)};
        
        return gpu_launch_kernel(ctx, ctx->program->do_DBSCAN_doublezisegmap_intrablock_52645, "do_DBSCAN_double.segmap_intrablock_52645", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 19, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_do_DBSCAN_doublezisegmap_49121(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int8_t arg0, int64_t arg1, int64_t arg2, gpu_mem arg3, gpu_mem arg4, gpu_mem arg5, gpu_mem arg6, gpu_mem arg7)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[9] = {&ctx->global_failure, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6, &arg7};
        size_t args_sizes[9] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6), sizeof(arg7)};
        
        return gpu_launch_kernel(ctx, ctx->program->do_DBSCAN_doublezisegmap_49121, "do_DBSCAN_double.segmap_49121", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 9, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_do_DBSCAN_doublezisegred_small_49140(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int8_t arg0, int8_t arg1, double arg2, double arg3, int64_t arg4, int64_t arg5, int64_t arg6, int64_t arg7, bool arg8, int64_t arg9, gpu_mem arg10, gpu_mem arg11, gpu_mem arg12, gpu_mem arg13, gpu_mem arg14, gpu_mem arg15, gpu_mem arg16, gpu_mem arg17, gpu_mem arg18, gpu_mem arg19)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[21] = {&ctx->global_failure, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6, &arg7, &arg8, &arg9, &arg10, &arg11, &arg12, &arg13, &arg14, &arg15, &arg16, &arg17, &arg18, &arg19};
        size_t args_sizes[21] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6), sizeof(arg7), sizeof(arg8), sizeof(arg9), sizeof(arg10), sizeof(arg11), sizeof(arg12), sizeof(arg13), sizeof(arg14), sizeof(arg15), sizeof(arg16), sizeof(arg17), sizeof(arg18), sizeof(arg19)};
        
        return gpu_launch_kernel(ctx, ctx->program->do_DBSCAN_doublezisegred_small_49140, "do_DBSCAN_double.segred_small_49140", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 21, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_do_DBSCAN_doublezisegred_large_49140(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int8_t arg0, int8_t arg1, double arg2, double arg3, int64_t arg4, int64_t arg5, int64_t arg6, int64_t arg7, bool arg8, int64_t arg9, int64_t arg10, int64_t arg11, int64_t arg12, gpu_mem arg13, gpu_mem arg14, gpu_mem arg15, gpu_mem arg16, gpu_mem arg17, gpu_mem arg18, gpu_mem arg19, gpu_mem arg20, gpu_mem arg21, gpu_mem arg22, gpu_mem arg23, gpu_mem arg24, gpu_mem arg25)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[27] = {&ctx->global_failure, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6, &arg7, &arg8, &arg9, &arg10, &arg11, &arg12, &arg13, &arg14, &arg15, &arg16, &arg17, &arg18, &arg19, &arg20, &arg21, &arg22, &arg23, &arg24, &arg25};
        size_t args_sizes[27] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6), sizeof(arg7), sizeof(arg8), sizeof(arg9), sizeof(arg10), sizeof(arg11), sizeof(arg12), sizeof(arg13), sizeof(arg14), sizeof(arg15), sizeof(arg16), sizeof(arg17), sizeof(arg18), sizeof(arg19), sizeof(arg20), sizeof(arg21), sizeof(arg22), sizeof(arg23), sizeof(arg24), sizeof(arg25)};
        
        return gpu_launch_kernel(ctx, ctx->program->do_DBSCAN_doublezisegred_large_49140, "do_DBSCAN_double.segred_large_49140", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 27, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_do_DBSCAN_doublezisegred_nonseg_49196(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int64_t arg0, int64_t arg1, int64_t arg2, gpu_mem arg3, gpu_mem arg4, gpu_mem arg5, gpu_mem arg6)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[8] = {&ctx->global_failure, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6};
        size_t args_sizes[8] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6)};
        
        return gpu_launch_kernel(ctx, ctx->program->do_DBSCAN_doublezisegred_nonseg_49196, "do_DBSCAN_double.segred_nonseg_49196", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 8, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_do_DBSCAN_doublezisegred_nonseg_49206(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int64_t arg0, int64_t arg1, int64_t arg2, gpu_mem arg3, gpu_mem arg4, gpu_mem arg5, gpu_mem arg6)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[8] = {&ctx->global_failure, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6};
        size_t args_sizes[8] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6)};
        
        return gpu_launch_kernel(ctx, ctx->program->do_DBSCAN_doublezisegred_nonseg_49206, "do_DBSCAN_double.segred_nonseg_49206", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 8, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_do_DBSCAN_doublezigpuseq_56885(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, gpu_mem arg0, gpu_mem arg1, gpu_mem arg2)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[4] = {&ctx->global_failure, &arg0, &arg1, &arg2};
        size_t args_sizes[4] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1), sizeof(arg2)};
        
        return gpu_launch_kernel(ctx, ctx->program->do_DBSCAN_doublezigpuseq_56885, "do_DBSCAN_double.gpuseq_56885", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 4, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_make_collisions_compact_doublezisegmap_intrablock_49824(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int64_t arg0, int64_t arg1, int64_t arg2, int64_t arg3, int64_t arg4, int64_t arg5, bool arg6, int64_t arg7, gpu_mem arg8, gpu_mem arg9, gpu_mem arg10)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[14] = {&ctx->global_failure, &ctx->failure_is_an_option, &ctx->global_failure_args, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6, &arg7, &arg8, &arg9, &arg10};
        size_t args_sizes[14] = {sizeof(ctx->global_failure), sizeof(ctx->failure_is_an_option), sizeof(ctx->global_failure_args), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6), sizeof(arg7), sizeof(arg8), sizeof(arg9), sizeof(arg10)};
        
        return gpu_launch_kernel(ctx, ctx->program->make_collisions_compact_doublezisegmap_intrablock_49824, "make_collisions_compact_double.segmap_intrablock_49824", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 14, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_make_collisions_compact_doublezisegmap_intrablock_50093(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int64_t arg0, int64_t arg1, int64_t arg2, int64_t arg3, int64_t arg4, int64_t arg5, bool arg6, int64_t arg7, gpu_mem arg8, gpu_mem arg9, gpu_mem arg10)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[14] = {&ctx->global_failure, &ctx->failure_is_an_option, &ctx->global_failure_args, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6, &arg7, &arg8, &arg9, &arg10};
        size_t args_sizes[14] = {sizeof(ctx->global_failure), sizeof(ctx->failure_is_an_option), sizeof(ctx->global_failure_args), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6), sizeof(arg7), sizeof(arg8), sizeof(arg9), sizeof(arg10)};
        
        return gpu_launch_kernel(ctx, ctx->program->make_collisions_compact_doublezisegmap_intrablock_50093, "make_collisions_compact_double.segmap_intrablock_50093", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 14, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_make_collisions_compact_doublezisegscan_45654(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int64_t arg0, int64_t arg1, int64_t arg2, int64_t arg3, gpu_mem arg4, gpu_mem arg5, gpu_mem arg6, gpu_mem arg7, gpu_mem arg8, gpu_mem arg9, gpu_mem arg10)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[12] = {&ctx->global_failure, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6, &arg7, &arg8, &arg9, &arg10};
        size_t args_sizes[12] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6), sizeof(arg7), sizeof(arg8), sizeof(arg9), sizeof(arg10)};
        
        return gpu_launch_kernel(ctx, ctx->program->make_collisions_compact_doublezisegscan_45654, "make_collisions_compact_double.segscan_45654", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 12, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_make_collisions_compact_doublezisegmap_45656(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int64_t arg0, int64_t arg1, int64_t arg2, int32_t arg3, gpu_mem arg4, gpu_mem arg5, gpu_mem arg6, gpu_mem arg7, gpu_mem arg8, gpu_mem arg9)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[11] = {&ctx->global_failure, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6, &arg7, &arg8, &arg9};
        size_t args_sizes[11] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6), sizeof(arg7), sizeof(arg8), sizeof(arg9)};
        
        return gpu_launch_kernel(ctx, ctx->program->make_collisions_compact_doublezisegmap_45656, "make_collisions_compact_double.segmap_45656", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 11, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_mk_dbcHandler_doublezigpuseq_54642(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, double arg0, double arg1, double arg2, double arg3, int64_t arg4, int64_t arg5, double arg6, double arg7, gpu_mem arg8, gpu_mem arg9, gpu_mem arg10, gpu_mem arg11, gpu_mem arg12, gpu_mem arg13, gpu_mem arg14, gpu_mem arg15)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[17] = {&ctx->global_failure, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6, &arg7, &arg8, &arg9, &arg10, &arg11, &arg12, &arg13, &arg14, &arg15};
        size_t args_sizes[17] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6), sizeof(arg7), sizeof(arg8), sizeof(arg9), sizeof(arg10), sizeof(arg11), sizeof(arg12), sizeof(arg13), sizeof(arg14), sizeof(arg15)};
        
        return gpu_launch_kernel(ctx, ctx->program->mk_dbcHandler_doublezigpuseq_54642, "mk_dbcHandler_double.gpuseq_54642", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 17, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_next_partition_to_read_doublezigpuseq_54544(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, gpu_mem arg0, gpu_mem arg1)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[3] = {&ctx->global_failure, &arg0, &arg1};
        size_t args_sizes[3] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1)};
        
        return gpu_launch_kernel(ctx, ctx->program->next_partition_to_read_doublezigpuseq_54544, "next_partition_to_read_double.gpuseq_54544", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 3, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_next_partition_to_read_doublezisegred_nonseg_45483(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int64_t arg0, int64_t arg1, int64_t arg2, gpu_mem arg3, gpu_mem arg4, gpu_mem arg5, gpu_mem arg6)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[8] = {&ctx->global_failure, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6};
        size_t args_sizes[8] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6)};
        
        return gpu_launch_kernel(ctx, ctx->program->next_partition_to_read_doublezisegred_nonseg_45483, "next_partition_to_read_double.segred_nonseg_45483", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 8, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_next_partition_to_read_doublezisegscan_45491(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int64_t arg0, int64_t arg1, int64_t arg2, int64_t arg3, gpu_mem arg4, gpu_mem arg5, gpu_mem arg6, gpu_mem arg7, gpu_mem arg8, gpu_mem arg9, gpu_mem arg10)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[12] = {&ctx->global_failure, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6, &arg7, &arg8, &arg9, &arg10};
        size_t args_sizes[12] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6), sizeof(arg7), sizeof(arg8), sizeof(arg9), sizeof(arg10)};
        
        return gpu_launch_kernel(ctx, ctx->program->next_partition_to_read_doublezisegscan_45491, "next_partition_to_read_double.segscan_45491", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 12, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_next_partition_to_read_doublezisegmap_45493(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int64_t arg0, int64_t arg1, int64_t arg2, int32_t arg3, gpu_mem arg4, gpu_mem arg5, gpu_mem arg6)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[8] = {&ctx->global_failure, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6};
        size_t args_sizes[8] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6)};
        
        return gpu_launch_kernel(ctx, ctx->program->next_partition_to_read_doublezisegmap_45493, "next_partition_to_read_double.segmap_45493", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 8, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_next_partition_to_read_doublezigpuseq_54757(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, gpu_mem arg0, gpu_mem arg1)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[3] = {&ctx->global_failure, &arg0, &arg1};
        size_t args_sizes[3] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1)};
        
        return gpu_launch_kernel(ctx, ctx->program->next_partition_to_read_doublezigpuseq_54757, "next_partition_to_read_double.gpuseq_54757", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 3, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_rectify_partition_ids_doublezisegmap_intrablock_49824(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int64_t arg0, int64_t arg1, int64_t arg2, int64_t arg3, int64_t arg4, int64_t arg5, bool arg6, int64_t arg7, gpu_mem arg8, gpu_mem arg9, gpu_mem arg10, gpu_mem arg11)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[13] = {&ctx->global_failure, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6, &arg7, &arg8, &arg9, &arg10, &arg11};
        size_t args_sizes[13] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6), sizeof(arg7), sizeof(arg8), sizeof(arg9), sizeof(arg10), sizeof(arg11)};
        
        return gpu_launch_kernel(ctx, ctx->program->rectify_partition_ids_doublezisegmap_intrablock_49824, "rectify_partition_ids_double.segmap_intrablock_49824", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 13, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_rectify_partition_ids_doublezisegmap_intrablock_50068(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int64_t arg0, int64_t arg1, int64_t arg2, int64_t arg3, int64_t arg4, int64_t arg5, bool arg6, int64_t arg7, gpu_mem arg8, gpu_mem arg9, gpu_mem arg10, gpu_mem arg11)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[13] = {&ctx->global_failure, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6, &arg7, &arg8, &arg9, &arg10, &arg11};
        size_t args_sizes[13] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6), sizeof(arg7), sizeof(arg8), sizeof(arg9), sizeof(arg10), sizeof(arg11)};
        
        return gpu_launch_kernel(ctx, ctx->program->rectify_partition_ids_doublezisegmap_intrablock_50068, "rectify_partition_ids_double.segmap_intrablock_50068", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 13, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_get_num_neighbours_against_10103zisegmap_intrablock_49824(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int64_t arg0, double arg1, int8_t arg2, int8_t arg3, double arg4, int64_t arg5, int64_t arg6, int64_t arg7, int64_t arg8, int64_t arg9, bool arg10, int64_t arg11, gpu_mem arg12, gpu_mem arg13, gpu_mem arg14, gpu_mem arg15, gpu_mem arg16)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[18] = {&ctx->global_failure, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6, &arg7, &arg8, &arg9, &arg10, &arg11, &arg12, &arg13, &arg14, &arg15, &arg16};
        size_t args_sizes[18] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6), sizeof(arg7), sizeof(arg8), sizeof(arg9), sizeof(arg10), sizeof(arg11), sizeof(arg12), sizeof(arg13), sizeof(arg14), sizeof(arg15), sizeof(arg16)};
        
        return gpu_launch_kernel(ctx, ctx->program->get_num_neighbours_against_10103zisegmap_intrablock_49824, "get_num_neighbours_against_10103.segmap_intrablock_49824", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 18, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_get_num_neighbours_against_10103zisegmap_49384(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int8_t arg0, int64_t arg1, int64_t arg2, gpu_mem arg3, gpu_mem arg4, gpu_mem arg5, gpu_mem arg6, gpu_mem arg7)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[9] = {&ctx->global_failure, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6, &arg7};
        size_t args_sizes[9] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6), sizeof(arg7)};
        
        return gpu_launch_kernel(ctx, ctx->program->get_num_neighbours_against_10103zisegmap_49384, "get_num_neighbours_against_10103.segmap_49384", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 9, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_get_num_neighbours_against_10103zisegred_small_49402(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int64_t arg0, double arg1, int8_t arg2, int8_t arg3, double arg4, int64_t arg5, int64_t arg6, int64_t arg7, bool arg8, int64_t arg9, gpu_mem arg10, gpu_mem arg11, gpu_mem arg12, gpu_mem arg13, gpu_mem arg14, gpu_mem arg15, gpu_mem arg16, gpu_mem arg17)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[19] = {&ctx->global_failure, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6, &arg7, &arg8, &arg9, &arg10, &arg11, &arg12, &arg13, &arg14, &arg15, &arg16, &arg17};
        size_t args_sizes[19] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6), sizeof(arg7), sizeof(arg8), sizeof(arg9), sizeof(arg10), sizeof(arg11), sizeof(arg12), sizeof(arg13), sizeof(arg14), sizeof(arg15), sizeof(arg16), sizeof(arg17)};
        
        return gpu_launch_kernel(ctx, ctx->program->get_num_neighbours_against_10103zisegred_small_49402, "get_num_neighbours_against_10103.segred_small_49402", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 19, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_get_num_neighbours_against_10103zisegred_large_49402(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int64_t arg0, double arg1, int8_t arg2, int8_t arg3, double arg4, int64_t arg5, int64_t arg6, int64_t arg7, bool arg8, int64_t arg9, int64_t arg10, int64_t arg11, int64_t arg12, gpu_mem arg13, gpu_mem arg14, gpu_mem arg15, gpu_mem arg16, gpu_mem arg17, gpu_mem arg18, gpu_mem arg19, gpu_mem arg20, gpu_mem arg21, gpu_mem arg22)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[24] = {&ctx->global_failure, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6, &arg7, &arg8, &arg9, &arg10, &arg11, &arg12, &arg13, &arg14, &arg15, &arg16, &arg17, &arg18, &arg19, &arg20, &arg21, &arg22};
        size_t args_sizes[24] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6), sizeof(arg7), sizeof(arg8), sizeof(arg9), sizeof(arg10), sizeof(arg11), sizeof(arg12), sizeof(arg13), sizeof(arg14), sizeof(arg15), sizeof(arg16), sizeof(arg17), sizeof(arg18), sizeof(arg19), sizeof(arg20), sizeof(arg21), sizeof(arg22)};
        
        return gpu_launch_kernel(ctx, ctx->program->get_num_neighbours_against_10103zisegred_large_49402, "get_num_neighbours_against_10103.segred_large_49402", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 24, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_get_num_neighbours_against_10106zisegmap_intrablock_49824(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int64_t arg0, double arg1, int8_t arg2, int8_t arg3, double arg4, int64_t arg5, int64_t arg6, int64_t arg7, int64_t arg8, int64_t arg9, bool arg10, int64_t arg11, gpu_mem arg12, gpu_mem arg13, gpu_mem arg14, gpu_mem arg15, gpu_mem arg16)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[18] = {&ctx->global_failure, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6, &arg7, &arg8, &arg9, &arg10, &arg11, &arg12, &arg13, &arg14, &arg15, &arg16};
        size_t args_sizes[18] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6), sizeof(arg7), sizeof(arg8), sizeof(arg9), sizeof(arg10), sizeof(arg11), sizeof(arg12), sizeof(arg13), sizeof(arg14), sizeof(arg15), sizeof(arg16)};
        
        return gpu_launch_kernel(ctx, ctx->program->get_num_neighbours_against_10106zisegmap_intrablock_49824, "get_num_neighbours_against_10106.segmap_intrablock_49824", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 18, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_get_num_neighbours_against_10106zisegmap_49618(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int8_t arg0, int64_t arg1, int64_t arg2, gpu_mem arg3, gpu_mem arg4, gpu_mem arg5, gpu_mem arg6, gpu_mem arg7)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[9] = {&ctx->global_failure, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6, &arg7};
        size_t args_sizes[9] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6), sizeof(arg7)};
        
        return gpu_launch_kernel(ctx, ctx->program->get_num_neighbours_against_10106zisegmap_49618, "get_num_neighbours_against_10106.segmap_49618", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 9, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_get_num_neighbours_against_10106zisegred_small_49636(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int64_t arg0, double arg1, int8_t arg2, int8_t arg3, double arg4, int64_t arg5, int64_t arg6, int64_t arg7, bool arg8, int64_t arg9, gpu_mem arg10, gpu_mem arg11, gpu_mem arg12, gpu_mem arg13, gpu_mem arg14, gpu_mem arg15, gpu_mem arg16, gpu_mem arg17)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[19] = {&ctx->global_failure, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6, &arg7, &arg8, &arg9, &arg10, &arg11, &arg12, &arg13, &arg14, &arg15, &arg16, &arg17};
        size_t args_sizes[19] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6), sizeof(arg7), sizeof(arg8), sizeof(arg9), sizeof(arg10), sizeof(arg11), sizeof(arg12), sizeof(arg13), sizeof(arg14), sizeof(arg15), sizeof(arg16), sizeof(arg17)};
        
        return gpu_launch_kernel(ctx, ctx->program->get_num_neighbours_against_10106zisegred_small_49636, "get_num_neighbours_against_10106.segred_small_49636", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 19, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_get_num_neighbours_against_10106zisegred_large_49636(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int64_t arg0, double arg1, int8_t arg2, int8_t arg3, double arg4, int64_t arg5, int64_t arg6, int64_t arg7, bool arg8, int64_t arg9, int64_t arg10, int64_t arg11, int64_t arg12, gpu_mem arg13, gpu_mem arg14, gpu_mem arg15, gpu_mem arg16, gpu_mem arg17, gpu_mem arg18, gpu_mem arg19, gpu_mem arg20, gpu_mem arg21, gpu_mem arg22)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[24] = {&ctx->global_failure, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6, &arg7, &arg8, &arg9, &arg10, &arg11, &arg12, &arg13, &arg14, &arg15, &arg16, &arg17, &arg18, &arg19, &arg20, &arg21, &arg22};
        size_t args_sizes[24] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6), sizeof(arg7), sizeof(arg8), sizeof(arg9), sizeof(arg10), sizeof(arg11), sizeof(arg12), sizeof(arg13), sizeof(arg14), sizeof(arg15), sizeof(arg16), sizeof(arg17), sizeof(arg18), sizeof(arg19), sizeof(arg20), sizeof(arg21), sizeof(arg22)};
        
        return gpu_launch_kernel(ctx, ctx->program->get_num_neighbours_against_10106zisegred_large_49636, "get_num_neighbours_against_10106.segred_large_49636", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 24, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
struct futhark_i64_1d {
    struct memblock_device mem;
    int64_t shape[1];
};
struct futhark_i64_1d *futhark_new_i64_1d(struct futhark_context *ctx, const int64_t *data, int64_t dim0)
{
    int err = 0;
    struct futhark_i64_1d *bad = NULL;
    struct futhark_i64_1d *arr = (struct futhark_i64_1d *) malloc(sizeof(struct futhark_i64_1d));
    
    if (arr == NULL)
        return bad;
    lock_lock(&ctx->lock);
    CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
    arr->mem.references = NULL;
    if (memblock_alloc_device(ctx, &arr->mem, dim0 * 8, "arr->mem"))
        err = 1;
    arr->shape[0] = dim0;
    err = memcpy_host2gpu(ctx, false, arr->mem.mem, 0, (const unsigned char *) data, 0, (size_t) dim0 * 8);
    CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
    lock_unlock(&ctx->lock);
    if (err != 0) {
        free(arr);
        return bad;
    }
    return arr;
}
struct futhark_i64_1d *futhark_new_raw_i64_1d(struct futhark_context *ctx, CUdeviceptr data, int64_t dim0)
{
    int err = 0;
    struct futhark_i64_1d *bad = NULL;
    struct futhark_i64_1d *arr = (struct futhark_i64_1d *) malloc(sizeof(struct futhark_i64_1d));
    
    if (arr == NULL)
        return bad;
    lock_lock(&ctx->lock);
    CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
    arr->mem.references = NULL;
    arr->mem.mem = data;
    arr->shape[0] = dim0;
    CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
    lock_unlock(&ctx->lock);
    return arr;
}
int futhark_free_i64_1d(struct futhark_context *ctx, struct futhark_i64_1d *arr)
{
    lock_lock(&ctx->lock);
    CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
    if (memblock_unref_device(ctx, &arr->mem, "arr->mem") != 0)
        return 1;
    CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
    lock_unlock(&ctx->lock);
    free(arr);
    return 0;
}
int futhark_values_i64_1d(struct futhark_context *ctx, struct futhark_i64_1d *arr, int64_t *data)
{
    int err = 0;
    
    lock_lock(&ctx->lock);
    CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
    err = memcpy_gpu2host(ctx, false, (unsigned char *) data, 0, arr->mem.mem, 0, (size_t) arr->shape[0] * 8);
    CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
    lock_unlock(&ctx->lock);
    return err;
}
int futhark_index_i64_1d(struct futhark_context *ctx, int64_t *out, struct futhark_i64_1d *arr, int64_t i0)
{
    int err = 0;
    
    if (i0 >= 0 && i0 < arr->shape[0]) {
        lock_lock(&ctx->lock);
        CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
        err = memcpy_gpu2host(ctx, false, (unsigned char *) out, 0, arr->mem.mem, 8 * (i0 * 1), 8);
        CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
        lock_unlock(&ctx->lock);
    } else {
        err = 1;
        set_error(ctx, strdup("Index out of bounds."));
    }
    return err;
}
CUdeviceptr futhark_values_raw_i64_1d(struct futhark_context *ctx, struct futhark_i64_1d *arr)
{
    (void) ctx;
    return arr->mem.mem;
}
const int64_t *futhark_shape_i64_1d(struct futhark_context *ctx, struct futhark_i64_1d *arr)
{
    (void) ctx;
    return arr->shape;
}
struct futhark_f64_1d {
    struct memblock_device mem;
    int64_t shape[1];
};
struct futhark_f64_1d *futhark_new_f64_1d(struct futhark_context *ctx, const double *data, int64_t dim0)
{
    int err = 0;
    struct futhark_f64_1d *bad = NULL;
    struct futhark_f64_1d *arr = (struct futhark_f64_1d *) malloc(sizeof(struct futhark_f64_1d));
    
    if (arr == NULL)
        return bad;
    lock_lock(&ctx->lock);
    CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
    arr->mem.references = NULL;
    if (memblock_alloc_device(ctx, &arr->mem, dim0 * 8, "arr->mem"))
        err = 1;
    arr->shape[0] = dim0;
    err = memcpy_host2gpu(ctx, false, arr->mem.mem, 0, (const unsigned char *) data, 0, (size_t) dim0 * 8);
    CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
    lock_unlock(&ctx->lock);
    if (err != 0) {
        free(arr);
        return bad;
    }
    return arr;
}
struct futhark_f64_1d *futhark_new_raw_f64_1d(struct futhark_context *ctx, CUdeviceptr data, int64_t dim0)
{
    int err = 0;
    struct futhark_f64_1d *bad = NULL;
    struct futhark_f64_1d *arr = (struct futhark_f64_1d *) malloc(sizeof(struct futhark_f64_1d));
    
    if (arr == NULL)
        return bad;
    lock_lock(&ctx->lock);
    CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
    arr->mem.references = NULL;
    arr->mem.mem = data;
    arr->shape[0] = dim0;
    CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
    lock_unlock(&ctx->lock);
    return arr;
}
int futhark_free_f64_1d(struct futhark_context *ctx, struct futhark_f64_1d *arr)
{
    lock_lock(&ctx->lock);
    CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
    if (memblock_unref_device(ctx, &arr->mem, "arr->mem") != 0)
        return 1;
    CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
    lock_unlock(&ctx->lock);
    free(arr);
    return 0;
}
int futhark_values_f64_1d(struct futhark_context *ctx, struct futhark_f64_1d *arr, double *data)
{
    int err = 0;
    
    lock_lock(&ctx->lock);
    CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
    err = memcpy_gpu2host(ctx, false, (unsigned char *) data, 0, arr->mem.mem, 0, (size_t) arr->shape[0] * 8);
    CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
    lock_unlock(&ctx->lock);
    return err;
}
int futhark_index_f64_1d(struct futhark_context *ctx, double *out, struct futhark_f64_1d *arr, int64_t i0)
{
    int err = 0;
    
    if (i0 >= 0 && i0 < arr->shape[0]) {
        lock_lock(&ctx->lock);
        CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
        err = memcpy_gpu2host(ctx, false, (unsigned char *) out, 0, arr->mem.mem, 8 * (i0 * 1), 8);
        CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
        lock_unlock(&ctx->lock);
    } else {
        err = 1;
        set_error(ctx, strdup("Index out of bounds."));
    }
    return err;
}
CUdeviceptr futhark_values_raw_f64_1d(struct futhark_context *ctx, struct futhark_f64_1d *arr)
{
    (void) ctx;
    return arr->mem.mem;
}
const int64_t *futhark_shape_f64_1d(struct futhark_context *ctx, struct futhark_f64_1d *arr)
{
    (void) ctx;
    return arr->shape;
}
struct futhark_bool_1d {
    struct memblock_device mem;
    int64_t shape[1];
};
struct futhark_bool_1d *futhark_new_bool_1d(struct futhark_context *ctx, const bool *data, int64_t dim0)
{
    int err = 0;
    struct futhark_bool_1d *bad = NULL;
    struct futhark_bool_1d *arr = (struct futhark_bool_1d *) malloc(sizeof(struct futhark_bool_1d));
    
    if (arr == NULL)
        return bad;
    lock_lock(&ctx->lock);
    CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
    arr->mem.references = NULL;
    if (memblock_alloc_device(ctx, &arr->mem, dim0 * 1, "arr->mem"))
        err = 1;
    arr->shape[0] = dim0;
    err = memcpy_host2gpu(ctx, false, arr->mem.mem, 0, (const unsigned char *) data, 0, (size_t) dim0 * 1);
    CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
    lock_unlock(&ctx->lock);
    if (err != 0) {
        free(arr);
        return bad;
    }
    return arr;
}
struct futhark_bool_1d *futhark_new_raw_bool_1d(struct futhark_context *ctx, CUdeviceptr data, int64_t dim0)
{
    int err = 0;
    struct futhark_bool_1d *bad = NULL;
    struct futhark_bool_1d *arr = (struct futhark_bool_1d *) malloc(sizeof(struct futhark_bool_1d));
    
    if (arr == NULL)
        return bad;
    lock_lock(&ctx->lock);
    CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
    arr->mem.references = NULL;
    arr->mem.mem = data;
    arr->shape[0] = dim0;
    CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
    lock_unlock(&ctx->lock);
    return arr;
}
int futhark_free_bool_1d(struct futhark_context *ctx, struct futhark_bool_1d *arr)
{
    lock_lock(&ctx->lock);
    CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
    if (memblock_unref_device(ctx, &arr->mem, "arr->mem") != 0)
        return 1;
    CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
    lock_unlock(&ctx->lock);
    free(arr);
    return 0;
}
int futhark_values_bool_1d(struct futhark_context *ctx, struct futhark_bool_1d *arr, bool *data)
{
    int err = 0;
    
    lock_lock(&ctx->lock);
    CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
    err = memcpy_gpu2host(ctx, false, (unsigned char *) data, 0, arr->mem.mem, 0, (size_t) arr->shape[0] * 1);
    CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
    lock_unlock(&ctx->lock);
    return err;
}
int futhark_index_bool_1d(struct futhark_context *ctx, bool *out, struct futhark_bool_1d *arr, int64_t i0)
{
    int err = 0;
    
    if (i0 >= 0 && i0 < arr->shape[0]) {
        lock_lock(&ctx->lock);
        CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
        err = memcpy_gpu2host(ctx, false, (unsigned char *) out, 0, arr->mem.mem, 1 * (i0 * 1), 1);
        CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
        lock_unlock(&ctx->lock);
    } else {
        err = 1;
        set_error(ctx, strdup("Index out of bounds."));
    }
    return err;
}
CUdeviceptr futhark_values_raw_bool_1d(struct futhark_context *ctx, struct futhark_bool_1d *arr)
{
    (void) ctx;
    return arr->mem.mem;
}
const int64_t *futhark_shape_bool_1d(struct futhark_context *ctx, struct futhark_bool_1d *arr)
{
    (void) ctx;
    return arr->shape;
}
struct futhark_opaque_tup2_i64_i64 {
    int64_t v0;
    int64_t v1;
};
int futhark_project_opaque_tup2_i64_i64_0(struct futhark_context *ctx, int64_t *out, const struct futhark_opaque_tup2_i64_i64 *obj)
{
    (void) ctx;
    
    int64_t v;
    
    v = obj->v0;
    *out = v;
    return 0;
}
int futhark_project_opaque_tup2_i64_i64_1(struct futhark_context *ctx, int64_t *out, const struct futhark_opaque_tup2_i64_i64 *obj)
{
    (void) ctx;
    
    int64_t v;
    
    v = obj->v1;
    *out = v;
    return 0;
}
int futhark_new_opaque_tup2_i64_i64(struct futhark_context *ctx, struct futhark_opaque_tup2_i64_i64 **out, const int64_t f_0, const int64_t f_1)
{
    struct futhark_opaque_tup2_i64_i64 *v = malloc(sizeof(struct futhark_opaque_tup2_i64_i64));
    
    lock_lock(&ctx->lock);
    CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
    v->v0 = f_0;
    v->v1 = f_1;
    CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
    lock_unlock(&ctx->lock);
    *out = v;
    return FUTHARK_SUCCESS;
}
int futhark_free_opaque_tup2_i64_i64(struct futhark_context *ctx, struct futhark_opaque_tup2_i64_i64 *obj)
{
    (void) ctx;
    
    int ret = 0, tmp;
    
    free(obj);
    return ret;
}
int futhark_store_opaque_tup2_i64_i64(struct futhark_context *ctx, const struct futhark_opaque_tup2_i64_i64 *obj, void **p, size_t *n)
{
    (void) ctx;
    
    int ret = 0;
    int64_t size_0 = 7 + 0 * sizeof(int64_t) + 1 * sizeof(int64_t);
    int64_t size_1 = 7 + 0 * sizeof(int64_t) + 1 * sizeof(int64_t);
    
    *n = size_0 + size_1;
    if (p != NULL && *p == NULL)
        *p = malloc(*n);
    if (p != NULL) {
        unsigned char *out = *p;
        
        *out++ = 'b';
        *out++ = 2;
        *out++ = 0;
        memcpy(out, " i64", 4);
        out += 4;
        memcpy(out, &obj->v0, sizeof(obj->v0));
        out += sizeof(obj->v0);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 0;
        memcpy(out, " i64", 4);
        out += 4;
        memcpy(out, &obj->v1, sizeof(obj->v1));
        out += sizeof(obj->v1);
    }
    return ret;
}
struct futhark_opaque_tup2_i64_i64 *futhark_restore_opaque_tup2_i64_i64(struct futhark_context *ctx, const void *p)
{
    (void) ctx;
    
    int err = 0;
    const unsigned char *src = p;
    struct futhark_opaque_tup2_i64_i64 *obj = malloc(sizeof(struct futhark_opaque_tup2_i64_i64));
    
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 0;
    err |= memcmp(src, " i64", 4) != 0;
    src += 4;
    if (err == 0) {
        src += 0 * sizeof(int64_t);
    }
    
    const void *data_0 = src;
    
    src += sizeof(obj->v0);
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 0;
    err |= memcmp(src, " i64", 4) != 0;
    src += 4;
    if (err == 0) {
        src += 0 * sizeof(int64_t);
    }
    
    const void *data_1 = src;
    
    src += sizeof(obj->v1);
    if (err == 0) {
        memcpy(&obj->v0, data_0, sizeof(obj->v0));
        memcpy(&obj->v1, data_1, sizeof(obj->v1));
    }
    if (err != 0) {
        int ret = 0, tmp;
        
        free(obj);
        obj = NULL;
    }
    return obj;
}
struct futhark_opaque_arr1d_tup2_i64_i64 {
    struct futhark_i64_1d *v0;
    struct futhark_i64_1d *v1;
};
int futhark_project_opaque_arr1d_tup2_i64_i64_0(struct futhark_context *ctx, struct futhark_i64_1d **out, const struct futhark_opaque_arr1d_tup2_i64_i64 *obj)
{
    (void) ctx;
    
    struct futhark_i64_1d *v;
    
    lock_lock(&ctx->lock);
    CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
    v = malloc(sizeof(struct futhark_i64_1d));
    memcpy(v, obj->v0, sizeof(struct futhark_i64_1d));
    (void) (*v->mem.references)++;
    CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
    lock_unlock(&ctx->lock);
    *out = v;
    return 0;
}
int futhark_project_opaque_arr1d_tup2_i64_i64_1(struct futhark_context *ctx, struct futhark_i64_1d **out, const struct futhark_opaque_arr1d_tup2_i64_i64 *obj)
{
    (void) ctx;
    
    struct futhark_i64_1d *v;
    
    lock_lock(&ctx->lock);
    CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
    v = malloc(sizeof(struct futhark_i64_1d));
    memcpy(v, obj->v1, sizeof(struct futhark_i64_1d));
    (void) (*v->mem.references)++;
    CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
    lock_unlock(&ctx->lock);
    *out = v;
    return 0;
}
int futhark_zip_opaque_arr1d_tup2_i64_i64(struct futhark_context *ctx, struct futhark_opaque_arr1d_tup2_i64_i64 **out, const struct futhark_i64_1d *f_0, const struct futhark_i64_1d *f_1)
{
    if (!(f_0->shape[0] == f_1->shape[0])) {
        set_error(ctx, strdup("Cannot zip arrays with different shapes."));
        return 1;
    }
    
    struct futhark_opaque_arr1d_tup2_i64_i64 *v = malloc(sizeof(struct futhark_opaque_arr1d_tup2_i64_i64));
    
    lock_lock(&ctx->lock);
    CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
    {
        v->v0 = malloc(sizeof(struct futhark_i64_1d));
        *v->v0 = *f_0;
        (void) (*v->v0->mem.references)++;
    }
    {
        v->v1 = malloc(sizeof(struct futhark_i64_1d));
        *v->v1 = *f_1;
        (void) (*v->v1->mem.references)++;
    }
    CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
    lock_unlock(&ctx->lock);
    *out = v;
    return FUTHARK_SUCCESS;
}
int futhark_index_opaque_arr1d_tup2_i64_i64(struct futhark_context *ctx, struct futhark_opaque_tup2_i64_i64 **out, struct futhark_opaque_arr1d_tup2_i64_i64 *arr, int64_t i0)
{
    int err = 0;
    
    if (i0 >= 0 && i0 < arr->v0->shape[0]) {
        struct futhark_opaque_tup2_i64_i64 *v = malloc(sizeof(struct futhark_opaque_tup2_i64_i64));
        
        err = memcpy_gpu2host(ctx, false, (unsigned char *) &v->v0, 0, arr->v0->mem.mem, 8 * (i0 * 1), 8);
        err = memcpy_gpu2host(ctx, false, (unsigned char *) &v->v1, 0, arr->v1->mem.mem, 8 * (i0 * 1), 8);
        if (err == 0)
            *out = v;
    } else {
        err = 1;
        set_error(ctx, strdup("Index out of bounds."));
    }
    return err;
}
const int64_t *futhark_shape_opaque_arr1d_tup2_i64_i64(struct futhark_context *ctx, struct futhark_opaque_arr1d_tup2_i64_i64 *arr)
{
    (void) ctx;
    return arr->v0->shape;
}
int futhark_free_opaque_arr1d_tup2_i64_i64(struct futhark_context *ctx, struct futhark_opaque_arr1d_tup2_i64_i64 *obj)
{
    (void) ctx;
    
    int ret = 0, tmp;
    
    if (obj->v0 != NULL && (tmp = futhark_free_i64_1d(ctx, obj->v0)) != 0)
        ret = tmp;
    if (obj->v1 != NULL && (tmp = futhark_free_i64_1d(ctx, obj->v1)) != 0)
        ret = tmp;
    free(obj);
    return ret;
}
int futhark_store_opaque_arr1d_tup2_i64_i64(struct futhark_context *ctx, const struct futhark_opaque_arr1d_tup2_i64_i64 *obj, void **p, size_t *n)
{
    (void) ctx;
    
    int ret = 0;
    int64_t size_0 = 7 + 1 * sizeof(int64_t) + futhark_shape_i64_1d(ctx, obj->v0)[0] * sizeof(int64_t);
    int64_t size_1 = 7 + 1 * sizeof(int64_t) + futhark_shape_i64_1d(ctx, obj->v1)[0] * sizeof(int64_t);
    
    *n = size_0 + size_1;
    if (p != NULL && *p == NULL)
        *p = malloc(*n);
    if (p != NULL) {
        unsigned char *out = *p;
        
        *out++ = 'b';
        *out++ = 2;
        *out++ = 1;
        memcpy(out, " i64", 4);
        out += 4;
        memcpy(out, futhark_shape_i64_1d(ctx, obj->v0), 1 * sizeof(int64_t));
        out += 1 * sizeof(int64_t);
        ret |= futhark_values_i64_1d(ctx, obj->v0, (void *) out);
        out += futhark_shape_i64_1d(ctx, obj->v0)[0] * sizeof(int64_t);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 1;
        memcpy(out, " i64", 4);
        out += 4;
        memcpy(out, futhark_shape_i64_1d(ctx, obj->v1), 1 * sizeof(int64_t));
        out += 1 * sizeof(int64_t);
        ret |= futhark_values_i64_1d(ctx, obj->v1, (void *) out);
        out += futhark_shape_i64_1d(ctx, obj->v1)[0] * sizeof(int64_t);
    }
    return ret;
}
struct futhark_opaque_arr1d_tup2_i64_i64 *futhark_restore_opaque_arr1d_tup2_i64_i64(struct futhark_context *ctx, const void *p)
{
    (void) ctx;
    
    int err = 0;
    const unsigned char *src = p;
    struct futhark_opaque_arr1d_tup2_i64_i64 *obj = malloc(sizeof(struct futhark_opaque_arr1d_tup2_i64_i64));
    int64_t shape_0[1] = {0};
    
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 1;
    err |= memcmp(src, " i64", 4) != 0;
    src += 4;
    if (err == 0) {
        memcpy(shape_0, src, 1 * sizeof(int64_t));
        src += 1 * sizeof(int64_t);
    }
    
    const void *data_0 = src;
    
    obj->v0 = NULL;
    src += shape_0[0] * sizeof(int64_t);
    
    int64_t shape_1[1] = {0};
    
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 1;
    err |= memcmp(src, " i64", 4) != 0;
    src += 4;
    if (err == 0) {
        memcpy(shape_1, src, 1 * sizeof(int64_t));
        src += 1 * sizeof(int64_t);
    }
    
    const void *data_1 = src;
    
    obj->v1 = NULL;
    src += shape_1[0] * sizeof(int64_t);
    if (err == 0) {
        obj->v0 = futhark_new_i64_1d(ctx, data_0, shape_0[0]);
        if (obj->v0 == NULL)
            err = 1;
        obj->v1 = futhark_new_i64_1d(ctx, data_1, shape_1[0]);
        if (obj->v1 == NULL)
            err = 1;
    }
    if (err != 0) {
        int ret = 0, tmp;
        
        if (obj->v0 != NULL && (tmp = futhark_free_i64_1d(ctx, obj->v0)) != 0)
            ret = tmp;
        if (obj->v1 != NULL && (tmp = futhark_free_i64_1d(ctx, obj->v1)) != 0)
            ret = tmp;
        free(obj);
        obj = NULL;
    }
    return obj;
}
struct futhark_opaque_00764e1f7379f14f22282d21712a8514 {
    int8_t v0;
};
int futhark_new_opaque_00764e1f7379f14f22282d21712a8514_degrees(struct futhark_context *ctx, struct futhark_opaque_00764e1f7379f14f22282d21712a8514 **out)
{
    (void) ctx;
    
    struct futhark_opaque_00764e1f7379f14f22282d21712a8514 *v = malloc(sizeof(struct futhark_opaque_00764e1f7379f14f22282d21712a8514));
    
    v->v0 = 0;
    {
        lock_lock(&ctx->lock);
        CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
        CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
        lock_unlock(&ctx->lock);
    }
    {
        { }
    }
    *out = v;
    return FUTHARK_SUCCESS;
}
int futhark_destruct_opaque_00764e1f7379f14f22282d21712a8514_degrees(struct futhark_context *ctx, const struct futhark_opaque_00764e1f7379f14f22282d21712a8514 *obj)
{
    (void) ctx;
    assert(obj->v0 == 0);
    return FUTHARK_SUCCESS;
}
int futhark_new_opaque_00764e1f7379f14f22282d21712a8514_radians(struct futhark_context *ctx, struct futhark_opaque_00764e1f7379f14f22282d21712a8514 **out)
{
    (void) ctx;
    
    struct futhark_opaque_00764e1f7379f14f22282d21712a8514 *v = malloc(sizeof(struct futhark_opaque_00764e1f7379f14f22282d21712a8514));
    
    v->v0 = 1;
    {
        lock_lock(&ctx->lock);
        CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
        CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
        lock_unlock(&ctx->lock);
    }
    {
        { }
    }
    *out = v;
    return FUTHARK_SUCCESS;
}
int futhark_destruct_opaque_00764e1f7379f14f22282d21712a8514_radians(struct futhark_context *ctx, const struct futhark_opaque_00764e1f7379f14f22282d21712a8514 *obj)
{
    (void) ctx;
    assert(obj->v0 == 1);
    return FUTHARK_SUCCESS;
}
int futhark_variant_opaque_00764e1f7379f14f22282d21712a8514(struct futhark_context *ctx, const struct futhark_opaque_00764e1f7379f14f22282d21712a8514 *v)
{
    (void) ctx;
    return v->v0;
}
int futhark_free_opaque_00764e1f7379f14f22282d21712a8514(struct futhark_context *ctx, struct futhark_opaque_00764e1f7379f14f22282d21712a8514 *obj)
{
    (void) ctx;
    
    int ret = 0, tmp;
    
    free(obj);
    return ret;
}
int futhark_store_opaque_00764e1f7379f14f22282d21712a8514(struct futhark_context *ctx, const struct futhark_opaque_00764e1f7379f14f22282d21712a8514 *obj, void **p, size_t *n)
{
    (void) ctx;
    
    int ret = 0;
    int64_t size_0 = 7 + 0 * sizeof(int64_t) + 1 * sizeof(int8_t);
    
    *n = size_0;
    if (p != NULL && *p == NULL)
        *p = malloc(*n);
    if (p != NULL) {
        unsigned char *out = *p;
        
        *out++ = 'b';
        *out++ = 2;
        *out++ = 0;
        memcpy(out, "  i8", 4);
        out += 4;
        memcpy(out, &obj->v0, sizeof(obj->v0));
        out += sizeof(obj->v0);
    }
    return ret;
}
struct futhark_opaque_00764e1f7379f14f22282d21712a8514 *futhark_restore_opaque_00764e1f7379f14f22282d21712a8514(struct futhark_context *ctx, const void *p)
{
    (void) ctx;
    
    int err = 0;
    const unsigned char *src = p;
    struct futhark_opaque_00764e1f7379f14f22282d21712a8514 *obj = malloc(sizeof(struct futhark_opaque_00764e1f7379f14f22282d21712a8514));
    
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 0;
    err |= memcmp(src, "  i8", 4) != 0;
    src += 4;
    if (err == 0) {
        src += 0 * sizeof(int64_t);
    }
    
    const void *data_0 = src;
    
    src += sizeof(obj->v0);
    if (err == 0) {
        memcpy(&obj->v0, data_0, sizeof(obj->v0));
    }
    if (err != 0) {
        int ret = 0, tmp;
        
        free(obj);
        obj = NULL;
    }
    return obj;
}
struct futhark_opaque_5797e930517e531e6d939a24b1db07bd {
    int8_t v0;
};
int futhark_new_opaque_5797e930517e531e6d939a24b1db07bd_euclidean(struct futhark_context *ctx, struct futhark_opaque_5797e930517e531e6d939a24b1db07bd **out)
{
    (void) ctx;
    
    struct futhark_opaque_5797e930517e531e6d939a24b1db07bd *v = malloc(sizeof(struct futhark_opaque_5797e930517e531e6d939a24b1db07bd));
    
    v->v0 = 0;
    {
        lock_lock(&ctx->lock);
        CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
        CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
        lock_unlock(&ctx->lock);
    }
    {
        { }
    }
    *out = v;
    return FUTHARK_SUCCESS;
}
int futhark_destruct_opaque_5797e930517e531e6d939a24b1db07bd_euclidean(struct futhark_context *ctx, const struct futhark_opaque_5797e930517e531e6d939a24b1db07bd *obj)
{
    (void) ctx;
    assert(obj->v0 == 0);
    return FUTHARK_SUCCESS;
}
int futhark_new_opaque_5797e930517e531e6d939a24b1db07bd_haversine(struct futhark_context *ctx, struct futhark_opaque_5797e930517e531e6d939a24b1db07bd **out)
{
    (void) ctx;
    
    struct futhark_opaque_5797e930517e531e6d939a24b1db07bd *v = malloc(sizeof(struct futhark_opaque_5797e930517e531e6d939a24b1db07bd));
    
    v->v0 = 1;
    {
        lock_lock(&ctx->lock);
        CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
        CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
        lock_unlock(&ctx->lock);
    }
    {
        { }
    }
    *out = v;
    return FUTHARK_SUCCESS;
}
int futhark_destruct_opaque_5797e930517e531e6d939a24b1db07bd_haversine(struct futhark_context *ctx, const struct futhark_opaque_5797e930517e531e6d939a24b1db07bd *obj)
{
    (void) ctx;
    assert(obj->v0 == 1);
    return FUTHARK_SUCCESS;
}
int futhark_variant_opaque_5797e930517e531e6d939a24b1db07bd(struct futhark_context *ctx, const struct futhark_opaque_5797e930517e531e6d939a24b1db07bd *v)
{
    (void) ctx;
    return v->v0;
}
int futhark_free_opaque_5797e930517e531e6d939a24b1db07bd(struct futhark_context *ctx, struct futhark_opaque_5797e930517e531e6d939a24b1db07bd *obj)
{
    (void) ctx;
    
    int ret = 0, tmp;
    
    free(obj);
    return ret;
}
int futhark_store_opaque_5797e930517e531e6d939a24b1db07bd(struct futhark_context *ctx, const struct futhark_opaque_5797e930517e531e6d939a24b1db07bd *obj, void **p, size_t *n)
{
    (void) ctx;
    
    int ret = 0;
    int64_t size_0 = 7 + 0 * sizeof(int64_t) + 1 * sizeof(int8_t);
    
    *n = size_0;
    if (p != NULL && *p == NULL)
        *p = malloc(*n);
    if (p != NULL) {
        unsigned char *out = *p;
        
        *out++ = 'b';
        *out++ = 2;
        *out++ = 0;
        memcpy(out, "  i8", 4);
        out += 4;
        memcpy(out, &obj->v0, sizeof(obj->v0));
        out += sizeof(obj->v0);
    }
    return ret;
}
struct futhark_opaque_5797e930517e531e6d939a24b1db07bd *futhark_restore_opaque_5797e930517e531e6d939a24b1db07bd(struct futhark_context *ctx, const void *p)
{
    (void) ctx;
    
    int err = 0;
    const unsigned char *src = p;
    struct futhark_opaque_5797e930517e531e6d939a24b1db07bd *obj = malloc(sizeof(struct futhark_opaque_5797e930517e531e6d939a24b1db07bd));
    
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 0;
    err |= memcmp(src, "  i8", 4) != 0;
    src += 4;
    if (err == 0) {
        src += 0 * sizeof(int64_t);
    }
    
    const void *data_0 = src;
    
    src += sizeof(obj->v0);
    if (err == 0) {
        memcpy(&obj->v0, data_0, sizeof(obj->v0));
    }
    if (err != 0) {
        int ret = 0, tmp;
        
        free(obj);
        obj = NULL;
    }
    return obj;
}
struct futhark_opaque_8b7e80c3fb80a9a7700efe8e89371deb {
    int8_t v0;
    int8_t v1;
    double v2;
    int64_t v3;
    struct futhark_f64_1d *v4;
    int64_t v5;
    struct futhark_f64_1d *v6;
    struct futhark_i64_1d *v7;
    double v8;
    struct futhark_f64_1d *v9;
    int64_t v10;
};
int futhark_project_opaque_8b7e80c3fb80a9a7700efe8e89371deb_angle_t(struct futhark_context *ctx, struct futhark_opaque_00764e1f7379f14f22282d21712a8514 **out, const struct futhark_opaque_8b7e80c3fb80a9a7700efe8e89371deb *obj)
{
    (void) ctx;
    
    struct futhark_opaque_00764e1f7379f14f22282d21712a8514 *v;
    
    lock_lock(&ctx->lock);
    CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
    v = malloc(sizeof(struct futhark_opaque_00764e1f7379f14f22282d21712a8514));
    v->v0 = obj->v0;
    CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
    lock_unlock(&ctx->lock);
    *out = v;
    return 0;
}
int futhark_project_opaque_8b7e80c3fb80a9a7700efe8e89371deb_dist_t(struct futhark_context *ctx, struct futhark_opaque_5797e930517e531e6d939a24b1db07bd **out, const struct futhark_opaque_8b7e80c3fb80a9a7700efe8e89371deb *obj)
{
    (void) ctx;
    
    struct futhark_opaque_5797e930517e531e6d939a24b1db07bd *v;
    
    lock_lock(&ctx->lock);
    CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
    v = malloc(sizeof(struct futhark_opaque_5797e930517e531e6d939a24b1db07bd));
    v->v0 = obj->v1;
    CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
    lock_unlock(&ctx->lock);
    *out = v;
    return 0;
}
int futhark_project_opaque_8b7e80c3fb80a9a7700efe8e89371deb_eps(struct futhark_context *ctx, double *out, const struct futhark_opaque_8b7e80c3fb80a9a7700efe8e89371deb *obj)
{
    (void) ctx;
    
    double v;
    
    v = obj->v2;
    *out = v;
    return 0;
}
int futhark_project_opaque_8b7e80c3fb80a9a7700efe8e89371deb_m_size(struct futhark_context *ctx, int64_t *out, const struct futhark_opaque_8b7e80c3fb80a9a7700efe8e89371deb *obj)
{
    (void) ctx;
    
    int64_t v;
    
    v = obj->v3;
    *out = v;
    return 0;
}
int futhark_project_opaque_8b7e80c3fb80a9a7700efe8e89371deb_maxs(struct futhark_context *ctx, struct futhark_f64_1d **out, const struct futhark_opaque_8b7e80c3fb80a9a7700efe8e89371deb *obj)
{
    (void) ctx;
    
    struct futhark_f64_1d *v;
    
    lock_lock(&ctx->lock);
    CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
    v = malloc(sizeof(struct futhark_f64_1d));
    memcpy(v, obj->v4, sizeof(struct futhark_f64_1d));
    (void) (*v->mem.references)++;
    CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
    lock_unlock(&ctx->lock);
    *out = v;
    return 0;
}
int futhark_project_opaque_8b7e80c3fb80a9a7700efe8e89371deb_minPts(struct futhark_context *ctx, int64_t *out, const struct futhark_opaque_8b7e80c3fb80a9a7700efe8e89371deb *obj)
{
    (void) ctx;
    
    int64_t v;
    
    v = obj->v5;
    *out = v;
    return 0;
}
int futhark_project_opaque_8b7e80c3fb80a9a7700efe8e89371deb_mins(struct futhark_context *ctx, struct futhark_f64_1d **out, const struct futhark_opaque_8b7e80c3fb80a9a7700efe8e89371deb *obj)
{
    (void) ctx;
    
    struct futhark_f64_1d *v;
    
    lock_lock(&ctx->lock);
    CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
    v = malloc(sizeof(struct futhark_f64_1d));
    memcpy(v, obj->v6, sizeof(struct futhark_f64_1d));
    (void) (*v->mem.references)++;
    CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
    lock_unlock(&ctx->lock);
    *out = v;
    return 0;
}
int futhark_project_opaque_8b7e80c3fb80a9a7700efe8e89371deb_part_per_dim(struct futhark_context *ctx, struct futhark_i64_1d **out, const struct futhark_opaque_8b7e80c3fb80a9a7700efe8e89371deb *obj)
{
    (void) ctx;
    
    struct futhark_i64_1d *v;
    
    lock_lock(&ctx->lock);
    CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
    v = malloc(sizeof(struct futhark_i64_1d));
    memcpy(v, obj->v7, sizeof(struct futhark_i64_1d));
    (void) (*v->mem.references)++;
    CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
    lock_unlock(&ctx->lock);
    *out = v;
    return 0;
}
int futhark_project_opaque_8b7e80c3fb80a9a7700efe8e89371deb_radius(struct futhark_context *ctx, double *out, const struct futhark_opaque_8b7e80c3fb80a9a7700efe8e89371deb *obj)
{
    (void) ctx;
    
    double v;
    
    v = obj->v8;
    *out = v;
    return 0;
}
int futhark_project_opaque_8b7e80c3fb80a9a7700efe8e89371deb_step_per_dim(struct futhark_context *ctx, struct futhark_f64_1d **out, const struct futhark_opaque_8b7e80c3fb80a9a7700efe8e89371deb *obj)
{
    (void) ctx;
    
    struct futhark_f64_1d *v;
    
    lock_lock(&ctx->lock);
    CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
    v = malloc(sizeof(struct futhark_f64_1d));
    memcpy(v, obj->v9, sizeof(struct futhark_f64_1d));
    (void) (*v->mem.references)++;
    CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
    lock_unlock(&ctx->lock);
    *out = v;
    return 0;
}
int futhark_project_opaque_8b7e80c3fb80a9a7700efe8e89371deb_total_partitions(struct futhark_context *ctx, int64_t *out, const struct futhark_opaque_8b7e80c3fb80a9a7700efe8e89371deb *obj)
{
    (void) ctx;
    
    int64_t v;
    
    v = obj->v10;
    *out = v;
    return 0;
}
int futhark_new_opaque_8b7e80c3fb80a9a7700efe8e89371deb(struct futhark_context *ctx, struct futhark_opaque_8b7e80c3fb80a9a7700efe8e89371deb **out, const struct futhark_opaque_00764e1f7379f14f22282d21712a8514 *f_angle_t, const struct futhark_opaque_5797e930517e531e6d939a24b1db07bd *f_dist_t, const double f_eps, const int64_t f_m_sizze, const struct futhark_f64_1d *f_maxs, const int64_t f_minPts, const struct futhark_f64_1d *f_mins, const struct futhark_i64_1d *f_part_per_dim, const double f_radius, const struct futhark_f64_1d *f_step_per_dim, const int64_t f_total_partitions)
{
    struct futhark_opaque_8b7e80c3fb80a9a7700efe8e89371deb *v = malloc(sizeof(struct futhark_opaque_8b7e80c3fb80a9a7700efe8e89371deb));
    
    lock_lock(&ctx->lock);
    CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
    {
        v->v0 = f_angle_t->v0;
    }
    {
        v->v1 = f_dist_t->v0;
    }
    v->v2 = f_eps;
    v->v3 = f_m_sizze;
    {
        v->v4 = malloc(sizeof(struct futhark_f64_1d));
        *v->v4 = *f_maxs;
        (void) (*v->v4->mem.references)++;
    }
    v->v5 = f_minPts;
    {
        v->v6 = malloc(sizeof(struct futhark_f64_1d));
        *v->v6 = *f_mins;
        (void) (*v->v6->mem.references)++;
    }
    {
        v->v7 = malloc(sizeof(struct futhark_i64_1d));
        *v->v7 = *f_part_per_dim;
        (void) (*v->v7->mem.references)++;
    }
    v->v8 = f_radius;
    {
        v->v9 = malloc(sizeof(struct futhark_f64_1d));
        *v->v9 = *f_step_per_dim;
        (void) (*v->v9->mem.references)++;
    }
    v->v10 = f_total_partitions;
    CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
    lock_unlock(&ctx->lock);
    *out = v;
    return FUTHARK_SUCCESS;
}
int futhark_free_opaque_8b7e80c3fb80a9a7700efe8e89371deb(struct futhark_context *ctx, struct futhark_opaque_8b7e80c3fb80a9a7700efe8e89371deb *obj)
{
    (void) ctx;
    
    int ret = 0, tmp;
    
    if (obj->v4 != NULL && (tmp = futhark_free_f64_1d(ctx, obj->v4)) != 0)
        ret = tmp;
    if (obj->v6 != NULL && (tmp = futhark_free_f64_1d(ctx, obj->v6)) != 0)
        ret = tmp;
    if (obj->v7 != NULL && (tmp = futhark_free_i64_1d(ctx, obj->v7)) != 0)
        ret = tmp;
    if (obj->v9 != NULL && (tmp = futhark_free_f64_1d(ctx, obj->v9)) != 0)
        ret = tmp;
    free(obj);
    return ret;
}
int futhark_store_opaque_8b7e80c3fb80a9a7700efe8e89371deb(struct futhark_context *ctx, const struct futhark_opaque_8b7e80c3fb80a9a7700efe8e89371deb *obj, void **p, size_t *n)
{
    (void) ctx;
    
    int ret = 0;
    int64_t size_0 = 7 + 0 * sizeof(int64_t) + 1 * sizeof(int8_t);
    int64_t size_1 = 7 + 0 * sizeof(int64_t) + 1 * sizeof(int8_t);
    int64_t size_2 = 7 + 0 * sizeof(int64_t) + 1 * sizeof(double);
    int64_t size_3 = 7 + 0 * sizeof(int64_t) + 1 * sizeof(int64_t);
    int64_t size_4 = 7 + 1 * sizeof(int64_t) + futhark_shape_f64_1d(ctx, obj->v4)[0] * sizeof(double);
    int64_t size_5 = 7 + 0 * sizeof(int64_t) + 1 * sizeof(int64_t);
    int64_t size_6 = 7 + 1 * sizeof(int64_t) + futhark_shape_f64_1d(ctx, obj->v6)[0] * sizeof(double);
    int64_t size_7 = 7 + 1 * sizeof(int64_t) + futhark_shape_i64_1d(ctx, obj->v7)[0] * sizeof(int64_t);
    int64_t size_8 = 7 + 0 * sizeof(int64_t) + 1 * sizeof(double);
    int64_t size_9 = 7 + 1 * sizeof(int64_t) + futhark_shape_f64_1d(ctx, obj->v9)[0] * sizeof(double);
    int64_t size_10 = 7 + 0 * sizeof(int64_t) + 1 * sizeof(int64_t);
    
    *n = size_0 + size_1 + size_2 + size_3 + size_4 + size_5 + size_6 + size_7 + size_8 + size_9 + size_10;
    if (p != NULL && *p == NULL)
        *p = malloc(*n);
    if (p != NULL) {
        unsigned char *out = *p;
        
        *out++ = 'b';
        *out++ = 2;
        *out++ = 0;
        memcpy(out, "  i8", 4);
        out += 4;
        memcpy(out, &obj->v0, sizeof(obj->v0));
        out += sizeof(obj->v0);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 0;
        memcpy(out, "  i8", 4);
        out += 4;
        memcpy(out, &obj->v1, sizeof(obj->v1));
        out += sizeof(obj->v1);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 0;
        memcpy(out, " f64", 4);
        out += 4;
        memcpy(out, &obj->v2, sizeof(obj->v2));
        out += sizeof(obj->v2);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 0;
        memcpy(out, " i64", 4);
        out += 4;
        memcpy(out, &obj->v3, sizeof(obj->v3));
        out += sizeof(obj->v3);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 1;
        memcpy(out, " f64", 4);
        out += 4;
        memcpy(out, futhark_shape_f64_1d(ctx, obj->v4), 1 * sizeof(int64_t));
        out += 1 * sizeof(int64_t);
        ret |= futhark_values_f64_1d(ctx, obj->v4, (void *) out);
        out += futhark_shape_f64_1d(ctx, obj->v4)[0] * sizeof(double);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 0;
        memcpy(out, " i64", 4);
        out += 4;
        memcpy(out, &obj->v5, sizeof(obj->v5));
        out += sizeof(obj->v5);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 1;
        memcpy(out, " f64", 4);
        out += 4;
        memcpy(out, futhark_shape_f64_1d(ctx, obj->v6), 1 * sizeof(int64_t));
        out += 1 * sizeof(int64_t);
        ret |= futhark_values_f64_1d(ctx, obj->v6, (void *) out);
        out += futhark_shape_f64_1d(ctx, obj->v6)[0] * sizeof(double);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 1;
        memcpy(out, " i64", 4);
        out += 4;
        memcpy(out, futhark_shape_i64_1d(ctx, obj->v7), 1 * sizeof(int64_t));
        out += 1 * sizeof(int64_t);
        ret |= futhark_values_i64_1d(ctx, obj->v7, (void *) out);
        out += futhark_shape_i64_1d(ctx, obj->v7)[0] * sizeof(int64_t);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 0;
        memcpy(out, " f64", 4);
        out += 4;
        memcpy(out, &obj->v8, sizeof(obj->v8));
        out += sizeof(obj->v8);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 1;
        memcpy(out, " f64", 4);
        out += 4;
        memcpy(out, futhark_shape_f64_1d(ctx, obj->v9), 1 * sizeof(int64_t));
        out += 1 * sizeof(int64_t);
        ret |= futhark_values_f64_1d(ctx, obj->v9, (void *) out);
        out += futhark_shape_f64_1d(ctx, obj->v9)[0] * sizeof(double);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 0;
        memcpy(out, " i64", 4);
        out += 4;
        memcpy(out, &obj->v10, sizeof(obj->v10));
        out += sizeof(obj->v10);
    }
    return ret;
}
struct futhark_opaque_8b7e80c3fb80a9a7700efe8e89371deb *futhark_restore_opaque_8b7e80c3fb80a9a7700efe8e89371deb(struct futhark_context *ctx, const void *p)
{
    (void) ctx;
    
    int err = 0;
    const unsigned char *src = p;
    struct futhark_opaque_8b7e80c3fb80a9a7700efe8e89371deb *obj = malloc(sizeof(struct futhark_opaque_8b7e80c3fb80a9a7700efe8e89371deb));
    
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 0;
    err |= memcmp(src, "  i8", 4) != 0;
    src += 4;
    if (err == 0) {
        src += 0 * sizeof(int64_t);
    }
    
    const void *data_0 = src;
    
    src += sizeof(obj->v0);
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 0;
    err |= memcmp(src, "  i8", 4) != 0;
    src += 4;
    if (err == 0) {
        src += 0 * sizeof(int64_t);
    }
    
    const void *data_1 = src;
    
    src += sizeof(obj->v1);
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 0;
    err |= memcmp(src, " f64", 4) != 0;
    src += 4;
    if (err == 0) {
        src += 0 * sizeof(int64_t);
    }
    
    const void *data_2 = src;
    
    src += sizeof(obj->v2);
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 0;
    err |= memcmp(src, " i64", 4) != 0;
    src += 4;
    if (err == 0) {
        src += 0 * sizeof(int64_t);
    }
    
    const void *data_3 = src;
    
    src += sizeof(obj->v3);
    
    int64_t shape_4[1] = {0};
    
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 1;
    err |= memcmp(src, " f64", 4) != 0;
    src += 4;
    if (err == 0) {
        memcpy(shape_4, src, 1 * sizeof(int64_t));
        src += 1 * sizeof(int64_t);
    }
    
    const void *data_4 = src;
    
    obj->v4 = NULL;
    src += shape_4[0] * sizeof(double);
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 0;
    err |= memcmp(src, " i64", 4) != 0;
    src += 4;
    if (err == 0) {
        src += 0 * sizeof(int64_t);
    }
    
    const void *data_5 = src;
    
    src += sizeof(obj->v5);
    
    int64_t shape_6[1] = {0};
    
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 1;
    err |= memcmp(src, " f64", 4) != 0;
    src += 4;
    if (err == 0) {
        memcpy(shape_6, src, 1 * sizeof(int64_t));
        src += 1 * sizeof(int64_t);
    }
    
    const void *data_6 = src;
    
    obj->v6 = NULL;
    src += shape_6[0] * sizeof(double);
    
    int64_t shape_7[1] = {0};
    
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 1;
    err |= memcmp(src, " i64", 4) != 0;
    src += 4;
    if (err == 0) {
        memcpy(shape_7, src, 1 * sizeof(int64_t));
        src += 1 * sizeof(int64_t);
    }
    
    const void *data_7 = src;
    
    obj->v7 = NULL;
    src += shape_7[0] * sizeof(int64_t);
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 0;
    err |= memcmp(src, " f64", 4) != 0;
    src += 4;
    if (err == 0) {
        src += 0 * sizeof(int64_t);
    }
    
    const void *data_8 = src;
    
    src += sizeof(obj->v8);
    
    int64_t shape_9[1] = {0};
    
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 1;
    err |= memcmp(src, " f64", 4) != 0;
    src += 4;
    if (err == 0) {
        memcpy(shape_9, src, 1 * sizeof(int64_t));
        src += 1 * sizeof(int64_t);
    }
    
    const void *data_9 = src;
    
    obj->v9 = NULL;
    src += shape_9[0] * sizeof(double);
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 0;
    err |= memcmp(src, " i64", 4) != 0;
    src += 4;
    if (err == 0) {
        src += 0 * sizeof(int64_t);
    }
    
    const void *data_10 = src;
    
    src += sizeof(obj->v10);
    if (err == 0) {
        memcpy(&obj->v0, data_0, sizeof(obj->v0));
        memcpy(&obj->v1, data_1, sizeof(obj->v1));
        memcpy(&obj->v2, data_2, sizeof(obj->v2));
        memcpy(&obj->v3, data_3, sizeof(obj->v3));
        obj->v4 = futhark_new_f64_1d(ctx, data_4, shape_4[0]);
        if (obj->v4 == NULL)
            err = 1;
        memcpy(&obj->v5, data_5, sizeof(obj->v5));
        obj->v6 = futhark_new_f64_1d(ctx, data_6, shape_6[0]);
        if (obj->v6 == NULL)
            err = 1;
        obj->v7 = futhark_new_i64_1d(ctx, data_7, shape_7[0]);
        if (obj->v7 == NULL)
            err = 1;
        memcpy(&obj->v8, data_8, sizeof(obj->v8));
        obj->v9 = futhark_new_f64_1d(ctx, data_9, shape_9[0]);
        if (obj->v9 == NULL)
            err = 1;
        memcpy(&obj->v10, data_10, sizeof(obj->v10));
    }
    if (err != 0) {
        int ret = 0, tmp;
        
        if (obj->v4 != NULL && (tmp = futhark_free_f64_1d(ctx, obj->v4)) != 0)
            ret = tmp;
        if (obj->v6 != NULL && (tmp = futhark_free_f64_1d(ctx, obj->v6)) != 0)
            ret = tmp;
        if (obj->v7 != NULL && (tmp = futhark_free_i64_1d(ctx, obj->v7)) != 0)
            ret = tmp;
        if (obj->v9 != NULL && (tmp = futhark_free_f64_1d(ctx, obj->v9)) != 0)
            ret = tmp;
        free(obj);
        obj = NULL;
    }
    return obj;
}
struct futhark_opaque_tup2_f64_f64 {
    double v0;
    double v1;
};
int futhark_project_opaque_tup2_f64_f64_0(struct futhark_context *ctx, double *out, const struct futhark_opaque_tup2_f64_f64 *obj)
{
    (void) ctx;
    
    double v;
    
    v = obj->v0;
    *out = v;
    return 0;
}
int futhark_project_opaque_tup2_f64_f64_1(struct futhark_context *ctx, double *out, const struct futhark_opaque_tup2_f64_f64 *obj)
{
    (void) ctx;
    
    double v;
    
    v = obj->v1;
    *out = v;
    return 0;
}
int futhark_new_opaque_tup2_f64_f64(struct futhark_context *ctx, struct futhark_opaque_tup2_f64_f64 **out, const double f_0, const double f_1)
{
    struct futhark_opaque_tup2_f64_f64 *v = malloc(sizeof(struct futhark_opaque_tup2_f64_f64));
    
    lock_lock(&ctx->lock);
    CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
    v->v0 = f_0;
    v->v1 = f_1;
    CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
    lock_unlock(&ctx->lock);
    *out = v;
    return FUTHARK_SUCCESS;
}
int futhark_free_opaque_tup2_f64_f64(struct futhark_context *ctx, struct futhark_opaque_tup2_f64_f64 *obj)
{
    (void) ctx;
    
    int ret = 0, tmp;
    
    free(obj);
    return ret;
}
int futhark_store_opaque_tup2_f64_f64(struct futhark_context *ctx, const struct futhark_opaque_tup2_f64_f64 *obj, void **p, size_t *n)
{
    (void) ctx;
    
    int ret = 0;
    int64_t size_0 = 7 + 0 * sizeof(int64_t) + 1 * sizeof(double);
    int64_t size_1 = 7 + 0 * sizeof(int64_t) + 1 * sizeof(double);
    
    *n = size_0 + size_1;
    if (p != NULL && *p == NULL)
        *p = malloc(*n);
    if (p != NULL) {
        unsigned char *out = *p;
        
        *out++ = 'b';
        *out++ = 2;
        *out++ = 0;
        memcpy(out, " f64", 4);
        out += 4;
        memcpy(out, &obj->v0, sizeof(obj->v0));
        out += sizeof(obj->v0);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 0;
        memcpy(out, " f64", 4);
        out += 4;
        memcpy(out, &obj->v1, sizeof(obj->v1));
        out += sizeof(obj->v1);
    }
    return ret;
}
struct futhark_opaque_tup2_f64_f64 *futhark_restore_opaque_tup2_f64_f64(struct futhark_context *ctx, const void *p)
{
    (void) ctx;
    
    int err = 0;
    const unsigned char *src = p;
    struct futhark_opaque_tup2_f64_f64 *obj = malloc(sizeof(struct futhark_opaque_tup2_f64_f64));
    
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 0;
    err |= memcmp(src, " f64", 4) != 0;
    src += 4;
    if (err == 0) {
        src += 0 * sizeof(int64_t);
    }
    
    const void *data_0 = src;
    
    src += sizeof(obj->v0);
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 0;
    err |= memcmp(src, " f64", 4) != 0;
    src += 4;
    if (err == 0) {
        src += 0 * sizeof(int64_t);
    }
    
    const void *data_1 = src;
    
    src += sizeof(obj->v1);
    if (err == 0) {
        memcpy(&obj->v0, data_0, sizeof(obj->v0));
        memcpy(&obj->v1, data_1, sizeof(obj->v1));
    }
    if (err != 0) {
        int ret = 0, tmp;
        
        free(obj);
        obj = NULL;
    }
    return obj;
}
struct futhark_opaque_arr1d_tup2_f64_f64 {
    struct futhark_f64_1d *v0;
    struct futhark_f64_1d *v1;
};
int futhark_project_opaque_arr1d_tup2_f64_f64_0(struct futhark_context *ctx, struct futhark_f64_1d **out, const struct futhark_opaque_arr1d_tup2_f64_f64 *obj)
{
    (void) ctx;
    
    struct futhark_f64_1d *v;
    
    lock_lock(&ctx->lock);
    CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
    v = malloc(sizeof(struct futhark_f64_1d));
    memcpy(v, obj->v0, sizeof(struct futhark_f64_1d));
    (void) (*v->mem.references)++;
    CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
    lock_unlock(&ctx->lock);
    *out = v;
    return 0;
}
int futhark_project_opaque_arr1d_tup2_f64_f64_1(struct futhark_context *ctx, struct futhark_f64_1d **out, const struct futhark_opaque_arr1d_tup2_f64_f64 *obj)
{
    (void) ctx;
    
    struct futhark_f64_1d *v;
    
    lock_lock(&ctx->lock);
    CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
    v = malloc(sizeof(struct futhark_f64_1d));
    memcpy(v, obj->v1, sizeof(struct futhark_f64_1d));
    (void) (*v->mem.references)++;
    CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
    lock_unlock(&ctx->lock);
    *out = v;
    return 0;
}
int futhark_zip_opaque_arr1d_tup2_f64_f64(struct futhark_context *ctx, struct futhark_opaque_arr1d_tup2_f64_f64 **out, const struct futhark_f64_1d *f_0, const struct futhark_f64_1d *f_1)
{
    if (!(f_0->shape[0] == f_1->shape[0])) {
        set_error(ctx, strdup("Cannot zip arrays with different shapes."));
        return 1;
    }
    
    struct futhark_opaque_arr1d_tup2_f64_f64 *v = malloc(sizeof(struct futhark_opaque_arr1d_tup2_f64_f64));
    
    lock_lock(&ctx->lock);
    CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
    {
        v->v0 = malloc(sizeof(struct futhark_f64_1d));
        *v->v0 = *f_0;
        (void) (*v->v0->mem.references)++;
    }
    {
        v->v1 = malloc(sizeof(struct futhark_f64_1d));
        *v->v1 = *f_1;
        (void) (*v->v1->mem.references)++;
    }
    CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
    lock_unlock(&ctx->lock);
    *out = v;
    return FUTHARK_SUCCESS;
}
int futhark_index_opaque_arr1d_tup2_f64_f64(struct futhark_context *ctx, struct futhark_opaque_tup2_f64_f64 **out, struct futhark_opaque_arr1d_tup2_f64_f64 *arr, int64_t i0)
{
    int err = 0;
    
    if (i0 >= 0 && i0 < arr->v0->shape[0]) {
        struct futhark_opaque_tup2_f64_f64 *v = malloc(sizeof(struct futhark_opaque_tup2_f64_f64));
        
        err = memcpy_gpu2host(ctx, false, (unsigned char *) &v->v0, 0, arr->v0->mem.mem, 8 * (i0 * 1), 8);
        err = memcpy_gpu2host(ctx, false, (unsigned char *) &v->v1, 0, arr->v1->mem.mem, 8 * (i0 * 1), 8);
        if (err == 0)
            *out = v;
    } else {
        err = 1;
        set_error(ctx, strdup("Index out of bounds."));
    }
    return err;
}
const int64_t *futhark_shape_opaque_arr1d_tup2_f64_f64(struct futhark_context *ctx, struct futhark_opaque_arr1d_tup2_f64_f64 *arr)
{
    (void) ctx;
    return arr->v0->shape;
}
int futhark_free_opaque_arr1d_tup2_f64_f64(struct futhark_context *ctx, struct futhark_opaque_arr1d_tup2_f64_f64 *obj)
{
    (void) ctx;
    
    int ret = 0, tmp;
    
    if (obj->v0 != NULL && (tmp = futhark_free_f64_1d(ctx, obj->v0)) != 0)
        ret = tmp;
    if (obj->v1 != NULL && (tmp = futhark_free_f64_1d(ctx, obj->v1)) != 0)
        ret = tmp;
    free(obj);
    return ret;
}
int futhark_store_opaque_arr1d_tup2_f64_f64(struct futhark_context *ctx, const struct futhark_opaque_arr1d_tup2_f64_f64 *obj, void **p, size_t *n)
{
    (void) ctx;
    
    int ret = 0;
    int64_t size_0 = 7 + 1 * sizeof(int64_t) + futhark_shape_f64_1d(ctx, obj->v0)[0] * sizeof(double);
    int64_t size_1 = 7 + 1 * sizeof(int64_t) + futhark_shape_f64_1d(ctx, obj->v1)[0] * sizeof(double);
    
    *n = size_0 + size_1;
    if (p != NULL && *p == NULL)
        *p = malloc(*n);
    if (p != NULL) {
        unsigned char *out = *p;
        
        *out++ = 'b';
        *out++ = 2;
        *out++ = 1;
        memcpy(out, " f64", 4);
        out += 4;
        memcpy(out, futhark_shape_f64_1d(ctx, obj->v0), 1 * sizeof(int64_t));
        out += 1 * sizeof(int64_t);
        ret |= futhark_values_f64_1d(ctx, obj->v0, (void *) out);
        out += futhark_shape_f64_1d(ctx, obj->v0)[0] * sizeof(double);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 1;
        memcpy(out, " f64", 4);
        out += 4;
        memcpy(out, futhark_shape_f64_1d(ctx, obj->v1), 1 * sizeof(int64_t));
        out += 1 * sizeof(int64_t);
        ret |= futhark_values_f64_1d(ctx, obj->v1, (void *) out);
        out += futhark_shape_f64_1d(ctx, obj->v1)[0] * sizeof(double);
    }
    return ret;
}
struct futhark_opaque_arr1d_tup2_f64_f64 *futhark_restore_opaque_arr1d_tup2_f64_f64(struct futhark_context *ctx, const void *p)
{
    (void) ctx;
    
    int err = 0;
    const unsigned char *src = p;
    struct futhark_opaque_arr1d_tup2_f64_f64 *obj = malloc(sizeof(struct futhark_opaque_arr1d_tup2_f64_f64));
    int64_t shape_0[1] = {0};
    
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 1;
    err |= memcmp(src, " f64", 4) != 0;
    src += 4;
    if (err == 0) {
        memcpy(shape_0, src, 1 * sizeof(int64_t));
        src += 1 * sizeof(int64_t);
    }
    
    const void *data_0 = src;
    
    obj->v0 = NULL;
    src += shape_0[0] * sizeof(double);
    
    int64_t shape_1[1] = {0};
    
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 1;
    err |= memcmp(src, " f64", 4) != 0;
    src += 4;
    if (err == 0) {
        memcpy(shape_1, src, 1 * sizeof(int64_t));
        src += 1 * sizeof(int64_t);
    }
    
    const void *data_1 = src;
    
    obj->v1 = NULL;
    src += shape_1[0] * sizeof(double);
    if (err == 0) {
        obj->v0 = futhark_new_f64_1d(ctx, data_0, shape_0[0]);
        if (obj->v0 == NULL)
            err = 1;
        obj->v1 = futhark_new_f64_1d(ctx, data_1, shape_1[0]);
        if (obj->v1 == NULL)
            err = 1;
    }
    if (err != 0) {
        int ret = 0, tmp;
        
        if (obj->v0 != NULL && (tmp = futhark_free_f64_1d(ctx, obj->v0)) != 0)
            ret = tmp;
        if (obj->v1 != NULL && (tmp = futhark_free_f64_1d(ctx, obj->v1)) != 0)
            ret = tmp;
        free(obj);
        obj = NULL;
    }
    return obj;
}
struct futhark_opaque_a8fdbed66266f52db9d5a0da8b1f6763 {
    struct futhark_bool_1d *v0;
    struct futhark_i64_1d *v1;
    struct futhark_f64_1d *v2;
    struct futhark_f64_1d *v3;
    int64_t v4;
    int64_t v5;
    int64_t v6;
    struct futhark_bool_1d *v7;
    int64_t v8;
    int64_t v9;
    struct futhark_i64_1d *v10;
};
int futhark_project_opaque_a8fdbed66266f52db9d5a0da8b1f6763_buff_isCore(struct futhark_context *ctx, struct futhark_bool_1d **out, const struct futhark_opaque_a8fdbed66266f52db9d5a0da8b1f6763 *obj)
{
    (void) ctx;
    
    struct futhark_bool_1d *v;
    
    lock_lock(&ctx->lock);
    CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
    v = malloc(sizeof(struct futhark_bool_1d));
    memcpy(v, obj->v0, sizeof(struct futhark_bool_1d));
    (void) (*v->mem.references)++;
    CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
    lock_unlock(&ctx->lock);
    *out = v;
    return 0;
}
int futhark_project_opaque_a8fdbed66266f52db9d5a0da8b1f6763_buffered_ids(struct futhark_context *ctx, struct futhark_i64_1d **out, const struct futhark_opaque_a8fdbed66266f52db9d5a0da8b1f6763 *obj)
{
    (void) ctx;
    
    struct futhark_i64_1d *v;
    
    lock_lock(&ctx->lock);
    CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
    v = malloc(sizeof(struct futhark_i64_1d));
    memcpy(v, obj->v1, sizeof(struct futhark_i64_1d));
    (void) (*v->mem.references)++;
    CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
    lock_unlock(&ctx->lock);
    *out = v;
    return 0;
}
int futhark_project_opaque_a8fdbed66266f52db9d5a0da8b1f6763_buffered_pts(struct futhark_context *ctx, struct futhark_opaque_arr1d_tup2_f64_f64 **out, const struct futhark_opaque_a8fdbed66266f52db9d5a0da8b1f6763 *obj)
{
    (void) ctx;
    
    struct futhark_opaque_arr1d_tup2_f64_f64 *v;
    
    lock_lock(&ctx->lock);
    CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
    v = malloc(sizeof(struct futhark_opaque_arr1d_tup2_f64_f64));
    v->v0 = malloc(sizeof(*v->v0));
    *v->v0 = *obj->v2;
    (void) (*v->v0->mem.references)++;
    v->v1 = malloc(sizeof(*v->v1));
    *v->v1 = *obj->v3;
    (void) (*v->v1->mem.references)++;
    CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
    lock_unlock(&ctx->lock);
    *out = v;
    return 0;
}
int futhark_project_opaque_a8fdbed66266f52db9d5a0da8b1f6763_chainOffs(struct futhark_context *ctx, int64_t *out, const struct futhark_opaque_a8fdbed66266f52db9d5a0da8b1f6763 *obj)
{
    (void) ctx;
    
    int64_t v;
    
    v = obj->v4;
    *out = v;
    return 0;
}
int futhark_project_opaque_a8fdbed66266f52db9d5a0da8b1f6763_cur_part_id(struct futhark_context *ctx, int64_t *out, const struct futhark_opaque_a8fdbed66266f52db9d5a0da8b1f6763 *obj)
{
    (void) ctx;
    
    int64_t v;
    
    v = obj->v5;
    *out = v;
    return 0;
}
int futhark_project_opaque_a8fdbed66266f52db9d5a0da8b1f6763_cur_part_order(struct futhark_context *ctx, int64_t *out, const struct futhark_opaque_a8fdbed66266f52db9d5a0da8b1f6763 *obj)
{
    (void) ctx;
    
    int64_t v;
    
    v = obj->v6;
    *out = v;
    return 0;
}
int futhark_project_opaque_a8fdbed66266f52db9d5a0da8b1f6763_isPartVisited(struct futhark_context *ctx, struct futhark_bool_1d **out, const struct futhark_opaque_a8fdbed66266f52db9d5a0da8b1f6763 *obj)
{
    (void) ctx;
    
    struct futhark_bool_1d *v;
    
    lock_lock(&ctx->lock);
    CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
    v = malloc(sizeof(struct futhark_bool_1d));
    memcpy(v, obj->v7, sizeof(struct futhark_bool_1d));
    (void) (*v->mem.references)++;
    CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
    lock_unlock(&ctx->lock);
    *out = v;
    return 0;
}
int futhark_project_opaque_a8fdbed66266f52db9d5a0da8b1f6763_next_offs(struct futhark_context *ctx, int64_t *out, const struct futhark_opaque_a8fdbed66266f52db9d5a0da8b1f6763 *obj)
{
    (void) ctx;
    
    int64_t v;
    
    v = obj->v8;
    *out = v;
    return 0;
}
int futhark_project_opaque_a8fdbed66266f52db9d5a0da8b1f6763_offs(struct futhark_context *ctx, int64_t *out, const struct futhark_opaque_a8fdbed66266f52db9d5a0da8b1f6763 *obj)
{
    (void) ctx;
    
    int64_t v;
    
    v = obj->v9;
    *out = v;
    return 0;
}
int futhark_project_opaque_a8fdbed66266f52db9d5a0da8b1f6763_relevantParts(struct futhark_context *ctx, struct futhark_i64_1d **out, const struct futhark_opaque_a8fdbed66266f52db9d5a0da8b1f6763 *obj)
{
    (void) ctx;
    
    struct futhark_i64_1d *v;
    
    lock_lock(&ctx->lock);
    CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
    v = malloc(sizeof(struct futhark_i64_1d));
    memcpy(v, obj->v10, sizeof(struct futhark_i64_1d));
    (void) (*v->mem.references)++;
    CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
    lock_unlock(&ctx->lock);
    *out = v;
    return 0;
}
int futhark_new_opaque_a8fdbed66266f52db9d5a0da8b1f6763(struct futhark_context *ctx, struct futhark_opaque_a8fdbed66266f52db9d5a0da8b1f6763 **out, const struct futhark_bool_1d *f_buff_isCore, const struct futhark_i64_1d *f_buffered_ids, const struct futhark_opaque_arr1d_tup2_f64_f64 *f_buffered_pts, const int64_t f_chainOffs, const int64_t f_cur_part_id, const int64_t f_cur_part_order, const struct futhark_bool_1d *f_isPartVisited, const int64_t f_next_offs, const int64_t f_offs, const struct futhark_i64_1d *f_relevantParts)
{
    struct futhark_opaque_a8fdbed66266f52db9d5a0da8b1f6763 *v = malloc(sizeof(struct futhark_opaque_a8fdbed66266f52db9d5a0da8b1f6763));
    
    lock_lock(&ctx->lock);
    CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
    {
        v->v0 = malloc(sizeof(struct futhark_bool_1d));
        *v->v0 = *f_buff_isCore;
        (void) (*v->v0->mem.references)++;
    }
    {
        v->v1 = malloc(sizeof(struct futhark_i64_1d));
        *v->v1 = *f_buffered_ids;
        (void) (*v->v1->mem.references)++;
    }
    {
        {
            v->v2 = malloc(sizeof(*f_buffered_pts->v0));
            *v->v2 = *f_buffered_pts->v0;
            (void) (*v->v2->mem.references)++;
        }
        {
            v->v3 = malloc(sizeof(*f_buffered_pts->v1));
            *v->v3 = *f_buffered_pts->v1;
            (void) (*v->v3->mem.references)++;
        }
    }
    v->v4 = f_chainOffs;
    v->v5 = f_cur_part_id;
    v->v6 = f_cur_part_order;
    {
        v->v7 = malloc(sizeof(struct futhark_bool_1d));
        *v->v7 = *f_isPartVisited;
        (void) (*v->v7->mem.references)++;
    }
    v->v8 = f_next_offs;
    v->v9 = f_offs;
    {
        v->v10 = malloc(sizeof(struct futhark_i64_1d));
        *v->v10 = *f_relevantParts;
        (void) (*v->v10->mem.references)++;
    }
    CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
    lock_unlock(&ctx->lock);
    *out = v;
    return FUTHARK_SUCCESS;
}
int futhark_free_opaque_a8fdbed66266f52db9d5a0da8b1f6763(struct futhark_context *ctx, struct futhark_opaque_a8fdbed66266f52db9d5a0da8b1f6763 *obj)
{
    (void) ctx;
    
    int ret = 0, tmp;
    
    if (obj->v0 != NULL && (tmp = futhark_free_bool_1d(ctx, obj->v0)) != 0)
        ret = tmp;
    if (obj->v1 != NULL && (tmp = futhark_free_i64_1d(ctx, obj->v1)) != 0)
        ret = tmp;
    if (obj->v2 != NULL && (tmp = futhark_free_f64_1d(ctx, obj->v2)) != 0)
        ret = tmp;
    if (obj->v3 != NULL && (tmp = futhark_free_f64_1d(ctx, obj->v3)) != 0)
        ret = tmp;
    if (obj->v7 != NULL && (tmp = futhark_free_bool_1d(ctx, obj->v7)) != 0)
        ret = tmp;
    if (obj->v10 != NULL && (tmp = futhark_free_i64_1d(ctx, obj->v10)) != 0)
        ret = tmp;
    free(obj);
    return ret;
}
int futhark_store_opaque_a8fdbed66266f52db9d5a0da8b1f6763(struct futhark_context *ctx, const struct futhark_opaque_a8fdbed66266f52db9d5a0da8b1f6763 *obj, void **p, size_t *n)
{
    (void) ctx;
    
    int ret = 0;
    int64_t size_0 = 7 + 1 * sizeof(int64_t) + futhark_shape_bool_1d(ctx, obj->v0)[0] * sizeof(bool);
    int64_t size_1 = 7 + 1 * sizeof(int64_t) + futhark_shape_i64_1d(ctx, obj->v1)[0] * sizeof(int64_t);
    int64_t size_2 = 7 + 1 * sizeof(int64_t) + futhark_shape_f64_1d(ctx, obj->v2)[0] * sizeof(double);
    int64_t size_3 = 7 + 1 * sizeof(int64_t) + futhark_shape_f64_1d(ctx, obj->v3)[0] * sizeof(double);
    int64_t size_4 = 7 + 0 * sizeof(int64_t) + 1 * sizeof(int64_t);
    int64_t size_5 = 7 + 0 * sizeof(int64_t) + 1 * sizeof(int64_t);
    int64_t size_6 = 7 + 0 * sizeof(int64_t) + 1 * sizeof(int64_t);
    int64_t size_7 = 7 + 1 * sizeof(int64_t) + futhark_shape_bool_1d(ctx, obj->v7)[0] * sizeof(bool);
    int64_t size_8 = 7 + 0 * sizeof(int64_t) + 1 * sizeof(int64_t);
    int64_t size_9 = 7 + 0 * sizeof(int64_t) + 1 * sizeof(int64_t);
    int64_t size_10 = 7 + 1 * sizeof(int64_t) + futhark_shape_i64_1d(ctx, obj->v10)[0] * sizeof(int64_t);
    
    *n = size_0 + size_1 + size_2 + size_3 + size_4 + size_5 + size_6 + size_7 + size_8 + size_9 + size_10;
    if (p != NULL && *p == NULL)
        *p = malloc(*n);
    if (p != NULL) {
        unsigned char *out = *p;
        
        *out++ = 'b';
        *out++ = 2;
        *out++ = 1;
        memcpy(out, "bool", 4);
        out += 4;
        memcpy(out, futhark_shape_bool_1d(ctx, obj->v0), 1 * sizeof(int64_t));
        out += 1 * sizeof(int64_t);
        ret |= futhark_values_bool_1d(ctx, obj->v0, (void *) out);
        out += futhark_shape_bool_1d(ctx, obj->v0)[0] * sizeof(bool);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 1;
        memcpy(out, " i64", 4);
        out += 4;
        memcpy(out, futhark_shape_i64_1d(ctx, obj->v1), 1 * sizeof(int64_t));
        out += 1 * sizeof(int64_t);
        ret |= futhark_values_i64_1d(ctx, obj->v1, (void *) out);
        out += futhark_shape_i64_1d(ctx, obj->v1)[0] * sizeof(int64_t);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 1;
        memcpy(out, " f64", 4);
        out += 4;
        memcpy(out, futhark_shape_f64_1d(ctx, obj->v2), 1 * sizeof(int64_t));
        out += 1 * sizeof(int64_t);
        ret |= futhark_values_f64_1d(ctx, obj->v2, (void *) out);
        out += futhark_shape_f64_1d(ctx, obj->v2)[0] * sizeof(double);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 1;
        memcpy(out, " f64", 4);
        out += 4;
        memcpy(out, futhark_shape_f64_1d(ctx, obj->v3), 1 * sizeof(int64_t));
        out += 1 * sizeof(int64_t);
        ret |= futhark_values_f64_1d(ctx, obj->v3, (void *) out);
        out += futhark_shape_f64_1d(ctx, obj->v3)[0] * sizeof(double);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 0;
        memcpy(out, " i64", 4);
        out += 4;
        memcpy(out, &obj->v4, sizeof(obj->v4));
        out += sizeof(obj->v4);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 0;
        memcpy(out, " i64", 4);
        out += 4;
        memcpy(out, &obj->v5, sizeof(obj->v5));
        out += sizeof(obj->v5);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 0;
        memcpy(out, " i64", 4);
        out += 4;
        memcpy(out, &obj->v6, sizeof(obj->v6));
        out += sizeof(obj->v6);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 1;
        memcpy(out, "bool", 4);
        out += 4;
        memcpy(out, futhark_shape_bool_1d(ctx, obj->v7), 1 * sizeof(int64_t));
        out += 1 * sizeof(int64_t);
        ret |= futhark_values_bool_1d(ctx, obj->v7, (void *) out);
        out += futhark_shape_bool_1d(ctx, obj->v7)[0] * sizeof(bool);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 0;
        memcpy(out, " i64", 4);
        out += 4;
        memcpy(out, &obj->v8, sizeof(obj->v8));
        out += sizeof(obj->v8);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 0;
        memcpy(out, " i64", 4);
        out += 4;
        memcpy(out, &obj->v9, sizeof(obj->v9));
        out += sizeof(obj->v9);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 1;
        memcpy(out, " i64", 4);
        out += 4;
        memcpy(out, futhark_shape_i64_1d(ctx, obj->v10), 1 * sizeof(int64_t));
        out += 1 * sizeof(int64_t);
        ret |= futhark_values_i64_1d(ctx, obj->v10, (void *) out);
        out += futhark_shape_i64_1d(ctx, obj->v10)[0] * sizeof(int64_t);
    }
    return ret;
}
struct futhark_opaque_a8fdbed66266f52db9d5a0da8b1f6763 *futhark_restore_opaque_a8fdbed66266f52db9d5a0da8b1f6763(struct futhark_context *ctx, const void *p)
{
    (void) ctx;
    
    int err = 0;
    const unsigned char *src = p;
    struct futhark_opaque_a8fdbed66266f52db9d5a0da8b1f6763 *obj = malloc(sizeof(struct futhark_opaque_a8fdbed66266f52db9d5a0da8b1f6763));
    int64_t shape_0[1] = {0};
    
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 1;
    err |= memcmp(src, "bool", 4) != 0;
    src += 4;
    if (err == 0) {
        memcpy(shape_0, src, 1 * sizeof(int64_t));
        src += 1 * sizeof(int64_t);
    }
    
    const void *data_0 = src;
    
    obj->v0 = NULL;
    src += shape_0[0] * sizeof(bool);
    
    int64_t shape_1[1] = {0};
    
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 1;
    err |= memcmp(src, " i64", 4) != 0;
    src += 4;
    if (err == 0) {
        memcpy(shape_1, src, 1 * sizeof(int64_t));
        src += 1 * sizeof(int64_t);
    }
    
    const void *data_1 = src;
    
    obj->v1 = NULL;
    src += shape_1[0] * sizeof(int64_t);
    
    int64_t shape_2[1] = {0};
    
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 1;
    err |= memcmp(src, " f64", 4) != 0;
    src += 4;
    if (err == 0) {
        memcpy(shape_2, src, 1 * sizeof(int64_t));
        src += 1 * sizeof(int64_t);
    }
    
    const void *data_2 = src;
    
    obj->v2 = NULL;
    src += shape_2[0] * sizeof(double);
    
    int64_t shape_3[1] = {0};
    
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 1;
    err |= memcmp(src, " f64", 4) != 0;
    src += 4;
    if (err == 0) {
        memcpy(shape_3, src, 1 * sizeof(int64_t));
        src += 1 * sizeof(int64_t);
    }
    
    const void *data_3 = src;
    
    obj->v3 = NULL;
    src += shape_3[0] * sizeof(double);
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 0;
    err |= memcmp(src, " i64", 4) != 0;
    src += 4;
    if (err == 0) {
        src += 0 * sizeof(int64_t);
    }
    
    const void *data_4 = src;
    
    src += sizeof(obj->v4);
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 0;
    err |= memcmp(src, " i64", 4) != 0;
    src += 4;
    if (err == 0) {
        src += 0 * sizeof(int64_t);
    }
    
    const void *data_5 = src;
    
    src += sizeof(obj->v5);
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 0;
    err |= memcmp(src, " i64", 4) != 0;
    src += 4;
    if (err == 0) {
        src += 0 * sizeof(int64_t);
    }
    
    const void *data_6 = src;
    
    src += sizeof(obj->v6);
    
    int64_t shape_7[1] = {0};
    
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 1;
    err |= memcmp(src, "bool", 4) != 0;
    src += 4;
    if (err == 0) {
        memcpy(shape_7, src, 1 * sizeof(int64_t));
        src += 1 * sizeof(int64_t);
    }
    
    const void *data_7 = src;
    
    obj->v7 = NULL;
    src += shape_7[0] * sizeof(bool);
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 0;
    err |= memcmp(src, " i64", 4) != 0;
    src += 4;
    if (err == 0) {
        src += 0 * sizeof(int64_t);
    }
    
    const void *data_8 = src;
    
    src += sizeof(obj->v8);
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 0;
    err |= memcmp(src, " i64", 4) != 0;
    src += 4;
    if (err == 0) {
        src += 0 * sizeof(int64_t);
    }
    
    const void *data_9 = src;
    
    src += sizeof(obj->v9);
    
    int64_t shape_10[1] = {0};
    
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 1;
    err |= memcmp(src, " i64", 4) != 0;
    src += 4;
    if (err == 0) {
        memcpy(shape_10, src, 1 * sizeof(int64_t));
        src += 1 * sizeof(int64_t);
    }
    
    const void *data_10 = src;
    
    obj->v10 = NULL;
    src += shape_10[0] * sizeof(int64_t);
    if (err == 0) {
        obj->v0 = futhark_new_bool_1d(ctx, data_0, shape_0[0]);
        if (obj->v0 == NULL)
            err = 1;
        obj->v1 = futhark_new_i64_1d(ctx, data_1, shape_1[0]);
        if (obj->v1 == NULL)
            err = 1;
        obj->v2 = futhark_new_f64_1d(ctx, data_2, shape_2[0]);
        if (obj->v2 == NULL)
            err = 1;
        obj->v3 = futhark_new_f64_1d(ctx, data_3, shape_3[0]);
        if (obj->v3 == NULL)
            err = 1;
        memcpy(&obj->v4, data_4, sizeof(obj->v4));
        memcpy(&obj->v5, data_5, sizeof(obj->v5));
        memcpy(&obj->v6, data_6, sizeof(obj->v6));
        obj->v7 = futhark_new_bool_1d(ctx, data_7, shape_7[0]);
        if (obj->v7 == NULL)
            err = 1;
        memcpy(&obj->v8, data_8, sizeof(obj->v8));
        memcpy(&obj->v9, data_9, sizeof(obj->v9));
        obj->v10 = futhark_new_i64_1d(ctx, data_10, shape_10[0]);
        if (obj->v10 == NULL)
            err = 1;
    }
    if (err != 0) {
        int ret = 0, tmp;
        
        if (obj->v0 != NULL && (tmp = futhark_free_bool_1d(ctx, obj->v0)) != 0)
            ret = tmp;
        if (obj->v1 != NULL && (tmp = futhark_free_i64_1d(ctx, obj->v1)) != 0)
            ret = tmp;
        if (obj->v2 != NULL && (tmp = futhark_free_f64_1d(ctx, obj->v2)) != 0)
            ret = tmp;
        if (obj->v3 != NULL && (tmp = futhark_free_f64_1d(ctx, obj->v3)) != 0)
            ret = tmp;
        if (obj->v7 != NULL && (tmp = futhark_free_bool_1d(ctx, obj->v7)) != 0)
            ret = tmp;
        if (obj->v10 != NULL && (tmp = futhark_free_i64_1d(ctx, obj->v10)) != 0)
            ret = tmp;
        free(obj);
        obj = NULL;
    }
    return obj;
}
struct futhark_opaque_4dedc823193c594b5c01727ae8ac5943 {
    struct futhark_i64_1d *v0;
    struct futhark_f64_1d *v1;
    struct futhark_f64_1d *v2;
    struct futhark_f64_1d *v3;
    struct futhark_f64_1d *v4;
    struct futhark_bool_1d *v5;
    struct futhark_bool_1d *v6;
    struct futhark_bool_1d *v7;
    struct futhark_bool_1d *v8;
    struct futhark_f64_1d *v9;
    struct futhark_f64_1d *v10;
    struct futhark_i64_1d *v11;
    int64_t v12;
};
int futhark_project_opaque_4dedc823193c594b5c01727ae8ac5943_chain_ids(struct futhark_context *ctx, struct futhark_i64_1d **out, const struct futhark_opaque_4dedc823193c594b5c01727ae8ac5943 *obj)
{
    (void) ctx;
    
    struct futhark_i64_1d *v;
    
    lock_lock(&ctx->lock);
    CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
    v = malloc(sizeof(struct futhark_i64_1d));
    memcpy(v, obj->v0, sizeof(struct futhark_i64_1d));
    (void) (*v->mem.references)++;
    CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
    lock_unlock(&ctx->lock);
    *out = v;
    return 0;
}
int futhark_project_opaque_4dedc823193c594b5c01727ae8ac5943_dat(struct futhark_context *ctx, struct futhark_opaque_arr1d_tup2_f64_f64 **out, const struct futhark_opaque_4dedc823193c594b5c01727ae8ac5943 *obj)
{
    (void) ctx;
    
    struct futhark_opaque_arr1d_tup2_f64_f64 *v;
    
    lock_lock(&ctx->lock);
    CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
    v = malloc(sizeof(struct futhark_opaque_arr1d_tup2_f64_f64));
    v->v0 = malloc(sizeof(*v->v0));
    *v->v0 = *obj->v1;
    (void) (*v->v0->mem.references)++;
    v->v1 = malloc(sizeof(*v->v1));
    *v->v1 = *obj->v2;
    (void) (*v->v1->mem.references)++;
    CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
    lock_unlock(&ctx->lock);
    *out = v;
    return 0;
}
int futhark_project_opaque_4dedc823193c594b5c01727ae8ac5943_inner_max_coord(struct futhark_context *ctx, struct futhark_f64_1d **out, const struct futhark_opaque_4dedc823193c594b5c01727ae8ac5943 *obj)
{
    (void) ctx;
    
    struct futhark_f64_1d *v;
    
    lock_lock(&ctx->lock);
    CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
    v = malloc(sizeof(struct futhark_f64_1d));
    memcpy(v, obj->v3, sizeof(struct futhark_f64_1d));
    (void) (*v->mem.references)++;
    CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
    lock_unlock(&ctx->lock);
    *out = v;
    return 0;
}
int futhark_project_opaque_4dedc823193c594b5c01727ae8ac5943_inner_min_coord(struct futhark_context *ctx, struct futhark_f64_1d **out, const struct futhark_opaque_4dedc823193c594b5c01727ae8ac5943 *obj)
{
    (void) ctx;
    
    struct futhark_f64_1d *v;
    
    lock_lock(&ctx->lock);
    CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
    v = malloc(sizeof(struct futhark_f64_1d));
    memcpy(v, obj->v4, sizeof(struct futhark_f64_1d));
    (void) (*v->mem.references)++;
    CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
    lock_unlock(&ctx->lock);
    *out = v;
    return 0;
}
int futhark_project_opaque_4dedc823193c594b5c01727ae8ac5943_isCore(struct futhark_context *ctx, struct futhark_bool_1d **out, const struct futhark_opaque_4dedc823193c594b5c01727ae8ac5943 *obj)
{
    (void) ctx;
    
    struct futhark_bool_1d *v;
    
    lock_lock(&ctx->lock);
    CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
    v = malloc(sizeof(struct futhark_bool_1d));
    memcpy(v, obj->v5, sizeof(struct futhark_bool_1d));
    (void) (*v->mem.references)++;
    CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
    lock_unlock(&ctx->lock);
    *out = v;
    return 0;
}
int futhark_project_opaque_4dedc823193c594b5c01727ae8ac5943_isMargin(struct futhark_context *ctx, struct futhark_bool_1d **out, const struct futhark_opaque_4dedc823193c594b5c01727ae8ac5943 *obj)
{
    (void) ctx;
    
    struct futhark_bool_1d *v;
    
    lock_lock(&ctx->lock);
    CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
    v = malloc(sizeof(struct futhark_bool_1d));
    memcpy(v, obj->v6, sizeof(struct futhark_bool_1d));
    (void) (*v->mem.references)++;
    CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
    lock_unlock(&ctx->lock);
    *out = v;
    return 0;
}
int futhark_project_opaque_4dedc823193c594b5c01727ae8ac5943_isNeighbourVisited(struct futhark_context *ctx, struct futhark_bool_1d **out, const struct futhark_opaque_4dedc823193c594b5c01727ae8ac5943 *obj)
{
    (void) ctx;
    
    struct futhark_bool_1d *v;
    
    lock_lock(&ctx->lock);
    CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
    v = malloc(sizeof(struct futhark_bool_1d));
    memcpy(v, obj->v7, sizeof(struct futhark_bool_1d));
    (void) (*v->mem.references)++;
    CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
    lock_unlock(&ctx->lock);
    *out = v;
    return 0;
}
int futhark_project_opaque_4dedc823193c594b5c01727ae8ac5943_isTightMargin(struct futhark_context *ctx, struct futhark_bool_1d **out, const struct futhark_opaque_4dedc823193c594b5c01727ae8ac5943 *obj)
{
    (void) ctx;
    
    struct futhark_bool_1d *v;
    
    lock_lock(&ctx->lock);
    CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
    v = malloc(sizeof(struct futhark_bool_1d));
    memcpy(v, obj->v8, sizeof(struct futhark_bool_1d));
    (void) (*v->mem.references)++;
    CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
    lock_unlock(&ctx->lock);
    *out = v;
    return 0;
}
int futhark_project_opaque_4dedc823193c594b5c01727ae8ac5943_max_coord(struct futhark_context *ctx, struct futhark_f64_1d **out, const struct futhark_opaque_4dedc823193c594b5c01727ae8ac5943 *obj)
{
    (void) ctx;
    
    struct futhark_f64_1d *v;
    
    lock_lock(&ctx->lock);
    CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
    v = malloc(sizeof(struct futhark_f64_1d));
    memcpy(v, obj->v9, sizeof(struct futhark_f64_1d));
    (void) (*v->mem.references)++;
    CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
    lock_unlock(&ctx->lock);
    *out = v;
    return 0;
}
int futhark_project_opaque_4dedc823193c594b5c01727ae8ac5943_min_coord(struct futhark_context *ctx, struct futhark_f64_1d **out, const struct futhark_opaque_4dedc823193c594b5c01727ae8ac5943 *obj)
{
    (void) ctx;
    
    struct futhark_f64_1d *v;
    
    lock_lock(&ctx->lock);
    CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
    v = malloc(sizeof(struct futhark_f64_1d));
    memcpy(v, obj->v10, sizeof(struct futhark_f64_1d));
    (void) (*v->mem.references)++;
    CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
    lock_unlock(&ctx->lock);
    *out = v;
    return 0;
}
int futhark_project_opaque_4dedc823193c594b5c01727ae8ac5943_neighbours(struct futhark_context *ctx, struct futhark_i64_1d **out, const struct futhark_opaque_4dedc823193c594b5c01727ae8ac5943 *obj)
{
    (void) ctx;
    
    struct futhark_i64_1d *v;
    
    lock_lock(&ctx->lock);
    CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
    v = malloc(sizeof(struct futhark_i64_1d));
    memcpy(v, obj->v11, sizeof(struct futhark_i64_1d));
    (void) (*v->mem.references)++;
    CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
    lock_unlock(&ctx->lock);
    *out = v;
    return 0;
}
int futhark_project_opaque_4dedc823193c594b5c01727ae8ac5943_part_id(struct futhark_context *ctx, int64_t *out, const struct futhark_opaque_4dedc823193c594b5c01727ae8ac5943 *obj)
{
    (void) ctx;
    
    int64_t v;
    
    v = obj->v12;
    *out = v;
    return 0;
}
int futhark_new_opaque_4dedc823193c594b5c01727ae8ac5943(struct futhark_context *ctx, struct futhark_opaque_4dedc823193c594b5c01727ae8ac5943 **out, const struct futhark_i64_1d *f_chain_ids, const struct futhark_opaque_arr1d_tup2_f64_f64 *f_dat, const struct futhark_f64_1d *f_inner_max_coord, const struct futhark_f64_1d *f_inner_min_coord, const struct futhark_bool_1d *f_isCore, const struct futhark_bool_1d *f_isMargin, const struct futhark_bool_1d *f_isNeighbourVisited, const struct futhark_bool_1d *f_isTightMargin, const struct futhark_f64_1d *f_max_coord, const struct futhark_f64_1d *f_min_coord, const struct futhark_i64_1d *f_neighbours, const int64_t f_part_id)
{
    struct futhark_opaque_4dedc823193c594b5c01727ae8ac5943 *v = malloc(sizeof(struct futhark_opaque_4dedc823193c594b5c01727ae8ac5943));
    
    lock_lock(&ctx->lock);
    CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
    {
        v->v0 = malloc(sizeof(struct futhark_i64_1d));
        *v->v0 = *f_chain_ids;
        (void) (*v->v0->mem.references)++;
    }
    {
        {
            v->v1 = malloc(sizeof(*f_dat->v0));
            *v->v1 = *f_dat->v0;
            (void) (*v->v1->mem.references)++;
        }
        {
            v->v2 = malloc(sizeof(*f_dat->v1));
            *v->v2 = *f_dat->v1;
            (void) (*v->v2->mem.references)++;
        }
    }
    {
        v->v3 = malloc(sizeof(struct futhark_f64_1d));
        *v->v3 = *f_inner_max_coord;
        (void) (*v->v3->mem.references)++;
    }
    {
        v->v4 = malloc(sizeof(struct futhark_f64_1d));
        *v->v4 = *f_inner_min_coord;
        (void) (*v->v4->mem.references)++;
    }
    {
        v->v5 = malloc(sizeof(struct futhark_bool_1d));
        *v->v5 = *f_isCore;
        (void) (*v->v5->mem.references)++;
    }
    {
        v->v6 = malloc(sizeof(struct futhark_bool_1d));
        *v->v6 = *f_isMargin;
        (void) (*v->v6->mem.references)++;
    }
    {
        v->v7 = malloc(sizeof(struct futhark_bool_1d));
        *v->v7 = *f_isNeighbourVisited;
        (void) (*v->v7->mem.references)++;
    }
    {
        v->v8 = malloc(sizeof(struct futhark_bool_1d));
        *v->v8 = *f_isTightMargin;
        (void) (*v->v8->mem.references)++;
    }
    {
        v->v9 = malloc(sizeof(struct futhark_f64_1d));
        *v->v9 = *f_max_coord;
        (void) (*v->v9->mem.references)++;
    }
    {
        v->v10 = malloc(sizeof(struct futhark_f64_1d));
        *v->v10 = *f_min_coord;
        (void) (*v->v10->mem.references)++;
    }
    {
        v->v11 = malloc(sizeof(struct futhark_i64_1d));
        *v->v11 = *f_neighbours;
        (void) (*v->v11->mem.references)++;
    }
    v->v12 = f_part_id;
    CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
    lock_unlock(&ctx->lock);
    *out = v;
    return FUTHARK_SUCCESS;
}
int futhark_free_opaque_4dedc823193c594b5c01727ae8ac5943(struct futhark_context *ctx, struct futhark_opaque_4dedc823193c594b5c01727ae8ac5943 *obj)
{
    (void) ctx;
    
    int ret = 0, tmp;
    
    if (obj->v0 != NULL && (tmp = futhark_free_i64_1d(ctx, obj->v0)) != 0)
        ret = tmp;
    if (obj->v1 != NULL && (tmp = futhark_free_f64_1d(ctx, obj->v1)) != 0)
        ret = tmp;
    if (obj->v2 != NULL && (tmp = futhark_free_f64_1d(ctx, obj->v2)) != 0)
        ret = tmp;
    if (obj->v3 != NULL && (tmp = futhark_free_f64_1d(ctx, obj->v3)) != 0)
        ret = tmp;
    if (obj->v4 != NULL && (tmp = futhark_free_f64_1d(ctx, obj->v4)) != 0)
        ret = tmp;
    if (obj->v5 != NULL && (tmp = futhark_free_bool_1d(ctx, obj->v5)) != 0)
        ret = tmp;
    if (obj->v6 != NULL && (tmp = futhark_free_bool_1d(ctx, obj->v6)) != 0)
        ret = tmp;
    if (obj->v7 != NULL && (tmp = futhark_free_bool_1d(ctx, obj->v7)) != 0)
        ret = tmp;
    if (obj->v8 != NULL && (tmp = futhark_free_bool_1d(ctx, obj->v8)) != 0)
        ret = tmp;
    if (obj->v9 != NULL && (tmp = futhark_free_f64_1d(ctx, obj->v9)) != 0)
        ret = tmp;
    if (obj->v10 != NULL && (tmp = futhark_free_f64_1d(ctx, obj->v10)) != 0)
        ret = tmp;
    if (obj->v11 != NULL && (tmp = futhark_free_i64_1d(ctx, obj->v11)) != 0)
        ret = tmp;
    free(obj);
    return ret;
}
int futhark_store_opaque_4dedc823193c594b5c01727ae8ac5943(struct futhark_context *ctx, const struct futhark_opaque_4dedc823193c594b5c01727ae8ac5943 *obj, void **p, size_t *n)
{
    (void) ctx;
    
    int ret = 0;
    int64_t size_0 = 7 + 1 * sizeof(int64_t) + futhark_shape_i64_1d(ctx, obj->v0)[0] * sizeof(int64_t);
    int64_t size_1 = 7 + 1 * sizeof(int64_t) + futhark_shape_f64_1d(ctx, obj->v1)[0] * sizeof(double);
    int64_t size_2 = 7 + 1 * sizeof(int64_t) + futhark_shape_f64_1d(ctx, obj->v2)[0] * sizeof(double);
    int64_t size_3 = 7 + 1 * sizeof(int64_t) + futhark_shape_f64_1d(ctx, obj->v3)[0] * sizeof(double);
    int64_t size_4 = 7 + 1 * sizeof(int64_t) + futhark_shape_f64_1d(ctx, obj->v4)[0] * sizeof(double);
    int64_t size_5 = 7 + 1 * sizeof(int64_t) + futhark_shape_bool_1d(ctx, obj->v5)[0] * sizeof(bool);
    int64_t size_6 = 7 + 1 * sizeof(int64_t) + futhark_shape_bool_1d(ctx, obj->v6)[0] * sizeof(bool);
    int64_t size_7 = 7 + 1 * sizeof(int64_t) + futhark_shape_bool_1d(ctx, obj->v7)[0] * sizeof(bool);
    int64_t size_8 = 7 + 1 * sizeof(int64_t) + futhark_shape_bool_1d(ctx, obj->v8)[0] * sizeof(bool);
    int64_t size_9 = 7 + 1 * sizeof(int64_t) + futhark_shape_f64_1d(ctx, obj->v9)[0] * sizeof(double);
    int64_t size_10 = 7 + 1 * sizeof(int64_t) + futhark_shape_f64_1d(ctx, obj->v10)[0] * sizeof(double);
    int64_t size_11 = 7 + 1 * sizeof(int64_t) + futhark_shape_i64_1d(ctx, obj->v11)[0] * sizeof(int64_t);
    int64_t size_12 = 7 + 0 * sizeof(int64_t) + 1 * sizeof(int64_t);
    
    *n = size_0 + size_1 + size_2 + size_3 + size_4 + size_5 + size_6 + size_7 + size_8 + size_9 + size_10 + size_11 + size_12;
    if (p != NULL && *p == NULL)
        *p = malloc(*n);
    if (p != NULL) {
        unsigned char *out = *p;
        
        *out++ = 'b';
        *out++ = 2;
        *out++ = 1;
        memcpy(out, " i64", 4);
        out += 4;
        memcpy(out, futhark_shape_i64_1d(ctx, obj->v0), 1 * sizeof(int64_t));
        out += 1 * sizeof(int64_t);
        ret |= futhark_values_i64_1d(ctx, obj->v0, (void *) out);
        out += futhark_shape_i64_1d(ctx, obj->v0)[0] * sizeof(int64_t);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 1;
        memcpy(out, " f64", 4);
        out += 4;
        memcpy(out, futhark_shape_f64_1d(ctx, obj->v1), 1 * sizeof(int64_t));
        out += 1 * sizeof(int64_t);
        ret |= futhark_values_f64_1d(ctx, obj->v1, (void *) out);
        out += futhark_shape_f64_1d(ctx, obj->v1)[0] * sizeof(double);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 1;
        memcpy(out, " f64", 4);
        out += 4;
        memcpy(out, futhark_shape_f64_1d(ctx, obj->v2), 1 * sizeof(int64_t));
        out += 1 * sizeof(int64_t);
        ret |= futhark_values_f64_1d(ctx, obj->v2, (void *) out);
        out += futhark_shape_f64_1d(ctx, obj->v2)[0] * sizeof(double);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 1;
        memcpy(out, " f64", 4);
        out += 4;
        memcpy(out, futhark_shape_f64_1d(ctx, obj->v3), 1 * sizeof(int64_t));
        out += 1 * sizeof(int64_t);
        ret |= futhark_values_f64_1d(ctx, obj->v3, (void *) out);
        out += futhark_shape_f64_1d(ctx, obj->v3)[0] * sizeof(double);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 1;
        memcpy(out, " f64", 4);
        out += 4;
        memcpy(out, futhark_shape_f64_1d(ctx, obj->v4), 1 * sizeof(int64_t));
        out += 1 * sizeof(int64_t);
        ret |= futhark_values_f64_1d(ctx, obj->v4, (void *) out);
        out += futhark_shape_f64_1d(ctx, obj->v4)[0] * sizeof(double);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 1;
        memcpy(out, "bool", 4);
        out += 4;
        memcpy(out, futhark_shape_bool_1d(ctx, obj->v5), 1 * sizeof(int64_t));
        out += 1 * sizeof(int64_t);
        ret |= futhark_values_bool_1d(ctx, obj->v5, (void *) out);
        out += futhark_shape_bool_1d(ctx, obj->v5)[0] * sizeof(bool);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 1;
        memcpy(out, "bool", 4);
        out += 4;
        memcpy(out, futhark_shape_bool_1d(ctx, obj->v6), 1 * sizeof(int64_t));
        out += 1 * sizeof(int64_t);
        ret |= futhark_values_bool_1d(ctx, obj->v6, (void *) out);
        out += futhark_shape_bool_1d(ctx, obj->v6)[0] * sizeof(bool);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 1;
        memcpy(out, "bool", 4);
        out += 4;
        memcpy(out, futhark_shape_bool_1d(ctx, obj->v7), 1 * sizeof(int64_t));
        out += 1 * sizeof(int64_t);
        ret |= futhark_values_bool_1d(ctx, obj->v7, (void *) out);
        out += futhark_shape_bool_1d(ctx, obj->v7)[0] * sizeof(bool);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 1;
        memcpy(out, "bool", 4);
        out += 4;
        memcpy(out, futhark_shape_bool_1d(ctx, obj->v8), 1 * sizeof(int64_t));
        out += 1 * sizeof(int64_t);
        ret |= futhark_values_bool_1d(ctx, obj->v8, (void *) out);
        out += futhark_shape_bool_1d(ctx, obj->v8)[0] * sizeof(bool);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 1;
        memcpy(out, " f64", 4);
        out += 4;
        memcpy(out, futhark_shape_f64_1d(ctx, obj->v9), 1 * sizeof(int64_t));
        out += 1 * sizeof(int64_t);
        ret |= futhark_values_f64_1d(ctx, obj->v9, (void *) out);
        out += futhark_shape_f64_1d(ctx, obj->v9)[0] * sizeof(double);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 1;
        memcpy(out, " f64", 4);
        out += 4;
        memcpy(out, futhark_shape_f64_1d(ctx, obj->v10), 1 * sizeof(int64_t));
        out += 1 * sizeof(int64_t);
        ret |= futhark_values_f64_1d(ctx, obj->v10, (void *) out);
        out += futhark_shape_f64_1d(ctx, obj->v10)[0] * sizeof(double);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 1;
        memcpy(out, " i64", 4);
        out += 4;
        memcpy(out, futhark_shape_i64_1d(ctx, obj->v11), 1 * sizeof(int64_t));
        out += 1 * sizeof(int64_t);
        ret |= futhark_values_i64_1d(ctx, obj->v11, (void *) out);
        out += futhark_shape_i64_1d(ctx, obj->v11)[0] * sizeof(int64_t);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 0;
        memcpy(out, " i64", 4);
        out += 4;
        memcpy(out, &obj->v12, sizeof(obj->v12));
        out += sizeof(obj->v12);
    }
    return ret;
}
struct futhark_opaque_4dedc823193c594b5c01727ae8ac5943 *futhark_restore_opaque_4dedc823193c594b5c01727ae8ac5943(struct futhark_context *ctx, const void *p)
{
    (void) ctx;
    
    int err = 0;
    const unsigned char *src = p;
    struct futhark_opaque_4dedc823193c594b5c01727ae8ac5943 *obj = malloc(sizeof(struct futhark_opaque_4dedc823193c594b5c01727ae8ac5943));
    int64_t shape_0[1] = {0};
    
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 1;
    err |= memcmp(src, " i64", 4) != 0;
    src += 4;
    if (err == 0) {
        memcpy(shape_0, src, 1 * sizeof(int64_t));
        src += 1 * sizeof(int64_t);
    }
    
    const void *data_0 = src;
    
    obj->v0 = NULL;
    src += shape_0[0] * sizeof(int64_t);
    
    int64_t shape_1[1] = {0};
    
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 1;
    err |= memcmp(src, " f64", 4) != 0;
    src += 4;
    if (err == 0) {
        memcpy(shape_1, src, 1 * sizeof(int64_t));
        src += 1 * sizeof(int64_t);
    }
    
    const void *data_1 = src;
    
    obj->v1 = NULL;
    src += shape_1[0] * sizeof(double);
    
    int64_t shape_2[1] = {0};
    
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 1;
    err |= memcmp(src, " f64", 4) != 0;
    src += 4;
    if (err == 0) {
        memcpy(shape_2, src, 1 * sizeof(int64_t));
        src += 1 * sizeof(int64_t);
    }
    
    const void *data_2 = src;
    
    obj->v2 = NULL;
    src += shape_2[0] * sizeof(double);
    
    int64_t shape_3[1] = {0};
    
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 1;
    err |= memcmp(src, " f64", 4) != 0;
    src += 4;
    if (err == 0) {
        memcpy(shape_3, src, 1 * sizeof(int64_t));
        src += 1 * sizeof(int64_t);
    }
    
    const void *data_3 = src;
    
    obj->v3 = NULL;
    src += shape_3[0] * sizeof(double);
    
    int64_t shape_4[1] = {0};
    
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 1;
    err |= memcmp(src, " f64", 4) != 0;
    src += 4;
    if (err == 0) {
        memcpy(shape_4, src, 1 * sizeof(int64_t));
        src += 1 * sizeof(int64_t);
    }
    
    const void *data_4 = src;
    
    obj->v4 = NULL;
    src += shape_4[0] * sizeof(double);
    
    int64_t shape_5[1] = {0};
    
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 1;
    err |= memcmp(src, "bool", 4) != 0;
    src += 4;
    if (err == 0) {
        memcpy(shape_5, src, 1 * sizeof(int64_t));
        src += 1 * sizeof(int64_t);
    }
    
    const void *data_5 = src;
    
    obj->v5 = NULL;
    src += shape_5[0] * sizeof(bool);
    
    int64_t shape_6[1] = {0};
    
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 1;
    err |= memcmp(src, "bool", 4) != 0;
    src += 4;
    if (err == 0) {
        memcpy(shape_6, src, 1 * sizeof(int64_t));
        src += 1 * sizeof(int64_t);
    }
    
    const void *data_6 = src;
    
    obj->v6 = NULL;
    src += shape_6[0] * sizeof(bool);
    
    int64_t shape_7[1] = {0};
    
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 1;
    err |= memcmp(src, "bool", 4) != 0;
    src += 4;
    if (err == 0) {
        memcpy(shape_7, src, 1 * sizeof(int64_t));
        src += 1 * sizeof(int64_t);
    }
    
    const void *data_7 = src;
    
    obj->v7 = NULL;
    src += shape_7[0] * sizeof(bool);
    
    int64_t shape_8[1] = {0};
    
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 1;
    err |= memcmp(src, "bool", 4) != 0;
    src += 4;
    if (err == 0) {
        memcpy(shape_8, src, 1 * sizeof(int64_t));
        src += 1 * sizeof(int64_t);
    }
    
    const void *data_8 = src;
    
    obj->v8 = NULL;
    src += shape_8[0] * sizeof(bool);
    
    int64_t shape_9[1] = {0};
    
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 1;
    err |= memcmp(src, " f64", 4) != 0;
    src += 4;
    if (err == 0) {
        memcpy(shape_9, src, 1 * sizeof(int64_t));
        src += 1 * sizeof(int64_t);
    }
    
    const void *data_9 = src;
    
    obj->v9 = NULL;
    src += shape_9[0] * sizeof(double);
    
    int64_t shape_10[1] = {0};
    
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 1;
    err |= memcmp(src, " f64", 4) != 0;
    src += 4;
    if (err == 0) {
        memcpy(shape_10, src, 1 * sizeof(int64_t));
        src += 1 * sizeof(int64_t);
    }
    
    const void *data_10 = src;
    
    obj->v10 = NULL;
    src += shape_10[0] * sizeof(double);
    
    int64_t shape_11[1] = {0};
    
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 1;
    err |= memcmp(src, " i64", 4) != 0;
    src += 4;
    if (err == 0) {
        memcpy(shape_11, src, 1 * sizeof(int64_t));
        src += 1 * sizeof(int64_t);
    }
    
    const void *data_11 = src;
    
    obj->v11 = NULL;
    src += shape_11[0] * sizeof(int64_t);
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 0;
    err |= memcmp(src, " i64", 4) != 0;
    src += 4;
    if (err == 0) {
        src += 0 * sizeof(int64_t);
    }
    
    const void *data_12 = src;
    
    src += sizeof(obj->v12);
    if (err == 0) {
        obj->v0 = futhark_new_i64_1d(ctx, data_0, shape_0[0]);
        if (obj->v0 == NULL)
            err = 1;
        obj->v1 = futhark_new_f64_1d(ctx, data_1, shape_1[0]);
        if (obj->v1 == NULL)
            err = 1;
        obj->v2 = futhark_new_f64_1d(ctx, data_2, shape_2[0]);
        if (obj->v2 == NULL)
            err = 1;
        obj->v3 = futhark_new_f64_1d(ctx, data_3, shape_3[0]);
        if (obj->v3 == NULL)
            err = 1;
        obj->v4 = futhark_new_f64_1d(ctx, data_4, shape_4[0]);
        if (obj->v4 == NULL)
            err = 1;
        obj->v5 = futhark_new_bool_1d(ctx, data_5, shape_5[0]);
        if (obj->v5 == NULL)
            err = 1;
        obj->v6 = futhark_new_bool_1d(ctx, data_6, shape_6[0]);
        if (obj->v6 == NULL)
            err = 1;
        obj->v7 = futhark_new_bool_1d(ctx, data_7, shape_7[0]);
        if (obj->v7 == NULL)
            err = 1;
        obj->v8 = futhark_new_bool_1d(ctx, data_8, shape_8[0]);
        if (obj->v8 == NULL)
            err = 1;
        obj->v9 = futhark_new_f64_1d(ctx, data_9, shape_9[0]);
        if (obj->v9 == NULL)
            err = 1;
        obj->v10 = futhark_new_f64_1d(ctx, data_10, shape_10[0]);
        if (obj->v10 == NULL)
            err = 1;
        obj->v11 = futhark_new_i64_1d(ctx, data_11, shape_11[0]);
        if (obj->v11 == NULL)
            err = 1;
        memcpy(&obj->v12, data_12, sizeof(obj->v12));
    }
    if (err != 0) {
        int ret = 0, tmp;
        
        if (obj->v0 != NULL && (tmp = futhark_free_i64_1d(ctx, obj->v0)) != 0)
            ret = tmp;
        if (obj->v1 != NULL && (tmp = futhark_free_f64_1d(ctx, obj->v1)) != 0)
            ret = tmp;
        if (obj->v2 != NULL && (tmp = futhark_free_f64_1d(ctx, obj->v2)) != 0)
            ret = tmp;
        if (obj->v3 != NULL && (tmp = futhark_free_f64_1d(ctx, obj->v3)) != 0)
            ret = tmp;
        if (obj->v4 != NULL && (tmp = futhark_free_f64_1d(ctx, obj->v4)) != 0)
            ret = tmp;
        if (obj->v5 != NULL && (tmp = futhark_free_bool_1d(ctx, obj->v5)) != 0)
            ret = tmp;
        if (obj->v6 != NULL && (tmp = futhark_free_bool_1d(ctx, obj->v6)) != 0)
            ret = tmp;
        if (obj->v7 != NULL && (tmp = futhark_free_bool_1d(ctx, obj->v7)) != 0)
            ret = tmp;
        if (obj->v8 != NULL && (tmp = futhark_free_bool_1d(ctx, obj->v8)) != 0)
            ret = tmp;
        if (obj->v9 != NULL && (tmp = futhark_free_f64_1d(ctx, obj->v9)) != 0)
            ret = tmp;
        if (obj->v10 != NULL && (tmp = futhark_free_f64_1d(ctx, obj->v10)) != 0)
            ret = tmp;
        if (obj->v11 != NULL && (tmp = futhark_free_i64_1d(ctx, obj->v11)) != 0)
            ret = tmp;
        free(obj);
        obj = NULL;
    }
    return obj;
}
struct futhark_opaque_dbcHandler_double {
    struct futhark_i64_1d *v0;
    struct futhark_i64_1d *v1;
    int8_t v2;
    int8_t v3;
    double v4;
    int64_t v5;
    struct futhark_f64_1d *v6;
    int64_t v7;
    struct futhark_f64_1d *v8;
    struct futhark_i64_1d *v9;
    double v10;
    struct futhark_f64_1d *v11;
    int64_t v12;
    struct futhark_bool_1d *v13;
    struct futhark_i64_1d *v14;
    struct futhark_f64_1d *v15;
    struct futhark_f64_1d *v16;
    int64_t v17;
    int64_t v18;
    int64_t v19;
    struct futhark_bool_1d *v20;
    int64_t v21;
    int64_t v22;
    struct futhark_i64_1d *v23;
    struct futhark_i64_1d *v24;
    struct futhark_f64_1d *v25;
    struct futhark_f64_1d *v26;
    struct futhark_f64_1d *v27;
    struct futhark_f64_1d *v28;
    struct futhark_bool_1d *v29;
    struct futhark_bool_1d *v30;
    struct futhark_bool_1d *v31;
    struct futhark_bool_1d *v32;
    struct futhark_f64_1d *v33;
    struct futhark_f64_1d *v34;
    struct futhark_i64_1d *v35;
    int64_t v36;
    struct futhark_f64_1d *v37;
    struct futhark_f64_1d *v38;
    struct futhark_i64_1d *v39;
};
int futhark_project_opaque_dbcHandler_double_chain_collisions(struct futhark_context *ctx, struct futhark_opaque_arr1d_tup2_i64_i64 **out, const struct futhark_opaque_dbcHandler_double *obj)
{
    (void) ctx;
    
    struct futhark_opaque_arr1d_tup2_i64_i64 *v;
    
    lock_lock(&ctx->lock);
    CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
    v = malloc(sizeof(struct futhark_opaque_arr1d_tup2_i64_i64));
    v->v0 = malloc(sizeof(*v->v0));
    *v->v0 = *obj->v0;
    (void) (*v->v0->mem.references)++;
    v->v1 = malloc(sizeof(*v->v1));
    *v->v1 = *obj->v1;
    (void) (*v->v1->mem.references)++;
    CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
    lock_unlock(&ctx->lock);
    *out = v;
    return 0;
}
int futhark_project_opaque_dbcHandler_double_clBase(struct futhark_context *ctx, struct futhark_opaque_8b7e80c3fb80a9a7700efe8e89371deb **out, const struct futhark_opaque_dbcHandler_double *obj)
{
    (void) ctx;
    
    struct futhark_opaque_8b7e80c3fb80a9a7700efe8e89371deb *v;
    
    lock_lock(&ctx->lock);
    CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
    v = malloc(sizeof(struct futhark_opaque_8b7e80c3fb80a9a7700efe8e89371deb));
    v->v0 = obj->v2;
    v->v1 = obj->v3;
    v->v2 = obj->v4;
    v->v3 = obj->v5;
    v->v4 = malloc(sizeof(*v->v4));
    *v->v4 = *obj->v6;
    (void) (*v->v4->mem.references)++;
    v->v5 = obj->v7;
    v->v6 = malloc(sizeof(*v->v6));
    *v->v6 = *obj->v8;
    (void) (*v->v6->mem.references)++;
    v->v7 = malloc(sizeof(*v->v7));
    *v->v7 = *obj->v9;
    (void) (*v->v7->mem.references)++;
    v->v8 = obj->v10;
    v->v9 = malloc(sizeof(*v->v9));
    *v->v9 = *obj->v11;
    (void) (*v->v9->mem.references)++;
    v->v10 = obj->v12;
    CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
    lock_unlock(&ctx->lock);
    *out = v;
    return 0;
}
int futhark_project_opaque_dbcHandler_double_clProc(struct futhark_context *ctx, struct futhark_opaque_a8fdbed66266f52db9d5a0da8b1f6763 **out, const struct futhark_opaque_dbcHandler_double *obj)
{
    (void) ctx;
    
    struct futhark_opaque_a8fdbed66266f52db9d5a0da8b1f6763 *v;
    
    lock_lock(&ctx->lock);
    CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
    v = malloc(sizeof(struct futhark_opaque_a8fdbed66266f52db9d5a0da8b1f6763));
    v->v0 = malloc(sizeof(*v->v0));
    *v->v0 = *obj->v13;
    (void) (*v->v0->mem.references)++;
    v->v1 = malloc(sizeof(*v->v1));
    *v->v1 = *obj->v14;
    (void) (*v->v1->mem.references)++;
    v->v2 = malloc(sizeof(*v->v2));
    *v->v2 = *obj->v15;
    (void) (*v->v2->mem.references)++;
    v->v3 = malloc(sizeof(*v->v3));
    *v->v3 = *obj->v16;
    (void) (*v->v3->mem.references)++;
    v->v4 = obj->v17;
    v->v5 = obj->v18;
    v->v6 = obj->v19;
    v->v7 = malloc(sizeof(*v->v7));
    *v->v7 = *obj->v20;
    (void) (*v->v7->mem.references)++;
    v->v8 = obj->v21;
    v->v9 = obj->v22;
    v->v10 = malloc(sizeof(*v->v10));
    *v->v10 = *obj->v23;
    (void) (*v->v10->mem.references)++;
    CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
    lock_unlock(&ctx->lock);
    *out = v;
    return 0;
}
int futhark_project_opaque_dbcHandler_double_current_partition(struct futhark_context *ctx, struct futhark_opaque_4dedc823193c594b5c01727ae8ac5943 **out, const struct futhark_opaque_dbcHandler_double *obj)
{
    (void) ctx;
    
    struct futhark_opaque_4dedc823193c594b5c01727ae8ac5943 *v;
    
    lock_lock(&ctx->lock);
    CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
    v = malloc(sizeof(struct futhark_opaque_4dedc823193c594b5c01727ae8ac5943));
    v->v0 = malloc(sizeof(*v->v0));
    *v->v0 = *obj->v24;
    (void) (*v->v0->mem.references)++;
    v->v1 = malloc(sizeof(*v->v1));
    *v->v1 = *obj->v25;
    (void) (*v->v1->mem.references)++;
    v->v2 = malloc(sizeof(*v->v2));
    *v->v2 = *obj->v26;
    (void) (*v->v2->mem.references)++;
    v->v3 = malloc(sizeof(*v->v3));
    *v->v3 = *obj->v27;
    (void) (*v->v3->mem.references)++;
    v->v4 = malloc(sizeof(*v->v4));
    *v->v4 = *obj->v28;
    (void) (*v->v4->mem.references)++;
    v->v5 = malloc(sizeof(*v->v5));
    *v->v5 = *obj->v29;
    (void) (*v->v5->mem.references)++;
    v->v6 = malloc(sizeof(*v->v6));
    *v->v6 = *obj->v30;
    (void) (*v->v6->mem.references)++;
    v->v7 = malloc(sizeof(*v->v7));
    *v->v7 = *obj->v31;
    (void) (*v->v7->mem.references)++;
    v->v8 = malloc(sizeof(*v->v8));
    *v->v8 = *obj->v32;
    (void) (*v->v8->mem.references)++;
    v->v9 = malloc(sizeof(*v->v9));
    *v->v9 = *obj->v33;
    (void) (*v->v9->mem.references)++;
    v->v10 = malloc(sizeof(*v->v10));
    *v->v10 = *obj->v34;
    (void) (*v->v10->mem.references)++;
    v->v11 = malloc(sizeof(*v->v11));
    *v->v11 = *obj->v35;
    (void) (*v->v11->mem.references)++;
    v->v12 = obj->v36;
    CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
    lock_unlock(&ctx->lock);
    *out = v;
    return 0;
}
int futhark_project_opaque_dbcHandler_double_toFlush_dat(struct futhark_context *ctx, struct futhark_opaque_arr1d_tup2_f64_f64 **out, const struct futhark_opaque_dbcHandler_double *obj)
{
    (void) ctx;
    
    struct futhark_opaque_arr1d_tup2_f64_f64 *v;
    
    lock_lock(&ctx->lock);
    CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
    v = malloc(sizeof(struct futhark_opaque_arr1d_tup2_f64_f64));
    v->v0 = malloc(sizeof(*v->v0));
    *v->v0 = *obj->v37;
    (void) (*v->v0->mem.references)++;
    v->v1 = malloc(sizeof(*v->v1));
    *v->v1 = *obj->v38;
    (void) (*v->v1->mem.references)++;
    CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
    lock_unlock(&ctx->lock);
    *out = v;
    return 0;
}
int futhark_project_opaque_dbcHandler_double_toFlush_ids(struct futhark_context *ctx, struct futhark_i64_1d **out, const struct futhark_opaque_dbcHandler_double *obj)
{
    (void) ctx;
    
    struct futhark_i64_1d *v;
    
    lock_lock(&ctx->lock);
    CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
    v = malloc(sizeof(struct futhark_i64_1d));
    memcpy(v, obj->v39, sizeof(struct futhark_i64_1d));
    (void) (*v->mem.references)++;
    CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
    lock_unlock(&ctx->lock);
    *out = v;
    return 0;
}
int futhark_new_opaque_dbcHandler_double(struct futhark_context *ctx, struct futhark_opaque_dbcHandler_double **out, const struct futhark_opaque_arr1d_tup2_i64_i64 *f_chain_collisions, const struct futhark_opaque_8b7e80c3fb80a9a7700efe8e89371deb *f_clBase, const struct futhark_opaque_a8fdbed66266f52db9d5a0da8b1f6763 *f_clProc, const struct futhark_opaque_4dedc823193c594b5c01727ae8ac5943 *f_current_partition, const struct futhark_opaque_arr1d_tup2_f64_f64 *f_toFlush_dat, const struct futhark_i64_1d *f_toFlush_ids)
{
    struct futhark_opaque_dbcHandler_double *v = malloc(sizeof(struct futhark_opaque_dbcHandler_double));
    
    lock_lock(&ctx->lock);
    CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
    {
        {
            v->v0 = malloc(sizeof(*f_chain_collisions->v0));
            *v->v0 = *f_chain_collisions->v0;
            (void) (*v->v0->mem.references)++;
        }
        {
            v->v1 = malloc(sizeof(*f_chain_collisions->v1));
            *v->v1 = *f_chain_collisions->v1;
            (void) (*v->v1->mem.references)++;
        }
    }
    {
        v->v2 = f_clBase->v0;
        v->v3 = f_clBase->v1;
        v->v4 = f_clBase->v2;
        v->v5 = f_clBase->v3;
        {
            v->v6 = malloc(sizeof(*f_clBase->v4));
            *v->v6 = *f_clBase->v4;
            (void) (*v->v6->mem.references)++;
        }
        v->v7 = f_clBase->v5;
        {
            v->v8 = malloc(sizeof(*f_clBase->v6));
            *v->v8 = *f_clBase->v6;
            (void) (*v->v8->mem.references)++;
        }
        {
            v->v9 = malloc(sizeof(*f_clBase->v7));
            *v->v9 = *f_clBase->v7;
            (void) (*v->v9->mem.references)++;
        }
        v->v10 = f_clBase->v8;
        {
            v->v11 = malloc(sizeof(*f_clBase->v9));
            *v->v11 = *f_clBase->v9;
            (void) (*v->v11->mem.references)++;
        }
        v->v12 = f_clBase->v10;
    }
    {
        {
            v->v13 = malloc(sizeof(*f_clProc->v0));
            *v->v13 = *f_clProc->v0;
            (void) (*v->v13->mem.references)++;
        }
        {
            v->v14 = malloc(sizeof(*f_clProc->v1));
            *v->v14 = *f_clProc->v1;
            (void) (*v->v14->mem.references)++;
        }
        {
            v->v15 = malloc(sizeof(*f_clProc->v2));
            *v->v15 = *f_clProc->v2;
            (void) (*v->v15->mem.references)++;
        }
        {
            v->v16 = malloc(sizeof(*f_clProc->v3));
            *v->v16 = *f_clProc->v3;
            (void) (*v->v16->mem.references)++;
        }
        v->v17 = f_clProc->v4;
        v->v18 = f_clProc->v5;
        v->v19 = f_clProc->v6;
        {
            v->v20 = malloc(sizeof(*f_clProc->v7));
            *v->v20 = *f_clProc->v7;
            (void) (*v->v20->mem.references)++;
        }
        v->v21 = f_clProc->v8;
        v->v22 = f_clProc->v9;
        {
            v->v23 = malloc(sizeof(*f_clProc->v10));
            *v->v23 = *f_clProc->v10;
            (void) (*v->v23->mem.references)++;
        }
    }
    {
        {
            v->v24 = malloc(sizeof(*f_current_partition->v0));
            *v->v24 = *f_current_partition->v0;
            (void) (*v->v24->mem.references)++;
        }
        {
            v->v25 = malloc(sizeof(*f_current_partition->v1));
            *v->v25 = *f_current_partition->v1;
            (void) (*v->v25->mem.references)++;
        }
        {
            v->v26 = malloc(sizeof(*f_current_partition->v2));
            *v->v26 = *f_current_partition->v2;
            (void) (*v->v26->mem.references)++;
        }
        {
            v->v27 = malloc(sizeof(*f_current_partition->v3));
            *v->v27 = *f_current_partition->v3;
            (void) (*v->v27->mem.references)++;
        }
        {
            v->v28 = malloc(sizeof(*f_current_partition->v4));
            *v->v28 = *f_current_partition->v4;
            (void) (*v->v28->mem.references)++;
        }
        {
            v->v29 = malloc(sizeof(*f_current_partition->v5));
            *v->v29 = *f_current_partition->v5;
            (void) (*v->v29->mem.references)++;
        }
        {
            v->v30 = malloc(sizeof(*f_current_partition->v6));
            *v->v30 = *f_current_partition->v6;
            (void) (*v->v30->mem.references)++;
        }
        {
            v->v31 = malloc(sizeof(*f_current_partition->v7));
            *v->v31 = *f_current_partition->v7;
            (void) (*v->v31->mem.references)++;
        }
        {
            v->v32 = malloc(sizeof(*f_current_partition->v8));
            *v->v32 = *f_current_partition->v8;
            (void) (*v->v32->mem.references)++;
        }
        {
            v->v33 = malloc(sizeof(*f_current_partition->v9));
            *v->v33 = *f_current_partition->v9;
            (void) (*v->v33->mem.references)++;
        }
        {
            v->v34 = malloc(sizeof(*f_current_partition->v10));
            *v->v34 = *f_current_partition->v10;
            (void) (*v->v34->mem.references)++;
        }
        {
            v->v35 = malloc(sizeof(*f_current_partition->v11));
            *v->v35 = *f_current_partition->v11;
            (void) (*v->v35->mem.references)++;
        }
        v->v36 = f_current_partition->v12;
    }
    {
        {
            v->v37 = malloc(sizeof(*f_toFlush_dat->v0));
            *v->v37 = *f_toFlush_dat->v0;
            (void) (*v->v37->mem.references)++;
        }
        {
            v->v38 = malloc(sizeof(*f_toFlush_dat->v1));
            *v->v38 = *f_toFlush_dat->v1;
            (void) (*v->v38->mem.references)++;
        }
    }
    {
        v->v39 = malloc(sizeof(struct futhark_i64_1d));
        *v->v39 = *f_toFlush_ids;
        (void) (*v->v39->mem.references)++;
    }
    CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
    lock_unlock(&ctx->lock);
    *out = v;
    return FUTHARK_SUCCESS;
}
int futhark_free_opaque_dbcHandler_double(struct futhark_context *ctx, struct futhark_opaque_dbcHandler_double *obj)
{
    (void) ctx;
    
    int ret = 0, tmp;
    
    if (obj->v0 != NULL && (tmp = futhark_free_i64_1d(ctx, obj->v0)) != 0)
        ret = tmp;
    if (obj->v1 != NULL && (tmp = futhark_free_i64_1d(ctx, obj->v1)) != 0)
        ret = tmp;
    if (obj->v6 != NULL && (tmp = futhark_free_f64_1d(ctx, obj->v6)) != 0)
        ret = tmp;
    if (obj->v8 != NULL && (tmp = futhark_free_f64_1d(ctx, obj->v8)) != 0)
        ret = tmp;
    if (obj->v9 != NULL && (tmp = futhark_free_i64_1d(ctx, obj->v9)) != 0)
        ret = tmp;
    if (obj->v11 != NULL && (tmp = futhark_free_f64_1d(ctx, obj->v11)) != 0)
        ret = tmp;
    if (obj->v13 != NULL && (tmp = futhark_free_bool_1d(ctx, obj->v13)) != 0)
        ret = tmp;
    if (obj->v14 != NULL && (tmp = futhark_free_i64_1d(ctx, obj->v14)) != 0)
        ret = tmp;
    if (obj->v15 != NULL && (tmp = futhark_free_f64_1d(ctx, obj->v15)) != 0)
        ret = tmp;
    if (obj->v16 != NULL && (tmp = futhark_free_f64_1d(ctx, obj->v16)) != 0)
        ret = tmp;
    if (obj->v20 != NULL && (tmp = futhark_free_bool_1d(ctx, obj->v20)) != 0)
        ret = tmp;
    if (obj->v23 != NULL && (tmp = futhark_free_i64_1d(ctx, obj->v23)) != 0)
        ret = tmp;
    if (obj->v24 != NULL && (tmp = futhark_free_i64_1d(ctx, obj->v24)) != 0)
        ret = tmp;
    if (obj->v25 != NULL && (tmp = futhark_free_f64_1d(ctx, obj->v25)) != 0)
        ret = tmp;
    if (obj->v26 != NULL && (tmp = futhark_free_f64_1d(ctx, obj->v26)) != 0)
        ret = tmp;
    if (obj->v27 != NULL && (tmp = futhark_free_f64_1d(ctx, obj->v27)) != 0)
        ret = tmp;
    if (obj->v28 != NULL && (tmp = futhark_free_f64_1d(ctx, obj->v28)) != 0)
        ret = tmp;
    if (obj->v29 != NULL && (tmp = futhark_free_bool_1d(ctx, obj->v29)) != 0)
        ret = tmp;
    if (obj->v30 != NULL && (tmp = futhark_free_bool_1d(ctx, obj->v30)) != 0)
        ret = tmp;
    if (obj->v31 != NULL && (tmp = futhark_free_bool_1d(ctx, obj->v31)) != 0)
        ret = tmp;
    if (obj->v32 != NULL && (tmp = futhark_free_bool_1d(ctx, obj->v32)) != 0)
        ret = tmp;
    if (obj->v33 != NULL && (tmp = futhark_free_f64_1d(ctx, obj->v33)) != 0)
        ret = tmp;
    if (obj->v34 != NULL && (tmp = futhark_free_f64_1d(ctx, obj->v34)) != 0)
        ret = tmp;
    if (obj->v35 != NULL && (tmp = futhark_free_i64_1d(ctx, obj->v35)) != 0)
        ret = tmp;
    if (obj->v37 != NULL && (tmp = futhark_free_f64_1d(ctx, obj->v37)) != 0)
        ret = tmp;
    if (obj->v38 != NULL && (tmp = futhark_free_f64_1d(ctx, obj->v38)) != 0)
        ret = tmp;
    if (obj->v39 != NULL && (tmp = futhark_free_i64_1d(ctx, obj->v39)) != 0)
        ret = tmp;
    free(obj);
    return ret;
}
int futhark_store_opaque_dbcHandler_double(struct futhark_context *ctx, const struct futhark_opaque_dbcHandler_double *obj, void **p, size_t *n)
{
    (void) ctx;
    
    int ret = 0;
    int64_t size_0 = 7 + 1 * sizeof(int64_t) + futhark_shape_i64_1d(ctx, obj->v0)[0] * sizeof(int64_t);
    int64_t size_1 = 7 + 1 * sizeof(int64_t) + futhark_shape_i64_1d(ctx, obj->v1)[0] * sizeof(int64_t);
    int64_t size_2 = 7 + 0 * sizeof(int64_t) + 1 * sizeof(int8_t);
    int64_t size_3 = 7 + 0 * sizeof(int64_t) + 1 * sizeof(int8_t);
    int64_t size_4 = 7 + 0 * sizeof(int64_t) + 1 * sizeof(double);
    int64_t size_5 = 7 + 0 * sizeof(int64_t) + 1 * sizeof(int64_t);
    int64_t size_6 = 7 + 1 * sizeof(int64_t) + futhark_shape_f64_1d(ctx, obj->v6)[0] * sizeof(double);
    int64_t size_7 = 7 + 0 * sizeof(int64_t) + 1 * sizeof(int64_t);
    int64_t size_8 = 7 + 1 * sizeof(int64_t) + futhark_shape_f64_1d(ctx, obj->v8)[0] * sizeof(double);
    int64_t size_9 = 7 + 1 * sizeof(int64_t) + futhark_shape_i64_1d(ctx, obj->v9)[0] * sizeof(int64_t);
    int64_t size_10 = 7 + 0 * sizeof(int64_t) + 1 * sizeof(double);
    int64_t size_11 = 7 + 1 * sizeof(int64_t) + futhark_shape_f64_1d(ctx, obj->v11)[0] * sizeof(double);
    int64_t size_12 = 7 + 0 * sizeof(int64_t) + 1 * sizeof(int64_t);
    int64_t size_13 = 7 + 1 * sizeof(int64_t) + futhark_shape_bool_1d(ctx, obj->v13)[0] * sizeof(bool);
    int64_t size_14 = 7 + 1 * sizeof(int64_t) + futhark_shape_i64_1d(ctx, obj->v14)[0] * sizeof(int64_t);
    int64_t size_15 = 7 + 1 * sizeof(int64_t) + futhark_shape_f64_1d(ctx, obj->v15)[0] * sizeof(double);
    int64_t size_16 = 7 + 1 * sizeof(int64_t) + futhark_shape_f64_1d(ctx, obj->v16)[0] * sizeof(double);
    int64_t size_17 = 7 + 0 * sizeof(int64_t) + 1 * sizeof(int64_t);
    int64_t size_18 = 7 + 0 * sizeof(int64_t) + 1 * sizeof(int64_t);
    int64_t size_19 = 7 + 0 * sizeof(int64_t) + 1 * sizeof(int64_t);
    int64_t size_20 = 7 + 1 * sizeof(int64_t) + futhark_shape_bool_1d(ctx, obj->v20)[0] * sizeof(bool);
    int64_t size_21 = 7 + 0 * sizeof(int64_t) + 1 * sizeof(int64_t);
    int64_t size_22 = 7 + 0 * sizeof(int64_t) + 1 * sizeof(int64_t);
    int64_t size_23 = 7 + 1 * sizeof(int64_t) + futhark_shape_i64_1d(ctx, obj->v23)[0] * sizeof(int64_t);
    int64_t size_24 = 7 + 1 * sizeof(int64_t) + futhark_shape_i64_1d(ctx, obj->v24)[0] * sizeof(int64_t);
    int64_t size_25 = 7 + 1 * sizeof(int64_t) + futhark_shape_f64_1d(ctx, obj->v25)[0] * sizeof(double);
    int64_t size_26 = 7 + 1 * sizeof(int64_t) + futhark_shape_f64_1d(ctx, obj->v26)[0] * sizeof(double);
    int64_t size_27 = 7 + 1 * sizeof(int64_t) + futhark_shape_f64_1d(ctx, obj->v27)[0] * sizeof(double);
    int64_t size_28 = 7 + 1 * sizeof(int64_t) + futhark_shape_f64_1d(ctx, obj->v28)[0] * sizeof(double);
    int64_t size_29 = 7 + 1 * sizeof(int64_t) + futhark_shape_bool_1d(ctx, obj->v29)[0] * sizeof(bool);
    int64_t size_30 = 7 + 1 * sizeof(int64_t) + futhark_shape_bool_1d(ctx, obj->v30)[0] * sizeof(bool);
    int64_t size_31 = 7 + 1 * sizeof(int64_t) + futhark_shape_bool_1d(ctx, obj->v31)[0] * sizeof(bool);
    int64_t size_32 = 7 + 1 * sizeof(int64_t) + futhark_shape_bool_1d(ctx, obj->v32)[0] * sizeof(bool);
    int64_t size_33 = 7 + 1 * sizeof(int64_t) + futhark_shape_f64_1d(ctx, obj->v33)[0] * sizeof(double);
    int64_t size_34 = 7 + 1 * sizeof(int64_t) + futhark_shape_f64_1d(ctx, obj->v34)[0] * sizeof(double);
    int64_t size_35 = 7 + 1 * sizeof(int64_t) + futhark_shape_i64_1d(ctx, obj->v35)[0] * sizeof(int64_t);
    int64_t size_36 = 7 + 0 * sizeof(int64_t) + 1 * sizeof(int64_t);
    int64_t size_37 = 7 + 1 * sizeof(int64_t) + futhark_shape_f64_1d(ctx, obj->v37)[0] * sizeof(double);
    int64_t size_38 = 7 + 1 * sizeof(int64_t) + futhark_shape_f64_1d(ctx, obj->v38)[0] * sizeof(double);
    int64_t size_39 = 7 + 1 * sizeof(int64_t) + futhark_shape_i64_1d(ctx, obj->v39)[0] * sizeof(int64_t);
    
    *n = size_0 + size_1 + size_2 + size_3 + size_4 + size_5 + size_6 + size_7 + size_8 + size_9 + size_10 + size_11 + size_12 + size_13 + size_14 + size_15 + size_16 + size_17 + size_18 + size_19 + size_20 + size_21 + size_22 + size_23 + size_24 + size_25 + size_26 + size_27 + size_28 + size_29 + size_30 + size_31 + size_32 + size_33 + size_34 + size_35 + size_36 + size_37 + size_38 + size_39;
    if (p != NULL && *p == NULL)
        *p = malloc(*n);
    if (p != NULL) {
        unsigned char *out = *p;
        
        *out++ = 'b';
        *out++ = 2;
        *out++ = 1;
        memcpy(out, " i64", 4);
        out += 4;
        memcpy(out, futhark_shape_i64_1d(ctx, obj->v0), 1 * sizeof(int64_t));
        out += 1 * sizeof(int64_t);
        ret |= futhark_values_i64_1d(ctx, obj->v0, (void *) out);
        out += futhark_shape_i64_1d(ctx, obj->v0)[0] * sizeof(int64_t);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 1;
        memcpy(out, " i64", 4);
        out += 4;
        memcpy(out, futhark_shape_i64_1d(ctx, obj->v1), 1 * sizeof(int64_t));
        out += 1 * sizeof(int64_t);
        ret |= futhark_values_i64_1d(ctx, obj->v1, (void *) out);
        out += futhark_shape_i64_1d(ctx, obj->v1)[0] * sizeof(int64_t);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 0;
        memcpy(out, "  i8", 4);
        out += 4;
        memcpy(out, &obj->v2, sizeof(obj->v2));
        out += sizeof(obj->v2);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 0;
        memcpy(out, "  i8", 4);
        out += 4;
        memcpy(out, &obj->v3, sizeof(obj->v3));
        out += sizeof(obj->v3);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 0;
        memcpy(out, " f64", 4);
        out += 4;
        memcpy(out, &obj->v4, sizeof(obj->v4));
        out += sizeof(obj->v4);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 0;
        memcpy(out, " i64", 4);
        out += 4;
        memcpy(out, &obj->v5, sizeof(obj->v5));
        out += sizeof(obj->v5);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 1;
        memcpy(out, " f64", 4);
        out += 4;
        memcpy(out, futhark_shape_f64_1d(ctx, obj->v6), 1 * sizeof(int64_t));
        out += 1 * sizeof(int64_t);
        ret |= futhark_values_f64_1d(ctx, obj->v6, (void *) out);
        out += futhark_shape_f64_1d(ctx, obj->v6)[0] * sizeof(double);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 0;
        memcpy(out, " i64", 4);
        out += 4;
        memcpy(out, &obj->v7, sizeof(obj->v7));
        out += sizeof(obj->v7);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 1;
        memcpy(out, " f64", 4);
        out += 4;
        memcpy(out, futhark_shape_f64_1d(ctx, obj->v8), 1 * sizeof(int64_t));
        out += 1 * sizeof(int64_t);
        ret |= futhark_values_f64_1d(ctx, obj->v8, (void *) out);
        out += futhark_shape_f64_1d(ctx, obj->v8)[0] * sizeof(double);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 1;
        memcpy(out, " i64", 4);
        out += 4;
        memcpy(out, futhark_shape_i64_1d(ctx, obj->v9), 1 * sizeof(int64_t));
        out += 1 * sizeof(int64_t);
        ret |= futhark_values_i64_1d(ctx, obj->v9, (void *) out);
        out += futhark_shape_i64_1d(ctx, obj->v9)[0] * sizeof(int64_t);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 0;
        memcpy(out, " f64", 4);
        out += 4;
        memcpy(out, &obj->v10, sizeof(obj->v10));
        out += sizeof(obj->v10);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 1;
        memcpy(out, " f64", 4);
        out += 4;
        memcpy(out, futhark_shape_f64_1d(ctx, obj->v11), 1 * sizeof(int64_t));
        out += 1 * sizeof(int64_t);
        ret |= futhark_values_f64_1d(ctx, obj->v11, (void *) out);
        out += futhark_shape_f64_1d(ctx, obj->v11)[0] * sizeof(double);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 0;
        memcpy(out, " i64", 4);
        out += 4;
        memcpy(out, &obj->v12, sizeof(obj->v12));
        out += sizeof(obj->v12);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 1;
        memcpy(out, "bool", 4);
        out += 4;
        memcpy(out, futhark_shape_bool_1d(ctx, obj->v13), 1 * sizeof(int64_t));
        out += 1 * sizeof(int64_t);
        ret |= futhark_values_bool_1d(ctx, obj->v13, (void *) out);
        out += futhark_shape_bool_1d(ctx, obj->v13)[0] * sizeof(bool);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 1;
        memcpy(out, " i64", 4);
        out += 4;
        memcpy(out, futhark_shape_i64_1d(ctx, obj->v14), 1 * sizeof(int64_t));
        out += 1 * sizeof(int64_t);
        ret |= futhark_values_i64_1d(ctx, obj->v14, (void *) out);
        out += futhark_shape_i64_1d(ctx, obj->v14)[0] * sizeof(int64_t);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 1;
        memcpy(out, " f64", 4);
        out += 4;
        memcpy(out, futhark_shape_f64_1d(ctx, obj->v15), 1 * sizeof(int64_t));
        out += 1 * sizeof(int64_t);
        ret |= futhark_values_f64_1d(ctx, obj->v15, (void *) out);
        out += futhark_shape_f64_1d(ctx, obj->v15)[0] * sizeof(double);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 1;
        memcpy(out, " f64", 4);
        out += 4;
        memcpy(out, futhark_shape_f64_1d(ctx, obj->v16), 1 * sizeof(int64_t));
        out += 1 * sizeof(int64_t);
        ret |= futhark_values_f64_1d(ctx, obj->v16, (void *) out);
        out += futhark_shape_f64_1d(ctx, obj->v16)[0] * sizeof(double);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 0;
        memcpy(out, " i64", 4);
        out += 4;
        memcpy(out, &obj->v17, sizeof(obj->v17));
        out += sizeof(obj->v17);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 0;
        memcpy(out, " i64", 4);
        out += 4;
        memcpy(out, &obj->v18, sizeof(obj->v18));
        out += sizeof(obj->v18);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 0;
        memcpy(out, " i64", 4);
        out += 4;
        memcpy(out, &obj->v19, sizeof(obj->v19));
        out += sizeof(obj->v19);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 1;
        memcpy(out, "bool", 4);
        out += 4;
        memcpy(out, futhark_shape_bool_1d(ctx, obj->v20), 1 * sizeof(int64_t));
        out += 1 * sizeof(int64_t);
        ret |= futhark_values_bool_1d(ctx, obj->v20, (void *) out);
        out += futhark_shape_bool_1d(ctx, obj->v20)[0] * sizeof(bool);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 0;
        memcpy(out, " i64", 4);
        out += 4;
        memcpy(out, &obj->v21, sizeof(obj->v21));
        out += sizeof(obj->v21);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 0;
        memcpy(out, " i64", 4);
        out += 4;
        memcpy(out, &obj->v22, sizeof(obj->v22));
        out += sizeof(obj->v22);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 1;
        memcpy(out, " i64", 4);
        out += 4;
        memcpy(out, futhark_shape_i64_1d(ctx, obj->v23), 1 * sizeof(int64_t));
        out += 1 * sizeof(int64_t);
        ret |= futhark_values_i64_1d(ctx, obj->v23, (void *) out);
        out += futhark_shape_i64_1d(ctx, obj->v23)[0] * sizeof(int64_t);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 1;
        memcpy(out, " i64", 4);
        out += 4;
        memcpy(out, futhark_shape_i64_1d(ctx, obj->v24), 1 * sizeof(int64_t));
        out += 1 * sizeof(int64_t);
        ret |= futhark_values_i64_1d(ctx, obj->v24, (void *) out);
        out += futhark_shape_i64_1d(ctx, obj->v24)[0] * sizeof(int64_t);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 1;
        memcpy(out, " f64", 4);
        out += 4;
        memcpy(out, futhark_shape_f64_1d(ctx, obj->v25), 1 * sizeof(int64_t));
        out += 1 * sizeof(int64_t);
        ret |= futhark_values_f64_1d(ctx, obj->v25, (void *) out);
        out += futhark_shape_f64_1d(ctx, obj->v25)[0] * sizeof(double);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 1;
        memcpy(out, " f64", 4);
        out += 4;
        memcpy(out, futhark_shape_f64_1d(ctx, obj->v26), 1 * sizeof(int64_t));
        out += 1 * sizeof(int64_t);
        ret |= futhark_values_f64_1d(ctx, obj->v26, (void *) out);
        out += futhark_shape_f64_1d(ctx, obj->v26)[0] * sizeof(double);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 1;
        memcpy(out, " f64", 4);
        out += 4;
        memcpy(out, futhark_shape_f64_1d(ctx, obj->v27), 1 * sizeof(int64_t));
        out += 1 * sizeof(int64_t);
        ret |= futhark_values_f64_1d(ctx, obj->v27, (void *) out);
        out += futhark_shape_f64_1d(ctx, obj->v27)[0] * sizeof(double);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 1;
        memcpy(out, " f64", 4);
        out += 4;
        memcpy(out, futhark_shape_f64_1d(ctx, obj->v28), 1 * sizeof(int64_t));
        out += 1 * sizeof(int64_t);
        ret |= futhark_values_f64_1d(ctx, obj->v28, (void *) out);
        out += futhark_shape_f64_1d(ctx, obj->v28)[0] * sizeof(double);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 1;
        memcpy(out, "bool", 4);
        out += 4;
        memcpy(out, futhark_shape_bool_1d(ctx, obj->v29), 1 * sizeof(int64_t));
        out += 1 * sizeof(int64_t);
        ret |= futhark_values_bool_1d(ctx, obj->v29, (void *) out);
        out += futhark_shape_bool_1d(ctx, obj->v29)[0] * sizeof(bool);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 1;
        memcpy(out, "bool", 4);
        out += 4;
        memcpy(out, futhark_shape_bool_1d(ctx, obj->v30), 1 * sizeof(int64_t));
        out += 1 * sizeof(int64_t);
        ret |= futhark_values_bool_1d(ctx, obj->v30, (void *) out);
        out += futhark_shape_bool_1d(ctx, obj->v30)[0] * sizeof(bool);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 1;
        memcpy(out, "bool", 4);
        out += 4;
        memcpy(out, futhark_shape_bool_1d(ctx, obj->v31), 1 * sizeof(int64_t));
        out += 1 * sizeof(int64_t);
        ret |= futhark_values_bool_1d(ctx, obj->v31, (void *) out);
        out += futhark_shape_bool_1d(ctx, obj->v31)[0] * sizeof(bool);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 1;
        memcpy(out, "bool", 4);
        out += 4;
        memcpy(out, futhark_shape_bool_1d(ctx, obj->v32), 1 * sizeof(int64_t));
        out += 1 * sizeof(int64_t);
        ret |= futhark_values_bool_1d(ctx, obj->v32, (void *) out);
        out += futhark_shape_bool_1d(ctx, obj->v32)[0] * sizeof(bool);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 1;
        memcpy(out, " f64", 4);
        out += 4;
        memcpy(out, futhark_shape_f64_1d(ctx, obj->v33), 1 * sizeof(int64_t));
        out += 1 * sizeof(int64_t);
        ret |= futhark_values_f64_1d(ctx, obj->v33, (void *) out);
        out += futhark_shape_f64_1d(ctx, obj->v33)[0] * sizeof(double);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 1;
        memcpy(out, " f64", 4);
        out += 4;
        memcpy(out, futhark_shape_f64_1d(ctx, obj->v34), 1 * sizeof(int64_t));
        out += 1 * sizeof(int64_t);
        ret |= futhark_values_f64_1d(ctx, obj->v34, (void *) out);
        out += futhark_shape_f64_1d(ctx, obj->v34)[0] * sizeof(double);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 1;
        memcpy(out, " i64", 4);
        out += 4;
        memcpy(out, futhark_shape_i64_1d(ctx, obj->v35), 1 * sizeof(int64_t));
        out += 1 * sizeof(int64_t);
        ret |= futhark_values_i64_1d(ctx, obj->v35, (void *) out);
        out += futhark_shape_i64_1d(ctx, obj->v35)[0] * sizeof(int64_t);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 0;
        memcpy(out, " i64", 4);
        out += 4;
        memcpy(out, &obj->v36, sizeof(obj->v36));
        out += sizeof(obj->v36);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 1;
        memcpy(out, " f64", 4);
        out += 4;
        memcpy(out, futhark_shape_f64_1d(ctx, obj->v37), 1 * sizeof(int64_t));
        out += 1 * sizeof(int64_t);
        ret |= futhark_values_f64_1d(ctx, obj->v37, (void *) out);
        out += futhark_shape_f64_1d(ctx, obj->v37)[0] * sizeof(double);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 1;
        memcpy(out, " f64", 4);
        out += 4;
        memcpy(out, futhark_shape_f64_1d(ctx, obj->v38), 1 * sizeof(int64_t));
        out += 1 * sizeof(int64_t);
        ret |= futhark_values_f64_1d(ctx, obj->v38, (void *) out);
        out += futhark_shape_f64_1d(ctx, obj->v38)[0] * sizeof(double);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 1;
        memcpy(out, " i64", 4);
        out += 4;
        memcpy(out, futhark_shape_i64_1d(ctx, obj->v39), 1 * sizeof(int64_t));
        out += 1 * sizeof(int64_t);
        ret |= futhark_values_i64_1d(ctx, obj->v39, (void *) out);
        out += futhark_shape_i64_1d(ctx, obj->v39)[0] * sizeof(int64_t);
    }
    return ret;
}
struct futhark_opaque_dbcHandler_double *futhark_restore_opaque_dbcHandler_double(struct futhark_context *ctx, const void *p)
{
    (void) ctx;
    
    int err = 0;
    const unsigned char *src = p;
    struct futhark_opaque_dbcHandler_double *obj = malloc(sizeof(struct futhark_opaque_dbcHandler_double));
    int64_t shape_0[1] = {0};
    
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 1;
    err |= memcmp(src, " i64", 4) != 0;
    src += 4;
    if (err == 0) {
        memcpy(shape_0, src, 1 * sizeof(int64_t));
        src += 1 * sizeof(int64_t);
    }
    
    const void *data_0 = src;
    
    obj->v0 = NULL;
    src += shape_0[0] * sizeof(int64_t);
    
    int64_t shape_1[1] = {0};
    
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 1;
    err |= memcmp(src, " i64", 4) != 0;
    src += 4;
    if (err == 0) {
        memcpy(shape_1, src, 1 * sizeof(int64_t));
        src += 1 * sizeof(int64_t);
    }
    
    const void *data_1 = src;
    
    obj->v1 = NULL;
    src += shape_1[0] * sizeof(int64_t);
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 0;
    err |= memcmp(src, "  i8", 4) != 0;
    src += 4;
    if (err == 0) {
        src += 0 * sizeof(int64_t);
    }
    
    const void *data_2 = src;
    
    src += sizeof(obj->v2);
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 0;
    err |= memcmp(src, "  i8", 4) != 0;
    src += 4;
    if (err == 0) {
        src += 0 * sizeof(int64_t);
    }
    
    const void *data_3 = src;
    
    src += sizeof(obj->v3);
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 0;
    err |= memcmp(src, " f64", 4) != 0;
    src += 4;
    if (err == 0) {
        src += 0 * sizeof(int64_t);
    }
    
    const void *data_4 = src;
    
    src += sizeof(obj->v4);
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 0;
    err |= memcmp(src, " i64", 4) != 0;
    src += 4;
    if (err == 0) {
        src += 0 * sizeof(int64_t);
    }
    
    const void *data_5 = src;
    
    src += sizeof(obj->v5);
    
    int64_t shape_6[1] = {0};
    
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 1;
    err |= memcmp(src, " f64", 4) != 0;
    src += 4;
    if (err == 0) {
        memcpy(shape_6, src, 1 * sizeof(int64_t));
        src += 1 * sizeof(int64_t);
    }
    
    const void *data_6 = src;
    
    obj->v6 = NULL;
    src += shape_6[0] * sizeof(double);
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 0;
    err |= memcmp(src, " i64", 4) != 0;
    src += 4;
    if (err == 0) {
        src += 0 * sizeof(int64_t);
    }
    
    const void *data_7 = src;
    
    src += sizeof(obj->v7);
    
    int64_t shape_8[1] = {0};
    
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 1;
    err |= memcmp(src, " f64", 4) != 0;
    src += 4;
    if (err == 0) {
        memcpy(shape_8, src, 1 * sizeof(int64_t));
        src += 1 * sizeof(int64_t);
    }
    
    const void *data_8 = src;
    
    obj->v8 = NULL;
    src += shape_8[0] * sizeof(double);
    
    int64_t shape_9[1] = {0};
    
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 1;
    err |= memcmp(src, " i64", 4) != 0;
    src += 4;
    if (err == 0) {
        memcpy(shape_9, src, 1 * sizeof(int64_t));
        src += 1 * sizeof(int64_t);
    }
    
    const void *data_9 = src;
    
    obj->v9 = NULL;
    src += shape_9[0] * sizeof(int64_t);
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 0;
    err |= memcmp(src, " f64", 4) != 0;
    src += 4;
    if (err == 0) {
        src += 0 * sizeof(int64_t);
    }
    
    const void *data_10 = src;
    
    src += sizeof(obj->v10);
    
    int64_t shape_11[1] = {0};
    
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 1;
    err |= memcmp(src, " f64", 4) != 0;
    src += 4;
    if (err == 0) {
        memcpy(shape_11, src, 1 * sizeof(int64_t));
        src += 1 * sizeof(int64_t);
    }
    
    const void *data_11 = src;
    
    obj->v11 = NULL;
    src += shape_11[0] * sizeof(double);
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 0;
    err |= memcmp(src, " i64", 4) != 0;
    src += 4;
    if (err == 0) {
        src += 0 * sizeof(int64_t);
    }
    
    const void *data_12 = src;
    
    src += sizeof(obj->v12);
    
    int64_t shape_13[1] = {0};
    
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 1;
    err |= memcmp(src, "bool", 4) != 0;
    src += 4;
    if (err == 0) {
        memcpy(shape_13, src, 1 * sizeof(int64_t));
        src += 1 * sizeof(int64_t);
    }
    
    const void *data_13 = src;
    
    obj->v13 = NULL;
    src += shape_13[0] * sizeof(bool);
    
    int64_t shape_14[1] = {0};
    
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 1;
    err |= memcmp(src, " i64", 4) != 0;
    src += 4;
    if (err == 0) {
        memcpy(shape_14, src, 1 * sizeof(int64_t));
        src += 1 * sizeof(int64_t);
    }
    
    const void *data_14 = src;
    
    obj->v14 = NULL;
    src += shape_14[0] * sizeof(int64_t);
    
    int64_t shape_15[1] = {0};
    
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 1;
    err |= memcmp(src, " f64", 4) != 0;
    src += 4;
    if (err == 0) {
        memcpy(shape_15, src, 1 * sizeof(int64_t));
        src += 1 * sizeof(int64_t);
    }
    
    const void *data_15 = src;
    
    obj->v15 = NULL;
    src += shape_15[0] * sizeof(double);
    
    int64_t shape_16[1] = {0};
    
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 1;
    err |= memcmp(src, " f64", 4) != 0;
    src += 4;
    if (err == 0) {
        memcpy(shape_16, src, 1 * sizeof(int64_t));
        src += 1 * sizeof(int64_t);
    }
    
    const void *data_16 = src;
    
    obj->v16 = NULL;
    src += shape_16[0] * sizeof(double);
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 0;
    err |= memcmp(src, " i64", 4) != 0;
    src += 4;
    if (err == 0) {
        src += 0 * sizeof(int64_t);
    }
    
    const void *data_17 = src;
    
    src += sizeof(obj->v17);
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 0;
    err |= memcmp(src, " i64", 4) != 0;
    src += 4;
    if (err == 0) {
        src += 0 * sizeof(int64_t);
    }
    
    const void *data_18 = src;
    
    src += sizeof(obj->v18);
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 0;
    err |= memcmp(src, " i64", 4) != 0;
    src += 4;
    if (err == 0) {
        src += 0 * sizeof(int64_t);
    }
    
    const void *data_19 = src;
    
    src += sizeof(obj->v19);
    
    int64_t shape_20[1] = {0};
    
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 1;
    err |= memcmp(src, "bool", 4) != 0;
    src += 4;
    if (err == 0) {
        memcpy(shape_20, src, 1 * sizeof(int64_t));
        src += 1 * sizeof(int64_t);
    }
    
    const void *data_20 = src;
    
    obj->v20 = NULL;
    src += shape_20[0] * sizeof(bool);
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 0;
    err |= memcmp(src, " i64", 4) != 0;
    src += 4;
    if (err == 0) {
        src += 0 * sizeof(int64_t);
    }
    
    const void *data_21 = src;
    
    src += sizeof(obj->v21);
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 0;
    err |= memcmp(src, " i64", 4) != 0;
    src += 4;
    if (err == 0) {
        src += 0 * sizeof(int64_t);
    }
    
    const void *data_22 = src;
    
    src += sizeof(obj->v22);
    
    int64_t shape_23[1] = {0};
    
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 1;
    err |= memcmp(src, " i64", 4) != 0;
    src += 4;
    if (err == 0) {
        memcpy(shape_23, src, 1 * sizeof(int64_t));
        src += 1 * sizeof(int64_t);
    }
    
    const void *data_23 = src;
    
    obj->v23 = NULL;
    src += shape_23[0] * sizeof(int64_t);
    
    int64_t shape_24[1] = {0};
    
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 1;
    err |= memcmp(src, " i64", 4) != 0;
    src += 4;
    if (err == 0) {
        memcpy(shape_24, src, 1 * sizeof(int64_t));
        src += 1 * sizeof(int64_t);
    }
    
    const void *data_24 = src;
    
    obj->v24 = NULL;
    src += shape_24[0] * sizeof(int64_t);
    
    int64_t shape_25[1] = {0};
    
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 1;
    err |= memcmp(src, " f64", 4) != 0;
    src += 4;
    if (err == 0) {
        memcpy(shape_25, src, 1 * sizeof(int64_t));
        src += 1 * sizeof(int64_t);
    }
    
    const void *data_25 = src;
    
    obj->v25 = NULL;
    src += shape_25[0] * sizeof(double);
    
    int64_t shape_26[1] = {0};
    
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 1;
    err |= memcmp(src, " f64", 4) != 0;
    src += 4;
    if (err == 0) {
        memcpy(shape_26, src, 1 * sizeof(int64_t));
        src += 1 * sizeof(int64_t);
    }
    
    const void *data_26 = src;
    
    obj->v26 = NULL;
    src += shape_26[0] * sizeof(double);
    
    int64_t shape_27[1] = {0};
    
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 1;
    err |= memcmp(src, " f64", 4) != 0;
    src += 4;
    if (err == 0) {
        memcpy(shape_27, src, 1 * sizeof(int64_t));
        src += 1 * sizeof(int64_t);
    }
    
    const void *data_27 = src;
    
    obj->v27 = NULL;
    src += shape_27[0] * sizeof(double);
    
    int64_t shape_28[1] = {0};
    
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 1;
    err |= memcmp(src, " f64", 4) != 0;
    src += 4;
    if (err == 0) {
        memcpy(shape_28, src, 1 * sizeof(int64_t));
        src += 1 * sizeof(int64_t);
    }
    
    const void *data_28 = src;
    
    obj->v28 = NULL;
    src += shape_28[0] * sizeof(double);
    
    int64_t shape_29[1] = {0};
    
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 1;
    err |= memcmp(src, "bool", 4) != 0;
    src += 4;
    if (err == 0) {
        memcpy(shape_29, src, 1 * sizeof(int64_t));
        src += 1 * sizeof(int64_t);
    }
    
    const void *data_29 = src;
    
    obj->v29 = NULL;
    src += shape_29[0] * sizeof(bool);
    
    int64_t shape_30[1] = {0};
    
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 1;
    err |= memcmp(src, "bool", 4) != 0;
    src += 4;
    if (err == 0) {
        memcpy(shape_30, src, 1 * sizeof(int64_t));
        src += 1 * sizeof(int64_t);
    }
    
    const void *data_30 = src;
    
    obj->v30 = NULL;
    src += shape_30[0] * sizeof(bool);
    
    int64_t shape_31[1] = {0};
    
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 1;
    err |= memcmp(src, "bool", 4) != 0;
    src += 4;
    if (err == 0) {
        memcpy(shape_31, src, 1 * sizeof(int64_t));
        src += 1 * sizeof(int64_t);
    }
    
    const void *data_31 = src;
    
    obj->v31 = NULL;
    src += shape_31[0] * sizeof(bool);
    
    int64_t shape_32[1] = {0};
    
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 1;
    err |= memcmp(src, "bool", 4) != 0;
    src += 4;
    if (err == 0) {
        memcpy(shape_32, src, 1 * sizeof(int64_t));
        src += 1 * sizeof(int64_t);
    }
    
    const void *data_32 = src;
    
    obj->v32 = NULL;
    src += shape_32[0] * sizeof(bool);
    
    int64_t shape_33[1] = {0};
    
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 1;
    err |= memcmp(src, " f64", 4) != 0;
    src += 4;
    if (err == 0) {
        memcpy(shape_33, src, 1 * sizeof(int64_t));
        src += 1 * sizeof(int64_t);
    }
    
    const void *data_33 = src;
    
    obj->v33 = NULL;
    src += shape_33[0] * sizeof(double);
    
    int64_t shape_34[1] = {0};
    
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 1;
    err |= memcmp(src, " f64", 4) != 0;
    src += 4;
    if (err == 0) {
        memcpy(shape_34, src, 1 * sizeof(int64_t));
        src += 1 * sizeof(int64_t);
    }
    
    const void *data_34 = src;
    
    obj->v34 = NULL;
    src += shape_34[0] * sizeof(double);
    
    int64_t shape_35[1] = {0};
    
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 1;
    err |= memcmp(src, " i64", 4) != 0;
    src += 4;
    if (err == 0) {
        memcpy(shape_35, src, 1 * sizeof(int64_t));
        src += 1 * sizeof(int64_t);
    }
    
    const void *data_35 = src;
    
    obj->v35 = NULL;
    src += shape_35[0] * sizeof(int64_t);
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 0;
    err |= memcmp(src, " i64", 4) != 0;
    src += 4;
    if (err == 0) {
        src += 0 * sizeof(int64_t);
    }
    
    const void *data_36 = src;
    
    src += sizeof(obj->v36);
    
    int64_t shape_37[1] = {0};
    
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 1;
    err |= memcmp(src, " f64", 4) != 0;
    src += 4;
    if (err == 0) {
        memcpy(shape_37, src, 1 * sizeof(int64_t));
        src += 1 * sizeof(int64_t);
    }
    
    const void *data_37 = src;
    
    obj->v37 = NULL;
    src += shape_37[0] * sizeof(double);
    
    int64_t shape_38[1] = {0};
    
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 1;
    err |= memcmp(src, " f64", 4) != 0;
    src += 4;
    if (err == 0) {
        memcpy(shape_38, src, 1 * sizeof(int64_t));
        src += 1 * sizeof(int64_t);
    }
    
    const void *data_38 = src;
    
    obj->v38 = NULL;
    src += shape_38[0] * sizeof(double);
    
    int64_t shape_39[1] = {0};
    
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 1;
    err |= memcmp(src, " i64", 4) != 0;
    src += 4;
    if (err == 0) {
        memcpy(shape_39, src, 1 * sizeof(int64_t));
        src += 1 * sizeof(int64_t);
    }
    
    const void *data_39 = src;
    
    obj->v39 = NULL;
    src += shape_39[0] * sizeof(int64_t);
    if (err == 0) {
        obj->v0 = futhark_new_i64_1d(ctx, data_0, shape_0[0]);
        if (obj->v0 == NULL)
            err = 1;
        obj->v1 = futhark_new_i64_1d(ctx, data_1, shape_1[0]);
        if (obj->v1 == NULL)
            err = 1;
        memcpy(&obj->v2, data_2, sizeof(obj->v2));
        memcpy(&obj->v3, data_3, sizeof(obj->v3));
        memcpy(&obj->v4, data_4, sizeof(obj->v4));
        memcpy(&obj->v5, data_5, sizeof(obj->v5));
        obj->v6 = futhark_new_f64_1d(ctx, data_6, shape_6[0]);
        if (obj->v6 == NULL)
            err = 1;
        memcpy(&obj->v7, data_7, sizeof(obj->v7));
        obj->v8 = futhark_new_f64_1d(ctx, data_8, shape_8[0]);
        if (obj->v8 == NULL)
            err = 1;
        obj->v9 = futhark_new_i64_1d(ctx, data_9, shape_9[0]);
        if (obj->v9 == NULL)
            err = 1;
        memcpy(&obj->v10, data_10, sizeof(obj->v10));
        obj->v11 = futhark_new_f64_1d(ctx, data_11, shape_11[0]);
        if (obj->v11 == NULL)
            err = 1;
        memcpy(&obj->v12, data_12, sizeof(obj->v12));
        obj->v13 = futhark_new_bool_1d(ctx, data_13, shape_13[0]);
        if (obj->v13 == NULL)
            err = 1;
        obj->v14 = futhark_new_i64_1d(ctx, data_14, shape_14[0]);
        if (obj->v14 == NULL)
            err = 1;
        obj->v15 = futhark_new_f64_1d(ctx, data_15, shape_15[0]);
        if (obj->v15 == NULL)
            err = 1;
        obj->v16 = futhark_new_f64_1d(ctx, data_16, shape_16[0]);
        if (obj->v16 == NULL)
            err = 1;
        memcpy(&obj->v17, data_17, sizeof(obj->v17));
        memcpy(&obj->v18, data_18, sizeof(obj->v18));
        memcpy(&obj->v19, data_19, sizeof(obj->v19));
        obj->v20 = futhark_new_bool_1d(ctx, data_20, shape_20[0]);
        if (obj->v20 == NULL)
            err = 1;
        memcpy(&obj->v21, data_21, sizeof(obj->v21));
        memcpy(&obj->v22, data_22, sizeof(obj->v22));
        obj->v23 = futhark_new_i64_1d(ctx, data_23, shape_23[0]);
        if (obj->v23 == NULL)
            err = 1;
        obj->v24 = futhark_new_i64_1d(ctx, data_24, shape_24[0]);
        if (obj->v24 == NULL)
            err = 1;
        obj->v25 = futhark_new_f64_1d(ctx, data_25, shape_25[0]);
        if (obj->v25 == NULL)
            err = 1;
        obj->v26 = futhark_new_f64_1d(ctx, data_26, shape_26[0]);
        if (obj->v26 == NULL)
            err = 1;
        obj->v27 = futhark_new_f64_1d(ctx, data_27, shape_27[0]);
        if (obj->v27 == NULL)
            err = 1;
        obj->v28 = futhark_new_f64_1d(ctx, data_28, shape_28[0]);
        if (obj->v28 == NULL)
            err = 1;
        obj->v29 = futhark_new_bool_1d(ctx, data_29, shape_29[0]);
        if (obj->v29 == NULL)
            err = 1;
        obj->v30 = futhark_new_bool_1d(ctx, data_30, shape_30[0]);
        if (obj->v30 == NULL)
            err = 1;
        obj->v31 = futhark_new_bool_1d(ctx, data_31, shape_31[0]);
        if (obj->v31 == NULL)
            err = 1;
        obj->v32 = futhark_new_bool_1d(ctx, data_32, shape_32[0]);
        if (obj->v32 == NULL)
            err = 1;
        obj->v33 = futhark_new_f64_1d(ctx, data_33, shape_33[0]);
        if (obj->v33 == NULL)
            err = 1;
        obj->v34 = futhark_new_f64_1d(ctx, data_34, shape_34[0]);
        if (obj->v34 == NULL)
            err = 1;
        obj->v35 = futhark_new_i64_1d(ctx, data_35, shape_35[0]);
        if (obj->v35 == NULL)
            err = 1;
        memcpy(&obj->v36, data_36, sizeof(obj->v36));
        obj->v37 = futhark_new_f64_1d(ctx, data_37, shape_37[0]);
        if (obj->v37 == NULL)
            err = 1;
        obj->v38 = futhark_new_f64_1d(ctx, data_38, shape_38[0]);
        if (obj->v38 == NULL)
            err = 1;
        obj->v39 = futhark_new_i64_1d(ctx, data_39, shape_39[0]);
        if (obj->v39 == NULL)
            err = 1;
    }
    if (err != 0) {
        int ret = 0, tmp;
        
        if (obj->v0 != NULL && (tmp = futhark_free_i64_1d(ctx, obj->v0)) != 0)
            ret = tmp;
        if (obj->v1 != NULL && (tmp = futhark_free_i64_1d(ctx, obj->v1)) != 0)
            ret = tmp;
        if (obj->v6 != NULL && (tmp = futhark_free_f64_1d(ctx, obj->v6)) != 0)
            ret = tmp;
        if (obj->v8 != NULL && (tmp = futhark_free_f64_1d(ctx, obj->v8)) != 0)
            ret = tmp;
        if (obj->v9 != NULL && (tmp = futhark_free_i64_1d(ctx, obj->v9)) != 0)
            ret = tmp;
        if (obj->v11 != NULL && (tmp = futhark_free_f64_1d(ctx, obj->v11)) != 0)
            ret = tmp;
        if (obj->v13 != NULL && (tmp = futhark_free_bool_1d(ctx, obj->v13)) != 0)
            ret = tmp;
        if (obj->v14 != NULL && (tmp = futhark_free_i64_1d(ctx, obj->v14)) != 0)
            ret = tmp;
        if (obj->v15 != NULL && (tmp = futhark_free_f64_1d(ctx, obj->v15)) != 0)
            ret = tmp;
        if (obj->v16 != NULL && (tmp = futhark_free_f64_1d(ctx, obj->v16)) != 0)
            ret = tmp;
        if (obj->v20 != NULL && (tmp = futhark_free_bool_1d(ctx, obj->v20)) != 0)
            ret = tmp;
        if (obj->v23 != NULL && (tmp = futhark_free_i64_1d(ctx, obj->v23)) != 0)
            ret = tmp;
        if (obj->v24 != NULL && (tmp = futhark_free_i64_1d(ctx, obj->v24)) != 0)
            ret = tmp;
        if (obj->v25 != NULL && (tmp = futhark_free_f64_1d(ctx, obj->v25)) != 0)
            ret = tmp;
        if (obj->v26 != NULL && (tmp = futhark_free_f64_1d(ctx, obj->v26)) != 0)
            ret = tmp;
        if (obj->v27 != NULL && (tmp = futhark_free_f64_1d(ctx, obj->v27)) != 0)
            ret = tmp;
        if (obj->v28 != NULL && (tmp = futhark_free_f64_1d(ctx, obj->v28)) != 0)
            ret = tmp;
        if (obj->v29 != NULL && (tmp = futhark_free_bool_1d(ctx, obj->v29)) != 0)
            ret = tmp;
        if (obj->v30 != NULL && (tmp = futhark_free_bool_1d(ctx, obj->v30)) != 0)
            ret = tmp;
        if (obj->v31 != NULL && (tmp = futhark_free_bool_1d(ctx, obj->v31)) != 0)
            ret = tmp;
        if (obj->v32 != NULL && (tmp = futhark_free_bool_1d(ctx, obj->v32)) != 0)
            ret = tmp;
        if (obj->v33 != NULL && (tmp = futhark_free_f64_1d(ctx, obj->v33)) != 0)
            ret = tmp;
        if (obj->v34 != NULL && (tmp = futhark_free_f64_1d(ctx, obj->v34)) != 0)
            ret = tmp;
        if (obj->v35 != NULL && (tmp = futhark_free_i64_1d(ctx, obj->v35)) != 0)
            ret = tmp;
        if (obj->v37 != NULL && (tmp = futhark_free_f64_1d(ctx, obj->v37)) != 0)
            ret = tmp;
        if (obj->v38 != NULL && (tmp = futhark_free_f64_1d(ctx, obj->v38)) != 0)
            ret = tmp;
        if (obj->v39 != NULL && (tmp = futhark_free_i64_1d(ctx, obj->v39)) != 0)
            ret = tmp;
        free(obj);
        obj = NULL;
    }
    return obj;
}
struct futhark_opaque_flushedData_double {
    struct futhark_i64_1d *v0;
    struct futhark_f64_1d *v1;
    struct futhark_f64_1d *v2;
};
int futhark_project_opaque_flushedData_double_chain_ids(struct futhark_context *ctx, struct futhark_i64_1d **out, const struct futhark_opaque_flushedData_double *obj)
{
    (void) ctx;
    
    struct futhark_i64_1d *v;
    
    lock_lock(&ctx->lock);
    CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
    v = malloc(sizeof(struct futhark_i64_1d));
    memcpy(v, obj->v0, sizeof(struct futhark_i64_1d));
    (void) (*v->mem.references)++;
    CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
    lock_unlock(&ctx->lock);
    *out = v;
    return 0;
}
int futhark_project_opaque_flushedData_double_xs(struct futhark_context *ctx, struct futhark_f64_1d **out, const struct futhark_opaque_flushedData_double *obj)
{
    (void) ctx;
    
    struct futhark_f64_1d *v;
    
    lock_lock(&ctx->lock);
    CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
    v = malloc(sizeof(struct futhark_f64_1d));
    memcpy(v, obj->v1, sizeof(struct futhark_f64_1d));
    (void) (*v->mem.references)++;
    CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
    lock_unlock(&ctx->lock);
    *out = v;
    return 0;
}
int futhark_project_opaque_flushedData_double_ys(struct futhark_context *ctx, struct futhark_f64_1d **out, const struct futhark_opaque_flushedData_double *obj)
{
    (void) ctx;
    
    struct futhark_f64_1d *v;
    
    lock_lock(&ctx->lock);
    CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
    v = malloc(sizeof(struct futhark_f64_1d));
    memcpy(v, obj->v2, sizeof(struct futhark_f64_1d));
    (void) (*v->mem.references)++;
    CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
    lock_unlock(&ctx->lock);
    *out = v;
    return 0;
}
int futhark_new_opaque_flushedData_double(struct futhark_context *ctx, struct futhark_opaque_flushedData_double **out, const struct futhark_i64_1d *f_chain_ids, const struct futhark_f64_1d *f_xs, const struct futhark_f64_1d *f_ys)
{
    struct futhark_opaque_flushedData_double *v = malloc(sizeof(struct futhark_opaque_flushedData_double));
    
    lock_lock(&ctx->lock);
    CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
    {
        v->v0 = malloc(sizeof(struct futhark_i64_1d));
        *v->v0 = *f_chain_ids;
        (void) (*v->v0->mem.references)++;
    }
    {
        v->v1 = malloc(sizeof(struct futhark_f64_1d));
        *v->v1 = *f_xs;
        (void) (*v->v1->mem.references)++;
    }
    {
        v->v2 = malloc(sizeof(struct futhark_f64_1d));
        *v->v2 = *f_ys;
        (void) (*v->v2->mem.references)++;
    }
    CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
    lock_unlock(&ctx->lock);
    *out = v;
    return FUTHARK_SUCCESS;
}
int futhark_free_opaque_flushedData_double(struct futhark_context *ctx, struct futhark_opaque_flushedData_double *obj)
{
    (void) ctx;
    
    int ret = 0, tmp;
    
    if (obj->v0 != NULL && (tmp = futhark_free_i64_1d(ctx, obj->v0)) != 0)
        ret = tmp;
    if (obj->v1 != NULL && (tmp = futhark_free_f64_1d(ctx, obj->v1)) != 0)
        ret = tmp;
    if (obj->v2 != NULL && (tmp = futhark_free_f64_1d(ctx, obj->v2)) != 0)
        ret = tmp;
    free(obj);
    return ret;
}
int futhark_store_opaque_flushedData_double(struct futhark_context *ctx, const struct futhark_opaque_flushedData_double *obj, void **p, size_t *n)
{
    (void) ctx;
    
    int ret = 0;
    int64_t size_0 = 7 + 1 * sizeof(int64_t) + futhark_shape_i64_1d(ctx, obj->v0)[0] * sizeof(int64_t);
    int64_t size_1 = 7 + 1 * sizeof(int64_t) + futhark_shape_f64_1d(ctx, obj->v1)[0] * sizeof(double);
    int64_t size_2 = 7 + 1 * sizeof(int64_t) + futhark_shape_f64_1d(ctx, obj->v2)[0] * sizeof(double);
    
    *n = size_0 + size_1 + size_2;
    if (p != NULL && *p == NULL)
        *p = malloc(*n);
    if (p != NULL) {
        unsigned char *out = *p;
        
        *out++ = 'b';
        *out++ = 2;
        *out++ = 1;
        memcpy(out, " i64", 4);
        out += 4;
        memcpy(out, futhark_shape_i64_1d(ctx, obj->v0), 1 * sizeof(int64_t));
        out += 1 * sizeof(int64_t);
        ret |= futhark_values_i64_1d(ctx, obj->v0, (void *) out);
        out += futhark_shape_i64_1d(ctx, obj->v0)[0] * sizeof(int64_t);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 1;
        memcpy(out, " f64", 4);
        out += 4;
        memcpy(out, futhark_shape_f64_1d(ctx, obj->v1), 1 * sizeof(int64_t));
        out += 1 * sizeof(int64_t);
        ret |= futhark_values_f64_1d(ctx, obj->v1, (void *) out);
        out += futhark_shape_f64_1d(ctx, obj->v1)[0] * sizeof(double);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 1;
        memcpy(out, " f64", 4);
        out += 4;
        memcpy(out, futhark_shape_f64_1d(ctx, obj->v2), 1 * sizeof(int64_t));
        out += 1 * sizeof(int64_t);
        ret |= futhark_values_f64_1d(ctx, obj->v2, (void *) out);
        out += futhark_shape_f64_1d(ctx, obj->v2)[0] * sizeof(double);
    }
    return ret;
}
struct futhark_opaque_flushedData_double *futhark_restore_opaque_flushedData_double(struct futhark_context *ctx, const void *p)
{
    (void) ctx;
    
    int err = 0;
    const unsigned char *src = p;
    struct futhark_opaque_flushedData_double *obj = malloc(sizeof(struct futhark_opaque_flushedData_double));
    int64_t shape_0[1] = {0};
    
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 1;
    err |= memcmp(src, " i64", 4) != 0;
    src += 4;
    if (err == 0) {
        memcpy(shape_0, src, 1 * sizeof(int64_t));
        src += 1 * sizeof(int64_t);
    }
    
    const void *data_0 = src;
    
    obj->v0 = NULL;
    src += shape_0[0] * sizeof(int64_t);
    
    int64_t shape_1[1] = {0};
    
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 1;
    err |= memcmp(src, " f64", 4) != 0;
    src += 4;
    if (err == 0) {
        memcpy(shape_1, src, 1 * sizeof(int64_t));
        src += 1 * sizeof(int64_t);
    }
    
    const void *data_1 = src;
    
    obj->v1 = NULL;
    src += shape_1[0] * sizeof(double);
    
    int64_t shape_2[1] = {0};
    
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 1;
    err |= memcmp(src, " f64", 4) != 0;
    src += 4;
    if (err == 0) {
        memcpy(shape_2, src, 1 * sizeof(int64_t));
        src += 1 * sizeof(int64_t);
    }
    
    const void *data_2 = src;
    
    obj->v2 = NULL;
    src += shape_2[0] * sizeof(double);
    if (err == 0) {
        obj->v0 = futhark_new_i64_1d(ctx, data_0, shape_0[0]);
        if (obj->v0 == NULL)
            err = 1;
        obj->v1 = futhark_new_f64_1d(ctx, data_1, shape_1[0]);
        if (obj->v1 == NULL)
            err = 1;
        obj->v2 = futhark_new_f64_1d(ctx, data_2, shape_2[0]);
        if (obj->v2 == NULL)
            err = 1;
    }
    if (err != 0) {
        int ret = 0, tmp;
        
        if (obj->v0 != NULL && (tmp = futhark_free_i64_1d(ctx, obj->v0)) != 0)
            ret = tmp;
        if (obj->v1 != NULL && (tmp = futhark_free_f64_1d(ctx, obj->v1)) != 0)
            ret = tmp;
        if (obj->v2 != NULL && (tmp = futhark_free_f64_1d(ctx, obj->v2)) != 0)
            ret = tmp;
        free(obj);
        obj = NULL;
    }
    return obj;
}
struct futhark_opaque_collisionTable {
    struct futhark_i64_1d *v0;
    struct futhark_i64_1d *v1;
};
int futhark_project_opaque_collisionTable_chain_id(struct futhark_context *ctx, struct futhark_i64_1d **out, const struct futhark_opaque_collisionTable *obj)
{
    (void) ctx;
    
    struct futhark_i64_1d *v;
    
    lock_lock(&ctx->lock);
    CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
    v = malloc(sizeof(struct futhark_i64_1d));
    memcpy(v, obj->v0, sizeof(struct futhark_i64_1d));
    (void) (*v->mem.references)++;
    CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
    lock_unlock(&ctx->lock);
    *out = v;
    return 0;
}
int futhark_project_opaque_collisionTable_replaceWith(struct futhark_context *ctx, struct futhark_i64_1d **out, const struct futhark_opaque_collisionTable *obj)
{
    (void) ctx;
    
    struct futhark_i64_1d *v;
    
    lock_lock(&ctx->lock);
    CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
    v = malloc(sizeof(struct futhark_i64_1d));
    memcpy(v, obj->v1, sizeof(struct futhark_i64_1d));
    (void) (*v->mem.references)++;
    CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
    lock_unlock(&ctx->lock);
    *out = v;
    return 0;
}
int futhark_new_opaque_collisionTable(struct futhark_context *ctx, struct futhark_opaque_collisionTable **out, const struct futhark_i64_1d *f_chain_id, const struct futhark_i64_1d *f_replaceWith)
{
    struct futhark_opaque_collisionTable *v = malloc(sizeof(struct futhark_opaque_collisionTable));
    
    lock_lock(&ctx->lock);
    CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
    {
        v->v0 = malloc(sizeof(struct futhark_i64_1d));
        *v->v0 = *f_chain_id;
        (void) (*v->v0->mem.references)++;
    }
    {
        v->v1 = malloc(sizeof(struct futhark_i64_1d));
        *v->v1 = *f_replaceWith;
        (void) (*v->v1->mem.references)++;
    }
    CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
    lock_unlock(&ctx->lock);
    *out = v;
    return FUTHARK_SUCCESS;
}
int futhark_free_opaque_collisionTable(struct futhark_context *ctx, struct futhark_opaque_collisionTable *obj)
{
    (void) ctx;
    
    int ret = 0, tmp;
    
    if (obj->v0 != NULL && (tmp = futhark_free_i64_1d(ctx, obj->v0)) != 0)
        ret = tmp;
    if (obj->v1 != NULL && (tmp = futhark_free_i64_1d(ctx, obj->v1)) != 0)
        ret = tmp;
    free(obj);
    return ret;
}
int futhark_store_opaque_collisionTable(struct futhark_context *ctx, const struct futhark_opaque_collisionTable *obj, void **p, size_t *n)
{
    (void) ctx;
    
    int ret = 0;
    int64_t size_0 = 7 + 1 * sizeof(int64_t) + futhark_shape_i64_1d(ctx, obj->v0)[0] * sizeof(int64_t);
    int64_t size_1 = 7 + 1 * sizeof(int64_t) + futhark_shape_i64_1d(ctx, obj->v1)[0] * sizeof(int64_t);
    
    *n = size_0 + size_1;
    if (p != NULL && *p == NULL)
        *p = malloc(*n);
    if (p != NULL) {
        unsigned char *out = *p;
        
        *out++ = 'b';
        *out++ = 2;
        *out++ = 1;
        memcpy(out, " i64", 4);
        out += 4;
        memcpy(out, futhark_shape_i64_1d(ctx, obj->v0), 1 * sizeof(int64_t));
        out += 1 * sizeof(int64_t);
        ret |= futhark_values_i64_1d(ctx, obj->v0, (void *) out);
        out += futhark_shape_i64_1d(ctx, obj->v0)[0] * sizeof(int64_t);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 1;
        memcpy(out, " i64", 4);
        out += 4;
        memcpy(out, futhark_shape_i64_1d(ctx, obj->v1), 1 * sizeof(int64_t));
        out += 1 * sizeof(int64_t);
        ret |= futhark_values_i64_1d(ctx, obj->v1, (void *) out);
        out += futhark_shape_i64_1d(ctx, obj->v1)[0] * sizeof(int64_t);
    }
    return ret;
}
struct futhark_opaque_collisionTable *futhark_restore_opaque_collisionTable(struct futhark_context *ctx, const void *p)
{
    (void) ctx;
    
    int err = 0;
    const unsigned char *src = p;
    struct futhark_opaque_collisionTable *obj = malloc(sizeof(struct futhark_opaque_collisionTable));
    int64_t shape_0[1] = {0};
    
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 1;
    err |= memcmp(src, " i64", 4) != 0;
    src += 4;
    if (err == 0) {
        memcpy(shape_0, src, 1 * sizeof(int64_t));
        src += 1 * sizeof(int64_t);
    }
    
    const void *data_0 = src;
    
    obj->v0 = NULL;
    src += shape_0[0] * sizeof(int64_t);
    
    int64_t shape_1[1] = {0};
    
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 1;
    err |= memcmp(src, " i64", 4) != 0;
    src += 4;
    if (err == 0) {
        memcpy(shape_1, src, 1 * sizeof(int64_t));
        src += 1 * sizeof(int64_t);
    }
    
    const void *data_1 = src;
    
    obj->v1 = NULL;
    src += shape_1[0] * sizeof(int64_t);
    if (err == 0) {
        obj->v0 = futhark_new_i64_1d(ctx, data_0, shape_0[0]);
        if (obj->v0 == NULL)
            err = 1;
        obj->v1 = futhark_new_i64_1d(ctx, data_1, shape_1[0]);
        if (obj->v1 == NULL)
            err = 1;
    }
    if (err != 0) {
        int ret = 0, tmp;
        
        if (obj->v0 != NULL && (tmp = futhark_free_i64_1d(ctx, obj->v0)) != 0)
            ret = tmp;
        if (obj->v1 != NULL && (tmp = futhark_free_i64_1d(ctx, obj->v1)) != 0)
            ret = tmp;
        free(obj);
        obj = NULL;
    }
    return obj;
}

FUTHARK_FUN_ATTR int futrts_builtinzhiota_i64(struct futhark_context *ctx, struct memblock_device mem_54725, int64_t n_54726, int64_t x_54727, int64_t s_54728)
{
    (void) ctx;
    
    int err = 0;
    struct memblock_device counters_mem_54551 = ctx->constants->counters_mem_54551;
    struct memblock_device counters_mem_54625 = ctx->constants->counters_mem_54625;
    struct memblock_device counters_mem_55050 = ctx->constants->counters_mem_55050;
    struct memblock_device counters_mem_55495 = ctx->constants->counters_mem_55495;
    struct memblock_device counters_mem_55534 = ctx->constants->counters_mem_55534;
    struct memblock_device counters_mem_55581 = ctx->constants->counters_mem_55581;
    struct memblock_device counters_mem_56605 = ctx->constants->counters_mem_56605;
    struct memblock_device counters_mem_56764 = ctx->constants->counters_mem_56764;
    struct memblock_device counters_mem_56815 = ctx->constants->counters_mem_56815;
    struct memblock_device counters_mem_56850 = ctx->constants->counters_mem_56850;
    struct memblock_device global_dynid_mem_54616 = ctx->constants->global_dynid_mem_54616;
    struct memblock_device global_dynid_mem_54626 = ctx->constants->global_dynid_mem_54626;
    struct memblock_device global_dynid_mem_54637 = ctx->constants->global_dynid_mem_54637;
    struct memblock_device global_dynid_mem_54642 = ctx->constants->global_dynid_mem_54642;
    struct memblock_device global_dynid_mem_54800 = ctx->constants->global_dynid_mem_54800;
    struct memblock_device global_dynid_mem_54871 = ctx->constants->global_dynid_mem_54871;
    struct memblock_device global_dynid_mem_54920 = ctx->constants->global_dynid_mem_54920;
    struct memblock_device global_dynid_mem_55083 = ctx->constants->global_dynid_mem_55083;
    struct memblock_device global_dynid_mem_55112 = ctx->constants->global_dynid_mem_55112;
    struct memblock_device global_dynid_mem_55221 = ctx->constants->global_dynid_mem_55221;
    struct memblock_device global_dynid_mem_55228 = ctx->constants->global_dynid_mem_55228;
    struct memblock_device global_dynid_mem_55334 = ctx->constants->global_dynid_mem_55334;
    struct memblock_device global_dynid_mem_55338 = ctx->constants->global_dynid_mem_55338;
    struct memblock_device global_dynid_mem_55581 = ctx->constants->global_dynid_mem_55581;
    struct memblock_device global_dynid_mem_55728 = ctx->constants->global_dynid_mem_55728;
    struct memblock_device global_dynid_mem_55884 = ctx->constants->global_dynid_mem_55884;
    struct memblock_device global_dynid_mem_56002 = ctx->constants->global_dynid_mem_56002;
    struct memblock_device global_dynid_mem_56151 = ctx->constants->global_dynid_mem_56151;
    struct memblock_device global_dynid_mem_56269 = ctx->constants->global_dynid_mem_56269;
    struct memblock_device global_dynid_mem_56425 = ctx->constants->global_dynid_mem_56425;
    int64_t tblock_sizze_54734;
    
    tblock_sizze_54734 = *ctx->tuning_params.builtinzhiota_i64zitblock_sizze_54734;
    
    int64_t virt_num_tblocks_54735 = sdiv_up64(n_54726, tblock_sizze_54734);
    int64_t num_tblocks_54736 = smin64(virt_num_tblocks_54735, (int64_t) 1048576);
    
    {
        err = gpu_kernel_builtinzhiota_i64ziiota_i64_54730(ctx, num_tblocks_54736, 1, 1, tblock_sizze_54734, 1, 1, (int64_t) 0, n_54726, x_54727, s_54728, virt_num_tblocks_54735, num_tblocks_54736, mem_54725.mem);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
  cleanup:
    { }
    return err;
}
FUTHARK_FUN_ATTR int futrts_builtinzhreplicate_bool(struct futhark_context *ctx, struct memblock_device mem_55474, int64_t num_elems_55475, bool val_55476)
{
    (void) ctx;
    
    int err = 0;
    struct memblock_device counters_mem_54551 = ctx->constants->counters_mem_54551;
    struct memblock_device counters_mem_54625 = ctx->constants->counters_mem_54625;
    struct memblock_device counters_mem_55050 = ctx->constants->counters_mem_55050;
    struct memblock_device counters_mem_55495 = ctx->constants->counters_mem_55495;
    struct memblock_device counters_mem_55534 = ctx->constants->counters_mem_55534;
    struct memblock_device counters_mem_55581 = ctx->constants->counters_mem_55581;
    struct memblock_device counters_mem_56605 = ctx->constants->counters_mem_56605;
    struct memblock_device counters_mem_56764 = ctx->constants->counters_mem_56764;
    struct memblock_device counters_mem_56815 = ctx->constants->counters_mem_56815;
    struct memblock_device counters_mem_56850 = ctx->constants->counters_mem_56850;
    struct memblock_device global_dynid_mem_54616 = ctx->constants->global_dynid_mem_54616;
    struct memblock_device global_dynid_mem_54626 = ctx->constants->global_dynid_mem_54626;
    struct memblock_device global_dynid_mem_54637 = ctx->constants->global_dynid_mem_54637;
    struct memblock_device global_dynid_mem_54642 = ctx->constants->global_dynid_mem_54642;
    struct memblock_device global_dynid_mem_54800 = ctx->constants->global_dynid_mem_54800;
    struct memblock_device global_dynid_mem_54871 = ctx->constants->global_dynid_mem_54871;
    struct memblock_device global_dynid_mem_54920 = ctx->constants->global_dynid_mem_54920;
    struct memblock_device global_dynid_mem_55083 = ctx->constants->global_dynid_mem_55083;
    struct memblock_device global_dynid_mem_55112 = ctx->constants->global_dynid_mem_55112;
    struct memblock_device global_dynid_mem_55221 = ctx->constants->global_dynid_mem_55221;
    struct memblock_device global_dynid_mem_55228 = ctx->constants->global_dynid_mem_55228;
    struct memblock_device global_dynid_mem_55334 = ctx->constants->global_dynid_mem_55334;
    struct memblock_device global_dynid_mem_55338 = ctx->constants->global_dynid_mem_55338;
    struct memblock_device global_dynid_mem_55581 = ctx->constants->global_dynid_mem_55581;
    struct memblock_device global_dynid_mem_55728 = ctx->constants->global_dynid_mem_55728;
    struct memblock_device global_dynid_mem_55884 = ctx->constants->global_dynid_mem_55884;
    struct memblock_device global_dynid_mem_56002 = ctx->constants->global_dynid_mem_56002;
    struct memblock_device global_dynid_mem_56151 = ctx->constants->global_dynid_mem_56151;
    struct memblock_device global_dynid_mem_56269 = ctx->constants->global_dynid_mem_56269;
    struct memblock_device global_dynid_mem_56425 = ctx->constants->global_dynid_mem_56425;
    int64_t replicate_n_55478 = num_elems_55475;
    int64_t tblock_sizze_55483;
    
    tblock_sizze_55483 = *ctx->tuning_params.builtinzhreplicate_boolzitblock_sizze_55483;
    
    int64_t virt_num_tblocks_55484 = sdiv_up64(replicate_n_55478, tblock_sizze_55483);
    int64_t num_tblocks_55485 = smin64(virt_num_tblocks_55484, (int64_t) 1048576);
    
    {
        err = gpu_kernel_builtinzhreplicate_boolzireplicate_55479(ctx, num_tblocks_55485, 1, 1, tblock_sizze_55483, 1, 1, (int64_t) 0, num_elems_55475, val_55476, replicate_n_55478, virt_num_tblocks_55484, num_tblocks_55485, mem_55474.mem);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
  cleanup:
    { }
    return err;
}
FUTHARK_FUN_ATTR int futrts_builtinzhreplicate_f64(struct futhark_context *ctx, struct memblock_device mem_54801, int64_t num_elems_54802, double val_54803)
{
    (void) ctx;
    
    int err = 0;
    struct memblock_device counters_mem_54551 = ctx->constants->counters_mem_54551;
    struct memblock_device counters_mem_54625 = ctx->constants->counters_mem_54625;
    struct memblock_device counters_mem_55050 = ctx->constants->counters_mem_55050;
    struct memblock_device counters_mem_55495 = ctx->constants->counters_mem_55495;
    struct memblock_device counters_mem_55534 = ctx->constants->counters_mem_55534;
    struct memblock_device counters_mem_55581 = ctx->constants->counters_mem_55581;
    struct memblock_device counters_mem_56605 = ctx->constants->counters_mem_56605;
    struct memblock_device counters_mem_56764 = ctx->constants->counters_mem_56764;
    struct memblock_device counters_mem_56815 = ctx->constants->counters_mem_56815;
    struct memblock_device counters_mem_56850 = ctx->constants->counters_mem_56850;
    struct memblock_device global_dynid_mem_54616 = ctx->constants->global_dynid_mem_54616;
    struct memblock_device global_dynid_mem_54626 = ctx->constants->global_dynid_mem_54626;
    struct memblock_device global_dynid_mem_54637 = ctx->constants->global_dynid_mem_54637;
    struct memblock_device global_dynid_mem_54642 = ctx->constants->global_dynid_mem_54642;
    struct memblock_device global_dynid_mem_54800 = ctx->constants->global_dynid_mem_54800;
    struct memblock_device global_dynid_mem_54871 = ctx->constants->global_dynid_mem_54871;
    struct memblock_device global_dynid_mem_54920 = ctx->constants->global_dynid_mem_54920;
    struct memblock_device global_dynid_mem_55083 = ctx->constants->global_dynid_mem_55083;
    struct memblock_device global_dynid_mem_55112 = ctx->constants->global_dynid_mem_55112;
    struct memblock_device global_dynid_mem_55221 = ctx->constants->global_dynid_mem_55221;
    struct memblock_device global_dynid_mem_55228 = ctx->constants->global_dynid_mem_55228;
    struct memblock_device global_dynid_mem_55334 = ctx->constants->global_dynid_mem_55334;
    struct memblock_device global_dynid_mem_55338 = ctx->constants->global_dynid_mem_55338;
    struct memblock_device global_dynid_mem_55581 = ctx->constants->global_dynid_mem_55581;
    struct memblock_device global_dynid_mem_55728 = ctx->constants->global_dynid_mem_55728;
    struct memblock_device global_dynid_mem_55884 = ctx->constants->global_dynid_mem_55884;
    struct memblock_device global_dynid_mem_56002 = ctx->constants->global_dynid_mem_56002;
    struct memblock_device global_dynid_mem_56151 = ctx->constants->global_dynid_mem_56151;
    struct memblock_device global_dynid_mem_56269 = ctx->constants->global_dynid_mem_56269;
    struct memblock_device global_dynid_mem_56425 = ctx->constants->global_dynid_mem_56425;
    int64_t replicate_n_54805 = num_elems_54802;
    int64_t tblock_sizze_54810;
    
    tblock_sizze_54810 = *ctx->tuning_params.builtinzhreplicate_f64zitblock_sizze_54810;
    
    int64_t virt_num_tblocks_54811 = sdiv_up64(replicate_n_54805, tblock_sizze_54810);
    int64_t num_tblocks_54812 = smin64(virt_num_tblocks_54811, (int64_t) 1048576);
    
    {
        err = gpu_kernel_builtinzhreplicate_f64zireplicate_54806(ctx, num_tblocks_54812, 1, 1, tblock_sizze_54810, 1, 1, (int64_t) 0, num_elems_54802, val_54803, replicate_n_54805, virt_num_tblocks_54811, num_tblocks_54812, mem_54801.mem);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
  cleanup:
    { }
    return err;
}
FUTHARK_FUN_ATTR int futrts_builtinzhreplicate_i32(struct futhark_context *ctx, struct memblock_device mem_54627, int64_t num_elems_54628, int32_t val_54629)
{
    (void) ctx;
    
    int err = 0;
    struct memblock_device counters_mem_54551 = ctx->constants->counters_mem_54551;
    struct memblock_device counters_mem_54625 = ctx->constants->counters_mem_54625;
    struct memblock_device counters_mem_55050 = ctx->constants->counters_mem_55050;
    struct memblock_device counters_mem_55495 = ctx->constants->counters_mem_55495;
    struct memblock_device counters_mem_55534 = ctx->constants->counters_mem_55534;
    struct memblock_device counters_mem_55581 = ctx->constants->counters_mem_55581;
    struct memblock_device counters_mem_56605 = ctx->constants->counters_mem_56605;
    struct memblock_device counters_mem_56764 = ctx->constants->counters_mem_56764;
    struct memblock_device counters_mem_56815 = ctx->constants->counters_mem_56815;
    struct memblock_device counters_mem_56850 = ctx->constants->counters_mem_56850;
    struct memblock_device global_dynid_mem_54616 = ctx->constants->global_dynid_mem_54616;
    struct memblock_device global_dynid_mem_54626 = ctx->constants->global_dynid_mem_54626;
    struct memblock_device global_dynid_mem_54637 = ctx->constants->global_dynid_mem_54637;
    struct memblock_device global_dynid_mem_54642 = ctx->constants->global_dynid_mem_54642;
    struct memblock_device global_dynid_mem_54800 = ctx->constants->global_dynid_mem_54800;
    struct memblock_device global_dynid_mem_54871 = ctx->constants->global_dynid_mem_54871;
    struct memblock_device global_dynid_mem_54920 = ctx->constants->global_dynid_mem_54920;
    struct memblock_device global_dynid_mem_55083 = ctx->constants->global_dynid_mem_55083;
    struct memblock_device global_dynid_mem_55112 = ctx->constants->global_dynid_mem_55112;
    struct memblock_device global_dynid_mem_55221 = ctx->constants->global_dynid_mem_55221;
    struct memblock_device global_dynid_mem_55228 = ctx->constants->global_dynid_mem_55228;
    struct memblock_device global_dynid_mem_55334 = ctx->constants->global_dynid_mem_55334;
    struct memblock_device global_dynid_mem_55338 = ctx->constants->global_dynid_mem_55338;
    struct memblock_device global_dynid_mem_55581 = ctx->constants->global_dynid_mem_55581;
    struct memblock_device global_dynid_mem_55728 = ctx->constants->global_dynid_mem_55728;
    struct memblock_device global_dynid_mem_55884 = ctx->constants->global_dynid_mem_55884;
    struct memblock_device global_dynid_mem_56002 = ctx->constants->global_dynid_mem_56002;
    struct memblock_device global_dynid_mem_56151 = ctx->constants->global_dynid_mem_56151;
    struct memblock_device global_dynid_mem_56269 = ctx->constants->global_dynid_mem_56269;
    struct memblock_device global_dynid_mem_56425 = ctx->constants->global_dynid_mem_56425;
    int64_t replicate_n_54631 = num_elems_54628;
    int64_t tblock_sizze_54636;
    
    tblock_sizze_54636 = *ctx->tuning_params.builtinzhreplicate_i32zitblock_sizze_54636;
    
    int64_t virt_num_tblocks_54637 = sdiv_up64(replicate_n_54631, tblock_sizze_54636);
    int64_t num_tblocks_54638 = smin64(virt_num_tblocks_54637, (int64_t) 1048576);
    
    {
        err = gpu_kernel_builtinzhreplicate_i32zireplicate_54632(ctx, num_tblocks_54638, 1, 1, tblock_sizze_54636, 1, 1, (int64_t) 0, num_elems_54628, val_54629, replicate_n_54631, virt_num_tblocks_54637, num_tblocks_54638, mem_54627.mem);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
  cleanup:
    { }
    return err;
}
FUTHARK_FUN_ATTR int futrts_builtinzhreplicate_i64(struct futhark_context *ctx, struct memblock_device mem_54542, int64_t num_elems_54543, int64_t val_54544)
{
    (void) ctx;
    
    int err = 0;
    struct memblock_device counters_mem_54551 = ctx->constants->counters_mem_54551;
    struct memblock_device counters_mem_54625 = ctx->constants->counters_mem_54625;
    struct memblock_device counters_mem_55050 = ctx->constants->counters_mem_55050;
    struct memblock_device counters_mem_55495 = ctx->constants->counters_mem_55495;
    struct memblock_device counters_mem_55534 = ctx->constants->counters_mem_55534;
    struct memblock_device counters_mem_55581 = ctx->constants->counters_mem_55581;
    struct memblock_device counters_mem_56605 = ctx->constants->counters_mem_56605;
    struct memblock_device counters_mem_56764 = ctx->constants->counters_mem_56764;
    struct memblock_device counters_mem_56815 = ctx->constants->counters_mem_56815;
    struct memblock_device counters_mem_56850 = ctx->constants->counters_mem_56850;
    struct memblock_device global_dynid_mem_54616 = ctx->constants->global_dynid_mem_54616;
    struct memblock_device global_dynid_mem_54626 = ctx->constants->global_dynid_mem_54626;
    struct memblock_device global_dynid_mem_54637 = ctx->constants->global_dynid_mem_54637;
    struct memblock_device global_dynid_mem_54642 = ctx->constants->global_dynid_mem_54642;
    struct memblock_device global_dynid_mem_54800 = ctx->constants->global_dynid_mem_54800;
    struct memblock_device global_dynid_mem_54871 = ctx->constants->global_dynid_mem_54871;
    struct memblock_device global_dynid_mem_54920 = ctx->constants->global_dynid_mem_54920;
    struct memblock_device global_dynid_mem_55083 = ctx->constants->global_dynid_mem_55083;
    struct memblock_device global_dynid_mem_55112 = ctx->constants->global_dynid_mem_55112;
    struct memblock_device global_dynid_mem_55221 = ctx->constants->global_dynid_mem_55221;
    struct memblock_device global_dynid_mem_55228 = ctx->constants->global_dynid_mem_55228;
    struct memblock_device global_dynid_mem_55334 = ctx->constants->global_dynid_mem_55334;
    struct memblock_device global_dynid_mem_55338 = ctx->constants->global_dynid_mem_55338;
    struct memblock_device global_dynid_mem_55581 = ctx->constants->global_dynid_mem_55581;
    struct memblock_device global_dynid_mem_55728 = ctx->constants->global_dynid_mem_55728;
    struct memblock_device global_dynid_mem_55884 = ctx->constants->global_dynid_mem_55884;
    struct memblock_device global_dynid_mem_56002 = ctx->constants->global_dynid_mem_56002;
    struct memblock_device global_dynid_mem_56151 = ctx->constants->global_dynid_mem_56151;
    struct memblock_device global_dynid_mem_56269 = ctx->constants->global_dynid_mem_56269;
    struct memblock_device global_dynid_mem_56425 = ctx->constants->global_dynid_mem_56425;
    int64_t replicate_n_54546 = num_elems_54543;
    int64_t tblock_sizze_54551;
    
    tblock_sizze_54551 = *ctx->tuning_params.builtinzhreplicate_i64zitblock_sizze_54551;
    
    int64_t virt_num_tblocks_54552 = sdiv_up64(replicate_n_54546, tblock_sizze_54551);
    int64_t num_tblocks_54553 = smin64(virt_num_tblocks_54552, (int64_t) 1048576);
    
    {
        err = gpu_kernel_builtinzhreplicate_i64zireplicate_54547(ctx, num_tblocks_54553, 1, 1, tblock_sizze_54551, 1, 1, (int64_t) 0, num_elems_54543, val_54544, replicate_n_54546, virt_num_tblocks_54552, num_tblocks_54553, mem_54542.mem);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
  cleanup:
    { }
    return err;
}
FUTHARK_FUN_ATTR int futrts_builtinzhreplicate_i8(struct futhark_context *ctx, struct memblock_device mem_54592, int64_t num_elems_54593, int8_t val_54594)
{
    (void) ctx;
    
    int err = 0;
    struct memblock_device counters_mem_54551 = ctx->constants->counters_mem_54551;
    struct memblock_device counters_mem_54625 = ctx->constants->counters_mem_54625;
    struct memblock_device counters_mem_55050 = ctx->constants->counters_mem_55050;
    struct memblock_device counters_mem_55495 = ctx->constants->counters_mem_55495;
    struct memblock_device counters_mem_55534 = ctx->constants->counters_mem_55534;
    struct memblock_device counters_mem_55581 = ctx->constants->counters_mem_55581;
    struct memblock_device counters_mem_56605 = ctx->constants->counters_mem_56605;
    struct memblock_device counters_mem_56764 = ctx->constants->counters_mem_56764;
    struct memblock_device counters_mem_56815 = ctx->constants->counters_mem_56815;
    struct memblock_device counters_mem_56850 = ctx->constants->counters_mem_56850;
    struct memblock_device global_dynid_mem_54616 = ctx->constants->global_dynid_mem_54616;
    struct memblock_device global_dynid_mem_54626 = ctx->constants->global_dynid_mem_54626;
    struct memblock_device global_dynid_mem_54637 = ctx->constants->global_dynid_mem_54637;
    struct memblock_device global_dynid_mem_54642 = ctx->constants->global_dynid_mem_54642;
    struct memblock_device global_dynid_mem_54800 = ctx->constants->global_dynid_mem_54800;
    struct memblock_device global_dynid_mem_54871 = ctx->constants->global_dynid_mem_54871;
    struct memblock_device global_dynid_mem_54920 = ctx->constants->global_dynid_mem_54920;
    struct memblock_device global_dynid_mem_55083 = ctx->constants->global_dynid_mem_55083;
    struct memblock_device global_dynid_mem_55112 = ctx->constants->global_dynid_mem_55112;
    struct memblock_device global_dynid_mem_55221 = ctx->constants->global_dynid_mem_55221;
    struct memblock_device global_dynid_mem_55228 = ctx->constants->global_dynid_mem_55228;
    struct memblock_device global_dynid_mem_55334 = ctx->constants->global_dynid_mem_55334;
    struct memblock_device global_dynid_mem_55338 = ctx->constants->global_dynid_mem_55338;
    struct memblock_device global_dynid_mem_55581 = ctx->constants->global_dynid_mem_55581;
    struct memblock_device global_dynid_mem_55728 = ctx->constants->global_dynid_mem_55728;
    struct memblock_device global_dynid_mem_55884 = ctx->constants->global_dynid_mem_55884;
    struct memblock_device global_dynid_mem_56002 = ctx->constants->global_dynid_mem_56002;
    struct memblock_device global_dynid_mem_56151 = ctx->constants->global_dynid_mem_56151;
    struct memblock_device global_dynid_mem_56269 = ctx->constants->global_dynid_mem_56269;
    struct memblock_device global_dynid_mem_56425 = ctx->constants->global_dynid_mem_56425;
    int64_t replicate_n_54596 = num_elems_54593;
    int64_t tblock_sizze_54601;
    
    tblock_sizze_54601 = *ctx->tuning_params.builtinzhreplicate_i8zitblock_sizze_54601;
    
    int64_t virt_num_tblocks_54602 = sdiv_up64(replicate_n_54596, tblock_sizze_54601);
    int64_t num_tblocks_54603 = smin64(virt_num_tblocks_54602, (int64_t) 1048576);
    
    {
        err = gpu_kernel_builtinzhreplicate_i8zireplicate_54597(ctx, num_tblocks_54603, 1, 1, tblock_sizze_54601, 1, 1, (int64_t) 0, num_elems_54593, val_54594, replicate_n_54596, virt_num_tblocks_54602, num_tblocks_54603, mem_54592.mem);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
  cleanup:
    { }
    return err;
}
FUTHARK_FUN_ATTR int futrts_entry_add_next_partition_double(struct futhark_context *ctx, struct memblock_device *mem_out_p_56891, struct memblock_device *mem_out_p_56892, struct memblock_device *mem_out_p_56893, struct memblock_device *mem_out_p_56894, struct memblock_device *mem_out_p_56895, struct memblock_device *mem_out_p_56896, struct memblock_device *mem_out_p_56897, struct memblock_device *mem_out_p_56898, struct memblock_device *mem_out_p_56899, struct memblock_device *mem_out_p_56900, struct memblock_device *mem_out_p_56901, struct memblock_device *mem_out_p_56902, struct memblock_device *mem_out_p_56903, struct memblock_device *mem_out_p_56904, struct memblock_device *mem_out_p_56905, struct memblock_device *mem_out_p_56906, struct memblock_device *mem_out_p_56907, struct memblock_device *mem_out_p_56908, struct memblock_device *mem_out_p_56909, struct memblock_device *mem_out_p_56910, struct memblock_device *mem_out_p_56911, struct memblock_device *mem_out_p_56912, struct memblock_device *mem_out_p_56913, struct memblock_device *mem_out_p_56914, struct memblock_device *mem_out_p_56915, struct memblock_device *mem_out_p_56916, struct memblock_device *mem_out_p_56917, int64_t *out_prim_out_56918, int64_t *out_prim_out_56919, int64_t *out_prim_out_56920, int8_t *out_prim_out_56921, int8_t *out_prim_out_56922, double *out_prim_out_56923, int64_t *out_prim_out_56924, int64_t *out_prim_out_56925, double *out_prim_out_56926, int64_t *out_prim_out_56927, int64_t *out_prim_out_56928, int64_t *out_prim_out_56929, int64_t *out_prim_out_56930, int64_t *out_prim_out_56931, int64_t *out_prim_out_56932, int64_t *out_prim_out_56933, struct memblock_device chain_collisions_mem_53506, struct memblock_device chain_collisions_mem_53507, struct memblock_device clBase_mem_53508, struct memblock_device clBase_mem_53509, struct memblock_device clBase_mem_53510, struct memblock_device clBase_mem_53511, struct memblock_device clProc_mem_53512, struct memblock_device clProc_mem_53513, struct memblock_device clProc_mem_53514, struct memblock_device clProc_mem_53515, struct memblock_device clProc_mem_53516, struct memblock_device clProc_mem_53517, struct memblock_device current_partition_mem_53518, struct memblock_device current_partition_mem_53519, struct memblock_device current_partition_mem_53520, struct memblock_device current_partition_mem_53521, struct memblock_device current_partition_mem_53522, struct memblock_device current_partition_mem_53523, struct memblock_device current_partition_mem_53524, struct memblock_device current_partition_mem_53525, struct memblock_device current_partition_mem_53526, struct memblock_device current_partition_mem_53527, struct memblock_device current_partition_mem_53528, struct memblock_device current_partition_mem_53529, struct memblock_device toFlush_dat_mem_53530, struct memblock_device toFlush_dat_mem_53531, struct memblock_device toFlush_ids_mem_53532, struct memblock_device new_xs_mem_53533, struct memblock_device new_ys_mem_53534, int64_t n_old_28413, int64_t part_no_28414, int64_t dz2084U_28415, int64_t dz2080U_28416, int64_t dz2081U_28417, int64_t dz2082U_28418, int64_t dz2083U_28419, int64_t dz2085U_28420, int64_t dz2086U_28421, int64_t n_new_28422, int8_t clBase_28425, int8_t clBase_28426, double clBase_28427, int64_t clBase_28428, int64_t clBase_28430, double clBase_28433, int64_t clBase_28435, int64_t clProc_28440, int64_t clProc_28441, int64_t clProc_28442, int64_t clProc_28444, int64_t clProc_28445, int64_t current_partition_28459, int64_t new_id_28463)
{
    (void) ctx;
    
    int err = 0;
    struct memblock_device mem_53734;
    
    mem_53734.references = NULL;
    
    struct memblock_device mem_53733;
    
    mem_53733.references = NULL;
    
    struct memblock_device mem_53732;
    
    mem_53732.references = NULL;
    
    struct memblock_device mem_53731;
    
    mem_53731.references = NULL;
    
    struct memblock_device mem_53730;
    
    mem_53730.references = NULL;
    
    struct memblock_device mem_53728;
    
    mem_53728.references = NULL;
    
    struct memblock_device mem_53726;
    
    mem_53726.references = NULL;
    
    struct memblock_device mem_53717;
    
    mem_53717.references = NULL;
    
    struct memblock_device mem_53715;
    
    mem_53715.references = NULL;
    
    struct memblock_device mem_53714;
    
    mem_53714.references = NULL;
    
    struct memblock_device mem_53712;
    
    mem_53712.references = NULL;
    
    struct memblock_device mem_53701;
    
    mem_53701.references = NULL;
    
    struct memblock_device segred_tmp_mem_55579;
    
    segred_tmp_mem_55579.references = NULL;
    
    struct memblock_device mem_53672;
    
    mem_53672.references = NULL;
    
    struct memblock_device mem_53698;
    
    mem_53698.references = NULL;
    
    struct memblock_device ext_mem_53699;
    
    ext_mem_53699.references = NULL;
    
    struct memblock_device mem_53669;
    
    mem_53669.references = NULL;
    
    struct memblock_device mem_53662;
    
    mem_53662.references = NULL;
    
    struct memblock_device mem_53577;
    
    mem_53577.references = NULL;
    
    struct memblock_device mem_53575;
    
    mem_53575.references = NULL;
    
    struct memblock_device mem_53574;
    
    mem_53574.references = NULL;
    
    struct memblock_device mem_53538;
    
    mem_53538.references = NULL;
    
    struct memblock_device mem_53536;
    
    mem_53536.references = NULL;
    
    struct memblock_device incprefixes_mem_55332;
    
    incprefixes_mem_55332.references = NULL;
    
    struct memblock_device aggregates_mem_55330;
    
    aggregates_mem_55330.references = NULL;
    
    struct memblock_device incprefixes_mem_55328;
    
    incprefixes_mem_55328.references = NULL;
    
    struct memblock_device aggregates_mem_55326;
    
    aggregates_mem_55326.references = NULL;
    
    struct memblock_device status_flags_mem_55324;
    
    status_flags_mem_55324.references = NULL;
    
    struct memblock_device mem_53708;
    
    mem_53708.references = NULL;
    
    struct memblock_device mem_53706;
    
    mem_53706.references = NULL;
    
    struct memblock_device mem_53704;
    
    mem_53704.references = NULL;
    
    struct memblock_device incprefixes_mem_55226;
    
    incprefixes_mem_55226.references = NULL;
    
    struct memblock_device aggregates_mem_55224;
    
    aggregates_mem_55224.references = NULL;
    
    struct memblock_device status_flags_mem_55222;
    
    status_flags_mem_55222.references = NULL;
    
    struct memblock_device mem_53667;
    
    mem_53667.references = NULL;
    
    struct memblock_device mem_53665;
    
    mem_53665.references = NULL;
    
    struct memblock_device mem_53659;
    
    mem_53659.references = NULL;
    
    struct memblock_device incprefixes_mem_55110;
    
    incprefixes_mem_55110.references = NULL;
    
    struct memblock_device aggregates_mem_55108;
    
    aggregates_mem_55108.references = NULL;
    
    struct memblock_device status_flags_mem_55106;
    
    status_flags_mem_55106.references = NULL;
    
    struct memblock_device mem_53648;
    
    mem_53648.references = NULL;
    
    struct memblock_device mem_53646;
    
    mem_53646.references = NULL;
    
    struct memblock_device mem_53600;
    
    mem_53600.references = NULL;
    
    struct memblock_device mem_53599;
    
    mem_53599.references = NULL;
    
    struct memblock_device segred_tmp_mem_55048;
    
    segred_tmp_mem_55048.references = NULL;
    
    struct memblock_device mem_53597;
    
    mem_53597.references = NULL;
    
    struct memblock_device mem_53595;
    
    mem_53595.references = NULL;
    
    struct memblock_device mem_53604;
    
    mem_53604.references = NULL;
    
    struct memblock_device mem_53603;
    
    mem_53603.references = NULL;
    
    struct memblock_device mem_53602;
    
    mem_53602.references = NULL;
    
    struct memblock_device ext_mem_53605;
    
    ext_mem_53605.references = NULL;
    
    struct memblock_device ext_mem_53606;
    
    ext_mem_53606.references = NULL;
    
    struct memblock_device ext_mem_53607;
    
    ext_mem_53607.references = NULL;
    
    struct memblock_device mem_53642;
    
    mem_53642.references = NULL;
    
    struct memblock_device mem_53641;
    
    mem_53641.references = NULL;
    
    struct memblock_device mem_53640;
    
    mem_53640.references = NULL;
    
    struct memblock_device ext_mem_53643;
    
    ext_mem_53643.references = NULL;
    
    struct memblock_device ext_mem_53644;
    
    ext_mem_53644.references = NULL;
    
    struct memblock_device ext_mem_53645;
    
    ext_mem_53645.references = NULL;
    
    struct memblock_device ext_mem_53654;
    
    ext_mem_53654.references = NULL;
    
    struct memblock_device ext_mem_53655;
    
    ext_mem_53655.references = NULL;
    
    struct memblock_device ext_mem_53656;
    
    ext_mem_53656.references = NULL;
    
    struct memblock_device ext_mem_53657;
    
    ext_mem_53657.references = NULL;
    
    struct memblock_device mem_53593;
    
    mem_53593.references = NULL;
    
    struct memblock_device mem_53592;
    
    mem_53592.references = NULL;
    
    struct memblock_device mem_53591;
    
    mem_53591.references = NULL;
    
    struct memblock_device mem_53590;
    
    mem_53590.references = NULL;
    
    struct memblock_device mem_53589;
    
    mem_53589.references = NULL;
    
    struct memblock_device mem_53588;
    
    mem_53588.references = NULL;
    
    struct memblock_device mem_53587;
    
    mem_53587.references = NULL;
    
    struct memblock_device mem_53586;
    
    mem_53586.references = NULL;
    
    struct memblock_device mem_53585;
    
    mem_53585.references = NULL;
    
    struct memblock_device mem_53584;
    
    mem_53584.references = NULL;
    
    struct memblock_device mem_53583;
    
    mem_53583.references = NULL;
    
    struct memblock_device mem_53582;
    
    mem_53582.references = NULL;
    
    struct memblock_device mem_53581;
    
    mem_53581.references = NULL;
    
    struct memblock_device mem_53580;
    
    mem_53580.references = NULL;
    
    struct memblock_device mem_53579;
    
    mem_53579.references = NULL;
    
    struct memblock_device mem_53578;
    
    mem_53578.references = NULL;
    
    struct memblock_device mem_53570;
    
    mem_53570.references = NULL;
    
    struct memblock_device mem_53571;
    
    mem_53571.references = NULL;
    
    struct memblock_device ext_mem_53572;
    
    ext_mem_53572.references = NULL;
    
    struct memblock_device mem_53567;
    
    mem_53567.references = NULL;
    
    struct memblock_device mem_53568;
    
    mem_53568.references = NULL;
    
    struct memblock_device ext_mem_53569;
    
    ext_mem_53569.references = NULL;
    
    struct memblock_device mem_53564;
    
    mem_53564.references = NULL;
    
    struct memblock_device mem_53565;
    
    mem_53565.references = NULL;
    
    struct memblock_device ext_mem_53566;
    
    ext_mem_53566.references = NULL;
    
    struct memblock_device mem_53561;
    
    mem_53561.references = NULL;
    
    struct memblock_device mem_53562;
    
    mem_53562.references = NULL;
    
    struct memblock_device ext_mem_53563;
    
    ext_mem_53563.references = NULL;
    
    struct memblock_device mem_53558;
    
    mem_53558.references = NULL;
    
    struct memblock_device mem_53559;
    
    mem_53559.references = NULL;
    
    struct memblock_device ext_mem_53560;
    
    ext_mem_53560.references = NULL;
    
    struct memblock_device mem_53555;
    
    mem_53555.references = NULL;
    
    struct memblock_device mem_53556;
    
    mem_53556.references = NULL;
    
    struct memblock_device ext_mem_53557;
    
    ext_mem_53557.references = NULL;
    
    struct memblock_device mem_53553;
    
    mem_53553.references = NULL;
    
    struct memblock_device mem_53551;
    
    mem_53551.references = NULL;
    
    struct memblock_device mem_53550;
    
    mem_53550.references = NULL;
    
    struct memblock_device mem_53548;
    
    mem_53548.references = NULL;
    
    struct memblock_device incprefixes_mem_54624;
    
    incprefixes_mem_54624.references = NULL;
    
    struct memblock_device aggregates_mem_54622;
    
    aggregates_mem_54622.references = NULL;
    
    struct memblock_device incprefixes_mem_54620;
    
    incprefixes_mem_54620.references = NULL;
    
    struct memblock_device aggregates_mem_54618;
    
    aggregates_mem_54618.references = NULL;
    
    struct memblock_device status_flags_mem_54596;
    
    status_flags_mem_54596.references = NULL;
    
    struct memblock_device mem_53546;
    
    mem_53546.references = NULL;
    
    struct memblock_device mem_53544;
    
    mem_53544.references = NULL;
    
    struct memblock_device mem_53542;
    
    mem_53542.references = NULL;
    
    struct memblock_device mem_53539;
    
    mem_53539.references = NULL;
    
    struct memblock_device mem_out_54567;
    
    mem_out_54567.references = NULL;
    
    struct memblock_device mem_out_54566;
    
    mem_out_54566.references = NULL;
    
    struct memblock_device mem_out_54565;
    
    mem_out_54565.references = NULL;
    
    struct memblock_device mem_out_54564;
    
    mem_out_54564.references = NULL;
    
    struct memblock_device mem_out_54563;
    
    mem_out_54563.references = NULL;
    
    struct memblock_device mem_out_54562;
    
    mem_out_54562.references = NULL;
    
    struct memblock_device mem_out_54561;
    
    mem_out_54561.references = NULL;
    
    struct memblock_device mem_out_54560;
    
    mem_out_54560.references = NULL;
    
    struct memblock_device mem_out_54559;
    
    mem_out_54559.references = NULL;
    
    struct memblock_device mem_out_54558;
    
    mem_out_54558.references = NULL;
    
    struct memblock_device mem_out_54557;
    
    mem_out_54557.references = NULL;
    
    struct memblock_device mem_out_54556;
    
    mem_out_54556.references = NULL;
    
    struct memblock_device mem_out_54555;
    
    mem_out_54555.references = NULL;
    
    struct memblock_device mem_out_54554;
    
    mem_out_54554.references = NULL;
    
    struct memblock_device mem_out_54553;
    
    mem_out_54553.references = NULL;
    
    struct memblock_device mem_out_54552;
    
    mem_out_54552.references = NULL;
    
    struct memblock_device mem_out_54551;
    
    mem_out_54551.references = NULL;
    
    struct memblock_device mem_out_54550;
    
    mem_out_54550.references = NULL;
    
    struct memblock_device mem_out_54549;
    
    mem_out_54549.references = NULL;
    
    struct memblock_device mem_out_54548;
    
    mem_out_54548.references = NULL;
    
    struct memblock_device mem_out_54547;
    
    mem_out_54547.references = NULL;
    
    struct memblock_device mem_out_54546;
    
    mem_out_54546.references = NULL;
    
    struct memblock_device mem_out_54545;
    
    mem_out_54545.references = NULL;
    
    struct memblock_device mem_out_54544;
    
    mem_out_54544.references = NULL;
    
    struct memblock_device mem_out_54543;
    
    mem_out_54543.references = NULL;
    
    struct memblock_device mem_out_54542;
    
    mem_out_54542.references = NULL;
    
    struct memblock_device mem_out_54541;
    
    mem_out_54541.references = NULL;
    
    struct memblock_device counters_mem_54551 = ctx->constants->counters_mem_54551;
    struct memblock_device counters_mem_54625 = ctx->constants->counters_mem_54625;
    struct memblock_device counters_mem_55050 = ctx->constants->counters_mem_55050;
    struct memblock_device counters_mem_55495 = ctx->constants->counters_mem_55495;
    struct memblock_device counters_mem_55534 = ctx->constants->counters_mem_55534;
    struct memblock_device counters_mem_55581 = ctx->constants->counters_mem_55581;
    struct memblock_device counters_mem_56605 = ctx->constants->counters_mem_56605;
    struct memblock_device counters_mem_56764 = ctx->constants->counters_mem_56764;
    struct memblock_device counters_mem_56815 = ctx->constants->counters_mem_56815;
    struct memblock_device counters_mem_56850 = ctx->constants->counters_mem_56850;
    struct memblock_device global_dynid_mem_54616 = ctx->constants->global_dynid_mem_54616;
    struct memblock_device global_dynid_mem_54626 = ctx->constants->global_dynid_mem_54626;
    struct memblock_device global_dynid_mem_54637 = ctx->constants->global_dynid_mem_54637;
    struct memblock_device global_dynid_mem_54642 = ctx->constants->global_dynid_mem_54642;
    struct memblock_device global_dynid_mem_54800 = ctx->constants->global_dynid_mem_54800;
    struct memblock_device global_dynid_mem_54871 = ctx->constants->global_dynid_mem_54871;
    struct memblock_device global_dynid_mem_54920 = ctx->constants->global_dynid_mem_54920;
    struct memblock_device global_dynid_mem_55083 = ctx->constants->global_dynid_mem_55083;
    struct memblock_device global_dynid_mem_55112 = ctx->constants->global_dynid_mem_55112;
    struct memblock_device global_dynid_mem_55221 = ctx->constants->global_dynid_mem_55221;
    struct memblock_device global_dynid_mem_55228 = ctx->constants->global_dynid_mem_55228;
    struct memblock_device global_dynid_mem_55334 = ctx->constants->global_dynid_mem_55334;
    struct memblock_device global_dynid_mem_55338 = ctx->constants->global_dynid_mem_55338;
    struct memblock_device global_dynid_mem_55581 = ctx->constants->global_dynid_mem_55581;
    struct memblock_device global_dynid_mem_55728 = ctx->constants->global_dynid_mem_55728;
    struct memblock_device global_dynid_mem_55884 = ctx->constants->global_dynid_mem_55884;
    struct memblock_device global_dynid_mem_56002 = ctx->constants->global_dynid_mem_56002;
    struct memblock_device global_dynid_mem_56151 = ctx->constants->global_dynid_mem_56151;
    struct memblock_device global_dynid_mem_56269 = ctx->constants->global_dynid_mem_56269;
    struct memblock_device global_dynid_mem_56425 = ctx->constants->global_dynid_mem_56425;
    int64_t prim_out_54568;
    int64_t prim_out_54569;
    int64_t prim_out_54570;
    int8_t prim_out_54571;
    int8_t prim_out_54572;
    double prim_out_54573;
    int64_t prim_out_54574;
    int64_t prim_out_54575;
    double prim_out_54576;
    int64_t prim_out_54577;
    int64_t prim_out_54578;
    int64_t prim_out_54579;
    int64_t prim_out_54580;
    int64_t prim_out_54581;
    int64_t prim_out_54582;
    int64_t prim_out_54583;
    double zt_res_40980 = 2.0 * clBase_28427;
    int64_t bytes_53535 = (int64_t) 8 * n_new_28422;
    bool suff_outer_screma_45769;
    
    suff_outer_screma_45769 = *ctx->tuning_params.add_next_partition_doublezisuff_outer_screma_0 <= (int64_t) 8;
    if (ctx->logging)
        fprintf(ctx->log, "Compared %s <= %ld: %s.\n", "add_next_partition_double.suff_outer_screma_0", (long) (int64_t) 8, suff_outer_screma_45769 ? "true" : "false");
    
    bool suff_outer_par_46236;
    
    suff_outer_par_46236 = *ctx->tuning_params.add_next_partition_doublezisuff_outer_par_1 <= (int64_t) 8;
    if (ctx->logging)
        fprintf(ctx->log, "Compared %s <= %ld: %s.\n", "add_next_partition_double.suff_outer_par_1", (long) (int64_t) 8, suff_outer_par_46236 ? "true" : "false");
    
    int64_t intra_avail_par_46237 = smin64(dz2083U_28419, n_new_28422);
    int64_t computed_tblock_sizze_46238 = smax64(dz2083U_28419, n_new_28422);
    int64_t max_tblock_sizze_46240;
    
    max_tblock_sizze_46240 = ctx->max_thread_block_size;
    
    bool fits_46241 = sle64(computed_tblock_sizze_46238, max_tblock_sizze_46240);
    bool suff_intra_par_46243;
    
    suff_intra_par_46243 = *ctx->tuning_params.add_next_partition_doublezisuff_intra_par_2 <= intra_avail_par_46237;
    if (ctx->logging)
        fprintf(ctx->log, "Compared %s <= %ld: %s.\n", "add_next_partition_double.suff_intra_par_2", (long) intra_avail_par_46237, suff_intra_par_46243 ? "true" : "false");
    
    bool intra_suff_and_fits_46244 = fits_46241 && suff_intra_par_46243;
    int64_t segmap_tblock_sizze_46375;
    
    segmap_tblock_sizze_46375 = *ctx->tuning_params.add_next_partition_doublezisegmap_tblock_sizze_46132;
    
    int64_t nest_sizze_46388 = (int64_t) 8 * dz2083U_28419;
    int64_t segred_tblock_sizze_46389;
    
    segred_tblock_sizze_46389 = *ctx->tuning_params.add_next_partition_doublezisegred_tblock_sizze_46113;
    
    int64_t num_tblocks_46390;
    int64_t max_num_tblocks_54584;
    
    max_num_tblocks_54584 = *ctx->tuning_params.add_next_partition_doublezisegred_num_tblocks_46115;
    num_tblocks_46390 = sext_i64_i32(smax64((int64_t) 1, smin64(sdiv_up64(nest_sizze_46388, segred_tblock_sizze_46389), max_num_tblocks_54584)));
    
    int64_t segmap_tblock_sizze_46403;
    
    segmap_tblock_sizze_46403 = *ctx->tuning_params.add_next_partition_doublezisegmap_tblock_sizze_46063;
    
    int64_t segmap_usable_groups_46404 = sdiv_up_safe64((int64_t) 8, segmap_tblock_sizze_46403);
    int64_t segscan_tblock_sizze_46456;
    
    segscan_tblock_sizze_46456 = *ctx->tuning_params.add_next_partition_doublezisegscan_tblock_sizze_46228;
    
    int64_t num_tblocks_46457;
    int64_t max_num_tblocks_54585;
    
    max_num_tblocks_54585 = *ctx->tuning_params.add_next_partition_doublezisegscan_num_tblocks_46230;
    num_tblocks_46457 = sext_i64_i32(smax64((int64_t) 1, smin64(sdiv_up64((int64_t) 8, segscan_tblock_sizze_46456), max_num_tblocks_54585)));
    
    int64_t segscan_tblock_sizze_45779;
    
    segscan_tblock_sizze_45779 = *ctx->tuning_params.add_next_partition_doublezisegscan_tblock_sizze_45771;
    
    int64_t num_tblocks_45780;
    int64_t max_num_tblocks_54586;
    
    max_num_tblocks_54586 = *ctx->tuning_params.add_next_partition_doublezisegscan_num_tblocks_45773;
    num_tblocks_45780 = sext_i64_i32(smax64((int64_t) 1, smin64(sdiv_up64((int64_t) 8, segscan_tblock_sizze_45779), max_num_tblocks_54586)));
    
    int64_t tile_sizze_49826;
    
    tile_sizze_49826 = *ctx->tuning_params.add_next_partition_doublezitile_sizze_49825;
    
    int64_t ldim_49827 = sdiv_up_safe64((int64_t) 8, tile_sizze_49826);
    int64_t num_whole_tiles_49841 = squot_safe64(dz2083U_28419, tile_sizze_49826);
    int64_t residual_input_49922 = srem_safe64(dz2083U_28419, tile_sizze_49826);
    bool cond_49923 = residual_input_49922 == (int64_t) 0;
    int64_t binop_x_49933 = tile_sizze_49826 * num_whole_tiles_49841;
    
    if (memblock_alloc_device(ctx, &mem_53539, part_no_28414, "mem_53539")) {
        err = 1;
        goto cleanup;
    }
    if ((err = lmad_copy_gpu2gpu_1b(ctx, 1, mem_53539.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, clProc_mem_53516.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, (int64_t []) {part_no_28414})) != 0)
        goto cleanup;
    
    bool x_41034 = sle64((int64_t) 0, new_id_28463);
    bool y_41035 = slt64(new_id_28463, part_no_28414);
    bool bounds_check_41036 = x_41034 && y_41035;
    bool index_certs_41037;
    
    if (!bounds_check_41036) {
        set_error(ctx, msgprintf("Error: %s%lld%s%lld%s\n\nBacktrace:\n%s", "Index [", (long long) new_id_28463, "] out of bounds for array of shape [", (long long) part_no_28414, "].", "-> #0  ft_libs/ftDBSCAN_plus.fut:283:49-97\n   #1  ft_libs/ftDBSCAN_plus.fut:877:18-882:84\n   #2  ft_libs/ftDBSCAN_plus.fut:876:9-882:84\n"));
        err = FUTHARK_PROGRAM_ERROR;
        goto cleanup;
    }
    
    bool write_tmp_56934 = 1;
    
    if ((err = gpu_scalar_to_device(ctx, mem_53539.mem, new_id_28463 * sizeof(bool), sizeof(bool), &write_tmp_56934)) != 0)
        goto cleanup;
    
    int64_t segmap_tblock_sizze_46474;
    
    segmap_tblock_sizze_46474 = *ctx->tuning_params.add_next_partition_doublezisegmap_tblock_sizze_46473;
    
    int64_t num_tblocks_46476;
    int64_t max_num_tblocks_54587;
    
    max_num_tblocks_54587 = *ctx->tuning_params.add_next_partition_doublezisegmap_num_tblocks_46475;
    num_tblocks_46476 = sext_i64_i32(smax64((int64_t) 1, smin64(sdiv_up64((int64_t) 8, segmap_tblock_sizze_46474), max_num_tblocks_54587)));
    
    int64_t segscan_tblock_sizze_46480;
    
    segscan_tblock_sizze_46480 = *ctx->tuning_params.add_next_partition_doublezisegscan_tblock_sizze_46479;
    
    int64_t segscan_tblock_sizze_46779;
    
    segscan_tblock_sizze_46779 = *ctx->tuning_params.add_next_partition_doublezisegscan_tblock_sizze_46778;
    
    int64_t num_tblocks_46781;
    int64_t max_num_tblocks_54588;
    
    max_num_tblocks_54588 = *ctx->tuning_params.add_next_partition_doublezisegscan_num_tblocks_46780;
    num_tblocks_46781 = sext_i64_i32(smax64((int64_t) 1, smin64(sdiv_up64(n_old_28413, segscan_tblock_sizze_46779), max_num_tblocks_54588)));
    
    int64_t bytes_53541 = (int64_t) 8 * n_old_28413;
    
    if (memblock_alloc_device(ctx, &mem_53542, bytes_53541, "mem_53542")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_53544, bytes_53541, "mem_53544")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_53546, bytes_53541, "mem_53546")) {
        err = 1;
        goto cleanup;
    }
    if (slt64((int64_t) 0, n_old_28413)) {
        if (ctx->debugging)
            fprintf(ctx->log, "%s\n", "\n# SegScan");
        
        int64_t shared_memory_54589;
        
        shared_memory_54589 = ctx->max_shared_memory;
        
        int64_t thread_block_sizze_54590;
        
        thread_block_sizze_54590 = ctx->max_thread_block_size;
        
        int64_t registers_54591;
        
        registers_54591 = ctx->max_registers;
        
        int64_t thread_block_sizze_54592;
        
        thread_block_sizze_54592 = ctx->max_thread_block_size;
        
        int64_t chunk_sizze_54593 = smax64((int64_t) 1, smin64(squot64(squot64(shared_memory_54589, thread_block_sizze_54590), (int64_t) 8), squot64(squot64(registers_54591, thread_block_sizze_54592) - (int64_t) 1 - squot64(smax64((int64_t) 4, (int64_t) 8) + smax64((int64_t) 4, (int64_t) 8), (int64_t) 4), (int64_t) 2 * squot64(smax64((int64_t) 4, (int64_t) 8) + smax64((int64_t) 4, (int64_t) 8), (int64_t) 4))));
        int64_t num_virt_blocks_54594 = sdiv_up64(n_old_28413, segscan_tblock_sizze_46779 * chunk_sizze_54593);
        int64_t num_virt_threads_54595 = num_virt_blocks_54594 * segscan_tblock_sizze_46779;
        
        if (ctx->debugging)
            fprintf(ctx->log, "%s: %llu%c", "Sequential elements per thread (chunk)", (long long) chunk_sizze_54593, '\n');
        if (memblock_alloc_device(ctx, &status_flags_mem_54596, num_virt_blocks_54594, "status_flags_mem_54596")) {
            err = 1;
            goto cleanup;
        }
        if (futrts_builtinzhreplicate_i8(ctx, status_flags_mem_54596, num_virt_blocks_54594, (int8_t) 0) != 0) {
            err = 1;
            goto cleanup;
        }
        if (memblock_alloc_device(ctx, &aggregates_mem_54618, (int64_t) 8 * num_virt_blocks_54594, "aggregates_mem_54618")) {
            err = 1;
            goto cleanup;
        }
        if (memblock_alloc_device(ctx, &incprefixes_mem_54620, (int64_t) 8 * num_virt_blocks_54594, "incprefixes_mem_54620")) {
            err = 1;
            goto cleanup;
        }
        if (memblock_alloc_device(ctx, &aggregates_mem_54622, (int64_t) 8 * num_virt_blocks_54594, "aggregates_mem_54622")) {
            err = 1;
            goto cleanup;
        }
        if (memblock_alloc_device(ctx, &incprefixes_mem_54624, (int64_t) 8 * num_virt_blocks_54594, "incprefixes_mem_54624")) {
            err = 1;
            goto cleanup;
        }
        {
            err = gpu_kernel_add_next_partition_doublezisegscan_46784(ctx, num_tblocks_46781, 1, 1, *ctx->tuning_params.add_next_partition_doublezisegscan_tblock_sizze_46778, 1, 1, smax64(smax64((int64_t) 544, sdiv_up64((int64_t) 8 * segscan_tblock_sizze_46779, (int64_t) 8) * (int64_t) 8 + (int64_t) 8 * segscan_tblock_sizze_46779), smax64(chunk_sizze_54593 * segscan_tblock_sizze_46779 * (int64_t) 8, chunk_sizze_54593 * segscan_tblock_sizze_46779 * (int64_t) 8)) + srem64((int64_t) 8 - srem64(smax64(smax64((int64_t) 544, sdiv_up64((int64_t) 8 * segscan_tblock_sizze_46779, (int64_t) 8) * (int64_t) 8 + (int64_t) 8 * segscan_tblock_sizze_46779), smax64(chunk_sizze_54593 * segscan_tblock_sizze_46779 * (int64_t) 8, chunk_sizze_54593 * segscan_tblock_sizze_46779 * (int64_t) 8)), (int64_t) 8), (int64_t) 8), n_old_28413, num_tblocks_46781, num_virt_blocks_54594, num_virt_threads_54595, current_partition_mem_53524.mem, mem_53542.mem, mem_53544.mem, mem_53546.mem, status_flags_mem_54596.mem, aggregates_mem_54618.mem, incprefixes_mem_54620.mem, aggregates_mem_54622.mem, incprefixes_mem_54624.mem, global_dynid_mem_54626.mem);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        if (ctx->debugging)
            fprintf(ctx->log, "%s\n", "");
    }
    
    int64_t last_index_41326 = n_old_28413 - (int64_t) 1;
    bool is_empty_41327 = n_old_28413 == (int64_t) 0;
    bool x_41328 = !is_empty_41327;
    int64_t last_offset_41329;
    
    if (x_41328) {
        int64_t read_res_56935;
        
        if ((err = gpu_scalar_from_device(ctx, &read_res_56935, mem_53542.mem, last_index_41326 * sizeof(int64_t), sizeof(int64_t))) != 0)
            goto cleanup;
        if (ctx->failure_is_an_option && futhark_context_sync(ctx) != 0) {
            err = 1;
            goto cleanup;
        }
        
        int64_t x_45257 = read_res_56935;
        
        last_offset_41329 = x_45257;
    } else {
        last_offset_41329 = (int64_t) 0;
    }
    
    int64_t partition_sizze_41331;
    
    if (is_empty_41327) {
        partition_sizze_41331 = (int64_t) 0;
    } else {
        partition_sizze_41331 = last_offset_41329;
    }
    if (memblock_alloc_device(ctx, &mem_53548, bytes_53541, "mem_53548")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_53550, bytes_53541, "mem_53550")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_53551, n_old_28413, "mem_53551")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_53553, bytes_53541, "mem_53553")) {
        err = 1;
        goto cleanup;
    }
    
    int64_t y_41336 = (int64_t) -1 + partition_sizze_41331;
    int64_t segmap_tblock_sizze_46789;
    
    segmap_tblock_sizze_46789 = *ctx->tuning_params.add_next_partition_doublezisegmap_tblock_sizze_46788;
    
    int64_t num_tblocks_46791;
    int64_t max_num_tblocks_54781;
    
    max_num_tblocks_54781 = *ctx->tuning_params.add_next_partition_doublezisegmap_num_tblocks_46790;
    num_tblocks_46791 = sext_i64_i32(smax64((int64_t) 1, smin64(sdiv_up64(n_old_28413, segmap_tblock_sizze_46789), max_num_tblocks_54781)));
    if (ctx->debugging)
        fprintf(ctx->log, "%s\n", "\n# SegMap");
    
    int32_t virt_num_tblocks_54782 = sext_i64_i32(sdiv_up64(n_old_28413, segmap_tblock_sizze_46789));
    
    {
        err = gpu_kernel_add_next_partition_doublezisegmap_46786(ctx, num_tblocks_46791, 1, 1, *ctx->tuning_params.add_next_partition_doublezisegmap_tblock_sizze_46788, 1, 1, (int64_t) 0, n_old_28413, y_41336, num_tblocks_46791, virt_num_tblocks_54782, current_partition_mem_53518.mem, current_partition_mem_53519.mem, current_partition_mem_53520.mem, current_partition_mem_53523.mem, mem_53542.mem, mem_53544.mem, mem_53546.mem, mem_53548.mem, mem_53550.mem, mem_53551.mem, mem_53553.mem);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (ctx->debugging)
        fprintf(ctx->log, "%s\n", "");
    if (memblock_unref_device(ctx, &mem_53542, "mem_53542") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_53544, "mem_53544") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_53546, "mem_53546") != 0)
        return 1;
    
    bool eq_x_zz_41354 = (int64_t) 0 == last_offset_41329;
    bool p_and_eq_x_y_41355 = x_41328 && eq_x_zz_41354;
    bool empty_slice_41356 = is_empty_41327 || p_and_eq_x_y_41355;
    int64_t m_41357 = sub64(partition_sizze_41331, (int64_t) 1);
    bool zzero_leq_i_p_m_t_s_41358 = sle64((int64_t) 0, m_41357);
    bool i_p_m_t_s_leq_w_41359 = slt64(m_41357, n_old_28413);
    bool i_lte_j_41360 = sle64((int64_t) 0, partition_sizze_41331);
    bool y_41361 = zzero_leq_i_p_m_t_s_41358 && i_p_m_t_s_leq_w_41359;
    bool forwards_ok_41362 = i_lte_j_41360 && y_41361;
    bool ok_or_empty_41363 = empty_slice_41356 || forwards_ok_41362;
    bool index_certs_41364;
    
    if (!ok_or_empty_41363) {
        set_error(ctx, msgprintf("Error: %s%lld%s%lld%s%lld%s\n\nBacktrace:\n%s", "Index [", (long long) (int64_t) 0, ":", (long long) partition_sizze_41331, "] out of bounds for array of shape [", (long long) n_old_28413, "].", "-> #0  /prelude/soacs.fut:174:7-19\n   #1  /prelude/functional.fut:9:44-45\n   #2  ft_libs/ftDBSCAN_plus.fut:877:18-882:84\n   #3  ft_libs/ftDBSCAN_plus.fut:876:9-882:84\n"));
        err = FUTHARK_PROGRAM_ERROR;
        goto cleanup;
    }
    
    int64_t j_m_i_41365 = sub64(n_old_28413, partition_sizze_41331);
    bool empty_slice_41366 = j_m_i_41365 == (int64_t) 0;
    int64_t m_41367 = sub64(j_m_i_41365, (int64_t) 1);
    int64_t i_p_m_t_s_41368 = add64(partition_sizze_41331, m_41367);
    bool zzero_leq_i_p_m_t_s_41369 = sle64((int64_t) 0, i_p_m_t_s_41368);
    bool i_p_m_t_s_leq_w_41370 = slt64(i_p_m_t_s_41368, n_old_28413);
    bool i_lte_j_41371 = sle64(partition_sizze_41331, n_old_28413);
    bool y_41372 = zzero_leq_i_p_m_t_s_41369 && i_p_m_t_s_leq_w_41370;
    bool forwards_ok_41373 = i_lte_j_41371 && y_41372;
    bool ok_or_empty_41374 = empty_slice_41366 || forwards_ok_41373;
    bool index_certs_41375;
    
    if (!ok_or_empty_41374) {
        set_error(ctx, msgprintf("Error: %s%lld%s%lld%s%lld%s\n\nBacktrace:\n%s", "Index [", (long long) partition_sizze_41331, ":", (long long) n_old_28413, "] out of bounds for array of shape [", (long long) n_old_28413, "].", "-> #0  /prelude/soacs.fut:174:21-33\n   #1  /prelude/functional.fut:9:44-45\n   #2  ft_libs/ftDBSCAN_plus.fut:877:18-882:84\n   #3  ft_libs/ftDBSCAN_plus.fut:876:9-882:84\n"));
        err = FUTHARK_PROGRAM_ERROR;
        goto cleanup;
    }
    
    int64_t dzlz7bUZLzpZRz20Udz2082Uz20Udz2084Uz2088Uz2083Uz7dUzg_41379 = add64(dz2082U_28418, partition_sizze_41331);
    bool cond_41383 = slt64((int64_t) 0, dz2083U_28419);
    bool loop_not_taken_41387 = !cond_41383;
    
    if (cond_41383) {
        if (memblock_alloc_device(ctx, &mem_53556, (int64_t) 8, "mem_53556")) {
            err = 1;
            goto cleanup;
        }
        {
            err = gpu_kernel_add_next_partition_doublezigpuseq_54795(ctx, (int64_t) 1, 1, 1, (int64_t) 1, 1, 1, (int64_t) 0, clBase_mem_53511.mem, mem_53556.mem);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        if (memblock_set_device(ctx, &ext_mem_53557, &mem_53556, "mem_53556") != 0)
            return 1;
    } else {
        if (memblock_alloc_device(ctx, &mem_53555, (int64_t) 8, "mem_53555")) {
            err = 1;
            goto cleanup;
        }
        if (futrts_builtinzhreplicate_f64(ctx, mem_53555, (int64_t) 1, 0.0) != 0) {
            err = 1;
            goto cleanup;
        }
        if (memblock_set_device(ctx, &ext_mem_53557, &mem_53555, "mem_53555") != 0)
            return 1;
    }
    if (cond_41383) {
        if (memblock_alloc_device(ctx, &mem_53559, (int64_t) 8, "mem_53559")) {
            err = 1;
            goto cleanup;
        }
        {
            err = gpu_kernel_add_next_partition_doublezigpuseq_54821(ctx, (int64_t) 1, 1, 1, (int64_t) 1, 1, 1, (int64_t) 0, clBase_mem_53509.mem, mem_53559.mem);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        if (memblock_set_device(ctx, &ext_mem_53560, &mem_53559, "mem_53559") != 0)
            return 1;
    } else {
        if (memblock_alloc_device(ctx, &mem_53558, (int64_t) 8, "mem_53558")) {
            err = 1;
            goto cleanup;
        }
        if (futrts_builtinzhreplicate_f64(ctx, mem_53558, (int64_t) 1, 0.0) != 0) {
            err = 1;
            goto cleanup;
        }
        if (memblock_set_device(ctx, &ext_mem_53560, &mem_53558, "mem_53558") != 0)
            return 1;
    }
    if (cond_41383) {
        if (memblock_alloc_device(ctx, &mem_53562, (int64_t) 8, "mem_53562")) {
            err = 1;
            goto cleanup;
        }
        {
            err = gpu_kernel_add_next_partition_doublezigpuseq_54827(ctx, (int64_t) 1, 1, 1, (int64_t) 1, 1, 1, (int64_t) 0, clBase_mem_53511.mem, mem_53562.mem);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        if (memblock_set_device(ctx, &ext_mem_53563, &mem_53562, "mem_53562") != 0)
            return 1;
    } else {
        if (memblock_alloc_device(ctx, &mem_53561, (int64_t) 8, "mem_53561")) {
            err = 1;
            goto cleanup;
        }
        if (futrts_builtinzhreplicate_f64(ctx, mem_53561, (int64_t) 1, 0.0) != 0) {
            err = 1;
            goto cleanup;
        }
        if (memblock_set_device(ctx, &ext_mem_53563, &mem_53561, "mem_53561") != 0)
            return 1;
    }
    if (cond_41383) {
        if (memblock_alloc_device(ctx, &mem_53565, (int64_t) 8, "mem_53565")) {
            err = 1;
            goto cleanup;
        }
        {
            err = gpu_kernel_add_next_partition_doublezigpuseq_54833(ctx, (int64_t) 1, 1, 1, (int64_t) 1, 1, 1, (int64_t) 0, clBase_mem_53509.mem, mem_53565.mem);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        if (memblock_set_device(ctx, &ext_mem_53566, &mem_53565, "mem_53565") != 0)
            return 1;
    } else {
        if (memblock_alloc_device(ctx, &mem_53564, (int64_t) 8, "mem_53564")) {
            err = 1;
            goto cleanup;
        }
        if (futrts_builtinzhreplicate_f64(ctx, mem_53564, (int64_t) 1, 0.0) != 0) {
            err = 1;
            goto cleanup;
        }
        if (memblock_set_device(ctx, &ext_mem_53566, &mem_53564, "mem_53564") != 0)
            return 1;
    }
    if (cond_41383) {
        if (memblock_alloc_device(ctx, &mem_53568, (int64_t) 8, "mem_53568")) {
            err = 1;
            goto cleanup;
        }
        {
            err = gpu_kernel_add_next_partition_doublezigpuseq_54839(ctx, (int64_t) 1, 1, 1, (int64_t) 1, 1, 1, (int64_t) 0, clBase_mem_53511.mem, mem_53568.mem);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        if (memblock_set_device(ctx, &ext_mem_53569, &mem_53568, "mem_53568") != 0)
            return 1;
    } else {
        if (memblock_alloc_device(ctx, &mem_53567, (int64_t) 8, "mem_53567")) {
            err = 1;
            goto cleanup;
        }
        if (futrts_builtinzhreplicate_f64(ctx, mem_53567, (int64_t) 1, 0.0) != 0) {
            err = 1;
            goto cleanup;
        }
        if (memblock_set_device(ctx, &ext_mem_53569, &mem_53567, "mem_53567") != 0)
            return 1;
    }
    if (cond_41383) {
        if (memblock_alloc_device(ctx, &mem_53571, (int64_t) 8, "mem_53571")) {
            err = 1;
            goto cleanup;
        }
        {
            err = gpu_kernel_add_next_partition_doublezigpuseq_54845(ctx, (int64_t) 1, 1, 1, (int64_t) 1, 1, 1, (int64_t) 0, clBase_mem_53511.mem, mem_53571.mem);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        if (memblock_set_device(ctx, &ext_mem_53572, &mem_53571, "mem_53571") != 0)
            return 1;
    } else {
        if (memblock_alloc_device(ctx, &mem_53570, (int64_t) 8, "mem_53570")) {
            err = 1;
            goto cleanup;
        }
        if (futrts_builtinzhreplicate_f64(ctx, mem_53570, (int64_t) 1, 0.0) != 0) {
            err = 1;
            goto cleanup;
        }
        if (memblock_set_device(ctx, &ext_mem_53572, &mem_53570, "mem_53570") != 0)
            return 1;
    }
    
    int64_t segscan_tblock_sizze_46795;
    
    segscan_tblock_sizze_46795 = *ctx->tuning_params.add_next_partition_doublezisegscan_tblock_sizze_46794;
    
    int64_t num_tblocks_46797;
    int64_t max_num_tblocks_54851;
    
    max_num_tblocks_54851 = *ctx->tuning_params.add_next_partition_doublezisegscan_num_tblocks_46796;
    num_tblocks_46797 = sext_i64_i32(smax64((int64_t) 1, smin64(sdiv_up64(dzlz7bUZLzpZRz20Udz2082Uz20Udz2084Uz2088Uz2083Uz7dUzg_41379, segscan_tblock_sizze_46795), max_num_tblocks_54851)));
    
    int64_t last_index_41481 = dzlz7bUZLzpZRz20Udz2082Uz20Udz2084Uz2088Uz2083Uz7dUzg_41379 - (int64_t) 1;
    bool is_empty_41482 = dzlz7bUZLzpZRz20Udz2082Uz20Udz2084Uz2088Uz2083Uz7dUzg_41379 == (int64_t) 0;
    bool x_41483 = !is_empty_41482;
    int64_t bytes_53573 = (int64_t) 8 * dzlz7bUZLzpZRz20Udz2082Uz20Udz2084Uz2088Uz2083Uz7dUzg_41379;
    
    if (memblock_alloc_device(ctx, &mem_53578, (int64_t) 64, "mem_53578")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_53579, (int64_t) 16, "mem_53579")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_53580, (int64_t) 16, "mem_53580")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_53581, (int64_t) 8, "mem_53581")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_53582, (int64_t) 64, "mem_53582")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_53583, (int64_t) 1, "mem_53583")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_53584, (int64_t) 8, "mem_53584")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_53585, (int64_t) 1, "mem_53585")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_53586, (int64_t) 8, "mem_53586")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_53587, (int64_t) 1, "mem_53587")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_53588, (int64_t) 8, "mem_53588")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_53589, (int64_t) 1, "mem_53589")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_53590, (int64_t) 8, "mem_53590")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_53591, (int64_t) 0, "mem_53591")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_53592, (int64_t) 16, "mem_53592")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_53593, (int64_t) 16, "mem_53593")) {
        err = 1;
        goto cleanup;
    }
    {
        err = gpu_kernel_add_next_partition_doublezigpuseq_54852(ctx, (int64_t) 1, 1, 1, (int64_t) 1, 1, 1, (int64_t) 0, new_id_28463, loop_not_taken_41387, clBase_mem_53509.mem, clBase_mem_53510.mem, clBase_mem_53511.mem, mem_53578.mem, mem_53579.mem, mem_53580.mem, mem_53581.mem, mem_53582.mem, mem_53583.mem, mem_53584.mem, mem_53585.mem, mem_53586.mem, mem_53587.mem, mem_53588.mem, mem_53589.mem, mem_53590.mem, mem_53591.mem, mem_53592.mem, mem_53593.mem);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    ctx->failure_is_an_option = 1;
    if (memblock_unref_device(ctx, &mem_53578, "mem_53578") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_53579, "mem_53579") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_53580, "mem_53580") != 0)
        return 1;
    
    int64_t bytes_53617 = (int64_t) 8 * tile_sizze_49826;
    int64_t shared_memory_capacity_55098;
    
    shared_memory_capacity_55098 = ctx->max_shared_memory;
    if (suff_outer_par_46236 && sle64(sdiv_up64(bytes_53617, (int64_t) 8) * (int64_t) 8, shared_memory_capacity_55098)) {
        if (memblock_alloc_device(ctx, &mem_53640, (int64_t) 64, "mem_53640")) {
            err = 1;
            goto cleanup;
        }
        if (memblock_alloc_device(ctx, &mem_53641, (int64_t) 64, "mem_53641")) {
            err = 1;
            goto cleanup;
        }
        if (memblock_alloc_device(ctx, &mem_53642, (int64_t) 8, "mem_53642")) {
            err = 1;
            goto cleanup;
        }
        if (ctx->debugging)
            fprintf(ctx->log, "%s\n", "\n# SegMap");
        
        int32_t num_chunks_54962 = sext_i64_i32(sdiv_up64(tile_sizze_49826, tile_sizze_49826));
        int32_t virt_num_tblocks_54963 = sext_i64_i32(ldim_49827);
        
        {
            err = gpu_kernel_add_next_partition_doublezisegmap_intrablock_49824(ctx, ldim_49827, 1, 1, *ctx->tuning_params.add_next_partition_doublezitile_sizze_49825, 1, 1, bytes_53617 + srem64((int64_t) 8 - srem64(bytes_53617, (int64_t) 8), (int64_t) 8), part_no_28414, dz2083U_28419, n_new_28422, clBase_28427, num_whole_tiles_49841, residual_input_49922, cond_49923, binop_x_49933, clBase_mem_53509.mem, clBase_mem_53510.mem, clBase_mem_53511.mem, clProc_mem_53516.mem, clProc_mem_53517.mem, new_xs_mem_53533.mem, new_ys_mem_53534.mem, mem_53582.mem, mem_53640.mem, mem_53641.mem, mem_53642.mem);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        ctx->failure_is_an_option = 1;
        if (ctx->debugging)
            fprintf(ctx->log, "%s\n", "");
        if (memblock_set_device(ctx, &ext_mem_53645, &mem_53640, "mem_53640") != 0)
            return 1;
        if (memblock_set_device(ctx, &ext_mem_53644, &mem_53641, "mem_53641") != 0)
            return 1;
        if (memblock_set_device(ctx, &ext_mem_53643, &mem_53642, "mem_53642") != 0)
            return 1;
    } else {
        int64_t shared_memory_capacity_55097;
        
        shared_memory_capacity_55097 = ctx->max_shared_memory;
        if (intra_suff_and_fits_46244 && sle64(sdiv_up64(dz2083U_28419, (int64_t) 8) * (int64_t) 8 + sdiv_up64(n_new_28422, (int64_t) 8) * (int64_t) 8, shared_memory_capacity_55097)) {
            if (memblock_alloc_device(ctx, &mem_53602, (int64_t) 64, "mem_53602")) {
                err = 1;
                goto cleanup;
            }
            if (memblock_alloc_device(ctx, &mem_53603, (int64_t) 64, "mem_53603")) {
                err = 1;
                goto cleanup;
            }
            if (memblock_alloc_device(ctx, &mem_53604, (int64_t) 8, "mem_53604")) {
                err = 1;
                goto cleanup;
            }
            if (ctx->debugging)
                fprintf(ctx->log, "%s\n", "\n# SegMap");
            
            int32_t num_chunks_54982 = sext_i64_i32(sdiv_up64(dz2083U_28419, computed_tblock_sizze_46238));
            int32_t num_chunks_54983 = sext_i64_i32(sdiv_up64(n_new_28422, computed_tblock_sizze_46238));
            int32_t virt_num_tblocks_54984 = 8;
            
            {
                err = gpu_kernel_add_next_partition_doublezisegmap_intrablock_46316(ctx, (int64_t) 8, 1, 1, computed_tblock_sizze_46238, 1, 1, n_new_28422 + srem64((int64_t) 8 - srem64(n_new_28422, (int64_t) 8), (int64_t) 8) + (dz2083U_28419 + srem64((int64_t) 8 - srem64(dz2083U_28419, (int64_t) 8), (int64_t) 8)), part_no_28414, dz2083U_28419, n_new_28422, clBase_28427, computed_tblock_sizze_46238, clBase_mem_53509.mem, clBase_mem_53510.mem, clBase_mem_53511.mem, clProc_mem_53516.mem, clProc_mem_53517.mem, new_xs_mem_53533.mem, new_ys_mem_53534.mem, mem_53582.mem, mem_53602.mem, mem_53603.mem, mem_53604.mem);
                if (err != FUTHARK_SUCCESS)
                    goto cleanup;
            }
            ctx->failure_is_an_option = 1;
            if (ctx->debugging)
                fprintf(ctx->log, "%s\n", "");
            if (memblock_set_device(ctx, &ext_mem_53607, &mem_53602, "mem_53602") != 0)
                return 1;
            if (memblock_set_device(ctx, &ext_mem_53606, &mem_53603, "mem_53603") != 0)
                return 1;
            if (memblock_set_device(ctx, &ext_mem_53605, &mem_53604, "mem_53604") != 0)
                return 1;
        } else {
            int64_t segmap_usable_groups_46376 = sdiv_up64((int64_t) 8, segmap_tblock_sizze_46375);
            
            if (memblock_alloc_device(ctx, &mem_53595, (int64_t) 8, "mem_53595")) {
                err = 1;
                goto cleanup;
            }
            if (ctx->debugging)
                fprintf(ctx->log, "%s\n", "\n# SegMap");
            
            int32_t virt_num_tblocks_55006 = sext_i64_i32(sdiv_up64((int64_t) 8, segmap_tblock_sizze_46375));
            
            {
                err = gpu_kernel_add_next_partition_doublezisegmap_46379(ctx, segmap_usable_groups_46376, 1, 1, *ctx->tuning_params.add_next_partition_doublezisegmap_tblock_sizze_46132, 1, 1, (int64_t) 0, part_no_28414, clProc_mem_53516.mem, mem_53582.mem, mem_53595.mem);
                if (err != FUTHARK_SUCCESS)
                    goto cleanup;
            }
            ctx->failure_is_an_option = 1;
            if (ctx->debugging)
                fprintf(ctx->log, "%s\n", "");
            if (memblock_alloc_device(ctx, &mem_53597, (int64_t) 8, "mem_53597")) {
                err = 1;
                goto cleanup;
            }
            if (ctx->debugging)
                fprintf(ctx->log, "%s\n", "\n# SegRed");
            
            int64_t chunk_sizze_55015 = (int64_t) 1;
            
            if (slt64(dz2083U_28419 * (int64_t) 2, segred_tblock_sizze_46389 * chunk_sizze_55015)) {
                int64_t segment_sizze_nonzzero_55016 = smax64((int64_t) 1, dz2083U_28419);
                int64_t num_threads_55017 = segred_tblock_sizze_46389 * segred_tblock_sizze_46389;
                
                if (ctx->debugging)
                    fprintf(ctx->log, "%s\n", "# SegRed-small");
                if (ctx->debugging)
                    fprintf(ctx->log, "%s: %llu%c", "num_segments", (long long) (int64_t) 8, '\n');
                if (ctx->debugging)
                    fprintf(ctx->log, "%s: %llu%c", "segment_size", (long long) dz2083U_28419, '\n');
                if (ctx->debugging)
                    fprintf(ctx->log, "%s: %llu%c", "segments_per_block", (long long) squot64(segred_tblock_sizze_46389, segment_sizze_nonzzero_55016), '\n');
                if (ctx->debugging)
                    fprintf(ctx->log, "%s: %llu%c", "required_blocks", (long long) sext_i64_i32(sdiv_up64((int64_t) 8, squot64(segred_tblock_sizze_46389, segment_sizze_nonzzero_55016))), '\n');
                {
                    err = gpu_kernel_add_next_partition_doublezisegred_small_46395(ctx, num_tblocks_46390, 1, 1, *ctx->tuning_params.add_next_partition_doublezisegred_tblock_sizze_46113, 1, 1, segred_tblock_sizze_46389 + srem64((int64_t) 8 - srem64(segred_tblock_sizze_46389, (int64_t) 8), (int64_t) 8), dz2083U_28419, num_tblocks_46390, segment_sizze_nonzzero_55016, clProc_mem_53517.mem, mem_53582.mem, mem_53597.mem);
                    if (err != FUTHARK_SUCCESS)
                        goto cleanup;
                }
            } else {
                int64_t blocks_per_segment_55044 = sdiv_up64(num_tblocks_46390, smax64((int64_t) 1, (int64_t) 8));
                int64_t q_55045 = sdiv_up64(dz2083U_28419, segred_tblock_sizze_46389 * blocks_per_segment_55044 * chunk_sizze_55015);
                int64_t num_virtblocks_55046 = blocks_per_segment_55044 * (int64_t) 8;
                int64_t threads_per_segment_55047 = blocks_per_segment_55044 * segred_tblock_sizze_46389;
                
                if (ctx->debugging)
                    fprintf(ctx->log, "%s\n", "# SegRed-large");
                if (ctx->debugging)
                    fprintf(ctx->log, "%s: %llu%c", "num_segments", (long long) (int64_t) 8, '\n');
                if (ctx->debugging)
                    fprintf(ctx->log, "%s: %llu%c", "segment_size", (long long) dz2083U_28419, '\n');
                if (ctx->debugging)
                    fprintf(ctx->log, "%s: %llu%c", "num_virtblocks", (long long) num_virtblocks_55046, '\n');
                if (ctx->debugging)
                    fprintf(ctx->log, "%s: %llu%c", "num_tblocks", (long long) num_tblocks_46390, '\n');
                if (ctx->debugging)
                    fprintf(ctx->log, "%s: %llu%c", "tblock_size", (long long) segred_tblock_sizze_46389, '\n');
                if (ctx->debugging)
                    fprintf(ctx->log, "%s: %llu%c", "q", (long long) q_55045, '\n');
                if (ctx->debugging)
                    fprintf(ctx->log, "%s: %llu%c", "blocks_per_segment", (long long) blocks_per_segment_55044, '\n');
                if (memblock_alloc_device(ctx, &segred_tmp_mem_55048, num_virtblocks_55046, "segred_tmp_mem_55048")) {
                    err = 1;
                    goto cleanup;
                }
                {
                    err = gpu_kernel_add_next_partition_doublezisegred_large_46395(ctx, num_tblocks_46390, 1, 1, *ctx->tuning_params.add_next_partition_doublezisegred_tblock_sizze_46113, 1, 1, 8 + (segred_tblock_sizze_46389 + srem64((int64_t) 8 - srem64(segred_tblock_sizze_46389, (int64_t) 8), (int64_t) 8)), dz2083U_28419, num_tblocks_46390, blocks_per_segment_55044, q_55045, num_virtblocks_55046, threads_per_segment_55047, clProc_mem_53517.mem, mem_53582.mem, mem_53597.mem, segred_tmp_mem_55048.mem, counters_mem_55050.mem);
                    if (err != FUTHARK_SUCCESS)
                        goto cleanup;
                }
            }
            if (ctx->debugging)
                fprintf(ctx->log, "%s\n", "");
            if (memblock_alloc_device(ctx, &mem_53599, (int64_t) 64, "mem_53599")) {
                err = 1;
                goto cleanup;
            }
            if (memblock_alloc_device(ctx, &mem_53600, (int64_t) 64, "mem_53600")) {
                err = 1;
                goto cleanup;
            }
            if (ctx->debugging)
                fprintf(ctx->log, "%s\n", "\n# SegMap");
            
            int32_t virt_num_tblocks_55087 = sext_i64_i32(sdiv_up64((int64_t) 8, segmap_tblock_sizze_46403));
            
            {
                err = gpu_kernel_add_next_partition_doublezisegmap_46408(ctx, segmap_usable_groups_46404, 1, 1, *ctx->tuning_params.add_next_partition_doublezisegmap_tblock_sizze_46063, 1, 1, (int64_t) 0, n_new_28422, clBase_28427, clBase_mem_53509.mem, clBase_mem_53510.mem, clBase_mem_53511.mem, new_xs_mem_53533.mem, new_ys_mem_53534.mem, mem_53582.mem, mem_53597.mem, mem_53599.mem, mem_53600.mem);
                if (err != FUTHARK_SUCCESS)
                    goto cleanup;
            }
            ctx->failure_is_an_option = 1;
            if (ctx->debugging)
                fprintf(ctx->log, "%s\n", "");
            if (memblock_unref_device(ctx, &mem_53597, "mem_53597") != 0)
                return 1;
            if (memblock_set_device(ctx, &ext_mem_53607, &mem_53599, "mem_53599") != 0)
                return 1;
            if (memblock_set_device(ctx, &ext_mem_53606, &mem_53600, "mem_53600") != 0)
                return 1;
            if (memblock_set_device(ctx, &ext_mem_53605, &mem_53595, "mem_53595") != 0)
                return 1;
        }
        if (memblock_set_device(ctx, &ext_mem_53645, &ext_mem_53607, "ext_mem_53607") != 0)
            return 1;
        if (memblock_set_device(ctx, &ext_mem_53644, &ext_mem_53606, "ext_mem_53606") != 0)
            return 1;
        if (memblock_set_device(ctx, &ext_mem_53643, &ext_mem_53605, "ext_mem_53605") != 0)
            return 1;
    }
    if (memblock_alloc_device(ctx, &mem_53646, (int64_t) 64, "mem_53646")) {
        err = 1;
        goto cleanup;
    }
    if ((err = lmad_copy_gpu2gpu_8b(ctx, 1, mem_53646.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, ext_mem_53645.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, (int64_t []) {(int64_t) 8})) != 0)
        goto cleanup;
    if (memblock_alloc_device(ctx, &mem_53648, (int64_t) 64, "mem_53648")) {
        err = 1;
        goto cleanup;
    }
    if (slt64((int64_t) 0, (int64_t) 8)) {
        if (ctx->debugging)
            fprintf(ctx->log, "%s\n", "\n# SegScan");
        
        int64_t shared_memory_55099;
        
        shared_memory_55099 = ctx->max_shared_memory;
        
        int64_t thread_block_sizze_55100;
        
        thread_block_sizze_55100 = ctx->max_thread_block_size;
        
        int64_t registers_55101;
        
        registers_55101 = ctx->max_registers;
        
        int64_t thread_block_sizze_55102;
        
        thread_block_sizze_55102 = ctx->max_thread_block_size;
        
        int64_t chunk_sizze_55103 = smax64((int64_t) 1, smin64(squot64(squot64(shared_memory_55099, thread_block_sizze_55100), (int64_t) 8), squot64(squot64(registers_55101, thread_block_sizze_55102) - (int64_t) 1 - squot64(smax64((int64_t) 4, (int64_t) 8), (int64_t) 4), (int64_t) 2 * squot64(smax64((int64_t) 4, (int64_t) 8), (int64_t) 4))));
        int64_t num_virt_blocks_55104 = sdiv_up64((int64_t) 8, segscan_tblock_sizze_46456 * chunk_sizze_55103);
        int64_t num_virt_threads_55105 = num_virt_blocks_55104 * segscan_tblock_sizze_46456;
        
        if (ctx->debugging)
            fprintf(ctx->log, "%s: %llu%c", "Sequential elements per thread (chunk)", (long long) chunk_sizze_55103, '\n');
        if (memblock_alloc_device(ctx, &status_flags_mem_55106, num_virt_blocks_55104, "status_flags_mem_55106")) {
            err = 1;
            goto cleanup;
        }
        if (futrts_builtinzhreplicate_i8(ctx, status_flags_mem_55106, num_virt_blocks_55104, (int8_t) 0) != 0) {
            err = 1;
            goto cleanup;
        }
        if (memblock_alloc_device(ctx, &aggregates_mem_55108, (int64_t) 8 * num_virt_blocks_55104, "aggregates_mem_55108")) {
            err = 1;
            goto cleanup;
        }
        if (memblock_alloc_device(ctx, &incprefixes_mem_55110, (int64_t) 8 * num_virt_blocks_55104, "incprefixes_mem_55110")) {
            err = 1;
            goto cleanup;
        }
        {
            err = gpu_kernel_add_next_partition_doublezisegscan_46461(ctx, num_tblocks_46457, 1, 1, *ctx->tuning_params.add_next_partition_doublezisegscan_tblock_sizze_46228, 1, 1, smax64(smax64((int64_t) 288, (int64_t) 8 * segscan_tblock_sizze_46456), chunk_sizze_55103 * segscan_tblock_sizze_46456 * (int64_t) 8) + srem64((int64_t) 8 - srem64(smax64(smax64((int64_t) 288, (int64_t) 8 * segscan_tblock_sizze_46456), chunk_sizze_55103 * segscan_tblock_sizze_46456 * (int64_t) 8), (int64_t) 8), (int64_t) 8), num_tblocks_46457, num_virt_blocks_55104, num_virt_threads_55105, ext_mem_53645.mem, mem_53648.mem, status_flags_mem_55106.mem, aggregates_mem_55108.mem, incprefixes_mem_55110.mem, global_dynid_mem_55112.mem);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        if (ctx->debugging)
            fprintf(ctx->log, "%s\n", "");
    }
    if (memblock_unref_device(ctx, &ext_mem_53645, "ext_mem_53645") != 0)
        return 1;
    if (memblock_set_device(ctx, &ext_mem_53657, &mem_53648, "mem_53648") != 0)
        return 1;
    if (memblock_set_device(ctx, &ext_mem_53656, &mem_53646, "mem_53646") != 0)
        return 1;
    if (memblock_set_device(ctx, &ext_mem_53655, &ext_mem_53644, "ext_mem_53644") != 0)
        return 1;
    if (memblock_set_device(ctx, &ext_mem_53654, &ext_mem_53643, "ext_mem_53643") != 0)
        return 1;
    
    int64_t read_res_56936;
    
    if ((err = gpu_scalar_from_device(ctx, &read_res_56936, ext_mem_53657.mem, (int64_t) 7 * sizeof(int64_t), sizeof(int64_t))) != 0)
        goto cleanup;
    if (ctx->failure_is_an_option && futhark_context_sync(ctx) != 0) {
        err = 1;
        goto cleanup;
    }
    
    int64_t m_f_res_41148 = read_res_56936;
    int64_t m_41156 = sub64(m_f_res_41148, (int64_t) 1);
    bool i_p_m_t_s_leq_w_41158 = slt64(m_41156, (int64_t) 8);
    bool zzero_leq_i_p_m_t_s_41157 = sle64((int64_t) 0, m_41156);
    bool y_41160 = zzero_leq_i_p_m_t_s_41157 && i_p_m_t_s_leq_w_41158;
    bool i_lte_j_41159 = sle64((int64_t) 0, m_f_res_41148);
    bool forwards_ok_41161 = i_lte_j_41159 && y_41160;
    bool empty_slice_41155 = m_f_res_41148 == (int64_t) 0;
    bool ok_or_empty_41162 = empty_slice_41155 || forwards_ok_41161;
    bool index_certs_41163;
    
    if (!ok_or_empty_41162) {
        set_error(ctx, msgprintf("Error: %s%lld%s%lld%s\n\nBacktrace:\n%s", "Index [:", (long long) m_f_res_41148, "] out of bounds for array of shape [", (long long) (int64_t) 8, "].", "-> #0  /prelude/soacs.fut:258:29-35\n   #1  /prelude/functional.fut:9:44-45\n   #2  ft_libs/ftDBSCAN_plus.fut:877:18-882:84\n   #3  ft_libs/ftDBSCAN_plus.fut:876:9-882:84\n"));
        err = FUTHARK_PROGRAM_ERROR;
        goto cleanup;
    }
    
    int64_t bytes_53658 = (int64_t) 8 * m_f_res_41148;
    
    if (memblock_alloc_device(ctx, &mem_53659, bytes_53658, "mem_53659")) {
        err = 1;
        goto cleanup;
    }
    if ((err = lmad_copy_gpu2gpu_8b(ctx, 1, mem_53659.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, ext_mem_53655.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, (int64_t []) {m_f_res_41148})) != 0)
        goto cleanup;
    if (ctx->debugging)
        fprintf(ctx->log, "%s\n", "\n# SegMap");
    
    int32_t virt_num_tblocks_55201 = sext_i64_i32(sdiv_up64((int64_t) 8, segmap_tblock_sizze_46474));
    
    {
        err = gpu_kernel_add_next_partition_doublezisegmap_46471(ctx, num_tblocks_46476, 1, 1, *ctx->tuning_params.add_next_partition_doublezisegmap_tblock_sizze_46473, 1, 1, (int64_t) 0, m_f_res_41148, num_tblocks_46476, virt_num_tblocks_55201, ext_mem_53655.mem, ext_mem_53656.mem, ext_mem_53657.mem, mem_53659.mem);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (ctx->debugging)
        fprintf(ctx->log, "%s\n", "");
    if (memblock_unref_device(ctx, &ext_mem_53655, "ext_mem_53655") != 0)
        return 1;
    if (memblock_unref_device(ctx, &ext_mem_53656, "ext_mem_53656") != 0)
        return 1;
    if (memblock_unref_device(ctx, &ext_mem_53657, "ext_mem_53657") != 0)
        return 1;
    
    int64_t conc_tmp_41169 = dz2083U_28419 + m_f_res_41148;
    int64_t bytes_53661 = (int64_t) 8 * conc_tmp_41169;
    int64_t num_tblocks_46482;
    int64_t max_num_tblocks_55214;
    
    max_num_tblocks_55214 = *ctx->tuning_params.add_next_partition_doublezisegscan_num_tblocks_46481;
    num_tblocks_46482 = sext_i64_i32(smax64((int64_t) 1, smin64(sdiv_up64(conc_tmp_41169, segscan_tblock_sizze_46480), max_num_tblocks_55214)));
    if (memblock_alloc_device(ctx, &mem_53665, bytes_53661, "mem_53665")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_53667, bytes_53661, "mem_53667")) {
        err = 1;
        goto cleanup;
    }
    if (slt64((int64_t) 0, conc_tmp_41169)) {
        if (ctx->debugging)
            fprintf(ctx->log, "%s\n", "\n# SegScan");
        
        int64_t shared_memory_55215;
        
        shared_memory_55215 = ctx->max_shared_memory;
        
        int64_t thread_block_sizze_55216;
        
        thread_block_sizze_55216 = ctx->max_thread_block_size;
        
        int64_t registers_55217;
        
        registers_55217 = ctx->max_registers;
        
        int64_t thread_block_sizze_55218;
        
        thread_block_sizze_55218 = ctx->max_thread_block_size;
        
        int64_t chunk_sizze_55219 = smax64((int64_t) 1, smin64(squot64(squot64(shared_memory_55215, thread_block_sizze_55216), (int64_t) 8), squot64(squot64(registers_55217, thread_block_sizze_55218) - (int64_t) 1 - squot64(smax64((int64_t) 4, (int64_t) 8), (int64_t) 4), (int64_t) 2 * squot64(smax64((int64_t) 4, (int64_t) 8), (int64_t) 4))));
        int64_t num_virt_blocks_55220 = sdiv_up64(conc_tmp_41169, segscan_tblock_sizze_46480 * chunk_sizze_55219);
        int64_t num_virt_threads_55221 = num_virt_blocks_55220 * segscan_tblock_sizze_46480;
        
        if (ctx->debugging)
            fprintf(ctx->log, "%s: %llu%c", "Sequential elements per thread (chunk)", (long long) chunk_sizze_55219, '\n');
        if (memblock_alloc_device(ctx, &status_flags_mem_55222, num_virt_blocks_55220, "status_flags_mem_55222")) {
            err = 1;
            goto cleanup;
        }
        if (futrts_builtinzhreplicate_i8(ctx, status_flags_mem_55222, num_virt_blocks_55220, (int8_t) 0) != 0) {
            err = 1;
            goto cleanup;
        }
        if (memblock_alloc_device(ctx, &aggregates_mem_55224, (int64_t) 8 * num_virt_blocks_55220, "aggregates_mem_55224")) {
            err = 1;
            goto cleanup;
        }
        if (memblock_alloc_device(ctx, &incprefixes_mem_55226, (int64_t) 8 * num_virt_blocks_55220, "incprefixes_mem_55226")) {
            err = 1;
            goto cleanup;
        }
        {
            err = gpu_kernel_add_next_partition_doublezisegscan_46485(ctx, num_tblocks_46482, 1, 1, *ctx->tuning_params.add_next_partition_doublezisegscan_tblock_sizze_46479, 1, 1, smax64(smax64((int64_t) 288, (int64_t) 8 * segscan_tblock_sizze_46480), chunk_sizze_55219 * segscan_tblock_sizze_46480 * (int64_t) 8) + srem64((int64_t) 8 - srem64(smax64(smax64((int64_t) 288, (int64_t) 8 * segscan_tblock_sizze_46480), chunk_sizze_55219 * segscan_tblock_sizze_46480 * (int64_t) 8), (int64_t) 8), (int64_t) 8), part_no_28414, dz2083U_28419, conc_tmp_41169, num_tblocks_46482, num_virt_blocks_55220, num_virt_threads_55221, clProc_mem_53517.mem, mem_53539.mem, mem_53659.mem, mem_53665.mem, mem_53667.mem, status_flags_mem_55222.mem, aggregates_mem_55224.mem, incprefixes_mem_55226.mem, global_dynid_mem_55228.mem);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        ctx->failure_is_an_option = 1;
        if (ctx->debugging)
            fprintf(ctx->log, "%s\n", "");
    }
    
    bool cond_41185 = conc_tmp_41169 == (int64_t) 0;
    bool x_41186 = !cond_41185;
    int64_t tmp_41187 = sub64(conc_tmp_41169, (int64_t) 1);
    bool x_41188 = sle64((int64_t) 0, tmp_41187);
    bool y_41189 = slt64(tmp_41187, conc_tmp_41169);
    bool bounds_check_41190 = x_41188 && y_41189;
    bool protect_assert_disj_41191 = cond_41185 || bounds_check_41190;
    bool index_certs_41192;
    
    if (!protect_assert_disj_41191) {
        set_error(ctx, msgprintf("Error: %s%lld%s%lld%s\n\nBacktrace:\n%s", "Index [", (long long) tmp_41187, "] out of bounds for array of shape [", (long long) conc_tmp_41169, "].", "-> #0  /prelude/soacs.fut:257:33-47\n   #1  /prelude/functional.fut:9:44-45\n   #2  ft_libs/ftDBSCAN_plus.fut:877:18-882:84\n   #3  ft_libs/ftDBSCAN_plus.fut:876:9-882:84\n"));
        err = FUTHARK_PROGRAM_ERROR;
        goto cleanup;
    }
    
    int64_t m_f_res_41193;
    
    if (x_41186) {
        int64_t read_res_56937;
        
        if ((err = gpu_scalar_from_device(ctx, &read_res_56937, mem_53665.mem, tmp_41187 * sizeof(int64_t), sizeof(int64_t))) != 0)
            goto cleanup;
        if (ctx->failure_is_an_option && futhark_context_sync(ctx) != 0) {
            err = 1;
            goto cleanup;
        }
        
        int64_t x_45216 = read_res_56937;
        
        m_f_res_41193 = x_45216;
    } else {
        m_f_res_41193 = (int64_t) 0;
    }
    
    int64_t m_41195;
    
    if (cond_41185) {
        m_41195 = (int64_t) 0;
    } else {
        m_41195 = m_f_res_41193;
    }
    
    int64_t m_41205 = sub64(m_41195, (int64_t) 1);
    bool i_p_m_t_s_leq_w_41207 = slt64(m_41205, conc_tmp_41169);
    bool zzero_leq_i_p_m_t_s_41206 = sle64((int64_t) 0, m_41205);
    bool y_41209 = zzero_leq_i_p_m_t_s_41206 && i_p_m_t_s_leq_w_41207;
    bool i_lte_j_41208 = sle64((int64_t) 0, m_41195);
    bool forwards_ok_41210 = i_lte_j_41208 && y_41209;
    bool eq_x_zz_41202 = (int64_t) 0 == m_f_res_41193;
    bool p_and_eq_x_y_41203 = x_41186 && eq_x_zz_41202;
    bool empty_slice_41204 = cond_41185 || p_and_eq_x_y_41203;
    bool ok_or_empty_41211 = empty_slice_41204 || forwards_ok_41210;
    bool index_certs_41212;
    
    if (!ok_or_empty_41211) {
        set_error(ctx, msgprintf("Error: %s%lld%s%lld%s\n\nBacktrace:\n%s", "Index [:", (long long) m_41195, "] out of bounds for array of shape [", (long long) conc_tmp_41169, "].", "-> #0  /prelude/soacs.fut:258:29-35\n   #1  /prelude/functional.fut:9:44-45\n   #2  ft_libs/ftDBSCAN_plus.fut:877:18-882:84\n   #3  ft_libs/ftDBSCAN_plus.fut:876:9-882:84\n"));
        err = FUTHARK_PROGRAM_ERROR;
        goto cleanup;
    }
    
    int64_t bytes_53668 = (int64_t) 8 * m_41195;
    bool nonzzero_cert_41389 = 0;
    
    if (memblock_unref_device(ctx, &mem_53591, "mem_53591") != 0)
        return 1;
    if (memblock_alloc_device(ctx, &mem_53704, bytes_53573, "mem_53704")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_53706, bytes_53573, "mem_53706")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_53708, bytes_53573, "mem_53708")) {
        err = 1;
        goto cleanup;
    }
    if (slt64((int64_t) 0, dzlz7bUZLzpZRz20Udz2082Uz20Udz2084Uz2088Uz2083Uz7dUzg_41379)) {
        if (ctx->debugging)
            fprintf(ctx->log, "%s\n", "\n# SegScan");
        
        int64_t shared_memory_55317;
        
        shared_memory_55317 = ctx->max_shared_memory;
        
        int64_t thread_block_sizze_55318;
        
        thread_block_sizze_55318 = ctx->max_thread_block_size;
        
        int64_t registers_55319;
        
        registers_55319 = ctx->max_registers;
        
        int64_t thread_block_sizze_55320;
        
        thread_block_sizze_55320 = ctx->max_thread_block_size;
        
        int64_t chunk_sizze_55321 = smax64((int64_t) 1, smin64(squot64(squot64(shared_memory_55317, thread_block_sizze_55318), (int64_t) 8), squot64(squot64(registers_55319, thread_block_sizze_55320) - (int64_t) 1 - squot64(smax64((int64_t) 4, (int64_t) 8) + smax64((int64_t) 4, (int64_t) 8), (int64_t) 4), (int64_t) 2 * squot64(smax64((int64_t) 4, (int64_t) 8) + smax64((int64_t) 4, (int64_t) 8), (int64_t) 4))));
        int64_t num_virt_blocks_55322 = sdiv_up64(dzlz7bUZLzpZRz20Udz2082Uz20Udz2084Uz2088Uz2083Uz7dUzg_41379, segscan_tblock_sizze_46795 * chunk_sizze_55321);
        int64_t num_virt_threads_55323 = num_virt_blocks_55322 * segscan_tblock_sizze_46795;
        
        if (ctx->debugging)
            fprintf(ctx->log, "%s: %llu%c", "Sequential elements per thread (chunk)", (long long) chunk_sizze_55321, '\n');
        if (memblock_alloc_device(ctx, &status_flags_mem_55324, num_virt_blocks_55322, "status_flags_mem_55324")) {
            err = 1;
            goto cleanup;
        }
        if (futrts_builtinzhreplicate_i8(ctx, status_flags_mem_55324, num_virt_blocks_55322, (int8_t) 0) != 0) {
            err = 1;
            goto cleanup;
        }
        if (memblock_alloc_device(ctx, &aggregates_mem_55326, (int64_t) 8 * num_virt_blocks_55322, "aggregates_mem_55326")) {
            err = 1;
            goto cleanup;
        }
        if (memblock_alloc_device(ctx, &incprefixes_mem_55328, (int64_t) 8 * num_virt_blocks_55322, "incprefixes_mem_55328")) {
            err = 1;
            goto cleanup;
        }
        if (memblock_alloc_device(ctx, &aggregates_mem_55330, (int64_t) 8 * num_virt_blocks_55322, "aggregates_mem_55330")) {
            err = 1;
            goto cleanup;
        }
        if (memblock_alloc_device(ctx, &incprefixes_mem_55332, (int64_t) 8 * num_virt_blocks_55322, "incprefixes_mem_55332")) {
            err = 1;
            goto cleanup;
        }
        {
            err = gpu_kernel_add_next_partition_doublezisegscan_46800(ctx, num_tblocks_46797, 1, 1, *ctx->tuning_params.add_next_partition_doublezisegscan_tblock_sizze_46794, 1, 1, smax64(smax64((int64_t) 544, sdiv_up64((int64_t) 8 * segscan_tblock_sizze_46795, (int64_t) 8) * (int64_t) 8 + (int64_t) 8 * segscan_tblock_sizze_46795), smax64(chunk_sizze_55321 * segscan_tblock_sizze_46795 * (int64_t) 8, chunk_sizze_55321 * segscan_tblock_sizze_46795 * (int64_t) 8)) + srem64((int64_t) 8 - srem64(smax64(smax64((int64_t) 544, sdiv_up64((int64_t) 8 * segscan_tblock_sizze_46795, (int64_t) 8) * (int64_t) 8 + (int64_t) 8 * segscan_tblock_sizze_46795), smax64(chunk_sizze_55321 * segscan_tblock_sizze_46795 * (int64_t) 8, chunk_sizze_55321 * segscan_tblock_sizze_46795 * (int64_t) 8)), (int64_t) 8), (int64_t) 8), dz2082U_28418, dz2083U_28419, zt_res_40980, dzlz7bUZLzpZRz20Udz2082Uz20Udz2084Uz2088Uz2083Uz7dUzg_41379, cond_41383, num_tblocks_46797, num_virt_blocks_55322, num_virt_threads_55323, clProc_mem_53514.mem, clProc_mem_53515.mem, clProc_mem_53517.mem, mem_53548.mem, mem_53550.mem, ext_mem_53557.mem, ext_mem_53560.mem, ext_mem_53563.mem, ext_mem_53566.mem, ext_mem_53569.mem, ext_mem_53572.mem, mem_53581.mem, mem_53704.mem, mem_53706.mem, mem_53708.mem, status_flags_mem_55324.mem, aggregates_mem_55326.mem, incprefixes_mem_55328.mem, aggregates_mem_55330.mem, incprefixes_mem_55332.mem, global_dynid_mem_55334.mem);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        ctx->failure_is_an_option = 1;
        if (ctx->debugging)
            fprintf(ctx->log, "%s\n", "");
    }
    if (memblock_unref_device(ctx, &ext_mem_53557, "ext_mem_53557") != 0)
        return 1;
    if (memblock_unref_device(ctx, &ext_mem_53560, "ext_mem_53560") != 0)
        return 1;
    if (memblock_unref_device(ctx, &ext_mem_53563, "ext_mem_53563") != 0)
        return 1;
    if (memblock_unref_device(ctx, &ext_mem_53566, "ext_mem_53566") != 0)
        return 1;
    if (memblock_unref_device(ctx, &ext_mem_53569, "ext_mem_53569") != 0)
        return 1;
    if (memblock_unref_device(ctx, &ext_mem_53572, "ext_mem_53572") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_53581, "mem_53581") != 0)
        return 1;
    
    int64_t last_offset_41484;
    
    if (x_41483) {
        int64_t read_res_56938;
        
        if ((err = gpu_scalar_from_device(ctx, &read_res_56938, mem_53704.mem, last_index_41481 * sizeof(int64_t), sizeof(int64_t))) != 0)
            goto cleanup;
        if (ctx->failure_is_an_option && futhark_context_sync(ctx) != 0) {
            err = 1;
            goto cleanup;
        }
        
        int64_t x_45268 = read_res_56938;
        
        last_offset_41484 = x_45268;
    } else {
        last_offset_41484 = (int64_t) 0;
    }
    
    int64_t partition_sizze_41486;
    
    if (is_empty_41482) {
        partition_sizze_41486 = (int64_t) 0;
    } else {
        partition_sizze_41486 = last_offset_41484;
    }
    
    bool eq_x_zz_41500 = (int64_t) 0 == last_offset_41484;
    bool p_and_eq_x_y_41501 = x_41483 && eq_x_zz_41500;
    bool empty_slice_41502 = is_empty_41482 || p_and_eq_x_y_41501;
    int64_t m_41503 = sub64(partition_sizze_41486, (int64_t) 1);
    bool zzero_leq_i_p_m_t_s_41504 = sle64((int64_t) 0, m_41503);
    bool i_p_m_t_s_leq_w_41505 = slt64(m_41503, dzlz7bUZLzpZRz20Udz2082Uz20Udz2084Uz2088Uz2083Uz7dUzg_41379);
    bool i_lte_j_41506 = sle64((int64_t) 0, partition_sizze_41486);
    bool y_41507 = zzero_leq_i_p_m_t_s_41504 && i_p_m_t_s_leq_w_41505;
    bool forwards_ok_41508 = i_lte_j_41506 && y_41507;
    bool ok_or_empty_41509 = empty_slice_41502 || forwards_ok_41508;
    bool index_certs_41510;
    
    if (!ok_or_empty_41509) {
        set_error(ctx, msgprintf("Error: %s%lld%s%lld%s%lld%s\n\nBacktrace:\n%s", "Index [", (long long) (int64_t) 0, ":", (long long) partition_sizze_41486, "] out of bounds for array of shape [", (long long) dzlz7bUZLzpZRz20Udz2082Uz20Udz2084Uz2088Uz2083Uz7dUzg_41379, "].", "-> #0  /prelude/soacs.fut:174:7-19\n   #1  /prelude/functional.fut:9:44-45\n   #2  ft_libs/ftDBSCAN_plus.fut:877:18-882:84\n   #3  ft_libs/ftDBSCAN_plus.fut:876:9-882:84\n"));
        err = FUTHARK_PROGRAM_ERROR;
        goto cleanup;
    }
    
    int64_t bytes_53711 = (int64_t) 8 * partition_sizze_41486;
    int64_t j_m_i_41512 = sub64(dzlz7bUZLzpZRz20Udz2082Uz20Udz2084Uz2088Uz2083Uz7dUzg_41379, partition_sizze_41486);
    bool empty_slice_41513 = j_m_i_41512 == (int64_t) 0;
    int64_t m_41514 = sub64(j_m_i_41512, (int64_t) 1);
    int64_t i_p_m_t_s_41515 = add64(partition_sizze_41486, m_41514);
    bool zzero_leq_i_p_m_t_s_41516 = sle64((int64_t) 0, i_p_m_t_s_41515);
    bool i_p_m_t_s_leq_w_41517 = slt64(i_p_m_t_s_41515, dzlz7bUZLzpZRz20Udz2082Uz20Udz2084Uz2088Uz2083Uz7dUzg_41379);
    bool i_lte_j_41518 = sle64(partition_sizze_41486, dzlz7bUZLzpZRz20Udz2082Uz20Udz2084Uz2088Uz2083Uz7dUzg_41379);
    bool y_41519 = zzero_leq_i_p_m_t_s_41516 && i_p_m_t_s_leq_w_41517;
    bool forwards_ok_41520 = i_lte_j_41518 && y_41519;
    bool ok_or_empty_41521 = empty_slice_41513 || forwards_ok_41520;
    bool index_certs_41522;
    
    if (!ok_or_empty_41521) {
        set_error(ctx, msgprintf("Error: %s%lld%s%lld%s%lld%s\n\nBacktrace:\n%s", "Index [", (long long) partition_sizze_41486, ":", (long long) dzlz7bUZLzpZRz20Udz2082Uz20Udz2084Uz2088Uz2083Uz7dUzg_41379, "] out of bounds for array of shape [", (long long) dzlz7bUZLzpZRz20Udz2082Uz20Udz2084Uz2088Uz2083Uz7dUzg_41379, "].", "-> #0  /prelude/soacs.fut:174:21-33\n   #1  /prelude/functional.fut:9:44-45\n   #2  ft_libs/ftDBSCAN_plus.fut:877:18-882:84\n   #3  ft_libs/ftDBSCAN_plus.fut:876:9-882:84\n"));
        err = FUTHARK_PROGRAM_ERROR;
        goto cleanup;
    }
    
    int64_t conc_tmp_41583 = j_m_i_41365 + j_m_i_41512;
    int64_t bytes_53725 = (int64_t) 8 * conc_tmp_41583;
    
    if (memblock_alloc_device(ctx, &mem_53536, bytes_53535, "mem_53536")) {
        err = 1;
        goto cleanup;
    }
    if ((err = lmad_copy_gpu2gpu_8b(ctx, 1, mem_53536.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, new_ys_mem_53534.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, (int64_t []) {n_new_28422})) != 0)
        goto cleanup;
    if (memblock_alloc_device(ctx, &mem_53538, bytes_53535, "mem_53538")) {
        err = 1;
        goto cleanup;
    }
    if ((err = lmad_copy_gpu2gpu_8b(ctx, 1, mem_53538.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, new_xs_mem_53533.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, (int64_t []) {n_new_28422})) != 0)
        goto cleanup;
    
    int64_t segmap_tblock_sizze_46490;
    
    segmap_tblock_sizze_46490 = *ctx->tuning_params.add_next_partition_doublezisegmap_tblock_sizze_46489;
    
    bool suff_outer_par_46495;
    
    suff_outer_par_46495 = *ctx->tuning_params.add_next_partition_doublezisuff_outer_par_3 <= n_new_28422;
    if (ctx->logging)
        fprintf(ctx->log, "Compared %s <= %ld: %s.\n", "add_next_partition_double.suff_outer_par_3", (long) n_new_28422, suff_outer_par_46495 ? "true" : "false");
    
    int64_t segred_tblock_sizze_46638;
    
    segred_tblock_sizze_46638 = *ctx->tuning_params.add_next_partition_doublezisegred_tblock_sizze_46589;
    
    int64_t num_tblocks_46639;
    int64_t max_num_tblocks_55472;
    
    max_num_tblocks_55472 = *ctx->tuning_params.add_next_partition_doublezisegred_num_tblocks_46591;
    num_tblocks_46639 = sext_i64_i32(smax64((int64_t) 1, smin64(sdiv_up64(bytes_53535, segred_tblock_sizze_46638), max_num_tblocks_55472)));
    
    int64_t tile_sizze_50038;
    
    tile_sizze_50038 = *ctx->tuning_params.add_next_partition_doublezitile_sizze_50037;
    
    int64_t segmap_tblock_sizze_46732;
    
    segmap_tblock_sizze_46732 = *ctx->tuning_params.add_next_partition_doublezisegmap_tblock_sizze_46686;
    
    int64_t segmap_usable_groups_46733 = sdiv_up64(n_new_28422, segmap_tblock_sizze_46732);
    int64_t conc_tmp_41380 = dz2080U_28416 + partition_sizze_41331;
    int64_t conc_tmp_41381 = dz2081U_28417 + partition_sizze_41331;
    
    if (memblock_alloc_device(ctx, &mem_53574, bytes_53573, "mem_53574")) {
        err = 1;
        goto cleanup;
    }
    
    int64_t segmap_tblock_sizze_46805;
    
    segmap_tblock_sizze_46805 = *ctx->tuning_params.add_next_partition_doublezisegmap_tblock_sizze_46804;
    
    int64_t num_tblocks_46807;
    int64_t max_num_tblocks_55473;
    
    max_num_tblocks_55473 = *ctx->tuning_params.add_next_partition_doublezisegmap_num_tblocks_46806;
    num_tblocks_46807 = sext_i64_i32(smax64((int64_t) 1, smin64(sdiv_up64(dzlz7bUZLzpZRz20Udz2082Uz20Udz2084Uz2088Uz2083Uz7dUzg_41379, segmap_tblock_sizze_46805), max_num_tblocks_55473)));
    
    int64_t segmap_tblock_sizze_46848;
    
    segmap_tblock_sizze_46848 = *ctx->tuning_params.add_next_partition_doublezisegmap_tblock_sizze_46812;
    
    int64_t segmap_tblock_sizze_46917;
    
    segmap_tblock_sizze_46917 = *ctx->tuning_params.add_next_partition_doublezisegmap_tblock_sizze_46889;
    
    int64_t new_proc_41586 = add64((int64_t) 1, clProc_28442);
    int64_t new_proc_41587 = add64(n_new_28422, clProc_28444);
    
    if (memblock_alloc_device(ctx, &mem_53575, n_new_28422, "mem_53575")) {
        err = 1;
        goto cleanup;
    }
    if (futrts_builtinzhreplicate_bool(ctx, mem_53575, n_new_28422, 0) != 0) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_53577, bytes_53535, "mem_53577")) {
        err = 1;
        goto cleanup;
    }
    if (futrts_builtinzhreplicate_i64(ctx, mem_53577, n_new_28422, (int64_t) -1) != 0) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_53662, bytes_53661, "mem_53662")) {
        err = 1;
        goto cleanup;
    }
    
    int64_t tmp_offs_55514 = (int64_t) 0;
    
    if ((err = lmad_copy_gpu2gpu_8b(ctx, 1, mem_53662.mem, tmp_offs_55514, (int64_t []) {(int64_t) 1}, clProc_mem_53517.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, (int64_t []) {dz2083U_28419})) != 0)
        goto cleanup;
    tmp_offs_55514 += dz2083U_28419;
    if ((err = lmad_copy_gpu2gpu_8b(ctx, 1, mem_53662.mem, tmp_offs_55514, (int64_t []) {(int64_t) 1}, mem_53659.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, (int64_t []) {m_f_res_41148})) != 0)
        goto cleanup;
    tmp_offs_55514 += m_f_res_41148;
    if (memblock_alloc_device(ctx, &mem_53669, bytes_53668, "mem_53669")) {
        err = 1;
        goto cleanup;
    }
    if ((err = lmad_copy_gpu2gpu_8b(ctx, 1, mem_53669.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, mem_53662.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, (int64_t []) {m_41195})) != 0)
        goto cleanup;
    if (memblock_unref_device(ctx, &mem_53662, "mem_53662") != 0)
        return 1;
    
    int64_t num_tblocks_46492;
    int64_t max_num_tblocks_55515;
    
    max_num_tblocks_55515 = *ctx->tuning_params.add_next_partition_doublezisegmap_num_tblocks_46491;
    num_tblocks_46492 = sext_i64_i32(smax64((int64_t) 1, smin64(sdiv_up64(conc_tmp_41169, segmap_tblock_sizze_46490), max_num_tblocks_55515)));
    if (ctx->debugging)
        fprintf(ctx->log, "%s\n", "\n# SegMap");
    
    int32_t virt_num_tblocks_55516 = sext_i64_i32(sdiv_up64(conc_tmp_41169, segmap_tblock_sizze_46490));
    
    {
        err = gpu_kernel_add_next_partition_doublezisegmap_46487(ctx, num_tblocks_46492, 1, 1, *ctx->tuning_params.add_next_partition_doublezisegmap_tblock_sizze_46489, 1, 1, (int64_t) 0, dz2083U_28419, conc_tmp_41169, m_41195, num_tblocks_46492, virt_num_tblocks_55516, clProc_mem_53517.mem, mem_53659.mem, mem_53665.mem, mem_53667.mem, mem_53669.mem);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (ctx->debugging)
        fprintf(ctx->log, "%s\n", "");
    if (memblock_unref_device(ctx, &mem_53659, "mem_53659") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_53665, "mem_53665") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_53667, "mem_53667") != 0)
        return 1;
    
    int64_t num_whole_tiles_50059 = squot_safe64((int64_t) 8, tile_sizze_50038);
    int64_t residual_input_50234 = srem_safe64((int64_t) 8, tile_sizze_50038);
    bool cond_50235 = residual_input_50234 == (int64_t) 0;
    int64_t binop_x_50245 = tile_sizze_50038 * num_whole_tiles_50059;
    int64_t bytes_53686 = (int64_t) 8 * tile_sizze_50038;
    int64_t shared_memory_capacity_55618;
    
    shared_memory_capacity_55618 = ctx->max_shared_memory;
    if (suff_outer_par_46495 && sle64(sdiv_up64(bytes_53686, (int64_t) 8) * (int64_t) 8, shared_memory_capacity_55618)) {
        int64_t ldim_50039 = sdiv_up64(n_new_28422, tile_sizze_50038);
        
        if (memblock_alloc_device(ctx, &mem_53698, n_new_28422, "mem_53698")) {
            err = 1;
            goto cleanup;
        }
        if (ctx->debugging)
            fprintf(ctx->log, "%s\n", "\n# SegMap");
        
        int32_t num_chunks_55529 = sext_i64_i32(sdiv_up64(tile_sizze_50038, tile_sizze_50038));
        int32_t virt_num_tblocks_55530 = sext_i64_i32(ldim_50039);
        
        {
            err = gpu_kernel_add_next_partition_doublezisegmap_intrablock_50036(ctx, ldim_50039, 1, 1, *ctx->tuning_params.add_next_partition_doublezitile_sizze_50037, 1, 1, bytes_53686 + srem64((int64_t) 8 - srem64(bytes_53686, (int64_t) 8), (int64_t) 8), n_new_28422, zt_res_40980, ldim_50039, clBase_mem_53509.mem, clBase_mem_53510.mem, clBase_mem_53511.mem, new_xs_mem_53533.mem, new_ys_mem_53534.mem, mem_53582.mem, mem_53698.mem);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        ctx->failure_is_an_option = 1;
        if (ctx->debugging)
            fprintf(ctx->log, "%s\n", "");
        if (memblock_set_device(ctx, &ext_mem_53699, &mem_53698, "mem_53698") != 0)
            return 1;
    } else {
        if (memblock_alloc_device(ctx, &mem_53672, n_new_28422, "mem_53672")) {
            err = 1;
            goto cleanup;
        }
        if (ctx->debugging)
            fprintf(ctx->log, "%s\n", "\n# SegRed");
        
        int64_t chunk_sizze_55546 = (int64_t) 1;
        
        if (slt64((int64_t) 16, segred_tblock_sizze_46638 * chunk_sizze_55546)) {
            int64_t segment_sizze_nonzzero_55547 = smax64((int64_t) 1, (int64_t) 8);
            int64_t num_threads_55548 = segred_tblock_sizze_46638 * segred_tblock_sizze_46638;
            
            if (ctx->debugging)
                fprintf(ctx->log, "%s\n", "# SegRed-small");
            if (ctx->debugging)
                fprintf(ctx->log, "%s: %llu%c", "num_segments", (long long) n_new_28422, '\n');
            if (ctx->debugging)
                fprintf(ctx->log, "%s: %llu%c", "segment_size", (long long) (int64_t) 8, '\n');
            if (ctx->debugging)
                fprintf(ctx->log, "%s: %llu%c", "segments_per_block", (long long) squot64(segred_tblock_sizze_46638, segment_sizze_nonzzero_55547), '\n');
            if (ctx->debugging)
                fprintf(ctx->log, "%s: %llu%c", "required_blocks", (long long) sext_i64_i32(sdiv_up64(n_new_28422, squot64(segred_tblock_sizze_46638, segment_sizze_nonzzero_55547))), '\n');
            {
                err = gpu_kernel_add_next_partition_doublezisegred_small_46644(ctx, num_tblocks_46639, 1, 1, *ctx->tuning_params.add_next_partition_doublezisegred_tblock_sizze_46589, 1, 1, segred_tblock_sizze_46638 + srem64((int64_t) 8 - srem64(segred_tblock_sizze_46638, (int64_t) 8), (int64_t) 8), n_new_28422, zt_res_40980, num_tblocks_46639, segment_sizze_nonzzero_55547, clBase_mem_53509.mem, clBase_mem_53510.mem, clBase_mem_53511.mem, new_xs_mem_53533.mem, new_ys_mem_53534.mem, mem_53582.mem, mem_53672.mem);
                if (err != FUTHARK_SUCCESS)
                    goto cleanup;
            }
            ctx->failure_is_an_option = 1;
        } else {
            int64_t blocks_per_segment_55575 = sdiv_up64(num_tblocks_46639, smax64((int64_t) 1, n_new_28422));
            int64_t q_55576 = sdiv_up64((int64_t) 8, segred_tblock_sizze_46638 * blocks_per_segment_55575 * chunk_sizze_55546);
            int64_t num_virtblocks_55577 = blocks_per_segment_55575 * n_new_28422;
            int64_t threads_per_segment_55578 = blocks_per_segment_55575 * segred_tblock_sizze_46638;
            
            if (ctx->debugging)
                fprintf(ctx->log, "%s\n", "# SegRed-large");
            if (ctx->debugging)
                fprintf(ctx->log, "%s: %llu%c", "num_segments", (long long) n_new_28422, '\n');
            if (ctx->debugging)
                fprintf(ctx->log, "%s: %llu%c", "segment_size", (long long) (int64_t) 8, '\n');
            if (ctx->debugging)
                fprintf(ctx->log, "%s: %llu%c", "num_virtblocks", (long long) num_virtblocks_55577, '\n');
            if (ctx->debugging)
                fprintf(ctx->log, "%s: %llu%c", "num_tblocks", (long long) num_tblocks_46639, '\n');
            if (ctx->debugging)
                fprintf(ctx->log, "%s: %llu%c", "tblock_size", (long long) segred_tblock_sizze_46638, '\n');
            if (ctx->debugging)
                fprintf(ctx->log, "%s: %llu%c", "q", (long long) q_55576, '\n');
            if (ctx->debugging)
                fprintf(ctx->log, "%s: %llu%c", "blocks_per_segment", (long long) blocks_per_segment_55575, '\n');
            if (memblock_alloc_device(ctx, &segred_tmp_mem_55579, num_virtblocks_55577, "segred_tmp_mem_55579")) {
                err = 1;
                goto cleanup;
            }
            {
                err = gpu_kernel_add_next_partition_doublezisegred_large_46644(ctx, num_tblocks_46639, 1, 1, *ctx->tuning_params.add_next_partition_doublezisegred_tblock_sizze_46589, 1, 1, 8 + (segred_tblock_sizze_46638 + srem64((int64_t) 8 - srem64(segred_tblock_sizze_46638, (int64_t) 8), (int64_t) 8)), n_new_28422, zt_res_40980, num_tblocks_46639, blocks_per_segment_55575, q_55576, num_virtblocks_55577, threads_per_segment_55578, clBase_mem_53509.mem, clBase_mem_53510.mem, clBase_mem_53511.mem, new_xs_mem_53533.mem, new_ys_mem_53534.mem, mem_53582.mem, mem_53672.mem, segred_tmp_mem_55579.mem, counters_mem_55581.mem);
                if (err != FUTHARK_SUCCESS)
                    goto cleanup;
            }
            ctx->failure_is_an_option = 1;
        }
        if (ctx->debugging)
            fprintf(ctx->log, "%s\n", "");
        if (memblock_set_device(ctx, &ext_mem_53699, &mem_53672, "mem_53672") != 0)
            return 1;
    }
    if (memblock_alloc_device(ctx, &mem_53701, n_new_28422, "mem_53701")) {
        err = 1;
        goto cleanup;
    }
    if (ctx->debugging)
        fprintf(ctx->log, "%s\n", "\n# SegMap");
    
    int32_t virt_num_tblocks_55619 = sext_i64_i32(sdiv_up64(n_new_28422, segmap_tblock_sizze_46732));
    
    {
        err = gpu_kernel_add_next_partition_doublezisegmap_46736(ctx, segmap_usable_groups_46733, 1, 1, *ctx->tuning_params.add_next_partition_doublezisegmap_tblock_sizze_46686, 1, 1, (int64_t) 0, n_new_28422, clBase_28427, clBase_mem_53509.mem, clBase_mem_53510.mem, clBase_mem_53511.mem, new_xs_mem_53533.mem, new_ys_mem_53534.mem, mem_53582.mem, ext_mem_53699.mem, mem_53701.mem);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    ctx->failure_is_an_option = 1;
    if (ctx->debugging)
        fprintf(ctx->log, "%s\n", "");
    
    int64_t y_41488 = (int64_t) -1 + partition_sizze_41486;
    
    if (ctx->debugging)
        fprintf(ctx->log, "%s\n", "\n# SegMap");
    
    int32_t virt_num_tblocks_55629 = sext_i64_i32(sdiv_up64(dzlz7bUZLzpZRz20Udz2082Uz20Udz2084Uz2088Uz2083Uz7dUzg_41379, segmap_tblock_sizze_46805));
    
    {
        err = gpu_kernel_add_next_partition_doublezisegmap_46802(ctx, num_tblocks_46807, 1, 1, *ctx->tuning_params.add_next_partition_doublezisegmap_tblock_sizze_46804, 1, 1, (int64_t) 0, dzlz7bUZLzpZRz20Udz2082Uz20Udz2084Uz2088Uz2083Uz7dUzg_41379, y_41488, num_tblocks_46807, virt_num_tblocks_55629, mem_53574.mem, mem_53704.mem, mem_53706.mem, mem_53708.mem);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (ctx->debugging)
        fprintf(ctx->log, "%s\n", "");
    if (memblock_unref_device(ctx, &mem_53704, "mem_53704") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_53706, "mem_53706") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_53708, "mem_53708") != 0)
        return 1;
    
    int64_t segmap_usable_groups_46849 = sdiv_up64(partition_sizze_41486, segmap_tblock_sizze_46848);
    
    if (memblock_alloc_device(ctx, &mem_53712, bytes_53711, "mem_53712")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_53714, bytes_53711, "mem_53714")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_53715, partition_sizze_41486, "mem_53715")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_53717, bytes_53711, "mem_53717")) {
        err = 1;
        goto cleanup;
    }
    if (ctx->debugging)
        fprintf(ctx->log, "%s\n", "\n# SegMap");
    
    int32_t virt_num_tblocks_55642 = sext_i64_i32(sdiv_up64(partition_sizze_41486, segmap_tblock_sizze_46848));
    
    {
        err = gpu_kernel_add_next_partition_doublezisegmap_46855(ctx, segmap_usable_groups_46849, 1, 1, *ctx->tuning_params.add_next_partition_doublezisegmap_tblock_sizze_46812, 1, 1, (int64_t) 0, dz2080U_28416, dz2081U_28417, dz2082U_28418, dzlz7bUZLzpZRz20Udz2082Uz20Udz2084Uz2088Uz2083Uz7dUzg_41379, conc_tmp_41380, conc_tmp_41381, partition_sizze_41486, clProc_mem_53512.mem, clProc_mem_53513.mem, clProc_mem_53514.mem, clProc_mem_53515.mem, mem_53548.mem, mem_53550.mem, mem_53551.mem, mem_53553.mem, mem_53574.mem, mem_53712.mem, mem_53714.mem, mem_53715.mem, mem_53717.mem);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    ctx->failure_is_an_option = 1;
    if (ctx->debugging)
        fprintf(ctx->log, "%s\n", "");
    if (memblock_unref_device(ctx, &mem_53551, "mem_53551") != 0)
        return 1;
    
    int64_t segmap_usable_groups_46918 = sdiv_up64(j_m_i_41512, segmap_tblock_sizze_46917);
    
    if (memblock_alloc_device(ctx, &mem_53726, bytes_53725, "mem_53726")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_53728, bytes_53725, "mem_53728")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_53730, bytes_53725, "mem_53730")) {
        err = 1;
        goto cleanup;
    }
    if (ctx->debugging)
        fprintf(ctx->log, "%s\n", "\n# SegMap");
    
    int32_t virt_num_tblocks_55651 = sext_i64_i32(sdiv_up64(j_m_i_41512, segmap_tblock_sizze_46917));
    
    {
        err = gpu_kernel_add_next_partition_doublezisegmap_46923(ctx, segmap_usable_groups_46918, 1, 1, *ctx->tuning_params.add_next_partition_doublezisegmap_tblock_sizze_46889, 1, 1, (int64_t) 0, dz2081U_28417, dz2082U_28418, j_m_i_41365, dzlz7bUZLzpZRz20Udz2082Uz20Udz2084Uz2088Uz2083Uz7dUzg_41379, conc_tmp_41381, partition_sizze_41486, j_m_i_41512, clProc_mem_53513.mem, clProc_mem_53514.mem, clProc_mem_53515.mem, mem_53548.mem, mem_53550.mem, mem_53553.mem, mem_53574.mem, mem_53726.mem, mem_53728.mem, mem_53730.mem);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    ctx->failure_is_an_option = 1;
    if (ctx->debugging)
        fprintf(ctx->log, "%s\n", "");
    if (memblock_unref_device(ctx, &mem_53574, "mem_53574") != 0)
        return 1;
    
    int64_t tmp_offs_55660 = (int64_t) 0;
    
    if ((err = lmad_copy_gpu2gpu_8b(ctx, 1, mem_53726.mem, tmp_offs_55660, (int64_t []) {(int64_t) 1}, mem_53548.mem, partition_sizze_41331, (int64_t []) {(int64_t) 1}, (int64_t []) {j_m_i_41365})) != 0)
        goto cleanup;
    tmp_offs_55660 += j_m_i_41365;
    if (!(tmp_offs_55660 == j_m_i_41365)) {
        if ((err = lmad_copy_gpu2gpu_8b(ctx, 1, mem_53726.mem, tmp_offs_55660, (int64_t []) {(int64_t) 1}, mem_53726.mem, j_m_i_41365, (int64_t []) {(int64_t) 1}, (int64_t []) {j_m_i_41512})) != 0)
            goto cleanup;
    }
    tmp_offs_55660 += j_m_i_41512;
    if (memblock_unref_device(ctx, &mem_53548, "mem_53548") != 0)
        return 1;
    
    int64_t tmp_offs_55661 = (int64_t) 0;
    
    if ((err = lmad_copy_gpu2gpu_8b(ctx, 1, mem_53728.mem, tmp_offs_55661, (int64_t []) {(int64_t) 1}, mem_53550.mem, partition_sizze_41331, (int64_t []) {(int64_t) 1}, (int64_t []) {j_m_i_41365})) != 0)
        goto cleanup;
    tmp_offs_55661 += j_m_i_41365;
    if (!(tmp_offs_55661 == j_m_i_41365)) {
        if ((err = lmad_copy_gpu2gpu_8b(ctx, 1, mem_53728.mem, tmp_offs_55661, (int64_t []) {(int64_t) 1}, mem_53728.mem, j_m_i_41365, (int64_t []) {(int64_t) 1}, (int64_t []) {j_m_i_41512})) != 0)
            goto cleanup;
    }
    tmp_offs_55661 += j_m_i_41512;
    if (memblock_unref_device(ctx, &mem_53550, "mem_53550") != 0)
        return 1;
    
    int64_t tmp_offs_55662 = (int64_t) 0;
    
    if ((err = lmad_copy_gpu2gpu_8b(ctx, 1, mem_53730.mem, tmp_offs_55662, (int64_t []) {(int64_t) 1}, mem_53553.mem, partition_sizze_41331, (int64_t []) {(int64_t) 1}, (int64_t []) {j_m_i_41365})) != 0)
        goto cleanup;
    tmp_offs_55662 += j_m_i_41365;
    if (!(tmp_offs_55662 == j_m_i_41365)) {
        if ((err = lmad_copy_gpu2gpu_8b(ctx, 1, mem_53730.mem, tmp_offs_55662, (int64_t []) {(int64_t) 1}, mem_53730.mem, j_m_i_41365, (int64_t []) {(int64_t) 1}, (int64_t []) {j_m_i_41512})) != 0)
            goto cleanup;
    }
    tmp_offs_55662 += j_m_i_41512;
    if (memblock_unref_device(ctx, &mem_53553, "mem_53553") != 0)
        return 1;
    if (memblock_alloc_device(ctx, &mem_53731, (int64_t) 16, "mem_53731")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_53732, (int64_t) 16, "mem_53732")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_53733, (int64_t) 16, "mem_53733")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_53734, (int64_t) 16, "mem_53734")) {
        err = 1;
        goto cleanup;
    }
    {
        err = gpu_kernel_add_next_partition_doublezigpuseq_55663(ctx, (int64_t) 1, 1, 1, (int64_t) 1, 1, 1, (int64_t) 0, zt_res_40980, mem_53583.mem, mem_53584.mem, mem_53585.mem, mem_53586.mem, mem_53587.mem, mem_53588.mem, mem_53589.mem, mem_53590.mem, ext_mem_53654.mem, mem_53731.mem, mem_53732.mem, mem_53733.mem, mem_53734.mem);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (memblock_unref_device(ctx, &mem_53583, "mem_53583") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_53584, "mem_53584") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_53585, "mem_53585") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_53586, "mem_53586") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_53587, "mem_53587") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_53588, "mem_53588") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_53589, "mem_53589") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_53590, "mem_53590") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_53731, "mem_53731") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_53732, "mem_53732") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_54541, &chain_collisions_mem_53506, "chain_collisions_mem_53506") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_54542, &chain_collisions_mem_53507, "chain_collisions_mem_53507") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_54543, &clBase_mem_53508, "clBase_mem_53508") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_54544, &clBase_mem_53509, "clBase_mem_53509") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_54545, &clBase_mem_53510, "clBase_mem_53510") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_54546, &clBase_mem_53511, "clBase_mem_53511") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_54547, &mem_53715, "mem_53715") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_54548, &mem_53717, "mem_53717") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_54549, &mem_53712, "mem_53712") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_54550, &mem_53714, "mem_53714") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_54551, &mem_53539, "mem_53539") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_54552, &mem_53669, "mem_53669") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_54553, &mem_53577, "mem_53577") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_54554, &mem_53538, "mem_53538") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_54555, &mem_53536, "mem_53536") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_54556, &mem_53734, "mem_53734") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_54557, &mem_53733, "mem_53733") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_54558, &mem_53575, "mem_53575") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_54559, &ext_mem_53699, "ext_mem_53699") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_54560, &ext_mem_53654, "ext_mem_53654") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_54561, &mem_53701, "mem_53701") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_54562, &mem_53593, "mem_53593") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_54563, &mem_53592, "mem_53592") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_54564, &mem_53582, "mem_53582") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_54565, &mem_53726, "mem_53726") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_54566, &mem_53728, "mem_53728") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_54567, &mem_53730, "mem_53730") != 0)
        return 1;
    prim_out_54568 = partition_sizze_41486;
    prim_out_54569 = m_41195;
    prim_out_54570 = conc_tmp_41583;
    prim_out_54571 = clBase_28425;
    prim_out_54572 = clBase_28426;
    prim_out_54573 = clBase_28427;
    prim_out_54574 = clBase_28428;
    prim_out_54575 = clBase_28430;
    prim_out_54576 = clBase_28433;
    prim_out_54577 = clBase_28435;
    prim_out_54578 = clProc_28440;
    prim_out_54579 = new_id_28463;
    prim_out_54580 = new_proc_41586;
    prim_out_54581 = new_proc_41587;
    prim_out_54582 = clProc_28444;
    prim_out_54583 = new_id_28463;
    if (memblock_set_device(ctx, &*mem_out_p_56891, &mem_out_54541, "mem_out_54541") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_56892, &mem_out_54542, "mem_out_54542") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_56893, &mem_out_54543, "mem_out_54543") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_56894, &mem_out_54544, "mem_out_54544") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_56895, &mem_out_54545, "mem_out_54545") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_56896, &mem_out_54546, "mem_out_54546") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_56897, &mem_out_54547, "mem_out_54547") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_56898, &mem_out_54548, "mem_out_54548") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_56899, &mem_out_54549, "mem_out_54549") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_56900, &mem_out_54550, "mem_out_54550") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_56901, &mem_out_54551, "mem_out_54551") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_56902, &mem_out_54552, "mem_out_54552") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_56903, &mem_out_54553, "mem_out_54553") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_56904, &mem_out_54554, "mem_out_54554") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_56905, &mem_out_54555, "mem_out_54555") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_56906, &mem_out_54556, "mem_out_54556") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_56907, &mem_out_54557, "mem_out_54557") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_56908, &mem_out_54558, "mem_out_54558") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_56909, &mem_out_54559, "mem_out_54559") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_56910, &mem_out_54560, "mem_out_54560") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_56911, &mem_out_54561, "mem_out_54561") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_56912, &mem_out_54562, "mem_out_54562") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_56913, &mem_out_54563, "mem_out_54563") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_56914, &mem_out_54564, "mem_out_54564") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_56915, &mem_out_54565, "mem_out_54565") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_56916, &mem_out_54566, "mem_out_54566") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_56917, &mem_out_54567, "mem_out_54567") != 0)
        return 1;
    *out_prim_out_56918 = prim_out_54568;
    *out_prim_out_56919 = prim_out_54569;
    *out_prim_out_56920 = prim_out_54570;
    *out_prim_out_56921 = prim_out_54571;
    *out_prim_out_56922 = prim_out_54572;
    *out_prim_out_56923 = prim_out_54573;
    *out_prim_out_56924 = prim_out_54574;
    *out_prim_out_56925 = prim_out_54575;
    *out_prim_out_56926 = prim_out_54576;
    *out_prim_out_56927 = prim_out_54577;
    *out_prim_out_56928 = prim_out_54578;
    *out_prim_out_56929 = prim_out_54579;
    *out_prim_out_56930 = prim_out_54580;
    *out_prim_out_56931 = prim_out_54581;
    *out_prim_out_56932 = prim_out_54582;
    *out_prim_out_56933 = prim_out_54583;
    
  cleanup:
    {
        if (memblock_unref_device(ctx, &mem_53734, "mem_53734") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53733, "mem_53733") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53732, "mem_53732") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53731, "mem_53731") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53730, "mem_53730") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53728, "mem_53728") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53726, "mem_53726") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53717, "mem_53717") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53715, "mem_53715") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53714, "mem_53714") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53712, "mem_53712") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53701, "mem_53701") != 0)
            return 1;
        if (memblock_unref_device(ctx, &segred_tmp_mem_55579, "segred_tmp_mem_55579") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53672, "mem_53672") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53698, "mem_53698") != 0)
            return 1;
        if (memblock_unref_device(ctx, &ext_mem_53699, "ext_mem_53699") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53669, "mem_53669") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53662, "mem_53662") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53577, "mem_53577") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53575, "mem_53575") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53574, "mem_53574") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53538, "mem_53538") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53536, "mem_53536") != 0)
            return 1;
        if (memblock_unref_device(ctx, &incprefixes_mem_55332, "incprefixes_mem_55332") != 0)
            return 1;
        if (memblock_unref_device(ctx, &aggregates_mem_55330, "aggregates_mem_55330") != 0)
            return 1;
        if (memblock_unref_device(ctx, &incprefixes_mem_55328, "incprefixes_mem_55328") != 0)
            return 1;
        if (memblock_unref_device(ctx, &aggregates_mem_55326, "aggregates_mem_55326") != 0)
            return 1;
        if (memblock_unref_device(ctx, &status_flags_mem_55324, "status_flags_mem_55324") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53708, "mem_53708") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53706, "mem_53706") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53704, "mem_53704") != 0)
            return 1;
        if (memblock_unref_device(ctx, &incprefixes_mem_55226, "incprefixes_mem_55226") != 0)
            return 1;
        if (memblock_unref_device(ctx, &aggregates_mem_55224, "aggregates_mem_55224") != 0)
            return 1;
        if (memblock_unref_device(ctx, &status_flags_mem_55222, "status_flags_mem_55222") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53667, "mem_53667") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53665, "mem_53665") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53659, "mem_53659") != 0)
            return 1;
        if (memblock_unref_device(ctx, &incprefixes_mem_55110, "incprefixes_mem_55110") != 0)
            return 1;
        if (memblock_unref_device(ctx, &aggregates_mem_55108, "aggregates_mem_55108") != 0)
            return 1;
        if (memblock_unref_device(ctx, &status_flags_mem_55106, "status_flags_mem_55106") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53648, "mem_53648") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53646, "mem_53646") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53600, "mem_53600") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53599, "mem_53599") != 0)
            return 1;
        if (memblock_unref_device(ctx, &segred_tmp_mem_55048, "segred_tmp_mem_55048") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53597, "mem_53597") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53595, "mem_53595") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53604, "mem_53604") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53603, "mem_53603") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53602, "mem_53602") != 0)
            return 1;
        if (memblock_unref_device(ctx, &ext_mem_53605, "ext_mem_53605") != 0)
            return 1;
        if (memblock_unref_device(ctx, &ext_mem_53606, "ext_mem_53606") != 0)
            return 1;
        if (memblock_unref_device(ctx, &ext_mem_53607, "ext_mem_53607") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53642, "mem_53642") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53641, "mem_53641") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53640, "mem_53640") != 0)
            return 1;
        if (memblock_unref_device(ctx, &ext_mem_53643, "ext_mem_53643") != 0)
            return 1;
        if (memblock_unref_device(ctx, &ext_mem_53644, "ext_mem_53644") != 0)
            return 1;
        if (memblock_unref_device(ctx, &ext_mem_53645, "ext_mem_53645") != 0)
            return 1;
        if (memblock_unref_device(ctx, &ext_mem_53654, "ext_mem_53654") != 0)
            return 1;
        if (memblock_unref_device(ctx, &ext_mem_53655, "ext_mem_53655") != 0)
            return 1;
        if (memblock_unref_device(ctx, &ext_mem_53656, "ext_mem_53656") != 0)
            return 1;
        if (memblock_unref_device(ctx, &ext_mem_53657, "ext_mem_53657") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53593, "mem_53593") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53592, "mem_53592") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53591, "mem_53591") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53590, "mem_53590") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53589, "mem_53589") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53588, "mem_53588") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53587, "mem_53587") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53586, "mem_53586") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53585, "mem_53585") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53584, "mem_53584") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53583, "mem_53583") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53582, "mem_53582") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53581, "mem_53581") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53580, "mem_53580") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53579, "mem_53579") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53578, "mem_53578") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53570, "mem_53570") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53571, "mem_53571") != 0)
            return 1;
        if (memblock_unref_device(ctx, &ext_mem_53572, "ext_mem_53572") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53567, "mem_53567") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53568, "mem_53568") != 0)
            return 1;
        if (memblock_unref_device(ctx, &ext_mem_53569, "ext_mem_53569") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53564, "mem_53564") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53565, "mem_53565") != 0)
            return 1;
        if (memblock_unref_device(ctx, &ext_mem_53566, "ext_mem_53566") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53561, "mem_53561") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53562, "mem_53562") != 0)
            return 1;
        if (memblock_unref_device(ctx, &ext_mem_53563, "ext_mem_53563") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53558, "mem_53558") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53559, "mem_53559") != 0)
            return 1;
        if (memblock_unref_device(ctx, &ext_mem_53560, "ext_mem_53560") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53555, "mem_53555") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53556, "mem_53556") != 0)
            return 1;
        if (memblock_unref_device(ctx, &ext_mem_53557, "ext_mem_53557") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53553, "mem_53553") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53551, "mem_53551") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53550, "mem_53550") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53548, "mem_53548") != 0)
            return 1;
        if (memblock_unref_device(ctx, &incprefixes_mem_54624, "incprefixes_mem_54624") != 0)
            return 1;
        if (memblock_unref_device(ctx, &aggregates_mem_54622, "aggregates_mem_54622") != 0)
            return 1;
        if (memblock_unref_device(ctx, &incprefixes_mem_54620, "incprefixes_mem_54620") != 0)
            return 1;
        if (memblock_unref_device(ctx, &aggregates_mem_54618, "aggregates_mem_54618") != 0)
            return 1;
        if (memblock_unref_device(ctx, &status_flags_mem_54596, "status_flags_mem_54596") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53546, "mem_53546") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53544, "mem_53544") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53542, "mem_53542") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53539, "mem_53539") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_54567, "mem_out_54567") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_54566, "mem_out_54566") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_54565, "mem_out_54565") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_54564, "mem_out_54564") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_54563, "mem_out_54563") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_54562, "mem_out_54562") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_54561, "mem_out_54561") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_54560, "mem_out_54560") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_54559, "mem_out_54559") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_54558, "mem_out_54558") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_54557, "mem_out_54557") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_54556, "mem_out_54556") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_54555, "mem_out_54555") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_54554, "mem_out_54554") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_54553, "mem_out_54553") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_54552, "mem_out_54552") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_54551, "mem_out_54551") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_54550, "mem_out_54550") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_54549, "mem_out_54549") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_54548, "mem_out_54548") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_54547, "mem_out_54547") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_54546, "mem_out_54546") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_54545, "mem_out_54545") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_54544, "mem_out_54544") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_54543, "mem_out_54543") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_54542, "mem_out_54542") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_54541, "mem_out_54541") != 0)
            return 1;
    }
    return err;
}
FUTHARK_FUN_ATTR int futrts_entry_do_DBSCAN_double(struct futhark_context *ctx, struct memblock_device *mem_out_p_56939, struct memblock_device *mem_out_p_56940, struct memblock_device *mem_out_p_56941, struct memblock_device *mem_out_p_56942, struct memblock_device *mem_out_p_56943, struct memblock_device *mem_out_p_56944, struct memblock_device *mem_out_p_56945, struct memblock_device *mem_out_p_56946, struct memblock_device *mem_out_p_56947, struct memblock_device *mem_out_p_56948, struct memblock_device *mem_out_p_56949, struct memblock_device *mem_out_p_56950, struct memblock_device *mem_out_p_56951, struct memblock_device *mem_out_p_56952, struct memblock_device *mem_out_p_56953, struct memblock_device *mem_out_p_56954, struct memblock_device *mem_out_p_56955, struct memblock_device *mem_out_p_56956, struct memblock_device *mem_out_p_56957, struct memblock_device *mem_out_p_56958, struct memblock_device *mem_out_p_56959, struct memblock_device *mem_out_p_56960, struct memblock_device *mem_out_p_56961, struct memblock_device *mem_out_p_56962, struct memblock_device *mem_out_p_56963, struct memblock_device *mem_out_p_56964, struct memblock_device *mem_out_p_56965, int64_t *out_prim_out_56966, int8_t *out_prim_out_56967, int8_t *out_prim_out_56968, double *out_prim_out_56969, int64_t *out_prim_out_56970, int64_t *out_prim_out_56971, double *out_prim_out_56972, int64_t *out_prim_out_56973, int64_t *out_prim_out_56974, int64_t *out_prim_out_56975, int64_t *out_prim_out_56976, int64_t *out_prim_out_56977, int64_t *out_prim_out_56978, int64_t *out_prim_out_56979, struct memblock_device chain_collisions_mem_53506, struct memblock_device chain_collisions_mem_53507, struct memblock_device clBase_mem_53508, struct memblock_device clBase_mem_53509, struct memblock_device clBase_mem_53510, struct memblock_device clBase_mem_53511, struct memblock_device clProc_mem_53512, struct memblock_device clProc_mem_53513, struct memblock_device clProc_mem_53514, struct memblock_device clProc_mem_53515, struct memblock_device clProc_mem_53516, struct memblock_device clProc_mem_53517, struct memblock_device current_partition_mem_53518, struct memblock_device current_partition_mem_53519, struct memblock_device current_partition_mem_53520, struct memblock_device current_partition_mem_53521, struct memblock_device current_partition_mem_53522, struct memblock_device current_partition_mem_53523, struct memblock_device current_partition_mem_53524, struct memblock_device current_partition_mem_53525, struct memblock_device current_partition_mem_53526, struct memblock_device current_partition_mem_53527, struct memblock_device current_partition_mem_53528, struct memblock_device current_partition_mem_53529, struct memblock_device toFlush_dat_mem_53530, struct memblock_device toFlush_dat_mem_53531, struct memblock_device toFlush_ids_mem_53532, int64_t n_36798, int64_t part_no_36799, int64_t dz2084U_36800, int64_t dz2080U_36801, int64_t dz2081U_36802, int64_t dz2082U_36803, int64_t dz2083U_36804, int64_t dz2085U_36805, int64_t dz2086U_36806, int8_t clBase_36809, int8_t clBase_36810, double clBase_36811, int64_t clBase_36812, int64_t clBase_36814, double clBase_36817, int64_t clBase_36819, int64_t clProc_36824, int64_t clProc_36825, int64_t clProc_36826, int64_t clProc_36828, int64_t clProc_36829, int64_t current_partition_36843, int64_t gather_psizze_36847)
{
    (void) ctx;
    
    int err = 0;
    struct memblock_device mem_54347;
    
    mem_54347.references = NULL;
    
    struct memblock_device mem_54346;
    
    mem_54346.references = NULL;
    
    struct memblock_device mem_54344;
    
    mem_54344.references = NULL;
    
    struct memblock_device segred_tmp_mem_56852;
    
    segred_tmp_mem_56852.references = NULL;
    
    struct memblock_device mem_54342;
    
    mem_54342.references = NULL;
    
    struct memblock_device segred_tmp_mem_56817;
    
    segred_tmp_mem_56817.references = NULL;
    
    struct memblock_device mem_54340;
    
    mem_54340.references = NULL;
    
    struct memblock_device segred_tmp_mem_56762;
    
    segred_tmp_mem_56762.references = NULL;
    
    struct memblock_device segred_tmp_mem_56760;
    
    segred_tmp_mem_56760.references = NULL;
    
    struct memblock_device mem_54274;
    
    mem_54274.references = NULL;
    
    struct memblock_device mem_54269;
    
    mem_54269.references = NULL;
    
    struct memblock_device mem_54267;
    
    mem_54267.references = NULL;
    
    struct memblock_device mem_54265;
    
    mem_54265.references = NULL;
    
    struct memblock_device mem_54258;
    
    mem_54258.references = NULL;
    
    struct memblock_device mem_54256;
    
    mem_54256.references = NULL;
    
    struct memblock_device segred_tmp_mem_56603;
    
    segred_tmp_mem_56603.references = NULL;
    
    struct memblock_device segred_tmp_mem_56601;
    
    segred_tmp_mem_56601.references = NULL;
    
    struct memblock_device mem_54027;
    
    mem_54027.references = NULL;
    
    struct memblock_device mem_54022;
    
    mem_54022.references = NULL;
    
    struct memblock_device mem_54020;
    
    mem_54020.references = NULL;
    
    struct memblock_device mem_54018;
    
    mem_54018.references = NULL;
    
    struct memblock_device mem_54012;
    
    mem_54012.references = NULL;
    
    struct memblock_device mem_54010;
    
    mem_54010.references = NULL;
    
    struct memblock_device mem_53626;
    
    mem_53626.references = NULL;
    
    struct memblock_device mem_53559;
    
    mem_53559.references = NULL;
    
    struct memblock_device mem_53558;
    
    mem_53558.references = NULL;
    
    struct memblock_device mem_53557;
    
    mem_53557.references = NULL;
    
    struct memblock_device mem_53556;
    
    mem_53556.references = NULL;
    
    struct memblock_device mem_53551;
    
    mem_53551.references = NULL;
    
    struct memblock_device mem_53549;
    
    mem_53549.references = NULL;
    
    struct memblock_device incprefixes_mem_56423;
    
    incprefixes_mem_56423.references = NULL;
    
    struct memblock_device aggregates_mem_56421;
    
    aggregates_mem_56421.references = NULL;
    
    struct memblock_device status_flags_mem_56419;
    
    status_flags_mem_56419.references = NULL;
    
    struct memblock_device mem_54247;
    
    mem_54247.references = NULL;
    
    struct memblock_device mem_54244;
    
    mem_54244.references = NULL;
    
    struct memblock_device mem_54169;
    
    mem_54169.references = NULL;
    
    struct memblock_device mem_54241;
    
    mem_54241.references = NULL;
    
    struct memblock_device ext_mem_54242;
    
    ext_mem_54242.references = NULL;
    
    struct memblock_device ext_mem_54253;
    
    ext_mem_54253.references = NULL;
    
    struct memblock_device ext_mem_54254;
    
    ext_mem_54254.references = NULL;
    
    struct memblock_device mem_54096;
    
    mem_54096.references = NULL;
    
    struct memblock_device mem_54094;
    
    mem_54094.references = NULL;
    
    struct memblock_device incprefixes_mem_56149;
    
    incprefixes_mem_56149.references = NULL;
    
    struct memblock_device aggregates_mem_56147;
    
    aggregates_mem_56147.references = NULL;
    
    struct memblock_device status_flags_mem_56145;
    
    status_flags_mem_56145.references = NULL;
    
    struct memblock_device mem_53997;
    
    mem_53997.references = NULL;
    
    struct memblock_device mem_53994;
    
    mem_53994.references = NULL;
    
    struct memblock_device mem_53940;
    
    mem_53940.references = NULL;
    
    struct memblock_device mem_53938;
    
    mem_53938.references = NULL;
    
    struct memblock_device mem_53990;
    
    mem_53990.references = NULL;
    
    struct memblock_device mem_53988;
    
    mem_53988.references = NULL;
    
    struct memblock_device ext_mem_53991;
    
    ext_mem_53991.references = NULL;
    
    struct memblock_device ext_mem_53992;
    
    ext_mem_53992.references = NULL;
    
    struct memblock_device ext_mem_54005;
    
    ext_mem_54005.references = NULL;
    
    struct memblock_device ext_mem_54006;
    
    ext_mem_54006.references = NULL;
    
    struct memblock_device ext_mem_54007;
    
    ext_mem_54007.references = NULL;
    
    struct memblock_device mem_53889;
    
    mem_53889.references = NULL;
    
    struct memblock_device mem_53887;
    
    mem_53887.references = NULL;
    
    struct memblock_device incprefixes_mem_55882;
    
    incprefixes_mem_55882.references = NULL;
    
    struct memblock_device aggregates_mem_55880;
    
    aggregates_mem_55880.references = NULL;
    
    struct memblock_device status_flags_mem_55878;
    
    status_flags_mem_55878.references = NULL;
    
    struct memblock_device mem_53878;
    
    mem_53878.references = NULL;
    
    struct memblock_device mem_53875;
    
    mem_53875.references = NULL;
    
    struct memblock_device mem_53810;
    
    mem_53810.references = NULL;
    
    struct memblock_device mem_53872;
    
    mem_53872.references = NULL;
    
    struct memblock_device ext_mem_53873;
    
    ext_mem_53873.references = NULL;
    
    struct memblock_device ext_mem_53884;
    
    ext_mem_53884.references = NULL;
    
    struct memblock_device ext_mem_53885;
    
    ext_mem_53885.references = NULL;
    
    struct memblock_device mem_53747;
    
    mem_53747.references = NULL;
    
    struct memblock_device mem_53745;
    
    mem_53745.references = NULL;
    
    struct memblock_device mem_param_tmp_55679;
    
    mem_param_tmp_55679.references = NULL;
    
    struct memblock_device mem_53739;
    
    mem_53739.references = NULL;
    
    struct memblock_device mem_param_53736;
    
    mem_param_53736.references = NULL;
    
    struct memblock_device ext_mem_53742;
    
    ext_mem_53742.references = NULL;
    
    struct memblock_device mem_53733;
    
    mem_53733.references = NULL;
    
    struct memblock_device incprefixes_mem_55579;
    
    incprefixes_mem_55579.references = NULL;
    
    struct memblock_device aggregates_mem_55577;
    
    aggregates_mem_55577.references = NULL;
    
    struct memblock_device status_flags_mem_55575;
    
    status_flags_mem_55575.references = NULL;
    
    struct memblock_device mem_53730;
    
    mem_53730.references = NULL;
    
    struct memblock_device mem_param_tmp_55428;
    
    mem_param_tmp_55428.references = NULL;
    
    struct memblock_device segred_tmp_mem_55536;
    
    segred_tmp_mem_55536.references = NULL;
    
    struct memblock_device mem_param_tmp_55431;
    
    mem_param_tmp_55431.references = NULL;
    
    struct memblock_device mem_53719;
    
    mem_53719.references = NULL;
    
    struct memblock_device segred_tmp_mem_55493;
    
    segred_tmp_mem_55493.references = NULL;
    
    struct memblock_device mem_53662;
    
    mem_53662.references = NULL;
    
    struct memblock_device mem_53659;
    
    mem_53659.references = NULL;
    
    struct memblock_device mem_53657;
    
    mem_53657.references = NULL;
    
    struct memblock_device mem_53655;
    
    mem_53655.references = NULL;
    
    struct memblock_device mem_53716;
    
    mem_53716.references = NULL;
    
    struct memblock_device ext_mem_53717;
    
    ext_mem_53717.references = NULL;
    
    struct memblock_device mem_param_53652;
    
    mem_param_53652.references = NULL;
    
    struct memblock_device ext_mem_53722;
    
    ext_mem_53722.references = NULL;
    
    struct memblock_device mem_param_53649;
    
    mem_param_53649.references = NULL;
    
    struct memblock_device ext_mem_53727;
    
    ext_mem_53727.references = NULL;
    
    struct memblock_device mem_53724;
    
    mem_53724.references = NULL;
    
    struct memblock_device mem_53646;
    
    mem_53646.references = NULL;
    
    struct memblock_device mem_53644;
    
    mem_53644.references = NULL;
    
    struct memblock_device mem_53642;
    
    mem_53642.references = NULL;
    
    struct memblock_device incprefixes_mem_55336;
    
    incprefixes_mem_55336.references = NULL;
    
    struct memblock_device aggregates_mem_55334;
    
    aggregates_mem_55334.references = NULL;
    
    struct memblock_device status_flags_mem_55332;
    
    status_flags_mem_55332.references = NULL;
    
    struct memblock_device mem_53640;
    
    mem_53640.references = NULL;
    
    struct memblock_device mem_53638;
    
    mem_53638.references = NULL;
    
    struct memblock_device mem_53635;
    
    mem_53635.references = NULL;
    
    struct memblock_device mem_53632;
    
    mem_53632.references = NULL;
    
    struct memblock_device mem_53630;
    
    mem_53630.references = NULL;
    
    struct memblock_device mem_53628;
    
    mem_53628.references = NULL;
    
    struct memblock_device incprefixes_mem_55219;
    
    incprefixes_mem_55219.references = NULL;
    
    struct memblock_device aggregates_mem_55217;
    
    aggregates_mem_55217.references = NULL;
    
    struct memblock_device status_flags_mem_55215;
    
    status_flags_mem_55215.references = NULL;
    
    struct memblock_device mem_53624;
    
    mem_53624.references = NULL;
    
    struct memblock_device mem_53622;
    
    mem_53622.references = NULL;
    
    struct memblock_device mem_53619;
    
    mem_53619.references = NULL;
    
    struct memblock_device ext_mem_53616;
    
    ext_mem_53616.references = NULL;
    
    struct memblock_device mem_53614;
    
    mem_53614.references = NULL;
    
    struct memblock_device mem_53612;
    
    mem_53612.references = NULL;
    
    struct memblock_device mem_53610;
    
    mem_53610.references = NULL;
    
    struct memblock_device incprefixes_mem_55081;
    
    incprefixes_mem_55081.references = NULL;
    
    struct memblock_device aggregates_mem_55079;
    
    aggregates_mem_55079.references = NULL;
    
    struct memblock_device status_flags_mem_55077;
    
    status_flags_mem_55077.references = NULL;
    
    struct memblock_device mem_53608;
    
    mem_53608.references = NULL;
    
    struct memblock_device mem_53607;
    
    mem_53607.references = NULL;
    
    struct memblock_device mem_53605;
    
    mem_53605.references = NULL;
    
    struct memblock_device ext_mem_53602;
    
    ext_mem_53602.references = NULL;
    
    struct memblock_device ext_mem_53601;
    
    ext_mem_53601.references = NULL;
    
    struct memblock_device mem_53599;
    
    mem_53599.references = NULL;
    
    struct memblock_device mem_53596;
    
    mem_53596.references = NULL;
    
    struct memblock_device ext_mem_53594;
    
    ext_mem_53594.references = NULL;
    
    struct memblock_device mem_53592;
    
    mem_53592.references = NULL;
    
    struct memblock_device mem_53590;
    
    mem_53590.references = NULL;
    
    struct memblock_device mem_53588;
    
    mem_53588.references = NULL;
    
    struct memblock_device mem_53586;
    
    mem_53586.references = NULL;
    
    struct memblock_device incprefixes_mem_54918;
    
    incprefixes_mem_54918.references = NULL;
    
    struct memblock_device aggregates_mem_54916;
    
    aggregates_mem_54916.references = NULL;
    
    struct memblock_device incprefixes_mem_54914;
    
    incprefixes_mem_54914.references = NULL;
    
    struct memblock_device aggregates_mem_54912;
    
    aggregates_mem_54912.references = NULL;
    
    struct memblock_device status_flags_mem_54910;
    
    status_flags_mem_54910.references = NULL;
    
    struct memblock_device mem_53584;
    
    mem_53584.references = NULL;
    
    struct memblock_device mem_53582;
    
    mem_53582.references = NULL;
    
    struct memblock_device mem_53580;
    
    mem_53580.references = NULL;
    
    struct memblock_device mem_53576;
    
    mem_53576.references = NULL;
    
    struct memblock_device mem_53574;
    
    mem_53574.references = NULL;
    
    struct memblock_device mem_53572;
    
    mem_53572.references = NULL;
    
    struct memblock_device mem_53570;
    
    mem_53570.references = NULL;
    
    struct memblock_device incprefixes_mem_54798;
    
    incprefixes_mem_54798.references = NULL;
    
    struct memblock_device aggregates_mem_54796;
    
    aggregates_mem_54796.references = NULL;
    
    struct memblock_device status_flags_mem_54794;
    
    status_flags_mem_54794.references = NULL;
    
    struct memblock_device mem_53568;
    
    mem_53568.references = NULL;
    
    struct memblock_device mem_53566;
    
    mem_53566.references = NULL;
    
    struct memblock_device mem_53564;
    
    mem_53564.references = NULL;
    
    struct memblock_device mem_53561;
    
    mem_53561.references = NULL;
    
    struct memblock_device mem_53560;
    
    mem_53560.references = NULL;
    
    struct memblock_device ext_mem_53554;
    
    ext_mem_53554.references = NULL;
    
    struct memblock_device mem_53553;
    
    mem_53553.references = NULL;
    
    struct memblock_device mem_53547;
    
    mem_53547.references = NULL;
    
    struct memblock_device mem_53545;
    
    mem_53545.references = NULL;
    
    struct memblock_device mem_53543;
    
    mem_53543.references = NULL;
    
    struct memblock_device mem_53541;
    
    mem_53541.references = NULL;
    
    struct memblock_device mem_53539;
    
    mem_53539.references = NULL;
    
    struct memblock_device incprefixes_mem_54614;
    
    incprefixes_mem_54614.references = NULL;
    
    struct memblock_device aggregates_mem_54612;
    
    aggregates_mem_54612.references = NULL;
    
    struct memblock_device status_flags_mem_54590;
    
    status_flags_mem_54590.references = NULL;
    
    struct memblock_device mem_53537;
    
    mem_53537.references = NULL;
    
    struct memblock_device mem_53535;
    
    mem_53535.references = NULL;
    
    struct memblock_device mem_out_54567;
    
    mem_out_54567.references = NULL;
    
    struct memblock_device mem_out_54566;
    
    mem_out_54566.references = NULL;
    
    struct memblock_device mem_out_54565;
    
    mem_out_54565.references = NULL;
    
    struct memblock_device mem_out_54564;
    
    mem_out_54564.references = NULL;
    
    struct memblock_device mem_out_54563;
    
    mem_out_54563.references = NULL;
    
    struct memblock_device mem_out_54562;
    
    mem_out_54562.references = NULL;
    
    struct memblock_device mem_out_54561;
    
    mem_out_54561.references = NULL;
    
    struct memblock_device mem_out_54560;
    
    mem_out_54560.references = NULL;
    
    struct memblock_device mem_out_54559;
    
    mem_out_54559.references = NULL;
    
    struct memblock_device mem_out_54558;
    
    mem_out_54558.references = NULL;
    
    struct memblock_device mem_out_54557;
    
    mem_out_54557.references = NULL;
    
    struct memblock_device mem_out_54556;
    
    mem_out_54556.references = NULL;
    
    struct memblock_device mem_out_54555;
    
    mem_out_54555.references = NULL;
    
    struct memblock_device mem_out_54554;
    
    mem_out_54554.references = NULL;
    
    struct memblock_device mem_out_54553;
    
    mem_out_54553.references = NULL;
    
    struct memblock_device mem_out_54552;
    
    mem_out_54552.references = NULL;
    
    struct memblock_device mem_out_54551;
    
    mem_out_54551.references = NULL;
    
    struct memblock_device mem_out_54550;
    
    mem_out_54550.references = NULL;
    
    struct memblock_device mem_out_54549;
    
    mem_out_54549.references = NULL;
    
    struct memblock_device mem_out_54548;
    
    mem_out_54548.references = NULL;
    
    struct memblock_device mem_out_54547;
    
    mem_out_54547.references = NULL;
    
    struct memblock_device mem_out_54546;
    
    mem_out_54546.references = NULL;
    
    struct memblock_device mem_out_54545;
    
    mem_out_54545.references = NULL;
    
    struct memblock_device mem_out_54544;
    
    mem_out_54544.references = NULL;
    
    struct memblock_device mem_out_54543;
    
    mem_out_54543.references = NULL;
    
    struct memblock_device mem_out_54542;
    
    mem_out_54542.references = NULL;
    
    struct memblock_device mem_out_54541;
    
    mem_out_54541.references = NULL;
    
    struct memblock_device counters_mem_54551 = ctx->constants->counters_mem_54551;
    struct memblock_device counters_mem_54625 = ctx->constants->counters_mem_54625;
    struct memblock_device counters_mem_55050 = ctx->constants->counters_mem_55050;
    struct memblock_device counters_mem_55495 = ctx->constants->counters_mem_55495;
    struct memblock_device counters_mem_55534 = ctx->constants->counters_mem_55534;
    struct memblock_device counters_mem_55581 = ctx->constants->counters_mem_55581;
    struct memblock_device counters_mem_56605 = ctx->constants->counters_mem_56605;
    struct memblock_device counters_mem_56764 = ctx->constants->counters_mem_56764;
    struct memblock_device counters_mem_56815 = ctx->constants->counters_mem_56815;
    struct memblock_device counters_mem_56850 = ctx->constants->counters_mem_56850;
    struct memblock_device global_dynid_mem_54616 = ctx->constants->global_dynid_mem_54616;
    struct memblock_device global_dynid_mem_54626 = ctx->constants->global_dynid_mem_54626;
    struct memblock_device global_dynid_mem_54637 = ctx->constants->global_dynid_mem_54637;
    struct memblock_device global_dynid_mem_54642 = ctx->constants->global_dynid_mem_54642;
    struct memblock_device global_dynid_mem_54800 = ctx->constants->global_dynid_mem_54800;
    struct memblock_device global_dynid_mem_54871 = ctx->constants->global_dynid_mem_54871;
    struct memblock_device global_dynid_mem_54920 = ctx->constants->global_dynid_mem_54920;
    struct memblock_device global_dynid_mem_55083 = ctx->constants->global_dynid_mem_55083;
    struct memblock_device global_dynid_mem_55112 = ctx->constants->global_dynid_mem_55112;
    struct memblock_device global_dynid_mem_55221 = ctx->constants->global_dynid_mem_55221;
    struct memblock_device global_dynid_mem_55228 = ctx->constants->global_dynid_mem_55228;
    struct memblock_device global_dynid_mem_55334 = ctx->constants->global_dynid_mem_55334;
    struct memblock_device global_dynid_mem_55338 = ctx->constants->global_dynid_mem_55338;
    struct memblock_device global_dynid_mem_55581 = ctx->constants->global_dynid_mem_55581;
    struct memblock_device global_dynid_mem_55728 = ctx->constants->global_dynid_mem_55728;
    struct memblock_device global_dynid_mem_55884 = ctx->constants->global_dynid_mem_55884;
    struct memblock_device global_dynid_mem_56002 = ctx->constants->global_dynid_mem_56002;
    struct memblock_device global_dynid_mem_56151 = ctx->constants->global_dynid_mem_56151;
    struct memblock_device global_dynid_mem_56269 = ctx->constants->global_dynid_mem_56269;
    struct memblock_device global_dynid_mem_56425 = ctx->constants->global_dynid_mem_56425;
    int64_t prim_out_54568;
    int8_t prim_out_54569;
    int8_t prim_out_54570;
    double prim_out_54571;
    int64_t prim_out_54572;
    int64_t prim_out_54573;
    double prim_out_54574;
    int64_t prim_out_54575;
    int64_t prim_out_54576;
    int64_t prim_out_54577;
    int64_t prim_out_54578;
    int64_t prim_out_54579;
    int64_t prim_out_54580;
    int64_t prim_out_54581;
    double zt_res_43632 = 2.0 * clBase_36811;
    int64_t segscan_tblock_sizze_46948;
    
    segscan_tblock_sizze_46948 = *ctx->tuning_params.do_DBSCAN_doublezisegscan_tblock_sizze_46947;
    
    int64_t num_tblocks_46950;
    int64_t max_num_tblocks_54582;
    
    max_num_tblocks_54582 = *ctx->tuning_params.do_DBSCAN_doublezisegscan_num_tblocks_46949;
    num_tblocks_46950 = sext_i64_i32(smax64((int64_t) 1, smin64(sdiv_up64(n_36798, segscan_tblock_sizze_46948), max_num_tblocks_54582)));
    
    int64_t bytes_53534 = (int64_t) 8 * n_36798;
    
    if (memblock_alloc_device(ctx, &mem_53535, bytes_53534, "mem_53535")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_53537, bytes_53534, "mem_53537")) {
        err = 1;
        goto cleanup;
    }
    if (slt64((int64_t) 0, n_36798)) {
        if (ctx->debugging)
            fprintf(ctx->log, "%s\n", "\n# SegScan");
        
        int64_t shared_memory_54583;
        
        shared_memory_54583 = ctx->max_shared_memory;
        
        int64_t thread_block_sizze_54584;
        
        thread_block_sizze_54584 = ctx->max_thread_block_size;
        
        int64_t registers_54585;
        
        registers_54585 = ctx->max_registers;
        
        int64_t thread_block_sizze_54586;
        
        thread_block_sizze_54586 = ctx->max_thread_block_size;
        
        int64_t chunk_sizze_54587 = smax64((int64_t) 1, smin64(squot64(squot64(shared_memory_54583, thread_block_sizze_54584), (int64_t) 8), squot64(squot64(registers_54585, thread_block_sizze_54586) - (int64_t) 1 - squot64(smax64((int64_t) 4, (int64_t) 8), (int64_t) 4), (int64_t) 2 * squot64(smax64((int64_t) 4, (int64_t) 8), (int64_t) 4))));
        int64_t num_virt_blocks_54588 = sdiv_up64(n_36798, segscan_tblock_sizze_46948 * chunk_sizze_54587);
        int64_t num_virt_threads_54589 = num_virt_blocks_54588 * segscan_tblock_sizze_46948;
        
        if (ctx->debugging)
            fprintf(ctx->log, "%s: %llu%c", "Sequential elements per thread (chunk)", (long long) chunk_sizze_54587, '\n');
        if (memblock_alloc_device(ctx, &status_flags_mem_54590, num_virt_blocks_54588, "status_flags_mem_54590")) {
            err = 1;
            goto cleanup;
        }
        if (futrts_builtinzhreplicate_i8(ctx, status_flags_mem_54590, num_virt_blocks_54588, (int8_t) 0) != 0) {
            err = 1;
            goto cleanup;
        }
        if (memblock_alloc_device(ctx, &aggregates_mem_54612, (int64_t) 8 * num_virt_blocks_54588, "aggregates_mem_54612")) {
            err = 1;
            goto cleanup;
        }
        if (memblock_alloc_device(ctx, &incprefixes_mem_54614, (int64_t) 8 * num_virt_blocks_54588, "incprefixes_mem_54614")) {
            err = 1;
            goto cleanup;
        }
        {
            err = gpu_kernel_do_DBSCAN_doublezisegscan_46953(ctx, num_tblocks_46950, 1, 1, *ctx->tuning_params.do_DBSCAN_doublezisegscan_tblock_sizze_46947, 1, 1, smax64(smax64((int64_t) 288, (int64_t) 8 * segscan_tblock_sizze_46948), chunk_sizze_54587 * segscan_tblock_sizze_46948 * (int64_t) 8) + srem64((int64_t) 8 - srem64(smax64(smax64((int64_t) 288, (int64_t) 8 * segscan_tblock_sizze_46948), chunk_sizze_54587 * segscan_tblock_sizze_46948 * (int64_t) 8), (int64_t) 8), (int64_t) 8), n_36798, num_tblocks_46950, num_virt_blocks_54588, num_virt_threads_54589, current_partition_mem_53526.mem, mem_53535.mem, mem_53537.mem, status_flags_mem_54590.mem, aggregates_mem_54612.mem, incprefixes_mem_54614.mem, global_dynid_mem_54616.mem);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        if (ctx->debugging)
            fprintf(ctx->log, "%s\n", "");
    }
    if (memblock_alloc_device(ctx, &mem_53539, bytes_53534, "mem_53539")) {
        err = 1;
        goto cleanup;
    }
    if ((err = lmad_copy_gpu2gpu_8b(ctx, 1, mem_53539.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, current_partition_mem_53519.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, (int64_t []) {n_36798})) != 0)
        goto cleanup;
    if (memblock_alloc_device(ctx, &mem_53541, bytes_53534, "mem_53541")) {
        err = 1;
        goto cleanup;
    }
    if ((err = lmad_copy_gpu2gpu_8b(ctx, 1, mem_53541.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, current_partition_mem_53520.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, (int64_t []) {n_36798})) != 0)
        goto cleanup;
    
    bool cond_43645 = n_36798 == (int64_t) 0;
    bool x_43646 = !cond_43645;
    int64_t tmp_43647 = sub64(n_36798, (int64_t) 1);
    bool x_43648 = sle64((int64_t) 0, tmp_43647);
    bool y_43649 = slt64(tmp_43647, n_36798);
    bool bounds_check_43650 = x_43648 && y_43649;
    bool protect_assert_disj_43651 = cond_43645 || bounds_check_43650;
    bool index_certs_43652;
    
    if (!protect_assert_disj_43651) {
        set_error(ctx, msgprintf("Error: %s%lld%s%lld%s\n\nBacktrace:\n%s", "Index [", (long long) tmp_43647, "] out of bounds for array of shape [", (long long) n_36798, "].", "-> #0  /prelude/soacs.fut:257:33-47\n   #1  /prelude/functional.fut:9:44-45\n   #2  ft_libs/ftDBSCAN_plus.fut:890:18-893:67\n   #3  ft_libs/ftDBSCAN_plus.fut:889:9-893:67\n"));
        err = FUTHARK_PROGRAM_ERROR;
        goto cleanup;
    }
    
    int64_t m_f_res_43653;
    
    if (x_43646) {
        int64_t read_res_56980;
        
        if ((err = gpu_scalar_from_device(ctx, &read_res_56980, mem_53535.mem, tmp_43647 * sizeof(int64_t), sizeof(int64_t))) != 0)
            goto cleanup;
        if (ctx->failure_is_an_option && futhark_context_sync(ctx) != 0) {
            err = 1;
            goto cleanup;
        }
        
        int64_t x_45320 = read_res_56980;
        
        m_f_res_43653 = x_45320;
    } else {
        m_f_res_43653 = (int64_t) 0;
    }
    
    int64_t m_43655;
    
    if (cond_43645) {
        m_43655 = (int64_t) 0;
    } else {
        m_43655 = m_f_res_43653;
    }
    
    int64_t m_43665 = sub64(m_43655, (int64_t) 1);
    bool i_p_m_t_s_leq_w_43667 = slt64(m_43665, n_36798);
    bool zzero_leq_i_p_m_t_s_43666 = sle64((int64_t) 0, m_43665);
    bool y_43669 = zzero_leq_i_p_m_t_s_43666 && i_p_m_t_s_leq_w_43667;
    bool i_lte_j_43668 = sle64((int64_t) 0, m_43655);
    bool forwards_ok_43670 = i_lte_j_43668 && y_43669;
    bool eq_x_zz_43662 = (int64_t) 0 == m_f_res_43653;
    bool p_and_eq_x_y_43663 = x_43646 && eq_x_zz_43662;
    bool empty_slice_43664 = cond_43645 || p_and_eq_x_y_43663;
    bool ok_or_empty_43671 = empty_slice_43664 || forwards_ok_43670;
    bool index_certs_43672;
    
    if (!ok_or_empty_43671) {
        set_error(ctx, msgprintf("Error: %s%lld%s%lld%s\n\nBacktrace:\n%s", "Index [:", (long long) m_43655, "] out of bounds for array of shape [", (long long) n_36798, "].", "-> #0  /prelude/soacs.fut:258:29-35\n   #1  /prelude/functional.fut:9:44-45\n   #2  ft_libs/ftDBSCAN_plus.fut:890:18-893:67\n   #3  ft_libs/ftDBSCAN_plus.fut:889:9-893:67\n"));
        err = FUTHARK_PROGRAM_ERROR;
        goto cleanup;
    }
    
    int64_t bytes_53542 = (int64_t) 8 * m_43655;
    
    if (memblock_alloc_device(ctx, &mem_53543, bytes_53542, "mem_53543")) {
        err = 1;
        goto cleanup;
    }
    if ((err = lmad_copy_gpu2gpu_8b(ctx, 1, mem_53543.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, mem_53541.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, (int64_t []) {m_43655})) != 0)
        goto cleanup;
    if (memblock_alloc_device(ctx, &mem_53545, bytes_53542, "mem_53545")) {
        err = 1;
        goto cleanup;
    }
    if ((err = lmad_copy_gpu2gpu_8b(ctx, 1, mem_53545.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, mem_53539.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, (int64_t []) {m_43655})) != 0)
        goto cleanup;
    if (memblock_alloc_device(ctx, &mem_53547, bytes_53542, "mem_53547")) {
        err = 1;
        goto cleanup;
    }
    if (futrts_builtinzhiota_i64(ctx, mem_53547, m_43655, (int64_t) 0, (int64_t) 1) != 0) {
        err = 1;
        goto cleanup;
    }
    
    int64_t segmap_tblock_sizze_46958;
    
    segmap_tblock_sizze_46958 = *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_46957;
    
    int64_t num_tblocks_46960;
    int64_t max_num_tblocks_54742;
    
    max_num_tblocks_54742 = *ctx->tuning_params.do_DBSCAN_doublezisegmap_num_tblocks_46959;
    num_tblocks_46960 = sext_i64_i32(smax64((int64_t) 1, smin64(sdiv_up64(n_36798, segmap_tblock_sizze_46958), max_num_tblocks_54742)));
    if (ctx->debugging)
        fprintf(ctx->log, "%s\n", "\n# SegMap");
    
    int32_t virt_num_tblocks_54743 = sext_i64_i32(sdiv_up64(n_36798, segmap_tblock_sizze_46958));
    
    {
        err = gpu_kernel_do_DBSCAN_doublezisegmap_46955(ctx, num_tblocks_46960, 1, 1, *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_46957, 1, 1, (int64_t) 0, n_36798, m_43655, num_tblocks_46960, virt_num_tblocks_54743, current_partition_mem_53519.mem, current_partition_mem_53520.mem, mem_53535.mem, mem_53537.mem, mem_53543.mem, mem_53545.mem, mem_53547.mem);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (ctx->debugging)
        fprintf(ctx->log, "%s\n", "");
    if (memblock_unref_device(ctx, &mem_53535, "mem_53535") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_53537, "mem_53537") != 0)
        return 1;
    
    int64_t segscan_tblock_sizze_46964;
    
    segscan_tblock_sizze_46964 = *ctx->tuning_params.do_DBSCAN_doublezisegscan_tblock_sizze_46963;
    
    int64_t num_tblocks_46966;
    int64_t max_num_tblocks_54756;
    
    max_num_tblocks_54756 = *ctx->tuning_params.do_DBSCAN_doublezisegscan_num_tblocks_46965;
    num_tblocks_46966 = sext_i64_i32(smax64((int64_t) 1, smin64(sdiv_up64(dz2082U_36803, segscan_tblock_sizze_46964), max_num_tblocks_54756)));
    
    bool cond_43724 = dz2082U_36803 == (int64_t) 0;
    bool x_43725 = !cond_43724;
    int64_t tmp_43726 = sub64(dz2082U_36803, (int64_t) 1);
    bool x_43727 = sle64((int64_t) 0, tmp_43726);
    bool y_43728 = slt64(tmp_43726, dz2082U_36803);
    bool bounds_check_43729 = x_43727 && y_43728;
    bool protect_assert_disj_43730 = cond_43724 || bounds_check_43729;
    bool index_certs_43731;
    
    if (!protect_assert_disj_43730) {
        set_error(ctx, msgprintf("Error: %s%lld%s%lld%s\n\nBacktrace:\n%s", "Index [", (long long) tmp_43726, "] out of bounds for array of shape [", (long long) dz2082U_36803, "].", "-> #0  /prelude/soacs.fut:257:33-47\n   #1  /prelude/functional.fut:9:44-45\n   #2  ft_libs/ftDBSCAN_plus.fut:890:18-893:67\n   #3  ft_libs/ftDBSCAN_plus.fut:889:9-893:67\n"));
        err = FUTHARK_PROGRAM_ERROR;
        goto cleanup;
    }
    
    int64_t segmap_tblock_sizze_46974;
    
    segmap_tblock_sizze_46974 = *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_46973;
    
    int64_t num_tblocks_46976;
    int64_t max_num_tblocks_54757;
    
    max_num_tblocks_54757 = *ctx->tuning_params.do_DBSCAN_doublezisegmap_num_tblocks_46975;
    num_tblocks_46976 = sext_i64_i32(smax64((int64_t) 1, smin64(sdiv_up64(dz2082U_36803, segmap_tblock_sizze_46974), max_num_tblocks_54757)));
    
    int64_t segscan_tblock_sizze_46980;
    
    segscan_tblock_sizze_46980 = *ctx->tuning_params.do_DBSCAN_doublezisegscan_tblock_sizze_46979;
    
    int64_t segmap_tblock_sizze_46990;
    
    segmap_tblock_sizze_46990 = *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_46989;
    
    int64_t segscan_tblock_sizze_46996;
    
    segscan_tblock_sizze_46996 = *ctx->tuning_params.do_DBSCAN_doublezisegscan_tblock_sizze_46995;
    
    int64_t segmap_tblock_sizze_47006;
    
    segmap_tblock_sizze_47006 = *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_47005;
    
    int64_t bytes_53550 = (int64_t) 8 * dz2081U_36802;
    
    if (memblock_alloc_device(ctx, &mem_53553, bytes_53534, "mem_53553")) {
        err = 1;
        goto cleanup;
    }
    if (futrts_builtinzhreplicate_i64(ctx, mem_53553, n_36798, (int64_t) 0) != 0) {
        err = 1;
        goto cleanup;
    }
    
    int64_t segmap_tblock_sizze_47014;
    
    segmap_tblock_sizze_47014 = *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_47013;
    
    int64_t num_tblocks_47016;
    int64_t max_num_tblocks_54778;
    
    max_num_tblocks_54778 = *ctx->tuning_params.do_DBSCAN_doublezisegmap_num_tblocks_47015;
    num_tblocks_47016 = sext_i64_i32(smax64((int64_t) 1, smin64(sdiv_up64(m_43655, segmap_tblock_sizze_47014), max_num_tblocks_54778)));
    if (futrts_get_num_neighbours_against_10103(ctx, &ext_mem_53554, current_partition_mem_53519, current_partition_mem_53520, current_partition_mem_53519, current_partition_mem_53520, n_36798, n_36798, clBase_36811, clBase_36810, clBase_36809, clBase_36817, clBase_36812) != 0) {
        err = 1;
        goto cleanup;
    }
    
    int64_t segmap_tblock_sizze_47032;
    
    segmap_tblock_sizze_47032 = *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_47021;
    
    int64_t segmap_usable_groups_47033 = sdiv_up64(n_36798, segmap_tblock_sizze_47032);
    int64_t segscan_tblock_sizze_47044;
    
    segscan_tblock_sizze_47044 = *ctx->tuning_params.do_DBSCAN_doublezisegscan_tblock_sizze_47043;
    
    int64_t num_tblocks_47046;
    int64_t max_num_tblocks_54779;
    
    max_num_tblocks_54779 = *ctx->tuning_params.do_DBSCAN_doublezisegscan_num_tblocks_47045;
    num_tblocks_47046 = sext_i64_i32(smax64((int64_t) 1, smin64(sdiv_up64(n_36798, segscan_tblock_sizze_47044), max_num_tblocks_54779)));
    
    int64_t segmap_tblock_sizze_47054;
    
    segmap_tblock_sizze_47054 = *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_47053;
    
    int64_t num_tblocks_47056;
    int64_t max_num_tblocks_54780;
    
    max_num_tblocks_54780 = *ctx->tuning_params.do_DBSCAN_doublezisegmap_num_tblocks_47055;
    num_tblocks_47056 = sext_i64_i32(smax64((int64_t) 1, smin64(sdiv_up64(n_36798, segmap_tblock_sizze_47054), max_num_tblocks_54780)));
    
    int64_t segscan_tblock_sizze_47060;
    
    segscan_tblock_sizze_47060 = *ctx->tuning_params.do_DBSCAN_doublezisegscan_tblock_sizze_47059;
    
    int64_t max_arg1_44113 = sdiv64(gather_psizze_36847, (int64_t) 8);
    int64_t max_res_44114 = smax64((int64_t) 1, max_arg1_44113);
    bool zzero_44117 = max_res_44114 == (int64_t) 0;
    bool nonzzero_44118 = !zzero_44117;
    bool nonzzero_cert_44119;
    
    if (!nonzzero_44118) {
        set_error(ctx, msgprintf("Error: %s\n\nBacktrace:\n%s", "division by zero", "-> #0  ft_libs/ftbasics.fut:27:31-39\n   #1  ft_libs/ftDBSCAN_plus.fut:890:18-893:67\n   #2  ft_libs/ftDBSCAN_plus.fut:889:9-893:67\n"));
        err = FUTHARK_PROGRAM_ERROR;
        goto cleanup;
    }
    
    int64_t segmap_tblock_sizze_47243;
    
    segmap_tblock_sizze_47243 = *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_47228;
    
    int64_t segred_tblock_sizze_47261;
    
    segred_tblock_sizze_47261 = *ctx->tuning_params.do_DBSCAN_doublezisegred_tblock_sizze_47176;
    
    int64_t segred_tblock_sizze_47310;
    
    segred_tblock_sizze_47310 = *ctx->tuning_params.do_DBSCAN_doublezisegred_tblock_sizze_47309;
    
    int64_t tile_sizze_49826;
    
    tile_sizze_49826 = *ctx->tuning_params.do_DBSCAN_doublezitile_sizze_49825;
    
    bool match_val_53497 = clBase_36810 == (int8_t) 0;
    bool x_53498 = !match_val_53497;
    int64_t segscan_tblock_sizze_47320;
    
    segscan_tblock_sizze_47320 = *ctx->tuning_params.do_DBSCAN_doublezisegscan_tblock_sizze_47319;
    
    int64_t segmap_tblock_sizze_47341;
    
    segmap_tblock_sizze_47341 = *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_47329;
    
    int64_t segmap_tblock_sizze_47372;
    
    segmap_tblock_sizze_47372 = *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_47355;
    
    int64_t segmap_tblock_sizze_47399;
    
    segmap_tblock_sizze_47399 = *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_47391;
    
    int64_t segmap_tblock_sizze_47410;
    
    segmap_tblock_sizze_47410 = *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_47409;
    
    int64_t segscan_tblock_sizze_47807;
    
    segscan_tblock_sizze_47807 = *ctx->tuning_params.do_DBSCAN_doublezisegscan_tblock_sizze_47706;
    
    int64_t segscan_tblock_sizze_47454;
    
    segscan_tblock_sizze_47454 = *ctx->tuning_params.do_DBSCAN_doublezisegscan_tblock_sizze_47446;
    
    int64_t tile_sizze_50561;
    
    tile_sizze_50561 = *ctx->tuning_params.do_DBSCAN_doublezitile_sizze_50560;
    
    int64_t tile_sizze_50206;
    
    tile_sizze_50206 = *ctx->tuning_params.do_DBSCAN_doublezitile_sizze_50205;
    
    int64_t segmap_tblock_sizze_47823;
    
    segmap_tblock_sizze_47823 = *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_47822;
    
    int64_t segscan_tblock_sizze_48120;
    
    segscan_tblock_sizze_48120 = *ctx->tuning_params.do_DBSCAN_doublezisegscan_tblock_sizze_48037;
    
    int64_t segscan_tblock_sizze_47838;
    
    segscan_tblock_sizze_47838 = *ctx->tuning_params.do_DBSCAN_doublezisegscan_tblock_sizze_47830;
    
    int64_t tile_sizze_51195;
    
    tile_sizze_51195 = *ctx->tuning_params.do_DBSCAN_doublezitile_sizze_51194;
    
    int64_t tile_sizze_50916;
    
    tile_sizze_50916 = *ctx->tuning_params.do_DBSCAN_doublezitile_sizze_50915;
    
    int64_t segmap_tblock_sizze_48461;
    
    segmap_tblock_sizze_48461 = *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_48460;
    
    int64_t segscan_tblock_sizze_48897;
    
    segscan_tblock_sizze_48897 = *ctx->tuning_params.do_DBSCAN_doublezisegscan_tblock_sizze_48778;
    
    int64_t segscan_tblock_sizze_48476;
    
    segscan_tblock_sizze_48476 = *ctx->tuning_params.do_DBSCAN_doublezisegscan_tblock_sizze_48468;
    
    int64_t tile_sizze_52265;
    
    tile_sizze_52265 = *ctx->tuning_params.do_DBSCAN_doublezitile_sizze_52264;
    
    int64_t tile_sizze_51883;
    
    tile_sizze_51883 = *ctx->tuning_params.do_DBSCAN_doublezitile_sizze_51882;
    if (memblock_alloc_device(ctx, &mem_53560, (int64_t) 8, "mem_53560")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_53561, (int64_t) 8, "mem_53561")) {
        err = 1;
        goto cleanup;
    }
    {
        err = gpu_kernel_do_DBSCAN_doublezigpuseq_54781(ctx, (int64_t) 1, 1, 1, (int64_t) 1, 1, 1, (int64_t) 0, clBase_36811, zt_res_43632, current_partition_mem_53528.mem, mem_53560.mem, mem_53561.mem);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    int64_t bytes_53563 = (int64_t) 8 * dz2082U_36803;
    
    if (memblock_alloc_device(ctx, &mem_53564, bytes_53563, "mem_53564")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_53566, bytes_53563, "mem_53566")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_53568, bytes_53563, "mem_53568")) {
        err = 1;
        goto cleanup;
    }
    if (slt64((int64_t) 0, dz2082U_36803)) {
        if (ctx->debugging)
            fprintf(ctx->log, "%s\n", "\n# SegScan");
        
        int64_t shared_memory_54787;
        
        shared_memory_54787 = ctx->max_shared_memory;
        
        int64_t thread_block_sizze_54788;
        
        thread_block_sizze_54788 = ctx->max_thread_block_size;
        
        int64_t registers_54789;
        
        registers_54789 = ctx->max_registers;
        
        int64_t thread_block_sizze_54790;
        
        thread_block_sizze_54790 = ctx->max_thread_block_size;
        
        int64_t chunk_sizze_54791 = smax64((int64_t) 1, smin64(squot64(squot64(shared_memory_54787, thread_block_sizze_54788), (int64_t) 8), squot64(squot64(registers_54789, thread_block_sizze_54790) - (int64_t) 1 - squot64(smax64((int64_t) 4, (int64_t) 8), (int64_t) 4), (int64_t) 2 * squot64(smax64((int64_t) 4, (int64_t) 8), (int64_t) 4))));
        int64_t num_virt_blocks_54792 = sdiv_up64(dz2082U_36803, segscan_tblock_sizze_46964 * chunk_sizze_54791);
        int64_t num_virt_threads_54793 = num_virt_blocks_54792 * segscan_tblock_sizze_46964;
        
        if (ctx->debugging)
            fprintf(ctx->log, "%s: %llu%c", "Sequential elements per thread (chunk)", (long long) chunk_sizze_54791, '\n');
        if (memblock_alloc_device(ctx, &status_flags_mem_54794, num_virt_blocks_54792, "status_flags_mem_54794")) {
            err = 1;
            goto cleanup;
        }
        if (futrts_builtinzhreplicate_i8(ctx, status_flags_mem_54794, num_virt_blocks_54792, (int8_t) 0) != 0) {
            err = 1;
            goto cleanup;
        }
        if (memblock_alloc_device(ctx, &aggregates_mem_54796, (int64_t) 8 * num_virt_blocks_54792, "aggregates_mem_54796")) {
            err = 1;
            goto cleanup;
        }
        if (memblock_alloc_device(ctx, &incprefixes_mem_54798, (int64_t) 8 * num_virt_blocks_54792, "incprefixes_mem_54798")) {
            err = 1;
            goto cleanup;
        }
        {
            err = gpu_kernel_do_DBSCAN_doublezisegscan_46969(ctx, num_tblocks_46966, 1, 1, *ctx->tuning_params.do_DBSCAN_doublezisegscan_tblock_sizze_46963, 1, 1, smax64(smax64((int64_t) 288, (int64_t) 8 * segscan_tblock_sizze_46964), chunk_sizze_54791 * segscan_tblock_sizze_46964 * (int64_t) 8) + srem64((int64_t) 8 - srem64(smax64(smax64((int64_t) 288, (int64_t) 8 * segscan_tblock_sizze_46964), chunk_sizze_54791 * segscan_tblock_sizze_46964 * (int64_t) 8), (int64_t) 8), (int64_t) 8), dz2081U_36802, dz2082U_36803, zt_res_43632, num_tblocks_46966, num_virt_blocks_54792, num_virt_threads_54793, clProc_mem_53513.mem, clProc_mem_53514.mem, clProc_mem_53515.mem, current_partition_mem_53527.mem, current_partition_mem_53528.mem, mem_53560.mem, mem_53564.mem, mem_53566.mem, mem_53568.mem, status_flags_mem_54794.mem, aggregates_mem_54796.mem, incprefixes_mem_54798.mem, global_dynid_mem_54800.mem);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        ctx->failure_is_an_option = 1;
        if (ctx->debugging)
            fprintf(ctx->log, "%s\n", "");
    }
    if (memblock_unref_device(ctx, &mem_53560, "mem_53560") != 0)
        return 1;
    
    int64_t m_f_res_43732;
    
    if (x_43725) {
        int64_t read_res_56981;
        
        if ((err = gpu_scalar_from_device(ctx, &read_res_56981, mem_53564.mem, tmp_43726 * sizeof(int64_t), sizeof(int64_t))) != 0)
            goto cleanup;
        if (ctx->failure_is_an_option && futhark_context_sync(ctx) != 0) {
            err = 1;
            goto cleanup;
        }
        
        int64_t x_45335 = read_res_56981;
        
        m_f_res_43732 = x_45335;
    } else {
        m_f_res_43732 = (int64_t) 0;
    }
    
    int64_t m_43734;
    
    if (cond_43724) {
        m_43734 = (int64_t) 0;
    } else {
        m_43734 = m_f_res_43732;
    }
    
    int64_t m_43744 = sub64(m_43734, (int64_t) 1);
    bool i_p_m_t_s_leq_w_43746 = slt64(m_43744, dz2082U_36803);
    bool zzero_leq_i_p_m_t_s_43745 = sle64((int64_t) 0, m_43744);
    bool y_43748 = zzero_leq_i_p_m_t_s_43745 && i_p_m_t_s_leq_w_43746;
    bool i_lte_j_43747 = sle64((int64_t) 0, m_43734);
    bool forwards_ok_43749 = i_lte_j_43747 && y_43748;
    bool eq_x_zz_43741 = (int64_t) 0 == m_f_res_43732;
    bool p_and_eq_x_y_43742 = x_43725 && eq_x_zz_43741;
    bool empty_slice_43743 = cond_43724 || p_and_eq_x_y_43742;
    bool ok_or_empty_43750 = empty_slice_43743 || forwards_ok_43749;
    bool index_certs_43751;
    
    if (!ok_or_empty_43750) {
        set_error(ctx, msgprintf("Error: %s%lld%s%lld%s\n\nBacktrace:\n%s", "Index [:", (long long) m_43734, "] out of bounds for array of shape [", (long long) dz2082U_36803, "].", "-> #0  /prelude/soacs.fut:258:29-35\n   #1  /prelude/functional.fut:9:44-45\n   #2  ft_libs/ftDBSCAN_plus.fut:890:18-893:67\n   #3  ft_libs/ftDBSCAN_plus.fut:889:9-893:67\n"));
        err = FUTHARK_PROGRAM_ERROR;
        goto cleanup;
    }
    
    int64_t bytes_53569 = (int64_t) 8 * m_43734;
    
    if (memblock_alloc_device(ctx, &mem_53570, bytes_53569, "mem_53570")) {
        err = 1;
        goto cleanup;
    }
    if (futrts_builtinzhiota_i64(ctx, mem_53570, m_43734, (int64_t) 0, (int64_t) 1) != 0) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_53572, bytes_53569, "mem_53572")) {
        err = 1;
        goto cleanup;
    }
    if ((err = lmad_copy_gpu2gpu_8b(ctx, 1, mem_53572.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, mem_53568.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, (int64_t []) {m_43734})) != 0)
        goto cleanup;
    if (memblock_alloc_device(ctx, &mem_53574, bytes_53569, "mem_53574")) {
        err = 1;
        goto cleanup;
    }
    if ((err = lmad_copy_gpu2gpu_8b(ctx, 1, mem_53574.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, clProc_mem_53515.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, (int64_t []) {m_43734})) != 0)
        goto cleanup;
    if (memblock_alloc_device(ctx, &mem_53576, bytes_53569, "mem_53576")) {
        err = 1;
        goto cleanup;
    }
    if ((err = lmad_copy_gpu2gpu_8b(ctx, 1, mem_53576.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, clProc_mem_53514.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, (int64_t []) {m_43734})) != 0)
        goto cleanup;
    if (ctx->debugging)
        fprintf(ctx->log, "%s\n", "\n# SegMap");
    
    int32_t virt_num_tblocks_54889 = sext_i64_i32(sdiv_up64(dz2082U_36803, segmap_tblock_sizze_46974));
    
    {
        err = gpu_kernel_do_DBSCAN_doublezisegmap_46971(ctx, num_tblocks_46976, 1, 1, *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_46973, 1, 1, (int64_t) 0, dz2082U_36803, m_43734, num_tblocks_46976, virt_num_tblocks_54889, clProc_mem_53514.mem, clProc_mem_53515.mem, mem_53564.mem, mem_53566.mem, mem_53568.mem, mem_53570.mem, mem_53572.mem, mem_53574.mem, mem_53576.mem);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (ctx->debugging)
        fprintf(ctx->log, "%s\n", "");
    if (memblock_unref_device(ctx, &mem_53564, "mem_53564") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_53566, "mem_53566") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_53568, "mem_53568") != 0)
        return 1;
    
    int64_t num_tblocks_46982;
    int64_t max_num_tblocks_54902;
    
    max_num_tblocks_54902 = *ctx->tuning_params.do_DBSCAN_doublezisegscan_num_tblocks_46981;
    num_tblocks_46982 = sext_i64_i32(smax64((int64_t) 1, smin64(sdiv_up64(m_43734, segscan_tblock_sizze_46980), max_num_tblocks_54902)));
    if (memblock_alloc_device(ctx, &mem_53580, bytes_53569, "mem_53580")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_53582, bytes_53569, "mem_53582")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_53584, bytes_53569, "mem_53584")) {
        err = 1;
        goto cleanup;
    }
    if (slt64((int64_t) 0, m_43734)) {
        if (ctx->debugging)
            fprintf(ctx->log, "%s\n", "\n# SegScan");
        
        int64_t shared_memory_54903;
        
        shared_memory_54903 = ctx->max_shared_memory;
        
        int64_t thread_block_sizze_54904;
        
        thread_block_sizze_54904 = ctx->max_thread_block_size;
        
        int64_t registers_54905;
        
        registers_54905 = ctx->max_registers;
        
        int64_t thread_block_sizze_54906;
        
        thread_block_sizze_54906 = ctx->max_thread_block_size;
        
        int64_t chunk_sizze_54907 = smax64((int64_t) 1, smin64(squot64(squot64(shared_memory_54903, thread_block_sizze_54904), (int64_t) 8), squot64(squot64(registers_54905, thread_block_sizze_54906) - (int64_t) 1 - squot64(smax64((int64_t) 4, (int64_t) 8) + smax64((int64_t) 4, (int64_t) 8), (int64_t) 4), (int64_t) 2 * squot64(smax64((int64_t) 4, (int64_t) 8) + smax64((int64_t) 4, (int64_t) 8), (int64_t) 4))));
        int64_t num_virt_blocks_54908 = sdiv_up64(m_43734, segscan_tblock_sizze_46980 * chunk_sizze_54907);
        int64_t num_virt_threads_54909 = num_virt_blocks_54908 * segscan_tblock_sizze_46980;
        
        if (ctx->debugging)
            fprintf(ctx->log, "%s: %llu%c", "Sequential elements per thread (chunk)", (long long) chunk_sizze_54907, '\n');
        if (memblock_alloc_device(ctx, &status_flags_mem_54910, num_virt_blocks_54908, "status_flags_mem_54910")) {
            err = 1;
            goto cleanup;
        }
        if (futrts_builtinzhreplicate_i8(ctx, status_flags_mem_54910, num_virt_blocks_54908, (int8_t) 0) != 0) {
            err = 1;
            goto cleanup;
        }
        if (memblock_alloc_device(ctx, &aggregates_mem_54912, (int64_t) 8 * num_virt_blocks_54908, "aggregates_mem_54912")) {
            err = 1;
            goto cleanup;
        }
        if (memblock_alloc_device(ctx, &incprefixes_mem_54914, (int64_t) 8 * num_virt_blocks_54908, "incprefixes_mem_54914")) {
            err = 1;
            goto cleanup;
        }
        if (memblock_alloc_device(ctx, &aggregates_mem_54916, (int64_t) 8 * num_virt_blocks_54908, "aggregates_mem_54916")) {
            err = 1;
            goto cleanup;
        }
        if (memblock_alloc_device(ctx, &incprefixes_mem_54918, (int64_t) 8 * num_virt_blocks_54908, "incprefixes_mem_54918")) {
            err = 1;
            goto cleanup;
        }
        {
            err = gpu_kernel_do_DBSCAN_doublezisegscan_46985(ctx, num_tblocks_46982, 1, 1, *ctx->tuning_params.do_DBSCAN_doublezisegscan_tblock_sizze_46979, 1, 1, smax64(smax64((int64_t) 544, sdiv_up64((int64_t) 8 * segscan_tblock_sizze_46980, (int64_t) 8) * (int64_t) 8 + (int64_t) 8 * segscan_tblock_sizze_46980), smax64(chunk_sizze_54907 * segscan_tblock_sizze_46980 * (int64_t) 8, chunk_sizze_54907 * segscan_tblock_sizze_46980 * (int64_t) 8)) + srem64((int64_t) 8 - srem64(smax64(smax64((int64_t) 544, sdiv_up64((int64_t) 8 * segscan_tblock_sizze_46980, (int64_t) 8) * (int64_t) 8 + (int64_t) 8 * segscan_tblock_sizze_46980), smax64(chunk_sizze_54907 * segscan_tblock_sizze_46980 * (int64_t) 8, chunk_sizze_54907 * segscan_tblock_sizze_46980 * (int64_t) 8)), (int64_t) 8), (int64_t) 8), clBase_36811, m_43734, num_tblocks_46982, num_virt_blocks_54908, num_virt_threads_54909, current_partition_mem_53527.mem, current_partition_mem_53528.mem, mem_53561.mem, mem_53574.mem, mem_53576.mem, mem_53580.mem, mem_53582.mem, mem_53584.mem, status_flags_mem_54910.mem, aggregates_mem_54912.mem, incprefixes_mem_54914.mem, aggregates_mem_54916.mem, incprefixes_mem_54918.mem, global_dynid_mem_54920.mem);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        if (ctx->debugging)
            fprintf(ctx->log, "%s\n", "");
    }
    if (memblock_unref_device(ctx, &mem_53561, "mem_53561") != 0)
        return 1;
    
    bool x_43806 = !empty_slice_43743;
    int64_t last_offset_43807;
    
    if (x_43806) {
        int64_t read_res_56982;
        
        if ((err = gpu_scalar_from_device(ctx, &read_res_56982, mem_53580.mem, m_43744 * sizeof(int64_t), sizeof(int64_t))) != 0)
            goto cleanup;
        if (ctx->failure_is_an_option && futhark_context_sync(ctx) != 0) {
            err = 1;
            goto cleanup;
        }
        
        int64_t x_45350 = read_res_56982;
        
        last_offset_43807 = x_45350;
    } else {
        last_offset_43807 = (int64_t) 0;
    }
    
    int64_t partition_sizze_43809;
    
    if (empty_slice_43743) {
        partition_sizze_43809 = (int64_t) 0;
    } else {
        partition_sizze_43809 = last_offset_43807;
    }
    if (memblock_alloc_device(ctx, &mem_53586, bytes_53569, "mem_53586")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_53588, bytes_53569, "mem_53588")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_53590, bytes_53569, "mem_53590")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_53592, bytes_53569, "mem_53592")) {
        err = 1;
        goto cleanup;
    }
    
    int64_t y_43814 = (int64_t) -1 + partition_sizze_43809;
    int64_t num_tblocks_46992;
    int64_t max_num_tblocks_55055;
    
    max_num_tblocks_55055 = *ctx->tuning_params.do_DBSCAN_doublezisegmap_num_tblocks_46991;
    num_tblocks_46992 = sext_i64_i32(smax64((int64_t) 1, smin64(sdiv_up64(m_43734, segmap_tblock_sizze_46990), max_num_tblocks_55055)));
    if (ctx->debugging)
        fprintf(ctx->log, "%s\n", "\n# SegMap");
    
    int32_t virt_num_tblocks_55056 = sext_i64_i32(sdiv_up64(m_43734, segmap_tblock_sizze_46990));
    
    {
        err = gpu_kernel_do_DBSCAN_doublezisegmap_46987(ctx, num_tblocks_46992, 1, 1, *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_46989, 1, 1, (int64_t) 0, m_43734, y_43814, num_tblocks_46992, virt_num_tblocks_55056, mem_53570.mem, mem_53572.mem, mem_53574.mem, mem_53576.mem, mem_53580.mem, mem_53582.mem, mem_53584.mem, mem_53586.mem, mem_53588.mem, mem_53590.mem, mem_53592.mem);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (ctx->debugging)
        fprintf(ctx->log, "%s\n", "");
    if (memblock_unref_device(ctx, &mem_53570, "mem_53570") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_53572, "mem_53572") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_53574, "mem_53574") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_53576, "mem_53576") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_53580, "mem_53580") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_53582, "mem_53582") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_53584, "mem_53584") != 0)
        return 1;
    
    bool eq_x_zz_43832 = (int64_t) 0 == last_offset_43807;
    bool p_and_eq_x_y_43833 = x_43806 && eq_x_zz_43832;
    bool empty_slice_43834 = empty_slice_43743 || p_and_eq_x_y_43833;
    int64_t m_43835 = sub64(partition_sizze_43809, (int64_t) 1);
    bool zzero_leq_i_p_m_t_s_43836 = sle64((int64_t) 0, m_43835);
    bool i_p_m_t_s_leq_w_43837 = slt64(m_43835, m_43734);
    bool i_lte_j_43838 = sle64((int64_t) 0, partition_sizze_43809);
    bool y_43839 = zzero_leq_i_p_m_t_s_43836 && i_p_m_t_s_leq_w_43837;
    bool forwards_ok_43840 = i_lte_j_43838 && y_43839;
    bool ok_or_empty_43841 = empty_slice_43834 || forwards_ok_43840;
    bool index_certs_43842;
    
    if (!ok_or_empty_43841) {
        set_error(ctx, msgprintf("Error: %s%lld%s%lld%s%lld%s\n\nBacktrace:\n%s", "Index [", (long long) (int64_t) 0, ":", (long long) partition_sizze_43809, "] out of bounds for array of shape [", (long long) m_43734, "].", "-> #0  /prelude/soacs.fut:174:7-19\n   #1  /prelude/functional.fut:9:44-45\n   #2  ft_libs/ftDBSCAN_plus.fut:890:18-893:67\n   #3  ft_libs/ftDBSCAN_plus.fut:889:9-893:67\n"));
        err = FUTHARK_PROGRAM_ERROR;
        goto cleanup;
    }
    
    bool y_43900 = slt64(m_43835, partition_sizze_43809);
    bool bounds_check_43901 = zzero_leq_i_p_m_t_s_43836 && y_43900;
    bool protect_assert_disj_43902 = empty_slice_43834 || bounds_check_43901;
    bool index_certs_43903;
    
    if (!protect_assert_disj_43902) {
        set_error(ctx, msgprintf("Error: %s%lld%s%lld%s\n\nBacktrace:\n%s", "Index [", (long long) m_43835, "] out of bounds for array of shape [", (long long) partition_sizze_43809, "].", "-> #0  /prelude/soacs.fut:257:33-47\n   #1  /prelude/functional.fut:9:44-45\n   #2  ft_libs/ftDBSCAN_plus.fut:890:18-893:67\n   #3  ft_libs/ftDBSCAN_plus.fut:889:9-893:67\n"));
        err = FUTHARK_PROGRAM_ERROR;
        goto cleanup;
    }
    
    bool x_43899 = !empty_slice_43834;
    
    if (futrts_get_num_neighbours_against_10106(ctx, &ext_mem_53594, mem_53586, mem_53588, mem_53545, mem_53543, partition_sizze_43809, m_43655, clBase_36811, clBase_36810, clBase_36809, clBase_36817, clBase_36812) != 0) {
        err = 1;
        goto cleanup;
    }
    
    int64_t j_m_i_43847 = sub64(m_43734, partition_sizze_43809);
    int64_t m_43849 = sub64(j_m_i_43847, (int64_t) 1);
    int64_t i_p_m_t_s_43850 = add64(partition_sizze_43809, m_43849);
    bool i_p_m_t_s_leq_w_43852 = slt64(i_p_m_t_s_43850, m_43734);
    bool zzero_leq_i_p_m_t_s_43851 = sle64((int64_t) 0, i_p_m_t_s_43850);
    bool y_43854 = zzero_leq_i_p_m_t_s_43851 && i_p_m_t_s_leq_w_43852;
    bool i_lte_j_43853 = sle64(partition_sizze_43809, m_43734);
    bool forwards_ok_43855 = i_lte_j_43853 && y_43854;
    bool empty_slice_43848 = j_m_i_43847 == (int64_t) 0;
    bool ok_or_empty_43856 = empty_slice_43848 || forwards_ok_43855;
    bool index_certs_43857;
    
    if (!ok_or_empty_43856) {
        set_error(ctx, msgprintf("Error: %s%lld%s%lld%s%lld%s\n\nBacktrace:\n%s", "Index [", (long long) partition_sizze_43809, ":", (long long) m_43734, "] out of bounds for array of shape [", (long long) m_43734, "].", "-> #0  /prelude/soacs.fut:174:21-33\n   #1  /prelude/functional.fut:9:44-45\n   #2  ft_libs/ftDBSCAN_plus.fut:890:18-893:67\n   #3  ft_libs/ftDBSCAN_plus.fut:889:9-893:67\n"));
        err = FUTHARK_PROGRAM_ERROR;
        goto cleanup;
    }
    
    int64_t bytes_53595 = (int64_t) 8 * j_m_i_43847;
    
    if (memblock_alloc_device(ctx, &mem_53596, bytes_53595, "mem_53596")) {
        err = 1;
        goto cleanup;
    }
    if ((err = lmad_copy_gpu2gpu_8b(ctx, 1, mem_53596.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, mem_53586.mem, partition_sizze_43809, (int64_t []) {(int64_t) 1}, (int64_t []) {j_m_i_43847})) != 0)
        goto cleanup;
    if (memblock_alloc_device(ctx, &mem_53599, bytes_53595, "mem_53599")) {
        err = 1;
        goto cleanup;
    }
    if ((err = lmad_copy_gpu2gpu_8b(ctx, 1, mem_53599.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, mem_53588.mem, partition_sizze_43809, (int64_t []) {(int64_t) 1}, (int64_t []) {j_m_i_43847})) != 0)
        goto cleanup;
    if (futrts_get_num_neighbours_against_10106(ctx, &ext_mem_53601, mem_53586, mem_53588, mem_53596, mem_53599, partition_sizze_43809, j_m_i_43847, clBase_36811, clBase_36810, clBase_36809, clBase_36817, clBase_36812) != 0) {
        err = 1;
        goto cleanup;
    }
    if (memblock_unref_device(ctx, &mem_53596, "mem_53596") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_53599, "mem_53599") != 0)
        return 1;
    if (futrts_get_num_neighbours_against_10103(ctx, &ext_mem_53602, mem_53586, mem_53588, mem_53586, mem_53588, partition_sizze_43809, partition_sizze_43809, clBase_36811, clBase_36810, clBase_36809, clBase_36817, clBase_36812) != 0) {
        err = 1;
        goto cleanup;
    }
    
    int64_t num_tblocks_46998;
    int64_t max_num_tblocks_55069;
    
    max_num_tblocks_55069 = *ctx->tuning_params.do_DBSCAN_doublezisegscan_num_tblocks_46997;
    num_tblocks_46998 = sext_i64_i32(smax64((int64_t) 1, smin64(sdiv_up64(partition_sizze_43809, segscan_tblock_sizze_46996), max_num_tblocks_55069)));
    
    int64_t bytes_53604 = (int64_t) 8 * partition_sizze_43809;
    
    if (memblock_alloc_device(ctx, &mem_53605, bytes_53604, "mem_53605")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_53607, bytes_53604, "mem_53607")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_53608, partition_sizze_43809, "mem_53608")) {
        err = 1;
        goto cleanup;
    }
    if (slt64((int64_t) 0, partition_sizze_43809)) {
        if (ctx->debugging)
            fprintf(ctx->log, "%s\n", "\n# SegScan");
        
        int64_t shared_memory_55070;
        
        shared_memory_55070 = ctx->max_shared_memory;
        
        int64_t thread_block_sizze_55071;
        
        thread_block_sizze_55071 = ctx->max_thread_block_size;
        
        int64_t registers_55072;
        
        registers_55072 = ctx->max_registers;
        
        int64_t thread_block_sizze_55073;
        
        thread_block_sizze_55073 = ctx->max_thread_block_size;
        
        int64_t chunk_sizze_55074 = smax64((int64_t) 1, smin64(squot64(squot64(shared_memory_55070, thread_block_sizze_55071), (int64_t) 8), squot64(squot64(registers_55072, thread_block_sizze_55073) - (int64_t) 1 - squot64(smax64((int64_t) 4, (int64_t) 8), (int64_t) 4), (int64_t) 2 * squot64(smax64((int64_t) 4, (int64_t) 8), (int64_t) 4))));
        int64_t num_virt_blocks_55075 = sdiv_up64(partition_sizze_43809, segscan_tblock_sizze_46996 * chunk_sizze_55074);
        int64_t num_virt_threads_55076 = num_virt_blocks_55075 * segscan_tblock_sizze_46996;
        
        if (ctx->debugging)
            fprintf(ctx->log, "%s: %llu%c", "Sequential elements per thread (chunk)", (long long) chunk_sizze_55074, '\n');
        if (memblock_alloc_device(ctx, &status_flags_mem_55077, num_virt_blocks_55075, "status_flags_mem_55077")) {
            err = 1;
            goto cleanup;
        }
        if (futrts_builtinzhreplicate_i8(ctx, status_flags_mem_55077, num_virt_blocks_55075, (int8_t) 0) != 0) {
            err = 1;
            goto cleanup;
        }
        if (memblock_alloc_device(ctx, &aggregates_mem_55079, (int64_t) 8 * num_virt_blocks_55075, "aggregates_mem_55079")) {
            err = 1;
            goto cleanup;
        }
        if (memblock_alloc_device(ctx, &incprefixes_mem_55081, (int64_t) 8 * num_virt_blocks_55075, "incprefixes_mem_55081")) {
            err = 1;
            goto cleanup;
        }
        {
            err = gpu_kernel_do_DBSCAN_doublezisegscan_47001(ctx, num_tblocks_46998, 1, 1, *ctx->tuning_params.do_DBSCAN_doublezisegscan_tblock_sizze_46995, 1, 1, smax64(smax64((int64_t) 288, (int64_t) 8 * segscan_tblock_sizze_46996), chunk_sizze_55074 * segscan_tblock_sizze_46996 * (int64_t) 8) + srem64((int64_t) 8 - srem64(smax64(smax64((int64_t) 288, (int64_t) 8 * segscan_tblock_sizze_46996), chunk_sizze_55074 * segscan_tblock_sizze_46996 * (int64_t) 8), (int64_t) 8), (int64_t) 8), clBase_36814, partition_sizze_43809, num_tblocks_46998, num_virt_blocks_55075, num_virt_threads_55076, ext_mem_53594.mem, ext_mem_53601.mem, ext_mem_53602.mem, mem_53605.mem, mem_53607.mem, mem_53608.mem, status_flags_mem_55077.mem, aggregates_mem_55079.mem, incprefixes_mem_55081.mem, global_dynid_mem_55083.mem);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        if (ctx->debugging)
            fprintf(ctx->log, "%s\n", "");
    }
    if (memblock_unref_device(ctx, &ext_mem_53594, "ext_mem_53594") != 0)
        return 1;
    if (memblock_unref_device(ctx, &ext_mem_53601, "ext_mem_53601") != 0)
        return 1;
    if (memblock_unref_device(ctx, &ext_mem_53602, "ext_mem_53602") != 0)
        return 1;
    
    int64_t m_f_res_43904;
    
    if (x_43899) {
        int64_t read_res_56983;
        
        if ((err = gpu_scalar_from_device(ctx, &read_res_56983, mem_53605.mem, m_43835 * sizeof(int64_t), sizeof(int64_t))) != 0)
            goto cleanup;
        if (ctx->failure_is_an_option && futhark_context_sync(ctx) != 0) {
            err = 1;
            goto cleanup;
        }
        
        int64_t x_45352 = read_res_56983;
        
        m_f_res_43904 = x_45352;
    } else {
        m_f_res_43904 = (int64_t) 0;
    }
    
    int64_t m_43906;
    
    if (empty_slice_43834) {
        m_43906 = (int64_t) 0;
    } else {
        m_43906 = m_f_res_43904;
    }
    
    int64_t m_43916 = sub64(m_43906, (int64_t) 1);
    bool i_p_m_t_s_leq_w_43918 = slt64(m_43916, partition_sizze_43809);
    bool zzero_leq_i_p_m_t_s_43917 = sle64((int64_t) 0, m_43916);
    bool y_43920 = zzero_leq_i_p_m_t_s_43917 && i_p_m_t_s_leq_w_43918;
    bool i_lte_j_43919 = sle64((int64_t) 0, m_43906);
    bool forwards_ok_43921 = i_lte_j_43919 && y_43920;
    bool eq_x_zz_43913 = (int64_t) 0 == m_f_res_43904;
    bool p_and_eq_x_y_43914 = x_43899 && eq_x_zz_43913;
    bool empty_slice_43915 = empty_slice_43834 || p_and_eq_x_y_43914;
    bool ok_or_empty_43922 = empty_slice_43915 || forwards_ok_43921;
    bool index_certs_43923;
    
    if (!ok_or_empty_43922) {
        set_error(ctx, msgprintf("Error: %s%lld%s%lld%s\n\nBacktrace:\n%s", "Index [:", (long long) m_43906, "] out of bounds for array of shape [", (long long) partition_sizze_43809, "].", "-> #0  /prelude/soacs.fut:258:29-35\n   #1  /prelude/functional.fut:9:44-45\n   #2  ft_libs/ftDBSCAN_plus.fut:890:18-893:67\n   #3  ft_libs/ftDBSCAN_plus.fut:889:9-893:67\n"));
        err = FUTHARK_PROGRAM_ERROR;
        goto cleanup;
    }
    
    int64_t bytes_53609 = (int64_t) 8 * m_43906;
    
    if (memblock_alloc_device(ctx, &mem_53610, bytes_53609, "mem_53610")) {
        err = 1;
        goto cleanup;
    }
    if ((err = lmad_copy_gpu2gpu_8b(ctx, 1, mem_53610.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, mem_53590.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, (int64_t []) {m_43906})) != 0)
        goto cleanup;
    if (memblock_alloc_device(ctx, &mem_53612, bytes_53609, "mem_53612")) {
        err = 1;
        goto cleanup;
    }
    if ((err = lmad_copy_gpu2gpu_8b(ctx, 1, mem_53612.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, mem_53588.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, (int64_t []) {m_43906})) != 0)
        goto cleanup;
    if (memblock_alloc_device(ctx, &mem_53614, bytes_53609, "mem_53614")) {
        err = 1;
        goto cleanup;
    }
    if ((err = lmad_copy_gpu2gpu_8b(ctx, 1, mem_53614.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, mem_53586.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, (int64_t []) {m_43906})) != 0)
        goto cleanup;
    
    int64_t num_tblocks_47008;
    int64_t max_num_tblocks_55172;
    
    max_num_tblocks_55172 = *ctx->tuning_params.do_DBSCAN_doublezisegmap_num_tblocks_47007;
    num_tblocks_47008 = sext_i64_i32(smax64((int64_t) 1, smin64(sdiv_up64(partition_sizze_43809, segmap_tblock_sizze_47006), max_num_tblocks_55172)));
    if (ctx->debugging)
        fprintf(ctx->log, "%s\n", "\n# SegMap");
    
    int32_t virt_num_tblocks_55173 = sext_i64_i32(sdiv_up64(partition_sizze_43809, segmap_tblock_sizze_47006));
    
    {
        err = gpu_kernel_do_DBSCAN_doublezisegmap_47003(ctx, num_tblocks_47008, 1, 1, *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_47005, 1, 1, (int64_t) 0, partition_sizze_43809, m_43906, num_tblocks_47008, virt_num_tblocks_55173, mem_53586.mem, mem_53588.mem, mem_53590.mem, mem_53605.mem, mem_53607.mem, mem_53610.mem, mem_53612.mem, mem_53614.mem);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (ctx->debugging)
        fprintf(ctx->log, "%s\n", "");
    if (memblock_unref_device(ctx, &mem_53590, "mem_53590") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_53605, "mem_53605") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_53607, "mem_53607") != 0)
        return 1;
    if (futrts_get_num_neighbours_against_10106(ctx, &ext_mem_53616, mem_53545, mem_53543, mem_53586, mem_53588, m_43655, partition_sizze_43809, clBase_36811, clBase_36810, clBase_36809, clBase_36817, clBase_36812) != 0) {
        err = 1;
        goto cleanup;
    }
    if (memblock_unref_device(ctx, &mem_53543, "mem_53543") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_53545, "mem_53545") != 0)
        return 1;
    if (ctx->debugging)
        fprintf(ctx->log, "%s\n", "\n# SegMap");
    
    int32_t virt_num_tblocks_55186 = sext_i64_i32(sdiv_up64(m_43655, segmap_tblock_sizze_47014));
    
    {
        err = gpu_kernel_do_DBSCAN_doublezisegmap_47011(ctx, num_tblocks_47016, 1, 1, *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_47013, 1, 1, (int64_t) 0, n_36798, m_43655, num_tblocks_47016, virt_num_tblocks_55186, mem_53547.mem, mem_53553.mem, ext_mem_53616.mem);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (ctx->debugging)
        fprintf(ctx->log, "%s\n", "");
    if (memblock_unref_device(ctx, &mem_53547, "mem_53547") != 0)
        return 1;
    if (memblock_unref_device(ctx, &ext_mem_53616, "ext_mem_53616") != 0)
        return 1;
    if (memblock_alloc_device(ctx, &mem_53619, n_36798, "mem_53619")) {
        err = 1;
        goto cleanup;
    }
    if (ctx->debugging)
        fprintf(ctx->log, "%s\n", "\n# SegMap");
    
    int32_t virt_num_tblocks_55199 = sext_i64_i32(sdiv_up64(n_36798, segmap_tblock_sizze_47032));
    
    {
        err = gpu_kernel_do_DBSCAN_doublezisegmap_47036(ctx, segmap_usable_groups_47033, 1, 1, *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_47021, 1, 1, (int64_t) 0, n_36798, clBase_36814, mem_53553.mem, ext_mem_53554.mem, mem_53619.mem);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (ctx->debugging)
        fprintf(ctx->log, "%s\n", "");
    if (memblock_unref_device(ctx, &mem_53553, "mem_53553") != 0)
        return 1;
    if (memblock_unref_device(ctx, &ext_mem_53554, "ext_mem_53554") != 0)
        return 1;
    if (memblock_alloc_device(ctx, &mem_53622, bytes_53534, "mem_53622")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_53624, bytes_53534, "mem_53624")) {
        err = 1;
        goto cleanup;
    }
    if (slt64((int64_t) 0, n_36798)) {
        if (ctx->debugging)
            fprintf(ctx->log, "%s\n", "\n# SegScan");
        
        int64_t shared_memory_55208;
        
        shared_memory_55208 = ctx->max_shared_memory;
        
        int64_t thread_block_sizze_55209;
        
        thread_block_sizze_55209 = ctx->max_thread_block_size;
        
        int64_t registers_55210;
        
        registers_55210 = ctx->max_registers;
        
        int64_t thread_block_sizze_55211;
        
        thread_block_sizze_55211 = ctx->max_thread_block_size;
        
        int64_t chunk_sizze_55212 = smax64((int64_t) 1, smin64(squot64(squot64(shared_memory_55208, thread_block_sizze_55209), (int64_t) 8), squot64(squot64(registers_55210, thread_block_sizze_55211) - (int64_t) 1 - squot64(smax64((int64_t) 4, (int64_t) 8), (int64_t) 4), (int64_t) 2 * squot64(smax64((int64_t) 4, (int64_t) 8), (int64_t) 4))));
        int64_t num_virt_blocks_55213 = sdiv_up64(n_36798, segscan_tblock_sizze_47044 * chunk_sizze_55212);
        int64_t num_virt_threads_55214 = num_virt_blocks_55213 * segscan_tblock_sizze_47044;
        
        if (ctx->debugging)
            fprintf(ctx->log, "%s: %llu%c", "Sequential elements per thread (chunk)", (long long) chunk_sizze_55212, '\n');
        if (memblock_alloc_device(ctx, &status_flags_mem_55215, num_virt_blocks_55213, "status_flags_mem_55215")) {
            err = 1;
            goto cleanup;
        }
        if (futrts_builtinzhreplicate_i8(ctx, status_flags_mem_55215, num_virt_blocks_55213, (int8_t) 0) != 0) {
            err = 1;
            goto cleanup;
        }
        if (memblock_alloc_device(ctx, &aggregates_mem_55217, (int64_t) 8 * num_virt_blocks_55213, "aggregates_mem_55217")) {
            err = 1;
            goto cleanup;
        }
        if (memblock_alloc_device(ctx, &incprefixes_mem_55219, (int64_t) 8 * num_virt_blocks_55213, "incprefixes_mem_55219")) {
            err = 1;
            goto cleanup;
        }
        {
            err = gpu_kernel_do_DBSCAN_doublezisegscan_47049(ctx, num_tblocks_47046, 1, 1, *ctx->tuning_params.do_DBSCAN_doublezisegscan_tblock_sizze_47043, 1, 1, smax64(smax64((int64_t) 288, (int64_t) 8 * segscan_tblock_sizze_47044), chunk_sizze_55212 * segscan_tblock_sizze_47044 * (int64_t) 8) + srem64((int64_t) 8 - srem64(smax64(smax64((int64_t) 288, (int64_t) 8 * segscan_tblock_sizze_47044), chunk_sizze_55212 * segscan_tblock_sizze_47044 * (int64_t) 8), (int64_t) 8), (int64_t) 8), n_36798, num_tblocks_47046, num_virt_blocks_55213, num_virt_threads_55214, mem_53619.mem, mem_53622.mem, mem_53624.mem, status_flags_mem_55215.mem, aggregates_mem_55217.mem, incprefixes_mem_55219.mem, global_dynid_mem_55221.mem);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        if (ctx->debugging)
            fprintf(ctx->log, "%s\n", "");
    }
    
    int64_t m_f_res_43946;
    
    if (x_43646) {
        int64_t read_res_56984;
        
        if ((err = gpu_scalar_from_device(ctx, &read_res_56984, mem_53622.mem, tmp_43647 * sizeof(int64_t), sizeof(int64_t))) != 0)
            goto cleanup;
        if (ctx->failure_is_an_option && futhark_context_sync(ctx) != 0) {
            err = 1;
            goto cleanup;
        }
        
        int64_t x_45353 = read_res_56984;
        
        m_f_res_43946 = x_45353;
    } else {
        m_f_res_43946 = (int64_t) 0;
    }
    
    int64_t m_43948;
    
    if (cond_43645) {
        m_43948 = (int64_t) 0;
    } else {
        m_43948 = m_f_res_43946;
    }
    
    int64_t conc_tmp_43977 = m_43906 + m_43948;
    int64_t max_res_43985 = smax64((int64_t) 1, conc_tmp_43977);
    bool zzero_43986 = max_res_43985 == (int64_t) 0;
    bool nonzzero_43987 = !zzero_43986;
    bool nonzzero_cert_43988;
    
    if (!nonzzero_43987) {
        set_error(ctx, msgprintf("Error: %s\n\nBacktrace:\n%s", "division by zero", "-> #0  ft_libs/ftDBSCAN_plus.fut:517:63-77\n   #1  ft_libs/ftDBSCAN_plus.fut:890:18-893:67\n   #2  ft_libs/ftDBSCAN_plus.fut:889:9-893:67\n"));
        err = FUTHARK_PROGRAM_ERROR;
        goto cleanup;
    }
    
    int64_t max_arg1_43989 = sdiv64(clBase_36812, max_res_43985);
    int64_t max_res_44441 = smax64((int64_t) 1, max_arg1_43989);
    bool zzero_44466 = max_res_44441 == (int64_t) 0;
    bool nonzzero_44467 = !zzero_44466;
    bool nonzzero_cert_44468;
    
    if (!nonzzero_44467) {
        set_error(ctx, msgprintf("Error: %s\n\nBacktrace:\n%s", "division by zero", "-> #0  ft_libs/ftDBSCAN_plus.fut:626:57-64\n   #1  ft_libs/ftDBSCAN_plus.fut:890:18-893:67\n   #2  ft_libs/ftDBSCAN_plus.fut:889:9-893:67\n"));
        err = FUTHARK_PROGRAM_ERROR;
        goto cleanup;
    }
    
    int64_t zm_lhs_44464 = add64(partition_sizze_43809, max_res_44441);
    int64_t zs_lhs_44465 = sub64(zm_lhs_44464, (int64_t) 1);
    int64_t numIter1_44469 = sdiv64(zs_lhs_44465, max_res_44441);
    bool bounds_invalid_upwards_44471 = slt64(numIter1_44469, (int64_t) 0);
    bool valid_44472 = !bounds_invalid_upwards_44471;
    bool range_valid_c_44473;
    
    if (!valid_44472) {
        set_error(ctx, msgprintf("Error: %s%lld%s%lld%s%lld%s\n\nBacktrace:\n%s", "Range ", (long long) (int64_t) 0, "..", (long long) (int64_t) 1, "..<", (long long) numIter1_44469, " is invalid.", "-> #0  /prelude/array.fut:94:3-11\n   #1  ft_libs/ftDBSCAN_plus.fut:628:75-88\n   #2  ft_libs/ftDBSCAN_plus.fut:890:18-893:67\n   #3  ft_libs/ftDBSCAN_plus.fut:889:9-893:67\n"));
        err = FUTHARK_PROGRAM_ERROR;
        goto cleanup;
    }
    
    int64_t tmp_44156 = sub64(conc_tmp_43977, (int64_t) 1);
    bool y_44158 = slt64(tmp_44156, conc_tmp_43977);
    bool x_44157 = sle64((int64_t) 0, tmp_44156);
    bool bounds_check_44159 = x_44157 && y_44158;
    bool cond_44154 = conc_tmp_43977 == (int64_t) 0;
    bool protect_assert_disj_44160 = cond_44154 || bounds_check_44159;
    bool index_certs_44161;
    
    if (!protect_assert_disj_44160) {
        set_error(ctx, msgprintf("Error: %s%lld%s%lld%s\n\nBacktrace:\n%s", "Index [", (long long) tmp_44156, "] out of bounds for array of shape [", (long long) conc_tmp_43977, "].", "-> #0  /prelude/soacs.fut:257:33-47\n   #1  /prelude/functional.fut:9:44-45\n   #2  ft_libs/ftDBSCAN_plus.fut:890:18-893:67\n   #3  ft_libs/ftDBSCAN_plus.fut:889:9-893:67\n"));
        err = FUTHARK_PROGRAM_ERROR;
        goto cleanup;
    }
    
    bool x_44155 = !cond_44154;
    int64_t m_43958 = sub64(m_43948, (int64_t) 1);
    bool i_p_m_t_s_leq_w_43960 = slt64(m_43958, n_36798);
    bool zzero_leq_i_p_m_t_s_43959 = sle64((int64_t) 0, m_43958);
    bool y_43962 = zzero_leq_i_p_m_t_s_43959 && i_p_m_t_s_leq_w_43960;
    bool i_lte_j_43961 = sle64((int64_t) 0, m_43948);
    bool forwards_ok_43963 = i_lte_j_43961 && y_43962;
    bool eq_x_zz_43955 = (int64_t) 0 == m_f_res_43946;
    bool p_and_eq_x_y_43956 = x_43646 && eq_x_zz_43955;
    bool empty_slice_43957 = cond_43645 || p_and_eq_x_y_43956;
    bool ok_or_empty_43964 = empty_slice_43957 || forwards_ok_43963;
    bool index_certs_43965;
    
    if (!ok_or_empty_43964) {
        set_error(ctx, msgprintf("Error: %s%lld%s%lld%s\n\nBacktrace:\n%s", "Index [:", (long long) m_43948, "] out of bounds for array of shape [", (long long) n_36798, "].", "-> #0  /prelude/soacs.fut:258:29-35\n   #1  /prelude/functional.fut:9:44-45\n   #2  ft_libs/ftDBSCAN_plus.fut:890:18-893:67\n   #3  ft_libs/ftDBSCAN_plus.fut:889:9-893:67\n"));
        err = FUTHARK_PROGRAM_ERROR;
        goto cleanup;
    }
    
    int64_t bytes_53627 = (int64_t) 8 * m_43948;
    
    if (memblock_alloc_device(ctx, &mem_53628, bytes_53627, "mem_53628")) {
        err = 1;
        goto cleanup;
    }
    if (futrts_builtinzhreplicate_i64(ctx, mem_53628, m_43948, (int64_t) -1) != 0) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_53630, bytes_53627, "mem_53630")) {
        err = 1;
        goto cleanup;
    }
    if ((err = lmad_copy_gpu2gpu_8b(ctx, 1, mem_53630.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, mem_53541.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, (int64_t []) {m_43948})) != 0)
        goto cleanup;
    if (memblock_unref_device(ctx, &mem_53541, "mem_53541") != 0)
        return 1;
    if (memblock_alloc_device(ctx, &mem_53632, bytes_53627, "mem_53632")) {
        err = 1;
        goto cleanup;
    }
    if ((err = lmad_copy_gpu2gpu_8b(ctx, 1, mem_53632.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, mem_53539.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, (int64_t []) {m_43948})) != 0)
        goto cleanup;
    if (memblock_unref_device(ctx, &mem_53539, "mem_53539") != 0)
        return 1;
    if (ctx->debugging)
        fprintf(ctx->log, "%s\n", "\n# SegMap");
    
    int32_t virt_num_tblocks_55310 = sext_i64_i32(sdiv_up64(n_36798, segmap_tblock_sizze_47054));
    
    {
        err = gpu_kernel_do_DBSCAN_doublezisegmap_47051(ctx, num_tblocks_47056, 1, 1, *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_47053, 1, 1, (int64_t) 0, n_36798, m_43948, num_tblocks_47056, virt_num_tblocks_55310, current_partition_mem_53519.mem, current_partition_mem_53520.mem, mem_53622.mem, mem_53624.mem, mem_53628.mem, mem_53630.mem, mem_53632.mem);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (ctx->debugging)
        fprintf(ctx->log, "%s\n", "");
    if (memblock_unref_device(ctx, &mem_53622, "mem_53622") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_53624, "mem_53624") != 0)
        return 1;
    
    int64_t bytes_53634 = (int64_t) 8 * conc_tmp_43977;
    
    if (memblock_alloc_device(ctx, &mem_53635, bytes_53634, "mem_53635")) {
        err = 1;
        goto cleanup;
    }
    
    int64_t tmp_offs_55323 = (int64_t) 0;
    
    if ((err = lmad_copy_gpu2gpu_8b(ctx, 1, mem_53635.mem, tmp_offs_55323, (int64_t []) {(int64_t) 1}, mem_53610.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, (int64_t []) {m_43906})) != 0)
        goto cleanup;
    tmp_offs_55323 += m_43906;
    if ((err = lmad_copy_gpu2gpu_8b(ctx, 1, mem_53635.mem, tmp_offs_55323, (int64_t []) {(int64_t) 1}, mem_53628.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, (int64_t []) {m_43948})) != 0)
        goto cleanup;
    tmp_offs_55323 += m_43948;
    
    int64_t num_tblocks_47062;
    int64_t max_num_tblocks_55324;
    
    max_num_tblocks_55324 = *ctx->tuning_params.do_DBSCAN_doublezisegscan_num_tblocks_47061;
    num_tblocks_47062 = sext_i64_i32(smax64((int64_t) 1, smin64(sdiv_up64(conc_tmp_43977, segscan_tblock_sizze_47060), max_num_tblocks_55324)));
    if (memblock_alloc_device(ctx, &mem_53638, bytes_53634, "mem_53638")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_53640, bytes_53634, "mem_53640")) {
        err = 1;
        goto cleanup;
    }
    if (slt64((int64_t) 0, conc_tmp_43977)) {
        if (ctx->debugging)
            fprintf(ctx->log, "%s\n", "\n# SegScan");
        
        int64_t shared_memory_55325;
        
        shared_memory_55325 = ctx->max_shared_memory;
        
        int64_t thread_block_sizze_55326;
        
        thread_block_sizze_55326 = ctx->max_thread_block_size;
        
        int64_t registers_55327;
        
        registers_55327 = ctx->max_registers;
        
        int64_t thread_block_sizze_55328;
        
        thread_block_sizze_55328 = ctx->max_thread_block_size;
        
        int64_t chunk_sizze_55329 = smax64((int64_t) 1, smin64(squot64(squot64(shared_memory_55325, thread_block_sizze_55326), (int64_t) 8), squot64(squot64(registers_55327, thread_block_sizze_55328) - (int64_t) 1 - squot64(smax64((int64_t) 4, (int64_t) 8), (int64_t) 4), (int64_t) 2 * squot64(smax64((int64_t) 4, (int64_t) 8), (int64_t) 4))));
        int64_t num_virt_blocks_55330 = sdiv_up64(conc_tmp_43977, segscan_tblock_sizze_47060 * chunk_sizze_55329);
        int64_t num_virt_threads_55331 = num_virt_blocks_55330 * segscan_tblock_sizze_47060;
        
        if (ctx->debugging)
            fprintf(ctx->log, "%s: %llu%c", "Sequential elements per thread (chunk)", (long long) chunk_sizze_55329, '\n');
        if (memblock_alloc_device(ctx, &status_flags_mem_55332, num_virt_blocks_55330, "status_flags_mem_55332")) {
            err = 1;
            goto cleanup;
        }
        if (futrts_builtinzhreplicate_i8(ctx, status_flags_mem_55332, num_virt_blocks_55330, (int8_t) 0) != 0) {
            err = 1;
            goto cleanup;
        }
        if (memblock_alloc_device(ctx, &aggregates_mem_55334, (int64_t) 8 * num_virt_blocks_55330, "aggregates_mem_55334")) {
            err = 1;
            goto cleanup;
        }
        if (memblock_alloc_device(ctx, &incprefixes_mem_55336, (int64_t) 8 * num_virt_blocks_55330, "incprefixes_mem_55336")) {
            err = 1;
            goto cleanup;
        }
        {
            err = gpu_kernel_do_DBSCAN_doublezisegscan_47065(ctx, num_tblocks_47062, 1, 1, *ctx->tuning_params.do_DBSCAN_doublezisegscan_tblock_sizze_47059, 1, 1, smax64(smax64((int64_t) 288, (int64_t) 8 * segscan_tblock_sizze_47060), chunk_sizze_55329 * segscan_tblock_sizze_47060 * (int64_t) 8) + srem64((int64_t) 8 - srem64(smax64(smax64((int64_t) 288, (int64_t) 8 * segscan_tblock_sizze_47060), chunk_sizze_55329 * segscan_tblock_sizze_47060 * (int64_t) 8), (int64_t) 8), (int64_t) 8), m_43906, conc_tmp_43977, num_tblocks_47062, num_virt_blocks_55330, num_virt_threads_55331, mem_53610.mem, mem_53628.mem, mem_53638.mem, mem_53640.mem, status_flags_mem_55332.mem, aggregates_mem_55334.mem, incprefixes_mem_55336.mem, global_dynid_mem_55338.mem);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        if (ctx->debugging)
            fprintf(ctx->log, "%s\n", "");
    }
    
    int64_t m_f_res_44162;
    
    if (x_44155) {
        int64_t read_res_56985;
        
        if ((err = gpu_scalar_from_device(ctx, &read_res_56985, mem_53638.mem, tmp_44156 * sizeof(int64_t), sizeof(int64_t))) != 0)
            goto cleanup;
        if (ctx->failure_is_an_option && futhark_context_sync(ctx) != 0) {
            err = 1;
            goto cleanup;
        }
        
        int64_t x_45370 = read_res_56985;
        
        m_f_res_44162 = x_45370;
    } else {
        m_f_res_44162 = (int64_t) 0;
    }
    
    int64_t m_44164;
    
    if (cond_44154) {
        m_44164 = (int64_t) 0;
    } else {
        m_44164 = m_f_res_44162;
    }
    
    int64_t m_44174 = sub64(m_44164, (int64_t) 1);
    bool y_44248 = slt64(m_44174, m_44164);
    bool zzero_leq_i_p_m_t_s_44175 = sle64((int64_t) 0, m_44174);
    bool bounds_check_44249 = zzero_leq_i_p_m_t_s_44175 && y_44248;
    bool eq_x_zz_44171 = (int64_t) 0 == m_f_res_44162;
    bool p_and_eq_x_y_44172 = x_44155 && eq_x_zz_44171;
    bool empty_slice_44173 = cond_44154 || p_and_eq_x_y_44172;
    bool protect_assert_disj_44250 = empty_slice_44173 || bounds_check_44249;
    bool index_certs_44251;
    
    if (!protect_assert_disj_44250) {
        set_error(ctx, msgprintf("Error: %s%lld%s%lld%s\n\nBacktrace:\n%s", "Index [", (long long) m_44174, "] out of bounds for array of shape [", (long long) m_44164, "].", "-> #0  /prelude/soacs.fut:257:33-47\n   #1  /prelude/functional.fut:9:44-45\n   #2  ft_libs/ftDBSCAN_plus.fut:890:18-893:67\n   #3  ft_libs/ftDBSCAN_plus.fut:889:9-893:67\n"));
        err = FUTHARK_PROGRAM_ERROR;
        goto cleanup;
    }
    
    bool x_44247 = !empty_slice_44173;
    bool i_p_m_t_s_leq_w_44176 = slt64(m_44174, conc_tmp_43977);
    bool y_44178 = zzero_leq_i_p_m_t_s_44175 && i_p_m_t_s_leq_w_44176;
    bool ok_or_empty_44180 = empty_slice_44173 || y_44178;
    bool index_certs_44181;
    
    if (!ok_or_empty_44180) {
        set_error(ctx, msgprintf("Error: %s%lld%s%lld%s\n\nBacktrace:\n%s", "Index [:", (long long) m_44164, "] out of bounds for array of shape [", (long long) conc_tmp_43977, "].", "-> #0  /prelude/soacs.fut:258:29-35\n   #1  /prelude/functional.fut:9:44-45\n   #2  ft_libs/ftDBSCAN_plus.fut:890:18-893:67\n   #3  ft_libs/ftDBSCAN_plus.fut:889:9-893:67\n"));
        err = FUTHARK_PROGRAM_ERROR;
        goto cleanup;
    }
    
    int64_t bytes_53641 = (int64_t) 8 * m_44164;
    
    if (memblock_alloc_device(ctx, &mem_53642, bytes_53641, "mem_53642")) {
        err = 1;
        goto cleanup;
    }
    if ((err = lmad_copy_gpu2gpu_8b(ctx, 1, mem_53642.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, mem_53635.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, (int64_t []) {m_44164})) != 0)
        goto cleanup;
    
    int64_t zm_lhs_44115 = add64(conc_tmp_43977, max_res_44114);
    int64_t zs_lhs_44116 = sub64(zm_lhs_44115, (int64_t) 1);
    int64_t max_iter_44120 = sdiv64(zs_lhs_44116, max_res_44114);
    bool bounds_invalid_upwards_44121 = slt64(max_iter_44120, (int64_t) 0);
    bool valid_44122 = !bounds_invalid_upwards_44121;
    bool range_valid_c_44123;
    
    if (!valid_44122) {
        set_error(ctx, msgprintf("Error: %s%lld%s%lld%s%lld%s\n\nBacktrace:\n%s", "Range ", (long long) (int64_t) 0, "..", (long long) (int64_t) 1, "..<", (long long) max_iter_44120, " is invalid.", "-> #0  /prelude/array.fut:94:3-11\n   #1  ft_libs/ftbasics.fut:28:33-46\n   #2  ft_libs/ftDBSCAN_plus.fut:890:18-893:67\n   #3  ft_libs/ftDBSCAN_plus.fut:889:9-893:67\n"));
        err = FUTHARK_PROGRAM_ERROR;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_53644, bytes_53634, "mem_53644")) {
        err = 1;
        goto cleanup;
    }
    if (futrts_builtinzhreplicate_i64(ctx, mem_53644, conc_tmp_43977, (int64_t) -1) != 0) {
        err = 1;
        goto cleanup;
    }
    
    int64_t zm_lhs_43991 = add64(conc_tmp_43977, max_res_44441);
    int64_t zs_lhs_43992 = sub64(zm_lhs_43991, (int64_t) 1);
    int64_t num_iter_43996 = sdiv64(zs_lhs_43992, max_res_44441);
    bool bounds_invalid_upwards_43998 = slt64(num_iter_43996, (int64_t) 0);
    bool valid_43999 = !bounds_invalid_upwards_43998;
    bool range_valid_c_44000;
    
    if (!valid_43999) {
        set_error(ctx, msgprintf("Error: %s%lld%s%lld%s%lld%s\n\nBacktrace:\n%s", "Range ", (long long) (int64_t) 0, "..", (long long) (int64_t) 1, "..<", (long long) num_iter_43996, " is invalid.", "-> #0  /prelude/array.fut:94:3-11\n   #1  ft_libs/ftDBSCAN_plus.fut:523:73-86\n   #2  ft_libs/ftDBSCAN_plus.fut:890:18-893:67\n   #3  ft_libs/ftDBSCAN_plus.fut:889:9-893:67\n"));
        err = FUTHARK_PROGRAM_ERROR;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_53646, bytes_53634, "mem_53646")) {
        err = 1;
        goto cleanup;
    }
    if (futrts_builtinzhiota_i64(ctx, mem_53646, conc_tmp_43977, (int64_t) 0, (int64_t) 1) != 0) {
        err = 1;
        goto cleanup;
    }
    
    int64_t num_tblocks_47312;
    int64_t max_num_tblocks_55427;
    
    max_num_tblocks_55427 = *ctx->tuning_params.do_DBSCAN_doublezisegred_num_tblocks_47311;
    num_tblocks_47312 = sext_i64_i32(smax64((int64_t) 1, smin64(sdiv_up64(conc_tmp_43977, segred_tblock_sizze_47310), max_num_tblocks_55427)));
    
    int64_t num_whole_tiles_49886 = squot_safe64(conc_tmp_43977, tile_sizze_49826);
    int64_t residual_input_50093 = srem_safe64(conc_tmp_43977, tile_sizze_49826);
    bool cond_50094 = residual_input_50093 == (int64_t) 0;
    int64_t binop_x_50110 = tile_sizze_49826 * num_whole_tiles_49886;
    int64_t bytes_53693 = (int64_t) 8 * tile_sizze_49826;
    
    if (memblock_alloc_device(ctx, &mem_53724, (int64_t) 1, "mem_53724")) {
        err = 1;
        goto cleanup;
    }
    
    bool cluster_heads_44001;
    bool loop_while_44003;
    
    if (memblock_set_device(ctx, &mem_param_53649, &mem_53646, "mem_53646") != 0)
        return 1;
    loop_while_44003 = 1;
    while (loop_while_44003) {
        if (memblock_set_device(ctx, &mem_param_53652, &mem_param_53649, "mem_param_53649") != 0)
            return 1;
        for (int64_t i_44006 = 0; i_44006 < num_iter_43996; i_44006++) {
            int64_t inf_44008 = mul64(i_44006, max_res_44441);
            int64_t min_arg1_44009 = add64(inf_44008, max_res_44441);
            int64_t min_res_44010 = smin64(conc_tmp_43977, min_arg1_44009);
            int64_t j_m_i_44011 = sub64(min_res_44010, inf_44008);
            bool empty_slice_44012 = j_m_i_44011 == (int64_t) 0;
            int64_t m_44013 = sub64(j_m_i_44011, (int64_t) 1);
            int64_t i_p_m_t_s_44014 = add64(inf_44008, m_44013);
            bool zzero_leq_i_p_m_t_s_44015 = sle64((int64_t) 0, i_p_m_t_s_44014);
            bool i_p_m_t_s_leq_w_44016 = slt64(i_p_m_t_s_44014, conc_tmp_43977);
            bool zzero_lte_i_44017 = sle64((int64_t) 0, inf_44008);
            bool i_lte_j_44018 = sle64(inf_44008, min_res_44010);
            bool y_44019 = i_p_m_t_s_leq_w_44016 && zzero_lte_i_44017;
            bool y_44020 = zzero_leq_i_p_m_t_s_44015 && y_44019;
            bool forwards_ok_44021 = i_lte_j_44018 && y_44020;
            bool ok_or_empty_44022 = empty_slice_44012 || forwards_ok_44021;
            bool index_certs_44023;
            
            if (!ok_or_empty_44022) {
                set_error(ctx, msgprintf("Error: %s%lld%s%lld%s%lld%s\n\nBacktrace:\n%s", "Index [", (long long) inf_44008, ":", (long long) min_res_44010, "] out of bounds for array of shape [", (long long) conc_tmp_43977, "].", "-> #0  ft_libs/ftDBSCAN_plus.fut:526:64-81\n   #1  ft_libs/ftDBSCAN_plus.fut:890:18-893:67\n   #2  ft_libs/ftDBSCAN_plus.fut:889:9-893:67\n"));
                err = FUTHARK_PROGRAM_ERROR;
                goto cleanup;
            }
            
            bool suff_outer_par_47067;
            
            suff_outer_par_47067 = *ctx->tuning_params.do_DBSCAN_doublezisuff_outer_par_0 <= j_m_i_44011;
            if (ctx->logging)
                fprintf(ctx->log, "Compared %s <= %ld: %s.\n", "do_DBSCAN_double.suff_outer_par_0", (long) j_m_i_44011, suff_outer_par_47067 ? "true" : "false");
            
            int64_t nest_sizze_47260 = conc_tmp_43977 * j_m_i_44011;
            int64_t num_tblocks_47262;
            int64_t max_num_tblocks_55433;
            
            max_num_tblocks_55433 = *ctx->tuning_params.do_DBSCAN_doublezisegred_num_tblocks_47178;
            num_tblocks_47262 = sext_i64_i32(smax64((int64_t) 1, smin64(sdiv_up64(nest_sizze_47260, segred_tblock_sizze_47261), max_num_tblocks_55433)));
            
            int64_t bytes_53654 = (int64_t) 8 * j_m_i_44011;
            int64_t shared_memory_capacity_55532;
            
            shared_memory_capacity_55532 = ctx->max_shared_memory;
            if (suff_outer_par_47067 && sle64(sdiv_up64(bytes_53693, (int64_t) 8) * (int64_t) 8 + sdiv_up64(bytes_53693, (int64_t) 8) * (int64_t) 8 + sdiv_up64(bytes_53693, (int64_t) 8) * (int64_t) 8, shared_memory_capacity_55532)) {
                int64_t ldim_49827 = sdiv_up64(j_m_i_44011, tile_sizze_49826);
                
                if (memblock_alloc_device(ctx, &mem_53716, bytes_53654, "mem_53716")) {
                    err = 1;
                    goto cleanup;
                }
                if (ctx->debugging)
                    fprintf(ctx->log, "%s\n", "\n# SegMap");
                
                int32_t num_chunks_55434 = sext_i64_i32(sdiv_up64(tile_sizze_49826, tile_sizze_49826));
                int32_t virt_num_tblocks_55435 = sext_i64_i32(ldim_49827);
                
                {
                    err = gpu_kernel_do_DBSCAN_doublezisegmap_intrablock_49824(ctx, ldim_49827, 1, 1, *ctx->tuning_params.do_DBSCAN_doublezitile_sizze_49825, 1, 1, bytes_53693 + srem64((int64_t) 8 - srem64(bytes_53693, (int64_t) 8), (int64_t) 8) + (bytes_53693 + srem64((int64_t) 8 - srem64(bytes_53693, (int64_t) 8), (int64_t) 8)) + (bytes_53693 + srem64((int64_t) 8 - srem64(bytes_53693, (int64_t) 8), (int64_t) 8)), clBase_36809, clBase_36810, clBase_36811, clBase_36817, m_43906, conc_tmp_43977, inf_44008, j_m_i_44011, ldim_49827, num_whole_tiles_49886, residual_input_50093, cond_50094, binop_x_50110, mem_53612.mem, mem_53614.mem, mem_53630.mem, mem_53632.mem, mem_param_53652.mem, mem_53716.mem);
                    if (err != FUTHARK_SUCCESS)
                        goto cleanup;
                }
                if (ctx->debugging)
                    fprintf(ctx->log, "%s\n", "");
                if (memblock_set_device(ctx, &ext_mem_53717, &mem_53716, "mem_53716") != 0)
                    return 1;
            } else {
                int64_t segmap_usable_groups_47244 = sdiv_up64(j_m_i_44011, segmap_tblock_sizze_47243);
                
                if (memblock_alloc_device(ctx, &mem_53655, bytes_53654, "mem_53655")) {
                    err = 1;
                    goto cleanup;
                }
                if (memblock_alloc_device(ctx, &mem_53657, bytes_53654, "mem_53657")) {
                    err = 1;
                    goto cleanup;
                }
                if (memblock_alloc_device(ctx, &mem_53659, bytes_53654, "mem_53659")) {
                    err = 1;
                    goto cleanup;
                }
                if (ctx->debugging)
                    fprintf(ctx->log, "%s\n", "\n# SegMap");
                
                int32_t virt_num_tblocks_55451 = sext_i64_i32(sdiv_up64(j_m_i_44011, segmap_tblock_sizze_47243));
                
                {
                    err = gpu_kernel_do_DBSCAN_doublezisegmap_47249(ctx, segmap_usable_groups_47244, 1, 1, *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_47228, 1, 1, (int64_t) 0, clBase_36809, m_43906, inf_44008, j_m_i_44011, mem_53612.mem, mem_53614.mem, mem_53630.mem, mem_53632.mem, mem_53655.mem, mem_53657.mem, mem_53659.mem);
                    if (err != FUTHARK_SUCCESS)
                        goto cleanup;
                }
                if (ctx->debugging)
                    fprintf(ctx->log, "%s\n", "");
                if (memblock_alloc_device(ctx, &mem_53662, bytes_53654, "mem_53662")) {
                    err = 1;
                    goto cleanup;
                }
                if (ctx->debugging)
                    fprintf(ctx->log, "%s\n", "\n# SegRed");
                
                int64_t chunk_sizze_55460 = (int64_t) 1;
                
                if (slt64(conc_tmp_43977 * (int64_t) 2, segred_tblock_sizze_47261 * chunk_sizze_55460)) {
                    int64_t segment_sizze_nonzzero_55461 = smax64((int64_t) 1, conc_tmp_43977);
                    int64_t num_threads_55462 = segred_tblock_sizze_47261 * segred_tblock_sizze_47261;
                    
                    if (ctx->debugging)
                        fprintf(ctx->log, "%s\n", "# SegRed-small");
                    if (ctx->debugging)
                        fprintf(ctx->log, "%s: %llu%c", "num_segments", (long long) j_m_i_44011, '\n');
                    if (ctx->debugging)
                        fprintf(ctx->log, "%s: %llu%c", "segment_size", (long long) conc_tmp_43977, '\n');
                    if (ctx->debugging)
                        fprintf(ctx->log, "%s: %llu%c", "segments_per_block", (long long) squot64(segred_tblock_sizze_47261, segment_sizze_nonzzero_55461), '\n');
                    if (ctx->debugging)
                        fprintf(ctx->log, "%s: %llu%c", "required_blocks", (long long) sext_i64_i32(sdiv_up64(j_m_i_44011, squot64(segred_tblock_sizze_47261, segment_sizze_nonzzero_55461))), '\n');
                    {
                        err = gpu_kernel_do_DBSCAN_doublezisegred_small_47267(ctx, num_tblocks_47262, 1, 1, *ctx->tuning_params.do_DBSCAN_doublezisegred_tblock_sizze_47176, 1, 1, (int64_t) 8 * segred_tblock_sizze_47261 + srem64((int64_t) 8 - srem64((int64_t) 8 * segred_tblock_sizze_47261, (int64_t) 8), (int64_t) 8), clBase_36809, clBase_36810, clBase_36811, clBase_36817, m_43906, conc_tmp_43977, inf_44008, j_m_i_44011, num_tblocks_47262, x_53498, segment_sizze_nonzzero_55461, mem_53612.mem, mem_53614.mem, mem_53630.mem, mem_53632.mem, mem_param_53652.mem, mem_53655.mem, mem_53657.mem, mem_53659.mem, mem_53662.mem);
                        if (err != FUTHARK_SUCCESS)
                            goto cleanup;
                    }
                } else {
                    int64_t blocks_per_segment_55489 = sdiv_up64(num_tblocks_47262, smax64((int64_t) 1, j_m_i_44011));
                    int64_t q_55490 = sdiv_up64(conc_tmp_43977, segred_tblock_sizze_47261 * blocks_per_segment_55489 * chunk_sizze_55460);
                    int64_t num_virtblocks_55491 = blocks_per_segment_55489 * j_m_i_44011;
                    int64_t threads_per_segment_55492 = blocks_per_segment_55489 * segred_tblock_sizze_47261;
                    
                    if (ctx->debugging)
                        fprintf(ctx->log, "%s\n", "# SegRed-large");
                    if (ctx->debugging)
                        fprintf(ctx->log, "%s: %llu%c", "num_segments", (long long) j_m_i_44011, '\n');
                    if (ctx->debugging)
                        fprintf(ctx->log, "%s: %llu%c", "segment_size", (long long) conc_tmp_43977, '\n');
                    if (ctx->debugging)
                        fprintf(ctx->log, "%s: %llu%c", "num_virtblocks", (long long) num_virtblocks_55491, '\n');
                    if (ctx->debugging)
                        fprintf(ctx->log, "%s: %llu%c", "num_tblocks", (long long) num_tblocks_47262, '\n');
                    if (ctx->debugging)
                        fprintf(ctx->log, "%s: %llu%c", "tblock_size", (long long) segred_tblock_sizze_47261, '\n');
                    if (ctx->debugging)
                        fprintf(ctx->log, "%s: %llu%c", "q", (long long) q_55490, '\n');
                    if (ctx->debugging)
                        fprintf(ctx->log, "%s: %llu%c", "blocks_per_segment", (long long) blocks_per_segment_55489, '\n');
                    if (memblock_alloc_device(ctx, &segred_tmp_mem_55493, (int64_t) 8 * num_virtblocks_55491, "segred_tmp_mem_55493")) {
                        err = 1;
                        goto cleanup;
                    }
                    {
                        err = gpu_kernel_do_DBSCAN_doublezisegred_large_47267(ctx, num_tblocks_47262, 1, 1, *ctx->tuning_params.do_DBSCAN_doublezisegred_tblock_sizze_47176, 1, 1, 8 + ((int64_t) 8 * segred_tblock_sizze_47261 + srem64((int64_t) 8 - srem64((int64_t) 8 * segred_tblock_sizze_47261, (int64_t) 8), (int64_t) 8)), clBase_36809, clBase_36810, clBase_36811, clBase_36817, m_43906, conc_tmp_43977, inf_44008, j_m_i_44011, num_tblocks_47262, x_53498, blocks_per_segment_55489, q_55490, num_virtblocks_55491, threads_per_segment_55492, mem_53612.mem, mem_53614.mem, mem_53630.mem, mem_53632.mem, mem_param_53652.mem, mem_53655.mem, mem_53657.mem, mem_53659.mem, mem_53662.mem, segred_tmp_mem_55493.mem, counters_mem_55495.mem);
                        if (err != FUTHARK_SUCCESS)
                            goto cleanup;
                    }
                }
                if (ctx->debugging)
                    fprintf(ctx->log, "%s\n", "");
                if (memblock_unref_device(ctx, &mem_53655, "mem_53655") != 0)
                    return 1;
                if (memblock_unref_device(ctx, &mem_53657, "mem_53657") != 0)
                    return 1;
                if (memblock_unref_device(ctx, &mem_53659, "mem_53659") != 0)
                    return 1;
                if (memblock_set_device(ctx, &ext_mem_53717, &mem_53662, "mem_53662") != 0)
                    return 1;
            }
            if (memblock_alloc_device(ctx, &mem_53719, bytes_53634, "mem_53719")) {
                err = 1;
                goto cleanup;
            }
            if ((err = lmad_copy_gpu2gpu_8b(ctx, 1, mem_53719.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, mem_param_53652.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, (int64_t []) {conc_tmp_43977})) != 0)
                goto cleanup;
            if ((err = lmad_copy_gpu2gpu_8b(ctx, 1, mem_53719.mem, inf_44008, (int64_t []) {(int64_t) 1}, ext_mem_53717.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, (int64_t []) {j_m_i_44011})) != 0)
                goto cleanup;
            if (memblock_unref_device(ctx, &ext_mem_53717, "ext_mem_53717") != 0)
                return 1;
            if (memblock_set_device(ctx, &mem_param_tmp_55431, &mem_53719, "mem_53719") != 0)
                return 1;
            if (memblock_set_device(ctx, &mem_param_53652, &mem_param_tmp_55431, "mem_param_tmp_55431") != 0)
                return 1;
        }
        if (memblock_set_device(ctx, &ext_mem_53722, &mem_param_53652, "mem_param_53652") != 0)
            return 1;
        if (ctx->debugging)
            fprintf(ctx->log, "%s\n", "\n# SegRed");
        
        int64_t chunk_sizze_55533 = (int64_t) 1;
        
        if (memblock_alloc_device(ctx, &segred_tmp_mem_55536, num_tblocks_47312, "segred_tmp_mem_55536")) {
            err = 1;
            goto cleanup;
        }
        
        int64_t num_threads_55538 = num_tblocks_47312 * segred_tblock_sizze_47310;
        
        {
            err = gpu_kernel_do_DBSCAN_doublezisegred_nonseg_47317(ctx, num_tblocks_47312, 1, 1, *ctx->tuning_params.do_DBSCAN_doublezisegred_tblock_sizze_47309, 1, 1, 8 + (segred_tblock_sizze_47310 + srem64((int64_t) 8 - srem64(segred_tblock_sizze_47310, (int64_t) 8), (int64_t) 8)), conc_tmp_43977, num_tblocks_47312, num_threads_55538, mem_param_53649.mem, ext_mem_53722.mem, mem_53724.mem, counters_mem_55534.mem, segred_tmp_mem_55536.mem);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        if (ctx->debugging)
            fprintf(ctx->log, "%s\n", "");
        
        bool read_res_56986;
        
        if ((err = gpu_scalar_from_device(ctx, &read_res_56986, mem_53724.mem, (int64_t) 0 * sizeof(bool), sizeof(bool))) != 0)
            goto cleanup;
        if (ctx->failure_is_an_option && futhark_context_sync(ctx) != 0) {
            err = 1;
            goto cleanup;
        }
        
        bool defunc_0_reduce_res_45363 = read_res_56986;
        bool loop_cond_44089 = !defunc_0_reduce_res_45363;
        
        if (memblock_set_device(ctx, &mem_param_tmp_55428, &ext_mem_53722, "ext_mem_53722") != 0)
            return 1;
        
        bool loop_while_tmp_55429 = loop_cond_44089;
        
        if (memblock_set_device(ctx, &mem_param_53649, &mem_param_tmp_55428, "mem_param_tmp_55428") != 0)
            return 1;
        loop_while_44003 = loop_while_tmp_55429;
    }
    if (memblock_set_device(ctx, &ext_mem_53727, &mem_param_53649, "mem_param_53649") != 0)
        return 1;
    cluster_heads_44001 = loop_while_44003;
    if (memblock_unref_device(ctx, &mem_53646, "mem_53646") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_53724, "mem_53724") != 0)
        return 1;
    
    int64_t num_tblocks_47322;
    int64_t max_num_tblocks_55567;
    
    max_num_tblocks_55567 = *ctx->tuning_params.do_DBSCAN_doublezisegscan_num_tblocks_47321;
    num_tblocks_47322 = sext_i64_i32(smax64((int64_t) 1, smin64(sdiv_up64(conc_tmp_43977, segscan_tblock_sizze_47320), max_num_tblocks_55567)));
    if (memblock_alloc_device(ctx, &mem_53730, bytes_53634, "mem_53730")) {
        err = 1;
        goto cleanup;
    }
    if (slt64((int64_t) 0, conc_tmp_43977)) {
        if (ctx->debugging)
            fprintf(ctx->log, "%s\n", "\n# SegScan");
        
        int64_t shared_memory_55568;
        
        shared_memory_55568 = ctx->max_shared_memory;
        
        int64_t thread_block_sizze_55569;
        
        thread_block_sizze_55569 = ctx->max_thread_block_size;
        
        int64_t registers_55570;
        
        registers_55570 = ctx->max_registers;
        
        int64_t thread_block_sizze_55571;
        
        thread_block_sizze_55571 = ctx->max_thread_block_size;
        
        int64_t chunk_sizze_55572 = smax64((int64_t) 1, smin64(squot64(squot64(shared_memory_55568, thread_block_sizze_55569), (int64_t) 8), squot64(squot64(registers_55570, thread_block_sizze_55571) - (int64_t) 1 - squot64(smax64((int64_t) 4, (int64_t) 8), (int64_t) 4), (int64_t) 2 * squot64(smax64((int64_t) 4, (int64_t) 8), (int64_t) 4))));
        int64_t num_virt_blocks_55573 = sdiv_up64(conc_tmp_43977, segscan_tblock_sizze_47320 * chunk_sizze_55572);
        int64_t num_virt_threads_55574 = num_virt_blocks_55573 * segscan_tblock_sizze_47320;
        
        if (ctx->debugging)
            fprintf(ctx->log, "%s: %llu%c", "Sequential elements per thread (chunk)", (long long) chunk_sizze_55572, '\n');
        if (memblock_alloc_device(ctx, &status_flags_mem_55575, num_virt_blocks_55573, "status_flags_mem_55575")) {
            err = 1;
            goto cleanup;
        }
        if (futrts_builtinzhreplicate_i8(ctx, status_flags_mem_55575, num_virt_blocks_55573, (int8_t) 0) != 0) {
            err = 1;
            goto cleanup;
        }
        if (memblock_alloc_device(ctx, &aggregates_mem_55577, (int64_t) 8 * num_virt_blocks_55573, "aggregates_mem_55577")) {
            err = 1;
            goto cleanup;
        }
        if (memblock_alloc_device(ctx, &incprefixes_mem_55579, (int64_t) 8 * num_virt_blocks_55573, "incprefixes_mem_55579")) {
            err = 1;
            goto cleanup;
        }
        {
            err = gpu_kernel_do_DBSCAN_doublezisegscan_47325(ctx, num_tblocks_47322, 1, 1, *ctx->tuning_params.do_DBSCAN_doublezisegscan_tblock_sizze_47319, 1, 1, smax64(smax64((int64_t) 288, (int64_t) 8 * segscan_tblock_sizze_47320), chunk_sizze_55572 * segscan_tblock_sizze_47320 * (int64_t) 8) + srem64((int64_t) 8 - srem64(smax64(smax64((int64_t) 288, (int64_t) 8 * segscan_tblock_sizze_47320), chunk_sizze_55572 * segscan_tblock_sizze_47320 * (int64_t) 8), (int64_t) 8), (int64_t) 8), conc_tmp_43977, num_tblocks_47322, num_virt_blocks_55573, num_virt_threads_55574, ext_mem_53727.mem, mem_53730.mem, status_flags_mem_55575.mem, aggregates_mem_55577.mem, incprefixes_mem_55579.mem, global_dynid_mem_55581.mem);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        if (ctx->debugging)
            fprintf(ctx->log, "%s\n", "");
    }
    
    int64_t segmap_usable_groups_47342 = sdiv_up64(conc_tmp_43977, segmap_tblock_sizze_47341);
    
    if (memblock_alloc_device(ctx, &mem_53733, bytes_53634, "mem_53733")) {
        err = 1;
        goto cleanup;
    }
    if (ctx->debugging)
        fprintf(ctx->log, "%s\n", "\n# SegMap");
    
    int32_t virt_num_tblocks_55670 = sext_i64_i32(sdiv_up64(conc_tmp_43977, segmap_tblock_sizze_47341));
    
    {
        err = gpu_kernel_do_DBSCAN_doublezisegmap_47345(ctx, segmap_usable_groups_47342, 1, 1, *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_47329, 1, 1, (int64_t) 0, conc_tmp_43977, mem_53730.mem, mem_53733.mem);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (ctx->debugging)
        fprintf(ctx->log, "%s\n", "");
    if (memblock_unref_device(ctx, &mem_53730, "mem_53730") != 0)
        return 1;
    
    int64_t segmap_usable_groups_47373 = sdiv_up_safe64(conc_tmp_43977, segmap_tblock_sizze_47372);
    
    if (memblock_set_device(ctx, &mem_param_53736, &mem_53644, "mem_53644") != 0)
        return 1;
    for (int64_t i_44125 = 0; i_44125 < max_iter_44120; i_44125++) {
        int64_t inf_44127 = mul64(max_res_44114, i_44125);
        int64_t min_arg1_44128 = add64(max_res_44114, inf_44127);
        int64_t min_res_44129 = smin64(conc_tmp_43977, min_arg1_44128);
        
        if (memblock_alloc_device(ctx, &mem_53739, bytes_53634, "mem_53739")) {
            err = 1;
            goto cleanup;
        }
        if (ctx->debugging)
            fprintf(ctx->log, "%s\n", "\n# SegMap");
        
        int32_t virt_num_tblocks_55681 = sext_i64_i32(sdiv_up64(conc_tmp_43977, segmap_tblock_sizze_47372));
        
        {
            err = gpu_kernel_do_DBSCAN_doublezisegmap_47376(ctx, segmap_usable_groups_47373, 1, 1, *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_47355, 1, 1, (int64_t) 0, conc_tmp_43977, inf_44127, min_res_44129, ext_mem_53727.mem, mem_53733.mem, mem_param_53736.mem, mem_53739.mem);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        ctx->failure_is_an_option = 1;
        if (ctx->debugging)
            fprintf(ctx->log, "%s\n", "");
        if (memblock_set_device(ctx, &mem_param_tmp_55679, &mem_53739, "mem_53739") != 0)
            return 1;
        if (memblock_set_device(ctx, &mem_param_53736, &mem_param_tmp_55679, "mem_param_tmp_55679") != 0)
            return 1;
    }
    if (memblock_set_device(ctx, &ext_mem_53742, &mem_param_53736, "mem_param_53736") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_53644, "mem_53644") != 0)
        return 1;
    if (memblock_unref_device(ctx, &ext_mem_53727, "ext_mem_53727") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_53733, "mem_53733") != 0)
        return 1;
    
    int64_t segmap_usable_groups_47400 = sdiv_up64(conc_tmp_43977, segmap_tblock_sizze_47399);
    
    if (memblock_alloc_device(ctx, &mem_53745, bytes_53634, "mem_53745")) {
        err = 1;
        goto cleanup;
    }
    if (ctx->debugging)
        fprintf(ctx->log, "%s\n", "\n# SegMap");
    
    int32_t virt_num_tblocks_55690 = sext_i64_i32(sdiv_up64(conc_tmp_43977, segmap_tblock_sizze_47399));
    
    {
        err = gpu_kernel_do_DBSCAN_doublezisegmap_47403(ctx, segmap_usable_groups_47400, 1, 1, *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_47391, 1, 1, (int64_t) 0, clProc_36824, conc_tmp_43977, ext_mem_53742.mem, mem_53745.mem);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (ctx->debugging)
        fprintf(ctx->log, "%s\n", "");
    if (memblock_unref_device(ctx, &ext_mem_53742, "ext_mem_53742") != 0)
        return 1;
    if (memblock_alloc_device(ctx, &mem_53747, bytes_53641, "mem_53747")) {
        err = 1;
        goto cleanup;
    }
    if ((err = lmad_copy_gpu2gpu_8b(ctx, 1, mem_53747.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, mem_53745.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, (int64_t []) {m_44164})) != 0)
        goto cleanup;
    
    int64_t num_tblocks_47412;
    int64_t max_num_tblocks_55699;
    
    max_num_tblocks_55699 = *ctx->tuning_params.do_DBSCAN_doublezisegmap_num_tblocks_47411;
    num_tblocks_47412 = sext_i64_i32(smax64((int64_t) 1, smin64(sdiv_up64(conc_tmp_43977, segmap_tblock_sizze_47410), max_num_tblocks_55699)));
    if (ctx->debugging)
        fprintf(ctx->log, "%s\n", "\n# SegMap");
    
    int32_t virt_num_tblocks_55700 = sext_i64_i32(sdiv_up64(conc_tmp_43977, segmap_tblock_sizze_47410));
    
    {
        err = gpu_kernel_do_DBSCAN_doublezisegmap_47407(ctx, num_tblocks_47412, 1, 1, *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_47409, 1, 1, (int64_t) 0, m_43906, conc_tmp_43977, m_44164, num_tblocks_47412, virt_num_tblocks_55700, mem_53610.mem, mem_53628.mem, mem_53638.mem, mem_53640.mem, mem_53642.mem, mem_53745.mem, mem_53747.mem);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (ctx->debugging)
        fprintf(ctx->log, "%s\n", "");
    if (memblock_unref_device(ctx, &mem_53638, "mem_53638") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_53640, "mem_53640") != 0)
        return 1;
    
    bool suff_outer_screma_47444;
    
    suff_outer_screma_47444 = *ctx->tuning_params.do_DBSCAN_doublezisuff_outer_screma_1 <= m_44164;
    if (ctx->logging)
        fprintf(ctx->log, "Compared %s <= %ld: %s.\n", "do_DBSCAN_double.suff_outer_screma_1", (long) m_44164, suff_outer_screma_47444 ? "true" : "false");
    
    bool suff_outer_par_47714;
    
    suff_outer_par_47714 = *ctx->tuning_params.do_DBSCAN_doublezisuff_outer_par_2 <= m_44164;
    if (ctx->logging)
        fprintf(ctx->log, "Compared %s <= %ld: %s.\n", "do_DBSCAN_double.suff_outer_par_2", (long) m_44164, suff_outer_par_47714 ? "true" : "false");
    
    int64_t num_tblocks_47808;
    int64_t max_num_tblocks_55713;
    
    max_num_tblocks_55713 = *ctx->tuning_params.do_DBSCAN_doublezisegscan_num_tblocks_47708;
    num_tblocks_47808 = sext_i64_i32(smax64((int64_t) 1, smin64(sdiv_up64(m_44164, segscan_tblock_sizze_47807), max_num_tblocks_55713)));
    
    int64_t num_tblocks_47455;
    int64_t max_num_tblocks_55714;
    
    max_num_tblocks_55714 = *ctx->tuning_params.do_DBSCAN_doublezisegscan_num_tblocks_47448;
    num_tblocks_47455 = sext_i64_i32(smax64((int64_t) 1, smin64(sdiv_up64(m_44164, segscan_tblock_sizze_47454), max_num_tblocks_55714)));
    
    int64_t ldim_50562 = sdiv_up_safe64(m_44164, tile_sizze_50561);
    int64_t num_whole_tiles_50582 = squot_safe64(m_44164, tile_sizze_50561);
    int64_t residual_input_50796 = srem_safe64(m_44164, tile_sizze_50561);
    bool cond_50797 = residual_input_50796 == (int64_t) 0;
    int64_t ldim_50207 = sdiv_up_safe64(m_44164, tile_sizze_50206);
    int64_t num_whole_tiles_50227 = squot_safe64(m_44164, tile_sizze_50206);
    int64_t residual_input_50441 = srem_safe64(m_44164, tile_sizze_50206);
    bool cond_50442 = residual_input_50441 == (int64_t) 0;
    int64_t binop_x_50813 = tile_sizze_50561 * num_whole_tiles_50582;
    int64_t binop_x_50458 = tile_sizze_50206 * num_whole_tiles_50227;
    int64_t bytes_53773 = (int64_t) 8 * tile_sizze_50561;
    int64_t bytes_53835 = (int64_t) 8 * tile_sizze_50206;
    int64_t shared_memory_capacity_55870;
    
    shared_memory_capacity_55870 = ctx->max_shared_memory;
    if (suff_outer_par_47714 && sle64(sdiv_up64(bytes_53835, (int64_t) 8) * (int64_t) 8 + sdiv_up64(bytes_53835, (int64_t) 8) * (int64_t) 8 + sdiv_up64(bytes_53835, (int64_t) 8) * (int64_t) 8, shared_memory_capacity_55870)) {
        if (memblock_alloc_device(ctx, &mem_53872, bytes_53641, "mem_53872")) {
            err = 1;
            goto cleanup;
        }
        if (ctx->debugging)
            fprintf(ctx->log, "%s\n", "\n# SegMap");
        
        int32_t num_chunks_55820 = sext_i64_i32(sdiv_up64(tile_sizze_50206, tile_sizze_50206));
        int32_t virt_num_tblocks_55821 = sext_i64_i32(ldim_50207);
        
        {
            err = gpu_kernel_do_DBSCAN_doublezisegmap_intrablock_50204(ctx, ldim_50207, 1, 1, *ctx->tuning_params.do_DBSCAN_doublezitile_sizze_50205, 1, 1, bytes_53835 + srem64((int64_t) 8 - srem64(bytes_53835, (int64_t) 8), (int64_t) 8) + (bytes_53835 + srem64((int64_t) 8 - srem64(bytes_53835, (int64_t) 8), (int64_t) 8)) + (bytes_53835 + srem64((int64_t) 8 - srem64(bytes_53835, (int64_t) 8), (int64_t) 8)), m_44164, ldim_50207, num_whole_tiles_50227, residual_input_50441, cond_50442, binop_x_50458, mem_53642.mem, mem_53747.mem, mem_53872.mem);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        if (ctx->debugging)
            fprintf(ctx->log, "%s\n", "");
        if (memblock_set_device(ctx, &ext_mem_53873, &mem_53872, "mem_53872") != 0)
            return 1;
    } else {
        if (memblock_alloc_device(ctx, &mem_53810, bytes_53641, "mem_53810")) {
            err = 1;
            goto cleanup;
        }
        if (ctx->debugging)
            fprintf(ctx->log, "%s\n", "\n# SegMap");
        
        int32_t num_chunks_55845 = sext_i64_i32(sdiv_up64(tile_sizze_50561, tile_sizze_50561));
        int32_t virt_num_tblocks_55846 = sext_i64_i32(ldim_50562);
        
        {
            err = gpu_kernel_do_DBSCAN_doublezisegmap_intrablock_50559(ctx, ldim_50562, 1, 1, *ctx->tuning_params.do_DBSCAN_doublezitile_sizze_50560, 1, 1, bytes_53773 + srem64((int64_t) 8 - srem64(bytes_53773, (int64_t) 8), (int64_t) 8) + (bytes_53773 + srem64((int64_t) 8 - srem64(bytes_53773, (int64_t) 8), (int64_t) 8)) + (bytes_53773 + srem64((int64_t) 8 - srem64(bytes_53773, (int64_t) 8), (int64_t) 8)), m_44164, ldim_50562, num_whole_tiles_50582, residual_input_50796, cond_50797, binop_x_50813, mem_53642.mem, mem_53747.mem, mem_53810.mem);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        if (ctx->debugging)
            fprintf(ctx->log, "%s\n", "");
        if (memblock_set_device(ctx, &ext_mem_53873, &mem_53810, "mem_53810") != 0)
            return 1;
    }
    if (memblock_alloc_device(ctx, &mem_53875, bytes_53641, "mem_53875")) {
        err = 1;
        goto cleanup;
    }
    if ((err = lmad_copy_gpu2gpu_8b(ctx, 1, mem_53875.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, ext_mem_53873.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, (int64_t []) {m_44164})) != 0)
        goto cleanup;
    if (memblock_alloc_device(ctx, &mem_53878, bytes_53641, "mem_53878")) {
        err = 1;
        goto cleanup;
    }
    if (slt64((int64_t) 0, m_44164)) {
        if (ctx->debugging)
            fprintf(ctx->log, "%s\n", "\n# SegScan");
        
        int64_t shared_memory_55871;
        
        shared_memory_55871 = ctx->max_shared_memory;
        
        int64_t thread_block_sizze_55872;
        
        thread_block_sizze_55872 = ctx->max_thread_block_size;
        
        int64_t registers_55873;
        
        registers_55873 = ctx->max_registers;
        
        int64_t thread_block_sizze_55874;
        
        thread_block_sizze_55874 = ctx->max_thread_block_size;
        
        int64_t chunk_sizze_55875 = smax64((int64_t) 1, smin64(squot64(squot64(shared_memory_55871, thread_block_sizze_55872), (int64_t) 8), squot64(squot64(registers_55873, thread_block_sizze_55874) - (int64_t) 1 - squot64(smax64((int64_t) 4, (int64_t) 8), (int64_t) 4), (int64_t) 2 * squot64(smax64((int64_t) 4, (int64_t) 8), (int64_t) 4))));
        int64_t num_virt_blocks_55876 = sdiv_up64(m_44164, segscan_tblock_sizze_47807 * chunk_sizze_55875);
        int64_t num_virt_threads_55877 = num_virt_blocks_55876 * segscan_tblock_sizze_47807;
        
        if (ctx->debugging)
            fprintf(ctx->log, "%s: %llu%c", "Sequential elements per thread (chunk)", (long long) chunk_sizze_55875, '\n');
        if (memblock_alloc_device(ctx, &status_flags_mem_55878, num_virt_blocks_55876, "status_flags_mem_55878")) {
            err = 1;
            goto cleanup;
        }
        if (futrts_builtinzhreplicate_i8(ctx, status_flags_mem_55878, num_virt_blocks_55876, (int8_t) 0) != 0) {
            err = 1;
            goto cleanup;
        }
        if (memblock_alloc_device(ctx, &aggregates_mem_55880, (int64_t) 8 * num_virt_blocks_55876, "aggregates_mem_55880")) {
            err = 1;
            goto cleanup;
        }
        if (memblock_alloc_device(ctx, &incprefixes_mem_55882, (int64_t) 8 * num_virt_blocks_55876, "incprefixes_mem_55882")) {
            err = 1;
            goto cleanup;
        }
        {
            err = gpu_kernel_do_DBSCAN_doublezisegscan_47812(ctx, num_tblocks_47808, 1, 1, *ctx->tuning_params.do_DBSCAN_doublezisegscan_tblock_sizze_47706, 1, 1, smax64(smax64((int64_t) 288, (int64_t) 8 * segscan_tblock_sizze_47807), chunk_sizze_55875 * segscan_tblock_sizze_47807 * (int64_t) 8) + srem64((int64_t) 8 - srem64(smax64(smax64((int64_t) 288, (int64_t) 8 * segscan_tblock_sizze_47807), chunk_sizze_55875 * segscan_tblock_sizze_47807 * (int64_t) 8), (int64_t) 8), (int64_t) 8), m_44164, num_tblocks_47808, num_virt_blocks_55876, num_virt_threads_55877, ext_mem_53873.mem, mem_53878.mem, status_flags_mem_55878.mem, aggregates_mem_55880.mem, incprefixes_mem_55882.mem, global_dynid_mem_55884.mem);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        if (ctx->debugging)
            fprintf(ctx->log, "%s\n", "");
    }
    if (memblock_unref_device(ctx, &ext_mem_53873, "ext_mem_53873") != 0)
        return 1;
    if (memblock_set_device(ctx, &ext_mem_53885, &mem_53878, "mem_53878") != 0)
        return 1;
    if (memblock_set_device(ctx, &ext_mem_53884, &mem_53875, "mem_53875") != 0)
        return 1;
    
    int64_t m_f_res_44252;
    
    if (x_44247) {
        int64_t read_res_56987;
        
        if ((err = gpu_scalar_from_device(ctx, &read_res_56987, ext_mem_53885.mem, m_44174 * sizeof(int64_t), sizeof(int64_t))) != 0)
            goto cleanup;
        if (ctx->failure_is_an_option && futhark_context_sync(ctx) != 0) {
            err = 1;
            goto cleanup;
        }
        
        int64_t x_45375 = read_res_56987;
        
        m_f_res_44252 = x_45375;
    } else {
        m_f_res_44252 = (int64_t) 0;
    }
    
    int64_t m_44254;
    
    if (empty_slice_44173) {
        m_44254 = (int64_t) 0;
    } else {
        m_44254 = m_f_res_44252;
    }
    
    int64_t m_44264 = sub64(m_44254, (int64_t) 1);
    bool i_p_m_t_s_leq_w_44266 = slt64(m_44264, m_44164);
    bool zzero_leq_i_p_m_t_s_44265 = sle64((int64_t) 0, m_44264);
    bool y_44268 = zzero_leq_i_p_m_t_s_44265 && i_p_m_t_s_leq_w_44266;
    bool i_lte_j_44267 = sle64((int64_t) 0, m_44254);
    bool forwards_ok_44269 = i_lte_j_44267 && y_44268;
    bool eq_x_zz_44261 = (int64_t) 0 == m_f_res_44252;
    bool p_and_eq_x_y_44262 = x_44247 && eq_x_zz_44261;
    bool empty_slice_44263 = empty_slice_44173 || p_and_eq_x_y_44262;
    bool ok_or_empty_44270 = empty_slice_44263 || forwards_ok_44269;
    bool index_certs_44271;
    
    if (!ok_or_empty_44270) {
        set_error(ctx, msgprintf("Error: %s%lld%s%lld%s\n\nBacktrace:\n%s", "Index [:", (long long) m_44254, "] out of bounds for array of shape [", (long long) m_44164, "].", "-> #0  /prelude/soacs.fut:258:29-35\n   #1  /prelude/functional.fut:9:44-45\n   #2  ft_libs/ftDBSCAN_plus.fut:890:18-893:67\n   #3  ft_libs/ftDBSCAN_plus.fut:889:9-893:67\n"));
        err = FUTHARK_PROGRAM_ERROR;
        goto cleanup;
    }
    
    int64_t bytes_53886 = (int64_t) 8 * m_44254;
    
    if (memblock_alloc_device(ctx, &mem_53887, bytes_53886, "mem_53887")) {
        err = 1;
        goto cleanup;
    }
    if ((err = lmad_copy_gpu2gpu_8b(ctx, 1, mem_53887.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, mem_53642.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, (int64_t []) {m_44254})) != 0)
        goto cleanup;
    if (memblock_alloc_device(ctx, &mem_53889, bytes_53886, "mem_53889")) {
        err = 1;
        goto cleanup;
    }
    if ((err = lmad_copy_gpu2gpu_8b(ctx, 1, mem_53889.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, mem_53747.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, (int64_t []) {m_44254})) != 0)
        goto cleanup;
    
    int64_t num_tblocks_47825;
    int64_t max_num_tblocks_55973;
    
    max_num_tblocks_55973 = *ctx->tuning_params.do_DBSCAN_doublezisegmap_num_tblocks_47824;
    num_tblocks_47825 = sext_i64_i32(smax64((int64_t) 1, smin64(sdiv_up64(m_44164, segmap_tblock_sizze_47823), max_num_tblocks_55973)));
    if (ctx->debugging)
        fprintf(ctx->log, "%s\n", "\n# SegMap");
    
    int32_t virt_num_tblocks_55974 = sext_i64_i32(sdiv_up64(m_44164, segmap_tblock_sizze_47823));
    
    {
        err = gpu_kernel_do_DBSCAN_doublezisegmap_47820(ctx, num_tblocks_47825, 1, 1, *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_47822, 1, 1, (int64_t) 0, m_44164, m_44254, num_tblocks_47825, virt_num_tblocks_55974, mem_53642.mem, mem_53747.mem, ext_mem_53884.mem, ext_mem_53885.mem, mem_53887.mem, mem_53889.mem);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (ctx->debugging)
        fprintf(ctx->log, "%s\n", "");
    if (memblock_unref_device(ctx, &mem_53642, "mem_53642") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_53747, "mem_53747") != 0)
        return 1;
    if (memblock_unref_device(ctx, &ext_mem_53884, "ext_mem_53884") != 0)
        return 1;
    if (memblock_unref_device(ctx, &ext_mem_53885, "ext_mem_53885") != 0)
        return 1;
    
    bool suff_outer_screma_47828;
    
    suff_outer_screma_47828 = *ctx->tuning_params.do_DBSCAN_doublezisuff_outer_screma_3 <= conc_tmp_43977;
    if (ctx->logging)
        fprintf(ctx->log, "Compared %s <= %ld: %s.\n", "do_DBSCAN_double.suff_outer_screma_3", (long) conc_tmp_43977, suff_outer_screma_47828 ? "true" : "false");
    
    bool suff_outer_par_48045;
    
    suff_outer_par_48045 = *ctx->tuning_params.do_DBSCAN_doublezisuff_outer_par_4 <= conc_tmp_43977;
    if (ctx->logging)
        fprintf(ctx->log, "Compared %s <= %ld: %s.\n", "do_DBSCAN_double.suff_outer_par_4", (long) conc_tmp_43977, suff_outer_par_48045 ? "true" : "false");
    
    int64_t num_tblocks_48121;
    int64_t max_num_tblocks_55987;
    
    max_num_tblocks_55987 = *ctx->tuning_params.do_DBSCAN_doublezisegscan_num_tblocks_48039;
    num_tblocks_48121 = sext_i64_i32(smax64((int64_t) 1, smin64(sdiv_up64(conc_tmp_43977, segscan_tblock_sizze_48120), max_num_tblocks_55987)));
    
    int64_t num_tblocks_47839;
    int64_t max_num_tblocks_55988;
    
    max_num_tblocks_55988 = *ctx->tuning_params.do_DBSCAN_doublezisegscan_num_tblocks_47832;
    num_tblocks_47839 = sext_i64_i32(smax64((int64_t) 1, smin64(sdiv_up64(conc_tmp_43977, segscan_tblock_sizze_47838), max_num_tblocks_55988)));
    
    int64_t ldim_51196 = sdiv_up_safe64(conc_tmp_43977, tile_sizze_51195);
    int64_t num_whole_tiles_51210 = squot_safe64(m_44254, tile_sizze_51195);
    int64_t residual_input_51369 = srem_safe64(m_44254, tile_sizze_51195);
    bool cond_51370 = residual_input_51369 == (int64_t) 0;
    int64_t ldim_50917 = sdiv_up_safe64(conc_tmp_43977, tile_sizze_50916);
    int64_t num_whole_tiles_50931 = squot_safe64(m_44254, tile_sizze_50916);
    int64_t residual_input_51090 = srem_safe64(m_44254, tile_sizze_50916);
    bool cond_51091 = residual_input_51090 == (int64_t) 0;
    int64_t binop_x_51383 = tile_sizze_51195 * num_whole_tiles_51210;
    int64_t binop_x_51104 = tile_sizze_50916 * num_whole_tiles_50931;
    int64_t bytes_53906 = (int64_t) 8 * tile_sizze_51195;
    int64_t bytes_53956 = (int64_t) 8 * tile_sizze_50916;
    int64_t shared_memory_capacity_56137;
    
    shared_memory_capacity_56137 = ctx->max_shared_memory;
    if (suff_outer_par_48045 && sle64(sdiv_up64(bytes_53956, (int64_t) 8) * (int64_t) 8 + sdiv_up64(bytes_53956, (int64_t) 8) * (int64_t) 8, shared_memory_capacity_56137)) {
        if (memblock_alloc_device(ctx, &mem_53988, bytes_53634, "mem_53988")) {
            err = 1;
            goto cleanup;
        }
        if (memblock_alloc_device(ctx, &mem_53990, bytes_53634, "mem_53990")) {
            err = 1;
            goto cleanup;
        }
        if (ctx->debugging)
            fprintf(ctx->log, "%s\n", "\n# SegMap");
        
        int32_t num_chunks_56093 = sext_i64_i32(sdiv_up64(tile_sizze_50916, tile_sizze_50916));
        int32_t virt_num_tblocks_56094 = sext_i64_i32(ldim_50917);
        
        {
            err = gpu_kernel_do_DBSCAN_doublezisegmap_intrablock_50914(ctx, ldim_50917, 1, 1, *ctx->tuning_params.do_DBSCAN_doublezitile_sizze_50915, 1, 1, bytes_53956 + srem64((int64_t) 8 - srem64(bytes_53956, (int64_t) 8), (int64_t) 8) + (bytes_53956 + srem64((int64_t) 8 - srem64(bytes_53956, (int64_t) 8), (int64_t) 8)), clProc_36824, m_43906, conc_tmp_43977, m_44254, ldim_50917, num_whole_tiles_50931, residual_input_51090, cond_51091, binop_x_51104, mem_53610.mem, mem_53628.mem, mem_53745.mem, mem_53887.mem, mem_53889.mem, mem_53988.mem, mem_53990.mem);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        if (ctx->debugging)
            fprintf(ctx->log, "%s\n", "");
        if (memblock_set_device(ctx, &ext_mem_53992, &mem_53988, "mem_53988") != 0)
            return 1;
        if (memblock_set_device(ctx, &ext_mem_53991, &mem_53990, "mem_53990") != 0)
            return 1;
    } else {
        if (memblock_alloc_device(ctx, &mem_53938, bytes_53634, "mem_53938")) {
            err = 1;
            goto cleanup;
        }
        if (memblock_alloc_device(ctx, &mem_53940, bytes_53634, "mem_53940")) {
            err = 1;
            goto cleanup;
        }
        if (ctx->debugging)
            fprintf(ctx->log, "%s\n", "\n# SegMap");
        
        int32_t num_chunks_56115 = sext_i64_i32(sdiv_up64(tile_sizze_51195, tile_sizze_51195));
        int32_t virt_num_tblocks_56116 = sext_i64_i32(ldim_51196);
        
        {
            err = gpu_kernel_do_DBSCAN_doublezisegmap_intrablock_51193(ctx, ldim_51196, 1, 1, *ctx->tuning_params.do_DBSCAN_doublezitile_sizze_51194, 1, 1, bytes_53906 + srem64((int64_t) 8 - srem64(bytes_53906, (int64_t) 8), (int64_t) 8) + (bytes_53906 + srem64((int64_t) 8 - srem64(bytes_53906, (int64_t) 8), (int64_t) 8)), clProc_36824, m_43906, conc_tmp_43977, m_44254, ldim_51196, num_whole_tiles_51210, residual_input_51369, cond_51370, binop_x_51383, mem_53610.mem, mem_53628.mem, mem_53745.mem, mem_53887.mem, mem_53889.mem, mem_53938.mem, mem_53940.mem);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        if (ctx->debugging)
            fprintf(ctx->log, "%s\n", "");
        if (memblock_set_device(ctx, &ext_mem_53992, &mem_53938, "mem_53938") != 0)
            return 1;
        if (memblock_set_device(ctx, &ext_mem_53991, &mem_53940, "mem_53940") != 0)
            return 1;
    }
    if (memblock_alloc_device(ctx, &mem_53994, bytes_53634, "mem_53994")) {
        err = 1;
        goto cleanup;
    }
    if ((err = lmad_copy_gpu2gpu_8b(ctx, 1, mem_53994.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, ext_mem_53992.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, (int64_t []) {conc_tmp_43977})) != 0)
        goto cleanup;
    if (memblock_alloc_device(ctx, &mem_53997, bytes_53634, "mem_53997")) {
        err = 1;
        goto cleanup;
    }
    if (slt64((int64_t) 0, conc_tmp_43977)) {
        if (ctx->debugging)
            fprintf(ctx->log, "%s\n", "\n# SegScan");
        
        int64_t shared_memory_56138;
        
        shared_memory_56138 = ctx->max_shared_memory;
        
        int64_t thread_block_sizze_56139;
        
        thread_block_sizze_56139 = ctx->max_thread_block_size;
        
        int64_t registers_56140;
        
        registers_56140 = ctx->max_registers;
        
        int64_t thread_block_sizze_56141;
        
        thread_block_sizze_56141 = ctx->max_thread_block_size;
        
        int64_t chunk_sizze_56142 = smax64((int64_t) 1, smin64(squot64(squot64(shared_memory_56138, thread_block_sizze_56139), (int64_t) 8), squot64(squot64(registers_56140, thread_block_sizze_56141) - (int64_t) 1 - squot64(smax64((int64_t) 4, (int64_t) 8), (int64_t) 4), (int64_t) 2 * squot64(smax64((int64_t) 4, (int64_t) 8), (int64_t) 4))));
        int64_t num_virt_blocks_56143 = sdiv_up64(conc_tmp_43977, segscan_tblock_sizze_48120 * chunk_sizze_56142);
        int64_t num_virt_threads_56144 = num_virt_blocks_56143 * segscan_tblock_sizze_48120;
        
        if (ctx->debugging)
            fprintf(ctx->log, "%s: %llu%c", "Sequential elements per thread (chunk)", (long long) chunk_sizze_56142, '\n');
        if (memblock_alloc_device(ctx, &status_flags_mem_56145, num_virt_blocks_56143, "status_flags_mem_56145")) {
            err = 1;
            goto cleanup;
        }
        if (futrts_builtinzhreplicate_i8(ctx, status_flags_mem_56145, num_virt_blocks_56143, (int8_t) 0) != 0) {
            err = 1;
            goto cleanup;
        }
        if (memblock_alloc_device(ctx, &aggregates_mem_56147, (int64_t) 8 * num_virt_blocks_56143, "aggregates_mem_56147")) {
            err = 1;
            goto cleanup;
        }
        if (memblock_alloc_device(ctx, &incprefixes_mem_56149, (int64_t) 8 * num_virt_blocks_56143, "incprefixes_mem_56149")) {
            err = 1;
            goto cleanup;
        }
        {
            err = gpu_kernel_do_DBSCAN_doublezisegscan_48125(ctx, num_tblocks_48121, 1, 1, *ctx->tuning_params.do_DBSCAN_doublezisegscan_tblock_sizze_48037, 1, 1, smax64(smax64((int64_t) 288, (int64_t) 8 * segscan_tblock_sizze_48120), chunk_sizze_56142 * segscan_tblock_sizze_48120 * (int64_t) 8) + srem64((int64_t) 8 - srem64(smax64(smax64((int64_t) 288, (int64_t) 8 * segscan_tblock_sizze_48120), chunk_sizze_56142 * segscan_tblock_sizze_48120 * (int64_t) 8), (int64_t) 8), (int64_t) 8), conc_tmp_43977, num_tblocks_48121, num_virt_blocks_56143, num_virt_threads_56144, ext_mem_53992.mem, mem_53997.mem, status_flags_mem_56145.mem, aggregates_mem_56147.mem, incprefixes_mem_56149.mem, global_dynid_mem_56151.mem);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        if (ctx->debugging)
            fprintf(ctx->log, "%s\n", "");
    }
    if (memblock_unref_device(ctx, &ext_mem_53992, "ext_mem_53992") != 0)
        return 1;
    if (memblock_set_device(ctx, &ext_mem_54007, &mem_53997, "mem_53997") != 0)
        return 1;
    if (memblock_set_device(ctx, &ext_mem_54006, &mem_53994, "mem_53994") != 0)
        return 1;
    if (memblock_set_device(ctx, &ext_mem_54005, &ext_mem_53991, "ext_mem_53991") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_53745, "mem_53745") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_53887, "mem_53887") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_53889, "mem_53889") != 0)
        return 1;
    
    int64_t m_f_res_44317;
    
    if (x_44155) {
        int64_t read_res_56988;
        
        if ((err = gpu_scalar_from_device(ctx, &read_res_56988, ext_mem_54007.mem, tmp_44156 * sizeof(int64_t), sizeof(int64_t))) != 0)
            goto cleanup;
        if (ctx->failure_is_an_option && futhark_context_sync(ctx) != 0) {
            err = 1;
            goto cleanup;
        }
        
        int64_t x_45379 = read_res_56988;
        
        m_f_res_44317 = x_45379;
    } else {
        m_f_res_44317 = (int64_t) 0;
    }
    
    int64_t m_44319;
    
    if (cond_44154) {
        m_44319 = (int64_t) 0;
    } else {
        m_44319 = m_f_res_44317;
    }
    
    int64_t m_44329 = sub64(m_44319, (int64_t) 1);
    bool i_p_m_t_s_leq_w_44331 = slt64(m_44329, conc_tmp_43977);
    bool zzero_leq_i_p_m_t_s_44330 = sle64((int64_t) 0, m_44329);
    bool y_44333 = zzero_leq_i_p_m_t_s_44330 && i_p_m_t_s_leq_w_44331;
    bool i_lte_j_44332 = sle64((int64_t) 0, m_44319);
    bool forwards_ok_44334 = i_lte_j_44332 && y_44333;
    bool eq_x_zz_44326 = (int64_t) 0 == m_f_res_44317;
    bool p_and_eq_x_y_44327 = x_44155 && eq_x_zz_44326;
    bool empty_slice_44328 = cond_44154 || p_and_eq_x_y_44327;
    bool ok_or_empty_44335 = empty_slice_44328 || forwards_ok_44334;
    bool index_certs_44336;
    
    if (!ok_or_empty_44335) {
        set_error(ctx, msgprintf("Error: %s%lld%s%lld%s\n\nBacktrace:\n%s", "Index [:", (long long) m_44319, "] out of bounds for array of shape [", (long long) conc_tmp_43977, "].", "-> #0  /prelude/soacs.fut:258:29-35\n   #1  /prelude/functional.fut:9:44-45\n   #2  ft_libs/ftDBSCAN_plus.fut:890:18-893:67\n   #3  ft_libs/ftDBSCAN_plus.fut:889:9-893:67\n"));
        err = FUTHARK_PROGRAM_ERROR;
        goto cleanup;
    }
    
    int64_t bytes_54093 = (int64_t) 8 * m_44319;
    
    if (memblock_alloc_device(ctx, &mem_54094, bytes_54093, "mem_54094")) {
        err = 1;
        goto cleanup;
    }
    if ((err = lmad_copy_gpu2gpu_8b(ctx, 1, mem_54094.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, ext_mem_54005.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, (int64_t []) {m_44319})) != 0)
        goto cleanup;
    if (memblock_alloc_device(ctx, &mem_54096, bytes_54093, "mem_54096")) {
        err = 1;
        goto cleanup;
    }
    if ((err = lmad_copy_gpu2gpu_8b(ctx, 1, mem_54096.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, mem_53635.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, (int64_t []) {m_44319})) != 0)
        goto cleanup;
    if (memblock_unref_device(ctx, &mem_53635, "mem_53635") != 0)
        return 1;
    
    int64_t num_tblocks_48463;
    int64_t max_num_tblocks_56240;
    
    max_num_tblocks_56240 = *ctx->tuning_params.do_DBSCAN_doublezisegmap_num_tblocks_48462;
    num_tblocks_48463 = sext_i64_i32(smax64((int64_t) 1, smin64(sdiv_up64(conc_tmp_43977, segmap_tblock_sizze_48461), max_num_tblocks_56240)));
    if (ctx->debugging)
        fprintf(ctx->log, "%s\n", "\n# SegMap");
    
    int32_t virt_num_tblocks_56241 = sext_i64_i32(sdiv_up64(conc_tmp_43977, segmap_tblock_sizze_48461));
    
    {
        err = gpu_kernel_do_DBSCAN_doublezisegmap_48458(ctx, num_tblocks_48463, 1, 1, *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_48460, 1, 1, (int64_t) 0, m_43906, conc_tmp_43977, m_44319, num_tblocks_48463, virt_num_tblocks_56241, mem_53610.mem, mem_53628.mem, ext_mem_54005.mem, ext_mem_54006.mem, ext_mem_54007.mem, mem_54094.mem, mem_54096.mem);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (ctx->debugging)
        fprintf(ctx->log, "%s\n", "");
    if (memblock_unref_device(ctx, &mem_53610, "mem_53610") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_53628, "mem_53628") != 0)
        return 1;
    if (memblock_unref_device(ctx, &ext_mem_54006, "ext_mem_54006") != 0)
        return 1;
    if (memblock_unref_device(ctx, &ext_mem_54007, "ext_mem_54007") != 0)
        return 1;
    
    bool suff_outer_screma_48466;
    
    suff_outer_screma_48466 = *ctx->tuning_params.do_DBSCAN_doublezisuff_outer_screma_6 <= m_44319;
    if (ctx->logging)
        fprintf(ctx->log, "Compared %s <= %ld: %s.\n", "do_DBSCAN_double.suff_outer_screma_6", (long) m_44319, suff_outer_screma_48466 ? "true" : "false");
    
    bool suff_outer_par_48786;
    
    suff_outer_par_48786 = *ctx->tuning_params.do_DBSCAN_doublezisuff_outer_par_7 <= m_44319;
    if (ctx->logging)
        fprintf(ctx->log, "Compared %s <= %ld: %s.\n", "do_DBSCAN_double.suff_outer_par_7", (long) m_44319, suff_outer_par_48786 ? "true" : "false");
    
    int64_t num_tblocks_48898;
    int64_t max_num_tblocks_56254;
    
    max_num_tblocks_56254 = *ctx->tuning_params.do_DBSCAN_doublezisegscan_num_tblocks_48780;
    num_tblocks_48898 = sext_i64_i32(smax64((int64_t) 1, smin64(sdiv_up64(m_44319, segscan_tblock_sizze_48897), max_num_tblocks_56254)));
    
    int64_t num_tblocks_48477;
    int64_t max_num_tblocks_56255;
    
    max_num_tblocks_56255 = *ctx->tuning_params.do_DBSCAN_doublezisegscan_num_tblocks_48470;
    num_tblocks_48477 = sext_i64_i32(smax64((int64_t) 1, smin64(sdiv_up64(m_44319, segscan_tblock_sizze_48476), max_num_tblocks_56255)));
    
    int64_t ldim_52266 = sdiv_up_safe64(m_44319, tile_sizze_52265);
    int64_t num_whole_tiles_52286 = squot_safe64(m_44319, tile_sizze_52265);
    int64_t residual_input_52518 = srem_safe64(m_44319, tile_sizze_52265);
    bool cond_52519 = residual_input_52518 == (int64_t) 0;
    int64_t ldim_51884 = sdiv_up_safe64(m_44319, tile_sizze_51883);
    int64_t num_whole_tiles_51904 = squot_safe64(m_44319, tile_sizze_51883);
    int64_t residual_input_52136 = srem_safe64(m_44319, tile_sizze_51883);
    bool cond_52137 = residual_input_52136 == (int64_t) 0;
    int64_t binop_x_52535 = tile_sizze_52265 * num_whole_tiles_52286;
    int64_t binop_x_52153 = tile_sizze_51883 * num_whole_tiles_51904;
    int64_t bytes_54122 = (int64_t) 8 * tile_sizze_52265;
    int64_t bytes_54194 = (int64_t) 8 * tile_sizze_51883;
    int64_t shared_memory_capacity_56411;
    
    shared_memory_capacity_56411 = ctx->max_shared_memory;
    if (suff_outer_par_48786 && sle64(sdiv_up64(bytes_54194, (int64_t) 8) * (int64_t) 8 + sdiv_up64(bytes_54194, (int64_t) 8) * (int64_t) 8 + sdiv_up64(bytes_54194, (int64_t) 8) * (int64_t) 8, shared_memory_capacity_56411)) {
        if (memblock_alloc_device(ctx, &mem_54241, bytes_54093, "mem_54241")) {
            err = 1;
            goto cleanup;
        }
        if (ctx->debugging)
            fprintf(ctx->log, "%s\n", "\n# SegMap");
        
        int32_t num_chunks_56361 = sext_i64_i32(sdiv_up64(tile_sizze_51883, tile_sizze_51883));
        int32_t virt_num_tblocks_56362 = sext_i64_i32(ldim_51884);
        
        {
            err = gpu_kernel_do_DBSCAN_doublezisegmap_intrablock_51881(ctx, ldim_51884, 1, 1, *ctx->tuning_params.do_DBSCAN_doublezitile_sizze_51882, 1, 1, bytes_54194 + srem64((int64_t) 8 - srem64(bytes_54194, (int64_t) 8), (int64_t) 8) + (bytes_54194 + srem64((int64_t) 8 - srem64(bytes_54194, (int64_t) 8), (int64_t) 8)) + (bytes_54194 + srem64((int64_t) 8 - srem64(bytes_54194, (int64_t) 8), (int64_t) 8)), m_44319, ldim_51884, num_whole_tiles_51904, residual_input_52136, cond_52137, binop_x_52153, mem_54094.mem, mem_54096.mem, mem_54241.mem);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        if (ctx->debugging)
            fprintf(ctx->log, "%s\n", "");
        if (memblock_set_device(ctx, &ext_mem_54242, &mem_54241, "mem_54241") != 0)
            return 1;
    } else {
        if (memblock_alloc_device(ctx, &mem_54169, bytes_54093, "mem_54169")) {
            err = 1;
            goto cleanup;
        }
        if (ctx->debugging)
            fprintf(ctx->log, "%s\n", "\n# SegMap");
        
        int32_t num_chunks_56386 = sext_i64_i32(sdiv_up64(tile_sizze_52265, tile_sizze_52265));
        int32_t virt_num_tblocks_56387 = sext_i64_i32(ldim_52266);
        
        {
            err = gpu_kernel_do_DBSCAN_doublezisegmap_intrablock_52263(ctx, ldim_52266, 1, 1, *ctx->tuning_params.do_DBSCAN_doublezitile_sizze_52264, 1, 1, bytes_54122 + srem64((int64_t) 8 - srem64(bytes_54122, (int64_t) 8), (int64_t) 8) + (bytes_54122 + srem64((int64_t) 8 - srem64(bytes_54122, (int64_t) 8), (int64_t) 8)) + (bytes_54122 + srem64((int64_t) 8 - srem64(bytes_54122, (int64_t) 8), (int64_t) 8)), m_44319, ldim_52266, num_whole_tiles_52286, residual_input_52518, cond_52519, binop_x_52535, mem_54094.mem, mem_54096.mem, mem_54169.mem);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        if (ctx->debugging)
            fprintf(ctx->log, "%s\n", "");
        if (memblock_set_device(ctx, &ext_mem_54242, &mem_54169, "mem_54169") != 0)
            return 1;
    }
    if (memblock_alloc_device(ctx, &mem_54244, bytes_54093, "mem_54244")) {
        err = 1;
        goto cleanup;
    }
    if ((err = lmad_copy_gpu2gpu_8b(ctx, 1, mem_54244.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, ext_mem_54242.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, (int64_t []) {m_44319})) != 0)
        goto cleanup;
    if (memblock_alloc_device(ctx, &mem_54247, bytes_54093, "mem_54247")) {
        err = 1;
        goto cleanup;
    }
    if (slt64((int64_t) 0, m_44319)) {
        if (ctx->debugging)
            fprintf(ctx->log, "%s\n", "\n# SegScan");
        
        int64_t shared_memory_56412;
        
        shared_memory_56412 = ctx->max_shared_memory;
        
        int64_t thread_block_sizze_56413;
        
        thread_block_sizze_56413 = ctx->max_thread_block_size;
        
        int64_t registers_56414;
        
        registers_56414 = ctx->max_registers;
        
        int64_t thread_block_sizze_56415;
        
        thread_block_sizze_56415 = ctx->max_thread_block_size;
        
        int64_t chunk_sizze_56416 = smax64((int64_t) 1, smin64(squot64(squot64(shared_memory_56412, thread_block_sizze_56413), (int64_t) 8), squot64(squot64(registers_56414, thread_block_sizze_56415) - (int64_t) 1 - squot64(smax64((int64_t) 4, (int64_t) 8), (int64_t) 4), (int64_t) 2 * squot64(smax64((int64_t) 4, (int64_t) 8), (int64_t) 4))));
        int64_t num_virt_blocks_56417 = sdiv_up64(m_44319, segscan_tblock_sizze_48897 * chunk_sizze_56416);
        int64_t num_virt_threads_56418 = num_virt_blocks_56417 * segscan_tblock_sizze_48897;
        
        if (ctx->debugging)
            fprintf(ctx->log, "%s: %llu%c", "Sequential elements per thread (chunk)", (long long) chunk_sizze_56416, '\n');
        if (memblock_alloc_device(ctx, &status_flags_mem_56419, num_virt_blocks_56417, "status_flags_mem_56419")) {
            err = 1;
            goto cleanup;
        }
        if (futrts_builtinzhreplicate_i8(ctx, status_flags_mem_56419, num_virt_blocks_56417, (int8_t) 0) != 0) {
            err = 1;
            goto cleanup;
        }
        if (memblock_alloc_device(ctx, &aggregates_mem_56421, (int64_t) 8 * num_virt_blocks_56417, "aggregates_mem_56421")) {
            err = 1;
            goto cleanup;
        }
        if (memblock_alloc_device(ctx, &incprefixes_mem_56423, (int64_t) 8 * num_virt_blocks_56417, "incprefixes_mem_56423")) {
            err = 1;
            goto cleanup;
        }
        {
            err = gpu_kernel_do_DBSCAN_doublezisegscan_48902(ctx, num_tblocks_48898, 1, 1, *ctx->tuning_params.do_DBSCAN_doublezisegscan_tblock_sizze_48778, 1, 1, smax64(smax64((int64_t) 288, (int64_t) 8 * segscan_tblock_sizze_48897), chunk_sizze_56416 * segscan_tblock_sizze_48897 * (int64_t) 8) + srem64((int64_t) 8 - srem64(smax64(smax64((int64_t) 288, (int64_t) 8 * segscan_tblock_sizze_48897), chunk_sizze_56416 * segscan_tblock_sizze_48897 * (int64_t) 8), (int64_t) 8), (int64_t) 8), m_44319, num_tblocks_48898, num_virt_blocks_56417, num_virt_threads_56418, ext_mem_54242.mem, mem_54247.mem, status_flags_mem_56419.mem, aggregates_mem_56421.mem, incprefixes_mem_56423.mem, global_dynid_mem_56425.mem);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        if (ctx->debugging)
            fprintf(ctx->log, "%s\n", "");
    }
    if (memblock_unref_device(ctx, &ext_mem_54242, "ext_mem_54242") != 0)
        return 1;
    if (memblock_set_device(ctx, &ext_mem_54254, &mem_54247, "mem_54247") != 0)
        return 1;
    if (memblock_set_device(ctx, &ext_mem_54253, &mem_54244, "mem_54244") != 0)
        return 1;
    
    bool x_44402 = !empty_slice_44328;
    bool y_44403 = slt64(m_44329, m_44319);
    bool bounds_check_44404 = zzero_leq_i_p_m_t_s_44330 && y_44403;
    bool protect_assert_disj_44405 = empty_slice_44328 || bounds_check_44404;
    bool index_certs_44406;
    
    if (!protect_assert_disj_44405) {
        set_error(ctx, msgprintf("Error: %s%lld%s%lld%s\n\nBacktrace:\n%s", "Index [", (long long) m_44329, "] out of bounds for array of shape [", (long long) m_44319, "].", "-> #0  /prelude/soacs.fut:257:33-47\n   #1  /prelude/functional.fut:9:44-45\n   #2  ft_libs/ftDBSCAN_plus.fut:890:18-893:67\n   #3  ft_libs/ftDBSCAN_plus.fut:889:9-893:67\n"));
        err = FUTHARK_PROGRAM_ERROR;
        goto cleanup;
    }
    
    int64_t m_f_res_44407;
    
    if (x_44402) {
        int64_t read_res_56989;
        
        if ((err = gpu_scalar_from_device(ctx, &read_res_56989, ext_mem_54254.mem, m_44329 * sizeof(int64_t), sizeof(int64_t))) != 0)
            goto cleanup;
        if (ctx->failure_is_an_option && futhark_context_sync(ctx) != 0) {
            err = 1;
            goto cleanup;
        }
        
        int64_t x_45384 = read_res_56989;
        
        m_f_res_44407 = x_45384;
    } else {
        m_f_res_44407 = (int64_t) 0;
    }
    
    int64_t m_44409;
    
    if (empty_slice_44328) {
        m_44409 = (int64_t) 0;
    } else {
        m_44409 = m_f_res_44407;
    }
    
    int64_t m_44419 = sub64(m_44409, (int64_t) 1);
    bool i_p_m_t_s_leq_w_44421 = slt64(m_44419, m_44319);
    bool zzero_leq_i_p_m_t_s_44420 = sle64((int64_t) 0, m_44419);
    bool y_44423 = zzero_leq_i_p_m_t_s_44420 && i_p_m_t_s_leq_w_44421;
    bool i_lte_j_44422 = sle64((int64_t) 0, m_44409);
    bool forwards_ok_44424 = i_lte_j_44422 && y_44423;
    bool eq_x_zz_44416 = (int64_t) 0 == m_f_res_44407;
    bool p_and_eq_x_y_44417 = x_44402 && eq_x_zz_44416;
    bool empty_slice_44418 = empty_slice_44328 || p_and_eq_x_y_44417;
    bool ok_or_empty_44425 = empty_slice_44418 || forwards_ok_44424;
    bool index_certs_44426;
    
    if (!ok_or_empty_44425) {
        set_error(ctx, msgprintf("Error: %s%lld%s%lld%s\n\nBacktrace:\n%s", "Index [:", (long long) m_44409, "] out of bounds for array of shape [", (long long) m_44319, "].", "-> #0  /prelude/soacs.fut:258:29-35\n   #1  /prelude/functional.fut:9:44-45\n   #2  ft_libs/ftDBSCAN_plus.fut:890:18-893:67\n   #3  ft_libs/ftDBSCAN_plus.fut:889:9-893:67\n"));
        err = FUTHARK_PROGRAM_ERROR;
        goto cleanup;
    }
    
    int64_t bytes_54255 = (int64_t) 8 * m_44409;
    int64_t zm_lhs_44550 = add64(n_36798, max_res_44441);
    int64_t zs_lhs_44551 = sub64(zm_lhs_44550, (int64_t) 1);
    int64_t numIter2_44552 = sdiv64(zs_lhs_44551, max_res_44441);
    bool bounds_invalid_upwards_44554 = slt64(numIter2_44552, (int64_t) 0);
    bool valid_44555 = !bounds_invalid_upwards_44554;
    bool range_valid_c_44556;
    
    if (!valid_44555) {
        set_error(ctx, msgprintf("Error: %s%lld%s%lld%s%lld%s\n\nBacktrace:\n%s", "Range ", (long long) (int64_t) 0, "..", (long long) (int64_t) 1, "..<", (long long) numIter2_44552, " is invalid.", "-> #0  /prelude/array.fut:94:3-11\n   #1  ft_libs/ftDBSCAN_plus.fut:645:75-88\n   #2  ft_libs/ftDBSCAN_plus.fut:890:18-893:67\n   #3  ft_libs/ftDBSCAN_plus.fut:889:9-893:67\n"));
        err = FUTHARK_PROGRAM_ERROR;
        goto cleanup;
    }
    
    int64_t conc_tmp_44654 = dz2084U_36800 + m_44409;
    int64_t bytes_54343 = (int64_t) 8 * conc_tmp_44654;
    
    if (memblock_alloc_device(ctx, &mem_53549, dz2080U_36801, "mem_53549")) {
        err = 1;
        goto cleanup;
    }
    if ((err = lmad_copy_gpu2gpu_1b(ctx, 1, mem_53549.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, clProc_mem_53512.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, (int64_t []) {dz2080U_36801})) != 0)
        goto cleanup;
    if (memblock_alloc_device(ctx, &mem_53551, bytes_53550, "mem_53551")) {
        err = 1;
        goto cleanup;
    }
    if ((err = lmad_copy_gpu2gpu_8b(ctx, 1, mem_53551.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, clProc_mem_53513.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, (int64_t []) {dz2081U_36802})) != 0)
        goto cleanup;
    
    int64_t segmap_tblock_sizze_48157;
    
    segmap_tblock_sizze_48157 = *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_48136;
    
    int64_t segmap_tblock_sizze_48377;
    
    segmap_tblock_sizze_48377 = *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_48362;
    
    int64_t segred_tblock_sizze_48395;
    
    segred_tblock_sizze_48395 = *ctx->tuning_params.do_DBSCAN_doublezisegred_tblock_sizze_48304;
    
    int64_t tile_sizze_51474;
    
    tile_sizze_51474 = *ctx->tuning_params.do_DBSCAN_doublezitile_sizze_51473;
    
    int64_t segmap_tblock_sizze_48453;
    
    segmap_tblock_sizze_48453 = *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_48452;
    
    int64_t segmap_tblock_sizze_48913;
    
    segmap_tblock_sizze_48913 = *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_48912;
    if (memblock_alloc_device(ctx, &mem_53556, bytes_53534, "mem_53556")) {
        err = 1;
        goto cleanup;
    }
    if (futrts_builtinzhreplicate_i64(ctx, mem_53556, n_36798, (int64_t) -1) != 0) {
        err = 1;
        goto cleanup;
    }
    
    int64_t segmap_tblock_sizze_49115;
    
    segmap_tblock_sizze_49115 = *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_49100;
    
    int64_t segred_tblock_sizze_49133;
    
    segred_tblock_sizze_49133 = *ctx->tuning_params.do_DBSCAN_doublezisegred_tblock_sizze_49042;
    
    int64_t tile_sizze_52647;
    
    tile_sizze_52647 = *ctx->tuning_params.do_DBSCAN_doublezitile_sizze_52646;
    
    int64_t segred_tblock_sizze_49189;
    
    segred_tblock_sizze_49189 = *ctx->tuning_params.do_DBSCAN_doublezisegred_tblock_sizze_49188;
    
    int64_t num_tblocks_49191;
    int64_t max_num_tblocks_56514;
    
    max_num_tblocks_56514 = *ctx->tuning_params.do_DBSCAN_doublezisegred_num_tblocks_49190;
    num_tblocks_49191 = sext_i64_i32(smax64((int64_t) 1, smin64(sdiv_up64(n_36798, segred_tblock_sizze_49189), max_num_tblocks_56514)));
    
    int64_t segred_tblock_sizze_49199;
    
    segred_tblock_sizze_49199 = *ctx->tuning_params.do_DBSCAN_doublezisegred_tblock_sizze_49198;
    if (memblock_alloc_device(ctx, &mem_53557, (int64_t) 0, "mem_53557")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_53558, (int64_t) 0, "mem_53558")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_53559, (int64_t) 0, "mem_53559")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_53626, bytes_53604, "mem_53626")) {
        err = 1;
        goto cleanup;
    }
    if (futrts_builtinzhreplicate_i64(ctx, mem_53626, partition_sizze_43809, (int64_t) -1) != 0) {
        err = 1;
        goto cleanup;
    }
    
    int64_t segmap_usable_groups_48158 = sdiv_up64(conc_tmp_43977, segmap_tblock_sizze_48157);
    
    if (memblock_alloc_device(ctx, &mem_54010, bytes_53634, "mem_54010")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_54012, bytes_53634, "mem_54012")) {
        err = 1;
        goto cleanup;
    }
    if (ctx->debugging)
        fprintf(ctx->log, "%s\n", "\n# SegMap");
    
    int32_t virt_num_tblocks_56515 = sext_i64_i32(sdiv_up64(conc_tmp_43977, segmap_tblock_sizze_48157));
    
    {
        err = gpu_kernel_do_DBSCAN_doublezisegmap_48163(ctx, segmap_usable_groups_48158, 1, 1, *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_48136, 1, 1, (int64_t) 0, m_43906, conc_tmp_43977, mem_53612.mem, mem_53614.mem, mem_53630.mem, mem_53632.mem, mem_54010.mem, mem_54012.mem);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (ctx->debugging)
        fprintf(ctx->log, "%s\n", "");
    if (memblock_unref_device(ctx, &mem_53612, "mem_53612") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_53614, "mem_53614") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_53630, "mem_53630") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_53632, "mem_53632") != 0)
        return 1;
    
    int64_t num_whole_tiles_51519 = squot_safe64(conc_tmp_43977, tile_sizze_51474);
    int64_t residual_input_51757 = srem_safe64(conc_tmp_43977, tile_sizze_51474);
    bool cond_51758 = residual_input_51757 == (int64_t) 0;
    int64_t binop_x_51774 = tile_sizze_51474 * num_whole_tiles_51519;
    int64_t bytes_54059 = (int64_t) 8 * tile_sizze_51474;
    
    for (int64_t i_44475 = 0; i_44475 < numIter1_44469; i_44475++) {
        int64_t inf_44477 = mul64(max_res_44441, i_44475);
        int64_t min_arg1_44478 = add64(max_res_44441, inf_44477);
        int64_t min_res_44479 = smin64(partition_sizze_43809, min_arg1_44478);
        int64_t dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_44480 = sub64(min_res_44479, inf_44477);
        bool empty_slice_44481 = dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_44480 == (int64_t) 0;
        int64_t m_44482 = sub64(dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_44480, (int64_t) 1);
        int64_t i_p_m_t_s_44483 = add64(inf_44477, m_44482);
        bool zzero_leq_i_p_m_t_s_44484 = sle64((int64_t) 0, i_p_m_t_s_44483);
        bool i_p_m_t_s_leq_w_44485 = slt64(i_p_m_t_s_44483, partition_sizze_43809);
        bool zzero_lte_i_44486 = sle64((int64_t) 0, inf_44477);
        bool i_lte_j_44487 = sle64(inf_44477, min_res_44479);
        bool y_44488 = i_p_m_t_s_leq_w_44485 && zzero_lte_i_44486;
        bool y_44489 = zzero_leq_i_p_m_t_s_44484 && y_44488;
        bool forwards_ok_44490 = i_lte_j_44487 && y_44489;
        bool ok_or_empty_44491 = empty_slice_44481 || forwards_ok_44490;
        bool index_certs_44492;
        
        if (!ok_or_empty_44491) {
            set_error(ctx, msgprintf("Error: %s%lld%s%lld%s%lld%s\n\nBacktrace:\n%s", "Index [", (long long) inf_44477, ":", (long long) min_res_44479, "] out of bounds for array of shape [", (long long) partition_sizze_43809, "].", "-> #0  ft_libs/ftDBSCAN_plus.fut:631:48-69\n   #1  ft_libs/ftDBSCAN_plus.fut:890:18-893:67\n   #2  ft_libs/ftDBSCAN_plus.fut:889:9-893:67\n"));
            err = FUTHARK_PROGRAM_ERROR;
            goto cleanup;
        }
        
        bool suff_outer_par_48180;
        
        suff_outer_par_48180 = *ctx->tuning_params.do_DBSCAN_doublezisuff_outer_par_5 <= dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_44480;
        if (ctx->logging)
            fprintf(ctx->log, "Compared %s <= %ld: %s.\n", "do_DBSCAN_double.suff_outer_par_5", (long) dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_44480, suff_outer_par_48180 ? "true" : "false");
        
        int64_t nest_sizze_48394 = conc_tmp_43977 * dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_44480;
        int64_t num_tblocks_48396;
        int64_t max_num_tblocks_56525;
        
        max_num_tblocks_56525 = *ctx->tuning_params.do_DBSCAN_doublezisegred_num_tblocks_48306;
        num_tblocks_48396 = sext_i64_i32(smax64((int64_t) 1, smin64(sdiv_up64(nest_sizze_48394, segred_tblock_sizze_48395), max_num_tblocks_56525)));
        
        int64_t bytes_54017 = (int64_t) 8 * dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_44480;
        int64_t shared_memory_capacity_56654;
        
        shared_memory_capacity_56654 = ctx->max_shared_memory;
        if (suff_outer_par_48180 && sle64(sdiv_up64(bytes_54059, (int64_t) 8) * (int64_t) 8 + sdiv_up64(bytes_54059, (int64_t) 8) * (int64_t) 8 + sdiv_up64(bytes_54059, (int64_t) 8) * (int64_t) 8, shared_memory_capacity_56654)) {
            int64_t ldim_51475 = sdiv_up64(dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_44480, tile_sizze_51474);
            
            if (ctx->debugging)
                fprintf(ctx->log, "%s\n", "\n# SegMap");
            
            int32_t num_chunks_56526 = sext_i64_i32(sdiv_up64(tile_sizze_51474, tile_sizze_51474));
            int32_t virt_num_tblocks_56527 = sext_i64_i32(ldim_51475);
            
            {
                err = gpu_kernel_do_DBSCAN_doublezisegmap_intrablock_51472(ctx, ldim_51475, 1, 1, *ctx->tuning_params.do_DBSCAN_doublezitile_sizze_51473, 1, 1, bytes_54059 + srem64((int64_t) 8 - srem64(bytes_54059, (int64_t) 8), (int64_t) 8) + (bytes_54059 + srem64((int64_t) 8 - srem64(bytes_54059, (int64_t) 8), (int64_t) 8)) + (bytes_54059 + srem64((int64_t) 8 - srem64(bytes_54059, (int64_t) 8), (int64_t) 8)), clBase_36809, clBase_36810, clBase_36811, clBase_36817, conc_tmp_43977, inf_44477, dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_44480, ldim_51475, num_whole_tiles_51519, residual_input_51757, cond_51758, binop_x_51774, mem_53586.mem, mem_53588.mem, mem_53626.mem, ext_mem_54005.mem, mem_54010.mem, mem_54012.mem);
                if (err != FUTHARK_SUCCESS)
                    goto cleanup;
            }
            if (ctx->debugging)
                fprintf(ctx->log, "%s\n", "");
        } else {
            int64_t segmap_usable_groups_48378 = sdiv_up64(dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_44480, segmap_tblock_sizze_48377);
            
            if (memblock_alloc_device(ctx, &mem_54018, bytes_54017, "mem_54018")) {
                err = 1;
                goto cleanup;
            }
            if (memblock_alloc_device(ctx, &mem_54020, bytes_54017, "mem_54020")) {
                err = 1;
                goto cleanup;
            }
            if (memblock_alloc_device(ctx, &mem_54022, bytes_54017, "mem_54022")) {
                err = 1;
                goto cleanup;
            }
            if (ctx->debugging)
                fprintf(ctx->log, "%s\n", "\n# SegMap");
            
            int32_t virt_num_tblocks_56547 = sext_i64_i32(sdiv_up64(dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_44480, segmap_tblock_sizze_48377));
            
            {
                err = gpu_kernel_do_DBSCAN_doublezisegmap_48383(ctx, segmap_usable_groups_48378, 1, 1, *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_48362, 1, 1, (int64_t) 0, clBase_36809, inf_44477, dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_44480, mem_53586.mem, mem_53588.mem, mem_54018.mem, mem_54020.mem, mem_54022.mem);
                if (err != FUTHARK_SUCCESS)
                    goto cleanup;
            }
            if (ctx->debugging)
                fprintf(ctx->log, "%s\n", "");
            if (memblock_alloc_device(ctx, &mem_54027, bytes_54017, "mem_54027")) {
                err = 1;
                goto cleanup;
            }
            if (ctx->debugging)
                fprintf(ctx->log, "%s\n", "\n# SegRed");
            
            int64_t chunk_sizze_56556 = (int64_t) 1;
            
            if (slt64(conc_tmp_43977 * (int64_t) 2, segred_tblock_sizze_48395 * chunk_sizze_56556)) {
                int64_t segment_sizze_nonzzero_56557 = smax64((int64_t) 1, conc_tmp_43977);
                int64_t num_threads_56558 = segred_tblock_sizze_48395 * segred_tblock_sizze_48395;
                
                if (ctx->debugging)
                    fprintf(ctx->log, "%s\n", "# SegRed-small");
                if (ctx->debugging)
                    fprintf(ctx->log, "%s: %llu%c", "num_segments", (long long) dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_44480, '\n');
                if (ctx->debugging)
                    fprintf(ctx->log, "%s: %llu%c", "segment_size", (long long) conc_tmp_43977, '\n');
                if (ctx->debugging)
                    fprintf(ctx->log, "%s: %llu%c", "segments_per_block", (long long) squot64(segred_tblock_sizze_48395, segment_sizze_nonzzero_56557), '\n');
                if (ctx->debugging)
                    fprintf(ctx->log, "%s: %llu%c", "required_blocks", (long long) sext_i64_i32(sdiv_up64(dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_44480, squot64(segred_tblock_sizze_48395, segment_sizze_nonzzero_56557))), '\n');
                {
                    err = gpu_kernel_do_DBSCAN_doublezisegred_small_48402(ctx, num_tblocks_48396, 1, 1, *ctx->tuning_params.do_DBSCAN_doublezisegred_tblock_sizze_48304, 1, 1, (int64_t) 8 * segred_tblock_sizze_48395 + srem64((int64_t) 8 - srem64((int64_t) 8 * segred_tblock_sizze_48395, (int64_t) 8), (int64_t) 8) + ((int64_t) 8 * segred_tblock_sizze_48395 + srem64((int64_t) 8 - srem64((int64_t) 8 * segred_tblock_sizze_48395, (int64_t) 8), (int64_t) 8)), clBase_36809, clBase_36810, clBase_36811, clBase_36817, conc_tmp_43977, inf_44477, dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_44480, num_tblocks_48396, x_53498, segment_sizze_nonzzero_56557, mem_53586.mem, mem_53588.mem, mem_53626.mem, ext_mem_54005.mem, mem_54010.mem, mem_54012.mem, mem_54018.mem, mem_54020.mem, mem_54022.mem, mem_54027.mem);
                    if (err != FUTHARK_SUCCESS)
                        goto cleanup;
                }
            } else {
                int64_t blocks_per_segment_56597 = sdiv_up64(num_tblocks_48396, smax64((int64_t) 1, dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_44480));
                int64_t q_56598 = sdiv_up64(conc_tmp_43977, segred_tblock_sizze_48395 * blocks_per_segment_56597 * chunk_sizze_56556);
                int64_t num_virtblocks_56599 = blocks_per_segment_56597 * dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_44480;
                int64_t threads_per_segment_56600 = blocks_per_segment_56597 * segred_tblock_sizze_48395;
                
                if (ctx->debugging)
                    fprintf(ctx->log, "%s\n", "# SegRed-large");
                if (ctx->debugging)
                    fprintf(ctx->log, "%s: %llu%c", "num_segments", (long long) dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_44480, '\n');
                if (ctx->debugging)
                    fprintf(ctx->log, "%s: %llu%c", "segment_size", (long long) conc_tmp_43977, '\n');
                if (ctx->debugging)
                    fprintf(ctx->log, "%s: %llu%c", "num_virtblocks", (long long) num_virtblocks_56599, '\n');
                if (ctx->debugging)
                    fprintf(ctx->log, "%s: %llu%c", "num_tblocks", (long long) num_tblocks_48396, '\n');
                if (ctx->debugging)
                    fprintf(ctx->log, "%s: %llu%c", "tblock_size", (long long) segred_tblock_sizze_48395, '\n');
                if (ctx->debugging)
                    fprintf(ctx->log, "%s: %llu%c", "q", (long long) q_56598, '\n');
                if (ctx->debugging)
                    fprintf(ctx->log, "%s: %llu%c", "blocks_per_segment", (long long) blocks_per_segment_56597, '\n');
                if (memblock_alloc_device(ctx, &segred_tmp_mem_56601, (int64_t) 8 * num_virtblocks_56599, "segred_tmp_mem_56601")) {
                    err = 1;
                    goto cleanup;
                }
                if (memblock_alloc_device(ctx, &segred_tmp_mem_56603, (int64_t) 8 * num_virtblocks_56599, "segred_tmp_mem_56603")) {
                    err = 1;
                    goto cleanup;
                }
                {
                    err = gpu_kernel_do_DBSCAN_doublezisegred_large_48402(ctx, num_tblocks_48396, 1, 1, *ctx->tuning_params.do_DBSCAN_doublezisegred_tblock_sizze_48304, 1, 1, 8 + ((int64_t) 8 * segred_tblock_sizze_48395 + srem64((int64_t) 8 - srem64((int64_t) 8 * segred_tblock_sizze_48395, (int64_t) 8), (int64_t) 8)) + ((int64_t) 8 * segred_tblock_sizze_48395 + srem64((int64_t) 8 - srem64((int64_t) 8 * segred_tblock_sizze_48395, (int64_t) 8), (int64_t) 8)), clBase_36809, clBase_36810, clBase_36811, clBase_36817, conc_tmp_43977, inf_44477, dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_44480, num_tblocks_48396, x_53498, blocks_per_segment_56597, q_56598, num_virtblocks_56599, threads_per_segment_56600, mem_53586.mem, mem_53588.mem, mem_53626.mem, ext_mem_54005.mem, mem_54010.mem, mem_54012.mem, mem_54018.mem, mem_54020.mem, mem_54022.mem, mem_54027.mem, segred_tmp_mem_56601.mem, segred_tmp_mem_56603.mem, counters_mem_56605.mem);
                    if (err != FUTHARK_SUCCESS)
                        goto cleanup;
                }
            }
            if (ctx->debugging)
                fprintf(ctx->log, "%s\n", "");
            if (memblock_unref_device(ctx, &mem_54018, "mem_54018") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_54020, "mem_54020") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_54022, "mem_54022") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_54027, "mem_54027") != 0)
                return 1;
        }
    }
    if (memblock_unref_device(ctx, &mem_53586, "mem_53586") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_53588, "mem_53588") != 0)
        return 1;
    
    int64_t num_tblocks_48455;
    int64_t max_num_tblocks_56655;
    
    max_num_tblocks_56655 = *ctx->tuning_params.do_DBSCAN_doublezisegmap_num_tblocks_48454;
    num_tblocks_48455 = sext_i64_i32(smax64((int64_t) 1, smin64(sdiv_up64(partition_sizze_43809, segmap_tblock_sizze_48453), max_num_tblocks_56655)));
    if (ctx->debugging)
        fprintf(ctx->log, "%s\n", "\n# SegMap");
    
    int32_t virt_num_tblocks_56656 = sext_i64_i32(sdiv_up64(partition_sizze_43809, segmap_tblock_sizze_48453));
    
    {
        err = gpu_kernel_do_DBSCAN_doublezisegmap_48450(ctx, num_tblocks_48455, 1, 1, *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_48452, 1, 1, (int64_t) 0, dz2080U_36801, dz2081U_36802, partition_sizze_43809, num_tblocks_48455, virt_num_tblocks_56656, mem_53549.mem, mem_53551.mem, mem_53592.mem, mem_53608.mem, mem_53626.mem);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (ctx->debugging)
        fprintf(ctx->log, "%s\n", "");
    if (memblock_unref_device(ctx, &mem_53592, "mem_53592") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_53608, "mem_53608") != 0)
        return 1;
    if (memblock_alloc_device(ctx, &mem_54256, bytes_54255, "mem_54256")) {
        err = 1;
        goto cleanup;
    }
    if ((err = lmad_copy_gpu2gpu_8b(ctx, 1, mem_54256.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, mem_54094.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, (int64_t []) {m_44409})) != 0)
        goto cleanup;
    if (memblock_alloc_device(ctx, &mem_54258, bytes_54255, "mem_54258")) {
        err = 1;
        goto cleanup;
    }
    if ((err = lmad_copy_gpu2gpu_8b(ctx, 1, mem_54258.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, mem_54096.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, (int64_t []) {m_44409})) != 0)
        goto cleanup;
    
    int64_t num_tblocks_48915;
    int64_t max_num_tblocks_56669;
    
    max_num_tblocks_56669 = *ctx->tuning_params.do_DBSCAN_doublezisegmap_num_tblocks_48914;
    num_tblocks_48915 = sext_i64_i32(smax64((int64_t) 1, smin64(sdiv_up64(m_44319, segmap_tblock_sizze_48913), max_num_tblocks_56669)));
    if (ctx->debugging)
        fprintf(ctx->log, "%s\n", "\n# SegMap");
    
    int32_t virt_num_tblocks_56670 = sext_i64_i32(sdiv_up64(m_44319, segmap_tblock_sizze_48913));
    
    {
        err = gpu_kernel_do_DBSCAN_doublezisegmap_48910(ctx, num_tblocks_48915, 1, 1, *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_48912, 1, 1, (int64_t) 0, m_44319, m_44409, num_tblocks_48915, virt_num_tblocks_56670, mem_54094.mem, mem_54096.mem, ext_mem_54253.mem, ext_mem_54254.mem, mem_54256.mem, mem_54258.mem);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (ctx->debugging)
        fprintf(ctx->log, "%s\n", "");
    if (memblock_unref_device(ctx, &mem_54094, "mem_54094") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_54096, "mem_54096") != 0)
        return 1;
    if (memblock_unref_device(ctx, &ext_mem_54253, "ext_mem_54253") != 0)
        return 1;
    if (memblock_unref_device(ctx, &ext_mem_54254, "ext_mem_54254") != 0)
        return 1;
    
    int64_t num_whole_tiles_52692 = squot_safe64(conc_tmp_43977, tile_sizze_52647);
    int64_t residual_input_52930 = srem_safe64(conc_tmp_43977, tile_sizze_52647);
    bool cond_52931 = residual_input_52930 == (int64_t) 0;
    int64_t binop_x_52947 = tile_sizze_52647 * num_whole_tiles_52692;
    int64_t bytes_54306 = (int64_t) 8 * tile_sizze_52647;
    
    for (int64_t i_44558 = 0; i_44558 < numIter2_44552; i_44558++) {
        int64_t inf_44560 = mul64(max_res_44441, i_44558);
        int64_t min_arg1_44561 = add64(max_res_44441, inf_44560);
        int64_t min_res_44562 = smin64(n_36798, min_arg1_44561);
        int64_t dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_44563 = sub64(min_res_44562, inf_44560);
        bool empty_slice_44564 = dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_44563 == (int64_t) 0;
        int64_t m_44565 = sub64(dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_44563, (int64_t) 1);
        int64_t i_p_m_t_s_44566 = add64(inf_44560, m_44565);
        bool zzero_leq_i_p_m_t_s_44567 = sle64((int64_t) 0, i_p_m_t_s_44566);
        bool i_p_m_t_s_leq_w_44568 = slt64(i_p_m_t_s_44566, n_36798);
        bool zzero_lte_i_44569 = sle64((int64_t) 0, inf_44560);
        bool i_lte_j_44570 = sle64(inf_44560, min_res_44562);
        bool y_44571 = i_p_m_t_s_leq_w_44568 && zzero_lte_i_44569;
        bool y_44572 = zzero_leq_i_p_m_t_s_44567 && y_44571;
        bool forwards_ok_44573 = i_lte_j_44570 && y_44572;
        bool ok_or_empty_44574 = empty_slice_44564 || forwards_ok_44573;
        bool index_certs_44575;
        
        if (!ok_or_empty_44574) {
            set_error(ctx, msgprintf("Error: %s%lld%s%lld%s%lld%s\n\nBacktrace:\n%s", "Index [", (long long) inf_44560, ":", (long long) min_res_44562, "] out of bounds for array of shape [", (long long) n_36798, "].", "-> #0  ft_libs/ftDBSCAN_plus.fut:648:48-70\n   #1  ft_libs/ftDBSCAN_plus.fut:890:18-893:67\n   #2  ft_libs/ftDBSCAN_plus.fut:889:9-893:67\n"));
            err = FUTHARK_PROGRAM_ERROR;
            goto cleanup;
        }
        
        bool suff_outer_par_48918;
        
        suff_outer_par_48918 = *ctx->tuning_params.do_DBSCAN_doublezisuff_outer_par_8 <= dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_44563;
        if (ctx->logging)
            fprintf(ctx->log, "Compared %s <= %ld: %s.\n", "do_DBSCAN_double.suff_outer_par_8", (long) dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_44563, suff_outer_par_48918 ? "true" : "false");
        
        int64_t nest_sizze_49132 = conc_tmp_43977 * dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_44563;
        int64_t num_tblocks_49134;
        int64_t max_num_tblocks_56684;
        
        max_num_tblocks_56684 = *ctx->tuning_params.do_DBSCAN_doublezisegred_num_tblocks_49044;
        num_tblocks_49134 = sext_i64_i32(smax64((int64_t) 1, smin64(sdiv_up64(nest_sizze_49132, segred_tblock_sizze_49133), max_num_tblocks_56684)));
        
        int64_t bytes_54264 = (int64_t) 8 * dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_44563;
        int64_t shared_memory_capacity_56813;
        
        shared_memory_capacity_56813 = ctx->max_shared_memory;
        if (suff_outer_par_48918 && sle64(sdiv_up64(bytes_54306, (int64_t) 8) * (int64_t) 8 + sdiv_up64(bytes_54306, (int64_t) 8) * (int64_t) 8 + sdiv_up64(bytes_54306, (int64_t) 8) * (int64_t) 8, shared_memory_capacity_56813)) {
            int64_t ldim_52648 = sdiv_up64(dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_44563, tile_sizze_52647);
            
            if (ctx->debugging)
                fprintf(ctx->log, "%s\n", "\n# SegMap");
            
            int32_t num_chunks_56685 = sext_i64_i32(sdiv_up64(tile_sizze_52647, tile_sizze_52647));
            int32_t virt_num_tblocks_56686 = sext_i64_i32(ldim_52648);
            
            {
                err = gpu_kernel_do_DBSCAN_doublezisegmap_intrablock_52645(ctx, ldim_52648, 1, 1, *ctx->tuning_params.do_DBSCAN_doublezitile_sizze_52646, 1, 1, bytes_54306 + srem64((int64_t) 8 - srem64(bytes_54306, (int64_t) 8), (int64_t) 8) + (bytes_54306 + srem64((int64_t) 8 - srem64(bytes_54306, (int64_t) 8), (int64_t) 8)) + (bytes_54306 + srem64((int64_t) 8 - srem64(bytes_54306, (int64_t) 8), (int64_t) 8)), clBase_36809, clBase_36810, clBase_36811, clBase_36817, conc_tmp_43977, inf_44560, dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_44563, ldim_52648, num_whole_tiles_52692, residual_input_52930, cond_52931, binop_x_52947, current_partition_mem_53519.mem, current_partition_mem_53520.mem, mem_53556.mem, ext_mem_54005.mem, mem_54010.mem, mem_54012.mem);
                if (err != FUTHARK_SUCCESS)
                    goto cleanup;
            }
            if (ctx->debugging)
                fprintf(ctx->log, "%s\n", "");
        } else {
            int64_t segmap_usable_groups_49116 = sdiv_up64(dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_44563, segmap_tblock_sizze_49115);
            
            if (memblock_alloc_device(ctx, &mem_54265, bytes_54264, "mem_54265")) {
                err = 1;
                goto cleanup;
            }
            if (memblock_alloc_device(ctx, &mem_54267, bytes_54264, "mem_54267")) {
                err = 1;
                goto cleanup;
            }
            if (memblock_alloc_device(ctx, &mem_54269, bytes_54264, "mem_54269")) {
                err = 1;
                goto cleanup;
            }
            if (ctx->debugging)
                fprintf(ctx->log, "%s\n", "\n# SegMap");
            
            int32_t virt_num_tblocks_56706 = sext_i64_i32(sdiv_up64(dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_44563, segmap_tblock_sizze_49115));
            
            {
                err = gpu_kernel_do_DBSCAN_doublezisegmap_49121(ctx, segmap_usable_groups_49116, 1, 1, *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_49100, 1, 1, (int64_t) 0, clBase_36809, inf_44560, dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_44563, current_partition_mem_53519.mem, current_partition_mem_53520.mem, mem_54265.mem, mem_54267.mem, mem_54269.mem);
                if (err != FUTHARK_SUCCESS)
                    goto cleanup;
            }
            if (ctx->debugging)
                fprintf(ctx->log, "%s\n", "");
            if (memblock_alloc_device(ctx, &mem_54274, bytes_54264, "mem_54274")) {
                err = 1;
                goto cleanup;
            }
            if (ctx->debugging)
                fprintf(ctx->log, "%s\n", "\n# SegRed");
            
            int64_t chunk_sizze_56715 = (int64_t) 1;
            
            if (slt64(conc_tmp_43977 * (int64_t) 2, segred_tblock_sizze_49133 * chunk_sizze_56715)) {
                int64_t segment_sizze_nonzzero_56716 = smax64((int64_t) 1, conc_tmp_43977);
                int64_t num_threads_56717 = segred_tblock_sizze_49133 * segred_tblock_sizze_49133;
                
                if (ctx->debugging)
                    fprintf(ctx->log, "%s\n", "# SegRed-small");
                if (ctx->debugging)
                    fprintf(ctx->log, "%s: %llu%c", "num_segments", (long long) dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_44563, '\n');
                if (ctx->debugging)
                    fprintf(ctx->log, "%s: %llu%c", "segment_size", (long long) conc_tmp_43977, '\n');
                if (ctx->debugging)
                    fprintf(ctx->log, "%s: %llu%c", "segments_per_block", (long long) squot64(segred_tblock_sizze_49133, segment_sizze_nonzzero_56716), '\n');
                if (ctx->debugging)
                    fprintf(ctx->log, "%s: %llu%c", "required_blocks", (long long) sext_i64_i32(sdiv_up64(dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_44563, squot64(segred_tblock_sizze_49133, segment_sizze_nonzzero_56716))), '\n');
                {
                    err = gpu_kernel_do_DBSCAN_doublezisegred_small_49140(ctx, num_tblocks_49134, 1, 1, *ctx->tuning_params.do_DBSCAN_doublezisegred_tblock_sizze_49042, 1, 1, (int64_t) 8 * segred_tblock_sizze_49133 + srem64((int64_t) 8 - srem64((int64_t) 8 * segred_tblock_sizze_49133, (int64_t) 8), (int64_t) 8) + ((int64_t) 8 * segred_tblock_sizze_49133 + srem64((int64_t) 8 - srem64((int64_t) 8 * segred_tblock_sizze_49133, (int64_t) 8), (int64_t) 8)), clBase_36809, clBase_36810, clBase_36811, clBase_36817, conc_tmp_43977, inf_44560, dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_44563, num_tblocks_49134, x_53498, segment_sizze_nonzzero_56716, current_partition_mem_53519.mem, current_partition_mem_53520.mem, mem_53556.mem, ext_mem_54005.mem, mem_54010.mem, mem_54012.mem, mem_54265.mem, mem_54267.mem, mem_54269.mem, mem_54274.mem);
                    if (err != FUTHARK_SUCCESS)
                        goto cleanup;
                }
            } else {
                int64_t blocks_per_segment_56756 = sdiv_up64(num_tblocks_49134, smax64((int64_t) 1, dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_44563));
                int64_t q_56757 = sdiv_up64(conc_tmp_43977, segred_tblock_sizze_49133 * blocks_per_segment_56756 * chunk_sizze_56715);
                int64_t num_virtblocks_56758 = blocks_per_segment_56756 * dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_44563;
                int64_t threads_per_segment_56759 = blocks_per_segment_56756 * segred_tblock_sizze_49133;
                
                if (ctx->debugging)
                    fprintf(ctx->log, "%s\n", "# SegRed-large");
                if (ctx->debugging)
                    fprintf(ctx->log, "%s: %llu%c", "num_segments", (long long) dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_44563, '\n');
                if (ctx->debugging)
                    fprintf(ctx->log, "%s: %llu%c", "segment_size", (long long) conc_tmp_43977, '\n');
                if (ctx->debugging)
                    fprintf(ctx->log, "%s: %llu%c", "num_virtblocks", (long long) num_virtblocks_56758, '\n');
                if (ctx->debugging)
                    fprintf(ctx->log, "%s: %llu%c", "num_tblocks", (long long) num_tblocks_49134, '\n');
                if (ctx->debugging)
                    fprintf(ctx->log, "%s: %llu%c", "tblock_size", (long long) segred_tblock_sizze_49133, '\n');
                if (ctx->debugging)
                    fprintf(ctx->log, "%s: %llu%c", "q", (long long) q_56757, '\n');
                if (ctx->debugging)
                    fprintf(ctx->log, "%s: %llu%c", "blocks_per_segment", (long long) blocks_per_segment_56756, '\n');
                if (memblock_alloc_device(ctx, &segred_tmp_mem_56760, (int64_t) 8 * num_virtblocks_56758, "segred_tmp_mem_56760")) {
                    err = 1;
                    goto cleanup;
                }
                if (memblock_alloc_device(ctx, &segred_tmp_mem_56762, (int64_t) 8 * num_virtblocks_56758, "segred_tmp_mem_56762")) {
                    err = 1;
                    goto cleanup;
                }
                {
                    err = gpu_kernel_do_DBSCAN_doublezisegred_large_49140(ctx, num_tblocks_49134, 1, 1, *ctx->tuning_params.do_DBSCAN_doublezisegred_tblock_sizze_49042, 1, 1, 8 + ((int64_t) 8 * segred_tblock_sizze_49133 + srem64((int64_t) 8 - srem64((int64_t) 8 * segred_tblock_sizze_49133, (int64_t) 8), (int64_t) 8)) + ((int64_t) 8 * segred_tblock_sizze_49133 + srem64((int64_t) 8 - srem64((int64_t) 8 * segred_tblock_sizze_49133, (int64_t) 8), (int64_t) 8)), clBase_36809, clBase_36810, clBase_36811, clBase_36817, conc_tmp_43977, inf_44560, dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_44563, num_tblocks_49134, x_53498, blocks_per_segment_56756, q_56757, num_virtblocks_56758, threads_per_segment_56759, current_partition_mem_53519.mem, current_partition_mem_53520.mem, mem_53556.mem, ext_mem_54005.mem, mem_54010.mem, mem_54012.mem, mem_54265.mem, mem_54267.mem, mem_54269.mem, mem_54274.mem, segred_tmp_mem_56760.mem, segred_tmp_mem_56762.mem, counters_mem_56764.mem);
                    if (err != FUTHARK_SUCCESS)
                        goto cleanup;
                }
            }
            if (ctx->debugging)
                fprintf(ctx->log, "%s\n", "");
            if (memblock_unref_device(ctx, &mem_54265, "mem_54265") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_54267, "mem_54267") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_54269, "mem_54269") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_54274, "mem_54274") != 0)
                return 1;
        }
    }
    if (memblock_unref_device(ctx, &ext_mem_54005, "ext_mem_54005") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_54010, "mem_54010") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_54012, "mem_54012") != 0)
        return 1;
    if (memblock_alloc_device(ctx, &mem_54340, (int64_t) 8, "mem_54340")) {
        err = 1;
        goto cleanup;
    }
    if (ctx->debugging)
        fprintf(ctx->log, "%s\n", "\n# SegRed");
    
    int64_t chunk_sizze_56814 = (int64_t) 1;
    
    if (memblock_alloc_device(ctx, &segred_tmp_mem_56817, (int64_t) 8 * num_tblocks_49191, "segred_tmp_mem_56817")) {
        err = 1;
        goto cleanup;
    }
    
    int64_t num_threads_56819 = num_tblocks_49191 * segred_tblock_sizze_49189;
    
    {
        err = gpu_kernel_do_DBSCAN_doublezisegred_nonseg_49196(ctx, num_tblocks_49191, 1, 1, *ctx->tuning_params.do_DBSCAN_doublezisegred_tblock_sizze_49188, 1, 1, 8 + ((int64_t) 8 * segred_tblock_sizze_49189 + srem64((int64_t) 8 - srem64((int64_t) 8 * segred_tblock_sizze_49189, (int64_t) 8), (int64_t) 8)), n_36798, num_tblocks_49191, num_threads_56819, mem_53556.mem, mem_54340.mem, counters_mem_56815.mem, segred_tmp_mem_56817.mem);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (ctx->debugging)
        fprintf(ctx->log, "%s\n", "");
    
    int64_t num_tblocks_49201;
    int64_t max_num_tblocks_56848;
    
    max_num_tblocks_56848 = *ctx->tuning_params.do_DBSCAN_doublezisegred_num_tblocks_49200;
    num_tblocks_49201 = sext_i64_i32(smax64((int64_t) 1, smin64(sdiv_up64(partition_sizze_43809, segred_tblock_sizze_49199), max_num_tblocks_56848)));
    if (memblock_alloc_device(ctx, &mem_54342, (int64_t) 8, "mem_54342")) {
        err = 1;
        goto cleanup;
    }
    if (ctx->debugging)
        fprintf(ctx->log, "%s\n", "\n# SegRed");
    
    int64_t chunk_sizze_56849 = (int64_t) 1;
    
    if (memblock_alloc_device(ctx, &segred_tmp_mem_56852, (int64_t) 8 * num_tblocks_49201, "segred_tmp_mem_56852")) {
        err = 1;
        goto cleanup;
    }
    
    int64_t num_threads_56854 = num_tblocks_49201 * segred_tblock_sizze_49199;
    
    {
        err = gpu_kernel_do_DBSCAN_doublezisegred_nonseg_49206(ctx, num_tblocks_49201, 1, 1, *ctx->tuning_params.do_DBSCAN_doublezisegred_tblock_sizze_49198, 1, 1, 8 + ((int64_t) 8 * segred_tblock_sizze_49199 + srem64((int64_t) 8 - srem64((int64_t) 8 * segred_tblock_sizze_49199, (int64_t) 8), (int64_t) 8)), partition_sizze_43809, num_tblocks_49201, num_threads_56854, mem_53626.mem, mem_54342.mem, counters_mem_56850.mem, segred_tmp_mem_56852.mem);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (ctx->debugging)
        fprintf(ctx->log, "%s\n", "");
    if (memblock_unref_device(ctx, &mem_53626, "mem_53626") != 0)
        return 1;
    if (memblock_alloc_device(ctx, &mem_54344, bytes_54343, "mem_54344")) {
        err = 1;
        goto cleanup;
    }
    
    int64_t tmp_offs_56883 = (int64_t) 0;
    
    if ((err = lmad_copy_gpu2gpu_8b(ctx, 1, mem_54344.mem, tmp_offs_56883, (int64_t []) {(int64_t) 1}, chain_collisions_mem_53506.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, (int64_t []) {dz2084U_36800})) != 0)
        goto cleanup;
    tmp_offs_56883 += dz2084U_36800;
    if ((err = lmad_copy_gpu2gpu_8b(ctx, 1, mem_54344.mem, tmp_offs_56883, (int64_t []) {(int64_t) 1}, mem_54258.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, (int64_t []) {m_44409})) != 0)
        goto cleanup;
    tmp_offs_56883 += m_44409;
    if (memblock_unref_device(ctx, &mem_54258, "mem_54258") != 0)
        return 1;
    if (memblock_alloc_device(ctx, &mem_54346, bytes_54343, "mem_54346")) {
        err = 1;
        goto cleanup;
    }
    
    int64_t tmp_offs_56884 = (int64_t) 0;
    
    if ((err = lmad_copy_gpu2gpu_8b(ctx, 1, mem_54346.mem, tmp_offs_56884, (int64_t []) {(int64_t) 1}, chain_collisions_mem_53507.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, (int64_t []) {dz2084U_36800})) != 0)
        goto cleanup;
    tmp_offs_56884 += dz2084U_36800;
    if ((err = lmad_copy_gpu2gpu_8b(ctx, 1, mem_54346.mem, tmp_offs_56884, (int64_t []) {(int64_t) 1}, mem_54256.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, (int64_t []) {m_44409})) != 0)
        goto cleanup;
    tmp_offs_56884 += m_44409;
    if (memblock_unref_device(ctx, &mem_54256, "mem_54256") != 0)
        return 1;
    if (memblock_alloc_device(ctx, &mem_54347, (int64_t) 8, "mem_54347")) {
        err = 1;
        goto cleanup;
    }
    {
        err = gpu_kernel_do_DBSCAN_doublezigpuseq_56885(ctx, (int64_t) 1, 1, 1, (int64_t) 1, 1, 1, (int64_t) 0, mem_54340.mem, mem_54342.mem, mem_54347.mem);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (memblock_unref_device(ctx, &mem_54340, "mem_54340") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_54342, "mem_54342") != 0)
        return 1;
    
    int64_t read_res_56990;
    
    if ((err = gpu_scalar_from_device(ctx, &read_res_56990, mem_54347.mem, (int64_t) 0 * sizeof(int64_t), sizeof(int64_t))) != 0)
        goto cleanup;
    if (ctx->failure_is_an_option && futhark_context_sync(ctx) != 0) {
        err = 1;
        goto cleanup;
    }
    
    int64_t max_res_44651 = read_res_56990;
    
    if (memblock_unref_device(ctx, &mem_54347, "mem_54347") != 0)
        return 1;
    
    int64_t max_arg1_44652 = add64((int64_t) 1, max_res_44651);
    int64_t max_res_44653 = smax64(clProc_36824, max_arg1_44652);
    
    if (memblock_set_device(ctx, &mem_out_54541, &mem_54344, "mem_54344") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_54542, &mem_54346, "mem_54346") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_54543, &clBase_mem_53508, "clBase_mem_53508") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_54544, &clBase_mem_53509, "clBase_mem_53509") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_54545, &clBase_mem_53510, "clBase_mem_53510") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_54546, &clBase_mem_53511, "clBase_mem_53511") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_54547, &mem_53549, "mem_53549") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_54548, &mem_53551, "mem_53551") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_54549, &clProc_mem_53514, "clProc_mem_53514") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_54550, &clProc_mem_53515, "clProc_mem_53515") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_54551, &clProc_mem_53516, "clProc_mem_53516") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_54552, &clProc_mem_53517, "clProc_mem_53517") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_54553, &mem_53556, "mem_53556") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_54554, &current_partition_mem_53519, "current_partition_mem_53519") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_54555, &current_partition_mem_53520, "current_partition_mem_53520") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_54556, &current_partition_mem_53521, "current_partition_mem_53521") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_54557, &current_partition_mem_53522, "current_partition_mem_53522") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_54558, &mem_53619, "mem_53619") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_54559, &current_partition_mem_53524, "current_partition_mem_53524") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_54560, &current_partition_mem_53525, "current_partition_mem_53525") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_54561, &current_partition_mem_53526, "current_partition_mem_53526") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_54562, &current_partition_mem_53527, "current_partition_mem_53527") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_54563, &current_partition_mem_53528, "current_partition_mem_53528") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_54564, &current_partition_mem_53529, "current_partition_mem_53529") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_54565, &mem_53557, "mem_53557") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_54566, &mem_53558, "mem_53558") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_54567, &mem_53559, "mem_53559") != 0)
        return 1;
    prim_out_54568 = conc_tmp_44654;
    prim_out_54569 = clBase_36809;
    prim_out_54570 = clBase_36810;
    prim_out_54571 = clBase_36811;
    prim_out_54572 = clBase_36812;
    prim_out_54573 = clBase_36814;
    prim_out_54574 = clBase_36817;
    prim_out_54575 = clBase_36819;
    prim_out_54576 = max_res_44653;
    prim_out_54577 = clProc_36825;
    prim_out_54578 = clProc_36826;
    prim_out_54579 = clProc_36828;
    prim_out_54580 = clProc_36829;
    prim_out_54581 = current_partition_36843;
    if (memblock_set_device(ctx, &*mem_out_p_56939, &mem_out_54541, "mem_out_54541") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_56940, &mem_out_54542, "mem_out_54542") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_56941, &mem_out_54543, "mem_out_54543") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_56942, &mem_out_54544, "mem_out_54544") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_56943, &mem_out_54545, "mem_out_54545") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_56944, &mem_out_54546, "mem_out_54546") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_56945, &mem_out_54547, "mem_out_54547") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_56946, &mem_out_54548, "mem_out_54548") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_56947, &mem_out_54549, "mem_out_54549") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_56948, &mem_out_54550, "mem_out_54550") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_56949, &mem_out_54551, "mem_out_54551") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_56950, &mem_out_54552, "mem_out_54552") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_56951, &mem_out_54553, "mem_out_54553") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_56952, &mem_out_54554, "mem_out_54554") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_56953, &mem_out_54555, "mem_out_54555") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_56954, &mem_out_54556, "mem_out_54556") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_56955, &mem_out_54557, "mem_out_54557") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_56956, &mem_out_54558, "mem_out_54558") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_56957, &mem_out_54559, "mem_out_54559") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_56958, &mem_out_54560, "mem_out_54560") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_56959, &mem_out_54561, "mem_out_54561") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_56960, &mem_out_54562, "mem_out_54562") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_56961, &mem_out_54563, "mem_out_54563") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_56962, &mem_out_54564, "mem_out_54564") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_56963, &mem_out_54565, "mem_out_54565") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_56964, &mem_out_54566, "mem_out_54566") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_56965, &mem_out_54567, "mem_out_54567") != 0)
        return 1;
    *out_prim_out_56966 = prim_out_54568;
    *out_prim_out_56967 = prim_out_54569;
    *out_prim_out_56968 = prim_out_54570;
    *out_prim_out_56969 = prim_out_54571;
    *out_prim_out_56970 = prim_out_54572;
    *out_prim_out_56971 = prim_out_54573;
    *out_prim_out_56972 = prim_out_54574;
    *out_prim_out_56973 = prim_out_54575;
    *out_prim_out_56974 = prim_out_54576;
    *out_prim_out_56975 = prim_out_54577;
    *out_prim_out_56976 = prim_out_54578;
    *out_prim_out_56977 = prim_out_54579;
    *out_prim_out_56978 = prim_out_54580;
    *out_prim_out_56979 = prim_out_54581;
    
  cleanup:
    {
        if (memblock_unref_device(ctx, &mem_54347, "mem_54347") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_54346, "mem_54346") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_54344, "mem_54344") != 0)
            return 1;
        if (memblock_unref_device(ctx, &segred_tmp_mem_56852, "segred_tmp_mem_56852") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_54342, "mem_54342") != 0)
            return 1;
        if (memblock_unref_device(ctx, &segred_tmp_mem_56817, "segred_tmp_mem_56817") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_54340, "mem_54340") != 0)
            return 1;
        if (memblock_unref_device(ctx, &segred_tmp_mem_56762, "segred_tmp_mem_56762") != 0)
            return 1;
        if (memblock_unref_device(ctx, &segred_tmp_mem_56760, "segred_tmp_mem_56760") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_54274, "mem_54274") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_54269, "mem_54269") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_54267, "mem_54267") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_54265, "mem_54265") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_54258, "mem_54258") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_54256, "mem_54256") != 0)
            return 1;
        if (memblock_unref_device(ctx, &segred_tmp_mem_56603, "segred_tmp_mem_56603") != 0)
            return 1;
        if (memblock_unref_device(ctx, &segred_tmp_mem_56601, "segred_tmp_mem_56601") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_54027, "mem_54027") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_54022, "mem_54022") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_54020, "mem_54020") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_54018, "mem_54018") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_54012, "mem_54012") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_54010, "mem_54010") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53626, "mem_53626") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53559, "mem_53559") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53558, "mem_53558") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53557, "mem_53557") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53556, "mem_53556") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53551, "mem_53551") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53549, "mem_53549") != 0)
            return 1;
        if (memblock_unref_device(ctx, &incprefixes_mem_56423, "incprefixes_mem_56423") != 0)
            return 1;
        if (memblock_unref_device(ctx, &aggregates_mem_56421, "aggregates_mem_56421") != 0)
            return 1;
        if (memblock_unref_device(ctx, &status_flags_mem_56419, "status_flags_mem_56419") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_54247, "mem_54247") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_54244, "mem_54244") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_54169, "mem_54169") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_54241, "mem_54241") != 0)
            return 1;
        if (memblock_unref_device(ctx, &ext_mem_54242, "ext_mem_54242") != 0)
            return 1;
        if (memblock_unref_device(ctx, &ext_mem_54253, "ext_mem_54253") != 0)
            return 1;
        if (memblock_unref_device(ctx, &ext_mem_54254, "ext_mem_54254") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_54096, "mem_54096") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_54094, "mem_54094") != 0)
            return 1;
        if (memblock_unref_device(ctx, &incprefixes_mem_56149, "incprefixes_mem_56149") != 0)
            return 1;
        if (memblock_unref_device(ctx, &aggregates_mem_56147, "aggregates_mem_56147") != 0)
            return 1;
        if (memblock_unref_device(ctx, &status_flags_mem_56145, "status_flags_mem_56145") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53997, "mem_53997") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53994, "mem_53994") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53940, "mem_53940") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53938, "mem_53938") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53990, "mem_53990") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53988, "mem_53988") != 0)
            return 1;
        if (memblock_unref_device(ctx, &ext_mem_53991, "ext_mem_53991") != 0)
            return 1;
        if (memblock_unref_device(ctx, &ext_mem_53992, "ext_mem_53992") != 0)
            return 1;
        if (memblock_unref_device(ctx, &ext_mem_54005, "ext_mem_54005") != 0)
            return 1;
        if (memblock_unref_device(ctx, &ext_mem_54006, "ext_mem_54006") != 0)
            return 1;
        if (memblock_unref_device(ctx, &ext_mem_54007, "ext_mem_54007") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53889, "mem_53889") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53887, "mem_53887") != 0)
            return 1;
        if (memblock_unref_device(ctx, &incprefixes_mem_55882, "incprefixes_mem_55882") != 0)
            return 1;
        if (memblock_unref_device(ctx, &aggregates_mem_55880, "aggregates_mem_55880") != 0)
            return 1;
        if (memblock_unref_device(ctx, &status_flags_mem_55878, "status_flags_mem_55878") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53878, "mem_53878") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53875, "mem_53875") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53810, "mem_53810") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53872, "mem_53872") != 0)
            return 1;
        if (memblock_unref_device(ctx, &ext_mem_53873, "ext_mem_53873") != 0)
            return 1;
        if (memblock_unref_device(ctx, &ext_mem_53884, "ext_mem_53884") != 0)
            return 1;
        if (memblock_unref_device(ctx, &ext_mem_53885, "ext_mem_53885") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53747, "mem_53747") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53745, "mem_53745") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_param_tmp_55679, "mem_param_tmp_55679") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53739, "mem_53739") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_param_53736, "mem_param_53736") != 0)
            return 1;
        if (memblock_unref_device(ctx, &ext_mem_53742, "ext_mem_53742") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53733, "mem_53733") != 0)
            return 1;
        if (memblock_unref_device(ctx, &incprefixes_mem_55579, "incprefixes_mem_55579") != 0)
            return 1;
        if (memblock_unref_device(ctx, &aggregates_mem_55577, "aggregates_mem_55577") != 0)
            return 1;
        if (memblock_unref_device(ctx, &status_flags_mem_55575, "status_flags_mem_55575") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53730, "mem_53730") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_param_tmp_55428, "mem_param_tmp_55428") != 0)
            return 1;
        if (memblock_unref_device(ctx, &segred_tmp_mem_55536, "segred_tmp_mem_55536") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_param_tmp_55431, "mem_param_tmp_55431") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53719, "mem_53719") != 0)
            return 1;
        if (memblock_unref_device(ctx, &segred_tmp_mem_55493, "segred_tmp_mem_55493") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53662, "mem_53662") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53659, "mem_53659") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53657, "mem_53657") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53655, "mem_53655") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53716, "mem_53716") != 0)
            return 1;
        if (memblock_unref_device(ctx, &ext_mem_53717, "ext_mem_53717") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_param_53652, "mem_param_53652") != 0)
            return 1;
        if (memblock_unref_device(ctx, &ext_mem_53722, "ext_mem_53722") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_param_53649, "mem_param_53649") != 0)
            return 1;
        if (memblock_unref_device(ctx, &ext_mem_53727, "ext_mem_53727") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53724, "mem_53724") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53646, "mem_53646") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53644, "mem_53644") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53642, "mem_53642") != 0)
            return 1;
        if (memblock_unref_device(ctx, &incprefixes_mem_55336, "incprefixes_mem_55336") != 0)
            return 1;
        if (memblock_unref_device(ctx, &aggregates_mem_55334, "aggregates_mem_55334") != 0)
            return 1;
        if (memblock_unref_device(ctx, &status_flags_mem_55332, "status_flags_mem_55332") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53640, "mem_53640") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53638, "mem_53638") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53635, "mem_53635") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53632, "mem_53632") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53630, "mem_53630") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53628, "mem_53628") != 0)
            return 1;
        if (memblock_unref_device(ctx, &incprefixes_mem_55219, "incprefixes_mem_55219") != 0)
            return 1;
        if (memblock_unref_device(ctx, &aggregates_mem_55217, "aggregates_mem_55217") != 0)
            return 1;
        if (memblock_unref_device(ctx, &status_flags_mem_55215, "status_flags_mem_55215") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53624, "mem_53624") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53622, "mem_53622") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53619, "mem_53619") != 0)
            return 1;
        if (memblock_unref_device(ctx, &ext_mem_53616, "ext_mem_53616") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53614, "mem_53614") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53612, "mem_53612") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53610, "mem_53610") != 0)
            return 1;
        if (memblock_unref_device(ctx, &incprefixes_mem_55081, "incprefixes_mem_55081") != 0)
            return 1;
        if (memblock_unref_device(ctx, &aggregates_mem_55079, "aggregates_mem_55079") != 0)
            return 1;
        if (memblock_unref_device(ctx, &status_flags_mem_55077, "status_flags_mem_55077") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53608, "mem_53608") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53607, "mem_53607") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53605, "mem_53605") != 0)
            return 1;
        if (memblock_unref_device(ctx, &ext_mem_53602, "ext_mem_53602") != 0)
            return 1;
        if (memblock_unref_device(ctx, &ext_mem_53601, "ext_mem_53601") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53599, "mem_53599") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53596, "mem_53596") != 0)
            return 1;
        if (memblock_unref_device(ctx, &ext_mem_53594, "ext_mem_53594") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53592, "mem_53592") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53590, "mem_53590") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53588, "mem_53588") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53586, "mem_53586") != 0)
            return 1;
        if (memblock_unref_device(ctx, &incprefixes_mem_54918, "incprefixes_mem_54918") != 0)
            return 1;
        if (memblock_unref_device(ctx, &aggregates_mem_54916, "aggregates_mem_54916") != 0)
            return 1;
        if (memblock_unref_device(ctx, &incprefixes_mem_54914, "incprefixes_mem_54914") != 0)
            return 1;
        if (memblock_unref_device(ctx, &aggregates_mem_54912, "aggregates_mem_54912") != 0)
            return 1;
        if (memblock_unref_device(ctx, &status_flags_mem_54910, "status_flags_mem_54910") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53584, "mem_53584") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53582, "mem_53582") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53580, "mem_53580") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53576, "mem_53576") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53574, "mem_53574") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53572, "mem_53572") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53570, "mem_53570") != 0)
            return 1;
        if (memblock_unref_device(ctx, &incprefixes_mem_54798, "incprefixes_mem_54798") != 0)
            return 1;
        if (memblock_unref_device(ctx, &aggregates_mem_54796, "aggregates_mem_54796") != 0)
            return 1;
        if (memblock_unref_device(ctx, &status_flags_mem_54794, "status_flags_mem_54794") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53568, "mem_53568") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53566, "mem_53566") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53564, "mem_53564") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53561, "mem_53561") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53560, "mem_53560") != 0)
            return 1;
        if (memblock_unref_device(ctx, &ext_mem_53554, "ext_mem_53554") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53553, "mem_53553") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53547, "mem_53547") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53545, "mem_53545") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53543, "mem_53543") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53541, "mem_53541") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53539, "mem_53539") != 0)
            return 1;
        if (memblock_unref_device(ctx, &incprefixes_mem_54614, "incprefixes_mem_54614") != 0)
            return 1;
        if (memblock_unref_device(ctx, &aggregates_mem_54612, "aggregates_mem_54612") != 0)
            return 1;
        if (memblock_unref_device(ctx, &status_flags_mem_54590, "status_flags_mem_54590") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53537, "mem_53537") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53535, "mem_53535") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_54567, "mem_out_54567") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_54566, "mem_out_54566") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_54565, "mem_out_54565") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_54564, "mem_out_54564") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_54563, "mem_out_54563") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_54562, "mem_out_54562") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_54561, "mem_out_54561") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_54560, "mem_out_54560") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_54559, "mem_out_54559") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_54558, "mem_out_54558") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_54557, "mem_out_54557") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_54556, "mem_out_54556") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_54555, "mem_out_54555") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_54554, "mem_out_54554") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_54553, "mem_out_54553") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_54552, "mem_out_54552") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_54551, "mem_out_54551") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_54550, "mem_out_54550") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_54549, "mem_out_54549") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_54548, "mem_out_54548") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_54547, "mem_out_54547") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_54546, "mem_out_54546") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_54545, "mem_out_54545") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_54544, "mem_out_54544") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_54543, "mem_out_54543") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_54542, "mem_out_54542") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_54541, "mem_out_54541") != 0)
            return 1;
    }
    return err;
}
FUTHARK_FUN_ATTR int futrts_entry_flush_dat_double(struct futhark_context *ctx, struct memblock_device *mem_out_p_56991, struct memblock_device *mem_out_p_56992, struct memblock_device *mem_out_p_56993, struct memblock_device chain_collisions_mem_53506, struct memblock_device chain_collisions_mem_53507, struct memblock_device clBase_mem_53508, struct memblock_device clBase_mem_53509, struct memblock_device clBase_mem_53510, struct memblock_device clBase_mem_53511, struct memblock_device clProc_mem_53512, struct memblock_device clProc_mem_53513, struct memblock_device clProc_mem_53514, struct memblock_device clProc_mem_53515, struct memblock_device clProc_mem_53516, struct memblock_device clProc_mem_53517, struct memblock_device current_partition_mem_53518, struct memblock_device current_partition_mem_53519, struct memblock_device current_partition_mem_53520, struct memblock_device current_partition_mem_53521, struct memblock_device current_partition_mem_53522, struct memblock_device current_partition_mem_53523, struct memblock_device current_partition_mem_53524, struct memblock_device current_partition_mem_53525, struct memblock_device current_partition_mem_53526, struct memblock_device current_partition_mem_53527, struct memblock_device current_partition_mem_53528, struct memblock_device current_partition_mem_53529, struct memblock_device toFlush_dat_mem_53530, struct memblock_device toFlush_dat_mem_53531, struct memblock_device toFlush_ids_mem_53532, int64_t n_28651, int64_t part_no_28652, int64_t dz2084U_28653, int64_t dz2080U_28654, int64_t dz2081U_28655, int64_t dz2082U_28656, int64_t dz2083U_28657, int64_t dz2085U_28658, int64_t dz2086U_28659, int8_t clBase_28662, int8_t clBase_28663, double clBase_28664, int64_t clBase_28665, int64_t clBase_28667, double clBase_28670, int64_t clBase_28672, int64_t clProc_28677, int64_t clProc_28678, int64_t clProc_28679, int64_t clProc_28681, int64_t clProc_28682, int64_t current_partition_28696)
{
    (void) ctx;
    
    int err = 0;
    struct memblock_device mem_53536;
    
    mem_53536.references = NULL;
    
    struct memblock_device mem_53534;
    
    mem_53534.references = NULL;
    
    struct memblock_device mem_out_54543;
    
    mem_out_54543.references = NULL;
    
    struct memblock_device mem_out_54542;
    
    mem_out_54542.references = NULL;
    
    struct memblock_device mem_out_54541;
    
    mem_out_54541.references = NULL;
    
    struct memblock_device counters_mem_54551 = ctx->constants->counters_mem_54551;
    struct memblock_device counters_mem_54625 = ctx->constants->counters_mem_54625;
    struct memblock_device counters_mem_55050 = ctx->constants->counters_mem_55050;
    struct memblock_device counters_mem_55495 = ctx->constants->counters_mem_55495;
    struct memblock_device counters_mem_55534 = ctx->constants->counters_mem_55534;
    struct memblock_device counters_mem_55581 = ctx->constants->counters_mem_55581;
    struct memblock_device counters_mem_56605 = ctx->constants->counters_mem_56605;
    struct memblock_device counters_mem_56764 = ctx->constants->counters_mem_56764;
    struct memblock_device counters_mem_56815 = ctx->constants->counters_mem_56815;
    struct memblock_device counters_mem_56850 = ctx->constants->counters_mem_56850;
    struct memblock_device global_dynid_mem_54616 = ctx->constants->global_dynid_mem_54616;
    struct memblock_device global_dynid_mem_54626 = ctx->constants->global_dynid_mem_54626;
    struct memblock_device global_dynid_mem_54637 = ctx->constants->global_dynid_mem_54637;
    struct memblock_device global_dynid_mem_54642 = ctx->constants->global_dynid_mem_54642;
    struct memblock_device global_dynid_mem_54800 = ctx->constants->global_dynid_mem_54800;
    struct memblock_device global_dynid_mem_54871 = ctx->constants->global_dynid_mem_54871;
    struct memblock_device global_dynid_mem_54920 = ctx->constants->global_dynid_mem_54920;
    struct memblock_device global_dynid_mem_55083 = ctx->constants->global_dynid_mem_55083;
    struct memblock_device global_dynid_mem_55112 = ctx->constants->global_dynid_mem_55112;
    struct memblock_device global_dynid_mem_55221 = ctx->constants->global_dynid_mem_55221;
    struct memblock_device global_dynid_mem_55228 = ctx->constants->global_dynid_mem_55228;
    struct memblock_device global_dynid_mem_55334 = ctx->constants->global_dynid_mem_55334;
    struct memblock_device global_dynid_mem_55338 = ctx->constants->global_dynid_mem_55338;
    struct memblock_device global_dynid_mem_55581 = ctx->constants->global_dynid_mem_55581;
    struct memblock_device global_dynid_mem_55728 = ctx->constants->global_dynid_mem_55728;
    struct memblock_device global_dynid_mem_55884 = ctx->constants->global_dynid_mem_55884;
    struct memblock_device global_dynid_mem_56002 = ctx->constants->global_dynid_mem_56002;
    struct memblock_device global_dynid_mem_56151 = ctx->constants->global_dynid_mem_56151;
    struct memblock_device global_dynid_mem_56269 = ctx->constants->global_dynid_mem_56269;
    struct memblock_device global_dynid_mem_56425 = ctx->constants->global_dynid_mem_56425;
    int64_t bytes_53533 = (int64_t) 8 * dz2085U_28658;
    
    if (memblock_alloc_device(ctx, &mem_53534, bytes_53533, "mem_53534")) {
        err = 1;
        goto cleanup;
    }
    if ((err = lmad_copy_gpu2gpu_8b(ctx, 1, mem_53534.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, toFlush_dat_mem_53530.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, (int64_t []) {dz2085U_28658})) != 0)
        goto cleanup;
    if (memblock_alloc_device(ctx, &mem_53536, bytes_53533, "mem_53536")) {
        err = 1;
        goto cleanup;
    }
    if ((err = lmad_copy_gpu2gpu_8b(ctx, 1, mem_53536.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, toFlush_dat_mem_53531.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, (int64_t []) {dz2085U_28658})) != 0)
        goto cleanup;
    if (memblock_set_device(ctx, &mem_out_54541, &toFlush_ids_mem_53532, "toFlush_ids_mem_53532") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_54542, &mem_53534, "mem_53534") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_54543, &mem_53536, "mem_53536") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_56991, &mem_out_54541, "mem_out_54541") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_56992, &mem_out_54542, "mem_out_54542") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_56993, &mem_out_54543, "mem_out_54543") != 0)
        return 1;
    
  cleanup:
    {
        if (memblock_unref_device(ctx, &mem_53536, "mem_53536") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53534, "mem_53534") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_54543, "mem_out_54543") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_54542, "mem_out_54542") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_54541, "mem_out_54541") != 0)
            return 1;
    }
    return err;
}
FUTHARK_FUN_ATTR int futrts_entry_make_collisions_compact_double(struct futhark_context *ctx, struct memblock_device *mem_out_p_56994, struct memblock_device *mem_out_p_56995, int64_t *out_prim_out_56996, struct memblock_device chain_collisions_mem_53506, struct memblock_device chain_collisions_mem_53507, struct memblock_device clBase_mem_53508, struct memblock_device clBase_mem_53509, struct memblock_device clBase_mem_53510, struct memblock_device clBase_mem_53511, struct memblock_device clProc_mem_53512, struct memblock_device clProc_mem_53513, struct memblock_device clProc_mem_53514, struct memblock_device clProc_mem_53515, struct memblock_device clProc_mem_53516, struct memblock_device clProc_mem_53517, struct memblock_device current_partition_mem_53518, struct memblock_device current_partition_mem_53519, struct memblock_device current_partition_mem_53520, struct memblock_device current_partition_mem_53521, struct memblock_device current_partition_mem_53522, struct memblock_device current_partition_mem_53523, struct memblock_device current_partition_mem_53524, struct memblock_device current_partition_mem_53525, struct memblock_device current_partition_mem_53526, struct memblock_device current_partition_mem_53527, struct memblock_device current_partition_mem_53528, struct memblock_device current_partition_mem_53529, struct memblock_device toFlush_dat_mem_53530, struct memblock_device toFlush_dat_mem_53531, struct memblock_device toFlush_ids_mem_53532, int64_t n_37609, int64_t part_no_37610, int64_t dz2084U_37611, int64_t dz2080U_37612, int64_t dz2081U_37613, int64_t dz2082U_37614, int64_t dz2083U_37615, int64_t dz2085U_37616, int64_t dz2086U_37617, int8_t clBase_37620, int8_t clBase_37621, double clBase_37622, int64_t clBase_37623, int64_t clBase_37625, double clBase_37628, int64_t clBase_37630, int64_t clProc_37635, int64_t clProc_37636, int64_t clProc_37637, int64_t clProc_37639, int64_t clProc_37640, int64_t current_partition_37654)
{
    (void) ctx;
    
    int err = 0;
    struct memblock_device mem_53641;
    
    mem_53641.references = NULL;
    
    struct memblock_device mem_53639;
    
    mem_53639.references = NULL;
    
    struct memblock_device incprefixes_mem_54640;
    
    incprefixes_mem_54640.references = NULL;
    
    struct memblock_device aggregates_mem_54638;
    
    aggregates_mem_54638.references = NULL;
    
    struct memblock_device status_flags_mem_54616;
    
    status_flags_mem_54616.references = NULL;
    
    struct memblock_device mem_53637;
    
    mem_53637.references = NULL;
    
    struct memblock_device mem_53635;
    
    mem_53635.references = NULL;
    
    struct memblock_device mem_53533;
    
    mem_53533.references = NULL;
    
    struct memblock_device mem_out_54542;
    
    mem_out_54542.references = NULL;
    
    struct memblock_device mem_out_54541;
    
    mem_out_54541.references = NULL;
    
    struct memblock_device counters_mem_54551 = ctx->constants->counters_mem_54551;
    struct memblock_device counters_mem_54625 = ctx->constants->counters_mem_54625;
    struct memblock_device counters_mem_55050 = ctx->constants->counters_mem_55050;
    struct memblock_device counters_mem_55495 = ctx->constants->counters_mem_55495;
    struct memblock_device counters_mem_55534 = ctx->constants->counters_mem_55534;
    struct memblock_device counters_mem_55581 = ctx->constants->counters_mem_55581;
    struct memblock_device counters_mem_56605 = ctx->constants->counters_mem_56605;
    struct memblock_device counters_mem_56764 = ctx->constants->counters_mem_56764;
    struct memblock_device counters_mem_56815 = ctx->constants->counters_mem_56815;
    struct memblock_device counters_mem_56850 = ctx->constants->counters_mem_56850;
    struct memblock_device global_dynid_mem_54616 = ctx->constants->global_dynid_mem_54616;
    struct memblock_device global_dynid_mem_54626 = ctx->constants->global_dynid_mem_54626;
    struct memblock_device global_dynid_mem_54637 = ctx->constants->global_dynid_mem_54637;
    struct memblock_device global_dynid_mem_54642 = ctx->constants->global_dynid_mem_54642;
    struct memblock_device global_dynid_mem_54800 = ctx->constants->global_dynid_mem_54800;
    struct memblock_device global_dynid_mem_54871 = ctx->constants->global_dynid_mem_54871;
    struct memblock_device global_dynid_mem_54920 = ctx->constants->global_dynid_mem_54920;
    struct memblock_device global_dynid_mem_55083 = ctx->constants->global_dynid_mem_55083;
    struct memblock_device global_dynid_mem_55112 = ctx->constants->global_dynid_mem_55112;
    struct memblock_device global_dynid_mem_55221 = ctx->constants->global_dynid_mem_55221;
    struct memblock_device global_dynid_mem_55228 = ctx->constants->global_dynid_mem_55228;
    struct memblock_device global_dynid_mem_55334 = ctx->constants->global_dynid_mem_55334;
    struct memblock_device global_dynid_mem_55338 = ctx->constants->global_dynid_mem_55338;
    struct memblock_device global_dynid_mem_55581 = ctx->constants->global_dynid_mem_55581;
    struct memblock_device global_dynid_mem_55728 = ctx->constants->global_dynid_mem_55728;
    struct memblock_device global_dynid_mem_55884 = ctx->constants->global_dynid_mem_55884;
    struct memblock_device global_dynid_mem_56002 = ctx->constants->global_dynid_mem_56002;
    struct memblock_device global_dynid_mem_56151 = ctx->constants->global_dynid_mem_56151;
    struct memblock_device global_dynid_mem_56269 = ctx->constants->global_dynid_mem_56269;
    struct memblock_device global_dynid_mem_56425 = ctx->constants->global_dynid_mem_56425;
    int64_t prim_out_54543;
    bool zzero_39866 = dz2084U_37611 == (int64_t) 0;
    bool nonzzero_39867 = !zzero_39866;
    bool nonzzero_cert_39868;
    
    if (!nonzzero_39867) {
        set_error(ctx, msgprintf("Error: %s\n\nBacktrace:\n%s", "division by zero", "-> #0  ft_libs/ftDBSCAN_plus.fut:796:56-60\n   #1  ft_libs/ftDBSCAN_plus.fut:896:18-898:58\n   #2  ft_libs/ftDBSCAN_plus.fut:895:9-898:68\n"));
        err = FUTHARK_PROGRAM_ERROR;
        goto cleanup;
    }
    
    int64_t max_arg1_39869 = sdiv64(clBase_37623, dz2084U_37611);
    int64_t max_res_39870 = smax64((int64_t) 1, max_arg1_39869);
    int64_t zm_lhs_39871 = add64(dz2084U_37611, max_res_39870);
    int64_t zs_lhs_39872 = sub64(zm_lhs_39871, (int64_t) 1);
    bool zzero_39873 = max_res_39870 == (int64_t) 0;
    bool nonzzero_39874 = !zzero_39873;
    bool nonzzero_cert_39875;
    
    if (!nonzzero_39874) {
        set_error(ctx, msgprintf("Error: %s\n\nBacktrace:\n%s", "division by zero", "-> #0  ft_libs/ftDBSCAN_plus.fut:797:58-66\n   #1  ft_libs/ftDBSCAN_plus.fut:896:18-898:58\n   #2  ft_libs/ftDBSCAN_plus.fut:895:9-898:68\n"));
        err = FUTHARK_PROGRAM_ERROR;
        goto cleanup;
    }
    
    int64_t num_iter_39876 = sdiv64(zs_lhs_39872, max_res_39870);
    
    if (memblock_alloc_device(ctx, &mem_53533, dz2084U_37611, "mem_53533")) {
        err = 1;
        goto cleanup;
    }
    if (futrts_builtinzhreplicate_bool(ctx, mem_53533, dz2084U_37611, 1) != 0) {
        err = 1;
        goto cleanup;
    }
    
    bool bounds_invalid_upwards_39878 = slt64(num_iter_39876, (int64_t) 0);
    bool valid_39879 = !bounds_invalid_upwards_39878;
    bool range_valid_c_39880;
    
    if (!valid_39879) {
        set_error(ctx, msgprintf("Error: %s%lld%s%lld%s%lld%s\n\nBacktrace:\n%s", "Range ", (long long) (int64_t) 0, "..", (long long) (int64_t) 1, "..<", (long long) num_iter_39876, " is invalid.", "-> #0  /prelude/array.fut:94:3-11\n   #1  ft_libs/ftDBSCAN_plus.fut:799:81-94\n   #2  ft_libs/ftDBSCAN_plus.fut:896:18-898:58\n   #3  ft_libs/ftDBSCAN_plus.fut:895:9-898:68\n"));
        err = FUTHARK_PROGRAM_ERROR;
        goto cleanup;
    }
    
    int64_t tile_sizze_50095;
    
    tile_sizze_50095 = *ctx->tuning_params.make_collisions_compact_doublezitile_sizze_50094;
    
    int64_t tile_sizze_49826;
    
    tile_sizze_49826 = *ctx->tuning_params.make_collisions_compact_doublezitile_sizze_49825;
    
    int64_t num_whole_tiles_50121 = squot_safe64(dz2084U_37611, tile_sizze_50095);
    int64_t residual_input_50273 = srem_safe64(dz2084U_37611, tile_sizze_50095);
    bool cond_50274 = residual_input_50273 == (int64_t) 0;
    int64_t binop_x_50287 = tile_sizze_50095 * num_whole_tiles_50121;
    int64_t bytes_53556 = (int64_t) 8 * tile_sizze_50095;
    int64_t num_whole_tiles_49852 = squot_safe64(dz2084U_37611, tile_sizze_49826);
    int64_t residual_input_50004 = srem_safe64(dz2084U_37611, tile_sizze_49826);
    bool cond_50005 = residual_input_50004 == (int64_t) 0;
    int64_t binop_x_50018 = tile_sizze_49826 * num_whole_tiles_49852;
    int64_t bytes_53602 = (int64_t) 8 * tile_sizze_49826;
    
    for (int64_t i_39882 = 0; i_39882 < num_iter_39876; i_39882++) {
        int64_t inf_39884 = mul64(max_res_39870, i_39882);
        int64_t min_arg0_39885 = add64(max_res_39870, inf_39884);
        int64_t min_res_39886 = smin64(dz2084U_37611, min_arg0_39885);
        int64_t dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_39887 = sub64(min_res_39886, inf_39884);
        bool bounds_invalid_upwards_39888 = slt64(min_res_39886, inf_39884);
        bool valid_39889 = !bounds_invalid_upwards_39888;
        bool range_valid_c_39890;
        
        if (!valid_39889) {
            set_error(ctx, msgprintf("Error: %s%lld%s%lld%s\n\nBacktrace:\n%s", "Range ", (long long) inf_39884, "..<", (long long) min_res_39886, " is invalid.", "-> #0  ft_libs/ftDBSCAN_plus.fut:802:55-64\n   #1  ft_libs/ftDBSCAN_plus.fut:896:18-898:58\n   #2  ft_libs/ftDBSCAN_plus.fut:895:9-898:68\n"));
            err = FUTHARK_PROGRAM_ERROR;
            goto cleanup;
        }
        
        bool empty_slice_39918 = dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_39887 == (int64_t) 0;
        int64_t m_39919 = sub64(dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_39887, (int64_t) 1);
        int64_t i_p_m_t_s_39920 = add64(inf_39884, m_39919);
        bool zzero_leq_i_p_m_t_s_39921 = sle64((int64_t) 0, i_p_m_t_s_39920);
        bool i_p_m_t_s_leq_w_39922 = slt64(i_p_m_t_s_39920, dz2084U_37611);
        bool zzero_lte_i_39923 = sle64((int64_t) 0, inf_39884);
        bool i_lte_j_39924 = sle64(inf_39884, min_res_39886);
        bool y_39925 = i_p_m_t_s_leq_w_39922 && zzero_lte_i_39923;
        bool y_39926 = zzero_leq_i_p_m_t_s_39921 && y_39925;
        bool forwards_ok_39927 = i_lte_j_39924 && y_39926;
        bool ok_or_empty_39928 = empty_slice_39918 || forwards_ok_39927;
        bool index_certs_39929;
        
        if (!ok_or_empty_39928) {
            set_error(ctx, msgprintf("Error: %s%lld%s%lld%s%lld%s\n\nBacktrace:\n%s", "Index [", (long long) inf_39884, ":", (long long) min_res_39886, "] out of bounds for array of shape [", (long long) dz2084U_37611, "].", "-> #0  ft_libs/ftDBSCAN_plus.fut:813:44-81\n   #1  ft_libs/ftDBSCAN_plus.fut:896:18-898:58\n   #2  ft_libs/ftDBSCAN_plus.fut:895:9-898:68\n"));
            err = FUTHARK_PROGRAM_ERROR;
            goto cleanup;
        }
        
        bool suff_outer_par_45501;
        
        suff_outer_par_45501 = *ctx->tuning_params.make_collisions_compact_doublezisuff_outer_par_0 <= dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_39887;
        if (ctx->logging)
            fprintf(ctx->log, "Compared %s <= %ld: %s.\n", "make_collisions_compact_double.suff_outer_par_0", (long) dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_39887, suff_outer_par_45501 ? "true" : "false");
        
        int64_t shared_memory_capacity_54607;
        
        shared_memory_capacity_54607 = ctx->max_shared_memory;
        if (suff_outer_par_45501 && sle64(sdiv_up64(bytes_53602, (int64_t) 8) * (int64_t) 8 + sdiv_up64(bytes_53602, (int64_t) 8) * (int64_t) 8, shared_memory_capacity_54607)) {
            int64_t ldim_49827 = sdiv_up64(dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_39887, tile_sizze_49826);
            
            if (ctx->debugging)
                fprintf(ctx->log, "%s\n", "\n# SegMap");
            
            int32_t num_chunks_54565 = sext_i64_i32(sdiv_up64(tile_sizze_49826, tile_sizze_49826));
            int32_t virt_num_tblocks_54566 = sext_i64_i32(ldim_49827);
            
            {
                err = gpu_kernel_make_collisions_compact_doublezisegmap_intrablock_49824(ctx, ldim_49827, 1, 1, *ctx->tuning_params.make_collisions_compact_doublezitile_sizze_49825, 1, 1, bytes_53602 + srem64((int64_t) 8 - srem64(bytes_53602, (int64_t) 8), (int64_t) 8) + (bytes_53602 + srem64((int64_t) 8 - srem64(bytes_53602, (int64_t) 8), (int64_t) 8)), dz2084U_37611, inf_39884, dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_39887, ldim_49827, num_whole_tiles_49852, residual_input_50004, cond_50005, binop_x_50018, chain_collisions_mem_53506.mem, chain_collisions_mem_53507.mem, mem_53533.mem);
                if (err != FUTHARK_SUCCESS)
                    goto cleanup;
            }
            ctx->failure_is_an_option = 1;
            if (ctx->debugging)
                fprintf(ctx->log, "%s\n", "");
        } else {
            int64_t ldim_50096 = sdiv_up64(dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_39887, tile_sizze_50095);
            
            if (ctx->debugging)
                fprintf(ctx->log, "%s\n", "\n# SegMap");
            
            int32_t num_chunks_54586 = sext_i64_i32(sdiv_up64(tile_sizze_50095, tile_sizze_50095));
            int32_t virt_num_tblocks_54587 = sext_i64_i32(ldim_50096);
            
            {
                err = gpu_kernel_make_collisions_compact_doublezisegmap_intrablock_50093(ctx, ldim_50096, 1, 1, *ctx->tuning_params.make_collisions_compact_doublezitile_sizze_50094, 1, 1, bytes_53556 + srem64((int64_t) 8 - srem64(bytes_53556, (int64_t) 8), (int64_t) 8) + (bytes_53556 + srem64((int64_t) 8 - srem64(bytes_53556, (int64_t) 8), (int64_t) 8)), dz2084U_37611, inf_39884, dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_39887, ldim_50096, num_whole_tiles_50121, residual_input_50273, cond_50274, binop_x_50287, chain_collisions_mem_53506.mem, chain_collisions_mem_53507.mem, mem_53533.mem);
                if (err != FUTHARK_SUCCESS)
                    goto cleanup;
            }
            ctx->failure_is_an_option = 1;
            if (ctx->debugging)
                fprintf(ctx->log, "%s\n", "");
        }
    }
    
    int64_t segscan_tblock_sizze_45649;
    
    segscan_tblock_sizze_45649 = *ctx->tuning_params.make_collisions_compact_doublezisegscan_tblock_sizze_45648;
    
    int64_t num_tblocks_45651;
    int64_t max_num_tblocks_54608;
    
    max_num_tblocks_54608 = *ctx->tuning_params.make_collisions_compact_doublezisegscan_num_tblocks_45650;
    num_tblocks_45651 = sext_i64_i32(smax64((int64_t) 1, smin64(sdiv_up64(dz2084U_37611, segscan_tblock_sizze_45649), max_num_tblocks_54608)));
    
    int64_t bytes_53634 = (int64_t) 8 * dz2084U_37611;
    
    if (memblock_alloc_device(ctx, &mem_53635, bytes_53634, "mem_53635")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_53637, bytes_53634, "mem_53637")) {
        err = 1;
        goto cleanup;
    }
    if (slt64((int64_t) 0, dz2084U_37611)) {
        if (ctx->debugging)
            fprintf(ctx->log, "%s\n", "\n# SegScan");
        
        int64_t shared_memory_54609;
        
        shared_memory_54609 = ctx->max_shared_memory;
        
        int64_t thread_block_sizze_54610;
        
        thread_block_sizze_54610 = ctx->max_thread_block_size;
        
        int64_t registers_54611;
        
        registers_54611 = ctx->max_registers;
        
        int64_t thread_block_sizze_54612;
        
        thread_block_sizze_54612 = ctx->max_thread_block_size;
        
        int64_t chunk_sizze_54613 = smax64((int64_t) 1, smin64(squot64(squot64(shared_memory_54609, thread_block_sizze_54610), (int64_t) 8), squot64(squot64(registers_54611, thread_block_sizze_54612) - (int64_t) 1 - squot64(smax64((int64_t) 4, (int64_t) 8), (int64_t) 4), (int64_t) 2 * squot64(smax64((int64_t) 4, (int64_t) 8), (int64_t) 4))));
        int64_t num_virt_blocks_54614 = sdiv_up64(dz2084U_37611, segscan_tblock_sizze_45649 * chunk_sizze_54613);
        int64_t num_virt_threads_54615 = num_virt_blocks_54614 * segscan_tblock_sizze_45649;
        
        if (ctx->debugging)
            fprintf(ctx->log, "%s: %llu%c", "Sequential elements per thread (chunk)", (long long) chunk_sizze_54613, '\n');
        if (memblock_alloc_device(ctx, &status_flags_mem_54616, num_virt_blocks_54614, "status_flags_mem_54616")) {
            err = 1;
            goto cleanup;
        }
        if (futrts_builtinzhreplicate_i8(ctx, status_flags_mem_54616, num_virt_blocks_54614, (int8_t) 0) != 0) {
            err = 1;
            goto cleanup;
        }
        if (memblock_alloc_device(ctx, &aggregates_mem_54638, (int64_t) 8 * num_virt_blocks_54614, "aggregates_mem_54638")) {
            err = 1;
            goto cleanup;
        }
        if (memblock_alloc_device(ctx, &incprefixes_mem_54640, (int64_t) 8 * num_virt_blocks_54614, "incprefixes_mem_54640")) {
            err = 1;
            goto cleanup;
        }
        {
            err = gpu_kernel_make_collisions_compact_doublezisegscan_45654(ctx, num_tblocks_45651, 1, 1, *ctx->tuning_params.make_collisions_compact_doublezisegscan_tblock_sizze_45648, 1, 1, smax64(smax64((int64_t) 288, (int64_t) 8 * segscan_tblock_sizze_45649), chunk_sizze_54613 * segscan_tblock_sizze_45649 * (int64_t) 8) + srem64((int64_t) 8 - srem64(smax64(smax64((int64_t) 288, (int64_t) 8 * segscan_tblock_sizze_45649), chunk_sizze_54613 * segscan_tblock_sizze_45649 * (int64_t) 8), (int64_t) 8), (int64_t) 8), dz2084U_37611, num_tblocks_45651, num_virt_blocks_54614, num_virt_threads_54615, mem_53533.mem, mem_53635.mem, mem_53637.mem, status_flags_mem_54616.mem, aggregates_mem_54638.mem, incprefixes_mem_54640.mem, global_dynid_mem_54642.mem);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        if (ctx->debugging)
            fprintf(ctx->log, "%s\n", "");
    }
    if (memblock_unref_device(ctx, &mem_53533, "mem_53533") != 0)
        return 1;
    
    int64_t tmp_39951 = sub64(dz2084U_37611, (int64_t) 1);
    bool x_39952 = sle64((int64_t) 0, tmp_39951);
    bool y_39953 = slt64(tmp_39951, dz2084U_37611);
    bool bounds_check_39954 = x_39952 && y_39953;
    bool protect_assert_disj_39955 = zzero_39866 || bounds_check_39954;
    bool index_certs_39956;
    
    if (!protect_assert_disj_39955) {
        set_error(ctx, msgprintf("Error: %s%lld%s%lld%s\n\nBacktrace:\n%s", "Index [", (long long) tmp_39951, "] out of bounds for array of shape [", (long long) dz2084U_37611, "].", "-> #0  /prelude/soacs.fut:257:33-47\n   #1  /prelude/functional.fut:9:44-45\n   #2  ft_libs/ftDBSCAN_plus.fut:896:18-898:58\n   #3  ft_libs/ftDBSCAN_plus.fut:895:9-898:68\n"));
        err = FUTHARK_PROGRAM_ERROR;
        goto cleanup;
    }
    
    int64_t m_f_res_39957;
    
    if (nonzzero_39867) {
        int64_t read_res_56997;
        
        if ((err = gpu_scalar_from_device(ctx, &read_res_56997, mem_53635.mem, tmp_39951 * sizeof(int64_t), sizeof(int64_t))) != 0)
            goto cleanup;
        if (ctx->failure_is_an_option && futhark_context_sync(ctx) != 0) {
            err = 1;
            goto cleanup;
        }
        
        int64_t x_44750 = read_res_56997;
        
        m_f_res_39957 = x_44750;
    } else {
        m_f_res_39957 = (int64_t) 0;
    }
    
    int64_t m_39959;
    
    if (zzero_39866) {
        m_39959 = (int64_t) 0;
    } else {
        m_39959 = m_f_res_39957;
    }
    
    int64_t m_39969 = sub64(m_39959, (int64_t) 1);
    bool i_p_m_t_s_leq_w_39971 = slt64(m_39969, dz2084U_37611);
    bool zzero_leq_i_p_m_t_s_39970 = sle64((int64_t) 0, m_39969);
    bool y_39973 = zzero_leq_i_p_m_t_s_39970 && i_p_m_t_s_leq_w_39971;
    bool i_lte_j_39972 = sle64((int64_t) 0, m_39959);
    bool forwards_ok_39974 = i_lte_j_39972 && y_39973;
    bool eq_x_zz_39966 = (int64_t) 0 == m_f_res_39957;
    bool p_and_eq_x_y_39967 = nonzzero_39867 && eq_x_zz_39966;
    bool empty_slice_39968 = zzero_39866 || p_and_eq_x_y_39967;
    bool ok_or_empty_39975 = empty_slice_39968 || forwards_ok_39974;
    bool index_certs_39976;
    
    if (!ok_or_empty_39975) {
        set_error(ctx, msgprintf("Error: %s%lld%s%lld%s\n\nBacktrace:\n%s", "Index [:", (long long) m_39959, "] out of bounds for array of shape [", (long long) dz2084U_37611, "].", "-> #0  /prelude/soacs.fut:258:29-35\n   #1  /prelude/functional.fut:9:44-45\n   #2  ft_libs/ftDBSCAN_plus.fut:896:18-898:58\n   #3  ft_libs/ftDBSCAN_plus.fut:895:9-898:68\n"));
        err = FUTHARK_PROGRAM_ERROR;
        goto cleanup;
    }
    
    int64_t bytes_53638 = (int64_t) 8 * m_39959;
    
    if (memblock_alloc_device(ctx, &mem_53639, bytes_53638, "mem_53639")) {
        err = 1;
        goto cleanup;
    }
    if ((err = lmad_copy_gpu2gpu_8b(ctx, 1, mem_53639.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, chain_collisions_mem_53507.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, (int64_t []) {m_39959})) != 0)
        goto cleanup;
    if (memblock_alloc_device(ctx, &mem_53641, bytes_53638, "mem_53641")) {
        err = 1;
        goto cleanup;
    }
    if ((err = lmad_copy_gpu2gpu_8b(ctx, 1, mem_53641.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, chain_collisions_mem_53506.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, (int64_t []) {m_39959})) != 0)
        goto cleanup;
    
    int64_t segmap_tblock_sizze_45659;
    
    segmap_tblock_sizze_45659 = *ctx->tuning_params.make_collisions_compact_doublezisegmap_tblock_sizze_45658;
    
    int64_t num_tblocks_45661;
    int64_t max_num_tblocks_54751;
    
    max_num_tblocks_54751 = *ctx->tuning_params.make_collisions_compact_doublezisegmap_num_tblocks_45660;
    num_tblocks_45661 = sext_i64_i32(smax64((int64_t) 1, smin64(sdiv_up64(dz2084U_37611, segmap_tblock_sizze_45659), max_num_tblocks_54751)));
    if (ctx->debugging)
        fprintf(ctx->log, "%s\n", "\n# SegMap");
    
    int32_t virt_num_tblocks_54752 = sext_i64_i32(sdiv_up64(dz2084U_37611, segmap_tblock_sizze_45659));
    
    {
        err = gpu_kernel_make_collisions_compact_doublezisegmap_45656(ctx, num_tblocks_45661, 1, 1, *ctx->tuning_params.make_collisions_compact_doublezisegmap_tblock_sizze_45658, 1, 1, (int64_t) 0, dz2084U_37611, m_39959, num_tblocks_45661, virt_num_tblocks_54752, chain_collisions_mem_53506.mem, chain_collisions_mem_53507.mem, mem_53635.mem, mem_53637.mem, mem_53639.mem, mem_53641.mem);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (ctx->debugging)
        fprintf(ctx->log, "%s\n", "");
    if (memblock_unref_device(ctx, &mem_53635, "mem_53635") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_53637, "mem_53637") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_54541, &mem_53641, "mem_53641") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_54542, &mem_53639, "mem_53639") != 0)
        return 1;
    prim_out_54543 = m_39959;
    if (memblock_set_device(ctx, &*mem_out_p_56994, &mem_out_54541, "mem_out_54541") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_56995, &mem_out_54542, "mem_out_54542") != 0)
        return 1;
    *out_prim_out_56996 = prim_out_54543;
    
  cleanup:
    {
        if (memblock_unref_device(ctx, &mem_53641, "mem_53641") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53639, "mem_53639") != 0)
            return 1;
        if (memblock_unref_device(ctx, &incprefixes_mem_54640, "incprefixes_mem_54640") != 0)
            return 1;
        if (memblock_unref_device(ctx, &aggregates_mem_54638, "aggregates_mem_54638") != 0)
            return 1;
        if (memblock_unref_device(ctx, &status_flags_mem_54616, "status_flags_mem_54616") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53637, "mem_53637") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53635, "mem_53635") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53533, "mem_53533") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_54542, "mem_out_54542") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_54541, "mem_out_54541") != 0)
            return 1;
    }
    return err;
}
FUTHARK_FUN_ATTR int futrts_entry_mk_dbcHandler_double(struct futhark_context *ctx, struct memblock_device *mem_out_p_56998, struct memblock_device *mem_out_p_56999, struct memblock_device *mem_out_p_57000, struct memblock_device *mem_out_p_57001, struct memblock_device *mem_out_p_57002, struct memblock_device *mem_out_p_57003, struct memblock_device *mem_out_p_57004, struct memblock_device *mem_out_p_57005, struct memblock_device *mem_out_p_57006, struct memblock_device *mem_out_p_57007, struct memblock_device *mem_out_p_57008, struct memblock_device *mem_out_p_57009, struct memblock_device *mem_out_p_57010, struct memblock_device *mem_out_p_57011, struct memblock_device *mem_out_p_57012, struct memblock_device *mem_out_p_57013, struct memblock_device *mem_out_p_57014, struct memblock_device *mem_out_p_57015, struct memblock_device *mem_out_p_57016, struct memblock_device *mem_out_p_57017, struct memblock_device *mem_out_p_57018, struct memblock_device *mem_out_p_57019, struct memblock_device *mem_out_p_57020, struct memblock_device *mem_out_p_57021, struct memblock_device *mem_out_p_57022, struct memblock_device *mem_out_p_57023, struct memblock_device *mem_out_p_57024, int64_t *out_prim_out_57025, int8_t *out_prim_out_57026, int8_t *out_prim_out_57027, double *out_prim_out_57028, int64_t *out_prim_out_57029, int64_t *out_prim_out_57030, double *out_prim_out_57031, int64_t *out_prim_out_57032, int64_t *out_prim_out_57033, int64_t *out_prim_out_57034, int64_t *out_prim_out_57035, int64_t *out_prim_out_57036, int64_t *out_prim_out_57037, int64_t *out_prim_out_57038, double min_x_23482, double min_y_23483, double max_x_23484, double max_y_23485, int64_t parts_x_23486, int64_t parts_y_23487, bool isEuclidean_23488, bool isRadians_23489, double radius_23490, double eps_23491, int64_t minPts_23492, int64_t m_sizze_23493)
{
    (void) ctx;
    
    int err = 0;
    struct memblock_device mem_53536;
    
    mem_53536.references = NULL;
    
    struct memblock_device mem_53535;
    
    mem_53535.references = NULL;
    
    struct memblock_device mem_53534;
    
    mem_53534.references = NULL;
    
    struct memblock_device mem_53533;
    
    mem_53533.references = NULL;
    
    struct memblock_device mem_53532;
    
    mem_53532.references = NULL;
    
    struct memblock_device mem_53531;
    
    mem_53531.references = NULL;
    
    struct memblock_device mem_53530;
    
    mem_53530.references = NULL;
    
    struct memblock_device mem_53529;
    
    mem_53529.references = NULL;
    
    struct memblock_device mem_53528;
    
    mem_53528.references = NULL;
    
    struct memblock_device mem_53527;
    
    mem_53527.references = NULL;
    
    struct memblock_device mem_53526;
    
    mem_53526.references = NULL;
    
    struct memblock_device mem_53525;
    
    mem_53525.references = NULL;
    
    struct memblock_device mem_53524;
    
    mem_53524.references = NULL;
    
    struct memblock_device mem_53523;
    
    mem_53523.references = NULL;
    
    struct memblock_device mem_53522;
    
    mem_53522.references = NULL;
    
    struct memblock_device mem_53521;
    
    mem_53521.references = NULL;
    
    struct memblock_device mem_53520;
    
    mem_53520.references = NULL;
    
    struct memblock_device mem_53519;
    
    mem_53519.references = NULL;
    
    struct memblock_device mem_53518;
    
    mem_53518.references = NULL;
    
    struct memblock_device mem_53517;
    
    mem_53517.references = NULL;
    
    struct memblock_device mem_53516;
    
    mem_53516.references = NULL;
    
    struct memblock_device mem_53515;
    
    mem_53515.references = NULL;
    
    struct memblock_device mem_53514;
    
    mem_53514.references = NULL;
    
    struct memblock_device mem_53513;
    
    mem_53513.references = NULL;
    
    struct memblock_device mem_53512;
    
    mem_53512.references = NULL;
    
    struct memblock_device mem_53511;
    
    mem_53511.references = NULL;
    
    struct memblock_device mem_53510;
    
    mem_53510.references = NULL;
    
    struct memblock_device mem_53509;
    
    mem_53509.references = NULL;
    
    struct memblock_device mem_53508;
    
    mem_53508.references = NULL;
    
    struct memblock_device mem_53507;
    
    mem_53507.references = NULL;
    
    struct memblock_device mem_53506;
    
    mem_53506.references = NULL;
    
    struct memblock_device mem_out_54567;
    
    mem_out_54567.references = NULL;
    
    struct memblock_device mem_out_54566;
    
    mem_out_54566.references = NULL;
    
    struct memblock_device mem_out_54565;
    
    mem_out_54565.references = NULL;
    
    struct memblock_device mem_out_54564;
    
    mem_out_54564.references = NULL;
    
    struct memblock_device mem_out_54563;
    
    mem_out_54563.references = NULL;
    
    struct memblock_device mem_out_54562;
    
    mem_out_54562.references = NULL;
    
    struct memblock_device mem_out_54561;
    
    mem_out_54561.references = NULL;
    
    struct memblock_device mem_out_54560;
    
    mem_out_54560.references = NULL;
    
    struct memblock_device mem_out_54559;
    
    mem_out_54559.references = NULL;
    
    struct memblock_device mem_out_54558;
    
    mem_out_54558.references = NULL;
    
    struct memblock_device mem_out_54557;
    
    mem_out_54557.references = NULL;
    
    struct memblock_device mem_out_54556;
    
    mem_out_54556.references = NULL;
    
    struct memblock_device mem_out_54555;
    
    mem_out_54555.references = NULL;
    
    struct memblock_device mem_out_54554;
    
    mem_out_54554.references = NULL;
    
    struct memblock_device mem_out_54553;
    
    mem_out_54553.references = NULL;
    
    struct memblock_device mem_out_54552;
    
    mem_out_54552.references = NULL;
    
    struct memblock_device mem_out_54551;
    
    mem_out_54551.references = NULL;
    
    struct memblock_device mem_out_54550;
    
    mem_out_54550.references = NULL;
    
    struct memblock_device mem_out_54549;
    
    mem_out_54549.references = NULL;
    
    struct memblock_device mem_out_54548;
    
    mem_out_54548.references = NULL;
    
    struct memblock_device mem_out_54547;
    
    mem_out_54547.references = NULL;
    
    struct memblock_device mem_out_54546;
    
    mem_out_54546.references = NULL;
    
    struct memblock_device mem_out_54545;
    
    mem_out_54545.references = NULL;
    
    struct memblock_device mem_out_54544;
    
    mem_out_54544.references = NULL;
    
    struct memblock_device mem_out_54543;
    
    mem_out_54543.references = NULL;
    
    struct memblock_device mem_out_54542;
    
    mem_out_54542.references = NULL;
    
    struct memblock_device mem_out_54541;
    
    mem_out_54541.references = NULL;
    
    struct memblock_device counters_mem_54551 = ctx->constants->counters_mem_54551;
    struct memblock_device counters_mem_54625 = ctx->constants->counters_mem_54625;
    struct memblock_device counters_mem_55050 = ctx->constants->counters_mem_55050;
    struct memblock_device counters_mem_55495 = ctx->constants->counters_mem_55495;
    struct memblock_device counters_mem_55534 = ctx->constants->counters_mem_55534;
    struct memblock_device counters_mem_55581 = ctx->constants->counters_mem_55581;
    struct memblock_device counters_mem_56605 = ctx->constants->counters_mem_56605;
    struct memblock_device counters_mem_56764 = ctx->constants->counters_mem_56764;
    struct memblock_device counters_mem_56815 = ctx->constants->counters_mem_56815;
    struct memblock_device counters_mem_56850 = ctx->constants->counters_mem_56850;
    struct memblock_device global_dynid_mem_54616 = ctx->constants->global_dynid_mem_54616;
    struct memblock_device global_dynid_mem_54626 = ctx->constants->global_dynid_mem_54626;
    struct memblock_device global_dynid_mem_54637 = ctx->constants->global_dynid_mem_54637;
    struct memblock_device global_dynid_mem_54642 = ctx->constants->global_dynid_mem_54642;
    struct memblock_device global_dynid_mem_54800 = ctx->constants->global_dynid_mem_54800;
    struct memblock_device global_dynid_mem_54871 = ctx->constants->global_dynid_mem_54871;
    struct memblock_device global_dynid_mem_54920 = ctx->constants->global_dynid_mem_54920;
    struct memblock_device global_dynid_mem_55083 = ctx->constants->global_dynid_mem_55083;
    struct memblock_device global_dynid_mem_55112 = ctx->constants->global_dynid_mem_55112;
    struct memblock_device global_dynid_mem_55221 = ctx->constants->global_dynid_mem_55221;
    struct memblock_device global_dynid_mem_55228 = ctx->constants->global_dynid_mem_55228;
    struct memblock_device global_dynid_mem_55334 = ctx->constants->global_dynid_mem_55334;
    struct memblock_device global_dynid_mem_55338 = ctx->constants->global_dynid_mem_55338;
    struct memblock_device global_dynid_mem_55581 = ctx->constants->global_dynid_mem_55581;
    struct memblock_device global_dynid_mem_55728 = ctx->constants->global_dynid_mem_55728;
    struct memblock_device global_dynid_mem_55884 = ctx->constants->global_dynid_mem_55884;
    struct memblock_device global_dynid_mem_56002 = ctx->constants->global_dynid_mem_56002;
    struct memblock_device global_dynid_mem_56151 = ctx->constants->global_dynid_mem_56151;
    struct memblock_device global_dynid_mem_56269 = ctx->constants->global_dynid_mem_56269;
    struct memblock_device global_dynid_mem_56425 = ctx->constants->global_dynid_mem_56425;
    int64_t prim_out_54568;
    int8_t prim_out_54569;
    int8_t prim_out_54570;
    double prim_out_54571;
    int64_t prim_out_54572;
    int64_t prim_out_54573;
    double prim_out_54574;
    int64_t prim_out_54575;
    int64_t prim_out_54576;
    int64_t prim_out_54577;
    int64_t prim_out_54578;
    int64_t prim_out_54579;
    int64_t prim_out_54580;
    int64_t prim_out_54581;
    int64_t dzlz7bUZLztZRz20Uparts_xz20Uparts_yz7dUzg_39208 = mul64(parts_x_23486, parts_y_23487);
    bool cond_neg_39205 = !isEuclidean_23488;
    int8_t dist_type_39206 = btoi_bool_i8(cond_neg_39205);
    int8_t angle_type_39207 = btoi_bool_i8(isRadians_23489);
    double i64_res_39211 = sitofp_i64_f64(parts_x_23486);
    double zm_res_39212 = max_x_23484 - min_x_23482;
    double zs_res_39213 = zm_res_39212 / i64_res_39211;
    double i64_res_39214 = sitofp_i64_f64(parts_y_23487);
    double zm_res_39215 = max_y_23485 - min_y_23483;
    double zs_res_39216 = zm_res_39215 / i64_res_39214;
    
    if (memblock_alloc_device(ctx, &mem_53506, dzlz7bUZLztZRz20Uparts_xz20Uparts_yz7dUzg_39208, "mem_53506")) {
        err = 1;
        goto cleanup;
    }
    if (futrts_builtinzhreplicate_bool(ctx, mem_53506, dzlz7bUZLztZRz20Uparts_xz20Uparts_yz7dUzg_39208, 0) != 0) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_53507, (int64_t) 0, "mem_53507")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_53508, (int64_t) 0, "mem_53508")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_53509, (int64_t) 0, "mem_53509")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_53510, (int64_t) 0, "mem_53510")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_53511, (int64_t) 0, "mem_53511")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_53512, (int64_t) 16, "mem_53512")) {
        err = 1;
        goto cleanup;
    }
    if (futrts_builtinzhreplicate_f64(ctx, mem_53512, (int64_t) 2, INFINITY) != 0) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_53513, (int64_t) 16, "mem_53513")) {
        err = 1;
        goto cleanup;
    }
    if (futrts_builtinzhreplicate_f64(ctx, mem_53513, (int64_t) 2, -INFINITY) != 0) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_53514, (int64_t) 16, "mem_53514")) {
        err = 1;
        goto cleanup;
    }
    if (futrts_builtinzhreplicate_f64(ctx, mem_53514, (int64_t) 2, INFINITY) != 0) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_53515, (int64_t) 16, "mem_53515")) {
        err = 1;
        goto cleanup;
    }
    if (futrts_builtinzhreplicate_f64(ctx, mem_53515, (int64_t) 2, -INFINITY) != 0) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_53516, (int64_t) 64, "mem_53516")) {
        err = 1;
        goto cleanup;
    }
    if (futrts_builtinzhreplicate_i64(ctx, mem_53516, (int64_t) 8, (int64_t) -1) != 0) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_53517, (int64_t) 8, "mem_53517")) {
        err = 1;
        goto cleanup;
    }
    if (futrts_builtinzhreplicate_bool(ctx, mem_53517, (int64_t) 8, 0) != 0) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_53518, (int64_t) 0, "mem_53518")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_53519, (int64_t) 0, "mem_53519")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_53520, (int64_t) 0, "mem_53520")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_53521, (int64_t) 0, "mem_53521")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_53522, (int64_t) 0, "mem_53522")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_53523, (int64_t) 0, "mem_53523")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_53524, (int64_t) 0, "mem_53524")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_53525, (int64_t) 0, "mem_53525")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_53526, (int64_t) 0, "mem_53526")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_53527, (int64_t) 0, "mem_53527")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_53528, (int64_t) 0, "mem_53528")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_53529, (int64_t) 16, "mem_53529")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_53530, (int64_t) 16, "mem_53530")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_53531, (int64_t) 16, "mem_53531")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_53532, (int64_t) 16, "mem_53532")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_53533, (int64_t) 16, "mem_53533")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_53534, (int64_t) 16, "mem_53534")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_53535, (int64_t) 16, "mem_53535")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_53536, (int64_t) 16, "mem_53536")) {
        err = 1;
        goto cleanup;
    }
    {
        err = gpu_kernel_mk_dbcHandler_doublezigpuseq_54642(ctx, (int64_t) 1, 1, 1, (int64_t) 1, 1, 1, (int64_t) 0, min_x_23482, min_y_23483, max_x_23484, max_y_23485, parts_x_23486, parts_y_23487, zs_res_39213, zs_res_39216, mem_53529.mem, mem_53530.mem, mem_53531.mem, mem_53532.mem, mem_53533.mem, mem_53534.mem, mem_53535.mem, mem_53536.mem);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (memblock_unref_device(ctx, &mem_53529, "mem_53529") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_53530, "mem_53530") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_53531, "mem_53531") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_53532, "mem_53532") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_54541, &mem_53527, "mem_53527") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_54542, &mem_53528, "mem_53528") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_54543, &mem_53534, "mem_53534") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_54544, &mem_53533, "mem_53533") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_54545, &mem_53536, "mem_53536") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_54546, &mem_53535, "mem_53535") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_54547, &mem_53507, "mem_53507") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_54548, &mem_53508, "mem_53508") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_54549, &mem_53509, "mem_53509") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_54550, &mem_53510, "mem_53510") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_54551, &mem_53506, "mem_53506") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_54552, &mem_53511, "mem_53511") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_54553, &mem_53518, "mem_53518") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_54554, &mem_53519, "mem_53519") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_54555, &mem_53520, "mem_53520") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_54556, &mem_53515, "mem_53515") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_54557, &mem_53514, "mem_53514") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_54558, &mem_53521, "mem_53521") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_54559, &mem_53522, "mem_53522") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_54560, &mem_53517, "mem_53517") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_54561, &mem_53523, "mem_53523") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_54562, &mem_53513, "mem_53513") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_54563, &mem_53512, "mem_53512") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_54564, &mem_53516, "mem_53516") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_54565, &mem_53524, "mem_53524") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_54566, &mem_53525, "mem_53525") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_54567, &mem_53526, "mem_53526") != 0)
        return 1;
    prim_out_54568 = dzlz7bUZLztZRz20Uparts_xz20Uparts_yz7dUzg_39208;
    prim_out_54569 = angle_type_39207;
    prim_out_54570 = dist_type_39206;
    prim_out_54571 = eps_23491;
    prim_out_54572 = m_sizze_23493;
    prim_out_54573 = minPts_23492;
    prim_out_54574 = radius_23490;
    prim_out_54575 = dzlz7bUZLztZRz20Uparts_xz20Uparts_yz7dUzg_39208;
    prim_out_54576 = (int64_t) 0;
    prim_out_54577 = (int64_t) -1;
    prim_out_54578 = (int64_t) -1;
    prim_out_54579 = (int64_t) 0;
    prim_out_54580 = (int64_t) -1;
    prim_out_54581 = (int64_t) -1;
    if (memblock_set_device(ctx, &*mem_out_p_56998, &mem_out_54541, "mem_out_54541") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_56999, &mem_out_54542, "mem_out_54542") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_57000, &mem_out_54543, "mem_out_54543") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_57001, &mem_out_54544, "mem_out_54544") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_57002, &mem_out_54545, "mem_out_54545") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_57003, &mem_out_54546, "mem_out_54546") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_57004, &mem_out_54547, "mem_out_54547") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_57005, &mem_out_54548, "mem_out_54548") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_57006, &mem_out_54549, "mem_out_54549") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_57007, &mem_out_54550, "mem_out_54550") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_57008, &mem_out_54551, "mem_out_54551") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_57009, &mem_out_54552, "mem_out_54552") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_57010, &mem_out_54553, "mem_out_54553") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_57011, &mem_out_54554, "mem_out_54554") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_57012, &mem_out_54555, "mem_out_54555") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_57013, &mem_out_54556, "mem_out_54556") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_57014, &mem_out_54557, "mem_out_54557") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_57015, &mem_out_54558, "mem_out_54558") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_57016, &mem_out_54559, "mem_out_54559") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_57017, &mem_out_54560, "mem_out_54560") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_57018, &mem_out_54561, "mem_out_54561") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_57019, &mem_out_54562, "mem_out_54562") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_57020, &mem_out_54563, "mem_out_54563") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_57021, &mem_out_54564, "mem_out_54564") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_57022, &mem_out_54565, "mem_out_54565") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_57023, &mem_out_54566, "mem_out_54566") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_57024, &mem_out_54567, "mem_out_54567") != 0)
        return 1;
    *out_prim_out_57025 = prim_out_54568;
    *out_prim_out_57026 = prim_out_54569;
    *out_prim_out_57027 = prim_out_54570;
    *out_prim_out_57028 = prim_out_54571;
    *out_prim_out_57029 = prim_out_54572;
    *out_prim_out_57030 = prim_out_54573;
    *out_prim_out_57031 = prim_out_54574;
    *out_prim_out_57032 = prim_out_54575;
    *out_prim_out_57033 = prim_out_54576;
    *out_prim_out_57034 = prim_out_54577;
    *out_prim_out_57035 = prim_out_54578;
    *out_prim_out_57036 = prim_out_54579;
    *out_prim_out_57037 = prim_out_54580;
    *out_prim_out_57038 = prim_out_54581;
    
  cleanup:
    {
        if (memblock_unref_device(ctx, &mem_53536, "mem_53536") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53535, "mem_53535") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53534, "mem_53534") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53533, "mem_53533") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53532, "mem_53532") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53531, "mem_53531") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53530, "mem_53530") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53529, "mem_53529") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53528, "mem_53528") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53527, "mem_53527") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53526, "mem_53526") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53525, "mem_53525") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53524, "mem_53524") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53523, "mem_53523") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53522, "mem_53522") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53521, "mem_53521") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53520, "mem_53520") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53519, "mem_53519") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53518, "mem_53518") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53517, "mem_53517") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53516, "mem_53516") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53515, "mem_53515") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53514, "mem_53514") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53513, "mem_53513") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53512, "mem_53512") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53511, "mem_53511") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53510, "mem_53510") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53509, "mem_53509") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53508, "mem_53508") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53507, "mem_53507") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53506, "mem_53506") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_54567, "mem_out_54567") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_54566, "mem_out_54566") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_54565, "mem_out_54565") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_54564, "mem_out_54564") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_54563, "mem_out_54563") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_54562, "mem_out_54562") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_54561, "mem_out_54561") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_54560, "mem_out_54560") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_54559, "mem_out_54559") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_54558, "mem_out_54558") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_54557, "mem_out_54557") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_54556, "mem_out_54556") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_54555, "mem_out_54555") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_54554, "mem_out_54554") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_54553, "mem_out_54553") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_54552, "mem_out_54552") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_54551, "mem_out_54551") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_54550, "mem_out_54550") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_54549, "mem_out_54549") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_54548, "mem_out_54548") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_54547, "mem_out_54547") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_54546, "mem_out_54546") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_54545, "mem_out_54545") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_54544, "mem_out_54544") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_54543, "mem_out_54543") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_54542, "mem_out_54542") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_54541, "mem_out_54541") != 0)
            return 1;
    }
    return err;
}
FUTHARK_FUN_ATTR int futrts_entry_next_partition_to_read_double(struct futhark_context *ctx, int64_t *out_prim_out_57039, struct memblock_device chain_collisions_mem_53506, struct memblock_device chain_collisions_mem_53507, struct memblock_device clBase_mem_53508, struct memblock_device clBase_mem_53509, struct memblock_device clBase_mem_53510, struct memblock_device clBase_mem_53511, struct memblock_device clProc_mem_53512, struct memblock_device clProc_mem_53513, struct memblock_device clProc_mem_53514, struct memblock_device clProc_mem_53515, struct memblock_device clProc_mem_53516, struct memblock_device clProc_mem_53517, struct memblock_device current_partition_mem_53518, struct memblock_device current_partition_mem_53519, struct memblock_device current_partition_mem_53520, struct memblock_device current_partition_mem_53521, struct memblock_device current_partition_mem_53522, struct memblock_device current_partition_mem_53523, struct memblock_device current_partition_mem_53524, struct memblock_device current_partition_mem_53525, struct memblock_device current_partition_mem_53526, struct memblock_device current_partition_mem_53527, struct memblock_device current_partition_mem_53528, struct memblock_device current_partition_mem_53529, struct memblock_device toFlush_dat_mem_53530, struct memblock_device toFlush_dat_mem_53531, struct memblock_device toFlush_ids_mem_53532, int64_t n_24089, int64_t part_no_24090, int64_t dz2084U_24091, int64_t dz2080U_24092, int64_t dz2081U_24093, int64_t dz2082U_24094, int64_t dz2083U_24095, int64_t dz2085U_24096, int64_t dz2086U_24097, int8_t clBase_24100, int8_t clBase_24101, double clBase_24102, int64_t clBase_24103, int64_t clBase_24105, double clBase_24108, int64_t clBase_24110, int64_t clProc_24115, int64_t clProc_24116, int64_t clProc_24117, int64_t clProc_24119, int64_t clProc_24120, int64_t current_partition_24134)
{
    (void) ctx;
    
    int err = 0;
    struct memblock_device mem_53535;
    
    mem_53535.references = NULL;
    
    struct memblock_device mem_53544;
    
    mem_53544.references = NULL;
    
    struct memblock_device mem_53542;
    
    mem_53542.references = NULL;
    
    struct memblock_device incprefixes_mem_54635;
    
    incprefixes_mem_54635.references = NULL;
    
    struct memblock_device aggregates_mem_54633;
    
    aggregates_mem_54633.references = NULL;
    
    struct memblock_device status_flags_mem_54611;
    
    status_flags_mem_54611.references = NULL;
    
    struct memblock_device mem_53540;
    
    mem_53540.references = NULL;
    
    struct memblock_device mem_53538;
    
    mem_53538.references = NULL;
    
    struct memblock_device ext_mem_53545;
    
    ext_mem_53545.references = NULL;
    
    struct memblock_device segred_tmp_mem_54573;
    
    segred_tmp_mem_54573.references = NULL;
    
    struct memblock_device mem_53534;
    
    mem_53534.references = NULL;
    
    struct memblock_device mem_53546;
    
    mem_53546.references = NULL;
    
    struct memblock_device ext_mem_53547;
    
    ext_mem_53547.references = NULL;
    
    struct memblock_device counters_mem_54551 = ctx->constants->counters_mem_54551;
    struct memblock_device counters_mem_54625 = ctx->constants->counters_mem_54625;
    struct memblock_device counters_mem_55050 = ctx->constants->counters_mem_55050;
    struct memblock_device counters_mem_55495 = ctx->constants->counters_mem_55495;
    struct memblock_device counters_mem_55534 = ctx->constants->counters_mem_55534;
    struct memblock_device counters_mem_55581 = ctx->constants->counters_mem_55581;
    struct memblock_device counters_mem_56605 = ctx->constants->counters_mem_56605;
    struct memblock_device counters_mem_56764 = ctx->constants->counters_mem_56764;
    struct memblock_device counters_mem_56815 = ctx->constants->counters_mem_56815;
    struct memblock_device counters_mem_56850 = ctx->constants->counters_mem_56850;
    struct memblock_device global_dynid_mem_54616 = ctx->constants->global_dynid_mem_54616;
    struct memblock_device global_dynid_mem_54626 = ctx->constants->global_dynid_mem_54626;
    struct memblock_device global_dynid_mem_54637 = ctx->constants->global_dynid_mem_54637;
    struct memblock_device global_dynid_mem_54642 = ctx->constants->global_dynid_mem_54642;
    struct memblock_device global_dynid_mem_54800 = ctx->constants->global_dynid_mem_54800;
    struct memblock_device global_dynid_mem_54871 = ctx->constants->global_dynid_mem_54871;
    struct memblock_device global_dynid_mem_54920 = ctx->constants->global_dynid_mem_54920;
    struct memblock_device global_dynid_mem_55083 = ctx->constants->global_dynid_mem_55083;
    struct memblock_device global_dynid_mem_55112 = ctx->constants->global_dynid_mem_55112;
    struct memblock_device global_dynid_mem_55221 = ctx->constants->global_dynid_mem_55221;
    struct memblock_device global_dynid_mem_55228 = ctx->constants->global_dynid_mem_55228;
    struct memblock_device global_dynid_mem_55334 = ctx->constants->global_dynid_mem_55334;
    struct memblock_device global_dynid_mem_55338 = ctx->constants->global_dynid_mem_55338;
    struct memblock_device global_dynid_mem_55581 = ctx->constants->global_dynid_mem_55581;
    struct memblock_device global_dynid_mem_55728 = ctx->constants->global_dynid_mem_55728;
    struct memblock_device global_dynid_mem_55884 = ctx->constants->global_dynid_mem_55884;
    struct memblock_device global_dynid_mem_56002 = ctx->constants->global_dynid_mem_56002;
    struct memblock_device global_dynid_mem_56151 = ctx->constants->global_dynid_mem_56151;
    struct memblock_device global_dynid_mem_56269 = ctx->constants->global_dynid_mem_56269;
    struct memblock_device global_dynid_mem_56425 = ctx->constants->global_dynid_mem_56425;
    int64_t prim_out_54541;
    int64_t zeze_rhs_39866 = sub64(part_no_24090, (int64_t) 1);
    bool cond_39867 = clProc_24117 == zeze_rhs_39866;
    int64_t next_partition_to_read_res_39868;
    
    if (cond_39867) {
        next_partition_to_read_res_39868 = (int64_t) -1;
    } else {
        bool cond_39869 = slt64((int64_t) 0, dz2083U_24095);
        int64_t segred_tblock_sizze_45476;
        
        segred_tblock_sizze_45476 = *ctx->tuning_params.next_partition_to_read_doublezisegred_tblock_sizze_45475;
        
        int64_t num_tblocks_45478;
        int64_t max_num_tblocks_54542;
        
        max_num_tblocks_54542 = *ctx->tuning_params.next_partition_to_read_doublezisegred_num_tblocks_45477;
        num_tblocks_45478 = sext_i64_i32(smax64((int64_t) 1, smin64(sdiv_up64(part_no_24090, segred_tblock_sizze_45476), max_num_tblocks_54542)));
        
        bool cond_39883 = part_no_24090 == (int64_t) 0;
        bool x_39884 = !cond_39883;
        bool x_39885 = sle64((int64_t) 0, zeze_rhs_39866);
        bool y_39886 = slt64(zeze_rhs_39866, part_no_24090);
        bool bounds_check_39887 = x_39885 && y_39886;
        bool protect_assert_disj_39888 = cond_39883 || bounds_check_39887;
        int64_t segscan_tblock_sizze_45486;
        
        segscan_tblock_sizze_45486 = *ctx->tuning_params.next_partition_to_read_doublezisegscan_tblock_sizze_45485;
        
        int64_t num_tblocks_45488;
        int64_t max_num_tblocks_54543;
        
        max_num_tblocks_54543 = *ctx->tuning_params.next_partition_to_read_doublezisegscan_num_tblocks_45487;
        num_tblocks_45488 = sext_i64_i32(smax64((int64_t) 1, smin64(sdiv_up64(part_no_24090, segscan_tblock_sizze_45486), max_num_tblocks_54543)));
        
        int64_t bytes_53537 = (int64_t) 8 * part_no_24090;
        
        if (cond_39869) {
            bool index_certs_44874;
            
            if (!cond_39869) {
                set_error(ctx, msgprintf("Error: %s%lld%s%lld%s\n\nBacktrace:\n%s", "Index [", (long long) (int64_t) 0, "] out of bounds for array of shape [", (long long) dz2083U_24095, "].", "-> #0  ft_libs/ftDBSCAN_plus.fut:231:51-84\n   #1  ft_libs/ftDBSCAN_plus.fut:872:18-874:57\n   #2  ft_libs/ftDBSCAN_plus.fut:871:9-874:67\n"));
                err = FUTHARK_PROGRAM_ERROR;
                goto cleanup;
            }
            if (memblock_alloc_device(ctx, &mem_53546, (int64_t) 8, "mem_53546")) {
                err = 1;
                goto cleanup;
            }
            {
                err = gpu_kernel_next_partition_to_read_doublezigpuseq_54544(ctx, (int64_t) 1, 1, 1, (int64_t) 1, 1, 1, (int64_t) 0, clProc_mem_53517.mem, mem_53546.mem);
                if (err != FUTHARK_SUCCESS)
                    goto cleanup;
            }
            if (memblock_set_device(ctx, &ext_mem_53547, &mem_53546, "mem_53546") != 0)
                return 1;
        } else {
            if (memblock_alloc_device(ctx, &mem_53534, (int64_t) 8, "mem_53534")) {
                err = 1;
                goto cleanup;
            }
            if (ctx->debugging)
                fprintf(ctx->log, "%s\n", "\n# SegRed");
            
            int64_t chunk_sizze_54550 = (int64_t) 1;
            
            if (memblock_alloc_device(ctx, &segred_tmp_mem_54573, (int64_t) 8 * num_tblocks_45478, "segred_tmp_mem_54573")) {
                err = 1;
                goto cleanup;
            }
            
            int64_t num_threads_54575 = num_tblocks_45478 * segred_tblock_sizze_45476;
            
            {
                err = gpu_kernel_next_partition_to_read_doublezisegred_nonseg_45483(ctx, num_tblocks_45478, 1, 1, *ctx->tuning_params.next_partition_to_read_doublezisegred_tblock_sizze_45475, 1, 1, 8 + ((int64_t) 8 * segred_tblock_sizze_45476 + srem64((int64_t) 8 - srem64((int64_t) 8 * segred_tblock_sizze_45476, (int64_t) 8), (int64_t) 8)), part_no_24090, num_tblocks_45478, num_threads_54575, clProc_mem_53516.mem, mem_53534.mem, counters_mem_54551.mem, segred_tmp_mem_54573.mem);
                if (err != FUTHARK_SUCCESS)
                    goto cleanup;
            }
            if (ctx->debugging)
                fprintf(ctx->log, "%s\n", "");
            
            int64_t read_res_57040;
            
            if ((err = gpu_scalar_from_device(ctx, &read_res_57040, mem_53534.mem, (int64_t) 0 * sizeof(int64_t), sizeof(int64_t))) != 0)
                goto cleanup;
            if (ctx->failure_is_an_option && futhark_context_sync(ctx) != 0) {
                err = 1;
                goto cleanup;
            }
            
            int64_t defunc_res_44927 = read_res_57040;
            
            if (memblock_unref_device(ctx, &mem_53534, "mem_53534") != 0)
                return 1;
            
            bool cond_39882 = slt64((int64_t) 0, defunc_res_44927);
            bool loop_not_taken_39889 = !cond_39882;
            bool protect_assert_disj_39890 = protect_assert_disj_39888 || loop_not_taken_39889;
            bool index_certs_39891;
            
            if (!protect_assert_disj_39890) {
                set_error(ctx, msgprintf("Error: %s%lld%s%lld%s\n\nBacktrace:\n%s", "Index [", (long long) zeze_rhs_39866, "] out of bounds for array of shape [", (long long) part_no_24090, "].", "-> #0  /prelude/soacs.fut:257:33-47\n   #1  /prelude/functional.fut:9:44-45\n   #2  ft_libs/ftDBSCAN_plus.fut:872:18-874:57\n   #3  ft_libs/ftDBSCAN_plus.fut:871:9-874:67\n"));
                err = FUTHARK_PROGRAM_ERROR;
                goto cleanup;
            }
            if (cond_39882) {
                if (memblock_alloc_device(ctx, &mem_53538, bytes_53537, "mem_53538")) {
                    err = 1;
                    goto cleanup;
                }
                if (memblock_alloc_device(ctx, &mem_53540, bytes_53537, "mem_53540")) {
                    err = 1;
                    goto cleanup;
                }
                if (slt64((int64_t) 0, part_no_24090)) {
                    if (ctx->debugging)
                        fprintf(ctx->log, "%s\n", "\n# SegScan");
                    
                    int64_t shared_memory_54604;
                    
                    shared_memory_54604 = ctx->max_shared_memory;
                    
                    int64_t thread_block_sizze_54605;
                    
                    thread_block_sizze_54605 = ctx->max_thread_block_size;
                    
                    int64_t registers_54606;
                    
                    registers_54606 = ctx->max_registers;
                    
                    int64_t thread_block_sizze_54607;
                    
                    thread_block_sizze_54607 = ctx->max_thread_block_size;
                    
                    int64_t chunk_sizze_54608 = smax64((int64_t) 1, smin64(squot64(squot64(shared_memory_54604, thread_block_sizze_54605), (int64_t) 8), squot64(squot64(registers_54606, thread_block_sizze_54607) - (int64_t) 1 - squot64(smax64((int64_t) 4, (int64_t) 8), (int64_t) 4), (int64_t) 2 * squot64(smax64((int64_t) 4, (int64_t) 8), (int64_t) 4))));
                    int64_t num_virt_blocks_54609 = sdiv_up64(part_no_24090, segscan_tblock_sizze_45486 * chunk_sizze_54608);
                    int64_t num_virt_threads_54610 = num_virt_blocks_54609 * segscan_tblock_sizze_45486;
                    
                    if (ctx->debugging)
                        fprintf(ctx->log, "%s: %llu%c", "Sequential elements per thread (chunk)", (long long) chunk_sizze_54608, '\n');
                    if (memblock_alloc_device(ctx, &status_flags_mem_54611, num_virt_blocks_54609, "status_flags_mem_54611")) {
                        err = 1;
                        goto cleanup;
                    }
                    if (futrts_builtinzhreplicate_i8(ctx, status_flags_mem_54611, num_virt_blocks_54609, (int8_t) 0) != 0) {
                        err = 1;
                        goto cleanup;
                    }
                    if (memblock_alloc_device(ctx, &aggregates_mem_54633, (int64_t) 8 * num_virt_blocks_54609, "aggregates_mem_54633")) {
                        err = 1;
                        goto cleanup;
                    }
                    if (memblock_alloc_device(ctx, &incprefixes_mem_54635, (int64_t) 8 * num_virt_blocks_54609, "incprefixes_mem_54635")) {
                        err = 1;
                        goto cleanup;
                    }
                    {
                        err = gpu_kernel_next_partition_to_read_doublezisegscan_45491(ctx, num_tblocks_45488, 1, 1, *ctx->tuning_params.next_partition_to_read_doublezisegscan_tblock_sizze_45485, 1, 1, smax64(smax64((int64_t) 288, (int64_t) 8 * segscan_tblock_sizze_45486), chunk_sizze_54608 * segscan_tblock_sizze_45486 * (int64_t) 8) + srem64((int64_t) 8 - srem64(smax64(smax64((int64_t) 288, (int64_t) 8 * segscan_tblock_sizze_45486), chunk_sizze_54608 * segscan_tblock_sizze_45486 * (int64_t) 8), (int64_t) 8), (int64_t) 8), part_no_24090, num_tblocks_45488, num_virt_blocks_54609, num_virt_threads_54610, clProc_mem_53516.mem, mem_53538.mem, mem_53540.mem, status_flags_mem_54611.mem, aggregates_mem_54633.mem, incprefixes_mem_54635.mem, global_dynid_mem_54637.mem);
                        if (err != FUTHARK_SUCCESS)
                            goto cleanup;
                    }
                    if (ctx->debugging)
                        fprintf(ctx->log, "%s\n", "");
                }
                
                int64_t m_f_res_44898;
                
                if (x_39884) {
                    int64_t read_res_57041;
                    
                    if ((err = gpu_scalar_from_device(ctx, &read_res_57041, mem_53538.mem, zeze_rhs_39866 * sizeof(int64_t), sizeof(int64_t))) != 0)
                        goto cleanup;
                    if (ctx->failure_is_an_option && futhark_context_sync(ctx) != 0) {
                        err = 1;
                        goto cleanup;
                    }
                    
                    int64_t x_44899 = read_res_57041;
                    
                    m_f_res_44898 = x_44899;
                } else {
                    m_f_res_44898 = (int64_t) 0;
                }
                
                int64_t m_44900;
                
                if (cond_39883) {
                    m_44900 = (int64_t) 0;
                } else {
                    m_44900 = m_f_res_44898;
                }
                
                int64_t m_44901 = sub64(m_44900, (int64_t) 1);
                bool i_p_m_t_s_leq_w_44902 = slt64(m_44901, part_no_24090);
                bool zzero_leq_i_p_m_t_s_44903 = sle64((int64_t) 0, m_44901);
                bool y_44904 = i_p_m_t_s_leq_w_44902 && zzero_leq_i_p_m_t_s_44903;
                bool i_lte_j_44905 = sle64((int64_t) 0, m_44900);
                bool forwards_ok_44906 = y_44904 && i_lte_j_44905;
                bool eq_x_zz_44907 = (int64_t) 0 == m_f_res_44898;
                bool p_and_eq_x_y_44908 = x_39884 && eq_x_zz_44907;
                bool empty_slice_44909 = cond_39883 || p_and_eq_x_y_44908;
                bool ok_or_empty_44910 = forwards_ok_44906 || empty_slice_44909;
                bool index_certs_44911;
                
                if (!ok_or_empty_44910) {
                    set_error(ctx, msgprintf("Error: %s%lld%s%lld%s\n\nBacktrace:\n%s", "Index [:", (long long) m_44900, "] out of bounds for array of shape [", (long long) part_no_24090, "].", "-> #0  /prelude/soacs.fut:258:29-35\n   #1  /prelude/functional.fut:9:44-45\n   #2  ft_libs/ftDBSCAN_plus.fut:872:18-874:57\n   #3  ft_libs/ftDBSCAN_plus.fut:871:9-874:67\n"));
                    err = FUTHARK_PROGRAM_ERROR;
                    goto cleanup;
                }
                
                int64_t bytes_53541 = (int64_t) 8 * m_44900;
                bool y_44924 = slt64((int64_t) 0, m_44900);
                bool index_certs_44925;
                
                if (!y_44924) {
                    set_error(ctx, msgprintf("Error: %s%lld%s%lld%s\n\nBacktrace:\n%s", "Index [", (long long) (int64_t) 0, "] out of bounds for array of shape [", (long long) m_44900, "].", "-> #0  ft_libs/ftDBSCAN_plus.fut:239:44-56\n   #1  ft_libs/ftDBSCAN_plus.fut:872:18-874:57\n   #2  ft_libs/ftDBSCAN_plus.fut:871:9-874:67\n"));
                    err = FUTHARK_PROGRAM_ERROR;
                    goto cleanup;
                }
                if (memblock_alloc_device(ctx, &mem_53542, bytes_53541, "mem_53542")) {
                    err = 1;
                    goto cleanup;
                }
                if (futrts_builtinzhiota_i64(ctx, mem_53542, m_44900, (int64_t) 0, (int64_t) 1) != 0) {
                    err = 1;
                    goto cleanup;
                }
                
                int64_t segmap_tblock_sizze_45496;
                
                segmap_tblock_sizze_45496 = *ctx->tuning_params.next_partition_to_read_doublezisegmap_tblock_sizze_45495;
                
                int64_t num_tblocks_45498;
                int64_t max_num_tblocks_54743;
                
                max_num_tblocks_54743 = *ctx->tuning_params.next_partition_to_read_doublezisegmap_num_tblocks_45497;
                num_tblocks_45498 = sext_i64_i32(smax64((int64_t) 1, smin64(sdiv_up64(part_no_24090, segmap_tblock_sizze_45496), max_num_tblocks_54743)));
                if (ctx->debugging)
                    fprintf(ctx->log, "%s\n", "\n# SegMap");
                
                int32_t virt_num_tblocks_54744 = sext_i64_i32(sdiv_up64(part_no_24090, segmap_tblock_sizze_45496));
                
                {
                    err = gpu_kernel_next_partition_to_read_doublezisegmap_45493(ctx, num_tblocks_45498, 1, 1, *ctx->tuning_params.next_partition_to_read_doublezisegmap_tblock_sizze_45495, 1, 1, (int64_t) 0, part_no_24090, m_44900, num_tblocks_45498, virt_num_tblocks_54744, mem_53538.mem, mem_53540.mem, mem_53542.mem);
                    if (err != FUTHARK_SUCCESS)
                        goto cleanup;
                }
                if (ctx->debugging)
                    fprintf(ctx->log, "%s\n", "");
                if (memblock_unref_device(ctx, &mem_53538, "mem_53538") != 0)
                    return 1;
                if (memblock_unref_device(ctx, &mem_53540, "mem_53540") != 0)
                    return 1;
                if (memblock_alloc_device(ctx, &mem_53544, (int64_t) 8, "mem_53544")) {
                    err = 1;
                    goto cleanup;
                }
                {
                    err = gpu_kernel_next_partition_to_read_doublezigpuseq_54757(ctx, (int64_t) 1, 1, 1, (int64_t) 1, 1, 1, (int64_t) 0, mem_53542.mem, mem_53544.mem);
                    if (err != FUTHARK_SUCCESS)
                        goto cleanup;
                }
                if (memblock_unref_device(ctx, &mem_53542, "mem_53542") != 0)
                    return 1;
                if (memblock_set_device(ctx, &ext_mem_53545, &mem_53544, "mem_53544") != 0)
                    return 1;
            } else {
                if (memblock_alloc_device(ctx, &mem_53535, (int64_t) 8, "mem_53535")) {
                    err = 1;
                    goto cleanup;
                }
                if (futrts_builtinzhreplicate_i64(ctx, mem_53535, (int64_t) 1, (int64_t) -1) != 0) {
                    err = 1;
                    goto cleanup;
                }
                if (memblock_set_device(ctx, &ext_mem_53545, &mem_53535, "mem_53535") != 0)
                    return 1;
            }
            if (memblock_set_device(ctx, &ext_mem_53547, &ext_mem_53545, "ext_mem_53545") != 0)
                return 1;
        }
        
        int64_t read_res_57042;
        
        if ((err = gpu_scalar_from_device(ctx, &read_res_57042, ext_mem_53547.mem, (int64_t) 0 * sizeof(int64_t), sizeof(int64_t))) != 0)
            goto cleanup;
        if (ctx->failure_is_an_option && futhark_context_sync(ctx) != 0) {
            err = 1;
            goto cleanup;
        }
        
        int64_t next_partition_to_read_res_f_res_39870 = read_res_57042;
        
        if (memblock_unref_device(ctx, &ext_mem_53547, "ext_mem_53547") != 0)
            return 1;
        next_partition_to_read_res_39868 = next_partition_to_read_res_f_res_39870;
    }
    prim_out_54541 = next_partition_to_read_res_39868;
    *out_prim_out_57039 = prim_out_54541;
    
  cleanup:
    {
        if (memblock_unref_device(ctx, &mem_53535, "mem_53535") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53544, "mem_53544") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53542, "mem_53542") != 0)
            return 1;
        if (memblock_unref_device(ctx, &incprefixes_mem_54635, "incprefixes_mem_54635") != 0)
            return 1;
        if (memblock_unref_device(ctx, &aggregates_mem_54633, "aggregates_mem_54633") != 0)
            return 1;
        if (memblock_unref_device(ctx, &status_flags_mem_54611, "status_flags_mem_54611") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53540, "mem_53540") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53538, "mem_53538") != 0)
            return 1;
        if (memblock_unref_device(ctx, &ext_mem_53545, "ext_mem_53545") != 0)
            return 1;
        if (memblock_unref_device(ctx, &segred_tmp_mem_54573, "segred_tmp_mem_54573") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53534, "mem_53534") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53546, "mem_53546") != 0)
            return 1;
        if (memblock_unref_device(ctx, &ext_mem_53547, "ext_mem_53547") != 0)
            return 1;
    }
    return err;
}
FUTHARK_FUN_ATTR int futrts_entry_rectify_partition_ids_double(struct futhark_context *ctx, struct memblock_device *mem_out_p_57043, struct memblock_device partition_ids_mem_53506, struct memblock_device chain_id_mem_53507, struct memblock_device replaceWith_mem_53508, int64_t n_37952, int64_t dz2081Uz2080U_37953, int64_t dz2081Uz2081U_37954, int64_t m_sizze_37958)
{
    (void) ctx;
    
    int err = 0;
    struct memblock_device mem_53510;
    
    mem_53510.references = NULL;
    
    struct memblock_device mem_out_54541;
    
    mem_out_54541.references = NULL;
    
    struct memblock_device counters_mem_54551 = ctx->constants->counters_mem_54551;
    struct memblock_device counters_mem_54625 = ctx->constants->counters_mem_54625;
    struct memblock_device counters_mem_55050 = ctx->constants->counters_mem_55050;
    struct memblock_device counters_mem_55495 = ctx->constants->counters_mem_55495;
    struct memblock_device counters_mem_55534 = ctx->constants->counters_mem_55534;
    struct memblock_device counters_mem_55581 = ctx->constants->counters_mem_55581;
    struct memblock_device counters_mem_56605 = ctx->constants->counters_mem_56605;
    struct memblock_device counters_mem_56764 = ctx->constants->counters_mem_56764;
    struct memblock_device counters_mem_56815 = ctx->constants->counters_mem_56815;
    struct memblock_device counters_mem_56850 = ctx->constants->counters_mem_56850;
    struct memblock_device global_dynid_mem_54616 = ctx->constants->global_dynid_mem_54616;
    struct memblock_device global_dynid_mem_54626 = ctx->constants->global_dynid_mem_54626;
    struct memblock_device global_dynid_mem_54637 = ctx->constants->global_dynid_mem_54637;
    struct memblock_device global_dynid_mem_54642 = ctx->constants->global_dynid_mem_54642;
    struct memblock_device global_dynid_mem_54800 = ctx->constants->global_dynid_mem_54800;
    struct memblock_device global_dynid_mem_54871 = ctx->constants->global_dynid_mem_54871;
    struct memblock_device global_dynid_mem_54920 = ctx->constants->global_dynid_mem_54920;
    struct memblock_device global_dynid_mem_55083 = ctx->constants->global_dynid_mem_55083;
    struct memblock_device global_dynid_mem_55112 = ctx->constants->global_dynid_mem_55112;
    struct memblock_device global_dynid_mem_55221 = ctx->constants->global_dynid_mem_55221;
    struct memblock_device global_dynid_mem_55228 = ctx->constants->global_dynid_mem_55228;
    struct memblock_device global_dynid_mem_55334 = ctx->constants->global_dynid_mem_55334;
    struct memblock_device global_dynid_mem_55338 = ctx->constants->global_dynid_mem_55338;
    struct memblock_device global_dynid_mem_55581 = ctx->constants->global_dynid_mem_55581;
    struct memblock_device global_dynid_mem_55728 = ctx->constants->global_dynid_mem_55728;
    struct memblock_device global_dynid_mem_55884 = ctx->constants->global_dynid_mem_55884;
    struct memblock_device global_dynid_mem_56002 = ctx->constants->global_dynid_mem_56002;
    struct memblock_device global_dynid_mem_56151 = ctx->constants->global_dynid_mem_56151;
    struct memblock_device global_dynid_mem_56269 = ctx->constants->global_dynid_mem_56269;
    struct memblock_device global_dynid_mem_56425 = ctx->constants->global_dynid_mem_56425;
    bool zzero_39824 = dz2081Uz2080U_37953 == (int64_t) 0;
    bool nonzzero_39825 = !zzero_39824;
    bool nonzzero_cert_39826;
    
    if (!nonzzero_39825) {
        set_error(ctx, msgprintf("Error: %s\n\nBacktrace:\n%s", "division by zero", "-> #0  ft_libs/ftDBSCAN_plus.fut:827:56-61\n   #1  ft_libs/ftDBSCAN_plus.fut:902:18-905:84\n   #2  ft_libs/ftDBSCAN_plus.fut:900:9-905:84\n"));
        err = FUTHARK_PROGRAM_ERROR;
        goto cleanup;
    }
    
    int64_t max_arg1_39827 = sdiv64(m_sizze_37958, dz2081Uz2080U_37953);
    int64_t max_res_39828 = smax64((int64_t) 1, max_arg1_39827);
    int64_t zm_lhs_39829 = add64(n_37952, max_res_39828);
    int64_t zs_lhs_39830 = sub64(zm_lhs_39829, (int64_t) 1);
    bool zzero_39831 = max_res_39828 == (int64_t) 0;
    bool nonzzero_39832 = !zzero_39831;
    bool nonzzero_cert_39833;
    
    if (!nonzzero_39832) {
        set_error(ctx, msgprintf("Error: %s\n\nBacktrace:\n%s", "division by zero", "-> #0  ft_libs/ftDBSCAN_plus.fut:828:57-65\n   #1  ft_libs/ftDBSCAN_plus.fut:902:18-905:84\n   #2  ft_libs/ftDBSCAN_plus.fut:900:9-905:84\n"));
        err = FUTHARK_PROGRAM_ERROR;
        goto cleanup;
    }
    
    int64_t num_iter_39834 = sdiv64(zs_lhs_39830, max_res_39828);
    bool dim_match_39835 = dz2081Uz2080U_37953 == dz2081Uz2081U_37954;
    bool empty_or_match_cert_39836;
    
    if (!dim_match_39835) {
        set_error(ctx, msgprintf("Error: %s%lld%s%lld%s\n\nBacktrace:\n%s", "Value of (desugared) shape [", (long long) dz2081Uz2081U_37954, "] cannot match shape of type `[", (long long) dz2081Uz2080U_37953, "]i64`.", "-> #0  ft_libs/ftDBSCAN_plus.fut:829:69-99\n   #1  ft_libs/ftDBSCAN_plus.fut:902:18-905:84\n   #2  ft_libs/ftDBSCAN_plus.fut:900:9-905:84\n"));
        err = FUTHARK_PROGRAM_ERROR;
        goto cleanup;
    }
    
    int64_t bytes_53509 = (int64_t) 8 * n_37952;
    bool bounds_invalid_upwards_39839 = slt64(num_iter_39834, (int64_t) 0);
    bool valid_39840 = !bounds_invalid_upwards_39839;
    bool range_valid_c_39841;
    
    if (!valid_39840) {
        set_error(ctx, msgprintf("Error: %s%lld%s%lld%s%lld%s\n\nBacktrace:\n%s", "Range ", (long long) (int64_t) 0, "..", (long long) (int64_t) 1, "..<", (long long) num_iter_39834, " is invalid.", "-> #0  /prelude/array.fut:94:3-11\n   #1  ft_libs/ftDBSCAN_plus.fut:831:80-93\n   #2  ft_libs/ftDBSCAN_plus.fut:902:18-905:84\n   #3  ft_libs/ftDBSCAN_plus.fut:900:9-905:84\n"));
        err = FUTHARK_PROGRAM_ERROR;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_53510, bytes_53509, "mem_53510")) {
        err = 1;
        goto cleanup;
    }
    if ((err = lmad_copy_gpu2gpu_8b(ctx, 1, mem_53510.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, partition_ids_mem_53506.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, (int64_t []) {n_37952})) != 0)
        goto cleanup;
    
    int64_t tile_sizze_50070;
    
    tile_sizze_50070 = *ctx->tuning_params.rectify_partition_ids_doublezitile_sizze_50069;
    
    int64_t tile_sizze_49826;
    
    tile_sizze_49826 = *ctx->tuning_params.rectify_partition_ids_doublezitile_sizze_49825;
    
    int64_t num_whole_tiles_50086 = squot_safe64(dz2081Uz2080U_37953, tile_sizze_50070);
    int64_t residual_input_50233 = srem_safe64(dz2081Uz2080U_37953, tile_sizze_50070);
    bool cond_50234 = residual_input_50233 == (int64_t) 0;
    int64_t binop_x_50247 = tile_sizze_50070 * num_whole_tiles_50086;
    int64_t bytes_53529 = (int64_t) 8 * tile_sizze_50070;
    int64_t num_whole_tiles_49842 = squot_safe64(dz2081Uz2080U_37953, tile_sizze_49826);
    int64_t residual_input_49989 = srem_safe64(dz2081Uz2080U_37953, tile_sizze_49826);
    bool cond_49990 = residual_input_49989 == (int64_t) 0;
    int64_t binop_x_50003 = tile_sizze_49826 * num_whole_tiles_49842;
    int64_t bytes_53569 = (int64_t) 8 * tile_sizze_49826;
    
    for (int64_t i_39843 = 0; i_39843 < num_iter_39834; i_39843++) {
        int64_t inf_39845 = mul64(max_res_39828, i_39843);
        int64_t min_arg0_39846 = add64(max_res_39828, inf_39845);
        int64_t min_res_39847 = smin64(n_37952, min_arg0_39846);
        int64_t dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_39848 = sub64(min_res_39847, inf_39845);
        bool empty_slice_39849 = dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_39848 == (int64_t) 0;
        int64_t m_39850 = sub64(dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_39848, (int64_t) 1);
        int64_t i_p_m_t_s_39851 = add64(inf_39845, m_39850);
        bool zzero_leq_i_p_m_t_s_39852 = sle64((int64_t) 0, i_p_m_t_s_39851);
        bool i_p_m_t_s_leq_w_39853 = slt64(i_p_m_t_s_39851, n_37952);
        bool zzero_lte_i_39854 = sle64((int64_t) 0, inf_39845);
        bool i_lte_j_39855 = sle64(inf_39845, min_res_39847);
        bool y_39856 = i_p_m_t_s_leq_w_39853 && zzero_lte_i_39854;
        bool y_39857 = zzero_leq_i_p_m_t_s_39852 && y_39856;
        bool forwards_ok_39858 = i_lte_j_39855 && y_39857;
        bool ok_or_empty_39859 = empty_slice_39849 || forwards_ok_39858;
        bool index_certs_39860;
        
        if (!ok_or_empty_39859) {
            set_error(ctx, msgprintf("Error: %s%lld%s%lld%s%lld%s\n\nBacktrace:\n%s", "Index [", (long long) inf_39845, ":", (long long) min_res_39847, "] out of bounds for array of shape [", (long long) n_37952, "].", "-> #0  ft_libs/ftDBSCAN_plus.fut:834:55-77\n   #1  ft_libs/ftDBSCAN_plus.fut:902:18-905:84\n   #2  ft_libs/ftDBSCAN_plus.fut:900:9-905:84\n"));
            err = FUTHARK_PROGRAM_ERROR;
            goto cleanup;
        }
        
        bool suff_outer_par_45664;
        
        suff_outer_par_45664 = *ctx->tuning_params.rectify_partition_ids_doublezisuff_outer_par_0 <= dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_39848;
        if (ctx->logging)
            fprintf(ctx->log, "Compared %s <= %ld: %s.\n", "rectify_partition_ids_double.suff_outer_par_0", (long) dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_39848, suff_outer_par_45664 ? "true" : "false");
        
        int64_t shared_memory_capacity_54585;
        
        shared_memory_capacity_54585 = ctx->max_shared_memory;
        if (suff_outer_par_45664 && sle64(sdiv_up64(bytes_53569, (int64_t) 8) * (int64_t) 8 + sdiv_up64(bytes_53569, (int64_t) 8) * (int64_t) 8, shared_memory_capacity_54585)) {
            int64_t ldim_49827 = sdiv_up64(dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_39848, tile_sizze_49826);
            
            if (ctx->debugging)
                fprintf(ctx->log, "%s\n", "\n# SegMap");
            
            int32_t num_chunks_54543 = sext_i64_i32(sdiv_up64(tile_sizze_49826, tile_sizze_49826));
            int32_t virt_num_tblocks_54544 = sext_i64_i32(ldim_49827);
            
            {
                err = gpu_kernel_rectify_partition_ids_doublezisegmap_intrablock_49824(ctx, ldim_49827, 1, 1, *ctx->tuning_params.rectify_partition_ids_doublezitile_sizze_49825, 1, 1, bytes_53569 + srem64((int64_t) 8 - srem64(bytes_53569, (int64_t) 8), (int64_t) 8) + (bytes_53569 + srem64((int64_t) 8 - srem64(bytes_53569, (int64_t) 8), (int64_t) 8)), dz2081Uz2080U_37953, inf_39845, dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_39848, ldim_49827, num_whole_tiles_49842, residual_input_49989, cond_49990, binop_x_50003, partition_ids_mem_53506.mem, chain_id_mem_53507.mem, replaceWith_mem_53508.mem, mem_53510.mem);
                if (err != FUTHARK_SUCCESS)
                    goto cleanup;
            }
            if (ctx->debugging)
                fprintf(ctx->log, "%s\n", "");
        } else {
            int64_t ldim_50071 = sdiv_up64(dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_39848, tile_sizze_50070);
            
            if (ctx->debugging)
                fprintf(ctx->log, "%s\n", "\n# SegMap");
            
            int32_t num_chunks_54564 = sext_i64_i32(sdiv_up64(tile_sizze_50070, tile_sizze_50070));
            int32_t virt_num_tblocks_54565 = sext_i64_i32(ldim_50071);
            
            {
                err = gpu_kernel_rectify_partition_ids_doublezisegmap_intrablock_50068(ctx, ldim_50071, 1, 1, *ctx->tuning_params.rectify_partition_ids_doublezitile_sizze_50069, 1, 1, bytes_53529 + srem64((int64_t) 8 - srem64(bytes_53529, (int64_t) 8), (int64_t) 8) + (bytes_53529 + srem64((int64_t) 8 - srem64(bytes_53529, (int64_t) 8), (int64_t) 8)), dz2081Uz2080U_37953, inf_39845, dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_39848, ldim_50071, num_whole_tiles_50086, residual_input_50233, cond_50234, binop_x_50247, partition_ids_mem_53506.mem, chain_id_mem_53507.mem, replaceWith_mem_53508.mem, mem_53510.mem);
                if (err != FUTHARK_SUCCESS)
                    goto cleanup;
            }
            if (ctx->debugging)
                fprintf(ctx->log, "%s\n", "");
        }
    }
    if (memblock_set_device(ctx, &mem_out_54541, &mem_53510, "mem_53510") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_57043, &mem_out_54541, "mem_out_54541") != 0)
        return 1;
    
  cleanup:
    {
        if (memblock_unref_device(ctx, &mem_53510, "mem_53510") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_54541, "mem_out_54541") != 0)
            return 1;
    }
    return err;
}
FUTHARK_FUN_ATTR int futrts_get_num_neighbours_against_10103(struct futhark_context *ctx, struct memblock_device *mem_out_p_57044, struct memblock_device dat1_mem_53506, struct memblock_device dat1_mem_53507, struct memblock_device dat2_mem_53508, struct memblock_device dat2_mem_53509, int64_t n1_29590, int64_t n2_29591, double eps_29596, int8_t dist_t_29597, int8_t angle_t_29598, double radius_29599, int64_t m_sizze_29600)
{
    (void) ctx;
    
    int err = 0;
    struct memblock_device segred_tmp_mem_54623;
    
    segred_tmp_mem_54623.references = NULL;
    
    struct memblock_device mem_53521;
    
    mem_53521.references = NULL;
    
    struct memblock_device mem_53519;
    
    mem_53519.references = NULL;
    
    struct memblock_device mem_53517;
    
    mem_53517.references = NULL;
    
    struct memblock_device mem_53511;
    
    mem_53511.references = NULL;
    
    struct memblock_device mem_out_54541;
    
    mem_out_54541.references = NULL;
    
    struct memblock_device counters_mem_54551 = ctx->constants->counters_mem_54551;
    struct memblock_device counters_mem_54625 = ctx->constants->counters_mem_54625;
    struct memblock_device counters_mem_55050 = ctx->constants->counters_mem_55050;
    struct memblock_device counters_mem_55495 = ctx->constants->counters_mem_55495;
    struct memblock_device counters_mem_55534 = ctx->constants->counters_mem_55534;
    struct memblock_device counters_mem_55581 = ctx->constants->counters_mem_55581;
    struct memblock_device counters_mem_56605 = ctx->constants->counters_mem_56605;
    struct memblock_device counters_mem_56764 = ctx->constants->counters_mem_56764;
    struct memblock_device counters_mem_56815 = ctx->constants->counters_mem_56815;
    struct memblock_device counters_mem_56850 = ctx->constants->counters_mem_56850;
    struct memblock_device global_dynid_mem_54616 = ctx->constants->global_dynid_mem_54616;
    struct memblock_device global_dynid_mem_54626 = ctx->constants->global_dynid_mem_54626;
    struct memblock_device global_dynid_mem_54637 = ctx->constants->global_dynid_mem_54637;
    struct memblock_device global_dynid_mem_54642 = ctx->constants->global_dynid_mem_54642;
    struct memblock_device global_dynid_mem_54800 = ctx->constants->global_dynid_mem_54800;
    struct memblock_device global_dynid_mem_54871 = ctx->constants->global_dynid_mem_54871;
    struct memblock_device global_dynid_mem_54920 = ctx->constants->global_dynid_mem_54920;
    struct memblock_device global_dynid_mem_55083 = ctx->constants->global_dynid_mem_55083;
    struct memblock_device global_dynid_mem_55112 = ctx->constants->global_dynid_mem_55112;
    struct memblock_device global_dynid_mem_55221 = ctx->constants->global_dynid_mem_55221;
    struct memblock_device global_dynid_mem_55228 = ctx->constants->global_dynid_mem_55228;
    struct memblock_device global_dynid_mem_55334 = ctx->constants->global_dynid_mem_55334;
    struct memblock_device global_dynid_mem_55338 = ctx->constants->global_dynid_mem_55338;
    struct memblock_device global_dynid_mem_55581 = ctx->constants->global_dynid_mem_55581;
    struct memblock_device global_dynid_mem_55728 = ctx->constants->global_dynid_mem_55728;
    struct memblock_device global_dynid_mem_55884 = ctx->constants->global_dynid_mem_55884;
    struct memblock_device global_dynid_mem_56002 = ctx->constants->global_dynid_mem_56002;
    struct memblock_device global_dynid_mem_56151 = ctx->constants->global_dynid_mem_56151;
    struct memblock_device global_dynid_mem_56269 = ctx->constants->global_dynid_mem_56269;
    struct memblock_device global_dynid_mem_56425 = ctx->constants->global_dynid_mem_56425;
    int64_t max_res_38036 = smax64((int64_t) 1, n2_29591);
    bool zzero_29603 = max_res_38036 == (int64_t) 0;
    bool nonzzero_29604 = !zzero_29603;
    bool nonzzero_cert_29605;
    
    if (!nonzzero_29604) {
        set_error(ctx, msgprintf("Error: %s\n\nBacktrace:\n%s", "division by zero", "-> #0  ft_libs/ftDBSCAN_plus.fut:487:55-69\n"));
        err = FUTHARK_PROGRAM_ERROR;
        goto cleanup;
    }
    
    int64_t max_arg1_29606 = sdiv64(m_sizze_29600, max_res_38036);
    int64_t max_res_38039 = smax64((int64_t) 1, max_arg1_29606);
    int64_t zm_lhs_29610 = add64(n1_29590, max_res_38039);
    int64_t zs_lhs_29612 = sub64(zm_lhs_29610, (int64_t) 1);
    bool zzero_29614 = max_res_38039 == (int64_t) 0;
    bool nonzzero_29615 = !zzero_29614;
    bool nonzzero_cert_29616;
    
    if (!nonzzero_29615) {
        set_error(ctx, msgprintf("Error: %s\n\nBacktrace:\n%s", "division by zero", "-> #0  ft_libs/ftDBSCAN_plus.fut:488:57-64\n"));
        err = FUTHARK_PROGRAM_ERROR;
        goto cleanup;
    }
    
    int64_t num_iter_29617 = sdiv64(zs_lhs_29612, max_res_38039);
    int64_t bytes_53510 = (int64_t) 8 * n1_29590;
    bool bounds_invalid_upwards_38041 = slt64(num_iter_29617, (int64_t) 0);
    bool valid_38042 = !bounds_invalid_upwards_38041;
    bool range_valid_c_38043;
    
    if (!valid_38042) {
        set_error(ctx, msgprintf("Error: %s%lld%s%lld%s%lld%s\n\nBacktrace:\n%s", "Range ", (long long) (int64_t) 0, "..", (long long) (int64_t) 1, "..<", (long long) num_iter_29617, " is invalid.", "-> #0  /prelude/array.fut:94:3-11\n   #1  ft_libs/ftDBSCAN_plus.fut:489:69-82\n"));
        err = FUTHARK_PROGRAM_ERROR;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_53511, bytes_53510, "mem_53511")) {
        err = 1;
        goto cleanup;
    }
    if (futrts_builtinzhreplicate_i64(ctx, mem_53511, n1_29590, (int64_t) 0) != 0) {
        err = 1;
        goto cleanup;
    }
    
    int64_t segmap_tblock_sizze_49378;
    
    segmap_tblock_sizze_49378 = *ctx->tuning_params.get_num_neighbours_against_10103zisegmap_tblock_sizze_49363;
    
    int64_t segred_tblock_sizze_49396;
    
    segred_tblock_sizze_49396 = *ctx->tuning_params.get_num_neighbours_against_10103zisegred_tblock_sizze_49313;
    
    int64_t tile_sizze_49826;
    
    tile_sizze_49826 = *ctx->tuning_params.get_num_neighbours_against_10103zitile_sizze_49825;
    
    bool match_val_53479 = dist_t_29597 == (int8_t) 0;
    bool x_53480 = !match_val_53479;
    int64_t num_whole_tiles_49871 = squot_safe64(n2_29591, tile_sizze_49826);
    int64_t residual_input_50060 = srem_safe64(n2_29591, tile_sizze_49826);
    bool cond_50061 = residual_input_50060 == (int64_t) 0;
    int64_t binop_x_50074 = tile_sizze_49826 * num_whole_tiles_49871;
    int64_t bytes_53551 = (int64_t) 8 * tile_sizze_49826;
    
    for (int64_t i_29623 = 0; i_29623 < num_iter_29617; i_29623++) {
        int64_t inf_29626 = mul64(i_29623, max_res_38039);
        int64_t min_arg1_29628 = add64(inf_29626, max_res_38039);
        int64_t min_res_38051 = smin64(n1_29590, min_arg1_29628);
        int64_t dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_29632 = sub64(min_res_38051, inf_29626);
        bool empty_slice_29644 = dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_29632 == (int64_t) 0;
        int64_t m_29645 = sub64(dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_29632, (int64_t) 1);
        int64_t i_p_m_t_s_29647 = add64(inf_29626, m_29645);
        bool zzero_leq_i_p_m_t_s_29648 = sle64((int64_t) 0, i_p_m_t_s_29647);
        bool i_p_m_t_s_leq_w_29650 = slt64(i_p_m_t_s_29647, n1_29590);
        bool zzero_lte_i_29651 = sle64((int64_t) 0, inf_29626);
        bool i_lte_j_29652 = sle64(inf_29626, min_res_38051);
        bool y_29653 = i_p_m_t_s_leq_w_29650 && zzero_lte_i_29651;
        bool y_29654 = zzero_leq_i_p_m_t_s_29648 && y_29653;
        bool forwards_ok_29655 = i_lte_j_29652 && y_29654;
        bool ok_or_empty_29662 = empty_slice_29644 || forwards_ok_29655;
        bool index_certs_29664;
        
        if (!ok_or_empty_29662) {
            set_error(ctx, msgprintf("Error: %s%lld%s%lld%s%lld%s\n\nBacktrace:\n%s", "Index [", (long long) inf_29626, ":", (long long) min_res_38051, "] out of bounds for array of shape [", (long long) n1_29590, "].", "-> #0  ft_libs/ftDBSCAN_plus.fut:492:47-60\n"));
            err = FUTHARK_PROGRAM_ERROR;
            goto cleanup;
        }
        
        bool suff_outer_par_49208;
        
        suff_outer_par_49208 = *ctx->tuning_params.get_num_neighbours_against_10103zisuff_outer_par_0 <= dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_29632;
        if (ctx->logging)
            fprintf(ctx->log, "Compared %s <= %ld: %s.\n", "get_num_neighbours_against_10103.suff_outer_par_0", (long) dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_29632, suff_outer_par_49208 ? "true" : "false");
        
        int64_t nest_sizze_49395 = n2_29591 * dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_29632;
        int64_t num_tblocks_49397;
        int64_t max_num_tblocks_54563;
        
        max_num_tblocks_54563 = *ctx->tuning_params.get_num_neighbours_against_10103zisegred_num_tblocks_49315;
        num_tblocks_49397 = sext_i64_i32(smax64((int64_t) 1, smin64(sdiv_up64(nest_sizze_49395, segred_tblock_sizze_49396), max_num_tblocks_54563)));
        
        int64_t bytes_53516 = (int64_t) 8 * dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_29632;
        int64_t shared_memory_capacity_54682;
        
        shared_memory_capacity_54682 = ctx->max_shared_memory;
        if (suff_outer_par_49208 && sle64(sdiv_up64(bytes_53551, (int64_t) 8) * (int64_t) 8 + sdiv_up64(bytes_53551, (int64_t) 8) * (int64_t) 8, shared_memory_capacity_54682)) {
            int64_t ldim_49827 = sdiv_up64(dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_29632, tile_sizze_49826);
            
            if (ctx->debugging)
                fprintf(ctx->log, "%s\n", "\n# SegMap");
            
            int32_t num_chunks_54564 = sext_i64_i32(sdiv_up64(tile_sizze_49826, tile_sizze_49826));
            int32_t virt_num_tblocks_54565 = sext_i64_i32(ldim_49827);
            
            {
                err = gpu_kernel_get_num_neighbours_against_10103zisegmap_intrablock_49824(ctx, ldim_49827, 1, 1, *ctx->tuning_params.get_num_neighbours_against_10103zitile_sizze_49825, 1, 1, bytes_53551 + srem64((int64_t) 8 - srem64(bytes_53551, (int64_t) 8), (int64_t) 8) + (bytes_53551 + srem64((int64_t) 8 - srem64(bytes_53551, (int64_t) 8), (int64_t) 8)), n2_29591, eps_29596, dist_t_29597, angle_t_29598, radius_29599, inf_29626, dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_29632, ldim_49827, num_whole_tiles_49871, residual_input_50060, cond_50061, binop_x_50074, dat1_mem_53506.mem, dat1_mem_53507.mem, dat2_mem_53508.mem, dat2_mem_53509.mem, mem_53511.mem);
                if (err != FUTHARK_SUCCESS)
                    goto cleanup;
            }
            if (ctx->debugging)
                fprintf(ctx->log, "%s\n", "");
        } else {
            int64_t segmap_usable_groups_49379 = sdiv_up64(dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_29632, segmap_tblock_sizze_49378);
            
            if (memblock_alloc_device(ctx, &mem_53517, bytes_53516, "mem_53517")) {
                err = 1;
                goto cleanup;
            }
            if (memblock_alloc_device(ctx, &mem_53519, bytes_53516, "mem_53519")) {
                err = 1;
                goto cleanup;
            }
            if (memblock_alloc_device(ctx, &mem_53521, bytes_53516, "mem_53521")) {
                err = 1;
                goto cleanup;
            }
            if (ctx->debugging)
                fprintf(ctx->log, "%s\n", "\n# SegMap");
            
            int32_t virt_num_tblocks_54581 = sext_i64_i32(sdiv_up64(dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_29632, segmap_tblock_sizze_49378));
            
            {
                err = gpu_kernel_get_num_neighbours_against_10103zisegmap_49384(ctx, segmap_usable_groups_49379, 1, 1, *ctx->tuning_params.get_num_neighbours_against_10103zisegmap_tblock_sizze_49363, 1, 1, (int64_t) 0, angle_t_29598, inf_29626, dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_29632, dat1_mem_53506.mem, dat1_mem_53507.mem, mem_53517.mem, mem_53519.mem, mem_53521.mem);
                if (err != FUTHARK_SUCCESS)
                    goto cleanup;
            }
            if (ctx->debugging)
                fprintf(ctx->log, "%s\n", "");
            if (ctx->debugging)
                fprintf(ctx->log, "%s\n", "\n# SegRed");
            
            int64_t chunk_sizze_54590 = (int64_t) 1;
            
            if (slt64(n2_29591 * (int64_t) 2, segred_tblock_sizze_49396 * chunk_sizze_54590)) {
                int64_t segment_sizze_nonzzero_54591 = smax64((int64_t) 1, n2_29591);
                int64_t num_threads_54592 = segred_tblock_sizze_49396 * segred_tblock_sizze_49396;
                
                if (ctx->debugging)
                    fprintf(ctx->log, "%s\n", "# SegRed-small");
                if (ctx->debugging)
                    fprintf(ctx->log, "%s: %llu%c", "num_segments", (long long) dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_29632, '\n');
                if (ctx->debugging)
                    fprintf(ctx->log, "%s: %llu%c", "segment_size", (long long) n2_29591, '\n');
                if (ctx->debugging)
                    fprintf(ctx->log, "%s: %llu%c", "segments_per_block", (long long) squot64(segred_tblock_sizze_49396, segment_sizze_nonzzero_54591), '\n');
                if (ctx->debugging)
                    fprintf(ctx->log, "%s: %llu%c", "required_blocks", (long long) sext_i64_i32(sdiv_up64(dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_29632, squot64(segred_tblock_sizze_49396, segment_sizze_nonzzero_54591))), '\n');
                {
                    err = gpu_kernel_get_num_neighbours_against_10103zisegred_small_49402(ctx, num_tblocks_49397, 1, 1, *ctx->tuning_params.get_num_neighbours_against_10103zisegred_tblock_sizze_49313, 1, 1, (int64_t) 8 * segred_tblock_sizze_49396 + srem64((int64_t) 8 - srem64((int64_t) 8 * segred_tblock_sizze_49396, (int64_t) 8), (int64_t) 8), n2_29591, eps_29596, dist_t_29597, angle_t_29598, radius_29599, inf_29626, dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_29632, num_tblocks_49397, x_53480, segment_sizze_nonzzero_54591, dat1_mem_53506.mem, dat1_mem_53507.mem, dat2_mem_53508.mem, dat2_mem_53509.mem, mem_53511.mem, mem_53517.mem, mem_53519.mem, mem_53521.mem);
                    if (err != FUTHARK_SUCCESS)
                        goto cleanup;
                }
            } else {
                int64_t blocks_per_segment_54619 = sdiv_up64(num_tblocks_49397, smax64((int64_t) 1, dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_29632));
                int64_t q_54620 = sdiv_up64(n2_29591, segred_tblock_sizze_49396 * blocks_per_segment_54619 * chunk_sizze_54590);
                int64_t num_virtblocks_54621 = blocks_per_segment_54619 * dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_29632;
                int64_t threads_per_segment_54622 = blocks_per_segment_54619 * segred_tblock_sizze_49396;
                
                if (ctx->debugging)
                    fprintf(ctx->log, "%s\n", "# SegRed-large");
                if (ctx->debugging)
                    fprintf(ctx->log, "%s: %llu%c", "num_segments", (long long) dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_29632, '\n');
                if (ctx->debugging)
                    fprintf(ctx->log, "%s: %llu%c", "segment_size", (long long) n2_29591, '\n');
                if (ctx->debugging)
                    fprintf(ctx->log, "%s: %llu%c", "num_virtblocks", (long long) num_virtblocks_54621, '\n');
                if (ctx->debugging)
                    fprintf(ctx->log, "%s: %llu%c", "num_tblocks", (long long) num_tblocks_49397, '\n');
                if (ctx->debugging)
                    fprintf(ctx->log, "%s: %llu%c", "tblock_size", (long long) segred_tblock_sizze_49396, '\n');
                if (ctx->debugging)
                    fprintf(ctx->log, "%s: %llu%c", "q", (long long) q_54620, '\n');
                if (ctx->debugging)
                    fprintf(ctx->log, "%s: %llu%c", "blocks_per_segment", (long long) blocks_per_segment_54619, '\n');
                if (memblock_alloc_device(ctx, &segred_tmp_mem_54623, (int64_t) 8 * num_virtblocks_54621, "segred_tmp_mem_54623")) {
                    err = 1;
                    goto cleanup;
                }
                {
                    err = gpu_kernel_get_num_neighbours_against_10103zisegred_large_49402(ctx, num_tblocks_49397, 1, 1, *ctx->tuning_params.get_num_neighbours_against_10103zisegred_tblock_sizze_49313, 1, 1, 8 + ((int64_t) 8 * segred_tblock_sizze_49396 + srem64((int64_t) 8 - srem64((int64_t) 8 * segred_tblock_sizze_49396, (int64_t) 8), (int64_t) 8)), n2_29591, eps_29596, dist_t_29597, angle_t_29598, radius_29599, inf_29626, dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_29632, num_tblocks_49397, x_53480, blocks_per_segment_54619, q_54620, num_virtblocks_54621, threads_per_segment_54622, dat1_mem_53506.mem, dat1_mem_53507.mem, dat2_mem_53508.mem, dat2_mem_53509.mem, mem_53511.mem, mem_53517.mem, mem_53519.mem, mem_53521.mem, segred_tmp_mem_54623.mem, counters_mem_54625.mem);
                    if (err != FUTHARK_SUCCESS)
                        goto cleanup;
                }
            }
            if (ctx->debugging)
                fprintf(ctx->log, "%s\n", "");
            if (memblock_unref_device(ctx, &mem_53517, "mem_53517") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_53519, "mem_53519") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_53521, "mem_53521") != 0)
                return 1;
        }
    }
    if (memblock_set_device(ctx, &mem_out_54541, &mem_53511, "mem_53511") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_57044, &mem_out_54541, "mem_out_54541") != 0)
        return 1;
    
  cleanup:
    {
        if (memblock_unref_device(ctx, &segred_tmp_mem_54623, "segred_tmp_mem_54623") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53521, "mem_53521") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53519, "mem_53519") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53517, "mem_53517") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53511, "mem_53511") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_54541, "mem_out_54541") != 0)
            return 1;
    }
    return err;
}
FUTHARK_FUN_ATTR int futrts_get_num_neighbours_against_10106(struct futhark_context *ctx, struct memblock_device *mem_out_p_57045, struct memblock_device dat1_mem_53506, struct memblock_device dat1_mem_53507, struct memblock_device dat2_mem_53508, struct memblock_device dat2_mem_53509, int64_t n1_29851, int64_t n2_29852, double eps_29857, int8_t dist_t_29858, int8_t angle_t_29859, double radius_29860, int64_t m_sizze_29861)
{
    (void) ctx;
    
    int err = 0;
    struct memblock_device segred_tmp_mem_54623;
    
    segred_tmp_mem_54623.references = NULL;
    
    struct memblock_device mem_53521;
    
    mem_53521.references = NULL;
    
    struct memblock_device mem_53519;
    
    mem_53519.references = NULL;
    
    struct memblock_device mem_53517;
    
    mem_53517.references = NULL;
    
    struct memblock_device mem_53511;
    
    mem_53511.references = NULL;
    
    struct memblock_device mem_out_54541;
    
    mem_out_54541.references = NULL;
    
    struct memblock_device counters_mem_54551 = ctx->constants->counters_mem_54551;
    struct memblock_device counters_mem_54625 = ctx->constants->counters_mem_54625;
    struct memblock_device counters_mem_55050 = ctx->constants->counters_mem_55050;
    struct memblock_device counters_mem_55495 = ctx->constants->counters_mem_55495;
    struct memblock_device counters_mem_55534 = ctx->constants->counters_mem_55534;
    struct memblock_device counters_mem_55581 = ctx->constants->counters_mem_55581;
    struct memblock_device counters_mem_56605 = ctx->constants->counters_mem_56605;
    struct memblock_device counters_mem_56764 = ctx->constants->counters_mem_56764;
    struct memblock_device counters_mem_56815 = ctx->constants->counters_mem_56815;
    struct memblock_device counters_mem_56850 = ctx->constants->counters_mem_56850;
    struct memblock_device global_dynid_mem_54616 = ctx->constants->global_dynid_mem_54616;
    struct memblock_device global_dynid_mem_54626 = ctx->constants->global_dynid_mem_54626;
    struct memblock_device global_dynid_mem_54637 = ctx->constants->global_dynid_mem_54637;
    struct memblock_device global_dynid_mem_54642 = ctx->constants->global_dynid_mem_54642;
    struct memblock_device global_dynid_mem_54800 = ctx->constants->global_dynid_mem_54800;
    struct memblock_device global_dynid_mem_54871 = ctx->constants->global_dynid_mem_54871;
    struct memblock_device global_dynid_mem_54920 = ctx->constants->global_dynid_mem_54920;
    struct memblock_device global_dynid_mem_55083 = ctx->constants->global_dynid_mem_55083;
    struct memblock_device global_dynid_mem_55112 = ctx->constants->global_dynid_mem_55112;
    struct memblock_device global_dynid_mem_55221 = ctx->constants->global_dynid_mem_55221;
    struct memblock_device global_dynid_mem_55228 = ctx->constants->global_dynid_mem_55228;
    struct memblock_device global_dynid_mem_55334 = ctx->constants->global_dynid_mem_55334;
    struct memblock_device global_dynid_mem_55338 = ctx->constants->global_dynid_mem_55338;
    struct memblock_device global_dynid_mem_55581 = ctx->constants->global_dynid_mem_55581;
    struct memblock_device global_dynid_mem_55728 = ctx->constants->global_dynid_mem_55728;
    struct memblock_device global_dynid_mem_55884 = ctx->constants->global_dynid_mem_55884;
    struct memblock_device global_dynid_mem_56002 = ctx->constants->global_dynid_mem_56002;
    struct memblock_device global_dynid_mem_56151 = ctx->constants->global_dynid_mem_56151;
    struct memblock_device global_dynid_mem_56269 = ctx->constants->global_dynid_mem_56269;
    struct memblock_device global_dynid_mem_56425 = ctx->constants->global_dynid_mem_56425;
    int64_t max_res_38036 = smax64((int64_t) 1, n2_29852);
    bool zzero_29864 = max_res_38036 == (int64_t) 0;
    bool nonzzero_29865 = !zzero_29864;
    bool nonzzero_cert_29866;
    
    if (!nonzzero_29865) {
        set_error(ctx, msgprintf("Error: %s\n\nBacktrace:\n%s", "division by zero", "-> #0  ft_libs/ftDBSCAN_plus.fut:487:55-69\n"));
        err = FUTHARK_PROGRAM_ERROR;
        goto cleanup;
    }
    
    int64_t max_arg1_29867 = sdiv64(m_sizze_29861, max_res_38036);
    int64_t max_res_38039 = smax64((int64_t) 1, max_arg1_29867);
    int64_t zm_lhs_29871 = add64(n1_29851, max_res_38039);
    int64_t zs_lhs_29873 = sub64(zm_lhs_29871, (int64_t) 1);
    bool zzero_29875 = max_res_38039 == (int64_t) 0;
    bool nonzzero_29876 = !zzero_29875;
    bool nonzzero_cert_29877;
    
    if (!nonzzero_29876) {
        set_error(ctx, msgprintf("Error: %s\n\nBacktrace:\n%s", "division by zero", "-> #0  ft_libs/ftDBSCAN_plus.fut:488:57-64\n"));
        err = FUTHARK_PROGRAM_ERROR;
        goto cleanup;
    }
    
    int64_t num_iter_29878 = sdiv64(zs_lhs_29873, max_res_38039);
    int64_t bytes_53510 = (int64_t) 8 * n1_29851;
    bool bounds_invalid_upwards_38041 = slt64(num_iter_29878, (int64_t) 0);
    bool valid_38042 = !bounds_invalid_upwards_38041;
    bool range_valid_c_38043;
    
    if (!valid_38042) {
        set_error(ctx, msgprintf("Error: %s%lld%s%lld%s%lld%s\n\nBacktrace:\n%s", "Range ", (long long) (int64_t) 0, "..", (long long) (int64_t) 1, "..<", (long long) num_iter_29878, " is invalid.", "-> #0  /prelude/array.fut:94:3-11\n   #1  ft_libs/ftDBSCAN_plus.fut:489:69-82\n"));
        err = FUTHARK_PROGRAM_ERROR;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_53511, bytes_53510, "mem_53511")) {
        err = 1;
        goto cleanup;
    }
    if (futrts_builtinzhreplicate_i64(ctx, mem_53511, n1_29851, (int64_t) 0) != 0) {
        err = 1;
        goto cleanup;
    }
    
    int64_t segmap_tblock_sizze_49612;
    
    segmap_tblock_sizze_49612 = *ctx->tuning_params.get_num_neighbours_against_10106zisegmap_tblock_sizze_49597;
    
    int64_t segred_tblock_sizze_49630;
    
    segred_tblock_sizze_49630 = *ctx->tuning_params.get_num_neighbours_against_10106zisegred_tblock_sizze_49547;
    
    int64_t tile_sizze_49826;
    
    tile_sizze_49826 = *ctx->tuning_params.get_num_neighbours_against_10106zitile_sizze_49825;
    
    bool match_val_53479 = dist_t_29858 == (int8_t) 0;
    bool x_53480 = !match_val_53479;
    int64_t num_whole_tiles_49871 = squot_safe64(n2_29852, tile_sizze_49826);
    int64_t residual_input_50060 = srem_safe64(n2_29852, tile_sizze_49826);
    bool cond_50061 = residual_input_50060 == (int64_t) 0;
    int64_t binop_x_50074 = tile_sizze_49826 * num_whole_tiles_49871;
    int64_t bytes_53551 = (int64_t) 8 * tile_sizze_49826;
    
    for (int64_t i_29884 = 0; i_29884 < num_iter_29878; i_29884++) {
        int64_t inf_29887 = mul64(i_29884, max_res_38039);
        int64_t min_arg1_29889 = add64(inf_29887, max_res_38039);
        int64_t min_res_38051 = smin64(n1_29851, min_arg1_29889);
        int64_t dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_29893 = sub64(min_res_38051, inf_29887);
        bool empty_slice_29905 = dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_29893 == (int64_t) 0;
        int64_t m_29906 = sub64(dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_29893, (int64_t) 1);
        int64_t i_p_m_t_s_29908 = add64(inf_29887, m_29906);
        bool zzero_leq_i_p_m_t_s_29909 = sle64((int64_t) 0, i_p_m_t_s_29908);
        bool i_p_m_t_s_leq_w_29911 = slt64(i_p_m_t_s_29908, n1_29851);
        bool zzero_lte_i_29912 = sle64((int64_t) 0, inf_29887);
        bool i_lte_j_29913 = sle64(inf_29887, min_res_38051);
        bool y_29914 = i_p_m_t_s_leq_w_29911 && zzero_lte_i_29912;
        bool y_29915 = zzero_leq_i_p_m_t_s_29909 && y_29914;
        bool forwards_ok_29916 = i_lte_j_29913 && y_29915;
        bool ok_or_empty_29923 = empty_slice_29905 || forwards_ok_29916;
        bool index_certs_29925;
        
        if (!ok_or_empty_29923) {
            set_error(ctx, msgprintf("Error: %s%lld%s%lld%s%lld%s\n\nBacktrace:\n%s", "Index [", (long long) inf_29887, ":", (long long) min_res_38051, "] out of bounds for array of shape [", (long long) n1_29851, "].", "-> #0  ft_libs/ftDBSCAN_plus.fut:492:47-60\n"));
            err = FUTHARK_PROGRAM_ERROR;
            goto cleanup;
        }
        
        bool suff_outer_par_49442;
        
        suff_outer_par_49442 = *ctx->tuning_params.get_num_neighbours_against_10106zisuff_outer_par_0 <= dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_29893;
        if (ctx->logging)
            fprintf(ctx->log, "Compared %s <= %ld: %s.\n", "get_num_neighbours_against_10106.suff_outer_par_0", (long) dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_29893, suff_outer_par_49442 ? "true" : "false");
        
        int64_t nest_sizze_49629 = n2_29852 * dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_29893;
        int64_t num_tblocks_49631;
        int64_t max_num_tblocks_54563;
        
        max_num_tblocks_54563 = *ctx->tuning_params.get_num_neighbours_against_10106zisegred_num_tblocks_49549;
        num_tblocks_49631 = sext_i64_i32(smax64((int64_t) 1, smin64(sdiv_up64(nest_sizze_49629, segred_tblock_sizze_49630), max_num_tblocks_54563)));
        
        int64_t bytes_53516 = (int64_t) 8 * dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_29893;
        int64_t shared_memory_capacity_54682;
        
        shared_memory_capacity_54682 = ctx->max_shared_memory;
        if (suff_outer_par_49442 && sle64(sdiv_up64(bytes_53551, (int64_t) 8) * (int64_t) 8 + sdiv_up64(bytes_53551, (int64_t) 8) * (int64_t) 8, shared_memory_capacity_54682)) {
            int64_t ldim_49827 = sdiv_up64(dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_29893, tile_sizze_49826);
            
            if (ctx->debugging)
                fprintf(ctx->log, "%s\n", "\n# SegMap");
            
            int32_t num_chunks_54564 = sext_i64_i32(sdiv_up64(tile_sizze_49826, tile_sizze_49826));
            int32_t virt_num_tblocks_54565 = sext_i64_i32(ldim_49827);
            
            {
                err = gpu_kernel_get_num_neighbours_against_10106zisegmap_intrablock_49824(ctx, ldim_49827, 1, 1, *ctx->tuning_params.get_num_neighbours_against_10106zitile_sizze_49825, 1, 1, bytes_53551 + srem64((int64_t) 8 - srem64(bytes_53551, (int64_t) 8), (int64_t) 8) + (bytes_53551 + srem64((int64_t) 8 - srem64(bytes_53551, (int64_t) 8), (int64_t) 8)), n2_29852, eps_29857, dist_t_29858, angle_t_29859, radius_29860, inf_29887, dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_29893, ldim_49827, num_whole_tiles_49871, residual_input_50060, cond_50061, binop_x_50074, dat1_mem_53506.mem, dat1_mem_53507.mem, dat2_mem_53508.mem, dat2_mem_53509.mem, mem_53511.mem);
                if (err != FUTHARK_SUCCESS)
                    goto cleanup;
            }
            if (ctx->debugging)
                fprintf(ctx->log, "%s\n", "");
        } else {
            int64_t segmap_usable_groups_49613 = sdiv_up64(dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_29893, segmap_tblock_sizze_49612);
            
            if (memblock_alloc_device(ctx, &mem_53517, bytes_53516, "mem_53517")) {
                err = 1;
                goto cleanup;
            }
            if (memblock_alloc_device(ctx, &mem_53519, bytes_53516, "mem_53519")) {
                err = 1;
                goto cleanup;
            }
            if (memblock_alloc_device(ctx, &mem_53521, bytes_53516, "mem_53521")) {
                err = 1;
                goto cleanup;
            }
            if (ctx->debugging)
                fprintf(ctx->log, "%s\n", "\n# SegMap");
            
            int32_t virt_num_tblocks_54581 = sext_i64_i32(sdiv_up64(dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_29893, segmap_tblock_sizze_49612));
            
            {
                err = gpu_kernel_get_num_neighbours_against_10106zisegmap_49618(ctx, segmap_usable_groups_49613, 1, 1, *ctx->tuning_params.get_num_neighbours_against_10106zisegmap_tblock_sizze_49597, 1, 1, (int64_t) 0, angle_t_29859, inf_29887, dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_29893, dat1_mem_53506.mem, dat1_mem_53507.mem, mem_53517.mem, mem_53519.mem, mem_53521.mem);
                if (err != FUTHARK_SUCCESS)
                    goto cleanup;
            }
            if (ctx->debugging)
                fprintf(ctx->log, "%s\n", "");
            if (ctx->debugging)
                fprintf(ctx->log, "%s\n", "\n# SegRed");
            
            int64_t chunk_sizze_54590 = (int64_t) 1;
            
            if (slt64(n2_29852 * (int64_t) 2, segred_tblock_sizze_49630 * chunk_sizze_54590)) {
                int64_t segment_sizze_nonzzero_54591 = smax64((int64_t) 1, n2_29852);
                int64_t num_threads_54592 = segred_tblock_sizze_49630 * segred_tblock_sizze_49630;
                
                if (ctx->debugging)
                    fprintf(ctx->log, "%s\n", "# SegRed-small");
                if (ctx->debugging)
                    fprintf(ctx->log, "%s: %llu%c", "num_segments", (long long) dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_29893, '\n');
                if (ctx->debugging)
                    fprintf(ctx->log, "%s: %llu%c", "segment_size", (long long) n2_29852, '\n');
                if (ctx->debugging)
                    fprintf(ctx->log, "%s: %llu%c", "segments_per_block", (long long) squot64(segred_tblock_sizze_49630, segment_sizze_nonzzero_54591), '\n');
                if (ctx->debugging)
                    fprintf(ctx->log, "%s: %llu%c", "required_blocks", (long long) sext_i64_i32(sdiv_up64(dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_29893, squot64(segred_tblock_sizze_49630, segment_sizze_nonzzero_54591))), '\n');
                {
                    err = gpu_kernel_get_num_neighbours_against_10106zisegred_small_49636(ctx, num_tblocks_49631, 1, 1, *ctx->tuning_params.get_num_neighbours_against_10106zisegred_tblock_sizze_49547, 1, 1, (int64_t) 8 * segred_tblock_sizze_49630 + srem64((int64_t) 8 - srem64((int64_t) 8 * segred_tblock_sizze_49630, (int64_t) 8), (int64_t) 8), n2_29852, eps_29857, dist_t_29858, angle_t_29859, radius_29860, inf_29887, dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_29893, num_tblocks_49631, x_53480, segment_sizze_nonzzero_54591, dat1_mem_53506.mem, dat1_mem_53507.mem, dat2_mem_53508.mem, dat2_mem_53509.mem, mem_53511.mem, mem_53517.mem, mem_53519.mem, mem_53521.mem);
                    if (err != FUTHARK_SUCCESS)
                        goto cleanup;
                }
            } else {
                int64_t blocks_per_segment_54619 = sdiv_up64(num_tblocks_49631, smax64((int64_t) 1, dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_29893));
                int64_t q_54620 = sdiv_up64(n2_29852, segred_tblock_sizze_49630 * blocks_per_segment_54619 * chunk_sizze_54590);
                int64_t num_virtblocks_54621 = blocks_per_segment_54619 * dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_29893;
                int64_t threads_per_segment_54622 = blocks_per_segment_54619 * segred_tblock_sizze_49630;
                
                if (ctx->debugging)
                    fprintf(ctx->log, "%s\n", "# SegRed-large");
                if (ctx->debugging)
                    fprintf(ctx->log, "%s: %llu%c", "num_segments", (long long) dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_29893, '\n');
                if (ctx->debugging)
                    fprintf(ctx->log, "%s: %llu%c", "segment_size", (long long) n2_29852, '\n');
                if (ctx->debugging)
                    fprintf(ctx->log, "%s: %llu%c", "num_virtblocks", (long long) num_virtblocks_54621, '\n');
                if (ctx->debugging)
                    fprintf(ctx->log, "%s: %llu%c", "num_tblocks", (long long) num_tblocks_49631, '\n');
                if (ctx->debugging)
                    fprintf(ctx->log, "%s: %llu%c", "tblock_size", (long long) segred_tblock_sizze_49630, '\n');
                if (ctx->debugging)
                    fprintf(ctx->log, "%s: %llu%c", "q", (long long) q_54620, '\n');
                if (ctx->debugging)
                    fprintf(ctx->log, "%s: %llu%c", "blocks_per_segment", (long long) blocks_per_segment_54619, '\n');
                if (memblock_alloc_device(ctx, &segred_tmp_mem_54623, (int64_t) 8 * num_virtblocks_54621, "segred_tmp_mem_54623")) {
                    err = 1;
                    goto cleanup;
                }
                {
                    err = gpu_kernel_get_num_neighbours_against_10106zisegred_large_49636(ctx, num_tblocks_49631, 1, 1, *ctx->tuning_params.get_num_neighbours_against_10106zisegred_tblock_sizze_49547, 1, 1, 8 + ((int64_t) 8 * segred_tblock_sizze_49630 + srem64((int64_t) 8 - srem64((int64_t) 8 * segred_tblock_sizze_49630, (int64_t) 8), (int64_t) 8)), n2_29852, eps_29857, dist_t_29858, angle_t_29859, radius_29860, inf_29887, dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_29893, num_tblocks_49631, x_53480, blocks_per_segment_54619, q_54620, num_virtblocks_54621, threads_per_segment_54622, dat1_mem_53506.mem, dat1_mem_53507.mem, dat2_mem_53508.mem, dat2_mem_53509.mem, mem_53511.mem, mem_53517.mem, mem_53519.mem, mem_53521.mem, segred_tmp_mem_54623.mem, counters_mem_54625.mem);
                    if (err != FUTHARK_SUCCESS)
                        goto cleanup;
                }
            }
            if (ctx->debugging)
                fprintf(ctx->log, "%s\n", "");
            if (memblock_unref_device(ctx, &mem_53517, "mem_53517") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_53519, "mem_53519") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_53521, "mem_53521") != 0)
                return 1;
        }
    }
    if (memblock_set_device(ctx, &mem_out_54541, &mem_53511, "mem_53511") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_57045, &mem_out_54541, "mem_out_54541") != 0)
        return 1;
    
  cleanup:
    {
        if (memblock_unref_device(ctx, &segred_tmp_mem_54623, "segred_tmp_mem_54623") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53521, "mem_53521") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53519, "mem_53519") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53517, "mem_53517") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_53511, "mem_53511") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_54541, "mem_out_54541") != 0)
            return 1;
    }
    return err;
}

int futhark_entry_add_next_partition_double(struct futhark_context *ctx, struct futhark_opaque_dbcHandler_double **out0, const struct futhark_opaque_dbcHandler_double *in0, const int64_t in1, const struct futhark_f64_1d *in2, const struct futhark_f64_1d *in3)
{
    int64_t n_old_28413 = (int64_t) 0;
    int64_t part_no_28414 = (int64_t) 0;
    int64_t dz2084U_28415 = (int64_t) 0;
    int64_t dz2080U_28416 = (int64_t) 0;
    int64_t dz2081U_28417 = (int64_t) 0;
    int64_t dz2082U_28418 = (int64_t) 0;
    int64_t dz2083U_28419 = (int64_t) 0;
    int64_t dz2085U_28420 = (int64_t) 0;
    int64_t dz2086U_28421 = (int64_t) 0;
    int64_t n_new_28422 = (int64_t) 0;
    int8_t clBase_28425 = (int8_t) 0;
    int8_t clBase_28426 = (int8_t) 0;
    double clBase_28427 = 0.0;
    int64_t clBase_28428 = (int64_t) 0;
    int64_t clBase_28430 = (int64_t) 0;
    double clBase_28433 = 0.0;
    int64_t clBase_28435 = (int64_t) 0;
    int64_t clProc_28440 = (int64_t) 0;
    int64_t clProc_28441 = (int64_t) 0;
    int64_t clProc_28442 = (int64_t) 0;
    int64_t clProc_28444 = (int64_t) 0;
    int64_t clProc_28445 = (int64_t) 0;
    int64_t current_partition_28459 = (int64_t) 0;
    int64_t new_id_28463 = (int64_t) 0;
    int64_t prim_out_54568 = (int64_t) 0;
    int64_t prim_out_54569 = (int64_t) 0;
    int64_t prim_out_54570 = (int64_t) 0;
    int8_t prim_out_54571 = (int8_t) 0;
    int8_t prim_out_54572 = (int8_t) 0;
    double prim_out_54573 = 0.0;
    int64_t prim_out_54574 = (int64_t) 0;
    int64_t prim_out_54575 = (int64_t) 0;
    double prim_out_54576 = 0.0;
    int64_t prim_out_54577 = (int64_t) 0;
    int64_t prim_out_54578 = (int64_t) 0;
    int64_t prim_out_54579 = (int64_t) 0;
    int64_t prim_out_54580 = (int64_t) 0;
    int64_t prim_out_54581 = (int64_t) 0;
    int64_t prim_out_54582 = (int64_t) 0;
    int64_t prim_out_54583 = (int64_t) 0;
    int ret = 0;
    
    lock_lock(&ctx->lock);
    CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
    
    struct memblock_device mem_out_54567;
    
    mem_out_54567.references = NULL;
    
    struct memblock_device mem_out_54566;
    
    mem_out_54566.references = NULL;
    
    struct memblock_device mem_out_54565;
    
    mem_out_54565.references = NULL;
    
    struct memblock_device mem_out_54564;
    
    mem_out_54564.references = NULL;
    
    struct memblock_device mem_out_54563;
    
    mem_out_54563.references = NULL;
    
    struct memblock_device mem_out_54562;
    
    mem_out_54562.references = NULL;
    
    struct memblock_device mem_out_54561;
    
    mem_out_54561.references = NULL;
    
    struct memblock_device mem_out_54560;
    
    mem_out_54560.references = NULL;
    
    struct memblock_device mem_out_54559;
    
    mem_out_54559.references = NULL;
    
    struct memblock_device mem_out_54558;
    
    mem_out_54558.references = NULL;
    
    struct memblock_device mem_out_54557;
    
    mem_out_54557.references = NULL;
    
    struct memblock_device mem_out_54556;
    
    mem_out_54556.references = NULL;
    
    struct memblock_device mem_out_54555;
    
    mem_out_54555.references = NULL;
    
    struct memblock_device mem_out_54554;
    
    mem_out_54554.references = NULL;
    
    struct memblock_device mem_out_54553;
    
    mem_out_54553.references = NULL;
    
    struct memblock_device mem_out_54552;
    
    mem_out_54552.references = NULL;
    
    struct memblock_device mem_out_54551;
    
    mem_out_54551.references = NULL;
    
    struct memblock_device mem_out_54550;
    
    mem_out_54550.references = NULL;
    
    struct memblock_device mem_out_54549;
    
    mem_out_54549.references = NULL;
    
    struct memblock_device mem_out_54548;
    
    mem_out_54548.references = NULL;
    
    struct memblock_device mem_out_54547;
    
    mem_out_54547.references = NULL;
    
    struct memblock_device mem_out_54546;
    
    mem_out_54546.references = NULL;
    
    struct memblock_device mem_out_54545;
    
    mem_out_54545.references = NULL;
    
    struct memblock_device mem_out_54544;
    
    mem_out_54544.references = NULL;
    
    struct memblock_device mem_out_54543;
    
    mem_out_54543.references = NULL;
    
    struct memblock_device mem_out_54542;
    
    mem_out_54542.references = NULL;
    
    struct memblock_device mem_out_54541;
    
    mem_out_54541.references = NULL;
    
    struct memblock_device new_ys_mem_53534;
    
    new_ys_mem_53534.references = NULL;
    
    struct memblock_device new_xs_mem_53533;
    
    new_xs_mem_53533.references = NULL;
    
    struct memblock_device toFlush_ids_mem_53532;
    
    toFlush_ids_mem_53532.references = NULL;
    
    struct memblock_device toFlush_dat_mem_53531;
    
    toFlush_dat_mem_53531.references = NULL;
    
    struct memblock_device toFlush_dat_mem_53530;
    
    toFlush_dat_mem_53530.references = NULL;
    
    struct memblock_device current_partition_mem_53529;
    
    current_partition_mem_53529.references = NULL;
    
    struct memblock_device current_partition_mem_53528;
    
    current_partition_mem_53528.references = NULL;
    
    struct memblock_device current_partition_mem_53527;
    
    current_partition_mem_53527.references = NULL;
    
    struct memblock_device current_partition_mem_53526;
    
    current_partition_mem_53526.references = NULL;
    
    struct memblock_device current_partition_mem_53525;
    
    current_partition_mem_53525.references = NULL;
    
    struct memblock_device current_partition_mem_53524;
    
    current_partition_mem_53524.references = NULL;
    
    struct memblock_device current_partition_mem_53523;
    
    current_partition_mem_53523.references = NULL;
    
    struct memblock_device current_partition_mem_53522;
    
    current_partition_mem_53522.references = NULL;
    
    struct memblock_device current_partition_mem_53521;
    
    current_partition_mem_53521.references = NULL;
    
    struct memblock_device current_partition_mem_53520;
    
    current_partition_mem_53520.references = NULL;
    
    struct memblock_device current_partition_mem_53519;
    
    current_partition_mem_53519.references = NULL;
    
    struct memblock_device current_partition_mem_53518;
    
    current_partition_mem_53518.references = NULL;
    
    struct memblock_device clProc_mem_53517;
    
    clProc_mem_53517.references = NULL;
    
    struct memblock_device clProc_mem_53516;
    
    clProc_mem_53516.references = NULL;
    
    struct memblock_device clProc_mem_53515;
    
    clProc_mem_53515.references = NULL;
    
    struct memblock_device clProc_mem_53514;
    
    clProc_mem_53514.references = NULL;
    
    struct memblock_device clProc_mem_53513;
    
    clProc_mem_53513.references = NULL;
    
    struct memblock_device clProc_mem_53512;
    
    clProc_mem_53512.references = NULL;
    
    struct memblock_device clBase_mem_53511;
    
    clBase_mem_53511.references = NULL;
    
    struct memblock_device clBase_mem_53510;
    
    clBase_mem_53510.references = NULL;
    
    struct memblock_device clBase_mem_53509;
    
    clBase_mem_53509.references = NULL;
    
    struct memblock_device clBase_mem_53508;
    
    clBase_mem_53508.references = NULL;
    
    struct memblock_device chain_collisions_mem_53507;
    
    chain_collisions_mem_53507.references = NULL;
    
    struct memblock_device chain_collisions_mem_53506;
    
    chain_collisions_mem_53506.references = NULL;
    chain_collisions_mem_53506 = in0->v0->mem;
    dz2084U_28415 = in0->v0->shape[0];
    chain_collisions_mem_53507 = in0->v1->mem;
    dz2084U_28415 = in0->v1->shape[0];
    clBase_28425 = in0->v2;
    clBase_28426 = in0->v3;
    clBase_28427 = in0->v4;
    clBase_28428 = in0->v5;
    clBase_mem_53508 = in0->v6->mem;
    clBase_28430 = in0->v7;
    clBase_mem_53509 = in0->v8->mem;
    clBase_mem_53510 = in0->v9->mem;
    clBase_28433 = in0->v10;
    clBase_mem_53511 = in0->v11->mem;
    clBase_28435 = in0->v12;
    clProc_mem_53512 = in0->v13->mem;
    dz2080U_28416 = in0->v13->shape[0];
    clProc_mem_53513 = in0->v14->mem;
    dz2081U_28417 = in0->v14->shape[0];
    clProc_mem_53514 = in0->v15->mem;
    dz2082U_28418 = in0->v15->shape[0];
    clProc_mem_53515 = in0->v16->mem;
    dz2082U_28418 = in0->v16->shape[0];
    clProc_28440 = in0->v17;
    clProc_28441 = in0->v18;
    clProc_28442 = in0->v19;
    clProc_mem_53516 = in0->v20->mem;
    part_no_28414 = in0->v20->shape[0];
    clProc_28444 = in0->v21;
    clProc_28445 = in0->v22;
    clProc_mem_53517 = in0->v23->mem;
    dz2083U_28419 = in0->v23->shape[0];
    current_partition_mem_53518 = in0->v24->mem;
    n_old_28413 = in0->v24->shape[0];
    current_partition_mem_53519 = in0->v25->mem;
    n_old_28413 = in0->v25->shape[0];
    current_partition_mem_53520 = in0->v26->mem;
    n_old_28413 = in0->v26->shape[0];
    current_partition_mem_53521 = in0->v27->mem;
    current_partition_mem_53522 = in0->v28->mem;
    current_partition_mem_53523 = in0->v29->mem;
    n_old_28413 = in0->v29->shape[0];
    current_partition_mem_53524 = in0->v30->mem;
    n_old_28413 = in0->v30->shape[0];
    current_partition_mem_53525 = in0->v31->mem;
    current_partition_mem_53526 = in0->v32->mem;
    n_old_28413 = in0->v32->shape[0];
    current_partition_mem_53527 = in0->v33->mem;
    current_partition_mem_53528 = in0->v34->mem;
    current_partition_mem_53529 = in0->v35->mem;
    current_partition_28459 = in0->v36;
    toFlush_dat_mem_53530 = in0->v37->mem;
    dz2085U_28420 = in0->v37->shape[0];
    toFlush_dat_mem_53531 = in0->v38->mem;
    dz2085U_28420 = in0->v38->shape[0];
    toFlush_ids_mem_53532 = in0->v39->mem;
    dz2086U_28421 = in0->v39->shape[0];
    new_id_28463 = in1;
    new_xs_mem_53533 = in2->mem;
    n_new_28422 = in2->shape[0];
    new_ys_mem_53534 = in3->mem;
    n_new_28422 = in3->shape[0];
    if (!((dz2084U_28415 == in0->v0->shape[0] && (dz2084U_28415 == in0->v1->shape[0] && ((int64_t) 2 == in0->v6->shape[0] && ((int64_t) 2 == in0->v8->shape[0] && ((int64_t) 2 == in0->v9->shape[0] && ((int64_t) 2 == in0->v11->shape[0] && (dz2080U_28416 == in0->v13->shape[0] && (dz2081U_28417 == in0->v14->shape[0] && (dz2082U_28418 == in0->v15->shape[0] && (dz2082U_28418 == in0->v16->shape[0] && (part_no_28414 == in0->v20->shape[0] && (dz2083U_28419 == in0->v23->shape[0] && (n_old_28413 == in0->v24->shape[0] && (n_old_28413 == in0->v25->shape[0] && (n_old_28413 == in0->v26->shape[0] && ((int64_t) 2 == in0->v27->shape[0] && ((int64_t) 2 == in0->v28->shape[0] && (n_old_28413 == in0->v29->shape[0] && (n_old_28413 == in0->v30->shape[0] && ((int64_t) 8 == in0->v31->shape[0] && (n_old_28413 == in0->v32->shape[0] && ((int64_t) 2 == in0->v33->shape[0] && ((int64_t) 2 == in0->v34->shape[0] && ((int64_t) 8 == in0->v35->shape[0] && (dz2085U_28420 == in0->v37->shape[0] && (dz2085U_28420 == in0->v38->shape[0] && dz2086U_28421 == in0->v39->shape[0])))))))))))))))))))))))))) && (n_new_28422 == in2->shape[0] && n_new_28422 == in3->shape[0]))) {
        ret = 1;
        set_error(ctx, msgprintf("Error: entry point arguments have invalid sizes.\n"));
    }
    if (ret == 0) {
        ret = futrts_entry_add_next_partition_double(ctx, &mem_out_54541, &mem_out_54542, &mem_out_54543, &mem_out_54544, &mem_out_54545, &mem_out_54546, &mem_out_54547, &mem_out_54548, &mem_out_54549, &mem_out_54550, &mem_out_54551, &mem_out_54552, &mem_out_54553, &mem_out_54554, &mem_out_54555, &mem_out_54556, &mem_out_54557, &mem_out_54558, &mem_out_54559, &mem_out_54560, &mem_out_54561, &mem_out_54562, &mem_out_54563, &mem_out_54564, &mem_out_54565, &mem_out_54566, &mem_out_54567, &prim_out_54568, &prim_out_54569, &prim_out_54570, &prim_out_54571, &prim_out_54572, &prim_out_54573, &prim_out_54574, &prim_out_54575, &prim_out_54576, &prim_out_54577, &prim_out_54578, &prim_out_54579, &prim_out_54580, &prim_out_54581, &prim_out_54582, &prim_out_54583, chain_collisions_mem_53506, chain_collisions_mem_53507, clBase_mem_53508, clBase_mem_53509, clBase_mem_53510, clBase_mem_53511, clProc_mem_53512, clProc_mem_53513, clProc_mem_53514, clProc_mem_53515, clProc_mem_53516, clProc_mem_53517, current_partition_mem_53518, current_partition_mem_53519, current_partition_mem_53520, current_partition_mem_53521, current_partition_mem_53522, current_partition_mem_53523, current_partition_mem_53524, current_partition_mem_53525, current_partition_mem_53526, current_partition_mem_53527, current_partition_mem_53528, current_partition_mem_53529, toFlush_dat_mem_53530, toFlush_dat_mem_53531, toFlush_ids_mem_53532, new_xs_mem_53533, new_ys_mem_53534, n_old_28413, part_no_28414, dz2084U_28415, dz2080U_28416, dz2081U_28417, dz2082U_28418, dz2083U_28419, dz2085U_28420, dz2086U_28421, n_new_28422, clBase_28425, clBase_28426, clBase_28427, clBase_28428, clBase_28430, clBase_28433, clBase_28435, clProc_28440, clProc_28441, clProc_28442, clProc_28444, clProc_28445, current_partition_28459, new_id_28463);
        if (ret == 0) {
            struct memblock_device counters_mem_54551 = ctx->constants->counters_mem_54551;
            struct memblock_device counters_mem_54625 = ctx->constants->counters_mem_54625;
            struct memblock_device counters_mem_55050 = ctx->constants->counters_mem_55050;
            struct memblock_device counters_mem_55495 = ctx->constants->counters_mem_55495;
            struct memblock_device counters_mem_55534 = ctx->constants->counters_mem_55534;
            struct memblock_device counters_mem_55581 = ctx->constants->counters_mem_55581;
            struct memblock_device counters_mem_56605 = ctx->constants->counters_mem_56605;
            struct memblock_device counters_mem_56764 = ctx->constants->counters_mem_56764;
            struct memblock_device counters_mem_56815 = ctx->constants->counters_mem_56815;
            struct memblock_device counters_mem_56850 = ctx->constants->counters_mem_56850;
            struct memblock_device global_dynid_mem_54616 = ctx->constants->global_dynid_mem_54616;
            struct memblock_device global_dynid_mem_54626 = ctx->constants->global_dynid_mem_54626;
            struct memblock_device global_dynid_mem_54637 = ctx->constants->global_dynid_mem_54637;
            struct memblock_device global_dynid_mem_54642 = ctx->constants->global_dynid_mem_54642;
            struct memblock_device global_dynid_mem_54800 = ctx->constants->global_dynid_mem_54800;
            struct memblock_device global_dynid_mem_54871 = ctx->constants->global_dynid_mem_54871;
            struct memblock_device global_dynid_mem_54920 = ctx->constants->global_dynid_mem_54920;
            struct memblock_device global_dynid_mem_55083 = ctx->constants->global_dynid_mem_55083;
            struct memblock_device global_dynid_mem_55112 = ctx->constants->global_dynid_mem_55112;
            struct memblock_device global_dynid_mem_55221 = ctx->constants->global_dynid_mem_55221;
            struct memblock_device global_dynid_mem_55228 = ctx->constants->global_dynid_mem_55228;
            struct memblock_device global_dynid_mem_55334 = ctx->constants->global_dynid_mem_55334;
            struct memblock_device global_dynid_mem_55338 = ctx->constants->global_dynid_mem_55338;
            struct memblock_device global_dynid_mem_55581 = ctx->constants->global_dynid_mem_55581;
            struct memblock_device global_dynid_mem_55728 = ctx->constants->global_dynid_mem_55728;
            struct memblock_device global_dynid_mem_55884 = ctx->constants->global_dynid_mem_55884;
            struct memblock_device global_dynid_mem_56002 = ctx->constants->global_dynid_mem_56002;
            struct memblock_device global_dynid_mem_56151 = ctx->constants->global_dynid_mem_56151;
            struct memblock_device global_dynid_mem_56269 = ctx->constants->global_dynid_mem_56269;
            struct memblock_device global_dynid_mem_56425 = ctx->constants->global_dynid_mem_56425;
            
            assert((*out0 = (struct futhark_opaque_dbcHandler_double *) malloc(sizeof(struct futhark_opaque_dbcHandler_double))) != NULL);
            assert(((*out0)->v0 = (struct futhark_i64_1d *) malloc(sizeof(struct futhark_i64_1d))) != NULL);
            (*out0)->v0->mem = mem_out_54541;
            (*out0)->v0->shape[0] = dz2084U_28415;
            assert(((*out0)->v1 = (struct futhark_i64_1d *) malloc(sizeof(struct futhark_i64_1d))) != NULL);
            (*out0)->v1->mem = mem_out_54542;
            (*out0)->v1->shape[0] = dz2084U_28415;
            (*out0)->v2 = prim_out_54571;
            (*out0)->v3 = prim_out_54572;
            (*out0)->v4 = prim_out_54573;
            (*out0)->v5 = prim_out_54574;
            assert(((*out0)->v6 = (struct futhark_f64_1d *) malloc(sizeof(struct futhark_f64_1d))) != NULL);
            (*out0)->v6->mem = mem_out_54543;
            (*out0)->v6->shape[0] = (int64_t) 2;
            (*out0)->v7 = prim_out_54575;
            assert(((*out0)->v8 = (struct futhark_f64_1d *) malloc(sizeof(struct futhark_f64_1d))) != NULL);
            (*out0)->v8->mem = mem_out_54544;
            (*out0)->v8->shape[0] = (int64_t) 2;
            assert(((*out0)->v9 = (struct futhark_i64_1d *) malloc(sizeof(struct futhark_i64_1d))) != NULL);
            (*out0)->v9->mem = mem_out_54545;
            (*out0)->v9->shape[0] = (int64_t) 2;
            (*out0)->v10 = prim_out_54576;
            assert(((*out0)->v11 = (struct futhark_f64_1d *) malloc(sizeof(struct futhark_f64_1d))) != NULL);
            (*out0)->v11->mem = mem_out_54546;
            (*out0)->v11->shape[0] = (int64_t) 2;
            (*out0)->v12 = prim_out_54577;
            assert(((*out0)->v13 = (struct futhark_bool_1d *) malloc(sizeof(struct futhark_bool_1d))) != NULL);
            (*out0)->v13->mem = mem_out_54547;
            (*out0)->v13->shape[0] = prim_out_54568;
            assert(((*out0)->v14 = (struct futhark_i64_1d *) malloc(sizeof(struct futhark_i64_1d))) != NULL);
            (*out0)->v14->mem = mem_out_54548;
            (*out0)->v14->shape[0] = prim_out_54568;
            assert(((*out0)->v15 = (struct futhark_f64_1d *) malloc(sizeof(struct futhark_f64_1d))) != NULL);
            (*out0)->v15->mem = mem_out_54549;
            (*out0)->v15->shape[0] = prim_out_54568;
            assert(((*out0)->v16 = (struct futhark_f64_1d *) malloc(sizeof(struct futhark_f64_1d))) != NULL);
            (*out0)->v16->mem = mem_out_54550;
            (*out0)->v16->shape[0] = prim_out_54568;
            (*out0)->v17 = prim_out_54578;
            (*out0)->v18 = prim_out_54579;
            (*out0)->v19 = prim_out_54580;
            assert(((*out0)->v20 = (struct futhark_bool_1d *) malloc(sizeof(struct futhark_bool_1d))) != NULL);
            (*out0)->v20->mem = mem_out_54551;
            (*out0)->v20->shape[0] = part_no_28414;
            (*out0)->v21 = prim_out_54581;
            (*out0)->v22 = prim_out_54582;
            assert(((*out0)->v23 = (struct futhark_i64_1d *) malloc(sizeof(struct futhark_i64_1d))) != NULL);
            (*out0)->v23->mem = mem_out_54552;
            (*out0)->v23->shape[0] = prim_out_54569;
            assert(((*out0)->v24 = (struct futhark_i64_1d *) malloc(sizeof(struct futhark_i64_1d))) != NULL);
            (*out0)->v24->mem = mem_out_54553;
            (*out0)->v24->shape[0] = n_new_28422;
            assert(((*out0)->v25 = (struct futhark_f64_1d *) malloc(sizeof(struct futhark_f64_1d))) != NULL);
            (*out0)->v25->mem = mem_out_54554;
            (*out0)->v25->shape[0] = n_new_28422;
            assert(((*out0)->v26 = (struct futhark_f64_1d *) malloc(sizeof(struct futhark_f64_1d))) != NULL);
            (*out0)->v26->mem = mem_out_54555;
            (*out0)->v26->shape[0] = n_new_28422;
            assert(((*out0)->v27 = (struct futhark_f64_1d *) malloc(sizeof(struct futhark_f64_1d))) != NULL);
            (*out0)->v27->mem = mem_out_54556;
            (*out0)->v27->shape[0] = (int64_t) 2;
            assert(((*out0)->v28 = (struct futhark_f64_1d *) malloc(sizeof(struct futhark_f64_1d))) != NULL);
            (*out0)->v28->mem = mem_out_54557;
            (*out0)->v28->shape[0] = (int64_t) 2;
            assert(((*out0)->v29 = (struct futhark_bool_1d *) malloc(sizeof(struct futhark_bool_1d))) != NULL);
            (*out0)->v29->mem = mem_out_54558;
            (*out0)->v29->shape[0] = n_new_28422;
            assert(((*out0)->v30 = (struct futhark_bool_1d *) malloc(sizeof(struct futhark_bool_1d))) != NULL);
            (*out0)->v30->mem = mem_out_54559;
            (*out0)->v30->shape[0] = n_new_28422;
            assert(((*out0)->v31 = (struct futhark_bool_1d *) malloc(sizeof(struct futhark_bool_1d))) != NULL);
            (*out0)->v31->mem = mem_out_54560;
            (*out0)->v31->shape[0] = (int64_t) 8;
            assert(((*out0)->v32 = (struct futhark_bool_1d *) malloc(sizeof(struct futhark_bool_1d))) != NULL);
            (*out0)->v32->mem = mem_out_54561;
            (*out0)->v32->shape[0] = n_new_28422;
            assert(((*out0)->v33 = (struct futhark_f64_1d *) malloc(sizeof(struct futhark_f64_1d))) != NULL);
            (*out0)->v33->mem = mem_out_54562;
            (*out0)->v33->shape[0] = (int64_t) 2;
            assert(((*out0)->v34 = (struct futhark_f64_1d *) malloc(sizeof(struct futhark_f64_1d))) != NULL);
            (*out0)->v34->mem = mem_out_54563;
            (*out0)->v34->shape[0] = (int64_t) 2;
            assert(((*out0)->v35 = (struct futhark_i64_1d *) malloc(sizeof(struct futhark_i64_1d))) != NULL);
            (*out0)->v35->mem = mem_out_54564;
            (*out0)->v35->shape[0] = (int64_t) 8;
            (*out0)->v36 = prim_out_54583;
            assert(((*out0)->v37 = (struct futhark_f64_1d *) malloc(sizeof(struct futhark_f64_1d))) != NULL);
            (*out0)->v37->mem = mem_out_54565;
            (*out0)->v37->shape[0] = prim_out_54570;
            assert(((*out0)->v38 = (struct futhark_f64_1d *) malloc(sizeof(struct futhark_f64_1d))) != NULL);
            (*out0)->v38->mem = mem_out_54566;
            (*out0)->v38->shape[0] = prim_out_54570;
            assert(((*out0)->v39 = (struct futhark_i64_1d *) malloc(sizeof(struct futhark_i64_1d))) != NULL);
            (*out0)->v39->mem = mem_out_54567;
            (*out0)->v39->shape[0] = prim_out_54570;
        }
    }
    CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
    lock_unlock(&ctx->lock);
    return ret;
}
int futhark_entry_do_DBSCAN_double(struct futhark_context *ctx, struct futhark_opaque_dbcHandler_double **out0, const struct futhark_opaque_dbcHandler_double *in0, const int64_t in1)
{
    int64_t n_36798 = (int64_t) 0;
    int64_t part_no_36799 = (int64_t) 0;
    int64_t dz2084U_36800 = (int64_t) 0;
    int64_t dz2080U_36801 = (int64_t) 0;
    int64_t dz2081U_36802 = (int64_t) 0;
    int64_t dz2082U_36803 = (int64_t) 0;
    int64_t dz2083U_36804 = (int64_t) 0;
    int64_t dz2085U_36805 = (int64_t) 0;
    int64_t dz2086U_36806 = (int64_t) 0;
    int8_t clBase_36809 = (int8_t) 0;
    int8_t clBase_36810 = (int8_t) 0;
    double clBase_36811 = 0.0;
    int64_t clBase_36812 = (int64_t) 0;
    int64_t clBase_36814 = (int64_t) 0;
    double clBase_36817 = 0.0;
    int64_t clBase_36819 = (int64_t) 0;
    int64_t clProc_36824 = (int64_t) 0;
    int64_t clProc_36825 = (int64_t) 0;
    int64_t clProc_36826 = (int64_t) 0;
    int64_t clProc_36828 = (int64_t) 0;
    int64_t clProc_36829 = (int64_t) 0;
    int64_t current_partition_36843 = (int64_t) 0;
    int64_t gather_psizze_36847 = (int64_t) 0;
    int64_t prim_out_54568 = (int64_t) 0;
    int8_t prim_out_54569 = (int8_t) 0;
    int8_t prim_out_54570 = (int8_t) 0;
    double prim_out_54571 = 0.0;
    int64_t prim_out_54572 = (int64_t) 0;
    int64_t prim_out_54573 = (int64_t) 0;
    double prim_out_54574 = 0.0;
    int64_t prim_out_54575 = (int64_t) 0;
    int64_t prim_out_54576 = (int64_t) 0;
    int64_t prim_out_54577 = (int64_t) 0;
    int64_t prim_out_54578 = (int64_t) 0;
    int64_t prim_out_54579 = (int64_t) 0;
    int64_t prim_out_54580 = (int64_t) 0;
    int64_t prim_out_54581 = (int64_t) 0;
    int ret = 0;
    
    lock_lock(&ctx->lock);
    CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
    
    struct memblock_device mem_out_54567;
    
    mem_out_54567.references = NULL;
    
    struct memblock_device mem_out_54566;
    
    mem_out_54566.references = NULL;
    
    struct memblock_device mem_out_54565;
    
    mem_out_54565.references = NULL;
    
    struct memblock_device mem_out_54564;
    
    mem_out_54564.references = NULL;
    
    struct memblock_device mem_out_54563;
    
    mem_out_54563.references = NULL;
    
    struct memblock_device mem_out_54562;
    
    mem_out_54562.references = NULL;
    
    struct memblock_device mem_out_54561;
    
    mem_out_54561.references = NULL;
    
    struct memblock_device mem_out_54560;
    
    mem_out_54560.references = NULL;
    
    struct memblock_device mem_out_54559;
    
    mem_out_54559.references = NULL;
    
    struct memblock_device mem_out_54558;
    
    mem_out_54558.references = NULL;
    
    struct memblock_device mem_out_54557;
    
    mem_out_54557.references = NULL;
    
    struct memblock_device mem_out_54556;
    
    mem_out_54556.references = NULL;
    
    struct memblock_device mem_out_54555;
    
    mem_out_54555.references = NULL;
    
    struct memblock_device mem_out_54554;
    
    mem_out_54554.references = NULL;
    
    struct memblock_device mem_out_54553;
    
    mem_out_54553.references = NULL;
    
    struct memblock_device mem_out_54552;
    
    mem_out_54552.references = NULL;
    
    struct memblock_device mem_out_54551;
    
    mem_out_54551.references = NULL;
    
    struct memblock_device mem_out_54550;
    
    mem_out_54550.references = NULL;
    
    struct memblock_device mem_out_54549;
    
    mem_out_54549.references = NULL;
    
    struct memblock_device mem_out_54548;
    
    mem_out_54548.references = NULL;
    
    struct memblock_device mem_out_54547;
    
    mem_out_54547.references = NULL;
    
    struct memblock_device mem_out_54546;
    
    mem_out_54546.references = NULL;
    
    struct memblock_device mem_out_54545;
    
    mem_out_54545.references = NULL;
    
    struct memblock_device mem_out_54544;
    
    mem_out_54544.references = NULL;
    
    struct memblock_device mem_out_54543;
    
    mem_out_54543.references = NULL;
    
    struct memblock_device mem_out_54542;
    
    mem_out_54542.references = NULL;
    
    struct memblock_device mem_out_54541;
    
    mem_out_54541.references = NULL;
    
    struct memblock_device toFlush_ids_mem_53532;
    
    toFlush_ids_mem_53532.references = NULL;
    
    struct memblock_device toFlush_dat_mem_53531;
    
    toFlush_dat_mem_53531.references = NULL;
    
    struct memblock_device toFlush_dat_mem_53530;
    
    toFlush_dat_mem_53530.references = NULL;
    
    struct memblock_device current_partition_mem_53529;
    
    current_partition_mem_53529.references = NULL;
    
    struct memblock_device current_partition_mem_53528;
    
    current_partition_mem_53528.references = NULL;
    
    struct memblock_device current_partition_mem_53527;
    
    current_partition_mem_53527.references = NULL;
    
    struct memblock_device current_partition_mem_53526;
    
    current_partition_mem_53526.references = NULL;
    
    struct memblock_device current_partition_mem_53525;
    
    current_partition_mem_53525.references = NULL;
    
    struct memblock_device current_partition_mem_53524;
    
    current_partition_mem_53524.references = NULL;
    
    struct memblock_device current_partition_mem_53523;
    
    current_partition_mem_53523.references = NULL;
    
    struct memblock_device current_partition_mem_53522;
    
    current_partition_mem_53522.references = NULL;
    
    struct memblock_device current_partition_mem_53521;
    
    current_partition_mem_53521.references = NULL;
    
    struct memblock_device current_partition_mem_53520;
    
    current_partition_mem_53520.references = NULL;
    
    struct memblock_device current_partition_mem_53519;
    
    current_partition_mem_53519.references = NULL;
    
    struct memblock_device current_partition_mem_53518;
    
    current_partition_mem_53518.references = NULL;
    
    struct memblock_device clProc_mem_53517;
    
    clProc_mem_53517.references = NULL;
    
    struct memblock_device clProc_mem_53516;
    
    clProc_mem_53516.references = NULL;
    
    struct memblock_device clProc_mem_53515;
    
    clProc_mem_53515.references = NULL;
    
    struct memblock_device clProc_mem_53514;
    
    clProc_mem_53514.references = NULL;
    
    struct memblock_device clProc_mem_53513;
    
    clProc_mem_53513.references = NULL;
    
    struct memblock_device clProc_mem_53512;
    
    clProc_mem_53512.references = NULL;
    
    struct memblock_device clBase_mem_53511;
    
    clBase_mem_53511.references = NULL;
    
    struct memblock_device clBase_mem_53510;
    
    clBase_mem_53510.references = NULL;
    
    struct memblock_device clBase_mem_53509;
    
    clBase_mem_53509.references = NULL;
    
    struct memblock_device clBase_mem_53508;
    
    clBase_mem_53508.references = NULL;
    
    struct memblock_device chain_collisions_mem_53507;
    
    chain_collisions_mem_53507.references = NULL;
    
    struct memblock_device chain_collisions_mem_53506;
    
    chain_collisions_mem_53506.references = NULL;
    chain_collisions_mem_53506 = in0->v0->mem;
    dz2084U_36800 = in0->v0->shape[0];
    chain_collisions_mem_53507 = in0->v1->mem;
    dz2084U_36800 = in0->v1->shape[0];
    clBase_36809 = in0->v2;
    clBase_36810 = in0->v3;
    clBase_36811 = in0->v4;
    clBase_36812 = in0->v5;
    clBase_mem_53508 = in0->v6->mem;
    clBase_36814 = in0->v7;
    clBase_mem_53509 = in0->v8->mem;
    clBase_mem_53510 = in0->v9->mem;
    clBase_36817 = in0->v10;
    clBase_mem_53511 = in0->v11->mem;
    clBase_36819 = in0->v12;
    clProc_mem_53512 = in0->v13->mem;
    dz2080U_36801 = in0->v13->shape[0];
    clProc_mem_53513 = in0->v14->mem;
    dz2081U_36802 = in0->v14->shape[0];
    clProc_mem_53514 = in0->v15->mem;
    dz2082U_36803 = in0->v15->shape[0];
    clProc_mem_53515 = in0->v16->mem;
    dz2082U_36803 = in0->v16->shape[0];
    clProc_36824 = in0->v17;
    clProc_36825 = in0->v18;
    clProc_36826 = in0->v19;
    clProc_mem_53516 = in0->v20->mem;
    part_no_36799 = in0->v20->shape[0];
    clProc_36828 = in0->v21;
    clProc_36829 = in0->v22;
    clProc_mem_53517 = in0->v23->mem;
    dz2083U_36804 = in0->v23->shape[0];
    current_partition_mem_53518 = in0->v24->mem;
    n_36798 = in0->v24->shape[0];
    current_partition_mem_53519 = in0->v25->mem;
    n_36798 = in0->v25->shape[0];
    current_partition_mem_53520 = in0->v26->mem;
    n_36798 = in0->v26->shape[0];
    current_partition_mem_53521 = in0->v27->mem;
    current_partition_mem_53522 = in0->v28->mem;
    current_partition_mem_53523 = in0->v29->mem;
    n_36798 = in0->v29->shape[0];
    current_partition_mem_53524 = in0->v30->mem;
    n_36798 = in0->v30->shape[0];
    current_partition_mem_53525 = in0->v31->mem;
    current_partition_mem_53526 = in0->v32->mem;
    n_36798 = in0->v32->shape[0];
    current_partition_mem_53527 = in0->v33->mem;
    current_partition_mem_53528 = in0->v34->mem;
    current_partition_mem_53529 = in0->v35->mem;
    current_partition_36843 = in0->v36;
    toFlush_dat_mem_53530 = in0->v37->mem;
    dz2085U_36805 = in0->v37->shape[0];
    toFlush_dat_mem_53531 = in0->v38->mem;
    dz2085U_36805 = in0->v38->shape[0];
    toFlush_ids_mem_53532 = in0->v39->mem;
    dz2086U_36806 = in0->v39->shape[0];
    gather_psizze_36847 = in1;
    if (!(dz2084U_36800 == in0->v0->shape[0] && (dz2084U_36800 == in0->v1->shape[0] && ((int64_t) 2 == in0->v6->shape[0] && ((int64_t) 2 == in0->v8->shape[0] && ((int64_t) 2 == in0->v9->shape[0] && ((int64_t) 2 == in0->v11->shape[0] && (dz2080U_36801 == in0->v13->shape[0] && (dz2081U_36802 == in0->v14->shape[0] && (dz2082U_36803 == in0->v15->shape[0] && (dz2082U_36803 == in0->v16->shape[0] && (part_no_36799 == in0->v20->shape[0] && (dz2083U_36804 == in0->v23->shape[0] && (n_36798 == in0->v24->shape[0] && (n_36798 == in0->v25->shape[0] && (n_36798 == in0->v26->shape[0] && ((int64_t) 2 == in0->v27->shape[0] && ((int64_t) 2 == in0->v28->shape[0] && (n_36798 == in0->v29->shape[0] && (n_36798 == in0->v30->shape[0] && ((int64_t) 8 == in0->v31->shape[0] && (n_36798 == in0->v32->shape[0] && ((int64_t) 2 == in0->v33->shape[0] && ((int64_t) 2 == in0->v34->shape[0] && ((int64_t) 8 == in0->v35->shape[0] && (dz2085U_36805 == in0->v37->shape[0] && (dz2085U_36805 == in0->v38->shape[0] && dz2086U_36806 == in0->v39->shape[0]))))))))))))))))))))))))))) {
        ret = 1;
        set_error(ctx, msgprintf("Error: entry point arguments have invalid sizes.\n"));
    }
    if (ret == 0) {
        ret = futrts_entry_do_DBSCAN_double(ctx, &mem_out_54541, &mem_out_54542, &mem_out_54543, &mem_out_54544, &mem_out_54545, &mem_out_54546, &mem_out_54547, &mem_out_54548, &mem_out_54549, &mem_out_54550, &mem_out_54551, &mem_out_54552, &mem_out_54553, &mem_out_54554, &mem_out_54555, &mem_out_54556, &mem_out_54557, &mem_out_54558, &mem_out_54559, &mem_out_54560, &mem_out_54561, &mem_out_54562, &mem_out_54563, &mem_out_54564, &mem_out_54565, &mem_out_54566, &mem_out_54567, &prim_out_54568, &prim_out_54569, &prim_out_54570, &prim_out_54571, &prim_out_54572, &prim_out_54573, &prim_out_54574, &prim_out_54575, &prim_out_54576, &prim_out_54577, &prim_out_54578, &prim_out_54579, &prim_out_54580, &prim_out_54581, chain_collisions_mem_53506, chain_collisions_mem_53507, clBase_mem_53508, clBase_mem_53509, clBase_mem_53510, clBase_mem_53511, clProc_mem_53512, clProc_mem_53513, clProc_mem_53514, clProc_mem_53515, clProc_mem_53516, clProc_mem_53517, current_partition_mem_53518, current_partition_mem_53519, current_partition_mem_53520, current_partition_mem_53521, current_partition_mem_53522, current_partition_mem_53523, current_partition_mem_53524, current_partition_mem_53525, current_partition_mem_53526, current_partition_mem_53527, current_partition_mem_53528, current_partition_mem_53529, toFlush_dat_mem_53530, toFlush_dat_mem_53531, toFlush_ids_mem_53532, n_36798, part_no_36799, dz2084U_36800, dz2080U_36801, dz2081U_36802, dz2082U_36803, dz2083U_36804, dz2085U_36805, dz2086U_36806, clBase_36809, clBase_36810, clBase_36811, clBase_36812, clBase_36814, clBase_36817, clBase_36819, clProc_36824, clProc_36825, clProc_36826, clProc_36828, clProc_36829, current_partition_36843, gather_psizze_36847);
        if (ret == 0) {
            struct memblock_device counters_mem_54551 = ctx->constants->counters_mem_54551;
            struct memblock_device counters_mem_54625 = ctx->constants->counters_mem_54625;
            struct memblock_device counters_mem_55050 = ctx->constants->counters_mem_55050;
            struct memblock_device counters_mem_55495 = ctx->constants->counters_mem_55495;
            struct memblock_device counters_mem_55534 = ctx->constants->counters_mem_55534;
            struct memblock_device counters_mem_55581 = ctx->constants->counters_mem_55581;
            struct memblock_device counters_mem_56605 = ctx->constants->counters_mem_56605;
            struct memblock_device counters_mem_56764 = ctx->constants->counters_mem_56764;
            struct memblock_device counters_mem_56815 = ctx->constants->counters_mem_56815;
            struct memblock_device counters_mem_56850 = ctx->constants->counters_mem_56850;
            struct memblock_device global_dynid_mem_54616 = ctx->constants->global_dynid_mem_54616;
            struct memblock_device global_dynid_mem_54626 = ctx->constants->global_dynid_mem_54626;
            struct memblock_device global_dynid_mem_54637 = ctx->constants->global_dynid_mem_54637;
            struct memblock_device global_dynid_mem_54642 = ctx->constants->global_dynid_mem_54642;
            struct memblock_device global_dynid_mem_54800 = ctx->constants->global_dynid_mem_54800;
            struct memblock_device global_dynid_mem_54871 = ctx->constants->global_dynid_mem_54871;
            struct memblock_device global_dynid_mem_54920 = ctx->constants->global_dynid_mem_54920;
            struct memblock_device global_dynid_mem_55083 = ctx->constants->global_dynid_mem_55083;
            struct memblock_device global_dynid_mem_55112 = ctx->constants->global_dynid_mem_55112;
            struct memblock_device global_dynid_mem_55221 = ctx->constants->global_dynid_mem_55221;
            struct memblock_device global_dynid_mem_55228 = ctx->constants->global_dynid_mem_55228;
            struct memblock_device global_dynid_mem_55334 = ctx->constants->global_dynid_mem_55334;
            struct memblock_device global_dynid_mem_55338 = ctx->constants->global_dynid_mem_55338;
            struct memblock_device global_dynid_mem_55581 = ctx->constants->global_dynid_mem_55581;
            struct memblock_device global_dynid_mem_55728 = ctx->constants->global_dynid_mem_55728;
            struct memblock_device global_dynid_mem_55884 = ctx->constants->global_dynid_mem_55884;
            struct memblock_device global_dynid_mem_56002 = ctx->constants->global_dynid_mem_56002;
            struct memblock_device global_dynid_mem_56151 = ctx->constants->global_dynid_mem_56151;
            struct memblock_device global_dynid_mem_56269 = ctx->constants->global_dynid_mem_56269;
            struct memblock_device global_dynid_mem_56425 = ctx->constants->global_dynid_mem_56425;
            
            assert((*out0 = (struct futhark_opaque_dbcHandler_double *) malloc(sizeof(struct futhark_opaque_dbcHandler_double))) != NULL);
            assert(((*out0)->v0 = (struct futhark_i64_1d *) malloc(sizeof(struct futhark_i64_1d))) != NULL);
            (*out0)->v0->mem = mem_out_54541;
            (*out0)->v0->shape[0] = prim_out_54568;
            assert(((*out0)->v1 = (struct futhark_i64_1d *) malloc(sizeof(struct futhark_i64_1d))) != NULL);
            (*out0)->v1->mem = mem_out_54542;
            (*out0)->v1->shape[0] = prim_out_54568;
            (*out0)->v2 = prim_out_54569;
            (*out0)->v3 = prim_out_54570;
            (*out0)->v4 = prim_out_54571;
            (*out0)->v5 = prim_out_54572;
            assert(((*out0)->v6 = (struct futhark_f64_1d *) malloc(sizeof(struct futhark_f64_1d))) != NULL);
            (*out0)->v6->mem = mem_out_54543;
            (*out0)->v6->shape[0] = (int64_t) 2;
            (*out0)->v7 = prim_out_54573;
            assert(((*out0)->v8 = (struct futhark_f64_1d *) malloc(sizeof(struct futhark_f64_1d))) != NULL);
            (*out0)->v8->mem = mem_out_54544;
            (*out0)->v8->shape[0] = (int64_t) 2;
            assert(((*out0)->v9 = (struct futhark_i64_1d *) malloc(sizeof(struct futhark_i64_1d))) != NULL);
            (*out0)->v9->mem = mem_out_54545;
            (*out0)->v9->shape[0] = (int64_t) 2;
            (*out0)->v10 = prim_out_54574;
            assert(((*out0)->v11 = (struct futhark_f64_1d *) malloc(sizeof(struct futhark_f64_1d))) != NULL);
            (*out0)->v11->mem = mem_out_54546;
            (*out0)->v11->shape[0] = (int64_t) 2;
            (*out0)->v12 = prim_out_54575;
            assert(((*out0)->v13 = (struct futhark_bool_1d *) malloc(sizeof(struct futhark_bool_1d))) != NULL);
            (*out0)->v13->mem = mem_out_54547;
            (*out0)->v13->shape[0] = dz2080U_36801;
            assert(((*out0)->v14 = (struct futhark_i64_1d *) malloc(sizeof(struct futhark_i64_1d))) != NULL);
            (*out0)->v14->mem = mem_out_54548;
            (*out0)->v14->shape[0] = dz2081U_36802;
            assert(((*out0)->v15 = (struct futhark_f64_1d *) malloc(sizeof(struct futhark_f64_1d))) != NULL);
            (*out0)->v15->mem = mem_out_54549;
            (*out0)->v15->shape[0] = dz2082U_36803;
            assert(((*out0)->v16 = (struct futhark_f64_1d *) malloc(sizeof(struct futhark_f64_1d))) != NULL);
            (*out0)->v16->mem = mem_out_54550;
            (*out0)->v16->shape[0] = dz2082U_36803;
            (*out0)->v17 = prim_out_54576;
            (*out0)->v18 = prim_out_54577;
            (*out0)->v19 = prim_out_54578;
            assert(((*out0)->v20 = (struct futhark_bool_1d *) malloc(sizeof(struct futhark_bool_1d))) != NULL);
            (*out0)->v20->mem = mem_out_54551;
            (*out0)->v20->shape[0] = part_no_36799;
            (*out0)->v21 = prim_out_54579;
            (*out0)->v22 = prim_out_54580;
            assert(((*out0)->v23 = (struct futhark_i64_1d *) malloc(sizeof(struct futhark_i64_1d))) != NULL);
            (*out0)->v23->mem = mem_out_54552;
            (*out0)->v23->shape[0] = dz2083U_36804;
            assert(((*out0)->v24 = (struct futhark_i64_1d *) malloc(sizeof(struct futhark_i64_1d))) != NULL);
            (*out0)->v24->mem = mem_out_54553;
            (*out0)->v24->shape[0] = n_36798;
            assert(((*out0)->v25 = (struct futhark_f64_1d *) malloc(sizeof(struct futhark_f64_1d))) != NULL);
            (*out0)->v25->mem = mem_out_54554;
            (*out0)->v25->shape[0] = n_36798;
            assert(((*out0)->v26 = (struct futhark_f64_1d *) malloc(sizeof(struct futhark_f64_1d))) != NULL);
            (*out0)->v26->mem = mem_out_54555;
            (*out0)->v26->shape[0] = n_36798;
            assert(((*out0)->v27 = (struct futhark_f64_1d *) malloc(sizeof(struct futhark_f64_1d))) != NULL);
            (*out0)->v27->mem = mem_out_54556;
            (*out0)->v27->shape[0] = (int64_t) 2;
            assert(((*out0)->v28 = (struct futhark_f64_1d *) malloc(sizeof(struct futhark_f64_1d))) != NULL);
            (*out0)->v28->mem = mem_out_54557;
            (*out0)->v28->shape[0] = (int64_t) 2;
            assert(((*out0)->v29 = (struct futhark_bool_1d *) malloc(sizeof(struct futhark_bool_1d))) != NULL);
            (*out0)->v29->mem = mem_out_54558;
            (*out0)->v29->shape[0] = n_36798;
            assert(((*out0)->v30 = (struct futhark_bool_1d *) malloc(sizeof(struct futhark_bool_1d))) != NULL);
            (*out0)->v30->mem = mem_out_54559;
            (*out0)->v30->shape[0] = n_36798;
            assert(((*out0)->v31 = (struct futhark_bool_1d *) malloc(sizeof(struct futhark_bool_1d))) != NULL);
            (*out0)->v31->mem = mem_out_54560;
            (*out0)->v31->shape[0] = (int64_t) 8;
            assert(((*out0)->v32 = (struct futhark_bool_1d *) malloc(sizeof(struct futhark_bool_1d))) != NULL);
            (*out0)->v32->mem = mem_out_54561;
            (*out0)->v32->shape[0] = n_36798;
            assert(((*out0)->v33 = (struct futhark_f64_1d *) malloc(sizeof(struct futhark_f64_1d))) != NULL);
            (*out0)->v33->mem = mem_out_54562;
            (*out0)->v33->shape[0] = (int64_t) 2;
            assert(((*out0)->v34 = (struct futhark_f64_1d *) malloc(sizeof(struct futhark_f64_1d))) != NULL);
            (*out0)->v34->mem = mem_out_54563;
            (*out0)->v34->shape[0] = (int64_t) 2;
            assert(((*out0)->v35 = (struct futhark_i64_1d *) malloc(sizeof(struct futhark_i64_1d))) != NULL);
            (*out0)->v35->mem = mem_out_54564;
            (*out0)->v35->shape[0] = (int64_t) 8;
            (*out0)->v36 = prim_out_54581;
            assert(((*out0)->v37 = (struct futhark_f64_1d *) malloc(sizeof(struct futhark_f64_1d))) != NULL);
            (*out0)->v37->mem = mem_out_54565;
            (*out0)->v37->shape[0] = (int64_t) 0;
            assert(((*out0)->v38 = (struct futhark_f64_1d *) malloc(sizeof(struct futhark_f64_1d))) != NULL);
            (*out0)->v38->mem = mem_out_54566;
            (*out0)->v38->shape[0] = (int64_t) 0;
            assert(((*out0)->v39 = (struct futhark_i64_1d *) malloc(sizeof(struct futhark_i64_1d))) != NULL);
            (*out0)->v39->mem = mem_out_54567;
            (*out0)->v39->shape[0] = (int64_t) 0;
        }
    }
    CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
    lock_unlock(&ctx->lock);
    return ret;
}
int futhark_entry_flush_dat_double(struct futhark_context *ctx, struct futhark_opaque_flushedData_double **out0, const struct futhark_opaque_dbcHandler_double *in0)
{
    int64_t n_28651 = (int64_t) 0;
    int64_t part_no_28652 = (int64_t) 0;
    int64_t dz2084U_28653 = (int64_t) 0;
    int64_t dz2080U_28654 = (int64_t) 0;
    int64_t dz2081U_28655 = (int64_t) 0;
    int64_t dz2082U_28656 = (int64_t) 0;
    int64_t dz2083U_28657 = (int64_t) 0;
    int64_t dz2085U_28658 = (int64_t) 0;
    int64_t dz2086U_28659 = (int64_t) 0;
    int8_t clBase_28662 = (int8_t) 0;
    int8_t clBase_28663 = (int8_t) 0;
    double clBase_28664 = 0.0;
    int64_t clBase_28665 = (int64_t) 0;
    int64_t clBase_28667 = (int64_t) 0;
    double clBase_28670 = 0.0;
    int64_t clBase_28672 = (int64_t) 0;
    int64_t clProc_28677 = (int64_t) 0;
    int64_t clProc_28678 = (int64_t) 0;
    int64_t clProc_28679 = (int64_t) 0;
    int64_t clProc_28681 = (int64_t) 0;
    int64_t clProc_28682 = (int64_t) 0;
    int64_t current_partition_28696 = (int64_t) 0;
    int ret = 0;
    
    lock_lock(&ctx->lock);
    CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
    
    struct memblock_device mem_out_54543;
    
    mem_out_54543.references = NULL;
    
    struct memblock_device mem_out_54542;
    
    mem_out_54542.references = NULL;
    
    struct memblock_device mem_out_54541;
    
    mem_out_54541.references = NULL;
    
    struct memblock_device toFlush_ids_mem_53532;
    
    toFlush_ids_mem_53532.references = NULL;
    
    struct memblock_device toFlush_dat_mem_53531;
    
    toFlush_dat_mem_53531.references = NULL;
    
    struct memblock_device toFlush_dat_mem_53530;
    
    toFlush_dat_mem_53530.references = NULL;
    
    struct memblock_device current_partition_mem_53529;
    
    current_partition_mem_53529.references = NULL;
    
    struct memblock_device current_partition_mem_53528;
    
    current_partition_mem_53528.references = NULL;
    
    struct memblock_device current_partition_mem_53527;
    
    current_partition_mem_53527.references = NULL;
    
    struct memblock_device current_partition_mem_53526;
    
    current_partition_mem_53526.references = NULL;
    
    struct memblock_device current_partition_mem_53525;
    
    current_partition_mem_53525.references = NULL;
    
    struct memblock_device current_partition_mem_53524;
    
    current_partition_mem_53524.references = NULL;
    
    struct memblock_device current_partition_mem_53523;
    
    current_partition_mem_53523.references = NULL;
    
    struct memblock_device current_partition_mem_53522;
    
    current_partition_mem_53522.references = NULL;
    
    struct memblock_device current_partition_mem_53521;
    
    current_partition_mem_53521.references = NULL;
    
    struct memblock_device current_partition_mem_53520;
    
    current_partition_mem_53520.references = NULL;
    
    struct memblock_device current_partition_mem_53519;
    
    current_partition_mem_53519.references = NULL;
    
    struct memblock_device current_partition_mem_53518;
    
    current_partition_mem_53518.references = NULL;
    
    struct memblock_device clProc_mem_53517;
    
    clProc_mem_53517.references = NULL;
    
    struct memblock_device clProc_mem_53516;
    
    clProc_mem_53516.references = NULL;
    
    struct memblock_device clProc_mem_53515;
    
    clProc_mem_53515.references = NULL;
    
    struct memblock_device clProc_mem_53514;
    
    clProc_mem_53514.references = NULL;
    
    struct memblock_device clProc_mem_53513;
    
    clProc_mem_53513.references = NULL;
    
    struct memblock_device clProc_mem_53512;
    
    clProc_mem_53512.references = NULL;
    
    struct memblock_device clBase_mem_53511;
    
    clBase_mem_53511.references = NULL;
    
    struct memblock_device clBase_mem_53510;
    
    clBase_mem_53510.references = NULL;
    
    struct memblock_device clBase_mem_53509;
    
    clBase_mem_53509.references = NULL;
    
    struct memblock_device clBase_mem_53508;
    
    clBase_mem_53508.references = NULL;
    
    struct memblock_device chain_collisions_mem_53507;
    
    chain_collisions_mem_53507.references = NULL;
    
    struct memblock_device chain_collisions_mem_53506;
    
    chain_collisions_mem_53506.references = NULL;
    chain_collisions_mem_53506 = in0->v0->mem;
    dz2084U_28653 = in0->v0->shape[0];
    chain_collisions_mem_53507 = in0->v1->mem;
    dz2084U_28653 = in0->v1->shape[0];
    clBase_28662 = in0->v2;
    clBase_28663 = in0->v3;
    clBase_28664 = in0->v4;
    clBase_28665 = in0->v5;
    clBase_mem_53508 = in0->v6->mem;
    clBase_28667 = in0->v7;
    clBase_mem_53509 = in0->v8->mem;
    clBase_mem_53510 = in0->v9->mem;
    clBase_28670 = in0->v10;
    clBase_mem_53511 = in0->v11->mem;
    clBase_28672 = in0->v12;
    clProc_mem_53512 = in0->v13->mem;
    dz2080U_28654 = in0->v13->shape[0];
    clProc_mem_53513 = in0->v14->mem;
    dz2081U_28655 = in0->v14->shape[0];
    clProc_mem_53514 = in0->v15->mem;
    dz2082U_28656 = in0->v15->shape[0];
    clProc_mem_53515 = in0->v16->mem;
    dz2082U_28656 = in0->v16->shape[0];
    clProc_28677 = in0->v17;
    clProc_28678 = in0->v18;
    clProc_28679 = in0->v19;
    clProc_mem_53516 = in0->v20->mem;
    part_no_28652 = in0->v20->shape[0];
    clProc_28681 = in0->v21;
    clProc_28682 = in0->v22;
    clProc_mem_53517 = in0->v23->mem;
    dz2083U_28657 = in0->v23->shape[0];
    current_partition_mem_53518 = in0->v24->mem;
    n_28651 = in0->v24->shape[0];
    current_partition_mem_53519 = in0->v25->mem;
    n_28651 = in0->v25->shape[0];
    current_partition_mem_53520 = in0->v26->mem;
    n_28651 = in0->v26->shape[0];
    current_partition_mem_53521 = in0->v27->mem;
    current_partition_mem_53522 = in0->v28->mem;
    current_partition_mem_53523 = in0->v29->mem;
    n_28651 = in0->v29->shape[0];
    current_partition_mem_53524 = in0->v30->mem;
    n_28651 = in0->v30->shape[0];
    current_partition_mem_53525 = in0->v31->mem;
    current_partition_mem_53526 = in0->v32->mem;
    n_28651 = in0->v32->shape[0];
    current_partition_mem_53527 = in0->v33->mem;
    current_partition_mem_53528 = in0->v34->mem;
    current_partition_mem_53529 = in0->v35->mem;
    current_partition_28696 = in0->v36;
    toFlush_dat_mem_53530 = in0->v37->mem;
    dz2085U_28658 = in0->v37->shape[0];
    toFlush_dat_mem_53531 = in0->v38->mem;
    dz2085U_28658 = in0->v38->shape[0];
    toFlush_ids_mem_53532 = in0->v39->mem;
    dz2086U_28659 = in0->v39->shape[0];
    if (!(dz2084U_28653 == in0->v0->shape[0] && (dz2084U_28653 == in0->v1->shape[0] && ((int64_t) 2 == in0->v6->shape[0] && ((int64_t) 2 == in0->v8->shape[0] && ((int64_t) 2 == in0->v9->shape[0] && ((int64_t) 2 == in0->v11->shape[0] && (dz2080U_28654 == in0->v13->shape[0] && (dz2081U_28655 == in0->v14->shape[0] && (dz2082U_28656 == in0->v15->shape[0] && (dz2082U_28656 == in0->v16->shape[0] && (part_no_28652 == in0->v20->shape[0] && (dz2083U_28657 == in0->v23->shape[0] && (n_28651 == in0->v24->shape[0] && (n_28651 == in0->v25->shape[0] && (n_28651 == in0->v26->shape[0] && ((int64_t) 2 == in0->v27->shape[0] && ((int64_t) 2 == in0->v28->shape[0] && (n_28651 == in0->v29->shape[0] && (n_28651 == in0->v30->shape[0] && ((int64_t) 8 == in0->v31->shape[0] && (n_28651 == in0->v32->shape[0] && ((int64_t) 2 == in0->v33->shape[0] && ((int64_t) 2 == in0->v34->shape[0] && ((int64_t) 8 == in0->v35->shape[0] && (dz2085U_28658 == in0->v37->shape[0] && (dz2085U_28658 == in0->v38->shape[0] && dz2086U_28659 == in0->v39->shape[0]))))))))))))))))))))))))))) {
        ret = 1;
        set_error(ctx, msgprintf("Error: entry point arguments have invalid sizes.\n"));
    }
    if (ret == 0) {
        ret = futrts_entry_flush_dat_double(ctx, &mem_out_54541, &mem_out_54542, &mem_out_54543, chain_collisions_mem_53506, chain_collisions_mem_53507, clBase_mem_53508, clBase_mem_53509, clBase_mem_53510, clBase_mem_53511, clProc_mem_53512, clProc_mem_53513, clProc_mem_53514, clProc_mem_53515, clProc_mem_53516, clProc_mem_53517, current_partition_mem_53518, current_partition_mem_53519, current_partition_mem_53520, current_partition_mem_53521, current_partition_mem_53522, current_partition_mem_53523, current_partition_mem_53524, current_partition_mem_53525, current_partition_mem_53526, current_partition_mem_53527, current_partition_mem_53528, current_partition_mem_53529, toFlush_dat_mem_53530, toFlush_dat_mem_53531, toFlush_ids_mem_53532, n_28651, part_no_28652, dz2084U_28653, dz2080U_28654, dz2081U_28655, dz2082U_28656, dz2083U_28657, dz2085U_28658, dz2086U_28659, clBase_28662, clBase_28663, clBase_28664, clBase_28665, clBase_28667, clBase_28670, clBase_28672, clProc_28677, clProc_28678, clProc_28679, clProc_28681, clProc_28682, current_partition_28696);
        if (ret == 0) {
            struct memblock_device counters_mem_54551 = ctx->constants->counters_mem_54551;
            struct memblock_device counters_mem_54625 = ctx->constants->counters_mem_54625;
            struct memblock_device counters_mem_55050 = ctx->constants->counters_mem_55050;
            struct memblock_device counters_mem_55495 = ctx->constants->counters_mem_55495;
            struct memblock_device counters_mem_55534 = ctx->constants->counters_mem_55534;
            struct memblock_device counters_mem_55581 = ctx->constants->counters_mem_55581;
            struct memblock_device counters_mem_56605 = ctx->constants->counters_mem_56605;
            struct memblock_device counters_mem_56764 = ctx->constants->counters_mem_56764;
            struct memblock_device counters_mem_56815 = ctx->constants->counters_mem_56815;
            struct memblock_device counters_mem_56850 = ctx->constants->counters_mem_56850;
            struct memblock_device global_dynid_mem_54616 = ctx->constants->global_dynid_mem_54616;
            struct memblock_device global_dynid_mem_54626 = ctx->constants->global_dynid_mem_54626;
            struct memblock_device global_dynid_mem_54637 = ctx->constants->global_dynid_mem_54637;
            struct memblock_device global_dynid_mem_54642 = ctx->constants->global_dynid_mem_54642;
            struct memblock_device global_dynid_mem_54800 = ctx->constants->global_dynid_mem_54800;
            struct memblock_device global_dynid_mem_54871 = ctx->constants->global_dynid_mem_54871;
            struct memblock_device global_dynid_mem_54920 = ctx->constants->global_dynid_mem_54920;
            struct memblock_device global_dynid_mem_55083 = ctx->constants->global_dynid_mem_55083;
            struct memblock_device global_dynid_mem_55112 = ctx->constants->global_dynid_mem_55112;
            struct memblock_device global_dynid_mem_55221 = ctx->constants->global_dynid_mem_55221;
            struct memblock_device global_dynid_mem_55228 = ctx->constants->global_dynid_mem_55228;
            struct memblock_device global_dynid_mem_55334 = ctx->constants->global_dynid_mem_55334;
            struct memblock_device global_dynid_mem_55338 = ctx->constants->global_dynid_mem_55338;
            struct memblock_device global_dynid_mem_55581 = ctx->constants->global_dynid_mem_55581;
            struct memblock_device global_dynid_mem_55728 = ctx->constants->global_dynid_mem_55728;
            struct memblock_device global_dynid_mem_55884 = ctx->constants->global_dynid_mem_55884;
            struct memblock_device global_dynid_mem_56002 = ctx->constants->global_dynid_mem_56002;
            struct memblock_device global_dynid_mem_56151 = ctx->constants->global_dynid_mem_56151;
            struct memblock_device global_dynid_mem_56269 = ctx->constants->global_dynid_mem_56269;
            struct memblock_device global_dynid_mem_56425 = ctx->constants->global_dynid_mem_56425;
            
            assert((*out0 = (struct futhark_opaque_flushedData_double *) malloc(sizeof(struct futhark_opaque_flushedData_double))) != NULL);
            assert(((*out0)->v0 = (struct futhark_i64_1d *) malloc(sizeof(struct futhark_i64_1d))) != NULL);
            (*out0)->v0->mem = mem_out_54541;
            (*out0)->v0->shape[0] = dz2086U_28659;
            assert(((*out0)->v1 = (struct futhark_f64_1d *) malloc(sizeof(struct futhark_f64_1d))) != NULL);
            (*out0)->v1->mem = mem_out_54542;
            (*out0)->v1->shape[0] = dz2085U_28658;
            assert(((*out0)->v2 = (struct futhark_f64_1d *) malloc(sizeof(struct futhark_f64_1d))) != NULL);
            (*out0)->v2->mem = mem_out_54543;
            (*out0)->v2->shape[0] = dz2085U_28658;
        }
    }
    CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
    lock_unlock(&ctx->lock);
    return ret;
}
int futhark_entry_make_collisions_compact_double(struct futhark_context *ctx, struct futhark_opaque_collisionTable **out0, const struct futhark_opaque_dbcHandler_double *in0)
{
    int64_t n_37609 = (int64_t) 0;
    int64_t part_no_37610 = (int64_t) 0;
    int64_t dz2084U_37611 = (int64_t) 0;
    int64_t dz2080U_37612 = (int64_t) 0;
    int64_t dz2081U_37613 = (int64_t) 0;
    int64_t dz2082U_37614 = (int64_t) 0;
    int64_t dz2083U_37615 = (int64_t) 0;
    int64_t dz2085U_37616 = (int64_t) 0;
    int64_t dz2086U_37617 = (int64_t) 0;
    int8_t clBase_37620 = (int8_t) 0;
    int8_t clBase_37621 = (int8_t) 0;
    double clBase_37622 = 0.0;
    int64_t clBase_37623 = (int64_t) 0;
    int64_t clBase_37625 = (int64_t) 0;
    double clBase_37628 = 0.0;
    int64_t clBase_37630 = (int64_t) 0;
    int64_t clProc_37635 = (int64_t) 0;
    int64_t clProc_37636 = (int64_t) 0;
    int64_t clProc_37637 = (int64_t) 0;
    int64_t clProc_37639 = (int64_t) 0;
    int64_t clProc_37640 = (int64_t) 0;
    int64_t current_partition_37654 = (int64_t) 0;
    int64_t prim_out_54543 = (int64_t) 0;
    int ret = 0;
    
    lock_lock(&ctx->lock);
    CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
    
    struct memblock_device mem_out_54542;
    
    mem_out_54542.references = NULL;
    
    struct memblock_device mem_out_54541;
    
    mem_out_54541.references = NULL;
    
    struct memblock_device toFlush_ids_mem_53532;
    
    toFlush_ids_mem_53532.references = NULL;
    
    struct memblock_device toFlush_dat_mem_53531;
    
    toFlush_dat_mem_53531.references = NULL;
    
    struct memblock_device toFlush_dat_mem_53530;
    
    toFlush_dat_mem_53530.references = NULL;
    
    struct memblock_device current_partition_mem_53529;
    
    current_partition_mem_53529.references = NULL;
    
    struct memblock_device current_partition_mem_53528;
    
    current_partition_mem_53528.references = NULL;
    
    struct memblock_device current_partition_mem_53527;
    
    current_partition_mem_53527.references = NULL;
    
    struct memblock_device current_partition_mem_53526;
    
    current_partition_mem_53526.references = NULL;
    
    struct memblock_device current_partition_mem_53525;
    
    current_partition_mem_53525.references = NULL;
    
    struct memblock_device current_partition_mem_53524;
    
    current_partition_mem_53524.references = NULL;
    
    struct memblock_device current_partition_mem_53523;
    
    current_partition_mem_53523.references = NULL;
    
    struct memblock_device current_partition_mem_53522;
    
    current_partition_mem_53522.references = NULL;
    
    struct memblock_device current_partition_mem_53521;
    
    current_partition_mem_53521.references = NULL;
    
    struct memblock_device current_partition_mem_53520;
    
    current_partition_mem_53520.references = NULL;
    
    struct memblock_device current_partition_mem_53519;
    
    current_partition_mem_53519.references = NULL;
    
    struct memblock_device current_partition_mem_53518;
    
    current_partition_mem_53518.references = NULL;
    
    struct memblock_device clProc_mem_53517;
    
    clProc_mem_53517.references = NULL;
    
    struct memblock_device clProc_mem_53516;
    
    clProc_mem_53516.references = NULL;
    
    struct memblock_device clProc_mem_53515;
    
    clProc_mem_53515.references = NULL;
    
    struct memblock_device clProc_mem_53514;
    
    clProc_mem_53514.references = NULL;
    
    struct memblock_device clProc_mem_53513;
    
    clProc_mem_53513.references = NULL;
    
    struct memblock_device clProc_mem_53512;
    
    clProc_mem_53512.references = NULL;
    
    struct memblock_device clBase_mem_53511;
    
    clBase_mem_53511.references = NULL;
    
    struct memblock_device clBase_mem_53510;
    
    clBase_mem_53510.references = NULL;
    
    struct memblock_device clBase_mem_53509;
    
    clBase_mem_53509.references = NULL;
    
    struct memblock_device clBase_mem_53508;
    
    clBase_mem_53508.references = NULL;
    
    struct memblock_device chain_collisions_mem_53507;
    
    chain_collisions_mem_53507.references = NULL;
    
    struct memblock_device chain_collisions_mem_53506;
    
    chain_collisions_mem_53506.references = NULL;
    chain_collisions_mem_53506 = in0->v0->mem;
    dz2084U_37611 = in0->v0->shape[0];
    chain_collisions_mem_53507 = in0->v1->mem;
    dz2084U_37611 = in0->v1->shape[0];
    clBase_37620 = in0->v2;
    clBase_37621 = in0->v3;
    clBase_37622 = in0->v4;
    clBase_37623 = in0->v5;
    clBase_mem_53508 = in0->v6->mem;
    clBase_37625 = in0->v7;
    clBase_mem_53509 = in0->v8->mem;
    clBase_mem_53510 = in0->v9->mem;
    clBase_37628 = in0->v10;
    clBase_mem_53511 = in0->v11->mem;
    clBase_37630 = in0->v12;
    clProc_mem_53512 = in0->v13->mem;
    dz2080U_37612 = in0->v13->shape[0];
    clProc_mem_53513 = in0->v14->mem;
    dz2081U_37613 = in0->v14->shape[0];
    clProc_mem_53514 = in0->v15->mem;
    dz2082U_37614 = in0->v15->shape[0];
    clProc_mem_53515 = in0->v16->mem;
    dz2082U_37614 = in0->v16->shape[0];
    clProc_37635 = in0->v17;
    clProc_37636 = in0->v18;
    clProc_37637 = in0->v19;
    clProc_mem_53516 = in0->v20->mem;
    part_no_37610 = in0->v20->shape[0];
    clProc_37639 = in0->v21;
    clProc_37640 = in0->v22;
    clProc_mem_53517 = in0->v23->mem;
    dz2083U_37615 = in0->v23->shape[0];
    current_partition_mem_53518 = in0->v24->mem;
    n_37609 = in0->v24->shape[0];
    current_partition_mem_53519 = in0->v25->mem;
    n_37609 = in0->v25->shape[0];
    current_partition_mem_53520 = in0->v26->mem;
    n_37609 = in0->v26->shape[0];
    current_partition_mem_53521 = in0->v27->mem;
    current_partition_mem_53522 = in0->v28->mem;
    current_partition_mem_53523 = in0->v29->mem;
    n_37609 = in0->v29->shape[0];
    current_partition_mem_53524 = in0->v30->mem;
    n_37609 = in0->v30->shape[0];
    current_partition_mem_53525 = in0->v31->mem;
    current_partition_mem_53526 = in0->v32->mem;
    n_37609 = in0->v32->shape[0];
    current_partition_mem_53527 = in0->v33->mem;
    current_partition_mem_53528 = in0->v34->mem;
    current_partition_mem_53529 = in0->v35->mem;
    current_partition_37654 = in0->v36;
    toFlush_dat_mem_53530 = in0->v37->mem;
    dz2085U_37616 = in0->v37->shape[0];
    toFlush_dat_mem_53531 = in0->v38->mem;
    dz2085U_37616 = in0->v38->shape[0];
    toFlush_ids_mem_53532 = in0->v39->mem;
    dz2086U_37617 = in0->v39->shape[0];
    if (!(dz2084U_37611 == in0->v0->shape[0] && (dz2084U_37611 == in0->v1->shape[0] && ((int64_t) 2 == in0->v6->shape[0] && ((int64_t) 2 == in0->v8->shape[0] && ((int64_t) 2 == in0->v9->shape[0] && ((int64_t) 2 == in0->v11->shape[0] && (dz2080U_37612 == in0->v13->shape[0] && (dz2081U_37613 == in0->v14->shape[0] && (dz2082U_37614 == in0->v15->shape[0] && (dz2082U_37614 == in0->v16->shape[0] && (part_no_37610 == in0->v20->shape[0] && (dz2083U_37615 == in0->v23->shape[0] && (n_37609 == in0->v24->shape[0] && (n_37609 == in0->v25->shape[0] && (n_37609 == in0->v26->shape[0] && ((int64_t) 2 == in0->v27->shape[0] && ((int64_t) 2 == in0->v28->shape[0] && (n_37609 == in0->v29->shape[0] && (n_37609 == in0->v30->shape[0] && ((int64_t) 8 == in0->v31->shape[0] && (n_37609 == in0->v32->shape[0] && ((int64_t) 2 == in0->v33->shape[0] && ((int64_t) 2 == in0->v34->shape[0] && ((int64_t) 8 == in0->v35->shape[0] && (dz2085U_37616 == in0->v37->shape[0] && (dz2085U_37616 == in0->v38->shape[0] && dz2086U_37617 == in0->v39->shape[0]))))))))))))))))))))))))))) {
        ret = 1;
        set_error(ctx, msgprintf("Error: entry point arguments have invalid sizes.\n"));
    }
    if (ret == 0) {
        ret = futrts_entry_make_collisions_compact_double(ctx, &mem_out_54541, &mem_out_54542, &prim_out_54543, chain_collisions_mem_53506, chain_collisions_mem_53507, clBase_mem_53508, clBase_mem_53509, clBase_mem_53510, clBase_mem_53511, clProc_mem_53512, clProc_mem_53513, clProc_mem_53514, clProc_mem_53515, clProc_mem_53516, clProc_mem_53517, current_partition_mem_53518, current_partition_mem_53519, current_partition_mem_53520, current_partition_mem_53521, current_partition_mem_53522, current_partition_mem_53523, current_partition_mem_53524, current_partition_mem_53525, current_partition_mem_53526, current_partition_mem_53527, current_partition_mem_53528, current_partition_mem_53529, toFlush_dat_mem_53530, toFlush_dat_mem_53531, toFlush_ids_mem_53532, n_37609, part_no_37610, dz2084U_37611, dz2080U_37612, dz2081U_37613, dz2082U_37614, dz2083U_37615, dz2085U_37616, dz2086U_37617, clBase_37620, clBase_37621, clBase_37622, clBase_37623, clBase_37625, clBase_37628, clBase_37630, clProc_37635, clProc_37636, clProc_37637, clProc_37639, clProc_37640, current_partition_37654);
        if (ret == 0) {
            struct memblock_device counters_mem_54551 = ctx->constants->counters_mem_54551;
            struct memblock_device counters_mem_54625 = ctx->constants->counters_mem_54625;
            struct memblock_device counters_mem_55050 = ctx->constants->counters_mem_55050;
            struct memblock_device counters_mem_55495 = ctx->constants->counters_mem_55495;
            struct memblock_device counters_mem_55534 = ctx->constants->counters_mem_55534;
            struct memblock_device counters_mem_55581 = ctx->constants->counters_mem_55581;
            struct memblock_device counters_mem_56605 = ctx->constants->counters_mem_56605;
            struct memblock_device counters_mem_56764 = ctx->constants->counters_mem_56764;
            struct memblock_device counters_mem_56815 = ctx->constants->counters_mem_56815;
            struct memblock_device counters_mem_56850 = ctx->constants->counters_mem_56850;
            struct memblock_device global_dynid_mem_54616 = ctx->constants->global_dynid_mem_54616;
            struct memblock_device global_dynid_mem_54626 = ctx->constants->global_dynid_mem_54626;
            struct memblock_device global_dynid_mem_54637 = ctx->constants->global_dynid_mem_54637;
            struct memblock_device global_dynid_mem_54642 = ctx->constants->global_dynid_mem_54642;
            struct memblock_device global_dynid_mem_54800 = ctx->constants->global_dynid_mem_54800;
            struct memblock_device global_dynid_mem_54871 = ctx->constants->global_dynid_mem_54871;
            struct memblock_device global_dynid_mem_54920 = ctx->constants->global_dynid_mem_54920;
            struct memblock_device global_dynid_mem_55083 = ctx->constants->global_dynid_mem_55083;
            struct memblock_device global_dynid_mem_55112 = ctx->constants->global_dynid_mem_55112;
            struct memblock_device global_dynid_mem_55221 = ctx->constants->global_dynid_mem_55221;
            struct memblock_device global_dynid_mem_55228 = ctx->constants->global_dynid_mem_55228;
            struct memblock_device global_dynid_mem_55334 = ctx->constants->global_dynid_mem_55334;
            struct memblock_device global_dynid_mem_55338 = ctx->constants->global_dynid_mem_55338;
            struct memblock_device global_dynid_mem_55581 = ctx->constants->global_dynid_mem_55581;
            struct memblock_device global_dynid_mem_55728 = ctx->constants->global_dynid_mem_55728;
            struct memblock_device global_dynid_mem_55884 = ctx->constants->global_dynid_mem_55884;
            struct memblock_device global_dynid_mem_56002 = ctx->constants->global_dynid_mem_56002;
            struct memblock_device global_dynid_mem_56151 = ctx->constants->global_dynid_mem_56151;
            struct memblock_device global_dynid_mem_56269 = ctx->constants->global_dynid_mem_56269;
            struct memblock_device global_dynid_mem_56425 = ctx->constants->global_dynid_mem_56425;
            
            assert((*out0 = (struct futhark_opaque_collisionTable *) malloc(sizeof(struct futhark_opaque_collisionTable))) != NULL);
            assert(((*out0)->v0 = (struct futhark_i64_1d *) malloc(sizeof(struct futhark_i64_1d))) != NULL);
            (*out0)->v0->mem = mem_out_54541;
            (*out0)->v0->shape[0] = prim_out_54543;
            assert(((*out0)->v1 = (struct futhark_i64_1d *) malloc(sizeof(struct futhark_i64_1d))) != NULL);
            (*out0)->v1->mem = mem_out_54542;
            (*out0)->v1->shape[0] = prim_out_54543;
        }
    }
    CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
    lock_unlock(&ctx->lock);
    return ret;
}
int futhark_entry_mk_dbcHandler_double(struct futhark_context *ctx, struct futhark_opaque_dbcHandler_double **out0, const double in0, const double in1, const double in2, const double in3, const int64_t in4, const int64_t in5, const bool in6, const bool in7, const double in8, const double in9, const int64_t in10, const int64_t in11)
{
    double min_x_23482 = 0.0;
    double min_y_23483 = 0.0;
    double max_x_23484 = 0.0;
    double max_y_23485 = 0.0;
    int64_t parts_x_23486 = (int64_t) 0;
    int64_t parts_y_23487 = (int64_t) 0;
    bool isEuclidean_23488 = 0;
    bool isRadians_23489 = 0;
    double radius_23490 = 0.0;
    double eps_23491 = 0.0;
    int64_t minPts_23492 = (int64_t) 0;
    int64_t m_sizze_23493 = (int64_t) 0;
    int64_t prim_out_54568 = (int64_t) 0;
    int8_t prim_out_54569 = (int8_t) 0;
    int8_t prim_out_54570 = (int8_t) 0;
    double prim_out_54571 = 0.0;
    int64_t prim_out_54572 = (int64_t) 0;
    int64_t prim_out_54573 = (int64_t) 0;
    double prim_out_54574 = 0.0;
    int64_t prim_out_54575 = (int64_t) 0;
    int64_t prim_out_54576 = (int64_t) 0;
    int64_t prim_out_54577 = (int64_t) 0;
    int64_t prim_out_54578 = (int64_t) 0;
    int64_t prim_out_54579 = (int64_t) 0;
    int64_t prim_out_54580 = (int64_t) 0;
    int64_t prim_out_54581 = (int64_t) 0;
    int ret = 0;
    
    lock_lock(&ctx->lock);
    CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
    
    struct memblock_device mem_out_54567;
    
    mem_out_54567.references = NULL;
    
    struct memblock_device mem_out_54566;
    
    mem_out_54566.references = NULL;
    
    struct memblock_device mem_out_54565;
    
    mem_out_54565.references = NULL;
    
    struct memblock_device mem_out_54564;
    
    mem_out_54564.references = NULL;
    
    struct memblock_device mem_out_54563;
    
    mem_out_54563.references = NULL;
    
    struct memblock_device mem_out_54562;
    
    mem_out_54562.references = NULL;
    
    struct memblock_device mem_out_54561;
    
    mem_out_54561.references = NULL;
    
    struct memblock_device mem_out_54560;
    
    mem_out_54560.references = NULL;
    
    struct memblock_device mem_out_54559;
    
    mem_out_54559.references = NULL;
    
    struct memblock_device mem_out_54558;
    
    mem_out_54558.references = NULL;
    
    struct memblock_device mem_out_54557;
    
    mem_out_54557.references = NULL;
    
    struct memblock_device mem_out_54556;
    
    mem_out_54556.references = NULL;
    
    struct memblock_device mem_out_54555;
    
    mem_out_54555.references = NULL;
    
    struct memblock_device mem_out_54554;
    
    mem_out_54554.references = NULL;
    
    struct memblock_device mem_out_54553;
    
    mem_out_54553.references = NULL;
    
    struct memblock_device mem_out_54552;
    
    mem_out_54552.references = NULL;
    
    struct memblock_device mem_out_54551;
    
    mem_out_54551.references = NULL;
    
    struct memblock_device mem_out_54550;
    
    mem_out_54550.references = NULL;
    
    struct memblock_device mem_out_54549;
    
    mem_out_54549.references = NULL;
    
    struct memblock_device mem_out_54548;
    
    mem_out_54548.references = NULL;
    
    struct memblock_device mem_out_54547;
    
    mem_out_54547.references = NULL;
    
    struct memblock_device mem_out_54546;
    
    mem_out_54546.references = NULL;
    
    struct memblock_device mem_out_54545;
    
    mem_out_54545.references = NULL;
    
    struct memblock_device mem_out_54544;
    
    mem_out_54544.references = NULL;
    
    struct memblock_device mem_out_54543;
    
    mem_out_54543.references = NULL;
    
    struct memblock_device mem_out_54542;
    
    mem_out_54542.references = NULL;
    
    struct memblock_device mem_out_54541;
    
    mem_out_54541.references = NULL;
    min_x_23482 = in0;
    min_y_23483 = in1;
    max_x_23484 = in2;
    max_y_23485 = in3;
    parts_x_23486 = in4;
    parts_y_23487 = in5;
    isEuclidean_23488 = in6;
    isRadians_23489 = in7;
    radius_23490 = in8;
    eps_23491 = in9;
    minPts_23492 = in10;
    m_sizze_23493 = in11;
    if (ret == 0) {
        ret = futrts_entry_mk_dbcHandler_double(ctx, &mem_out_54541, &mem_out_54542, &mem_out_54543, &mem_out_54544, &mem_out_54545, &mem_out_54546, &mem_out_54547, &mem_out_54548, &mem_out_54549, &mem_out_54550, &mem_out_54551, &mem_out_54552, &mem_out_54553, &mem_out_54554, &mem_out_54555, &mem_out_54556, &mem_out_54557, &mem_out_54558, &mem_out_54559, &mem_out_54560, &mem_out_54561, &mem_out_54562, &mem_out_54563, &mem_out_54564, &mem_out_54565, &mem_out_54566, &mem_out_54567, &prim_out_54568, &prim_out_54569, &prim_out_54570, &prim_out_54571, &prim_out_54572, &prim_out_54573, &prim_out_54574, &prim_out_54575, &prim_out_54576, &prim_out_54577, &prim_out_54578, &prim_out_54579, &prim_out_54580, &prim_out_54581, min_x_23482, min_y_23483, max_x_23484, max_y_23485, parts_x_23486, parts_y_23487, isEuclidean_23488, isRadians_23489, radius_23490, eps_23491, minPts_23492, m_sizze_23493);
        if (ret == 0) {
            struct memblock_device counters_mem_54551 = ctx->constants->counters_mem_54551;
            struct memblock_device counters_mem_54625 = ctx->constants->counters_mem_54625;
            struct memblock_device counters_mem_55050 = ctx->constants->counters_mem_55050;
            struct memblock_device counters_mem_55495 = ctx->constants->counters_mem_55495;
            struct memblock_device counters_mem_55534 = ctx->constants->counters_mem_55534;
            struct memblock_device counters_mem_55581 = ctx->constants->counters_mem_55581;
            struct memblock_device counters_mem_56605 = ctx->constants->counters_mem_56605;
            struct memblock_device counters_mem_56764 = ctx->constants->counters_mem_56764;
            struct memblock_device counters_mem_56815 = ctx->constants->counters_mem_56815;
            struct memblock_device counters_mem_56850 = ctx->constants->counters_mem_56850;
            struct memblock_device global_dynid_mem_54616 = ctx->constants->global_dynid_mem_54616;
            struct memblock_device global_dynid_mem_54626 = ctx->constants->global_dynid_mem_54626;
            struct memblock_device global_dynid_mem_54637 = ctx->constants->global_dynid_mem_54637;
            struct memblock_device global_dynid_mem_54642 = ctx->constants->global_dynid_mem_54642;
            struct memblock_device global_dynid_mem_54800 = ctx->constants->global_dynid_mem_54800;
            struct memblock_device global_dynid_mem_54871 = ctx->constants->global_dynid_mem_54871;
            struct memblock_device global_dynid_mem_54920 = ctx->constants->global_dynid_mem_54920;
            struct memblock_device global_dynid_mem_55083 = ctx->constants->global_dynid_mem_55083;
            struct memblock_device global_dynid_mem_55112 = ctx->constants->global_dynid_mem_55112;
            struct memblock_device global_dynid_mem_55221 = ctx->constants->global_dynid_mem_55221;
            struct memblock_device global_dynid_mem_55228 = ctx->constants->global_dynid_mem_55228;
            struct memblock_device global_dynid_mem_55334 = ctx->constants->global_dynid_mem_55334;
            struct memblock_device global_dynid_mem_55338 = ctx->constants->global_dynid_mem_55338;
            struct memblock_device global_dynid_mem_55581 = ctx->constants->global_dynid_mem_55581;
            struct memblock_device global_dynid_mem_55728 = ctx->constants->global_dynid_mem_55728;
            struct memblock_device global_dynid_mem_55884 = ctx->constants->global_dynid_mem_55884;
            struct memblock_device global_dynid_mem_56002 = ctx->constants->global_dynid_mem_56002;
            struct memblock_device global_dynid_mem_56151 = ctx->constants->global_dynid_mem_56151;
            struct memblock_device global_dynid_mem_56269 = ctx->constants->global_dynid_mem_56269;
            struct memblock_device global_dynid_mem_56425 = ctx->constants->global_dynid_mem_56425;
            
            assert((*out0 = (struct futhark_opaque_dbcHandler_double *) malloc(sizeof(struct futhark_opaque_dbcHandler_double))) != NULL);
            assert(((*out0)->v0 = (struct futhark_i64_1d *) malloc(sizeof(struct futhark_i64_1d))) != NULL);
            (*out0)->v0->mem = mem_out_54541;
            (*out0)->v0->shape[0] = (int64_t) 0;
            assert(((*out0)->v1 = (struct futhark_i64_1d *) malloc(sizeof(struct futhark_i64_1d))) != NULL);
            (*out0)->v1->mem = mem_out_54542;
            (*out0)->v1->shape[0] = (int64_t) 0;
            (*out0)->v2 = prim_out_54569;
            (*out0)->v3 = prim_out_54570;
            (*out0)->v4 = prim_out_54571;
            (*out0)->v5 = prim_out_54572;
            assert(((*out0)->v6 = (struct futhark_f64_1d *) malloc(sizeof(struct futhark_f64_1d))) != NULL);
            (*out0)->v6->mem = mem_out_54543;
            (*out0)->v6->shape[0] = (int64_t) 2;
            (*out0)->v7 = prim_out_54573;
            assert(((*out0)->v8 = (struct futhark_f64_1d *) malloc(sizeof(struct futhark_f64_1d))) != NULL);
            (*out0)->v8->mem = mem_out_54544;
            (*out0)->v8->shape[0] = (int64_t) 2;
            assert(((*out0)->v9 = (struct futhark_i64_1d *) malloc(sizeof(struct futhark_i64_1d))) != NULL);
            (*out0)->v9->mem = mem_out_54545;
            (*out0)->v9->shape[0] = (int64_t) 2;
            (*out0)->v10 = prim_out_54574;
            assert(((*out0)->v11 = (struct futhark_f64_1d *) malloc(sizeof(struct futhark_f64_1d))) != NULL);
            (*out0)->v11->mem = mem_out_54546;
            (*out0)->v11->shape[0] = (int64_t) 2;
            (*out0)->v12 = prim_out_54575;
            assert(((*out0)->v13 = (struct futhark_bool_1d *) malloc(sizeof(struct futhark_bool_1d))) != NULL);
            (*out0)->v13->mem = mem_out_54547;
            (*out0)->v13->shape[0] = (int64_t) 0;
            assert(((*out0)->v14 = (struct futhark_i64_1d *) malloc(sizeof(struct futhark_i64_1d))) != NULL);
            (*out0)->v14->mem = mem_out_54548;
            (*out0)->v14->shape[0] = (int64_t) 0;
            assert(((*out0)->v15 = (struct futhark_f64_1d *) malloc(sizeof(struct futhark_f64_1d))) != NULL);
            (*out0)->v15->mem = mem_out_54549;
            (*out0)->v15->shape[0] = (int64_t) 0;
            assert(((*out0)->v16 = (struct futhark_f64_1d *) malloc(sizeof(struct futhark_f64_1d))) != NULL);
            (*out0)->v16->mem = mem_out_54550;
            (*out0)->v16->shape[0] = (int64_t) 0;
            (*out0)->v17 = prim_out_54576;
            (*out0)->v18 = prim_out_54577;
            (*out0)->v19 = prim_out_54578;
            assert(((*out0)->v20 = (struct futhark_bool_1d *) malloc(sizeof(struct futhark_bool_1d))) != NULL);
            (*out0)->v20->mem = mem_out_54551;
            (*out0)->v20->shape[0] = prim_out_54568;
            (*out0)->v21 = prim_out_54579;
            (*out0)->v22 = prim_out_54580;
            assert(((*out0)->v23 = (struct futhark_i64_1d *) malloc(sizeof(struct futhark_i64_1d))) != NULL);
            (*out0)->v23->mem = mem_out_54552;
            (*out0)->v23->shape[0] = (int64_t) 0;
            assert(((*out0)->v24 = (struct futhark_i64_1d *) malloc(sizeof(struct futhark_i64_1d))) != NULL);
            (*out0)->v24->mem = mem_out_54553;
            (*out0)->v24->shape[0] = (int64_t) 0;
            assert(((*out0)->v25 = (struct futhark_f64_1d *) malloc(sizeof(struct futhark_f64_1d))) != NULL);
            (*out0)->v25->mem = mem_out_54554;
            (*out0)->v25->shape[0] = (int64_t) 0;
            assert(((*out0)->v26 = (struct futhark_f64_1d *) malloc(sizeof(struct futhark_f64_1d))) != NULL);
            (*out0)->v26->mem = mem_out_54555;
            (*out0)->v26->shape[0] = (int64_t) 0;
            assert(((*out0)->v27 = (struct futhark_f64_1d *) malloc(sizeof(struct futhark_f64_1d))) != NULL);
            (*out0)->v27->mem = mem_out_54556;
            (*out0)->v27->shape[0] = (int64_t) 2;
            assert(((*out0)->v28 = (struct futhark_f64_1d *) malloc(sizeof(struct futhark_f64_1d))) != NULL);
            (*out0)->v28->mem = mem_out_54557;
            (*out0)->v28->shape[0] = (int64_t) 2;
            assert(((*out0)->v29 = (struct futhark_bool_1d *) malloc(sizeof(struct futhark_bool_1d))) != NULL);
            (*out0)->v29->mem = mem_out_54558;
            (*out0)->v29->shape[0] = (int64_t) 0;
            assert(((*out0)->v30 = (struct futhark_bool_1d *) malloc(sizeof(struct futhark_bool_1d))) != NULL);
            (*out0)->v30->mem = mem_out_54559;
            (*out0)->v30->shape[0] = (int64_t) 0;
            assert(((*out0)->v31 = (struct futhark_bool_1d *) malloc(sizeof(struct futhark_bool_1d))) != NULL);
            (*out0)->v31->mem = mem_out_54560;
            (*out0)->v31->shape[0] = (int64_t) 8;
            assert(((*out0)->v32 = (struct futhark_bool_1d *) malloc(sizeof(struct futhark_bool_1d))) != NULL);
            (*out0)->v32->mem = mem_out_54561;
            (*out0)->v32->shape[0] = (int64_t) 0;
            assert(((*out0)->v33 = (struct futhark_f64_1d *) malloc(sizeof(struct futhark_f64_1d))) != NULL);
            (*out0)->v33->mem = mem_out_54562;
            (*out0)->v33->shape[0] = (int64_t) 2;
            assert(((*out0)->v34 = (struct futhark_f64_1d *) malloc(sizeof(struct futhark_f64_1d))) != NULL);
            (*out0)->v34->mem = mem_out_54563;
            (*out0)->v34->shape[0] = (int64_t) 2;
            assert(((*out0)->v35 = (struct futhark_i64_1d *) malloc(sizeof(struct futhark_i64_1d))) != NULL);
            (*out0)->v35->mem = mem_out_54564;
            (*out0)->v35->shape[0] = (int64_t) 8;
            (*out0)->v36 = prim_out_54581;
            assert(((*out0)->v37 = (struct futhark_f64_1d *) malloc(sizeof(struct futhark_f64_1d))) != NULL);
            (*out0)->v37->mem = mem_out_54565;
            (*out0)->v37->shape[0] = (int64_t) 0;
            assert(((*out0)->v38 = (struct futhark_f64_1d *) malloc(sizeof(struct futhark_f64_1d))) != NULL);
            (*out0)->v38->mem = mem_out_54566;
            (*out0)->v38->shape[0] = (int64_t) 0;
            assert(((*out0)->v39 = (struct futhark_i64_1d *) malloc(sizeof(struct futhark_i64_1d))) != NULL);
            (*out0)->v39->mem = mem_out_54567;
            (*out0)->v39->shape[0] = (int64_t) 0;
        }
    }
    CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
    lock_unlock(&ctx->lock);
    return ret;
}
int futhark_entry_next_partition_to_read_double(struct futhark_context *ctx, int64_t *out0, const struct futhark_opaque_dbcHandler_double *in0)
{
    int64_t n_24089 = (int64_t) 0;
    int64_t part_no_24090 = (int64_t) 0;
    int64_t dz2084U_24091 = (int64_t) 0;
    int64_t dz2080U_24092 = (int64_t) 0;
    int64_t dz2081U_24093 = (int64_t) 0;
    int64_t dz2082U_24094 = (int64_t) 0;
    int64_t dz2083U_24095 = (int64_t) 0;
    int64_t dz2085U_24096 = (int64_t) 0;
    int64_t dz2086U_24097 = (int64_t) 0;
    int8_t clBase_24100 = (int8_t) 0;
    int8_t clBase_24101 = (int8_t) 0;
    double clBase_24102 = 0.0;
    int64_t clBase_24103 = (int64_t) 0;
    int64_t clBase_24105 = (int64_t) 0;
    double clBase_24108 = 0.0;
    int64_t clBase_24110 = (int64_t) 0;
    int64_t clProc_24115 = (int64_t) 0;
    int64_t clProc_24116 = (int64_t) 0;
    int64_t clProc_24117 = (int64_t) 0;
    int64_t clProc_24119 = (int64_t) 0;
    int64_t clProc_24120 = (int64_t) 0;
    int64_t current_partition_24134 = (int64_t) 0;
    int64_t prim_out_54541 = (int64_t) 0;
    int ret = 0;
    
    lock_lock(&ctx->lock);
    CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
    
    struct memblock_device toFlush_ids_mem_53532;
    
    toFlush_ids_mem_53532.references = NULL;
    
    struct memblock_device toFlush_dat_mem_53531;
    
    toFlush_dat_mem_53531.references = NULL;
    
    struct memblock_device toFlush_dat_mem_53530;
    
    toFlush_dat_mem_53530.references = NULL;
    
    struct memblock_device current_partition_mem_53529;
    
    current_partition_mem_53529.references = NULL;
    
    struct memblock_device current_partition_mem_53528;
    
    current_partition_mem_53528.references = NULL;
    
    struct memblock_device current_partition_mem_53527;
    
    current_partition_mem_53527.references = NULL;
    
    struct memblock_device current_partition_mem_53526;
    
    current_partition_mem_53526.references = NULL;
    
    struct memblock_device current_partition_mem_53525;
    
    current_partition_mem_53525.references = NULL;
    
    struct memblock_device current_partition_mem_53524;
    
    current_partition_mem_53524.references = NULL;
    
    struct memblock_device current_partition_mem_53523;
    
    current_partition_mem_53523.references = NULL;
    
    struct memblock_device current_partition_mem_53522;
    
    current_partition_mem_53522.references = NULL;
    
    struct memblock_device current_partition_mem_53521;
    
    current_partition_mem_53521.references = NULL;
    
    struct memblock_device current_partition_mem_53520;
    
    current_partition_mem_53520.references = NULL;
    
    struct memblock_device current_partition_mem_53519;
    
    current_partition_mem_53519.references = NULL;
    
    struct memblock_device current_partition_mem_53518;
    
    current_partition_mem_53518.references = NULL;
    
    struct memblock_device clProc_mem_53517;
    
    clProc_mem_53517.references = NULL;
    
    struct memblock_device clProc_mem_53516;
    
    clProc_mem_53516.references = NULL;
    
    struct memblock_device clProc_mem_53515;
    
    clProc_mem_53515.references = NULL;
    
    struct memblock_device clProc_mem_53514;
    
    clProc_mem_53514.references = NULL;
    
    struct memblock_device clProc_mem_53513;
    
    clProc_mem_53513.references = NULL;
    
    struct memblock_device clProc_mem_53512;
    
    clProc_mem_53512.references = NULL;
    
    struct memblock_device clBase_mem_53511;
    
    clBase_mem_53511.references = NULL;
    
    struct memblock_device clBase_mem_53510;
    
    clBase_mem_53510.references = NULL;
    
    struct memblock_device clBase_mem_53509;
    
    clBase_mem_53509.references = NULL;
    
    struct memblock_device clBase_mem_53508;
    
    clBase_mem_53508.references = NULL;
    
    struct memblock_device chain_collisions_mem_53507;
    
    chain_collisions_mem_53507.references = NULL;
    
    struct memblock_device chain_collisions_mem_53506;
    
    chain_collisions_mem_53506.references = NULL;
    chain_collisions_mem_53506 = in0->v0->mem;
    dz2084U_24091 = in0->v0->shape[0];
    chain_collisions_mem_53507 = in0->v1->mem;
    dz2084U_24091 = in0->v1->shape[0];
    clBase_24100 = in0->v2;
    clBase_24101 = in0->v3;
    clBase_24102 = in0->v4;
    clBase_24103 = in0->v5;
    clBase_mem_53508 = in0->v6->mem;
    clBase_24105 = in0->v7;
    clBase_mem_53509 = in0->v8->mem;
    clBase_mem_53510 = in0->v9->mem;
    clBase_24108 = in0->v10;
    clBase_mem_53511 = in0->v11->mem;
    clBase_24110 = in0->v12;
    clProc_mem_53512 = in0->v13->mem;
    dz2080U_24092 = in0->v13->shape[0];
    clProc_mem_53513 = in0->v14->mem;
    dz2081U_24093 = in0->v14->shape[0];
    clProc_mem_53514 = in0->v15->mem;
    dz2082U_24094 = in0->v15->shape[0];
    clProc_mem_53515 = in0->v16->mem;
    dz2082U_24094 = in0->v16->shape[0];
    clProc_24115 = in0->v17;
    clProc_24116 = in0->v18;
    clProc_24117 = in0->v19;
    clProc_mem_53516 = in0->v20->mem;
    part_no_24090 = in0->v20->shape[0];
    clProc_24119 = in0->v21;
    clProc_24120 = in0->v22;
    clProc_mem_53517 = in0->v23->mem;
    dz2083U_24095 = in0->v23->shape[0];
    current_partition_mem_53518 = in0->v24->mem;
    n_24089 = in0->v24->shape[0];
    current_partition_mem_53519 = in0->v25->mem;
    n_24089 = in0->v25->shape[0];
    current_partition_mem_53520 = in0->v26->mem;
    n_24089 = in0->v26->shape[0];
    current_partition_mem_53521 = in0->v27->mem;
    current_partition_mem_53522 = in0->v28->mem;
    current_partition_mem_53523 = in0->v29->mem;
    n_24089 = in0->v29->shape[0];
    current_partition_mem_53524 = in0->v30->mem;
    n_24089 = in0->v30->shape[0];
    current_partition_mem_53525 = in0->v31->mem;
    current_partition_mem_53526 = in0->v32->mem;
    n_24089 = in0->v32->shape[0];
    current_partition_mem_53527 = in0->v33->mem;
    current_partition_mem_53528 = in0->v34->mem;
    current_partition_mem_53529 = in0->v35->mem;
    current_partition_24134 = in0->v36;
    toFlush_dat_mem_53530 = in0->v37->mem;
    dz2085U_24096 = in0->v37->shape[0];
    toFlush_dat_mem_53531 = in0->v38->mem;
    dz2085U_24096 = in0->v38->shape[0];
    toFlush_ids_mem_53532 = in0->v39->mem;
    dz2086U_24097 = in0->v39->shape[0];
    if (!(dz2084U_24091 == in0->v0->shape[0] && (dz2084U_24091 == in0->v1->shape[0] && ((int64_t) 2 == in0->v6->shape[0] && ((int64_t) 2 == in0->v8->shape[0] && ((int64_t) 2 == in0->v9->shape[0] && ((int64_t) 2 == in0->v11->shape[0] && (dz2080U_24092 == in0->v13->shape[0] && (dz2081U_24093 == in0->v14->shape[0] && (dz2082U_24094 == in0->v15->shape[0] && (dz2082U_24094 == in0->v16->shape[0] && (part_no_24090 == in0->v20->shape[0] && (dz2083U_24095 == in0->v23->shape[0] && (n_24089 == in0->v24->shape[0] && (n_24089 == in0->v25->shape[0] && (n_24089 == in0->v26->shape[0] && ((int64_t) 2 == in0->v27->shape[0] && ((int64_t) 2 == in0->v28->shape[0] && (n_24089 == in0->v29->shape[0] && (n_24089 == in0->v30->shape[0] && ((int64_t) 8 == in0->v31->shape[0] && (n_24089 == in0->v32->shape[0] && ((int64_t) 2 == in0->v33->shape[0] && ((int64_t) 2 == in0->v34->shape[0] && ((int64_t) 8 == in0->v35->shape[0] && (dz2085U_24096 == in0->v37->shape[0] && (dz2085U_24096 == in0->v38->shape[0] && dz2086U_24097 == in0->v39->shape[0]))))))))))))))))))))))))))) {
        ret = 1;
        set_error(ctx, msgprintf("Error: entry point arguments have invalid sizes.\n"));
    }
    if (ret == 0) {
        ret = futrts_entry_next_partition_to_read_double(ctx, &prim_out_54541, chain_collisions_mem_53506, chain_collisions_mem_53507, clBase_mem_53508, clBase_mem_53509, clBase_mem_53510, clBase_mem_53511, clProc_mem_53512, clProc_mem_53513, clProc_mem_53514, clProc_mem_53515, clProc_mem_53516, clProc_mem_53517, current_partition_mem_53518, current_partition_mem_53519, current_partition_mem_53520, current_partition_mem_53521, current_partition_mem_53522, current_partition_mem_53523, current_partition_mem_53524, current_partition_mem_53525, current_partition_mem_53526, current_partition_mem_53527, current_partition_mem_53528, current_partition_mem_53529, toFlush_dat_mem_53530, toFlush_dat_mem_53531, toFlush_ids_mem_53532, n_24089, part_no_24090, dz2084U_24091, dz2080U_24092, dz2081U_24093, dz2082U_24094, dz2083U_24095, dz2085U_24096, dz2086U_24097, clBase_24100, clBase_24101, clBase_24102, clBase_24103, clBase_24105, clBase_24108, clBase_24110, clProc_24115, clProc_24116, clProc_24117, clProc_24119, clProc_24120, current_partition_24134);
        if (ret == 0) {
            struct memblock_device counters_mem_54551 = ctx->constants->counters_mem_54551;
            struct memblock_device counters_mem_54625 = ctx->constants->counters_mem_54625;
            struct memblock_device counters_mem_55050 = ctx->constants->counters_mem_55050;
            struct memblock_device counters_mem_55495 = ctx->constants->counters_mem_55495;
            struct memblock_device counters_mem_55534 = ctx->constants->counters_mem_55534;
            struct memblock_device counters_mem_55581 = ctx->constants->counters_mem_55581;
            struct memblock_device counters_mem_56605 = ctx->constants->counters_mem_56605;
            struct memblock_device counters_mem_56764 = ctx->constants->counters_mem_56764;
            struct memblock_device counters_mem_56815 = ctx->constants->counters_mem_56815;
            struct memblock_device counters_mem_56850 = ctx->constants->counters_mem_56850;
            struct memblock_device global_dynid_mem_54616 = ctx->constants->global_dynid_mem_54616;
            struct memblock_device global_dynid_mem_54626 = ctx->constants->global_dynid_mem_54626;
            struct memblock_device global_dynid_mem_54637 = ctx->constants->global_dynid_mem_54637;
            struct memblock_device global_dynid_mem_54642 = ctx->constants->global_dynid_mem_54642;
            struct memblock_device global_dynid_mem_54800 = ctx->constants->global_dynid_mem_54800;
            struct memblock_device global_dynid_mem_54871 = ctx->constants->global_dynid_mem_54871;
            struct memblock_device global_dynid_mem_54920 = ctx->constants->global_dynid_mem_54920;
            struct memblock_device global_dynid_mem_55083 = ctx->constants->global_dynid_mem_55083;
            struct memblock_device global_dynid_mem_55112 = ctx->constants->global_dynid_mem_55112;
            struct memblock_device global_dynid_mem_55221 = ctx->constants->global_dynid_mem_55221;
            struct memblock_device global_dynid_mem_55228 = ctx->constants->global_dynid_mem_55228;
            struct memblock_device global_dynid_mem_55334 = ctx->constants->global_dynid_mem_55334;
            struct memblock_device global_dynid_mem_55338 = ctx->constants->global_dynid_mem_55338;
            struct memblock_device global_dynid_mem_55581 = ctx->constants->global_dynid_mem_55581;
            struct memblock_device global_dynid_mem_55728 = ctx->constants->global_dynid_mem_55728;
            struct memblock_device global_dynid_mem_55884 = ctx->constants->global_dynid_mem_55884;
            struct memblock_device global_dynid_mem_56002 = ctx->constants->global_dynid_mem_56002;
            struct memblock_device global_dynid_mem_56151 = ctx->constants->global_dynid_mem_56151;
            struct memblock_device global_dynid_mem_56269 = ctx->constants->global_dynid_mem_56269;
            struct memblock_device global_dynid_mem_56425 = ctx->constants->global_dynid_mem_56425;
            
            *out0 = prim_out_54541;
        }
    }
    CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
    lock_unlock(&ctx->lock);
    return ret;
}
int futhark_entry_rectify_partition_ids_double(struct futhark_context *ctx, struct futhark_i64_1d **out0, const struct futhark_i64_1d *in0, const struct futhark_opaque_collisionTable *in1, const int64_t in2)
{
    int64_t n_37952 = (int64_t) 0;
    int64_t dz2081Uz2080U_37953 = (int64_t) 0;
    int64_t dz2081Uz2081U_37954 = (int64_t) 0;
    int64_t m_sizze_37958 = (int64_t) 0;
    int ret = 0;
    
    lock_lock(&ctx->lock);
    CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
    
    struct memblock_device mem_out_54541;
    
    mem_out_54541.references = NULL;
    
    struct memblock_device replaceWith_mem_53508;
    
    replaceWith_mem_53508.references = NULL;
    
    struct memblock_device chain_id_mem_53507;
    
    chain_id_mem_53507.references = NULL;
    
    struct memblock_device partition_ids_mem_53506;
    
    partition_ids_mem_53506.references = NULL;
    partition_ids_mem_53506 = in0->mem;
    n_37952 = in0->shape[0];
    chain_id_mem_53507 = in1->v0->mem;
    dz2081Uz2080U_37953 = in1->v0->shape[0];
    replaceWith_mem_53508 = in1->v1->mem;
    dz2081Uz2081U_37954 = in1->v1->shape[0];
    m_sizze_37958 = in2;
    if (!(n_37952 == in0->shape[0] && (dz2081Uz2080U_37953 == in1->v0->shape[0] && dz2081Uz2081U_37954 == in1->v1->shape[0]))) {
        ret = 1;
        set_error(ctx, msgprintf("Error: entry point arguments have invalid sizes.\n"));
    }
    if (ret == 0) {
        ret = futrts_entry_rectify_partition_ids_double(ctx, &mem_out_54541, partition_ids_mem_53506, chain_id_mem_53507, replaceWith_mem_53508, n_37952, dz2081Uz2080U_37953, dz2081Uz2081U_37954, m_sizze_37958);
        if (ret == 0) {
            struct memblock_device counters_mem_54551 = ctx->constants->counters_mem_54551;
            struct memblock_device counters_mem_54625 = ctx->constants->counters_mem_54625;
            struct memblock_device counters_mem_55050 = ctx->constants->counters_mem_55050;
            struct memblock_device counters_mem_55495 = ctx->constants->counters_mem_55495;
            struct memblock_device counters_mem_55534 = ctx->constants->counters_mem_55534;
            struct memblock_device counters_mem_55581 = ctx->constants->counters_mem_55581;
            struct memblock_device counters_mem_56605 = ctx->constants->counters_mem_56605;
            struct memblock_device counters_mem_56764 = ctx->constants->counters_mem_56764;
            struct memblock_device counters_mem_56815 = ctx->constants->counters_mem_56815;
            struct memblock_device counters_mem_56850 = ctx->constants->counters_mem_56850;
            struct memblock_device global_dynid_mem_54616 = ctx->constants->global_dynid_mem_54616;
            struct memblock_device global_dynid_mem_54626 = ctx->constants->global_dynid_mem_54626;
            struct memblock_device global_dynid_mem_54637 = ctx->constants->global_dynid_mem_54637;
            struct memblock_device global_dynid_mem_54642 = ctx->constants->global_dynid_mem_54642;
            struct memblock_device global_dynid_mem_54800 = ctx->constants->global_dynid_mem_54800;
            struct memblock_device global_dynid_mem_54871 = ctx->constants->global_dynid_mem_54871;
            struct memblock_device global_dynid_mem_54920 = ctx->constants->global_dynid_mem_54920;
            struct memblock_device global_dynid_mem_55083 = ctx->constants->global_dynid_mem_55083;
            struct memblock_device global_dynid_mem_55112 = ctx->constants->global_dynid_mem_55112;
            struct memblock_device global_dynid_mem_55221 = ctx->constants->global_dynid_mem_55221;
            struct memblock_device global_dynid_mem_55228 = ctx->constants->global_dynid_mem_55228;
            struct memblock_device global_dynid_mem_55334 = ctx->constants->global_dynid_mem_55334;
            struct memblock_device global_dynid_mem_55338 = ctx->constants->global_dynid_mem_55338;
            struct memblock_device global_dynid_mem_55581 = ctx->constants->global_dynid_mem_55581;
            struct memblock_device global_dynid_mem_55728 = ctx->constants->global_dynid_mem_55728;
            struct memblock_device global_dynid_mem_55884 = ctx->constants->global_dynid_mem_55884;
            struct memblock_device global_dynid_mem_56002 = ctx->constants->global_dynid_mem_56002;
            struct memblock_device global_dynid_mem_56151 = ctx->constants->global_dynid_mem_56151;
            struct memblock_device global_dynid_mem_56269 = ctx->constants->global_dynid_mem_56269;
            struct memblock_device global_dynid_mem_56425 = ctx->constants->global_dynid_mem_56425;
            
            assert((*out0 = (struct futhark_i64_1d *) malloc(sizeof(struct futhark_i64_1d))) != NULL);
            (*out0)->mem = mem_out_54541;
            (*out0)->shape[0] = n_37952;
        }
    }
    CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
    lock_unlock(&ctx->lock);
    return ret;
}
  
