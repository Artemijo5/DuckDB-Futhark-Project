// Generated by Futhark 0.26.0 (prerelease - include info below when reporting bugs).
// git: 1de4f0c (Fri Jan 24 11:10:52 2025 +0100)
// Compiled with GHC 9.4.8.

// We need to define _GNU_SOURCE before
// _any_ headers files are imported to get
// the usage statistics of a thread (i.e. have RUSAGE_THREAD) on GNU/Linux
// https://manpages.courier-mta.org/htmlman2/getrusage.2.html
#ifndef _GNU_SOURCE // Avoid possible double-definition warning.
#define _GNU_SOURCE
#endif

#ifdef __clang__
#pragma clang diagnostic ignored "-Wunused-function"
#pragma clang diagnostic ignored "-Wunused-variable"
#pragma clang diagnostic ignored "-Wunused-const-variable"
#pragma clang diagnostic ignored "-Wparentheses"
#pragma clang diagnostic ignored "-Wunused-label"
#pragma clang diagnostic ignored "-Wunused-but-set-variable"
#elif __GNUC__
#pragma GCC diagnostic ignored "-Wunused-function"
#pragma GCC diagnostic ignored "-Wunused-variable"
#pragma GCC diagnostic ignored "-Wunused-const-variable"
#pragma GCC diagnostic ignored "-Wparentheses"
#pragma GCC diagnostic ignored "-Wunused-label"
#pragma GCC diagnostic ignored "-Wunused-but-set-variable"
#endif

// Headers
#include <stdint.h>
#include <stddef.h>
#include <stdbool.h>
#include <stdio.h>
#include <float.h>

#include <cuda.h>
#include <cuda_runtime.h>
#include <nvrtc.h>

#ifdef __cplusplus
extern "C" {
#endif

// Initialisation
struct futhark_context_config;
struct futhark_context_config *futhark_context_config_new(void);
void futhark_context_config_free(struct futhark_context_config *cfg);
int futhark_context_config_set_tuning_param(struct futhark_context_config *cfg, const char *param_name, size_t new_value);
struct futhark_context;
struct futhark_context *futhark_context_new(struct futhark_context_config *cfg);
void futhark_context_free(struct futhark_context *cfg);
void futhark_context_config_set_default_thread_block_size(struct futhark_context_config *cfg, int size);
void futhark_context_config_set_default_grid_size(struct futhark_context_config *cfg, int size);
void futhark_context_config_set_default_group_size(struct futhark_context_config *cfg, int size);
void futhark_context_config_set_default_num_groups(struct futhark_context_config *cfg, int size);
void futhark_context_config_set_default_tile_size(struct futhark_context_config *cfg, int size);
void futhark_context_config_set_default_reg_tile_size(struct futhark_context_config *cfg, int size);
void futhark_context_config_set_default_registers(struct futhark_context_config *cfg, int size);
void futhark_context_config_set_default_cache(struct futhark_context_config *cfg, int size);
void futhark_context_config_set_default_threshold(struct futhark_context_config *cfg, int size);
void futhark_context_config_set_unified_memory(struct futhark_context_config *cfg, int flag);
void futhark_context_config_add_nvrtc_option(struct futhark_context_config *cfg, const char *opt);
void futhark_context_config_set_device(struct futhark_context_config *cfg, const char *s);
const char *futhark_context_config_get_program(struct futhark_context_config *cfg);
void futhark_context_config_set_program(struct futhark_context_config *cfg, const char *s);
void futhark_context_config_dump_ptx_to(struct futhark_context_config *cfg, const char *s);
void futhark_context_config_load_ptx_from(struct futhark_context_config *cfg, const char *s);
void futhark_context_config_set_debugging(struct futhark_context_config *cfg, int flag);
void futhark_context_config_set_profiling(struct futhark_context_config *cfg, int flag);
void futhark_context_config_set_logging(struct futhark_context_config *cfg, int flag);
int futhark_get_tuning_param_count(void);
const char *futhark_get_tuning_param_name(int);
const char *futhark_get_tuning_param_class(int);

// Arrays
struct futhark_bool_1d;
struct futhark_bool_1d *futhark_new_bool_1d(struct futhark_context *ctx, const bool *data, int64_t dim0);
struct futhark_bool_1d *futhark_new_raw_bool_1d(struct futhark_context *ctx, CUdeviceptr data, int64_t dim0);
int futhark_free_bool_1d(struct futhark_context *ctx, struct futhark_bool_1d *arr);
int futhark_values_bool_1d(struct futhark_context *ctx, struct futhark_bool_1d *arr, bool *data);
int futhark_index_bool_1d(struct futhark_context *ctx, bool *out, struct futhark_bool_1d *arr, int64_t i0);
CUdeviceptr futhark_values_raw_bool_1d(struct futhark_context *ctx, struct futhark_bool_1d *arr);
const int64_t *futhark_shape_bool_1d(struct futhark_context *ctx, struct futhark_bool_1d *arr);
struct futhark_f64_1d;
struct futhark_f64_1d *futhark_new_f64_1d(struct futhark_context *ctx, const double *data, int64_t dim0);
struct futhark_f64_1d *futhark_new_raw_f64_1d(struct futhark_context *ctx, CUdeviceptr data, int64_t dim0);
int futhark_free_f64_1d(struct futhark_context *ctx, struct futhark_f64_1d *arr);
int futhark_values_f64_1d(struct futhark_context *ctx, struct futhark_f64_1d *arr, double *data);
int futhark_index_f64_1d(struct futhark_context *ctx, double *out, struct futhark_f64_1d *arr, int64_t i0);
CUdeviceptr futhark_values_raw_f64_1d(struct futhark_context *ctx, struct futhark_f64_1d *arr);
const int64_t *futhark_shape_f64_1d(struct futhark_context *ctx, struct futhark_f64_1d *arr);
struct futhark_i64_1d;
struct futhark_i64_1d *futhark_new_i64_1d(struct futhark_context *ctx, const int64_t *data, int64_t dim0);
struct futhark_i64_1d *futhark_new_raw_i64_1d(struct futhark_context *ctx, CUdeviceptr data, int64_t dim0);
int futhark_free_i64_1d(struct futhark_context *ctx, struct futhark_i64_1d *arr);
int futhark_values_i64_1d(struct futhark_context *ctx, struct futhark_i64_1d *arr, int64_t *data);
int futhark_index_i64_1d(struct futhark_context *ctx, int64_t *out, struct futhark_i64_1d *arr, int64_t i0);
CUdeviceptr futhark_values_raw_i64_1d(struct futhark_context *ctx, struct futhark_i64_1d *arr);
const int64_t *futhark_shape_i64_1d(struct futhark_context *ctx, struct futhark_i64_1d *arr);

// Opaque values
struct futhark_opaque_00764e1f7379f14f22282d21712a8514;
struct futhark_opaque_5797e930517e531e6d939a24b1db07bd;
struct futhark_opaque_tup2_f64_f64;
struct futhark_opaque_tup2_i64_i64;
struct futhark_opaque_arr1d_tup2_f64_f64;
struct futhark_opaque_arr1d_tup2_i64_i64;
struct futhark_opaque_collisionTable;
struct futhark_opaque_dbcHandler_double;
struct futhark_opaque_flushedData_double;
struct futhark_opaque_8b7e80c3fb80a9a7700efe8e89371deb;
struct futhark_opaque_a8fdbed66266f52db9d5a0da8b1f6763;
struct futhark_opaque_4dedc823193c594b5c01727ae8ac5943;
int futhark_free_opaque_00764e1f7379f14f22282d21712a8514(struct futhark_context *ctx, struct futhark_opaque_00764e1f7379f14f22282d21712a8514 *obj);
int futhark_store_opaque_00764e1f7379f14f22282d21712a8514(struct futhark_context *ctx, const struct futhark_opaque_00764e1f7379f14f22282d21712a8514 *obj, void **p, size_t *n);
struct futhark_opaque_00764e1f7379f14f22282d21712a8514 *futhark_restore_opaque_00764e1f7379f14f22282d21712a8514(struct futhark_context *ctx, const void *p);
int futhark_new_opaque_00764e1f7379f14f22282d21712a8514_degrees(struct futhark_context *ctx, struct futhark_opaque_00764e1f7379f14f22282d21712a8514 **out);
int futhark_destruct_opaque_00764e1f7379f14f22282d21712a8514_degrees(struct futhark_context *ctx, const struct futhark_opaque_00764e1f7379f14f22282d21712a8514 *obj);
int futhark_new_opaque_00764e1f7379f14f22282d21712a8514_radians(struct futhark_context *ctx, struct futhark_opaque_00764e1f7379f14f22282d21712a8514 **out);
int futhark_destruct_opaque_00764e1f7379f14f22282d21712a8514_radians(struct futhark_context *ctx, const struct futhark_opaque_00764e1f7379f14f22282d21712a8514 *obj);
int futhark_variant_opaque_00764e1f7379f14f22282d21712a8514(struct futhark_context *ctx, const struct futhark_opaque_00764e1f7379f14f22282d21712a8514 *v);
int futhark_free_opaque_5797e930517e531e6d939a24b1db07bd(struct futhark_context *ctx, struct futhark_opaque_5797e930517e531e6d939a24b1db07bd *obj);
int futhark_store_opaque_5797e930517e531e6d939a24b1db07bd(struct futhark_context *ctx, const struct futhark_opaque_5797e930517e531e6d939a24b1db07bd *obj, void **p, size_t *n);
struct futhark_opaque_5797e930517e531e6d939a24b1db07bd *futhark_restore_opaque_5797e930517e531e6d939a24b1db07bd(struct futhark_context *ctx, const void *p);
int futhark_new_opaque_5797e930517e531e6d939a24b1db07bd_euclidean(struct futhark_context *ctx, struct futhark_opaque_5797e930517e531e6d939a24b1db07bd **out);
int futhark_destruct_opaque_5797e930517e531e6d939a24b1db07bd_euclidean(struct futhark_context *ctx, const struct futhark_opaque_5797e930517e531e6d939a24b1db07bd *obj);
int futhark_new_opaque_5797e930517e531e6d939a24b1db07bd_haversine(struct futhark_context *ctx, struct futhark_opaque_5797e930517e531e6d939a24b1db07bd **out);
int futhark_destruct_opaque_5797e930517e531e6d939a24b1db07bd_haversine(struct futhark_context *ctx, const struct futhark_opaque_5797e930517e531e6d939a24b1db07bd *obj);
int futhark_variant_opaque_5797e930517e531e6d939a24b1db07bd(struct futhark_context *ctx, const struct futhark_opaque_5797e930517e531e6d939a24b1db07bd *v);
int futhark_free_opaque_tup2_f64_f64(struct futhark_context *ctx, struct futhark_opaque_tup2_f64_f64 *obj);
int futhark_store_opaque_tup2_f64_f64(struct futhark_context *ctx, const struct futhark_opaque_tup2_f64_f64 *obj, void **p, size_t *n);
struct futhark_opaque_tup2_f64_f64 *futhark_restore_opaque_tup2_f64_f64(struct futhark_context *ctx, const void *p);
int futhark_project_opaque_tup2_f64_f64_0(struct futhark_context *ctx, double *out, const struct futhark_opaque_tup2_f64_f64 *obj);
int futhark_project_opaque_tup2_f64_f64_1(struct futhark_context *ctx, double *out, const struct futhark_opaque_tup2_f64_f64 *obj);
int futhark_new_opaque_tup2_f64_f64(struct futhark_context *ctx, struct futhark_opaque_tup2_f64_f64 **out, const double f_0, const double f_1);
int futhark_free_opaque_tup2_i64_i64(struct futhark_context *ctx, struct futhark_opaque_tup2_i64_i64 *obj);
int futhark_store_opaque_tup2_i64_i64(struct futhark_context *ctx, const struct futhark_opaque_tup2_i64_i64 *obj, void **p, size_t *n);
struct futhark_opaque_tup2_i64_i64 *futhark_restore_opaque_tup2_i64_i64(struct futhark_context *ctx, const void *p);
int futhark_project_opaque_tup2_i64_i64_0(struct futhark_context *ctx, int64_t *out, const struct futhark_opaque_tup2_i64_i64 *obj);
int futhark_project_opaque_tup2_i64_i64_1(struct futhark_context *ctx, int64_t *out, const struct futhark_opaque_tup2_i64_i64 *obj);
int futhark_new_opaque_tup2_i64_i64(struct futhark_context *ctx, struct futhark_opaque_tup2_i64_i64 **out, const int64_t f_0, const int64_t f_1);
int futhark_free_opaque_arr1d_tup2_f64_f64(struct futhark_context *ctx, struct futhark_opaque_arr1d_tup2_f64_f64 *obj);
int futhark_store_opaque_arr1d_tup2_f64_f64(struct futhark_context *ctx, const struct futhark_opaque_arr1d_tup2_f64_f64 *obj, void **p, size_t *n);
struct futhark_opaque_arr1d_tup2_f64_f64 *futhark_restore_opaque_arr1d_tup2_f64_f64(struct futhark_context *ctx, const void *p);
int futhark_project_opaque_arr1d_tup2_f64_f64_0(struct futhark_context *ctx, struct futhark_f64_1d **out, const struct futhark_opaque_arr1d_tup2_f64_f64 *obj);
int futhark_project_opaque_arr1d_tup2_f64_f64_1(struct futhark_context *ctx, struct futhark_f64_1d **out, const struct futhark_opaque_arr1d_tup2_f64_f64 *obj);
int futhark_zip_opaque_arr1d_tup2_f64_f64(struct futhark_context *ctx, struct futhark_opaque_arr1d_tup2_f64_f64 **out, const struct futhark_f64_1d *f_0, const struct futhark_f64_1d *f_1);
int futhark_index_opaque_arr1d_tup2_f64_f64(struct futhark_context *ctx, struct futhark_opaque_tup2_f64_f64 **out, struct futhark_opaque_arr1d_tup2_f64_f64 *arr, int64_t i0);
const int64_t *futhark_shape_opaque_arr1d_tup2_f64_f64(struct futhark_context *ctx, struct futhark_opaque_arr1d_tup2_f64_f64 *arr);
int futhark_free_opaque_arr1d_tup2_i64_i64(struct futhark_context *ctx, struct futhark_opaque_arr1d_tup2_i64_i64 *obj);
int futhark_store_opaque_arr1d_tup2_i64_i64(struct futhark_context *ctx, const struct futhark_opaque_arr1d_tup2_i64_i64 *obj, void **p, size_t *n);
struct futhark_opaque_arr1d_tup2_i64_i64 *futhark_restore_opaque_arr1d_tup2_i64_i64(struct futhark_context *ctx, const void *p);
int futhark_project_opaque_arr1d_tup2_i64_i64_0(struct futhark_context *ctx, struct futhark_i64_1d **out, const struct futhark_opaque_arr1d_tup2_i64_i64 *obj);
int futhark_project_opaque_arr1d_tup2_i64_i64_1(struct futhark_context *ctx, struct futhark_i64_1d **out, const struct futhark_opaque_arr1d_tup2_i64_i64 *obj);
int futhark_zip_opaque_arr1d_tup2_i64_i64(struct futhark_context *ctx, struct futhark_opaque_arr1d_tup2_i64_i64 **out, const struct futhark_i64_1d *f_0, const struct futhark_i64_1d *f_1);
int futhark_index_opaque_arr1d_tup2_i64_i64(struct futhark_context *ctx, struct futhark_opaque_tup2_i64_i64 **out, struct futhark_opaque_arr1d_tup2_i64_i64 *arr, int64_t i0);
const int64_t *futhark_shape_opaque_arr1d_tup2_i64_i64(struct futhark_context *ctx, struct futhark_opaque_arr1d_tup2_i64_i64 *arr);
int futhark_free_opaque_collisionTable(struct futhark_context *ctx, struct futhark_opaque_collisionTable *obj);
int futhark_store_opaque_collisionTable(struct futhark_context *ctx, const struct futhark_opaque_collisionTable *obj, void **p, size_t *n);
struct futhark_opaque_collisionTable *futhark_restore_opaque_collisionTable(struct futhark_context *ctx, const void *p);
int futhark_project_opaque_collisionTable_chain_id(struct futhark_context *ctx, struct futhark_i64_1d **out, const struct futhark_opaque_collisionTable *obj);
int futhark_project_opaque_collisionTable_replaceWith(struct futhark_context *ctx, struct futhark_i64_1d **out, const struct futhark_opaque_collisionTable *obj);
int futhark_new_opaque_collisionTable(struct futhark_context *ctx, struct futhark_opaque_collisionTable **out, const struct futhark_i64_1d *f_chain_id, const struct futhark_i64_1d *f_replaceWith);
int futhark_free_opaque_dbcHandler_double(struct futhark_context *ctx, struct futhark_opaque_dbcHandler_double *obj);
int futhark_store_opaque_dbcHandler_double(struct futhark_context *ctx, const struct futhark_opaque_dbcHandler_double *obj, void **p, size_t *n);
struct futhark_opaque_dbcHandler_double *futhark_restore_opaque_dbcHandler_double(struct futhark_context *ctx, const void *p);
int futhark_project_opaque_dbcHandler_double_chain_collisions(struct futhark_context *ctx, struct futhark_opaque_arr1d_tup2_i64_i64 **out, const struct futhark_opaque_dbcHandler_double *obj);
int futhark_project_opaque_dbcHandler_double_clBase(struct futhark_context *ctx, struct futhark_opaque_8b7e80c3fb80a9a7700efe8e89371deb **out, const struct futhark_opaque_dbcHandler_double *obj);
int futhark_project_opaque_dbcHandler_double_clProc(struct futhark_context *ctx, struct futhark_opaque_a8fdbed66266f52db9d5a0da8b1f6763 **out, const struct futhark_opaque_dbcHandler_double *obj);
int futhark_project_opaque_dbcHandler_double_current_partition(struct futhark_context *ctx, struct futhark_opaque_4dedc823193c594b5c01727ae8ac5943 **out, const struct futhark_opaque_dbcHandler_double *obj);
int futhark_project_opaque_dbcHandler_double_toFlush_dat(struct futhark_context *ctx, struct futhark_opaque_arr1d_tup2_f64_f64 **out, const struct futhark_opaque_dbcHandler_double *obj);
int futhark_project_opaque_dbcHandler_double_toFlush_ids(struct futhark_context *ctx, struct futhark_i64_1d **out, const struct futhark_opaque_dbcHandler_double *obj);
int futhark_new_opaque_dbcHandler_double(struct futhark_context *ctx, struct futhark_opaque_dbcHandler_double **out, const struct futhark_opaque_arr1d_tup2_i64_i64 *f_chain_collisions, const struct futhark_opaque_8b7e80c3fb80a9a7700efe8e89371deb *f_clBase, const struct futhark_opaque_a8fdbed66266f52db9d5a0da8b1f6763 *f_clProc, const struct futhark_opaque_4dedc823193c594b5c01727ae8ac5943 *f_current_partition, const struct futhark_opaque_arr1d_tup2_f64_f64 *f_toFlush_dat, const struct futhark_i64_1d *f_toFlush_ids);
int futhark_free_opaque_flushedData_double(struct futhark_context *ctx, struct futhark_opaque_flushedData_double *obj);
int futhark_store_opaque_flushedData_double(struct futhark_context *ctx, const struct futhark_opaque_flushedData_double *obj, void **p, size_t *n);
struct futhark_opaque_flushedData_double *futhark_restore_opaque_flushedData_double(struct futhark_context *ctx, const void *p);
int futhark_project_opaque_flushedData_double_chain_ids(struct futhark_context *ctx, struct futhark_i64_1d **out, const struct futhark_opaque_flushedData_double *obj);
int futhark_project_opaque_flushedData_double_xs(struct futhark_context *ctx, struct futhark_f64_1d **out, const struct futhark_opaque_flushedData_double *obj);
int futhark_project_opaque_flushedData_double_ys(struct futhark_context *ctx, struct futhark_f64_1d **out, const struct futhark_opaque_flushedData_double *obj);
int futhark_new_opaque_flushedData_double(struct futhark_context *ctx, struct futhark_opaque_flushedData_double **out, const struct futhark_i64_1d *f_chain_ids, const struct futhark_f64_1d *f_xs, const struct futhark_f64_1d *f_ys);
int futhark_free_opaque_8b7e80c3fb80a9a7700efe8e89371deb(struct futhark_context *ctx, struct futhark_opaque_8b7e80c3fb80a9a7700efe8e89371deb *obj);
int futhark_store_opaque_8b7e80c3fb80a9a7700efe8e89371deb(struct futhark_context *ctx, const struct futhark_opaque_8b7e80c3fb80a9a7700efe8e89371deb *obj, void **p, size_t *n);
struct futhark_opaque_8b7e80c3fb80a9a7700efe8e89371deb *futhark_restore_opaque_8b7e80c3fb80a9a7700efe8e89371deb(struct futhark_context *ctx, const void *p);
int futhark_project_opaque_8b7e80c3fb80a9a7700efe8e89371deb_angle_t(struct futhark_context *ctx, struct futhark_opaque_00764e1f7379f14f22282d21712a8514 **out, const struct futhark_opaque_8b7e80c3fb80a9a7700efe8e89371deb *obj);
int futhark_project_opaque_8b7e80c3fb80a9a7700efe8e89371deb_dist_t(struct futhark_context *ctx, struct futhark_opaque_5797e930517e531e6d939a24b1db07bd **out, const struct futhark_opaque_8b7e80c3fb80a9a7700efe8e89371deb *obj);
int futhark_project_opaque_8b7e80c3fb80a9a7700efe8e89371deb_eps(struct futhark_context *ctx, double *out, const struct futhark_opaque_8b7e80c3fb80a9a7700efe8e89371deb *obj);
int futhark_project_opaque_8b7e80c3fb80a9a7700efe8e89371deb_m_size(struct futhark_context *ctx, int64_t *out, const struct futhark_opaque_8b7e80c3fb80a9a7700efe8e89371deb *obj);
int futhark_project_opaque_8b7e80c3fb80a9a7700efe8e89371deb_maxs(struct futhark_context *ctx, struct futhark_f64_1d **out, const struct futhark_opaque_8b7e80c3fb80a9a7700efe8e89371deb *obj);
int futhark_project_opaque_8b7e80c3fb80a9a7700efe8e89371deb_minPts(struct futhark_context *ctx, int64_t *out, const struct futhark_opaque_8b7e80c3fb80a9a7700efe8e89371deb *obj);
int futhark_project_opaque_8b7e80c3fb80a9a7700efe8e89371deb_mins(struct futhark_context *ctx, struct futhark_f64_1d **out, const struct futhark_opaque_8b7e80c3fb80a9a7700efe8e89371deb *obj);
int futhark_project_opaque_8b7e80c3fb80a9a7700efe8e89371deb_part_per_dim(struct futhark_context *ctx, struct futhark_i64_1d **out, const struct futhark_opaque_8b7e80c3fb80a9a7700efe8e89371deb *obj);
int futhark_project_opaque_8b7e80c3fb80a9a7700efe8e89371deb_radius(struct futhark_context *ctx, double *out, const struct futhark_opaque_8b7e80c3fb80a9a7700efe8e89371deb *obj);
int futhark_project_opaque_8b7e80c3fb80a9a7700efe8e89371deb_step_per_dim(struct futhark_context *ctx, struct futhark_f64_1d **out, const struct futhark_opaque_8b7e80c3fb80a9a7700efe8e89371deb *obj);
int futhark_project_opaque_8b7e80c3fb80a9a7700efe8e89371deb_total_partitions(struct futhark_context *ctx, int64_t *out, const struct futhark_opaque_8b7e80c3fb80a9a7700efe8e89371deb *obj);
int futhark_new_opaque_8b7e80c3fb80a9a7700efe8e89371deb(struct futhark_context *ctx, struct futhark_opaque_8b7e80c3fb80a9a7700efe8e89371deb **out, const struct futhark_opaque_00764e1f7379f14f22282d21712a8514 *f_angle_t, const struct futhark_opaque_5797e930517e531e6d939a24b1db07bd *f_dist_t, const double f_eps, const int64_t f_m_sizze, const struct futhark_f64_1d *f_maxs, const int64_t f_minPts, const struct futhark_f64_1d *f_mins, const struct futhark_i64_1d *f_part_per_dim, const double f_radius, const struct futhark_f64_1d *f_step_per_dim, const int64_t f_total_partitions);
int futhark_free_opaque_a8fdbed66266f52db9d5a0da8b1f6763(struct futhark_context *ctx, struct futhark_opaque_a8fdbed66266f52db9d5a0da8b1f6763 *obj);
int futhark_store_opaque_a8fdbed66266f52db9d5a0da8b1f6763(struct futhark_context *ctx, const struct futhark_opaque_a8fdbed66266f52db9d5a0da8b1f6763 *obj, void **p, size_t *n);
struct futhark_opaque_a8fdbed66266f52db9d5a0da8b1f6763 *futhark_restore_opaque_a8fdbed66266f52db9d5a0da8b1f6763(struct futhark_context *ctx, const void *p);
int futhark_project_opaque_a8fdbed66266f52db9d5a0da8b1f6763_buff_isCore(struct futhark_context *ctx, struct futhark_bool_1d **out, const struct futhark_opaque_a8fdbed66266f52db9d5a0da8b1f6763 *obj);
int futhark_project_opaque_a8fdbed66266f52db9d5a0da8b1f6763_buffered_ids(struct futhark_context *ctx, struct futhark_i64_1d **out, const struct futhark_opaque_a8fdbed66266f52db9d5a0da8b1f6763 *obj);
int futhark_project_opaque_a8fdbed66266f52db9d5a0da8b1f6763_buffered_pts(struct futhark_context *ctx, struct futhark_opaque_arr1d_tup2_f64_f64 **out, const struct futhark_opaque_a8fdbed66266f52db9d5a0da8b1f6763 *obj);
int futhark_project_opaque_a8fdbed66266f52db9d5a0da8b1f6763_chainOffs(struct futhark_context *ctx, int64_t *out, const struct futhark_opaque_a8fdbed66266f52db9d5a0da8b1f6763 *obj);
int futhark_project_opaque_a8fdbed66266f52db9d5a0da8b1f6763_cur_part_id(struct futhark_context *ctx, int64_t *out, const struct futhark_opaque_a8fdbed66266f52db9d5a0da8b1f6763 *obj);
int futhark_project_opaque_a8fdbed66266f52db9d5a0da8b1f6763_cur_part_order(struct futhark_context *ctx, int64_t *out, const struct futhark_opaque_a8fdbed66266f52db9d5a0da8b1f6763 *obj);
int futhark_project_opaque_a8fdbed66266f52db9d5a0da8b1f6763_isPartVisited(struct futhark_context *ctx, struct futhark_bool_1d **out, const struct futhark_opaque_a8fdbed66266f52db9d5a0da8b1f6763 *obj);
int futhark_project_opaque_a8fdbed66266f52db9d5a0da8b1f6763_next_offs(struct futhark_context *ctx, int64_t *out, const struct futhark_opaque_a8fdbed66266f52db9d5a0da8b1f6763 *obj);
int futhark_project_opaque_a8fdbed66266f52db9d5a0da8b1f6763_offs(struct futhark_context *ctx, int64_t *out, const struct futhark_opaque_a8fdbed66266f52db9d5a0da8b1f6763 *obj);
int futhark_project_opaque_a8fdbed66266f52db9d5a0da8b1f6763_relevantParts(struct futhark_context *ctx, struct futhark_i64_1d **out, const struct futhark_opaque_a8fdbed66266f52db9d5a0da8b1f6763 *obj);
int futhark_new_opaque_a8fdbed66266f52db9d5a0da8b1f6763(struct futhark_context *ctx, struct futhark_opaque_a8fdbed66266f52db9d5a0da8b1f6763 **out, const struct futhark_bool_1d *f_buff_isCore, const struct futhark_i64_1d *f_buffered_ids, const struct futhark_opaque_arr1d_tup2_f64_f64 *f_buffered_pts, const int64_t f_chainOffs, const int64_t f_cur_part_id, const int64_t f_cur_part_order, const struct futhark_bool_1d *f_isPartVisited, const int64_t f_next_offs, const int64_t f_offs, const struct futhark_i64_1d *f_relevantParts);
int futhark_free_opaque_4dedc823193c594b5c01727ae8ac5943(struct futhark_context *ctx, struct futhark_opaque_4dedc823193c594b5c01727ae8ac5943 *obj);
int futhark_store_opaque_4dedc823193c594b5c01727ae8ac5943(struct futhark_context *ctx, const struct futhark_opaque_4dedc823193c594b5c01727ae8ac5943 *obj, void **p, size_t *n);
struct futhark_opaque_4dedc823193c594b5c01727ae8ac5943 *futhark_restore_opaque_4dedc823193c594b5c01727ae8ac5943(struct futhark_context *ctx, const void *p);
int futhark_project_opaque_4dedc823193c594b5c01727ae8ac5943_chain_ids(struct futhark_context *ctx, struct futhark_i64_1d **out, const struct futhark_opaque_4dedc823193c594b5c01727ae8ac5943 *obj);
int futhark_project_opaque_4dedc823193c594b5c01727ae8ac5943_dat(struct futhark_context *ctx, struct futhark_opaque_arr1d_tup2_f64_f64 **out, const struct futhark_opaque_4dedc823193c594b5c01727ae8ac5943 *obj);
int futhark_project_opaque_4dedc823193c594b5c01727ae8ac5943_inner_max_coord(struct futhark_context *ctx, struct futhark_f64_1d **out, const struct futhark_opaque_4dedc823193c594b5c01727ae8ac5943 *obj);
int futhark_project_opaque_4dedc823193c594b5c01727ae8ac5943_inner_min_coord(struct futhark_context *ctx, struct futhark_f64_1d **out, const struct futhark_opaque_4dedc823193c594b5c01727ae8ac5943 *obj);
int futhark_project_opaque_4dedc823193c594b5c01727ae8ac5943_isCore(struct futhark_context *ctx, struct futhark_bool_1d **out, const struct futhark_opaque_4dedc823193c594b5c01727ae8ac5943 *obj);
int futhark_project_opaque_4dedc823193c594b5c01727ae8ac5943_isMargin(struct futhark_context *ctx, struct futhark_bool_1d **out, const struct futhark_opaque_4dedc823193c594b5c01727ae8ac5943 *obj);
int futhark_project_opaque_4dedc823193c594b5c01727ae8ac5943_isNeighbourVisited(struct futhark_context *ctx, struct futhark_bool_1d **out, const struct futhark_opaque_4dedc823193c594b5c01727ae8ac5943 *obj);
int futhark_project_opaque_4dedc823193c594b5c01727ae8ac5943_isTightMargin(struct futhark_context *ctx, struct futhark_bool_1d **out, const struct futhark_opaque_4dedc823193c594b5c01727ae8ac5943 *obj);
int futhark_project_opaque_4dedc823193c594b5c01727ae8ac5943_max_coord(struct futhark_context *ctx, struct futhark_f64_1d **out, const struct futhark_opaque_4dedc823193c594b5c01727ae8ac5943 *obj);
int futhark_project_opaque_4dedc823193c594b5c01727ae8ac5943_min_coord(struct futhark_context *ctx, struct futhark_f64_1d **out, const struct futhark_opaque_4dedc823193c594b5c01727ae8ac5943 *obj);
int futhark_project_opaque_4dedc823193c594b5c01727ae8ac5943_neighbours(struct futhark_context *ctx, struct futhark_i64_1d **out, const struct futhark_opaque_4dedc823193c594b5c01727ae8ac5943 *obj);
int futhark_project_opaque_4dedc823193c594b5c01727ae8ac5943_part_id(struct futhark_context *ctx, int64_t *out, const struct futhark_opaque_4dedc823193c594b5c01727ae8ac5943 *obj);
int futhark_new_opaque_4dedc823193c594b5c01727ae8ac5943(struct futhark_context *ctx, struct futhark_opaque_4dedc823193c594b5c01727ae8ac5943 **out, const struct futhark_i64_1d *f_chain_ids, const struct futhark_opaque_arr1d_tup2_f64_f64 *f_dat, const struct futhark_f64_1d *f_inner_max_coord, const struct futhark_f64_1d *f_inner_min_coord, const struct futhark_bool_1d *f_isCore, const struct futhark_bool_1d *f_isMargin, const struct futhark_bool_1d *f_isNeighbourVisited, const struct futhark_bool_1d *f_isTightMargin, const struct futhark_f64_1d *f_max_coord, const struct futhark_f64_1d *f_min_coord, const struct futhark_i64_1d *f_neighbours, const int64_t f_part_id);

// Entry points
int futhark_entry_add_next_partition_double(struct futhark_context *ctx, struct futhark_opaque_dbcHandler_double **out0, const struct futhark_opaque_dbcHandler_double *in0, const int64_t in1, const struct futhark_f64_1d *in2, const struct futhark_f64_1d *in3);
int futhark_entry_do_DBSCAN_double(struct futhark_context *ctx, struct futhark_opaque_dbcHandler_double **out0, const struct futhark_opaque_dbcHandler_double *in0, const int64_t in1);
int futhark_entry_flush_dat_double(struct futhark_context *ctx, struct futhark_opaque_flushedData_double **out0, const struct futhark_opaque_dbcHandler_double *in0);
int futhark_entry_make_collisions_compact_double(struct futhark_context *ctx, struct futhark_opaque_collisionTable **out0, const struct futhark_opaque_dbcHandler_double *in0);
int futhark_entry_mk_dbcHandler_double(struct futhark_context *ctx, struct futhark_opaque_dbcHandler_double **out0, const double in0, const double in1, const double in2, const double in3, const int64_t in4, const int64_t in5, const bool in6, const bool in7, const double in8, const double in9, const int64_t in10, const int64_t in11);
int futhark_entry_next_partition_to_read_double(struct futhark_context *ctx, int64_t *out0, const struct futhark_opaque_dbcHandler_double *in0);
int futhark_entry_rectify_partition_ids_double(struct futhark_context *ctx, struct futhark_i64_1d **out0, const struct futhark_i64_1d *in0, const struct futhark_opaque_collisionTable *in1, const int64_t in2);

// Miscellaneous
int futhark_context_sync(struct futhark_context *ctx);
void futhark_context_config_set_cache_file(struct futhark_context_config *cfg, const char *f);
char *futhark_context_get_error(struct futhark_context *ctx);
void futhark_context_set_logging_file(struct futhark_context *ctx, FILE *f);
void futhark_context_pause_profiling(struct futhark_context *ctx);
void futhark_context_unpause_profiling(struct futhark_context *ctx);
char *futhark_context_report(struct futhark_context *ctx);
int futhark_context_clear_caches(struct futhark_context *ctx);
#define FUTHARK_BACKEND_cuda
#define FUTHARK_SUCCESS 0
#define FUTHARK_PROGRAM_ERROR 2
#define FUTHARK_OUT_OF_MEMORY 3

#ifdef __cplusplus
}
#endif

#include <stdio.h>
#include <stdlib.h>
#include <stdbool.h>
#include <math.h>
#include <stdint.h>
// If NDEBUG is set, the assert() macro will do nothing. Since Futhark
// (unfortunately) makes use of assert() for error detection (and even some
// side effects), we want to avoid that.
#undef NDEBUG
#include <assert.h>
#include <stdarg.h>
#define SCALAR_FUN_ATTR static inline
// Start of util.h.
//
// Various helper functions that are useful in all generated C code.

#include <errno.h>
#include <string.h>

static const char *fut_progname = "(embedded Futhark)";

static void futhark_panic(int eval, const char *fmt, ...) __attribute__((noreturn));
static char* msgprintf(const char *s, ...);
static void* slurp_file(const char *filename, size_t *size);
static int dump_file(const char *file, const void *buf, size_t n);
struct str_builder;
static void str_builder_init(struct str_builder *b);
static void str_builder(struct str_builder *b, const char *s, ...);
static char *strclone(const char *str);

static void futhark_panic(int eval, const char *fmt, ...) {
  va_list ap;
  va_start(ap, fmt);
  fprintf(stderr, "%s: ", fut_progname);
  vfprintf(stderr, fmt, ap);
  va_end(ap);
  exit(eval);
}

// For generating arbitrary-sized error messages.  It is the callers
// responsibility to free the buffer at some point.
static char* msgprintf(const char *s, ...) {
  va_list vl;
  va_start(vl, s);
  size_t needed = 1 + (size_t)vsnprintf(NULL, 0, s, vl);
  char *buffer = (char*) malloc(needed);
  va_start(vl, s); // Must re-init.
  vsnprintf(buffer, needed, s, vl);
  return buffer;
}

static inline void check_err(int errval, int sets_errno, const char *fun, int line,
                             const char *msg, ...) {
  if (errval) {
    char errnum[10];

    va_list vl;
    va_start(vl, msg);

    fprintf(stderr, "ERROR: ");
    vfprintf(stderr, msg, vl);
    fprintf(stderr, " in %s() at line %d with error code %s\n",
            fun, line,
            sets_errno ? strerror(errno) : errnum);
    exit(errval);
  }
}

#define CHECK_ERR(err, ...) check_err(err, 0, __func__, __LINE__, __VA_ARGS__)
#define CHECK_ERRNO(err, ...) check_err(err, 1, __func__, __LINE__, __VA_ARGS__)

// Read the rest of an open file into a NUL-terminated string; returns
// NULL on error.
static void* fslurp_file(FILE *f, size_t *size) {
  long start = ftell(f);
  fseek(f, 0, SEEK_END);
  long src_size = ftell(f)-start;
  fseek(f, start, SEEK_SET);
  unsigned char *s = (unsigned char*) malloc((size_t)src_size + 1);
  if (fread(s, 1, (size_t)src_size, f) != (size_t)src_size) {
    free(s);
    s = NULL;
  } else {
    s[src_size] = '\0';
  }

  if (size) {
    *size = (size_t)src_size;
  }

  return s;
}

// Read a file into a NUL-terminated string; returns NULL on error.
static void* slurp_file(const char *filename, size_t *size) {
  FILE *f = fopen(filename, "rb"); // To avoid Windows messing with linebreaks.
  if (f == NULL) return NULL;
  unsigned char *s = fslurp_file(f, size);
  fclose(f);
  return s;
}

// Dump 'n' bytes from 'buf' into the file at the designated location.
// Returns 0 on success.
static int dump_file(const char *file, const void *buf, size_t n) {
  FILE *f = fopen(file, "w");

  if (f == NULL) {
    return 1;
  }

  if (fwrite(buf, sizeof(char), n, f) != n) {
    return 1;
  }

  if (fclose(f) != 0) {
    return 1;
  }

  return 0;
}

struct str_builder {
  char *str;
  size_t capacity; // Size of buffer.
  size_t used; // Bytes used, *not* including final zero.
};

static void str_builder_init(struct str_builder *b) {
  b->capacity = 10;
  b->used = 0;
  b->str = malloc(b->capacity);
  b->str[0] = 0;
}

static void str_builder(struct str_builder *b, const char *s, ...) {
  va_list vl;
  va_start(vl, s);
  size_t needed = (size_t)vsnprintf(NULL, 0, s, vl);

  while (b->capacity < b->used + needed + 1) {
    b->capacity *= 2;
    b->str = realloc(b->str, b->capacity);
  }

  va_start(vl, s); // Must re-init.
  vsnprintf(b->str+b->used, b->capacity-b->used, s, vl);
  b->used += needed;
}

static void str_builder_str(struct str_builder *b, const char *s) {
  size_t needed = strlen(s);
  if (b->capacity < b->used + needed + 1) {
    b->capacity *= 2;
    b->str = realloc(b->str, b->capacity);
  }
  strcpy(b->str+b->used, s);
  b->used += needed;
}

static void str_builder_char(struct str_builder *b, char c) {
  size_t needed = 1;
  if (b->capacity < b->used + needed + 1) {
    b->capacity *= 2;
    b->str = realloc(b->str, b->capacity);
  }
  b->str[b->used] = c;
  b->str[b->used+1] = 0;
  b->used += needed;
}

static void str_builder_json_str(struct str_builder* sb, const char* s) {
  str_builder_char(sb, '"');
  for (int j = 0; s[j]; j++) {
    char c = s[j];
    switch (c) {
    case '\n':
      str_builder_str(sb, "\\n");
      break;
    case '"':
      str_builder_str(sb, "\\\"");
      break;
    default:
      str_builder_char(sb, c);
    }
  }
  str_builder_char(sb, '"');
}

static char *strclone(const char *str) {
  size_t size = strlen(str) + 1;
  char *copy = (char*) malloc(size);
  if (copy == NULL) {
    return NULL;
  }

  memcpy(copy, str, size);
  return copy;
}

// Assumes NULL-terminated.
static char *strconcat(const char *src_fragments[]) {
  size_t src_len = 0;
  const char **p;

  for (p = src_fragments; *p; p++) {
    src_len += strlen(*p);
  }

  char *src = (char*) malloc(src_len + 1);
  size_t n = 0;
  for (p = src_fragments; *p; p++) {
    strcpy(src + n, *p);
    n += strlen(*p);
  }

  return src;
}

// End of util.h.
// Start of cache.h

#define CACHE_HASH_SIZE 8 // In 32-bit words.

struct cache_hash {
  uint32_t hash[CACHE_HASH_SIZE];
};

// Initialise a blank cache.
static void cache_hash_init(struct cache_hash *c);

// Hash some bytes and add them to the accumulated hash.
static void cache_hash(struct cache_hash *out, const char *in, size_t n);

// Try to restore cache contents from a file with the given name.
// Assumes the cache is invalid if it contains the given hash.
// Allocates memory and reads the cache conents, which is returned in
// *buf with size *buflen.  If the cache is successfully loaded, this
// function returns 0.  Otherwise it returns nonzero.  Errno is set if
// the failure to load the cache is due to anything except invalid
// cache conents.  Note that failing to restore the cache is not
// necessarily a problem: it might just be invalid or not created yet.
static int cache_restore(const char *fname, const struct cache_hash *hash,
                         unsigned char **buf, size_t *buflen);

// Store cache contents in the given file, with the given hash.
static int cache_store(const char *fname, const struct cache_hash *hash,
                       const unsigned char *buf, size_t buflen);

// Now for the implementation.

static void cache_hash_init(struct cache_hash *c) {
  memset(c->hash, 0, CACHE_HASH_SIZE * sizeof(uint32_t));
}

static void cache_hash(struct cache_hash *out, const char *in, size_t n) {
  // Adaptation of djb2 for larger output size by storing intermediate
  // states.
  uint32_t hash = 5381;
  for (size_t i = 0; i < n; i++) {
    hash = ((hash << 5) + hash) + in[i];
    out->hash[i % CACHE_HASH_SIZE] ^= hash;
  }
}

#define CACHE_HEADER_SIZE 8
static const char cache_header[CACHE_HEADER_SIZE] = "FUTHARK\0";

static int cache_restore(const char *fname, const struct cache_hash *hash,
                         unsigned char **buf, size_t *buflen) {
  FILE *f = fopen(fname, "rb");

  if (f == NULL) {
    return 1;
  }

  char f_header[CACHE_HEADER_SIZE];

  if (fread(f_header, sizeof(char), CACHE_HEADER_SIZE, f) != CACHE_HEADER_SIZE) {
    goto error;
  }

  if (memcmp(f_header, cache_header, CACHE_HEADER_SIZE) != 0) {
    goto error;
  }

  if (fseek(f, 0, SEEK_END) != 0) {
    goto error;
  }
  int64_t f_size = (int64_t)ftell(f);
  if (fseek(f, CACHE_HEADER_SIZE, SEEK_SET) != 0) {
    goto error;
  }

  int64_t expected_size;

  if (fread(&expected_size, sizeof(int64_t), 1, f) != 1) {
    goto error;
  }

  if (f_size != expected_size) {
    errno = 0;
    goto error;
  }

  int32_t f_hash[CACHE_HASH_SIZE];

  if (fread(f_hash, sizeof(int32_t), CACHE_HASH_SIZE, f) != CACHE_HASH_SIZE) {
    goto error;
  }

  if (memcmp(f_hash, hash->hash, CACHE_HASH_SIZE) != 0) {
    errno = 0;
    goto error;
  }

  *buflen = f_size - CACHE_HEADER_SIZE - sizeof(int64_t) - CACHE_HASH_SIZE*sizeof(int32_t);
  *buf = malloc(*buflen);
  if (fread(*buf, sizeof(char), *buflen, f) != *buflen) {
    free(*buf);
    goto error;
  }

  fclose(f);

  return 0;

 error:
  fclose(f);
  return 1;
}

static int cache_store(const char *fname, const struct cache_hash *hash,
                       const unsigned char *buf, size_t buflen) {
  FILE *f = fopen(fname, "wb");

  if (f == NULL) {
    return 1;
  }

  if (fwrite(cache_header, CACHE_HEADER_SIZE, 1, f) != 1) {
    goto error;
  }

  int64_t size = CACHE_HEADER_SIZE + sizeof(int64_t) + CACHE_HASH_SIZE*sizeof(int32_t) + buflen;

  if (fwrite(&size, sizeof(size), 1, f) != 1) {
    goto error;
  }

  if (fwrite(hash->hash, sizeof(int32_t), CACHE_HASH_SIZE, f) != CACHE_HASH_SIZE) {
    goto error;
  }

  if (fwrite(buf, sizeof(unsigned char), buflen, f) != buflen) {
    goto error;
  }

  fclose(f);

  return 0;

 error:
  fclose(f);
  return 1;
}

// End of cache.h
// Start of half.h.

// Conversion functions are from http://half.sourceforge.net/, but
// translated to C.
//
// Copyright (c) 2012-2021 Christian Rau
//
// Permission is hereby granted, free of charge, to any person obtaining a copy
// of this software and associated documentation files (the "Software"), to deal
// in the Software without restriction, including without limitation the rights
// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
// copies of the Software, and to permit persons to whom the Software is
// furnished to do so, subject to the following conditions:
//
// The above copyright notice and this permission notice shall be included in
// all copies or substantial portions of the Software.
//
// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
// THE SOFTWARE.

#ifndef __OPENCL_VERSION__
#define __constant
#endif

__constant static const uint16_t base_table[512] = {
  0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
  0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
  0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
  0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
  0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
  0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
  0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0001, 0x0002, 0x0004, 0x0008, 0x0010, 0x0020, 0x0040, 0x0080, 0x0100,
  0x0200, 0x0400, 0x0800, 0x0C00, 0x1000, 0x1400, 0x1800, 0x1C00, 0x2000, 0x2400, 0x2800, 0x2C00, 0x3000, 0x3400, 0x3800, 0x3C00,
  0x4000, 0x4400, 0x4800, 0x4C00, 0x5000, 0x5400, 0x5800, 0x5C00, 0x6000, 0x6400, 0x6800, 0x6C00, 0x7000, 0x7400, 0x7800, 0x7C00,
  0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00,
  0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00,
  0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00,
  0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00,
  0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00,
  0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00,
  0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00,
  0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000,
  0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000,
  0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000,
  0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000,
  0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000,
  0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000,
  0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8001, 0x8002, 0x8004, 0x8008, 0x8010, 0x8020, 0x8040, 0x8080, 0x8100,
  0x8200, 0x8400, 0x8800, 0x8C00, 0x9000, 0x9400, 0x9800, 0x9C00, 0xA000, 0xA400, 0xA800, 0xAC00, 0xB000, 0xB400, 0xB800, 0xBC00,
  0xC000, 0xC400, 0xC800, 0xCC00, 0xD000, 0xD400, 0xD800, 0xDC00, 0xE000, 0xE400, 0xE800, 0xEC00, 0xF000, 0xF400, 0xF800, 0xFC00,
  0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00,
  0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00,
  0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00,
  0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00,
  0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00,
  0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00,
  0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00 };

__constant static const unsigned char shift_table[512] = {
  24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24,
  24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24,
  24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24,
  24, 24, 24, 24, 24, 24, 24, 23, 22, 21, 20, 19, 18, 17, 16, 15, 14, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13,
  13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24,
  24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24,
  24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24,
  24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 13,
  24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24,
  24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24,
  24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24,
  24, 24, 24, 24, 24, 24, 24, 23, 22, 21, 20, 19, 18, 17, 16, 15, 14, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13,
  13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24,
  24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24,
  24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24,
  24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 13 };

__constant static const uint32_t mantissa_table[2048] = {
  0x00000000, 0x33800000, 0x34000000, 0x34400000, 0x34800000, 0x34A00000, 0x34C00000, 0x34E00000, 0x35000000, 0x35100000, 0x35200000, 0x35300000, 0x35400000, 0x35500000, 0x35600000, 0x35700000,
  0x35800000, 0x35880000, 0x35900000, 0x35980000, 0x35A00000, 0x35A80000, 0x35B00000, 0x35B80000, 0x35C00000, 0x35C80000, 0x35D00000, 0x35D80000, 0x35E00000, 0x35E80000, 0x35F00000, 0x35F80000,
  0x36000000, 0x36040000, 0x36080000, 0x360C0000, 0x36100000, 0x36140000, 0x36180000, 0x361C0000, 0x36200000, 0x36240000, 0x36280000, 0x362C0000, 0x36300000, 0x36340000, 0x36380000, 0x363C0000,
  0x36400000, 0x36440000, 0x36480000, 0x364C0000, 0x36500000, 0x36540000, 0x36580000, 0x365C0000, 0x36600000, 0x36640000, 0x36680000, 0x366C0000, 0x36700000, 0x36740000, 0x36780000, 0x367C0000,
  0x36800000, 0x36820000, 0x36840000, 0x36860000, 0x36880000, 0x368A0000, 0x368C0000, 0x368E0000, 0x36900000, 0x36920000, 0x36940000, 0x36960000, 0x36980000, 0x369A0000, 0x369C0000, 0x369E0000,
  0x36A00000, 0x36A20000, 0x36A40000, 0x36A60000, 0x36A80000, 0x36AA0000, 0x36AC0000, 0x36AE0000, 0x36B00000, 0x36B20000, 0x36B40000, 0x36B60000, 0x36B80000, 0x36BA0000, 0x36BC0000, 0x36BE0000,
  0x36C00000, 0x36C20000, 0x36C40000, 0x36C60000, 0x36C80000, 0x36CA0000, 0x36CC0000, 0x36CE0000, 0x36D00000, 0x36D20000, 0x36D40000, 0x36D60000, 0x36D80000, 0x36DA0000, 0x36DC0000, 0x36DE0000,
  0x36E00000, 0x36E20000, 0x36E40000, 0x36E60000, 0x36E80000, 0x36EA0000, 0x36EC0000, 0x36EE0000, 0x36F00000, 0x36F20000, 0x36F40000, 0x36F60000, 0x36F80000, 0x36FA0000, 0x36FC0000, 0x36FE0000,
  0x37000000, 0x37010000, 0x37020000, 0x37030000, 0x37040000, 0x37050000, 0x37060000, 0x37070000, 0x37080000, 0x37090000, 0x370A0000, 0x370B0000, 0x370C0000, 0x370D0000, 0x370E0000, 0x370F0000,
  0x37100000, 0x37110000, 0x37120000, 0x37130000, 0x37140000, 0x37150000, 0x37160000, 0x37170000, 0x37180000, 0x37190000, 0x371A0000, 0x371B0000, 0x371C0000, 0x371D0000, 0x371E0000, 0x371F0000,
  0x37200000, 0x37210000, 0x37220000, 0x37230000, 0x37240000, 0x37250000, 0x37260000, 0x37270000, 0x37280000, 0x37290000, 0x372A0000, 0x372B0000, 0x372C0000, 0x372D0000, 0x372E0000, 0x372F0000,
  0x37300000, 0x37310000, 0x37320000, 0x37330000, 0x37340000, 0x37350000, 0x37360000, 0x37370000, 0x37380000, 0x37390000, 0x373A0000, 0x373B0000, 0x373C0000, 0x373D0000, 0x373E0000, 0x373F0000,
  0x37400000, 0x37410000, 0x37420000, 0x37430000, 0x37440000, 0x37450000, 0x37460000, 0x37470000, 0x37480000, 0x37490000, 0x374A0000, 0x374B0000, 0x374C0000, 0x374D0000, 0x374E0000, 0x374F0000,
  0x37500000, 0x37510000, 0x37520000, 0x37530000, 0x37540000, 0x37550000, 0x37560000, 0x37570000, 0x37580000, 0x37590000, 0x375A0000, 0x375B0000, 0x375C0000, 0x375D0000, 0x375E0000, 0x375F0000,
  0x37600000, 0x37610000, 0x37620000, 0x37630000, 0x37640000, 0x37650000, 0x37660000, 0x37670000, 0x37680000, 0x37690000, 0x376A0000, 0x376B0000, 0x376C0000, 0x376D0000, 0x376E0000, 0x376F0000,
  0x37700000, 0x37710000, 0x37720000, 0x37730000, 0x37740000, 0x37750000, 0x37760000, 0x37770000, 0x37780000, 0x37790000, 0x377A0000, 0x377B0000, 0x377C0000, 0x377D0000, 0x377E0000, 0x377F0000,
  0x37800000, 0x37808000, 0x37810000, 0x37818000, 0x37820000, 0x37828000, 0x37830000, 0x37838000, 0x37840000, 0x37848000, 0x37850000, 0x37858000, 0x37860000, 0x37868000, 0x37870000, 0x37878000,
  0x37880000, 0x37888000, 0x37890000, 0x37898000, 0x378A0000, 0x378A8000, 0x378B0000, 0x378B8000, 0x378C0000, 0x378C8000, 0x378D0000, 0x378D8000, 0x378E0000, 0x378E8000, 0x378F0000, 0x378F8000,
  0x37900000, 0x37908000, 0x37910000, 0x37918000, 0x37920000, 0x37928000, 0x37930000, 0x37938000, 0x37940000, 0x37948000, 0x37950000, 0x37958000, 0x37960000, 0x37968000, 0x37970000, 0x37978000,
  0x37980000, 0x37988000, 0x37990000, 0x37998000, 0x379A0000, 0x379A8000, 0x379B0000, 0x379B8000, 0x379C0000, 0x379C8000, 0x379D0000, 0x379D8000, 0x379E0000, 0x379E8000, 0x379F0000, 0x379F8000,
  0x37A00000, 0x37A08000, 0x37A10000, 0x37A18000, 0x37A20000, 0x37A28000, 0x37A30000, 0x37A38000, 0x37A40000, 0x37A48000, 0x37A50000, 0x37A58000, 0x37A60000, 0x37A68000, 0x37A70000, 0x37A78000,
  0x37A80000, 0x37A88000, 0x37A90000, 0x37A98000, 0x37AA0000, 0x37AA8000, 0x37AB0000, 0x37AB8000, 0x37AC0000, 0x37AC8000, 0x37AD0000, 0x37AD8000, 0x37AE0000, 0x37AE8000, 0x37AF0000, 0x37AF8000,
  0x37B00000, 0x37B08000, 0x37B10000, 0x37B18000, 0x37B20000, 0x37B28000, 0x37B30000, 0x37B38000, 0x37B40000, 0x37B48000, 0x37B50000, 0x37B58000, 0x37B60000, 0x37B68000, 0x37B70000, 0x37B78000,
  0x37B80000, 0x37B88000, 0x37B90000, 0x37B98000, 0x37BA0000, 0x37BA8000, 0x37BB0000, 0x37BB8000, 0x37BC0000, 0x37BC8000, 0x37BD0000, 0x37BD8000, 0x37BE0000, 0x37BE8000, 0x37BF0000, 0x37BF8000,
  0x37C00000, 0x37C08000, 0x37C10000, 0x37C18000, 0x37C20000, 0x37C28000, 0x37C30000, 0x37C38000, 0x37C40000, 0x37C48000, 0x37C50000, 0x37C58000, 0x37C60000, 0x37C68000, 0x37C70000, 0x37C78000,
  0x37C80000, 0x37C88000, 0x37C90000, 0x37C98000, 0x37CA0000, 0x37CA8000, 0x37CB0000, 0x37CB8000, 0x37CC0000, 0x37CC8000, 0x37CD0000, 0x37CD8000, 0x37CE0000, 0x37CE8000, 0x37CF0000, 0x37CF8000,
  0x37D00000, 0x37D08000, 0x37D10000, 0x37D18000, 0x37D20000, 0x37D28000, 0x37D30000, 0x37D38000, 0x37D40000, 0x37D48000, 0x37D50000, 0x37D58000, 0x37D60000, 0x37D68000, 0x37D70000, 0x37D78000,
  0x37D80000, 0x37D88000, 0x37D90000, 0x37D98000, 0x37DA0000, 0x37DA8000, 0x37DB0000, 0x37DB8000, 0x37DC0000, 0x37DC8000, 0x37DD0000, 0x37DD8000, 0x37DE0000, 0x37DE8000, 0x37DF0000, 0x37DF8000,
  0x37E00000, 0x37E08000, 0x37E10000, 0x37E18000, 0x37E20000, 0x37E28000, 0x37E30000, 0x37E38000, 0x37E40000, 0x37E48000, 0x37E50000, 0x37E58000, 0x37E60000, 0x37E68000, 0x37E70000, 0x37E78000,
  0x37E80000, 0x37E88000, 0x37E90000, 0x37E98000, 0x37EA0000, 0x37EA8000, 0x37EB0000, 0x37EB8000, 0x37EC0000, 0x37EC8000, 0x37ED0000, 0x37ED8000, 0x37EE0000, 0x37EE8000, 0x37EF0000, 0x37EF8000,
  0x37F00000, 0x37F08000, 0x37F10000, 0x37F18000, 0x37F20000, 0x37F28000, 0x37F30000, 0x37F38000, 0x37F40000, 0x37F48000, 0x37F50000, 0x37F58000, 0x37F60000, 0x37F68000, 0x37F70000, 0x37F78000,
  0x37F80000, 0x37F88000, 0x37F90000, 0x37F98000, 0x37FA0000, 0x37FA8000, 0x37FB0000, 0x37FB8000, 0x37FC0000, 0x37FC8000, 0x37FD0000, 0x37FD8000, 0x37FE0000, 0x37FE8000, 0x37FF0000, 0x37FF8000,
  0x38000000, 0x38004000, 0x38008000, 0x3800C000, 0x38010000, 0x38014000, 0x38018000, 0x3801C000, 0x38020000, 0x38024000, 0x38028000, 0x3802C000, 0x38030000, 0x38034000, 0x38038000, 0x3803C000,
  0x38040000, 0x38044000, 0x38048000, 0x3804C000, 0x38050000, 0x38054000, 0x38058000, 0x3805C000, 0x38060000, 0x38064000, 0x38068000, 0x3806C000, 0x38070000, 0x38074000, 0x38078000, 0x3807C000,
  0x38080000, 0x38084000, 0x38088000, 0x3808C000, 0x38090000, 0x38094000, 0x38098000, 0x3809C000, 0x380A0000, 0x380A4000, 0x380A8000, 0x380AC000, 0x380B0000, 0x380B4000, 0x380B8000, 0x380BC000,
  0x380C0000, 0x380C4000, 0x380C8000, 0x380CC000, 0x380D0000, 0x380D4000, 0x380D8000, 0x380DC000, 0x380E0000, 0x380E4000, 0x380E8000, 0x380EC000, 0x380F0000, 0x380F4000, 0x380F8000, 0x380FC000,
  0x38100000, 0x38104000, 0x38108000, 0x3810C000, 0x38110000, 0x38114000, 0x38118000, 0x3811C000, 0x38120000, 0x38124000, 0x38128000, 0x3812C000, 0x38130000, 0x38134000, 0x38138000, 0x3813C000,
  0x38140000, 0x38144000, 0x38148000, 0x3814C000, 0x38150000, 0x38154000, 0x38158000, 0x3815C000, 0x38160000, 0x38164000, 0x38168000, 0x3816C000, 0x38170000, 0x38174000, 0x38178000, 0x3817C000,
  0x38180000, 0x38184000, 0x38188000, 0x3818C000, 0x38190000, 0x38194000, 0x38198000, 0x3819C000, 0x381A0000, 0x381A4000, 0x381A8000, 0x381AC000, 0x381B0000, 0x381B4000, 0x381B8000, 0x381BC000,
  0x381C0000, 0x381C4000, 0x381C8000, 0x381CC000, 0x381D0000, 0x381D4000, 0x381D8000, 0x381DC000, 0x381E0000, 0x381E4000, 0x381E8000, 0x381EC000, 0x381F0000, 0x381F4000, 0x381F8000, 0x381FC000,
  0x38200000, 0x38204000, 0x38208000, 0x3820C000, 0x38210000, 0x38214000, 0x38218000, 0x3821C000, 0x38220000, 0x38224000, 0x38228000, 0x3822C000, 0x38230000, 0x38234000, 0x38238000, 0x3823C000,
  0x38240000, 0x38244000, 0x38248000, 0x3824C000, 0x38250000, 0x38254000, 0x38258000, 0x3825C000, 0x38260000, 0x38264000, 0x38268000, 0x3826C000, 0x38270000, 0x38274000, 0x38278000, 0x3827C000,
  0x38280000, 0x38284000, 0x38288000, 0x3828C000, 0x38290000, 0x38294000, 0x38298000, 0x3829C000, 0x382A0000, 0x382A4000, 0x382A8000, 0x382AC000, 0x382B0000, 0x382B4000, 0x382B8000, 0x382BC000,
  0x382C0000, 0x382C4000, 0x382C8000, 0x382CC000, 0x382D0000, 0x382D4000, 0x382D8000, 0x382DC000, 0x382E0000, 0x382E4000, 0x382E8000, 0x382EC000, 0x382F0000, 0x382F4000, 0x382F8000, 0x382FC000,
  0x38300000, 0x38304000, 0x38308000, 0x3830C000, 0x38310000, 0x38314000, 0x38318000, 0x3831C000, 0x38320000, 0x38324000, 0x38328000, 0x3832C000, 0x38330000, 0x38334000, 0x38338000, 0x3833C000,
  0x38340000, 0x38344000, 0x38348000, 0x3834C000, 0x38350000, 0x38354000, 0x38358000, 0x3835C000, 0x38360000, 0x38364000, 0x38368000, 0x3836C000, 0x38370000, 0x38374000, 0x38378000, 0x3837C000,
  0x38380000, 0x38384000, 0x38388000, 0x3838C000, 0x38390000, 0x38394000, 0x38398000, 0x3839C000, 0x383A0000, 0x383A4000, 0x383A8000, 0x383AC000, 0x383B0000, 0x383B4000, 0x383B8000, 0x383BC000,
  0x383C0000, 0x383C4000, 0x383C8000, 0x383CC000, 0x383D0000, 0x383D4000, 0x383D8000, 0x383DC000, 0x383E0000, 0x383E4000, 0x383E8000, 0x383EC000, 0x383F0000, 0x383F4000, 0x383F8000, 0x383FC000,
  0x38400000, 0x38404000, 0x38408000, 0x3840C000, 0x38410000, 0x38414000, 0x38418000, 0x3841C000, 0x38420000, 0x38424000, 0x38428000, 0x3842C000, 0x38430000, 0x38434000, 0x38438000, 0x3843C000,
  0x38440000, 0x38444000, 0x38448000, 0x3844C000, 0x38450000, 0x38454000, 0x38458000, 0x3845C000, 0x38460000, 0x38464000, 0x38468000, 0x3846C000, 0x38470000, 0x38474000, 0x38478000, 0x3847C000,
  0x38480000, 0x38484000, 0x38488000, 0x3848C000, 0x38490000, 0x38494000, 0x38498000, 0x3849C000, 0x384A0000, 0x384A4000, 0x384A8000, 0x384AC000, 0x384B0000, 0x384B4000, 0x384B8000, 0x384BC000,
  0x384C0000, 0x384C4000, 0x384C8000, 0x384CC000, 0x384D0000, 0x384D4000, 0x384D8000, 0x384DC000, 0x384E0000, 0x384E4000, 0x384E8000, 0x384EC000, 0x384F0000, 0x384F4000, 0x384F8000, 0x384FC000,
  0x38500000, 0x38504000, 0x38508000, 0x3850C000, 0x38510000, 0x38514000, 0x38518000, 0x3851C000, 0x38520000, 0x38524000, 0x38528000, 0x3852C000, 0x38530000, 0x38534000, 0x38538000, 0x3853C000,
  0x38540000, 0x38544000, 0x38548000, 0x3854C000, 0x38550000, 0x38554000, 0x38558000, 0x3855C000, 0x38560000, 0x38564000, 0x38568000, 0x3856C000, 0x38570000, 0x38574000, 0x38578000, 0x3857C000,
  0x38580000, 0x38584000, 0x38588000, 0x3858C000, 0x38590000, 0x38594000, 0x38598000, 0x3859C000, 0x385A0000, 0x385A4000, 0x385A8000, 0x385AC000, 0x385B0000, 0x385B4000, 0x385B8000, 0x385BC000,
  0x385C0000, 0x385C4000, 0x385C8000, 0x385CC000, 0x385D0000, 0x385D4000, 0x385D8000, 0x385DC000, 0x385E0000, 0x385E4000, 0x385E8000, 0x385EC000, 0x385F0000, 0x385F4000, 0x385F8000, 0x385FC000,
  0x38600000, 0x38604000, 0x38608000, 0x3860C000, 0x38610000, 0x38614000, 0x38618000, 0x3861C000, 0x38620000, 0x38624000, 0x38628000, 0x3862C000, 0x38630000, 0x38634000, 0x38638000, 0x3863C000,
  0x38640000, 0x38644000, 0x38648000, 0x3864C000, 0x38650000, 0x38654000, 0x38658000, 0x3865C000, 0x38660000, 0x38664000, 0x38668000, 0x3866C000, 0x38670000, 0x38674000, 0x38678000, 0x3867C000,
  0x38680000, 0x38684000, 0x38688000, 0x3868C000, 0x38690000, 0x38694000, 0x38698000, 0x3869C000, 0x386A0000, 0x386A4000, 0x386A8000, 0x386AC000, 0x386B0000, 0x386B4000, 0x386B8000, 0x386BC000,
  0x386C0000, 0x386C4000, 0x386C8000, 0x386CC000, 0x386D0000, 0x386D4000, 0x386D8000, 0x386DC000, 0x386E0000, 0x386E4000, 0x386E8000, 0x386EC000, 0x386F0000, 0x386F4000, 0x386F8000, 0x386FC000,
  0x38700000, 0x38704000, 0x38708000, 0x3870C000, 0x38710000, 0x38714000, 0x38718000, 0x3871C000, 0x38720000, 0x38724000, 0x38728000, 0x3872C000, 0x38730000, 0x38734000, 0x38738000, 0x3873C000,
  0x38740000, 0x38744000, 0x38748000, 0x3874C000, 0x38750000, 0x38754000, 0x38758000, 0x3875C000, 0x38760000, 0x38764000, 0x38768000, 0x3876C000, 0x38770000, 0x38774000, 0x38778000, 0x3877C000,
  0x38780000, 0x38784000, 0x38788000, 0x3878C000, 0x38790000, 0x38794000, 0x38798000, 0x3879C000, 0x387A0000, 0x387A4000, 0x387A8000, 0x387AC000, 0x387B0000, 0x387B4000, 0x387B8000, 0x387BC000,
  0x387C0000, 0x387C4000, 0x387C8000, 0x387CC000, 0x387D0000, 0x387D4000, 0x387D8000, 0x387DC000, 0x387E0000, 0x387E4000, 0x387E8000, 0x387EC000, 0x387F0000, 0x387F4000, 0x387F8000, 0x387FC000,
  0x38000000, 0x38002000, 0x38004000, 0x38006000, 0x38008000, 0x3800A000, 0x3800C000, 0x3800E000, 0x38010000, 0x38012000, 0x38014000, 0x38016000, 0x38018000, 0x3801A000, 0x3801C000, 0x3801E000,
  0x38020000, 0x38022000, 0x38024000, 0x38026000, 0x38028000, 0x3802A000, 0x3802C000, 0x3802E000, 0x38030000, 0x38032000, 0x38034000, 0x38036000, 0x38038000, 0x3803A000, 0x3803C000, 0x3803E000,
  0x38040000, 0x38042000, 0x38044000, 0x38046000, 0x38048000, 0x3804A000, 0x3804C000, 0x3804E000, 0x38050000, 0x38052000, 0x38054000, 0x38056000, 0x38058000, 0x3805A000, 0x3805C000, 0x3805E000,
  0x38060000, 0x38062000, 0x38064000, 0x38066000, 0x38068000, 0x3806A000, 0x3806C000, 0x3806E000, 0x38070000, 0x38072000, 0x38074000, 0x38076000, 0x38078000, 0x3807A000, 0x3807C000, 0x3807E000,
  0x38080000, 0x38082000, 0x38084000, 0x38086000, 0x38088000, 0x3808A000, 0x3808C000, 0x3808E000, 0x38090000, 0x38092000, 0x38094000, 0x38096000, 0x38098000, 0x3809A000, 0x3809C000, 0x3809E000,
  0x380A0000, 0x380A2000, 0x380A4000, 0x380A6000, 0x380A8000, 0x380AA000, 0x380AC000, 0x380AE000, 0x380B0000, 0x380B2000, 0x380B4000, 0x380B6000, 0x380B8000, 0x380BA000, 0x380BC000, 0x380BE000,
  0x380C0000, 0x380C2000, 0x380C4000, 0x380C6000, 0x380C8000, 0x380CA000, 0x380CC000, 0x380CE000, 0x380D0000, 0x380D2000, 0x380D4000, 0x380D6000, 0x380D8000, 0x380DA000, 0x380DC000, 0x380DE000,
  0x380E0000, 0x380E2000, 0x380E4000, 0x380E6000, 0x380E8000, 0x380EA000, 0x380EC000, 0x380EE000, 0x380F0000, 0x380F2000, 0x380F4000, 0x380F6000, 0x380F8000, 0x380FA000, 0x380FC000, 0x380FE000,
  0x38100000, 0x38102000, 0x38104000, 0x38106000, 0x38108000, 0x3810A000, 0x3810C000, 0x3810E000, 0x38110000, 0x38112000, 0x38114000, 0x38116000, 0x38118000, 0x3811A000, 0x3811C000, 0x3811E000,
  0x38120000, 0x38122000, 0x38124000, 0x38126000, 0x38128000, 0x3812A000, 0x3812C000, 0x3812E000, 0x38130000, 0x38132000, 0x38134000, 0x38136000, 0x38138000, 0x3813A000, 0x3813C000, 0x3813E000,
  0x38140000, 0x38142000, 0x38144000, 0x38146000, 0x38148000, 0x3814A000, 0x3814C000, 0x3814E000, 0x38150000, 0x38152000, 0x38154000, 0x38156000, 0x38158000, 0x3815A000, 0x3815C000, 0x3815E000,
  0x38160000, 0x38162000, 0x38164000, 0x38166000, 0x38168000, 0x3816A000, 0x3816C000, 0x3816E000, 0x38170000, 0x38172000, 0x38174000, 0x38176000, 0x38178000, 0x3817A000, 0x3817C000, 0x3817E000,
  0x38180000, 0x38182000, 0x38184000, 0x38186000, 0x38188000, 0x3818A000, 0x3818C000, 0x3818E000, 0x38190000, 0x38192000, 0x38194000, 0x38196000, 0x38198000, 0x3819A000, 0x3819C000, 0x3819E000,
  0x381A0000, 0x381A2000, 0x381A4000, 0x381A6000, 0x381A8000, 0x381AA000, 0x381AC000, 0x381AE000, 0x381B0000, 0x381B2000, 0x381B4000, 0x381B6000, 0x381B8000, 0x381BA000, 0x381BC000, 0x381BE000,
  0x381C0000, 0x381C2000, 0x381C4000, 0x381C6000, 0x381C8000, 0x381CA000, 0x381CC000, 0x381CE000, 0x381D0000, 0x381D2000, 0x381D4000, 0x381D6000, 0x381D8000, 0x381DA000, 0x381DC000, 0x381DE000,
  0x381E0000, 0x381E2000, 0x381E4000, 0x381E6000, 0x381E8000, 0x381EA000, 0x381EC000, 0x381EE000, 0x381F0000, 0x381F2000, 0x381F4000, 0x381F6000, 0x381F8000, 0x381FA000, 0x381FC000, 0x381FE000,
  0x38200000, 0x38202000, 0x38204000, 0x38206000, 0x38208000, 0x3820A000, 0x3820C000, 0x3820E000, 0x38210000, 0x38212000, 0x38214000, 0x38216000, 0x38218000, 0x3821A000, 0x3821C000, 0x3821E000,
  0x38220000, 0x38222000, 0x38224000, 0x38226000, 0x38228000, 0x3822A000, 0x3822C000, 0x3822E000, 0x38230000, 0x38232000, 0x38234000, 0x38236000, 0x38238000, 0x3823A000, 0x3823C000, 0x3823E000,
  0x38240000, 0x38242000, 0x38244000, 0x38246000, 0x38248000, 0x3824A000, 0x3824C000, 0x3824E000, 0x38250000, 0x38252000, 0x38254000, 0x38256000, 0x38258000, 0x3825A000, 0x3825C000, 0x3825E000,
  0x38260000, 0x38262000, 0x38264000, 0x38266000, 0x38268000, 0x3826A000, 0x3826C000, 0x3826E000, 0x38270000, 0x38272000, 0x38274000, 0x38276000, 0x38278000, 0x3827A000, 0x3827C000, 0x3827E000,
  0x38280000, 0x38282000, 0x38284000, 0x38286000, 0x38288000, 0x3828A000, 0x3828C000, 0x3828E000, 0x38290000, 0x38292000, 0x38294000, 0x38296000, 0x38298000, 0x3829A000, 0x3829C000, 0x3829E000,
  0x382A0000, 0x382A2000, 0x382A4000, 0x382A6000, 0x382A8000, 0x382AA000, 0x382AC000, 0x382AE000, 0x382B0000, 0x382B2000, 0x382B4000, 0x382B6000, 0x382B8000, 0x382BA000, 0x382BC000, 0x382BE000,
  0x382C0000, 0x382C2000, 0x382C4000, 0x382C6000, 0x382C8000, 0x382CA000, 0x382CC000, 0x382CE000, 0x382D0000, 0x382D2000, 0x382D4000, 0x382D6000, 0x382D8000, 0x382DA000, 0x382DC000, 0x382DE000,
  0x382E0000, 0x382E2000, 0x382E4000, 0x382E6000, 0x382E8000, 0x382EA000, 0x382EC000, 0x382EE000, 0x382F0000, 0x382F2000, 0x382F4000, 0x382F6000, 0x382F8000, 0x382FA000, 0x382FC000, 0x382FE000,
  0x38300000, 0x38302000, 0x38304000, 0x38306000, 0x38308000, 0x3830A000, 0x3830C000, 0x3830E000, 0x38310000, 0x38312000, 0x38314000, 0x38316000, 0x38318000, 0x3831A000, 0x3831C000, 0x3831E000,
  0x38320000, 0x38322000, 0x38324000, 0x38326000, 0x38328000, 0x3832A000, 0x3832C000, 0x3832E000, 0x38330000, 0x38332000, 0x38334000, 0x38336000, 0x38338000, 0x3833A000, 0x3833C000, 0x3833E000,
  0x38340000, 0x38342000, 0x38344000, 0x38346000, 0x38348000, 0x3834A000, 0x3834C000, 0x3834E000, 0x38350000, 0x38352000, 0x38354000, 0x38356000, 0x38358000, 0x3835A000, 0x3835C000, 0x3835E000,
  0x38360000, 0x38362000, 0x38364000, 0x38366000, 0x38368000, 0x3836A000, 0x3836C000, 0x3836E000, 0x38370000, 0x38372000, 0x38374000, 0x38376000, 0x38378000, 0x3837A000, 0x3837C000, 0x3837E000,
  0x38380000, 0x38382000, 0x38384000, 0x38386000, 0x38388000, 0x3838A000, 0x3838C000, 0x3838E000, 0x38390000, 0x38392000, 0x38394000, 0x38396000, 0x38398000, 0x3839A000, 0x3839C000, 0x3839E000,
  0x383A0000, 0x383A2000, 0x383A4000, 0x383A6000, 0x383A8000, 0x383AA000, 0x383AC000, 0x383AE000, 0x383B0000, 0x383B2000, 0x383B4000, 0x383B6000, 0x383B8000, 0x383BA000, 0x383BC000, 0x383BE000,
  0x383C0000, 0x383C2000, 0x383C4000, 0x383C6000, 0x383C8000, 0x383CA000, 0x383CC000, 0x383CE000, 0x383D0000, 0x383D2000, 0x383D4000, 0x383D6000, 0x383D8000, 0x383DA000, 0x383DC000, 0x383DE000,
  0x383E0000, 0x383E2000, 0x383E4000, 0x383E6000, 0x383E8000, 0x383EA000, 0x383EC000, 0x383EE000, 0x383F0000, 0x383F2000, 0x383F4000, 0x383F6000, 0x383F8000, 0x383FA000, 0x383FC000, 0x383FE000,
  0x38400000, 0x38402000, 0x38404000, 0x38406000, 0x38408000, 0x3840A000, 0x3840C000, 0x3840E000, 0x38410000, 0x38412000, 0x38414000, 0x38416000, 0x38418000, 0x3841A000, 0x3841C000, 0x3841E000,
  0x38420000, 0x38422000, 0x38424000, 0x38426000, 0x38428000, 0x3842A000, 0x3842C000, 0x3842E000, 0x38430000, 0x38432000, 0x38434000, 0x38436000, 0x38438000, 0x3843A000, 0x3843C000, 0x3843E000,
  0x38440000, 0x38442000, 0x38444000, 0x38446000, 0x38448000, 0x3844A000, 0x3844C000, 0x3844E000, 0x38450000, 0x38452000, 0x38454000, 0x38456000, 0x38458000, 0x3845A000, 0x3845C000, 0x3845E000,
  0x38460000, 0x38462000, 0x38464000, 0x38466000, 0x38468000, 0x3846A000, 0x3846C000, 0x3846E000, 0x38470000, 0x38472000, 0x38474000, 0x38476000, 0x38478000, 0x3847A000, 0x3847C000, 0x3847E000,
  0x38480000, 0x38482000, 0x38484000, 0x38486000, 0x38488000, 0x3848A000, 0x3848C000, 0x3848E000, 0x38490000, 0x38492000, 0x38494000, 0x38496000, 0x38498000, 0x3849A000, 0x3849C000, 0x3849E000,
  0x384A0000, 0x384A2000, 0x384A4000, 0x384A6000, 0x384A8000, 0x384AA000, 0x384AC000, 0x384AE000, 0x384B0000, 0x384B2000, 0x384B4000, 0x384B6000, 0x384B8000, 0x384BA000, 0x384BC000, 0x384BE000,
  0x384C0000, 0x384C2000, 0x384C4000, 0x384C6000, 0x384C8000, 0x384CA000, 0x384CC000, 0x384CE000, 0x384D0000, 0x384D2000, 0x384D4000, 0x384D6000, 0x384D8000, 0x384DA000, 0x384DC000, 0x384DE000,
  0x384E0000, 0x384E2000, 0x384E4000, 0x384E6000, 0x384E8000, 0x384EA000, 0x384EC000, 0x384EE000, 0x384F0000, 0x384F2000, 0x384F4000, 0x384F6000, 0x384F8000, 0x384FA000, 0x384FC000, 0x384FE000,
  0x38500000, 0x38502000, 0x38504000, 0x38506000, 0x38508000, 0x3850A000, 0x3850C000, 0x3850E000, 0x38510000, 0x38512000, 0x38514000, 0x38516000, 0x38518000, 0x3851A000, 0x3851C000, 0x3851E000,
  0x38520000, 0x38522000, 0x38524000, 0x38526000, 0x38528000, 0x3852A000, 0x3852C000, 0x3852E000, 0x38530000, 0x38532000, 0x38534000, 0x38536000, 0x38538000, 0x3853A000, 0x3853C000, 0x3853E000,
  0x38540000, 0x38542000, 0x38544000, 0x38546000, 0x38548000, 0x3854A000, 0x3854C000, 0x3854E000, 0x38550000, 0x38552000, 0x38554000, 0x38556000, 0x38558000, 0x3855A000, 0x3855C000, 0x3855E000,
  0x38560000, 0x38562000, 0x38564000, 0x38566000, 0x38568000, 0x3856A000, 0x3856C000, 0x3856E000, 0x38570000, 0x38572000, 0x38574000, 0x38576000, 0x38578000, 0x3857A000, 0x3857C000, 0x3857E000,
  0x38580000, 0x38582000, 0x38584000, 0x38586000, 0x38588000, 0x3858A000, 0x3858C000, 0x3858E000, 0x38590000, 0x38592000, 0x38594000, 0x38596000, 0x38598000, 0x3859A000, 0x3859C000, 0x3859E000,
  0x385A0000, 0x385A2000, 0x385A4000, 0x385A6000, 0x385A8000, 0x385AA000, 0x385AC000, 0x385AE000, 0x385B0000, 0x385B2000, 0x385B4000, 0x385B6000, 0x385B8000, 0x385BA000, 0x385BC000, 0x385BE000,
  0x385C0000, 0x385C2000, 0x385C4000, 0x385C6000, 0x385C8000, 0x385CA000, 0x385CC000, 0x385CE000, 0x385D0000, 0x385D2000, 0x385D4000, 0x385D6000, 0x385D8000, 0x385DA000, 0x385DC000, 0x385DE000,
  0x385E0000, 0x385E2000, 0x385E4000, 0x385E6000, 0x385E8000, 0x385EA000, 0x385EC000, 0x385EE000, 0x385F0000, 0x385F2000, 0x385F4000, 0x385F6000, 0x385F8000, 0x385FA000, 0x385FC000, 0x385FE000,
  0x38600000, 0x38602000, 0x38604000, 0x38606000, 0x38608000, 0x3860A000, 0x3860C000, 0x3860E000, 0x38610000, 0x38612000, 0x38614000, 0x38616000, 0x38618000, 0x3861A000, 0x3861C000, 0x3861E000,
  0x38620000, 0x38622000, 0x38624000, 0x38626000, 0x38628000, 0x3862A000, 0x3862C000, 0x3862E000, 0x38630000, 0x38632000, 0x38634000, 0x38636000, 0x38638000, 0x3863A000, 0x3863C000, 0x3863E000,
  0x38640000, 0x38642000, 0x38644000, 0x38646000, 0x38648000, 0x3864A000, 0x3864C000, 0x3864E000, 0x38650000, 0x38652000, 0x38654000, 0x38656000, 0x38658000, 0x3865A000, 0x3865C000, 0x3865E000,
  0x38660000, 0x38662000, 0x38664000, 0x38666000, 0x38668000, 0x3866A000, 0x3866C000, 0x3866E000, 0x38670000, 0x38672000, 0x38674000, 0x38676000, 0x38678000, 0x3867A000, 0x3867C000, 0x3867E000,
  0x38680000, 0x38682000, 0x38684000, 0x38686000, 0x38688000, 0x3868A000, 0x3868C000, 0x3868E000, 0x38690000, 0x38692000, 0x38694000, 0x38696000, 0x38698000, 0x3869A000, 0x3869C000, 0x3869E000,
  0x386A0000, 0x386A2000, 0x386A4000, 0x386A6000, 0x386A8000, 0x386AA000, 0x386AC000, 0x386AE000, 0x386B0000, 0x386B2000, 0x386B4000, 0x386B6000, 0x386B8000, 0x386BA000, 0x386BC000, 0x386BE000,
  0x386C0000, 0x386C2000, 0x386C4000, 0x386C6000, 0x386C8000, 0x386CA000, 0x386CC000, 0x386CE000, 0x386D0000, 0x386D2000, 0x386D4000, 0x386D6000, 0x386D8000, 0x386DA000, 0x386DC000, 0x386DE000,
  0x386E0000, 0x386E2000, 0x386E4000, 0x386E6000, 0x386E8000, 0x386EA000, 0x386EC000, 0x386EE000, 0x386F0000, 0x386F2000, 0x386F4000, 0x386F6000, 0x386F8000, 0x386FA000, 0x386FC000, 0x386FE000,
  0x38700000, 0x38702000, 0x38704000, 0x38706000, 0x38708000, 0x3870A000, 0x3870C000, 0x3870E000, 0x38710000, 0x38712000, 0x38714000, 0x38716000, 0x38718000, 0x3871A000, 0x3871C000, 0x3871E000,
  0x38720000, 0x38722000, 0x38724000, 0x38726000, 0x38728000, 0x3872A000, 0x3872C000, 0x3872E000, 0x38730000, 0x38732000, 0x38734000, 0x38736000, 0x38738000, 0x3873A000, 0x3873C000, 0x3873E000,
  0x38740000, 0x38742000, 0x38744000, 0x38746000, 0x38748000, 0x3874A000, 0x3874C000, 0x3874E000, 0x38750000, 0x38752000, 0x38754000, 0x38756000, 0x38758000, 0x3875A000, 0x3875C000, 0x3875E000,
  0x38760000, 0x38762000, 0x38764000, 0x38766000, 0x38768000, 0x3876A000, 0x3876C000, 0x3876E000, 0x38770000, 0x38772000, 0x38774000, 0x38776000, 0x38778000, 0x3877A000, 0x3877C000, 0x3877E000,
  0x38780000, 0x38782000, 0x38784000, 0x38786000, 0x38788000, 0x3878A000, 0x3878C000, 0x3878E000, 0x38790000, 0x38792000, 0x38794000, 0x38796000, 0x38798000, 0x3879A000, 0x3879C000, 0x3879E000,
  0x387A0000, 0x387A2000, 0x387A4000, 0x387A6000, 0x387A8000, 0x387AA000, 0x387AC000, 0x387AE000, 0x387B0000, 0x387B2000, 0x387B4000, 0x387B6000, 0x387B8000, 0x387BA000, 0x387BC000, 0x387BE000,
  0x387C0000, 0x387C2000, 0x387C4000, 0x387C6000, 0x387C8000, 0x387CA000, 0x387CC000, 0x387CE000, 0x387D0000, 0x387D2000, 0x387D4000, 0x387D6000, 0x387D8000, 0x387DA000, 0x387DC000, 0x387DE000,
  0x387E0000, 0x387E2000, 0x387E4000, 0x387E6000, 0x387E8000, 0x387EA000, 0x387EC000, 0x387EE000, 0x387F0000, 0x387F2000, 0x387F4000, 0x387F6000, 0x387F8000, 0x387FA000, 0x387FC000, 0x387FE000 };
__constant static const uint32_t exponent_table[64] = {
  0x00000000, 0x00800000, 0x01000000, 0x01800000, 0x02000000, 0x02800000, 0x03000000, 0x03800000, 0x04000000, 0x04800000, 0x05000000, 0x05800000, 0x06000000, 0x06800000, 0x07000000, 0x07800000,
  0x08000000, 0x08800000, 0x09000000, 0x09800000, 0x0A000000, 0x0A800000, 0x0B000000, 0x0B800000, 0x0C000000, 0x0C800000, 0x0D000000, 0x0D800000, 0x0E000000, 0x0E800000, 0x0F000000, 0x47800000,
  0x80000000, 0x80800000, 0x81000000, 0x81800000, 0x82000000, 0x82800000, 0x83000000, 0x83800000, 0x84000000, 0x84800000, 0x85000000, 0x85800000, 0x86000000, 0x86800000, 0x87000000, 0x87800000,
  0x88000000, 0x88800000, 0x89000000, 0x89800000, 0x8A000000, 0x8A800000, 0x8B000000, 0x8B800000, 0x8C000000, 0x8C800000, 0x8D000000, 0x8D800000, 0x8E000000, 0x8E800000, 0x8F000000, 0xC7800000 };
__constant static const unsigned short offset_table[64] = {
  0, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024,
  0, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024 };

SCALAR_FUN_ATTR uint16_t float2halfbits(float value) {
  union { float x; uint32_t y; } u;
  u.x = value;
  uint32_t bits = u.y;

  uint16_t hbits = base_table[bits>>23] + (uint16_t)((bits&0x7FFFFF)>>shift_table[bits>>23]);;

  return hbits;
}

SCALAR_FUN_ATTR float halfbits2float(uint16_t value) {
  uint32_t bits = mantissa_table[offset_table[value>>10]+(value&0x3FF)] + exponent_table[value>>10];

  union { uint32_t x; float y; } u;
  u.x = bits;
  return u.y;
}

SCALAR_FUN_ATTR uint16_t halfbitsnextafter(uint16_t from, uint16_t to) {
  int fabs = from & 0x7FFF, tabs = to & 0x7FFF;
  if(fabs > 0x7C00 || tabs > 0x7C00) {
    return ((from&0x7FFF)>0x7C00) ? (from|0x200) : (to|0x200);
  }
  if(from == to || !(fabs|tabs)) {
    return to;
  }
  if(!fabs) {
    return (to&0x8000)+1;
  }
  unsigned int out =
    from +
    (((from>>15)^(unsigned int)((from^(0x8000|(0x8000-(from>>15))))<(to^(0x8000|(0x8000-(to>>15))))))<<1)
    - 1;
  return out;
}

// End of half.h.
// Start of timing.h.

// The function get_wall_time() returns the wall time in microseconds
// (with an unspecified offset).

#ifdef _WIN32

#include <windows.h>

static int64_t get_wall_time(void) {
  LARGE_INTEGER time,freq;
  assert(QueryPerformanceFrequency(&freq));
  assert(QueryPerformanceCounter(&time));
  return ((double)time.QuadPart / freq.QuadPart) * 1000000;
}

static int64_t get_wall_time_ns(void) {
  return get_wall_time() * 1000;
}

#else
// Assuming POSIX

#include <time.h>
#include <sys/time.h>

static int64_t get_wall_time(void) {
  struct timeval time;
  assert(gettimeofday(&time,NULL) == 0);
  return time.tv_sec * 1000000 + time.tv_usec;
}

static int64_t get_wall_time_ns(void) {
  struct timespec time;
  assert(clock_gettime(CLOCK_REALTIME, &time) == 0);
  return time.tv_sec * 1000000000 + time.tv_nsec;
}

#endif

// End of timing.h.
// Start of lock.h.

// A very simple cross-platform implementation of locks.  Uses
// pthreads on Unix and some Windows thing there.  Futhark's
// host-level code is not multithreaded, but user code may be, so we
// need some mechanism for ensuring atomic access to API functions.
// This is that mechanism.  It is not exposed to user code at all, so
// we do not have to worry about name collisions.

#ifdef _WIN32

typedef HANDLE lock_t;

static void create_lock(lock_t *lock) {
  *lock = CreateMutex(NULL,  // Default security attributes.
                      FALSE, // Initially unlocked.
                      NULL); // Unnamed.
}

static void lock_lock(lock_t *lock) {
  assert(WaitForSingleObject(*lock, INFINITE) == WAIT_OBJECT_0);
}

static void lock_unlock(lock_t *lock) {
  assert(ReleaseMutex(*lock));
}

static void free_lock(lock_t *lock) {
  CloseHandle(*lock);
}

#else
// Assuming POSIX

#include <pthread.h>

typedef pthread_mutex_t lock_t;

static void create_lock(lock_t *lock) {
  int r = pthread_mutex_init(lock, NULL);
  assert(r == 0);
}

static void lock_lock(lock_t *lock) {
  int r = pthread_mutex_lock(lock);
  assert(r == 0);
}

static void lock_unlock(lock_t *lock) {
  int r = pthread_mutex_unlock(lock);
  assert(r == 0);
}

static void free_lock(lock_t *lock) {
  // Nothing to do for pthreads.
  (void)lock;
}

#endif

// End of lock.h.
// Start of free_list.h.

typedef uintptr_t fl_mem;

// An entry in the free list.  May be invalid, to avoid having to
// deallocate entries as soon as they are removed.  There is also a
// tag, to help with memory reuse.
struct free_list_entry {
  size_t size;
  fl_mem mem;
  const char *tag;
  unsigned char valid;
};

struct free_list {
  struct free_list_entry *entries; // Pointer to entries.
  int capacity;                    // Number of entries.
  int used;                        // Number of valid entries.
  lock_t lock;                     // Thread safety.
};

static void free_list_init(struct free_list *l) {
  l->capacity = 30; // Picked arbitrarily.
  l->used = 0;
  l->entries = (struct free_list_entry*) malloc(sizeof(struct free_list_entry) * l->capacity);
  for (int i = 0; i < l->capacity; i++) {
    l->entries[i].valid = 0;
  }
  create_lock(&l->lock);
}

// Remove invalid entries from the free list.
static void free_list_pack(struct free_list *l) {
  lock_lock(&l->lock);
  int p = 0;
  for (int i = 0; i < l->capacity; i++) {
    if (l->entries[i].valid) {
      l->entries[p] = l->entries[i];
      if (i > p) {
        l->entries[i].valid = 0;
      }
      p++;
    }
  }

  // Now p is the number of used elements.  We don't want it to go
  // less than the default capacity (although in practice it's OK as
  // long as it doesn't become 1).
  if (p < 30) {
    p = 30;
  }
  l->entries = realloc(l->entries, p * sizeof(struct free_list_entry));
  l->capacity = p;
  lock_unlock(&l->lock);
}

static void free_list_destroy(struct free_list *l) {
  assert(l->used == 0);
  free(l->entries);
  free_lock(&l->lock);
}

// Not part of the interface, so no locking.
static int free_list_find_invalid(struct free_list *l) {
  int i;
  for (i = 0; i < l->capacity; i++) {
    if (!l->entries[i].valid) {
      break;
    }
  }
  return i;
}

static void free_list_insert(struct free_list *l, size_t size, fl_mem mem, const char *tag) {
  lock_lock(&l->lock);
  int i = free_list_find_invalid(l);

  if (i == l->capacity) {
    // List is full; so we have to grow it.
    int new_capacity = l->capacity * 2 * sizeof(struct free_list_entry);
    l->entries = realloc(l->entries, new_capacity);
    for (int j = 0; j < l->capacity; j++) {
      l->entries[j+l->capacity].valid = 0;
    }
    l->capacity *= 2;
  }

  // Now 'i' points to the first invalid entry.
  l->entries[i].valid = 1;
  l->entries[i].size = size;
  l->entries[i].mem = mem;
  l->entries[i].tag = tag;

  l->used++;
  lock_unlock(&l->lock);
}

// Determine whether this entry in the free list is acceptable for
// satisfying the request.  Not public, so no locking.
static bool free_list_acceptable(size_t size, const char* tag, struct free_list_entry *entry) {
  // We check not just the hard requirement (is the entry acceptable
  // and big enough?) but also put a cap on how much wasted space
  // (internal fragmentation) we allow.  This is necessarily a
  // heuristic, and a crude one.

  if (!entry->valid) {
    return false;
  }

  if (size > entry->size) {
    return false;
  }

  // We know the block fits.  Now the question is whether it is too
  // big.  Our policy is as follows:
  //
  // 1) We don't care about wasted space below 4096 bytes (to avoid
  // churn in tiny allocations).
  //
  // 2) If the tag matches, we allow _any_ amount of wasted space.
  //
  // 3) Otherwise we allow up to 50% wasted space.

  if (entry->size < 4096) {
    return true;
  }

  if (entry->tag == tag) {
    return true;
  }

  if (entry->size < size * 2) {
    return true;
  }

  return false;
}

// Find and remove a memory block of the indicated tag, or if that
// does not exist, another memory block with exactly the desired size.
// Returns 0 on success.
static int free_list_find(struct free_list *l, size_t size, const char *tag,
                          size_t *size_out, fl_mem *mem_out) {
  lock_lock(&l->lock);
  int size_match = -1;
  int i;
  int ret = 1;
  for (i = 0; i < l->capacity; i++) {
    if (free_list_acceptable(size, tag, &l->entries[i]) &&
        (size_match < 0 || l->entries[i].size < l->entries[size_match].size)) {
      // If this entry is valid, has sufficient size, and is smaller than the
      // best entry found so far, use this entry.
      size_match = i;
    }
  }

  if (size_match >= 0) {
    l->entries[size_match].valid = 0;
    *size_out = l->entries[size_match].size;
    *mem_out = l->entries[size_match].mem;
    l->used--;
    ret = 0;
  }
  lock_unlock(&l->lock);
  return ret;
}

// Remove the first block in the free list.  Returns 0 if a block was
// removed, and nonzero if the free list was already empty.
static int free_list_first(struct free_list *l, fl_mem *mem_out) {
  lock_lock(&l->lock);
  int ret = 1;
  for (int i = 0; i < l->capacity; i++) {
    if (l->entries[i].valid) {
      l->entries[i].valid = 0;
      *mem_out = l->entries[i].mem;
      l->used--;
      ret = 0;
      break;
    }
  }
  lock_unlock(&l->lock);
  return ret;
}

// End of free_list.h.
// Start of event_list.h

typedef int (*event_report_fn)(struct str_builder*, void*);

struct event {
  void* data;
  event_report_fn f;
  const char* name;
  char *description;
};

struct event_list {
  struct event *events;
  int num_events;
  int capacity;
};

static void event_list_init(struct event_list *l) {
  l->capacity = 100;
  l->num_events = 0;
  l->events = calloc(l->capacity, sizeof(struct event));
}

static void event_list_free(struct event_list *l) {
  free(l->events);
}

static void add_event_to_list(struct event_list *l,
                              const char* name,
                              char* description,
                              void* data,
                              event_report_fn f) {
  if (l->num_events == l->capacity) {
    l->capacity *= 2;
    l->events = realloc(l->events, l->capacity * sizeof(struct event));
  }
  l->events[l->num_events].name = name;
  l->events[l->num_events].description = description;
  l->events[l->num_events].data = data;
  l->events[l->num_events].f = f;
  l->num_events++;
}

static int report_events_in_list(struct event_list *l,
                                 struct str_builder* sb) {
  int ret = 0;
  for (int i = 0; i < l->num_events; i++) {
    if (i != 0) {
      str_builder_str(sb, ",");
    }
    str_builder_str(sb, "{\"name\":");
    str_builder_json_str(sb, l->events[i].name);
    str_builder_str(sb, ",\"description\":");
    str_builder_json_str(sb, l->events[i].description);
    free(l->events[i].description);
    if (l->events[i].f(sb, l->events[i].data) != 0) {
      ret = 1;
      break;
    }
    str_builder(sb, "}");
  }
  event_list_free(l);
  event_list_init(l);
  return ret;
}

// End of event_list.h

#ifdef _MSC_VER
#define inline __inline
#endif
#include <string.h>
#include <string.h>
#include <errno.h>
#include <assert.h>
#include <ctype.h>


#include <cuda.h>
#include <cuda_runtime.h>
#include <nvrtc.h>


#define FUTHARK_F64_ENABLED

// Start of scalar.h.

// Implementation of the primitive scalar operations.  Very
// repetitive.  This code is inserted directly into both CUDA and
// OpenCL programs, as well as the CPU code, so it has some #ifdefs to
// work everywhere.  Some operations are defined as macros because
// this allows us to use them as constant expressions in things like
// array sizes and static initialisers.

// Some of the #ifdefs are because OpenCL uses type-generic functions
// for some operations (e.g. sqrt), while C and CUDA sensibly use
// distinct functions for different precisions (e.g. sqrtf() and
// sqrt()).  This is quite annoying.  Due to C's unfortunate casting
// rules, it is also really easy to accidentally implement
// floating-point functions in the wrong precision, so be careful.

// Double-precision definitions are only included if the preprocessor
// macro FUTHARK_F64_ENABLED is set.

SCALAR_FUN_ATTR int32_t futrts_to_bits32(float x);
SCALAR_FUN_ATTR float futrts_from_bits32(int32_t x);

SCALAR_FUN_ATTR uint8_t add8(uint8_t x, uint8_t y) {
  return x + y;
}

SCALAR_FUN_ATTR uint16_t add16(uint16_t x, uint16_t y) {
  return x + y;
}

SCALAR_FUN_ATTR uint32_t add32(uint32_t x, uint32_t y) {
  return x + y;
}

SCALAR_FUN_ATTR uint64_t add64(uint64_t x, uint64_t y) {
  return x + y;
}

SCALAR_FUN_ATTR uint8_t sub8(uint8_t x, uint8_t y) {
  return x - y;
}

SCALAR_FUN_ATTR uint16_t sub16(uint16_t x, uint16_t y) {
  return x - y;
}

SCALAR_FUN_ATTR uint32_t sub32(uint32_t x, uint32_t y) {
  return x - y;
}

SCALAR_FUN_ATTR uint64_t sub64(uint64_t x, uint64_t y) {
  return x - y;
}

SCALAR_FUN_ATTR uint8_t mul8(uint8_t x, uint8_t y) {
  return x * y;
}

SCALAR_FUN_ATTR uint16_t mul16(uint16_t x, uint16_t y) {
  return x * y;
}

SCALAR_FUN_ATTR uint32_t mul32(uint32_t x, uint32_t y) {
  return x * y;
}

SCALAR_FUN_ATTR uint64_t mul64(uint64_t x, uint64_t y) {
  return x * y;
}

#if ISPC

SCALAR_FUN_ATTR uint8_t udiv8(uint8_t x, uint8_t y) {
  // This strange pattern is used to prevent the ISPC compiler from
  // causing SIGFPEs and bogus results on divisions where inactive lanes
  // have 0-valued divisors. It ensures that any inactive lane instead
  // has a divisor of 1. https://github.com/ispc/ispc/issues/2292
  uint8_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  return x / ys;
}

SCALAR_FUN_ATTR uint16_t udiv16(uint16_t x, uint16_t y) {
  uint16_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  return x / ys;
}

SCALAR_FUN_ATTR uint32_t udiv32(uint32_t x, uint32_t y) {
  uint32_t ys = 1;
  foreach_active(i){
    ys = y;
  }


  return x / ys;
}

SCALAR_FUN_ATTR uint64_t udiv64(uint64_t x, uint64_t y) {
  uint64_t ys = 1;
  foreach_active(i){
    ys = y;
  }


  return x / ys;
}

SCALAR_FUN_ATTR uint8_t udiv_up8(uint8_t x, uint8_t y) {
  uint8_t ys = 1;
  foreach_active(i){
    ys = y;
  }


  return (x + y - 1) / ys;
}

SCALAR_FUN_ATTR uint16_t udiv_up16(uint16_t x, uint16_t y) {
  uint16_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  return (x + y - 1) / ys;
}

SCALAR_FUN_ATTR uint32_t udiv_up32(uint32_t x, uint32_t y) {
  uint32_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  return (x + y - 1) / ys;
}

SCALAR_FUN_ATTR uint64_t udiv_up64(uint64_t x, uint64_t y) {
  uint64_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  return (x + y - 1) / ys;
}

SCALAR_FUN_ATTR uint8_t umod8(uint8_t x, uint8_t y) {
  uint8_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  return x % ys;
}

SCALAR_FUN_ATTR uint16_t umod16(uint16_t x, uint16_t y) {
  uint16_t ys = 1;
  foreach_active(i){
    ys = y;
  }


  return x % ys;
}

SCALAR_FUN_ATTR uint32_t umod32(uint32_t x, uint32_t y) {
  uint32_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  return x % ys;
}

SCALAR_FUN_ATTR uint64_t umod64(uint64_t x, uint64_t y) {
  uint64_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  return x % ys;
}

SCALAR_FUN_ATTR uint8_t udiv_safe8(uint8_t x, uint8_t y) {
  uint8_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  return y == 0 ? 0 : x / ys;
}

SCALAR_FUN_ATTR uint16_t udiv_safe16(uint16_t x, uint16_t y) {
  uint16_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  return y == 0 ? 0 : x / ys;
}

SCALAR_FUN_ATTR uint32_t udiv_safe32(uint32_t x, uint32_t y) {
  uint32_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  return y == 0 ? 0 : x / ys;
}

SCALAR_FUN_ATTR uint64_t udiv_safe64(uint64_t x, uint64_t y) {
  uint64_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  return y == 0 ? 0 : x / ys;
}

SCALAR_FUN_ATTR uint8_t udiv_up_safe8(uint8_t x, uint8_t y) {
  uint8_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  return y == 0 ? 0 : (x + y - 1) / ys;
}

SCALAR_FUN_ATTR uint16_t udiv_up_safe16(uint16_t x, uint16_t y) {
  uint16_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  return y == 0 ? 0 : (x + y - 1) / ys;
}

SCALAR_FUN_ATTR uint32_t udiv_up_safe32(uint32_t x, uint32_t y) {
  uint32_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  return y == 0 ? 0 : (x + y - 1) / ys;
}

SCALAR_FUN_ATTR uint64_t udiv_up_safe64(uint64_t x, uint64_t y) {
  uint64_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  return y == 0 ? 0 : (x + y - 1) / ys;
}

SCALAR_FUN_ATTR uint8_t umod_safe8(uint8_t x, uint8_t y) {
  uint8_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  return y == 0 ? 0 : x % ys;
}

SCALAR_FUN_ATTR uint16_t umod_safe16(uint16_t x, uint16_t y) {
  uint16_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  return y == 0 ? 0 : x % ys;
}

SCALAR_FUN_ATTR uint32_t umod_safe32(uint32_t x, uint32_t y) {
  uint32_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  return y == 0 ? 0 : x % ys;
}

SCALAR_FUN_ATTR uint64_t umod_safe64(uint64_t x, uint64_t y) {
  uint64_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  return y == 0 ? 0 : x % ys;
}

SCALAR_FUN_ATTR int8_t sdiv8(int8_t x, int8_t y) {
  int8_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  int8_t q = x / ys;
  int8_t r = x % ys;

  return q - ((r != 0 && r < 0 != y < 0) ? 1 : 0);
}

SCALAR_FUN_ATTR int16_t sdiv16(int16_t x, int16_t y) {
  int16_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  int16_t q = x / ys;
  int16_t r = x % ys;

  return q - ((r != 0 && r < 0 != y < 0) ? 1 : 0);
}

SCALAR_FUN_ATTR int32_t sdiv32(int32_t x, int32_t y) {
  int32_t ys = 1;
  foreach_active(i){
    ys = y;
  }
  int32_t q = x / ys;
  int32_t r = x % ys;

  return q - ((r != 0 && r < 0 != y < 0) ? 1 : 0);
}

SCALAR_FUN_ATTR int64_t sdiv64(int64_t x, int64_t y) {
  int64_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  int64_t q = x / ys;
  int64_t r = x % ys;

  return q - ((r != 0 && r < 0 != y < 0) ? 1 : 0);
}

SCALAR_FUN_ATTR int8_t sdiv_up8(int8_t x, int8_t y) {
  return sdiv8(x + y - 1, y);
}

SCALAR_FUN_ATTR int16_t sdiv_up16(int16_t x, int16_t y) {
  return sdiv16(x + y - 1, y);
}

SCALAR_FUN_ATTR int32_t sdiv_up32(int32_t x, int32_t y) {
  return sdiv32(x + y - 1, y);
}

SCALAR_FUN_ATTR int64_t sdiv_up64(int64_t x, int64_t y) {
  return sdiv64(x + y - 1, y);
}

SCALAR_FUN_ATTR int8_t smod8(int8_t x, int8_t y) {
  int8_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  int8_t r = x % ys;

  return r + (r == 0 || (x > 0 && y > 0) || (x < 0 && y < 0) ? 0 : y);
}

SCALAR_FUN_ATTR int16_t smod16(int16_t x, int16_t y) {
  int16_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  int16_t r = x % ys;

  return r + (r == 0 || (x > 0 && y > 0) || (x < 0 && y < 0) ? 0 : y);
}

SCALAR_FUN_ATTR int32_t smod32(int32_t x, int32_t y) {
  int32_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  int32_t r = x % ys;

  return r + (r == 0 || (x > 0 && y > 0) || (x < 0 && y < 0) ? 0 : y);
}

SCALAR_FUN_ATTR int64_t smod64(int64_t x, int64_t y) {
  int64_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  int64_t r = x % ys;

  return r + (r == 0 || (x > 0 && y > 0) || (x < 0 && y < 0) ? 0 : y);
}

SCALAR_FUN_ATTR int8_t sdiv_safe8(int8_t x, int8_t y) {
  return y == 0 ? 0 : sdiv8(x, y);
}

SCALAR_FUN_ATTR int16_t sdiv_safe16(int16_t x, int16_t y) {
  return y == 0 ? 0 : sdiv16(x, y);
}

SCALAR_FUN_ATTR int32_t sdiv_safe32(int32_t x, int32_t y) {
  return y == 0 ? 0 : sdiv32(x, y);
}

SCALAR_FUN_ATTR int64_t sdiv_safe64(int64_t x, int64_t y) {
  return y == 0 ? 0 : sdiv64(x, y);
}

SCALAR_FUN_ATTR int8_t sdiv_up_safe8(int8_t x, int8_t y) {
  return sdiv_safe8(x + y - 1, y);
}

SCALAR_FUN_ATTR int16_t sdiv_up_safe16(int16_t x, int16_t y) {
  return sdiv_safe16(x + y - 1, y);
}

SCALAR_FUN_ATTR int32_t sdiv_up_safe32(int32_t x, int32_t y) {
  return sdiv_safe32(x + y - 1, y);
}

SCALAR_FUN_ATTR int64_t sdiv_up_safe64(int64_t x, int64_t y) {
  return sdiv_safe64(x + y - 1, y);
}

SCALAR_FUN_ATTR int8_t smod_safe8(int8_t x, int8_t y) {
  return y == 0 ? 0 : smod8(x, y);
}

SCALAR_FUN_ATTR int16_t smod_safe16(int16_t x, int16_t y) {
  return y == 0 ? 0 : smod16(x, y);
}

SCALAR_FUN_ATTR int32_t smod_safe32(int32_t x, int32_t y) {
  return y == 0 ? 0 : smod32(x, y);
}

SCALAR_FUN_ATTR int64_t smod_safe64(int64_t x, int64_t y) {
  return y == 0 ? 0 : smod64(x, y);
}

SCALAR_FUN_ATTR int8_t squot8(int8_t x, int8_t y) {
  int8_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  return x / ys;
}

SCALAR_FUN_ATTR int16_t squot16(int16_t x, int16_t y) {
  int16_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  return x / ys;
}

SCALAR_FUN_ATTR int32_t squot32(int32_t x, int32_t y) {
  int32_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  return x / ys;
}

SCALAR_FUN_ATTR int64_t squot64(int64_t x, int64_t y) {
  int64_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  return x / ys;
}

SCALAR_FUN_ATTR int8_t srem8(int8_t x, int8_t y) {
  int8_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  return x % ys;
}

SCALAR_FUN_ATTR int16_t srem16(int16_t x, int16_t y) {
  int16_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  return x % ys;
}

SCALAR_FUN_ATTR int32_t srem32(int32_t x, int32_t y) {
  int32_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  return x % ys;
}

SCALAR_FUN_ATTR int64_t srem64(int64_t x, int64_t y) {
  int8_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  return x % ys;
}

SCALAR_FUN_ATTR int8_t squot_safe8(int8_t x, int8_t y) {
  int8_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  return y == 0 ? 0 : x / ys;
}

SCALAR_FUN_ATTR int16_t squot_safe16(int16_t x, int16_t y) {
  int16_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  return y == 0 ? 0 : x / ys;
}

SCALAR_FUN_ATTR int32_t squot_safe32(int32_t x, int32_t y) {
  int32_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  return y == 0 ? 0 : x / ys;
}

SCALAR_FUN_ATTR int64_t squot_safe64(int64_t x, int64_t y) {
  int64_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  return y == 0 ? 0 : x / ys;
}

SCALAR_FUN_ATTR int8_t srem_safe8(int8_t x, int8_t y) {
  int8_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  return y == 0 ? 0 : x % ys;
}

SCALAR_FUN_ATTR int16_t srem_safe16(int16_t x, int16_t y) {
  int16_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  return y == 0 ? 0 : x % ys;
}

SCALAR_FUN_ATTR int32_t srem_safe32(int32_t x, int32_t y) {
  int32_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  return y == 0 ? 0 : x % ys;
}

SCALAR_FUN_ATTR int64_t srem_safe64(int64_t x, int64_t y) {
  int64_t ys = 1;
  foreach_active(i){
    ys = y;
  }

  return y == 0 ? 0 : x % ys;
}

#else

SCALAR_FUN_ATTR uint8_t udiv8(uint8_t x, uint8_t y) {
  return x / y;
}

SCALAR_FUN_ATTR uint16_t udiv16(uint16_t x, uint16_t y) {
  return x / y;
}

SCALAR_FUN_ATTR uint32_t udiv32(uint32_t x, uint32_t y) {
  return x / y;
}

SCALAR_FUN_ATTR uint64_t udiv64(uint64_t x, uint64_t y) {
  return x / y;
}

SCALAR_FUN_ATTR uint8_t udiv_up8(uint8_t x, uint8_t y) {
  return (x + y - 1) / y;
}

SCALAR_FUN_ATTR uint16_t udiv_up16(uint16_t x, uint16_t y) {
  return (x + y - 1) / y;
}

SCALAR_FUN_ATTR uint32_t udiv_up32(uint32_t x, uint32_t y) {
  return (x + y - 1) / y;
}

SCALAR_FUN_ATTR uint64_t udiv_up64(uint64_t x, uint64_t y) {
  return (x + y - 1) / y;
}

SCALAR_FUN_ATTR uint8_t umod8(uint8_t x, uint8_t y) {
  return x % y;
}

SCALAR_FUN_ATTR uint16_t umod16(uint16_t x, uint16_t y) {
  return x % y;
}

SCALAR_FUN_ATTR uint32_t umod32(uint32_t x, uint32_t y) {
  return x % y;
}

SCALAR_FUN_ATTR uint64_t umod64(uint64_t x, uint64_t y) {
  return x % y;
}

SCALAR_FUN_ATTR uint8_t udiv_safe8(uint8_t x, uint8_t y) {
  return y == 0 ? 0 : x / y;
}

SCALAR_FUN_ATTR uint16_t udiv_safe16(uint16_t x, uint16_t y) {
  return y == 0 ? 0 : x / y;
}

SCALAR_FUN_ATTR uint32_t udiv_safe32(uint32_t x, uint32_t y) {
  return y == 0 ? 0 : x / y;
}

SCALAR_FUN_ATTR uint64_t udiv_safe64(uint64_t x, uint64_t y) {
  return y == 0 ? 0 : x / y;
}

SCALAR_FUN_ATTR uint8_t udiv_up_safe8(uint8_t x, uint8_t y) {
  return y == 0 ? 0 : (x + y - 1) / y;
}

SCALAR_FUN_ATTR uint16_t udiv_up_safe16(uint16_t x, uint16_t y) {
  return y == 0 ? 0 : (x + y - 1) / y;
}

SCALAR_FUN_ATTR uint32_t udiv_up_safe32(uint32_t x, uint32_t y) {
  return y == 0 ? 0 : (x + y - 1) / y;
}

SCALAR_FUN_ATTR uint64_t udiv_up_safe64(uint64_t x, uint64_t y) {
  return y == 0 ? 0 : (x + y - 1) / y;
}

SCALAR_FUN_ATTR uint8_t umod_safe8(uint8_t x, uint8_t y) {
  return y == 0 ? 0 : x % y;
}

SCALAR_FUN_ATTR uint16_t umod_safe16(uint16_t x, uint16_t y) {
  return y == 0 ? 0 : x % y;
}

SCALAR_FUN_ATTR uint32_t umod_safe32(uint32_t x, uint32_t y) {
  return y == 0 ? 0 : x % y;
}

SCALAR_FUN_ATTR uint64_t umod_safe64(uint64_t x, uint64_t y) {
  return y == 0 ? 0 : x % y;
}

SCALAR_FUN_ATTR int8_t sdiv8(int8_t x, int8_t y) {
  int8_t q = x / y;
  int8_t r = x % y;

  return q - ((r != 0 && r < 0 != y < 0) ? 1 : 0);
}

SCALAR_FUN_ATTR int16_t sdiv16(int16_t x, int16_t y) {
  int16_t q = x / y;
  int16_t r = x % y;

  return q - ((r != 0 && r < 0 != y < 0) ? 1 : 0);
}

SCALAR_FUN_ATTR int32_t sdiv32(int32_t x, int32_t y) {
  int32_t q = x / y;
  int32_t r = x % y;

  return q - ((r != 0 && r < 0 != y < 0) ? 1 : 0);
}

SCALAR_FUN_ATTR int64_t sdiv64(int64_t x, int64_t y) {
  int64_t q = x / y;
  int64_t r = x % y;

  return q - ((r != 0 && r < 0 != y < 0) ? 1 : 0);
}

SCALAR_FUN_ATTR int8_t sdiv_up8(int8_t x, int8_t y) {
  return sdiv8(x + y - 1, y);
}

SCALAR_FUN_ATTR int16_t sdiv_up16(int16_t x, int16_t y) {
  return sdiv16(x + y - 1, y);
}

SCALAR_FUN_ATTR int32_t sdiv_up32(int32_t x, int32_t y) {
  return sdiv32(x + y - 1, y);
}

SCALAR_FUN_ATTR int64_t sdiv_up64(int64_t x, int64_t y) {
  return sdiv64(x + y - 1, y);
}

SCALAR_FUN_ATTR int8_t smod8(int8_t x, int8_t y) {
  int8_t r = x % y;

  return r + (r == 0 || (x > 0 && y > 0) || (x < 0 && y < 0) ? 0 : y);
}

SCALAR_FUN_ATTR int16_t smod16(int16_t x, int16_t y) {
  int16_t r = x % y;

  return r + (r == 0 || (x > 0 && y > 0) || (x < 0 && y < 0) ? 0 : y);
}

SCALAR_FUN_ATTR int32_t smod32(int32_t x, int32_t y) {
  int32_t r = x % y;

  return r + (r == 0 || (x > 0 && y > 0) || (x < 0 && y < 0) ? 0 : y);
}

SCALAR_FUN_ATTR int64_t smod64(int64_t x, int64_t y) {
  int64_t r = x % y;

  return r + (r == 0 || (x > 0 && y > 0) || (x < 0 && y < 0) ? 0 : y);
}

SCALAR_FUN_ATTR int8_t sdiv_safe8(int8_t x, int8_t y) {
  return y == 0 ? 0 : sdiv8(x, y);
}

SCALAR_FUN_ATTR int16_t sdiv_safe16(int16_t x, int16_t y) {
  return y == 0 ? 0 : sdiv16(x, y);
}

SCALAR_FUN_ATTR int32_t sdiv_safe32(int32_t x, int32_t y) {
  return y == 0 ? 0 : sdiv32(x, y);
}

SCALAR_FUN_ATTR int64_t sdiv_safe64(int64_t x, int64_t y) {
  return y == 0 ? 0 : sdiv64(x, y);
}

SCALAR_FUN_ATTR int8_t sdiv_up_safe8(int8_t x, int8_t y) {
  return sdiv_safe8(x + y - 1, y);
}

SCALAR_FUN_ATTR int16_t sdiv_up_safe16(int16_t x, int16_t y) {
  return sdiv_safe16(x + y - 1, y);
}

SCALAR_FUN_ATTR int32_t sdiv_up_safe32(int32_t x, int32_t y) {
  return sdiv_safe32(x + y - 1, y);
}

SCALAR_FUN_ATTR int64_t sdiv_up_safe64(int64_t x, int64_t y) {
  return sdiv_safe64(x + y - 1, y);
}

SCALAR_FUN_ATTR int8_t smod_safe8(int8_t x, int8_t y) {
  return y == 0 ? 0 : smod8(x, y);
}

SCALAR_FUN_ATTR int16_t smod_safe16(int16_t x, int16_t y) {
  return y == 0 ? 0 : smod16(x, y);
}

SCALAR_FUN_ATTR int32_t smod_safe32(int32_t x, int32_t y) {
  return y == 0 ? 0 : smod32(x, y);
}

SCALAR_FUN_ATTR int64_t smod_safe64(int64_t x, int64_t y) {
  return y == 0 ? 0 : smod64(x, y);
}

SCALAR_FUN_ATTR int8_t squot8(int8_t x, int8_t y) {
  return x / y;
}

SCALAR_FUN_ATTR int16_t squot16(int16_t x, int16_t y) {
  return x / y;
}

SCALAR_FUN_ATTR int32_t squot32(int32_t x, int32_t y) {
  return x / y;
}

SCALAR_FUN_ATTR int64_t squot64(int64_t x, int64_t y) {
  return x / y;
}

SCALAR_FUN_ATTR int8_t srem8(int8_t x, int8_t y) {
  return x % y;
}

SCALAR_FUN_ATTR int16_t srem16(int16_t x, int16_t y) {
  return x % y;
}

SCALAR_FUN_ATTR int32_t srem32(int32_t x, int32_t y) {
  return x % y;
}

SCALAR_FUN_ATTR int64_t srem64(int64_t x, int64_t y) {
  return x % y;
}

SCALAR_FUN_ATTR int8_t squot_safe8(int8_t x, int8_t y) {
  return y == 0 ? 0 : x / y;
}

SCALAR_FUN_ATTR int16_t squot_safe16(int16_t x, int16_t y) {
  return y == 0 ? 0 : x / y;
}

SCALAR_FUN_ATTR int32_t squot_safe32(int32_t x, int32_t y) {
  return y == 0 ? 0 : x / y;
}

SCALAR_FUN_ATTR int64_t squot_safe64(int64_t x, int64_t y) {
  return y == 0 ? 0 : x / y;
}

SCALAR_FUN_ATTR int8_t srem_safe8(int8_t x, int8_t y) {
  return y == 0 ? 0 : x % y;
}

SCALAR_FUN_ATTR int16_t srem_safe16(int16_t x, int16_t y) {
  return y == 0 ? 0 : x % y;
}

SCALAR_FUN_ATTR int32_t srem_safe32(int32_t x, int32_t y) {
  return y == 0 ? 0 : x % y;
}

SCALAR_FUN_ATTR int64_t srem_safe64(int64_t x, int64_t y) {
  return y == 0 ? 0 : x % y;
}

#endif

SCALAR_FUN_ATTR int8_t smin8(int8_t x, int8_t y) {
  return x < y ? x : y;
}

SCALAR_FUN_ATTR int16_t smin16(int16_t x, int16_t y) {
  return x < y ? x : y;
}

SCALAR_FUN_ATTR int32_t smin32(int32_t x, int32_t y) {
  return x < y ? x : y;
}

SCALAR_FUN_ATTR int64_t smin64(int64_t x, int64_t y) {
  return x < y ? x : y;
}

SCALAR_FUN_ATTR uint8_t umin8(uint8_t x, uint8_t y) {
  return x < y ? x : y;
}

SCALAR_FUN_ATTR uint16_t umin16(uint16_t x, uint16_t y) {
  return x < y ? x : y;
}

SCALAR_FUN_ATTR uint32_t umin32(uint32_t x, uint32_t y) {
  return x < y ? x : y;
}

SCALAR_FUN_ATTR uint64_t umin64(uint64_t x, uint64_t y) {
  return x < y ? x : y;
}

SCALAR_FUN_ATTR int8_t smax8(int8_t x, int8_t y) {
  return x < y ? y : x;
}

SCALAR_FUN_ATTR int16_t smax16(int16_t x, int16_t y) {
  return x < y ? y : x;
}

SCALAR_FUN_ATTR int32_t smax32(int32_t x, int32_t y) {
  return x < y ? y : x;
}

SCALAR_FUN_ATTR int64_t smax64(int64_t x, int64_t y) {
  return x < y ? y : x;
}

SCALAR_FUN_ATTR uint8_t umax8(uint8_t x, uint8_t y) {
  return x < y ? y : x;
}

SCALAR_FUN_ATTR uint16_t umax16(uint16_t x, uint16_t y) {
  return x < y ? y : x;
}

SCALAR_FUN_ATTR uint32_t umax32(uint32_t x, uint32_t y) {
  return x < y ? y : x;
}

SCALAR_FUN_ATTR uint64_t umax64(uint64_t x, uint64_t y) {
  return x < y ? y : x;
}

SCALAR_FUN_ATTR uint8_t shl8(uint8_t x, uint8_t y) {
  return (uint8_t)(x << y);
}

SCALAR_FUN_ATTR uint16_t shl16(uint16_t x, uint16_t y) {
  return (uint16_t)(x << y);
}

SCALAR_FUN_ATTR uint32_t shl32(uint32_t x, uint32_t y) {
  return x << y;
}

SCALAR_FUN_ATTR uint64_t shl64(uint64_t x, uint64_t y) {
  return x << y;
}

SCALAR_FUN_ATTR uint8_t lshr8(uint8_t x, uint8_t y) {
  return x >> y;
}

SCALAR_FUN_ATTR uint16_t lshr16(uint16_t x, uint16_t y) {
  return x >> y;
}

SCALAR_FUN_ATTR uint32_t lshr32(uint32_t x, uint32_t y) {
  return x >> y;
}

SCALAR_FUN_ATTR uint64_t lshr64(uint64_t x, uint64_t y) {
  return x >> y;
}

SCALAR_FUN_ATTR int8_t ashr8(int8_t x, int8_t y) {
  return x >> y;
}

SCALAR_FUN_ATTR int16_t ashr16(int16_t x, int16_t y) {
  return x >> y;
}

SCALAR_FUN_ATTR int32_t ashr32(int32_t x, int32_t y) {
  return x >> y;
}

SCALAR_FUN_ATTR int64_t ashr64(int64_t x, int64_t y) {
  return x >> y;
}

SCALAR_FUN_ATTR uint8_t and8(uint8_t x, uint8_t y) {
  return x & y;
}

SCALAR_FUN_ATTR uint16_t and16(uint16_t x, uint16_t y) {
  return x & y;
}

SCALAR_FUN_ATTR uint32_t and32(uint32_t x, uint32_t y) {
  return x & y;
}

SCALAR_FUN_ATTR uint64_t and64(uint64_t x, uint64_t y) {
  return x & y;
}

SCALAR_FUN_ATTR uint8_t or8(uint8_t x, uint8_t y) {
  return x | y;
}

SCALAR_FUN_ATTR uint16_t or16(uint16_t x, uint16_t y) {
  return x | y;
}

SCALAR_FUN_ATTR uint32_t or32(uint32_t x, uint32_t y) {
  return x | y;
}

SCALAR_FUN_ATTR uint64_t or64(uint64_t x, uint64_t y) {
  return x | y;
}

SCALAR_FUN_ATTR uint8_t xor8(uint8_t x, uint8_t y) {
  return x ^ y;
}

SCALAR_FUN_ATTR uint16_t xor16(uint16_t x, uint16_t y) {
  return x ^ y;
}

SCALAR_FUN_ATTR uint32_t xor32(uint32_t x, uint32_t y) {
  return x ^ y;
}

SCALAR_FUN_ATTR uint64_t xor64(uint64_t x, uint64_t y) {
  return x ^ y;
}

SCALAR_FUN_ATTR bool ult8(uint8_t x, uint8_t y) {
  return x < y;
}

SCALAR_FUN_ATTR bool ult16(uint16_t x, uint16_t y) {
  return x < y;
}

SCALAR_FUN_ATTR bool ult32(uint32_t x, uint32_t y) {
  return x < y;
}

SCALAR_FUN_ATTR bool ult64(uint64_t x, uint64_t y) {
  return x < y;
}

SCALAR_FUN_ATTR bool ule8(uint8_t x, uint8_t y) {
  return x <= y;
}

SCALAR_FUN_ATTR bool ule16(uint16_t x, uint16_t y) {
  return x <= y;
}

SCALAR_FUN_ATTR bool ule32(uint32_t x, uint32_t y) {
  return x <= y;
}

SCALAR_FUN_ATTR bool ule64(uint64_t x, uint64_t y) {
  return x <= y;
}

SCALAR_FUN_ATTR bool slt8(int8_t x, int8_t y) {
  return x < y;
}

SCALAR_FUN_ATTR bool slt16(int16_t x, int16_t y) {
  return x < y;
}

SCALAR_FUN_ATTR bool slt32(int32_t x, int32_t y) {
  return x < y;
}

SCALAR_FUN_ATTR bool slt64(int64_t x, int64_t y) {
  return x < y;
}

SCALAR_FUN_ATTR bool sle8(int8_t x, int8_t y) {
  return x <= y;
}

SCALAR_FUN_ATTR bool sle16(int16_t x, int16_t y) {
  return x <= y;
}

SCALAR_FUN_ATTR bool sle32(int32_t x, int32_t y) {
  return x <= y;
}

SCALAR_FUN_ATTR bool sle64(int64_t x, int64_t y) {
  return x <= y;
}

SCALAR_FUN_ATTR uint8_t pow8(uint8_t x, uint8_t y) {
  uint8_t res = 1, rem = y;

  while (rem != 0) {
    if (rem & 1)
      res *= x;
    rem >>= 1;
    x *= x;
  }
  return res;
}

SCALAR_FUN_ATTR uint16_t pow16(uint16_t x, uint16_t y) {
  uint16_t res = 1, rem = y;

  while (rem != 0) {
    if (rem & 1)
      res *= x;
    rem >>= 1;
    x *= x;
  }
  return res;
}

SCALAR_FUN_ATTR uint32_t pow32(uint32_t x, uint32_t y) {
  uint32_t res = 1, rem = y;

  while (rem != 0) {
    if (rem & 1)
      res *= x;
    rem >>= 1;
    x *= x;
  }
  return res;
}

SCALAR_FUN_ATTR uint64_t pow64(uint64_t x, uint64_t y) {
  uint64_t res = 1, rem = y;

  while (rem != 0) {
    if (rem & 1)
      res *= x;
    rem >>= 1;
    x *= x;
  }
  return res;
}

SCALAR_FUN_ATTR bool itob_i8_bool(int8_t x) {
  return x != 0;
}

SCALAR_FUN_ATTR bool itob_i16_bool(int16_t x) {
  return x != 0;
}

SCALAR_FUN_ATTR bool itob_i32_bool(int32_t x) {
  return x != 0;
}

SCALAR_FUN_ATTR bool itob_i64_bool(int64_t x) {
  return x != 0;
}

SCALAR_FUN_ATTR int8_t btoi_bool_i8(bool x) {
  return x;
}

SCALAR_FUN_ATTR int16_t btoi_bool_i16(bool x) {
  return x;
}

SCALAR_FUN_ATTR int32_t btoi_bool_i32(bool x) {
  return x;
}

SCALAR_FUN_ATTR int64_t btoi_bool_i64(bool x) {
  return x;
}

#define sext_i8_i8(x) ((int8_t) (int8_t) (x))
#define sext_i8_i16(x) ((int16_t) (int8_t) (x))
#define sext_i8_i32(x) ((int32_t) (int8_t) (x))
#define sext_i8_i64(x) ((int64_t) (int8_t) (x))
#define sext_i16_i8(x) ((int8_t) (int16_t) (x))
#define sext_i16_i16(x) ((int16_t) (int16_t) (x))
#define sext_i16_i32(x) ((int32_t) (int16_t) (x))
#define sext_i16_i64(x) ((int64_t) (int16_t) (x))
#define sext_i32_i8(x) ((int8_t) (int32_t) (x))
#define sext_i32_i16(x) ((int16_t) (int32_t) (x))
#define sext_i32_i32(x) ((int32_t) (int32_t) (x))
#define sext_i32_i64(x) ((int64_t) (int32_t) (x))
#define sext_i64_i8(x) ((int8_t) (int64_t) (x))
#define sext_i64_i16(x) ((int16_t) (int64_t) (x))
#define sext_i64_i32(x) ((int32_t) (int64_t) (x))
#define sext_i64_i64(x) ((int64_t) (int64_t) (x))
#define zext_i8_i8(x) ((int8_t) (uint8_t) (x))
#define zext_i8_i16(x) ((int16_t) (uint8_t) (x))
#define zext_i8_i32(x) ((int32_t) (uint8_t) (x))
#define zext_i8_i64(x) ((int64_t) (uint8_t) (x))
#define zext_i16_i8(x) ((int8_t) (uint16_t) (x))
#define zext_i16_i16(x) ((int16_t) (uint16_t) (x))
#define zext_i16_i32(x) ((int32_t) (uint16_t) (x))
#define zext_i16_i64(x) ((int64_t) (uint16_t) (x))
#define zext_i32_i8(x) ((int8_t) (uint32_t) (x))
#define zext_i32_i16(x) ((int16_t) (uint32_t) (x))
#define zext_i32_i32(x) ((int32_t) (uint32_t) (x))
#define zext_i32_i64(x) ((int64_t) (uint32_t) (x))
#define zext_i64_i8(x) ((int8_t) (uint64_t) (x))
#define zext_i64_i16(x) ((int16_t) (uint64_t) (x))
#define zext_i64_i32(x) ((int32_t) (uint64_t) (x))
#define zext_i64_i64(x) ((int64_t) (uint64_t) (x))

SCALAR_FUN_ATTR int8_t abs8(int8_t x) {
  return (int8_t)abs(x);
}

SCALAR_FUN_ATTR int16_t abs16(int16_t x) {
  return (int16_t)abs(x);
}

SCALAR_FUN_ATTR int32_t abs32(int32_t x) {
  return abs(x);
}

SCALAR_FUN_ATTR int64_t abs64(int64_t x) {
#if defined(__OPENCL_VERSION__) || defined(ISPC)
  return abs(x);
#else
  return llabs(x);
#endif
}

#if defined(__OPENCL_VERSION__)
SCALAR_FUN_ATTR int32_t futrts_popc8(int8_t x) {
  return popcount(x);
}

SCALAR_FUN_ATTR int32_t futrts_popc16(int16_t x) {
  return popcount(x);
}

SCALAR_FUN_ATTR int32_t futrts_popc32(int32_t x) {
  return popcount(x);
}

SCALAR_FUN_ATTR int32_t futrts_popc64(int64_t x) {
  return popcount(x);
}
#elif defined(__CUDA_ARCH__)

SCALAR_FUN_ATTR int32_t futrts_popc8(int8_t x) {
  return __popc(zext_i8_i32(x));
}

SCALAR_FUN_ATTR int32_t futrts_popc16(int16_t x) {
  return __popc(zext_i16_i32(x));
}

SCALAR_FUN_ATTR int32_t futrts_popc32(int32_t x) {
  return __popc(x);
}

SCALAR_FUN_ATTR int32_t futrts_popc64(int64_t x) {
  return __popcll(x);
}

#else // Not OpenCL or CUDA, but plain C.

SCALAR_FUN_ATTR int32_t futrts_popc8(uint8_t x) {
  int c = 0;
  for (; x; ++c) { x &= x - 1; }
  return c;
}

SCALAR_FUN_ATTR int32_t futrts_popc16(uint16_t x) {
  int c = 0;
  for (; x; ++c) { x &= x - 1; }
  return c;
}

SCALAR_FUN_ATTR int32_t futrts_popc32(uint32_t x) {
  int c = 0;
  for (; x; ++c) { x &= x - 1; }
  return c;
}

SCALAR_FUN_ATTR int32_t futrts_popc64(uint64_t x) {
  int c = 0;
  for (; x; ++c) { x &= x - 1; }
  return c;
}
#endif

#if defined(__OPENCL_VERSION__)
SCALAR_FUN_ATTR uint8_t  futrts_umul_hi8 ( uint8_t a,  uint8_t b) { return mul_hi(a, b); }
SCALAR_FUN_ATTR uint16_t futrts_umul_hi16(uint16_t a, uint16_t b) { return mul_hi(a, b); }
SCALAR_FUN_ATTR uint32_t futrts_umul_hi32(uint32_t a, uint32_t b) { return mul_hi(a, b); }
SCALAR_FUN_ATTR uint64_t futrts_umul_hi64(uint64_t a, uint64_t b) { return mul_hi(a, b); }
SCALAR_FUN_ATTR uint8_t  futrts_smul_hi8 ( int8_t a,  int8_t b) { return mul_hi(a, b); }
SCALAR_FUN_ATTR uint16_t futrts_smul_hi16(int16_t a, int16_t b) { return mul_hi(a, b); }
SCALAR_FUN_ATTR uint32_t futrts_smul_hi32(int32_t a, int32_t b) { return mul_hi(a, b); }
SCALAR_FUN_ATTR uint64_t futrts_smul_hi64(int64_t a, int64_t b) { return mul_hi(a, b); }
#elif defined(__CUDA_ARCH__)
SCALAR_FUN_ATTR  uint8_t futrts_umul_hi8(uint8_t a, uint8_t b) { return ((uint16_t)a) * ((uint16_t)b) >> 8; }
SCALAR_FUN_ATTR uint16_t futrts_umul_hi16(uint16_t a, uint16_t b) { return ((uint32_t)a) * ((uint32_t)b) >> 16; }
SCALAR_FUN_ATTR uint32_t futrts_umul_hi32(uint32_t a, uint32_t b) { return __umulhi(a, b); }
SCALAR_FUN_ATTR uint64_t futrts_umul_hi64(uint64_t a, uint64_t b) { return __umul64hi(a, b); }
SCALAR_FUN_ATTR  uint8_t futrts_smul_hi8 ( int8_t a, int8_t b) { return ((int16_t)a) * ((int16_t)b) >> 8; }
SCALAR_FUN_ATTR uint16_t futrts_smul_hi16(int16_t a, int16_t b) { return ((int32_t)a) * ((int32_t)b) >> 16; }
SCALAR_FUN_ATTR uint32_t futrts_smul_hi32(int32_t a, int32_t b) { return __mulhi(a, b); }
SCALAR_FUN_ATTR uint64_t futrts_smul_hi64(int64_t a, int64_t b) { return __mul64hi(a, b); }
#elif ISPC
SCALAR_FUN_ATTR uint8_t futrts_umul_hi8(uint8_t a, uint8_t b) { return ((uint16_t)a) * ((uint16_t)b) >> 8; }
SCALAR_FUN_ATTR uint16_t futrts_umul_hi16(uint16_t a, uint16_t b) { return ((uint32_t)a) * ((uint32_t)b) >> 16; }
SCALAR_FUN_ATTR uint32_t futrts_umul_hi32(uint32_t a, uint32_t b) { return ((uint64_t)a) * ((uint64_t)b) >> 32; }
SCALAR_FUN_ATTR uint64_t futrts_umul_hi64(uint64_t a, uint64_t b) {
  uint64_t ah = a >> 32;
  uint64_t al = a & 0xffffffff;
  uint64_t bh = b >> 32;
  uint64_t bl = b & 0xffffffff;

  uint64_t p1 = al * bl;
  uint64_t p2 = al * bh;
  uint64_t p3 = ah * bl;
  uint64_t p4 = ah * bh;

  uint64_t p1h = p1 >> 32;
  uint64_t p2h = p2 >> 32;
  uint64_t p3h = p3 >> 32;
  uint64_t p2l = p2 & 0xffffffff;
  uint64_t p3l = p3 & 0xffffffff;

  uint64_t l = p1h + p2l + p3l;
  uint64_t m = (p2 >> 32) + (p3 >> 32);
  uint64_t h = (l >> 32) + m + p4;

  return h;
}
SCALAR_FUN_ATTR  int8_t futrts_smul_hi8 ( int8_t a,  int8_t b) { return ((uint16_t)a) * ((uint16_t)b) >> 8; }
SCALAR_FUN_ATTR int16_t futrts_smul_hi16(int16_t a, int16_t b) { return ((uint32_t)a) * ((uint32_t)b) >> 16; }
SCALAR_FUN_ATTR int32_t futrts_smul_hi32(int32_t a, int32_t b) { return ((uint64_t)a) * ((uint64_t)b) >> 32; }
SCALAR_FUN_ATTR int64_t futrts_smul_hi64(int64_t a, int64_t b) {
  uint64_t ah = a >> 32;
  uint64_t al = a & 0xffffffff;
  uint64_t bh = b >> 32;
  uint64_t bl = b & 0xffffffff;

  uint64_t p1 =  al * bl;
  int64_t  p2 = al * bh;
  int64_t  p3 = ah * bl;
  uint64_t p4 =  ah * bh;

  uint64_t p1h = p1 >> 32;
  uint64_t p2h = p2 >> 32;
  uint64_t p3h = p3 >> 32;
  uint64_t p2l = p2 & 0xffffffff;
  uint64_t p3l = p3 & 0xffffffff;

  uint64_t l = p1h + p2l + p3l;
  uint64_t m = (p2 >> 32) + (p3 >> 32);
  uint64_t h = (l >> 32) + m + p4;

  return h;
}

#else // Not OpenCL, ISPC, or CUDA, but plain C.
SCALAR_FUN_ATTR uint8_t futrts_umul_hi8(uint8_t a, uint8_t b) { return ((uint16_t)a) * ((uint16_t)b) >> 8; }
SCALAR_FUN_ATTR uint16_t futrts_umul_hi16(uint16_t a, uint16_t b) { return ((uint32_t)a) * ((uint32_t)b) >> 16; }
SCALAR_FUN_ATTR uint32_t futrts_umul_hi32(uint32_t a, uint32_t b) { return ((uint64_t)a) * ((uint64_t)b) >> 32; }
SCALAR_FUN_ATTR uint64_t futrts_umul_hi64(uint64_t a, uint64_t b) { return ((__uint128_t)a) * ((__uint128_t)b) >> 64; }
SCALAR_FUN_ATTR int8_t futrts_smul_hi8(int8_t a, int8_t b) { return ((int16_t)a) * ((int16_t)b) >> 8; }
SCALAR_FUN_ATTR int16_t futrts_smul_hi16(int16_t a, int16_t b) { return ((int32_t)a) * ((int32_t)b) >> 16; }
SCALAR_FUN_ATTR int32_t futrts_smul_hi32(int32_t a, int32_t b) { return ((int64_t)a) * ((int64_t)b) >> 32; }
SCALAR_FUN_ATTR int64_t futrts_smul_hi64(int64_t a, int64_t b) { return ((__int128_t)a) * ((__int128_t)b) >> 64; }
#endif

#if defined(__OPENCL_VERSION__)
SCALAR_FUN_ATTR  uint8_t futrts_umad_hi8 ( uint8_t a,  uint8_t b,  uint8_t c) { return mad_hi(a, b, c); }
SCALAR_FUN_ATTR uint16_t futrts_umad_hi16(uint16_t a, uint16_t b, uint16_t c) { return mad_hi(a, b, c); }
SCALAR_FUN_ATTR uint32_t futrts_umad_hi32(uint32_t a, uint32_t b, uint32_t c) { return mad_hi(a, b, c); }
SCALAR_FUN_ATTR uint64_t futrts_umad_hi64(uint64_t a, uint64_t b, uint64_t c) { return mad_hi(a, b, c); }
SCALAR_FUN_ATTR  uint8_t futrts_smad_hi8( int8_t a,  int8_t b,   int8_t c) { return mad_hi(a, b, c); }
SCALAR_FUN_ATTR uint16_t futrts_smad_hi16(int16_t a, int16_t b, int16_t c) { return mad_hi(a, b, c); }
SCALAR_FUN_ATTR uint32_t futrts_smad_hi32(int32_t a, int32_t b, int32_t c) { return mad_hi(a, b, c); }
SCALAR_FUN_ATTR uint64_t futrts_smad_hi64(int64_t a, int64_t b, int64_t c) { return mad_hi(a, b, c); }
#else // Not OpenCL

SCALAR_FUN_ATTR  uint8_t futrts_umad_hi8( uint8_t a,  uint8_t b,  uint8_t c) { return futrts_umul_hi8(a, b) + c; }
SCALAR_FUN_ATTR uint16_t futrts_umad_hi16(uint16_t a, uint16_t b, uint16_t c) { return futrts_umul_hi16(a, b) + c; }
SCALAR_FUN_ATTR uint32_t futrts_umad_hi32(uint32_t a, uint32_t b, uint32_t c) { return futrts_umul_hi32(a, b) + c; }
SCALAR_FUN_ATTR uint64_t futrts_umad_hi64(uint64_t a, uint64_t b, uint64_t c) { return futrts_umul_hi64(a, b) + c; }
SCALAR_FUN_ATTR  uint8_t futrts_smad_hi8 ( int8_t a,  int8_t b,  int8_t c) { return futrts_smul_hi8(a, b) + c; }
SCALAR_FUN_ATTR uint16_t futrts_smad_hi16(int16_t a, int16_t b, int16_t c) { return futrts_smul_hi16(a, b) + c; }
SCALAR_FUN_ATTR uint32_t futrts_smad_hi32(int32_t a, int32_t b, int32_t c) { return futrts_smul_hi32(a, b) + c; }
SCALAR_FUN_ATTR uint64_t futrts_smad_hi64(int64_t a, int64_t b, int64_t c) { return futrts_smul_hi64(a, b) + c; }
#endif

#if defined(__OPENCL_VERSION__)
SCALAR_FUN_ATTR int32_t futrts_clzz8(int8_t x) {
  return clz(x);
}

SCALAR_FUN_ATTR int32_t futrts_clzz16(int16_t x) {
  return clz(x);
}

SCALAR_FUN_ATTR int32_t futrts_clzz32(int32_t x) {
  return clz(x);
}

SCALAR_FUN_ATTR int32_t futrts_clzz64(int64_t x) {
  return clz(x);
}

#elif defined(__CUDA_ARCH__)

SCALAR_FUN_ATTR int32_t futrts_clzz8(int8_t x) {
  return __clz(zext_i8_i32(x)) - 24;
}

SCALAR_FUN_ATTR int32_t futrts_clzz16(int16_t x) {
  return __clz(zext_i16_i32(x)) - 16;
}

SCALAR_FUN_ATTR int32_t futrts_clzz32(int32_t x) {
  return __clz(x);
}

SCALAR_FUN_ATTR int32_t futrts_clzz64(int64_t x) {
  return __clzll(x);
}

#elif ISPC

SCALAR_FUN_ATTR int32_t futrts_clzz8(int8_t x) {
  return count_leading_zeros((int32_t)(uint8_t)x)-24;
}

SCALAR_FUN_ATTR int32_t futrts_clzz16(int16_t x) {
  return count_leading_zeros((int32_t)(uint16_t)x)-16;
}

SCALAR_FUN_ATTR int32_t futrts_clzz32(int32_t x) {
  return count_leading_zeros(x);
}

SCALAR_FUN_ATTR int32_t futrts_clzz64(int64_t x) {
  return count_leading_zeros(x);
}

#else // Not OpenCL, ISPC or CUDA, but plain C.

SCALAR_FUN_ATTR int32_t futrts_clzz8(int8_t x) {
  return x == 0 ? 8 : __builtin_clz((uint32_t)zext_i8_i32(x)) - 24;
}

SCALAR_FUN_ATTR int32_t futrts_clzz16(int16_t x) {
  return x == 0 ? 16 : __builtin_clz((uint32_t)zext_i16_i32(x)) - 16;
}

SCALAR_FUN_ATTR int32_t futrts_clzz32(int32_t x) {
  return x == 0 ? 32 : __builtin_clz((uint32_t)x);
}

SCALAR_FUN_ATTR int32_t futrts_clzz64(int64_t x) {
  return x == 0 ? 64 : __builtin_clzll((uint64_t)x);
}
#endif

#if defined(__OPENCL_VERSION__)
SCALAR_FUN_ATTR int32_t futrts_ctzz8(int8_t x) {
  int i = 0;
  for (; i < 8 && (x & 1) == 0; i++, x >>= 1)
    ;
  return i;
}

SCALAR_FUN_ATTR int32_t futrts_ctzz16(int16_t x) {
  int i = 0;
  for (; i < 16 && (x & 1) == 0; i++, x >>= 1)
    ;
  return i;
}

SCALAR_FUN_ATTR int32_t futrts_ctzz32(int32_t x) {
  int i = 0;
  for (; i < 32 && (x & 1) == 0; i++, x >>= 1)
    ;
  return i;
}

SCALAR_FUN_ATTR int32_t futrts_ctzz64(int64_t x) {
  int i = 0;
  for (; i < 64 && (x & 1) == 0; i++, x >>= 1)
    ;
  return i;
}

#elif defined(__CUDA_ARCH__)

SCALAR_FUN_ATTR int32_t futrts_ctzz8(int8_t x) {
  int y = __ffs(x);
  return y == 0 ? 8 : y - 1;
}

SCALAR_FUN_ATTR int32_t futrts_ctzz16(int16_t x) {
  int y = __ffs(x);
  return y == 0 ? 16 : y - 1;
}

SCALAR_FUN_ATTR int32_t futrts_ctzz32(int32_t x) {
  int y = __ffs(x);
  return y == 0 ? 32 : y - 1;
}

SCALAR_FUN_ATTR int32_t futrts_ctzz64(int64_t x) {
  int y = __ffsll(x);
  return y == 0 ? 64 : y - 1;
}

#elif ISPC

SCALAR_FUN_ATTR int32_t futrts_ctzz8(int8_t x) {
  return x == 0 ? 8 : count_trailing_zeros((int32_t)x);
}

SCALAR_FUN_ATTR int32_t futrts_ctzz16(int16_t x) {
  return x == 0 ? 16 : count_trailing_zeros((int32_t)x);
}

SCALAR_FUN_ATTR int32_t futrts_ctzz32(int32_t x) {
  return count_trailing_zeros(x);
}

SCALAR_FUN_ATTR int32_t futrts_ctzz64(int64_t x) {
  return count_trailing_zeros(x);
}

#else // Not OpenCL or CUDA, but plain C.

SCALAR_FUN_ATTR int32_t futrts_ctzz8(int8_t x) {
  return x == 0 ? 8 : __builtin_ctz((uint32_t)x);
}

SCALAR_FUN_ATTR int32_t futrts_ctzz16(int16_t x) {
  return x == 0 ? 16 : __builtin_ctz((uint32_t)x);
}

SCALAR_FUN_ATTR int32_t futrts_ctzz32(int32_t x) {
  return x == 0 ? 32 : __builtin_ctz((uint32_t)x);
}

SCALAR_FUN_ATTR int32_t futrts_ctzz64(int64_t x) {
  return x == 0 ? 64 : __builtin_ctzll((uint64_t)x);
}
#endif

SCALAR_FUN_ATTR float fdiv32(float x, float y) {
  return x / y;
}

SCALAR_FUN_ATTR float fadd32(float x, float y) {
  return x + y;
}

SCALAR_FUN_ATTR float fsub32(float x, float y) {
  return x - y;
}

SCALAR_FUN_ATTR float fmul32(float x, float y) {
  return x * y;
}

SCALAR_FUN_ATTR bool cmplt32(float x, float y) {
  return x < y;
}

SCALAR_FUN_ATTR bool cmple32(float x, float y) {
  return x <= y;
}

SCALAR_FUN_ATTR float sitofp_i8_f32(int8_t x) {
  return (float) x;
}

SCALAR_FUN_ATTR float sitofp_i16_f32(int16_t x) {
  return (float) x;
}

SCALAR_FUN_ATTR float sitofp_i32_f32(int32_t x) {
  return (float) x;
}

SCALAR_FUN_ATTR float sitofp_i64_f32(int64_t x) {
  return (float) x;
}

SCALAR_FUN_ATTR float uitofp_i8_f32(uint8_t x) {
  return (float) x;
}

SCALAR_FUN_ATTR float uitofp_i16_f32(uint16_t x) {
  return (float) x;
}

SCALAR_FUN_ATTR float uitofp_i32_f32(uint32_t x) {
  return (float) x;
}

SCALAR_FUN_ATTR float uitofp_i64_f32(uint64_t x) {
  return (float) x;
}

#ifdef __OPENCL_VERSION__
SCALAR_FUN_ATTR float fabs32(float x) {
  return fabs(x);
}

SCALAR_FUN_ATTR float fmax32(float x, float y) {
  return fmax(x, y);
}

SCALAR_FUN_ATTR float fmin32(float x, float y) {
  return fmin(x, y);
}

SCALAR_FUN_ATTR float fpow32(float x, float y) {
  return pow(x, y);
}

#elif ISPC

SCALAR_FUN_ATTR float fabs32(float x) {
  return abs(x);
}

SCALAR_FUN_ATTR float fmax32(float x, float y) {
  return isnan(x) ? y : isnan(y) ? x : max(x, y);
}

SCALAR_FUN_ATTR float fmin32(float x, float y) {
  return isnan(x) ? y : isnan(y) ? x : min(x, y);
}

SCALAR_FUN_ATTR float fpow32(float a, float b) {
  float ret;
  foreach_active (i) {
      uniform float r = __stdlib_powf(extract(a, i), extract(b, i));
      ret = insert(ret, i, r);
  }
  return ret;
}

#else // Not OpenCL, but CUDA or plain C.

SCALAR_FUN_ATTR float fabs32(float x) {
  return fabsf(x);
}

SCALAR_FUN_ATTR float fmax32(float x, float y) {
  return fmaxf(x, y);
}

SCALAR_FUN_ATTR float fmin32(float x, float y) {
  return fminf(x, y);
}

SCALAR_FUN_ATTR float fpow32(float x, float y) {
  return powf(x, y);
}
#endif

SCALAR_FUN_ATTR bool futrts_isnan32(float x) {
  return isnan(x);
}

#if ISPC

SCALAR_FUN_ATTR bool futrts_isinf32(float x) {
  return !isnan(x) && isnan(x - x);
}

SCALAR_FUN_ATTR bool futrts_isfinite32(float x) {
  return !isnan(x) && !futrts_isinf32(x);
}

#else

SCALAR_FUN_ATTR bool futrts_isinf32(float x) {
  return isinf(x);
}

#endif

SCALAR_FUN_ATTR int8_t fptosi_f32_i8(float x) {
  if (futrts_isnan32(x) || futrts_isinf32(x)) {
    return 0;
  } else {
    return (int8_t) x;
  }
}

SCALAR_FUN_ATTR int16_t fptosi_f32_i16(float x) {
  if (futrts_isnan32(x) || futrts_isinf32(x)) {
    return 0;
  } else {
    return (int16_t) x;
  }
}

SCALAR_FUN_ATTR int32_t fptosi_f32_i32(float x) {
  if (futrts_isnan32(x) || futrts_isinf32(x)) {
    return 0;
  } else {
    return (int32_t) x;
  }
}

SCALAR_FUN_ATTR int64_t fptosi_f32_i64(float x) {
  if (futrts_isnan32(x) || futrts_isinf32(x)) {
    return 0;
  } else {
    return (int64_t) x;
  };
}

SCALAR_FUN_ATTR uint8_t fptoui_f32_i8(float x) {
  if (futrts_isnan32(x) || futrts_isinf32(x)) {
    return 0;
  } else {
    return (uint8_t) (int8_t) x;
  }
}

SCALAR_FUN_ATTR uint16_t fptoui_f32_i16(float x) {
  if (futrts_isnan32(x) || futrts_isinf32(x)) {
    return 0;
  } else {
    return (uint16_t) (int16_t) x;
  }
}

SCALAR_FUN_ATTR uint32_t fptoui_f32_i32(float x) {
  if (futrts_isnan32(x) || futrts_isinf32(x)) {
    return 0;
  } else {
    return (uint32_t) (int32_t) x;
  }
}

SCALAR_FUN_ATTR uint64_t fptoui_f32_i64(float x) {
  if (futrts_isnan32(x) || futrts_isinf32(x)) {
    return 0;
  } else {
    return (uint64_t) (int64_t) x;
  }
}

SCALAR_FUN_ATTR bool ftob_f32_bool(float x) {
  return x != 0;
}

SCALAR_FUN_ATTR float btof_bool_f32(bool x) {
  return x ? 1 : 0;
}

#ifdef __OPENCL_VERSION__
SCALAR_FUN_ATTR float futrts_log32(float x) {
  return log(x);
}

SCALAR_FUN_ATTR float futrts_log2_32(float x) {
  return log2(x);
}

SCALAR_FUN_ATTR float futrts_log10_32(float x) {
  return log10(x);
}

SCALAR_FUN_ATTR float futrts_log1p_32(float x) {
  return log1p(x);
}

SCALAR_FUN_ATTR float futrts_sqrt32(float x) {
  return sqrt(x);
}

SCALAR_FUN_ATTR float futrts_cbrt32(float x) {
  return cbrt(x);
}

SCALAR_FUN_ATTR float futrts_exp32(float x) {
  return exp(x);
}

SCALAR_FUN_ATTR float futrts_cos32(float x) {
  return cos(x);
}

SCALAR_FUN_ATTR float futrts_sin32(float x) {
  return sin(x);
}

SCALAR_FUN_ATTR float futrts_tan32(float x) {
  return tan(x);
}

SCALAR_FUN_ATTR float futrts_acos32(float x) {
  return acos(x);
}

SCALAR_FUN_ATTR float futrts_asin32(float x) {
  return asin(x);
}

SCALAR_FUN_ATTR float futrts_atan32(float x) {
  return atan(x);
}

SCALAR_FUN_ATTR float futrts_cosh32(float x) {
  return cosh(x);
}

SCALAR_FUN_ATTR float futrts_sinh32(float x) {
  return sinh(x);
}

SCALAR_FUN_ATTR float futrts_tanh32(float x) {
  return tanh(x);
}

SCALAR_FUN_ATTR float futrts_acosh32(float x) {
  return acosh(x);
}

SCALAR_FUN_ATTR float futrts_asinh32(float x) {
  return asinh(x);
}

SCALAR_FUN_ATTR float futrts_atanh32(float x) {
  return atanh(x);
}

SCALAR_FUN_ATTR float futrts_atan2_32(float x, float y) {
  return atan2(x, y);
}

SCALAR_FUN_ATTR float futrts_hypot32(float x, float y) {
  return hypot(x, y);
}

SCALAR_FUN_ATTR float futrts_gamma32(float x) {
  return tgamma(x);
}

SCALAR_FUN_ATTR float futrts_lgamma32(float x) {
  return lgamma(x);
}

SCALAR_FUN_ATTR float futrts_erf32(float x) {
  return erf(x);
}

SCALAR_FUN_ATTR float futrts_erfc32(float x) {
  return erfc(x);
}

SCALAR_FUN_ATTR float fmod32(float x, float y) {
  return fmod(x, y);
}

SCALAR_FUN_ATTR float futrts_round32(float x) {
  return rint(x);
}

SCALAR_FUN_ATTR float futrts_floor32(float x) {
  return floor(x);
}

SCALAR_FUN_ATTR float futrts_ceil32(float x) {
  return ceil(x);
}

SCALAR_FUN_ATTR float futrts_nextafter32(float x, float y) {
  return nextafter(x, y);
}

SCALAR_FUN_ATTR float futrts_lerp32(float v0, float v1, float t) {
  return mix(v0, v1, t);
}

SCALAR_FUN_ATTR float futrts_ldexp32(float x, int32_t y) {
  return ldexp(x, y);
}

SCALAR_FUN_ATTR float futrts_copysign32(float x, float y) {
  return copysign(x, y);
}

SCALAR_FUN_ATTR float futrts_mad32(float a, float b, float c) {
  return mad(a, b, c);
}

SCALAR_FUN_ATTR float futrts_fma32(float a, float b, float c) {
  return fma(a, b, c);
}

#elif ISPC

SCALAR_FUN_ATTR float futrts_log32(float x) {
  return futrts_isfinite32(x) || (futrts_isinf32(x) && x < 0)? log(x) : x;
}

SCALAR_FUN_ATTR float futrts_log2_32(float x) {
  return futrts_log32(x) / log(2.0f);
}

SCALAR_FUN_ATTR float futrts_log10_32(float x) {
  return futrts_log32(x) / log(10.0f);
}

SCALAR_FUN_ATTR float futrts_log1p_32(float x) {
  if(x == -1.0f || (futrts_isinf32(x) && x > 0.0f)) return x / 0.0f;
  float y = 1.0f + x;
  float z = y - 1.0f;
  return log(y) - (z-x)/y;
}

SCALAR_FUN_ATTR float futrts_sqrt32(float x) {
  return sqrt(x);
}

extern "C" unmasked uniform float cbrtf(uniform float);
SCALAR_FUN_ATTR float futrts_cbrt32(float x) {
  float res;
  foreach_active (i) {
    uniform float r = cbrtf(extract(x, i));
    res = insert(res, i, r);
  }
  return res;
}

SCALAR_FUN_ATTR float futrts_exp32(float x) {
  return exp(x);
}

SCALAR_FUN_ATTR float futrts_cos32(float x) {
  return cos(x);
}

SCALAR_FUN_ATTR float futrts_sin32(float x) {
  return sin(x);
}

SCALAR_FUN_ATTR float futrts_tan32(float x) {
  return tan(x);
}

SCALAR_FUN_ATTR float futrts_acos32(float x) {
  return acos(x);
}

SCALAR_FUN_ATTR float futrts_asin32(float x) {
  return asin(x);
}

SCALAR_FUN_ATTR float futrts_atan32(float x) {
  return atan(x);
}

SCALAR_FUN_ATTR float futrts_cosh32(float x) {
  return (exp(x)+exp(-x)) / 2.0f;
}

SCALAR_FUN_ATTR float futrts_sinh32(float x) {
  return (exp(x)-exp(-x)) / 2.0f;
}

SCALAR_FUN_ATTR float futrts_tanh32(float x) {
  return futrts_sinh32(x)/futrts_cosh32(x);
}

SCALAR_FUN_ATTR float futrts_acosh32(float x) {
  float f = x+sqrt(x*x-1);
  if(futrts_isfinite32(f)) return log(f);
  return f;
}

SCALAR_FUN_ATTR float futrts_asinh32(float x) {
  float f = x+sqrt(x*x+1);
  if(futrts_isfinite32(f)) return log(f);
  return f;

}

SCALAR_FUN_ATTR float futrts_atanh32(float x) {
  float f = (1+x)/(1-x);
  if(futrts_isfinite32(f)) return log(f)/2.0f;
  return f;

}

SCALAR_FUN_ATTR float futrts_atan2_32(float x, float y) {
  return (x == 0.0f && y == 0.0f) ? 0.0f : atan2(x, y);
}

SCALAR_FUN_ATTR float futrts_hypot32(float x, float y) {
  if (futrts_isfinite32(x) && futrts_isfinite32(y)) {
    x = abs(x);
    y = abs(y);
    float a;
    float b;
    if (x >= y){
        a = x;
        b = y;
    } else {
        a = y;
        b = x;
    }
    if(b == 0){
      return a;
    }

    int e;
    float an;
    float bn;
    an = frexp (a, &e);
    bn = ldexp (b, - e);
    float cn;
    cn = sqrt (an * an + bn * bn);
    return ldexp (cn, e);
  } else {
    if (futrts_isinf32(x) || futrts_isinf32(y)) return INFINITY;
    else return x + y;
  }

}

extern "C" unmasked uniform float tgammaf(uniform float x);
SCALAR_FUN_ATTR float futrts_gamma32(float x) {
  float res;
  foreach_active (i) {
    uniform float r = tgammaf(extract(x, i));
    res = insert(res, i, r);
  }
  return res;
}

extern "C" unmasked uniform float lgammaf(uniform float x);
SCALAR_FUN_ATTR float futrts_lgamma32(float x) {
  float res;
  foreach_active (i) {
    uniform float r = lgammaf(extract(x, i));
    res = insert(res, i, r);
  }
  return res;
}

extern "C" unmasked uniform float erff(uniform float x);
SCALAR_FUN_ATTR float futrts_erf32(float x) {
  float res;
  foreach_active (i) {
    uniform float r = erff(extract(x, i));
    res = insert(res, i, r);
  }
  return res;
}

extern "C" unmasked uniform float erfcf(uniform float x);
SCALAR_FUN_ATTR float futrts_erfc32(float x) {
  float res;
  foreach_active (i) {
    uniform float r = erfcf(extract(x, i));
    res = insert(res, i, r);
  }
  return res;
}

SCALAR_FUN_ATTR float fmod32(float x, float y) {
  return x - y * trunc(x/y);
}

SCALAR_FUN_ATTR float futrts_round32(float x) {
  return round(x);
}

SCALAR_FUN_ATTR float futrts_floor32(float x) {
  return floor(x);
}

SCALAR_FUN_ATTR float futrts_ceil32(float x) {
  return ceil(x);
}

extern "C" unmasked uniform float nextafterf(uniform float x, uniform float y);
SCALAR_FUN_ATTR float futrts_nextafter32(float x, float y) {
  float res;
  foreach_active (i) {
    uniform float r = nextafterf(extract(x, i), extract(y, i));
    res = insert(res, i, r);
  }
  return res;
}

SCALAR_FUN_ATTR float futrts_lerp32(float v0, float v1, float t) {
  return v0 + (v1 - v0) * t;
}

SCALAR_FUN_ATTR float futrts_ldexp32(float x, int32_t y) {
  return x * pow((double)2.0, (double)y);
}

SCALAR_FUN_ATTR float futrts_copysign32(float x, float y) {
  int32_t xb = futrts_to_bits32(x);
  int32_t yb = futrts_to_bits32(y);
  return futrts_from_bits32((xb & ~(1<<31)) | (yb & (1<<31)));
}

SCALAR_FUN_ATTR float futrts_mad32(float a, float b, float c) {
  return a * b + c;
}

SCALAR_FUN_ATTR float futrts_fma32(float a, float b, float c) {
  return a * b + c;
}

#else // Not OpenCL or ISPC, but CUDA or plain C.

SCALAR_FUN_ATTR float futrts_log32(float x) {
  return logf(x);
}

SCALAR_FUN_ATTR float futrts_log2_32(float x) {
  return log2f(x);
}

SCALAR_FUN_ATTR float futrts_log10_32(float x) {
  return log10f(x);
}

SCALAR_FUN_ATTR float futrts_log1p_32(float x) {
  return log1pf(x);
}

SCALAR_FUN_ATTR float futrts_sqrt32(float x) {
  return sqrtf(x);
}

SCALAR_FUN_ATTR float futrts_cbrt32(float x) {
  return cbrtf(x);
}

SCALAR_FUN_ATTR float futrts_exp32(float x) {
  return expf(x);
}

SCALAR_FUN_ATTR float futrts_cos32(float x) {
  return cosf(x);
}

SCALAR_FUN_ATTR float futrts_sin32(float x) {
  return sinf(x);
}

SCALAR_FUN_ATTR float futrts_tan32(float x) {
  return tanf(x);
}

SCALAR_FUN_ATTR float futrts_acos32(float x) {
  return acosf(x);
}

SCALAR_FUN_ATTR float futrts_asin32(float x) {
  return asinf(x);
}

SCALAR_FUN_ATTR float futrts_atan32(float x) {
  return atanf(x);
}

SCALAR_FUN_ATTR float futrts_cosh32(float x) {
  return coshf(x);
}

SCALAR_FUN_ATTR float futrts_sinh32(float x) {
  return sinhf(x);
}

SCALAR_FUN_ATTR float futrts_tanh32(float x) {
  return tanhf(x);
}

SCALAR_FUN_ATTR float futrts_acosh32(float x) {
  return acoshf(x);
}

SCALAR_FUN_ATTR float futrts_asinh32(float x) {
  return asinhf(x);
}

SCALAR_FUN_ATTR float futrts_atanh32(float x) {
  return atanhf(x);
}

SCALAR_FUN_ATTR float futrts_atan2_32(float x, float y) {
  return atan2f(x, y);
}

SCALAR_FUN_ATTR float futrts_hypot32(float x, float y) {
  return hypotf(x, y);
}

SCALAR_FUN_ATTR float futrts_gamma32(float x) {
  return tgammaf(x);
}

SCALAR_FUN_ATTR float futrts_lgamma32(float x) {
  return lgammaf(x);
}

SCALAR_FUN_ATTR float futrts_erf32(float x) {
  return erff(x);
}

SCALAR_FUN_ATTR float futrts_erfc32(float x) {
  return erfcf(x);
}

SCALAR_FUN_ATTR float fmod32(float x, float y) {
  return fmodf(x, y);
}

SCALAR_FUN_ATTR float futrts_round32(float x) {
  return rintf(x);
}

SCALAR_FUN_ATTR float futrts_floor32(float x) {
  return floorf(x);
}

SCALAR_FUN_ATTR float futrts_ceil32(float x) {
  return ceilf(x);
}

SCALAR_FUN_ATTR float futrts_nextafter32(float x, float y) {
  return nextafterf(x, y);
}

SCALAR_FUN_ATTR float futrts_lerp32(float v0, float v1, float t) {
  return v0 + (v1 - v0) * t;
}

SCALAR_FUN_ATTR float futrts_ldexp32(float x, int32_t y) {
  return ldexpf(x, y);
}

SCALAR_FUN_ATTR float futrts_copysign32(float x, float y) {
  return copysignf(x, y);
}

SCALAR_FUN_ATTR float futrts_mad32(float a, float b, float c) {
  return a * b + c;
}

SCALAR_FUN_ATTR float futrts_fma32(float a, float b, float c) {
  return fmaf(a, b, c);
}
#endif

#if ISPC
SCALAR_FUN_ATTR int32_t futrts_to_bits32(float x) {
  return intbits(x);
}

SCALAR_FUN_ATTR float futrts_from_bits32(int32_t x) {
  return floatbits(x);
}
#else
SCALAR_FUN_ATTR int32_t futrts_to_bits32(float x) {
  union {
    float f;
    int32_t t;
  } p;

  p.f = x;
  return p.t;
}

SCALAR_FUN_ATTR float futrts_from_bits32(int32_t x) {
  union {
    int32_t f;
    float t;
  } p;

  p.f = x;
  return p.t;
}
#endif

SCALAR_FUN_ATTR float fsignum32(float x) {
  return futrts_isnan32(x) ? x : (x > 0 ? 1 : 0) - (x < 0 ? 1 : 0);
}

#ifdef FUTHARK_F64_ENABLED

SCALAR_FUN_ATTR double futrts_from_bits64(int64_t x);
SCALAR_FUN_ATTR int64_t futrts_to_bits64(double x);

#if ISPC
SCALAR_FUN_ATTR bool futrts_isinf64(float x) {
  return !isnan(x) && isnan(x - x);
}

SCALAR_FUN_ATTR bool futrts_isfinite64(float x) {
  return !isnan(x) && !futrts_isinf64(x);
}

SCALAR_FUN_ATTR double fdiv64(double x, double y) {
  return x / y;
}

SCALAR_FUN_ATTR double fadd64(double x, double y) {
  return x + y;
}

SCALAR_FUN_ATTR double fsub64(double x, double y) {
  return x - y;
}

SCALAR_FUN_ATTR double fmul64(double x, double y) {
  return x * y;
}

SCALAR_FUN_ATTR bool cmplt64(double x, double y) {
  return x < y;
}

SCALAR_FUN_ATTR bool cmple64(double x, double y) {
  return x <= y;
}

SCALAR_FUN_ATTR double sitofp_i8_f64(int8_t x) {
  return (double) x;
}

SCALAR_FUN_ATTR double sitofp_i16_f64(int16_t x) {
  return (double) x;
}

SCALAR_FUN_ATTR double sitofp_i32_f64(int32_t x) {
  return (double) x;
}

SCALAR_FUN_ATTR double sitofp_i64_f64(int64_t x) {
  return (double) x;
}

SCALAR_FUN_ATTR double uitofp_i8_f64(uint8_t x) {
  return (double) x;
}

SCALAR_FUN_ATTR double uitofp_i16_f64(uint16_t x) {
  return (double) x;
}

SCALAR_FUN_ATTR double uitofp_i32_f64(uint32_t x) {
  return (double) x;
}

SCALAR_FUN_ATTR double uitofp_i64_f64(uint64_t x) {
  return (double) x;
}

SCALAR_FUN_ATTR double fabs64(double x) {
  return abs(x);
}

SCALAR_FUN_ATTR double fmax64(double x, double y) {
  return isnan(x) ? y : isnan(y) ? x : max(x, y);
}

SCALAR_FUN_ATTR double fmin64(double x, double y) {
  return isnan(x) ? y : isnan(y) ? x : min(x, y);
}

SCALAR_FUN_ATTR double fpow64(double a, double b) {
  float ret;
  foreach_active (i) {
      uniform float r = __stdlib_powf(extract(a, i), extract(b, i));
      ret = insert(ret, i, r);
  }
  return ret;
}

SCALAR_FUN_ATTR double futrts_log64(double x) {
  return futrts_isfinite64(x) || (futrts_isinf64(x) && x < 0)? log(x) : x;
}

SCALAR_FUN_ATTR double futrts_log2_64(double x) {
  return futrts_log64(x)/log(2.0d);
}

SCALAR_FUN_ATTR double futrts_log10_64(double x) {
  return futrts_log64(x)/log(10.0d);
}

SCALAR_FUN_ATTR double futrts_log1p_64(double x) {
  if(x == -1.0d || (futrts_isinf64(x) && x > 0.0d)) return x / 0.0d;
  double y = 1.0d + x;
  double z = y - 1.0d;
  return log(y) - (z-x)/y;
}

SCALAR_FUN_ATTR double futrts_sqrt64(double x) {
  return sqrt(x);
}

extern "C" unmasked uniform double cbrt(uniform double);
SCALAR_FUN_ATTR double futrts_cbrt64(double x) {
  double res;
  foreach_active (i) {
    uniform double r = cbrtf(extract(x, i));
    res = insert(res, i, r);
  }
  return res;
}

SCALAR_FUN_ATTR double futrts_exp64(double x) {
  return exp(x);
}

SCALAR_FUN_ATTR double futrts_cos64(double x) {
  return cos(x);
}

SCALAR_FUN_ATTR double futrts_sin64(double x) {
  return sin(x);
}

SCALAR_FUN_ATTR double futrts_tan64(double x) {
  return tan(x);
}

SCALAR_FUN_ATTR double futrts_acos64(double x) {
  return acos(x);
}

SCALAR_FUN_ATTR double futrts_asin64(double x) {
  return asin(x);
}

SCALAR_FUN_ATTR double futrts_atan64(double x) {
  return atan(x);
}

SCALAR_FUN_ATTR double futrts_cosh64(double x) {
  return (exp(x)+exp(-x)) / 2.0d;
}

SCALAR_FUN_ATTR double futrts_sinh64(double x) {
  return (exp(x)-exp(-x)) / 2.0d;
}

SCALAR_FUN_ATTR double futrts_tanh64(double x) {
  return futrts_sinh64(x)/futrts_cosh64(x);
}

SCALAR_FUN_ATTR double futrts_acosh64(double x) {
  double f = x+sqrt(x*x-1.0d);
  if(futrts_isfinite64(f)) return log(f);
  return f;
}

SCALAR_FUN_ATTR double futrts_asinh64(double x) {
  double f = x+sqrt(x*x+1.0d);
  if(futrts_isfinite64(f)) return log(f);
  return f;
}

SCALAR_FUN_ATTR double futrts_atanh64(double x) {
  double f = (1.0d+x)/(1.0d-x);
  if(futrts_isfinite64(f)) return log(f)/2.0d;
  return f;

}

SCALAR_FUN_ATTR double futrts_atan2_64(double x, double y) {
  return atan2(x, y);
}

extern "C" unmasked uniform double hypot(uniform double x, uniform double y);
SCALAR_FUN_ATTR double futrts_hypot64(double x, double y) {
  double res;
  foreach_active (i) {
    uniform double r = hypot(extract(x, i), extract(y, i));
    res = insert(res, i, r);
  }
  return res;
}

extern "C" unmasked uniform double tgamma(uniform double x);
SCALAR_FUN_ATTR double futrts_gamma64(double x) {
  double res;
  foreach_active (i) {
    uniform double r = tgamma(extract(x, i));
    res = insert(res, i, r);
  }
  return res;
}

extern "C" unmasked uniform double lgamma(uniform double x);
SCALAR_FUN_ATTR double futrts_lgamma64(double x) {
  double res;
  foreach_active (i) {
    uniform double r = lgamma(extract(x, i));
    res = insert(res, i, r);
  }
  return res;
}

extern "C" unmasked uniform double erf(uniform double x);
SCALAR_FUN_ATTR double futrts_erf64(double x) {
  double res;
  foreach_active (i) {
    uniform double r = erf(extract(x, i));
    res = insert(res, i, r);
  }
  return res;
}

extern "C" unmasked uniform double erfc(uniform double x);
SCALAR_FUN_ATTR double futrts_erfc64(double x) {
  double res;
  foreach_active (i) {
    uniform double r = erfc(extract(x, i));
    res = insert(res, i, r);
  }
  return res;
}

SCALAR_FUN_ATTR double futrts_fma64(double a, double b, double c) {
  return a * b + c;
}

SCALAR_FUN_ATTR double futrts_round64(double x) {
  return round(x);
}

SCALAR_FUN_ATTR double futrts_ceil64(double x) {
  return ceil(x);
}

extern "C" unmasked uniform double nextafter(uniform float x, uniform double y);
SCALAR_FUN_ATTR float futrts_nextafter64(double x, double y) {
  double res;
  foreach_active (i) {
    uniform double r = nextafter(extract(x, i), extract(y, i));
    res = insert(res, i, r);
  }
  return res;
}

SCALAR_FUN_ATTR double futrts_floor64(double x) {
  return floor(x);
}

SCALAR_FUN_ATTR bool futrts_isnan64(double x) {
  return isnan(x);
}

SCALAR_FUN_ATTR int8_t fptosi_f64_i8(double x) {
  if (futrts_isnan64(x) || futrts_isinf64(x)) {
    return 0;
  } else {
    return (int8_t) x;
  }
}

SCALAR_FUN_ATTR int16_t fptosi_f64_i16(double x) {
  if (futrts_isnan64(x) || futrts_isinf64(x)) {
    return 0;
  } else {
    return (int16_t) x;
  }
}

SCALAR_FUN_ATTR int32_t fptosi_f64_i32(double x) {
  if (futrts_isnan64(x) || futrts_isinf64(x)) {
    return 0;
  } else {
    return (int32_t) x;
  }
}

SCALAR_FUN_ATTR int64_t fptosi_f64_i64(double x) {
  if (futrts_isnan64(x) || futrts_isinf64(x)) {
    return 0;
  } else {
    return (int64_t) x;
  }
}

SCALAR_FUN_ATTR uint8_t fptoui_f64_i8(double x) {
  if (futrts_isnan64(x) || futrts_isinf64(x)) {
    return 0;
  } else {
    return (uint8_t) (int8_t) x;
  }
}

SCALAR_FUN_ATTR uint16_t fptoui_f64_i16(double x) {
  if (futrts_isnan64(x) || futrts_isinf64(x)) {
    return 0;
  } else {
    return (uint16_t) (int16_t) x;
  }
}

SCALAR_FUN_ATTR uint32_t fptoui_f64_i32(double x) {
  if (futrts_isnan64(x) || futrts_isinf64(x)) {
    return 0;
  } else {
    return (uint32_t) (int32_t) x;
  }
}

SCALAR_FUN_ATTR uint64_t fptoui_f64_i64(double x) {
  if (futrts_isnan64(x) || futrts_isinf64(x)) {
    return 0;
  } else {
    return (uint64_t) (int64_t) x;
  }
}

SCALAR_FUN_ATTR bool ftob_f64_bool(double x) {
  return x != 0.0;
}

SCALAR_FUN_ATTR double btof_bool_f64(bool x) {
  return x ? 1.0 : 0.0;
}

SCALAR_FUN_ATTR int64_t futrts_to_bits64(double x) {
  int64_t res;
  foreach_active (i) {
    uniform double tmp = extract(x, i);
    uniform int64_t r = *((uniform int64_t* uniform)&tmp);
    res = insert(res, i, r);
  }
  return res;
}

SCALAR_FUN_ATTR double futrts_from_bits64(int64_t x) {
  double res;
  foreach_active (i) {
    uniform int64_t tmp = extract(x, i);
    uniform double r = *((uniform double* uniform)&tmp);
    res = insert(res, i, r);
  }
  return res;
}

SCALAR_FUN_ATTR double fmod64(double x, double y) {
  return x - y * trunc(x/y);
}

SCALAR_FUN_ATTR double fsignum64(double x) {
  return futrts_isnan64(x) ? x : (x > 0 ? 1.0d : 0.0d) - (x < 0 ? 1.0d : 0.0d);
}

SCALAR_FUN_ATTR double futrts_lerp64(double v0, double v1, double t) {
  return v0 + (v1 - v0) * t;
}

SCALAR_FUN_ATTR double futrts_ldexp64(double x, int32_t y) {
  return x * pow((double)2.0, (double)y);
}

SCALAR_FUN_ATTR double futrts_copysign64(double x, double y) {
  int64_t xb = futrts_to_bits64(x);
  int64_t yb = futrts_to_bits64(y);
  return futrts_from_bits64((xb & ~(((int64_t)1)<<63)) | (yb & (((int64_t)1)<<63)));
}

SCALAR_FUN_ATTR double futrts_mad64(double a, double b, double c) {
  return a * b + c;
}

SCALAR_FUN_ATTR float fpconv_f32_f32(float x) {
  return (float) x;
}

SCALAR_FUN_ATTR double fpconv_f32_f64(float x) {
  return (double) x;
}

SCALAR_FUN_ATTR float fpconv_f64_f32(double x) {
  return (float) x;
}

SCALAR_FUN_ATTR double fpconv_f64_f64(double x) {
  return (double) x;
}

#else

SCALAR_FUN_ATTR double fdiv64(double x, double y) {
  return x / y;
}

SCALAR_FUN_ATTR double fadd64(double x, double y) {
  return x + y;
}

SCALAR_FUN_ATTR double fsub64(double x, double y) {
  return x - y;
}

SCALAR_FUN_ATTR double fmul64(double x, double y) {
  return x * y;
}

SCALAR_FUN_ATTR bool cmplt64(double x, double y) {
  return x < y;
}

SCALAR_FUN_ATTR bool cmple64(double x, double y) {
  return x <= y;
}

SCALAR_FUN_ATTR double sitofp_i8_f64(int8_t x) {
  return (double) x;
}

SCALAR_FUN_ATTR double sitofp_i16_f64(int16_t x) {
  return (double) x;
}

SCALAR_FUN_ATTR double sitofp_i32_f64(int32_t x) {
  return (double) x;
}

SCALAR_FUN_ATTR double sitofp_i64_f64(int64_t x) {
  return (double) x;
}

SCALAR_FUN_ATTR double uitofp_i8_f64(uint8_t x) {
  return (double) x;
}

SCALAR_FUN_ATTR double uitofp_i16_f64(uint16_t x) {
  return (double) x;
}

SCALAR_FUN_ATTR double uitofp_i32_f64(uint32_t x) {
  return (double) x;
}

SCALAR_FUN_ATTR double uitofp_i64_f64(uint64_t x) {
  return (double) x;
}

SCALAR_FUN_ATTR double fabs64(double x) {
  return fabs(x);
}

SCALAR_FUN_ATTR double fmax64(double x, double y) {
  return fmax(x, y);
}

SCALAR_FUN_ATTR double fmin64(double x, double y) {
  return fmin(x, y);
}

SCALAR_FUN_ATTR double fpow64(double x, double y) {
  return pow(x, y);
}

SCALAR_FUN_ATTR double futrts_log64(double x) {
  return log(x);
}

SCALAR_FUN_ATTR double futrts_log2_64(double x) {
  return log2(x);
}

SCALAR_FUN_ATTR double futrts_log10_64(double x) {
  return log10(x);
}

SCALAR_FUN_ATTR double futrts_log1p_64(double x) {
  return log1p(x);
}

SCALAR_FUN_ATTR double futrts_sqrt64(double x) {
  return sqrt(x);
}

SCALAR_FUN_ATTR double futrts_cbrt64(double x) {
  return cbrt(x);
}

SCALAR_FUN_ATTR double futrts_exp64(double x) {
  return exp(x);
}

SCALAR_FUN_ATTR double futrts_cos64(double x) {
  return cos(x);
}

SCALAR_FUN_ATTR double futrts_sin64(double x) {
  return sin(x);
}

SCALAR_FUN_ATTR double futrts_tan64(double x) {
  return tan(x);
}

SCALAR_FUN_ATTR double futrts_acos64(double x) {
  return acos(x);
}

SCALAR_FUN_ATTR double futrts_asin64(double x) {
  return asin(x);
}

SCALAR_FUN_ATTR double futrts_atan64(double x) {
  return atan(x);
}

SCALAR_FUN_ATTR double futrts_cosh64(double x) {
  return cosh(x);
}

SCALAR_FUN_ATTR double futrts_sinh64(double x) {
  return sinh(x);
}

SCALAR_FUN_ATTR double futrts_tanh64(double x) {
  return tanh(x);
}

SCALAR_FUN_ATTR double futrts_acosh64(double x) {
  return acosh(x);
}

SCALAR_FUN_ATTR double futrts_asinh64(double x) {
  return asinh(x);
}

SCALAR_FUN_ATTR double futrts_atanh64(double x) {
  return atanh(x);
}

SCALAR_FUN_ATTR double futrts_atan2_64(double x, double y) {
  return atan2(x, y);
}

SCALAR_FUN_ATTR double futrts_hypot64(double x, double y) {
  return hypot(x, y);
}

SCALAR_FUN_ATTR double futrts_gamma64(double x) {
  return tgamma(x);
}

SCALAR_FUN_ATTR double futrts_lgamma64(double x) {
  return lgamma(x);
}

SCALAR_FUN_ATTR double futrts_erf64(double x) {
  return erf(x);
}

SCALAR_FUN_ATTR double futrts_erfc64(double x) {
  return erfc(x);
}

SCALAR_FUN_ATTR double futrts_fma64(double a, double b, double c) {
  return fma(a, b, c);
}

SCALAR_FUN_ATTR double futrts_round64(double x) {
  return rint(x);
}

SCALAR_FUN_ATTR double futrts_ceil64(double x) {
  return ceil(x);
}

SCALAR_FUN_ATTR float futrts_nextafter64(float x, float y) {
  return nextafter(x, y);
}

SCALAR_FUN_ATTR double futrts_floor64(double x) {
  return floor(x);
}

SCALAR_FUN_ATTR bool futrts_isnan64(double x) {
  return isnan(x);
}

SCALAR_FUN_ATTR bool futrts_isinf64(double x) {
  return isinf(x);
}

SCALAR_FUN_ATTR int8_t fptosi_f64_i8(double x) {
  if (futrts_isnan64(x) || futrts_isinf64(x)) {
    return 0;
  } else {
    return (int8_t) x;
  }
}

SCALAR_FUN_ATTR int16_t fptosi_f64_i16(double x) {
  if (futrts_isnan64(x) || futrts_isinf64(x)) {
    return 0;
  } else {
    return (int16_t) x;
  }
}

SCALAR_FUN_ATTR int32_t fptosi_f64_i32(double x) {
  if (futrts_isnan64(x) || futrts_isinf64(x)) {
    return 0;
  } else {
    return (int32_t) x;
  }
}

SCALAR_FUN_ATTR int64_t fptosi_f64_i64(double x) {
  if (futrts_isnan64(x) || futrts_isinf64(x)) {
    return 0;
  } else {
    return (int64_t) x;
  }
}

SCALAR_FUN_ATTR uint8_t fptoui_f64_i8(double x) {
  if (futrts_isnan64(x) || futrts_isinf64(x)) {
    return 0;
  } else {
    return (uint8_t) (int8_t) x;
  }
}

SCALAR_FUN_ATTR uint16_t fptoui_f64_i16(double x) {
  if (futrts_isnan64(x) || futrts_isinf64(x)) {
    return 0;
  } else {
    return (uint16_t) (int16_t) x;
  }
}

SCALAR_FUN_ATTR uint32_t fptoui_f64_i32(double x) {
  if (futrts_isnan64(x) || futrts_isinf64(x)) {
    return 0;
  } else {
    return (uint32_t) (int32_t) x;
  }
}

SCALAR_FUN_ATTR uint64_t fptoui_f64_i64(double x) {
  if (futrts_isnan64(x) || futrts_isinf64(x)) {
    return 0;
  } else {
    return (uint64_t) (int64_t) x;
  }
}

SCALAR_FUN_ATTR bool ftob_f64_bool(double x) {
  return x != 0;
}

SCALAR_FUN_ATTR double btof_bool_f64(bool x) {
  return x ? 1 : 0;
}

SCALAR_FUN_ATTR int64_t futrts_to_bits64(double x) {
  union {
    double f;
    int64_t t;
  } p;

  p.f = x;
  return p.t;
}

SCALAR_FUN_ATTR double futrts_from_bits64(int64_t x) {
  union {
    int64_t f;
    double t;
  } p;

  p.f = x;
  return p.t;
}

SCALAR_FUN_ATTR double fmod64(double x, double y) {
  return fmod(x, y);
}

SCALAR_FUN_ATTR double fsignum64(double x) {
  return futrts_isnan64(x) ? x : (x > 0) - (x < 0);
}

SCALAR_FUN_ATTR double futrts_lerp64(double v0, double v1, double t) {
#ifdef __OPENCL_VERSION__
  return mix(v0, v1, t);
#else
  return v0 + (v1 - v0) * t;
#endif
}

SCALAR_FUN_ATTR double futrts_ldexp64(double x, int32_t y) {
  return ldexp(x, y);
}

SCALAR_FUN_ATTR float futrts_copysign64(double x, double y) {
  return copysign(x, y);
}

SCALAR_FUN_ATTR double futrts_mad64(double a, double b, double c) {
#ifdef __OPENCL_VERSION__
  return mad(a, b, c);
#else
  return a * b + c;
#endif
}

SCALAR_FUN_ATTR float fpconv_f32_f32(float x) {
  return (float) x;
}

SCALAR_FUN_ATTR double fpconv_f32_f64(float x) {
  return (double) x;
}

SCALAR_FUN_ATTR float fpconv_f64_f32(double x) {
  return (float) x;
}

SCALAR_FUN_ATTR double fpconv_f64_f64(double x) {
  return (double) x;
}

#endif

#endif

// End of scalar.h.
// Start of scalar_f16.h.

// Half-precision is emulated if needed (e.g. in straight C) with the
// native type used if possible.  The emulation works by typedef'ing
// 'float' to 'f16', and then implementing all operations on single
// precision.  To cut down on duplication, we use the same code for
// those Futhark functions that require just operators or casts.  The
// in-memory representation for arrays will still be 16 bits even
// under emulation, so the compiler will have to be careful when
// generating reads or writes.

#if !defined(cl_khr_fp16) && !(defined(__CUDA_ARCH__) && __CUDA_ARCH__ >= 600) && !(defined(ISPC))
#define EMULATE_F16
#endif

#if !defined(EMULATE_F16) && defined(__OPENCL_VERSION__)
#pragma OPENCL EXTENSION cl_khr_fp16 : enable
#endif

#ifdef EMULATE_F16

// Note that the half-precision storage format is still 16 bits - the
// compiler will have to be real careful!
typedef float f16;

#elif ISPC
typedef float16 f16;

#else

#ifdef __CUDA_ARCH__
#include <cuda_fp16.h>
#endif

typedef half f16;

#endif

// Some of these functions convert to single precision because half
// precision versions are not available.

SCALAR_FUN_ATTR f16 fadd16(f16 x, f16 y) {
  return x + y;
}

SCALAR_FUN_ATTR f16 fsub16(f16 x, f16 y) {
  return x - y;
}

SCALAR_FUN_ATTR f16 fmul16(f16 x, f16 y) {
  return x * y;
}

SCALAR_FUN_ATTR bool cmplt16(f16 x, f16 y) {
  return x < y;
}

SCALAR_FUN_ATTR bool cmple16(f16 x, f16 y) {
  return x <= y;
}

SCALAR_FUN_ATTR f16 sitofp_i8_f16(int8_t x) {
  return (f16) x;
}

SCALAR_FUN_ATTR f16 sitofp_i16_f16(int16_t x) {
  return (f16) x;
}

SCALAR_FUN_ATTR f16 sitofp_i32_f16(int32_t x) {
  return (f16) x;
}

SCALAR_FUN_ATTR f16 sitofp_i64_f16(int64_t x) {
  return (f16) x;
}

SCALAR_FUN_ATTR f16 uitofp_i8_f16(uint8_t x) {
  return (f16) x;
}

SCALAR_FUN_ATTR f16 uitofp_i16_f16(uint16_t x) {
  return (f16) x;
}

SCALAR_FUN_ATTR f16 uitofp_i32_f16(uint32_t x) {
  return (f16) x;
}

SCALAR_FUN_ATTR f16 uitofp_i64_f16(uint64_t x) {
  return (f16) x;
}

SCALAR_FUN_ATTR int8_t fptosi_f16_i8(f16 x) {
  return (int8_t) (float) x;
}

SCALAR_FUN_ATTR int16_t fptosi_f16_i16(f16 x) {
  return (int16_t) x;
}

SCALAR_FUN_ATTR int32_t fptosi_f16_i32(f16 x) {
  return (int32_t) x;
}

SCALAR_FUN_ATTR int64_t fptosi_f16_i64(f16 x) {
  return (int64_t) x;
}

SCALAR_FUN_ATTR uint8_t fptoui_f16_i8(f16 x) {
  return (uint8_t) (float) x;
}

SCALAR_FUN_ATTR uint16_t fptoui_f16_i16(f16 x) {
  return (uint16_t) x;
}

SCALAR_FUN_ATTR uint32_t fptoui_f16_i32(f16 x) {
  return (uint32_t) x;
}

SCALAR_FUN_ATTR uint64_t fptoui_f16_i64(f16 x) {
  return (uint64_t) x;
}

SCALAR_FUN_ATTR bool ftob_f16_bool(f16 x) {
  return x != (f16)0;
}

SCALAR_FUN_ATTR f16 btof_bool_f16(bool x) {
  return x ? 1 : 0;
}

#ifndef EMULATE_F16
SCALAR_FUN_ATTR bool futrts_isnan16(f16 x) {
  return isnan((float)x);
}

#ifdef __OPENCL_VERSION__

SCALAR_FUN_ATTR f16 fabs16(f16 x) {
  return fabs(x);
}

SCALAR_FUN_ATTR f16 fmax16(f16 x, f16 y) {
  return fmax(x, y);
}

SCALAR_FUN_ATTR f16 fmin16(f16 x, f16 y) {
  return fmin(x, y);
}

SCALAR_FUN_ATTR f16 fpow16(f16 x, f16 y) {
  return pow(x, y);
}

#elif ISPC
SCALAR_FUN_ATTR f16 fabs16(f16 x) {
  return abs(x);
}

SCALAR_FUN_ATTR f16 fmax16(f16 x, f16 y) {
  return futrts_isnan16(x) ? y : futrts_isnan16(y) ? x : max(x, y);
}

SCALAR_FUN_ATTR f16 fmin16(f16 x, f16 y) {
  return futrts_isnan16(x) ? y : futrts_isnan16(y) ? x : min(x, y);
}

SCALAR_FUN_ATTR f16 fpow16(f16 x, f16 y) {
  return pow(x, y);
}

#else // Assuming CUDA.

SCALAR_FUN_ATTR f16 fabs16(f16 x) {
  return fabsf(x);
}

SCALAR_FUN_ATTR f16 fmax16(f16 x, f16 y) {
  return fmaxf(x, y);
}

SCALAR_FUN_ATTR f16 fmin16(f16 x, f16 y) {
  return fminf(x, y);
}

SCALAR_FUN_ATTR f16 fpow16(f16 x, f16 y) {
  return powf(x, y);
}
#endif

#if ISPC
SCALAR_FUN_ATTR bool futrts_isinf16(float x) {
  return !futrts_isnan16(x) && futrts_isnan16(x - x);
}
SCALAR_FUN_ATTR bool futrts_isfinite16(float x) {
  return !futrts_isnan16(x) && !futrts_isinf16(x);
}

#else

SCALAR_FUN_ATTR bool futrts_isinf16(f16 x) {
  return isinf((float)x);
}
#endif

#ifdef __OPENCL_VERSION__
SCALAR_FUN_ATTR f16 futrts_log16(f16 x) {
  return log(x);
}

SCALAR_FUN_ATTR f16 futrts_log2_16(f16 x) {
  return log2(x);
}

SCALAR_FUN_ATTR f16 futrts_log10_16(f16 x) {
  return log10(x);
}

SCALAR_FUN_ATTR f16 futrts_log1p_16(f16 x) {
  return log1p(x);
}

SCALAR_FUN_ATTR f16 futrts_sqrt16(f16 x) {
  return sqrt(x);
}

SCALAR_FUN_ATTR f16 futrts_cbrt16(f16 x) {
  return cbrt(x);
}

SCALAR_FUN_ATTR f16 futrts_exp16(f16 x) {
  return exp(x);
}

SCALAR_FUN_ATTR f16 futrts_cos16(f16 x) {
  return cos(x);
}

SCALAR_FUN_ATTR f16 futrts_sin16(f16 x) {
  return sin(x);
}

SCALAR_FUN_ATTR f16 futrts_tan16(f16 x) {
  return tan(x);
}

SCALAR_FUN_ATTR f16 futrts_acos16(f16 x) {
  return acos(x);
}

SCALAR_FUN_ATTR f16 futrts_asin16(f16 x) {
  return asin(x);
}

SCALAR_FUN_ATTR f16 futrts_atan16(f16 x) {
  return atan(x);
}

SCALAR_FUN_ATTR f16 futrts_cosh16(f16 x) {
  return cosh(x);
}

SCALAR_FUN_ATTR f16 futrts_sinh16(f16 x) {
  return sinh(x);
}

SCALAR_FUN_ATTR f16 futrts_tanh16(f16 x) {
  return tanh(x);
}

SCALAR_FUN_ATTR f16 futrts_acosh16(f16 x) {
  return acosh(x);
}

SCALAR_FUN_ATTR f16 futrts_asinh16(f16 x) {
  return asinh(x);
}

SCALAR_FUN_ATTR f16 futrts_atanh16(f16 x) {
  return atanh(x);
}

SCALAR_FUN_ATTR f16 futrts_atan2_16(f16 x, f16 y) {
  return atan2(x, y);
}

SCALAR_FUN_ATTR f16 futrts_hypot16(f16 x, f16 y) {
  return hypot(x, y);
}

SCALAR_FUN_ATTR f16 futrts_gamma16(f16 x) {
  return tgamma(x);
}

SCALAR_FUN_ATTR f16 futrts_lgamma16(f16 x) {
  return lgamma(x);
}

SCALAR_FUN_ATTR f16 futrts_erf16(f16 x) {
  return erf(x);
}

SCALAR_FUN_ATTR f16 futrts_erfc16(f16 x) {
  return erfc(x);
}

SCALAR_FUN_ATTR f16 fmod16(f16 x, f16 y) {
  return fmod(x, y);
}

SCALAR_FUN_ATTR f16 futrts_round16(f16 x) {
  return rint(x);
}

SCALAR_FUN_ATTR f16 futrts_floor16(f16 x) {
  return floor(x);
}

SCALAR_FUN_ATTR f16 futrts_ceil16(f16 x) {
  return ceil(x);
}

SCALAR_FUN_ATTR f16 futrts_nextafter16(f16 x, f16 y) {
  return nextafter(x, y);
}

SCALAR_FUN_ATTR f16 futrts_lerp16(f16 v0, f16 v1, f16 t) {
  return mix(v0, v1, t);
}

SCALAR_FUN_ATTR f16 futrts_ldexp16(f16 x, int32_t y) {
  return ldexp(x, y);
}

SCALAR_FUN_ATTR f16 futrts_copysign16(f16 x, f16 y) {
  return copysign(x, y);
}

SCALAR_FUN_ATTR f16 futrts_mad16(f16 a, f16 b, f16 c) {
  return mad(a, b, c);
}

SCALAR_FUN_ATTR f16 futrts_fma16(f16 a, f16 b, f16 c) {
  return fma(a, b, c);
}
#elif ISPC

SCALAR_FUN_ATTR f16 futrts_log16(f16 x) {
  return futrts_isfinite16(x) || (futrts_isinf16(x) && x < 0) ? log(x) : x;
}

SCALAR_FUN_ATTR f16 futrts_log2_16(f16 x) {
  return futrts_log16(x) / log(2.0f16);
}

SCALAR_FUN_ATTR f16 futrts_log10_16(f16 x) {
  return futrts_log16(x) / log(10.0f16);
}

SCALAR_FUN_ATTR f16 futrts_log1p_16(f16 x) {
  if(x == -1.0f16 || (futrts_isinf16(x) && x > 0.0f16)) return x / 0.0f16;
  f16 y = 1.0f16 + x;
  f16 z = y - 1.0f16;
  return log(y) - (z-x)/y;
}

SCALAR_FUN_ATTR f16 futrts_sqrt16(f16 x) {
  return (float16)sqrt((float)x);
}

SCALAR_FUN_ATTR f16 futrts_exp16(f16 x) {
  return exp(x);
}

SCALAR_FUN_ATTR f16 futrts_cos16(f16 x) {
  return (float16)cos((float)x);
}

SCALAR_FUN_ATTR f16 futrts_sin16(f16 x) {
  return (float16)sin((float)x);
}

SCALAR_FUN_ATTR f16 futrts_tan16(f16 x) {
  return (float16)tan((float)x);
}

SCALAR_FUN_ATTR f16 futrts_acos16(f16 x) {
  return (float16)acos((float)x);
}

SCALAR_FUN_ATTR f16 futrts_asin16(f16 x) {
  return (float16)asin((float)x);
}

SCALAR_FUN_ATTR f16 futrts_atan16(f16 x) {
  return (float16)atan((float)x);
}

SCALAR_FUN_ATTR f16 futrts_cosh16(f16 x) {
  return (exp(x)+exp(-x)) / 2.0f16;
}

SCALAR_FUN_ATTR f16 futrts_sinh16(f16 x) {
  return (exp(x)-exp(-x)) / 2.0f16;
}

SCALAR_FUN_ATTR f16 futrts_tanh16(f16 x) {
  return futrts_sinh16(x)/futrts_cosh16(x);
}

SCALAR_FUN_ATTR f16 futrts_acosh16(f16 x) {
  float16 f = x+(float16)sqrt((float)(x*x-1));
  if(futrts_isfinite16(f)) return log(f);
  return f;
}

SCALAR_FUN_ATTR f16 futrts_asinh16(f16 x) {
  float16 f = x+(float16)sqrt((float)(x*x+1));
  if(futrts_isfinite16(f)) return log(f);
  return f;
}

SCALAR_FUN_ATTR f16 futrts_atanh16(f16 x) {
  float16 f = (1+x)/(1-x);
  if(futrts_isfinite16(f)) return log(f)/2.0f16;
  return f;
}

SCALAR_FUN_ATTR f16 futrts_atan2_16(f16 x, f16 y) {
  return (float16)atan2((float)x, (float)y);
}

SCALAR_FUN_ATTR f16 futrts_hypot16(f16 x, f16 y) {
  return (float16)futrts_hypot32((float)x, (float)y);
}

extern "C" unmasked uniform float tgammaf(uniform float x);
SCALAR_FUN_ATTR f16 futrts_gamma16(f16 x) {
  f16 res;
  foreach_active (i) {
    uniform f16 r = (f16)tgammaf(extract((float)x, i));
    res = insert(res, i, r);
  }
  return res;
}

extern "C" unmasked uniform float lgammaf(uniform float x);
SCALAR_FUN_ATTR f16 futrts_lgamma16(f16 x) {
  f16 res;
  foreach_active (i) {
    uniform f16 r = (f16)lgammaf(extract((float)x, i));
    res = insert(res, i, r);
  }
  return res;
}

SCALAR_FUN_ATTR f16 futrts_cbrt16(f16 x) {
  f16 res = (f16)futrts_cbrt32((float)x);
  return res;
}

SCALAR_FUN_ATTR f16 futrts_erf16(f16 x) {
  f16 res = (f16)futrts_erf32((float)x);
  return res;
}

SCALAR_FUN_ATTR f16 futrts_erfc16(f16 x) {
  f16 res = (f16)futrts_erfc32((float)x);
  return res;
}

SCALAR_FUN_ATTR f16 fmod16(f16 x, f16 y) {
  return x - y * (float16)trunc((float) (x/y));
}

SCALAR_FUN_ATTR f16 futrts_round16(f16 x) {
  return (float16)round((float)x);
}

SCALAR_FUN_ATTR f16 futrts_floor16(f16 x) {
  return (float16)floor((float)x);
}

SCALAR_FUN_ATTR f16 futrts_ceil16(f16 x) {
  return (float16)ceil((float)x);
}

SCALAR_FUN_ATTR f16 futrts_nextafter16(f16 x, f16 y) {
  return (float16)futrts_nextafter32((float)x, (float) y);
}

SCALAR_FUN_ATTR f16 futrts_lerp16(f16 v0, f16 v1, f16 t) {
  return v0 + (v1 - v0) * t;
}

SCALAR_FUN_ATTR f16 futrts_ldexp16(f16 x, int32_t y) {
  return futrts_ldexp32((float)x, y);
}

SCALAR_FUN_ATTR f16 futrts_copysign16(f16 x, f16 y) {
  return futrts_copysign32((float)x, y);
}

SCALAR_FUN_ATTR f16 futrts_mad16(f16 a, f16 b, f16 c) {
  return a * b + c;
}

SCALAR_FUN_ATTR f16 futrts_fma16(f16 a, f16 b, f16 c) {
  return a * b + c;
}

#else // Assume CUDA.

SCALAR_FUN_ATTR f16 futrts_log16(f16 x) {
  return hlog(x);
}

SCALAR_FUN_ATTR f16 futrts_log2_16(f16 x) {
  return hlog2(x);
}

SCALAR_FUN_ATTR f16 futrts_log10_16(f16 x) {
  return hlog10(x);
}

SCALAR_FUN_ATTR f16 futrts_log1p_16(f16 x) {
  return (f16)log1pf((float)x);
}

SCALAR_FUN_ATTR f16 futrts_sqrt16(f16 x) {
  return hsqrt(x);
}

SCALAR_FUN_ATTR f16 futrts_cbrt16(f16 x) {
  return cbrtf(x);
}

SCALAR_FUN_ATTR f16 futrts_exp16(f16 x) {
  return hexp(x);
}

SCALAR_FUN_ATTR f16 futrts_cos16(f16 x) {
  return hcos(x);
}

SCALAR_FUN_ATTR f16 futrts_sin16(f16 x) {
  return hsin(x);
}

SCALAR_FUN_ATTR f16 futrts_tan16(f16 x) {
  return tanf(x);
}

SCALAR_FUN_ATTR f16 futrts_acos16(f16 x) {
  return acosf(x);
}

SCALAR_FUN_ATTR f16 futrts_asin16(f16 x) {
  return asinf(x);
}

SCALAR_FUN_ATTR f16 futrts_atan16(f16 x) {
  return atanf(x);
}

SCALAR_FUN_ATTR f16 futrts_cosh16(f16 x) {
  return coshf(x);
}

SCALAR_FUN_ATTR f16 futrts_sinh16(f16 x) {
  return sinhf(x);
}

SCALAR_FUN_ATTR f16 futrts_tanh16(f16 x) {
  return tanhf(x);
}

SCALAR_FUN_ATTR f16 futrts_acosh16(f16 x) {
  return acoshf(x);
}

SCALAR_FUN_ATTR f16 futrts_asinh16(f16 x) {
  return asinhf(x);
}

SCALAR_FUN_ATTR f16 futrts_atanh16(f16 x) {
  return atanhf(x);
}

SCALAR_FUN_ATTR f16 futrts_atan2_16(f16 x, f16 y) {
  return atan2f(x, y);
}

SCALAR_FUN_ATTR f16 futrts_hypot16(f16 x, f16 y) {
  return hypotf(x, y);
}

SCALAR_FUN_ATTR f16 futrts_gamma16(f16 x) {
  return tgammaf(x);
}

SCALAR_FUN_ATTR f16 futrts_lgamma16(f16 x) {
  return lgammaf(x);
}

SCALAR_FUN_ATTR f16 futrts_erf16(f16 x) {
  return erff(x);
}

SCALAR_FUN_ATTR f16 futrts_erfc16(f16 x) {
  return erfcf(x);
}

SCALAR_FUN_ATTR f16 fmod16(f16 x, f16 y) {
  return fmodf(x, y);
}

SCALAR_FUN_ATTR f16 futrts_round16(f16 x) {
  return rintf(x);
}

SCALAR_FUN_ATTR f16 futrts_floor16(f16 x) {
  return hfloor(x);
}

SCALAR_FUN_ATTR f16 futrts_ceil16(f16 x) {
  return hceil(x);
}

SCALAR_FUN_ATTR f16 futrts_nextafter16(f16 x, f16 y) {
  return __ushort_as_half(halfbitsnextafter(__half_as_ushort(x), __half_as_ushort(y)));
}

SCALAR_FUN_ATTR f16 futrts_lerp16(f16 v0, f16 v1, f16 t) {
  return v0 + (v1 - v0) * t;
}

SCALAR_FUN_ATTR f16 futrts_ldexp16(f16 x, int32_t y) {
  return futrts_ldexp32((float)x, y);
}

SCALAR_FUN_ATTR f16 futrts_copysign16(f16 x, f16 y) {
  return futrts_copysign32((float)x, y);
}

SCALAR_FUN_ATTR f16 futrts_mad16(f16 a, f16 b, f16 c) {
  return a * b + c;
}

SCALAR_FUN_ATTR f16 futrts_fma16(f16 a, f16 b, f16 c) {
  return fmaf(a, b, c);
}

#endif

// The CUDA __half type cannot be put in unions for some reason, so we
// use bespoke conversion functions instead.
#ifdef __CUDA_ARCH__
SCALAR_FUN_ATTR int16_t futrts_to_bits16(f16 x) {
  return __half_as_ushort(x);
}
SCALAR_FUN_ATTR f16 futrts_from_bits16(int16_t x) {
  return __ushort_as_half(x);
}
#elif ISPC

SCALAR_FUN_ATTR int16_t futrts_to_bits16(f16 x) {
  varying int16_t y = *((varying int16_t * uniform)&x);
  return y;
}

SCALAR_FUN_ATTR f16 futrts_from_bits16(int16_t x) {
  varying f16 y = *((varying f16 * uniform)&x);
  return y;
}
#else
SCALAR_FUN_ATTR int16_t futrts_to_bits16(f16 x) {
  union {
    f16 f;
    int16_t t;
  } p;

  p.f = x;
  return p.t;
}

SCALAR_FUN_ATTR f16 futrts_from_bits16(int16_t x) {
  union {
    int16_t f;
    f16 t;
  } p;

  p.f = x;
  return p.t;
}
#endif

#else // No native f16 - emulate.

SCALAR_FUN_ATTR f16 fabs16(f16 x) {
  return fabs32(x);
}

SCALAR_FUN_ATTR f16 fmax16(f16 x, f16 y) {
  return fmax32(x, y);
}

SCALAR_FUN_ATTR f16 fmin16(f16 x, f16 y) {
  return fmin32(x, y);
}

SCALAR_FUN_ATTR f16 fpow16(f16 x, f16 y) {
  return fpow32(x, y);
}

SCALAR_FUN_ATTR bool futrts_isnan16(f16 x) {
  return futrts_isnan32(x);
}

SCALAR_FUN_ATTR bool futrts_isinf16(f16 x) {
  return futrts_isinf32(x);
}

SCALAR_FUN_ATTR f16 futrts_log16(f16 x) {
  return futrts_log32(x);
}

SCALAR_FUN_ATTR f16 futrts_log2_16(f16 x) {
  return futrts_log2_32(x);
}

SCALAR_FUN_ATTR f16 futrts_log10_16(f16 x) {
  return futrts_log10_32(x);
}

SCALAR_FUN_ATTR f16 futrts_log1p_16(f16 x) {
  return futrts_log1p_32(x);
}

SCALAR_FUN_ATTR f16 futrts_sqrt16(f16 x) {
  return futrts_sqrt32(x);
}

SCALAR_FUN_ATTR f16 futrts_cbrt16(f16 x) {
  return futrts_cbrt32(x);
}

SCALAR_FUN_ATTR f16 futrts_exp16(f16 x) {
  return futrts_exp32(x);
}

SCALAR_FUN_ATTR f16 futrts_cos16(f16 x) {
  return futrts_cos32(x);
}

SCALAR_FUN_ATTR f16 futrts_sin16(f16 x) {
  return futrts_sin32(x);
}

SCALAR_FUN_ATTR f16 futrts_tan16(f16 x) {
  return futrts_tan32(x);
}

SCALAR_FUN_ATTR f16 futrts_acos16(f16 x) {
  return futrts_acos32(x);
}

SCALAR_FUN_ATTR f16 futrts_asin16(f16 x) {
  return futrts_asin32(x);
}

SCALAR_FUN_ATTR f16 futrts_atan16(f16 x) {
  return futrts_atan32(x);
}

SCALAR_FUN_ATTR f16 futrts_cosh16(f16 x) {
  return futrts_cosh32(x);
}

SCALAR_FUN_ATTR f16 futrts_sinh16(f16 x) {
  return futrts_sinh32(x);
}

SCALAR_FUN_ATTR f16 futrts_tanh16(f16 x) {
  return futrts_tanh32(x);
}

SCALAR_FUN_ATTR f16 futrts_acosh16(f16 x) {
  return futrts_acosh32(x);
}

SCALAR_FUN_ATTR f16 futrts_asinh16(f16 x) {
  return futrts_asinh32(x);
}

SCALAR_FUN_ATTR f16 futrts_atanh16(f16 x) {
  return futrts_atanh32(x);
}

SCALAR_FUN_ATTR f16 futrts_atan2_16(f16 x, f16 y) {
  return futrts_atan2_32(x, y);
}

SCALAR_FUN_ATTR f16 futrts_hypot16(f16 x, f16 y) {
  return futrts_hypot32(x, y);
}

SCALAR_FUN_ATTR f16 futrts_gamma16(f16 x) {
  return futrts_gamma32(x);
}

SCALAR_FUN_ATTR f16 futrts_lgamma16(f16 x) {
  return futrts_lgamma32(x);
}

SCALAR_FUN_ATTR f16 futrts_erf16(f16 x) {
  return futrts_erf32(x);
}

SCALAR_FUN_ATTR f16 futrts_erfc16(f16 x) {
  return futrts_erfc32(x);
}

SCALAR_FUN_ATTR f16 fmod16(f16 x, f16 y) {
  return fmod32(x, y);
}

SCALAR_FUN_ATTR f16 futrts_round16(f16 x) {
  return futrts_round32(x);
}

SCALAR_FUN_ATTR f16 futrts_floor16(f16 x) {
  return futrts_floor32(x);
}

SCALAR_FUN_ATTR f16 futrts_ceil16(f16 x) {
  return futrts_ceil32(x);
}

SCALAR_FUN_ATTR f16 futrts_nextafter16(f16 x, f16 y) {
  return halfbits2float(halfbitsnextafter(float2halfbits(x), float2halfbits(y)));
}

SCALAR_FUN_ATTR f16 futrts_lerp16(f16 v0, f16 v1, f16 t) {
  return futrts_lerp32(v0, v1, t);
}

SCALAR_FUN_ATTR f16 futrts_ldexp16(f16 x, int32_t y) {
  return futrts_ldexp32(x, y);
}

SCALAR_FUN_ATTR f16 futrts_copysign16(f16 x, f16 y) {
  return futrts_copysign32((float)x, y);
}

SCALAR_FUN_ATTR f16 futrts_mad16(f16 a, f16 b, f16 c) {
  return futrts_mad32(a, b, c);
}

SCALAR_FUN_ATTR f16 futrts_fma16(f16 a, f16 b, f16 c) {
  return futrts_fma32(a, b, c);
}

// Even when we are using an OpenCL that does not support cl_khr_fp16,
// it must still support vload_half for actually creating a
// half-precision number, which can then be efficiently converted to a
// float.  Similarly for vstore_half.
#ifdef __OPENCL_VERSION__

SCALAR_FUN_ATTR int16_t futrts_to_bits16(f16 x) {
  int16_t y;
  // Violating strict aliasing here.
  vstore_half((float)x, 0, (half*)&y);
  return y;
}

SCALAR_FUN_ATTR f16 futrts_from_bits16(int16_t x) {
  return (f16)vload_half(0, (half*)&x);
}

#else

SCALAR_FUN_ATTR int16_t futrts_to_bits16(f16 x) {
  return (int16_t)float2halfbits(x);
}

SCALAR_FUN_ATTR f16 futrts_from_bits16(int16_t x) {
  return halfbits2float((uint16_t)x);
}

SCALAR_FUN_ATTR f16 fsignum16(f16 x) {
  return futrts_isnan16(x) ? x : (x > 0 ? 1 : 0) - (x < 0 ? 1 : 0);
}

#endif

#endif

SCALAR_FUN_ATTR float fpconv_f16_f16(f16 x) {
  return x;
}

SCALAR_FUN_ATTR float fpconv_f16_f32(f16 x) {
  return x;
}

SCALAR_FUN_ATTR f16 fpconv_f32_f16(float x) {
  return (f16) x;
}

#ifdef FUTHARK_F64_ENABLED

SCALAR_FUN_ATTR double fpconv_f16_f64(f16 x) {
  return (double) x;
}

#if ISPC
SCALAR_FUN_ATTR f16 fpconv_f64_f16(double x) {
  return (f16) ((float)x);
}
#else
SCALAR_FUN_ATTR f16 fpconv_f64_f16(double x) {
  return (f16) x;
}
#endif
#endif


// End of scalar_f16.h.

// Start of context_prototypes.h
//
// Prototypes for the functions in context.h, or that will be called
// from those functions, that need to be available very early.

struct futhark_context_config;
struct futhark_context;

static void set_error(struct futhark_context* ctx, char *error);

// These are called in context/config new/free functions and contain
// shared setup.  They are generated by the compiler itself.
static int init_constants(struct futhark_context*);
static int free_constants(struct futhark_context*);
static void setup_program(struct futhark_context* ctx);
static void teardown_program(struct futhark_context *ctx);

// Allocate host memory.  Must be freed with host_free().
static void host_alloc(struct futhark_context* ctx, size_t size, const char* tag, size_t* size_out, void** mem_out);
// Allocate memory allocated with host_alloc().
static void host_free(struct futhark_context* ctx, size_t size, const char* tag, void* mem);

// Log that a copy has occurred.
static void log_copy(struct futhark_context* ctx,
                     const char *kind, int r,
                     int64_t dst_offset, int64_t dst_strides[r],
                     int64_t src_offset, int64_t src_strides[r],
                     int64_t shape[r]);

static void log_transpose(struct futhark_context* ctx,
                          int64_t k, int64_t m, int64_t n);

static bool lmad_map_tr(int64_t *num_arrays_out, int64_t *n_out, int64_t *m_out,
                        int r,
                        const int64_t dst_strides[r],
                        const int64_t src_strides[r],
                        const int64_t shape[r]);

static bool lmad_contiguous(int r, int64_t strides[r], int64_t shape[r]);

static bool lmad_memcpyable(int r,
                            int64_t dst_strides[r], int64_t src_strides[r], int64_t shape[r]);

static void add_event(struct futhark_context* ctx,
                      const char* name,
                      char* description,
                      void* data,
                      event_report_fn f);

// Functions that must be defined by the backend.
static void backend_context_config_setup(struct futhark_context_config* cfg);
static void backend_context_config_teardown(struct futhark_context_config* cfg);
static int backend_context_setup(struct futhark_context *ctx);
static void backend_context_teardown(struct futhark_context *ctx);

// End of of context_prototypes.h

struct memblock_device {
    int *references;
    CUdeviceptr mem;
    int64_t size;
    const char *desc;
};
struct memblock {
    int *references;
    unsigned char *mem;
    int64_t size;
    const char *desc;
};
struct constants {
    int dummy;
    struct memblock_device counters_mem_50201;
    struct memblock_device counters_mem_50275;
    struct memblock_device counters_mem_50707;
    struct memblock_device counters_mem_51122;
    struct memblock_device counters_mem_51145;
    struct memblock_device counters_mem_51184;
    struct memblock_device counters_mem_51873;
    struct memblock_device counters_mem_52032;
    struct memblock_device global_dynid_mem_50266;
    struct memblock_device global_dynid_mem_50275;
    struct memblock_device global_dynid_mem_50287;
    struct memblock_device global_dynid_mem_50292;
    struct memblock_device global_dynid_mem_50450;
    struct memblock_device global_dynid_mem_50529;
    struct memblock_device global_dynid_mem_50570;
    struct memblock_device global_dynid_mem_50733;
    struct memblock_device global_dynid_mem_50769;
    struct memblock_device global_dynid_mem_50871;
    struct memblock_device global_dynid_mem_50875;
    struct memblock_device global_dynid_mem_50988;
    struct memblock_device global_dynid_mem_51231;
    struct memblock_device global_dynid_mem_51378;
    struct memblock_device global_dynid_mem_51534;
    struct memblock_device global_dynid_mem_51651;
};
struct tuning_params {
    int dummy;
    int64_t *add_next_partition_doublezisegmap_num_tblocks_43891;
    int64_t *add_next_partition_doublezisegmap_num_tblocks_44190;
    int64_t *add_next_partition_doublezisegmap_num_tblocks_44206;
    int64_t *add_next_partition_doublezisegmap_tblock_sizze_43112;
    int64_t *add_next_partition_doublezisegmap_tblock_sizze_43450;
    int64_t *add_next_partition_doublezisegmap_tblock_sizze_43527;
    int64_t *add_next_partition_doublezisegmap_tblock_sizze_43889;
    int64_t *add_next_partition_doublezisegmap_tblock_sizze_44086;
    int64_t *add_next_partition_doublezisegmap_tblock_sizze_44188;
    int64_t *add_next_partition_doublezisegmap_tblock_sizze_44204;
    int64_t *add_next_partition_doublezisegmap_tblock_sizze_44212;
    int64_t *add_next_partition_doublezisegmap_tblock_sizze_44289;
    int64_t *add_next_partition_doublezisegred_num_tblocks_43504;
    int64_t *add_next_partition_doublezisegred_num_tblocks_43991;
    int64_t *add_next_partition_doublezisegred_tblock_sizze_43502;
    int64_t *add_next_partition_doublezisegred_tblock_sizze_43989;
    int64_t *add_next_partition_doublezisegscan_num_tblocks_43142;
    int64_t *add_next_partition_doublezisegscan_num_tblocks_43633;
    int64_t *add_next_partition_doublezisegscan_num_tblocks_44180;
    int64_t *add_next_partition_doublezisegscan_num_tblocks_44196;
    int64_t *add_next_partition_doublezisegscan_tblock_sizze_43140;
    int64_t *add_next_partition_doublezisegscan_tblock_sizze_43631;
    int64_t *add_next_partition_doublezisegscan_tblock_sizze_44178;
    int64_t *add_next_partition_doublezisegscan_tblock_sizze_44194;
    int64_t *add_next_partition_doublezisuff_intra_par_2;
    int64_t *add_next_partition_doublezisuff_outer_par_1;
    int64_t *add_next_partition_doublezisuff_outer_par_3;
    int64_t *add_next_partition_doublezisuff_outer_screma_0;
    int64_t *add_next_partition_doublezitile_sizze_46536;
    int64_t *add_next_partition_doublezitile_sizze_46784;
    int64_t *builtinzhiota_i64zitblock_sizze_50384;
    int64_t *builtinzhreplicate_boolzitblock_sizze_51025;
    int64_t *builtinzhreplicate_f64zitblock_sizze_50459;
    int64_t *builtinzhreplicate_i32zitblock_sizze_50286;
    int64_t *builtinzhreplicate_i64zitblock_sizze_50201;
    int64_t *builtinzhreplicate_i8zitblock_sizze_50251;
    int64_t *do_DBSCAN_doublezisegmap_num_tblocks_44359;
    int64_t *do_DBSCAN_doublezisegmap_num_tblocks_44375;
    int64_t *do_DBSCAN_doublezisegmap_num_tblocks_44391;
    int64_t *do_DBSCAN_doublezisegmap_num_tblocks_44407;
    int64_t *do_DBSCAN_doublezisegmap_num_tblocks_44415;
    int64_t *do_DBSCAN_doublezisegmap_num_tblocks_44453;
    int64_t *do_DBSCAN_doublezisegmap_num_tblocks_44809;
    int64_t *do_DBSCAN_doublezisegmap_num_tblocks_45222;
    int64_t *do_DBSCAN_doublezisegmap_num_tblocks_45667;
    int64_t *do_DBSCAN_doublezisegmap_num_tblocks_45683;
    int64_t *do_DBSCAN_doublezisegmap_tblock_sizze_44357;
    int64_t *do_DBSCAN_doublezisegmap_tblock_sizze_44373;
    int64_t *do_DBSCAN_doublezisegmap_tblock_sizze_44389;
    int64_t *do_DBSCAN_doublezisegmap_tblock_sizze_44405;
    int64_t *do_DBSCAN_doublezisegmap_tblock_sizze_44413;
    int64_t *do_DBSCAN_doublezisegmap_tblock_sizze_44421;
    int64_t *do_DBSCAN_doublezisegmap_tblock_sizze_44451;
    int64_t *do_DBSCAN_doublezisegmap_tblock_sizze_44626;
    int64_t *do_DBSCAN_doublezisegmap_tblock_sizze_44727;
    int64_t *do_DBSCAN_doublezisegmap_tblock_sizze_44753;
    int64_t *do_DBSCAN_doublezisegmap_tblock_sizze_44789;
    int64_t *do_DBSCAN_doublezisegmap_tblock_sizze_44807;
    int64_t *do_DBSCAN_doublezisegmap_tblock_sizze_45220;
    int64_t *do_DBSCAN_doublezisegmap_tblock_sizze_45349;
    int64_t *do_DBSCAN_doublezisegmap_tblock_sizze_45575;
    int64_t *do_DBSCAN_doublezisegmap_tblock_sizze_45665;
    int64_t *do_DBSCAN_doublezisegmap_tblock_sizze_45681;
    int64_t *do_DBSCAN_doublezisegmap_tblock_sizze_45869;
    int64_t *do_DBSCAN_doublezisegred_num_tblocks_44576;
    int64_t *do_DBSCAN_doublezisegred_num_tblocks_44709;
    int64_t *do_DBSCAN_doublezisegred_num_tblocks_45519;
    int64_t *do_DBSCAN_doublezisegred_num_tblocks_45813;
    int64_t *do_DBSCAN_doublezisegred_tblock_sizze_44574;
    int64_t *do_DBSCAN_doublezisegred_tblock_sizze_44707;
    int64_t *do_DBSCAN_doublezisegred_tblock_sizze_45517;
    int64_t *do_DBSCAN_doublezisegred_tblock_sizze_45811;
    int64_t *do_DBSCAN_doublezisegscan_num_tblocks_44349;
    int64_t *do_DBSCAN_doublezisegscan_num_tblocks_44365;
    int64_t *do_DBSCAN_doublezisegscan_num_tblocks_44381;
    int64_t *do_DBSCAN_doublezisegscan_num_tblocks_44397;
    int64_t *do_DBSCAN_doublezisegscan_num_tblocks_44443;
    int64_t *do_DBSCAN_doublezisegscan_num_tblocks_44459;
    int64_t *do_DBSCAN_doublezisegscan_num_tblocks_44719;
    int64_t *do_DBSCAN_doublezisegscan_num_tblocks_44846;
    int64_t *do_DBSCAN_doublezisegscan_num_tblocks_45106;
    int64_t *do_DBSCAN_doublezisegscan_num_tblocks_45673;
    int64_t *do_DBSCAN_doublezisegscan_tblock_sizze_44347;
    int64_t *do_DBSCAN_doublezisegscan_tblock_sizze_44363;
    int64_t *do_DBSCAN_doublezisegscan_tblock_sizze_44379;
    int64_t *do_DBSCAN_doublezisegscan_tblock_sizze_44395;
    int64_t *do_DBSCAN_doublezisegscan_tblock_sizze_44441;
    int64_t *do_DBSCAN_doublezisegscan_tblock_sizze_44457;
    int64_t *do_DBSCAN_doublezisegscan_tblock_sizze_44717;
    int64_t *do_DBSCAN_doublezisegscan_tblock_sizze_44844;
    int64_t *do_DBSCAN_doublezisegscan_tblock_sizze_45104;
    int64_t *do_DBSCAN_doublezisegscan_tblock_sizze_45671;
    int64_t *do_DBSCAN_doublezisuff_outer_par_0;
    int64_t *do_DBSCAN_doublezisuff_outer_par_2;
    int64_t *do_DBSCAN_doublezisuff_outer_par_3;
    int64_t *do_DBSCAN_doublezisuff_outer_par_4;
    int64_t *do_DBSCAN_doublezisuff_outer_par_5;
    int64_t *do_DBSCAN_doublezisuff_outer_screma_1;
    int64_t *do_DBSCAN_doublezitile_sizze_46536;
    int64_t *do_DBSCAN_doublezitile_sizze_46916;
    int64_t *do_DBSCAN_doublezitile_sizze_47271;
    int64_t *do_DBSCAN_doublezitile_sizze_47626;
    int64_t *do_DBSCAN_doublezitile_sizze_47885;
    int64_t *do_DBSCAN_doublezitile_sizze_48144;
    int64_t *do_DBSCAN_doublezitile_sizze_48553;
    int64_t *get_num_neighbours_against_9632zisegmap_tblock_sizze_46112;
    int64_t *get_num_neighbours_against_9632zisegred_num_tblocks_46064;
    int64_t *get_num_neighbours_against_9632zisegred_tblock_sizze_46062;
    int64_t *get_num_neighbours_against_9632zisuff_outer_par_0;
    int64_t *get_num_neighbours_against_9632zitile_sizze_46536;
    int64_t *get_num_neighbours_against_9635zisegmap_tblock_sizze_46346;
    int64_t *get_num_neighbours_against_9635zisegred_num_tblocks_46298;
    int64_t *get_num_neighbours_against_9635zisegred_tblock_sizze_46296;
    int64_t *get_num_neighbours_against_9635zisuff_outer_par_0;
    int64_t *get_num_neighbours_against_9635zitile_sizze_46536;
    int64_t *make_collisions_compact_doublezisegmap_num_tblocks_43001;
    int64_t *make_collisions_compact_doublezisegmap_tblock_sizze_42999;
    int64_t *make_collisions_compact_doublezisegscan_num_tblocks_42991;
    int64_t *make_collisions_compact_doublezisegscan_tblock_sizze_42989;
    int64_t *make_collisions_compact_doublezisuff_outer_par_0;
    int64_t *make_collisions_compact_doublezitile_sizze_46536;
    int64_t *make_collisions_compact_doublezitile_sizze_46805;
    int64_t *next_partition_to_read_doublezisegmap_num_tblocks_42838;
    int64_t *next_partition_to_read_doublezisegmap_tblock_sizze_42836;
    int64_t *next_partition_to_read_doublezisegred_num_tblocks_42818;
    int64_t *next_partition_to_read_doublezisegred_tblock_sizze_42816;
    int64_t *next_partition_to_read_doublezisegscan_num_tblocks_42828;
    int64_t *next_partition_to_read_doublezisegscan_tblock_sizze_42826;
    int64_t *rectify_partition_ids_doublezisuff_outer_par_0;
    int64_t *rectify_partition_ids_doublezitile_sizze_46536;
    int64_t *rectify_partition_ids_doublezitile_sizze_46780;
};
static const int num_tuning_params = 131;
static const char *tuning_param_names[] = {"add_next_partition_double.segmap_num_tblocks_43891", "add_next_partition_double.segmap_num_tblocks_44190", "add_next_partition_double.segmap_num_tblocks_44206", "add_next_partition_double.segmap_tblock_size_43112", "add_next_partition_double.segmap_tblock_size_43450", "add_next_partition_double.segmap_tblock_size_43527", "add_next_partition_double.segmap_tblock_size_43889", "add_next_partition_double.segmap_tblock_size_44086", "add_next_partition_double.segmap_tblock_size_44188", "add_next_partition_double.segmap_tblock_size_44204", "add_next_partition_double.segmap_tblock_size_44212", "add_next_partition_double.segmap_tblock_size_44289", "add_next_partition_double.segred_num_tblocks_43504", "add_next_partition_double.segred_num_tblocks_43991", "add_next_partition_double.segred_tblock_size_43502", "add_next_partition_double.segred_tblock_size_43989", "add_next_partition_double.segscan_num_tblocks_43142", "add_next_partition_double.segscan_num_tblocks_43633", "add_next_partition_double.segscan_num_tblocks_44180", "add_next_partition_double.segscan_num_tblocks_44196", "add_next_partition_double.segscan_tblock_size_43140", "add_next_partition_double.segscan_tblock_size_43631", "add_next_partition_double.segscan_tblock_size_44178", "add_next_partition_double.segscan_tblock_size_44194", "add_next_partition_double.suff_intra_par_2", "add_next_partition_double.suff_outer_par_1", "add_next_partition_double.suff_outer_par_3", "add_next_partition_double.suff_outer_screma_0", "add_next_partition_double.tile_size_46536", "add_next_partition_double.tile_size_46784", "builtin#iota_i64.tblock_size_50384", "builtin#replicate_bool.tblock_size_51025", "builtin#replicate_f64.tblock_size_50459", "builtin#replicate_i32.tblock_size_50286", "builtin#replicate_i64.tblock_size_50201", "builtin#replicate_i8.tblock_size_50251", "do_DBSCAN_double.segmap_num_tblocks_44359", "do_DBSCAN_double.segmap_num_tblocks_44375", "do_DBSCAN_double.segmap_num_tblocks_44391", "do_DBSCAN_double.segmap_num_tblocks_44407", "do_DBSCAN_double.segmap_num_tblocks_44415", "do_DBSCAN_double.segmap_num_tblocks_44453", "do_DBSCAN_double.segmap_num_tblocks_44809", "do_DBSCAN_double.segmap_num_tblocks_45222", "do_DBSCAN_double.segmap_num_tblocks_45667", "do_DBSCAN_double.segmap_num_tblocks_45683", "do_DBSCAN_double.segmap_tblock_size_44357", "do_DBSCAN_double.segmap_tblock_size_44373", "do_DBSCAN_double.segmap_tblock_size_44389", "do_DBSCAN_double.segmap_tblock_size_44405", "do_DBSCAN_double.segmap_tblock_size_44413", "do_DBSCAN_double.segmap_tblock_size_44421", "do_DBSCAN_double.segmap_tblock_size_44451", "do_DBSCAN_double.segmap_tblock_size_44626", "do_DBSCAN_double.segmap_tblock_size_44727", "do_DBSCAN_double.segmap_tblock_size_44753", "do_DBSCAN_double.segmap_tblock_size_44789", "do_DBSCAN_double.segmap_tblock_size_44807", "do_DBSCAN_double.segmap_tblock_size_45220", "do_DBSCAN_double.segmap_tblock_size_45349", "do_DBSCAN_double.segmap_tblock_size_45575", "do_DBSCAN_double.segmap_tblock_size_45665", "do_DBSCAN_double.segmap_tblock_size_45681", "do_DBSCAN_double.segmap_tblock_size_45869", "do_DBSCAN_double.segred_num_tblocks_44576", "do_DBSCAN_double.segred_num_tblocks_44709", "do_DBSCAN_double.segred_num_tblocks_45519", "do_DBSCAN_double.segred_num_tblocks_45813", "do_DBSCAN_double.segred_tblock_size_44574", "do_DBSCAN_double.segred_tblock_size_44707", "do_DBSCAN_double.segred_tblock_size_45517", "do_DBSCAN_double.segred_tblock_size_45811", "do_DBSCAN_double.segscan_num_tblocks_44349", "do_DBSCAN_double.segscan_num_tblocks_44365", "do_DBSCAN_double.segscan_num_tblocks_44381", "do_DBSCAN_double.segscan_num_tblocks_44397", "do_DBSCAN_double.segscan_num_tblocks_44443", "do_DBSCAN_double.segscan_num_tblocks_44459", "do_DBSCAN_double.segscan_num_tblocks_44719", "do_DBSCAN_double.segscan_num_tblocks_44846", "do_DBSCAN_double.segscan_num_tblocks_45106", "do_DBSCAN_double.segscan_num_tblocks_45673", "do_DBSCAN_double.segscan_tblock_size_44347", "do_DBSCAN_double.segscan_tblock_size_44363", "do_DBSCAN_double.segscan_tblock_size_44379", "do_DBSCAN_double.segscan_tblock_size_44395", "do_DBSCAN_double.segscan_tblock_size_44441", "do_DBSCAN_double.segscan_tblock_size_44457", "do_DBSCAN_double.segscan_tblock_size_44717", "do_DBSCAN_double.segscan_tblock_size_44844", "do_DBSCAN_double.segscan_tblock_size_45104", "do_DBSCAN_double.segscan_tblock_size_45671", "do_DBSCAN_double.suff_outer_par_0", "do_DBSCAN_double.suff_outer_par_2", "do_DBSCAN_double.suff_outer_par_3", "do_DBSCAN_double.suff_outer_par_4", "do_DBSCAN_double.suff_outer_par_5", "do_DBSCAN_double.suff_outer_screma_1", "do_DBSCAN_double.tile_size_46536", "do_DBSCAN_double.tile_size_46916", "do_DBSCAN_double.tile_size_47271", "do_DBSCAN_double.tile_size_47626", "do_DBSCAN_double.tile_size_47885", "do_DBSCAN_double.tile_size_48144", "do_DBSCAN_double.tile_size_48553", "get_num_neighbours_against_9632.segmap_tblock_size_46112", "get_num_neighbours_against_9632.segred_num_tblocks_46064", "get_num_neighbours_against_9632.segred_tblock_size_46062", "get_num_neighbours_against_9632.suff_outer_par_0", "get_num_neighbours_against_9632.tile_size_46536", "get_num_neighbours_against_9635.segmap_tblock_size_46346", "get_num_neighbours_against_9635.segred_num_tblocks_46298", "get_num_neighbours_against_9635.segred_tblock_size_46296", "get_num_neighbours_against_9635.suff_outer_par_0", "get_num_neighbours_against_9635.tile_size_46536", "make_collisions_compact_double.segmap_num_tblocks_43001", "make_collisions_compact_double.segmap_tblock_size_42999", "make_collisions_compact_double.segscan_num_tblocks_42991", "make_collisions_compact_double.segscan_tblock_size_42989", "make_collisions_compact_double.suff_outer_par_0", "make_collisions_compact_double.tile_size_46536", "make_collisions_compact_double.tile_size_46805", "next_partition_to_read_double.segmap_num_tblocks_42838", "next_partition_to_read_double.segmap_tblock_size_42836", "next_partition_to_read_double.segred_num_tblocks_42818", "next_partition_to_read_double.segred_tblock_size_42816", "next_partition_to_read_double.segscan_num_tblocks_42828", "next_partition_to_read_double.segscan_tblock_size_42826", "rectify_partition_ids_double.suff_outer_par_0", "rectify_partition_ids_double.tile_size_46536", "rectify_partition_ids_double.tile_size_46780", NULL};
static const char *tuning_param_vars[] = {"add_next_partition_doublezisegmap_num_tblocks_43891", "add_next_partition_doublezisegmap_num_tblocks_44190", "add_next_partition_doublezisegmap_num_tblocks_44206", "add_next_partition_doublezisegmap_tblock_sizze_43112", "add_next_partition_doublezisegmap_tblock_sizze_43450", "add_next_partition_doublezisegmap_tblock_sizze_43527", "add_next_partition_doublezisegmap_tblock_sizze_43889", "add_next_partition_doublezisegmap_tblock_sizze_44086", "add_next_partition_doublezisegmap_tblock_sizze_44188", "add_next_partition_doublezisegmap_tblock_sizze_44204", "add_next_partition_doublezisegmap_tblock_sizze_44212", "add_next_partition_doublezisegmap_tblock_sizze_44289", "add_next_partition_doublezisegred_num_tblocks_43504", "add_next_partition_doublezisegred_num_tblocks_43991", "add_next_partition_doublezisegred_tblock_sizze_43502", "add_next_partition_doublezisegred_tblock_sizze_43989", "add_next_partition_doublezisegscan_num_tblocks_43142", "add_next_partition_doublezisegscan_num_tblocks_43633", "add_next_partition_doublezisegscan_num_tblocks_44180", "add_next_partition_doublezisegscan_num_tblocks_44196", "add_next_partition_doublezisegscan_tblock_sizze_43140", "add_next_partition_doublezisegscan_tblock_sizze_43631", "add_next_partition_doublezisegscan_tblock_sizze_44178", "add_next_partition_doublezisegscan_tblock_sizze_44194", "add_next_partition_doublezisuff_intra_par_2", "add_next_partition_doublezisuff_outer_par_1", "add_next_partition_doublezisuff_outer_par_3", "add_next_partition_doublezisuff_outer_screma_0", "add_next_partition_doublezitile_sizze_46536", "add_next_partition_doublezitile_sizze_46784", "builtinzhiota_i64zitblock_sizze_50384", "builtinzhreplicate_boolzitblock_sizze_51025", "builtinzhreplicate_f64zitblock_sizze_50459", "builtinzhreplicate_i32zitblock_sizze_50286", "builtinzhreplicate_i64zitblock_sizze_50201", "builtinzhreplicate_i8zitblock_sizze_50251", "do_DBSCAN_doublezisegmap_num_tblocks_44359", "do_DBSCAN_doublezisegmap_num_tblocks_44375", "do_DBSCAN_doublezisegmap_num_tblocks_44391", "do_DBSCAN_doublezisegmap_num_tblocks_44407", "do_DBSCAN_doublezisegmap_num_tblocks_44415", "do_DBSCAN_doublezisegmap_num_tblocks_44453", "do_DBSCAN_doublezisegmap_num_tblocks_44809", "do_DBSCAN_doublezisegmap_num_tblocks_45222", "do_DBSCAN_doublezisegmap_num_tblocks_45667", "do_DBSCAN_doublezisegmap_num_tblocks_45683", "do_DBSCAN_doublezisegmap_tblock_sizze_44357", "do_DBSCAN_doublezisegmap_tblock_sizze_44373", "do_DBSCAN_doublezisegmap_tblock_sizze_44389", "do_DBSCAN_doublezisegmap_tblock_sizze_44405", "do_DBSCAN_doublezisegmap_tblock_sizze_44413", "do_DBSCAN_doublezisegmap_tblock_sizze_44421", "do_DBSCAN_doublezisegmap_tblock_sizze_44451", "do_DBSCAN_doublezisegmap_tblock_sizze_44626", "do_DBSCAN_doublezisegmap_tblock_sizze_44727", "do_DBSCAN_doublezisegmap_tblock_sizze_44753", "do_DBSCAN_doublezisegmap_tblock_sizze_44789", "do_DBSCAN_doublezisegmap_tblock_sizze_44807", "do_DBSCAN_doublezisegmap_tblock_sizze_45220", "do_DBSCAN_doublezisegmap_tblock_sizze_45349", "do_DBSCAN_doublezisegmap_tblock_sizze_45575", "do_DBSCAN_doublezisegmap_tblock_sizze_45665", "do_DBSCAN_doublezisegmap_tblock_sizze_45681", "do_DBSCAN_doublezisegmap_tblock_sizze_45869", "do_DBSCAN_doublezisegred_num_tblocks_44576", "do_DBSCAN_doublezisegred_num_tblocks_44709", "do_DBSCAN_doublezisegred_num_tblocks_45519", "do_DBSCAN_doublezisegred_num_tblocks_45813", "do_DBSCAN_doublezisegred_tblock_sizze_44574", "do_DBSCAN_doublezisegred_tblock_sizze_44707", "do_DBSCAN_doublezisegred_tblock_sizze_45517", "do_DBSCAN_doublezisegred_tblock_sizze_45811", "do_DBSCAN_doublezisegscan_num_tblocks_44349", "do_DBSCAN_doublezisegscan_num_tblocks_44365", "do_DBSCAN_doublezisegscan_num_tblocks_44381", "do_DBSCAN_doublezisegscan_num_tblocks_44397", "do_DBSCAN_doublezisegscan_num_tblocks_44443", "do_DBSCAN_doublezisegscan_num_tblocks_44459", "do_DBSCAN_doublezisegscan_num_tblocks_44719", "do_DBSCAN_doublezisegscan_num_tblocks_44846", "do_DBSCAN_doublezisegscan_num_tblocks_45106", "do_DBSCAN_doublezisegscan_num_tblocks_45673", "do_DBSCAN_doublezisegscan_tblock_sizze_44347", "do_DBSCAN_doublezisegscan_tblock_sizze_44363", "do_DBSCAN_doublezisegscan_tblock_sizze_44379", "do_DBSCAN_doublezisegscan_tblock_sizze_44395", "do_DBSCAN_doublezisegscan_tblock_sizze_44441", "do_DBSCAN_doublezisegscan_tblock_sizze_44457", "do_DBSCAN_doublezisegscan_tblock_sizze_44717", "do_DBSCAN_doublezisegscan_tblock_sizze_44844", "do_DBSCAN_doublezisegscan_tblock_sizze_45104", "do_DBSCAN_doublezisegscan_tblock_sizze_45671", "do_DBSCAN_doublezisuff_outer_par_0", "do_DBSCAN_doublezisuff_outer_par_2", "do_DBSCAN_doublezisuff_outer_par_3", "do_DBSCAN_doublezisuff_outer_par_4", "do_DBSCAN_doublezisuff_outer_par_5", "do_DBSCAN_doublezisuff_outer_screma_1", "do_DBSCAN_doublezitile_sizze_46536", "do_DBSCAN_doublezitile_sizze_46916", "do_DBSCAN_doublezitile_sizze_47271", "do_DBSCAN_doublezitile_sizze_47626", "do_DBSCAN_doublezitile_sizze_47885", "do_DBSCAN_doublezitile_sizze_48144", "do_DBSCAN_doublezitile_sizze_48553", "get_num_neighbours_against_9632zisegmap_tblock_sizze_46112", "get_num_neighbours_against_9632zisegred_num_tblocks_46064", "get_num_neighbours_against_9632zisegred_tblock_sizze_46062", "get_num_neighbours_against_9632zisuff_outer_par_0", "get_num_neighbours_against_9632zitile_sizze_46536", "get_num_neighbours_against_9635zisegmap_tblock_sizze_46346", "get_num_neighbours_against_9635zisegred_num_tblocks_46298", "get_num_neighbours_against_9635zisegred_tblock_sizze_46296", "get_num_neighbours_against_9635zisuff_outer_par_0", "get_num_neighbours_against_9635zitile_sizze_46536", "make_collisions_compact_doublezisegmap_num_tblocks_43001", "make_collisions_compact_doublezisegmap_tblock_sizze_42999", "make_collisions_compact_doublezisegscan_num_tblocks_42991", "make_collisions_compact_doublezisegscan_tblock_sizze_42989", "make_collisions_compact_doublezisuff_outer_par_0", "make_collisions_compact_doublezitile_sizze_46536", "make_collisions_compact_doublezitile_sizze_46805", "next_partition_to_read_doublezisegmap_num_tblocks_42838", "next_partition_to_read_doublezisegmap_tblock_sizze_42836", "next_partition_to_read_doublezisegred_num_tblocks_42818", "next_partition_to_read_doublezisegred_tblock_sizze_42816", "next_partition_to_read_doublezisegscan_num_tblocks_42828", "next_partition_to_read_doublezisegscan_tblock_sizze_42826", "rectify_partition_ids_doublezisuff_outer_par_0", "rectify_partition_ids_doublezitile_sizze_46536", "rectify_partition_ids_doublezitile_sizze_46780", NULL};
static const char *tuning_param_classes[] = {"grid_size", "grid_size", "grid_size", "thread_block_size", "thread_block_size", "thread_block_size", "thread_block_size", "thread_block_size", "thread_block_size", "thread_block_size", "thread_block_size", "thread_block_size", "grid_size", "grid_size", "thread_block_size", "thread_block_size", "grid_size", "grid_size", "grid_size", "grid_size", "thread_block_size", "thread_block_size", "thread_block_size", "thread_block_size", "threshold(32, !add_next_partition_double.suff_outer_par_1 !add_next_partition_double.suff_outer_screma_0)", "threshold(def, !add_next_partition_double.suff_outer_screma_0)", "threshold(def, )", "threshold(def, )", "thread_block_size", "thread_block_size", "thread_block_size", "thread_block_size", "thread_block_size", "thread_block_size", "thread_block_size", "thread_block_size", "grid_size", "grid_size", "grid_size", "grid_size", "grid_size", "grid_size", "grid_size", "grid_size", "grid_size", "grid_size", "thread_block_size", "thread_block_size", "thread_block_size", "thread_block_size", "thread_block_size", "thread_block_size", "thread_block_size", "thread_block_size", "thread_block_size", "thread_block_size", "thread_block_size", "thread_block_size", "thread_block_size", "thread_block_size", "thread_block_size", "thread_block_size", "thread_block_size", "thread_block_size", "grid_size", "grid_size", "grid_size", "grid_size", "thread_block_size", "thread_block_size", "thread_block_size", "thread_block_size", "grid_size", "grid_size", "grid_size", "grid_size", "grid_size", "grid_size", "grid_size", "grid_size", "grid_size", "grid_size", "thread_block_size", "thread_block_size", "thread_block_size", "thread_block_size", "thread_block_size", "thread_block_size", "thread_block_size", "thread_block_size", "thread_block_size", "thread_block_size", "threshold(def, )", "threshold(def, !do_DBSCAN_double.suff_outer_screma_1)", "threshold(def, )", "threshold(def, )", "threshold(def, )", "threshold(def, )", "thread_block_size", "thread_block_size", "thread_block_size", "thread_block_size", "thread_block_size", "thread_block_size", "thread_block_size", "thread_block_size", "grid_size", "thread_block_size", "threshold(def, )", "thread_block_size", "thread_block_size", "grid_size", "thread_block_size", "threshold(def, )", "thread_block_size", "grid_size", "thread_block_size", "grid_size", "thread_block_size", "threshold(def, )", "thread_block_size", "thread_block_size", "grid_size", "thread_block_size", "grid_size", "thread_block_size", "grid_size", "thread_block_size", "threshold(def, )", "thread_block_size", "thread_block_size", NULL};
static int64_t tuning_param_defaults[] = {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 32, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0};
static const int max_failure_args = 2;
static const int f64_required = 1;
static const char *gpu_program[] = {"#define FUTHARK_CUDA\n// start of prelude.cu\n\n#define SCALAR_FUN_ATTR __device__ static inline\n#define FUTHARK_FUN_ATTR __device__ static\n#define FUTHARK_F64_ENABLED\n\ntypedef char int8_t;\ntypedef short int16_t;\ntypedef int int32_t;\ntypedef long long int64_t;\ntypedef unsigned char uint8_t;\ntypedef unsigned short uint16_t;\ntypedef unsigned int uint32_t;\ntypedef unsigned long long uint64_t;\n\n#define __global\n#define __local\n#define __private\n#define __constant\n#define __write_only\n#define __read_only\n\nstatic inline __device__ int get_tblock_id(int d) {\n  switch (d) {\n  case 0: return blockIdx.x;\n  case 1: return blockIdx.y;\n  case 2: return blockIdx.z;\n  default: return 0;\n  }\n}\n\nstatic inline __device__ int get_num_tblocks(int d) {\n  switch(d) {\n  case 0: return gridDim.x;\n  case 1: return gridDim.y;\n  case 2: return gridDim.z;\n  default: return 0;\n  }\n}\n\nstatic inline __device__ int get_global_id(int d) {\n  switch (d) {\n    case 0: return threadIdx.x + blockIdx.x * blockDim.x;\n    case 1: return threadIdx.y + blockIdx.y * blockDim.y;\n    case 2: return threadIdx.z + blockIdx.z * blockDim.z;\n    default: return 0;\n  }\n}\n\nstatic inline __device__ int get_local_id(int d) {\n  switch (d) {\n    case 0: return threadIdx.x;\n    case 1: return threadIdx.y;\n    case 2: return threadIdx.z;\n    default: return 0;\n  }\n}\n\nstatic inline __device__ int get_local_size(int d) {\n  switch (d) {\n    case 0: return blockDim.x;\n    case 1: return blockDim.y;\n    case 2: return blockDim.z;\n    default: return 0;\n  }\n}\n\nstatic inline __device__ int get_global_size(int d) {\n  switch (d) {\n    case 0: return gridDim.x * blockDim.x;\n    case 1: return gridDim.y * blockDim.y;\n    case 2: return gridDim.z * blockDim.z;\n    default: return 0;\n  }\n}\n\n\n#define CLK_LOCAL_MEM_FENCE 1\n#define CLK_GLOBAL_MEM_FENCE 2\nstatic inline __device__ void barrier(int x) {\n  __syncthreads();\n}\nstatic inline __device__ void mem_fence_local() {\n  __threadfence_block();\n}\nstatic inline __device__ void mem_fence_global", "() {\n  __threadfence();\n}\n\nstatic inline __device__ void barrier_local() {\n  __syncthreads();\n}\n\n#define NAN (0.0/0.0)\n#define INFINITY (1.0/0.0)\nextern volatile __shared__ unsigned char shared_mem[];\n\n#define SHARED_MEM_PARAM\n#define FUTHARK_KERNEL extern \"C\" __global__ __launch_bounds__(MAX_THREADS_PER_BLOCK)\n#define FUTHARK_KERNEL_SIZED(a,b,c) extern \"C\" __global__ __launch_bounds__(a*b*c)\n\n// End of prelude.cu\n// Start of half.h.\n\n// Conversion functions are from http://half.sourceforge.net/, but\n// translated to C.\n//\n// Copyright (c) 2012-2021 Christian Rau\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\n#ifndef __OPENCL_VERSION__\n#define __constant\n#endif\n\n__constant static const uint16_t base_table[512] = {\n  0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,\n  0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0", "000, 0x0000,\n  0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,\n  0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,\n  0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,\n  0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,\n  0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0001, 0x0002, 0x0004, 0x0008, 0x0010, 0x0020, 0x0040, 0x0080, 0x0100,\n  0x0200, 0x0400, 0x0800, 0x0C00, 0x1000, 0x1400, 0x1800, 0x1C00, 0x2000, 0x2400, 0x2800, 0x2C00, 0x3000, 0x3400, 0x3800, 0x3C00,\n  0x4000, 0x4400, 0x4800, 0x4C00, 0x5000, 0x5400, 0x5800, 0x5C00, 0x6000, 0x6400, 0x6800, 0x6C00, 0x7000, 0x7400, 0x7800, 0x7C00,\n  0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00,\n  0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00,\n  0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00,\n  0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00,\n  0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00,\n  0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00,\n  0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00, 0x7C00,\n  0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000,\n  0x8000, 0x8000, 0x8000, 0x8000, 0x8",
                                    "000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000,\n  0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000,\n  0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000,\n  0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000,\n  0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000,\n  0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8000, 0x8001, 0x8002, 0x8004, 0x8008, 0x8010, 0x8020, 0x8040, 0x8080, 0x8100,\n  0x8200, 0x8400, 0x8800, 0x8C00, 0x9000, 0x9400, 0x9800, 0x9C00, 0xA000, 0xA400, 0xA800, 0xAC00, 0xB000, 0xB400, 0xB800, 0xBC00,\n  0xC000, 0xC400, 0xC800, 0xCC00, 0xD000, 0xD400, 0xD800, 0xDC00, 0xE000, 0xE400, 0xE800, 0xEC00, 0xF000, 0xF400, 0xF800, 0xFC00,\n  0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00,\n  0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00,\n  0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00,\n  0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00,\n  0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00,\n  0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00,\n  0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00, 0xFC00 };\n\n__constant static const unsigned char shift_table[512] = {\n  24, 24, 24, 24, 24, 24,", " 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24,\n  24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24,\n  24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24,\n  24, 24, 24, 24, 24, 24, 24, 23, 22, 21, 20, 19, 18, 17, 16, 15, 14, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13,\n  13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24,\n  24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24,\n  24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24,\n  24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 13,\n  24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24,\n  24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24,\n  24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24,\n  24, 24, 24, 24, 24, 24, 24, 23, 22, 21, 20, 19, 18, 17, 16, 15, 14, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13,\n  13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24,\n  24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24,\n  24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24,\n  24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 2", "4, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 13 };\n\n__constant static const uint32_t mantissa_table[2048] = {\n  0x00000000, 0x33800000, 0x34000000, 0x34400000, 0x34800000, 0x34A00000, 0x34C00000, 0x34E00000, 0x35000000, 0x35100000, 0x35200000, 0x35300000, 0x35400000, 0x35500000, 0x35600000, 0x35700000,\n  0x35800000, 0x35880000, 0x35900000, 0x35980000, 0x35A00000, 0x35A80000, 0x35B00000, 0x35B80000, 0x35C00000, 0x35C80000, 0x35D00000, 0x35D80000, 0x35E00000, 0x35E80000, 0x35F00000, 0x35F80000,\n  0x36000000, 0x36040000, 0x36080000, 0x360C0000, 0x36100000, 0x36140000, 0x36180000, 0x361C0000, 0x36200000, 0x36240000, 0x36280000, 0x362C0000, 0x36300000, 0x36340000, 0x36380000, 0x363C0000,\n  0x36400000, 0x36440000, 0x36480000, 0x364C0000, 0x36500000, 0x36540000, 0x36580000, 0x365C0000, 0x36600000, 0x36640000, 0x36680000, 0x366C0000, 0x36700000, 0x36740000, 0x36780000, 0x367C0000,\n  0x36800000, 0x36820000, 0x36840000, 0x36860000, 0x36880000, 0x368A0000, 0x368C0000, 0x368E0000, 0x36900000, 0x36920000, 0x36940000, 0x36960000, 0x36980000, 0x369A0000, 0x369C0000, 0x369E0000,\n  0x36A00000, 0x36A20000, 0x36A40000, 0x36A60000, 0x36A80000, 0x36AA0000, 0x36AC0000, 0x36AE0000, 0x36B00000, 0x36B20000, 0x36B40000, 0x36B60000, 0x36B80000, 0x36BA0000, 0x36BC0000, 0x36BE0000,\n  0x36C00000, 0x36C20000, 0x36C40000, 0x36C60000, 0x36C80000, 0x36CA0000, 0x36CC0000, 0x36CE0000, 0x36D00000, 0x36D20000, 0x36D40000, 0x36D60000, 0x36D80000, 0x36DA0000, 0x36DC0000, 0x36DE0000,\n  0x36E00000, 0x36E20000, 0x36E40000, 0x36E60000, 0x36E80000, 0x36EA0000, 0x36EC0000, 0x36EE0000, 0x36F00000, 0x36F20000, 0x36F40000, 0x36F60000, 0x36F80000, 0x36FA0000, 0x36FC0000, 0x36FE0000,\n  0x37000000, 0x37010000, 0x37020000, 0x37030000, 0x37040000, 0x37050000, 0x37060000, 0x37070000, 0x37080000, 0x37090000, 0x370A0000, 0x370B0000, 0x370C0000, 0x370D0000, 0x370E0000, 0x370F0000,\n  0x37100000, 0x37110000, 0x37120000, 0x37130000, 0x37140000, 0x37150000, 0x37160000, 0x37170000, 0x37180000, 0x37190000, 0x371A0000, 0x37",
                                    "1B0000, 0x371C0000, 0x371D0000, 0x371E0000, 0x371F0000,\n  0x37200000, 0x37210000, 0x37220000, 0x37230000, 0x37240000, 0x37250000, 0x37260000, 0x37270000, 0x37280000, 0x37290000, 0x372A0000, 0x372B0000, 0x372C0000, 0x372D0000, 0x372E0000, 0x372F0000,\n  0x37300000, 0x37310000, 0x37320000, 0x37330000, 0x37340000, 0x37350000, 0x37360000, 0x37370000, 0x37380000, 0x37390000, 0x373A0000, 0x373B0000, 0x373C0000, 0x373D0000, 0x373E0000, 0x373F0000,\n  0x37400000, 0x37410000, 0x37420000, 0x37430000, 0x37440000, 0x37450000, 0x37460000, 0x37470000, 0x37480000, 0x37490000, 0x374A0000, 0x374B0000, 0x374C0000, 0x374D0000, 0x374E0000, 0x374F0000,\n  0x37500000, 0x37510000, 0x37520000, 0x37530000, 0x37540000, 0x37550000, 0x37560000, 0x37570000, 0x37580000, 0x37590000, 0x375A0000, 0x375B0000, 0x375C0000, 0x375D0000, 0x375E0000, 0x375F0000,\n  0x37600000, 0x37610000, 0x37620000, 0x37630000, 0x37640000, 0x37650000, 0x37660000, 0x37670000, 0x37680000, 0x37690000, 0x376A0000, 0x376B0000, 0x376C0000, 0x376D0000, 0x376E0000, 0x376F0000,\n  0x37700000, 0x37710000, 0x37720000, 0x37730000, 0x37740000, 0x37750000, 0x37760000, 0x37770000, 0x37780000, 0x37790000, 0x377A0000, 0x377B0000, 0x377C0000, 0x377D0000, 0x377E0000, 0x377F0000,\n  0x37800000, 0x37808000, 0x37810000, 0x37818000, 0x37820000, 0x37828000, 0x37830000, 0x37838000, 0x37840000, 0x37848000, 0x37850000, 0x37858000, 0x37860000, 0x37868000, 0x37870000, 0x37878000,\n  0x37880000, 0x37888000, 0x37890000, 0x37898000, 0x378A0000, 0x378A8000, 0x378B0000, 0x378B8000, 0x378C0000, 0x378C8000, 0x378D0000, 0x378D8000, 0x378E0000, 0x378E8000, 0x378F0000, 0x378F8000,\n  0x37900000, 0x37908000, 0x37910000, 0x37918000, 0x37920000, 0x37928000, 0x37930000, 0x37938000, 0x37940000, 0x37948000, 0x37950000, 0x37958000, 0x37960000, 0x37968000, 0x37970000, 0x37978000,\n  0x37980000, 0x37988000, 0x37990000, 0x37998000, 0x379A0000, 0x379A8000, 0x379B0000, 0x379B8000, 0x379C0000, 0x379C8000, 0x379D0000, 0x379D8000, 0x379E0000, 0x379E8000, 0x379F0000, 0x379F8000,\n  0x", "37A00000, 0x37A08000, 0x37A10000, 0x37A18000, 0x37A20000, 0x37A28000, 0x37A30000, 0x37A38000, 0x37A40000, 0x37A48000, 0x37A50000, 0x37A58000, 0x37A60000, 0x37A68000, 0x37A70000, 0x37A78000,\n  0x37A80000, 0x37A88000, 0x37A90000, 0x37A98000, 0x37AA0000, 0x37AA8000, 0x37AB0000, 0x37AB8000, 0x37AC0000, 0x37AC8000, 0x37AD0000, 0x37AD8000, 0x37AE0000, 0x37AE8000, 0x37AF0000, 0x37AF8000,\n  0x37B00000, 0x37B08000, 0x37B10000, 0x37B18000, 0x37B20000, 0x37B28000, 0x37B30000, 0x37B38000, 0x37B40000, 0x37B48000, 0x37B50000, 0x37B58000, 0x37B60000, 0x37B68000, 0x37B70000, 0x37B78000,\n  0x37B80000, 0x37B88000, 0x37B90000, 0x37B98000, 0x37BA0000, 0x37BA8000, 0x37BB0000, 0x37BB8000, 0x37BC0000, 0x37BC8000, 0x37BD0000, 0x37BD8000, 0x37BE0000, 0x37BE8000, 0x37BF0000, 0x37BF8000,\n  0x37C00000, 0x37C08000, 0x37C10000, 0x37C18000, 0x37C20000, 0x37C28000, 0x37C30000, 0x37C38000, 0x37C40000, 0x37C48000, 0x37C50000, 0x37C58000, 0x37C60000, 0x37C68000, 0x37C70000, 0x37C78000,\n  0x37C80000, 0x37C88000, 0x37C90000, 0x37C98000, 0x37CA0000, 0x37CA8000, 0x37CB0000, 0x37CB8000, 0x37CC0000, 0x37CC8000, 0x37CD0000, 0x37CD8000, 0x37CE0000, 0x37CE8000, 0x37CF0000, 0x37CF8000,\n  0x37D00000, 0x37D08000, 0x37D10000, 0x37D18000, 0x37D20000, 0x37D28000, 0x37D30000, 0x37D38000, 0x37D40000, 0x37D48000, 0x37D50000, 0x37D58000, 0x37D60000, 0x37D68000, 0x37D70000, 0x37D78000,\n  0x37D80000, 0x37D88000, 0x37D90000, 0x37D98000, 0x37DA0000, 0x37DA8000, 0x37DB0000, 0x37DB8000, 0x37DC0000, 0x37DC8000, 0x37DD0000, 0x37DD8000, 0x37DE0000, 0x37DE8000, 0x37DF0000, 0x37DF8000,\n  0x37E00000, 0x37E08000, 0x37E10000, 0x37E18000, 0x37E20000, 0x37E28000, 0x37E30000, 0x37E38000, 0x37E40000, 0x37E48000, 0x37E50000, 0x37E58000, 0x37E60000, 0x37E68000, 0x37E70000, 0x37E78000,\n  0x37E80000, 0x37E88000, 0x37E90000, 0x37E98000, 0x37EA0000, 0x37EA8000, 0x37EB0000, 0x37EB8000, 0x37EC0000, 0x37EC8000, 0x37ED0000, 0x37ED8000, 0x37EE0000, 0x37EE8000, 0x37EF0000, 0x37EF8000,\n  0x37F00000, 0x37F08000, 0x37F10000, 0x37F18000, 0x37F20000, 0x", "37F28000, 0x37F30000, 0x37F38000, 0x37F40000, 0x37F48000, 0x37F50000, 0x37F58000, 0x37F60000, 0x37F68000, 0x37F70000, 0x37F78000,\n  0x37F80000, 0x37F88000, 0x37F90000, 0x37F98000, 0x37FA0000, 0x37FA8000, 0x37FB0000, 0x37FB8000, 0x37FC0000, 0x37FC8000, 0x37FD0000, 0x37FD8000, 0x37FE0000, 0x37FE8000, 0x37FF0000, 0x37FF8000,\n  0x38000000, 0x38004000, 0x38008000, 0x3800C000, 0x38010000, 0x38014000, 0x38018000, 0x3801C000, 0x38020000, 0x38024000, 0x38028000, 0x3802C000, 0x38030000, 0x38034000, 0x38038000, 0x3803C000,\n  0x38040000, 0x38044000, 0x38048000, 0x3804C000, 0x38050000, 0x38054000, 0x38058000, 0x3805C000, 0x38060000, 0x38064000, 0x38068000, 0x3806C000, 0x38070000, 0x38074000, 0x38078000, 0x3807C000,\n  0x38080000, 0x38084000, 0x38088000, 0x3808C000, 0x38090000, 0x38094000, 0x38098000, 0x3809C000, 0x380A0000, 0x380A4000, 0x380A8000, 0x380AC000, 0x380B0000, 0x380B4000, 0x380B8000, 0x380BC000,\n  0x380C0000, 0x380C4000, 0x380C8000, 0x380CC000, 0x380D0000, 0x380D4000, 0x380D8000, 0x380DC000, 0x380E0000, 0x380E4000, 0x380E8000, 0x380EC000, 0x380F0000, 0x380F4000, 0x380F8000, 0x380FC000,\n  0x38100000, 0x38104000, 0x38108000, 0x3810C000, 0x38110000, 0x38114000, 0x38118000, 0x3811C000, 0x38120000, 0x38124000, 0x38128000, 0x3812C000, 0x38130000, 0x38134000, 0x38138000, 0x3813C000,\n  0x38140000, 0x38144000, 0x38148000, 0x3814C000, 0x38150000, 0x38154000, 0x38158000, 0x3815C000, 0x38160000, 0x38164000, 0x38168000, 0x3816C000, 0x38170000, 0x38174000, 0x38178000, 0x3817C000,\n  0x38180000, 0x38184000, 0x38188000, 0x3818C000, 0x38190000, 0x38194000, 0x38198000, 0x3819C000, 0x381A0000, 0x381A4000, 0x381A8000, 0x381AC000, 0x381B0000, 0x381B4000, 0x381B8000, 0x381BC000,\n  0x381C0000, 0x381C4000, 0x381C8000, 0x381CC000, 0x381D0000, 0x381D4000, 0x381D8000, 0x381DC000, 0x381E0000, 0x381E4000, 0x381E8000, 0x381EC000, 0x381F0000, 0x381F4000, 0x381F8000, 0x381FC000,\n  0x38200000, 0x38204000, 0x38208000, 0x3820C000, 0x38210000, 0x38214000, 0x38218000, 0x3821C000, 0x38220000, 0x38224000, 0x",
                                    "38228000, 0x3822C000, 0x38230000, 0x38234000, 0x38238000, 0x3823C000,\n  0x38240000, 0x38244000, 0x38248000, 0x3824C000, 0x38250000, 0x38254000, 0x38258000, 0x3825C000, 0x38260000, 0x38264000, 0x38268000, 0x3826C000, 0x38270000, 0x38274000, 0x38278000, 0x3827C000,\n  0x38280000, 0x38284000, 0x38288000, 0x3828C000, 0x38290000, 0x38294000, 0x38298000, 0x3829C000, 0x382A0000, 0x382A4000, 0x382A8000, 0x382AC000, 0x382B0000, 0x382B4000, 0x382B8000, 0x382BC000,\n  0x382C0000, 0x382C4000, 0x382C8000, 0x382CC000, 0x382D0000, 0x382D4000, 0x382D8000, 0x382DC000, 0x382E0000, 0x382E4000, 0x382E8000, 0x382EC000, 0x382F0000, 0x382F4000, 0x382F8000, 0x382FC000,\n  0x38300000, 0x38304000, 0x38308000, 0x3830C000, 0x38310000, 0x38314000, 0x38318000, 0x3831C000, 0x38320000, 0x38324000, 0x38328000, 0x3832C000, 0x38330000, 0x38334000, 0x38338000, 0x3833C000,\n  0x38340000, 0x38344000, 0x38348000, 0x3834C000, 0x38350000, 0x38354000, 0x38358000, 0x3835C000, 0x38360000, 0x38364000, 0x38368000, 0x3836C000, 0x38370000, 0x38374000, 0x38378000, 0x3837C000,\n  0x38380000, 0x38384000, 0x38388000, 0x3838C000, 0x38390000, 0x38394000, 0x38398000, 0x3839C000, 0x383A0000, 0x383A4000, 0x383A8000, 0x383AC000, 0x383B0000, 0x383B4000, 0x383B8000, 0x383BC000,\n  0x383C0000, 0x383C4000, 0x383C8000, 0x383CC000, 0x383D0000, 0x383D4000, 0x383D8000, 0x383DC000, 0x383E0000, 0x383E4000, 0x383E8000, 0x383EC000, 0x383F0000, 0x383F4000, 0x383F8000, 0x383FC000,\n  0x38400000, 0x38404000, 0x38408000, 0x3840C000, 0x38410000, 0x38414000, 0x38418000, 0x3841C000, 0x38420000, 0x38424000, 0x38428000, 0x3842C000, 0x38430000, 0x38434000, 0x38438000, 0x3843C000,\n  0x38440000, 0x38444000, 0x38448000, 0x3844C000, 0x38450000, 0x38454000, 0x38458000, 0x3845C000, 0x38460000, 0x38464000, 0x38468000, 0x3846C000, 0x38470000, 0x38474000, 0x38478000, 0x3847C000,\n  0x38480000, 0x38484000, 0x38488000, 0x3848C000, 0x38490000, 0x38494000, 0x38498000, 0x3849C000, 0x384A0000, 0x384A4000, 0x384A8000, 0x384AC000, 0x384B0000, 0x384B4000, 0x384B8000, 0x", "384BC000,\n  0x384C0000, 0x384C4000, 0x384C8000, 0x384CC000, 0x384D0000, 0x384D4000, 0x384D8000, 0x384DC000, 0x384E0000, 0x384E4000, 0x384E8000, 0x384EC000, 0x384F0000, 0x384F4000, 0x384F8000, 0x384FC000,\n  0x38500000, 0x38504000, 0x38508000, 0x3850C000, 0x38510000, 0x38514000, 0x38518000, 0x3851C000, 0x38520000, 0x38524000, 0x38528000, 0x3852C000, 0x38530000, 0x38534000, 0x38538000, 0x3853C000,\n  0x38540000, 0x38544000, 0x38548000, 0x3854C000, 0x38550000, 0x38554000, 0x38558000, 0x3855C000, 0x38560000, 0x38564000, 0x38568000, 0x3856C000, 0x38570000, 0x38574000, 0x38578000, 0x3857C000,\n  0x38580000, 0x38584000, 0x38588000, 0x3858C000, 0x38590000, 0x38594000, 0x38598000, 0x3859C000, 0x385A0000, 0x385A4000, 0x385A8000, 0x385AC000, 0x385B0000, 0x385B4000, 0x385B8000, 0x385BC000,\n  0x385C0000, 0x385C4000, 0x385C8000, 0x385CC000, 0x385D0000, 0x385D4000, 0x385D8000, 0x385DC000, 0x385E0000, 0x385E4000, 0x385E8000, 0x385EC000, 0x385F0000, 0x385F4000, 0x385F8000, 0x385FC000,\n  0x38600000, 0x38604000, 0x38608000, 0x3860C000, 0x38610000, 0x38614000, 0x38618000, 0x3861C000, 0x38620000, 0x38624000, 0x38628000, 0x3862C000, 0x38630000, 0x38634000, 0x38638000, 0x3863C000,\n  0x38640000, 0x38644000, 0x38648000, 0x3864C000, 0x38650000, 0x38654000, 0x38658000, 0x3865C000, 0x38660000, 0x38664000, 0x38668000, 0x3866C000, 0x38670000, 0x38674000, 0x38678000, 0x3867C000,\n  0x38680000, 0x38684000, 0x38688000, 0x3868C000, 0x38690000, 0x38694000, 0x38698000, 0x3869C000, 0x386A0000, 0x386A4000, 0x386A8000, 0x386AC000, 0x386B0000, 0x386B4000, 0x386B8000, 0x386BC000,\n  0x386C0000, 0x386C4000, 0x386C8000, 0x386CC000, 0x386D0000, 0x386D4000, 0x386D8000, 0x386DC000, 0x386E0000, 0x386E4000, 0x386E8000, 0x386EC000, 0x386F0000, 0x386F4000, 0x386F8000, 0x386FC000,\n  0x38700000, 0x38704000, 0x38708000, 0x3870C000, 0x38710000, 0x38714000, 0x38718000, 0x3871C000, 0x38720000, 0x38724000, 0x38728000, 0x3872C000, 0x38730000, 0x38734000, 0x38738000, 0x3873C000,\n  0x38740000, 0x38744000, 0x38748000, 0x3874C000, ", "0x38750000, 0x38754000, 0x38758000, 0x3875C000, 0x38760000, 0x38764000, 0x38768000, 0x3876C000, 0x38770000, 0x38774000, 0x38778000, 0x3877C000,\n  0x38780000, 0x38784000, 0x38788000, 0x3878C000, 0x38790000, 0x38794000, 0x38798000, 0x3879C000, 0x387A0000, 0x387A4000, 0x387A8000, 0x387AC000, 0x387B0000, 0x387B4000, 0x387B8000, 0x387BC000,\n  0x387C0000, 0x387C4000, 0x387C8000, 0x387CC000, 0x387D0000, 0x387D4000, 0x387D8000, 0x387DC000, 0x387E0000, 0x387E4000, 0x387E8000, 0x387EC000, 0x387F0000, 0x387F4000, 0x387F8000, 0x387FC000,\n  0x38000000, 0x38002000, 0x38004000, 0x38006000, 0x38008000, 0x3800A000, 0x3800C000, 0x3800E000, 0x38010000, 0x38012000, 0x38014000, 0x38016000, 0x38018000, 0x3801A000, 0x3801C000, 0x3801E000,\n  0x38020000, 0x38022000, 0x38024000, 0x38026000, 0x38028000, 0x3802A000, 0x3802C000, 0x3802E000, 0x38030000, 0x38032000, 0x38034000, 0x38036000, 0x38038000, 0x3803A000, 0x3803C000, 0x3803E000,\n  0x38040000, 0x38042000, 0x38044000, 0x38046000, 0x38048000, 0x3804A000, 0x3804C000, 0x3804E000, 0x38050000, 0x38052000, 0x38054000, 0x38056000, 0x38058000, 0x3805A000, 0x3805C000, 0x3805E000,\n  0x38060000, 0x38062000, 0x38064000, 0x38066000, 0x38068000, 0x3806A000, 0x3806C000, 0x3806E000, 0x38070000, 0x38072000, 0x38074000, 0x38076000, 0x38078000, 0x3807A000, 0x3807C000, 0x3807E000,\n  0x38080000, 0x38082000, 0x38084000, 0x38086000, 0x38088000, 0x3808A000, 0x3808C000, 0x3808E000, 0x38090000, 0x38092000, 0x38094000, 0x38096000, 0x38098000, 0x3809A000, 0x3809C000, 0x3809E000,\n  0x380A0000, 0x380A2000, 0x380A4000, 0x380A6000, 0x380A8000, 0x380AA000, 0x380AC000, 0x380AE000, 0x380B0000, 0x380B2000, 0x380B4000, 0x380B6000, 0x380B8000, 0x380BA000, 0x380BC000, 0x380BE000,\n  0x380C0000, 0x380C2000, 0x380C4000, 0x380C6000, 0x380C8000, 0x380CA000, 0x380CC000, 0x380CE000, 0x380D0000, 0x380D2000, 0x380D4000, 0x380D6000, 0x380D8000, 0x380DA000, 0x380DC000, 0x380DE000,\n  0x380E0000, 0x380E2000, 0x380E4000, 0x380E6000, 0x380E8000, 0x380EA000, 0x380EC000, 0x380EE000, 0x380F0000, ",
                                    "0x380F2000, 0x380F4000, 0x380F6000, 0x380F8000, 0x380FA000, 0x380FC000, 0x380FE000,\n  0x38100000, 0x38102000, 0x38104000, 0x38106000, 0x38108000, 0x3810A000, 0x3810C000, 0x3810E000, 0x38110000, 0x38112000, 0x38114000, 0x38116000, 0x38118000, 0x3811A000, 0x3811C000, 0x3811E000,\n  0x38120000, 0x38122000, 0x38124000, 0x38126000, 0x38128000, 0x3812A000, 0x3812C000, 0x3812E000, 0x38130000, 0x38132000, 0x38134000, 0x38136000, 0x38138000, 0x3813A000, 0x3813C000, 0x3813E000,\n  0x38140000, 0x38142000, 0x38144000, 0x38146000, 0x38148000, 0x3814A000, 0x3814C000, 0x3814E000, 0x38150000, 0x38152000, 0x38154000, 0x38156000, 0x38158000, 0x3815A000, 0x3815C000, 0x3815E000,\n  0x38160000, 0x38162000, 0x38164000, 0x38166000, 0x38168000, 0x3816A000, 0x3816C000, 0x3816E000, 0x38170000, 0x38172000, 0x38174000, 0x38176000, 0x38178000, 0x3817A000, 0x3817C000, 0x3817E000,\n  0x38180000, 0x38182000, 0x38184000, 0x38186000, 0x38188000, 0x3818A000, 0x3818C000, 0x3818E000, 0x38190000, 0x38192000, 0x38194000, 0x38196000, 0x38198000, 0x3819A000, 0x3819C000, 0x3819E000,\n  0x381A0000, 0x381A2000, 0x381A4000, 0x381A6000, 0x381A8000, 0x381AA000, 0x381AC000, 0x381AE000, 0x381B0000, 0x381B2000, 0x381B4000, 0x381B6000, 0x381B8000, 0x381BA000, 0x381BC000, 0x381BE000,\n  0x381C0000, 0x381C2000, 0x381C4000, 0x381C6000, 0x381C8000, 0x381CA000, 0x381CC000, 0x381CE000, 0x381D0000, 0x381D2000, 0x381D4000, 0x381D6000, 0x381D8000, 0x381DA000, 0x381DC000, 0x381DE000,\n  0x381E0000, 0x381E2000, 0x381E4000, 0x381E6000, 0x381E8000, 0x381EA000, 0x381EC000, 0x381EE000, 0x381F0000, 0x381F2000, 0x381F4000, 0x381F6000, 0x381F8000, 0x381FA000, 0x381FC000, 0x381FE000,\n  0x38200000, 0x38202000, 0x38204000, 0x38206000, 0x38208000, 0x3820A000, 0x3820C000, 0x3820E000, 0x38210000, 0x38212000, 0x38214000, 0x38216000, 0x38218000, 0x3821A000, 0x3821C000, 0x3821E000,\n  0x38220000, 0x38222000, 0x38224000, 0x38226000, 0x38228000, 0x3822A000, 0x3822C000, 0x3822E000, 0x38230000, 0x38232000, 0x38234000, 0x38236000, 0x38238000, 0x3823A000, ", "0x3823C000, 0x3823E000,\n  0x38240000, 0x38242000, 0x38244000, 0x38246000, 0x38248000, 0x3824A000, 0x3824C000, 0x3824E000, 0x38250000, 0x38252000, 0x38254000, 0x38256000, 0x38258000, 0x3825A000, 0x3825C000, 0x3825E000,\n  0x38260000, 0x38262000, 0x38264000, 0x38266000, 0x38268000, 0x3826A000, 0x3826C000, 0x3826E000, 0x38270000, 0x38272000, 0x38274000, 0x38276000, 0x38278000, 0x3827A000, 0x3827C000, 0x3827E000,\n  0x38280000, 0x38282000, 0x38284000, 0x38286000, 0x38288000, 0x3828A000, 0x3828C000, 0x3828E000, 0x38290000, 0x38292000, 0x38294000, 0x38296000, 0x38298000, 0x3829A000, 0x3829C000, 0x3829E000,\n  0x382A0000, 0x382A2000, 0x382A4000, 0x382A6000, 0x382A8000, 0x382AA000, 0x382AC000, 0x382AE000, 0x382B0000, 0x382B2000, 0x382B4000, 0x382B6000, 0x382B8000, 0x382BA000, 0x382BC000, 0x382BE000,\n  0x382C0000, 0x382C2000, 0x382C4000, 0x382C6000, 0x382C8000, 0x382CA000, 0x382CC000, 0x382CE000, 0x382D0000, 0x382D2000, 0x382D4000, 0x382D6000, 0x382D8000, 0x382DA000, 0x382DC000, 0x382DE000,\n  0x382E0000, 0x382E2000, 0x382E4000, 0x382E6000, 0x382E8000, 0x382EA000, 0x382EC000, 0x382EE000, 0x382F0000, 0x382F2000, 0x382F4000, 0x382F6000, 0x382F8000, 0x382FA000, 0x382FC000, 0x382FE000,\n  0x38300000, 0x38302000, 0x38304000, 0x38306000, 0x38308000, 0x3830A000, 0x3830C000, 0x3830E000, 0x38310000, 0x38312000, 0x38314000, 0x38316000, 0x38318000, 0x3831A000, 0x3831C000, 0x3831E000,\n  0x38320000, 0x38322000, 0x38324000, 0x38326000, 0x38328000, 0x3832A000, 0x3832C000, 0x3832E000, 0x38330000, 0x38332000, 0x38334000, 0x38336000, 0x38338000, 0x3833A000, 0x3833C000, 0x3833E000,\n  0x38340000, 0x38342000, 0x38344000, 0x38346000, 0x38348000, 0x3834A000, 0x3834C000, 0x3834E000, 0x38350000, 0x38352000, 0x38354000, 0x38356000, 0x38358000, 0x3835A000, 0x3835C000, 0x3835E000,\n  0x38360000, 0x38362000, 0x38364000, 0x38366000, 0x38368000, 0x3836A000, 0x3836C000, 0x3836E000, 0x38370000, 0x38372000, 0x38374000, 0x38376000, 0x38378000, 0x3837A000, 0x3837C000, 0x3837E000,\n  0x38380000, 0x38382000, 0x38384000", ", 0x38386000, 0x38388000, 0x3838A000, 0x3838C000, 0x3838E000, 0x38390000, 0x38392000, 0x38394000, 0x38396000, 0x38398000, 0x3839A000, 0x3839C000, 0x3839E000,\n  0x383A0000, 0x383A2000, 0x383A4000, 0x383A6000, 0x383A8000, 0x383AA000, 0x383AC000, 0x383AE000, 0x383B0000, 0x383B2000, 0x383B4000, 0x383B6000, 0x383B8000, 0x383BA000, 0x383BC000, 0x383BE000,\n  0x383C0000, 0x383C2000, 0x383C4000, 0x383C6000, 0x383C8000, 0x383CA000, 0x383CC000, 0x383CE000, 0x383D0000, 0x383D2000, 0x383D4000, 0x383D6000, 0x383D8000, 0x383DA000, 0x383DC000, 0x383DE000,\n  0x383E0000, 0x383E2000, 0x383E4000, 0x383E6000, 0x383E8000, 0x383EA000, 0x383EC000, 0x383EE000, 0x383F0000, 0x383F2000, 0x383F4000, 0x383F6000, 0x383F8000, 0x383FA000, 0x383FC000, 0x383FE000,\n  0x38400000, 0x38402000, 0x38404000, 0x38406000, 0x38408000, 0x3840A000, 0x3840C000, 0x3840E000, 0x38410000, 0x38412000, 0x38414000, 0x38416000, 0x38418000, 0x3841A000, 0x3841C000, 0x3841E000,\n  0x38420000, 0x38422000, 0x38424000, 0x38426000, 0x38428000, 0x3842A000, 0x3842C000, 0x3842E000, 0x38430000, 0x38432000, 0x38434000, 0x38436000, 0x38438000, 0x3843A000, 0x3843C000, 0x3843E000,\n  0x38440000, 0x38442000, 0x38444000, 0x38446000, 0x38448000, 0x3844A000, 0x3844C000, 0x3844E000, 0x38450000, 0x38452000, 0x38454000, 0x38456000, 0x38458000, 0x3845A000, 0x3845C000, 0x3845E000,\n  0x38460000, 0x38462000, 0x38464000, 0x38466000, 0x38468000, 0x3846A000, 0x3846C000, 0x3846E000, 0x38470000, 0x38472000, 0x38474000, 0x38476000, 0x38478000, 0x3847A000, 0x3847C000, 0x3847E000,\n  0x38480000, 0x38482000, 0x38484000, 0x38486000, 0x38488000, 0x3848A000, 0x3848C000, 0x3848E000, 0x38490000, 0x38492000, 0x38494000, 0x38496000, 0x38498000, 0x3849A000, 0x3849C000, 0x3849E000,\n  0x384A0000, 0x384A2000, 0x384A4000, 0x384A6000, 0x384A8000, 0x384AA000, 0x384AC000, 0x384AE000, 0x384B0000, 0x384B2000, 0x384B4000, 0x384B6000, 0x384B8000, 0x384BA000, 0x384BC000, 0x384BE000,\n  0x384C0000, 0x384C2000, 0x384C4000, 0x384C6000, 0x384C8000, 0x384CA000, 0x384CC000, 0x384CE000",
                                    ", 0x384D0000, 0x384D2000, 0x384D4000, 0x384D6000, 0x384D8000, 0x384DA000, 0x384DC000, 0x384DE000,\n  0x384E0000, 0x384E2000, 0x384E4000, 0x384E6000, 0x384E8000, 0x384EA000, 0x384EC000, 0x384EE000, 0x384F0000, 0x384F2000, 0x384F4000, 0x384F6000, 0x384F8000, 0x384FA000, 0x384FC000, 0x384FE000,\n  0x38500000, 0x38502000, 0x38504000, 0x38506000, 0x38508000, 0x3850A000, 0x3850C000, 0x3850E000, 0x38510000, 0x38512000, 0x38514000, 0x38516000, 0x38518000, 0x3851A000, 0x3851C000, 0x3851E000,\n  0x38520000, 0x38522000, 0x38524000, 0x38526000, 0x38528000, 0x3852A000, 0x3852C000, 0x3852E000, 0x38530000, 0x38532000, 0x38534000, 0x38536000, 0x38538000, 0x3853A000, 0x3853C000, 0x3853E000,\n  0x38540000, 0x38542000, 0x38544000, 0x38546000, 0x38548000, 0x3854A000, 0x3854C000, 0x3854E000, 0x38550000, 0x38552000, 0x38554000, 0x38556000, 0x38558000, 0x3855A000, 0x3855C000, 0x3855E000,\n  0x38560000, 0x38562000, 0x38564000, 0x38566000, 0x38568000, 0x3856A000, 0x3856C000, 0x3856E000, 0x38570000, 0x38572000, 0x38574000, 0x38576000, 0x38578000, 0x3857A000, 0x3857C000, 0x3857E000,\n  0x38580000, 0x38582000, 0x38584000, 0x38586000, 0x38588000, 0x3858A000, 0x3858C000, 0x3858E000, 0x38590000, 0x38592000, 0x38594000, 0x38596000, 0x38598000, 0x3859A000, 0x3859C000, 0x3859E000,\n  0x385A0000, 0x385A2000, 0x385A4000, 0x385A6000, 0x385A8000, 0x385AA000, 0x385AC000, 0x385AE000, 0x385B0000, 0x385B2000, 0x385B4000, 0x385B6000, 0x385B8000, 0x385BA000, 0x385BC000, 0x385BE000,\n  0x385C0000, 0x385C2000, 0x385C4000, 0x385C6000, 0x385C8000, 0x385CA000, 0x385CC000, 0x385CE000, 0x385D0000, 0x385D2000, 0x385D4000, 0x385D6000, 0x385D8000, 0x385DA000, 0x385DC000, 0x385DE000,\n  0x385E0000, 0x385E2000, 0x385E4000, 0x385E6000, 0x385E8000, 0x385EA000, 0x385EC000, 0x385EE000, 0x385F0000, 0x385F2000, 0x385F4000, 0x385F6000, 0x385F8000, 0x385FA000, 0x385FC000, 0x385FE000,\n  0x38600000, 0x38602000, 0x38604000, 0x38606000, 0x38608000, 0x3860A000, 0x3860C000, 0x3860E000, 0x38610000, 0x38612000, 0x38614000, 0x38616000, 0x38618000", ", 0x3861A000, 0x3861C000, 0x3861E000,\n  0x38620000, 0x38622000, 0x38624000, 0x38626000, 0x38628000, 0x3862A000, 0x3862C000, 0x3862E000, 0x38630000, 0x38632000, 0x38634000, 0x38636000, 0x38638000, 0x3863A000, 0x3863C000, 0x3863E000,\n  0x38640000, 0x38642000, 0x38644000, 0x38646000, 0x38648000, 0x3864A000, 0x3864C000, 0x3864E000, 0x38650000, 0x38652000, 0x38654000, 0x38656000, 0x38658000, 0x3865A000, 0x3865C000, 0x3865E000,\n  0x38660000, 0x38662000, 0x38664000, 0x38666000, 0x38668000, 0x3866A000, 0x3866C000, 0x3866E000, 0x38670000, 0x38672000, 0x38674000, 0x38676000, 0x38678000, 0x3867A000, 0x3867C000, 0x3867E000,\n  0x38680000, 0x38682000, 0x38684000, 0x38686000, 0x38688000, 0x3868A000, 0x3868C000, 0x3868E000, 0x38690000, 0x38692000, 0x38694000, 0x38696000, 0x38698000, 0x3869A000, 0x3869C000, 0x3869E000,\n  0x386A0000, 0x386A2000, 0x386A4000, 0x386A6000, 0x386A8000, 0x386AA000, 0x386AC000, 0x386AE000, 0x386B0000, 0x386B2000, 0x386B4000, 0x386B6000, 0x386B8000, 0x386BA000, 0x386BC000, 0x386BE000,\n  0x386C0000, 0x386C2000, 0x386C4000, 0x386C6000, 0x386C8000, 0x386CA000, 0x386CC000, 0x386CE000, 0x386D0000, 0x386D2000, 0x386D4000, 0x386D6000, 0x386D8000, 0x386DA000, 0x386DC000, 0x386DE000,\n  0x386E0000, 0x386E2000, 0x386E4000, 0x386E6000, 0x386E8000, 0x386EA000, 0x386EC000, 0x386EE000, 0x386F0000, 0x386F2000, 0x386F4000, 0x386F6000, 0x386F8000, 0x386FA000, 0x386FC000, 0x386FE000,\n  0x38700000, 0x38702000, 0x38704000, 0x38706000, 0x38708000, 0x3870A000, 0x3870C000, 0x3870E000, 0x38710000, 0x38712000, 0x38714000, 0x38716000, 0x38718000, 0x3871A000, 0x3871C000, 0x3871E000,\n  0x38720000, 0x38722000, 0x38724000, 0x38726000, 0x38728000, 0x3872A000, 0x3872C000, 0x3872E000, 0x38730000, 0x38732000, 0x38734000, 0x38736000, 0x38738000, 0x3873A000, 0x3873C000, 0x3873E000,\n  0x38740000, 0x38742000, 0x38744000, 0x38746000, 0x38748000, 0x3874A000, 0x3874C000, 0x3874E000, 0x38750000, 0x38752000, 0x38754000, 0x38756000, 0x38758000, 0x3875A000, 0x3875C000, 0x3875E000,\n  0x38760000, 0x387620", "00, 0x38764000, 0x38766000, 0x38768000, 0x3876A000, 0x3876C000, 0x3876E000, 0x38770000, 0x38772000, 0x38774000, 0x38776000, 0x38778000, 0x3877A000, 0x3877C000, 0x3877E000,\n  0x38780000, 0x38782000, 0x38784000, 0x38786000, 0x38788000, 0x3878A000, 0x3878C000, 0x3878E000, 0x38790000, 0x38792000, 0x38794000, 0x38796000, 0x38798000, 0x3879A000, 0x3879C000, 0x3879E000,\n  0x387A0000, 0x387A2000, 0x387A4000, 0x387A6000, 0x387A8000, 0x387AA000, 0x387AC000, 0x387AE000, 0x387B0000, 0x387B2000, 0x387B4000, 0x387B6000, 0x387B8000, 0x387BA000, 0x387BC000, 0x387BE000,\n  0x387C0000, 0x387C2000, 0x387C4000, 0x387C6000, 0x387C8000, 0x387CA000, 0x387CC000, 0x387CE000, 0x387D0000, 0x387D2000, 0x387D4000, 0x387D6000, 0x387D8000, 0x387DA000, 0x387DC000, 0x387DE000,\n  0x387E0000, 0x387E2000, 0x387E4000, 0x387E6000, 0x387E8000, 0x387EA000, 0x387EC000, 0x387EE000, 0x387F0000, 0x387F2000, 0x387F4000, 0x387F6000, 0x387F8000, 0x387FA000, 0x387FC000, 0x387FE000 };\n__constant static const uint32_t exponent_table[64] = {\n  0x00000000, 0x00800000, 0x01000000, 0x01800000, 0x02000000, 0x02800000, 0x03000000, 0x03800000, 0x04000000, 0x04800000, 0x05000000, 0x05800000, 0x06000000, 0x06800000, 0x07000000, 0x07800000,\n  0x08000000, 0x08800000, 0x09000000, 0x09800000, 0x0A000000, 0x0A800000, 0x0B000000, 0x0B800000, 0x0C000000, 0x0C800000, 0x0D000000, 0x0D800000, 0x0E000000, 0x0E800000, 0x0F000000, 0x47800000,\n  0x80000000, 0x80800000, 0x81000000, 0x81800000, 0x82000000, 0x82800000, 0x83000000, 0x83800000, 0x84000000, 0x84800000, 0x85000000, 0x85800000, 0x86000000, 0x86800000, 0x87000000, 0x87800000,\n  0x88000000, 0x88800000, 0x89000000, 0x89800000, 0x8A000000, 0x8A800000, 0x8B000000, 0x8B800000, 0x8C000000, 0x8C800000, 0x8D000000, 0x8D800000, 0x8E000000, 0x8E800000, 0x8F000000, 0xC7800000 };\n__constant static const unsigned short offset_table[64] = {\n  0, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1",
                                    "024, 1024, 1024, 1024, 1024, 1024,\n  0, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024, 1024 };\n\nSCALAR_FUN_ATTR uint16_t float2halfbits(float value) {\n  union { float x; uint32_t y; } u;\n  u.x = value;\n  uint32_t bits = u.y;\n\n  uint16_t hbits = base_table[bits>>23] + (uint16_t)((bits&0x7FFFFF)>>shift_table[bits>>23]);;\n\n  return hbits;\n}\n\nSCALAR_FUN_ATTR float halfbits2float(uint16_t value) {\n  uint32_t bits = mantissa_table[offset_table[value>>10]+(value&0x3FF)] + exponent_table[value>>10];\n\n  union { uint32_t x; float y; } u;\n  u.x = bits;\n  return u.y;\n}\n\nSCALAR_FUN_ATTR uint16_t halfbitsnextafter(uint16_t from, uint16_t to) {\n  int fabs = from & 0x7FFF, tabs = to & 0x7FFF;\n  if(fabs > 0x7C00 || tabs > 0x7C00) {\n    return ((from&0x7FFF)>0x7C00) ? (from|0x200) : (to|0x200);\n  }\n  if(from == to || !(fabs|tabs)) {\n    return to;\n  }\n  if(!fabs) {\n    return (to&0x8000)+1;\n  }\n  unsigned int out =\n    from +\n    (((from>>15)^(unsigned int)((from^(0x8000|(0x8000-(from>>15))))<(to^(0x8000|(0x8000-(to>>15))))))<<1)\n    - 1;\n  return out;\n}\n\n// End of half.h.\n// Start of scalar.h.\n\n// Implementation of the primitive scalar operations.  Very\n// repetitive.  This code is inserted directly into both CUDA and\n// OpenCL programs, as well as the CPU code, so it has some #ifdefs to\n// work everywhere.  Some operations are defined as macros because\n// this allows us to use them as constant expressions in things like\n// array sizes and static initialisers.\n\n// Some of the #ifdefs are because OpenCL uses type-generic functions\n// for some operations (e.g. sqrt), while C and CUDA sensibly use\n// distinct functions for different precisions (e.g. sqrtf() and\n// sqrt()).  This is quite annoying.  Due to C's unfortunate casting\n// rules, it is also really easy to accidentally implement\n// floating-point functions in the wrong precision, so be careful.\n\n/", "/ Double-precision definitions are only included if the preprocessor\n// macro FUTHARK_F64_ENABLED is set.\n\nSCALAR_FUN_ATTR int32_t futrts_to_bits32(float x);\nSCALAR_FUN_ATTR float futrts_from_bits32(int32_t x);\n\nSCALAR_FUN_ATTR uint8_t add8(uint8_t x, uint8_t y) {\n  return x + y;\n}\n\nSCALAR_FUN_ATTR uint16_t add16(uint16_t x, uint16_t y) {\n  return x + y;\n}\n\nSCALAR_FUN_ATTR uint32_t add32(uint32_t x, uint32_t y) {\n  return x + y;\n}\n\nSCALAR_FUN_ATTR uint64_t add64(uint64_t x, uint64_t y) {\n  return x + y;\n}\n\nSCALAR_FUN_ATTR uint8_t sub8(uint8_t x, uint8_t y) {\n  return x - y;\n}\n\nSCALAR_FUN_ATTR uint16_t sub16(uint16_t x, uint16_t y) {\n  return x - y;\n}\n\nSCALAR_FUN_ATTR uint32_t sub32(uint32_t x, uint32_t y) {\n  return x - y;\n}\n\nSCALAR_FUN_ATTR uint64_t sub64(uint64_t x, uint64_t y) {\n  return x - y;\n}\n\nSCALAR_FUN_ATTR uint8_t mul8(uint8_t x, uint8_t y) {\n  return x * y;\n}\n\nSCALAR_FUN_ATTR uint16_t mul16(uint16_t x, uint16_t y) {\n  return x * y;\n}\n\nSCALAR_FUN_ATTR uint32_t mul32(uint32_t x, uint32_t y) {\n  return x * y;\n}\n\nSCALAR_FUN_ATTR uint64_t mul64(uint64_t x, uint64_t y) {\n  return x * y;\n}\n\n#if ISPC\n\nSCALAR_FUN_ATTR uint8_t udiv8(uint8_t x, uint8_t y) {\n  // This strange pattern is used to prevent the ISPC compiler from\n  // causing SIGFPEs and bogus results on divisions where inactive lanes\n  // have 0-valued divisors. It ensures that any inactive lane instead\n  // has a divisor of 1. https://github.com/ispc/ispc/issues/2292\n  uint8_t ys = 1;\n  foreach_active(i){\n    ys = y;\n  }\n\n  return x / ys;\n}\n\nSCALAR_FUN_ATTR uint16_t udiv16(uint16_t x, uint16_t y) {\n  uint16_t ys = 1;\n  foreach_active(i){\n    ys = y;\n  }\n\n  return x / ys;\n}\n\nSCALAR_FUN_ATTR uint32_t udiv32(uint32_t x, uint32_t y) {\n  uint32_t ys = 1;\n  foreach_active(i){\n    ys = y;\n  }\n\n\n  return x / ys;\n}\n\nSCALAR_FUN_ATTR uint64_t udiv64(uint64_t x, uint64_t y) {\n  uint64_t ys = 1;\n  foreach_active(i){\n    ys = y;\n  }\n\n\n  return x / ys;\n}\n\nSCALAR_FUN_ATTR uint8_t udiv_up8(uint8_t x, uint8_t y) {\n  uint", "8_t ys = 1;\n  foreach_active(i){\n    ys = y;\n  }\n\n\n  return (x + y - 1) / ys;\n}\n\nSCALAR_FUN_ATTR uint16_t udiv_up16(uint16_t x, uint16_t y) {\n  uint16_t ys = 1;\n  foreach_active(i){\n    ys = y;\n  }\n\n  return (x + y - 1) / ys;\n}\n\nSCALAR_FUN_ATTR uint32_t udiv_up32(uint32_t x, uint32_t y) {\n  uint32_t ys = 1;\n  foreach_active(i){\n    ys = y;\n  }\n\n  return (x + y - 1) / ys;\n}\n\nSCALAR_FUN_ATTR uint64_t udiv_up64(uint64_t x, uint64_t y) {\n  uint64_t ys = 1;\n  foreach_active(i){\n    ys = y;\n  }\n\n  return (x + y - 1) / ys;\n}\n\nSCALAR_FUN_ATTR uint8_t umod8(uint8_t x, uint8_t y) {\n  uint8_t ys = 1;\n  foreach_active(i){\n    ys = y;\n  }\n\n  return x % ys;\n}\n\nSCALAR_FUN_ATTR uint16_t umod16(uint16_t x, uint16_t y) {\n  uint16_t ys = 1;\n  foreach_active(i){\n    ys = y;\n  }\n\n\n  return x % ys;\n}\n\nSCALAR_FUN_ATTR uint32_t umod32(uint32_t x, uint32_t y) {\n  uint32_t ys = 1;\n  foreach_active(i){\n    ys = y;\n  }\n\n  return x % ys;\n}\n\nSCALAR_FUN_ATTR uint64_t umod64(uint64_t x, uint64_t y) {\n  uint64_t ys = 1;\n  foreach_active(i){\n    ys = y;\n  }\n\n  return x % ys;\n}\n\nSCALAR_FUN_ATTR uint8_t udiv_safe8(uint8_t x, uint8_t y) {\n  uint8_t ys = 1;\n  foreach_active(i){\n    ys = y;\n  }\n\n  return y == 0 ? 0 : x / ys;\n}\n\nSCALAR_FUN_ATTR uint16_t udiv_safe16(uint16_t x, uint16_t y) {\n  uint16_t ys = 1;\n  foreach_active(i){\n    ys = y;\n  }\n\n  return y == 0 ? 0 : x / ys;\n}\n\nSCALAR_FUN_ATTR uint32_t udiv_safe32(uint32_t x, uint32_t y) {\n  uint32_t ys = 1;\n  foreach_active(i){\n    ys = y;\n  }\n\n  return y == 0 ? 0 : x / ys;\n}\n\nSCALAR_FUN_ATTR uint64_t udiv_safe64(uint64_t x, uint64_t y) {\n  uint64_t ys = 1;\n  foreach_active(i){\n    ys = y;\n  }\n\n  return y == 0 ? 0 : x / ys;\n}\n\nSCALAR_FUN_ATTR uint8_t udiv_up_safe8(uint8_t x, uint8_t y) {\n  uint8_t ys = 1;\n  foreach_active(i){\n    ys = y;\n  }\n\n  return y == 0 ? 0 : (x + y - 1) / ys;\n}\n\nSCALAR_FUN_ATTR uint16_t udiv_up_safe16(uint16_t x, uint16_t y) {\n  uint16_t ys = 1;\n  foreach_active(i){\n    ys = y;\n  }\n\n  return y == 0 ? 0 : (x + y - 1) / ys;\n}\n\nSCALA",
                                    "R_FUN_ATTR uint32_t udiv_up_safe32(uint32_t x, uint32_t y) {\n  uint32_t ys = 1;\n  foreach_active(i){\n    ys = y;\n  }\n\n  return y == 0 ? 0 : (x + y - 1) / ys;\n}\n\nSCALAR_FUN_ATTR uint64_t udiv_up_safe64(uint64_t x, uint64_t y) {\n  uint64_t ys = 1;\n  foreach_active(i){\n    ys = y;\n  }\n\n  return y == 0 ? 0 : (x + y - 1) / ys;\n}\n\nSCALAR_FUN_ATTR uint8_t umod_safe8(uint8_t x, uint8_t y) {\n  uint8_t ys = 1;\n  foreach_active(i){\n    ys = y;\n  }\n\n  return y == 0 ? 0 : x % ys;\n}\n\nSCALAR_FUN_ATTR uint16_t umod_safe16(uint16_t x, uint16_t y) {\n  uint16_t ys = 1;\n  foreach_active(i){\n    ys = y;\n  }\n\n  return y == 0 ? 0 : x % ys;\n}\n\nSCALAR_FUN_ATTR uint32_t umod_safe32(uint32_t x, uint32_t y) {\n  uint32_t ys = 1;\n  foreach_active(i){\n    ys = y;\n  }\n\n  return y == 0 ? 0 : x % ys;\n}\n\nSCALAR_FUN_ATTR uint64_t umod_safe64(uint64_t x, uint64_t y) {\n  uint64_t ys = 1;\n  foreach_active(i){\n    ys = y;\n  }\n\n  return y == 0 ? 0 : x % ys;\n}\n\nSCALAR_FUN_ATTR int8_t sdiv8(int8_t x, int8_t y) {\n  int8_t ys = 1;\n  foreach_active(i){\n    ys = y;\n  }\n\n  int8_t q = x / ys;\n  int8_t r = x % ys;\n\n  return q - ((r != 0 && r < 0 != y < 0) ? 1 : 0);\n}\n\nSCALAR_FUN_ATTR int16_t sdiv16(int16_t x, int16_t y) {\n  int16_t ys = 1;\n  foreach_active(i){\n    ys = y;\n  }\n\n  int16_t q = x / ys;\n  int16_t r = x % ys;\n\n  return q - ((r != 0 && r < 0 != y < 0) ? 1 : 0);\n}\n\nSCALAR_FUN_ATTR int32_t sdiv32(int32_t x, int32_t y) {\n  int32_t ys = 1;\n  foreach_active(i){\n    ys = y;\n  }\n  int32_t q = x / ys;\n  int32_t r = x % ys;\n\n  return q - ((r != 0 && r < 0 != y < 0) ? 1 : 0);\n}\n\nSCALAR_FUN_ATTR int64_t sdiv64(int64_t x, int64_t y) {\n  int64_t ys = 1;\n  foreach_active(i){\n    ys = y;\n  }\n\n  int64_t q = x / ys;\n  int64_t r = x % ys;\n\n  return q - ((r != 0 && r < 0 != y < 0) ? 1 : 0);\n}\n\nSCALAR_FUN_ATTR int8_t sdiv_up8(int8_t x, int8_t y) {\n  return sdiv8(x + y - 1, y);\n}\n\nSCALAR_FUN_ATTR int16_t sdiv_up16(int16_t x, int16_t y) {\n  return sdiv16(x + y - 1, y);\n}\n\nSCALAR_FUN_ATTR int32_t sdiv_up32(int32_t x, int32_t y)", " {\n  return sdiv32(x + y - 1, y);\n}\n\nSCALAR_FUN_ATTR int64_t sdiv_up64(int64_t x, int64_t y) {\n  return sdiv64(x + y - 1, y);\n}\n\nSCALAR_FUN_ATTR int8_t smod8(int8_t x, int8_t y) {\n  int8_t ys = 1;\n  foreach_active(i){\n    ys = y;\n  }\n\n  int8_t r = x % ys;\n\n  return r + (r == 0 || (x > 0 && y > 0) || (x < 0 && y < 0) ? 0 : y);\n}\n\nSCALAR_FUN_ATTR int16_t smod16(int16_t x, int16_t y) {\n  int16_t ys = 1;\n  foreach_active(i){\n    ys = y;\n  }\n\n  int16_t r = x % ys;\n\n  return r + (r == 0 || (x > 0 && y > 0) || (x < 0 && y < 0) ? 0 : y);\n}\n\nSCALAR_FUN_ATTR int32_t smod32(int32_t x, int32_t y) {\n  int32_t ys = 1;\n  foreach_active(i){\n    ys = y;\n  }\n\n  int32_t r = x % ys;\n\n  return r + (r == 0 || (x > 0 && y > 0) || (x < 0 && y < 0) ? 0 : y);\n}\n\nSCALAR_FUN_ATTR int64_t smod64(int64_t x, int64_t y) {\n  int64_t ys = 1;\n  foreach_active(i){\n    ys = y;\n  }\n\n  int64_t r = x % ys;\n\n  return r + (r == 0 || (x > 0 && y > 0) || (x < 0 && y < 0) ? 0 : y);\n}\n\nSCALAR_FUN_ATTR int8_t sdiv_safe8(int8_t x, int8_t y) {\n  return y == 0 ? 0 : sdiv8(x, y);\n}\n\nSCALAR_FUN_ATTR int16_t sdiv_safe16(int16_t x, int16_t y) {\n  return y == 0 ? 0 : sdiv16(x, y);\n}\n\nSCALAR_FUN_ATTR int32_t sdiv_safe32(int32_t x, int32_t y) {\n  return y == 0 ? 0 : sdiv32(x, y);\n}\n\nSCALAR_FUN_ATTR int64_t sdiv_safe64(int64_t x, int64_t y) {\n  return y == 0 ? 0 : sdiv64(x, y);\n}\n\nSCALAR_FUN_ATTR int8_t sdiv_up_safe8(int8_t x, int8_t y) {\n  return sdiv_safe8(x + y - 1, y);\n}\n\nSCALAR_FUN_ATTR int16_t sdiv_up_safe16(int16_t x, int16_t y) {\n  return sdiv_safe16(x + y - 1, y);\n}\n\nSCALAR_FUN_ATTR int32_t sdiv_up_safe32(int32_t x, int32_t y) {\n  return sdiv_safe32(x + y - 1, y);\n}\n\nSCALAR_FUN_ATTR int64_t sdiv_up_safe64(int64_t x, int64_t y) {\n  return sdiv_safe64(x + y - 1, y);\n}\n\nSCALAR_FUN_ATTR int8_t smod_safe8(int8_t x, int8_t y) {\n  return y == 0 ? 0 : smod8(x, y);\n}\n\nSCALAR_FUN_ATTR int16_t smod_safe16(int16_t x, int16_t y) {\n  return y == 0 ? 0 : smod16(x, y);\n}\n\nSCALAR_FUN_ATTR int32_t smod_safe32(int32_t x, int32_t y) ", "{\n  return y == 0 ? 0 : smod32(x, y);\n}\n\nSCALAR_FUN_ATTR int64_t smod_safe64(int64_t x, int64_t y) {\n  return y == 0 ? 0 : smod64(x, y);\n}\n\nSCALAR_FUN_ATTR int8_t squot8(int8_t x, int8_t y) {\n  int8_t ys = 1;\n  foreach_active(i){\n    ys = y;\n  }\n\n  return x / ys;\n}\n\nSCALAR_FUN_ATTR int16_t squot16(int16_t x, int16_t y) {\n  int16_t ys = 1;\n  foreach_active(i){\n    ys = y;\n  }\n\n  return x / ys;\n}\n\nSCALAR_FUN_ATTR int32_t squot32(int32_t x, int32_t y) {\n  int32_t ys = 1;\n  foreach_active(i){\n    ys = y;\n  }\n\n  return x / ys;\n}\n\nSCALAR_FUN_ATTR int64_t squot64(int64_t x, int64_t y) {\n  int64_t ys = 1;\n  foreach_active(i){\n    ys = y;\n  }\n\n  return x / ys;\n}\n\nSCALAR_FUN_ATTR int8_t srem8(int8_t x, int8_t y) {\n  int8_t ys = 1;\n  foreach_active(i){\n    ys = y;\n  }\n\n  return x % ys;\n}\n\nSCALAR_FUN_ATTR int16_t srem16(int16_t x, int16_t y) {\n  int16_t ys = 1;\n  foreach_active(i){\n    ys = y;\n  }\n\n  return x % ys;\n}\n\nSCALAR_FUN_ATTR int32_t srem32(int32_t x, int32_t y) {\n  int32_t ys = 1;\n  foreach_active(i){\n    ys = y;\n  }\n\n  return x % ys;\n}\n\nSCALAR_FUN_ATTR int64_t srem64(int64_t x, int64_t y) {\n  int8_t ys = 1;\n  foreach_active(i){\n    ys = y;\n  }\n\n  return x % ys;\n}\n\nSCALAR_FUN_ATTR int8_t squot_safe8(int8_t x, int8_t y) {\n  int8_t ys = 1;\n  foreach_active(i){\n    ys = y;\n  }\n\n  return y == 0 ? 0 : x / ys;\n}\n\nSCALAR_FUN_ATTR int16_t squot_safe16(int16_t x, int16_t y) {\n  int16_t ys = 1;\n  foreach_active(i){\n    ys = y;\n  }\n\n  return y == 0 ? 0 : x / ys;\n}\n\nSCALAR_FUN_ATTR int32_t squot_safe32(int32_t x, int32_t y) {\n  int32_t ys = 1;\n  foreach_active(i){\n    ys = y;\n  }\n\n  return y == 0 ? 0 : x / ys;\n}\n\nSCALAR_FUN_ATTR int64_t squot_safe64(int64_t x, int64_t y) {\n  int64_t ys = 1;\n  foreach_active(i){\n    ys = y;\n  }\n\n  return y == 0 ? 0 : x / ys;\n}\n\nSCALAR_FUN_ATTR int8_t srem_safe8(int8_t x, int8_t y) {\n  int8_t ys = 1;\n  foreach_active(i){\n    ys = y;\n  }\n\n  return y == 0 ? 0 : x % ys;\n}\n\nSCALAR_FUN_ATTR int16_t srem_safe16(int16_t x, int16_t y) {\n  int16_t ys = 1;\n  ",
                                    "foreach_active(i){\n    ys = y;\n  }\n\n  return y == 0 ? 0 : x % ys;\n}\n\nSCALAR_FUN_ATTR int32_t srem_safe32(int32_t x, int32_t y) {\n  int32_t ys = 1;\n  foreach_active(i){\n    ys = y;\n  }\n\n  return y == 0 ? 0 : x % ys;\n}\n\nSCALAR_FUN_ATTR int64_t srem_safe64(int64_t x, int64_t y) {\n  int64_t ys = 1;\n  foreach_active(i){\n    ys = y;\n  }\n\n  return y == 0 ? 0 : x % ys;\n}\n\n#else\n\nSCALAR_FUN_ATTR uint8_t udiv8(uint8_t x, uint8_t y) {\n  return x / y;\n}\n\nSCALAR_FUN_ATTR uint16_t udiv16(uint16_t x, uint16_t y) {\n  return x / y;\n}\n\nSCALAR_FUN_ATTR uint32_t udiv32(uint32_t x, uint32_t y) {\n  return x / y;\n}\n\nSCALAR_FUN_ATTR uint64_t udiv64(uint64_t x, uint64_t y) {\n  return x / y;\n}\n\nSCALAR_FUN_ATTR uint8_t udiv_up8(uint8_t x, uint8_t y) {\n  return (x + y - 1) / y;\n}\n\nSCALAR_FUN_ATTR uint16_t udiv_up16(uint16_t x, uint16_t y) {\n  return (x + y - 1) / y;\n}\n\nSCALAR_FUN_ATTR uint32_t udiv_up32(uint32_t x, uint32_t y) {\n  return (x + y - 1) / y;\n}\n\nSCALAR_FUN_ATTR uint64_t udiv_up64(uint64_t x, uint64_t y) {\n  return (x + y - 1) / y;\n}\n\nSCALAR_FUN_ATTR uint8_t umod8(uint8_t x, uint8_t y) {\n  return x % y;\n}\n\nSCALAR_FUN_ATTR uint16_t umod16(uint16_t x, uint16_t y) {\n  return x % y;\n}\n\nSCALAR_FUN_ATTR uint32_t umod32(uint32_t x, uint32_t y) {\n  return x % y;\n}\n\nSCALAR_FUN_ATTR uint64_t umod64(uint64_t x, uint64_t y) {\n  return x % y;\n}\n\nSCALAR_FUN_ATTR uint8_t udiv_safe8(uint8_t x, uint8_t y) {\n  return y == 0 ? 0 : x / y;\n}\n\nSCALAR_FUN_ATTR uint16_t udiv_safe16(uint16_t x, uint16_t y) {\n  return y == 0 ? 0 : x / y;\n}\n\nSCALAR_FUN_ATTR uint32_t udiv_safe32(uint32_t x, uint32_t y) {\n  return y == 0 ? 0 : x / y;\n}\n\nSCALAR_FUN_ATTR uint64_t udiv_safe64(uint64_t x, uint64_t y) {\n  return y == 0 ? 0 : x / y;\n}\n\nSCALAR_FUN_ATTR uint8_t udiv_up_safe8(uint8_t x, uint8_t y) {\n  return y == 0 ? 0 : (x + y - 1) / y;\n}\n\nSCALAR_FUN_ATTR uint16_t udiv_up_safe16(uint16_t x, uint16_t y) {\n  return y == 0 ? 0 : (x + y - 1) / y;\n}\n\nSCALAR_FUN_ATTR uint32_t udiv_up_safe32(uint32_t x, uint32_t y) {\n  return", " y == 0 ? 0 : (x + y - 1) / y;\n}\n\nSCALAR_FUN_ATTR uint64_t udiv_up_safe64(uint64_t x, uint64_t y) {\n  return y == 0 ? 0 : (x + y - 1) / y;\n}\n\nSCALAR_FUN_ATTR uint8_t umod_safe8(uint8_t x, uint8_t y) {\n  return y == 0 ? 0 : x % y;\n}\n\nSCALAR_FUN_ATTR uint16_t umod_safe16(uint16_t x, uint16_t y) {\n  return y == 0 ? 0 : x % y;\n}\n\nSCALAR_FUN_ATTR uint32_t umod_safe32(uint32_t x, uint32_t y) {\n  return y == 0 ? 0 : x % y;\n}\n\nSCALAR_FUN_ATTR uint64_t umod_safe64(uint64_t x, uint64_t y) {\n  return y == 0 ? 0 : x % y;\n}\n\nSCALAR_FUN_ATTR int8_t sdiv8(int8_t x, int8_t y) {\n  int8_t q = x / y;\n  int8_t r = x % y;\n\n  return q - ((r != 0 && r < 0 != y < 0) ? 1 : 0);\n}\n\nSCALAR_FUN_ATTR int16_t sdiv16(int16_t x, int16_t y) {\n  int16_t q = x / y;\n  int16_t r = x % y;\n\n  return q - ((r != 0 && r < 0 != y < 0) ? 1 : 0);\n}\n\nSCALAR_FUN_ATTR int32_t sdiv32(int32_t x, int32_t y) {\n  int32_t q = x / y;\n  int32_t r = x % y;\n\n  return q - ((r != 0 && r < 0 != y < 0) ? 1 : 0);\n}\n\nSCALAR_FUN_ATTR int64_t sdiv64(int64_t x, int64_t y) {\n  int64_t q = x / y;\n  int64_t r = x % y;\n\n  return q - ((r != 0 && r < 0 != y < 0) ? 1 : 0);\n}\n\nSCALAR_FUN_ATTR int8_t sdiv_up8(int8_t x, int8_t y) {\n  return sdiv8(x + y - 1, y);\n}\n\nSCALAR_FUN_ATTR int16_t sdiv_up16(int16_t x, int16_t y) {\n  return sdiv16(x + y - 1, y);\n}\n\nSCALAR_FUN_ATTR int32_t sdiv_up32(int32_t x, int32_t y) {\n  return sdiv32(x + y - 1, y);\n}\n\nSCALAR_FUN_ATTR int64_t sdiv_up64(int64_t x, int64_t y) {\n  return sdiv64(x + y - 1, y);\n}\n\nSCALAR_FUN_ATTR int8_t smod8(int8_t x, int8_t y) {\n  int8_t r = x % y;\n\n  return r + (r == 0 || (x > 0 && y > 0) || (x < 0 && y < 0) ? 0 : y);\n}\n\nSCALAR_FUN_ATTR int16_t smod16(int16_t x, int16_t y) {\n  int16_t r = x % y;\n\n  return r + (r == 0 || (x > 0 && y > 0) || (x < 0 && y < 0) ? 0 : y);\n}\n\nSCALAR_FUN_ATTR int32_t smod32(int32_t x, int32_t y) {\n  int32_t r = x % y;\n\n  return r + (r == 0 || (x > 0 && y > 0) || (x < 0 && y < 0) ? 0 : y);\n}\n\nSCALAR_FUN_ATTR int64_t smod64(int64_t x, int64_t y) {\n  int64_t r = ", "x % y;\n\n  return r + (r == 0 || (x > 0 && y > 0) || (x < 0 && y < 0) ? 0 : y);\n}\n\nSCALAR_FUN_ATTR int8_t sdiv_safe8(int8_t x, int8_t y) {\n  return y == 0 ? 0 : sdiv8(x, y);\n}\n\nSCALAR_FUN_ATTR int16_t sdiv_safe16(int16_t x, int16_t y) {\n  return y == 0 ? 0 : sdiv16(x, y);\n}\n\nSCALAR_FUN_ATTR int32_t sdiv_safe32(int32_t x, int32_t y) {\n  return y == 0 ? 0 : sdiv32(x, y);\n}\n\nSCALAR_FUN_ATTR int64_t sdiv_safe64(int64_t x, int64_t y) {\n  return y == 0 ? 0 : sdiv64(x, y);\n}\n\nSCALAR_FUN_ATTR int8_t sdiv_up_safe8(int8_t x, int8_t y) {\n  return sdiv_safe8(x + y - 1, y);\n}\n\nSCALAR_FUN_ATTR int16_t sdiv_up_safe16(int16_t x, int16_t y) {\n  return sdiv_safe16(x + y - 1, y);\n}\n\nSCALAR_FUN_ATTR int32_t sdiv_up_safe32(int32_t x, int32_t y) {\n  return sdiv_safe32(x + y - 1, y);\n}\n\nSCALAR_FUN_ATTR int64_t sdiv_up_safe64(int64_t x, int64_t y) {\n  return sdiv_safe64(x + y - 1, y);\n}\n\nSCALAR_FUN_ATTR int8_t smod_safe8(int8_t x, int8_t y) {\n  return y == 0 ? 0 : smod8(x, y);\n}\n\nSCALAR_FUN_ATTR int16_t smod_safe16(int16_t x, int16_t y) {\n  return y == 0 ? 0 : smod16(x, y);\n}\n\nSCALAR_FUN_ATTR int32_t smod_safe32(int32_t x, int32_t y) {\n  return y == 0 ? 0 : smod32(x, y);\n}\n\nSCALAR_FUN_ATTR int64_t smod_safe64(int64_t x, int64_t y) {\n  return y == 0 ? 0 : smod64(x, y);\n}\n\nSCALAR_FUN_ATTR int8_t squot8(int8_t x, int8_t y) {\n  return x / y;\n}\n\nSCALAR_FUN_ATTR int16_t squot16(int16_t x, int16_t y) {\n  return x / y;\n}\n\nSCALAR_FUN_ATTR int32_t squot32(int32_t x, int32_t y) {\n  return x / y;\n}\n\nSCALAR_FUN_ATTR int64_t squot64(int64_t x, int64_t y) {\n  return x / y;\n}\n\nSCALAR_FUN_ATTR int8_t srem8(int8_t x, int8_t y) {\n  return x % y;\n}\n\nSCALAR_FUN_ATTR int16_t srem16(int16_t x, int16_t y) {\n  return x % y;\n}\n\nSCALAR_FUN_ATTR int32_t srem32(int32_t x, int32_t y) {\n  return x % y;\n}\n\nSCALAR_FUN_ATTR int64_t srem64(int64_t x, int64_t y) {\n  return x % y;\n}\n\nSCALAR_FUN_ATTR int8_t squot_safe8(int8_t x, int8_t y) {\n  return y == 0 ? 0 : x / y;\n}\n\nSCALAR_FUN_ATTR int16_t squot_safe16(int16_t x, int16_t ",
                                    "y) {\n  return y == 0 ? 0 : x / y;\n}\n\nSCALAR_FUN_ATTR int32_t squot_safe32(int32_t x, int32_t y) {\n  return y == 0 ? 0 : x / y;\n}\n\nSCALAR_FUN_ATTR int64_t squot_safe64(int64_t x, int64_t y) {\n  return y == 0 ? 0 : x / y;\n}\n\nSCALAR_FUN_ATTR int8_t srem_safe8(int8_t x, int8_t y) {\n  return y == 0 ? 0 : x % y;\n}\n\nSCALAR_FUN_ATTR int16_t srem_safe16(int16_t x, int16_t y) {\n  return y == 0 ? 0 : x % y;\n}\n\nSCALAR_FUN_ATTR int32_t srem_safe32(int32_t x, int32_t y) {\n  return y == 0 ? 0 : x % y;\n}\n\nSCALAR_FUN_ATTR int64_t srem_safe64(int64_t x, int64_t y) {\n  return y == 0 ? 0 : x % y;\n}\n\n#endif\n\nSCALAR_FUN_ATTR int8_t smin8(int8_t x, int8_t y) {\n  return x < y ? x : y;\n}\n\nSCALAR_FUN_ATTR int16_t smin16(int16_t x, int16_t y) {\n  return x < y ? x : y;\n}\n\nSCALAR_FUN_ATTR int32_t smin32(int32_t x, int32_t y) {\n  return x < y ? x : y;\n}\n\nSCALAR_FUN_ATTR int64_t smin64(int64_t x, int64_t y) {\n  return x < y ? x : y;\n}\n\nSCALAR_FUN_ATTR uint8_t umin8(uint8_t x, uint8_t y) {\n  return x < y ? x : y;\n}\n\nSCALAR_FUN_ATTR uint16_t umin16(uint16_t x, uint16_t y) {\n  return x < y ? x : y;\n}\n\nSCALAR_FUN_ATTR uint32_t umin32(uint32_t x, uint32_t y) {\n  return x < y ? x : y;\n}\n\nSCALAR_FUN_ATTR uint64_t umin64(uint64_t x, uint64_t y) {\n  return x < y ? x : y;\n}\n\nSCALAR_FUN_ATTR int8_t smax8(int8_t x, int8_t y) {\n  return x < y ? y : x;\n}\n\nSCALAR_FUN_ATTR int16_t smax16(int16_t x, int16_t y) {\n  return x < y ? y : x;\n}\n\nSCALAR_FUN_ATTR int32_t smax32(int32_t x, int32_t y) {\n  return x < y ? y : x;\n}\n\nSCALAR_FUN_ATTR int64_t smax64(int64_t x, int64_t y) {\n  return x < y ? y : x;\n}\n\nSCALAR_FUN_ATTR uint8_t umax8(uint8_t x, uint8_t y) {\n  return x < y ? y : x;\n}\n\nSCALAR_FUN_ATTR uint16_t umax16(uint16_t x, uint16_t y) {\n  return x < y ? y : x;\n}\n\nSCALAR_FUN_ATTR uint32_t umax32(uint32_t x, uint32_t y) {\n  return x < y ? y : x;\n}\n\nSCALAR_FUN_ATTR uint64_t umax64(uint64_t x, uint64_t y) {\n  return x < y ? y : x;\n}\n\nSCALAR_FUN_ATTR uint8_t shl8(uint8_t x, uint8_t y) {\n  return (uint8_t)(x << y);\n}\n\nS", "CALAR_FUN_ATTR uint16_t shl16(uint16_t x, uint16_t y) {\n  return (uint16_t)(x << y);\n}\n\nSCALAR_FUN_ATTR uint32_t shl32(uint32_t x, uint32_t y) {\n  return x << y;\n}\n\nSCALAR_FUN_ATTR uint64_t shl64(uint64_t x, uint64_t y) {\n  return x << y;\n}\n\nSCALAR_FUN_ATTR uint8_t lshr8(uint8_t x, uint8_t y) {\n  return x >> y;\n}\n\nSCALAR_FUN_ATTR uint16_t lshr16(uint16_t x, uint16_t y) {\n  return x >> y;\n}\n\nSCALAR_FUN_ATTR uint32_t lshr32(uint32_t x, uint32_t y) {\n  return x >> y;\n}\n\nSCALAR_FUN_ATTR uint64_t lshr64(uint64_t x, uint64_t y) {\n  return x >> y;\n}\n\nSCALAR_FUN_ATTR int8_t ashr8(int8_t x, int8_t y) {\n  return x >> y;\n}\n\nSCALAR_FUN_ATTR int16_t ashr16(int16_t x, int16_t y) {\n  return x >> y;\n}\n\nSCALAR_FUN_ATTR int32_t ashr32(int32_t x, int32_t y) {\n  return x >> y;\n}\n\nSCALAR_FUN_ATTR int64_t ashr64(int64_t x, int64_t y) {\n  return x >> y;\n}\n\nSCALAR_FUN_ATTR uint8_t and8(uint8_t x, uint8_t y) {\n  return x & y;\n}\n\nSCALAR_FUN_ATTR uint16_t and16(uint16_t x, uint16_t y) {\n  return x & y;\n}\n\nSCALAR_FUN_ATTR uint32_t and32(uint32_t x, uint32_t y) {\n  return x & y;\n}\n\nSCALAR_FUN_ATTR uint64_t and64(uint64_t x, uint64_t y) {\n  return x & y;\n}\n\nSCALAR_FUN_ATTR uint8_t or8(uint8_t x, uint8_t y) {\n  return x | y;\n}\n\nSCALAR_FUN_ATTR uint16_t or16(uint16_t x, uint16_t y) {\n  return x | y;\n}\n\nSCALAR_FUN_ATTR uint32_t or32(uint32_t x, uint32_t y) {\n  return x | y;\n}\n\nSCALAR_FUN_ATTR uint64_t or64(uint64_t x, uint64_t y) {\n  return x | y;\n}\n\nSCALAR_FUN_ATTR uint8_t xor8(uint8_t x, uint8_t y) {\n  return x ^ y;\n}\n\nSCALAR_FUN_ATTR uint16_t xor16(uint16_t x, uint16_t y) {\n  return x ^ y;\n}\n\nSCALAR_FUN_ATTR uint32_t xor32(uint32_t x, uint32_t y) {\n  return x ^ y;\n}\n\nSCALAR_FUN_ATTR uint64_t xor64(uint64_t x, uint64_t y) {\n  return x ^ y;\n}\n\nSCALAR_FUN_ATTR bool ult8(uint8_t x, uint8_t y) {\n  return x < y;\n}\n\nSCALAR_FUN_ATTR bool ult16(uint16_t x, uint16_t y) {\n  return x < y;\n}\n\nSCALAR_FUN_ATTR bool ult32(uint32_t x, uint32_t y) {\n  return x < y;\n}\n\nSCALAR_FUN_ATTR bool ult64(uint64_t x, uint64", "_t y) {\n  return x < y;\n}\n\nSCALAR_FUN_ATTR bool ule8(uint8_t x, uint8_t y) {\n  return x <= y;\n}\n\nSCALAR_FUN_ATTR bool ule16(uint16_t x, uint16_t y) {\n  return x <= y;\n}\n\nSCALAR_FUN_ATTR bool ule32(uint32_t x, uint32_t y) {\n  return x <= y;\n}\n\nSCALAR_FUN_ATTR bool ule64(uint64_t x, uint64_t y) {\n  return x <= y;\n}\n\nSCALAR_FUN_ATTR bool slt8(int8_t x, int8_t y) {\n  return x < y;\n}\n\nSCALAR_FUN_ATTR bool slt16(int16_t x, int16_t y) {\n  return x < y;\n}\n\nSCALAR_FUN_ATTR bool slt32(int32_t x, int32_t y) {\n  return x < y;\n}\n\nSCALAR_FUN_ATTR bool slt64(int64_t x, int64_t y) {\n  return x < y;\n}\n\nSCALAR_FUN_ATTR bool sle8(int8_t x, int8_t y) {\n  return x <= y;\n}\n\nSCALAR_FUN_ATTR bool sle16(int16_t x, int16_t y) {\n  return x <= y;\n}\n\nSCALAR_FUN_ATTR bool sle32(int32_t x, int32_t y) {\n  return x <= y;\n}\n\nSCALAR_FUN_ATTR bool sle64(int64_t x, int64_t y) {\n  return x <= y;\n}\n\nSCALAR_FUN_ATTR uint8_t pow8(uint8_t x, uint8_t y) {\n  uint8_t res = 1, rem = y;\n\n  while (rem != 0) {\n    if (rem & 1)\n      res *= x;\n    rem >>= 1;\n    x *= x;\n  }\n  return res;\n}\n\nSCALAR_FUN_ATTR uint16_t pow16(uint16_t x, uint16_t y) {\n  uint16_t res = 1, rem = y;\n\n  while (rem != 0) {\n    if (rem & 1)\n      res *= x;\n    rem >>= 1;\n    x *= x;\n  }\n  return res;\n}\n\nSCALAR_FUN_ATTR uint32_t pow32(uint32_t x, uint32_t y) {\n  uint32_t res = 1, rem = y;\n\n  while (rem != 0) {\n    if (rem & 1)\n      res *= x;\n    rem >>= 1;\n    x *= x;\n  }\n  return res;\n}\n\nSCALAR_FUN_ATTR uint64_t pow64(uint64_t x, uint64_t y) {\n  uint64_t res = 1, rem = y;\n\n  while (rem != 0) {\n    if (rem & 1)\n      res *= x;\n    rem >>= 1;\n    x *= x;\n  }\n  return res;\n}\n\nSCALAR_FUN_ATTR bool itob_i8_bool(int8_t x) {\n  return x != 0;\n}\n\nSCALAR_FUN_ATTR bool itob_i16_bool(int16_t x) {\n  return x != 0;\n}\n\nSCALAR_FUN_ATTR bool itob_i32_bool(int32_t x) {\n  return x != 0;\n}\n\nSCALAR_FUN_ATTR bool itob_i64_bool(int64_t x) {\n  return x != 0;\n}\n\nSCALAR_FUN_ATTR int8_t btoi_bool_i8(bool x) {\n  return x;\n}\n\nSCALAR_FUN_ATTR int16_t btoi_bool_i16(bool x",
                                    ") {\n  return x;\n}\n\nSCALAR_FUN_ATTR int32_t btoi_bool_i32(bool x) {\n  return x;\n}\n\nSCALAR_FUN_ATTR int64_t btoi_bool_i64(bool x) {\n  return x;\n}\n\n#define sext_i8_i8(x) ((int8_t) (int8_t) (x))\n#define sext_i8_i16(x) ((int16_t) (int8_t) (x))\n#define sext_i8_i32(x) ((int32_t) (int8_t) (x))\n#define sext_i8_i64(x) ((int64_t) (int8_t) (x))\n#define sext_i16_i8(x) ((int8_t) (int16_t) (x))\n#define sext_i16_i16(x) ((int16_t) (int16_t) (x))\n#define sext_i16_i32(x) ((int32_t) (int16_t) (x))\n#define sext_i16_i64(x) ((int64_t) (int16_t) (x))\n#define sext_i32_i8(x) ((int8_t) (int32_t) (x))\n#define sext_i32_i16(x) ((int16_t) (int32_t) (x))\n#define sext_i32_i32(x) ((int32_t) (int32_t) (x))\n#define sext_i32_i64(x) ((int64_t) (int32_t) (x))\n#define sext_i64_i8(x) ((int8_t) (int64_t) (x))\n#define sext_i64_i16(x) ((int16_t) (int64_t) (x))\n#define sext_i64_i32(x) ((int32_t) (int64_t) (x))\n#define sext_i64_i64(x) ((int64_t) (int64_t) (x))\n#define zext_i8_i8(x) ((int8_t) (uint8_t) (x))\n#define zext_i8_i16(x) ((int16_t) (uint8_t) (x))\n#define zext_i8_i32(x) ((int32_t) (uint8_t) (x))\n#define zext_i8_i64(x) ((int64_t) (uint8_t) (x))\n#define zext_i16_i8(x) ((int8_t) (uint16_t) (x))\n#define zext_i16_i16(x) ((int16_t) (uint16_t) (x))\n#define zext_i16_i32(x) ((int32_t) (uint16_t) (x))\n#define zext_i16_i64(x) ((int64_t) (uint16_t) (x))\n#define zext_i32_i8(x) ((int8_t) (uint32_t) (x))\n#define zext_i32_i16(x) ((int16_t) (uint32_t) (x))\n#define zext_i32_i32(x) ((int32_t) (uint32_t) (x))\n#define zext_i32_i64(x) ((int64_t) (uint32_t) (x))\n#define zext_i64_i8(x) ((int8_t) (uint64_t) (x))\n#define zext_i64_i16(x) ((int16_t) (uint64_t) (x))\n#define zext_i64_i32(x) ((int32_t) (uint64_t) (x))\n#define zext_i64_i64(x) ((int64_t) (uint64_t) (x))\n\nSCALAR_FUN_ATTR int8_t abs8(int8_t x) {\n  return (int8_t)abs(x);\n}\n\nSCALAR_FUN_ATTR int16_t abs16(int16_t x) {\n  return (int16_t)abs(x);\n}\n\nSCALAR_FUN_ATTR int32_t abs32(int32_t x) {\n  return abs(x);\n}\n\nSCALAR_FUN_ATTR int64_t abs64(int64_t x) {\n#if defined(__OPENCL_VER", "SION__) || defined(ISPC)\n  return abs(x);\n#else\n  return llabs(x);\n#endif\n}\n\n#if defined(__OPENCL_VERSION__)\nSCALAR_FUN_ATTR int32_t futrts_popc8(int8_t x) {\n  return popcount(x);\n}\n\nSCALAR_FUN_ATTR int32_t futrts_popc16(int16_t x) {\n  return popcount(x);\n}\n\nSCALAR_FUN_ATTR int32_t futrts_popc32(int32_t x) {\n  return popcount(x);\n}\n\nSCALAR_FUN_ATTR int32_t futrts_popc64(int64_t x) {\n  return popcount(x);\n}\n#elif defined(__CUDA_ARCH__)\n\nSCALAR_FUN_ATTR int32_t futrts_popc8(int8_t x) {\n  return __popc(zext_i8_i32(x));\n}\n\nSCALAR_FUN_ATTR int32_t futrts_popc16(int16_t x) {\n  return __popc(zext_i16_i32(x));\n}\n\nSCALAR_FUN_ATTR int32_t futrts_popc32(int32_t x) {\n  return __popc(x);\n}\n\nSCALAR_FUN_ATTR int32_t futrts_popc64(int64_t x) {\n  return __popcll(x);\n}\n\n#else // Not OpenCL or CUDA, but plain C.\n\nSCALAR_FUN_ATTR int32_t futrts_popc8(uint8_t x) {\n  int c = 0;\n  for (; x; ++c) { x &= x - 1; }\n  return c;\n}\n\nSCALAR_FUN_ATTR int32_t futrts_popc16(uint16_t x) {\n  int c = 0;\n  for (; x; ++c) { x &= x - 1; }\n  return c;\n}\n\nSCALAR_FUN_ATTR int32_t futrts_popc32(uint32_t x) {\n  int c = 0;\n  for (; x; ++c) { x &= x - 1; }\n  return c;\n}\n\nSCALAR_FUN_ATTR int32_t futrts_popc64(uint64_t x) {\n  int c = 0;\n  for (; x; ++c) { x &= x - 1; }\n  return c;\n}\n#endif\n\n#if defined(__OPENCL_VERSION__)\nSCALAR_FUN_ATTR uint8_t  futrts_umul_hi8 ( uint8_t a,  uint8_t b) { return mul_hi(a, b); }\nSCALAR_FUN_ATTR uint16_t futrts_umul_hi16(uint16_t a, uint16_t b) { return mul_hi(a, b); }\nSCALAR_FUN_ATTR uint32_t futrts_umul_hi32(uint32_t a, uint32_t b) { return mul_hi(a, b); }\nSCALAR_FUN_ATTR uint64_t futrts_umul_hi64(uint64_t a, uint64_t b) { return mul_hi(a, b); }\nSCALAR_FUN_ATTR uint8_t  futrts_smul_hi8 ( int8_t a,  int8_t b) { return mul_hi(a, b); }\nSCALAR_FUN_ATTR uint16_t futrts_smul_hi16(int16_t a, int16_t b) { return mul_hi(a, b); }\nSCALAR_FUN_ATTR uint32_t futrts_smul_hi32(int32_t a, int32_t b) { return mul_hi(a, b); }\nSCALAR_FUN_ATTR uint64_t futrts_smul_hi64(int64_t a, int64_t b) { return m", "ul_hi(a, b); }\n#elif defined(__CUDA_ARCH__)\nSCALAR_FUN_ATTR  uint8_t futrts_umul_hi8(uint8_t a, uint8_t b) { return ((uint16_t)a) * ((uint16_t)b) >> 8; }\nSCALAR_FUN_ATTR uint16_t futrts_umul_hi16(uint16_t a, uint16_t b) { return ((uint32_t)a) * ((uint32_t)b) >> 16; }\nSCALAR_FUN_ATTR uint32_t futrts_umul_hi32(uint32_t a, uint32_t b) { return __umulhi(a, b); }\nSCALAR_FUN_ATTR uint64_t futrts_umul_hi64(uint64_t a, uint64_t b) { return __umul64hi(a, b); }\nSCALAR_FUN_ATTR  uint8_t futrts_smul_hi8 ( int8_t a, int8_t b) { return ((int16_t)a) * ((int16_t)b) >> 8; }\nSCALAR_FUN_ATTR uint16_t futrts_smul_hi16(int16_t a, int16_t b) { return ((int32_t)a) * ((int32_t)b) >> 16; }\nSCALAR_FUN_ATTR uint32_t futrts_smul_hi32(int32_t a, int32_t b) { return __mulhi(a, b); }\nSCALAR_FUN_ATTR uint64_t futrts_smul_hi64(int64_t a, int64_t b) { return __mul64hi(a, b); }\n#elif ISPC\nSCALAR_FUN_ATTR uint8_t futrts_umul_hi8(uint8_t a, uint8_t b) { return ((uint16_t)a) * ((uint16_t)b) >> 8; }\nSCALAR_FUN_ATTR uint16_t futrts_umul_hi16(uint16_t a, uint16_t b) { return ((uint32_t)a) * ((uint32_t)b) >> 16; }\nSCALAR_FUN_ATTR uint32_t futrts_umul_hi32(uint32_t a, uint32_t b) { return ((uint64_t)a) * ((uint64_t)b) >> 32; }\nSCALAR_FUN_ATTR uint64_t futrts_umul_hi64(uint64_t a, uint64_t b) {\n  uint64_t ah = a >> 32;\n  uint64_t al = a & 0xffffffff;\n  uint64_t bh = b >> 32;\n  uint64_t bl = b & 0xffffffff;\n\n  uint64_t p1 = al * bl;\n  uint64_t p2 = al * bh;\n  uint64_t p3 = ah * bl;\n  uint64_t p4 = ah * bh;\n\n  uint64_t p1h = p1 >> 32;\n  uint64_t p2h = p2 >> 32;\n  uint64_t p3h = p3 >> 32;\n  uint64_t p2l = p2 & 0xffffffff;\n  uint64_t p3l = p3 & 0xffffffff;\n\n  uint64_t l = p1h + p2l + p3l;\n  uint64_t m = (p2 >> 32) + (p3 >> 32);\n  uint64_t h = (l >> 32) + m + p4;\n\n  return h;\n}\nSCALAR_FUN_ATTR  int8_t futrts_smul_hi8 ( int8_t a,  int8_t b) { return ((uint16_t)a) * ((uint16_t)b) >> 8; }\nSCALAR_FUN_ATTR int16_t futrts_smul_hi16(int16_t a, int16_t b) { return ((uint32_t)a) * ((uint32_t)b) >> 16; }\nSCALAR_FUN_ATTR int",
                                    "32_t futrts_smul_hi32(int32_t a, int32_t b) { return ((uint64_t)a) * ((uint64_t)b) >> 32; }\nSCALAR_FUN_ATTR int64_t futrts_smul_hi64(int64_t a, int64_t b) {\n  uint64_t ah = a >> 32;\n  uint64_t al = a & 0xffffffff;\n  uint64_t bh = b >> 32;\n  uint64_t bl = b & 0xffffffff;\n\n  uint64_t p1 =  al * bl;\n  int64_t  p2 = al * bh;\n  int64_t  p3 = ah * bl;\n  uint64_t p4 =  ah * bh;\n\n  uint64_t p1h = p1 >> 32;\n  uint64_t p2h = p2 >> 32;\n  uint64_t p3h = p3 >> 32;\n  uint64_t p2l = p2 & 0xffffffff;\n  uint64_t p3l = p3 & 0xffffffff;\n\n  uint64_t l = p1h + p2l + p3l;\n  uint64_t m = (p2 >> 32) + (p3 >> 32);\n  uint64_t h = (l >> 32) + m + p4;\n\n  return h;\n}\n\n#else // Not OpenCL, ISPC, or CUDA, but plain C.\nSCALAR_FUN_ATTR uint8_t futrts_umul_hi8(uint8_t a, uint8_t b) { return ((uint16_t)a) * ((uint16_t)b) >> 8; }\nSCALAR_FUN_ATTR uint16_t futrts_umul_hi16(uint16_t a, uint16_t b) { return ((uint32_t)a) * ((uint32_t)b) >> 16; }\nSCALAR_FUN_ATTR uint32_t futrts_umul_hi32(uint32_t a, uint32_t b) { return ((uint64_t)a) * ((uint64_t)b) >> 32; }\nSCALAR_FUN_ATTR uint64_t futrts_umul_hi64(uint64_t a, uint64_t b) { return ((__uint128_t)a) * ((__uint128_t)b) >> 64; }\nSCALAR_FUN_ATTR int8_t futrts_smul_hi8(int8_t a, int8_t b) { return ((int16_t)a) * ((int16_t)b) >> 8; }\nSCALAR_FUN_ATTR int16_t futrts_smul_hi16(int16_t a, int16_t b) { return ((int32_t)a) * ((int32_t)b) >> 16; }\nSCALAR_FUN_ATTR int32_t futrts_smul_hi32(int32_t a, int32_t b) { return ((int64_t)a) * ((int64_t)b) >> 32; }\nSCALAR_FUN_ATTR int64_t futrts_smul_hi64(int64_t a, int64_t b) { return ((__int128_t)a) * ((__int128_t)b) >> 64; }\n#endif\n\n#if defined(__OPENCL_VERSION__)\nSCALAR_FUN_ATTR  uint8_t futrts_umad_hi8 ( uint8_t a,  uint8_t b,  uint8_t c) { return mad_hi(a, b, c); }\nSCALAR_FUN_ATTR uint16_t futrts_umad_hi16(uint16_t a, uint16_t b, uint16_t c) { return mad_hi(a, b, c); }\nSCALAR_FUN_ATTR uint32_t futrts_umad_hi32(uint32_t a, uint32_t b, uint32_t c) { return mad_hi(a, b, c); }\nSCALAR_FUN_ATTR uint64_t futrts_umad_hi64(uint64_t ", "a, uint64_t b, uint64_t c) { return mad_hi(a, b, c); }\nSCALAR_FUN_ATTR  uint8_t futrts_smad_hi8( int8_t a,  int8_t b,   int8_t c) { return mad_hi(a, b, c); }\nSCALAR_FUN_ATTR uint16_t futrts_smad_hi16(int16_t a, int16_t b, int16_t c) { return mad_hi(a, b, c); }\nSCALAR_FUN_ATTR uint32_t futrts_smad_hi32(int32_t a, int32_t b, int32_t c) { return mad_hi(a, b, c); }\nSCALAR_FUN_ATTR uint64_t futrts_smad_hi64(int64_t a, int64_t b, int64_t c) { return mad_hi(a, b, c); }\n#else // Not OpenCL\n\nSCALAR_FUN_ATTR  uint8_t futrts_umad_hi8( uint8_t a,  uint8_t b,  uint8_t c) { return futrts_umul_hi8(a, b) + c; }\nSCALAR_FUN_ATTR uint16_t futrts_umad_hi16(uint16_t a, uint16_t b, uint16_t c) { return futrts_umul_hi16(a, b) + c; }\nSCALAR_FUN_ATTR uint32_t futrts_umad_hi32(uint32_t a, uint32_t b, uint32_t c) { return futrts_umul_hi32(a, b) + c; }\nSCALAR_FUN_ATTR uint64_t futrts_umad_hi64(uint64_t a, uint64_t b, uint64_t c) { return futrts_umul_hi64(a, b) + c; }\nSCALAR_FUN_ATTR  uint8_t futrts_smad_hi8 ( int8_t a,  int8_t b,  int8_t c) { return futrts_smul_hi8(a, b) + c; }\nSCALAR_FUN_ATTR uint16_t futrts_smad_hi16(int16_t a, int16_t b, int16_t c) { return futrts_smul_hi16(a, b) + c; }\nSCALAR_FUN_ATTR uint32_t futrts_smad_hi32(int32_t a, int32_t b, int32_t c) { return futrts_smul_hi32(a, b) + c; }\nSCALAR_FUN_ATTR uint64_t futrts_smad_hi64(int64_t a, int64_t b, int64_t c) { return futrts_smul_hi64(a, b) + c; }\n#endif\n\n#if defined(__OPENCL_VERSION__)\nSCALAR_FUN_ATTR int32_t futrts_clzz8(int8_t x) {\n  return clz(x);\n}\n\nSCALAR_FUN_ATTR int32_t futrts_clzz16(int16_t x) {\n  return clz(x);\n}\n\nSCALAR_FUN_ATTR int32_t futrts_clzz32(int32_t x) {\n  return clz(x);\n}\n\nSCALAR_FUN_ATTR int32_t futrts_clzz64(int64_t x) {\n  return clz(x);\n}\n\n#elif defined(__CUDA_ARCH__)\n\nSCALAR_FUN_ATTR int32_t futrts_clzz8(int8_t x) {\n  return __clz(zext_i8_i32(x)) - 24;\n}\n\nSCALAR_FUN_ATTR int32_t futrts_clzz16(int16_t x) {\n  return __clz(zext_i16_i32(x)) - 16;\n}\n\nSCALAR_FUN_ATTR int32_t futrts_clzz32(int32_t x) {\n  retur", "n __clz(x);\n}\n\nSCALAR_FUN_ATTR int32_t futrts_clzz64(int64_t x) {\n  return __clzll(x);\n}\n\n#elif ISPC\n\nSCALAR_FUN_ATTR int32_t futrts_clzz8(int8_t x) {\n  return count_leading_zeros((int32_t)(uint8_t)x)-24;\n}\n\nSCALAR_FUN_ATTR int32_t futrts_clzz16(int16_t x) {\n  return count_leading_zeros((int32_t)(uint16_t)x)-16;\n}\n\nSCALAR_FUN_ATTR int32_t futrts_clzz32(int32_t x) {\n  return count_leading_zeros(x);\n}\n\nSCALAR_FUN_ATTR int32_t futrts_clzz64(int64_t x) {\n  return count_leading_zeros(x);\n}\n\n#else // Not OpenCL, ISPC or CUDA, but plain C.\n\nSCALAR_FUN_ATTR int32_t futrts_clzz8(int8_t x) {\n  return x == 0 ? 8 : __builtin_clz((uint32_t)zext_i8_i32(x)) - 24;\n}\n\nSCALAR_FUN_ATTR int32_t futrts_clzz16(int16_t x) {\n  return x == 0 ? 16 : __builtin_clz((uint32_t)zext_i16_i32(x)) - 16;\n}\n\nSCALAR_FUN_ATTR int32_t futrts_clzz32(int32_t x) {\n  return x == 0 ? 32 : __builtin_clz((uint32_t)x);\n}\n\nSCALAR_FUN_ATTR int32_t futrts_clzz64(int64_t x) {\n  return x == 0 ? 64 : __builtin_clzll((uint64_t)x);\n}\n#endif\n\n#if defined(__OPENCL_VERSION__)\nSCALAR_FUN_ATTR int32_t futrts_ctzz8(int8_t x) {\n  int i = 0;\n  for (; i < 8 && (x & 1) == 0; i++, x >>= 1)\n    ;\n  return i;\n}\n\nSCALAR_FUN_ATTR int32_t futrts_ctzz16(int16_t x) {\n  int i = 0;\n  for (; i < 16 && (x & 1) == 0; i++, x >>= 1)\n    ;\n  return i;\n}\n\nSCALAR_FUN_ATTR int32_t futrts_ctzz32(int32_t x) {\n  int i = 0;\n  for (; i < 32 && (x & 1) == 0; i++, x >>= 1)\n    ;\n  return i;\n}\n\nSCALAR_FUN_ATTR int32_t futrts_ctzz64(int64_t x) {\n  int i = 0;\n  for (; i < 64 && (x & 1) == 0; i++, x >>= 1)\n    ;\n  return i;\n}\n\n#elif defined(__CUDA_ARCH__)\n\nSCALAR_FUN_ATTR int32_t futrts_ctzz8(int8_t x) {\n  int y = __ffs(x);\n  return y == 0 ? 8 : y - 1;\n}\n\nSCALAR_FUN_ATTR int32_t futrts_ctzz16(int16_t x) {\n  int y = __ffs(x);\n  return y == 0 ? 16 : y - 1;\n}\n\nSCALAR_FUN_ATTR int32_t futrts_ctzz32(int32_t x) {\n  int y = __ffs(x);\n  return y == 0 ? 32 : y - 1;\n}\n\nSCALAR_FUN_ATTR int32_t futrts_ctzz64(int64_t x) {\n  int y = __ffsll(x);\n  return y == 0 ? 64 : y - 1",
                                    ";\n}\n\n#elif ISPC\n\nSCALAR_FUN_ATTR int32_t futrts_ctzz8(int8_t x) {\n  return x == 0 ? 8 : count_trailing_zeros((int32_t)x);\n}\n\nSCALAR_FUN_ATTR int32_t futrts_ctzz16(int16_t x) {\n  return x == 0 ? 16 : count_trailing_zeros((int32_t)x);\n}\n\nSCALAR_FUN_ATTR int32_t futrts_ctzz32(int32_t x) {\n  return count_trailing_zeros(x);\n}\n\nSCALAR_FUN_ATTR int32_t futrts_ctzz64(int64_t x) {\n  return count_trailing_zeros(x);\n}\n\n#else // Not OpenCL or CUDA, but plain C.\n\nSCALAR_FUN_ATTR int32_t futrts_ctzz8(int8_t x) {\n  return x == 0 ? 8 : __builtin_ctz((uint32_t)x);\n}\n\nSCALAR_FUN_ATTR int32_t futrts_ctzz16(int16_t x) {\n  return x == 0 ? 16 : __builtin_ctz((uint32_t)x);\n}\n\nSCALAR_FUN_ATTR int32_t futrts_ctzz32(int32_t x) {\n  return x == 0 ? 32 : __builtin_ctz((uint32_t)x);\n}\n\nSCALAR_FUN_ATTR int32_t futrts_ctzz64(int64_t x) {\n  return x == 0 ? 64 : __builtin_ctzll((uint64_t)x);\n}\n#endif\n\nSCALAR_FUN_ATTR float fdiv32(float x, float y) {\n  return x / y;\n}\n\nSCALAR_FUN_ATTR float fadd32(float x, float y) {\n  return x + y;\n}\n\nSCALAR_FUN_ATTR float fsub32(float x, float y) {\n  return x - y;\n}\n\nSCALAR_FUN_ATTR float fmul32(float x, float y) {\n  return x * y;\n}\n\nSCALAR_FUN_ATTR bool cmplt32(float x, float y) {\n  return x < y;\n}\n\nSCALAR_FUN_ATTR bool cmple32(float x, float y) {\n  return x <= y;\n}\n\nSCALAR_FUN_ATTR float sitofp_i8_f32(int8_t x) {\n  return (float) x;\n}\n\nSCALAR_FUN_ATTR float sitofp_i16_f32(int16_t x) {\n  return (float) x;\n}\n\nSCALAR_FUN_ATTR float sitofp_i32_f32(int32_t x) {\n  return (float) x;\n}\n\nSCALAR_FUN_ATTR float sitofp_i64_f32(int64_t x) {\n  return (float) x;\n}\n\nSCALAR_FUN_ATTR float uitofp_i8_f32(uint8_t x) {\n  return (float) x;\n}\n\nSCALAR_FUN_ATTR float uitofp_i16_f32(uint16_t x) {\n  return (float) x;\n}\n\nSCALAR_FUN_ATTR float uitofp_i32_f32(uint32_t x) {\n  return (float) x;\n}\n\nSCALAR_FUN_ATTR float uitofp_i64_f32(uint64_t x) {\n  return (float) x;\n}\n\n#ifdef __OPENCL_VERSION__\nSCALAR_FUN_ATTR float fabs32(float x) {\n  return fabs(x);\n}\n\nSCALAR_FUN_ATTR float fmax32(float x, f", "loat y) {\n  return fmax(x, y);\n}\n\nSCALAR_FUN_ATTR float fmin32(float x, float y) {\n  return fmin(x, y);\n}\n\nSCALAR_FUN_ATTR float fpow32(float x, float y) {\n  return pow(x, y);\n}\n\n#elif ISPC\n\nSCALAR_FUN_ATTR float fabs32(float x) {\n  return abs(x);\n}\n\nSCALAR_FUN_ATTR float fmax32(float x, float y) {\n  return isnan(x) ? y : isnan(y) ? x : max(x, y);\n}\n\nSCALAR_FUN_ATTR float fmin32(float x, float y) {\n  return isnan(x) ? y : isnan(y) ? x : min(x, y);\n}\n\nSCALAR_FUN_ATTR float fpow32(float a, float b) {\n  float ret;\n  foreach_active (i) {\n      uniform float r = __stdlib_powf(extract(a, i), extract(b, i));\n      ret = insert(ret, i, r);\n  }\n  return ret;\n}\n\n#else // Not OpenCL, but CUDA or plain C.\n\nSCALAR_FUN_ATTR float fabs32(float x) {\n  return fabsf(x);\n}\n\nSCALAR_FUN_ATTR float fmax32(float x, float y) {\n  return fmaxf(x, y);\n}\n\nSCALAR_FUN_ATTR float fmin32(float x, float y) {\n  return fminf(x, y);\n}\n\nSCALAR_FUN_ATTR float fpow32(float x, float y) {\n  return powf(x, y);\n}\n#endif\n\nSCALAR_FUN_ATTR bool futrts_isnan32(float x) {\n  return isnan(x);\n}\n\n#if ISPC\n\nSCALAR_FUN_ATTR bool futrts_isinf32(float x) {\n  return !isnan(x) && isnan(x - x);\n}\n\nSCALAR_FUN_ATTR bool futrts_isfinite32(float x) {\n  return !isnan(x) && !futrts_isinf32(x);\n}\n\n#else\n\nSCALAR_FUN_ATTR bool futrts_isinf32(float x) {\n  return isinf(x);\n}\n\n#endif\n\nSCALAR_FUN_ATTR int8_t fptosi_f32_i8(float x) {\n  if (futrts_isnan32(x) || futrts_isinf32(x)) {\n    return 0;\n  } else {\n    return (int8_t) x;\n  }\n}\n\nSCALAR_FUN_ATTR int16_t fptosi_f32_i16(float x) {\n  if (futrts_isnan32(x) || futrts_isinf32(x)) {\n    return 0;\n  } else {\n    return (int16_t) x;\n  }\n}\n\nSCALAR_FUN_ATTR int32_t fptosi_f32_i32(float x) {\n  if (futrts_isnan32(x) || futrts_isinf32(x)) {\n    return 0;\n  } else {\n    return (int32_t) x;\n  }\n}\n\nSCALAR_FUN_ATTR int64_t fptosi_f32_i64(float x) {\n  if (futrts_isnan32(x) || futrts_isinf32(x)) {\n    return 0;\n  } else {\n    return (int64_t) x;\n  };\n}\n\nSCALAR_FUN_ATTR uint8_t fptoui_f32_i8(float x) {", "\n  if (futrts_isnan32(x) || futrts_isinf32(x)) {\n    return 0;\n  } else {\n    return (uint8_t) (int8_t) x;\n  }\n}\n\nSCALAR_FUN_ATTR uint16_t fptoui_f32_i16(float x) {\n  if (futrts_isnan32(x) || futrts_isinf32(x)) {\n    return 0;\n  } else {\n    return (uint16_t) (int16_t) x;\n  }\n}\n\nSCALAR_FUN_ATTR uint32_t fptoui_f32_i32(float x) {\n  if (futrts_isnan32(x) || futrts_isinf32(x)) {\n    return 0;\n  } else {\n    return (uint32_t) (int32_t) x;\n  }\n}\n\nSCALAR_FUN_ATTR uint64_t fptoui_f32_i64(float x) {\n  if (futrts_isnan32(x) || futrts_isinf32(x)) {\n    return 0;\n  } else {\n    return (uint64_t) (int64_t) x;\n  }\n}\n\nSCALAR_FUN_ATTR bool ftob_f32_bool(float x) {\n  return x != 0;\n}\n\nSCALAR_FUN_ATTR float btof_bool_f32(bool x) {\n  return x ? 1 : 0;\n}\n\n#ifdef __OPENCL_VERSION__\nSCALAR_FUN_ATTR float futrts_log32(float x) {\n  return log(x);\n}\n\nSCALAR_FUN_ATTR float futrts_log2_32(float x) {\n  return log2(x);\n}\n\nSCALAR_FUN_ATTR float futrts_log10_32(float x) {\n  return log10(x);\n}\n\nSCALAR_FUN_ATTR float futrts_log1p_32(float x) {\n  return log1p(x);\n}\n\nSCALAR_FUN_ATTR float futrts_sqrt32(float x) {\n  return sqrt(x);\n}\n\nSCALAR_FUN_ATTR float futrts_cbrt32(float x) {\n  return cbrt(x);\n}\n\nSCALAR_FUN_ATTR float futrts_exp32(float x) {\n  return exp(x);\n}\n\nSCALAR_FUN_ATTR float futrts_cos32(float x) {\n  return cos(x);\n}\n\nSCALAR_FUN_ATTR float futrts_sin32(float x) {\n  return sin(x);\n}\n\nSCALAR_FUN_ATTR float futrts_tan32(float x) {\n  return tan(x);\n}\n\nSCALAR_FUN_ATTR float futrts_acos32(float x) {\n  return acos(x);\n}\n\nSCALAR_FUN_ATTR float futrts_asin32(float x) {\n  return asin(x);\n}\n\nSCALAR_FUN_ATTR float futrts_atan32(float x) {\n  return atan(x);\n}\n\nSCALAR_FUN_ATTR float futrts_cosh32(float x) {\n  return cosh(x);\n}\n\nSCALAR_FUN_ATTR float futrts_sinh32(float x) {\n  return sinh(x);\n}\n\nSCALAR_FUN_ATTR float futrts_tanh32(float x) {\n  return tanh(x);\n}\n\nSCALAR_FUN_ATTR float futrts_acosh32(float x) {\n  return acosh(x);\n}\n\nSCALAR_FUN_ATTR float futrts_asinh32(float x) {\n  return asinh(x);\n}\n\nSC",
                                    "ALAR_FUN_ATTR float futrts_atanh32(float x) {\n  return atanh(x);\n}\n\nSCALAR_FUN_ATTR float futrts_atan2_32(float x, float y) {\n  return atan2(x, y);\n}\n\nSCALAR_FUN_ATTR float futrts_hypot32(float x, float y) {\n  return hypot(x, y);\n}\n\nSCALAR_FUN_ATTR float futrts_gamma32(float x) {\n  return tgamma(x);\n}\n\nSCALAR_FUN_ATTR float futrts_lgamma32(float x) {\n  return lgamma(x);\n}\n\nSCALAR_FUN_ATTR float futrts_erf32(float x) {\n  return erf(x);\n}\n\nSCALAR_FUN_ATTR float futrts_erfc32(float x) {\n  return erfc(x);\n}\n\nSCALAR_FUN_ATTR float fmod32(float x, float y) {\n  return fmod(x, y);\n}\n\nSCALAR_FUN_ATTR float futrts_round32(float x) {\n  return rint(x);\n}\n\nSCALAR_FUN_ATTR float futrts_floor32(float x) {\n  return floor(x);\n}\n\nSCALAR_FUN_ATTR float futrts_ceil32(float x) {\n  return ceil(x);\n}\n\nSCALAR_FUN_ATTR float futrts_nextafter32(float x, float y) {\n  return nextafter(x, y);\n}\n\nSCALAR_FUN_ATTR float futrts_lerp32(float v0, float v1, float t) {\n  return mix(v0, v1, t);\n}\n\nSCALAR_FUN_ATTR float futrts_ldexp32(float x, int32_t y) {\n  return ldexp(x, y);\n}\n\nSCALAR_FUN_ATTR float futrts_copysign32(float x, float y) {\n  return copysign(x, y);\n}\n\nSCALAR_FUN_ATTR float futrts_mad32(float a, float b, float c) {\n  return mad(a, b, c);\n}\n\nSCALAR_FUN_ATTR float futrts_fma32(float a, float b, float c) {\n  return fma(a, b, c);\n}\n\n#elif ISPC\n\nSCALAR_FUN_ATTR float futrts_log32(float x) {\n  return futrts_isfinite32(x) || (futrts_isinf32(x) && x < 0)? log(x) : x;\n}\n\nSCALAR_FUN_ATTR float futrts_log2_32(float x) {\n  return futrts_log32(x) / log(2.0f);\n}\n\nSCALAR_FUN_ATTR float futrts_log10_32(float x) {\n  return futrts_log32(x) / log(10.0f);\n}\n\nSCALAR_FUN_ATTR float futrts_log1p_32(float x) {\n  if(x == -1.0f || (futrts_isinf32(x) && x > 0.0f)) return x / 0.0f;\n  float y = 1.0f + x;\n  float z = y - 1.0f;\n  return log(y) - (z-x)/y;\n}\n\nSCALAR_FUN_ATTR float futrts_sqrt32(float x) {\n  return sqrt(x);\n}\n\nextern \"C\" unmasked uniform float cbrtf(uniform float);\nSCALAR_FUN_ATTR float futrts_cbrt32(float", " x) {\n  float res;\n  foreach_active (i) {\n    uniform float r = cbrtf(extract(x, i));\n    res = insert(res, i, r);\n  }\n  return res;\n}\n\nSCALAR_FUN_ATTR float futrts_exp32(float x) {\n  return exp(x);\n}\n\nSCALAR_FUN_ATTR float futrts_cos32(float x) {\n  return cos(x);\n}\n\nSCALAR_FUN_ATTR float futrts_sin32(float x) {\n  return sin(x);\n}\n\nSCALAR_FUN_ATTR float futrts_tan32(float x) {\n  return tan(x);\n}\n\nSCALAR_FUN_ATTR float futrts_acos32(float x) {\n  return acos(x);\n}\n\nSCALAR_FUN_ATTR float futrts_asin32(float x) {\n  return asin(x);\n}\n\nSCALAR_FUN_ATTR float futrts_atan32(float x) {\n  return atan(x);\n}\n\nSCALAR_FUN_ATTR float futrts_cosh32(float x) {\n  return (exp(x)+exp(-x)) / 2.0f;\n}\n\nSCALAR_FUN_ATTR float futrts_sinh32(float x) {\n  return (exp(x)-exp(-x)) / 2.0f;\n}\n\nSCALAR_FUN_ATTR float futrts_tanh32(float x) {\n  return futrts_sinh32(x)/futrts_cosh32(x);\n}\n\nSCALAR_FUN_ATTR float futrts_acosh32(float x) {\n  float f = x+sqrt(x*x-1);\n  if(futrts_isfinite32(f)) return log(f);\n  return f;\n}\n\nSCALAR_FUN_ATTR float futrts_asinh32(float x) {\n  float f = x+sqrt(x*x+1);\n  if(futrts_isfinite32(f)) return log(f);\n  return f;\n\n}\n\nSCALAR_FUN_ATTR float futrts_atanh32(float x) {\n  float f = (1+x)/(1-x);\n  if(futrts_isfinite32(f)) return log(f)/2.0f;\n  return f;\n\n}\n\nSCALAR_FUN_ATTR float futrts_atan2_32(float x, float y) {\n  return (x == 0.0f && y == 0.0f) ? 0.0f : atan2(x, y);\n}\n\nSCALAR_FUN_ATTR float futrts_hypot32(float x, float y) {\n  if (futrts_isfinite32(x) && futrts_isfinite32(y)) {\n    x = abs(x);\n    y = abs(y);\n    float a;\n    float b;\n    if (x >= y){\n        a = x;\n        b = y;\n    } else {\n        a = y;\n        b = x;\n    }\n    if(b == 0){\n      return a;\n    }\n\n    int e;\n    float an;\n    float bn;\n    an = frexp (a, &e);\n    bn = ldexp (b, - e);\n    float cn;\n    cn = sqrt (an * an + bn * bn);\n    return ldexp (cn, e);\n  } else {\n    if (futrts_isinf32(x) || futrts_isinf32(y)) return INFINITY;\n    else return x + y;\n  }\n\n}\n\nextern \"C\" unmasked uniform float tgammaf(", "uniform float x);\nSCALAR_FUN_ATTR float futrts_gamma32(float x) {\n  float res;\n  foreach_active (i) {\n    uniform float r = tgammaf(extract(x, i));\n    res = insert(res, i, r);\n  }\n  return res;\n}\n\nextern \"C\" unmasked uniform float lgammaf(uniform float x);\nSCALAR_FUN_ATTR float futrts_lgamma32(float x) {\n  float res;\n  foreach_active (i) {\n    uniform float r = lgammaf(extract(x, i));\n    res = insert(res, i, r);\n  }\n  return res;\n}\n\nextern \"C\" unmasked uniform float erff(uniform float x);\nSCALAR_FUN_ATTR float futrts_erf32(float x) {\n  float res;\n  foreach_active (i) {\n    uniform float r = erff(extract(x, i));\n    res = insert(res, i, r);\n  }\n  return res;\n}\n\nextern \"C\" unmasked uniform float erfcf(uniform float x);\nSCALAR_FUN_ATTR float futrts_erfc32(float x) {\n  float res;\n  foreach_active (i) {\n    uniform float r = erfcf(extract(x, i));\n    res = insert(res, i, r);\n  }\n  return res;\n}\n\nSCALAR_FUN_ATTR float fmod32(float x, float y) {\n  return x - y * trunc(x/y);\n}\n\nSCALAR_FUN_ATTR float futrts_round32(float x) {\n  return round(x);\n}\n\nSCALAR_FUN_ATTR float futrts_floor32(float x) {\n  return floor(x);\n}\n\nSCALAR_FUN_ATTR float futrts_ceil32(float x) {\n  return ceil(x);\n}\n\nextern \"C\" unmasked uniform float nextafterf(uniform float x, uniform float y);\nSCALAR_FUN_ATTR float futrts_nextafter32(float x, float y) {\n  float res;\n  foreach_active (i) {\n    uniform float r = nextafterf(extract(x, i), extract(y, i));\n    res = insert(res, i, r);\n  }\n  return res;\n}\n\nSCALAR_FUN_ATTR float futrts_lerp32(float v0, float v1, float t) {\n  return v0 + (v1 - v0) * t;\n}\n\nSCALAR_FUN_ATTR float futrts_ldexp32(float x, int32_t y) {\n  return x * pow((double)2.0, (double)y);\n}\n\nSCALAR_FUN_ATTR float futrts_copysign32(float x, float y) {\n  int32_t xb = futrts_to_bits32(x);\n  int32_t yb = futrts_to_bits32(y);\n  return futrts_from_bits32((xb & ~(1<<31)) | (yb & (1<<31)));\n}\n\nSCALAR_FUN_ATTR float futrts_mad32(float a, float b, float c) {\n  return a * b + c;\n}\n\nSCALAR_FUN_ATTR float futr",
                                    "ts_fma32(float a, float b, float c) {\n  return a * b + c;\n}\n\n#else // Not OpenCL or ISPC, but CUDA or plain C.\n\nSCALAR_FUN_ATTR float futrts_log32(float x) {\n  return logf(x);\n}\n\nSCALAR_FUN_ATTR float futrts_log2_32(float x) {\n  return log2f(x);\n}\n\nSCALAR_FUN_ATTR float futrts_log10_32(float x) {\n  return log10f(x);\n}\n\nSCALAR_FUN_ATTR float futrts_log1p_32(float x) {\n  return log1pf(x);\n}\n\nSCALAR_FUN_ATTR float futrts_sqrt32(float x) {\n  return sqrtf(x);\n}\n\nSCALAR_FUN_ATTR float futrts_cbrt32(float x) {\n  return cbrtf(x);\n}\n\nSCALAR_FUN_ATTR float futrts_exp32(float x) {\n  return expf(x);\n}\n\nSCALAR_FUN_ATTR float futrts_cos32(float x) {\n  return cosf(x);\n}\n\nSCALAR_FUN_ATTR float futrts_sin32(float x) {\n  return sinf(x);\n}\n\nSCALAR_FUN_ATTR float futrts_tan32(float x) {\n  return tanf(x);\n}\n\nSCALAR_FUN_ATTR float futrts_acos32(float x) {\n  return acosf(x);\n}\n\nSCALAR_FUN_ATTR float futrts_asin32(float x) {\n  return asinf(x);\n}\n\nSCALAR_FUN_ATTR float futrts_atan32(float x) {\n  return atanf(x);\n}\n\nSCALAR_FUN_ATTR float futrts_cosh32(float x) {\n  return coshf(x);\n}\n\nSCALAR_FUN_ATTR float futrts_sinh32(float x) {\n  return sinhf(x);\n}\n\nSCALAR_FUN_ATTR float futrts_tanh32(float x) {\n  return tanhf(x);\n}\n\nSCALAR_FUN_ATTR float futrts_acosh32(float x) {\n  return acoshf(x);\n}\n\nSCALAR_FUN_ATTR float futrts_asinh32(float x) {\n  return asinhf(x);\n}\n\nSCALAR_FUN_ATTR float futrts_atanh32(float x) {\n  return atanhf(x);\n}\n\nSCALAR_FUN_ATTR float futrts_atan2_32(float x, float y) {\n  return atan2f(x, y);\n}\n\nSCALAR_FUN_ATTR float futrts_hypot32(float x, float y) {\n  return hypotf(x, y);\n}\n\nSCALAR_FUN_ATTR float futrts_gamma32(float x) {\n  return tgammaf(x);\n}\n\nSCALAR_FUN_ATTR float futrts_lgamma32(float x) {\n  return lgammaf(x);\n}\n\nSCALAR_FUN_ATTR float futrts_erf32(float x) {\n  return erff(x);\n}\n\nSCALAR_FUN_ATTR float futrts_erfc32(float x) {\n  return erfcf(x);\n}\n\nSCALAR_FUN_ATTR float fmod32(float x, float y) {\n  return fmodf(x, y);\n}\n\nSCALAR_FUN_ATTR float futrts_round32(float x) {\n  re", "turn rintf(x);\n}\n\nSCALAR_FUN_ATTR float futrts_floor32(float x) {\n  return floorf(x);\n}\n\nSCALAR_FUN_ATTR float futrts_ceil32(float x) {\n  return ceilf(x);\n}\n\nSCALAR_FUN_ATTR float futrts_nextafter32(float x, float y) {\n  return nextafterf(x, y);\n}\n\nSCALAR_FUN_ATTR float futrts_lerp32(float v0, float v1, float t) {\n  return v0 + (v1 - v0) * t;\n}\n\nSCALAR_FUN_ATTR float futrts_ldexp32(float x, int32_t y) {\n  return ldexpf(x, y);\n}\n\nSCALAR_FUN_ATTR float futrts_copysign32(float x, float y) {\n  return copysignf(x, y);\n}\n\nSCALAR_FUN_ATTR float futrts_mad32(float a, float b, float c) {\n  return a * b + c;\n}\n\nSCALAR_FUN_ATTR float futrts_fma32(float a, float b, float c) {\n  return fmaf(a, b, c);\n}\n#endif\n\n#if ISPC\nSCALAR_FUN_ATTR int32_t futrts_to_bits32(float x) {\n  return intbits(x);\n}\n\nSCALAR_FUN_ATTR float futrts_from_bits32(int32_t x) {\n  return floatbits(x);\n}\n#else\nSCALAR_FUN_ATTR int32_t futrts_to_bits32(float x) {\n  union {\n    float f;\n    int32_t t;\n  } p;\n\n  p.f = x;\n  return p.t;\n}\n\nSCALAR_FUN_ATTR float futrts_from_bits32(int32_t x) {\n  union {\n    int32_t f;\n    float t;\n  } p;\n\n  p.f = x;\n  return p.t;\n}\n#endif\n\nSCALAR_FUN_ATTR float fsignum32(float x) {\n  return futrts_isnan32(x) ? x : (x > 0 ? 1 : 0) - (x < 0 ? 1 : 0);\n}\n\n#ifdef FUTHARK_F64_ENABLED\n\nSCALAR_FUN_ATTR double futrts_from_bits64(int64_t x);\nSCALAR_FUN_ATTR int64_t futrts_to_bits64(double x);\n\n#if ISPC\nSCALAR_FUN_ATTR bool futrts_isinf64(float x) {\n  return !isnan(x) && isnan(x - x);\n}\n\nSCALAR_FUN_ATTR bool futrts_isfinite64(float x) {\n  return !isnan(x) && !futrts_isinf64(x);\n}\n\nSCALAR_FUN_ATTR double fdiv64(double x, double y) {\n  return x / y;\n}\n\nSCALAR_FUN_ATTR double fadd64(double x, double y) {\n  return x + y;\n}\n\nSCALAR_FUN_ATTR double fsub64(double x, double y) {\n  return x - y;\n}\n\nSCALAR_FUN_ATTR double fmul64(double x, double y) {\n  return x * y;\n}\n\nSCALAR_FUN_ATTR bool cmplt64(double x, double y) {\n  return x < y;\n}\n\nSCALAR_FUN_ATTR bool cmple64(double x, double y) {\n  return x <= y;\n}", "\n\nSCALAR_FUN_ATTR double sitofp_i8_f64(int8_t x) {\n  return (double) x;\n}\n\nSCALAR_FUN_ATTR double sitofp_i16_f64(int16_t x) {\n  return (double) x;\n}\n\nSCALAR_FUN_ATTR double sitofp_i32_f64(int32_t x) {\n  return (double) x;\n}\n\nSCALAR_FUN_ATTR double sitofp_i64_f64(int64_t x) {\n  return (double) x;\n}\n\nSCALAR_FUN_ATTR double uitofp_i8_f64(uint8_t x) {\n  return (double) x;\n}\n\nSCALAR_FUN_ATTR double uitofp_i16_f64(uint16_t x) {\n  return (double) x;\n}\n\nSCALAR_FUN_ATTR double uitofp_i32_f64(uint32_t x) {\n  return (double) x;\n}\n\nSCALAR_FUN_ATTR double uitofp_i64_f64(uint64_t x) {\n  return (double) x;\n}\n\nSCALAR_FUN_ATTR double fabs64(double x) {\n  return abs(x);\n}\n\nSCALAR_FUN_ATTR double fmax64(double x, double y) {\n  return isnan(x) ? y : isnan(y) ? x : max(x, y);\n}\n\nSCALAR_FUN_ATTR double fmin64(double x, double y) {\n  return isnan(x) ? y : isnan(y) ? x : min(x, y);\n}\n\nSCALAR_FUN_ATTR double fpow64(double a, double b) {\n  float ret;\n  foreach_active (i) {\n      uniform float r = __stdlib_powf(extract(a, i), extract(b, i));\n      ret = insert(ret, i, r);\n  }\n  return ret;\n}\n\nSCALAR_FUN_ATTR double futrts_log64(double x) {\n  return futrts_isfinite64(x) || (futrts_isinf64(x) && x < 0)? log(x) : x;\n}\n\nSCALAR_FUN_ATTR double futrts_log2_64(double x) {\n  return futrts_log64(x)/log(2.0d);\n}\n\nSCALAR_FUN_ATTR double futrts_log10_64(double x) {\n  return futrts_log64(x)/log(10.0d);\n}\n\nSCALAR_FUN_ATTR double futrts_log1p_64(double x) {\n  if(x == -1.0d || (futrts_isinf64(x) && x > 0.0d)) return x / 0.0d;\n  double y = 1.0d + x;\n  double z = y - 1.0d;\n  return log(y) - (z-x)/y;\n}\n\nSCALAR_FUN_ATTR double futrts_sqrt64(double x) {\n  return sqrt(x);\n}\n\nextern \"C\" unmasked uniform double cbrt(uniform double);\nSCALAR_FUN_ATTR double futrts_cbrt64(double x) {\n  double res;\n  foreach_active (i) {\n    uniform double r = cbrtf(extract(x, i));\n    res = insert(res, i, r);\n  }\n  return res;\n}\n\nSCALAR_FUN_ATTR double futrts_exp64(double x) {\n  return exp(x);\n}\n\nSCALAR_FUN_ATTR double futrts_cos64(dou",
                                    "ble x) {\n  return cos(x);\n}\n\nSCALAR_FUN_ATTR double futrts_sin64(double x) {\n  return sin(x);\n}\n\nSCALAR_FUN_ATTR double futrts_tan64(double x) {\n  return tan(x);\n}\n\nSCALAR_FUN_ATTR double futrts_acos64(double x) {\n  return acos(x);\n}\n\nSCALAR_FUN_ATTR double futrts_asin64(double x) {\n  return asin(x);\n}\n\nSCALAR_FUN_ATTR double futrts_atan64(double x) {\n  return atan(x);\n}\n\nSCALAR_FUN_ATTR double futrts_cosh64(double x) {\n  return (exp(x)+exp(-x)) / 2.0d;\n}\n\nSCALAR_FUN_ATTR double futrts_sinh64(double x) {\n  return (exp(x)-exp(-x)) / 2.0d;\n}\n\nSCALAR_FUN_ATTR double futrts_tanh64(double x) {\n  return futrts_sinh64(x)/futrts_cosh64(x);\n}\n\nSCALAR_FUN_ATTR double futrts_acosh64(double x) {\n  double f = x+sqrt(x*x-1.0d);\n  if(futrts_isfinite64(f)) return log(f);\n  return f;\n}\n\nSCALAR_FUN_ATTR double futrts_asinh64(double x) {\n  double f = x+sqrt(x*x+1.0d);\n  if(futrts_isfinite64(f)) return log(f);\n  return f;\n}\n\nSCALAR_FUN_ATTR double futrts_atanh64(double x) {\n  double f = (1.0d+x)/(1.0d-x);\n  if(futrts_isfinite64(f)) return log(f)/2.0d;\n  return f;\n\n}\n\nSCALAR_FUN_ATTR double futrts_atan2_64(double x, double y) {\n  return atan2(x, y);\n}\n\nextern \"C\" unmasked uniform double hypot(uniform double x, uniform double y);\nSCALAR_FUN_ATTR double futrts_hypot64(double x, double y) {\n  double res;\n  foreach_active (i) {\n    uniform double r = hypot(extract(x, i), extract(y, i));\n    res = insert(res, i, r);\n  }\n  return res;\n}\n\nextern \"C\" unmasked uniform double tgamma(uniform double x);\nSCALAR_FUN_ATTR double futrts_gamma64(double x) {\n  double res;\n  foreach_active (i) {\n    uniform double r = tgamma(extract(x, i));\n    res = insert(res, i, r);\n  }\n  return res;\n}\n\nextern \"C\" unmasked uniform double lgamma(uniform double x);\nSCALAR_FUN_ATTR double futrts_lgamma64(double x) {\n  double res;\n  foreach_active (i) {\n    uniform double r = lgamma(extract(x, i));\n    res = insert(res, i, r);\n  }\n  return res;\n}\n\nextern \"C\" unmasked uniform double erf(uniform double x);\nSCALAR_FUN_ATTR do", "uble futrts_erf64(double x) {\n  double res;\n  foreach_active (i) {\n    uniform double r = erf(extract(x, i));\n    res = insert(res, i, r);\n  }\n  return res;\n}\n\nextern \"C\" unmasked uniform double erfc(uniform double x);\nSCALAR_FUN_ATTR double futrts_erfc64(double x) {\n  double res;\n  foreach_active (i) {\n    uniform double r = erfc(extract(x, i));\n    res = insert(res, i, r);\n  }\n  return res;\n}\n\nSCALAR_FUN_ATTR double futrts_fma64(double a, double b, double c) {\n  return a * b + c;\n}\n\nSCALAR_FUN_ATTR double futrts_round64(double x) {\n  return round(x);\n}\n\nSCALAR_FUN_ATTR double futrts_ceil64(double x) {\n  return ceil(x);\n}\n\nextern \"C\" unmasked uniform double nextafter(uniform float x, uniform double y);\nSCALAR_FUN_ATTR float futrts_nextafter64(double x, double y) {\n  double res;\n  foreach_active (i) {\n    uniform double r = nextafter(extract(x, i), extract(y, i));\n    res = insert(res, i, r);\n  }\n  return res;\n}\n\nSCALAR_FUN_ATTR double futrts_floor64(double x) {\n  return floor(x);\n}\n\nSCALAR_FUN_ATTR bool futrts_isnan64(double x) {\n  return isnan(x);\n}\n\nSCALAR_FUN_ATTR int8_t fptosi_f64_i8(double x) {\n  if (futrts_isnan64(x) || futrts_isinf64(x)) {\n    return 0;\n  } else {\n    return (int8_t) x;\n  }\n}\n\nSCALAR_FUN_ATTR int16_t fptosi_f64_i16(double x) {\n  if (futrts_isnan64(x) || futrts_isinf64(x)) {\n    return 0;\n  } else {\n    return (int16_t) x;\n  }\n}\n\nSCALAR_FUN_ATTR int32_t fptosi_f64_i32(double x) {\n  if (futrts_isnan64(x) || futrts_isinf64(x)) {\n    return 0;\n  } else {\n    return (int32_t) x;\n  }\n}\n\nSCALAR_FUN_ATTR int64_t fptosi_f64_i64(double x) {\n  if (futrts_isnan64(x) || futrts_isinf64(x)) {\n    return 0;\n  } else {\n    return (int64_t) x;\n  }\n}\n\nSCALAR_FUN_ATTR uint8_t fptoui_f64_i8(double x) {\n  if (futrts_isnan64(x) || futrts_isinf64(x)) {\n    return 0;\n  } else {\n    return (uint8_t) (int8_t) x;\n  }\n}\n\nSCALAR_FUN_ATTR uint16_t fptoui_f64_i16(double x) {\n  if (futrts_isnan64(x) || futrts_isinf64(x)) {\n    return 0;\n  } else {\n    return (uint16_t) (int", "16_t) x;\n  }\n}\n\nSCALAR_FUN_ATTR uint32_t fptoui_f64_i32(double x) {\n  if (futrts_isnan64(x) || futrts_isinf64(x)) {\n    return 0;\n  } else {\n    return (uint32_t) (int32_t) x;\n  }\n}\n\nSCALAR_FUN_ATTR uint64_t fptoui_f64_i64(double x) {\n  if (futrts_isnan64(x) || futrts_isinf64(x)) {\n    return 0;\n  } else {\n    return (uint64_t) (int64_t) x;\n  }\n}\n\nSCALAR_FUN_ATTR bool ftob_f64_bool(double x) {\n  return x != 0.0;\n}\n\nSCALAR_FUN_ATTR double btof_bool_f64(bool x) {\n  return x ? 1.0 : 0.0;\n}\n\nSCALAR_FUN_ATTR int64_t futrts_to_bits64(double x) {\n  int64_t res;\n  foreach_active (i) {\n    uniform double tmp = extract(x, i);\n    uniform int64_t r = *((uniform int64_t* uniform)&tmp);\n    res = insert(res, i, r);\n  }\n  return res;\n}\n\nSCALAR_FUN_ATTR double futrts_from_bits64(int64_t x) {\n  double res;\n  foreach_active (i) {\n    uniform int64_t tmp = extract(x, i);\n    uniform double r = *((uniform double* uniform)&tmp);\n    res = insert(res, i, r);\n  }\n  return res;\n}\n\nSCALAR_FUN_ATTR double fmod64(double x, double y) {\n  return x - y * trunc(x/y);\n}\n\nSCALAR_FUN_ATTR double fsignum64(double x) {\n  return futrts_isnan64(x) ? x : (x > 0 ? 1.0d : 0.0d) - (x < 0 ? 1.0d : 0.0d);\n}\n\nSCALAR_FUN_ATTR double futrts_lerp64(double v0, double v1, double t) {\n  return v0 + (v1 - v0) * t;\n}\n\nSCALAR_FUN_ATTR double futrts_ldexp64(double x, int32_t y) {\n  return x * pow((double)2.0, (double)y);\n}\n\nSCALAR_FUN_ATTR double futrts_copysign64(double x, double y) {\n  int64_t xb = futrts_to_bits64(x);\n  int64_t yb = futrts_to_bits64(y);\n  return futrts_from_bits64((xb & ~(((int64_t)1)<<63)) | (yb & (((int64_t)1)<<63)));\n}\n\nSCALAR_FUN_ATTR double futrts_mad64(double a, double b, double c) {\n  return a * b + c;\n}\n\nSCALAR_FUN_ATTR float fpconv_f32_f32(float x) {\n  return (float) x;\n}\n\nSCALAR_FUN_ATTR double fpconv_f32_f64(float x) {\n  return (double) x;\n}\n\nSCALAR_FUN_ATTR float fpconv_f64_f32(double x) {\n  return (float) x;\n}\n\nSCALAR_FUN_ATTR double fpconv_f64_f64(double x) {\n  return (double) x;\n}\n\n#e",
                                    "lse\n\nSCALAR_FUN_ATTR double fdiv64(double x, double y) {\n  return x / y;\n}\n\nSCALAR_FUN_ATTR double fadd64(double x, double y) {\n  return x + y;\n}\n\nSCALAR_FUN_ATTR double fsub64(double x, double y) {\n  return x - y;\n}\n\nSCALAR_FUN_ATTR double fmul64(double x, double y) {\n  return x * y;\n}\n\nSCALAR_FUN_ATTR bool cmplt64(double x, double y) {\n  return x < y;\n}\n\nSCALAR_FUN_ATTR bool cmple64(double x, double y) {\n  return x <= y;\n}\n\nSCALAR_FUN_ATTR double sitofp_i8_f64(int8_t x) {\n  return (double) x;\n}\n\nSCALAR_FUN_ATTR double sitofp_i16_f64(int16_t x) {\n  return (double) x;\n}\n\nSCALAR_FUN_ATTR double sitofp_i32_f64(int32_t x) {\n  return (double) x;\n}\n\nSCALAR_FUN_ATTR double sitofp_i64_f64(int64_t x) {\n  return (double) x;\n}\n\nSCALAR_FUN_ATTR double uitofp_i8_f64(uint8_t x) {\n  return (double) x;\n}\n\nSCALAR_FUN_ATTR double uitofp_i16_f64(uint16_t x) {\n  return (double) x;\n}\n\nSCALAR_FUN_ATTR double uitofp_i32_f64(uint32_t x) {\n  return (double) x;\n}\n\nSCALAR_FUN_ATTR double uitofp_i64_f64(uint64_t x) {\n  return (double) x;\n}\n\nSCALAR_FUN_ATTR double fabs64(double x) {\n  return fabs(x);\n}\n\nSCALAR_FUN_ATTR double fmax64(double x, double y) {\n  return fmax(x, y);\n}\n\nSCALAR_FUN_ATTR double fmin64(double x, double y) {\n  return fmin(x, y);\n}\n\nSCALAR_FUN_ATTR double fpow64(double x, double y) {\n  return pow(x, y);\n}\n\nSCALAR_FUN_ATTR double futrts_log64(double x) {\n  return log(x);\n}\n\nSCALAR_FUN_ATTR double futrts_log2_64(double x) {\n  return log2(x);\n}\n\nSCALAR_FUN_ATTR double futrts_log10_64(double x) {\n  return log10(x);\n}\n\nSCALAR_FUN_ATTR double futrts_log1p_64(double x) {\n  return log1p(x);\n}\n\nSCALAR_FUN_ATTR double futrts_sqrt64(double x) {\n  return sqrt(x);\n}\n\nSCALAR_FUN_ATTR double futrts_cbrt64(double x) {\n  return cbrt(x);\n}\n\nSCALAR_FUN_ATTR double futrts_exp64(double x) {\n  return exp(x);\n}\n\nSCALAR_FUN_ATTR double futrts_cos64(double x) {\n  return cos(x);\n}\n\nSCALAR_FUN_ATTR double futrts_sin64(double x) {\n  return sin(x);\n}\n\nSCALAR_FUN_ATTR double futrts_tan64(double x) {\n  r", "eturn tan(x);\n}\n\nSCALAR_FUN_ATTR double futrts_acos64(double x) {\n  return acos(x);\n}\n\nSCALAR_FUN_ATTR double futrts_asin64(double x) {\n  return asin(x);\n}\n\nSCALAR_FUN_ATTR double futrts_atan64(double x) {\n  return atan(x);\n}\n\nSCALAR_FUN_ATTR double futrts_cosh64(double x) {\n  return cosh(x);\n}\n\nSCALAR_FUN_ATTR double futrts_sinh64(double x) {\n  return sinh(x);\n}\n\nSCALAR_FUN_ATTR double futrts_tanh64(double x) {\n  return tanh(x);\n}\n\nSCALAR_FUN_ATTR double futrts_acosh64(double x) {\n  return acosh(x);\n}\n\nSCALAR_FUN_ATTR double futrts_asinh64(double x) {\n  return asinh(x);\n}\n\nSCALAR_FUN_ATTR double futrts_atanh64(double x) {\n  return atanh(x);\n}\n\nSCALAR_FUN_ATTR double futrts_atan2_64(double x, double y) {\n  return atan2(x, y);\n}\n\nSCALAR_FUN_ATTR double futrts_hypot64(double x, double y) {\n  return hypot(x, y);\n}\n\nSCALAR_FUN_ATTR double futrts_gamma64(double x) {\n  return tgamma(x);\n}\n\nSCALAR_FUN_ATTR double futrts_lgamma64(double x) {\n  return lgamma(x);\n}\n\nSCALAR_FUN_ATTR double futrts_erf64(double x) {\n  return erf(x);\n}\n\nSCALAR_FUN_ATTR double futrts_erfc64(double x) {\n  return erfc(x);\n}\n\nSCALAR_FUN_ATTR double futrts_fma64(double a, double b, double c) {\n  return fma(a, b, c);\n}\n\nSCALAR_FUN_ATTR double futrts_round64(double x) {\n  return rint(x);\n}\n\nSCALAR_FUN_ATTR double futrts_ceil64(double x) {\n  return ceil(x);\n}\n\nSCALAR_FUN_ATTR float futrts_nextafter64(float x, float y) {\n  return nextafter(x, y);\n}\n\nSCALAR_FUN_ATTR double futrts_floor64(double x) {\n  return floor(x);\n}\n\nSCALAR_FUN_ATTR bool futrts_isnan64(double x) {\n  return isnan(x);\n}\n\nSCALAR_FUN_ATTR bool futrts_isinf64(double x) {\n  return isinf(x);\n}\n\nSCALAR_FUN_ATTR int8_t fptosi_f64_i8(double x) {\n  if (futrts_isnan64(x) || futrts_isinf64(x)) {\n    return 0;\n  } else {\n    return (int8_t) x;\n  }\n}\n\nSCALAR_FUN_ATTR int16_t fptosi_f64_i16(double x) {\n  if (futrts_isnan64(x) || futrts_isinf64(x)) {\n    return 0;\n  } else {\n    return (int16_t) x;\n  }\n}\n\nSCALAR_FUN_ATTR int32_t fptosi_f64_i32(double x", ") {\n  if (futrts_isnan64(x) || futrts_isinf64(x)) {\n    return 0;\n  } else {\n    return (int32_t) x;\n  }\n}\n\nSCALAR_FUN_ATTR int64_t fptosi_f64_i64(double x) {\n  if (futrts_isnan64(x) || futrts_isinf64(x)) {\n    return 0;\n  } else {\n    return (int64_t) x;\n  }\n}\n\nSCALAR_FUN_ATTR uint8_t fptoui_f64_i8(double x) {\n  if (futrts_isnan64(x) || futrts_isinf64(x)) {\n    return 0;\n  } else {\n    return (uint8_t) (int8_t) x;\n  }\n}\n\nSCALAR_FUN_ATTR uint16_t fptoui_f64_i16(double x) {\n  if (futrts_isnan64(x) || futrts_isinf64(x)) {\n    return 0;\n  } else {\n    return (uint16_t) (int16_t) x;\n  }\n}\n\nSCALAR_FUN_ATTR uint32_t fptoui_f64_i32(double x) {\n  if (futrts_isnan64(x) || futrts_isinf64(x)) {\n    return 0;\n  } else {\n    return (uint32_t) (int32_t) x;\n  }\n}\n\nSCALAR_FUN_ATTR uint64_t fptoui_f64_i64(double x) {\n  if (futrts_isnan64(x) || futrts_isinf64(x)) {\n    return 0;\n  } else {\n    return (uint64_t) (int64_t) x;\n  }\n}\n\nSCALAR_FUN_ATTR bool ftob_f64_bool(double x) {\n  return x != 0;\n}\n\nSCALAR_FUN_ATTR double btof_bool_f64(bool x) {\n  return x ? 1 : 0;\n}\n\nSCALAR_FUN_ATTR int64_t futrts_to_bits64(double x) {\n  union {\n    double f;\n    int64_t t;\n  } p;\n\n  p.f = x;\n  return p.t;\n}\n\nSCALAR_FUN_ATTR double futrts_from_bits64(int64_t x) {\n  union {\n    int64_t f;\n    double t;\n  } p;\n\n  p.f = x;\n  return p.t;\n}\n\nSCALAR_FUN_ATTR double fmod64(double x, double y) {\n  return fmod(x, y);\n}\n\nSCALAR_FUN_ATTR double fsignum64(double x) {\n  return futrts_isnan64(x) ? x : (x > 0) - (x < 0);\n}\n\nSCALAR_FUN_ATTR double futrts_lerp64(double v0, double v1, double t) {\n#ifdef __OPENCL_VERSION__\n  return mix(v0, v1, t);\n#else\n  return v0 + (v1 - v0) * t;\n#endif\n}\n\nSCALAR_FUN_ATTR double futrts_ldexp64(double x, int32_t y) {\n  return ldexp(x, y);\n}\n\nSCALAR_FUN_ATTR float futrts_copysign64(double x, double y) {\n  return copysign(x, y);\n}\n\nSCALAR_FUN_ATTR double futrts_mad64(double a, double b, double c) {\n#ifdef __OPENCL_VERSION__\n  return mad(a, b, c);\n#else\n  return a * b + c;\n#endif\n}\n\nSCALAR",
                                    "_FUN_ATTR float fpconv_f32_f32(float x) {\n  return (float) x;\n}\n\nSCALAR_FUN_ATTR double fpconv_f32_f64(float x) {\n  return (double) x;\n}\n\nSCALAR_FUN_ATTR float fpconv_f64_f32(double x) {\n  return (float) x;\n}\n\nSCALAR_FUN_ATTR double fpconv_f64_f64(double x) {\n  return (double) x;\n}\n\n#endif\n\n#endif\n\n// End of scalar.h.\n// Start of scalar_f16.h.\n\n// Half-precision is emulated if needed (e.g. in straight C) with the\n// native type used if possible.  The emulation works by typedef'ing\n// 'float' to 'f16', and then implementing all operations on single\n// precision.  To cut down on duplication, we use the same code for\n// those Futhark functions that require just operators or casts.  The\n// in-memory representation for arrays will still be 16 bits even\n// under emulation, so the compiler will have to be careful when\n// generating reads or writes.\n\n#if !defined(cl_khr_fp16) && !(defined(__CUDA_ARCH__) && __CUDA_ARCH__ >= 600) && !(defined(ISPC))\n#define EMULATE_F16\n#endif\n\n#if !defined(EMULATE_F16) && defined(__OPENCL_VERSION__)\n#pragma OPENCL EXTENSION cl_khr_fp16 : enable\n#endif\n\n#ifdef EMULATE_F16\n\n// Note that the half-precision storage format is still 16 bits - the\n// compiler will have to be real careful!\ntypedef float f16;\n\n#elif ISPC\ntypedef float16 f16;\n\n#else\n\n#ifdef __CUDA_ARCH__\n#include <cuda_fp16.h>\n#endif\n\ntypedef half f16;\n\n#endif\n\n// Some of these functions convert to single precision because half\n// precision versions are not available.\n\nSCALAR_FUN_ATTR f16 fadd16(f16 x, f16 y) {\n  return x + y;\n}\n\nSCALAR_FUN_ATTR f16 fsub16(f16 x, f16 y) {\n  return x - y;\n}\n\nSCALAR_FUN_ATTR f16 fmul16(f16 x, f16 y) {\n  return x * y;\n}\n\nSCALAR_FUN_ATTR bool cmplt16(f16 x, f16 y) {\n  return x < y;\n}\n\nSCALAR_FUN_ATTR bool cmple16(f16 x, f16 y) {\n  return x <= y;\n}\n\nSCALAR_FUN_ATTR f16 sitofp_i8_f16(int8_t x) {\n  return (f16) x;\n}\n\nSCALAR_FUN_ATTR f16 sitofp_i16_f16(int16_t x) {\n  return (f16) x;\n}\n\nSCALAR_FUN_ATTR f16 sitofp_i32_f16(int32_t x) {\n  return (f16) x;\n}\n\nSCALAR", "_FUN_ATTR f16 sitofp_i64_f16(int64_t x) {\n  return (f16) x;\n}\n\nSCALAR_FUN_ATTR f16 uitofp_i8_f16(uint8_t x) {\n  return (f16) x;\n}\n\nSCALAR_FUN_ATTR f16 uitofp_i16_f16(uint16_t x) {\n  return (f16) x;\n}\n\nSCALAR_FUN_ATTR f16 uitofp_i32_f16(uint32_t x) {\n  return (f16) x;\n}\n\nSCALAR_FUN_ATTR f16 uitofp_i64_f16(uint64_t x) {\n  return (f16) x;\n}\n\nSCALAR_FUN_ATTR int8_t fptosi_f16_i8(f16 x) {\n  return (int8_t) (float) x;\n}\n\nSCALAR_FUN_ATTR int16_t fptosi_f16_i16(f16 x) {\n  return (int16_t) x;\n}\n\nSCALAR_FUN_ATTR int32_t fptosi_f16_i32(f16 x) {\n  return (int32_t) x;\n}\n\nSCALAR_FUN_ATTR int64_t fptosi_f16_i64(f16 x) {\n  return (int64_t) x;\n}\n\nSCALAR_FUN_ATTR uint8_t fptoui_f16_i8(f16 x) {\n  return (uint8_t) (float) x;\n}\n\nSCALAR_FUN_ATTR uint16_t fptoui_f16_i16(f16 x) {\n  return (uint16_t) x;\n}\n\nSCALAR_FUN_ATTR uint32_t fptoui_f16_i32(f16 x) {\n  return (uint32_t) x;\n}\n\nSCALAR_FUN_ATTR uint64_t fptoui_f16_i64(f16 x) {\n  return (uint64_t) x;\n}\n\nSCALAR_FUN_ATTR bool ftob_f16_bool(f16 x) {\n  return x != (f16)0;\n}\n\nSCALAR_FUN_ATTR f16 btof_bool_f16(bool x) {\n  return x ? 1 : 0;\n}\n\n#ifndef EMULATE_F16\nSCALAR_FUN_ATTR bool futrts_isnan16(f16 x) {\n  return isnan((float)x);\n}\n\n#ifdef __OPENCL_VERSION__\n\nSCALAR_FUN_ATTR f16 fabs16(f16 x) {\n  return fabs(x);\n}\n\nSCALAR_FUN_ATTR f16 fmax16(f16 x, f16 y) {\n  return fmax(x, y);\n}\n\nSCALAR_FUN_ATTR f16 fmin16(f16 x, f16 y) {\n  return fmin(x, y);\n}\n\nSCALAR_FUN_ATTR f16 fpow16(f16 x, f16 y) {\n  return pow(x, y);\n}\n\n#elif ISPC\nSCALAR_FUN_ATTR f16 fabs16(f16 x) {\n  return abs(x);\n}\n\nSCALAR_FUN_ATTR f16 fmax16(f16 x, f16 y) {\n  return futrts_isnan16(x) ? y : futrts_isnan16(y) ? x : max(x, y);\n}\n\nSCALAR_FUN_ATTR f16 fmin16(f16 x, f16 y) {\n  return futrts_isnan16(x) ? y : futrts_isnan16(y) ? x : min(x, y);\n}\n\nSCALAR_FUN_ATTR f16 fpow16(f16 x, f16 y) {\n  return pow(x, y);\n}\n\n#else // Assuming CUDA.\n\nSCALAR_FUN_ATTR f16 fabs16(f16 x) {\n  return fabsf(x);\n}\n\nSCALAR_FUN_ATTR f16 fmax16(f16 x, f16 y) {\n  return fmaxf(x, y);\n}\n\nSCALAR_FUN_ATTR f16 fmin16(f16 ", "x, f16 y) {\n  return fminf(x, y);\n}\n\nSCALAR_FUN_ATTR f16 fpow16(f16 x, f16 y) {\n  return powf(x, y);\n}\n#endif\n\n#if ISPC\nSCALAR_FUN_ATTR bool futrts_isinf16(float x) {\n  return !futrts_isnan16(x) && futrts_isnan16(x - x);\n}\nSCALAR_FUN_ATTR bool futrts_isfinite16(float x) {\n  return !futrts_isnan16(x) && !futrts_isinf16(x);\n}\n\n#else\n\nSCALAR_FUN_ATTR bool futrts_isinf16(f16 x) {\n  return isinf((float)x);\n}\n#endif\n\n#ifdef __OPENCL_VERSION__\nSCALAR_FUN_ATTR f16 futrts_log16(f16 x) {\n  return log(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_log2_16(f16 x) {\n  return log2(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_log10_16(f16 x) {\n  return log10(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_log1p_16(f16 x) {\n  return log1p(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_sqrt16(f16 x) {\n  return sqrt(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_cbrt16(f16 x) {\n  return cbrt(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_exp16(f16 x) {\n  return exp(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_cos16(f16 x) {\n  return cos(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_sin16(f16 x) {\n  return sin(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_tan16(f16 x) {\n  return tan(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_acos16(f16 x) {\n  return acos(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_asin16(f16 x) {\n  return asin(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_atan16(f16 x) {\n  return atan(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_cosh16(f16 x) {\n  return cosh(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_sinh16(f16 x) {\n  return sinh(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_tanh16(f16 x) {\n  return tanh(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_acosh16(f16 x) {\n  return acosh(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_asinh16(f16 x) {\n  return asinh(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_atanh16(f16 x) {\n  return atanh(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_atan2_16(f16 x, f16 y) {\n  return atan2(x, y);\n}\n\nSCALAR_FUN_ATTR f16 futrts_hypot16(f16 x, f16 y) {\n  return hypot(x, y);\n}\n\nSCALAR_FUN_ATTR f16 futrts_gamma16(f16 x) {\n  return tgamma(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_lgamma16(f16 x) {\n  return lgamma(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_erf16(f16 x) {\n  return e",
                                    "rf(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_erfc16(f16 x) {\n  return erfc(x);\n}\n\nSCALAR_FUN_ATTR f16 fmod16(f16 x, f16 y) {\n  return fmod(x, y);\n}\n\nSCALAR_FUN_ATTR f16 futrts_round16(f16 x) {\n  return rint(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_floor16(f16 x) {\n  return floor(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_ceil16(f16 x) {\n  return ceil(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_nextafter16(f16 x, f16 y) {\n  return nextafter(x, y);\n}\n\nSCALAR_FUN_ATTR f16 futrts_lerp16(f16 v0, f16 v1, f16 t) {\n  return mix(v0, v1, t);\n}\n\nSCALAR_FUN_ATTR f16 futrts_ldexp16(f16 x, int32_t y) {\n  return ldexp(x, y);\n}\n\nSCALAR_FUN_ATTR f16 futrts_copysign16(f16 x, f16 y) {\n  return copysign(x, y);\n}\n\nSCALAR_FUN_ATTR f16 futrts_mad16(f16 a, f16 b, f16 c) {\n  return mad(a, b, c);\n}\n\nSCALAR_FUN_ATTR f16 futrts_fma16(f16 a, f16 b, f16 c) {\n  return fma(a, b, c);\n}\n#elif ISPC\n\nSCALAR_FUN_ATTR f16 futrts_log16(f16 x) {\n  return futrts_isfinite16(x) || (futrts_isinf16(x) && x < 0) ? log(x) : x;\n}\n\nSCALAR_FUN_ATTR f16 futrts_log2_16(f16 x) {\n  return futrts_log16(x) / log(2.0f16);\n}\n\nSCALAR_FUN_ATTR f16 futrts_log10_16(f16 x) {\n  return futrts_log16(x) / log(10.0f16);\n}\n\nSCALAR_FUN_ATTR f16 futrts_log1p_16(f16 x) {\n  if(x == -1.0f16 || (futrts_isinf16(x) && x > 0.0f16)) return x / 0.0f16;\n  f16 y = 1.0f16 + x;\n  f16 z = y - 1.0f16;\n  return log(y) - (z-x)/y;\n}\n\nSCALAR_FUN_ATTR f16 futrts_sqrt16(f16 x) {\n  return (float16)sqrt((float)x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_exp16(f16 x) {\n  return exp(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_cos16(f16 x) {\n  return (float16)cos((float)x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_sin16(f16 x) {\n  return (float16)sin((float)x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_tan16(f16 x) {\n  return (float16)tan((float)x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_acos16(f16 x) {\n  return (float16)acos((float)x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_asin16(f16 x) {\n  return (float16)asin((float)x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_atan16(f16 x) {\n  return (float16)atan((float)x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_cosh16(f16 x) {\n  retu", "rn (exp(x)+exp(-x)) / 2.0f16;\n}\n\nSCALAR_FUN_ATTR f16 futrts_sinh16(f16 x) {\n  return (exp(x)-exp(-x)) / 2.0f16;\n}\n\nSCALAR_FUN_ATTR f16 futrts_tanh16(f16 x) {\n  return futrts_sinh16(x)/futrts_cosh16(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_acosh16(f16 x) {\n  float16 f = x+(float16)sqrt((float)(x*x-1));\n  if(futrts_isfinite16(f)) return log(f);\n  return f;\n}\n\nSCALAR_FUN_ATTR f16 futrts_asinh16(f16 x) {\n  float16 f = x+(float16)sqrt((float)(x*x+1));\n  if(futrts_isfinite16(f)) return log(f);\n  return f;\n}\n\nSCALAR_FUN_ATTR f16 futrts_atanh16(f16 x) {\n  float16 f = (1+x)/(1-x);\n  if(futrts_isfinite16(f)) return log(f)/2.0f16;\n  return f;\n}\n\nSCALAR_FUN_ATTR f16 futrts_atan2_16(f16 x, f16 y) {\n  return (float16)atan2((float)x, (float)y);\n}\n\nSCALAR_FUN_ATTR f16 futrts_hypot16(f16 x, f16 y) {\n  return (float16)futrts_hypot32((float)x, (float)y);\n}\n\nextern \"C\" unmasked uniform float tgammaf(uniform float x);\nSCALAR_FUN_ATTR f16 futrts_gamma16(f16 x) {\n  f16 res;\n  foreach_active (i) {\n    uniform f16 r = (f16)tgammaf(extract((float)x, i));\n    res = insert(res, i, r);\n  }\n  return res;\n}\n\nextern \"C\" unmasked uniform float lgammaf(uniform float x);\nSCALAR_FUN_ATTR f16 futrts_lgamma16(f16 x) {\n  f16 res;\n  foreach_active (i) {\n    uniform f16 r = (f16)lgammaf(extract((float)x, i));\n    res = insert(res, i, r);\n  }\n  return res;\n}\n\nSCALAR_FUN_ATTR f16 futrts_cbrt16(f16 x) {\n  f16 res = (f16)futrts_cbrt32((float)x);\n  return res;\n}\n\nSCALAR_FUN_ATTR f16 futrts_erf16(f16 x) {\n  f16 res = (f16)futrts_erf32((float)x);\n  return res;\n}\n\nSCALAR_FUN_ATTR f16 futrts_erfc16(f16 x) {\n  f16 res = (f16)futrts_erfc32((float)x);\n  return res;\n}\n\nSCALAR_FUN_ATTR f16 fmod16(f16 x, f16 y) {\n  return x - y * (float16)trunc((float) (x/y));\n}\n\nSCALAR_FUN_ATTR f16 futrts_round16(f16 x) {\n  return (float16)round((float)x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_floor16(f16 x) {\n  return (float16)floor((float)x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_ceil16(f16 x) {\n  return (float16)ceil((float)x);\n}\n\nSCALAR_FUN_ATTR f16 futrt", "s_nextafter16(f16 x, f16 y) {\n  return (float16)futrts_nextafter32((float)x, (float) y);\n}\n\nSCALAR_FUN_ATTR f16 futrts_lerp16(f16 v0, f16 v1, f16 t) {\n  return v0 + (v1 - v0) * t;\n}\n\nSCALAR_FUN_ATTR f16 futrts_ldexp16(f16 x, int32_t y) {\n  return futrts_ldexp32((float)x, y);\n}\n\nSCALAR_FUN_ATTR f16 futrts_copysign16(f16 x, f16 y) {\n  return futrts_copysign32((float)x, y);\n}\n\nSCALAR_FUN_ATTR f16 futrts_mad16(f16 a, f16 b, f16 c) {\n  return a * b + c;\n}\n\nSCALAR_FUN_ATTR f16 futrts_fma16(f16 a, f16 b, f16 c) {\n  return a * b + c;\n}\n\n#else // Assume CUDA.\n\nSCALAR_FUN_ATTR f16 futrts_log16(f16 x) {\n  return hlog(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_log2_16(f16 x) {\n  return hlog2(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_log10_16(f16 x) {\n  return hlog10(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_log1p_16(f16 x) {\n  return (f16)log1pf((float)x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_sqrt16(f16 x) {\n  return hsqrt(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_cbrt16(f16 x) {\n  return cbrtf(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_exp16(f16 x) {\n  return hexp(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_cos16(f16 x) {\n  return hcos(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_sin16(f16 x) {\n  return hsin(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_tan16(f16 x) {\n  return tanf(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_acos16(f16 x) {\n  return acosf(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_asin16(f16 x) {\n  return asinf(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_atan16(f16 x) {\n  return atanf(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_cosh16(f16 x) {\n  return coshf(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_sinh16(f16 x) {\n  return sinhf(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_tanh16(f16 x) {\n  return tanhf(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_acosh16(f16 x) {\n  return acoshf(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_asinh16(f16 x) {\n  return asinhf(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_atanh16(f16 x) {\n  return atanhf(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_atan2_16(f16 x, f16 y) {\n  return atan2f(x, y);\n}\n\nSCALAR_FUN_ATTR f16 futrts_hypot16(f16 x, f16 y) {\n  return hypotf(x, y);\n}\n\nSCALAR_FUN_ATTR f16 futrts_gamma16(f1",
                                    "6 x) {\n  return tgammaf(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_lgamma16(f16 x) {\n  return lgammaf(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_erf16(f16 x) {\n  return erff(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_erfc16(f16 x) {\n  return erfcf(x);\n}\n\nSCALAR_FUN_ATTR f16 fmod16(f16 x, f16 y) {\n  return fmodf(x, y);\n}\n\nSCALAR_FUN_ATTR f16 futrts_round16(f16 x) {\n  return rintf(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_floor16(f16 x) {\n  return hfloor(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_ceil16(f16 x) {\n  return hceil(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_nextafter16(f16 x, f16 y) {\n  return __ushort_as_half(halfbitsnextafter(__half_as_ushort(x), __half_as_ushort(y)));\n}\n\nSCALAR_FUN_ATTR f16 futrts_lerp16(f16 v0, f16 v1, f16 t) {\n  return v0 + (v1 - v0) * t;\n}\n\nSCALAR_FUN_ATTR f16 futrts_ldexp16(f16 x, int32_t y) {\n  return futrts_ldexp32((float)x, y);\n}\n\nSCALAR_FUN_ATTR f16 futrts_copysign16(f16 x, f16 y) {\n  return futrts_copysign32((float)x, y);\n}\n\nSCALAR_FUN_ATTR f16 futrts_mad16(f16 a, f16 b, f16 c) {\n  return a * b + c;\n}\n\nSCALAR_FUN_ATTR f16 futrts_fma16(f16 a, f16 b, f16 c) {\n  return fmaf(a, b, c);\n}\n\n#endif\n\n// The CUDA __half type cannot be put in unions for some reason, so we\n// use bespoke conversion functions instead.\n#ifdef __CUDA_ARCH__\nSCALAR_FUN_ATTR int16_t futrts_to_bits16(f16 x) {\n  return __half_as_ushort(x);\n}\nSCALAR_FUN_ATTR f16 futrts_from_bits16(int16_t x) {\n  return __ushort_as_half(x);\n}\n#elif ISPC\n\nSCALAR_FUN_ATTR int16_t futrts_to_bits16(f16 x) {\n  varying int16_t y = *((varying int16_t * uniform)&x);\n  return y;\n}\n\nSCALAR_FUN_ATTR f16 futrts_from_bits16(int16_t x) {\n  varying f16 y = *((varying f16 * uniform)&x);\n  return y;\n}\n#else\nSCALAR_FUN_ATTR int16_t futrts_to_bits16(f16 x) {\n  union {\n    f16 f;\n    int16_t t;\n  } p;\n\n  p.f = x;\n  return p.t;\n}\n\nSCALAR_FUN_ATTR f16 futrts_from_bits16(int16_t x) {\n  union {\n    int16_t f;\n    f16 t;\n  } p;\n\n  p.f = x;\n  return p.t;\n}\n#endif\n\n#else // No native f16 - emulate.\n\nSCALAR_FUN_ATTR f16 fabs16(f16 x) {\n  return fabs32(x);\n}\n\nSC", "ALAR_FUN_ATTR f16 fmax16(f16 x, f16 y) {\n  return fmax32(x, y);\n}\n\nSCALAR_FUN_ATTR f16 fmin16(f16 x, f16 y) {\n  return fmin32(x, y);\n}\n\nSCALAR_FUN_ATTR f16 fpow16(f16 x, f16 y) {\n  return fpow32(x, y);\n}\n\nSCALAR_FUN_ATTR bool futrts_isnan16(f16 x) {\n  return futrts_isnan32(x);\n}\n\nSCALAR_FUN_ATTR bool futrts_isinf16(f16 x) {\n  return futrts_isinf32(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_log16(f16 x) {\n  return futrts_log32(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_log2_16(f16 x) {\n  return futrts_log2_32(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_log10_16(f16 x) {\n  return futrts_log10_32(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_log1p_16(f16 x) {\n  return futrts_log1p_32(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_sqrt16(f16 x) {\n  return futrts_sqrt32(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_cbrt16(f16 x) {\n  return futrts_cbrt32(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_exp16(f16 x) {\n  return futrts_exp32(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_cos16(f16 x) {\n  return futrts_cos32(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_sin16(f16 x) {\n  return futrts_sin32(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_tan16(f16 x) {\n  return futrts_tan32(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_acos16(f16 x) {\n  return futrts_acos32(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_asin16(f16 x) {\n  return futrts_asin32(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_atan16(f16 x) {\n  return futrts_atan32(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_cosh16(f16 x) {\n  return futrts_cosh32(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_sinh16(f16 x) {\n  return futrts_sinh32(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_tanh16(f16 x) {\n  return futrts_tanh32(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_acosh16(f16 x) {\n  return futrts_acosh32(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_asinh16(f16 x) {\n  return futrts_asinh32(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_atanh16(f16 x) {\n  return futrts_atanh32(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_atan2_16(f16 x, f16 y) {\n  return futrts_atan2_32(x, y);\n}\n\nSCALAR_FUN_ATTR f16 futrts_hypot16(f16 x, f16 y) {\n  return futrts_hypot32(x, y);\n}\n\nSCALAR_FUN_ATTR f16 futrts_gamma16(f16 x) {\n  return futrts_gamma32(x);\n}\n\nSCA", "LAR_FUN_ATTR f16 futrts_lgamma16(f16 x) {\n  return futrts_lgamma32(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_erf16(f16 x) {\n  return futrts_erf32(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_erfc16(f16 x) {\n  return futrts_erfc32(x);\n}\n\nSCALAR_FUN_ATTR f16 fmod16(f16 x, f16 y) {\n  return fmod32(x, y);\n}\n\nSCALAR_FUN_ATTR f16 futrts_round16(f16 x) {\n  return futrts_round32(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_floor16(f16 x) {\n  return futrts_floor32(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_ceil16(f16 x) {\n  return futrts_ceil32(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_nextafter16(f16 x, f16 y) {\n  return halfbits2float(halfbitsnextafter(float2halfbits(x), float2halfbits(y)));\n}\n\nSCALAR_FUN_ATTR f16 futrts_lerp16(f16 v0, f16 v1, f16 t) {\n  return futrts_lerp32(v0, v1, t);\n}\n\nSCALAR_FUN_ATTR f16 futrts_ldexp16(f16 x, int32_t y) {\n  return futrts_ldexp32(x, y);\n}\n\nSCALAR_FUN_ATTR f16 futrts_copysign16(f16 x, f16 y) {\n  return futrts_copysign32((float)x, y);\n}\n\nSCALAR_FUN_ATTR f16 futrts_mad16(f16 a, f16 b, f16 c) {\n  return futrts_mad32(a, b, c);\n}\n\nSCALAR_FUN_ATTR f16 futrts_fma16(f16 a, f16 b, f16 c) {\n  return futrts_fma32(a, b, c);\n}\n\n// Even when we are using an OpenCL that does not support cl_khr_fp16,\n// it must still support vload_half for actually creating a\n// half-precision number, which can then be efficiently converted to a\n// float.  Similarly for vstore_half.\n#ifdef __OPENCL_VERSION__\n\nSCALAR_FUN_ATTR int16_t futrts_to_bits16(f16 x) {\n  int16_t y;\n  // Violating strict aliasing here.\n  vstore_half((float)x, 0, (half*)&y);\n  return y;\n}\n\nSCALAR_FUN_ATTR f16 futrts_from_bits16(int16_t x) {\n  return (f16)vload_half(0, (half*)&x);\n}\n\n#else\n\nSCALAR_FUN_ATTR int16_t futrts_to_bits16(f16 x) {\n  return (int16_t)float2halfbits(x);\n}\n\nSCALAR_FUN_ATTR f16 futrts_from_bits16(int16_t x) {\n  return halfbits2float((uint16_t)x);\n}\n\nSCALAR_FUN_ATTR f16 fsignum16(f16 x) {\n  return futrts_isnan16(x) ? x : (x > 0 ? 1 : 0) - (x < 0 ? 1 : 0);\n}\n\n#endif\n\n#endif\n\nSCALAR_FUN_ATTR float fpconv_f16_f16(f16 x) {\n  retu",
                                    "rn x;\n}\n\nSCALAR_FUN_ATTR float fpconv_f16_f32(f16 x) {\n  return x;\n}\n\nSCALAR_FUN_ATTR f16 fpconv_f32_f16(float x) {\n  return (f16) x;\n}\n\n#ifdef FUTHARK_F64_ENABLED\n\nSCALAR_FUN_ATTR double fpconv_f16_f64(f16 x) {\n  return (double) x;\n}\n\n#if ISPC\nSCALAR_FUN_ATTR f16 fpconv_f64_f16(double x) {\n  return (f16) ((float)x);\n}\n#else\nSCALAR_FUN_ATTR f16 fpconv_f64_f16(double x) {\n  return (f16) x;\n}\n#endif\n#endif\n\n\n// End of scalar_f16.h.\n// Start of atomics.h\n\nSCALAR_FUN_ATTR int32_t atomic_xchg_i32_global(volatile __global int32_t *p, int32_t x);\nSCALAR_FUN_ATTR int32_t atomic_xchg_i32_shared(volatile __local int32_t *p, int32_t x);\nSCALAR_FUN_ATTR int32_t atomic_cmpxchg_i32_global(volatile __global int32_t *p,\n                                                         int32_t cmp, int32_t val);\nSCALAR_FUN_ATTR int32_t atomic_cmpxchg_i32_shared(volatile __local int32_t *p,\n                                                        int32_t cmp, int32_t val);\nSCALAR_FUN_ATTR int32_t atomic_add_i32_global(volatile __global int32_t *p, int32_t x);\nSCALAR_FUN_ATTR int32_t atomic_add_i32_shared(volatile __local int32_t *p, int32_t x);\nSCALAR_FUN_ATTR float atomic_fadd_f32_global(volatile __global float *p, float x);\nSCALAR_FUN_ATTR float atomic_fadd_f32_shared(volatile __local float *p, float x);\nSCALAR_FUN_ATTR int32_t atomic_smax_i32_global(volatile __global int32_t *p, int32_t x);\nSCALAR_FUN_ATTR int32_t atomic_smax_i32_shared(volatile __local int32_t *p, int32_t x);\nSCALAR_FUN_ATTR int32_t atomic_smin_i32_global(volatile __global int32_t *p, int32_t x);\nSCALAR_FUN_ATTR int32_t atomic_smin_i32_shared(volatile __local int32_t *p, int32_t x);\nSCALAR_FUN_ATTR uint32_t atomic_umax_i32_global(volatile __global uint32_t *p, uint32_t x);\nSCALAR_FUN_ATTR uint32_t atomic_umax_i32_shared(volatile __local uint32_t *p, uint32_t x);\nSCALAR_FUN_ATTR uint32_t atomic_umin_i32_global(volatile __global uint32_t *p, uint32_t x);\nSCALAR_FUN_ATTR uint32_t atomic_umin_i32_shared(volatile __local uint32", "_t *p, uint32_t x);\nSCALAR_FUN_ATTR int32_t atomic_and_i32_global(volatile __global int32_t *p, int32_t x);\nSCALAR_FUN_ATTR int32_t atomic_and_i32_shared(volatile __local int32_t *p, int32_t x);\nSCALAR_FUN_ATTR int32_t atomic_or_i32_global(volatile __global int32_t *p, int32_t x);\nSCALAR_FUN_ATTR int32_t atomic_or_i32_shared(volatile __local int32_t *p, int32_t x);\nSCALAR_FUN_ATTR int32_t atomic_xor_i32_global(volatile __global int32_t *p, int32_t x);\nSCALAR_FUN_ATTR int32_t atomic_xor_i32_shared(volatile __local int32_t *p, int32_t x);\n\nSCALAR_FUN_ATTR int32_t atomic_xchg_i32_global(volatile __global int32_t *p, int32_t x) {\n#if defined(FUTHARK_CUDA) || defined(FUTHARK_HIP)\n  return atomicExch((int32_t*)p, x);\n#else\n  return atomic_xor(p, x);\n#endif\n}\n\nSCALAR_FUN_ATTR int32_t atomic_xchg_i32_shared(volatile __local int32_t *p, int32_t x) {\n#if defined(FUTHARK_CUDA) || defined(FUTHARK_HIP)\n  return atomicExch((int32_t*)p, x);\n#else\n  return atomic_xor(p, x);\n#endif\n}\n\nSCALAR_FUN_ATTR int32_t atomic_cmpxchg_i32_global(volatile __global int32_t *p,\n                                                         int32_t cmp, int32_t val) {\n#if defined(FUTHARK_CUDA) || defined(FUTHARK_HIP)\n  return atomicCAS((int32_t*)p, cmp, val);\n#else\n  return atomic_cmpxchg(p, cmp, val);\n#endif\n}\n\nSCALAR_FUN_ATTR int32_t atomic_cmpxchg_i32_shared(volatile __local int32_t *p,\n                                                        int32_t cmp, int32_t val) {\n#if defined(FUTHARK_CUDA) || defined(FUTHARK_HIP)\n  return atomicCAS((int32_t*)p, cmp, val);\n#else\n  return atomic_cmpxchg(p, cmp, val);\n#endif\n}\n\nSCALAR_FUN_ATTR int32_t atomic_add_i32_global(volatile __global int32_t *p, int32_t x) {\n#if defined(FUTHARK_CUDA) || defined(FUTHARK_HIP)\n  return atomicAdd((int32_t*)p, x);\n#else\n  return atomic_add(p, x);\n#endif\n}\n\nSCALAR_FUN_ATTR int32_t atomic_add_i32_shared(volatile __local int32_t *p, int32_t x) {\n#if defined(FUTHARK_CUDA) || defined(FUTHARK_HIP)\n  return atomicAdd((int32_t*)p, x);\n#el", "se\n  return atomic_add(p, x);\n#endif\n}\n\nSCALAR_FUN_ATTR float atomic_fadd_f32_global(volatile __global float *p, float x) {\n#if defined(FUTHARK_CUDA) || defined(FUTHARK_HIP)\n  return atomicAdd((float*)p, x);\n  // On OpenCL, use technique from\n  // https://pipinspace.github.io/blog/atomic-float-addition-in-opencl.html\n#elif defined(cl_nv_pragma_unroll)\n  // use hardware-supported atomic addition on Nvidia GPUs with inline\n  // PTX assembly\n  float ret;\n  asm volatile(\"atom.global.add.f32 %0,[%1],%2;\":\"=f\"(ret):\"l\"(p),\"f\"(x):\"memory\");\n  return ret;\n#elif defined(__opencl_c_ext_fp32_global_atomic_add)\n  // use hardware-supported atomic addition on some Intel GPUs\n  return atomic_fetch_add_explicit((volatile __global atomic_float*)p,\n                                   x,\n                                   memory_order_relaxed);\n#elif __has_builtin(__builtin_amdgcn_global_atomic_fadd_f32)\n  // use hardware-supported atomic addition on some AMD GPUs\n  return __builtin_amdgcn_global_atomic_fadd_f32(p, x);\n#else\n  // fallback emulation:\n  // https://forums.developer.nvidia.com/t/atomicadd-float-float-atomicmul-float-float/14639/5\n  float old = x;\n  float ret;\n  while ((old=atomic_xchg(p, ret=atomic_xchg(p, 0.0f)+old))!=0.0f);\n  return ret;\n#endif\n}\n\nSCALAR_FUN_ATTR float atomic_fadd_f32_shared(volatile __local float *p, float x) {\n#if defined(FUTHARK_CUDA) || defined(FUTHARK_HIP)\n  return atomicAdd((float*)p, x);\n#else\n  union { int32_t i; float f; } old;\n  union { int32_t i; float f; } assumed;\n  old.f = *p;\n  do {\n    assumed.f = old.f;\n    old.f = old.f + x;\n    old.i = atomic_cmpxchg_i32_shared((volatile __local int32_t*)p, assumed.i, old.i);\n  } while (assumed.i != old.i);\n  return old.f;\n#endif\n}\n\nSCALAR_FUN_ATTR int32_t atomic_smax_i32_global(volatile __global int32_t *p, int32_t x) {\n#if defined(FUTHARK_CUDA) || defined(FUTHARK_HIP)\n  return atomicMax((int32_t*)p, x);\n#else\n  return atomic_max(p, x);\n#endif\n}\n\nSCALAR_FUN_ATTR int32_t atomic_smax_i32_shared(volatile",
                                    " __local int32_t *p, int32_t x) {\n#if defined(FUTHARK_CUDA) || defined(FUTHARK_HIP)\n  return atomicMax((int32_t*)p, x);\n#else\n  return atomic_max(p, x);\n#endif\n}\n\nSCALAR_FUN_ATTR int32_t atomic_smin_i32_global(volatile __global int32_t *p, int32_t x) {\n#if defined(FUTHARK_CUDA) || defined(FUTHARK_HIP)\n  return atomicMin((int32_t*)p, x);\n#else\n  return atomic_min(p, x);\n#endif\n}\n\nSCALAR_FUN_ATTR int32_t atomic_smin_i32_shared(volatile __local int32_t *p, int32_t x) {\n#if defined(FUTHARK_CUDA) || defined(FUTHARK_HIP)\n  return atomicMin((int32_t*)p, x);\n#else\n  return atomic_min(p, x);\n#endif\n}\n\nSCALAR_FUN_ATTR uint32_t atomic_umax_i32_global(volatile __global uint32_t *p, uint32_t x) {\n#if defined(FUTHARK_CUDA) || defined(FUTHARK_HIP)\n  return atomicMax((uint32_t*)p, x);\n#else\n  return atomic_max(p, x);\n#endif\n}\n\nSCALAR_FUN_ATTR uint32_t atomic_umax_i32_shared(volatile __local uint32_t *p, uint32_t x) {\n#if defined(FUTHARK_CUDA) || defined(FUTHARK_HIP)\n  return atomicMax((uint32_t*)p, x);\n#else\n  return atomic_max(p, x);\n#endif\n}\n\nSCALAR_FUN_ATTR uint32_t atomic_umin_i32_global(volatile __global uint32_t *p, uint32_t x) {\n#if defined(FUTHARK_CUDA) || defined(FUTHARK_HIP)\n  return atomicMin((uint32_t*)p, x);\n#else\n  return atomic_min(p, x);\n#endif\n}\n\nSCALAR_FUN_ATTR uint32_t atomic_umin_i32_shared(volatile __local uint32_t *p, uint32_t x) {\n#if defined(FUTHARK_CUDA) || defined(FUTHARK_HIP)\n  return atomicMin((uint32_t*)p, x);\n#else\n  return atomic_min(p, x);\n#endif\n}\n\nSCALAR_FUN_ATTR int32_t atomic_and_i32_global(volatile __global int32_t *p, int32_t x) {\n#if defined(FUTHARK_CUDA) || defined(FUTHARK_HIP)\n  return atomicAnd((int32_t*)p, x);\n#else\n  return atomic_and(p, x);\n#endif\n}\n\nSCALAR_FUN_ATTR int32_t atomic_and_i32_shared(volatile __local int32_t *p, int32_t x) {\n#if defined(FUTHARK_CUDA) || defined(FUTHARK_HIP)\n  return atomicAnd((int32_t*)p, x);\n#else\n  return atomic_and(p, x);\n#endif\n}\n\nSCALAR_FUN_ATTR int32_t atomic_or_i32_global(volatile __global int32_t *p, ", "int32_t x) {\n#if defined(FUTHARK_CUDA) || defined(FUTHARK_HIP)\n  return atomicOr((int32_t*)p, x);\n#else\n  return atomic_or(p, x);\n#endif\n}\n\nSCALAR_FUN_ATTR int32_t atomic_or_i32_shared(volatile __local int32_t *p, int32_t x) {\n#if defined(FUTHARK_CUDA) || defined(FUTHARK_HIP)\n  return atomicOr((int32_t*)p, x);\n#else\n  return atomic_or(p, x);\n#endif\n}\n\nSCALAR_FUN_ATTR int32_t atomic_xor_i32_global(volatile __global int32_t *p, int32_t x) {\n#if defined(FUTHARK_CUDA) || defined(FUTHARK_HIP)\n  return atomicXor((int32_t*)p, x);\n#else\n  return atomic_xor(p, x);\n#endif\n}\n\nSCALAR_FUN_ATTR int32_t atomic_xor_i32_shared(volatile __local int32_t *p, int32_t x) {\n#if defined(FUTHARK_CUDA) || defined(FUTHARK_HIP)\n  return atomicXor((int32_t*)p, x);\n#else\n  return atomic_xor(p, x);\n#endif\n}\n\n// Start of 64 bit atomics\n\n#if defined(FUTHARK_CUDA) || defined(FUTHARK_HIP) || defined(cl_khr_int64_base_atomics) && defined(cl_khr_int64_extended_atomics)\n\nSCALAR_FUN_ATTR int64_t atomic_xchg_i64_global(volatile __global int64_t *p, int64_t x);\nSCALAR_FUN_ATTR int64_t atomic_xchg_i64_shared(volatile __local int64_t *p, int64_t x);\nSCALAR_FUN_ATTR int64_t atomic_cmpxchg_i64_global(volatile __global int64_t *p,\n                                                         int64_t cmp, int64_t val);\nSCALAR_FUN_ATTR int64_t atomic_cmpxchg_i64_shared(volatile __local int64_t *p,\n                                                        int64_t cmp, int64_t val);\nSCALAR_FUN_ATTR int64_t atomic_add_i64_global(volatile __global int64_t *p, int64_t x);\nSCALAR_FUN_ATTR int64_t atomic_add_i64_shared(volatile __local int64_t *p, int64_t x);\nSCALAR_FUN_ATTR int64_t atomic_smax_i64_global(volatile __global int64_t *p, int64_t x);\nSCALAR_FUN_ATTR int64_t atomic_smax_i64_shared(volatile __local int64_t *p, int64_t x);\nSCALAR_FUN_ATTR int64_t atomic_smin_i64_global(volatile __global int64_t *p, int64_t x);\nSCALAR_FUN_ATTR int64_t atomic_smin_i64_shared(volatile __local int64_t *p, int64_t x);\nSCALAR_FUN_ATTR uint", "64_t atomic_umax_i64_global(volatile __global uint64_t *p, uint64_t x);\nSCALAR_FUN_ATTR uint64_t atomic_umax_i64_shared(volatile __local uint64_t *p, uint64_t x);\nSCALAR_FUN_ATTR uint64_t atomic_umin_i64_global(volatile __global uint64_t *p, uint64_t x);\nSCALAR_FUN_ATTR uint64_t atomic_umin_i64_shared(volatile __local uint64_t *p, uint64_t x);\nSCALAR_FUN_ATTR int64_t atomic_and_i64_global(volatile __global int64_t *p, int64_t x);\nSCALAR_FUN_ATTR int64_t atomic_and_i64_shared(volatile __local int64_t *p, int64_t x);\nSCALAR_FUN_ATTR int64_t atomic_or_i64_global(volatile __global int64_t *p, int64_t x);\nSCALAR_FUN_ATTR int64_t atomic_or_i64_shared(volatile __local int64_t *p, int64_t x);\nSCALAR_FUN_ATTR int64_t atomic_xor_i64_global(volatile __global int64_t *p, int64_t x);\nSCALAR_FUN_ATTR int64_t atomic_xor_i64_shared(volatile __local int64_t *p, int64_t x);\n\n#ifdef FUTHARK_F64_ENABLED\nSCALAR_FUN_ATTR double atomic_fadd_f64_global(volatile __global double *p, double x);\nSCALAR_FUN_ATTR double atomic_fadd_f64_shared(volatile __local double *p, double x);\n#endif\n\nSCALAR_FUN_ATTR int64_t atomic_xchg_i64_global(volatile __global int64_t *p, int64_t x) {\n#if defined(FUTHARK_CUDA) || defined(FUTHARK_HIP)\n  return atomicExch((uint64_t*)p, x);\n#else\n  return atom_xor(p, x);\n#endif\n}\n\nSCALAR_FUN_ATTR int64_t atomic_xchg_i64_shared(volatile __local int64_t *p, int64_t x) {\n#if defined(FUTHARK_CUDA) || defined(FUTHARK_HIP)\n  return atomicExch((uint64_t*)p, x);\n#else\n  return atom_xor(p, x);\n#endif\n}\n\nSCALAR_FUN_ATTR int64_t atomic_cmpxchg_i64_global(volatile __global int64_t *p,\n                                                         int64_t cmp, int64_t val) {\n#if defined(FUTHARK_CUDA) || defined(FUTHARK_HIP)\n  return atomicCAS((uint64_t*)p, cmp, val);\n#else\n  return atom_cmpxchg(p, cmp, val);\n#endif\n}\n\nSCALAR_FUN_ATTR int64_t atomic_cmpxchg_i64_shared(volatile __local int64_t *p,\n                                                        int64_t cmp, int64_t val) {\n#if defined(F",
                                    "UTHARK_CUDA) || defined(FUTHARK_HIP)\n  return atomicCAS((uint64_t*)p, cmp, val);\n#else\n  return atom_cmpxchg(p, cmp, val);\n#endif\n}\n\nSCALAR_FUN_ATTR int64_t atomic_add_i64_global(volatile __global int64_t *p, int64_t x) {\n#if defined(FUTHARK_CUDA) || defined(FUTHARK_HIP)\n  return atomicAdd((uint64_t*)p, x);\n#else\n  return atom_add(p, x);\n#endif\n}\n\nSCALAR_FUN_ATTR int64_t atomic_add_i64_shared(volatile __local int64_t *p, int64_t x) {\n#if defined(FUTHARK_CUDA) || defined(FUTHARK_HIP)\n  return atomicAdd((uint64_t*)p, x);\n#else\n  return atom_add(p, x);\n#endif\n}\n\n#ifdef FUTHARK_F64_ENABLED\n\nSCALAR_FUN_ATTR double atomic_fadd_f64_global(volatile __global double *p, double x) {\n#if defined(FUTHARK_CUDA) && __CUDA_ARCH__ >= 600 || defined(FUTHARK_HIP)\n  return atomicAdd((double*)p, x);\n  // On OpenCL, use technique from\n  // https://pipinspace.github.io/blog/atomic-float-addition-in-opencl.html\n#elif defined(cl_nv_pragma_unroll)\n  // use hardware-supported atomic addition on Nvidia GPUs with inline\n  // PTX assembly\n  double ret;\n  asm volatile(\"atom.global.add.f64 %0,[%1],%2;\":\"=d\"(ret):\"l\"(p),\"d\"(x):\"memory\");\n  return ret;\n#elif __has_builtin(__builtin_amdgcn_global_atomic_fadd_f64)\n  // use hardware-supported atomic addition on some AMD GPUs\n  return __builtin_amdgcn_global_atomic_fadd_f64(p, x);\n#else\n  // fallback emulation:\n  // https://forums.developer.nvidia.com/t/atomicadd-float-float-atomicmul-float-float/14639/5\n  union {int64_t i; double f;} old;\n  union {int64_t i; double f;} ret;\n  old.f = x;\n  while (1) {\n    ret.i = atom_xchg((volatile __global int64_t*)p, (int64_t)0);\n    ret.f += old.f;\n    old.i = atom_xchg((volatile __global int64_t*)p, ret.i);\n    if (old.i == 0) {\n      break;\n    }\n  }\n  return ret.f;\n#endif\n}\n\nSCALAR_FUN_ATTR double atomic_fadd_f64_shared(volatile __local double *p, double x) {\n#if defined(FUTHARK_CUDA) && __CUDA_ARCH__ >= 600 || defined(FUTHARK_HIP)\n  return atomicAdd((double*)p, x);\n#else\n  union { int64_t i; double f; } old;\n  u", "nion { int64_t i; double f; } assumed;\n  old.f = *p;\n  do {\n    assumed.f = old.f;\n    old.f = old.f + x;\n    old.i = atomic_cmpxchg_i64_shared((volatile __local int64_t*)p, assumed.i, old.i);\n  } while (assumed.i != old.i);\n  return old.f;\n#endif\n}\n\n#endif\n\nSCALAR_FUN_ATTR int64_t atomic_smax_i64_global(volatile __global int64_t *p, int64_t x) {\n#if defined(FUTHARK_CUDA)\n  return atomicMax((int64_t*)p, x);\n#elif defined(FUTHARK_HIP)\n  // Currentely missing in HIP; probably a temporary oversight.\n  int64_t old = *p, assumed;\n  do {\n    assumed = old;\n    old = smax64(old, x);\n    old = atomic_cmpxchg_i64_global((volatile __global int64_t*)p, assumed, old);\n  } while (assumed != old);\n  return old;\n#else\n  return atom_max(p, x);\n#endif\n}\n\nSCALAR_FUN_ATTR int64_t atomic_smax_i64_shared(volatile __local int64_t *p, int64_t x) {\n#if defined(FUTHARK_CUDA)\n  return atomicMax((int64_t*)p, x);\n#elif defined(FUTHARK_HIP)\n  // Currentely missing in HIP; probably a temporary oversight.\n  int64_t old = *p, assumed;\n  do {\n    assumed = old;\n    old = smax64(old, x);\n    old = atomic_cmpxchg_i64_shared((volatile __local int64_t*)p, assumed, old);\n  } while (assumed != old);\n  return old;\n#else\n  return atom_max(p, x);\n#endif\n}\n\nSCALAR_FUN_ATTR int64_t atomic_smin_i64_global(volatile __global int64_t *p, int64_t x) {\n#if defined(FUTHARK_CUDA)\n  return atomicMin((int64_t*)p, x);\n#elif defined(FUTHARK_HIP)\n  // Currentely missing in HIP; probably a temporary oversight.\n  int64_t old = *p, assumed;\n  do {\n    assumed = old;\n    old = smin64(old, x);\n    old = atomic_cmpxchg_i64_global((volatile __global int64_t*)p, assumed, old);\n  } while (assumed != old);\n  return old;\n#else\n  return atom_min(p, x);\n#endif\n}\n\nSCALAR_FUN_ATTR int64_t atomic_smin_i64_shared(volatile __local int64_t *p, int64_t x) {\n#if defined(FUTHARK_CUDA)\n  return atomicMin((int64_t*)p, x);\n#elif defined(FUTHARK_HIP)\n  // Currentely missing in HIP; probably a temporary oversight.\n  int64_t old = *p, assumed;\n  do ", "{\n    assumed = old;\n    old = smin64(old, x);\n    old = atomic_cmpxchg_i64_shared((volatile __local int64_t*)p, assumed, old);\n  } while (assumed != old);\n  return old;\n#else\n  return atom_min(p, x);\n#endif\n}\n\nSCALAR_FUN_ATTR uint64_t atomic_umax_i64_global(volatile __global uint64_t *p, uint64_t x) {\n#if defined(FUTHARK_CUDA) || defined(FUTHARK_HIP)\n  return atomicMax((uint64_t*)p, x);\n#else\n  return atom_max(p, x);\n#endif\n}\n\nSCALAR_FUN_ATTR uint64_t atomic_umax_i64_shared(volatile __local uint64_t *p, uint64_t x) {\n#if defined(FUTHARK_CUDA) || defined(FUTHARK_HIP)\n  return atomicMax((uint64_t*)p, x);\n#else\n  return atom_max(p, x);\n#endif\n}\n\nSCALAR_FUN_ATTR uint64_t atomic_umin_i64_global(volatile __global uint64_t *p, uint64_t x) {\n#if defined(FUTHARK_CUDA) || defined(FUTHARK_HIP)\n  return atomicMin((uint64_t*)p, x);\n#else\n  return atom_min(p, x);\n#endif\n}\n\nSCALAR_FUN_ATTR uint64_t atomic_umin_i64_shared(volatile __local uint64_t *p, uint64_t x) {\n#if defined(FUTHARK_CUDA) || defined(FUTHARK_HIP)\n  return atomicMin((uint64_t*)p, x);\n#else\n  return atom_min(p, x);\n#endif\n}\n\nSCALAR_FUN_ATTR int64_t atomic_and_i64_global(volatile __global int64_t *p, int64_t x) {\n#if defined(FUTHARK_CUDA) || defined(FUTHARK_HIP)\n  return atomicAnd((uint64_t*)p, x);\n#else\n  return atom_and(p, x);\n#endif\n}\n\nSCALAR_FUN_ATTR int64_t atomic_and_i64_shared(volatile __local int64_t *p, int64_t x) {\n#if defined(FUTHARK_CUDA) || defined(FUTHARK_HIP)\n  return atomicAnd((uint64_t*)p, x);\n#else\n  return atom_and(p, x);\n#endif\n}\n\nSCALAR_FUN_ATTR int64_t atomic_or_i64_global(volatile __global int64_t *p, int64_t x) {\n#if defined(FUTHARK_CUDA) || defined(FUTHARK_HIP)\n  return atomicOr((uint64_t*)p, x);\n#else\n  return atom_or(p, x);\n#endif\n}\n\nSCALAR_FUN_ATTR int64_t atomic_or_i64_shared(volatile __local int64_t *p, int64_t x) {\n#if defined(FUTHARK_CUDA) || defined(FUTHARK_HIP)\n  return atomicOr((uint64_t*)p, x);\n#else\n  return atom_or(p, x);\n#endif\n}\n\nSCALAR_FUN_ATTR int64_t atomic_xor_i64_global(v",
                                    "olatile __global int64_t *p, int64_t x) {\n#if defined(FUTHARK_CUDA) || defined(FUTHARK_HIP)\n  return atomicXor((uint64_t*)p, x);\n#else\n  return atom_xor(p, x);\n#endif\n}\n\nSCALAR_FUN_ATTR int64_t atomic_xor_i64_shared(volatile __local int64_t *p, int64_t x) {\n#if defined(FUTHARK_CUDA) || defined(FUTHARK_HIP)\n  return atomicXor((uint64_t*)p, x);\n#else\n  return atom_xor(p, x);\n#endif\n}\n\n#endif // defined(FUTHARK_CUDA) || defined(FUTHARK_HIP) || defined(cl_khr_int64_base_atomics) && defined(cl_khr_int64_extended_atomics)\n\n// End of atomics.h\n// Start of transpose.cl\n\n#define GEN_TRANSPOSE_KERNELS(NAME, ELEM_TYPE)                          \\\nFUTHARK_KERNEL_SIZED(TR_BLOCK_DIM*2, TR_TILE_DIM/TR_ELEMS_PER_THREAD, 1)\\\nvoid map_transpose_##NAME(SHARED_MEM_PARAM                              \\\n                          __global ELEM_TYPE *dst_mem,                  \\\n                          int64_t dst_offset,                           \\\n                          __global ELEM_TYPE *src_mem,                  \\\n                          int64_t src_offset,                           \\\n                          int32_t num_arrays,                           \\\n                          int32_t x_elems,                              \\\n                          int32_t y_elems,                              \\\n                          int32_t mulx,                                 \\\n                          int32_t muly,                                 \\\n                          int32_t repeat_1,                             \\\n                          int32_t repeat_2) {                           \\\n  (void)mulx; (void)muly;                                               \\\n  __local ELEM_TYPE* block = (__local ELEM_TYPE*)shared_mem;            \\\n  int tblock_id_0 = get_tblock_id(0);                                   \\\n  int global_id_0 = get_global_id(0);                                   \\\n  int tblock_id_1 = get_tblock_id(1);                                   \\\n  int global_id_1 = get_g", "lobal_id(1);                                   \\\n  for (int i1 = 0; i1 <= repeat_1; i1++) {                              \\\n    int tblock_id_2 = get_tblock_id(2);                                 \\\n    int global_id_2 = get_global_id(2);                                 \\\n    for (int i2 = 0; i2 <= repeat_2; i2++) {                            \\\n      int32_t our_array_offset = tblock_id_2 * x_elems * y_elems;       \\\n      int32_t odata_offset = dst_offset + our_array_offset;             \\\n      int32_t idata_offset = src_offset + our_array_offset;             \\\n      int32_t x_index = global_id_0;                                    \\\n      int32_t y_index = tblock_id_1 * TR_TILE_DIM + get_local_id(1);    \\\n      if (x_index < x_elems) {                                          \\\n        for (int32_t j = 0; j < TR_ELEMS_PER_THREAD; j++) {             \\\n          int32_t index_i = (y_index + j * (TR_TILE_DIM/TR_ELEMS_PER_THREAD)) * x_elems + x_index; \\\n          if (y_index + j * (TR_TILE_DIM/TR_ELEMS_PER_THREAD) < y_elems) { \\\n            block[(get_local_id(1) + j * (TR_TILE_DIM/TR_ELEMS_PER_THREAD)) * (TR_TILE_DIM+1) + \\\n                  get_local_id(0)] =                                    \\\n              src_mem[idata_offset + index_i];                          \\\n          }                                                             \\\n        }                                                               \\\n      }                                                                 \\\n      barrier_local();                                                  \\\n      x_index = tblock_id_1 * TR_TILE_DIM + get_local_id(0);            \\\n      y_index = tblock_id_0 * TR_TILE_DIM + get_local_id(1);            \\\n      if (x_index < y_elems) {                                          \\\n        for (int32_t j = 0; j < TR_ELEMS_PER_THREAD; j++) {             \\\n          int32_t index_out = (y_index + j * (TR_TILE_DIM/TR_ELEMS_PER_THREAD)) * y_elems + x_index; \\\n          if (y_in", "dex + j * (TR_TILE_DIM/TR_ELEMS_PER_THREAD) < x_elems) { \\\n            dst_mem[(odata_offset + index_out)] =                       \\\n              block[get_local_id(0) * (TR_TILE_DIM+1) +                 \\\n                    get_local_id(1) + j * (TR_TILE_DIM/TR_ELEMS_PER_THREAD)]; \\\n          }                                                             \\\n        }                                                               \\\n      }                                                                 \\\n      tblock_id_2 += get_num_tblocks(2);                                \\\n      global_id_2 += get_global_size(2);                                \\\n    }                                                                   \\\n    tblock_id_1 += get_num_tblocks(1);                                  \\\n    global_id_1 += get_global_size(1);                                  \\\n  }                                                                     \\\n}                                                                       \\\n                                                                        \\\nFUTHARK_KERNEL_SIZED(TR_BLOCK_DIM, TR_BLOCK_DIM, 1)                     \\\nvoid map_transpose_##NAME##_low_height(SHARED_MEM_PARAM                 \\\n                                                __global ELEM_TYPE *dst_mem, \\\n                                                int64_t dst_offset,     \\\n                                                __global ELEM_TYPE *src_mem, \\\n                                                int64_t src_offset,     \\\n                                                int32_t num_arrays,     \\\n                                                int32_t x_elems,        \\\n                                                int32_t y_elems,        \\\n                                                int32_t mulx,           \\\n                                                int32_t muly,           \\\n                                                int32_t repeat_1,       \\\n ",
                                    "                                               int32_t repeat_2) {     \\\n  __local ELEM_TYPE* block = (__local ELEM_TYPE*)shared_mem;            \\\n  int tblock_id_0 = get_tblock_id(0);                                   \\\n  int global_id_0 = get_global_id(0);                                   \\\n  int tblock_id_1 = get_tblock_id(1);                                   \\\n  int global_id_1 = get_global_id(1);                                   \\\n  for (int i1 = 0; i1 <= repeat_1; i1++) {                              \\\n    int tblock_id_2 = get_tblock_id(2);                                 \\\n    int global_id_2 = get_global_id(2);                                 \\\n    for (int i2 = 0; i2 <= repeat_2; i2++) {                            \\\n      int32_t our_array_offset = tblock_id_2 * x_elems * y_elems;       \\\n      int32_t odata_offset = dst_offset + our_array_offset;             \\\n      int32_t idata_offset = src_offset + our_array_offset;             \\\n      int32_t x_index =                                                 \\\n        tblock_id_0 * TR_BLOCK_DIM * mulx +                             \\\n        get_local_id(0) +                                               \\\n        get_local_id(1)%mulx * TR_BLOCK_DIM;                            \\\n      int32_t y_index = tblock_id_1 * TR_BLOCK_DIM + get_local_id(1)/mulx; \\\n      int32_t index_in = y_index * x_elems + x_index;                   \\\n      if (x_index < x_elems && y_index < y_elems) {                     \\\n        block[get_local_id(1) * (TR_BLOCK_DIM+1) + get_local_id(0)] =   \\\n          src_mem[idata_offset + index_in];                             \\\n      }                                                                 \\\n      barrier_local();                                                  \\\n      x_index = tblock_id_1 * TR_BLOCK_DIM + get_local_id(0)/mulx;      \\\n      y_index =                                                         \\\n        tblock_id_0 * TR_BLOCK_DIM * mulx +                             \\\n", "        get_local_id(1) +                                               \\\n        (get_local_id(0)%mulx) * TR_BLOCK_DIM;                          \\\n      int32_t index_out = y_index * y_elems + x_index;                  \\\n      if (x_index < y_elems && y_index < x_elems) {                     \\\n        dst_mem[odata_offset + index_out] =                             \\\n          block[get_local_id(0) * (TR_BLOCK_DIM+1) + get_local_id(1)];  \\\n      }                                                                 \\\n      tblock_id_2 += get_num_tblocks(2);                                \\\n      global_id_2 += get_global_size(2);                                \\\n    }                                                                   \\\n    tblock_id_1 += get_num_tblocks(1);                                  \\\n    global_id_1 += get_global_size(1);                                  \\\n  }                                                                     \\\n}                                                                       \\\n                                                                        \\\nFUTHARK_KERNEL_SIZED(TR_BLOCK_DIM, TR_BLOCK_DIM, 1)                     \\\nvoid map_transpose_##NAME##_low_width(SHARED_MEM_PARAM                  \\\n                                      __global ELEM_TYPE *dst_mem,      \\\n                                      int64_t dst_offset,               \\\n                                      __global ELEM_TYPE *src_mem,      \\\n                                      int64_t src_offset,               \\\n                                      int32_t num_arrays,               \\\n                                      int32_t x_elems,                  \\\n                                      int32_t y_elems,                  \\\n                                      int32_t mulx,                     \\\n                                      int32_t muly,                     \\\n                                      int32_t repeat_1,                 \\\n  ", "                                    int32_t repeat_2) {               \\\n  __local ELEM_TYPE* block = (__local ELEM_TYPE*)shared_mem;            \\\n  int tblock_id_0 = get_tblock_id(0);                                   \\\n  int global_id_0 = get_global_id(0);                                   \\\n  int tblock_id_1 = get_tblock_id(1);                                   \\\n  int global_id_1 = get_global_id(1);                                   \\\n  for (int i1 = 0; i1 <= repeat_1; i1++) {                              \\\n    int tblock_id_2 = get_tblock_id(2);                                 \\\n    int global_id_2 = get_global_id(2);                                 \\\n    for (int i2 = 0; i2 <= repeat_2; i2++) {                            \\\n      int32_t our_array_offset = tblock_id_2 * x_elems * y_elems;       \\\n      int32_t odata_offset = dst_offset + our_array_offset;             \\\n      int32_t idata_offset = src_offset + our_array_offset;             \\\n      int32_t x_index = tblock_id_0 * TR_BLOCK_DIM + get_local_id(0)/muly; \\\n      int32_t y_index =                                                 \\\n        tblock_id_1 * TR_BLOCK_DIM * muly +                             \\\n        get_local_id(1) + (get_local_id(0)%muly) * TR_BLOCK_DIM;        \\\n      int32_t index_in = y_index * x_elems + x_index;                   \\\n      if (x_index < x_elems && y_index < y_elems) {                     \\\n        block[get_local_id(1) * (TR_BLOCK_DIM+1) + get_local_id(0)] =   \\\n          src_mem[idata_offset + index_in];                             \\\n      }                                                                 \\\n      barrier_local();                                                  \\\n      x_index = tblock_id_1 * TR_BLOCK_DIM * muly +                     \\\n        get_local_id(0) + (get_local_id(1)%muly) * TR_BLOCK_DIM;        \\\n      y_index = tblock_id_0 * TR_BLOCK_DIM + get_local_id(1)/muly;      \\\n      int32_t index_out = y_index * y_elems + x_index;                  \\\n ",
                                    "     if (x_index < y_elems && y_index < x_elems) {                     \\\n        dst_mem[odata_offset + index_out] =                             \\\n          block[get_local_id(0) * (TR_BLOCK_DIM+1) + get_local_id(1)];  \\\n      }                                                                 \\\n      tblock_id_2 += get_num_tblocks(2);                                \\\n      global_id_2 += get_num_tblocks(2) * get_local_size(2);            \\\n    }                                                                   \\\n    tblock_id_1 += get_num_tblocks(1);                                  \\\n    global_id_1 += get_num_tblocks(1) * get_local_size(1);              \\\n  }                                                                     \\\n}                                                                       \\\n                                                                        \\\nFUTHARK_KERNEL_SIZED(TR_BLOCK_DIM*TR_BLOCK_DIM, 1, 1)                   \\\nvoid map_transpose_##NAME##_small(SHARED_MEM_PARAM                       \\\n                                  __global ELEM_TYPE *dst_mem,          \\\n                                  int64_t dst_offset,                   \\\n                                  __global ELEM_TYPE *src_mem,          \\\n                                  int64_t src_offset,                   \\\n                                  int32_t num_arrays,                   \\\n                                  int32_t x_elems,                      \\\n                                  int32_t y_elems,                      \\\n                                  int32_t mulx,                         \\\n                                  int32_t muly,                         \\\n                                  int32_t repeat_1,                     \\\n                                  int32_t repeat_2) {                   \\\n  (void)mulx; (void)muly;                                               \\\n  __local ELEM_TYPE* block = (__local ELEM_TYPE*)shared_mem;            \\\n  ", "int tblock_id_0 = get_tblock_id(0);                                   \\\n  int global_id_0 = get_global_id(0);                                   \\\n  int tblock_id_1 = get_tblock_id(1);                                   \\\n  int global_id_1 = get_global_id(1);                                   \\\n  for (int i1 = 0; i1 <= repeat_1; i1++) {                              \\\n    int tblock_id_2 = get_tblock_id(2);                                 \\\n    int global_id_2 = get_global_id(2);                                 \\\n    for (int i2 = 0; i2 <= repeat_2; i2++) {                            \\\n      int32_t our_array_offset = global_id_0/(y_elems * x_elems) * y_elems * x_elems; \\\n      int32_t x_index = (global_id_0 % (y_elems * x_elems))/y_elems;    \\\n      int32_t y_index = global_id_0%y_elems;                            \\\n      int32_t odata_offset = dst_offset + our_array_offset;             \\\n      int32_t idata_offset = src_offset + our_array_offset;             \\\n      int32_t index_in = y_index * x_elems + x_index;                   \\\n      int32_t index_out = x_index * y_elems + y_index;                  \\\n      if (global_id_0 < x_elems * y_elems * num_arrays) {               \\\n        dst_mem[odata_offset + index_out] = src_mem[idata_offset + index_in]; \\\n      }                                                                 \\\n      tblock_id_2 += get_num_tblocks(2);                                \\\n      global_id_2 += get_global_size(2);                                \\\n    }                                                                   \\\n    tblock_id_1 += get_num_tblocks(1);                                  \\\n    global_id_1 += get_global_size(1);                                  \\\n  }                                                                     \\\n}                                                                       \\\n                                                                        \\\nFUTHARK_KERNEL_SIZED(TR_BLOCK_DIM*2, TR_TILE_DIM/TR_ELEMS_", "PER_THREAD, 1)\\\nvoid map_transpose_##NAME##_large(SHARED_MEM_PARAM                      \\\n                                  __global ELEM_TYPE *dst_mem,          \\\n                                  int64_t dst_offset,                   \\\n                                  __global ELEM_TYPE *src_mem,          \\\n                                  int64_t src_offset,                   \\\n                                  int64_t num_arrays,                   \\\n                                  int64_t x_elems,                      \\\n                                  int64_t y_elems,                      \\\n                                  int64_t mulx,                         \\\n                                  int64_t muly,                         \\\n                                  int32_t repeat_1,                     \\\n                                  int32_t repeat_2) {                   \\\n  (void)mulx; (void)muly;                                               \\\n  __local ELEM_TYPE* block = (__local ELEM_TYPE*)shared_mem;             \\\n  int tblock_id_0 = get_tblock_id(0);                                   \\\n  int global_id_0 = get_global_id(0);                                   \\\n  int tblock_id_1 = get_tblock_id(1);                                   \\\n  int global_id_1 = get_global_id(1);                                   \\\n  for (int i1 = 0; i1 <= repeat_1; i1++) {                              \\\n    int tblock_id_2 = get_tblock_id(2);                                 \\\n    int global_id_2 = get_global_id(2);                                 \\\n    for (int i2 = 0; i2 <= repeat_2; i2++) {                            \\\n      int64_t our_array_offset = tblock_id_2 * x_elems * y_elems;       \\\n      int64_t odata_offset = dst_offset + our_array_offset;             \\\n      int64_t idata_offset = src_offset + our_array_offset;             \\\n      int64_t x_index = global_id_0;                                    \\\n      int64_t y_index = tblock_id_1 * TR_TILE_DIM + get_loc",
                                    "al_id(1);    \\\n      if (x_index < x_elems) {                                          \\\n        for (int64_t j = 0; j < TR_ELEMS_PER_THREAD; j++) {             \\\n          int64_t index_i = (y_index + j * (TR_TILE_DIM/TR_ELEMS_PER_THREAD)) * x_elems + x_index; \\\n          if (y_index + j * (TR_TILE_DIM/TR_ELEMS_PER_THREAD) < y_elems) { \\\n            block[(get_local_id(1) + j * (TR_TILE_DIM/TR_ELEMS_PER_THREAD)) * (TR_TILE_DIM+1) + \\\n                  get_local_id(0)] =                                    \\\n              src_mem[idata_offset + index_i];                          \\\n          }                                                             \\\n        }                                                               \\\n      }                                                                 \\\n      barrier_local();                                                  \\\n      x_index = tblock_id_1 * TR_TILE_DIM + get_local_id(0);            \\\n      y_index = tblock_id_0 * TR_TILE_DIM + get_local_id(1);            \\\n      if (x_index < y_elems) {                                          \\\n        for (int64_t j = 0; j < TR_ELEMS_PER_THREAD; j++) {             \\\n          int64_t index_out = (y_index + j * (TR_TILE_DIM/TR_ELEMS_PER_THREAD)) * y_elems + x_index; \\\n          if (y_index + j * (TR_TILE_DIM/TR_ELEMS_PER_THREAD) < x_elems) { \\\n            dst_mem[(odata_offset + index_out)] =                       \\\n              block[get_local_id(0) * (TR_TILE_DIM+1) +                 \\\n                    get_local_id(1) + j * (TR_TILE_DIM/TR_ELEMS_PER_THREAD)]; \\\n          }                                                             \\\n        }                                                               \\\n      }                                                                 \\\n      tblock_id_2 += get_num_tblocks(2);                                \\\n      global_id_2 += get_global_size(2);                                \\\n    }                                      ", "                             \\\n    tblock_id_1 += get_num_tblocks(1);                                  \\\n    global_id_1 += get_global_size(1);                                  \\\n  }                                                                     \\\n}                                                                       \\\n\nGEN_TRANSPOSE_KERNELS(1b, uint8_t)\nGEN_TRANSPOSE_KERNELS(2b, uint16_t)\nGEN_TRANSPOSE_KERNELS(4b, uint32_t)\nGEN_TRANSPOSE_KERNELS(8b, uint64_t)\n\n// End of transpose.cl\n// Start of copy.cl\n\n#define GEN_COPY_KERNEL(NAME, ELEM_TYPE) \\\nFUTHARK_KERNEL void lmad_copy_##NAME(SHARED_MEM_PARAM                   \\\n                               __global ELEM_TYPE *dst_mem,             \\\n                               int64_t dst_offset,                      \\\n                               __global ELEM_TYPE *src_mem,             \\\n                               int64_t src_offset,                      \\\n                               int64_t n,                               \\\n                               int r,                                   \\\n                               int64_t shape0, int64_t dst_stride0, int64_t src_stride0, \\\n                               int64_t shape1, int64_t dst_stride1, int64_t src_stride1, \\\n                               int64_t shape2, int64_t dst_stride2, int64_t src_stride2, \\\n                               int64_t shape3, int64_t dst_stride3, int64_t src_stride3, \\\n                               int64_t shape4, int64_t dst_stride4, int64_t src_stride4, \\\n                               int64_t shape5, int64_t dst_stride5, int64_t src_stride5, \\\n                               int64_t shape6, int64_t dst_stride6, int64_t src_stride6, \\\n                               int64_t shape7, int64_t dst_stride7, int64_t src_stride7) { \\\n  int64_t gtid = get_global_id(0);                                      \\\n  int64_t remainder = gtid;                                             \\\n                                             ", "                           \\\n  if (gtid >= n) {                                                      \\\n    return;                                                             \\\n  }                                                                     \\\n                                                                        \\\n  if (r > 0) {                                                          \\\n    int64_t i = remainder % shape0;                                     \\\n    dst_offset += i * dst_stride0;                                      \\\n    src_offset += i * src_stride0;                                      \\\n    remainder /= shape0;                                                \\\n  }                                                                     \\\n  if (r > 1) {                                                          \\\n    int64_t i = remainder % shape1;                                     \\\n    dst_offset += i * dst_stride1;                                      \\\n    src_offset += i * src_stride1;                                      \\\n    remainder /= shape1;                                                \\\n  }                                                                     \\\n  if (r > 2) {                                                          \\\n    int64_t i = remainder % shape2;                                     \\\n    dst_offset += i * dst_stride2;                                      \\\n    src_offset += i * src_stride2;                                      \\\n    remainder /= shape2;                                                \\\n  }                                                                     \\\n  if (r > 3) {                                                          \\\n    int64_t i = remainder % shape3;                                     \\\n    dst_offset += i * dst_stride3;                                      \\\n    src_offset += i * src_stride3;                                      \\\n    remainder /= shape3;                       ",
                                    "                         \\\n  }                                                                     \\\n  if (r > 4) {                                                          \\\n    int64_t i = remainder % shape4;                                     \\\n    dst_offset += i * dst_stride4;                                      \\\n    src_offset += i * src_stride4;                                      \\\n    remainder /= shape4;                                                \\\n  }                                                                     \\\n  if (r > 5) {                                                          \\\n    int64_t i = remainder % shape5;                                     \\\n    dst_offset += i * dst_stride5;                                      \\\n    src_offset += i * src_stride5;                                      \\\n    remainder /= shape5;                                                \\\n  }                                                                     \\\n  if (r > 6) {                                                          \\\n    int64_t i = remainder % shape6;                                     \\\n    dst_offset += i * dst_stride6;                                      \\\n    src_offset += i * src_stride6;                                      \\\n    remainder /= shape6;                                                \\\n  }                                                                     \\\n  if (r > 7) {                                                          \\\n    int64_t i = remainder % shape7;                                     \\\n    dst_offset += i * dst_stride7;                                      \\\n    src_offset += i * src_stride7;                                      \\\n    remainder /= shape7;                                                \\\n  }                                                                     \\\n                                                                        \\\n  dst_mem[dst_offset] = src_mem[src_offset];     ", "                       \\\n}\n\nGEN_COPY_KERNEL(1b, uint8_t)\nGEN_COPY_KERNEL(2b, uint16_t)\nGEN_COPY_KERNEL(4b, uint32_t)\nGEN_COPY_KERNEL(8b, uint64_t)\n\n// End of copy.cl\n\n\n\nFUTHARK_KERNEL_SIZED(add_next_partition_doublezigpuseq_50444_dim1, 1, 1)\nvoid add_next_partition_doublezigpuseq_50444(__global int *global_failure, __global unsigned char *clBase_mem_49379, __global unsigned char *mem_49424)\n{\n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_50446;\n    int32_t tblock_sizze_50449;\n    int32_t wave_sizze_50448;\n    int32_t block_id_50447;\n    int32_t global_tid_50445;\n    int64_t tid_50444;\n    double x_49300;\n    \n    local_tid_50446 = get_local_id(0);\n    tblock_sizze_50449 = get_local_size(0);\n    wave_sizze_50448 = LOCKSTEP_WIDTH;\n    block_id_50447 = get_tblock_id(0);\n    global_tid_50445 = block_id_50447 * tblock_sizze_50449 + local_tid_50446;\n    tid_50444 = sext_i32_i64(global_tid_50445);\n    x_49300 = ((__global double *) clBase_mem_49379)[(int64_t) 0];\n    ((__global double *) mem_49424)[(int64_t) 0] = x_49300;\n    \n  error_0:\n    return;\n}\nFUTHARK_KERNEL_SIZED(add_next_partition_doublezigpuseq_50470_dim1, 1, 1)\nvoid add_next_partition_doublezigpuseq_50470(__global int *global_failure, __global unsigned char *clBase_mem_49377, __global unsigned char *mem_49427)\n{\n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_50472;\n    int32_t tblock_sizze_50475;\n    int32_t wave_sizze_50474;\n    int32_t block_id_50473;\n    int32_t global_tid_50471;\n    int64_t tid_50470;\n    double x_49304;\n    \n    local_tid_50472 = get_local_id(0);\n    tblock_sizze_50475 = get_local_size(0);\n    wave_sizze_50474 = LOCKSTEP_WIDTH;\n    block_id_50473 = get_tblock_id(0);\n    global_tid_50471 = block_id_50473 * tblock_sizze_50475 + local_tid_50472;\n    tid_50470 = sext_i32_i64(global_tid_50471);\n    x_49304 = ((__global double *) clBase_mem_49377)[(int64_t) 0];\n    ((__global double *) mem_49427)[(int64_t) 0] = x_49304;\n    \n  error_0:\n    ret", "urn;\n}\nFUTHARK_KERNEL_SIZED(add_next_partition_doublezigpuseq_50476_dim1, 1, 1)\nvoid add_next_partition_doublezigpuseq_50476(__global int *global_failure, __global unsigned char *clBase_mem_49379, __global unsigned char *mem_49430)\n{\n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_50478;\n    int32_t tblock_sizze_50481;\n    int32_t wave_sizze_50480;\n    int32_t block_id_50479;\n    int32_t global_tid_50477;\n    int64_t tid_50476;\n    double x_49308;\n    \n    local_tid_50478 = get_local_id(0);\n    tblock_sizze_50481 = get_local_size(0);\n    wave_sizze_50480 = LOCKSTEP_WIDTH;\n    block_id_50479 = get_tblock_id(0);\n    global_tid_50477 = block_id_50479 * tblock_sizze_50481 + local_tid_50478;\n    tid_50476 = sext_i32_i64(global_tid_50477);\n    x_49308 = ((__global double *) clBase_mem_49379)[(int64_t) 1];\n    ((__global double *) mem_49430)[(int64_t) 0] = x_49308;\n    \n  error_0:\n    return;\n}\nFUTHARK_KERNEL_SIZED(add_next_partition_doublezigpuseq_50482_dim1, 1, 1)\nvoid add_next_partition_doublezigpuseq_50482(__global int *global_failure, __global unsigned char *clBase_mem_49377, __global unsigned char *mem_49433)\n{\n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_50484;\n    int32_t tblock_sizze_50487;\n    int32_t wave_sizze_50486;\n    int32_t block_id_50485;\n    int32_t global_tid_50483;\n    int64_t tid_50482;\n    double x_49312;\n    \n    local_tid_50484 = get_local_id(0);\n    tblock_sizze_50487 = get_local_size(0);\n    wave_sizze_50486 = LOCKSTEP_WIDTH;\n    block_id_50485 = get_tblock_id(0);\n    global_tid_50483 = block_id_50485 * tblock_sizze_50487 + local_tid_50484;\n    tid_50482 = sext_i32_i64(global_tid_50483);\n    x_49312 = ((__global double *) clBase_mem_49377)[(int64_t) 1];\n    ((__global double *) mem_49433)[(int64_t) 0] = x_49312;\n    \n  error_0:\n    return;\n}\nFUTHARK_KERNEL_SIZED(add_next_partition_doublezigpuseq_50488_dim1, 1, 1)\nvoid add_next_partition_doublezigpuseq_50488(__global int *global_failure, __globa",
                                    "l unsigned char *clBase_mem_49379, __global unsigned char *mem_49436)\n{\n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_50490;\n    int32_t tblock_sizze_50493;\n    int32_t wave_sizze_50492;\n    int32_t block_id_50491;\n    int32_t global_tid_50489;\n    int64_t tid_50488;\n    double x_49316;\n    \n    local_tid_50490 = get_local_id(0);\n    tblock_sizze_50493 = get_local_size(0);\n    wave_sizze_50492 = LOCKSTEP_WIDTH;\n    block_id_50491 = get_tblock_id(0);\n    global_tid_50489 = block_id_50491 * tblock_sizze_50493 + local_tid_50490;\n    tid_50488 = sext_i32_i64(global_tid_50489);\n    x_49316 = ((__global double *) clBase_mem_49379)[(int64_t) 0];\n    ((__global double *) mem_49436)[(int64_t) 0] = x_49316;\n    \n  error_0:\n    return;\n}\nFUTHARK_KERNEL_SIZED(add_next_partition_doublezigpuseq_50494_dim1, 1, 1)\nvoid add_next_partition_doublezigpuseq_50494(__global int *global_failure, __global unsigned char *clBase_mem_49379, __global unsigned char *mem_49439)\n{\n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_50496;\n    int32_t tblock_sizze_50499;\n    int32_t wave_sizze_50498;\n    int32_t block_id_50497;\n    int32_t global_tid_50495;\n    int64_t tid_50494;\n    double x_49320;\n    \n    local_tid_50496 = get_local_id(0);\n    tblock_sizze_50499 = get_local_size(0);\n    wave_sizze_50498 = LOCKSTEP_WIDTH;\n    block_id_50497 = get_tblock_id(0);\n    global_tid_50495 = block_id_50497 * tblock_sizze_50499 + local_tid_50496;\n    tid_50494 = sext_i32_i64(global_tid_50495);\n    x_49320 = ((__global double *) clBase_mem_49379)[(int64_t) 1];\n    ((__global double *) mem_49439)[(int64_t) 0] = x_49320;\n    \n  error_0:\n    return;\n}\nFUTHARK_KERNEL_SIZED(add_next_partition_doublezigpuseq_50501_dim1, 1, 1)\nvoid add_next_partition_doublezigpuseq_50501(__global int *global_failure, int failure_is_an_option, __global int64_t *global_failure_args, int64_t new_id_27080, unsigned char loop_not_taken_39175_bits, __global unsigned char *clBase_mem_49377,", " __global unsigned char *clBase_mem_49378, __global unsigned char *clBase_mem_49379, __global unsigned char *mem_49446, __global unsigned char *mem_49447, __global unsigned char *mem_49448, __global unsigned char *mem_49449, __global unsigned char *mem_49450, __global unsigned char *mem_49451, __global unsigned char *mem_49452, __global unsigned char *mem_49453, __global unsigned char *mem_49454, __global unsigned char *mem_49455, __global unsigned char *mem_49456, __global unsigned char *mem_49457, __global unsigned char *mem_49458, __global unsigned char *mem_49459, __global unsigned char *mem_49460, __global unsigned char *mem_49461)\n{\n    bool loop_not_taken_39175 = loop_not_taken_39175_bits;\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_50503;\n    int32_t tblock_sizze_50506;\n    int32_t wave_sizze_50505;\n    int32_t block_id_50504;\n    int32_t global_tid_50502;\n    int64_t tid_50501;\n    int64_t zv_rhs_49051;\n    bool zzero_49054;\n    bool nonzzero_49057;\n    bool nonzzero_cert_49060;\n    int64_t x_id_49063;\n    int64_t y_id_49066;\n    bool cond_49069;\n    int64_t zp_lhs_49073;\n    int64_t zm_lhs_49077;\n    int64_t nleft_t_res_49080;\n    int64_t nleft_49084;\n    bool cond_t_res_49087;\n    bool x_49091;\n    int64_t zt_lhs_49094;\n    int64_t zp_lhs_49098;\n    int64_t zm_lhs_49102;\n    int64_t nld_t_res_49105;\n    int64_t nld_49109;\n    int64_t ndown_49113;\n    int64_t zl_rhs_49116;\n    bool cond_49120;\n    bool x_49124;\n    int64_t nrd_t_res_49127;\n    int64_t nrd_49131;\n    int64_t nright_t_res_49134;\n    int64_t nright_49138;\n    int64_t zm_lhs_49142;\n    int64_t zl_rhs_49145;\n    bool cond_t_res_49149;\n    bool x_49153;\n    int64_t zt_lhs_49156;\n    int64_t zp_lhs_49160;\n    int64_t zp_lhs_49164;\n    int64_t nru_t_res_49167;\n    int64_t nru_49171;\n    int64_t zm_lhs_49173;\n    int64_t zl_rhs_49176;\n    bool cond_49180;\n    int64_t nup_49184;\n    bool x_49188;\n    int64_t nlu_t_res_49191;\n    int64_t nlu_49195;\n    bool cond_4920", "8;\n    double minC_49217;\n    bool cond_49220;\n    double minC_49229;\n    bool cond_49233;\n    double maxC_49243;\n    bool cond_49247;\n    double maxC_49256;\n    bool protect_assert_disj_49295;\n    bool nonzzero_cert_49298;\n    \n    local_tid_50503 = get_local_id(0);\n    tblock_sizze_50506 = get_local_size(0);\n    wave_sizze_50505 = LOCKSTEP_WIDTH;\n    block_id_50504 = get_tblock_id(0);\n    global_tid_50502 = block_id_50504 * tblock_sizze_50506 + local_tid_50503;\n    tid_50501 = sext_i32_i64(global_tid_50502);\n    zv_rhs_49051 = ((__global int64_t *) clBase_mem_49378)[(int64_t) 0];\n    zzero_49054 = zv_rhs_49051 == (int64_t) 0;\n    nonzzero_49057 = !zzero_49054;\n    if (!nonzzero_49057) {\n        {\n            if (atomic_cmpxchg_i32_global(global_failure, -1, 0) == -1) {\n                ;\n            }\n            return;\n        }\n    }\n    x_id_49063 = smod64(new_id_27080, zv_rhs_49051);\n    y_id_49066 = sdiv64(new_id_27080, zv_rhs_49051);\n    cond_49069 = slt64((int64_t) 0, x_id_49063);\n    zp_lhs_49073 = mul64(zv_rhs_49051, y_id_49066);\n    zm_lhs_49077 = add64(x_id_49063, zp_lhs_49073);\n    nleft_t_res_49080 = sub64(zm_lhs_49077, (int64_t) 1);\n    if (cond_49069) {\n        nleft_49084 = nleft_t_res_49080;\n    } else {\n        nleft_49084 = (int64_t) -1;\n    }\n    cond_t_res_49087 = slt64((int64_t) 0, y_id_49066);\n    x_49091 = cond_49069 && cond_t_res_49087;\n    zt_lhs_49094 = sub64(y_id_49066, (int64_t) 1);\n    zp_lhs_49098 = mul64(zv_rhs_49051, zt_lhs_49094);\n    zm_lhs_49102 = add64(x_id_49063, zp_lhs_49098);\n    nld_t_res_49105 = sub64(zm_lhs_49102, (int64_t) 1);\n    if (x_49091) {\n        nld_49109 = nld_t_res_49105;\n    } else {\n        nld_49109 = (int64_t) -1;\n    }\n    if (cond_t_res_49087) {\n        ndown_49113 = zm_lhs_49102;\n    } else {\n        ndown_49113 = (int64_t) -1;\n    }\n    zl_rhs_49116 = sub64(zv_rhs_49051, (int64_t) 1);\n    cond_49120 = slt64(x_id_49063, zl_rhs_49116);\n    x_49124 = cond_t_res_49087 && cond_49120;\n    nrd_t_res_49127 = ad",
                                    "d64((int64_t) 1, zm_lhs_49102);\n    if (x_49124) {\n        nrd_49131 = nrd_t_res_49127;\n    } else {\n        nrd_49131 = (int64_t) -1;\n    }\n    nright_t_res_49134 = add64((int64_t) 1, zm_lhs_49077);\n    if (cond_49120) {\n        nright_49138 = nright_t_res_49134;\n    } else {\n        nright_49138 = (int64_t) -1;\n    }\n    if (cond_49120) {\n        int64_t x_49141 = ((__global int64_t *) clBase_mem_49378)[(int64_t) 1];\n        \n        zm_lhs_49142 = x_49141;\n    } else {\n        zm_lhs_49142 = (int64_t) 0;\n    }\n    zl_rhs_49145 = sub64(zm_lhs_49142, (int64_t) 1);\n    cond_t_res_49149 = slt64(y_id_49066, zl_rhs_49145);\n    x_49153 = cond_49120 && cond_t_res_49149;\n    zt_lhs_49156 = add64((int64_t) 1, y_id_49066);\n    zp_lhs_49160 = mul64(zv_rhs_49051, zt_lhs_49156);\n    zp_lhs_49164 = add64(x_id_49063, zp_lhs_49160);\n    nru_t_res_49167 = add64((int64_t) 1, zp_lhs_49164);\n    if (x_49153) {\n        nru_49171 = nru_t_res_49167;\n    } else {\n        nru_49171 = (int64_t) -1;\n    }\n    zm_lhs_49173 = ((__global int64_t *) clBase_mem_49378)[(int64_t) 1];\n    zl_rhs_49176 = sub64(zm_lhs_49173, (int64_t) 1);\n    cond_49180 = slt64(y_id_49066, zl_rhs_49176);\n    if (cond_49180) {\n        nup_49184 = zp_lhs_49164;\n    } else {\n        nup_49184 = (int64_t) -1;\n    }\n    x_49188 = cond_49069 && cond_49180;\n    nlu_t_res_49191 = sub64(zp_lhs_49164, (int64_t) 1);\n    if (x_49188) {\n        nlu_49195 = nlu_t_res_49191;\n    } else {\n        nlu_49195 = (int64_t) -1;\n    }\n    ((__global int64_t *) mem_49446)[(int64_t) 0] = nleft_49084;\n    ((__global int64_t *) mem_49446)[(int64_t) 1] = nld_49109;\n    ((__global int64_t *) mem_49446)[(int64_t) 2] = ndown_49113;\n    ((__global int64_t *) mem_49446)[(int64_t) 3] = nrd_49131;\n    ((__global int64_t *) mem_49446)[(int64_t) 4] = nright_49138;\n    ((__global int64_t *) mem_49446)[(int64_t) 5] = nru_49171;\n    ((__global int64_t *) mem_49446)[(int64_t) 6] = nup_49184;\n    ((__global int64_t *) mem_49446)[(int64_t) 7] = nlu_49195;\n   ", " cond_49208 = x_id_49063 == (int64_t) 0;\n    if (cond_49208) {\n        minC_49217 = -INFINITY;\n    } else {\n        double times_arg1_49211;\n        double i64_res_49213;\n        double zt_res_49214;\n        double plus_arg0_49215;\n        double zp_res_49216;\n        \n        times_arg1_49211 = ((__global double *) clBase_mem_49379)[(int64_t) 0];\n        i64_res_49213 = sitofp_i64_f64(x_id_49063);\n        zt_res_49214 = times_arg1_49211 * i64_res_49213;\n        plus_arg0_49215 = ((__global double *) clBase_mem_49377)[(int64_t) 0];\n        zp_res_49216 = zt_res_49214 + plus_arg0_49215;\n        minC_49217 = zp_res_49216;\n    }\n    cond_49220 = y_id_49066 == (int64_t) 0;\n    if (cond_49220) {\n        minC_49229 = -INFINITY;\n    } else {\n        double times_arg1_49223;\n        double i64_res_49225;\n        double zt_res_49226;\n        double plus_arg0_49227;\n        double zp_res_49228;\n        \n        times_arg1_49223 = ((__global double *) clBase_mem_49379)[(int64_t) 1];\n        i64_res_49225 = sitofp_i64_f64(y_id_49066);\n        zt_res_49226 = times_arg1_49223 * i64_res_49225;\n        plus_arg0_49227 = ((__global double *) clBase_mem_49377)[(int64_t) 1];\n        zp_res_49228 = zt_res_49226 + plus_arg0_49227;\n        minC_49229 = zp_res_49228;\n    }\n    cond_49233 = x_id_49063 == zl_rhs_49116;\n    if (cond_49233) {\n        maxC_49243 = INFINITY;\n    } else {\n        double times_arg1_49236;\n        int64_t from_i64_arg0_49238;\n        double i64_res_49239;\n        double zt_res_49240;\n        double plus_arg0_49241;\n        double zp_res_49242;\n        \n        times_arg1_49236 = ((__global double *) clBase_mem_49379)[(int64_t) 0];\n        from_i64_arg0_49238 = add64((int64_t) 1, x_id_49063);\n        i64_res_49239 = sitofp_i64_f64(from_i64_arg0_49238);\n        zt_res_49240 = times_arg1_49236 * i64_res_49239;\n        plus_arg0_49241 = ((__global double *) clBase_mem_49377)[(int64_t) 0];\n        zp_res_49242 = zt_res_49240 + plus_arg0_49241;\n        maxC_49243 = zp_r", "es_49242;\n    }\n    cond_49247 = y_id_49066 == zl_rhs_49176;\n    if (cond_49247) {\n        maxC_49256 = INFINITY;\n    } else {\n        double times_arg1_49250;\n        double i64_res_49252;\n        double zt_res_49253;\n        double plus_arg0_49254;\n        double zp_res_49255;\n        \n        times_arg1_49250 = ((__global double *) clBase_mem_49379)[(int64_t) 1];\n        i64_res_49252 = sitofp_i64_f64(zt_lhs_49156);\n        zt_res_49253 = times_arg1_49250 * i64_res_49252;\n        plus_arg0_49254 = ((__global double *) clBase_mem_49377)[(int64_t) 1];\n        zp_res_49255 = zt_res_49253 + plus_arg0_49254;\n        maxC_49256 = zp_res_49255;\n    }\n    protect_assert_disj_49295 = loop_not_taken_39175 || nonzzero_49057;\n    if (!protect_assert_disj_49295) {\n        {\n            if (atomic_cmpxchg_i32_global(global_failure, -1, 1) == -1) {\n                ;\n            }\n            return;\n        }\n    }\n    ((__global double *) mem_49447)[(int64_t) 0] = minC_49217;\n    ((__global double *) mem_49447)[(int64_t) 1] = minC_49229;\n    ((__global double *) mem_49448)[(int64_t) 0] = maxC_49243;\n    ((__global double *) mem_49448)[(int64_t) 1] = maxC_49256;\n    ((__global int64_t *) mem_49449)[(int64_t) 0] = zv_rhs_49051;\n    for (int64_t i_0 = 0; i_0 < (int64_t) 8; i_0++) {\n        ((__global int64_t *) mem_49450)[i_0] = ((__global int64_t *) mem_49446)[i_0];\n    }\n    ((__global bool *) mem_49451)[(int64_t) 0] = cond_49208;\n    ((__global double *) mem_49452)[(int64_t) 0] = minC_49217;\n    ((__global bool *) mem_49453)[(int64_t) 0] = cond_49220;\n    ((__global double *) mem_49454)[(int64_t) 0] = minC_49229;\n    ((__global bool *) mem_49455)[(int64_t) 0] = cond_49233;\n    ((__global double *) mem_49456)[(int64_t) 0] = maxC_49243;\n    ((__global bool *) mem_49457)[(int64_t) 0] = cond_49247;\n    ((__global double *) mem_49458)[(int64_t) 0] = maxC_49256;\n    for (int64_t i_0 = 0; i_0 < (int64_t) 2; i_0++) {\n        ((__global double *) mem_49460)[i_0] = ((__global double *) ",
                                    "mem_49447)[i_0];\n    }\n    for (int64_t i_0 = 0; i_0 < (int64_t) 2; i_0++) {\n        ((__global double *) mem_49461)[i_0] = ((__global double *) mem_49448)[i_0];\n    }\n    \n  error_0:\n    return;\n}\nFUTHARK_KERNEL_SIZED(add_next_partition_doublezigpuseq_51204_dim1, 1, 1)\nvoid add_next_partition_doublezigpuseq_51204(__global int *global_failure, double zt_res_38807, __global unsigned char *mem_49451, __global unsigned char *mem_49452, __global unsigned char *mem_49453, __global unsigned char *mem_49454, __global unsigned char *mem_49455, __global unsigned char *mem_49456, __global unsigned char *mem_49457, __global unsigned char *mem_49458, __global unsigned char *mem_49463, __global unsigned char *mem_49592, __global unsigned char *mem_49593, __global unsigned char *mem_49594, __global unsigned char *mem_49595)\n{\n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_51206;\n    int32_t tblock_sizze_51209;\n    int32_t wave_sizze_51208;\n    int32_t block_id_51207;\n    int32_t global_tid_51205;\n    int64_t tid_51204;\n    bool cond_49258;\n    bool cond_49260;\n    double minC_49263;\n    double min_inner_49265;\n    bool cond_49267;\n    bool cond_49269;\n    double minC_49272;\n    double min_inner_49274;\n    bool cond_49276;\n    bool cond_49278;\n    double maxC_49281;\n    double max_inner_49283;\n    bool cond_49285;\n    bool cond_49287;\n    double maxC_49290;\n    double max_inner_49292;\n    \n    local_tid_51206 = get_local_id(0);\n    tblock_sizze_51209 = get_local_size(0);\n    wave_sizze_51208 = LOCKSTEP_WIDTH;\n    block_id_51207 = get_tblock_id(0);\n    global_tid_51205 = block_id_51207 * tblock_sizze_51209 + local_tid_51206;\n    tid_51204 = sext_i32_i64(global_tid_51205);\n    cond_49258 = ((__global bool *) mem_49451)[(int64_t) 0];\n    if (cond_49258) {\n        cond_49260 = 1;\n    } else {\n        bool cond_f_res_49259 = ((__global bool *) mem_49463)[(int64_t) 0];\n        \n        cond_49260 = cond_f_res_49259;\n    }\n    minC_49263 = ((__global double *) m", "em_49452)[(int64_t) 0];\n    if (cond_49260) {\n        min_inner_49265 = minC_49263;\n    } else {\n        double zp_res_49264 = zt_res_38807 + minC_49263;\n        \n        min_inner_49265 = zp_res_49264;\n    }\n    cond_49267 = ((__global bool *) mem_49453)[(int64_t) 0];\n    if (cond_49267) {\n        cond_49269 = 1;\n    } else {\n        bool cond_f_res_49268 = ((__global bool *) mem_49463)[(int64_t) 1];\n        \n        cond_49269 = cond_f_res_49268;\n    }\n    minC_49272 = ((__global double *) mem_49454)[(int64_t) 0];\n    if (cond_49269) {\n        min_inner_49274 = minC_49272;\n    } else {\n        double zp_res_49273 = zt_res_38807 + minC_49272;\n        \n        min_inner_49274 = zp_res_49273;\n    }\n    cond_49276 = ((__global bool *) mem_49455)[(int64_t) 0];\n    if (cond_49276) {\n        cond_49278 = 1;\n    } else {\n        bool cond_f_res_49277 = ((__global bool *) mem_49463)[(int64_t) 2];\n        \n        cond_49278 = cond_f_res_49277;\n    }\n    maxC_49281 = ((__global double *) mem_49456)[(int64_t) 0];\n    if (cond_49278) {\n        max_inner_49283 = maxC_49281;\n    } else {\n        double zm_res_49282 = maxC_49281 - zt_res_38807;\n        \n        max_inner_49283 = zm_res_49282;\n    }\n    cond_49285 = ((__global bool *) mem_49457)[(int64_t) 0];\n    if (cond_49285) {\n        cond_49287 = 1;\n    } else {\n        bool cond_f_res_49286 = ((__global bool *) mem_49463)[(int64_t) 3];\n        \n        cond_49287 = cond_f_res_49286;\n    }\n    maxC_49290 = ((__global double *) mem_49458)[(int64_t) 0];\n    if (cond_49287) {\n        max_inner_49292 = maxC_49290;\n    } else {\n        double zm_res_49291 = maxC_49290 - zt_res_38807;\n        \n        max_inner_49292 = zm_res_49291;\n    }\n    ((__global double *) mem_49592)[(int64_t) 0] = min_inner_49265;\n    ((__global double *) mem_49592)[(int64_t) 1] = min_inner_49274;\n    ((__global double *) mem_49593)[(int64_t) 0] = max_inner_49283;\n    ((__global double *) mem_49593)[(int64_t) 1] = max_inner_49292;\n    for (int64_t i_0 = 0;", " i_0 < (int64_t) 2; i_0++) {\n        ((__global double *) mem_49594)[i_0] = ((__global double *) mem_49592)[i_0];\n    }\n    for (int64_t i_0 = 0; i_0 < (int64_t) 2; i_0++) {\n        ((__global double *) mem_49595)[i_0] = ((__global double *) mem_49593)[i_0];\n    }\n    \n  error_0:\n    return;\n}\nFUTHARK_KERNEL_SIZED(add_next_partition_doublezisegmap_43129_dim1, 1, 1)\nvoid add_next_partition_doublezisegmap_43129(__global int *global_failure, int failure_is_an_option, __global int64_t *global_failure_args, int64_t part_no_27031, __global unsigned char *clProc_mem_49384, __global unsigned char *mem_49450, __global unsigned char *mem_49463)\n{\n    #define segmap_tblock_sizze_43125 (add_next_partition_doublezisegmap_43129zisegmap_tblock_sizze_43125)\n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_50509;\n    int32_t tblock_sizze_50512;\n    int32_t wave_sizze_50511;\n    int32_t block_id_50510;\n    int32_t global_tid_50508;\n    int64_t phys_tid_43129;\n    int64_t global_tid_50513;\n    int64_t slice_50514;\n    int64_t gtid_43128;\n    int64_t remnant_50515;\n    \n    local_tid_50509 = get_local_id(0);\n    tblock_sizze_50512 = get_local_size(0);\n    wave_sizze_50511 = LOCKSTEP_WIDTH;\n    block_id_50510 = get_tblock_id(0);\n    global_tid_50508 = block_id_50510 * tblock_sizze_50512 + local_tid_50509;\n    phys_tid_43129 = sext_i32_i64(global_tid_50508);\n    global_tid_50513 = sext_i32_i64(block_id_50510) * segmap_tblock_sizze_43125 + sext_i32_i64(local_tid_50509);\n    slice_50514 = (int64_t) 8;\n    gtid_43128 = global_tid_50513;\n    remnant_50515 = global_tid_50513 - gtid_43128;\n    if (slt64(gtid_43128, (int64_t) 8)) {\n        int64_t eta_p_43130;\n        bool cond_43131;\n        bool lifted_lambda_res_43132;\n        \n        eta_p_43130 = ((__global int64_t *) mem_49450)[gtid_43128];\n        cond_43131 = sle64((int64_t) 0, eta_p_43130);\n        if (cond_43131) {\n            bool y_43133;\n            bool bounds_check_43134;\n            bool index_certs_4313",
                                    "5;\n            bool lifted_lambda_res_t_res_43136;\n            \n            y_43133 = slt64(eta_p_43130, part_no_27031);\n            bounds_check_43134 = cond_43131 && y_43133;\n            if (!bounds_check_43134) {\n                {\n                    if (atomic_cmpxchg_i32_global(global_failure, -1, 2) == -1) {\n                        global_failure_args[0] = (int64_t) eta_p_43130;\n                        global_failure_args[1] = (int64_t) part_no_27031;\n                        ;\n                    }\n                    return;\n                }\n            }\n            lifted_lambda_res_t_res_43136 = ((__global bool *) clProc_mem_49384)[eta_p_43130];\n            lifted_lambda_res_43132 = lifted_lambda_res_t_res_43136;\n        } else {\n            lifted_lambda_res_43132 = 0;\n        }\n        ((__global bool *) mem_49463)[gtid_43128] = lifted_lambda_res_43132;\n    }\n    \n  error_0:\n    return;\n    #undef segmap_tblock_sizze_43125\n}\nFUTHARK_KERNEL_SIZED(add_next_partition_doublezisegmap_43790_dim1, 1, 1)\nvoid add_next_partition_doublezisegmap_43790(__global int *global_failure, int failure_is_an_option, __global int64_t *global_failure_args, __global unsigned char *mem_49450, __global unsigned char *mem_49463, __global unsigned char *mem_49465, __global unsigned char *mem_49466, __global unsigned char *mem_49467)\n{\n    #define segmap_tblock_sizze_43784 (add_next_partition_doublezisegmap_43790zisegmap_tblock_sizze_43784)\n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_50665;\n    int32_t tblock_sizze_50668;\n    int32_t wave_sizze_50667;\n    int32_t block_id_50666;\n    int32_t global_tid_50664;\n    int64_t phys_tid_43790;\n    int64_t global_tid_50669;\n    int64_t slice_50670;\n    int64_t gtid_43789;\n    int64_t remnant_50671;\n    \n    local_tid_50665 = get_local_id(0);\n    tblock_sizze_50668 = get_local_size(0);\n    wave_sizze_50667 = LOCKSTEP_WIDTH;\n    block_id_50666 = get_tblock_id(0);\n    global_tid_50664 = block_id_50666 * tblock_sizz", "e_50668 + local_tid_50665;\n    phys_tid_43790 = sext_i32_i64(global_tid_50664);\n    global_tid_50669 = sext_i32_i64(block_id_50666) * segmap_tblock_sizze_43784 + sext_i32_i64(local_tid_50665);\n    slice_50670 = (int64_t) 8;\n    gtid_43789 = global_tid_50669;\n    remnant_50671 = global_tid_50669 - gtid_43789;\n    if (slt64(gtid_43789, (int64_t) 8)) {\n        int64_t eta_p_43791;\n        bool x_43792;\n        bool y_43793;\n        bool bounds_check_43794;\n        bool index_certs_43795;\n        bool cond_43796;\n        int64_t lifted_lambda_res_43797;\n        bool not_p_43798;\n        \n        eta_p_43791 = ((__global int64_t *) mem_49450)[gtid_43789];\n        x_43792 = sle64((int64_t) 0, eta_p_43791);\n        y_43793 = slt64(eta_p_43791, (int64_t) 8);\n        bounds_check_43794 = x_43792 && y_43793;\n        if (!bounds_check_43794) {\n            {\n                if (atomic_cmpxchg_i32_global(global_failure, -1, 7) == -1) {\n                    global_failure_args[0] = (int64_t) eta_p_43791;\n                    global_failure_args[1] = (int64_t) (int64_t) 8;\n                    ;\n                }\n                return;\n            }\n        }\n        cond_43796 = ((__global bool *) mem_49463)[eta_p_43791];\n        if (cond_43796) {\n            lifted_lambda_res_43797 = (int64_t) -1;\n        } else {\n            lifted_lambda_res_43797 = eta_p_43791;\n        }\n        not_p_43798 = !cond_43796;\n        ((__global bool *) mem_49465)[gtid_43789] = cond_43796;\n        ((__global bool *) mem_49466)[gtid_43789] = not_p_43798;\n        ((__global int64_t *) mem_49467)[gtid_43789] = lifted_lambda_res_43797;\n    }\n    \n  error_0:\n    return;\n    #undef segmap_tblock_sizze_43784\n}\nFUTHARK_KERNEL_SIZED(add_next_partition_doublezisegmap_43826_dim1, 1, 1)\nvoid add_next_partition_doublezisegmap_43826(__global int *global_failure, int failure_is_an_option, __global int64_t *global_failure_args, int64_t n_new_27039, double clBase_27044, __global unsigned char *clBase_mem_49377, __gl", "obal unsigned char *clBase_mem_49378, __global unsigned char *clBase_mem_49379, __global unsigned char *new_xs_mem_49401, __global unsigned char *new_ys_mem_49402, __global unsigned char *mem_49467, __global unsigned char *mem_49469, __global unsigned char *mem_49471, __global unsigned char *mem_49472)\n{\n    #define segmap_tblock_sizze_43821 (add_next_partition_doublezisegmap_43826zisegmap_tblock_sizze_43821)\n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_50746;\n    int32_t tblock_sizze_50749;\n    int32_t wave_sizze_50748;\n    int32_t block_id_50747;\n    int32_t global_tid_50745;\n    int64_t phys_tid_43826;\n    int64_t global_tid_50750;\n    int64_t slice_50751;\n    int64_t gtid_43825;\n    int64_t remnant_50752;\n    \n    local_tid_50746 = get_local_id(0);\n    tblock_sizze_50749 = get_local_size(0);\n    wave_sizze_50748 = LOCKSTEP_WIDTH;\n    block_id_50747 = get_tblock_id(0);\n    global_tid_50745 = block_id_50747 * tblock_sizze_50749 + local_tid_50746;\n    phys_tid_43826 = sext_i32_i64(global_tid_50745);\n    global_tid_50750 = sext_i32_i64(block_id_50747) * segmap_tblock_sizze_43821 + sext_i32_i64(local_tid_50746);\n    slice_50751 = (int64_t) 8;\n    gtid_43825 = global_tid_50750;\n    remnant_50752 = global_tid_50750 - gtid_43825;\n    if (slt64(gtid_43825, (int64_t) 8)) {\n        bool defunc_0_reduce_res_43828;\n        int64_t lifted_lambda_res_43829;\n        bool cond_43830;\n        int64_t lifted_lambda_res_43831;\n        bool lifted_lambda_res_43832;\n        int64_t defunc_0_f_res_43868;\n        \n        defunc_0_reduce_res_43828 = ((__global bool *) mem_49469)[gtid_43825];\n        if (defunc_0_reduce_res_43828) {\n            lifted_lambda_res_43829 = (int64_t) -1;\n        } else {\n            int64_t lifted_lambda_res_43827 = ((__global int64_t *) mem_49467)[gtid_43825];\n            \n            lifted_lambda_res_43829 = lifted_lambda_res_43827;\n        }\n        cond_43830 = slt64(lifted_lambda_res_43829, (int64_t) 0);\n        if (cond_43",
                                    "830) {\n            lifted_lambda_res_43831 = (int64_t) -1;\n        } else {\n            lifted_lambda_res_43831 = lifted_lambda_res_43829;\n        }\n        if (cond_43830) {\n            lifted_lambda_res_43832 = 0;\n        } else {\n            int64_t zv_rhs_43833;\n            bool zzero_43834;\n            bool nonzzero_43835;\n            bool nonzzero_cert_43836;\n            int64_t nxid_43837;\n            int64_t nyid_43838;\n            double times_arg1_43839;\n            double i64_res_43840;\n            double zt_res_43841;\n            double plus_arg0_43842;\n            double zp_res_43843;\n            double times_arg1_43844;\n            double i64_res_43845;\n            double zt_res_43846;\n            double plus_arg0_43847;\n            double zp_res_43848;\n            double zp_res_43849;\n            double zp_res_43850;\n            double zm_res_43851;\n            double zp_res_43852;\n            double zm_res_43853;\n            double zp_res_43854;\n            bool defunc_0_reduce_res_43855;\n            bool redout_49011;\n            \n            zv_rhs_43833 = ((__global int64_t *) clBase_mem_49378)[(int64_t) 0];\n            zzero_43834 = zv_rhs_43833 == (int64_t) 0;\n            nonzzero_43835 = !zzero_43834;\n            if (!nonzzero_43835) {\n                {\n                    if (atomic_cmpxchg_i32_global(global_failure, -1, 8) == -1) {\n                        ;\n                    }\n                    return;\n                }\n            }\n            nxid_43837 = smod64(lifted_lambda_res_43829, zv_rhs_43833);\n            nyid_43838 = sdiv64(lifted_lambda_res_43829, zv_rhs_43833);\n            times_arg1_43839 = ((__global double *) clBase_mem_49379)[(int64_t) 0];\n            i64_res_43840 = sitofp_i64_f64(nxid_43837);\n            zt_res_43841 = times_arg1_43839 * i64_res_43840;\n            plus_arg0_43842 = ((__global double *) clBase_mem_49377)[(int64_t) 0];\n            zp_res_43843 = zt_res_43841 + plus_arg0_43842;\n            times_arg1_4384", "4 = ((__global double *) clBase_mem_49379)[(int64_t) 1];\n            i64_res_43845 = sitofp_i64_f64(nyid_43838);\n            zt_res_43846 = times_arg1_43844 * i64_res_43845;\n            plus_arg0_43847 = ((__global double *) clBase_mem_49377)[(int64_t) 1];\n            zp_res_43848 = zt_res_43846 + plus_arg0_43847;\n            zp_res_43849 = times_arg1_43839 + zp_res_43843;\n            zp_res_43850 = times_arg1_43844 + zp_res_43848;\n            zm_res_43851 = zp_res_43843 - clBase_27044;\n            zp_res_43852 = clBase_27044 + zp_res_43849;\n            zm_res_43853 = zp_res_43848 - clBase_27044;\n            zp_res_43854 = clBase_27044 + zp_res_43850;\n            redout_49011 = 0;\n            for (int64_t i_49012 = 0; i_49012 < n_new_27039; i_49012++) {\n                double eta_p_43856;\n                double eta_p_43857;\n                bool zgze_res_43858;\n                bool zlze_res_43859;\n                bool x_43860;\n                bool zgze_res_43861;\n                bool zlze_res_43862;\n                bool x_43863;\n                bool x_43864;\n                bool defunc_0_op_res_43867;\n                bool redout_tmp_50753;\n                \n                eta_p_43856 = ((__global double *) new_xs_mem_49401)[i_49012];\n                eta_p_43857 = ((__global double *) new_ys_mem_49402)[i_49012];\n                zgze_res_43858 = zm_res_43851 <= eta_p_43856;\n                zlze_res_43859 = eta_p_43856 <= zp_res_43852;\n                x_43860 = zgze_res_43858 && zlze_res_43859;\n                zgze_res_43861 = zm_res_43853 <= eta_p_43857;\n                zlze_res_43862 = eta_p_43857 <= zp_res_43854;\n                x_43863 = zgze_res_43861 && zlze_res_43862;\n                x_43864 = x_43860 && x_43863;\n                defunc_0_op_res_43867 = x_43864 || redout_49011;\n                redout_tmp_50753 = defunc_0_op_res_43867;\n                redout_49011 = redout_tmp_50753;\n            }\n            defunc_0_reduce_res_43855 = redout_49011;\n            li", "fted_lambda_res_43832 = defunc_0_reduce_res_43855;\n        }\n        defunc_0_f_res_43868 = btoi_bool_i64(lifted_lambda_res_43832);\n        ((__global int64_t *) mem_49471)[gtid_43825] = defunc_0_f_res_43868;\n        ((__global int64_t *) mem_49472)[gtid_43825] = lifted_lambda_res_43831;\n    }\n    \n  error_0:\n    return;\n    #undef segmap_tblock_sizze_43821\n}\nFUTHARK_KERNEL_SIZED(add_next_partition_doublezisegmap_43887_dim1, 1, 1)\nvoid add_next_partition_doublezisegmap_43887(__global int *global_failure, int64_t m_f_res_38983, int64_t num_tblocks_43892, int32_t virt_num_tblocks_51056, __global unsigned char *ext_mem_49524, __global unsigned char *ext_mem_49525, __global unsigned char *ext_mem_49526, __global unsigned char *mem_49528)\n{\n    #define segmap_tblock_sizze_43890 (add_next_partition_doublezisegmap_43887zisegmap_tblock_sizze_43890)\n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_51058;\n    int32_t tblock_sizze_51061;\n    int32_t wave_sizze_51060;\n    int32_t block_id_51059;\n    int32_t global_tid_51057;\n    int64_t phys_tid_43887;\n    int32_t phys_tblock_id_51062;\n    int32_t iterations_51063;\n    \n    local_tid_51058 = get_local_id(0);\n    tblock_sizze_51061 = get_local_size(0);\n    wave_sizze_51060 = LOCKSTEP_WIDTH;\n    block_id_51059 = get_tblock_id(0);\n    global_tid_51057 = block_id_51059 * tblock_sizze_51061 + local_tid_51058;\n    phys_tid_43887 = sext_i32_i64(global_tid_51057);\n    phys_tblock_id_51062 = get_tblock_id(0);\n    iterations_51063 = sdiv_up32(virt_num_tblocks_51056 - phys_tblock_id_51062, sext_i64_i32(num_tblocks_43892));\n    for (int32_t i_51064 = 0; i_51064 < iterations_51063; i_51064++) {\n        int32_t virt_tblock_id_51065;\n        int64_t global_tid_51066;\n        int64_t slice_51067;\n        int64_t write_i_43886;\n        int64_t remnant_51068;\n        \n        virt_tblock_id_51065 = phys_tblock_id_51062 + i_51064 * sext_i64_i32(num_tblocks_43892);\n        global_tid_51066 = sext_i32_i64(virt_tblock_id_5106",
                                    "5) * segmap_tblock_sizze_43890 + sext_i32_i64(local_tid_51058);\n        slice_51067 = (int64_t) 8;\n        write_i_43886 = global_tid_51066;\n        remnant_51068 = global_tid_51066 - write_i_43886;\n        if (slt64(write_i_43886, (int64_t) 8)) {\n            int64_t eta_p_42283;\n            int64_t write_value_42285;\n            bool cond_42286;\n            int64_t lifted_lambda_res_42287;\n            \n            eta_p_42283 = ((__global int64_t *) ext_mem_49525)[write_i_43886];\n            write_value_42285 = ((__global int64_t *) ext_mem_49524)[write_i_43886];\n            cond_42286 = eta_p_42283 == (int64_t) 1;\n            if (cond_42286) {\n                int64_t eta_p_42284;\n                int64_t lifted_lambda_res_t_res_42672;\n                \n                eta_p_42284 = ((__global int64_t *) ext_mem_49526)[write_i_43886];\n                lifted_lambda_res_t_res_42672 = sub64(eta_p_42284, (int64_t) 1);\n                lifted_lambda_res_42287 = lifted_lambda_res_t_res_42672;\n            } else {\n                lifted_lambda_res_42287 = (int64_t) -1;\n            }\n            if (sle64((int64_t) 0, lifted_lambda_res_42287) && slt64(lifted_lambda_res_42287, m_f_res_38983)) {\n                ((__global int64_t *) mem_49528)[lifted_lambda_res_42287] = write_value_42285;\n            }\n        }\n        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    }\n    \n  error_1:\n    return;\n    #undef segmap_tblock_sizze_43890\n}\nFUTHARK_KERNEL_SIZED(add_next_partition_doublezisegmap_44136_dim1, 1, 1)\nvoid add_next_partition_doublezisegmap_44136(__global int *global_failure, int failure_is_an_option, __global int64_t *global_failure_args, int64_t n_new_27039, double clBase_27044, __global unsigned char *clBase_mem_49377, __global unsigned char *clBase_mem_49378, __global unsigned char *clBase_mem_49379, __global unsigned char *new_xs_mem_49401, __global unsigned char *new_ys_mem_49402, __global unsigned char *mem_49450, __global unsigned char *ext_mem_49560, __glo", "bal unsigned char *mem_49562)\n{\n    #define segmap_tblock_sizze_44132 (add_next_partition_doublezisegmap_44136zisegmap_tblock_sizze_44132)\n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_51162;\n    int32_t tblock_sizze_51165;\n    int32_t wave_sizze_51164;\n    int32_t block_id_51163;\n    int32_t global_tid_51161;\n    int64_t phys_tid_44136;\n    int64_t global_tid_51166;\n    int64_t slice_51167;\n    int64_t gtid_44135;\n    int64_t remnant_51168;\n    \n    local_tid_51162 = get_local_id(0);\n    tblock_sizze_51165 = get_local_size(0);\n    wave_sizze_51164 = LOCKSTEP_WIDTH;\n    block_id_51163 = get_tblock_id(0);\n    global_tid_51161 = block_id_51163 * tblock_sizze_51165 + local_tid_51162;\n    phys_tid_44136 = sext_i32_i64(global_tid_51161);\n    global_tid_51166 = sext_i32_i64(block_id_51163) * segmap_tblock_sizze_44132 + sext_i32_i64(local_tid_51162);\n    slice_51167 = n_new_27039;\n    gtid_44135 = global_tid_51166;\n    remnant_51168 = global_tid_51166 - gtid_44135;\n    if (slt64(gtid_44135, n_new_27039)) {\n        bool eta_p_44137;\n        bool lifted_lambda_res_44140;\n        \n        eta_p_44137 = ((__global bool *) ext_mem_49560)[gtid_44135];\n        if (eta_p_44137) {\n            double eta_p_44138;\n            double eta_p_44139;\n            bool defunc_0_reduce_res_44141;\n            bool redout_49017;\n            \n            eta_p_44138 = ((__global double *) new_xs_mem_49401)[gtid_44135];\n            eta_p_44139 = ((__global double *) new_ys_mem_49402)[gtid_44135];\n            redout_49017 = 0;\n            for (int64_t i_49018 = 0; i_49018 < (int64_t) 8; i_49018++) {\n                int64_t eta_p_44142;\n                bool cond_44143;\n                bool lifted_lambda_res_44144;\n                bool defunc_0_op_res_44176;\n                bool redout_tmp_51169;\n                \n                eta_p_44142 = ((__global int64_t *) mem_49450)[i_49018];\n                cond_44143 = slt64(eta_p_44142, (int64_t) 0);\n                if (cond_4", "4143) {\n                    lifted_lambda_res_44144 = 0;\n                } else {\n                    int64_t zv_rhs_44145;\n                    bool zzero_44146;\n                    bool nonzzero_44147;\n                    bool nonzzero_cert_44148;\n                    int64_t nxid_44149;\n                    int64_t nyid_44150;\n                    double times_arg1_44151;\n                    double i64_res_44152;\n                    double zt_res_44153;\n                    double plus_arg0_44154;\n                    double zp_res_44155;\n                    double times_arg1_44156;\n                    double i64_res_44157;\n                    double zt_res_44158;\n                    double plus_arg0_44159;\n                    double zp_res_44160;\n                    double zp_res_44161;\n                    double zp_res_44162;\n                    double zm_res_44163;\n                    bool zgze_res_44164;\n                    double zp_res_44165;\n                    bool zlze_res_44166;\n                    bool x_44167;\n                    double zm_res_44168;\n                    bool zgze_res_44169;\n                    double zp_res_44170;\n                    bool zlze_res_44171;\n                    bool x_44172;\n                    bool x_44173;\n                    \n                    zv_rhs_44145 = ((__global int64_t *) clBase_mem_49378)[(int64_t) 0];\n                    zzero_44146 = zv_rhs_44145 == (int64_t) 0;\n                    nonzzero_44147 = !zzero_44146;\n                    if (!nonzzero_44147) {\n                        {\n                            if (atomic_cmpxchg_i32_global(global_failure, -1, 14) == -1) {\n                                ;\n                            }\n                            return;\n                        }\n                    }\n                    nxid_44149 = smod64(eta_p_44142, zv_rhs_44145);\n                    nyid_44150 = sdiv64(eta_p_44142, zv_rhs_44145);\n                    times_arg1_44151 = ((__global double *) clBas",
                                    "e_mem_49379)[(int64_t) 0];\n                    i64_res_44152 = sitofp_i64_f64(nxid_44149);\n                    zt_res_44153 = times_arg1_44151 * i64_res_44152;\n                    plus_arg0_44154 = ((__global double *) clBase_mem_49377)[(int64_t) 0];\n                    zp_res_44155 = zt_res_44153 + plus_arg0_44154;\n                    times_arg1_44156 = ((__global double *) clBase_mem_49379)[(int64_t) 1];\n                    i64_res_44157 = sitofp_i64_f64(nyid_44150);\n                    zt_res_44158 = times_arg1_44156 * i64_res_44157;\n                    plus_arg0_44159 = ((__global double *) clBase_mem_49377)[(int64_t) 1];\n                    zp_res_44160 = zt_res_44158 + plus_arg0_44159;\n                    zp_res_44161 = times_arg1_44151 + zp_res_44155;\n                    zp_res_44162 = times_arg1_44156 + zp_res_44160;\n                    zm_res_44163 = zp_res_44155 - clBase_27044;\n                    zgze_res_44164 = zm_res_44163 <= eta_p_44138;\n                    zp_res_44165 = clBase_27044 + zp_res_44161;\n                    zlze_res_44166 = eta_p_44138 <= zp_res_44165;\n                    x_44167 = zgze_res_44164 && zlze_res_44166;\n                    zm_res_44168 = zp_res_44160 - clBase_27044;\n                    zgze_res_44169 = zm_res_44168 <= eta_p_44139;\n                    zp_res_44170 = clBase_27044 + zp_res_44162;\n                    zlze_res_44171 = eta_p_44139 <= zp_res_44170;\n                    x_44172 = zgze_res_44169 && zlze_res_44171;\n                    x_44173 = x_44167 && x_44172;\n                    lifted_lambda_res_44144 = x_44173;\n                }\n                defunc_0_op_res_44176 = lifted_lambda_res_44144 || redout_49017;\n                redout_tmp_51169 = defunc_0_op_res_44176;\n                redout_49017 = redout_tmp_51169;\n            }\n            defunc_0_reduce_res_44141 = redout_49017;\n            lifted_lambda_res_44140 = defunc_0_reduce_res_44141;\n        } else {\n            lifted_lambda_res_44140 = 0;\n        }\n   ", "     ((__global bool *) mem_49562)[gtid_44135] = lifted_lambda_res_44140;\n    }\n    \n  error_0:\n    return;\n    #undef segmap_tblock_sizze_44132\n}\nFUTHARK_KERNEL_SIZED(add_next_partition_doublezisegmap_44186_dim1, 1, 1)\nvoid add_next_partition_doublezisegmap_44186(__global int *global_failure, int64_t n_old_27030, int64_t y_39124, int64_t num_tblocks_44191, int32_t virt_num_tblocks_50431, __global unsigned char *current_partition_mem_49386, __global unsigned char *current_partition_mem_49387, __global unsigned char *current_partition_mem_49388, __global unsigned char *current_partition_mem_49391, __global unsigned char *mem_49410, __global unsigned char *mem_49412, __global unsigned char *mem_49414, __global unsigned char *mem_49416, __global unsigned char *mem_49418, __global unsigned char *mem_49419, __global unsigned char *mem_49421)\n{\n    #define segmap_tblock_sizze_44189 (add_next_partition_doublezisegmap_44186zisegmap_tblock_sizze_44189)\n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_50433;\n    int32_t tblock_sizze_50436;\n    int32_t wave_sizze_50435;\n    int32_t block_id_50434;\n    int32_t global_tid_50432;\n    int64_t phys_tid_44186;\n    int32_t phys_tblock_id_50437;\n    int32_t iterations_50438;\n    \n    local_tid_50433 = get_local_id(0);\n    tblock_sizze_50436 = get_local_size(0);\n    wave_sizze_50435 = LOCKSTEP_WIDTH;\n    block_id_50434 = get_tblock_id(0);\n    global_tid_50432 = block_id_50434 * tblock_sizze_50436 + local_tid_50433;\n    phys_tid_44186 = sext_i32_i64(global_tid_50432);\n    phys_tblock_id_50437 = get_tblock_id(0);\n    iterations_50438 = sdiv_up32(virt_num_tblocks_50431 - phys_tblock_id_50437, sext_i64_i32(num_tblocks_44191));\n    for (int32_t i_50439 = 0; i_50439 < iterations_50438; i_50439++) {\n        int32_t virt_tblock_id_50440;\n        int64_t global_tid_50441;\n        int64_t slice_50442;\n        int64_t write_i_44185;\n        int64_t remnant_50443;\n        \n        virt_tblock_id_50440 = phys_tblock_id_50437", " + i_50439 * sext_i64_i32(num_tblocks_44191);\n        global_tid_50441 = sext_i32_i64(virt_tblock_id_50440) * segmap_tblock_sizze_44189 + sext_i32_i64(local_tid_50433);\n        slice_50442 = n_old_27030;\n        write_i_44185 = global_tid_50441;\n        remnant_50443 = global_tid_50441 - write_i_44185;\n        if (slt64(write_i_44185, n_old_27030)) {\n            int64_t c_39129;\n            int64_t offset_39130;\n            int64_t offset_39131;\n            double v_39132;\n            double v_39133;\n            bool v_39134;\n            int64_t v_39135;\n            bool is_this_one_39136;\n            bool is_this_one_39137;\n            int64_t this_offset_39138;\n            int64_t total_res_39139;\n            int64_t this_offset_39140;\n            int64_t total_res_39141;\n            \n            c_39129 = ((__global int64_t *) mem_49414)[write_i_44185];\n            offset_39130 = ((__global int64_t *) mem_49410)[write_i_44185];\n            offset_39131 = ((__global int64_t *) mem_49412)[write_i_44185];\n            v_39132 = ((__global double *) current_partition_mem_49387)[write_i_44185];\n            v_39133 = ((__global double *) current_partition_mem_49388)[write_i_44185];\n            v_39134 = ((__global bool *) current_partition_mem_49391)[write_i_44185];\n            v_39135 = ((__global int64_t *) current_partition_mem_49386)[write_i_44185];\n            is_this_one_39136 = c_39129 == (int64_t) 0;\n            is_this_one_39137 = c_39129 == (int64_t) 1;\n            this_offset_39138 = y_39124 + offset_39131;\n            if (is_this_one_39137) {\n                total_res_39139 = this_offset_39138;\n            } else {\n                total_res_39139 = (int64_t) -1;\n            }\n            this_offset_39140 = (int64_t) -1 + offset_39130;\n            if (is_this_one_39136) {\n                total_res_39141 = this_offset_39140;\n            } else {\n                total_res_39141 = total_res_39139;\n            }\n            if (sle64((int64_t) 0, total_res_39141",
                                    ") && slt64(total_res_39141, n_old_27030)) {\n                ((__global double *) mem_49416)[total_res_39141] = v_39132;\n            }\n            if (sle64((int64_t) 0, total_res_39141) && slt64(total_res_39141, n_old_27030)) {\n                ((__global double *) mem_49418)[total_res_39141] = v_39133;\n            }\n            if (sle64((int64_t) 0, total_res_39141) && slt64(total_res_39141, n_old_27030)) {\n                ((__global bool *) mem_49419)[total_res_39141] = v_39134;\n            }\n            if (sle64((int64_t) 0, total_res_39141) && slt64(total_res_39141, n_old_27030)) {\n                ((__global int64_t *) mem_49421)[total_res_39141] = v_39135;\n            }\n        }\n        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    }\n    \n  error_1:\n    return;\n    #undef segmap_tblock_sizze_44189\n}\nFUTHARK_KERNEL_SIZED(add_next_partition_doublezisegmap_44202_dim1, 1, 1)\nvoid add_next_partition_doublezisegmap_44202(__global int *global_failure, int64_t dzlz7bUZLzpZRz20Udz2082Uz20Udz2084Uz2088Uz2084Uz7dUzg_39167, int64_t y_39276, int64_t num_tblocks_44207, int32_t virt_num_tblocks_51170, __global unsigned char *mem_49442, __global unsigned char *mem_49565, __global unsigned char *mem_49567, __global unsigned char *mem_49569)\n{\n    #define segmap_tblock_sizze_44205 (add_next_partition_doublezisegmap_44202zisegmap_tblock_sizze_44205)\n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_51172;\n    int32_t tblock_sizze_51175;\n    int32_t wave_sizze_51174;\n    int32_t block_id_51173;\n    int32_t global_tid_51171;\n    int64_t phys_tid_44202;\n    int32_t phys_tblock_id_51176;\n    int32_t iterations_51177;\n    \n    local_tid_51172 = get_local_id(0);\n    tblock_sizze_51175 = get_local_size(0);\n    wave_sizze_51174 = LOCKSTEP_WIDTH;\n    block_id_51173 = get_tblock_id(0);\n    global_tid_51171 = block_id_51173 * tblock_sizze_51175 + local_tid_51172;\n    phys_tid_44202 = sext_i32_i64(global_tid_51171);\n    phys_tblock_id_51176 = get_tblock_id", "(0);\n    iterations_51177 = sdiv_up32(virt_num_tblocks_51170 - phys_tblock_id_51176, sext_i64_i32(num_tblocks_44207));\n    for (int32_t i_51178 = 0; i_51178 < iterations_51177; i_51178++) {\n        int32_t virt_tblock_id_51179;\n        int64_t global_tid_51180;\n        int64_t slice_51181;\n        int64_t write_i_44201;\n        int64_t remnant_51182;\n        \n        virt_tblock_id_51179 = phys_tblock_id_51176 + i_51178 * sext_i64_i32(num_tblocks_44207);\n        global_tid_51180 = sext_i32_i64(virt_tblock_id_51179) * segmap_tblock_sizze_44205 + sext_i32_i64(local_tid_51172);\n        slice_51181 = dzlz7bUZLzpZRz20Udz2082Uz20Udz2084Uz2088Uz2084Uz7dUzg_39167;\n        write_i_44201 = global_tid_51180;\n        remnant_51182 = global_tid_51180 - write_i_44201;\n        if (slt64(write_i_44201, dzlz7bUZLzpZRz20Udz2082Uz20Udz2084Uz2088Uz2084Uz7dUzg_39167)) {\n            int64_t c_39278;\n            int64_t offset_39279;\n            int64_t offset_39280;\n            bool is_this_one_39282;\n            bool is_this_one_39283;\n            int64_t this_offset_39284;\n            int64_t total_res_39285;\n            int64_t this_offset_39286;\n            int64_t total_res_39287;\n            \n            c_39278 = ((__global int64_t *) mem_49569)[write_i_44201];\n            offset_39279 = ((__global int64_t *) mem_49565)[write_i_44201];\n            offset_39280 = ((__global int64_t *) mem_49567)[write_i_44201];\n            is_this_one_39282 = c_39278 == (int64_t) 0;\n            is_this_one_39283 = c_39278 == (int64_t) 1;\n            this_offset_39284 = y_39276 + offset_39280;\n            if (is_this_one_39283) {\n                total_res_39285 = this_offset_39284;\n            } else {\n                total_res_39285 = (int64_t) -1;\n            }\n            this_offset_39286 = (int64_t) -1 + offset_39279;\n            if (is_this_one_39282) {\n                total_res_39287 = this_offset_39286;\n            } else {\n                total_res_39287 = total_res_39285;\n            }\n   ", "         if (sle64((int64_t) 0, total_res_39287) && slt64(total_res_39287, dzlz7bUZLzpZRz20Udz2082Uz20Udz2084Uz2088Uz2084Uz7dUzg_39167)) {\n                ((__global int64_t *) mem_49442)[total_res_39287] = write_i_44201;\n            }\n        }\n        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    }\n    \n  error_1:\n    return;\n    #undef segmap_tblock_sizze_44205\n}\nFUTHARK_KERNEL_SIZED(add_next_partition_doublezisegmap_44255_dim1, 1, 1)\nvoid add_next_partition_doublezisegmap_44255(__global int *global_failure, int failure_is_an_option, __global int64_t *global_failure_args, int64_t dz2080U_27033, int64_t dz2081U_27034, int64_t dz2082U_27035, int64_t dzlz7bUZLzpZRz20Udz2082Uz20Udz2084Uz2088Uz2084Uz7dUzg_39167, int64_t conc_tmp_39168, int64_t conc_tmp_39169, int64_t partition_sizze_39274, __global unsigned char *clProc_mem_49380, __global unsigned char *clProc_mem_49381, __global unsigned char *clProc_mem_49382, __global unsigned char *clProc_mem_49383, __global unsigned char *mem_49416, __global unsigned char *mem_49418, __global unsigned char *mem_49419, __global unsigned char *mem_49421, __global unsigned char *mem_49442, __global unsigned char *mem_49573, __global unsigned char *mem_49575, __global unsigned char *mem_49576, __global unsigned char *mem_49578)\n{\n    #define segmap_tblock_sizze_44248 (add_next_partition_doublezisegmap_44255zisegmap_tblock_sizze_44248)\n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_51185;\n    int32_t tblock_sizze_51188;\n    int32_t wave_sizze_51187;\n    int32_t block_id_51186;\n    int32_t global_tid_51184;\n    int64_t phys_tid_44255;\n    int64_t global_tid_51189;\n    int64_t slice_51190;\n    int64_t gtid_44254;\n    int64_t remnant_51191;\n    \n    local_tid_51185 = get_local_id(0);\n    tblock_sizze_51188 = get_local_size(0);\n    wave_sizze_51187 = LOCKSTEP_WIDTH;\n    block_id_51186 = get_tblock_id(0);\n    global_tid_51184 = block_id_51186 * tblock_sizze_51188 + local_tid_51185;\n    phys_tid_44255 =",
                                    " sext_i32_i64(global_tid_51184);\n    global_tid_51189 = sext_i32_i64(block_id_51186) * segmap_tblock_sizze_44248 + sext_i32_i64(local_tid_51185);\n    slice_51190 = partition_sizze_39274;\n    gtid_44254 = global_tid_51189;\n    remnant_51191 = global_tid_51189 - gtid_44254;\n    if (slt64(gtid_44254, partition_sizze_39274)) {\n        int64_t eta_p_44256;\n        bool x_44257;\n        bool y_44258;\n        bool bounds_check_44259;\n        bool index_certs_44260;\n        bool y_44270;\n        bool bounds_check_44271;\n        bool index_certs_44272;\n        bool y_44278;\n        bool bounds_check_44279;\n        bool index_certs_44280;\n        bool index_concat_cmp_44261;\n        double index_concat_branch_44262;\n        double index_concat_branch_44266;\n        bool index_concat_cmp_44273;\n        bool index_concat_branch_44274;\n        bool index_concat_cmp_44281;\n        int64_t index_concat_branch_44282;\n        \n        eta_p_44256 = ((__global int64_t *) mem_49442)[gtid_44254];\n        x_44257 = sle64((int64_t) 0, eta_p_44256);\n        y_44258 = slt64(eta_p_44256, dzlz7bUZLzpZRz20Udz2082Uz20Udz2084Uz2088Uz2084Uz7dUzg_39167);\n        bounds_check_44259 = x_44257 && y_44258;\n        if (!bounds_check_44259) {\n            {\n                if (atomic_cmpxchg_i32_global(global_failure, -1, 15) == -1) {\n                    global_failure_args[0] = (int64_t) eta_p_44256;\n                    global_failure_args[1] = (int64_t) dzlz7bUZLzpZRz20Udz2082Uz20Udz2084Uz2088Uz2084Uz7dUzg_39167;\n                    ;\n                }\n                return;\n            }\n        }\n        y_44270 = slt64(eta_p_44256, conc_tmp_39168);\n        bounds_check_44271 = x_44257 && y_44270;\n        if (!bounds_check_44271) {\n            {\n                if (atomic_cmpxchg_i32_global(global_failure, -1, 16) == -1) {\n                    global_failure_args[0] = (int64_t) eta_p_44256;\n                    global_failure_args[1] = (int64_t) conc_tmp_39168;\n                    ;\n                }", "\n                return;\n            }\n        }\n        y_44278 = slt64(eta_p_44256, conc_tmp_39169);\n        bounds_check_44279 = x_44257 && y_44278;\n        if (!bounds_check_44279) {\n            {\n                if (atomic_cmpxchg_i32_global(global_failure, -1, 17) == -1) {\n                    global_failure_args[0] = (int64_t) eta_p_44256;\n                    global_failure_args[1] = (int64_t) conc_tmp_39169;\n                    ;\n                }\n                return;\n            }\n        }\n        index_concat_cmp_44261 = sle64(dz2082U_27035, eta_p_44256);\n        if (index_concat_cmp_44261) {\n            int64_t index_concat_i_44263;\n            double index_concat_44264;\n            \n            index_concat_i_44263 = sub64(eta_p_44256, dz2082U_27035);\n            index_concat_44264 = ((__global double *) mem_49416)[index_concat_i_44263];\n            index_concat_branch_44262 = index_concat_44264;\n        } else {\n            double index_concat_44265 = ((__global double *) clProc_mem_49382)[eta_p_44256];\n            \n            index_concat_branch_44262 = index_concat_44265;\n        }\n        if (index_concat_cmp_44261) {\n            int64_t index_concat_i_44267;\n            double index_concat_44268;\n            \n            index_concat_i_44267 = sub64(eta_p_44256, dz2082U_27035);\n            index_concat_44268 = ((__global double *) mem_49418)[index_concat_i_44267];\n            index_concat_branch_44266 = index_concat_44268;\n        } else {\n            double index_concat_44269 = ((__global double *) clProc_mem_49383)[eta_p_44256];\n            \n            index_concat_branch_44266 = index_concat_44269;\n        }\n        index_concat_cmp_44273 = sle64(dz2080U_27033, eta_p_44256);\n        if (index_concat_cmp_44273) {\n            int64_t index_concat_i_44275;\n            bool index_concat_44276;\n            \n            index_concat_i_44275 = sub64(eta_p_44256, dz2080U_27033);\n            index_concat_44276 = ((__global bool *) mem_49419)[index_co", "ncat_i_44275];\n            index_concat_branch_44274 = index_concat_44276;\n        } else {\n            bool index_concat_44277 = ((__global bool *) clProc_mem_49380)[eta_p_44256];\n            \n            index_concat_branch_44274 = index_concat_44277;\n        }\n        index_concat_cmp_44281 = sle64(dz2081U_27034, eta_p_44256);\n        if (index_concat_cmp_44281) {\n            int64_t index_concat_i_44283;\n            int64_t index_concat_44284;\n            \n            index_concat_i_44283 = sub64(eta_p_44256, dz2081U_27034);\n            index_concat_44284 = ((__global int64_t *) mem_49421)[index_concat_i_44283];\n            index_concat_branch_44282 = index_concat_44284;\n        } else {\n            int64_t index_concat_44285 = ((__global int64_t *) clProc_mem_49381)[eta_p_44256];\n            \n            index_concat_branch_44282 = index_concat_44285;\n        }\n        ((__global double *) mem_49573)[gtid_44254] = index_concat_branch_44262;\n        ((__global double *) mem_49575)[gtid_44254] = index_concat_branch_44266;\n        ((__global bool *) mem_49576)[gtid_44254] = index_concat_branch_44274;\n        ((__global int64_t *) mem_49578)[gtid_44254] = index_concat_branch_44282;\n    }\n    \n  error_0:\n    return;\n    #undef segmap_tblock_sizze_44248\n}\nFUTHARK_KERNEL_SIZED(add_next_partition_doublezisegmap_44323_dim1, 1, 1)\nvoid add_next_partition_doublezisegmap_44323(__global int *global_failure, int failure_is_an_option, __global int64_t *global_failure_args, int64_t dz2081U_27034, int64_t dz2082U_27035, int64_t j_m_i_39153, int64_t dzlz7bUZLzpZRz20Udz2082Uz20Udz2084Uz2088Uz2084Uz7dUzg_39167, int64_t conc_tmp_39169, int64_t partition_sizze_39274, int64_t j_m_i_39300, __global unsigned char *clProc_mem_49381, __global unsigned char *clProc_mem_49382, __global unsigned char *clProc_mem_49383, __global unsigned char *mem_49416, __global unsigned char *mem_49418, __global unsigned char *mem_49421, __global unsigned char *mem_49442, __global unsigned char *mem_49587,",
                                    " __global unsigned char *mem_49589, __global unsigned char *mem_49591)\n{\n    #define segmap_tblock_sizze_44317 (add_next_partition_doublezisegmap_44323zisegmap_tblock_sizze_44317)\n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_51194;\n    int32_t tblock_sizze_51197;\n    int32_t wave_sizze_51196;\n    int32_t block_id_51195;\n    int32_t global_tid_51193;\n    int64_t phys_tid_44323;\n    int64_t global_tid_51198;\n    int64_t slice_51199;\n    int64_t gtid_44322;\n    int64_t remnant_51200;\n    \n    local_tid_51194 = get_local_id(0);\n    tblock_sizze_51197 = get_local_size(0);\n    wave_sizze_51196 = LOCKSTEP_WIDTH;\n    block_id_51195 = get_tblock_id(0);\n    global_tid_51193 = block_id_51195 * tblock_sizze_51197 + local_tid_51194;\n    phys_tid_44323 = sext_i32_i64(global_tid_51193);\n    global_tid_51198 = sext_i32_i64(block_id_51195) * segmap_tblock_sizze_44317 + sext_i32_i64(local_tid_51194);\n    slice_51199 = j_m_i_39300;\n    gtid_44322 = global_tid_51198;\n    remnant_51200 = global_tid_51198 - gtid_44322;\n    if (slt64(gtid_44322, j_m_i_39300)) {\n        int64_t slice_46424;\n        int64_t eta_p_44324;\n        bool x_44325;\n        bool y_44326;\n        bool bounds_check_44327;\n        bool index_certs_44328;\n        bool y_44338;\n        bool bounds_check_44339;\n        bool index_certs_44340;\n        bool index_concat_cmp_44329;\n        double index_concat_branch_44330;\n        double index_concat_branch_44334;\n        bool index_concat_cmp_44341;\n        int64_t index_concat_branch_44342;\n        \n        slice_46424 = partition_sizze_39274 + gtid_44322;\n        eta_p_44324 = ((__global int64_t *) mem_49442)[slice_46424];\n        x_44325 = sle64((int64_t) 0, eta_p_44324);\n        y_44326 = slt64(eta_p_44324, dzlz7bUZLzpZRz20Udz2082Uz20Udz2084Uz2088Uz2084Uz7dUzg_39167);\n        bounds_check_44327 = x_44325 && y_44326;\n        if (!bounds_check_44327) {\n            {\n                if (atomic_cmpxchg_i32_global(global_failure, -1, 18) == -1) {", "\n                    global_failure_args[0] = (int64_t) eta_p_44324;\n                    global_failure_args[1] = (int64_t) dzlz7bUZLzpZRz20Udz2082Uz20Udz2084Uz2088Uz2084Uz7dUzg_39167;\n                    ;\n                }\n                return;\n            }\n        }\n        y_44338 = slt64(eta_p_44324, conc_tmp_39169);\n        bounds_check_44339 = x_44325 && y_44338;\n        if (!bounds_check_44339) {\n            {\n                if (atomic_cmpxchg_i32_global(global_failure, -1, 19) == -1) {\n                    global_failure_args[0] = (int64_t) eta_p_44324;\n                    global_failure_args[1] = (int64_t) conc_tmp_39169;\n                    ;\n                }\n                return;\n            }\n        }\n        index_concat_cmp_44329 = sle64(dz2082U_27035, eta_p_44324);\n        if (index_concat_cmp_44329) {\n            int64_t index_concat_i_44331;\n            double index_concat_44332;\n            \n            index_concat_i_44331 = sub64(eta_p_44324, dz2082U_27035);\n            index_concat_44332 = ((__global double *) mem_49416)[index_concat_i_44331];\n            index_concat_branch_44330 = index_concat_44332;\n        } else {\n            double index_concat_44333 = ((__global double *) clProc_mem_49382)[eta_p_44324];\n            \n            index_concat_branch_44330 = index_concat_44333;\n        }\n        if (index_concat_cmp_44329) {\n            int64_t index_concat_i_44335;\n            double index_concat_44336;\n            \n            index_concat_i_44335 = sub64(eta_p_44324, dz2082U_27035);\n            index_concat_44336 = ((__global double *) mem_49418)[index_concat_i_44335];\n            index_concat_branch_44334 = index_concat_44336;\n        } else {\n            double index_concat_44337 = ((__global double *) clProc_mem_49383)[eta_p_44324];\n            \n            index_concat_branch_44334 = index_concat_44337;\n        }\n        index_concat_cmp_44341 = sle64(dz2081U_27034, eta_p_44324);\n        if (index_concat_cmp_44341) {\n         ", "   int64_t index_concat_i_44343;\n            int64_t index_concat_44344;\n            \n            index_concat_i_44343 = sub64(eta_p_44324, dz2081U_27034);\n            index_concat_44344 = ((__global int64_t *) mem_49421)[index_concat_i_44343];\n            index_concat_branch_44342 = index_concat_44344;\n        } else {\n            int64_t index_concat_44345 = ((__global int64_t *) clProc_mem_49381)[eta_p_44324];\n            \n            index_concat_branch_44342 = index_concat_44345;\n        }\n        ((__global double *) mem_49587)[j_m_i_39153 + gtid_44322] = index_concat_branch_44330;\n        ((__global double *) mem_49589)[j_m_i_39153 + gtid_44322] = index_concat_branch_44334;\n        ((__global int64_t *) mem_49591)[j_m_i_39153 + gtid_44322] = index_concat_branch_44342;\n    }\n    \n  error_0:\n    return;\n    #undef segmap_tblock_sizze_44317\n}\nFUTHARK_KERNEL\nvoid add_next_partition_doublezisegmap_intrablock_43720(__global int *global_failure, int failure_is_an_option, __global int64_t *global_failure_args, int64_t dz2083U_27036, int64_t n_new_27039, double clBase_27044, int64_t computed_tblock_sizze_43641, __global unsigned char *clBase_mem_49377, __global unsigned char *clBase_mem_49378, __global unsigned char *clBase_mem_49379, __global unsigned char *clProc_mem_49385, __global unsigned char *new_xs_mem_49401, __global unsigned char *new_ys_mem_49402, __global unsigned char *mem_49450, __global unsigned char *mem_49463, __global unsigned char *mem_49474, __global unsigned char *mem_49475)\n{\n    volatile __local unsigned char *red_arr_mem_50659_backing_1 = &shared_mem[0];\n    const int64_t red_arr_mem_50659_backing_1_offset = 0 + (n_new_27039 + srem64((int64_t) 8 - srem64(n_new_27039, (int64_t) 8), (int64_t) 8));\n    volatile __local unsigned char *red_arr_mem_50655_backing_0 = &shared_mem[red_arr_mem_50659_backing_1_offset];\n    const int64_t red_arr_mem_50655_backing_0_offset = red_arr_mem_50659_backing_1_offset + (dz2083U_27036 + srem64((int64_t) 8 - srem64(d",
                                    "z2083U_27036, (int64_t) 8), (int64_t) 8));\n    volatile __local int local_failure;\n    \n    if (failure_is_an_option) {\n        int failed = *global_failure >= 0;\n        \n        if (failed)\n            return;\n    }\n    local_failure = 0;\n    barrier(CLK_LOCAL_MEM_FENCE);\n    \n    int32_t local_tid_50643;\n    int32_t tblock_sizze_50646;\n    int32_t wave_sizze_50645;\n    int32_t block_id_50644;\n    int32_t global_tid_50642;\n    int64_t phys_tblock_id_43720;\n    int64_t slice_50648;\n    int64_t ltid_pre_50647;\n    int64_t remnant_50649;\n    int64_t slice_50651;\n    int64_t ltid_pre_50650;\n    int64_t remnant_50652;\n    int64_t slice_50653;\n    int64_t gtid_43719;\n    int64_t remnant_50654;\n    int64_t eta_p_43721;\n    bool x_43722;\n    bool y_43723;\n    bool bounds_check_43724;\n    bool index_certs_43725;\n    bool cond_43726;\n    int64_t lifted_lambda_res_43727;\n    bool not_p_43728;\n    bool defunc_0_reduce_res_43729;\n    int64_t phys_tid_43731;\n    __local unsigned char *red_arr_mem_50655;\n    int64_t gtid_43730;\n    int32_t offset_50657;\n    int32_t skip_waves_50658;\n    bool eta_p_43732;\n    bool eta_p_43733;\n    int64_t lifted_lambda_res_43741;\n    bool cond_43742;\n    int64_t lifted_lambda_res_43743;\n    bool lifted_lambda_res_43744;\n    int64_t defunc_0_f_res_43782;\n    \n    local_tid_50643 = get_local_id(0);\n    tblock_sizze_50646 = get_local_size(0);\n    wave_sizze_50645 = LOCKSTEP_WIDTH;\n    block_id_50644 = get_tblock_id(0);\n    global_tid_50642 = block_id_50644 * tblock_sizze_50646 + local_tid_50643;\n    phys_tblock_id_43720 = sext_i32_i64(block_id_50644);\n    slice_50648 = dz2083U_27036;\n    ltid_pre_50647 = sext_i32_i64(local_tid_50643);\n    remnant_50649 = sext_i32_i64(local_tid_50643) - ltid_pre_50647;\n    slice_50651 = n_new_27039;\n    ltid_pre_50650 = sext_i32_i64(local_tid_50643);\n    remnant_50652 = sext_i32_i64(local_tid_50643) - ltid_pre_50650;\n    slice_50653 = (int64_t) 8;\n    gtid_43719 = sext_i32_i64(block_id_50644);\n    remnant_50654 = sex", "t_i32_i64(block_id_50644) - gtid_43719;\n    eta_p_43721 = ((__global int64_t *) mem_49450)[gtid_43719];\n    x_43722 = sle64((int64_t) 0, eta_p_43721);\n    y_43723 = slt64(eta_p_43721, (int64_t) 8);\n    bounds_check_43724 = x_43722 && y_43723;\n    if (!bounds_check_43724) {\n        {\n            if (atomic_cmpxchg_i32_global(global_failure, -1, 5) == -1) {\n                global_failure_args[0] = (int64_t) eta_p_43721;\n                global_failure_args[1] = (int64_t) (int64_t) 8;\n                ;\n            }\n            local_failure = 1;\n            goto error_0;\n        }\n    }\n    cond_43726 = ((__global bool *) mem_49463)[eta_p_43721];\n    \n  error_0:\n    barrier(CLK_LOCAL_MEM_FENCE);\n    if (local_failure)\n        return;\n    barrier(CLK_LOCAL_MEM_FENCE);\n    if (cond_43726) {\n        lifted_lambda_res_43727 = (int64_t) -1;\n    } else {\n        lifted_lambda_res_43727 = eta_p_43721;\n    }\n    not_p_43728 = !cond_43726;\n    phys_tid_43731 = sext_i32_i64(local_tid_50643);\n    red_arr_mem_50655 = (__local unsigned char *) red_arr_mem_50655_backing_0;\n    gtid_43730 = sext_i32_i64(sext_i64_i32(ltid_pre_50647));\n    if (slt64(gtid_43730, dz2083U_27036)) {\n        int64_t eta_p_43735;\n        bool eq_x_y_43736;\n        bool eq_x_zz_43737;\n        bool p_and_eq_x_y_43738;\n        bool p_and_eq_x_y_43739;\n        bool lifted_lambda_res_43740;\n        \n        eta_p_43735 = ((__global int64_t *) clProc_mem_49385)[gtid_43730];\n        eq_x_y_43736 = eta_p_43735 == (int64_t) -1;\n        eq_x_zz_43737 = eta_p_43735 == eta_p_43721;\n        p_and_eq_x_y_43738 = cond_43726 && eq_x_y_43736;\n        p_and_eq_x_y_43739 = not_p_43728 && eq_x_zz_43737;\n        lifted_lambda_res_43740 = p_and_eq_x_y_43738 || p_and_eq_x_y_43739;\n        ((__local bool *) red_arr_mem_50655)[gtid_43730] = lifted_lambda_res_43740;\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    skip_waves_50658 = 1;\n    offset_50657 = 0;\n    // participating threads read initial accumulator\n    {\n        if (slt32(loca", "l_tid_50643, sext_i64_i32(dz2083U_27036))) {\n            eta_p_43732 = ((__local bool *) red_arr_mem_50655)[sext_i32_i64(local_tid_50643 + offset_50657)];\n        }\n    }\n    offset_50657 = 1;\n    while (slt32(offset_50657, wave_sizze_50645)) {\n        if (slt32(local_tid_50643 + offset_50657, sext_i64_i32(dz2083U_27036)) && ((local_tid_50643 - squot32(local_tid_50643, wave_sizze_50645) * wave_sizze_50645) & (2 * offset_50657 - 1)) == 0) {\n            // read array element\n            {\n                eta_p_43733 = ((volatile __local bool *) red_arr_mem_50655)[sext_i32_i64(local_tid_50643 + offset_50657)];\n            }\n            // apply reduction operation\n            {\n                bool defunc_0_op_res_43734 = eta_p_43732 || eta_p_43733;\n                \n                eta_p_43732 = defunc_0_op_res_43734;\n            }\n            // write result of operation\n            {\n                ((volatile __local bool *) red_arr_mem_50655)[sext_i32_i64(local_tid_50643)] = eta_p_43732;\n            }\n        }\n        offset_50657 *= 2;\n    }\n    while (slt32(skip_waves_50658, squot32(sext_i64_i32(computed_tblock_sizze_43641) + wave_sizze_50645 - 1, wave_sizze_50645))) {\n        barrier(CLK_LOCAL_MEM_FENCE);\n        offset_50657 = skip_waves_50658 * wave_sizze_50645;\n        if (slt32(local_tid_50643 + offset_50657, sext_i64_i32(dz2083U_27036)) && ((local_tid_50643 - squot32(local_tid_50643, wave_sizze_50645) * wave_sizze_50645) == 0 && (squot32(local_tid_50643, wave_sizze_50645) & (2 * skip_waves_50658 - 1)) == 0)) {\n            // read array element\n            {\n                eta_p_43733 = ((__local bool *) red_arr_mem_50655)[sext_i32_i64(local_tid_50643 + offset_50657)];\n            }\n            // apply reduction operation\n            {\n                bool defunc_0_op_res_43734 = eta_p_43732 || eta_p_43733;\n                \n                eta_p_43732 = defunc_0_op_res_43734;\n            }\n            // write result of operation\n            {\n           ",
                                    "     ((__local bool *) red_arr_mem_50655)[sext_i32_i64(local_tid_50643)] = eta_p_43732;\n            }\n        }\n        skip_waves_50658 *= 2;\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // Save result of reduction.\n    {\n        defunc_0_reduce_res_43729 = ((__local bool *) red_arr_mem_50655)[(int64_t) 0];\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    barrier(CLK_LOCAL_MEM_FENCE);\n    if (defunc_0_reduce_res_43729) {\n        lifted_lambda_res_43741 = (int64_t) -1;\n    } else {\n        lifted_lambda_res_43741 = lifted_lambda_res_43727;\n    }\n    cond_43742 = slt64(lifted_lambda_res_43741, (int64_t) 0);\n    barrier(CLK_LOCAL_MEM_FENCE);\n    if (cond_43742) {\n        lifted_lambda_res_43743 = (int64_t) -1;\n    } else {\n        lifted_lambda_res_43743 = lifted_lambda_res_43741;\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    if (cond_43742) {\n        lifted_lambda_res_43744 = 0;\n    } else {\n        int64_t zv_rhs_43745;\n        bool zzero_43746;\n        bool nonzzero_43747;\n        bool nonzzero_cert_43748;\n        int64_t nxid_43749;\n        int64_t nyid_43750;\n        double times_arg1_43751;\n        double i64_res_43752;\n        double zt_res_43753;\n        double plus_arg0_43754;\n        double zp_res_43755;\n        double times_arg1_43756;\n        double i64_res_43757;\n        double zt_res_43758;\n        double plus_arg0_43759;\n        double zp_res_43760;\n        double zp_res_43761;\n        double zp_res_43762;\n        double zm_res_43763;\n        double zp_res_43764;\n        double zm_res_43765;\n        double zp_res_43766;\n        bool defunc_0_reduce_res_43767;\n        int64_t phys_tid_43769;\n        __local unsigned char *red_arr_mem_50659;\n        int64_t gtid_43768;\n        int32_t offset_50661;\n        int32_t skip_waves_50662;\n        bool eta_p_43770;\n        bool eta_p_43771;\n        \n        zv_rhs_43745 = ((__global int64_t *) clBase_mem_49378)[(int64_t) 0];\n        zzero_43746 = zv_rhs_43745 == (int64_t) 0;\n        nonz", "zero_43747 = !zzero_43746;\n        if (!nonzzero_43747) {\n            {\n                if (atomic_cmpxchg_i32_global(global_failure, -1, 6) == -1) {\n                    ;\n                }\n                local_failure = 1;\n                goto error_8;\n            }\n        }\n        nxid_43749 = smod64(lifted_lambda_res_43741, zv_rhs_43745);\n        nyid_43750 = sdiv64(lifted_lambda_res_43741, zv_rhs_43745);\n        times_arg1_43751 = ((__global double *) clBase_mem_49379)[(int64_t) 0];\n        i64_res_43752 = sitofp_i64_f64(nxid_43749);\n        zt_res_43753 = times_arg1_43751 * i64_res_43752;\n        plus_arg0_43754 = ((__global double *) clBase_mem_49377)[(int64_t) 0];\n        zp_res_43755 = zt_res_43753 + plus_arg0_43754;\n        times_arg1_43756 = ((__global double *) clBase_mem_49379)[(int64_t) 1];\n        i64_res_43757 = sitofp_i64_f64(nyid_43750);\n        zt_res_43758 = times_arg1_43756 * i64_res_43757;\n        plus_arg0_43759 = ((__global double *) clBase_mem_49377)[(int64_t) 1];\n        zp_res_43760 = zt_res_43758 + plus_arg0_43759;\n        zp_res_43761 = times_arg1_43751 + zp_res_43755;\n        zp_res_43762 = times_arg1_43756 + zp_res_43760;\n        zm_res_43763 = zp_res_43755 - clBase_27044;\n        zp_res_43764 = clBase_27044 + zp_res_43761;\n        zm_res_43765 = zp_res_43760 - clBase_27044;\n        zp_res_43766 = clBase_27044 + zp_res_43762;\n        phys_tid_43769 = sext_i32_i64(local_tid_50643);\n        red_arr_mem_50659 = (__local unsigned char *) red_arr_mem_50659_backing_1;\n        gtid_43768 = sext_i32_i64(sext_i64_i32(ltid_pre_50650));\n        if (slt64(gtid_43768, n_new_27039)) {\n            double eta_p_43773;\n            double eta_p_43774;\n            bool zgze_res_43775;\n            bool zlze_res_43776;\n            bool x_43777;\n            bool zgze_res_43778;\n            bool zlze_res_43779;\n            bool x_43780;\n            bool x_43781;\n            \n            eta_p_43773 = ((__global double *) new_xs_mem_49401)[gtid_43768];\n    ", "        eta_p_43774 = ((__global double *) new_ys_mem_49402)[gtid_43768];\n            zgze_res_43775 = zm_res_43763 <= eta_p_43773;\n            zlze_res_43776 = eta_p_43773 <= zp_res_43764;\n            x_43777 = zgze_res_43775 && zlze_res_43776;\n            zgze_res_43778 = zm_res_43765 <= eta_p_43774;\n            zlze_res_43779 = eta_p_43774 <= zp_res_43766;\n            x_43780 = zgze_res_43778 && zlze_res_43779;\n            x_43781 = x_43777 && x_43780;\n            ((__local bool *) red_arr_mem_50659)[gtid_43768] = x_43781;\n        }\n        \n      error_8:\n        barrier(CLK_LOCAL_MEM_FENCE);\n        if (local_failure)\n            return;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        skip_waves_50662 = 1;\n        offset_50661 = 0;\n        // participating threads read initial accumulator\n        {\n            if (slt32(local_tid_50643, sext_i64_i32(n_new_27039))) {\n                eta_p_43770 = ((__local bool *) red_arr_mem_50659)[sext_i32_i64(local_tid_50643 + offset_50661)];\n            }\n        }\n        offset_50661 = 1;\n        while (slt32(offset_50661, wave_sizze_50645)) {\n            if (slt32(local_tid_50643 + offset_50661, sext_i64_i32(n_new_27039)) && ((local_tid_50643 - squot32(local_tid_50643, wave_sizze_50645) * wave_sizze_50645) & (2 * offset_50661 - 1)) == 0) {\n                // read array element\n                {\n                    eta_p_43771 = ((volatile __local bool *) red_arr_mem_50659)[sext_i32_i64(local_tid_50643 + offset_50661)];\n                }\n                // apply reduction operation\n                {\n                    bool defunc_0_op_res_43772 = eta_p_43770 || eta_p_43771;\n                    \n                    eta_p_43770 = defunc_0_op_res_43772;\n                }\n                // write result of operation\n                {\n                    ((volatile __local bool *) red_arr_mem_50659)[sext_i32_i64(local_tid_50643)] = eta_p_43770;\n                }\n            }\n            offset_50661 *= 2;\n        }\n        whil",
                                    "e (slt32(skip_waves_50662, squot32(sext_i64_i32(computed_tblock_sizze_43641) + wave_sizze_50645 - 1, wave_sizze_50645))) {\n            barrier(CLK_LOCAL_MEM_FENCE);\n            offset_50661 = skip_waves_50662 * wave_sizze_50645;\n            if (slt32(local_tid_50643 + offset_50661, sext_i64_i32(n_new_27039)) && ((local_tid_50643 - squot32(local_tid_50643, wave_sizze_50645) * wave_sizze_50645) == 0 && (squot32(local_tid_50643, wave_sizze_50645) & (2 * skip_waves_50662 - 1)) == 0)) {\n                // read array element\n                {\n                    eta_p_43771 = ((__local bool *) red_arr_mem_50659)[sext_i32_i64(local_tid_50643 + offset_50661)];\n                }\n                // apply reduction operation\n                {\n                    bool defunc_0_op_res_43772 = eta_p_43770 || eta_p_43771;\n                    \n                    eta_p_43770 = defunc_0_op_res_43772;\n                }\n                // write result of operation\n                {\n                    ((__local bool *) red_arr_mem_50659)[sext_i32_i64(local_tid_50643)] = eta_p_43770;\n                }\n            }\n            skip_waves_50662 *= 2;\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        barrier(CLK_LOCAL_MEM_FENCE);\n        // Save result of reduction.\n        {\n            defunc_0_reduce_res_43767 = ((__local bool *) red_arr_mem_50659)[(int64_t) 0];\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        lifted_lambda_res_43744 = defunc_0_reduce_res_43767;\n    }\n    defunc_0_f_res_43782 = btoi_bool_i64(lifted_lambda_res_43744);\n    if (local_tid_50643 == 0) {\n        ((__global int64_t *) mem_49474)[gtid_43719] = defunc_0_f_res_43782;\n    }\n    if (local_tid_50643 == 0) {\n        ((__global int64_t *) mem_49475)[gtid_43719] = lifted_lambda_res_43743;\n    }\n    \n  error_12:\n    return;\n}\nFUTHARK_KERNEL_SIZED(add_next_partition_doublezisegmap_intrablock_46535_dim1, 1, 1)\nvoid add_next_partition_doublezisegmap_intrablock_46535(__global int *global_failure, int failure_", "is_an_option, __global int64_t *global_failure_args, int64_t dz2083U_27036, int64_t n_new_27039, double clBase_27044, int64_t num_whole_tiles_46568, int64_t residual_input_46669, unsigned char cond_46670_bits, int64_t binop_x_46680, __global unsigned char *clBase_mem_49377, __global unsigned char *clBase_mem_49378, __global unsigned char *clBase_mem_49379, __global unsigned char *clProc_mem_49385, __global unsigned char *new_xs_mem_49401, __global unsigned char *new_ys_mem_49402, __global unsigned char *mem_49450, __global unsigned char *mem_49463, __global unsigned char *mem_49513, __global unsigned char *mem_49514)\n{\n    bool cond_46670 = cond_46670_bits;\n    \n    #define tile_sizze_46537 (add_next_partition_doublezisegmap_intrablock_46535zitile_sizze_46537)\n    #define ldim_46538 (add_next_partition_doublezisegmap_intrablock_46535zildim_46538)\n    #define bytes_49493 (add_next_partition_doublezisegmap_intrablock_46535zibytes_49493)\n    \n    volatile __local unsigned char *color_50172_backing_0 = &shared_mem[0];\n    const int64_t color_50172_backing_0_offset = 0 + (bytes_49493 + srem64((int64_t) 8 - srem64(bytes_49493, (int64_t) 8), (int64_t) 8));\n    volatile __local int local_failure;\n    \n    if (failure_is_an_option) {\n        int failed = *global_failure >= 0;\n        \n        if (failed)\n            return;\n    }\n    local_failure = 0;\n    barrier(CLK_LOCAL_MEM_FENCE);\n    \n    int32_t local_tid_50623;\n    int32_t tblock_sizze_50626;\n    int32_t wave_sizze_50625;\n    int32_t block_id_50624;\n    int32_t global_tid_50622;\n    int64_t gid_flat_46535;\n    int64_t slice_50628;\n    int64_t ltid_pre_50627;\n    int64_t remnant_50629;\n    int64_t slice_50630;\n    int64_t gid_46534;\n    int64_t remnant_50631;\n    __local unsigned char *color_50172;\n    int64_t binop_x_46549;\n    int64_t mem_49482[1];\n    bool mem_49485[1];\n    bool mem_49488[1];\n    int64_t ltid_flat_46540;\n    int64_t ltid_46539;\n    int64_t gtid_46550;\n    bool cond_46551;\n    int64_t pre_46552;\n   ", " bool pre_46553;\n    bool pre_46554;\n    bool mem_49491[1];\n    int64_t ltid_flat_46570;\n    int64_t ltid_46569;\n    bool ext_mem_49498[1];\n    bool mem_param_49492[1];\n    bool mem_49503[1];\n    bool ext_mem_49504[1];\n    int64_t mem_49508[1];\n    int64_t mem_49512[1];\n    int64_t ltid_flat_46721;\n    int64_t ltid_46720;\n    int64_t gtid_46729;\n    bool cond_46731;\n    int64_t postlude_46732;\n    int64_t postlude_46733;\n    \n    local_tid_50623 = get_local_id(0);\n    tblock_sizze_50626 = get_local_size(0);\n    wave_sizze_50625 = LOCKSTEP_WIDTH;\n    block_id_50624 = get_tblock_id(0);\n    global_tid_50622 = block_id_50624 * tblock_sizze_50626 + local_tid_50623;\n    gid_flat_46535 = sext_i32_i64(block_id_50624);\n    slice_50628 = tile_sizze_46537;\n    ltid_pre_50627 = sext_i32_i64(local_tid_50623);\n    remnant_50629 = sext_i32_i64(local_tid_50623) - ltid_pre_50627;\n    slice_50630 = ldim_46538;\n    gid_46534 = sext_i32_i64(block_id_50624);\n    remnant_50631 = sext_i32_i64(block_id_50624) - gid_46534;\n    color_50172 = (__local unsigned char *) color_50172_backing_0;\n    binop_x_46549 = gid_46534 * tile_sizze_46537;\n    ltid_flat_46540 = sext_i32_i64(local_tid_50623);\n    ltid_46539 = sext_i32_i64(sext_i64_i32(ltid_pre_50627));\n    gtid_46550 = ltid_46539 + binop_x_46549;\n    cond_46551 = slt64(gtid_46550, (int64_t) 8);\n    if (cond_46551) {\n        int64_t eta_p_46555;\n        bool x_46556;\n        bool y_46557;\n        bool bounds_check_46558;\n        bool index_certs_46559;\n        bool cond_46560;\n        bool not_p_46561;\n        \n        eta_p_46555 = ((__global int64_t *) mem_49450)[gtid_46550];\n        x_46556 = sle64((int64_t) 0, eta_p_46555);\n        y_46557 = slt64(eta_p_46555, (int64_t) 8);\n        bounds_check_46558 = x_46556 && y_46557;\n        if (!bounds_check_46558) {\n            {\n                if (atomic_cmpxchg_i32_global(global_failure, -1, 3) == -1) {\n                    global_failure_args[0] = (int64_t) eta_p_46555;\n                    global_",
                                    "failure_args[1] = (int64_t) (int64_t) 8;\n                    ;\n                }\n                local_failure = 1;\n                goto error_0;\n            }\n        }\n        cond_46560 = ((__global bool *) mem_49463)[eta_p_46555];\n        not_p_46561 = !cond_46560;\n        pre_46552 = eta_p_46555;\n        pre_46553 = cond_46560;\n        pre_46554 = not_p_46561;\n    } else {\n        pre_46552 = (int64_t) 0;\n        pre_46553 = 0;\n        pre_46554 = 0;\n    }\n    mem_49482[(int64_t) 0] = pre_46552;\n    mem_49485[(int64_t) 0] = pre_46553;\n    mem_49488[(int64_t) 0] = pre_46554;\n    \n  error_0:\n    barrier(CLK_LOCAL_MEM_FENCE);\n    if (local_failure)\n        return;\n    barrier(CLK_LOCAL_MEM_FENCE);\n    ltid_flat_46570 = sext_i32_i64(local_tid_50623);\n    ltid_46569 = sext_i32_i64(sext_i64_i32(ltid_pre_50627));\n    mem_49491[(int64_t) 0] = 0;\n    barrier(CLK_LOCAL_MEM_FENCE);\n    barrier(CLK_LOCAL_MEM_FENCE);\n    for (int32_t i_1 = 0; i_1 < 1; i_1++)\n        mem_param_49492[i_1] = mem_49491[i_1];\n    for (int64_t tile_id_46576 = 0; tile_id_46576 < num_whole_tiles_46568; tile_id_46576++) {\n        int64_t binop_x_46627;\n        int64_t ltid_flat_46626;\n        int64_t ltid_46625;\n        int64_t j_46628;\n        bool cond_46634;\n        int64_t pre1d_46635;\n        bool mem_49497[1];\n        int64_t ltid_flat_46640;\n        int64_t ltid_46639;\n        int64_t gtid_46642;\n        bool acc_46646;\n        bool cond_46647;\n        bool acc_46648;\n        bool mem_param_tmp_50632[1];\n        \n        binop_x_46627 = tile_sizze_46537 * tile_id_46576;\n        ltid_flat_46626 = sext_i32_i64(local_tid_50623);\n        ltid_46625 = sext_i32_i64(sext_i64_i32(ltid_pre_50627));\n        j_46628 = ltid_46625 + binop_x_46627;\n        cond_46634 = slt64(j_46628, dz2083U_27036);\n        if (cond_46634) {\n            int64_t tile_elem_46636 = ((__global int64_t *) clProc_mem_49385)[j_46628];\n            \n            pre1d_46635 = tile_elem_46636;\n        } else {\n            pre1d_46635", " = (int64_t) 0;\n        }\n        ((__local int64_t *) color_50172)[ltid_46625] = pre1d_46635;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        ltid_flat_46640 = sext_i32_i64(local_tid_50623);\n        ltid_46639 = sext_i32_i64(sext_i64_i32(ltid_pre_50627));\n        gtid_46642 = binop_x_46549 + ltid_46639;\n        acc_46646 = mem_param_49492[(int64_t) 0];\n        cond_46647 = slt64(gtid_46642, (int64_t) 8);\n        if (cond_46647) {\n            int64_t eta_p_46643;\n            bool cond_46644;\n            bool not_p_46645;\n            bool x_46649;\n            bool redout_49005;\n            \n            eta_p_46643 = mem_49482[(int64_t) 0];\n            cond_46644 = mem_49485[(int64_t) 0];\n            not_p_46645 = mem_49488[(int64_t) 0];\n            redout_49005 = acc_46646;\n            for (int64_t i_49006 = 0; i_49006 < tile_sizze_46537; i_49006++) {\n                int64_t eta_p_46650;\n                bool eq_x_y_46651;\n                bool eq_x_zz_46652;\n                bool p_and_eq_x_y_46653;\n                bool p_and_eq_x_y_46654;\n                bool lifted_lambda_res_46655;\n                bool defunc_0_op_res_46658;\n                bool redout_tmp_50634;\n                \n                eta_p_46650 = ((__local int64_t *) color_50172)[i_49006];\n                eq_x_y_46651 = eta_p_46650 == (int64_t) -1;\n                eq_x_zz_46652 = eta_p_46650 == eta_p_46643;\n                p_and_eq_x_y_46653 = cond_46644 && eq_x_y_46651;\n                p_and_eq_x_y_46654 = not_p_46645 && eq_x_zz_46652;\n                lifted_lambda_res_46655 = p_and_eq_x_y_46653 || p_and_eq_x_y_46654;\n                defunc_0_op_res_46658 = lifted_lambda_res_46655 || redout_49005;\n                redout_tmp_50634 = defunc_0_op_res_46658;\n                redout_49005 = redout_tmp_50634;\n            }\n            x_46649 = redout_49005;\n            acc_46648 = x_46649;\n        } else {\n            acc_46648 = acc_46646;\n        }\n        mem_49497[(int64_t) 0] = acc_46648;\n        barrier(", "CLK_LOCAL_MEM_FENCE);\n        for (int32_t i_2 = 0; i_2 < 1; i_2++)\n            mem_param_tmp_50632[i_2] = mem_49497[i_2];\n        for (int32_t i_3 = 0; i_3 < 1; i_3++)\n            mem_param_49492[i_3] = mem_param_tmp_50632[i_3];\n    }\n    for (int32_t i_4 = 0; i_4 < 1; i_4++)\n        ext_mem_49498[i_4] = mem_param_49492[i_4];\n    barrier(CLK_LOCAL_MEM_FENCE);\n    if (cond_46670) {\n        for (int32_t i_5 = 0; i_5 < 1; i_5++)\n            ext_mem_49504[i_5] = ext_mem_49498[i_5];\n    } else {\n        int64_t ltid_flat_46672;\n        int64_t ltid_46671;\n        int64_t j_46681;\n        bool cond_46687;\n        int64_t pre1d_46688;\n        int64_t ltid_flat_46694;\n        int64_t ltid_46693;\n        int64_t gtid_46701;\n        bool acc_46705;\n        bool cond_46706;\n        bool acc_46707;\n        \n        ltid_flat_46672 = sext_i32_i64(local_tid_50623);\n        ltid_46671 = sext_i32_i64(sext_i64_i32(ltid_pre_50627));\n        j_46681 = ltid_46671 + binop_x_46680;\n        cond_46687 = slt64(j_46681, dz2083U_27036);\n        if (cond_46687) {\n            int64_t tile_elem_46689 = ((__global int64_t *) clProc_mem_49385)[j_46681];\n            \n            pre1d_46688 = tile_elem_46689;\n        } else {\n            pre1d_46688 = (int64_t) 0;\n        }\n        ((__local int64_t *) color_50172)[ltid_46671] = pre1d_46688;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        ltid_flat_46694 = sext_i32_i64(local_tid_50623);\n        ltid_46693 = sext_i32_i64(sext_i64_i32(ltid_pre_50627));\n        gtid_46701 = binop_x_46549 + ltid_46693;\n        acc_46705 = ext_mem_49498[(int64_t) 0];\n        cond_46706 = slt64(gtid_46701, (int64_t) 8);\n        if (cond_46706) {\n            int64_t eta_p_46702;\n            bool cond_46703;\n            bool not_p_46704;\n            bool x_46708;\n            bool redout_49007;\n            \n            eta_p_46702 = mem_49482[(int64_t) 0];\n            cond_46703 = mem_49485[(int64_t) 0];\n            not_p_46704 = mem_49488[(int64_t) 0];\n            redout_4",
                                    "9007 = acc_46705;\n            for (int64_t i_49008 = 0; i_49008 < residual_input_46669; i_49008++) {\n                int64_t eta_p_46709;\n                bool eq_x_y_46710;\n                bool eq_x_zz_46711;\n                bool p_and_eq_x_y_46712;\n                bool p_and_eq_x_y_46713;\n                bool lifted_lambda_res_46714;\n                bool defunc_0_op_res_46717;\n                bool redout_tmp_50635;\n                \n                eta_p_46709 = ((__local int64_t *) color_50172)[i_49008];\n                eq_x_y_46710 = eta_p_46709 == (int64_t) -1;\n                eq_x_zz_46711 = eta_p_46709 == eta_p_46702;\n                p_and_eq_x_y_46712 = cond_46703 && eq_x_y_46710;\n                p_and_eq_x_y_46713 = not_p_46704 && eq_x_zz_46711;\n                lifted_lambda_res_46714 = p_and_eq_x_y_46712 || p_and_eq_x_y_46713;\n                defunc_0_op_res_46717 = lifted_lambda_res_46714 || redout_49007;\n                redout_tmp_50635 = defunc_0_op_res_46717;\n                redout_49007 = redout_tmp_50635;\n            }\n            x_46708 = redout_49007;\n            acc_46707 = x_46708;\n        } else {\n            acc_46707 = acc_46705;\n        }\n        mem_49503[(int64_t) 0] = acc_46707;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        for (int32_t i_6 = 0; i_6 < 1; i_6++)\n            ext_mem_49504[i_6] = mem_49503[i_6];\n    }\n    ltid_flat_46721 = sext_i32_i64(local_tid_50623);\n    ltid_46720 = sext_i32_i64(sext_i64_i32(ltid_pre_50627));\n    gtid_46729 = binop_x_46549 + ltid_46720;\n    cond_46731 = slt64(gtid_46729, (int64_t) 8);\n    if (cond_46731) {\n        bool defunc_0_reduce_res_46730;\n        bool cond_46735;\n        int64_t lifted_lambda_res_46737;\n        int64_t lifted_lambda_res_46738;\n        bool cond_46739;\n        int64_t lifted_lambda_res_46740;\n        bool lifted_lambda_res_46741;\n        int64_t defunc_0_f_res_46777;\n        \n        defunc_0_reduce_res_46730 = ext_mem_49504[(int64_t) 0];\n        cond_46735 = mem_49485[(int64_t) 0];\n", "        if (cond_46735) {\n            lifted_lambda_res_46737 = (int64_t) -1;\n        } else {\n            int64_t eta_p_46734 = mem_49482[(int64_t) 0];\n            \n            lifted_lambda_res_46737 = eta_p_46734;\n        }\n        if (defunc_0_reduce_res_46730) {\n            lifted_lambda_res_46738 = (int64_t) -1;\n        } else {\n            lifted_lambda_res_46738 = lifted_lambda_res_46737;\n        }\n        cond_46739 = slt64(lifted_lambda_res_46738, (int64_t) 0);\n        if (cond_46739) {\n            lifted_lambda_res_46740 = (int64_t) -1;\n        } else {\n            lifted_lambda_res_46740 = lifted_lambda_res_46738;\n        }\n        if (cond_46739) {\n            lifted_lambda_res_46741 = 0;\n        } else {\n            int64_t zv_rhs_46742;\n            bool zzero_46743;\n            bool nonzzero_46744;\n            bool nonzzero_cert_46745;\n            int64_t nxid_46746;\n            int64_t nyid_46747;\n            double times_arg1_46748;\n            double i64_res_46749;\n            double zt_res_46750;\n            double plus_arg0_46751;\n            double zp_res_46752;\n            double times_arg1_46753;\n            double i64_res_46754;\n            double zt_res_46755;\n            double plus_arg0_46756;\n            double zp_res_46757;\n            double zp_res_46758;\n            double zp_res_46759;\n            double zm_res_46760;\n            double zp_res_46761;\n            double zm_res_46762;\n            double zp_res_46763;\n            bool defunc_0_reduce_res_46764;\n            bool redout_49009;\n            \n            zv_rhs_46742 = ((__global int64_t *) clBase_mem_49378)[(int64_t) 0];\n            zzero_46743 = zv_rhs_46742 == (int64_t) 0;\n            nonzzero_46744 = !zzero_46743;\n            if (!nonzzero_46744) {\n                {\n                    if (atomic_cmpxchg_i32_global(global_failure, -1, 4) == -1) {\n                        ;\n                    }\n                    local_failure = 1;\n                    goto error_8;\n      ", "          }\n            }\n            nxid_46746 = smod64(lifted_lambda_res_46738, zv_rhs_46742);\n            nyid_46747 = sdiv64(lifted_lambda_res_46738, zv_rhs_46742);\n            times_arg1_46748 = ((__global double *) clBase_mem_49379)[(int64_t) 0];\n            i64_res_46749 = sitofp_i64_f64(nxid_46746);\n            zt_res_46750 = times_arg1_46748 * i64_res_46749;\n            plus_arg0_46751 = ((__global double *) clBase_mem_49377)[(int64_t) 0];\n            zp_res_46752 = zt_res_46750 + plus_arg0_46751;\n            times_arg1_46753 = ((__global double *) clBase_mem_49379)[(int64_t) 1];\n            i64_res_46754 = sitofp_i64_f64(nyid_46747);\n            zt_res_46755 = times_arg1_46753 * i64_res_46754;\n            plus_arg0_46756 = ((__global double *) clBase_mem_49377)[(int64_t) 1];\n            zp_res_46757 = zt_res_46755 + plus_arg0_46756;\n            zp_res_46758 = times_arg1_46748 + zp_res_46752;\n            zp_res_46759 = times_arg1_46753 + zp_res_46757;\n            zm_res_46760 = zp_res_46752 - clBase_27044;\n            zp_res_46761 = clBase_27044 + zp_res_46758;\n            zm_res_46762 = zp_res_46757 - clBase_27044;\n            zp_res_46763 = clBase_27044 + zp_res_46759;\n            redout_49009 = 0;\n            for (int64_t i_49010 = 0; i_49010 < n_new_27039; i_49010++) {\n                double eta_p_46765;\n                double eta_p_46766;\n                bool zgze_res_46767;\n                bool zlze_res_46768;\n                bool x_46769;\n                bool zgze_res_46770;\n                bool zlze_res_46771;\n                bool x_46772;\n                bool x_46773;\n                bool defunc_0_op_res_46776;\n                bool redout_tmp_50636;\n                \n                eta_p_46765 = ((__global double *) new_xs_mem_49401)[i_49010];\n                eta_p_46766 = ((__global double *) new_ys_mem_49402)[i_49010];\n                zgze_res_46767 = zm_res_46760 <= eta_p_46765;\n                zlze_res_46768 = eta_p_46765 <= zp_res_46761;\n    ",
                                    "            x_46769 = zgze_res_46767 && zlze_res_46768;\n                zgze_res_46770 = zm_res_46762 <= eta_p_46766;\n                zlze_res_46771 = eta_p_46766 <= zp_res_46763;\n                x_46772 = zgze_res_46770 && zlze_res_46771;\n                x_46773 = x_46769 && x_46772;\n                defunc_0_op_res_46776 = x_46773 || redout_49009;\n                redout_tmp_50636 = defunc_0_op_res_46776;\n                redout_49009 = redout_tmp_50636;\n            }\n            defunc_0_reduce_res_46764 = redout_49009;\n            lifted_lambda_res_46741 = defunc_0_reduce_res_46764;\n        }\n        defunc_0_f_res_46777 = btoi_bool_i64(lifted_lambda_res_46741);\n        postlude_46732 = defunc_0_f_res_46777;\n        postlude_46733 = lifted_lambda_res_46740;\n    } else {\n        postlude_46732 = (int64_t) 0;\n        postlude_46733 = (int64_t) 0;\n    }\n    mem_49508[(int64_t) 0] = postlude_46732;\n    mem_49512[(int64_t) 0] = postlude_46733;\n    \n  error_8:\n    barrier(CLK_LOCAL_MEM_FENCE);\n    if (local_failure)\n        return;\n    barrier(CLK_LOCAL_MEM_FENCE);\n    if (slt64(sext_i32_i64(local_tid_50623) + tile_sizze_46537 * sext_i32_i64(block_id_50624), (int64_t) 8)) {\n        int64_t tmp_50637 = mem_49508[(int64_t) 0];\n        \n        ((__global int64_t *) mem_49513)[sext_i32_i64(local_tid_50623) + tile_sizze_46537 * sext_i32_i64(block_id_50624)] = tmp_50637;\n    }\n    if (slt64(sext_i32_i64(local_tid_50623) + tile_sizze_46537 * sext_i32_i64(block_id_50624), (int64_t) 8)) {\n        int64_t tmp_50638 = mem_49512[(int64_t) 0];\n        \n        ((__global int64_t *) mem_49514)[sext_i32_i64(local_tid_50623) + tile_sizze_46537 * sext_i32_i64(block_id_50624)] = tmp_50638;\n    }\n    \n  error_9:\n    return;\n    #undef tile_sizze_46537\n    #undef ldim_46538\n    #undef bytes_49493\n}\nFUTHARK_KERNEL_SIZED(add_next_partition_doublezisegmap_intrablock_46783_dim1, 1, 1)\nvoid add_next_partition_doublezisegmap_intrablock_46783(__global int *global_failure, int failure_is_an_option", ", __global int64_t *global_failure_args, int64_t n_new_27039, double zt_res_38807, int64_t ldim_46786, __global unsigned char *clBase_mem_49377, __global unsigned char *clBase_mem_49378, __global unsigned char *clBase_mem_49379, __global unsigned char *new_xs_mem_49401, __global unsigned char *new_ys_mem_49402, __global unsigned char *mem_49450, __global unsigned char *mem_49559)\n{\n    #define tile_sizze_46785 (add_next_partition_doublezisegmap_intrablock_46783zitile_sizze_46785)\n    #define num_whole_tiles_46806 (add_next_partition_doublezisegmap_intrablock_46783zinum_whole_tiles_46806)\n    #define residual_input_46981 (add_next_partition_doublezisegmap_intrablock_46783ziresidual_input_46981)\n    #define cond_46982 (add_next_partition_doublezisegmap_intrablock_46783zicond_46982)\n    #define binop_x_46992 (add_next_partition_doublezisegmap_intrablock_46783zibinop_x_46992)\n    #define bytes_49547 (add_next_partition_doublezisegmap_intrablock_46783zibytes_49547)\n    \n    volatile __local unsigned char *color_50173_backing_0 = &shared_mem[0];\n    const int64_t color_50173_backing_0_offset = 0 + (bytes_49547 + srem64((int64_t) 8 - srem64(bytes_49547, (int64_t) 8), (int64_t) 8));\n    volatile __local int local_failure;\n    \n    if (failure_is_an_option) {\n        int failed = *global_failure >= 0;\n        \n        if (failed)\n            return;\n    }\n    local_failure = 0;\n    barrier(CLK_LOCAL_MEM_FENCE);\n    \n    int32_t local_tid_51073;\n    int32_t tblock_sizze_51076;\n    int32_t wave_sizze_51075;\n    int32_t block_id_51074;\n    int32_t global_tid_51072;\n    int64_t gid_flat_46783;\n    int64_t slice_51078;\n    int64_t ltid_pre_51077;\n    int64_t remnant_51079;\n    int64_t slice_51080;\n    int64_t gid_46782;\n    int64_t remnant_51081;\n    __local unsigned char *color_50173;\n    int64_t binop_x_46795;\n    double mem_49538[1];\n    double mem_49542[1];\n    int64_t ltid_flat_46788;\n    int64_t ltid_46787;\n    int64_t gtid_46796;\n    bool cond_46797;\n    double pre_46798;\n", "    double pre_46799;\n    bool mem_49545[1];\n    int64_t ltid_flat_46808;\n    int64_t ltid_46807;\n    bool ext_mem_49552[1];\n    bool mem_param_49546[1];\n    bool mem_49557[1];\n    bool ext_mem_49558[1];\n    \n    local_tid_51073 = get_local_id(0);\n    tblock_sizze_51076 = get_local_size(0);\n    wave_sizze_51075 = LOCKSTEP_WIDTH;\n    block_id_51074 = get_tblock_id(0);\n    global_tid_51072 = block_id_51074 * tblock_sizze_51076 + local_tid_51073;\n    gid_flat_46783 = sext_i32_i64(block_id_51074);\n    slice_51078 = tile_sizze_46785;\n    ltid_pre_51077 = sext_i32_i64(local_tid_51073);\n    remnant_51079 = sext_i32_i64(local_tid_51073) - ltid_pre_51077;\n    slice_51080 = ldim_46786;\n    gid_46782 = sext_i32_i64(block_id_51074);\n    remnant_51081 = sext_i32_i64(block_id_51074) - gid_46782;\n    color_50173 = (__local unsigned char *) color_50173_backing_0;\n    binop_x_46795 = gid_46782 * tile_sizze_46785;\n    ltid_flat_46788 = sext_i32_i64(local_tid_51073);\n    ltid_46787 = sext_i32_i64(sext_i64_i32(ltid_pre_51077));\n    gtid_46796 = ltid_46787 + binop_x_46795;\n    cond_46797 = slt64(gtid_46796, n_new_27039);\n    if (cond_46797) {\n        double eta_p_46800;\n        double eta_p_46801;\n        \n        eta_p_46800 = ((__global double *) new_xs_mem_49401)[gtid_46796];\n        eta_p_46801 = ((__global double *) new_ys_mem_49402)[gtid_46796];\n        pre_46798 = eta_p_46800;\n        pre_46799 = eta_p_46801;\n    } else {\n        pre_46798 = 0.0;\n        pre_46799 = 0.0;\n    }\n    mem_49538[(int64_t) 0] = pre_46798;\n    mem_49542[(int64_t) 0] = pre_46799;\n    barrier(CLK_LOCAL_MEM_FENCE);\n    ltid_flat_46808 = sext_i32_i64(local_tid_51073);\n    ltid_46807 = sext_i32_i64(sext_i64_i32(ltid_pre_51077));\n    mem_49545[(int64_t) 0] = 0;\n    barrier(CLK_LOCAL_MEM_FENCE);\n    barrier(CLK_LOCAL_MEM_FENCE);\n    for (int32_t i_1 = 0; i_1 < 1; i_1++)\n        mem_param_49546[i_1] = mem_49545[i_1];\n    for (int64_t tile_id_46814 = 0; tile_id_46814 < num_whole_tiles_46806; tile_id_46814++) {\n ",
                                    "       int64_t binop_x_46889;\n        int64_t ltid_flat_46888;\n        int64_t ltid_46887;\n        int64_t j_46890;\n        bool cond_46895;\n        int64_t pre1d_46896;\n        bool mem_49551[1];\n        int64_t ltid_flat_46901;\n        int64_t ltid_46900;\n        int64_t gtid_46903;\n        bool acc_46906;\n        bool cond_46907;\n        bool acc_46908;\n        bool mem_param_tmp_51082[1];\n        \n        binop_x_46889 = tile_sizze_46785 * tile_id_46814;\n        ltid_flat_46888 = sext_i32_i64(local_tid_51073);\n        ltid_46887 = sext_i32_i64(sext_i64_i32(ltid_pre_51077));\n        j_46890 = ltid_46887 + binop_x_46889;\n        cond_46895 = slt64(j_46890, (int64_t) 8);\n        if (cond_46895) {\n            int64_t tile_elem_46897 = ((__global int64_t *) mem_49450)[j_46890];\n            \n            pre1d_46896 = tile_elem_46897;\n        } else {\n            pre1d_46896 = (int64_t) 0;\n        }\n        ((__local int64_t *) color_50173)[ltid_46887] = pre1d_46896;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        ltid_flat_46901 = sext_i32_i64(local_tid_51073);\n        ltid_46900 = sext_i32_i64(sext_i64_i32(ltid_pre_51077));\n        gtid_46903 = binop_x_46795 + ltid_46900;\n        acc_46906 = mem_param_49546[(int64_t) 0];\n        cond_46907 = slt64(gtid_46903, n_new_27039);\n        if (cond_46907) {\n            double eta_p_46904;\n            double eta_p_46905;\n            bool x_46909;\n            bool redout_49013;\n            \n            eta_p_46904 = mem_49538[(int64_t) 0];\n            eta_p_46905 = mem_49542[(int64_t) 0];\n            redout_49013 = acc_46906;\n            for (int64_t i_49014 = 0; i_49014 < tile_sizze_46785; i_49014++) {\n                int64_t eta_p_46910;\n                bool cond_46911;\n                bool lifted_lambda_res_46912;\n                bool defunc_0_op_res_46944;\n                bool redout_tmp_51084;\n                \n                eta_p_46910 = ((__local int64_t *) color_50173)[i_49014];\n                cond_46911 = slt64(eta_p_4", "6910, (int64_t) 0);\n                if (cond_46911) {\n                    lifted_lambda_res_46912 = 0;\n                } else {\n                    int64_t zv_rhs_46913;\n                    bool zzero_46914;\n                    bool nonzzero_46915;\n                    bool nonzzero_cert_46916;\n                    int64_t nxid_46917;\n                    int64_t nyid_46918;\n                    double times_arg1_46919;\n                    double i64_res_46920;\n                    double zt_res_46921;\n                    double plus_arg0_46922;\n                    double zp_res_46923;\n                    double times_arg1_46924;\n                    double i64_res_46925;\n                    double zt_res_46926;\n                    double plus_arg0_46927;\n                    double zp_res_46928;\n                    double zp_res_46929;\n                    double zp_res_46930;\n                    double zm_res_46931;\n                    bool zgze_res_46932;\n                    double zp_res_46933;\n                    bool zlze_res_46934;\n                    bool x_46935;\n                    double zm_res_46936;\n                    bool zgze_res_46937;\n                    double zp_res_46938;\n                    bool zlze_res_46939;\n                    bool x_46940;\n                    bool x_46941;\n                    \n                    zv_rhs_46913 = ((__global int64_t *) clBase_mem_49378)[(int64_t) 0];\n                    zzero_46914 = zv_rhs_46913 == (int64_t) 0;\n                    nonzzero_46915 = !zzero_46914;\n                    if (!nonzzero_46915) {\n                        {\n                            if (atomic_cmpxchg_i32_global(global_failure, -1, 10) == -1) {\n                                ;\n                            }\n                            local_failure = 1;\n                            goto error_4;\n                        }\n                    }\n                    nxid_46917 = smod64(eta_p_46910, zv_rhs_46913);\n                    nyid_46918 = s", "div64(eta_p_46910, zv_rhs_46913);\n                    times_arg1_46919 = ((__global double *) clBase_mem_49379)[(int64_t) 0];\n                    i64_res_46920 = sitofp_i64_f64(nxid_46917);\n                    zt_res_46921 = times_arg1_46919 * i64_res_46920;\n                    plus_arg0_46922 = ((__global double *) clBase_mem_49377)[(int64_t) 0];\n                    zp_res_46923 = zt_res_46921 + plus_arg0_46922;\n                    times_arg1_46924 = ((__global double *) clBase_mem_49379)[(int64_t) 1];\n                    i64_res_46925 = sitofp_i64_f64(nyid_46918);\n                    zt_res_46926 = times_arg1_46924 * i64_res_46925;\n                    plus_arg0_46927 = ((__global double *) clBase_mem_49377)[(int64_t) 1];\n                    zp_res_46928 = zt_res_46926 + plus_arg0_46927;\n                    zp_res_46929 = times_arg1_46919 + zp_res_46923;\n                    zp_res_46930 = times_arg1_46924 + zp_res_46928;\n                    zm_res_46931 = zp_res_46923 - zt_res_38807;\n                    zgze_res_46932 = zm_res_46931 <= eta_p_46904;\n                    zp_res_46933 = zt_res_38807 + zp_res_46929;\n                    zlze_res_46934 = eta_p_46904 <= zp_res_46933;\n                    x_46935 = zgze_res_46932 && zlze_res_46934;\n                    zm_res_46936 = zp_res_46928 - zt_res_38807;\n                    zgze_res_46937 = zm_res_46936 <= eta_p_46905;\n                    zp_res_46938 = zt_res_38807 + zp_res_46930;\n                    zlze_res_46939 = eta_p_46905 <= zp_res_46938;\n                    x_46940 = zgze_res_46937 && zlze_res_46939;\n                    x_46941 = x_46935 && x_46940;\n                    lifted_lambda_res_46912 = x_46941;\n                }\n                defunc_0_op_res_46944 = lifted_lambda_res_46912 || redout_49013;\n                redout_tmp_51084 = defunc_0_op_res_46944;\n                redout_49013 = redout_tmp_51084;\n            }\n            x_46909 = redout_49013;\n            acc_46908 = x_46909;\n        } else {\n     ",
                                    "       acc_46908 = acc_46906;\n        }\n        mem_49551[(int64_t) 0] = acc_46908;\n        \n      error_4:\n        barrier(CLK_LOCAL_MEM_FENCE);\n        if (local_failure)\n            return;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        for (int32_t i_2 = 0; i_2 < 1; i_2++)\n            mem_param_tmp_51082[i_2] = mem_49551[i_2];\n        for (int32_t i_3 = 0; i_3 < 1; i_3++)\n            mem_param_49546[i_3] = mem_param_tmp_51082[i_3];\n    }\n    for (int32_t i_4 = 0; i_4 < 1; i_4++)\n        ext_mem_49552[i_4] = mem_param_49546[i_4];\n    barrier(CLK_LOCAL_MEM_FENCE);\n    if (cond_46982) {\n        for (int32_t i_5 = 0; i_5 < 1; i_5++)\n            ext_mem_49558[i_5] = ext_mem_49552[i_5];\n    } else {\n        int64_t ltid_flat_46984;\n        int64_t ltid_46983;\n        int64_t j_46993;\n        bool cond_46998;\n        int64_t pre1d_46999;\n        int64_t ltid_flat_47005;\n        int64_t ltid_47004;\n        int64_t gtid_47012;\n        bool acc_47015;\n        bool cond_47016;\n        bool acc_47017;\n        \n        ltid_flat_46984 = sext_i32_i64(local_tid_51073);\n        ltid_46983 = sext_i32_i64(sext_i64_i32(ltid_pre_51077));\n        j_46993 = ltid_46983 + binop_x_46992;\n        cond_46998 = slt64(j_46993, (int64_t) 8);\n        if (cond_46998) {\n            int64_t tile_elem_47000 = ((__global int64_t *) mem_49450)[j_46993];\n            \n            pre1d_46999 = tile_elem_47000;\n        } else {\n            pre1d_46999 = (int64_t) 0;\n        }\n        ((__local int64_t *) color_50173)[ltid_46983] = pre1d_46999;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        ltid_flat_47005 = sext_i32_i64(local_tid_51073);\n        ltid_47004 = sext_i32_i64(sext_i64_i32(ltid_pre_51077));\n        gtid_47012 = binop_x_46795 + ltid_47004;\n        acc_47015 = ext_mem_49552[(int64_t) 0];\n        cond_47016 = slt64(gtid_47012, n_new_27039);\n        if (cond_47016) {\n            double eta_p_47013;\n            double eta_p_47014;\n            bool x_47018;\n            bool redout_49015;\n          ", "  \n            eta_p_47013 = mem_49538[(int64_t) 0];\n            eta_p_47014 = mem_49542[(int64_t) 0];\n            redout_49015 = acc_47015;\n            for (int64_t i_49016 = 0; i_49016 < residual_input_46981; i_49016++) {\n                int64_t eta_p_47019;\n                bool cond_47020;\n                bool lifted_lambda_res_47021;\n                bool defunc_0_op_res_47053;\n                bool redout_tmp_51085;\n                \n                eta_p_47019 = ((__local int64_t *) color_50173)[i_49016];\n                cond_47020 = slt64(eta_p_47019, (int64_t) 0);\n                if (cond_47020) {\n                    lifted_lambda_res_47021 = 0;\n                } else {\n                    int64_t zv_rhs_47022;\n                    bool zzero_47023;\n                    bool nonzzero_47024;\n                    bool nonzzero_cert_47025;\n                    int64_t nxid_47026;\n                    int64_t nyid_47027;\n                    double times_arg1_47028;\n                    double i64_res_47029;\n                    double zt_res_47030;\n                    double plus_arg0_47031;\n                    double zp_res_47032;\n                    double times_arg1_47033;\n                    double i64_res_47034;\n                    double zt_res_47035;\n                    double plus_arg0_47036;\n                    double zp_res_47037;\n                    double zp_res_47038;\n                    double zp_res_47039;\n                    double zm_res_47040;\n                    bool zgze_res_47041;\n                    double zp_res_47042;\n                    bool zlze_res_47043;\n                    bool x_47044;\n                    double zm_res_47045;\n                    bool zgze_res_47046;\n                    double zp_res_47047;\n                    bool zlze_res_47048;\n                    bool x_47049;\n                    bool x_47050;\n                    \n                    zv_rhs_47022 = ((__global int64_t *) clBase_mem_49378)[(int64_t) 0];\n                    z", "zero_47023 = zv_rhs_47022 == (int64_t) 0;\n                    nonzzero_47024 = !zzero_47023;\n                    if (!nonzzero_47024) {\n                        {\n                            if (atomic_cmpxchg_i32_global(global_failure, -1, 11) == -1) {\n                                ;\n                            }\n                            local_failure = 1;\n                            goto error_7;\n                        }\n                    }\n                    nxid_47026 = smod64(eta_p_47019, zv_rhs_47022);\n                    nyid_47027 = sdiv64(eta_p_47019, zv_rhs_47022);\n                    times_arg1_47028 = ((__global double *) clBase_mem_49379)[(int64_t) 0];\n                    i64_res_47029 = sitofp_i64_f64(nxid_47026);\n                    zt_res_47030 = times_arg1_47028 * i64_res_47029;\n                    plus_arg0_47031 = ((__global double *) clBase_mem_49377)[(int64_t) 0];\n                    zp_res_47032 = zt_res_47030 + plus_arg0_47031;\n                    times_arg1_47033 = ((__global double *) clBase_mem_49379)[(int64_t) 1];\n                    i64_res_47034 = sitofp_i64_f64(nyid_47027);\n                    zt_res_47035 = times_arg1_47033 * i64_res_47034;\n                    plus_arg0_47036 = ((__global double *) clBase_mem_49377)[(int64_t) 1];\n                    zp_res_47037 = zt_res_47035 + plus_arg0_47036;\n                    zp_res_47038 = times_arg1_47028 + zp_res_47032;\n                    zp_res_47039 = times_arg1_47033 + zp_res_47037;\n                    zm_res_47040 = zp_res_47032 - zt_res_38807;\n                    zgze_res_47041 = zm_res_47040 <= eta_p_47013;\n                    zp_res_47042 = zt_res_38807 + zp_res_47038;\n                    zlze_res_47043 = eta_p_47013 <= zp_res_47042;\n                    x_47044 = zgze_res_47041 && zlze_res_47043;\n                    zm_res_47045 = zp_res_47037 - zt_res_38807;\n                    zgze_res_47046 = zm_res_47045 <= eta_p_47014;\n                    zp_res_47047 = zt_res_38807 + zp_r",
                                    "es_47039;\n                    zlze_res_47048 = eta_p_47014 <= zp_res_47047;\n                    x_47049 = zgze_res_47046 && zlze_res_47048;\n                    x_47050 = x_47044 && x_47049;\n                    lifted_lambda_res_47021 = x_47050;\n                }\n                defunc_0_op_res_47053 = lifted_lambda_res_47021 || redout_49015;\n                redout_tmp_51085 = defunc_0_op_res_47053;\n                redout_49015 = redout_tmp_51085;\n            }\n            x_47018 = redout_49015;\n            acc_47017 = x_47018;\n        } else {\n            acc_47017 = acc_47015;\n        }\n        mem_49557[(int64_t) 0] = acc_47017;\n        \n      error_7:\n        barrier(CLK_LOCAL_MEM_FENCE);\n        if (local_failure)\n            return;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        for (int32_t i_6 = 0; i_6 < 1; i_6++)\n            ext_mem_49558[i_6] = mem_49557[i_6];\n    }\n    if (slt64(sext_i32_i64(local_tid_51073) + tile_sizze_46785 * sext_i32_i64(block_id_51074), n_new_27039)) {\n        bool tmp_51086 = ext_mem_49558[(int64_t) 0];\n        \n        ((__global bool *) mem_49559)[sext_i32_i64(local_tid_51073) + tile_sizze_46785 * sext_i32_i64(block_id_51074)] = tmp_51086;\n    }\n    \n  error_8:\n    return;\n    #undef tile_sizze_46785\n    #undef num_whole_tiles_46806\n    #undef residual_input_46981\n    #undef cond_46982\n    #undef binop_x_46992\n    #undef bytes_49547\n}\nFUTHARK_KERNEL_SIZED(add_next_partition_doublezisegred_large_43807_dim1, 1, 1)\nvoid add_next_partition_doublezisegred_large_43807(__global int *global_failure, int64_t dz2083U_27036, int64_t num_tblocks_43802, int64_t blocks_per_segment_50701, int64_t q_50702, int64_t num_virtblocks_50703, int64_t threads_per_segment_50704, __global unsigned char *clProc_mem_49385, __global unsigned char *mem_49450, __global unsigned char *mem_49465, __global unsigned char *mem_49466, __global unsigned char *mem_49469, __global unsigned char *segred_tmp_mem_50705, __global unsigned char *counters_mem_50707)\n{\n    #def", "ine segred_tblock_sizze_43801 (add_next_partition_doublezisegred_large_43807zisegred_tblock_sizze_43801)\n    #define chunk_sizze_50672 (add_next_partition_doublezisegred_large_43807zichunk_sizze_50672)\n    \n    volatile __local unsigned char *sync_arr_mem_50716_backing_1 = &shared_mem[0];\n    const int64_t sync_arr_mem_50716_backing_1_offset = 0 + 8;\n    volatile __local unsigned char *red_arr_bool_mem_50714_backing_0 = &shared_mem[sync_arr_mem_50716_backing_1_offset];\n    const int64_t red_arr_bool_mem_50714_backing_0_offset = sync_arr_mem_50716_backing_1_offset + (segred_tblock_sizze_43801 + srem64((int64_t) 8 - srem64(segred_tblock_sizze_43801, (int64_t) 8), (int64_t) 8));\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_50710;\n    int32_t tblock_sizze_50713;\n    int32_t wave_sizze_50712;\n    int32_t block_id_50711;\n    int32_t global_tid_50709;\n    int64_t phys_tid_43807;\n    __local unsigned char *red_arr_bool_mem_50714;\n    __local unsigned char *sync_arr_mem_50716;\n    int32_t phys_tblock_id_50718;\n    int32_t iterations_50719;\n    \n    local_tid_50710 = get_local_id(0);\n    tblock_sizze_50713 = get_local_size(0);\n    wave_sizze_50712 = LOCKSTEP_WIDTH;\n    block_id_50711 = get_tblock_id(0);\n    global_tid_50709 = block_id_50711 * tblock_sizze_50713 + local_tid_50710;\n    phys_tid_43807 = sext_i32_i64(global_tid_50709);\n    red_arr_bool_mem_50714 = (__local unsigned char *) red_arr_bool_mem_50714_backing_0;\n    sync_arr_mem_50716 = (__local unsigned char *) sync_arr_mem_50716_backing_1;\n    phys_tblock_id_50718 = get_tblock_id(0);\n    iterations_50719 = sdiv_up32(sext_i64_i32(num_virtblocks_50703) - phys_tblock_id_50718, sext_i64_i32(num_tblocks_43802));\n    for (int32_t i_50720 = 0; i_50720 < iterations_50719; i_50720++) {\n        int32_t virt_tblock_id_50721;\n        int64_t flat_segment_id_50722;\n        int64_t global_tid_50723;\n        int64_t slice_50724;\n        int64_t gtid_43805;\n        int64_t remnant_50725;\n        int6", "4_t gtid_43806;\n        bool eta_p_block_res_acc_50726;\n        bool eta_p_43808;\n        bool eta_p_43809;\n        int64_t tblock_id_in_segment_50730;\n        int64_t block_base_offset_50731;\n        int32_t offset_50734;\n        int32_t skip_waves_50735;\n        bool eta_p_50727;\n        bool eta_p_50728;\n        \n        virt_tblock_id_50721 = phys_tblock_id_50718 + i_50720 * sext_i64_i32(num_tblocks_43802);\n        flat_segment_id_50722 = squot64(sext_i32_i64(virt_tblock_id_50721), blocks_per_segment_50701);\n        global_tid_50723 = srem64(sext_i32_i64(virt_tblock_id_50721) * segred_tblock_sizze_43801 + sext_i32_i64(local_tid_50710), threads_per_segment_50704);\n        slice_50724 = (int64_t) 8;\n        gtid_43805 = flat_segment_id_50722;\n        remnant_50725 = flat_segment_id_50722 - gtid_43805;\n        // ne-initialise the outer (per-block) accumulator(s)\n        {\n            eta_p_block_res_acc_50726 = 0;\n        }\n        tblock_id_in_segment_50730 = squot64(global_tid_50723, segred_tblock_sizze_43801);\n        block_base_offset_50731 = tblock_id_in_segment_50730 * q_50702 * segred_tblock_sizze_43801;\n        for (int64_t i_50732 = 0; i_50732 < q_50702; i_50732++) {\n            int64_t block_offset_50733 = block_base_offset_50731 + i_50732 * segred_tblock_sizze_43801;\n            \n            gtid_43806 = global_tid_50723 + threads_per_segment_50704 * i_50732;\n            if (slt64(gtid_43806, dz2083U_27036)) {\n                // apply map function(s)\n                {\n                    // apply map function\n                    {\n                        int64_t eta_p_43811 = ((__global int64_t *) mem_49450)[gtid_43805];\n                        bool cond_43812 = ((__global bool *) mem_49465)[gtid_43805];\n                        bool not_p_43813 = ((__global bool *) mem_49466)[gtid_43805];\n                        int64_t eta_p_43814 = ((__global int64_t *) clProc_mem_49385)[gtid_43806];\n                        bool eq_x_y_43815 = eta_p_43814 == (int64_t)",
                                    " -1;\n                        bool eq_x_zz_43816 = eta_p_43814 == eta_p_43811;\n                        bool p_and_eq_x_y_43817 = cond_43812 && eq_x_y_43815;\n                        bool p_and_eq_x_y_43818 = not_p_43813 && eq_x_zz_43816;\n                        bool lifted_lambda_res_43819 = p_and_eq_x_y_43817 || p_and_eq_x_y_43818;\n                        \n                        // load accumulator(s)\n                        {\n                            eta_p_43808 = eta_p_block_res_acc_50726;\n                        }\n                        // load next value(s)\n                        {\n                            eta_p_43809 = lifted_lambda_res_43819;\n                        }\n                        // apply reduction operator(s)\n                        {\n                            bool defunc_0_op_res_43810 = eta_p_43808 || eta_p_43809;\n                            \n                            // store in accumulator(s)\n                            {\n                                eta_p_block_res_acc_50726 = defunc_0_op_res_43810;\n                            }\n                        }\n                    }\n                }\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        // store accs. prims go in lmem; non-prims in params (in global mem)\n        {\n            ((__local bool *) red_arr_bool_mem_50714)[sext_i32_i64(local_tid_50710)] = eta_p_block_res_acc_50726;\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        skip_waves_50735 = 1;\n        offset_50734 = 0;\n        // participating threads read initial accumulator\n        {\n            if (slt32(local_tid_50710, sext_i64_i32(segred_tblock_sizze_43801))) {\n                eta_p_50727 = ((__local bool *) red_arr_bool_mem_50714)[sext_i32_i64(local_tid_50710 + offset_50734)];\n            }\n        }\n        offset_50734 = 1;\n        while (slt32(offset_50734, wave_sizze_50712)) {\n            if (slt32(local_tid_50710 + offset_50734, sext_i64_i32(segred_tblock_sizze_43801)) && ((local_t", "id_50710 - squot32(local_tid_50710, wave_sizze_50712) * wave_sizze_50712) & (2 * offset_50734 - 1)) == 0) {\n                // read array element\n                {\n                    eta_p_50728 = ((volatile __local bool *) red_arr_bool_mem_50714)[sext_i32_i64(local_tid_50710 + offset_50734)];\n                }\n                // apply reduction operation\n                {\n                    bool defunc_0_op_res_50729 = eta_p_50727 || eta_p_50728;\n                    \n                    eta_p_50727 = defunc_0_op_res_50729;\n                }\n                // write result of operation\n                {\n                    ((volatile __local bool *) red_arr_bool_mem_50714)[sext_i32_i64(local_tid_50710)] = eta_p_50727;\n                }\n            }\n            offset_50734 *= 2;\n        }\n        while (slt32(skip_waves_50735, squot32(sext_i64_i32(segred_tblock_sizze_43801) + wave_sizze_50712 - 1, wave_sizze_50712))) {\n            barrier(CLK_LOCAL_MEM_FENCE);\n            offset_50734 = skip_waves_50735 * wave_sizze_50712;\n            if (slt32(local_tid_50710 + offset_50734, sext_i64_i32(segred_tblock_sizze_43801)) && ((local_tid_50710 - squot32(local_tid_50710, wave_sizze_50712) * wave_sizze_50712) == 0 && (squot32(local_tid_50710, wave_sizze_50712) & (2 * skip_waves_50735 - 1)) == 0)) {\n                // read array element\n                {\n                    eta_p_50728 = ((__local bool *) red_arr_bool_mem_50714)[sext_i32_i64(local_tid_50710 + offset_50734)];\n                }\n                // apply reduction operation\n                {\n                    bool defunc_0_op_res_50729 = eta_p_50727 || eta_p_50728;\n                    \n                    eta_p_50727 = defunc_0_op_res_50729;\n                }\n                // write result of operation\n                {\n                    ((__local bool *) red_arr_bool_mem_50714)[sext_i32_i64(local_tid_50710)] = eta_p_50727;\n                }\n            }\n            skip_waves_50735 *= 2;\n        }\n     ", "   barrier(CLK_LOCAL_MEM_FENCE);\n        barrier(CLK_LOCAL_MEM_FENCE);\n        // thread 0 updates per-block acc(s); rest reset to ne\n        {\n            if (sext_i32_i64(local_tid_50710) == (int64_t) 0) {\n                eta_p_block_res_acc_50726 = eta_p_50727;\n            } else {\n                eta_p_block_res_acc_50726 = 0;\n            }\n        }\n        if (blocks_per_segment_50701 == (int64_t) 1) {\n            // first thread in block saves final result to memory\n            {\n                if (local_tid_50710 == 0) {\n                    ((__global bool *) mem_49469)[gtid_43805] = eta_p_block_res_acc_50726;\n                }\n            }\n        } else {\n            int32_t old_counter_50736;\n            bool is_last_block_50737;\n            \n            // first thread in block saves block result to global memory\n            {\n                if (local_tid_50710 == 0) {\n                    ((__global bool *) segred_tmp_mem_50705)[sext_i32_i64(virt_tblock_id_50721)] = eta_p_block_res_acc_50726;\n                    mem_fence_global();\n                    old_counter_50736 = atomic_add_i32_global(&((volatile __global int *) counters_mem_50707)[srem64(flat_segment_id_50722, (int64_t) 20480)], (int) 1);\n                    ((__local bool *) sync_arr_mem_50716)[(int64_t) 0] = old_counter_50736 == sext_i64_i32(blocks_per_segment_50701 - (int64_t) 1);\n                }\n            }\n            barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n            is_last_block_50737 = ((__local bool *) sync_arr_mem_50716)[(int64_t) 0];\n            if (is_last_block_50737) {\n                if (local_tid_50710 == 0) {\n                    old_counter_50736 = atomic_add_i32_global(&((volatile __global int *) counters_mem_50707)[srem64(flat_segment_id_50722, (int64_t) 20480)], (int) sext_i64_i32((int64_t) 0 - blocks_per_segment_50701));\n                }\n                // read in the per-block-results\n                {\n                    int64_t read_per_thread_50738",
                                    " = sdiv_up64(blocks_per_segment_50701, segred_tblock_sizze_43801);\n                    \n                    eta_p_43808 = 0;\n                    for (int64_t i_50739 = 0; i_50739 < read_per_thread_50738; i_50739++) {\n                        int64_t block_res_id_50740 = sext_i32_i64(local_tid_50710) * read_per_thread_50738 + i_50739;\n                        int64_t index_of_block_res_50741 = flat_segment_id_50722 * blocks_per_segment_50701 + block_res_id_50740;\n                        \n                        if (slt64(block_res_id_50740, blocks_per_segment_50701)) {\n                            eta_p_43809 = ((__global bool *) segred_tmp_mem_50705)[index_of_block_res_50741];\n                            \n                            bool defunc_0_op_res_43810 = eta_p_43808 || eta_p_43809;\n                            \n                            eta_p_43808 = defunc_0_op_res_43810;\n                        }\n                    }\n                }\n                ((__local bool *) red_arr_bool_mem_50714)[sext_i32_i64(local_tid_50710)] = eta_p_43808;\n                barrier(CLK_LOCAL_MEM_FENCE);\n                // reduce the per-block results\n                {\n                    int32_t offset_50742;\n                    int32_t skip_waves_50743 = 1;\n                    bool eta_p_50727;\n                    bool eta_p_50728;\n                    \n                    offset_50742 = 0;\n                    // participating threads read initial accumulator\n                    {\n                        if (slt32(local_tid_50710, sext_i64_i32(segred_tblock_sizze_43801))) {\n                            eta_p_50727 = ((__local bool *) red_arr_bool_mem_50714)[sext_i32_i64(local_tid_50710 + offset_50742)];\n                        }\n                    }\n                    offset_50742 = 1;\n                    while (slt32(offset_50742, wave_sizze_50712)) {\n                        if (slt32(local_tid_50710 + offset_50742, sext_i64_i32(segred_tblock_sizze_43801)) && ((local_tid_50710 ", "- squot32(local_tid_50710, wave_sizze_50712) * wave_sizze_50712) & (2 * offset_50742 - 1)) == 0) {\n                            // read array element\n                            {\n                                eta_p_50728 = ((volatile __local bool *) red_arr_bool_mem_50714)[sext_i32_i64(local_tid_50710 + offset_50742)];\n                            }\n                            // apply reduction operation\n                            {\n                                bool defunc_0_op_res_50729 = eta_p_50727 || eta_p_50728;\n                                \n                                eta_p_50727 = defunc_0_op_res_50729;\n                            }\n                            // write result of operation\n                            {\n                                ((volatile __local bool *) red_arr_bool_mem_50714)[sext_i32_i64(local_tid_50710)] = eta_p_50727;\n                            }\n                        }\n                        offset_50742 *= 2;\n                    }\n                    while (slt32(skip_waves_50743, squot32(sext_i64_i32(segred_tblock_sizze_43801) + wave_sizze_50712 - 1, wave_sizze_50712))) {\n                        barrier(CLK_LOCAL_MEM_FENCE);\n                        offset_50742 = skip_waves_50743 * wave_sizze_50712;\n                        if (slt32(local_tid_50710 + offset_50742, sext_i64_i32(segred_tblock_sizze_43801)) && ((local_tid_50710 - squot32(local_tid_50710, wave_sizze_50712) * wave_sizze_50712) == 0 && (squot32(local_tid_50710, wave_sizze_50712) & (2 * skip_waves_50743 - 1)) == 0)) {\n                            // read array element\n                            {\n                                eta_p_50728 = ((__local bool *) red_arr_bool_mem_50714)[sext_i32_i64(local_tid_50710 + offset_50742)];\n                            }\n                            // apply reduction operation\n                            {\n                                bool defunc_0_op_res_50729 = eta_p_50727 || eta_p_50728;\n                      ", "          \n                                eta_p_50727 = defunc_0_op_res_50729;\n                            }\n                            // write result of operation\n                            {\n                                ((__local bool *) red_arr_bool_mem_50714)[sext_i32_i64(local_tid_50710)] = eta_p_50727;\n                            }\n                        }\n                        skip_waves_50743 *= 2;\n                    }\n                    barrier(CLK_LOCAL_MEM_FENCE);\n                    // and back to memory with the final result\n                    {\n                        if (local_tid_50710 == 0) {\n                            ((__global bool *) mem_49469)[gtid_43805] = eta_p_50727;\n                        }\n                    }\n                }\n            }\n        }\n        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    }\n    \n  error_6:\n    return;\n    #undef segred_tblock_sizze_43801\n    #undef chunk_sizze_50672\n}\nFUTHARK_KERNEL_SIZED(add_next_partition_doublezisegred_large_44044_dim1, 1, 1)\nvoid add_next_partition_doublezisegred_large_44044(__global int *global_failure, int failure_is_an_option, __global int64_t *global_failure_args, int64_t n_new_27039, double zt_res_38807, int64_t num_tblocks_44039, int64_t blocks_per_segment_51116, int64_t q_51117, int64_t num_virtblocks_51118, int64_t threads_per_segment_51119, __global unsigned char *clBase_mem_49377, __global unsigned char *clBase_mem_49378, __global unsigned char *clBase_mem_49379, __global unsigned char *new_xs_mem_49401, __global unsigned char *new_ys_mem_49402, __global unsigned char *mem_49450, __global unsigned char *mem_49533, __global unsigned char *segred_tmp_mem_51120, __global unsigned char *counters_mem_51122)\n{\n    #define segred_tblock_sizze_44038 (add_next_partition_doublezisegred_large_44044zisegred_tblock_sizze_44038)\n    #define chunk_sizze_51087 (add_next_partition_doublezisegred_large_44044zichunk_sizze_51087)\n    \n    volatile __local unsigned char ",
                                    "*sync_arr_mem_51131_backing_1 = &shared_mem[0];\n    const int64_t sync_arr_mem_51131_backing_1_offset = 0 + 8;\n    volatile __local unsigned char *red_arr_bool_mem_51129_backing_0 = &shared_mem[sync_arr_mem_51131_backing_1_offset];\n    const int64_t red_arr_bool_mem_51129_backing_0_offset = sync_arr_mem_51131_backing_1_offset + (segred_tblock_sizze_44038 + srem64((int64_t) 8 - srem64(segred_tblock_sizze_44038, (int64_t) 8), (int64_t) 8));\n    volatile __local int local_failure;\n    \n    if (failure_is_an_option) {\n        int failed = *global_failure >= 0;\n        \n        if (failed)\n            return;\n    }\n    local_failure = 0;\n    barrier(CLK_LOCAL_MEM_FENCE);\n    \n    int32_t local_tid_51125;\n    int32_t tblock_sizze_51128;\n    int32_t wave_sizze_51127;\n    int32_t block_id_51126;\n    int32_t global_tid_51124;\n    int64_t phys_tid_44044;\n    __local unsigned char *red_arr_bool_mem_51129;\n    __local unsigned char *sync_arr_mem_51131;\n    int32_t phys_tblock_id_51133;\n    int32_t iterations_51134;\n    \n    local_tid_51125 = get_local_id(0);\n    tblock_sizze_51128 = get_local_size(0);\n    wave_sizze_51127 = LOCKSTEP_WIDTH;\n    block_id_51126 = get_tblock_id(0);\n    global_tid_51124 = block_id_51126 * tblock_sizze_51128 + local_tid_51125;\n    phys_tid_44044 = sext_i32_i64(global_tid_51124);\n    red_arr_bool_mem_51129 = (__local unsigned char *) red_arr_bool_mem_51129_backing_0;\n    sync_arr_mem_51131 = (__local unsigned char *) sync_arr_mem_51131_backing_1;\n    phys_tblock_id_51133 = get_tblock_id(0);\n    iterations_51134 = sdiv_up32(sext_i64_i32(num_virtblocks_51118) - phys_tblock_id_51133, sext_i64_i32(num_tblocks_44039));\n    for (int32_t i_51135 = 0; i_51135 < iterations_51134; i_51135++) {\n        int32_t virt_tblock_id_51136;\n        int64_t flat_segment_id_51137;\n        int64_t global_tid_51138;\n        int64_t slice_51139;\n        int64_t gtid_44042;\n        int64_t remnant_51140;\n        int64_t gtid_44043;\n        bool eta_p_block_res_acc_51141;\n     ", "   bool eta_p_44045;\n        bool eta_p_44046;\n        int64_t tblock_id_in_segment_51145;\n        int64_t block_base_offset_51146;\n        int32_t offset_51149;\n        int32_t skip_waves_51150;\n        bool eta_p_51142;\n        bool eta_p_51143;\n        \n        virt_tblock_id_51136 = phys_tblock_id_51133 + i_51135 * sext_i64_i32(num_tblocks_44039);\n        flat_segment_id_51137 = squot64(sext_i32_i64(virt_tblock_id_51136), blocks_per_segment_51116);\n        global_tid_51138 = srem64(sext_i32_i64(virt_tblock_id_51136) * segred_tblock_sizze_44038 + sext_i32_i64(local_tid_51125), threads_per_segment_51119);\n        slice_51139 = n_new_27039;\n        gtid_44042 = flat_segment_id_51137;\n        remnant_51140 = flat_segment_id_51137 - gtid_44042;\n        // ne-initialise the outer (per-block) accumulator(s)\n        {\n            eta_p_block_res_acc_51141 = 0;\n        }\n        tblock_id_in_segment_51145 = squot64(global_tid_51138, segred_tblock_sizze_44038);\n        block_base_offset_51146 = tblock_id_in_segment_51145 * q_51117 * segred_tblock_sizze_44038;\n        for (int64_t i_51147 = 0; i_51147 < q_51117; i_51147++) {\n            int64_t block_offset_51148 = block_base_offset_51146 + i_51147 * segred_tblock_sizze_44038;\n            \n            gtid_44043 = global_tid_51138 + threads_per_segment_51119 * i_51147;\n            if (slt64(gtid_44043, (int64_t) 8)) {\n                // apply map function(s)\n                {\n                    // apply map function\n                    {\n                        int64_t eta_p_44050 = ((__global int64_t *) mem_49450)[gtid_44043];\n                        bool cond_44051 = slt64(eta_p_44050, (int64_t) 0);\n                        bool lifted_lambda_res_44052;\n                        \n                        if (cond_44051) {\n                            lifted_lambda_res_44052 = 0;\n                        } else {\n                            int64_t zv_rhs_44053 = ((__global int64_t *) clBase_mem_49378)[(int64_t) 0];\n          ", "                  bool zzero_44054 = zv_rhs_44053 == (int64_t) 0;\n                            bool nonzzero_44055 = !zzero_44054;\n                            bool nonzzero_cert_44056;\n                            \n                            if (!nonzzero_44055) {\n                                {\n                                    if (atomic_cmpxchg_i32_global(global_failure, -1, 13) == -1) {\n                                        ;\n                                    }\n                                    local_failure = 1;\n                                    goto error_0;\n                                }\n                            }\n                            \n                            double eta_p_44048 = ((__global double *) new_xs_mem_49401)[gtid_44042];\n                            double eta_p_44049 = ((__global double *) new_ys_mem_49402)[gtid_44042];\n                            int64_t nxid_44057 = smod64(eta_p_44050, zv_rhs_44053);\n                            int64_t nyid_44058 = sdiv64(eta_p_44050, zv_rhs_44053);\n                            double times_arg1_44059 = ((__global double *) clBase_mem_49379)[(int64_t) 0];\n                            double i64_res_44060 = sitofp_i64_f64(nxid_44057);\n                            double zt_res_44061 = times_arg1_44059 * i64_res_44060;\n                            double plus_arg0_44062 = ((__global double *) clBase_mem_49377)[(int64_t) 0];\n                            double zp_res_44063 = zt_res_44061 + plus_arg0_44062;\n                            double times_arg1_44064 = ((__global double *) clBase_mem_49379)[(int64_t) 1];\n                            double i64_res_44065 = sitofp_i64_f64(nyid_44058);\n                            double zt_res_44066 = times_arg1_44064 * i64_res_44065;\n                            double plus_arg0_44067 = ((__global double *) clBase_mem_49377)[(int64_t) 1];\n                            double zp_res_44068 = zt_res_44066 + plus_arg0_44067;\n                            double zp_r",
                                    "es_44069 = times_arg1_44059 + zp_res_44063;\n                            double zp_res_44070 = times_arg1_44064 + zp_res_44068;\n                            double zm_res_44071 = zp_res_44063 - zt_res_38807;\n                            bool zgze_res_44072 = zm_res_44071 <= eta_p_44048;\n                            double zp_res_44073 = zt_res_38807 + zp_res_44069;\n                            bool zlze_res_44074 = eta_p_44048 <= zp_res_44073;\n                            bool x_44075 = zgze_res_44072 && zlze_res_44074;\n                            double zm_res_44076 = zp_res_44068 - zt_res_38807;\n                            bool zgze_res_44077 = zm_res_44076 <= eta_p_44049;\n                            double zp_res_44078 = zt_res_38807 + zp_res_44070;\n                            bool zlze_res_44079 = eta_p_44049 <= zp_res_44078;\n                            bool x_44080 = zgze_res_44077 && zlze_res_44079;\n                            bool x_44081 = x_44075 && x_44080;\n                            \n                            lifted_lambda_res_44052 = x_44081;\n                        }\n                        // load accumulator(s)\n                        {\n                            eta_p_44045 = eta_p_block_res_acc_51141;\n                        }\n                        // load next value(s)\n                        {\n                            eta_p_44046 = lifted_lambda_res_44052;\n                        }\n                        // apply reduction operator(s)\n                        {\n                            bool defunc_0_op_res_44047 = eta_p_44045 || eta_p_44046;\n                            \n                            // store in accumulator(s)\n                            {\n                                eta_p_block_res_acc_51141 = defunc_0_op_res_44047;\n                            }\n                        }\n                    }\n                }\n            }\n        }\n        \n      error_0:\n        barrier(CLK_LOCAL_MEM_FENCE);\n        if (local_failure)\n ", "           return;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        // store accs. prims go in lmem; non-prims in params (in global mem)\n        {\n            ((__local bool *) red_arr_bool_mem_51129)[sext_i32_i64(local_tid_51125)] = eta_p_block_res_acc_51141;\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        skip_waves_51150 = 1;\n        offset_51149 = 0;\n        // participating threads read initial accumulator\n        {\n            if (slt32(local_tid_51125, sext_i64_i32(segred_tblock_sizze_44038))) {\n                eta_p_51142 = ((__local bool *) red_arr_bool_mem_51129)[sext_i32_i64(local_tid_51125 + offset_51149)];\n            }\n        }\n        offset_51149 = 1;\n        while (slt32(offset_51149, wave_sizze_51127)) {\n            if (slt32(local_tid_51125 + offset_51149, sext_i64_i32(segred_tblock_sizze_44038)) && ((local_tid_51125 - squot32(local_tid_51125, wave_sizze_51127) * wave_sizze_51127) & (2 * offset_51149 - 1)) == 0) {\n                // read array element\n                {\n                    eta_p_51143 = ((volatile __local bool *) red_arr_bool_mem_51129)[sext_i32_i64(local_tid_51125 + offset_51149)];\n                }\n                // apply reduction operation\n                {\n                    bool defunc_0_op_res_51144 = eta_p_51142 || eta_p_51143;\n                    \n                    eta_p_51142 = defunc_0_op_res_51144;\n                }\n                // write result of operation\n                {\n                    ((volatile __local bool *) red_arr_bool_mem_51129)[sext_i32_i64(local_tid_51125)] = eta_p_51142;\n                }\n            }\n            offset_51149 *= 2;\n        }\n        while (slt32(skip_waves_51150, squot32(sext_i64_i32(segred_tblock_sizze_44038) + wave_sizze_51127 - 1, wave_sizze_51127))) {\n            barrier(CLK_LOCAL_MEM_FENCE);\n            offset_51149 = skip_waves_51150 * wave_sizze_51127;\n            if (slt32(local_tid_51125 + offset_51149, sext_i64_i32(segred_tblock_sizze_44038)) && ((local_tid_511", "25 - squot32(local_tid_51125, wave_sizze_51127) * wave_sizze_51127) == 0 && (squot32(local_tid_51125, wave_sizze_51127) & (2 * skip_waves_51150 - 1)) == 0)) {\n                // read array element\n                {\n                    eta_p_51143 = ((__local bool *) red_arr_bool_mem_51129)[sext_i32_i64(local_tid_51125 + offset_51149)];\n                }\n                // apply reduction operation\n                {\n                    bool defunc_0_op_res_51144 = eta_p_51142 || eta_p_51143;\n                    \n                    eta_p_51142 = defunc_0_op_res_51144;\n                }\n                // write result of operation\n                {\n                    ((__local bool *) red_arr_bool_mem_51129)[sext_i32_i64(local_tid_51125)] = eta_p_51142;\n                }\n            }\n            skip_waves_51150 *= 2;\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        barrier(CLK_LOCAL_MEM_FENCE);\n        // thread 0 updates per-block acc(s); rest reset to ne\n        {\n            if (sext_i32_i64(local_tid_51125) == (int64_t) 0) {\n                eta_p_block_res_acc_51141 = eta_p_51142;\n            } else {\n                eta_p_block_res_acc_51141 = 0;\n            }\n        }\n        if (blocks_per_segment_51116 == (int64_t) 1) {\n            // first thread in block saves final result to memory\n            {\n                if (local_tid_51125 == 0) {\n                    ((__global bool *) mem_49533)[gtid_44042] = eta_p_block_res_acc_51141;\n                }\n            }\n        } else {\n            int32_t old_counter_51151;\n            bool is_last_block_51152;\n            \n            // first thread in block saves block result to global memory\n            {\n                if (local_tid_51125 == 0) {\n                    ((__global bool *) segred_tmp_mem_51120)[sext_i32_i64(virt_tblock_id_51136)] = eta_p_block_res_acc_51141;\n                    mem_fence_global();\n                    old_counter_51151 = atomic_add_i32_global(&((volatile __global int *) co",
                                    "unters_mem_51122)[srem64(flat_segment_id_51137, (int64_t) 20480)], (int) 1);\n                    ((__local bool *) sync_arr_mem_51131)[(int64_t) 0] = old_counter_51151 == sext_i64_i32(blocks_per_segment_51116 - (int64_t) 1);\n                }\n            }\n            barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n            is_last_block_51152 = ((__local bool *) sync_arr_mem_51131)[(int64_t) 0];\n            if (is_last_block_51152) {\n                if (local_tid_51125 == 0) {\n                    old_counter_51151 = atomic_add_i32_global(&((volatile __global int *) counters_mem_51122)[srem64(flat_segment_id_51137, (int64_t) 20480)], (int) sext_i64_i32((int64_t) 0 - blocks_per_segment_51116));\n                }\n                // read in the per-block-results\n                {\n                    int64_t read_per_thread_51153 = sdiv_up64(blocks_per_segment_51116, segred_tblock_sizze_44038);\n                    \n                    eta_p_44045 = 0;\n                    for (int64_t i_51154 = 0; i_51154 < read_per_thread_51153; i_51154++) {\n                        int64_t block_res_id_51155 = sext_i32_i64(local_tid_51125) * read_per_thread_51153 + i_51154;\n                        int64_t index_of_block_res_51156 = flat_segment_id_51137 * blocks_per_segment_51116 + block_res_id_51155;\n                        \n                        if (slt64(block_res_id_51155, blocks_per_segment_51116)) {\n                            eta_p_44046 = ((__global bool *) segred_tmp_mem_51120)[index_of_block_res_51156];\n                            \n                            bool defunc_0_op_res_44047 = eta_p_44045 || eta_p_44046;\n                            \n                            eta_p_44045 = defunc_0_op_res_44047;\n                        }\n                    }\n                }\n                ((__local bool *) red_arr_bool_mem_51129)[sext_i32_i64(local_tid_51125)] = eta_p_44045;\n                barrier(CLK_LOCAL_MEM_FENCE);\n                // reduce the per-block results\n", "                {\n                    int32_t offset_51157;\n                    int32_t skip_waves_51158 = 1;\n                    bool eta_p_51142;\n                    bool eta_p_51143;\n                    \n                    offset_51157 = 0;\n                    // participating threads read initial accumulator\n                    {\n                        if (slt32(local_tid_51125, sext_i64_i32(segred_tblock_sizze_44038))) {\n                            eta_p_51142 = ((__local bool *) red_arr_bool_mem_51129)[sext_i32_i64(local_tid_51125 + offset_51157)];\n                        }\n                    }\n                    offset_51157 = 1;\n                    while (slt32(offset_51157, wave_sizze_51127)) {\n                        if (slt32(local_tid_51125 + offset_51157, sext_i64_i32(segred_tblock_sizze_44038)) && ((local_tid_51125 - squot32(local_tid_51125, wave_sizze_51127) * wave_sizze_51127) & (2 * offset_51157 - 1)) == 0) {\n                            // read array element\n                            {\n                                eta_p_51143 = ((volatile __local bool *) red_arr_bool_mem_51129)[sext_i32_i64(local_tid_51125 + offset_51157)];\n                            }\n                            // apply reduction operation\n                            {\n                                bool defunc_0_op_res_51144 = eta_p_51142 || eta_p_51143;\n                                \n                                eta_p_51142 = defunc_0_op_res_51144;\n                            }\n                            // write result of operation\n                            {\n                                ((volatile __local bool *) red_arr_bool_mem_51129)[sext_i32_i64(local_tid_51125)] = eta_p_51142;\n                            }\n                        }\n                        offset_51157 *= 2;\n                    }\n                    while (slt32(skip_waves_51158, squot32(sext_i64_i32(segred_tblock_sizze_44038) + wave_sizze_51127 - 1, wave_sizze_51127))) {\n            ", "            barrier(CLK_LOCAL_MEM_FENCE);\n                        offset_51157 = skip_waves_51158 * wave_sizze_51127;\n                        if (slt32(local_tid_51125 + offset_51157, sext_i64_i32(segred_tblock_sizze_44038)) && ((local_tid_51125 - squot32(local_tid_51125, wave_sizze_51127) * wave_sizze_51127) == 0 && (squot32(local_tid_51125, wave_sizze_51127) & (2 * skip_waves_51158 - 1)) == 0)) {\n                            // read array element\n                            {\n                                eta_p_51143 = ((__local bool *) red_arr_bool_mem_51129)[sext_i32_i64(local_tid_51125 + offset_51157)];\n                            }\n                            // apply reduction operation\n                            {\n                                bool defunc_0_op_res_51144 = eta_p_51142 || eta_p_51143;\n                                \n                                eta_p_51142 = defunc_0_op_res_51144;\n                            }\n                            // write result of operation\n                            {\n                                ((__local bool *) red_arr_bool_mem_51129)[sext_i32_i64(local_tid_51125)] = eta_p_51142;\n                            }\n                        }\n                        skip_waves_51158 *= 2;\n                    }\n                    barrier(CLK_LOCAL_MEM_FENCE);\n                    // and back to memory with the final result\n                    {\n                        if (local_tid_51125 == 0) {\n                            ((__global bool *) mem_49533)[gtid_44042] = eta_p_51142;\n                        }\n                    }\n                }\n            }\n        }\n        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    }\n    \n  error_6:\n    return;\n    #undef segred_tblock_sizze_44038\n    #undef chunk_sizze_51087\n}\nFUTHARK_KERNEL_SIZED(add_next_partition_doublezisegred_small_43807_dim1, 1, 1)\nvoid add_next_partition_doublezisegred_small_43807(__global int *global_failure, int64_t dz2083U_27036, int6",
                                    "4_t num_tblocks_43802, int64_t segment_sizze_nonzzero_50673, __global unsigned char *clProc_mem_49385, __global unsigned char *mem_49450, __global unsigned char *mem_49465, __global unsigned char *mem_49466, __global unsigned char *mem_49469)\n{\n    #define segred_tblock_sizze_43801 (add_next_partition_doublezisegred_small_43807zisegred_tblock_sizze_43801)\n    \n    volatile __local unsigned char *red_arr_bool_mem_50680_backing_0 = &shared_mem[0];\n    const int64_t red_arr_bool_mem_50680_backing_0_offset = 0 + (segred_tblock_sizze_43801 + srem64((int64_t) 8 - srem64(segred_tblock_sizze_43801, (int64_t) 8), (int64_t) 8));\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_50676;\n    int32_t tblock_sizze_50679;\n    int32_t wave_sizze_50678;\n    int32_t block_id_50677;\n    int32_t global_tid_50675;\n    int64_t phys_tid_43807;\n    __local unsigned char *red_arr_bool_mem_50680;\n    int32_t phys_tblock_id_50682;\n    int32_t iterations_50683;\n    \n    local_tid_50676 = get_local_id(0);\n    tblock_sizze_50679 = get_local_size(0);\n    wave_sizze_50678 = LOCKSTEP_WIDTH;\n    block_id_50677 = get_tblock_id(0);\n    global_tid_50675 = block_id_50677 * tblock_sizze_50679 + local_tid_50676;\n    phys_tid_43807 = sext_i32_i64(global_tid_50675);\n    red_arr_bool_mem_50680 = (__local unsigned char *) red_arr_bool_mem_50680_backing_0;\n    phys_tblock_id_50682 = get_tblock_id(0);\n    iterations_50683 = sdiv_up32(sext_i64_i32(sdiv_up64((int64_t) 8, squot64(segred_tblock_sizze_43801, segment_sizze_nonzzero_50673))) - phys_tblock_id_50682, sext_i64_i32(num_tblocks_43802));\n    for (int32_t i_50684 = 0; i_50684 < iterations_50683; i_50684++) {\n        int32_t virt_tblock_id_50685;\n        int64_t slice_50686;\n        int64_t gtid_43805;\n        int64_t remnant_50687;\n        int64_t gtid_43806;\n        \n        virt_tblock_id_50685 = phys_tblock_id_50682 + i_50684 * sext_i64_i32(num_tblocks_43802);\n        slice_50686 = (int64_t) 8;\n        gtid_43805 = squot64(sext_", "i32_i64(local_tid_50676), segment_sizze_nonzzero_50673) + sext_i32_i64(virt_tblock_id_50685) * squot64(segred_tblock_sizze_43801, segment_sizze_nonzzero_50673);\n        remnant_50687 = squot64(sext_i32_i64(local_tid_50676), segment_sizze_nonzzero_50673) + sext_i32_i64(virt_tblock_id_50685) * squot64(segred_tblock_sizze_43801, segment_sizze_nonzzero_50673) - gtid_43805;\n        gtid_43806 = srem64(sext_i32_i64(local_tid_50676), dz2083U_27036);\n        // apply map function if in bounds\n        {\n            if (slt64((int64_t) 0, dz2083U_27036) && (slt64(gtid_43805, (int64_t) 8) && slt64(sext_i32_i64(local_tid_50676), dz2083U_27036 * squot64(segred_tblock_sizze_43801, segment_sizze_nonzzero_50673)))) {\n                // apply map function\n                {\n                    int64_t eta_p_43811 = ((__global int64_t *) mem_49450)[gtid_43805];\n                    bool cond_43812 = ((__global bool *) mem_49465)[gtid_43805];\n                    bool not_p_43813 = ((__global bool *) mem_49466)[gtid_43805];\n                    int64_t eta_p_43814 = ((__global int64_t *) clProc_mem_49385)[gtid_43806];\n                    bool eq_x_y_43815 = eta_p_43814 == (int64_t) -1;\n                    bool eq_x_zz_43816 = eta_p_43814 == eta_p_43811;\n                    bool p_and_eq_x_y_43817 = cond_43812 && eq_x_y_43815;\n                    bool p_and_eq_x_y_43818 = not_p_43813 && eq_x_zz_43816;\n                    bool lifted_lambda_res_43819 = p_and_eq_x_y_43817 || p_and_eq_x_y_43818;\n                    \n                    // save results to be reduced\n                    {\n                        ((__local bool *) red_arr_bool_mem_50680)[sext_i32_i64(local_tid_50676)] = lifted_lambda_res_43819;\n                    }\n                }\n            } else {\n                ((__local bool *) red_arr_bool_mem_50680)[sext_i32_i64(local_tid_50676)] = 0;\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        if (slt64((int64_t) 0, dz2083U_27036)) {\n            // perform ", "segmented scan to imitate reduction\n            {\n                bool eta_p_43808;\n                bool eta_p_43809;\n                bool eta_p_50688;\n                bool eta_p_50689;\n                bool ltid_in_bounds_50691 = slt64(sext_i32_i64(local_tid_50676), dz2083U_27036 * squot64(segred_tblock_sizze_43801, segment_sizze_nonzzero_50673));\n                int32_t skip_threads_50692;\n                \n                // read input for in-block scan\n                {\n                    if (ltid_in_bounds_50691) {\n                        eta_p_43809 = ((volatile __local bool *) red_arr_bool_mem_50680)[sext_i32_i64(local_tid_50676)];\n                        if ((local_tid_50676 - squot32(local_tid_50676, 32) * 32) == 0) {\n                            eta_p_43808 = eta_p_43809;\n                        }\n                    }\n                }\n                // in-block scan (hopefully no barriers needed)\n                {\n                    skip_threads_50692 = 1;\n                    while (slt32(skip_threads_50692, 32)) {\n                        bool thread_active_50693 = sle32(skip_threads_50692, local_tid_50676 - squot32(local_tid_50676, 32) * 32) && ltid_in_bounds_50691;\n                        \n                        if (thread_active_50693) {\n                            // read operands\n                            {\n                                eta_p_43808 = ((volatile __local bool *) red_arr_bool_mem_50680)[sext_i32_i64(local_tid_50676) - sext_i32_i64(skip_threads_50692)];\n                            }\n                        }\n                        // perform operation\n                        {\n                            bool inactive_50694 = slt64(srem64(sext_i32_i64(local_tid_50676), dz2083U_27036), sext_i32_i64(local_tid_50676) - sext_i32_i64(local_tid_50676 - skip_threads_50692));\n                            \n                            if (thread_active_50693 && inactive_50694) {\n                                eta_p_43808 = eta_p_43809;\n    ",
                                    "                        }\n                            if (thread_active_50693) {\n                                if (!inactive_50694) {\n                                    bool defunc_0_op_res_43810 = eta_p_43808 || eta_p_43809;\n                                    \n                                    eta_p_43808 = defunc_0_op_res_43810;\n                                }\n                            }\n                        }\n                        if (sle32(wave_sizze_50678, skip_threads_50692)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        if (thread_active_50693) {\n                            // write result\n                            {\n                                ((volatile __local bool *) red_arr_bool_mem_50680)[sext_i32_i64(local_tid_50676)] = eta_p_43808;\n                                eta_p_43809 = eta_p_43808;\n                            }\n                        }\n                        if (sle32(wave_sizze_50678, skip_threads_50692)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        skip_threads_50692 *= 2;\n                    }\n                }\n                barrier(CLK_LOCAL_MEM_FENCE);\n                // last thread of block 'i' writes its result to offset 'i'\n                {\n                    if ((local_tid_50676 - squot32(local_tid_50676, 32) * 32) == 31 && ltid_in_bounds_50691) {\n                        ((volatile __local bool *) red_arr_bool_mem_50680)[sext_i32_i64(squot32(local_tid_50676, 32))] = eta_p_43808;\n                    }\n                }\n                barrier(CLK_LOCAL_MEM_FENCE);\n                // scan the first block, after which offset 'i' contains carry-in for block 'i+1'\n                {\n                    int32_t skip_threads_50695;\n                    \n                    // read input for in-block scan\n                    {\n                        if (squot32(local_tid_50676, 32) == 0 && ", "ltid_in_bounds_50691) {\n                            eta_p_50689 = ((volatile __local bool *) red_arr_bool_mem_50680)[sext_i32_i64(local_tid_50676)];\n                            if ((local_tid_50676 - squot32(local_tid_50676, 32) * 32) == 0) {\n                                eta_p_50688 = eta_p_50689;\n                            }\n                        }\n                    }\n                    // in-block scan (hopefully no barriers needed)\n                    {\n                        skip_threads_50695 = 1;\n                        while (slt32(skip_threads_50695, 32)) {\n                            bool thread_active_50696 = sle32(skip_threads_50695, local_tid_50676 - squot32(local_tid_50676, 32) * 32) && (squot32(local_tid_50676, 32) == 0 && ltid_in_bounds_50691);\n                            \n                            if (thread_active_50696) {\n                                // read operands\n                                {\n                                    eta_p_50688 = ((volatile __local bool *) red_arr_bool_mem_50680)[sext_i32_i64(local_tid_50676) - sext_i32_i64(skip_threads_50695)];\n                                }\n                            }\n                            // perform operation\n                            {\n                                bool inactive_50697 = slt64(srem64(sext_i32_i64(local_tid_50676 * 32 + 32 - 1), dz2083U_27036), sext_i32_i64(local_tid_50676 * 32 + 32 - 1) - sext_i32_i64((local_tid_50676 - skip_threads_50695) * 32 + 32 - 1));\n                                \n                                if (thread_active_50696 && inactive_50697) {\n                                    eta_p_50688 = eta_p_50689;\n                                }\n                                if (thread_active_50696) {\n                                    if (!inactive_50697) {\n                                        bool defunc_0_op_res_50690 = eta_p_50688 || eta_p_50689;\n                                        \n                                    ", "    eta_p_50688 = defunc_0_op_res_50690;\n                                    }\n                                }\n                            }\n                            if (sle32(wave_sizze_50678, skip_threads_50695)) {\n                                barrier(CLK_LOCAL_MEM_FENCE);\n                            }\n                            if (thread_active_50696) {\n                                // write result\n                                {\n                                    ((volatile __local bool *) red_arr_bool_mem_50680)[sext_i32_i64(local_tid_50676)] = eta_p_50688;\n                                    eta_p_50689 = eta_p_50688;\n                                }\n                            }\n                            if (sle32(wave_sizze_50678, skip_threads_50695)) {\n                                barrier(CLK_LOCAL_MEM_FENCE);\n                            }\n                            skip_threads_50695 *= 2;\n                        }\n                    }\n                }\n                barrier(CLK_LOCAL_MEM_FENCE);\n                \n                bool no_carry_in_50698 = squot32(local_tid_50676, 32) == 0 || !ltid_in_bounds_50691;\n                \n                // carry-in for every block except the first\n                {\n                    // read operands\n                    {\n                        if (!no_carry_in_50698) {\n                            eta_p_43809 = eta_p_43808;\n                            eta_p_43808 = ((__local bool *) red_arr_bool_mem_50680)[sext_i32_i64(squot32(local_tid_50676, 32)) - (int64_t) 1];\n                        }\n                    }\n                    // perform operation\n                    {\n                        bool inactive_50699 = slt64(srem64(sext_i32_i64(local_tid_50676), dz2083U_27036), sext_i32_i64(local_tid_50676) - sext_i32_i64(squot32(local_tid_50676, 32) * 32 - 1));\n                        \n                        if (!no_carry_in_50698) {\n                            if (inactive_50699) {\n    ",
                                    "                            eta_p_43808 = eta_p_43809;\n                            }\n                        }\n                        if (!no_carry_in_50698) {\n                            if (!inactive_50699) {\n                                bool defunc_0_op_res_43810 = eta_p_43808 || eta_p_43809;\n                                \n                                eta_p_43808 = defunc_0_op_res_43810;\n                            }\n                        }\n                    }\n                    // write final result\n                    {\n                        if (!no_carry_in_50698) {\n                            ((__local bool *) red_arr_bool_mem_50680)[sext_i32_i64(local_tid_50676)] = eta_p_43808;\n                        }\n                    }\n                }\n                barrier(CLK_LOCAL_MEM_FENCE);\n                // restore correct values for first block\n                {\n                    if (squot32(local_tid_50676, 32) == 0 && ltid_in_bounds_50691) {\n                        ((__local bool *) red_arr_bool_mem_50680)[sext_i32_i64(local_tid_50676)] = eta_p_43809;\n                    }\n                }\n                barrier(CLK_LOCAL_MEM_FENCE);\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        // save final values of segments\n        {\n            if (slt64(sext_i32_i64(virt_tblock_id_50685) * squot64(segred_tblock_sizze_43801, segment_sizze_nonzzero_50673) + sext_i32_i64(local_tid_50676), (int64_t) 8) && slt64(sext_i32_i64(local_tid_50676), squot64(segred_tblock_sizze_43801, segment_sizze_nonzzero_50673))) {\n                bool tmp_50700 = ((__local bool *) red_arr_bool_mem_50680)[(sext_i32_i64(local_tid_50676) + (int64_t) 1) * segment_sizze_nonzzero_50673 - (int64_t) 1];\n                \n                ((__global bool *) mem_49469)[sext_i32_i64(virt_tblock_id_50685) * squot64(segred_tblock_sizze_43801, segment_sizze_nonzzero_50673) + sext_i32_i64(local_tid_50676)] = tmp_50700;\n            }\n        }\n        barrier(CLK_LOC", "AL_MEM_FENCE);\n        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    }\n    \n  error_3:\n    return;\n    #undef segred_tblock_sizze_43801\n}\nFUTHARK_KERNEL_SIZED(add_next_partition_doublezisegred_small_44044_dim1, 1, 1)\nvoid add_next_partition_doublezisegred_small_44044(__global int *global_failure, int failure_is_an_option, __global int64_t *global_failure_args, int64_t n_new_27039, double zt_res_38807, int64_t num_tblocks_44039, int64_t segment_sizze_nonzzero_51088, __global unsigned char *clBase_mem_49377, __global unsigned char *clBase_mem_49378, __global unsigned char *clBase_mem_49379, __global unsigned char *new_xs_mem_49401, __global unsigned char *new_ys_mem_49402, __global unsigned char *mem_49450, __global unsigned char *mem_49533)\n{\n    #define segred_tblock_sizze_44038 (add_next_partition_doublezisegred_small_44044zisegred_tblock_sizze_44038)\n    \n    volatile __local unsigned char *red_arr_bool_mem_51095_backing_0 = &shared_mem[0];\n    const int64_t red_arr_bool_mem_51095_backing_0_offset = 0 + (segred_tblock_sizze_44038 + srem64((int64_t) 8 - srem64(segred_tblock_sizze_44038, (int64_t) 8), (int64_t) 8));\n    volatile __local int local_failure;\n    \n    if (failure_is_an_option) {\n        int failed = *global_failure >= 0;\n        \n        if (failed)\n            return;\n    }\n    local_failure = 0;\n    barrier(CLK_LOCAL_MEM_FENCE);\n    \n    int32_t local_tid_51091;\n    int32_t tblock_sizze_51094;\n    int32_t wave_sizze_51093;\n    int32_t block_id_51092;\n    int32_t global_tid_51090;\n    int64_t phys_tid_44044;\n    __local unsigned char *red_arr_bool_mem_51095;\n    int32_t phys_tblock_id_51097;\n    int32_t iterations_51098;\n    \n    local_tid_51091 = get_local_id(0);\n    tblock_sizze_51094 = get_local_size(0);\n    wave_sizze_51093 = LOCKSTEP_WIDTH;\n    block_id_51092 = get_tblock_id(0);\n    global_tid_51090 = block_id_51092 * tblock_sizze_51094 + local_tid_51091;\n    phys_tid_44044 = sext_i32_i64(global_tid_51090);\n    red_arr_bool_mem_51095 = ", "(__local unsigned char *) red_arr_bool_mem_51095_backing_0;\n    phys_tblock_id_51097 = get_tblock_id(0);\n    iterations_51098 = sdiv_up32(sext_i64_i32(sdiv_up64(n_new_27039, squot64(segred_tblock_sizze_44038, segment_sizze_nonzzero_51088))) - phys_tblock_id_51097, sext_i64_i32(num_tblocks_44039));\n    for (int32_t i_51099 = 0; i_51099 < iterations_51098; i_51099++) {\n        int32_t virt_tblock_id_51100;\n        int64_t slice_51101;\n        int64_t gtid_44042;\n        int64_t remnant_51102;\n        int64_t gtid_44043;\n        \n        virt_tblock_id_51100 = phys_tblock_id_51097 + i_51099 * sext_i64_i32(num_tblocks_44039);\n        slice_51101 = n_new_27039;\n        gtid_44042 = squot64(sext_i32_i64(local_tid_51091), segment_sizze_nonzzero_51088) + sext_i32_i64(virt_tblock_id_51100) * squot64(segred_tblock_sizze_44038, segment_sizze_nonzzero_51088);\n        remnant_51102 = squot64(sext_i32_i64(local_tid_51091), segment_sizze_nonzzero_51088) + sext_i32_i64(virt_tblock_id_51100) * squot64(segred_tblock_sizze_44038, segment_sizze_nonzzero_51088) - gtid_44042;\n        gtid_44043 = srem64(sext_i32_i64(local_tid_51091), (int64_t) 8);\n        // apply map function if in bounds\n        {\n            if (slt64((int64_t) 0, (int64_t) 8) && (slt64(gtid_44042, n_new_27039) && slt64(sext_i32_i64(local_tid_51091), (int64_t) 8 * squot64(segred_tblock_sizze_44038, segment_sizze_nonzzero_51088)))) {\n                // apply map function\n                {\n                    int64_t eta_p_44050 = ((__global int64_t *) mem_49450)[gtid_44043];\n                    bool cond_44051 = slt64(eta_p_44050, (int64_t) 0);\n                    bool lifted_lambda_res_44052;\n                    \n                    if (cond_44051) {\n                        lifted_lambda_res_44052 = 0;\n                    } else {\n                        int64_t zv_rhs_44053 = ((__global int64_t *) clBase_mem_49378)[(int64_t) 0];\n                        bool zzero_44054 = zv_rhs_44053 == (int64_t) 0;\n                 ",
                                    "       bool nonzzero_44055 = !zzero_44054;\n                        bool nonzzero_cert_44056;\n                        \n                        if (!nonzzero_44055) {\n                            {\n                                if (atomic_cmpxchg_i32_global(global_failure, -1, 12) == -1) {\n                                    ;\n                                }\n                                local_failure = 1;\n                                goto error_0;\n                            }\n                        }\n                        \n                        double eta_p_44048 = ((__global double *) new_xs_mem_49401)[gtid_44042];\n                        double eta_p_44049 = ((__global double *) new_ys_mem_49402)[gtid_44042];\n                        int64_t nxid_44057 = smod64(eta_p_44050, zv_rhs_44053);\n                        int64_t nyid_44058 = sdiv64(eta_p_44050, zv_rhs_44053);\n                        double times_arg1_44059 = ((__global double *) clBase_mem_49379)[(int64_t) 0];\n                        double i64_res_44060 = sitofp_i64_f64(nxid_44057);\n                        double zt_res_44061 = times_arg1_44059 * i64_res_44060;\n                        double plus_arg0_44062 = ((__global double *) clBase_mem_49377)[(int64_t) 0];\n                        double zp_res_44063 = zt_res_44061 + plus_arg0_44062;\n                        double times_arg1_44064 = ((__global double *) clBase_mem_49379)[(int64_t) 1];\n                        double i64_res_44065 = sitofp_i64_f64(nyid_44058);\n                        double zt_res_44066 = times_arg1_44064 * i64_res_44065;\n                        double plus_arg0_44067 = ((__global double *) clBase_mem_49377)[(int64_t) 1];\n                        double zp_res_44068 = zt_res_44066 + plus_arg0_44067;\n                        double zp_res_44069 = times_arg1_44059 + zp_res_44063;\n                        double zp_res_44070 = times_arg1_44064 + zp_res_44068;\n                        double zm_res_44071 = zp_res_44063 - zt_res_3880", "7;\n                        bool zgze_res_44072 = zm_res_44071 <= eta_p_44048;\n                        double zp_res_44073 = zt_res_38807 + zp_res_44069;\n                        bool zlze_res_44074 = eta_p_44048 <= zp_res_44073;\n                        bool x_44075 = zgze_res_44072 && zlze_res_44074;\n                        double zm_res_44076 = zp_res_44068 - zt_res_38807;\n                        bool zgze_res_44077 = zm_res_44076 <= eta_p_44049;\n                        double zp_res_44078 = zt_res_38807 + zp_res_44070;\n                        bool zlze_res_44079 = eta_p_44049 <= zp_res_44078;\n                        bool x_44080 = zgze_res_44077 && zlze_res_44079;\n                        bool x_44081 = x_44075 && x_44080;\n                        \n                        lifted_lambda_res_44052 = x_44081;\n                    }\n                    // save results to be reduced\n                    {\n                        ((__local bool *) red_arr_bool_mem_51095)[sext_i32_i64(local_tid_51091)] = lifted_lambda_res_44052;\n                    }\n                }\n            } else {\n                ((__local bool *) red_arr_bool_mem_51095)[sext_i32_i64(local_tid_51091)] = 0;\n            }\n        }\n        \n      error_0:\n        barrier(CLK_LOCAL_MEM_FENCE);\n        if (local_failure)\n            return;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        if (slt64((int64_t) 0, (int64_t) 8)) {\n            // perform segmented scan to imitate reduction\n            {\n                bool eta_p_44045;\n                bool eta_p_44046;\n                bool eta_p_51103;\n                bool eta_p_51104;\n                bool ltid_in_bounds_51106 = slt64(sext_i32_i64(local_tid_51091), (int64_t) 8 * squot64(segred_tblock_sizze_44038, segment_sizze_nonzzero_51088));\n                int32_t skip_threads_51107;\n                \n                // read input for in-block scan\n                {\n                    if (ltid_in_bounds_51106) {\n                        eta_p_44046 = ((volati", "le __local bool *) red_arr_bool_mem_51095)[sext_i32_i64(local_tid_51091)];\n                        if ((local_tid_51091 - squot32(local_tid_51091, 32) * 32) == 0) {\n                            eta_p_44045 = eta_p_44046;\n                        }\n                    }\n                }\n                // in-block scan (hopefully no barriers needed)\n                {\n                    skip_threads_51107 = 1;\n                    while (slt32(skip_threads_51107, 32)) {\n                        bool thread_active_51108 = sle32(skip_threads_51107, local_tid_51091 - squot32(local_tid_51091, 32) * 32) && ltid_in_bounds_51106;\n                        \n                        if (thread_active_51108) {\n                            // read operands\n                            {\n                                eta_p_44045 = ((volatile __local bool *) red_arr_bool_mem_51095)[sext_i32_i64(local_tid_51091) - sext_i32_i64(skip_threads_51107)];\n                            }\n                        }\n                        // perform operation\n                        {\n                            bool inactive_51109 = slt64(srem64(sext_i32_i64(local_tid_51091), (int64_t) 8), sext_i32_i64(local_tid_51091) - sext_i32_i64(local_tid_51091 - skip_threads_51107));\n                            \n                            if (thread_active_51108 && inactive_51109) {\n                                eta_p_44045 = eta_p_44046;\n                            }\n                            if (thread_active_51108) {\n                                if (!inactive_51109) {\n                                    bool defunc_0_op_res_44047 = eta_p_44045 || eta_p_44046;\n                                    \n                                    eta_p_44045 = defunc_0_op_res_44047;\n                                }\n                            }\n                        }\n                        if (sle32(wave_sizze_51093, skip_threads_51107)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n           ",
                                    "             }\n                        if (thread_active_51108) {\n                            // write result\n                            {\n                                ((volatile __local bool *) red_arr_bool_mem_51095)[sext_i32_i64(local_tid_51091)] = eta_p_44045;\n                                eta_p_44046 = eta_p_44045;\n                            }\n                        }\n                        if (sle32(wave_sizze_51093, skip_threads_51107)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        skip_threads_51107 *= 2;\n                    }\n                }\n                barrier(CLK_LOCAL_MEM_FENCE);\n                // last thread of block 'i' writes its result to offset 'i'\n                {\n                    if ((local_tid_51091 - squot32(local_tid_51091, 32) * 32) == 31 && ltid_in_bounds_51106) {\n                        ((volatile __local bool *) red_arr_bool_mem_51095)[sext_i32_i64(squot32(local_tid_51091, 32))] = eta_p_44045;\n                    }\n                }\n                barrier(CLK_LOCAL_MEM_FENCE);\n                // scan the first block, after which offset 'i' contains carry-in for block 'i+1'\n                {\n                    int32_t skip_threads_51110;\n                    \n                    // read input for in-block scan\n                    {\n                        if (squot32(local_tid_51091, 32) == 0 && ltid_in_bounds_51106) {\n                            eta_p_51104 = ((volatile __local bool *) red_arr_bool_mem_51095)[sext_i32_i64(local_tid_51091)];\n                            if ((local_tid_51091 - squot32(local_tid_51091, 32) * 32) == 0) {\n                                eta_p_51103 = eta_p_51104;\n                            }\n                        }\n                    }\n                    // in-block scan (hopefully no barriers needed)\n                    {\n                        skip_threads_51110 = 1;\n                        while (slt32(skip_threads_51110", ", 32)) {\n                            bool thread_active_51111 = sle32(skip_threads_51110, local_tid_51091 - squot32(local_tid_51091, 32) * 32) && (squot32(local_tid_51091, 32) == 0 && ltid_in_bounds_51106);\n                            \n                            if (thread_active_51111) {\n                                // read operands\n                                {\n                                    eta_p_51103 = ((volatile __local bool *) red_arr_bool_mem_51095)[sext_i32_i64(local_tid_51091) - sext_i32_i64(skip_threads_51110)];\n                                }\n                            }\n                            // perform operation\n                            {\n                                bool inactive_51112 = slt64(srem64(sext_i32_i64(local_tid_51091 * 32 + 32 - 1), (int64_t) 8), sext_i32_i64(local_tid_51091 * 32 + 32 - 1) - sext_i32_i64((local_tid_51091 - skip_threads_51110) * 32 + 32 - 1));\n                                \n                                if (thread_active_51111 && inactive_51112) {\n                                    eta_p_51103 = eta_p_51104;\n                                }\n                                if (thread_active_51111) {\n                                    if (!inactive_51112) {\n                                        bool defunc_0_op_res_51105 = eta_p_51103 || eta_p_51104;\n                                        \n                                        eta_p_51103 = defunc_0_op_res_51105;\n                                    }\n                                }\n                            }\n                            if (sle32(wave_sizze_51093, skip_threads_51110)) {\n                                barrier(CLK_LOCAL_MEM_FENCE);\n                            }\n                            if (thread_active_51111) {\n                                // write result\n                                {\n                                    ((volatile __local bool *) red_arr_bool_mem_51095)[sext_i32_i64(local_tid_51091)] = eta_", "p_51103;\n                                    eta_p_51104 = eta_p_51103;\n                                }\n                            }\n                            if (sle32(wave_sizze_51093, skip_threads_51110)) {\n                                barrier(CLK_LOCAL_MEM_FENCE);\n                            }\n                            skip_threads_51110 *= 2;\n                        }\n                    }\n                }\n                barrier(CLK_LOCAL_MEM_FENCE);\n                \n                bool no_carry_in_51113 = squot32(local_tid_51091, 32) == 0 || !ltid_in_bounds_51106;\n                \n                // carry-in for every block except the first\n                {\n                    // read operands\n                    {\n                        if (!no_carry_in_51113) {\n                            eta_p_44046 = eta_p_44045;\n                            eta_p_44045 = ((__local bool *) red_arr_bool_mem_51095)[sext_i32_i64(squot32(local_tid_51091, 32)) - (int64_t) 1];\n                        }\n                    }\n                    // perform operation\n                    {\n                        bool inactive_51114 = slt64(srem64(sext_i32_i64(local_tid_51091), (int64_t) 8), sext_i32_i64(local_tid_51091) - sext_i32_i64(squot32(local_tid_51091, 32) * 32 - 1));\n                        \n                        if (!no_carry_in_51113) {\n                            if (inactive_51114) {\n                                eta_p_44045 = eta_p_44046;\n                            }\n                        }\n                        if (!no_carry_in_51113) {\n                            if (!inactive_51114) {\n                                bool defunc_0_op_res_44047 = eta_p_44045 || eta_p_44046;\n                                \n                                eta_p_44045 = defunc_0_op_res_44047;\n                            }\n                        }\n                    }\n                    // write final result\n                    {\n                        if (!no_",
                                    "carry_in_51113) {\n                            ((__local bool *) red_arr_bool_mem_51095)[sext_i32_i64(local_tid_51091)] = eta_p_44045;\n                        }\n                    }\n                }\n                barrier(CLK_LOCAL_MEM_FENCE);\n                // restore correct values for first block\n                {\n                    if (squot32(local_tid_51091, 32) == 0 && ltid_in_bounds_51106) {\n                        ((__local bool *) red_arr_bool_mem_51095)[sext_i32_i64(local_tid_51091)] = eta_p_44046;\n                    }\n                }\n                barrier(CLK_LOCAL_MEM_FENCE);\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        // save final values of segments\n        {\n            if (slt64(sext_i32_i64(virt_tblock_id_51100) * squot64(segred_tblock_sizze_44038, segment_sizze_nonzzero_51088) + sext_i32_i64(local_tid_51091), n_new_27039) && slt64(sext_i32_i64(local_tid_51091), squot64(segred_tblock_sizze_44038, segment_sizze_nonzzero_51088))) {\n                bool tmp_51115 = ((__local bool *) red_arr_bool_mem_51095)[(sext_i32_i64(local_tid_51091) + (int64_t) 1) * segment_sizze_nonzzero_51088 - (int64_t) 1];\n                \n                ((__global bool *) mem_49533)[sext_i32_i64(virt_tblock_id_51100) * squot64(segred_tblock_sizze_44038, segment_sizze_nonzzero_51088) + sext_i32_i64(local_tid_51091)] = tmp_51115;\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    }\n    \n  error_3:\n    return;\n    #undef segred_tblock_sizze_44038\n}\nFUTHARK_KERNEL_SIZED(add_next_partition_doublezisegscan_43878_dim1, 1, 1)\nvoid add_next_partition_doublezisegscan_43878(__global int *global_failure, int64_t num_tblocks_43874, int64_t num_virt_blocks_50761, int64_t num_virt_threads_50762, __global unsigned char *ext_mem_49516, __global unsigned char *mem_49519, __global unsigned char *status_flags_mem_50763, __global unsigned char *aggregates_mem_50765, __global unsigned ch", "ar *incprefixes_mem_50767, __global unsigned char *global_dynid_mem_50769)\n{\n    #define segscan_tblock_sizze_43873 (add_next_partition_doublezisegscan_43878zisegscan_tblock_sizze_43873)\n    #define chunk_sizze_50760 (add_next_partition_doublezisegscan_43878zichunk_sizze_50760)\n    \n    volatile __local unsigned char *local_mem_50779_backing_0 = &shared_mem[0];\n    const int64_t local_mem_50779_backing_0_offset = 0 + (smax64(smax64((int64_t) 288, (int64_t) 8 * segscan_tblock_sizze_43873), chunk_sizze_50760 * segscan_tblock_sizze_43873 * (int64_t) 8) + srem64((int64_t) 8 - srem64(smax64(smax64((int64_t) 288, (int64_t) 8 * segscan_tblock_sizze_43873), chunk_sizze_50760 * segscan_tblock_sizze_43873 * (int64_t) 8), (int64_t) 8), (int64_t) 8));\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_50772;\n    int32_t tblock_sizze_50775;\n    int32_t wave_sizze_50774;\n    int32_t block_id_50773;\n    int32_t global_tid_50771;\n    int64_t phys_tid_43878;\n    int32_t chunk_sizze_32b_50776;\n    int64_t byte_offsets_50777;\n    int64_t warp_byte_offset_50778;\n    __local unsigned char *local_mem_50779;\n    int64_t trans_arr_len_50780;\n    int64_t phys_block_id_50786;\n    int64_t virtloop_bound_50787;\n    \n    local_tid_50772 = get_local_id(0);\n    tblock_sizze_50775 = get_local_size(0);\n    wave_sizze_50774 = LOCKSTEP_WIDTH;\n    block_id_50773 = get_tblock_id(0);\n    global_tid_50771 = block_id_50773 * tblock_sizze_50775 + local_tid_50772;\n    phys_tid_43878 = sext_i32_i64(global_tid_50771);\n    chunk_sizze_32b_50776 = sext_i64_i32(chunk_sizze_50760);\n    byte_offsets_50777 = segscan_tblock_sizze_43873 * (int64_t) 8;\n    warp_byte_offset_50778 = (int64_t) 288;\n    // Allocate reusable shared memory\n    { }\n    local_mem_50779 = (__local unsigned char *) local_mem_50779_backing_0;\n    trans_arr_len_50780 = chunk_sizze_50760 * segscan_tblock_sizze_43873;\n    phys_block_id_50786 = get_tblock_id(0);\n    virtloop_bound_50787 = sdiv_up64(num_virt_blocks_50761 - ", "phys_block_id_50786, num_tblocks_43874);\n    for (int64_t virtloop_i_50788 = 0; virtloop_i_50788 < virtloop_bound_50787; virtloop_i_50788++) {\n        int64_t dynamic_id_50789;\n        int64_t block_offset_50790;\n        int64_t sgm_idx_50791;\n        int32_t boundary_50792;\n        int32_t segsizze_compact_50793;\n        int64_t private_mem_50794[chunk_sizze_50760];\n        int64_t thd_offset_50796;\n        int64_t acc_50812;\n        int64_t prefix_50822;\n        bool block_new_sgm_50823;\n        \n        // First thread in block fetches this block's dynamic_id\n        {\n            if (local_tid_50772 == 0) {\n                dynamic_id_50789 = atomic_add_i32_global(&((volatile __global int *) global_dynid_mem_50769)[(int64_t) 0], (int) 1);\n                // Set dynamic id for this block\n                {\n                    ((__local int64_t *) local_mem_50779)[(int64_t) 0] = dynamic_id_50789;\n                }\n                // First thread in last (virtual) block resets global dynamic_id\n                {\n                    if (dynamic_id_50789 == num_virt_blocks_50761 - (int64_t) 1) {\n                        ((__global int32_t *) global_dynid_mem_50769)[(int64_t) 0] = 0;\n                    }\n                }\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        dynamic_id_50789 = ((__local int32_t *) local_mem_50779)[(int64_t) 0];\n        barrier(CLK_LOCAL_MEM_FENCE);\n        block_offset_50790 = dynamic_id_50789 * chunk_sizze_50760 * segscan_tblock_sizze_43873;\n        sgm_idx_50791 = smod64(block_offset_50790, (int64_t) 8);\n        boundary_50792 = sext_i64_i32(smin64(chunk_sizze_50760 * segscan_tblock_sizze_43873, (int64_t) 8 - sgm_idx_50791));\n        segsizze_compact_50793 = sext_i64_i32(smin64(chunk_sizze_50760 * segscan_tblock_sizze_43873, (int64_t) 8));\n        thd_offset_50796 = block_offset_50790 + sext_i32_i64(local_tid_50772);\n        // Load and map\n        {\n            for (int64_t i_50797 = 0; i_50797 < chunk_sizze_50760; i_",
                                    "50797++) {\n                int64_t virt_tid_50798 = thd_offset_50796 + i_50797 * segscan_tblock_sizze_43873;\n                int64_t slice_50799 = (int64_t) 8;\n                int64_t gtid_43877 = virt_tid_50798;\n                int64_t remnant_50800 = virt_tid_50798 - gtid_43877;\n                \n                if (slt64(virt_tid_50798, (int64_t) 8)) {\n                    int64_t x_43882 = ((__global int64_t *) ext_mem_49516)[gtid_43877];\n                    \n                    private_mem_50794[i_50797] = x_43882;\n                } else {\n                    private_mem_50794[i_50797] = (int64_t) 0;\n                }\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        // Transpose scan inputs\n        {\n            for (int64_t i_50801 = 0; i_50801 < chunk_sizze_50760; i_50801++) {\n                int64_t sharedIdx_50802 = sext_i32_i64(local_tid_50772) + i_50801 * segscan_tblock_sizze_43873;\n                int64_t tmp_50803 = private_mem_50794[i_50801];\n                \n                ((__local int64_t *) local_mem_50779)[sharedIdx_50802] = tmp_50803;\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            for (int64_t i_50804 = 0; i_50804 < chunk_sizze_50760; i_50804++) {\n                int64_t sharedIdx_50805 = sext_i32_i64(local_tid_50772) * chunk_sizze_50760 + i_50804;\n                int64_t tmp_50806 = ((__local int64_t *) local_mem_50779)[sharedIdx_50805];\n                \n                private_mem_50794[i_50804] = tmp_50806;\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n        }\n        // Per thread scan\n        {\n            for (int64_t i_50807 = 0; i_50807 < chunk_sizze_50760 - (int64_t) 1; i_50807++) {\n                int64_t eta_p_43879;\n                int64_t eta_p_43880;\n                \n                eta_p_43879 = private_mem_50794[i_50807];\n                eta_p_43880 = private_mem_50794[i_50807 + (int64_t) 1];\n                \n                int64_t defunc_0_op_res_43881 = add64(eta_p_43879, eta", "_p_43880);\n                \n                private_mem_50794[i_50807 + (int64_t) 1] = defunc_0_op_res_43881;\n            }\n        }\n        // Publish results in shared memory\n        {\n            int64_t tmp_50808 = private_mem_50794[chunk_sizze_50760 - (int64_t) 1];\n            \n            ((__local int64_t *) local_mem_50779)[sext_i32_i64(local_tid_50772)] = tmp_50808;\n            barrier(CLK_LOCAL_MEM_FENCE);\n        }\n        // Scan results (with warp scan)\n        {\n            int64_t eta_p_50809;\n            int64_t eta_p_50810;\n            int64_t eta_p_50813;\n            int64_t eta_p_50814;\n            bool ltid_in_bounds_50816 = slt64(sext_i32_i64(local_tid_50772), num_virt_threads_50762);\n            int32_t skip_threads_50817;\n            \n            // read input for in-block scan\n            {\n                if (ltid_in_bounds_50816) {\n                    eta_p_50810 = ((volatile __local int64_t *) local_mem_50779)[sext_i32_i64(local_tid_50772)];\n                    if ((local_tid_50772 - squot32(local_tid_50772, 32) * 32) == 0) {\n                        eta_p_50809 = eta_p_50810;\n                    }\n                }\n            }\n            // in-block scan (hopefully no barriers needed)\n            {\n                skip_threads_50817 = 1;\n                while (slt32(skip_threads_50817, 32)) {\n                    bool thread_active_50818 = sle32(skip_threads_50817, local_tid_50772 - squot32(local_tid_50772, 32) * 32) && ltid_in_bounds_50816;\n                    \n                    if (thread_active_50818) {\n                        // read operands\n                        {\n                            eta_p_50809 = ((volatile __local int64_t *) local_mem_50779)[sext_i32_i64(local_tid_50772) - sext_i32_i64(skip_threads_50817)];\n                        }\n                    }\n                    // perform operation\n                    {\n                        if (thread_active_50818) {\n                            int64_t defunc_0_op_res", "_50811 = add64(eta_p_50809, eta_p_50810);\n                            \n                            eta_p_50809 = defunc_0_op_res_50811;\n                        }\n                    }\n                    if (sle32(wave_sizze_50774, skip_threads_50817)) {\n                        barrier(CLK_LOCAL_MEM_FENCE);\n                    }\n                    if (thread_active_50818) {\n                        // write result\n                        {\n                            ((volatile __local int64_t *) local_mem_50779)[sext_i32_i64(local_tid_50772)] = eta_p_50809;\n                            eta_p_50810 = eta_p_50809;\n                        }\n                    }\n                    if (sle32(wave_sizze_50774, skip_threads_50817)) {\n                        barrier(CLK_LOCAL_MEM_FENCE);\n                    }\n                    skip_threads_50817 *= 2;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // last thread of block 'i' writes its result to offset 'i'\n            {\n                if ((local_tid_50772 - squot32(local_tid_50772, 32) * 32) == 31 && ltid_in_bounds_50816) {\n                    ((volatile __local int64_t *) local_mem_50779)[sext_i32_i64(squot32(local_tid_50772, 32))] = eta_p_50809;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // scan the first block, after which offset 'i' contains carry-in for block 'i+1'\n            {\n                int32_t skip_threads_50819;\n                \n                // read input for in-block scan\n                {\n                    if (squot32(local_tid_50772, 32) == 0 && ltid_in_bounds_50816) {\n                        eta_p_50814 = ((volatile __local int64_t *) local_mem_50779)[sext_i32_i64(local_tid_50772)];\n                        if ((local_tid_50772 - squot32(local_tid_50772, 32) * 32) == 0) {\n                            eta_p_50813 = eta_p_50814;\n                        }\n                    }\n                }\n                // in-blo",
                                    "ck scan (hopefully no barriers needed)\n                {\n                    skip_threads_50819 = 1;\n                    while (slt32(skip_threads_50819, 32)) {\n                        bool thread_active_50820 = sle32(skip_threads_50819, local_tid_50772 - squot32(local_tid_50772, 32) * 32) && (squot32(local_tid_50772, 32) == 0 && ltid_in_bounds_50816);\n                        \n                        if (thread_active_50820) {\n                            // read operands\n                            {\n                                eta_p_50813 = ((volatile __local int64_t *) local_mem_50779)[sext_i32_i64(local_tid_50772) - sext_i32_i64(skip_threads_50819)];\n                            }\n                        }\n                        // perform operation\n                        {\n                            if (thread_active_50820) {\n                                int64_t defunc_0_op_res_50815 = add64(eta_p_50813, eta_p_50814);\n                                \n                                eta_p_50813 = defunc_0_op_res_50815;\n                            }\n                        }\n                        if (sle32(wave_sizze_50774, skip_threads_50819)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        if (thread_active_50820) {\n                            // write result\n                            {\n                                ((volatile __local int64_t *) local_mem_50779)[sext_i32_i64(local_tid_50772)] = eta_p_50813;\n                                eta_p_50814 = eta_p_50813;\n                            }\n                        }\n                        if (sle32(wave_sizze_50774, skip_threads_50819)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        skip_threads_50819 *= 2;\n                    }\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            \n            bool no_carry_in_50821 = squot32(local_tid_5", "0772, 32) == 0 || !ltid_in_bounds_50816;\n            \n            // carry-in for every block except the first\n            {\n                // read operands\n                {\n                    if (!no_carry_in_50821) {\n                        eta_p_50810 = eta_p_50809;\n                        eta_p_50809 = ((__local int64_t *) local_mem_50779)[sext_i32_i64(squot32(local_tid_50772, 32)) - (int64_t) 1];\n                    }\n                }\n                // perform operation\n                {\n                    if (!no_carry_in_50821) {\n                        int64_t defunc_0_op_res_50811 = add64(eta_p_50809, eta_p_50810);\n                        \n                        eta_p_50809 = defunc_0_op_res_50811;\n                    }\n                }\n                // write final result\n                {\n                    if (!no_carry_in_50821) {\n                        ((__local int64_t *) local_mem_50779)[sext_i32_i64(local_tid_50772)] = eta_p_50809;\n                    }\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // restore correct values for first block\n            {\n                if (squot32(local_tid_50772, 32) == 0 && ltid_in_bounds_50816) {\n                    ((__local int64_t *) local_mem_50779)[sext_i32_i64(local_tid_50772)] = eta_p_50810;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            barrier(CLK_LOCAL_MEM_FENCE);\n            if (local_tid_50772 == 0) {\n                acc_50812 = ((__local int64_t *) local_mem_50779)[segscan_tblock_sizze_43873 - (int64_t) 1];\n            } else {\n                acc_50812 = ((__local int64_t *) local_mem_50779)[sext_i32_i64(local_tid_50772) - (int64_t) 1];\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n        }\n        prefix_50822 = (int64_t) 0;\n        block_new_sgm_50823 = sgm_idx_50791 == (int64_t) 0;\n        // Perform lookback\n        {\n            if (block_new_sgm_50823 && local_tid_50772 == 0) {\n                ", "((volatile __global int64_t *) incprefixes_mem_50767)[dynamic_id_50789] = acc_50812;\n                mem_fence_global();\n                ((volatile __global int8_t *) status_flags_mem_50763)[dynamic_id_50789] = (int8_t) 2;\n                acc_50812 = (int64_t) 0;\n            }\n            if (!block_new_sgm_50823 && slt32(local_tid_50772, wave_sizze_50774)) {\n                if (local_tid_50772 == 0) {\n                    ((volatile __global int64_t *) aggregates_mem_50765)[dynamic_id_50789] = acc_50812;\n                    mem_fence_global();\n                    ((volatile __global int8_t *) status_flags_mem_50763)[dynamic_id_50789] = (int8_t) 1;\n                    \n                    int8_t tmp_50824 = ((volatile __global int8_t *) status_flags_mem_50763)[dynamic_id_50789 - (int64_t) 1];\n                    \n                    ((volatile __local int8_t *) local_mem_50779)[(int64_t) 0] = tmp_50824;\n                }\n                mem_fence_local();\n                \n                int8_t status_50825 = ((__local int8_t *) local_mem_50779)[(int64_t) 0];\n                \n                if (status_50825 == (int8_t) 2) {\n                    if (local_tid_50772 == 0) {\n                        prefix_50822 = ((volatile __global int64_t *) incprefixes_mem_50767)[dynamic_id_50789 - (int64_t) 1];\n                    }\n                } else {\n                    int32_t readOffset_50826 = sext_i64_i32(dynamic_id_50789 - sext_i32_i64(wave_sizze_50774));\n                    \n                    while (slt32(wave_sizze_50774 * -1, readOffset_50826)) {\n                        int32_t read_i_50827 = readOffset_50826 + local_tid_50772;\n                        int64_t aggr_50828 = (int64_t) 0;\n                        int8_t flag_50829 = (int8_t) 0;\n                        \n                        if (sle32(0, read_i_50827)) {\n                            flag_50829 = ((volatile __global int8_t *) status_flags_mem_50763)[sext_i32_i64(read_i_50827)];\n                           ",
                                    " if (flag_50829 == (int8_t) 2) {\n                                aggr_50828 = ((volatile __global int64_t *) incprefixes_mem_50767)[sext_i32_i64(read_i_50827)];\n                            } else if (flag_50829 == (int8_t) 1) {\n                                aggr_50828 = ((volatile __global int64_t *) aggregates_mem_50765)[sext_i32_i64(read_i_50827)];\n                            }\n                        }\n                        ((__local int64_t *) local_mem_50779)[(int64_t) 4 + sext_i32_i64(local_tid_50772)] = aggr_50828;\n                        ((__local int8_t *) local_mem_50779)[sext_i32_i64(local_tid_50772)] = flag_50829;\n                        flag_50829 = ((__local int8_t *) local_mem_50779)[sext_i32_i64(wave_sizze_50774) - (int64_t) 1];\n                        if (slt8(flag_50829, (int8_t) 2)) {\n                            int8_t flg_x_50833;\n                            int8_t flg_y_50834;\n                            int64_t eta_p_50830;\n                            int64_t eta_p_50831;\n                            int32_t skip_threads_50835;\n                            \n                            // read input for in-block scan\n                            {\n                                flg_y_50834 = ((volatile __local int8_t *) local_mem_50779)[sext_i32_i64(local_tid_50772)];\n                                eta_p_50831 = ((volatile __local int64_t *) local_mem_50779)[(int64_t) 4 + sext_i32_i64(local_tid_50772)];\n                                if ((local_tid_50772 - squot32(local_tid_50772, 32) * 32) == 0) {\n                                    eta_p_50830 = eta_p_50831;\n                                    flg_x_50833 = flg_y_50834;\n                                }\n                            }\n                            // in-block scan (hopefully no barriers needed)\n                            {\n                                skip_threads_50835 = 1;\n                                while (slt32(skip_threads_50835, 32)) {\n                           ", "         if (sle32(skip_threads_50835, local_tid_50772 - squot32(local_tid_50772, 32) * 32)) {\n                                        // read operands\n                                        {\n                                            flg_x_50833 = ((volatile __local int8_t *) local_mem_50779)[sext_i32_i64(local_tid_50772) - sext_i32_i64(skip_threads_50835)];\n                                            eta_p_50830 = ((volatile __local int64_t *) local_mem_50779)[(int64_t) 4 + (sext_i32_i64(local_tid_50772) - sext_i32_i64(skip_threads_50835))];\n                                        }\n                                        // perform operation\n                                        {\n                                            if (flg_y_50834 == (int8_t) 2 || flg_y_50834 == (int8_t) 0) {\n                                                flg_x_50833 = flg_y_50834;\n                                                eta_p_50830 = eta_p_50831;\n                                            } else {\n                                                int64_t defunc_0_op_res_50832 = add64(eta_p_50830, eta_p_50831);\n                                                \n                                                eta_p_50830 = defunc_0_op_res_50832;\n                                            }\n                                        }\n                                        // write result\n                                        {\n                                            ((volatile __local int8_t *) local_mem_50779)[sext_i32_i64(local_tid_50772)] = flg_x_50833;\n                                            flg_y_50834 = flg_x_50833;\n                                            ((volatile __local int64_t *) local_mem_50779)[(int64_t) 4 + sext_i32_i64(local_tid_50772)] = eta_p_50830;\n                                            eta_p_50831 = eta_p_50830;\n                                        }\n                                    }\n                                    skip_threads_50", "835 *= 2;\n                                }\n                            }\n                        }\n                        flag_50829 = ((__local int8_t *) local_mem_50779)[sext_i32_i64(wave_sizze_50774) - (int64_t) 1];\n                        aggr_50828 = ((__local int64_t *) local_mem_50779)[(int64_t) 4 + (sext_i32_i64(wave_sizze_50774) - (int64_t) 1)];\n                        if (flag_50829 == (int8_t) 2) {\n                            readOffset_50826 = wave_sizze_50774 * -1;\n                        } else if (flag_50829 == (int8_t) 1) {\n                            readOffset_50826 -= wave_sizze_50774;\n                        }\n                        if (slt8((int8_t) 0, flag_50829)) {\n                            int64_t eta_p_50836 = aggr_50828;\n                            int64_t eta_p_50837 = prefix_50822;\n                            int64_t defunc_0_op_res_50838 = add64(eta_p_50836, eta_p_50837);\n                            \n                            prefix_50822 = defunc_0_op_res_50838;\n                        }\n                        mem_fence_local();\n                    }\n                }\n                if (local_tid_50772 == 0) {\n                    if (boundary_50792 == sext_i64_i32(segscan_tblock_sizze_43873 * chunk_sizze_50760)) {\n                        int64_t eta_p_50839 = prefix_50822;\n                        int64_t eta_p_50840 = acc_50812;\n                        int64_t defunc_0_op_res_50841 = add64(eta_p_50839, eta_p_50840);\n                        \n                        ((volatile __global int64_t *) incprefixes_mem_50767)[dynamic_id_50789] = defunc_0_op_res_50841;\n                        mem_fence_global();\n                        ((volatile __global int8_t *) status_flags_mem_50763)[dynamic_id_50789] = (int8_t) 2;\n                    }\n                    ((__local int64_t *) local_mem_50779)[(int64_t) 4] = prefix_50822;\n                    acc_50812 = (int64_t) 0;\n                }\n            }\n            if (!(dynamic_id_50789 ",
                                    "== (int64_t) 0)) {\n                barrier(CLK_LOCAL_MEM_FENCE);\n                prefix_50822 = ((__local int64_t *) local_mem_50779)[(int64_t) 4];\n                barrier(CLK_LOCAL_MEM_FENCE);\n            }\n        }\n        // Distribute results\n        {\n            int64_t eta_p_50842;\n            int64_t eta_p_50843;\n            int64_t eta_p_50845 = prefix_50822;\n            int64_t eta_p_50846 = acc_50812;\n            \n            if (slt32(local_tid_50772 * chunk_sizze_32b_50776, boundary_50792) && !block_new_sgm_50823) {\n                int64_t defunc_0_op_res_50847 = add64(eta_p_50845, eta_p_50846);\n                \n                eta_p_50842 = defunc_0_op_res_50847;\n            } else {\n                eta_p_50842 = acc_50812;\n            }\n            \n            int32_t stopping_point_50848 = segsizze_compact_50793 - srem32(local_tid_50772 * chunk_sizze_32b_50776 - 1 + segsizze_compact_50793 - boundary_50792, segsizze_compact_50793);\n            \n            for (int64_t i_50849 = 0; i_50849 < chunk_sizze_50760; i_50849++) {\n                if (slt32(sext_i64_i32(i_50849), stopping_point_50848 - 1)) {\n                    eta_p_50843 = private_mem_50794[i_50849];\n                    \n                    int64_t defunc_0_op_res_50844 = add64(eta_p_50842, eta_p_50843);\n                    \n                    private_mem_50794[i_50849] = defunc_0_op_res_50844;\n                }\n            }\n        }\n        // Transpose scan output and Write it to global memory in coalesced fashion\n        {\n            for (int64_t i_50850 = 0; i_50850 < chunk_sizze_50760; i_50850++) {\n                int64_t sharedIdx_50851 = sext_i32_i64(local_tid_50772) * chunk_sizze_50760 + i_50850;\n                int64_t tmp_50852 = private_mem_50794[i_50850];\n                \n                ((__local int64_t *) local_mem_50779)[sharedIdx_50851] = tmp_50852;\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            for (int64_t i_50853 = 0; i_50853 < chunk_sizze_50760", "; i_50853++) {\n                int64_t flat_idx_50854 = thd_offset_50796 + i_50853 * segscan_tblock_sizze_43873;\n                int64_t slice_50855 = (int64_t) 8;\n                int64_t gtid_43877 = flat_idx_50854;\n                int64_t remnant_50856 = flat_idx_50854 - gtid_43877;\n                \n                if (slt64(flat_idx_50854, (int64_t) 8)) {\n                    int64_t tmp_50857 = ((__local int64_t *) local_mem_50779)[flat_idx_50854 - block_offset_50790];\n                    \n                    ((__global int64_t *) mem_49519)[gtid_43877] = tmp_50857;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n        }\n    }\n    \n  error_3:\n    return;\n    #undef segscan_tblock_sizze_43873\n    #undef chunk_sizze_50760\n}\nFUTHARK_KERNEL_SIZED(add_next_partition_doublezisegscan_44184_dim1, 1, 1)\nvoid add_next_partition_doublezisegscan_44184(__global int *global_failure, int64_t n_old_27030, int64_t num_tblocks_44181, int64_t num_virt_blocks_50243, int64_t num_virt_threads_50244, __global unsigned char *current_partition_mem_49392, __global unsigned char *mem_49410, __global unsigned char *mem_49412, __global unsigned char *mem_49414, __global unsigned char *status_flags_mem_50245, __global unsigned char *aggregates_mem_50267, __global unsigned char *incprefixes_mem_50269, __global unsigned char *aggregates_mem_50271, __global unsigned char *incprefixes_mem_50273, __global unsigned char *global_dynid_mem_50275)\n{\n    #define segscan_tblock_sizze_44179 (add_next_partition_doublezisegscan_44184zisegscan_tblock_sizze_44179)\n    #define chunk_sizze_50242 (add_next_partition_doublezisegscan_44184zichunk_sizze_50242)\n    \n    volatile __local unsigned char *local_mem_50307_backing_0 = &shared_mem[0];\n    const int64_t local_mem_50307_backing_0_offset = 0 + (smax64(smax64((int64_t) 544, sdiv_up64((int64_t) 8 * segscan_tblock_sizze_44179, (int64_t) 8) * (int64_t) 8 + (int64_t) 8 * segscan_tblock_sizze_44179), smax64(chunk_sizze_50242 * segscan_t", "block_sizze_44179 * (int64_t) 8, chunk_sizze_50242 * segscan_tblock_sizze_44179 * (int64_t) 8)) + srem64((int64_t) 8 - srem64(smax64(smax64((int64_t) 544, sdiv_up64((int64_t) 8 * segscan_tblock_sizze_44179, (int64_t) 8) * (int64_t) 8 + (int64_t) 8 * segscan_tblock_sizze_44179), smax64(chunk_sizze_50242 * segscan_tblock_sizze_44179 * (int64_t) 8, chunk_sizze_50242 * segscan_tblock_sizze_44179 * (int64_t) 8)), (int64_t) 8), (int64_t) 8));\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_50298;\n    int32_t tblock_sizze_50301;\n    int32_t wave_sizze_50300;\n    int32_t block_id_50299;\n    int32_t global_tid_50297;\n    int64_t phys_tid_44184;\n    int32_t chunk_sizze_32b_50302;\n    int64_t byte_offsets_50303;\n    int64_t byte_offsets_50304;\n    int64_t warp_byte_offset_50305;\n    int64_t warp_byte_offset_50306;\n    __local unsigned char *local_mem_50307;\n    int64_t trans_arr_len_50308;\n    int64_t phys_block_id_50317;\n    int64_t virtloop_bound_50318;\n    \n    local_tid_50298 = get_local_id(0);\n    tblock_sizze_50301 = get_local_size(0);\n    wave_sizze_50300 = LOCKSTEP_WIDTH;\n    block_id_50299 = get_tblock_id(0);\n    global_tid_50297 = block_id_50299 * tblock_sizze_50301 + local_tid_50298;\n    phys_tid_44184 = sext_i32_i64(global_tid_50297);\n    chunk_sizze_32b_50302 = sext_i64_i32(chunk_sizze_50242);\n    byte_offsets_50303 = segscan_tblock_sizze_44179 * (int64_t) 8;\n    byte_offsets_50304 = sdiv_up64(byte_offsets_50303, (int64_t) 8) * (int64_t) 8 + segscan_tblock_sizze_44179 * (int64_t) 8;\n    warp_byte_offset_50305 = (int64_t) 288;\n    warp_byte_offset_50306 = sdiv_up64(warp_byte_offset_50305, (int64_t) 8) * (int64_t) 8 + (int64_t) 256;\n    // Allocate reusable shared memory\n    { }\n    local_mem_50307 = (__local unsigned char *) local_mem_50307_backing_0;\n    trans_arr_len_50308 = chunk_sizze_50242 * segscan_tblock_sizze_44179;\n    phys_block_id_50317 = get_tblock_id(0);\n    virtloop_bound_50318 = sdiv_up64(num_virt_blocks_50243 - phys_blo",
                                    "ck_id_50317, num_tblocks_44181);\n    for (int64_t virtloop_i_50319 = 0; virtloop_i_50319 < virtloop_bound_50318; virtloop_i_50319++) {\n        int64_t dynamic_id_50320;\n        int64_t block_offset_50321;\n        int64_t sgm_idx_50322;\n        int32_t boundary_50323;\n        int32_t segsizze_compact_50324;\n        int64_t private_mem_50325[chunk_sizze_50242];\n        int64_t private_mem_50327[chunk_sizze_50242];\n        int64_t thd_offset_50329;\n        int64_t acc_50355;\n        int64_t acc_50356;\n        int64_t prefix_50369;\n        int64_t prefix_50370;\n        bool block_new_sgm_50371;\n        \n        // First thread in block fetches this block's dynamic_id\n        {\n            if (local_tid_50298 == 0) {\n                dynamic_id_50320 = atomic_add_i32_global(&((volatile __global int *) global_dynid_mem_50275)[(int64_t) 0], (int) 1);\n                // Set dynamic id for this block\n                {\n                    ((__local int64_t *) local_mem_50307)[(int64_t) 0] = dynamic_id_50320;\n                }\n                // First thread in last (virtual) block resets global dynamic_id\n                {\n                    if (dynamic_id_50320 == num_virt_blocks_50243 - (int64_t) 1) {\n                        ((__global int32_t *) global_dynid_mem_50275)[(int64_t) 0] = 0;\n                    }\n                }\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        dynamic_id_50320 = ((__local int32_t *) local_mem_50307)[(int64_t) 0];\n        barrier(CLK_LOCAL_MEM_FENCE);\n        block_offset_50321 = dynamic_id_50320 * chunk_sizze_50242 * segscan_tblock_sizze_44179;\n        sgm_idx_50322 = smod64(block_offset_50321, n_old_27030);\n        boundary_50323 = sext_i64_i32(smin64(chunk_sizze_50242 * segscan_tblock_sizze_44179, n_old_27030 - sgm_idx_50322));\n        segsizze_compact_50324 = sext_i64_i32(smin64(chunk_sizze_50242 * segscan_tblock_sizze_44179, n_old_27030));\n        thd_offset_50329 = block_offset_50321 + sext_i32_i64(local_tid_50298);\n", "        // Load and map\n        {\n            for (int64_t i_50330 = 0; i_50330 < chunk_sizze_50242; i_50330++) {\n                int64_t virt_tid_50331 = thd_offset_50329 + i_50330 * segscan_tblock_sizze_44179;\n                int64_t slice_50332 = n_old_27030;\n                int64_t gtid_44183 = virt_tid_50331;\n                int64_t remnant_50333 = virt_tid_50331 - gtid_44183;\n                \n                if (slt64(virt_tid_50331, n_old_27030)) {\n                    bool x_42269 = ((__global bool *) current_partition_mem_49392)[gtid_44183];\n                    bool cond_neg_42270 = !x_42269;\n                    int64_t defunc_0_lifted_pzq_res_42271 = btoi_bool_i64(cond_neg_42270);\n                    bool is_i_42272 = defunc_0_lifted_pzq_res_42271 == (int64_t) 0;\n                    int64_t part_res_42273 = btoi_bool_i64(is_i_42272);\n                    int64_t part_res_42274;\n                    int64_t part_res_42275;\n                    \n                    if (is_i_42272) {\n                        part_res_42274 = (int64_t) 0;\n                        part_res_42275 = (int64_t) 0;\n                    } else {\n                        bool is_i_42276 = defunc_0_lifted_pzq_res_42271 == (int64_t) 1;\n                        int64_t part_res_42277;\n                        \n                        if (is_i_42276) {\n                            part_res_42277 = (int64_t) 1;\n                        } else {\n                            part_res_42277 = (int64_t) 2;\n                        }\n                        \n                        int64_t part_res_42278 = btoi_bool_i64(is_i_42276);\n                        \n                        part_res_42274 = part_res_42277;\n                        part_res_42275 = part_res_42278;\n                    }\n                    ((__global int64_t *) mem_49414)[gtid_44183] = part_res_42274;\n                    private_mem_50325[i_50330] = part_res_42273;\n                    private_mem_50327[i_50330] = part_res_42275;\n        ", "        } else {\n                    private_mem_50325[i_50330] = (int64_t) 0;\n                    private_mem_50327[i_50330] = (int64_t) 0;\n                }\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        // Transpose scan inputs\n        {\n            for (int64_t i_50334 = 0; i_50334 < chunk_sizze_50242; i_50334++) {\n                int64_t sharedIdx_50335 = sext_i32_i64(local_tid_50298) + i_50334 * segscan_tblock_sizze_44179;\n                int64_t tmp_50336 = private_mem_50325[i_50334];\n                \n                ((__local int64_t *) local_mem_50307)[sharedIdx_50335] = tmp_50336;\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            for (int64_t i_50337 = 0; i_50337 < chunk_sizze_50242; i_50337++) {\n                int64_t sharedIdx_50338 = sext_i32_i64(local_tid_50298) * chunk_sizze_50242 + i_50337;\n                int64_t tmp_50339 = ((__local int64_t *) local_mem_50307)[sharedIdx_50338];\n                \n                private_mem_50325[i_50337] = tmp_50339;\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            for (int64_t i_50340 = 0; i_50340 < chunk_sizze_50242; i_50340++) {\n                int64_t sharedIdx_50341 = sext_i32_i64(local_tid_50298) + i_50340 * segscan_tblock_sizze_44179;\n                int64_t tmp_50342 = private_mem_50327[i_50340];\n                \n                ((__local int64_t *) local_mem_50307)[sharedIdx_50341] = tmp_50342;\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            for (int64_t i_50343 = 0; i_50343 < chunk_sizze_50242; i_50343++) {\n                int64_t sharedIdx_50344 = sext_i32_i64(local_tid_50298) * chunk_sizze_50242 + i_50343;\n                int64_t tmp_50345 = ((__local int64_t *) local_mem_50307)[sharedIdx_50344];\n                \n                private_mem_50327[i_50343] = tmp_50345;\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n        }\n        // Per thread scan\n        {\n            for (int64_t i_50346 = 0; i_50346 < chunk_s",
                                    "izze_50242 - (int64_t) 1; i_50346++) {\n                int64_t x_39108;\n                int64_t y_39110;\n                \n                x_39108 = private_mem_50325[i_50346];\n                y_39110 = private_mem_50325[i_50346 + (int64_t) 1];\n                \n                int64_t x_39109;\n                int64_t y_39111;\n                \n                x_39109 = private_mem_50327[i_50346];\n                y_39111 = private_mem_50327[i_50346 + (int64_t) 1];\n                \n                int64_t zz_39112 = x_39108 + y_39110;\n                int64_t zz_39113 = x_39109 + y_39111;\n                \n                private_mem_50325[i_50346 + (int64_t) 1] = zz_39112;\n                private_mem_50327[i_50346 + (int64_t) 1] = zz_39113;\n            }\n        }\n        // Publish results in shared memory\n        {\n            int64_t tmp_50347 = private_mem_50325[chunk_sizze_50242 - (int64_t) 1];\n            \n            ((__local int64_t *) local_mem_50307)[sext_i32_i64(local_tid_50298)] = tmp_50347;\n            \n            int64_t tmp_50348 = private_mem_50327[chunk_sizze_50242 - (int64_t) 1];\n            \n            ((__local int64_t *) local_mem_50307)[squot64(byte_offsets_50303, (int64_t) 8) + sext_i32_i64(local_tid_50298)] = tmp_50348;\n            barrier(CLK_LOCAL_MEM_FENCE);\n        }\n        // Scan results (with warp scan)\n        {\n            int64_t x_50349;\n            int64_t x_50350;\n            int64_t y_50351;\n            int64_t y_50352;\n            int64_t x_50357;\n            int64_t x_50358;\n            int64_t y_50359;\n            int64_t y_50360;\n            bool ltid_in_bounds_50363 = slt64(sext_i32_i64(local_tid_50298), num_virt_threads_50244);\n            int32_t skip_threads_50364;\n            \n            // read input for in-block scan\n            {\n                if (ltid_in_bounds_50363) {\n                    y_50351 = ((volatile __local int64_t *) local_mem_50307)[sext_i32_i64(local_tid_50298)];\n                    y_50352 = ((volat", "ile __local int64_t *) local_mem_50307)[squot64(byte_offsets_50303, (int64_t) 8) + sext_i32_i64(local_tid_50298)];\n                    if ((local_tid_50298 - squot32(local_tid_50298, 32) * 32) == 0) {\n                        x_50349 = y_50351;\n                        x_50350 = y_50352;\n                    }\n                }\n            }\n            // in-block scan (hopefully no barriers needed)\n            {\n                skip_threads_50364 = 1;\n                while (slt32(skip_threads_50364, 32)) {\n                    bool thread_active_50365 = sle32(skip_threads_50364, local_tid_50298 - squot32(local_tid_50298, 32) * 32) && ltid_in_bounds_50363;\n                    \n                    if (thread_active_50365) {\n                        // read operands\n                        {\n                            x_50349 = ((volatile __local int64_t *) local_mem_50307)[sext_i32_i64(local_tid_50298) - sext_i32_i64(skip_threads_50364)];\n                            x_50350 = ((volatile __local int64_t *) local_mem_50307)[squot64(byte_offsets_50303, (int64_t) 8) + (sext_i32_i64(local_tid_50298) - sext_i32_i64(skip_threads_50364))];\n                        }\n                    }\n                    // perform operation\n                    {\n                        if (thread_active_50365) {\n                            int64_t zz_50353 = x_50349 + y_50351;\n                            int64_t zz_50354 = x_50350 + y_50352;\n                            \n                            x_50349 = zz_50353;\n                            x_50350 = zz_50354;\n                        }\n                    }\n                    if (sle32(wave_sizze_50300, skip_threads_50364)) {\n                        barrier(CLK_LOCAL_MEM_FENCE);\n                    }\n                    if (thread_active_50365) {\n                        // write result\n                        {\n                            ((volatile __local int64_t *) local_mem_50307)[sext_i32_i64(local_tid_50298)] = x_50349;\n          ", "                  y_50351 = x_50349;\n                            ((volatile __local int64_t *) local_mem_50307)[squot64(byte_offsets_50303, (int64_t) 8) + sext_i32_i64(local_tid_50298)] = x_50350;\n                            y_50352 = x_50350;\n                        }\n                    }\n                    if (sle32(wave_sizze_50300, skip_threads_50364)) {\n                        barrier(CLK_LOCAL_MEM_FENCE);\n                    }\n                    skip_threads_50364 *= 2;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // last thread of block 'i' writes its result to offset 'i'\n            {\n                if ((local_tid_50298 - squot32(local_tid_50298, 32) * 32) == 31 && ltid_in_bounds_50363) {\n                    ((volatile __local int64_t *) local_mem_50307)[sext_i32_i64(squot32(local_tid_50298, 32))] = x_50349;\n                    ((volatile __local int64_t *) local_mem_50307)[squot64(byte_offsets_50303, (int64_t) 8) + sext_i32_i64(squot32(local_tid_50298, 32))] = x_50350;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // scan the first block, after which offset 'i' contains carry-in for block 'i+1'\n            {\n                int32_t skip_threads_50366;\n                \n                // read input for in-block scan\n                {\n                    if (squot32(local_tid_50298, 32) == 0 && ltid_in_bounds_50363) {\n                        y_50359 = ((volatile __local int64_t *) local_mem_50307)[sext_i32_i64(local_tid_50298)];\n                        y_50360 = ((volatile __local int64_t *) local_mem_50307)[squot64(byte_offsets_50303, (int64_t) 8) + sext_i32_i64(local_tid_50298)];\n                        if ((local_tid_50298 - squot32(local_tid_50298, 32) * 32) == 0) {\n                            x_50357 = y_50359;\n                            x_50358 = y_50360;\n                        }\n                    }\n                }\n                // in-block scan (hopefully no ba",
                                    "rriers needed)\n                {\n                    skip_threads_50366 = 1;\n                    while (slt32(skip_threads_50366, 32)) {\n                        bool thread_active_50367 = sle32(skip_threads_50366, local_tid_50298 - squot32(local_tid_50298, 32) * 32) && (squot32(local_tid_50298, 32) == 0 && ltid_in_bounds_50363);\n                        \n                        if (thread_active_50367) {\n                            // read operands\n                            {\n                                x_50357 = ((volatile __local int64_t *) local_mem_50307)[sext_i32_i64(local_tid_50298) - sext_i32_i64(skip_threads_50366)];\n                                x_50358 = ((volatile __local int64_t *) local_mem_50307)[squot64(byte_offsets_50303, (int64_t) 8) + (sext_i32_i64(local_tid_50298) - sext_i32_i64(skip_threads_50366))];\n                            }\n                        }\n                        // perform operation\n                        {\n                            if (thread_active_50367) {\n                                int64_t zz_50361 = x_50357 + y_50359;\n                                int64_t zz_50362 = x_50358 + y_50360;\n                                \n                                x_50357 = zz_50361;\n                                x_50358 = zz_50362;\n                            }\n                        }\n                        if (sle32(wave_sizze_50300, skip_threads_50366)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        if (thread_active_50367) {\n                            // write result\n                            {\n                                ((volatile __local int64_t *) local_mem_50307)[sext_i32_i64(local_tid_50298)] = x_50357;\n                                y_50359 = x_50357;\n                                ((volatile __local int64_t *) local_mem_50307)[squot64(byte_offsets_50303, (int64_t) 8) + sext_i32_i64(local_tid_50298)] = x_50358;\n                          ", "      y_50360 = x_50358;\n                            }\n                        }\n                        if (sle32(wave_sizze_50300, skip_threads_50366)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        skip_threads_50366 *= 2;\n                    }\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            \n            bool no_carry_in_50368 = squot32(local_tid_50298, 32) == 0 || !ltid_in_bounds_50363;\n            \n            // carry-in for every block except the first\n            {\n                // read operands\n                {\n                    if (!no_carry_in_50368) {\n                        y_50351 = x_50349;\n                        y_50352 = x_50350;\n                        x_50349 = ((__local int64_t *) local_mem_50307)[sext_i32_i64(squot32(local_tid_50298, 32)) - (int64_t) 1];\n                        x_50350 = ((__local int64_t *) local_mem_50307)[squot64(byte_offsets_50303, (int64_t) 8) + (sext_i32_i64(squot32(local_tid_50298, 32)) - (int64_t) 1)];\n                    }\n                }\n                // perform operation\n                {\n                    if (!no_carry_in_50368) {\n                        int64_t zz_50353 = x_50349 + y_50351;\n                        int64_t zz_50354 = x_50350 + y_50352;\n                        \n                        x_50349 = zz_50353;\n                        x_50350 = zz_50354;\n                    }\n                }\n                // write final result\n                {\n                    if (!no_carry_in_50368) {\n                        ((__local int64_t *) local_mem_50307)[sext_i32_i64(local_tid_50298)] = x_50349;\n                        ((__local int64_t *) local_mem_50307)[squot64(byte_offsets_50303, (int64_t) 8) + sext_i32_i64(local_tid_50298)] = x_50350;\n                    }\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // restore correct values for first block\n          ", "  {\n                if (squot32(local_tid_50298, 32) == 0 && ltid_in_bounds_50363) {\n                    ((__local int64_t *) local_mem_50307)[sext_i32_i64(local_tid_50298)] = y_50351;\n                    ((__local int64_t *) local_mem_50307)[squot64(byte_offsets_50303, (int64_t) 8) + sext_i32_i64(local_tid_50298)] = y_50352;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            barrier(CLK_LOCAL_MEM_FENCE);\n            if (local_tid_50298 == 0) {\n                acc_50355 = ((__local int64_t *) local_mem_50307)[segscan_tblock_sizze_44179 - (int64_t) 1];\n                acc_50356 = ((__local int64_t *) local_mem_50307)[squot64(byte_offsets_50303, (int64_t) 8) + (segscan_tblock_sizze_44179 - (int64_t) 1)];\n            } else {\n                acc_50355 = ((__local int64_t *) local_mem_50307)[sext_i32_i64(local_tid_50298) - (int64_t) 1];\n                acc_50356 = ((__local int64_t *) local_mem_50307)[squot64(byte_offsets_50303, (int64_t) 8) + (sext_i32_i64(local_tid_50298) - (int64_t) 1)];\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n        }\n        prefix_50369 = (int64_t) 0;\n        prefix_50370 = (int64_t) 0;\n        block_new_sgm_50371 = sgm_idx_50322 == (int64_t) 0;\n        // Perform lookback\n        {\n            if (block_new_sgm_50371 && local_tid_50298 == 0) {\n                ((volatile __global int64_t *) incprefixes_mem_50269)[dynamic_id_50320] = acc_50355;\n                ((volatile __global int64_t *) incprefixes_mem_50273)[dynamic_id_50320] = acc_50356;\n                mem_fence_global();\n                ((volatile __global int8_t *) status_flags_mem_50245)[dynamic_id_50320] = (int8_t) 2;\n                acc_50355 = (int64_t) 0;\n                acc_50356 = (int64_t) 0;\n            }\n            if (!block_new_sgm_50371 && slt32(local_tid_50298, wave_sizze_50300)) {\n                if (local_tid_50298 == 0) {\n                    ((volatile __global int64_t *) aggregates_mem_50267)[dynamic_id_50320] = acc_503",
                                    "55;\n                    ((volatile __global int64_t *) aggregates_mem_50271)[dynamic_id_50320] = acc_50356;\n                    mem_fence_global();\n                    ((volatile __global int8_t *) status_flags_mem_50245)[dynamic_id_50320] = (int8_t) 1;\n                    \n                    int8_t tmp_50372 = ((volatile __global int8_t *) status_flags_mem_50245)[dynamic_id_50320 - (int64_t) 1];\n                    \n                    ((volatile __local int8_t *) local_mem_50307)[(int64_t) 0] = tmp_50372;\n                }\n                mem_fence_local();\n                \n                int8_t status_50373 = ((__local int8_t *) local_mem_50307)[(int64_t) 0];\n                \n                if (status_50373 == (int8_t) 2) {\n                    if (local_tid_50298 == 0) {\n                        prefix_50369 = ((volatile __global int64_t *) incprefixes_mem_50269)[dynamic_id_50320 - (int64_t) 1];\n                        prefix_50370 = ((volatile __global int64_t *) incprefixes_mem_50273)[dynamic_id_50320 - (int64_t) 1];\n                    }\n                } else {\n                    int32_t readOffset_50374 = sext_i64_i32(dynamic_id_50320 - sext_i32_i64(wave_sizze_50300));\n                    \n                    while (slt32(wave_sizze_50300 * -1, readOffset_50374)) {\n                        int32_t read_i_50375 = readOffset_50374 + local_tid_50298;\n                        int64_t aggr_50376 = (int64_t) 0;\n                        int64_t aggr_50377 = (int64_t) 0;\n                        int8_t flag_50378 = (int8_t) 0;\n                        \n                        if (sle32(0, read_i_50375)) {\n                            flag_50378 = ((volatile __global int8_t *) status_flags_mem_50245)[sext_i32_i64(read_i_50375)];\n                            if (flag_50378 == (int8_t) 2) {\n                                aggr_50376 = ((volatile __global int64_t *) incprefixes_mem_50269)[sext_i32_i64(read_i_50375)];\n                                aggr_50377 = ((volatile _", "_global int64_t *) incprefixes_mem_50273)[sext_i32_i64(read_i_50375)];\n                            } else if (flag_50378 == (int8_t) 1) {\n                                aggr_50376 = ((volatile __global int64_t *) aggregates_mem_50267)[sext_i32_i64(read_i_50375)];\n                                aggr_50377 = ((volatile __global int64_t *) aggregates_mem_50271)[sext_i32_i64(read_i_50375)];\n                            }\n                        }\n                        ((__local int64_t *) local_mem_50307)[(int64_t) 4 + sext_i32_i64(local_tid_50298)] = aggr_50376;\n                        ((__local int64_t *) local_mem_50307)[squot64(warp_byte_offset_50305, (int64_t) 8) + sext_i32_i64(local_tid_50298)] = aggr_50377;\n                        ((__local int8_t *) local_mem_50307)[sext_i32_i64(local_tid_50298)] = flag_50378;\n                        flag_50378 = ((__local int8_t *) local_mem_50307)[sext_i32_i64(wave_sizze_50300) - (int64_t) 1];\n                        if (slt8(flag_50378, (int8_t) 2)) {\n                            int8_t flg_x_50385;\n                            int8_t flg_y_50386;\n                            int64_t x_50379;\n                            int64_t x_50380;\n                            int64_t y_50381;\n                            int64_t y_50382;\n                            int32_t skip_threads_50387;\n                            \n                            // read input for in-block scan\n                            {\n                                flg_y_50386 = ((volatile __local int8_t *) local_mem_50307)[sext_i32_i64(local_tid_50298)];\n                                y_50381 = ((volatile __local int64_t *) local_mem_50307)[(int64_t) 4 + sext_i32_i64(local_tid_50298)];\n                                y_50382 = ((volatile __local int64_t *) local_mem_50307)[squot64(warp_byte_offset_50305, (int64_t) 8) + sext_i32_i64(local_tid_50298)];\n                                if ((local_tid_50298 - squot32(local_tid_50298, 32) * 32) == 0) {\n              ", "                      x_50379 = y_50381;\n                                    x_50380 = y_50382;\n                                    flg_x_50385 = flg_y_50386;\n                                }\n                            }\n                            // in-block scan (hopefully no barriers needed)\n                            {\n                                skip_threads_50387 = 1;\n                                while (slt32(skip_threads_50387, 32)) {\n                                    if (sle32(skip_threads_50387, local_tid_50298 - squot32(local_tid_50298, 32) * 32)) {\n                                        // read operands\n                                        {\n                                            flg_x_50385 = ((volatile __local int8_t *) local_mem_50307)[sext_i32_i64(local_tid_50298) - sext_i32_i64(skip_threads_50387)];\n                                            x_50379 = ((volatile __local int64_t *) local_mem_50307)[(int64_t) 4 + (sext_i32_i64(local_tid_50298) - sext_i32_i64(skip_threads_50387))];\n                                            x_50380 = ((volatile __local int64_t *) local_mem_50307)[squot64(warp_byte_offset_50305, (int64_t) 8) + (sext_i32_i64(local_tid_50298) - sext_i32_i64(skip_threads_50387))];\n                                        }\n                                        // perform operation\n                                        {\n                                            if (flg_y_50386 == (int8_t) 2 || flg_y_50386 == (int8_t) 0) {\n                                                flg_x_50385 = flg_y_50386;\n                                                x_50379 = y_50381;\n                                                x_50380 = y_50382;\n                                            } else {\n                                                int64_t zz_50383 = x_50379 + y_50381;\n                                                int64_t zz_50384 = x_50380 + y_50382;\n                                                \n                ",
                                    "                                x_50379 = zz_50383;\n                                                x_50380 = zz_50384;\n                                            }\n                                        }\n                                        // write result\n                                        {\n                                            ((volatile __local int8_t *) local_mem_50307)[sext_i32_i64(local_tid_50298)] = flg_x_50385;\n                                            flg_y_50386 = flg_x_50385;\n                                            ((volatile __local int64_t *) local_mem_50307)[(int64_t) 4 + sext_i32_i64(local_tid_50298)] = x_50379;\n                                            y_50381 = x_50379;\n                                            ((volatile __local int64_t *) local_mem_50307)[squot64(warp_byte_offset_50305, (int64_t) 8) + sext_i32_i64(local_tid_50298)] = x_50380;\n                                            y_50382 = x_50380;\n                                        }\n                                    }\n                                    skip_threads_50387 *= 2;\n                                }\n                            }\n                        }\n                        flag_50378 = ((__local int8_t *) local_mem_50307)[sext_i32_i64(wave_sizze_50300) - (int64_t) 1];\n                        aggr_50376 = ((__local int64_t *) local_mem_50307)[(int64_t) 4 + (sext_i32_i64(wave_sizze_50300) - (int64_t) 1)];\n                        aggr_50377 = ((__local int64_t *) local_mem_50307)[squot64(warp_byte_offset_50305, (int64_t) 8) + (sext_i32_i64(wave_sizze_50300) - (int64_t) 1)];\n                        if (flag_50378 == (int8_t) 2) {\n                            readOffset_50374 = wave_sizze_50300 * -1;\n                        } else if (flag_50378 == (int8_t) 1) {\n                            readOffset_50374 -= wave_sizze_50300;\n                        }\n                        if (slt8((int8_t) 0, flag_50378)) {\n                            int6", "4_t x_50388 = aggr_50376;\n                            int64_t x_50389 = aggr_50377;\n                            int64_t y_50390 = prefix_50369;\n                            int64_t y_50391 = prefix_50370;\n                            int64_t zz_50392 = x_50388 + y_50390;\n                            int64_t zz_50393 = x_50389 + y_50391;\n                            \n                            prefix_50369 = zz_50392;\n                            prefix_50370 = zz_50393;\n                        }\n                        mem_fence_local();\n                    }\n                }\n                if (local_tid_50298 == 0) {\n                    if (boundary_50323 == sext_i64_i32(segscan_tblock_sizze_44179 * chunk_sizze_50242)) {\n                        int64_t x_50394 = prefix_50369;\n                        int64_t x_50395 = prefix_50370;\n                        int64_t y_50396 = acc_50355;\n                        int64_t y_50397 = acc_50356;\n                        int64_t zz_50398 = x_50394 + y_50396;\n                        int64_t zz_50399 = x_50395 + y_50397;\n                        \n                        ((volatile __global int64_t *) incprefixes_mem_50269)[dynamic_id_50320] = zz_50398;\n                        ((volatile __global int64_t *) incprefixes_mem_50273)[dynamic_id_50320] = zz_50399;\n                        mem_fence_global();\n                        ((volatile __global int8_t *) status_flags_mem_50245)[dynamic_id_50320] = (int8_t) 2;\n                    }\n                    ((__local int64_t *) local_mem_50307)[(int64_t) 4] = prefix_50369;\n                    ((__local int64_t *) local_mem_50307)[squot64(warp_byte_offset_50305, (int64_t) 8)] = prefix_50370;\n                    acc_50355 = (int64_t) 0;\n                    acc_50356 = (int64_t) 0;\n                }\n            }\n            if (!(dynamic_id_50320 == (int64_t) 0)) {\n                barrier(CLK_LOCAL_MEM_FENCE);\n                prefix_50369 = ((__local int64_t *) local_mem_50307)[(int64_t) 4];", "\n                prefix_50370 = ((__local int64_t *) local_mem_50307)[squot64(warp_byte_offset_50305, (int64_t) 8)];\n                barrier(CLK_LOCAL_MEM_FENCE);\n            }\n        }\n        // Distribute results\n        {\n            int64_t x_50400;\n            int64_t y_50402;\n            int64_t x_50406 = prefix_50369;\n            int64_t y_50408 = acc_50355;\n            int64_t x_50401;\n            int64_t y_50403;\n            int64_t x_50407 = prefix_50370;\n            int64_t y_50409 = acc_50356;\n            \n            if (slt32(local_tid_50298 * chunk_sizze_32b_50302, boundary_50323) && !block_new_sgm_50371) {\n                int64_t zz_50410 = x_50406 + y_50408;\n                int64_t zz_50411 = x_50407 + y_50409;\n                \n                x_50400 = zz_50410;\n                x_50401 = zz_50411;\n            } else {\n                x_50400 = acc_50355;\n                x_50401 = acc_50356;\n            }\n            \n            int32_t stopping_point_50412 = segsizze_compact_50324 - srem32(local_tid_50298 * chunk_sizze_32b_50302 - 1 + segsizze_compact_50324 - boundary_50323, segsizze_compact_50324);\n            \n            for (int64_t i_50413 = 0; i_50413 < chunk_sizze_50242; i_50413++) {\n                if (slt32(sext_i64_i32(i_50413), stopping_point_50412 - 1)) {\n                    y_50402 = private_mem_50325[i_50413];\n                    y_50403 = private_mem_50327[i_50413];\n                    \n                    int64_t zz_50404 = x_50400 + y_50402;\n                    int64_t zz_50405 = x_50401 + y_50403;\n                    \n                    private_mem_50325[i_50413] = zz_50404;\n                    private_mem_50327[i_50413] = zz_50405;\n                }\n            }\n        }\n        // Transpose scan output and Write it to global memory in coalesced fashion\n        {\n            for (int64_t i_50414 = 0; i_50414 < chunk_sizze_50242; i_50414++) {\n                int64_t sharedIdx_50415 = sext_i32_i64(local_tid_50298) * chunk_siz",
                                    "ze_50242 + i_50414;\n                int64_t tmp_50416 = private_mem_50325[i_50414];\n                \n                ((__local int64_t *) local_mem_50307)[sharedIdx_50415] = tmp_50416;\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            for (int64_t i_50417 = 0; i_50417 < chunk_sizze_50242; i_50417++) {\n                int64_t flat_idx_50418 = thd_offset_50329 + i_50417 * segscan_tblock_sizze_44179;\n                int64_t slice_50419 = n_old_27030;\n                int64_t gtid_44183 = flat_idx_50418;\n                int64_t remnant_50420 = flat_idx_50418 - gtid_44183;\n                \n                if (slt64(flat_idx_50418, n_old_27030)) {\n                    int64_t tmp_50421 = ((__local int64_t *) local_mem_50307)[flat_idx_50418 - block_offset_50321];\n                    \n                    ((__global int64_t *) mem_49410)[gtid_44183] = tmp_50421;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            for (int64_t i_50422 = 0; i_50422 < chunk_sizze_50242; i_50422++) {\n                int64_t sharedIdx_50423 = sext_i32_i64(local_tid_50298) * chunk_sizze_50242 + i_50422;\n                int64_t tmp_50424 = private_mem_50327[i_50422];\n                \n                ((__local int64_t *) local_mem_50307)[sharedIdx_50423] = tmp_50424;\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            for (int64_t i_50425 = 0; i_50425 < chunk_sizze_50242; i_50425++) {\n                int64_t flat_idx_50426 = thd_offset_50329 + i_50425 * segscan_tblock_sizze_44179;\n                int64_t slice_50427 = n_old_27030;\n                int64_t gtid_44183 = flat_idx_50426;\n                int64_t remnant_50428 = flat_idx_50426 - gtid_44183;\n                \n                if (slt64(flat_idx_50426, n_old_27030)) {\n                    int64_t tmp_50429 = ((__local int64_t *) local_mem_50307)[flat_idx_50426 - block_offset_50321];\n                    \n                    ((__global int64_t *) mem_49412)[gtid_44183] = tmp_50429;", "\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n        }\n    }\n    \n  error_3:\n    return;\n    #undef segscan_tblock_sizze_44179\n    #undef chunk_sizze_50242\n}\nFUTHARK_KERNEL_SIZED(add_next_partition_doublezisegscan_44200_dim1, 1, 1)\nvoid add_next_partition_doublezisegscan_44200(__global int *global_failure, int failure_is_an_option, __global int64_t *global_failure_args, int64_t dz2082U_27035, int64_t dz2083U_27036, double zt_res_38807, int64_t dzlz7bUZLzpZRz20Udz2082Uz20Udz2084Uz2088Uz2084Uz7dUzg_39167, unsigned char cond_39171_bits, int64_t num_tblocks_44197, int64_t num_virt_blocks_50863, int64_t num_virt_threads_50864, __global unsigned char *clProc_mem_49382, __global unsigned char *clProc_mem_49383, __global unsigned char *clProc_mem_49385, __global unsigned char *mem_49416, __global unsigned char *mem_49418, __global unsigned char *ext_mem_49425, __global unsigned char *ext_mem_49428, __global unsigned char *ext_mem_49431, __global unsigned char *ext_mem_49434, __global unsigned char *ext_mem_49437, __global unsigned char *ext_mem_49440, __global unsigned char *mem_49449, __global unsigned char *mem_49565, __global unsigned char *mem_49567, __global unsigned char *mem_49569, __global unsigned char *status_flags_mem_50865, __global unsigned char *aggregates_mem_50867, __global unsigned char *incprefixes_mem_50869, __global unsigned char *aggregates_mem_50871, __global unsigned char *incprefixes_mem_50873, __global unsigned char *global_dynid_mem_50875)\n{\n    bool cond_39171 = cond_39171_bits;\n    \n    #define segscan_tblock_sizze_44195 (add_next_partition_doublezisegscan_44200zisegscan_tblock_sizze_44195)\n    #define chunk_sizze_50862 (add_next_partition_doublezisegscan_44200zichunk_sizze_50862)\n    \n    volatile __local unsigned char *local_mem_50887_backing_0 = &shared_mem[0];\n    const int64_t local_mem_50887_backing_0_offset = 0 + (smax64(smax64((int64_t) 544, sdiv_up64((int64_t) 8 * segscan_tblock_sizze_44195, (int64_t) 8) * (", "int64_t) 8 + (int64_t) 8 * segscan_tblock_sizze_44195), smax64(chunk_sizze_50862 * segscan_tblock_sizze_44195 * (int64_t) 8, chunk_sizze_50862 * segscan_tblock_sizze_44195 * (int64_t) 8)) + srem64((int64_t) 8 - srem64(smax64(smax64((int64_t) 544, sdiv_up64((int64_t) 8 * segscan_tblock_sizze_44195, (int64_t) 8) * (int64_t) 8 + (int64_t) 8 * segscan_tblock_sizze_44195), smax64(chunk_sizze_50862 * segscan_tblock_sizze_44195 * (int64_t) 8, chunk_sizze_50862 * segscan_tblock_sizze_44195 * (int64_t) 8)), (int64_t) 8), (int64_t) 8));\n    volatile __local int local_failure;\n    \n    if (failure_is_an_option) {\n        int failed = *global_failure >= 0;\n        \n        if (failed)\n            return;\n    }\n    local_failure = 0;\n    barrier(CLK_LOCAL_MEM_FENCE);\n    \n    int32_t local_tid_50878;\n    int32_t tblock_sizze_50881;\n    int32_t wave_sizze_50880;\n    int32_t block_id_50879;\n    int32_t global_tid_50877;\n    int64_t phys_tid_44200;\n    int32_t chunk_sizze_32b_50882;\n    int64_t byte_offsets_50883;\n    int64_t byte_offsets_50884;\n    int64_t warp_byte_offset_50885;\n    int64_t warp_byte_offset_50886;\n    __local unsigned char *local_mem_50887;\n    int64_t trans_arr_len_50888;\n    int64_t phys_block_id_50897;\n    int64_t virtloop_bound_50898;\n    \n    local_tid_50878 = get_local_id(0);\n    tblock_sizze_50881 = get_local_size(0);\n    wave_sizze_50880 = LOCKSTEP_WIDTH;\n    block_id_50879 = get_tblock_id(0);\n    global_tid_50877 = block_id_50879 * tblock_sizze_50881 + local_tid_50878;\n    phys_tid_44200 = sext_i32_i64(global_tid_50877);\n    chunk_sizze_32b_50882 = sext_i64_i32(chunk_sizze_50862);\n    byte_offsets_50883 = segscan_tblock_sizze_44195 * (int64_t) 8;\n    byte_offsets_50884 = sdiv_up64(byte_offsets_50883, (int64_t) 8) * (int64_t) 8 + segscan_tblock_sizze_44195 * (int64_t) 8;\n    warp_byte_offset_50885 = (int64_t) 288;\n    warp_byte_offset_50886 = sdiv_up64(warp_byte_offset_50885, (int64_t) 8) * (int64_t) 8 + (int64_t) 256;\n    // Allocate reusable shared memo",
                                    "ry\n    { }\n    local_mem_50887 = (__local unsigned char *) local_mem_50887_backing_0;\n    trans_arr_len_50888 = chunk_sizze_50862 * segscan_tblock_sizze_44195;\n    phys_block_id_50897 = get_tblock_id(0);\n    virtloop_bound_50898 = sdiv_up64(num_virt_blocks_50863 - phys_block_id_50897, num_tblocks_44197);\n    for (int64_t virtloop_i_50899 = 0; virtloop_i_50899 < virtloop_bound_50898; virtloop_i_50899++) {\n        int64_t dynamic_id_50900;\n        int64_t block_offset_50901;\n        int64_t sgm_idx_50902;\n        int32_t boundary_50903;\n        int32_t segsizze_compact_50904;\n        int64_t private_mem_50905[chunk_sizze_50862];\n        int64_t private_mem_50907[chunk_sizze_50862];\n        int64_t thd_offset_50909;\n        int64_t acc_50938;\n        int64_t acc_50939;\n        int64_t prefix_50952;\n        int64_t prefix_50953;\n        bool block_new_sgm_50954;\n        \n        // First thread in block fetches this block's dynamic_id\n        {\n            if (local_tid_50878 == 0) {\n                dynamic_id_50900 = atomic_add_i32_global(&((volatile __global int *) global_dynid_mem_50875)[(int64_t) 0], (int) 1);\n                // Set dynamic id for this block\n                {\n                    ((__local int64_t *) local_mem_50887)[(int64_t) 0] = dynamic_id_50900;\n                }\n                // First thread in last (virtual) block resets global dynamic_id\n                {\n                    if (dynamic_id_50900 == num_virt_blocks_50863 - (int64_t) 1) {\n                        ((__global int32_t *) global_dynid_mem_50875)[(int64_t) 0] = 0;\n                    }\n                }\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        dynamic_id_50900 = ((__local int32_t *) local_mem_50887)[(int64_t) 0];\n        barrier(CLK_LOCAL_MEM_FENCE);\n        block_offset_50901 = dynamic_id_50900 * chunk_sizze_50862 * segscan_tblock_sizze_44195;\n        sgm_idx_50902 = smod64(block_offset_50901, dzlz7bUZLzpZRz20Udz2082Uz20Udz2084Uz2088Uz2084Uz7dUzg_39167)", ";\n        boundary_50903 = sext_i64_i32(smin64(chunk_sizze_50862 * segscan_tblock_sizze_44195, dzlz7bUZLzpZRz20Udz2082Uz20Udz2084Uz2088Uz2084Uz7dUzg_39167 - sgm_idx_50902));\n        segsizze_compact_50904 = sext_i64_i32(smin64(chunk_sizze_50862 * segscan_tblock_sizze_44195, dzlz7bUZLzpZRz20Udz2082Uz20Udz2084Uz2088Uz2084Uz7dUzg_39167));\n        thd_offset_50909 = block_offset_50901 + sext_i32_i64(local_tid_50878);\n        // Load and map\n        {\n            for (int64_t i_50910 = 0; i_50910 < chunk_sizze_50862; i_50910++) {\n                int64_t virt_tid_50911 = thd_offset_50909 + i_50910 * segscan_tblock_sizze_44195;\n                int64_t slice_50912 = dzlz7bUZLzpZRz20Udz2082Uz20Udz2084Uz2088Uz2084Uz7dUzg_39167;\n                int64_t gtid_44199 = virt_tid_50911;\n                int64_t remnant_50913 = virt_tid_50911 - gtid_44199;\n                \n                if (slt64(virt_tid_50911, dzlz7bUZLzpZRz20Udz2082Uz20Udz2084Uz2088Uz2084Uz7dUzg_39167)) {\n                    int64_t zv_rhs_49324 = ((__global int64_t *) mem_49449)[(int64_t) 0];\n                    double times_arg1_49325 = ((__global double *) ext_mem_49425)[(int64_t) 0];\n                    double plus_arg0_49326 = ((__global double *) ext_mem_49428)[(int64_t) 0];\n                    double times_arg1_49327 = ((__global double *) ext_mem_49431)[(int64_t) 0];\n                    double plus_arg0_49328 = ((__global double *) ext_mem_49434)[(int64_t) 0];\n                    double plus_arg1_49329 = ((__global double *) ext_mem_49437)[(int64_t) 0];\n                    double plus_arg1_49330 = ((__global double *) ext_mem_49440)[(int64_t) 0];\n                    bool index_concat_cmp_42208 = sle64(dz2082U_27035, gtid_44199);\n                    double index_concat_branch_42209;\n                    \n                    if (index_concat_cmp_42208) {\n                        int64_t index_concat_i_42719 = sub64(gtid_44199, dz2082U_27035);\n                        double index_concat_42720 = ((__global doub", "le *) mem_49416)[index_concat_i_42719];\n                        \n                        index_concat_branch_42209 = index_concat_42720;\n                    } else {\n                        double index_concat_42212 = ((__global double *) clProc_mem_49382)[gtid_44199];\n                        \n                        index_concat_branch_42209 = index_concat_42212;\n                    }\n                    \n                    double index_concat_branch_42213;\n                    \n                    if (index_concat_cmp_42208) {\n                        int64_t index_concat_i_42721 = sub64(gtid_44199, dz2082U_27035);\n                        double index_concat_42722 = ((__global double *) mem_49418)[index_concat_i_42721];\n                        \n                        index_concat_branch_42213 = index_concat_42722;\n                    } else {\n                        double index_concat_42216 = ((__global double *) clProc_mem_49383)[gtid_44199];\n                        \n                        index_concat_branch_42213 = index_concat_42216;\n                    }\n                    \n                    bool isNearAnyRelevant_42217;\n                    int64_t isNearAnyRelevant_42218;\n                    bool isNearAnyRelevant_42219;\n                    bool loop_while_42220;\n                    int64_t curPart_i_42221;\n                    bool isNear_42222;\n                    \n                    loop_while_42220 = cond_39171;\n                    curPart_i_42221 = (int64_t) 0;\n                    isNear_42222 = 0;\n                    while (loop_while_42220) {\n                        bool x_42223 = sle64((int64_t) 0, curPart_i_42221);\n                        bool y_42224 = slt64(curPart_i_42221, dz2083U_27036);\n                        bool bounds_check_42225 = x_42223 && y_42224;\n                        bool index_certs_42226;\n                        \n                        if (!bounds_check_42225) {\n                            {\n                                i",
                                    "f (atomic_cmpxchg_i32_global(global_failure, -1, 9) == -1) {\n                                    global_failure_args[0] = (int64_t) curPart_i_42221;\n                                    global_failure_args[1] = (int64_t) dz2083U_27036;\n                                    ;\n                                }\n                                local_failure = 1;\n                                goto error_0;\n                            }\n                        }\n                        \n                        int64_t curPart_42227 = ((__global int64_t *) clProc_mem_49385)[curPart_i_42221];\n                        int64_t cur_xid_42228 = smod64(curPart_42227, zv_rhs_49324);\n                        int64_t cur_yid_42229 = sdiv64(curPart_42227, zv_rhs_49324);\n                        double i64_res_42230 = sitofp_i64_f64(cur_xid_42228);\n                        double zt_res_42231 = i64_res_42230 * times_arg1_49325;\n                        double zp_res_42232 = zt_res_42231 + plus_arg0_49326;\n                        double i64_res_42233 = sitofp_i64_f64(cur_yid_42229);\n                        double zt_res_42234 = i64_res_42233 * times_arg1_49327;\n                        double zp_res_42235 = zt_res_42234 + plus_arg0_49328;\n                        double zp_res_42236 = zp_res_42232 + plus_arg1_49329;\n                        double zp_res_42237 = zp_res_42235 + plus_arg1_49330;\n                        double zm_res_42238 = zp_res_42232 - zt_res_38807;\n                        bool zgze_res_42239 = zm_res_42238 <= index_concat_branch_42209;\n                        double zp_res_42240 = zt_res_38807 + zp_res_42236;\n                        bool zlze_res_42241 = index_concat_branch_42209 <= zp_res_42240;\n                        bool x_42242 = zgze_res_42239 && zlze_res_42241;\n                        double zm_res_42243 = zp_res_42235 - zt_res_38807;\n                        bool zgze_res_42244 = zm_res_42243 <= index_concat_branch_42213;\n                        double zp_res_42245 = ", "zt_res_38807 + zp_res_42237;\n                        bool zlze_res_42246 = index_concat_branch_42213 <= zp_res_42245;\n                        bool x_42247 = zgze_res_42244 && zlze_res_42246;\n                        bool x_42248 = x_42242 && x_42247;\n                        int64_t tmp_42249 = add64((int64_t) 1, curPart_i_42221);\n                        bool cond_42250 = slt64(tmp_42249, dz2083U_27036);\n                        bool loop_cond_t_res_42251 = !x_42248;\n                        bool x_42252 = cond_42250 && loop_cond_t_res_42251;\n                        bool loop_while_tmp_50914 = x_42252;\n                        int64_t curPart_i_tmp_50915 = tmp_42249;\n                        bool isNear_tmp_50916 = x_42248;\n                        \n                        loop_while_42220 = loop_while_tmp_50914;\n                        curPart_i_42221 = curPart_i_tmp_50915;\n                        isNear_42222 = isNear_tmp_50916;\n                    }\n                    isNearAnyRelevant_42217 = loop_while_42220;\n                    isNearAnyRelevant_42218 = curPart_i_42221;\n                    isNearAnyRelevant_42219 = isNear_42222;\n                    \n                    bool cond_neg_42254 = !isNearAnyRelevant_42219;\n                    int64_t defunc_0_lifted_pzq_res_42255 = btoi_bool_i64(cond_neg_42254);\n                    bool is_i_42256 = defunc_0_lifted_pzq_res_42255 == (int64_t) 0;\n                    int64_t part_res_42257 = btoi_bool_i64(is_i_42256);\n                    int64_t part_res_42258;\n                    int64_t part_res_42259;\n                    \n                    if (is_i_42256) {\n                        part_res_42258 = (int64_t) 0;\n                        part_res_42259 = (int64_t) 0;\n                    } else {\n                        bool is_i_42260 = defunc_0_lifted_pzq_res_42255 == (int64_t) 1;\n                        int64_t part_res_42261;\n                        \n                        if (is_i_42260) {\n                            pa", "rt_res_42261 = (int64_t) 1;\n                        } else {\n                            part_res_42261 = (int64_t) 2;\n                        }\n                        \n                        int64_t part_res_42262 = btoi_bool_i64(is_i_42260);\n                        \n                        part_res_42258 = part_res_42261;\n                        part_res_42259 = part_res_42262;\n                    }\n                    ((__global int64_t *) mem_49569)[gtid_44199] = part_res_42258;\n                    private_mem_50905[i_50910] = part_res_42257;\n                    private_mem_50907[i_50910] = part_res_42259;\n                } else {\n                    private_mem_50905[i_50910] = (int64_t) 0;\n                    private_mem_50907[i_50910] = (int64_t) 0;\n                }\n            }\n        }\n        \n      error_0:\n        barrier(CLK_LOCAL_MEM_FENCE);\n        if (local_failure)\n            return;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        // Transpose scan inputs\n        {\n            for (int64_t i_50917 = 0; i_50917 < chunk_sizze_50862; i_50917++) {\n                int64_t sharedIdx_50918 = sext_i32_i64(local_tid_50878) + i_50917 * segscan_tblock_sizze_44195;\n                int64_t tmp_50919 = private_mem_50905[i_50917];\n                \n                ((__local int64_t *) local_mem_50887)[sharedIdx_50918] = tmp_50919;\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            for (int64_t i_50920 = 0; i_50920 < chunk_sizze_50862; i_50920++) {\n                int64_t sharedIdx_50921 = sext_i32_i64(local_tid_50878) * chunk_sizze_50862 + i_50920;\n                int64_t tmp_50922 = ((__local int64_t *) local_mem_50887)[sharedIdx_50921];\n                \n                private_mem_50905[i_50920] = tmp_50922;\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            for (int64_t i_50923 = 0; i_50923 < chunk_sizze_50862; i_50923++) {\n                int64_t sharedIdx_50924 = sext_i32_i64(local_tid_50878) + i_50923 * segscan_tblock_siz",
                                    "ze_44195;\n                int64_t tmp_50925 = private_mem_50907[i_50923];\n                \n                ((__local int64_t *) local_mem_50887)[sharedIdx_50924] = tmp_50925;\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            for (int64_t i_50926 = 0; i_50926 < chunk_sizze_50862; i_50926++) {\n                int64_t sharedIdx_50927 = sext_i32_i64(local_tid_50878) * chunk_sizze_50862 + i_50926;\n                int64_t tmp_50928 = ((__local int64_t *) local_mem_50887)[sharedIdx_50927];\n                \n                private_mem_50907[i_50926] = tmp_50928;\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n        }\n        // Per thread scan\n        {\n            for (int64_t i_50929 = 0; i_50929 < chunk_sizze_50862 - (int64_t) 1; i_50929++) {\n                int64_t x_39263;\n                int64_t y_39265;\n                \n                x_39263 = private_mem_50905[i_50929];\n                y_39265 = private_mem_50905[i_50929 + (int64_t) 1];\n                \n                int64_t x_39264;\n                int64_t y_39266;\n                \n                x_39264 = private_mem_50907[i_50929];\n                y_39266 = private_mem_50907[i_50929 + (int64_t) 1];\n                \n                int64_t zz_39267 = x_39263 + y_39265;\n                int64_t zz_39268 = x_39264 + y_39266;\n                \n                private_mem_50905[i_50929 + (int64_t) 1] = zz_39267;\n                private_mem_50907[i_50929 + (int64_t) 1] = zz_39268;\n            }\n        }\n        // Publish results in shared memory\n        {\n            int64_t tmp_50930 = private_mem_50905[chunk_sizze_50862 - (int64_t) 1];\n            \n            ((__local int64_t *) local_mem_50887)[sext_i32_i64(local_tid_50878)] = tmp_50930;\n            \n            int64_t tmp_50931 = private_mem_50907[chunk_sizze_50862 - (int64_t) 1];\n            \n            ((__local int64_t *) local_mem_50887)[squot64(byte_offsets_50883, (int64_t) 8) + sext_i32_i64(local_tid_50878)] = tmp_50931;\n ", "           barrier(CLK_LOCAL_MEM_FENCE);\n        }\n        // Scan results (with warp scan)\n        {\n            int64_t x_50932;\n            int64_t x_50933;\n            int64_t y_50934;\n            int64_t y_50935;\n            int64_t x_50940;\n            int64_t x_50941;\n            int64_t y_50942;\n            int64_t y_50943;\n            bool ltid_in_bounds_50946 = slt64(sext_i32_i64(local_tid_50878), num_virt_threads_50864);\n            int32_t skip_threads_50947;\n            \n            // read input for in-block scan\n            {\n                if (ltid_in_bounds_50946) {\n                    y_50934 = ((volatile __local int64_t *) local_mem_50887)[sext_i32_i64(local_tid_50878)];\n                    y_50935 = ((volatile __local int64_t *) local_mem_50887)[squot64(byte_offsets_50883, (int64_t) 8) + sext_i32_i64(local_tid_50878)];\n                    if ((local_tid_50878 - squot32(local_tid_50878, 32) * 32) == 0) {\n                        x_50932 = y_50934;\n                        x_50933 = y_50935;\n                    }\n                }\n            }\n            // in-block scan (hopefully no barriers needed)\n            {\n                skip_threads_50947 = 1;\n                while (slt32(skip_threads_50947, 32)) {\n                    bool thread_active_50948 = sle32(skip_threads_50947, local_tid_50878 - squot32(local_tid_50878, 32) * 32) && ltid_in_bounds_50946;\n                    \n                    if (thread_active_50948) {\n                        // read operands\n                        {\n                            x_50932 = ((volatile __local int64_t *) local_mem_50887)[sext_i32_i64(local_tid_50878) - sext_i32_i64(skip_threads_50947)];\n                            x_50933 = ((volatile __local int64_t *) local_mem_50887)[squot64(byte_offsets_50883, (int64_t) 8) + (sext_i32_i64(local_tid_50878) - sext_i32_i64(skip_threads_50947))];\n                        }\n                    }\n                    // perform operation\n                    {\n      ", "                  if (thread_active_50948) {\n                            int64_t zz_50936 = x_50932 + y_50934;\n                            int64_t zz_50937 = x_50933 + y_50935;\n                            \n                            x_50932 = zz_50936;\n                            x_50933 = zz_50937;\n                        }\n                    }\n                    if (sle32(wave_sizze_50880, skip_threads_50947)) {\n                        barrier(CLK_LOCAL_MEM_FENCE);\n                    }\n                    if (thread_active_50948) {\n                        // write result\n                        {\n                            ((volatile __local int64_t *) local_mem_50887)[sext_i32_i64(local_tid_50878)] = x_50932;\n                            y_50934 = x_50932;\n                            ((volatile __local int64_t *) local_mem_50887)[squot64(byte_offsets_50883, (int64_t) 8) + sext_i32_i64(local_tid_50878)] = x_50933;\n                            y_50935 = x_50933;\n                        }\n                    }\n                    if (sle32(wave_sizze_50880, skip_threads_50947)) {\n                        barrier(CLK_LOCAL_MEM_FENCE);\n                    }\n                    skip_threads_50947 *= 2;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // last thread of block 'i' writes its result to offset 'i'\n            {\n                if ((local_tid_50878 - squot32(local_tid_50878, 32) * 32) == 31 && ltid_in_bounds_50946) {\n                    ((volatile __local int64_t *) local_mem_50887)[sext_i32_i64(squot32(local_tid_50878, 32))] = x_50932;\n                    ((volatile __local int64_t *) local_mem_50887)[squot64(byte_offsets_50883, (int64_t) 8) + sext_i32_i64(squot32(local_tid_50878, 32))] = x_50933;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // scan the first block, after which offset 'i' contains carry-in for block 'i+1'\n            {\n                int32_t skip_threads_50949;",
                                    "\n                \n                // read input for in-block scan\n                {\n                    if (squot32(local_tid_50878, 32) == 0 && ltid_in_bounds_50946) {\n                        y_50942 = ((volatile __local int64_t *) local_mem_50887)[sext_i32_i64(local_tid_50878)];\n                        y_50943 = ((volatile __local int64_t *) local_mem_50887)[squot64(byte_offsets_50883, (int64_t) 8) + sext_i32_i64(local_tid_50878)];\n                        if ((local_tid_50878 - squot32(local_tid_50878, 32) * 32) == 0) {\n                            x_50940 = y_50942;\n                            x_50941 = y_50943;\n                        }\n                    }\n                }\n                // in-block scan (hopefully no barriers needed)\n                {\n                    skip_threads_50949 = 1;\n                    while (slt32(skip_threads_50949, 32)) {\n                        bool thread_active_50950 = sle32(skip_threads_50949, local_tid_50878 - squot32(local_tid_50878, 32) * 32) && (squot32(local_tid_50878, 32) == 0 && ltid_in_bounds_50946);\n                        \n                        if (thread_active_50950) {\n                            // read operands\n                            {\n                                x_50940 = ((volatile __local int64_t *) local_mem_50887)[sext_i32_i64(local_tid_50878) - sext_i32_i64(skip_threads_50949)];\n                                x_50941 = ((volatile __local int64_t *) local_mem_50887)[squot64(byte_offsets_50883, (int64_t) 8) + (sext_i32_i64(local_tid_50878) - sext_i32_i64(skip_threads_50949))];\n                            }\n                        }\n                        // perform operation\n                        {\n                            if (thread_active_50950) {\n                                int64_t zz_50944 = x_50940 + y_50942;\n                                int64_t zz_50945 = x_50941 + y_50943;\n                                \n                                x_50940 = zz_50944;\n                 ", "               x_50941 = zz_50945;\n                            }\n                        }\n                        if (sle32(wave_sizze_50880, skip_threads_50949)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        if (thread_active_50950) {\n                            // write result\n                            {\n                                ((volatile __local int64_t *) local_mem_50887)[sext_i32_i64(local_tid_50878)] = x_50940;\n                                y_50942 = x_50940;\n                                ((volatile __local int64_t *) local_mem_50887)[squot64(byte_offsets_50883, (int64_t) 8) + sext_i32_i64(local_tid_50878)] = x_50941;\n                                y_50943 = x_50941;\n                            }\n                        }\n                        if (sle32(wave_sizze_50880, skip_threads_50949)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        skip_threads_50949 *= 2;\n                    }\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            \n            bool no_carry_in_50951 = squot32(local_tid_50878, 32) == 0 || !ltid_in_bounds_50946;\n            \n            // carry-in for every block except the first\n            {\n                // read operands\n                {\n                    if (!no_carry_in_50951) {\n                        y_50934 = x_50932;\n                        y_50935 = x_50933;\n                        x_50932 = ((__local int64_t *) local_mem_50887)[sext_i32_i64(squot32(local_tid_50878, 32)) - (int64_t) 1];\n                        x_50933 = ((__local int64_t *) local_mem_50887)[squot64(byte_offsets_50883, (int64_t) 8) + (sext_i32_i64(squot32(local_tid_50878, 32)) - (int64_t) 1)];\n                    }\n                }\n                // perform operation\n                {\n                    if (!no_carry_in_50951) {\n                        int64_t zz_50936 = x_50932 + ", "y_50934;\n                        int64_t zz_50937 = x_50933 + y_50935;\n                        \n                        x_50932 = zz_50936;\n                        x_50933 = zz_50937;\n                    }\n                }\n                // write final result\n                {\n                    if (!no_carry_in_50951) {\n                        ((__local int64_t *) local_mem_50887)[sext_i32_i64(local_tid_50878)] = x_50932;\n                        ((__local int64_t *) local_mem_50887)[squot64(byte_offsets_50883, (int64_t) 8) + sext_i32_i64(local_tid_50878)] = x_50933;\n                    }\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // restore correct values for first block\n            {\n                if (squot32(local_tid_50878, 32) == 0 && ltid_in_bounds_50946) {\n                    ((__local int64_t *) local_mem_50887)[sext_i32_i64(local_tid_50878)] = y_50934;\n                    ((__local int64_t *) local_mem_50887)[squot64(byte_offsets_50883, (int64_t) 8) + sext_i32_i64(local_tid_50878)] = y_50935;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            barrier(CLK_LOCAL_MEM_FENCE);\n            if (local_tid_50878 == 0) {\n                acc_50938 = ((__local int64_t *) local_mem_50887)[segscan_tblock_sizze_44195 - (int64_t) 1];\n                acc_50939 = ((__local int64_t *) local_mem_50887)[squot64(byte_offsets_50883, (int64_t) 8) + (segscan_tblock_sizze_44195 - (int64_t) 1)];\n            } else {\n                acc_50938 = ((__local int64_t *) local_mem_50887)[sext_i32_i64(local_tid_50878) - (int64_t) 1];\n                acc_50939 = ((__local int64_t *) local_mem_50887)[squot64(byte_offsets_50883, (int64_t) 8) + (sext_i32_i64(local_tid_50878) - (int64_t) 1)];\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n        }\n        prefix_50952 = (int64_t) 0;\n        prefix_50953 = (int64_t) 0;\n        block_new_sgm_50954 = sgm_idx_50902 == (int64_t) 0;\n        // Perform lookback\n",
                                    "        {\n            if (block_new_sgm_50954 && local_tid_50878 == 0) {\n                ((volatile __global int64_t *) incprefixes_mem_50869)[dynamic_id_50900] = acc_50938;\n                ((volatile __global int64_t *) incprefixes_mem_50873)[dynamic_id_50900] = acc_50939;\n                mem_fence_global();\n                ((volatile __global int8_t *) status_flags_mem_50865)[dynamic_id_50900] = (int8_t) 2;\n                acc_50938 = (int64_t) 0;\n                acc_50939 = (int64_t) 0;\n            }\n            if (!block_new_sgm_50954 && slt32(local_tid_50878, wave_sizze_50880)) {\n                if (local_tid_50878 == 0) {\n                    ((volatile __global int64_t *) aggregates_mem_50867)[dynamic_id_50900] = acc_50938;\n                    ((volatile __global int64_t *) aggregates_mem_50871)[dynamic_id_50900] = acc_50939;\n                    mem_fence_global();\n                    ((volatile __global int8_t *) status_flags_mem_50865)[dynamic_id_50900] = (int8_t) 1;\n                    \n                    int8_t tmp_50955 = ((volatile __global int8_t *) status_flags_mem_50865)[dynamic_id_50900 - (int64_t) 1];\n                    \n                    ((volatile __local int8_t *) local_mem_50887)[(int64_t) 0] = tmp_50955;\n                }\n                mem_fence_local();\n                \n                int8_t status_50956 = ((__local int8_t *) local_mem_50887)[(int64_t) 0];\n                \n                if (status_50956 == (int8_t) 2) {\n                    if (local_tid_50878 == 0) {\n                        prefix_50952 = ((volatile __global int64_t *) incprefixes_mem_50869)[dynamic_id_50900 - (int64_t) 1];\n                        prefix_50953 = ((volatile __global int64_t *) incprefixes_mem_50873)[dynamic_id_50900 - (int64_t) 1];\n                    }\n                } else {\n                    int32_t readOffset_50957 = sext_i64_i32(dynamic_id_50900 - sext_i32_i64(wave_sizze_50880));\n                    \n                    while (slt32(wave_sizze", "_50880 * -1, readOffset_50957)) {\n                        int32_t read_i_50958 = readOffset_50957 + local_tid_50878;\n                        int64_t aggr_50959 = (int64_t) 0;\n                        int64_t aggr_50960 = (int64_t) 0;\n                        int8_t flag_50961 = (int8_t) 0;\n                        \n                        if (sle32(0, read_i_50958)) {\n                            flag_50961 = ((volatile __global int8_t *) status_flags_mem_50865)[sext_i32_i64(read_i_50958)];\n                            if (flag_50961 == (int8_t) 2) {\n                                aggr_50959 = ((volatile __global int64_t *) incprefixes_mem_50869)[sext_i32_i64(read_i_50958)];\n                                aggr_50960 = ((volatile __global int64_t *) incprefixes_mem_50873)[sext_i32_i64(read_i_50958)];\n                            } else if (flag_50961 == (int8_t) 1) {\n                                aggr_50959 = ((volatile __global int64_t *) aggregates_mem_50867)[sext_i32_i64(read_i_50958)];\n                                aggr_50960 = ((volatile __global int64_t *) aggregates_mem_50871)[sext_i32_i64(read_i_50958)];\n                            }\n                        }\n                        ((__local int64_t *) local_mem_50887)[(int64_t) 4 + sext_i32_i64(local_tid_50878)] = aggr_50959;\n                        ((__local int64_t *) local_mem_50887)[squot64(warp_byte_offset_50885, (int64_t) 8) + sext_i32_i64(local_tid_50878)] = aggr_50960;\n                        ((__local int8_t *) local_mem_50887)[sext_i32_i64(local_tid_50878)] = flag_50961;\n                        flag_50961 = ((__local int8_t *) local_mem_50887)[sext_i32_i64(wave_sizze_50880) - (int64_t) 1];\n                        if (slt8(flag_50961, (int8_t) 2)) {\n                            int8_t flg_x_50968;\n                            int8_t flg_y_50969;\n                            int64_t x_50962;\n                            int64_t x_50963;\n                            int64_t y_50964;\n                      ", "      int64_t y_50965;\n                            int32_t skip_threads_50970;\n                            \n                            // read input for in-block scan\n                            {\n                                flg_y_50969 = ((volatile __local int8_t *) local_mem_50887)[sext_i32_i64(local_tid_50878)];\n                                y_50964 = ((volatile __local int64_t *) local_mem_50887)[(int64_t) 4 + sext_i32_i64(local_tid_50878)];\n                                y_50965 = ((volatile __local int64_t *) local_mem_50887)[squot64(warp_byte_offset_50885, (int64_t) 8) + sext_i32_i64(local_tid_50878)];\n                                if ((local_tid_50878 - squot32(local_tid_50878, 32) * 32) == 0) {\n                                    x_50962 = y_50964;\n                                    x_50963 = y_50965;\n                                    flg_x_50968 = flg_y_50969;\n                                }\n                            }\n                            // in-block scan (hopefully no barriers needed)\n                            {\n                                skip_threads_50970 = 1;\n                                while (slt32(skip_threads_50970, 32)) {\n                                    if (sle32(skip_threads_50970, local_tid_50878 - squot32(local_tid_50878, 32) * 32)) {\n                                        // read operands\n                                        {\n                                            flg_x_50968 = ((volatile __local int8_t *) local_mem_50887)[sext_i32_i64(local_tid_50878) - sext_i32_i64(skip_threads_50970)];\n                                            x_50962 = ((volatile __local int64_t *) local_mem_50887)[(int64_t) 4 + (sext_i32_i64(local_tid_50878) - sext_i32_i64(skip_threads_50970))];\n                                            x_50963 = ((volatile __local int64_t *) local_mem_50887)[squot64(warp_byte_offset_50885, (int64_t) 8) + (sext_i32_i64(local_tid_50878) - sext_i32_i64(skip_threads_50970))];\n             ",
                                    "                           }\n                                        // perform operation\n                                        {\n                                            if (flg_y_50969 == (int8_t) 2 || flg_y_50969 == (int8_t) 0) {\n                                                flg_x_50968 = flg_y_50969;\n                                                x_50962 = y_50964;\n                                                x_50963 = y_50965;\n                                            } else {\n                                                int64_t zz_50966 = x_50962 + y_50964;\n                                                int64_t zz_50967 = x_50963 + y_50965;\n                                                \n                                                x_50962 = zz_50966;\n                                                x_50963 = zz_50967;\n                                            }\n                                        }\n                                        // write result\n                                        {\n                                            ((volatile __local int8_t *) local_mem_50887)[sext_i32_i64(local_tid_50878)] = flg_x_50968;\n                                            flg_y_50969 = flg_x_50968;\n                                            ((volatile __local int64_t *) local_mem_50887)[(int64_t) 4 + sext_i32_i64(local_tid_50878)] = x_50962;\n                                            y_50964 = x_50962;\n                                            ((volatile __local int64_t *) local_mem_50887)[squot64(warp_byte_offset_50885, (int64_t) 8) + sext_i32_i64(local_tid_50878)] = x_50963;\n                                            y_50965 = x_50963;\n                                        }\n                                    }\n                                    skip_threads_50970 *= 2;\n                                }\n                            }\n                        }\n                        flag_50961 = ((__local int8_t *) local_mem", "_50887)[sext_i32_i64(wave_sizze_50880) - (int64_t) 1];\n                        aggr_50959 = ((__local int64_t *) local_mem_50887)[(int64_t) 4 + (sext_i32_i64(wave_sizze_50880) - (int64_t) 1)];\n                        aggr_50960 = ((__local int64_t *) local_mem_50887)[squot64(warp_byte_offset_50885, (int64_t) 8) + (sext_i32_i64(wave_sizze_50880) - (int64_t) 1)];\n                        if (flag_50961 == (int8_t) 2) {\n                            readOffset_50957 = wave_sizze_50880 * -1;\n                        } else if (flag_50961 == (int8_t) 1) {\n                            readOffset_50957 -= wave_sizze_50880;\n                        }\n                        if (slt8((int8_t) 0, flag_50961)) {\n                            int64_t x_50971 = aggr_50959;\n                            int64_t x_50972 = aggr_50960;\n                            int64_t y_50973 = prefix_50952;\n                            int64_t y_50974 = prefix_50953;\n                            int64_t zz_50975 = x_50971 + y_50973;\n                            int64_t zz_50976 = x_50972 + y_50974;\n                            \n                            prefix_50952 = zz_50975;\n                            prefix_50953 = zz_50976;\n                        }\n                        mem_fence_local();\n                    }\n                }\n                if (local_tid_50878 == 0) {\n                    if (boundary_50903 == sext_i64_i32(segscan_tblock_sizze_44195 * chunk_sizze_50862)) {\n                        int64_t x_50977 = prefix_50952;\n                        int64_t x_50978 = prefix_50953;\n                        int64_t y_50979 = acc_50938;\n                        int64_t y_50980 = acc_50939;\n                        int64_t zz_50981 = x_50977 + y_50979;\n                        int64_t zz_50982 = x_50978 + y_50980;\n                        \n                        ((volatile __global int64_t *) incprefixes_mem_50869)[dynamic_id_50900] = zz_50981;\n                        ((volatile __global int64_t *) inc", "prefixes_mem_50873)[dynamic_id_50900] = zz_50982;\n                        mem_fence_global();\n                        ((volatile __global int8_t *) status_flags_mem_50865)[dynamic_id_50900] = (int8_t) 2;\n                    }\n                    ((__local int64_t *) local_mem_50887)[(int64_t) 4] = prefix_50952;\n                    ((__local int64_t *) local_mem_50887)[squot64(warp_byte_offset_50885, (int64_t) 8)] = prefix_50953;\n                    acc_50938 = (int64_t) 0;\n                    acc_50939 = (int64_t) 0;\n                }\n            }\n            if (!(dynamic_id_50900 == (int64_t) 0)) {\n                barrier(CLK_LOCAL_MEM_FENCE);\n                prefix_50952 = ((__local int64_t *) local_mem_50887)[(int64_t) 4];\n                prefix_50953 = ((__local int64_t *) local_mem_50887)[squot64(warp_byte_offset_50885, (int64_t) 8)];\n                barrier(CLK_LOCAL_MEM_FENCE);\n            }\n        }\n        // Distribute results\n        {\n            int64_t x_50983;\n            int64_t y_50985;\n            int64_t x_50989 = prefix_50952;\n            int64_t y_50991 = acc_50938;\n            int64_t x_50984;\n            int64_t y_50986;\n            int64_t x_50990 = prefix_50953;\n            int64_t y_50992 = acc_50939;\n            \n            if (slt32(local_tid_50878 * chunk_sizze_32b_50882, boundary_50903) && !block_new_sgm_50954) {\n                int64_t zz_50993 = x_50989 + y_50991;\n                int64_t zz_50994 = x_50990 + y_50992;\n                \n                x_50983 = zz_50993;\n                x_50984 = zz_50994;\n            } else {\n                x_50983 = acc_50938;\n                x_50984 = acc_50939;\n            }\n            \n            int32_t stopping_point_50995 = segsizze_compact_50904 - srem32(local_tid_50878 * chunk_sizze_32b_50882 - 1 + segsizze_compact_50904 - boundary_50903, segsizze_compact_50904);\n            \n            for (int64_t i_50996 = 0; i_50996 < chunk_sizze_50862; i_50996++) {\n                if (slt32(sext_i",
                                    "64_i32(i_50996), stopping_point_50995 - 1)) {\n                    y_50985 = private_mem_50905[i_50996];\n                    y_50986 = private_mem_50907[i_50996];\n                    \n                    int64_t zz_50987 = x_50983 + y_50985;\n                    int64_t zz_50988 = x_50984 + y_50986;\n                    \n                    private_mem_50905[i_50996] = zz_50987;\n                    private_mem_50907[i_50996] = zz_50988;\n                }\n            }\n        }\n        // Transpose scan output and Write it to global memory in coalesced fashion\n        {\n            for (int64_t i_50997 = 0; i_50997 < chunk_sizze_50862; i_50997++) {\n                int64_t sharedIdx_50998 = sext_i32_i64(local_tid_50878) * chunk_sizze_50862 + i_50997;\n                int64_t tmp_50999 = private_mem_50905[i_50997];\n                \n                ((__local int64_t *) local_mem_50887)[sharedIdx_50998] = tmp_50999;\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            for (int64_t i_51000 = 0; i_51000 < chunk_sizze_50862; i_51000++) {\n                int64_t flat_idx_51001 = thd_offset_50909 + i_51000 * segscan_tblock_sizze_44195;\n                int64_t slice_51002 = dzlz7bUZLzpZRz20Udz2082Uz20Udz2084Uz2088Uz2084Uz7dUzg_39167;\n                int64_t gtid_44199 = flat_idx_51001;\n                int64_t remnant_51003 = flat_idx_51001 - gtid_44199;\n                \n                if (slt64(flat_idx_51001, dzlz7bUZLzpZRz20Udz2082Uz20Udz2084Uz2088Uz2084Uz7dUzg_39167)) {\n                    int64_t tmp_51004 = ((__local int64_t *) local_mem_50887)[flat_idx_51001 - block_offset_50901];\n                    \n                    ((__global int64_t *) mem_49565)[gtid_44199] = tmp_51004;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            for (int64_t i_51005 = 0; i_51005 < chunk_sizze_50862; i_51005++) {\n                int64_t sharedIdx_51006 = sext_i32_i64(local_tid_50878) * chunk_sizze_50862 + i_51005;\n                int64_t tmp_", "51007 = private_mem_50907[i_51005];\n                \n                ((__local int64_t *) local_mem_50887)[sharedIdx_51006] = tmp_51007;\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            for (int64_t i_51008 = 0; i_51008 < chunk_sizze_50862; i_51008++) {\n                int64_t flat_idx_51009 = thd_offset_50909 + i_51008 * segscan_tblock_sizze_44195;\n                int64_t slice_51010 = dzlz7bUZLzpZRz20Udz2082Uz20Udz2084Uz2088Uz2084Uz7dUzg_39167;\n                int64_t gtid_44199 = flat_idx_51009;\n                int64_t remnant_51011 = flat_idx_51009 - gtid_44199;\n                \n                if (slt64(flat_idx_51009, dzlz7bUZLzpZRz20Udz2082Uz20Udz2084Uz2088Uz2084Uz7dUzg_39167)) {\n                    int64_t tmp_51012 = ((__local int64_t *) local_mem_50887)[flat_idx_51009 - block_offset_50901];\n                    \n                    ((__global int64_t *) mem_49567)[gtid_44199] = tmp_51012;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n        }\n    }\n    \n  error_3:\n    return;\n    #undef segscan_tblock_sizze_44195\n    #undef chunk_sizze_50862\n}\nFUTHARK_KERNEL\nvoid builtinzhiota_i64ziiota_i64_50380(int64_t n_50376, int64_t x_50377, int64_t s_50378, int64_t virt_num_tblocks_50385, int64_t num_tblocks_50386, __global unsigned char *mem_50375)\n{\n    int32_t iota_ltid_50381;\n    int32_t tblock_sizze_50383;\n    int32_t iota_gid_50382;\n    int32_t iota_gtid_50380;\n    int32_t phys_tblock_id_50387;\n    int32_t iterations_50388;\n    \n    iota_ltid_50381 = get_local_id(0);\n    tblock_sizze_50383 = get_local_size(0);\n    iota_gid_50382 = get_tblock_id(0);\n    iota_gtid_50380 = iota_gid_50382 * tblock_sizze_50383 + iota_ltid_50381;\n    phys_tblock_id_50387 = get_tblock_id(0);\n    iterations_50388 = sdiv_up32(sext_i64_i32(virt_num_tblocks_50385) - phys_tblock_id_50387, sext_i64_i32(num_tblocks_50386));\n    for (int32_t i_50389 = 0; i_50389 < iterations_50388; i_50389++) {\n        int32_t virt_tblock_id_50390;\n        int64_", "t global_tid_50391;\n        \n        virt_tblock_id_50390 = phys_tblock_id_50387 + i_50389 * sext_i64_i32(num_tblocks_50386);\n        global_tid_50391 = sext_i32_i64(virt_tblock_id_50390) * sext_i32_i64(tblock_sizze_50383) + sext_i32_i64(iota_ltid_50381);\n        if (slt64(global_tid_50391, n_50376)) {\n            ((__global int64_t *) mem_50375)[global_tid_50391] = add64(mul64(global_tid_50391, s_50378), x_50377);\n        }\n        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    }\n    \n  error_1:\n    return;\n}\nFUTHARK_KERNEL\nvoid builtinzhreplicate_boolzireplicate_51021(int64_t num_elems_51017, unsigned char val_51018_bits, int64_t replicate_n_51020, int64_t virt_num_tblocks_51026, int64_t num_tblocks_51027, __global unsigned char *mem_51016)\n{\n    bool val_51018 = val_51018_bits;\n    int32_t replicate_ltid_51022;\n    int32_t tblock_sizze_51024;\n    int32_t replicate_gid_51023;\n    int32_t replicate_gtid_51021;\n    int32_t phys_tblock_id_51028;\n    int32_t iterations_51029;\n    \n    replicate_ltid_51022 = get_local_id(0);\n    tblock_sizze_51024 = get_local_size(0);\n    replicate_gid_51023 = get_tblock_id(0);\n    replicate_gtid_51021 = replicate_gid_51023 * tblock_sizze_51024 + replicate_ltid_51022;\n    phys_tblock_id_51028 = get_tblock_id(0);\n    iterations_51029 = sdiv_up32(sext_i64_i32(virt_num_tblocks_51026) - phys_tblock_id_51028, sext_i64_i32(num_tblocks_51027));\n    for (int32_t i_51030 = 0; i_51030 < iterations_51029; i_51030++) {\n        int32_t virt_tblock_id_51031;\n        int64_t global_tid_51032;\n        int64_t slice_51034;\n        int64_t rep_i_51033;\n        int64_t remnant_51035;\n        \n        virt_tblock_id_51031 = phys_tblock_id_51028 + i_51030 * sext_i64_i32(num_tblocks_51027);\n        global_tid_51032 = sext_i32_i64(virt_tblock_id_51031) * sext_i32_i64(tblock_sizze_51024) + sext_i32_i64(replicate_ltid_51022);\n        slice_51034 = num_elems_51017;\n        rep_i_51033 = global_tid_51032;\n        remnant_51035 = global_tid_51032 - rep_",
                                    "i_51033;\n        if (slt64(global_tid_51032, replicate_n_51020)) {\n            ((__global bool *) mem_51016)[rep_i_51033] = val_51018;\n        }\n        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    }\n    \n  error_1:\n    return;\n}\nFUTHARK_KERNEL\nvoid builtinzhreplicate_f64zireplicate_50455(int64_t num_elems_50451, double val_50452, int64_t replicate_n_50454, int64_t virt_num_tblocks_50460, int64_t num_tblocks_50461, __global unsigned char *mem_50450)\n{\n    int32_t replicate_ltid_50456;\n    int32_t tblock_sizze_50458;\n    int32_t replicate_gid_50457;\n    int32_t replicate_gtid_50455;\n    int32_t phys_tblock_id_50462;\n    int32_t iterations_50463;\n    \n    replicate_ltid_50456 = get_local_id(0);\n    tblock_sizze_50458 = get_local_size(0);\n    replicate_gid_50457 = get_tblock_id(0);\n    replicate_gtid_50455 = replicate_gid_50457 * tblock_sizze_50458 + replicate_ltid_50456;\n    phys_tblock_id_50462 = get_tblock_id(0);\n    iterations_50463 = sdiv_up32(sext_i64_i32(virt_num_tblocks_50460) - phys_tblock_id_50462, sext_i64_i32(num_tblocks_50461));\n    for (int32_t i_50464 = 0; i_50464 < iterations_50463; i_50464++) {\n        int32_t virt_tblock_id_50465;\n        int64_t global_tid_50466;\n        int64_t slice_50468;\n        int64_t rep_i_50467;\n        int64_t remnant_50469;\n        \n        virt_tblock_id_50465 = phys_tblock_id_50462 + i_50464 * sext_i64_i32(num_tblocks_50461);\n        global_tid_50466 = sext_i32_i64(virt_tblock_id_50465) * sext_i32_i64(tblock_sizze_50458) + sext_i32_i64(replicate_ltid_50456);\n        slice_50468 = num_elems_50451;\n        rep_i_50467 = global_tid_50466;\n        remnant_50469 = global_tid_50466 - rep_i_50467;\n        if (slt64(global_tid_50466, replicate_n_50454)) {\n            ((__global double *) mem_50450)[rep_i_50467] = val_50452;\n        }\n        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    }\n    \n  error_1:\n    return;\n}\nFUTHARK_KERNEL\nvoid builtinzhreplicate_i32zireplicate_50282(int64_t num_elems_50278, int32", "_t val_50279, int64_t replicate_n_50281, int64_t virt_num_tblocks_50287, int64_t num_tblocks_50288, __global unsigned char *mem_50277)\n{\n    int32_t replicate_ltid_50283;\n    int32_t tblock_sizze_50285;\n    int32_t replicate_gid_50284;\n    int32_t replicate_gtid_50282;\n    int32_t phys_tblock_id_50289;\n    int32_t iterations_50290;\n    \n    replicate_ltid_50283 = get_local_id(0);\n    tblock_sizze_50285 = get_local_size(0);\n    replicate_gid_50284 = get_tblock_id(0);\n    replicate_gtid_50282 = replicate_gid_50284 * tblock_sizze_50285 + replicate_ltid_50283;\n    phys_tblock_id_50289 = get_tblock_id(0);\n    iterations_50290 = sdiv_up32(sext_i64_i32(virt_num_tblocks_50287) - phys_tblock_id_50289, sext_i64_i32(num_tblocks_50288));\n    for (int32_t i_50291 = 0; i_50291 < iterations_50290; i_50291++) {\n        int32_t virt_tblock_id_50292;\n        int64_t global_tid_50293;\n        int64_t slice_50295;\n        int64_t rep_i_50294;\n        int64_t remnant_50296;\n        \n        virt_tblock_id_50292 = phys_tblock_id_50289 + i_50291 * sext_i64_i32(num_tblocks_50288);\n        global_tid_50293 = sext_i32_i64(virt_tblock_id_50292) * sext_i32_i64(tblock_sizze_50285) + sext_i32_i64(replicate_ltid_50283);\n        slice_50295 = num_elems_50278;\n        rep_i_50294 = global_tid_50293;\n        remnant_50296 = global_tid_50293 - rep_i_50294;\n        if (slt64(global_tid_50293, replicate_n_50281)) {\n            ((__global int32_t *) mem_50277)[rep_i_50294] = val_50279;\n        }\n        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    }\n    \n  error_1:\n    return;\n}\nFUTHARK_KERNEL\nvoid builtinzhreplicate_i64zireplicate_50197(int64_t num_elems_50193, int64_t val_50194, int64_t replicate_n_50196, int64_t virt_num_tblocks_50202, int64_t num_tblocks_50203, __global unsigned char *mem_50192)\n{\n    int32_t replicate_ltid_50198;\n    int32_t tblock_sizze_50200;\n    int32_t replicate_gid_50199;\n    int32_t replicate_gtid_50197;\n    int32_t phys_tblock_id_50204;\n    int32_t iterations_502", "05;\n    \n    replicate_ltid_50198 = get_local_id(0);\n    tblock_sizze_50200 = get_local_size(0);\n    replicate_gid_50199 = get_tblock_id(0);\n    replicate_gtid_50197 = replicate_gid_50199 * tblock_sizze_50200 + replicate_ltid_50198;\n    phys_tblock_id_50204 = get_tblock_id(0);\n    iterations_50205 = sdiv_up32(sext_i64_i32(virt_num_tblocks_50202) - phys_tblock_id_50204, sext_i64_i32(num_tblocks_50203));\n    for (int32_t i_50206 = 0; i_50206 < iterations_50205; i_50206++) {\n        int32_t virt_tblock_id_50207;\n        int64_t global_tid_50208;\n        int64_t slice_50210;\n        int64_t rep_i_50209;\n        int64_t remnant_50211;\n        \n        virt_tblock_id_50207 = phys_tblock_id_50204 + i_50206 * sext_i64_i32(num_tblocks_50203);\n        global_tid_50208 = sext_i32_i64(virt_tblock_id_50207) * sext_i32_i64(tblock_sizze_50200) + sext_i32_i64(replicate_ltid_50198);\n        slice_50210 = num_elems_50193;\n        rep_i_50209 = global_tid_50208;\n        remnant_50211 = global_tid_50208 - rep_i_50209;\n        if (slt64(global_tid_50208, replicate_n_50196)) {\n            ((__global int64_t *) mem_50192)[rep_i_50209] = val_50194;\n        }\n        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    }\n    \n  error_1:\n    return;\n}\nFUTHARK_KERNEL\nvoid builtinzhreplicate_i8zireplicate_50247(int64_t num_elems_50243, int8_t val_50244, int64_t replicate_n_50246, int64_t virt_num_tblocks_50252, int64_t num_tblocks_50253, __global unsigned char *mem_50242)\n{\n    int32_t replicate_ltid_50248;\n    int32_t tblock_sizze_50250;\n    int32_t replicate_gid_50249;\n    int32_t replicate_gtid_50247;\n    int32_t phys_tblock_id_50254;\n    int32_t iterations_50255;\n    \n    replicate_ltid_50248 = get_local_id(0);\n    tblock_sizze_50250 = get_local_size(0);\n    replicate_gid_50249 = get_tblock_id(0);\n    replicate_gtid_50247 = replicate_gid_50249 * tblock_sizze_50250 + replicate_ltid_50248;\n    phys_tblock_id_50254 = get_tblock_id(0);\n    iterations_50255 = sdiv_up32(sext_i64_i32(virt_num",
                                    "_tblocks_50252) - phys_tblock_id_50254, sext_i64_i32(num_tblocks_50253));\n    for (int32_t i_50256 = 0; i_50256 < iterations_50255; i_50256++) {\n        int32_t virt_tblock_id_50257;\n        int64_t global_tid_50258;\n        int64_t slice_50260;\n        int64_t rep_i_50259;\n        int64_t remnant_50261;\n        \n        virt_tblock_id_50257 = phys_tblock_id_50254 + i_50256 * sext_i64_i32(num_tblocks_50253);\n        global_tid_50258 = sext_i32_i64(virt_tblock_id_50257) * sext_i32_i64(tblock_sizze_50250) + sext_i32_i64(replicate_ltid_50248);\n        slice_50260 = num_elems_50243;\n        rep_i_50259 = global_tid_50258;\n        remnant_50261 = global_tid_50258 - rep_i_50259;\n        if (slt64(global_tid_50258, replicate_n_50246)) {\n            ((__global int8_t *) mem_50242)[rep_i_50259] = val_50244;\n        }\n        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    }\n    \n  error_1:\n    return;\n}\nFUTHARK_KERNEL_SIZED(do_DBSCAN_doublezigpuseq_50431_dim1, 1, 1)\nvoid do_DBSCAN_doublezigpuseq_50431(__global int *global_failure, double clBase_34770, double zt_res_41216, __global unsigned char *current_partition_mem_49396, __global unsigned char *mem_49428, __global unsigned char *mem_49429)\n{\n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_50433;\n    int32_t tblock_sizze_50436;\n    int32_t wave_sizze_50435;\n    int32_t block_id_50434;\n    int32_t global_tid_50432;\n    int64_t tid_50431;\n    double minus_arg0_49051;\n    double zm_res_49054;\n    double zm_res_49058;\n    \n    local_tid_50433 = get_local_id(0);\n    tblock_sizze_50436 = get_local_size(0);\n    wave_sizze_50435 = LOCKSTEP_WIDTH;\n    block_id_50434 = get_tblock_id(0);\n    global_tid_50432 = block_id_50434 * tblock_sizze_50436 + local_tid_50433;\n    tid_50431 = sext_i32_i64(global_tid_50432);\n    minus_arg0_49051 = ((__global double *) current_partition_mem_49396)[(int64_t) 0];\n    zm_res_49054 = minus_arg0_49051 - zt_res_41216;\n    zm_res_49058 = minus_arg0_49051 - clBase_34770;\n ", "   ((__global double *) mem_49428)[(int64_t) 0] = zm_res_49054;\n    ((__global double *) mem_49429)[(int64_t) 0] = zm_res_49058;\n    \n  error_0:\n    return;\n}\nFUTHARK_KERNEL_SIZED(do_DBSCAN_doublezisegmap_44355_dim1, 1, 1)\nvoid do_DBSCAN_doublezisegmap_44355(__global int *global_failure, int64_t n_34757, int64_t m_41239, int64_t num_tblocks_44360, int32_t virt_num_tblocks_50393, __global unsigned char *current_partition_mem_49387, __global unsigned char *current_partition_mem_49388, __global unsigned char *mem_49403, __global unsigned char *mem_49405, __global unsigned char *mem_49411, __global unsigned char *mem_49413, __global unsigned char *mem_49415)\n{\n    #define segmap_tblock_sizze_44358 (do_DBSCAN_doublezisegmap_44355zisegmap_tblock_sizze_44358)\n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_50395;\n    int32_t tblock_sizze_50398;\n    int32_t wave_sizze_50397;\n    int32_t block_id_50396;\n    int32_t global_tid_50394;\n    int64_t phys_tid_44355;\n    int32_t phys_tblock_id_50399;\n    int32_t iterations_50400;\n    \n    local_tid_50395 = get_local_id(0);\n    tblock_sizze_50398 = get_local_size(0);\n    wave_sizze_50397 = LOCKSTEP_WIDTH;\n    block_id_50396 = get_tblock_id(0);\n    global_tid_50394 = block_id_50396 * tblock_sizze_50398 + local_tid_50395;\n    phys_tid_44355 = sext_i32_i64(global_tid_50394);\n    phys_tblock_id_50399 = get_tblock_id(0);\n    iterations_50400 = sdiv_up32(virt_num_tblocks_50393 - phys_tblock_id_50399, sext_i64_i32(num_tblocks_44360));\n    for (int32_t i_50401 = 0; i_50401 < iterations_50400; i_50401++) {\n        int32_t virt_tblock_id_50402;\n        int64_t global_tid_50403;\n        int64_t slice_50404;\n        int64_t write_i_44354;\n        int64_t remnant_50405;\n        \n        virt_tblock_id_50402 = phys_tblock_id_50399 + i_50401 * sext_i64_i32(num_tblocks_44360);\n        global_tid_50403 = sext_i32_i64(virt_tblock_id_50402) * segmap_tblock_sizze_44358 + sext_i32_i64(local_tid_50395);\n        slice_50404 = n_34", "757;\n        write_i_44354 = global_tid_50403;\n        remnant_50405 = global_tid_50403 - write_i_44354;\n        if (slt64(write_i_44354, n_34757)) {\n            int64_t eta_p_42431;\n            double write_value_42434;\n            double write_value_42435;\n            bool cond_42436;\n            int64_t lifted_lambda_res_42437;\n            \n            eta_p_42431 = ((__global int64_t *) mem_49405)[write_i_44354];\n            write_value_42434 = ((__global double *) current_partition_mem_49387)[write_i_44354];\n            write_value_42435 = ((__global double *) current_partition_mem_49388)[write_i_44354];\n            cond_42436 = eta_p_42431 == (int64_t) 1;\n            if (cond_42436) {\n                int64_t eta_p_42432;\n                int64_t lifted_lambda_res_t_res_42673;\n                \n                eta_p_42432 = ((__global int64_t *) mem_49403)[write_i_44354];\n                lifted_lambda_res_t_res_42673 = sub64(eta_p_42432, (int64_t) 1);\n                lifted_lambda_res_42437 = lifted_lambda_res_t_res_42673;\n            } else {\n                lifted_lambda_res_42437 = (int64_t) -1;\n            }\n            if (sle64((int64_t) 0, lifted_lambda_res_42437) && slt64(lifted_lambda_res_42437, m_41239)) {\n                ((__global int64_t *) mem_49415)[lifted_lambda_res_42437] = write_i_44354;\n            }\n            if (sle64((int64_t) 0, lifted_lambda_res_42437) && slt64(lifted_lambda_res_42437, m_41239)) {\n                ((__global double *) mem_49413)[lifted_lambda_res_42437] = write_value_42434;\n            }\n            if (sle64((int64_t) 0, lifted_lambda_res_42437) && slt64(lifted_lambda_res_42437, m_41239)) {\n                ((__global double *) mem_49411)[lifted_lambda_res_42437] = write_value_42435;\n            }\n        }\n        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    }\n    \n  error_1:\n    return;\n    #undef segmap_tblock_sizze_44358\n}\nFUTHARK_KERNEL_SIZED(do_DBSCAN_doublezisegmap_44371_dim1, 1, 1)\nvoid do_DBSCAN_doubl",
                                    "ezisegmap_44371(__global int *global_failure, int64_t dz2082U_34762, int64_t m_41318, int64_t num_tblocks_44376, int32_t virt_num_tblocks_50539, __global unsigned char *clProc_mem_49382, __global unsigned char *clProc_mem_49383, __global unsigned char *mem_49432, __global unsigned char *mem_49434, __global unsigned char *mem_49436, __global unsigned char *mem_49438, __global unsigned char *mem_49440, __global unsigned char *mem_49442, __global unsigned char *mem_49444)\n{\n    #define segmap_tblock_sizze_44374 (do_DBSCAN_doublezisegmap_44371zisegmap_tblock_sizze_44374)\n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_50541;\n    int32_t tblock_sizze_50544;\n    int32_t wave_sizze_50543;\n    int32_t block_id_50542;\n    int32_t global_tid_50540;\n    int64_t phys_tid_44371;\n    int32_t phys_tblock_id_50545;\n    int32_t iterations_50546;\n    \n    local_tid_50541 = get_local_id(0);\n    tblock_sizze_50544 = get_local_size(0);\n    wave_sizze_50543 = LOCKSTEP_WIDTH;\n    block_id_50542 = get_tblock_id(0);\n    global_tid_50540 = block_id_50542 * tblock_sizze_50544 + local_tid_50541;\n    phys_tid_44371 = sext_i32_i64(global_tid_50540);\n    phys_tblock_id_50545 = get_tblock_id(0);\n    iterations_50546 = sdiv_up32(virt_num_tblocks_50539 - phys_tblock_id_50545, sext_i64_i32(num_tblocks_44376));\n    for (int32_t i_50547 = 0; i_50547 < iterations_50546; i_50547++) {\n        int32_t virt_tblock_id_50548;\n        int64_t global_tid_50549;\n        int64_t slice_50550;\n        int64_t write_i_44370;\n        int64_t remnant_50551;\n        \n        virt_tblock_id_50548 = phys_tblock_id_50545 + i_50547 * sext_i64_i32(num_tblocks_44376);\n        global_tid_50549 = sext_i32_i64(virt_tblock_id_50548) * segmap_tblock_sizze_44374 + sext_i32_i64(local_tid_50541);\n        slice_50550 = dz2082U_34762;\n        write_i_44370 = global_tid_50549;\n        remnant_50551 = global_tid_50549 - write_i_44370;\n        if (slt64(write_i_44370, dz2082U_34762)) {\n            int64_t eta_p_4", "2370;\n            double write_value_42372;\n            double write_value_42373;\n            int64_t write_value_42374;\n            bool cond_42376;\n            int64_t lifted_lambda_res_42377;\n            \n            eta_p_42370 = ((__global int64_t *) mem_49434)[write_i_44370];\n            write_value_42372 = ((__global double *) clProc_mem_49382)[write_i_44370];\n            write_value_42373 = ((__global double *) clProc_mem_49383)[write_i_44370];\n            write_value_42374 = ((__global int64_t *) mem_49436)[write_i_44370];\n            cond_42376 = eta_p_42370 == (int64_t) 1;\n            if (cond_42376) {\n                int64_t eta_p_42371;\n                int64_t lifted_lambda_res_t_res_42688;\n                \n                eta_p_42371 = ((__global int64_t *) mem_49432)[write_i_44370];\n                lifted_lambda_res_t_res_42688 = sub64(eta_p_42371, (int64_t) 1);\n                lifted_lambda_res_42377 = lifted_lambda_res_t_res_42688;\n            } else {\n                lifted_lambda_res_42377 = (int64_t) -1;\n            }\n            if (sle64((int64_t) 0, lifted_lambda_res_42377) && slt64(lifted_lambda_res_42377, m_41318)) {\n                ((__global double *) mem_49444)[lifted_lambda_res_42377] = write_value_42372;\n            }\n            if (sle64((int64_t) 0, lifted_lambda_res_42377) && slt64(lifted_lambda_res_42377, m_41318)) {\n                ((__global double *) mem_49442)[lifted_lambda_res_42377] = write_value_42373;\n            }\n            if (sle64((int64_t) 0, lifted_lambda_res_42377) && slt64(lifted_lambda_res_42377, m_41318)) {\n                ((__global int64_t *) mem_49440)[lifted_lambda_res_42377] = write_value_42374;\n            }\n            if (sle64((int64_t) 0, lifted_lambda_res_42377) && slt64(lifted_lambda_res_42377, m_41318)) {\n                ((__global int64_t *) mem_49438)[lifted_lambda_res_42377] = write_i_44370;\n            }\n        }\n        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    }\n    \n  error_1:", "\n    return;\n    #undef segmap_tblock_sizze_44374\n}\nFUTHARK_KERNEL_SIZED(do_DBSCAN_doublezisegmap_44387_dim1, 1, 1)\nvoid do_DBSCAN_doublezisegmap_44387(__global int *global_failure, int64_t m_41318, int64_t y_41398, int64_t num_tblocks_44392, int32_t virt_num_tblocks_50706, __global unsigned char *mem_49438, __global unsigned char *mem_49440, __global unsigned char *mem_49442, __global unsigned char *mem_49444, __global unsigned char *mem_49448, __global unsigned char *mem_49450, __global unsigned char *mem_49452, __global unsigned char *mem_49454, __global unsigned char *mem_49456, __global unsigned char *mem_49458, __global unsigned char *mem_49460)\n{\n    #define segmap_tblock_sizze_44390 (do_DBSCAN_doublezisegmap_44387zisegmap_tblock_sizze_44390)\n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_50708;\n    int32_t tblock_sizze_50711;\n    int32_t wave_sizze_50710;\n    int32_t block_id_50709;\n    int32_t global_tid_50707;\n    int64_t phys_tid_44387;\n    int32_t phys_tblock_id_50712;\n    int32_t iterations_50713;\n    \n    local_tid_50708 = get_local_id(0);\n    tblock_sizze_50711 = get_local_size(0);\n    wave_sizze_50710 = LOCKSTEP_WIDTH;\n    block_id_50709 = get_tblock_id(0);\n    global_tid_50707 = block_id_50709 * tblock_sizze_50711 + local_tid_50708;\n    phys_tid_44387 = sext_i32_i64(global_tid_50707);\n    phys_tblock_id_50712 = get_tblock_id(0);\n    iterations_50713 = sdiv_up32(virt_num_tblocks_50706 - phys_tblock_id_50712, sext_i64_i32(num_tblocks_44392));\n    for (int32_t i_50714 = 0; i_50714 < iterations_50713; i_50714++) {\n        int32_t virt_tblock_id_50715;\n        int64_t global_tid_50716;\n        int64_t slice_50717;\n        int64_t write_i_44386;\n        int64_t remnant_50718;\n        \n        virt_tblock_id_50715 = phys_tblock_id_50712 + i_50714 * sext_i64_i32(num_tblocks_44392);\n        global_tid_50716 = sext_i32_i64(virt_tblock_id_50715) * segmap_tblock_sizze_44390 + sext_i32_i64(local_tid_50708);\n        slice_50717 = m_41318",
                                    ";\n        write_i_44386 = global_tid_50716;\n        remnant_50718 = global_tid_50716 - write_i_44386;\n        if (slt64(write_i_44386, m_41318)) {\n            int64_t c_41403;\n            int64_t offset_41404;\n            int64_t offset_41405;\n            double v_41406;\n            double v_41407;\n            int64_t v_41408;\n            int64_t v_41409;\n            bool is_this_one_41410;\n            bool is_this_one_41411;\n            int64_t this_offset_41412;\n            int64_t total_res_41413;\n            int64_t this_offset_41414;\n            int64_t total_res_41415;\n            \n            c_41403 = ((__global int64_t *) mem_49452)[write_i_44386];\n            offset_41404 = ((__global int64_t *) mem_49448)[write_i_44386];\n            offset_41405 = ((__global int64_t *) mem_49450)[write_i_44386];\n            v_41406 = ((__global double *) mem_49444)[write_i_44386];\n            v_41407 = ((__global double *) mem_49442)[write_i_44386];\n            v_41408 = ((__global int64_t *) mem_49440)[write_i_44386];\n            v_41409 = ((__global int64_t *) mem_49438)[write_i_44386];\n            is_this_one_41410 = c_41403 == (int64_t) 0;\n            is_this_one_41411 = c_41403 == (int64_t) 1;\n            this_offset_41412 = y_41398 + offset_41405;\n            if (is_this_one_41411) {\n                total_res_41413 = this_offset_41412;\n            } else {\n                total_res_41413 = (int64_t) -1;\n            }\n            this_offset_41414 = (int64_t) -1 + offset_41404;\n            if (is_this_one_41410) {\n                total_res_41415 = this_offset_41414;\n            } else {\n                total_res_41415 = total_res_41413;\n            }\n            if (sle64((int64_t) 0, total_res_41415) && slt64(total_res_41415, m_41318)) {\n                ((__global double *) mem_49454)[total_res_41415] = v_41406;\n            }\n            if (sle64((int64_t) 0, total_res_41415) && slt64(total_res_41415, m_41318)) {\n                ((__global double *) mem_49456)[tota", "l_res_41415] = v_41407;\n            }\n            if (sle64((int64_t) 0, total_res_41415) && slt64(total_res_41415, m_41318)) {\n                ((__global int64_t *) mem_49458)[total_res_41415] = v_41408;\n            }\n            if (sle64((int64_t) 0, total_res_41415) && slt64(total_res_41415, m_41318)) {\n                ((__global int64_t *) mem_49460)[total_res_41415] = v_41409;\n            }\n        }\n        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    }\n    \n  error_1:\n    return;\n    #undef segmap_tblock_sizze_44390\n}\nFUTHARK_KERNEL_SIZED(do_DBSCAN_doublezisegmap_44403_dim1, 1, 1)\nvoid do_DBSCAN_doublezisegmap_44403(__global int *global_failure, int64_t partition_sizze_41393, int64_t m_41485, int64_t num_tblocks_44408, int32_t virt_num_tblocks_50823, __global unsigned char *mem_49454, __global unsigned char *mem_49456, __global unsigned char *mem_49458, __global unsigned char *mem_49473, __global unsigned char *mem_49475, __global unsigned char *mem_49478, __global unsigned char *mem_49480, __global unsigned char *mem_49482)\n{\n    #define segmap_tblock_sizze_44406 (do_DBSCAN_doublezisegmap_44403zisegmap_tblock_sizze_44406)\n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_50825;\n    int32_t tblock_sizze_50828;\n    int32_t wave_sizze_50827;\n    int32_t block_id_50826;\n    int32_t global_tid_50824;\n    int64_t phys_tid_44403;\n    int32_t phys_tblock_id_50829;\n    int32_t iterations_50830;\n    \n    local_tid_50825 = get_local_id(0);\n    tblock_sizze_50828 = get_local_size(0);\n    wave_sizze_50827 = LOCKSTEP_WIDTH;\n    block_id_50826 = get_tblock_id(0);\n    global_tid_50824 = block_id_50826 * tblock_sizze_50828 + local_tid_50825;\n    phys_tid_44403 = sext_i32_i64(global_tid_50824);\n    phys_tblock_id_50829 = get_tblock_id(0);\n    iterations_50830 = sdiv_up32(virt_num_tblocks_50823 - phys_tblock_id_50829, sext_i64_i32(num_tblocks_44408));\n    for (int32_t i_50831 = 0; i_50831 < iterations_50830; i_50831++) {\n        int32_t virt", "_tblock_id_50832;\n        int64_t global_tid_50833;\n        int64_t slice_50834;\n        int64_t write_i_44402;\n        int64_t remnant_50835;\n        \n        virt_tblock_id_50832 = phys_tblock_id_50829 + i_50831 * sext_i64_i32(num_tblocks_44408);\n        global_tid_50833 = sext_i32_i64(virt_tblock_id_50832) * segmap_tblock_sizze_44406 + sext_i32_i64(local_tid_50825);\n        slice_50834 = partition_sizze_41393;\n        write_i_44402 = global_tid_50833;\n        remnant_50835 = global_tid_50833 - write_i_44402;\n        if (slt64(write_i_44402, partition_sizze_41393)) {\n            int64_t eta_p_42302;\n            double write_value_42304;\n            double write_value_42305;\n            int64_t write_value_42306;\n            bool cond_42307;\n            int64_t lifted_lambda_res_42308;\n            \n            eta_p_42302 = ((__global int64_t *) mem_49475)[write_i_44402];\n            write_value_42304 = ((__global double *) mem_49454)[write_i_44402];\n            write_value_42305 = ((__global double *) mem_49456)[write_i_44402];\n            write_value_42306 = ((__global int64_t *) mem_49458)[write_i_44402];\n            cond_42307 = eta_p_42302 == (int64_t) 1;\n            if (cond_42307) {\n                int64_t eta_p_42303;\n                int64_t lifted_lambda_res_t_res_42703;\n                \n                eta_p_42303 = ((__global int64_t *) mem_49473)[write_i_44402];\n                lifted_lambda_res_t_res_42703 = sub64(eta_p_42303, (int64_t) 1);\n                lifted_lambda_res_42308 = lifted_lambda_res_t_res_42703;\n            } else {\n                lifted_lambda_res_42308 = (int64_t) -1;\n            }\n            if (sle64((int64_t) 0, lifted_lambda_res_42308) && slt64(lifted_lambda_res_42308, m_41485)) {\n                ((__global double *) mem_49482)[lifted_lambda_res_42308] = write_value_42304;\n            }\n            if (sle64((int64_t) 0, lifted_lambda_res_42308) && slt64(lifted_lambda_res_42308, m_41485)) {\n                ((__global double *) ",
                                    "mem_49480)[lifted_lambda_res_42308] = write_value_42305;\n            }\n            if (sle64((int64_t) 0, lifted_lambda_res_42308) && slt64(lifted_lambda_res_42308, m_41485)) {\n                ((__global int64_t *) mem_49478)[lifted_lambda_res_42308] = write_value_42306;\n            }\n        }\n        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    }\n    \n  error_1:\n    return;\n    #undef segmap_tblock_sizze_44406\n}\nFUTHARK_KERNEL_SIZED(do_DBSCAN_doublezisegmap_44411_dim1, 1, 1)\nvoid do_DBSCAN_doublezisegmap_44411(__global int *global_failure, int64_t n_34757, int64_t m_41239, int64_t num_tblocks_44416, int32_t virt_num_tblocks_50836, __global unsigned char *mem_49415, __global unsigned char *mem_49421, __global unsigned char *ext_mem_49484)\n{\n    #define segmap_tblock_sizze_44414 (do_DBSCAN_doublezisegmap_44411zisegmap_tblock_sizze_44414)\n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_50838;\n    int32_t tblock_sizze_50841;\n    int32_t wave_sizze_50840;\n    int32_t block_id_50839;\n    int32_t global_tid_50837;\n    int64_t phys_tid_44411;\n    int32_t phys_tblock_id_50842;\n    int32_t iterations_50843;\n    \n    local_tid_50838 = get_local_id(0);\n    tblock_sizze_50841 = get_local_size(0);\n    wave_sizze_50840 = LOCKSTEP_WIDTH;\n    block_id_50839 = get_tblock_id(0);\n    global_tid_50837 = block_id_50839 * tblock_sizze_50841 + local_tid_50838;\n    phys_tid_44411 = sext_i32_i64(global_tid_50837);\n    phys_tblock_id_50842 = get_tblock_id(0);\n    iterations_50843 = sdiv_up32(virt_num_tblocks_50836 - phys_tblock_id_50842, sext_i64_i32(num_tblocks_44416));\n    for (int32_t i_50844 = 0; i_50844 < iterations_50843; i_50844++) {\n        int32_t virt_tblock_id_50845;\n        int64_t global_tid_50846;\n        int64_t slice_50847;\n        int64_t write_i_44410;\n        int64_t remnant_50848;\n        \n        virt_tblock_id_50845 = phys_tblock_id_50842 + i_50844 * sext_i64_i32(num_tblocks_44416);\n        global_tid_50846 = sext_i32_i64(virt_tbloc", "k_id_50845) * segmap_tblock_sizze_44414 + sext_i32_i64(local_tid_50838);\n        slice_50847 = m_41239;\n        write_i_44410 = global_tid_50846;\n        remnant_50848 = global_tid_50846 - write_i_44410;\n        if (slt64(write_i_44410, m_41239)) {\n            int64_t write_index_41461;\n            int64_t write_value_41462;\n            \n            write_index_41461 = ((__global int64_t *) mem_49415)[write_i_44410];\n            write_value_41462 = ((__global int64_t *) ext_mem_49484)[write_i_44410];\n            if (sle64((int64_t) 0, write_index_41461) && slt64(write_index_41461, n_34757)) {\n                ((__global int64_t *) mem_49421)[write_index_41461] = write_value_41462;\n            }\n        }\n        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    }\n    \n  error_1:\n    return;\n    #undef segmap_tblock_sizze_44414\n}\nFUTHARK_KERNEL_SIZED(do_DBSCAN_doublezisegmap_44435_dim1, 1, 1)\nvoid do_DBSCAN_doublezisegmap_44435(__global int *global_failure, int64_t n_34757, int64_t clBase_34773, __global unsigned char *mem_49421, __global unsigned char *ext_mem_49422, __global unsigned char *mem_49487)\n{\n    #define segmap_tblock_sizze_44431 (do_DBSCAN_doublezisegmap_44435zisegmap_tblock_sizze_44431)\n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_50851;\n    int32_t tblock_sizze_50854;\n    int32_t wave_sizze_50853;\n    int32_t block_id_50852;\n    int32_t global_tid_50850;\n    int64_t phys_tid_44435;\n    int64_t global_tid_50855;\n    int64_t slice_50856;\n    int64_t gtid_44434;\n    int64_t remnant_50857;\n    \n    local_tid_50851 = get_local_id(0);\n    tblock_sizze_50854 = get_local_size(0);\n    wave_sizze_50853 = LOCKSTEP_WIDTH;\n    block_id_50852 = get_tblock_id(0);\n    global_tid_50850 = block_id_50852 * tblock_sizze_50854 + local_tid_50851;\n    phys_tid_44435 = sext_i32_i64(global_tid_50850);\n    global_tid_50855 = sext_i32_i64(block_id_50852) * segmap_tblock_sizze_44431 + sext_i32_i64(local_tid_50851);\n    slice_50856 = n_34757;\n    ", "gtid_44434 = global_tid_50855;\n    remnant_50857 = global_tid_50855 - gtid_44434;\n    if (slt64(gtid_44434, n_34757)) {\n        int64_t eta_p_44436;\n        int64_t eta_p_44437;\n        int64_t defunc_0_f_res_44438;\n        bool lifted_lambda_res_44439;\n        \n        eta_p_44436 = ((__global int64_t *) ext_mem_49422)[gtid_44434];\n        eta_p_44437 = ((__global int64_t *) mem_49421)[gtid_44434];\n        defunc_0_f_res_44438 = add64(eta_p_44436, eta_p_44437);\n        lifted_lambda_res_44439 = sle64(clBase_34773, defunc_0_f_res_44438);\n        ((__global bool *) mem_49487)[gtid_44434] = lifted_lambda_res_44439;\n    }\n    \n  error_0:\n    return;\n    #undef segmap_tblock_sizze_44431\n}\nFUTHARK_KERNEL_SIZED(do_DBSCAN_doublezisegmap_44449_dim1, 1, 1)\nvoid do_DBSCAN_doublezisegmap_44449(__global int *global_failure, int64_t n_34757, int64_t m_41527, int64_t num_tblocks_44454, int32_t virt_num_tblocks_50960, __global unsigned char *current_partition_mem_49387, __global unsigned char *current_partition_mem_49388, __global unsigned char *mem_49490, __global unsigned char *mem_49492, __global unsigned char *mem_49496, __global unsigned char *mem_49498, __global unsigned char *mem_49500)\n{\n    #define segmap_tblock_sizze_44452 (do_DBSCAN_doublezisegmap_44449zisegmap_tblock_sizze_44452)\n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_50962;\n    int32_t tblock_sizze_50965;\n    int32_t wave_sizze_50964;\n    int32_t block_id_50963;\n    int32_t global_tid_50961;\n    int64_t phys_tid_44449;\n    int32_t phys_tblock_id_50966;\n    int32_t iterations_50967;\n    \n    local_tid_50962 = get_local_id(0);\n    tblock_sizze_50965 = get_local_size(0);\n    wave_sizze_50964 = LOCKSTEP_WIDTH;\n    block_id_50963 = get_tblock_id(0);\n    global_tid_50961 = block_id_50963 * tblock_sizze_50965 + local_tid_50962;\n    phys_tid_44449 = sext_i32_i64(global_tid_50961);\n    phys_tblock_id_50966 = get_tblock_id(0);\n    iterations_50967 = sdiv_up32(virt_num_tblocks_50960 - phys_tbloc",
                                    "k_id_50966, sext_i64_i32(num_tblocks_44454));\n    for (int32_t i_50968 = 0; i_50968 < iterations_50967; i_50968++) {\n        int32_t virt_tblock_id_50969;\n        int64_t global_tid_50970;\n        int64_t slice_50971;\n        int64_t write_i_44448;\n        int64_t remnant_50972;\n        \n        virt_tblock_id_50969 = phys_tblock_id_50966 + i_50968 * sext_i64_i32(num_tblocks_44454);\n        global_tid_50970 = sext_i32_i64(virt_tblock_id_50969) * segmap_tblock_sizze_44452 + sext_i32_i64(local_tid_50962);\n        slice_50971 = n_34757;\n        write_i_44448 = global_tid_50970;\n        remnant_50972 = global_tid_50970 - write_i_44448;\n        if (slt64(write_i_44448, n_34757)) {\n            int64_t eta_p_42289;\n            double write_value_42291;\n            double write_value_42292;\n            bool cond_42293;\n            int64_t lifted_lambda_res_42294;\n            \n            eta_p_42289 = ((__global int64_t *) mem_49492)[write_i_44448];\n            write_value_42291 = ((__global double *) current_partition_mem_49387)[write_i_44448];\n            write_value_42292 = ((__global double *) current_partition_mem_49388)[write_i_44448];\n            cond_42293 = eta_p_42289 == (int64_t) 1;\n            if (cond_42293) {\n                int64_t eta_p_42290;\n                int64_t lifted_lambda_res_t_res_42706;\n                \n                eta_p_42290 = ((__global int64_t *) mem_49490)[write_i_44448];\n                lifted_lambda_res_t_res_42706 = sub64(eta_p_42290, (int64_t) 1);\n                lifted_lambda_res_42294 = lifted_lambda_res_t_res_42706;\n            } else {\n                lifted_lambda_res_42294 = (int64_t) -1;\n            }\n            if (sle64((int64_t) 0, lifted_lambda_res_42294) && slt64(lifted_lambda_res_42294, m_41527)) {\n                ((__global double *) mem_49500)[lifted_lambda_res_42294] = write_value_42291;\n            }\n            if (sle64((int64_t) 0, lifted_lambda_res_42294) && slt64(lifted_lambda_res_42294, m_41527)) {\n            ", "    ((__global double *) mem_49498)[lifted_lambda_res_42294] = write_value_42292;\n            }\n            if (sle64((int64_t) 0, lifted_lambda_res_42294) && slt64(lifted_lambda_res_42294, m_41527)) {\n                ((__global int64_t *) mem_49496)[lifted_lambda_res_42294] = (int64_t) -1;\n            }\n        }\n        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    }\n    \n  error_1:\n    return;\n    #undef segmap_tblock_sizze_44452\n}\nFUTHARK_KERNEL_SIZED(do_DBSCAN_doublezisegmap_44647_dim1, 1, 1)\nvoid do_DBSCAN_doublezisegmap_44647(__global int *global_failure, int8_t clBase_34768, int64_t m_41485, int64_t inf_41586, int64_t j_m_i_41589, __global unsigned char *mem_49480, __global unsigned char *mem_49482, __global unsigned char *mem_49498, __global unsigned char *mem_49500, __global unsigned char *mem_49523, __global unsigned char *mem_49525, __global unsigned char *mem_49527)\n{\n    #define segmap_tblock_sizze_44641 (do_DBSCAN_doublezisegmap_44647zisegmap_tblock_sizze_44641)\n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_51103;\n    int32_t tblock_sizze_51106;\n    int32_t wave_sizze_51105;\n    int32_t block_id_51104;\n    int32_t global_tid_51102;\n    int64_t phys_tid_44647;\n    int64_t global_tid_51107;\n    int64_t slice_51108;\n    int64_t gtid_44646;\n    int64_t remnant_51109;\n    \n    local_tid_51103 = get_local_id(0);\n    tblock_sizze_51106 = get_local_size(0);\n    wave_sizze_51105 = LOCKSTEP_WIDTH;\n    block_id_51104 = get_tblock_id(0);\n    global_tid_51102 = block_id_51104 * tblock_sizze_51106 + local_tid_51103;\n    phys_tid_44647 = sext_i32_i64(global_tid_51102);\n    global_tid_51107 = sext_i32_i64(block_id_51104) * segmap_tblock_sizze_44641 + sext_i32_i64(local_tid_51103);\n    slice_51108 = j_m_i_41589;\n    gtid_44646 = global_tid_51107;\n    remnant_51109 = global_tid_51107 - gtid_44646;\n    if (slt64(gtid_44646, j_m_i_41589)) {\n        int64_t slice_46510;\n        bool index_concat_cmp_46512;\n        double index_concat_", "branch_46516;\n        double index_concat_branch_46509;\n        double zt_res_44650;\n        double zt_res_44651;\n        double zs_res_44652;\n        double zs_res_44653;\n        double d_haversine_res_44654;\n        double d_haversine_res_44655;\n        double cos_res_44656;\n        \n        slice_46510 = inf_41586 + gtid_44646;\n        index_concat_cmp_46512 = sle64(m_41485, slice_46510);\n        if (index_concat_cmp_46512) {\n            int64_t index_concat_i_46513;\n            double index_concat_46514;\n            \n            index_concat_i_46513 = sub64(slice_46510, m_41485);\n            index_concat_46514 = ((__global double *) mem_49500)[index_concat_i_46513];\n            index_concat_branch_46516 = index_concat_46514;\n        } else {\n            double index_concat_46515 = ((__global double *) mem_49482)[slice_46510];\n            \n            index_concat_branch_46516 = index_concat_46515;\n        }\n        if (index_concat_cmp_46512) {\n            int64_t index_concat_i_46506;\n            double index_concat_46507;\n            \n            index_concat_i_46506 = sub64(slice_46510, m_41485);\n            index_concat_46507 = ((__global double *) mem_49498)[index_concat_i_46506];\n            index_concat_branch_46509 = index_concat_46507;\n        } else {\n            double index_concat_46508 = ((__global double *) mem_49480)[slice_46510];\n            \n            index_concat_branch_46509 = index_concat_46508;\n        }\n        zt_res_44650 = 3.141592653589793 * index_concat_branch_46516;\n        zt_res_44651 = 3.141592653589793 * index_concat_branch_46509;\n        zs_res_44652 = zt_res_44650 / 180.0;\n        zs_res_44653 = zt_res_44651 / 180.0;\n        if (clBase_34768 == (int8_t) 1) {\n            d_haversine_res_44654 = index_concat_branch_46516;\n        } else {\n            d_haversine_res_44654 = zs_res_44652;\n        }\n        if (clBase_34768 == (int8_t) 1) {\n            d_haversine_res_44655 = index_concat_branch_46509;\n        } else {\n           ",
                                    " d_haversine_res_44655 = zs_res_44653;\n        }\n        cos_res_44656 = futrts_cos64(d_haversine_res_44654);\n        ((__global double *) mem_49523)[gtid_44646] = d_haversine_res_44654;\n        ((__global double *) mem_49525)[gtid_44646] = d_haversine_res_44655;\n        ((__global double *) mem_49527)[gtid_44646] = cos_res_44656;\n    }\n    \n  error_0:\n    return;\n    #undef segmap_tblock_sizze_44641\n}\nFUTHARK_KERNEL_SIZED(do_DBSCAN_doublezisegmap_44743_dim1, 1, 1)\nvoid do_DBSCAN_doublezisegmap_44743(__global int *global_failure, int64_t conc_tmp_41556, __global unsigned char *mem_49598, __global unsigned char *mem_49601)\n{\n    #define segmap_tblock_sizze_44739 (do_DBSCAN_doublezisegmap_44743zisegmap_tblock_sizze_44739)\n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_51322;\n    int32_t tblock_sizze_51325;\n    int32_t wave_sizze_51324;\n    int32_t block_id_51323;\n    int32_t global_tid_51321;\n    int64_t phys_tid_44743;\n    int64_t global_tid_51326;\n    int64_t slice_51327;\n    int64_t gtid_44742;\n    int64_t remnant_51328;\n    \n    local_tid_51322 = get_local_id(0);\n    tblock_sizze_51325 = get_local_size(0);\n    wave_sizze_51324 = LOCKSTEP_WIDTH;\n    block_id_51323 = get_tblock_id(0);\n    global_tid_51321 = block_id_51323 * tblock_sizze_51325 + local_tid_51322;\n    phys_tid_44743 = sext_i32_i64(global_tid_51321);\n    global_tid_51326 = sext_i32_i64(block_id_51323) * segmap_tblock_sizze_44739 + sext_i32_i64(local_tid_51322);\n    slice_51327 = conc_tmp_41556;\n    gtid_44742 = global_tid_51326;\n    remnant_51328 = global_tid_51326 - gtid_44742;\n    if (slt64(gtid_44742, conc_tmp_41556)) {\n        int64_t zv_lhs_44745;\n        int64_t tmp_44746;\n        bool cond_44748;\n        int64_t lifted_lambda_res_44749;\n        \n        zv_lhs_44745 = add64((int64_t) -1, gtid_44742);\n        tmp_44746 = smod64(zv_lhs_44745, conc_tmp_41556);\n        cond_44748 = gtid_44742 == (int64_t) 0;\n        if (cond_44748) {\n            lifted_lambda_res_44749 = (in", "t64_t) 0;\n        } else {\n            int64_t lifted_lambda_res_44747 = ((__global int64_t *) mem_49598)[tmp_44746];\n            \n            lifted_lambda_res_44749 = lifted_lambda_res_44747;\n        }\n        ((__global int64_t *) mem_49601)[gtid_44742] = lifted_lambda_res_44749;\n    }\n    \n  error_0:\n    return;\n    #undef segmap_tblock_sizze_44739\n}\nFUTHARK_KERNEL_SIZED(do_DBSCAN_doublezisegmap_44774_dim1, 1, 1)\nvoid do_DBSCAN_doublezisegmap_44774(__global int *global_failure, int failure_is_an_option, __global int64_t *global_failure_args, int64_t conc_tmp_41556, int64_t inf_41705, int64_t min_res_41707, __global unsigned char *ext_mem_49595, __global unsigned char *mem_49601, __global unsigned char *mem_param_49604, __global unsigned char *mem_49607)\n{\n    #define segmap_tblock_sizze_44770 (do_DBSCAN_doublezisegmap_44774zisegmap_tblock_sizze_44770)\n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_51333;\n    int32_t tblock_sizze_51336;\n    int32_t wave_sizze_51335;\n    int32_t block_id_51334;\n    int32_t global_tid_51332;\n    int64_t phys_tid_44774;\n    int64_t global_tid_51337;\n    int64_t slice_51338;\n    int64_t gtid_44773;\n    int64_t remnant_51339;\n    \n    local_tid_51333 = get_local_id(0);\n    tblock_sizze_51336 = get_local_size(0);\n    wave_sizze_51335 = LOCKSTEP_WIDTH;\n    block_id_51334 = get_tblock_id(0);\n    global_tid_51332 = block_id_51334 * tblock_sizze_51336 + local_tid_51333;\n    phys_tid_44774 = sext_i32_i64(global_tid_51332);\n    global_tid_51337 = sext_i32_i64(block_id_51334) * segmap_tblock_sizze_44770 + sext_i32_i64(local_tid_51333);\n    slice_51338 = conc_tmp_41556;\n    gtid_44773 = global_tid_51337;\n    remnant_51339 = global_tid_51337 - gtid_44773;\n    if (slt64(gtid_44773, conc_tmp_41556)) {\n        int64_t eta_p_44775;\n        bool cond_44777;\n        bool cond_t_res_44778;\n        bool x_44779;\n        int64_t lifted_lambda_res_44780;\n        \n        eta_p_44775 = ((__global int64_t *) ext_mem_49595)[gtid_44", "773];\n        cond_44777 = sle64(inf_41705, eta_p_44775);\n        cond_t_res_44778 = slt64(eta_p_44775, min_res_41707);\n        x_44779 = cond_44777 && cond_t_res_44778;\n        if (x_44779) {\n            bool x_44781;\n            bool y_44782;\n            bool bounds_check_44783;\n            bool index_certs_44784;\n            int64_t lifted_lambda_res_t_res_44785;\n            \n            x_44781 = sle64((int64_t) 0, eta_p_44775);\n            y_44782 = slt64(eta_p_44775, conc_tmp_41556);\n            bounds_check_44783 = x_44781 && y_44782;\n            if (!bounds_check_44783) {\n                {\n                    if (atomic_cmpxchg_i32_global(global_failure, -1, 21) == -1) {\n                        global_failure_args[0] = (int64_t) eta_p_44775;\n                        global_failure_args[1] = (int64_t) conc_tmp_41556;\n                        ;\n                    }\n                    return;\n                }\n            }\n            lifted_lambda_res_t_res_44785 = ((__global int64_t *) mem_49601)[eta_p_44775];\n            lifted_lambda_res_44780 = lifted_lambda_res_t_res_44785;\n        } else {\n            int64_t eta_p_44776 = ((__global int64_t *) mem_param_49604)[gtid_44773];\n            \n            lifted_lambda_res_44780 = eta_p_44776;\n        }\n        ((__global int64_t *) mem_49607)[gtid_44773] = lifted_lambda_res_44780;\n    }\n    \n  error_0:\n    return;\n    #undef segmap_tblock_sizze_44770\n}\nFUTHARK_KERNEL_SIZED(do_DBSCAN_doublezisegmap_44801_dim1, 1, 1)\nvoid do_DBSCAN_doublezisegmap_44801(__global int *global_failure, int64_t clProc_34783, int64_t conc_tmp_41556, __global unsigned char *ext_mem_49610, __global unsigned char *mem_49613)\n{\n    #define segmap_tblock_sizze_44797 (do_DBSCAN_doublezisegmap_44801zisegmap_tblock_sizze_44797)\n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_51342;\n    int32_t tblock_sizze_51345;\n    int32_t wave_sizze_51344;\n    int32_t block_id_51343;\n    int32_t global_tid_51341;\n    int64_t phys_",
                                    "tid_44801;\n    int64_t global_tid_51346;\n    int64_t slice_51347;\n    int64_t gtid_44800;\n    int64_t remnant_51348;\n    \n    local_tid_51342 = get_local_id(0);\n    tblock_sizze_51345 = get_local_size(0);\n    wave_sizze_51344 = LOCKSTEP_WIDTH;\n    block_id_51343 = get_tblock_id(0);\n    global_tid_51341 = block_id_51343 * tblock_sizze_51345 + local_tid_51342;\n    phys_tid_44801 = sext_i32_i64(global_tid_51341);\n    global_tid_51346 = sext_i32_i64(block_id_51343) * segmap_tblock_sizze_44797 + sext_i32_i64(local_tid_51342);\n    slice_51347 = conc_tmp_41556;\n    gtid_44800 = global_tid_51346;\n    remnant_51348 = global_tid_51346 - gtid_44800;\n    if (slt64(gtid_44800, conc_tmp_41556)) {\n        int64_t eta_p_44802;\n        int64_t lifted_lambda_res_44803;\n        \n        eta_p_44802 = ((__global int64_t *) ext_mem_49610)[gtid_44800];\n        lifted_lambda_res_44803 = add64(clProc_34783, eta_p_44802);\n        ((__global int64_t *) mem_49613)[gtid_44800] = lifted_lambda_res_44803;\n    }\n    \n  error_0:\n    return;\n    #undef segmap_tblock_sizze_44797\n}\nFUTHARK_KERNEL_SIZED(do_DBSCAN_doublezisegmap_44805_dim1, 1, 1)\nvoid do_DBSCAN_doublezisegmap_44805(__global int *global_failure, int64_t m_41485, int64_t conc_tmp_41556, int64_t m_41740, int64_t num_tblocks_44810, int32_t virt_num_tblocks_51350, __global unsigned char *mem_49478, __global unsigned char *mem_49496, __global unsigned char *mem_49506, __global unsigned char *mem_49508, __global unsigned char *mem_49510, __global unsigned char *mem_49613, __global unsigned char *mem_49615)\n{\n    #define segmap_tblock_sizze_44808 (do_DBSCAN_doublezisegmap_44805zisegmap_tblock_sizze_44808)\n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_51352;\n    int32_t tblock_sizze_51355;\n    int32_t wave_sizze_51354;\n    int32_t block_id_51353;\n    int32_t global_tid_51351;\n    int64_t phys_tid_44805;\n    int32_t phys_tblock_id_51356;\n    int32_t iterations_51357;\n    \n    local_tid_51352 = get_local_id(0);\n    tblo", "ck_sizze_51355 = get_local_size(0);\n    wave_sizze_51354 = LOCKSTEP_WIDTH;\n    block_id_51353 = get_tblock_id(0);\n    global_tid_51351 = block_id_51353 * tblock_sizze_51355 + local_tid_51352;\n    phys_tid_44805 = sext_i32_i64(global_tid_51351);\n    phys_tblock_id_51356 = get_tblock_id(0);\n    iterations_51357 = sdiv_up32(virt_num_tblocks_51350 - phys_tblock_id_51356, sext_i64_i32(num_tblocks_44810));\n    for (int32_t i_51358 = 0; i_51358 < iterations_51357; i_51358++) {\n        int32_t virt_tblock_id_51359;\n        int64_t global_tid_51360;\n        int64_t slice_51361;\n        int64_t write_i_44804;\n        int64_t remnant_51362;\n        \n        virt_tblock_id_51359 = phys_tblock_id_51356 + i_51358 * sext_i64_i32(num_tblocks_44810);\n        global_tid_51360 = sext_i32_i64(virt_tblock_id_51359) * segmap_tblock_sizze_44808 + sext_i32_i64(local_tid_51352);\n        slice_51361 = conc_tmp_41556;\n        write_i_44804 = global_tid_51360;\n        remnant_51362 = global_tid_51360 - write_i_44804;\n        if (slt64(write_i_44804, conc_tmp_41556)) {\n            int64_t eta_p_42255;\n            int64_t write_value_42257;\n            bool index_concat_cmp_46451;\n            int64_t index_concat_branch_46455;\n            bool cond_42259;\n            int64_t lifted_lambda_res_42260;\n            \n            eta_p_42255 = ((__global int64_t *) mem_49508)[write_i_44804];\n            write_value_42257 = ((__global int64_t *) mem_49613)[write_i_44804];\n            index_concat_cmp_46451 = sle64(m_41485, write_i_44804);\n            if (index_concat_cmp_46451) {\n                int64_t index_concat_i_46452;\n                int64_t index_concat_46453;\n                \n                index_concat_i_46452 = sub64(write_i_44804, m_41485);\n                index_concat_46453 = ((__global int64_t *) mem_49496)[index_concat_i_46452];\n                index_concat_branch_46455 = index_concat_46453;\n            } else {\n                int64_t index_concat_46454 = ((__global int64_t *) mem_4947", "8)[write_i_44804];\n                \n                index_concat_branch_46455 = index_concat_46454;\n            }\n            cond_42259 = eta_p_42255 == (int64_t) 1;\n            if (cond_42259) {\n                int64_t eta_p_42256;\n                int64_t lifted_lambda_res_t_res_42723;\n                \n                eta_p_42256 = ((__global int64_t *) mem_49506)[write_i_44804];\n                lifted_lambda_res_t_res_42723 = sub64(eta_p_42256, (int64_t) 1);\n                lifted_lambda_res_42260 = lifted_lambda_res_t_res_42723;\n            } else {\n                lifted_lambda_res_42260 = (int64_t) -1;\n            }\n            if (sle64((int64_t) 0, lifted_lambda_res_42260) && slt64(lifted_lambda_res_42260, m_41740)) {\n                ((__global int64_t *) mem_49615)[lifted_lambda_res_42260] = write_value_42257;\n            }\n            if (sle64((int64_t) 0, lifted_lambda_res_42260) && slt64(lifted_lambda_res_42260, m_41740)) {\n                ((__global int64_t *) mem_49510)[lifted_lambda_res_42260] = index_concat_branch_46455;\n            }\n        }\n        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    }\n    \n  error_1:\n    return;\n    #undef segmap_tblock_sizze_44808\n}\nFUTHARK_KERNEL_SIZED(do_DBSCAN_doublezisegmap_45218_dim1, 1, 1)\nvoid do_DBSCAN_doublezisegmap_45218(__global int *global_failure, int64_t m_41740, int64_t m_41830, int64_t num_tblocks_45223, int32_t virt_num_tblocks_51624, __global unsigned char *mem_49510, __global unsigned char *mem_49615, __global unsigned char *ext_mem_49752, __global unsigned char *ext_mem_49753, __global unsigned char *mem_49755, __global unsigned char *mem_49757)\n{\n    #define segmap_tblock_sizze_45221 (do_DBSCAN_doublezisegmap_45218zisegmap_tblock_sizze_45221)\n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_51626;\n    int32_t tblock_sizze_51629;\n    int32_t wave_sizze_51628;\n    int32_t block_id_51627;\n    int32_t global_tid_51625;\n    int64_t phys_tid_45218;\n    int32_t phys_tb",
                                    "lock_id_51630;\n    int32_t iterations_51631;\n    \n    local_tid_51626 = get_local_id(0);\n    tblock_sizze_51629 = get_local_size(0);\n    wave_sizze_51628 = LOCKSTEP_WIDTH;\n    block_id_51627 = get_tblock_id(0);\n    global_tid_51625 = block_id_51627 * tblock_sizze_51629 + local_tid_51626;\n    phys_tid_45218 = sext_i32_i64(global_tid_51625);\n    phys_tblock_id_51630 = get_tblock_id(0);\n    iterations_51631 = sdiv_up32(virt_num_tblocks_51624 - phys_tblock_id_51630, sext_i64_i32(num_tblocks_45223));\n    for (int32_t i_51632 = 0; i_51632 < iterations_51631; i_51632++) {\n        int32_t virt_tblock_id_51633;\n        int64_t global_tid_51634;\n        int64_t slice_51635;\n        int64_t write_i_45217;\n        int64_t remnant_51636;\n        \n        virt_tblock_id_51633 = phys_tblock_id_51630 + i_51632 * sext_i64_i32(num_tblocks_45223);\n        global_tid_51634 = sext_i32_i64(virt_tblock_id_51633) * segmap_tblock_sizze_45221 + sext_i32_i64(local_tid_51626);\n        slice_51635 = m_41740;\n        write_i_45217 = global_tid_51634;\n        remnant_51636 = global_tid_51634 - write_i_45217;\n        if (slt64(write_i_45217, m_41740)) {\n            int64_t eta_p_42201;\n            int64_t write_value_42203;\n            int64_t write_value_42204;\n            bool cond_42205;\n            int64_t lifted_lambda_res_42206;\n            \n            eta_p_42201 = ((__global int64_t *) ext_mem_49752)[write_i_45217];\n            write_value_42203 = ((__global int64_t *) mem_49615)[write_i_45217];\n            write_value_42204 = ((__global int64_t *) mem_49510)[write_i_45217];\n            cond_42205 = eta_p_42201 == (int64_t) 1;\n            if (cond_42205) {\n                int64_t eta_p_42202;\n                int64_t lifted_lambda_res_t_res_42728;\n                \n                eta_p_42202 = ((__global int64_t *) ext_mem_49753)[write_i_45217];\n                lifted_lambda_res_t_res_42728 = sub64(eta_p_42202, (int64_t) 1);\n                lifted_lambda_res_42206 = lifted_lambda_res_t_res", "_42728;\n            } else {\n                lifted_lambda_res_42206 = (int64_t) -1;\n            }\n            if (sle64((int64_t) 0, lifted_lambda_res_42206) && slt64(lifted_lambda_res_42206, m_41830)) {\n                ((__global int64_t *) mem_49757)[lifted_lambda_res_42206] = write_value_42203;\n            }\n            if (sle64((int64_t) 0, lifted_lambda_res_42206) && slt64(lifted_lambda_res_42206, m_41830)) {\n                ((__global int64_t *) mem_49755)[lifted_lambda_res_42206] = write_value_42204;\n            }\n        }\n        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    }\n    \n  error_1:\n    return;\n    #undef segmap_tblock_sizze_45221\n}\nFUTHARK_KERNEL_SIZED(do_DBSCAN_doublezisegmap_45376_dim1, 1, 1)\nvoid do_DBSCAN_doublezisegmap_45376(__global int *global_failure, int64_t m_41485, int64_t conc_tmp_41556, __global unsigned char *mem_49480, __global unsigned char *mem_49482, __global unsigned char *mem_49498, __global unsigned char *mem_49500, __global unsigned char *mem_49842, __global unsigned char *mem_49844)\n{\n    #define segmap_tblock_sizze_45370 (do_DBSCAN_doublezisegmap_45376zisegmap_tblock_sizze_45370)\n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_51785;\n    int32_t tblock_sizze_51788;\n    int32_t wave_sizze_51787;\n    int32_t block_id_51786;\n    int32_t global_tid_51784;\n    int64_t phys_tid_45376;\n    int64_t global_tid_51789;\n    int64_t slice_51790;\n    int64_t gtid_45375;\n    int64_t remnant_51791;\n    \n    local_tid_51785 = get_local_id(0);\n    tblock_sizze_51788 = get_local_size(0);\n    wave_sizze_51787 = LOCKSTEP_WIDTH;\n    block_id_51786 = get_tblock_id(0);\n    global_tid_51784 = block_id_51786 * tblock_sizze_51788 + local_tid_51785;\n    phys_tid_45376 = sext_i32_i64(global_tid_51784);\n    global_tid_51789 = sext_i32_i64(block_id_51786) * segmap_tblock_sizze_45370 + sext_i32_i64(local_tid_51785);\n    slice_51790 = conc_tmp_41556;\n    gtid_45375 = global_tid_51789;\n    remnant_51791 = global_tid_51", "789 - gtid_45375;\n    if (slt64(gtid_45375, conc_tmp_41556)) {\n        bool index_concat_cmp_45383;\n        double index_concat_branch_45384;\n        double index_concat_branch_45388;\n        \n        index_concat_cmp_45383 = sle64(m_41485, gtid_45375);\n        if (index_concat_cmp_45383) {\n            int64_t index_concat_i_45385;\n            double index_concat_45386;\n            \n            index_concat_i_45385 = sub64(gtid_45375, m_41485);\n            index_concat_45386 = ((__global double *) mem_49500)[index_concat_i_45385];\n            index_concat_branch_45384 = index_concat_45386;\n        } else {\n            double index_concat_45387 = ((__global double *) mem_49482)[gtid_45375];\n            \n            index_concat_branch_45384 = index_concat_45387;\n        }\n        if (index_concat_cmp_45383) {\n            int64_t index_concat_i_45389;\n            double index_concat_45390;\n            \n            index_concat_i_45389 = sub64(gtid_45375, m_41485);\n            index_concat_45390 = ((__global double *) mem_49498)[index_concat_i_45389];\n            index_concat_branch_45388 = index_concat_45390;\n        } else {\n            double index_concat_45391 = ((__global double *) mem_49480)[gtid_45375];\n            \n            index_concat_branch_45388 = index_concat_45391;\n        }\n        ((__global double *) mem_49842)[gtid_45375] = index_concat_branch_45384;\n        ((__global double *) mem_49844)[gtid_45375] = index_concat_branch_45388;\n    }\n    \n  error_0:\n    return;\n    #undef segmap_tblock_sizze_45370\n}\nFUTHARK_KERNEL_SIZED(do_DBSCAN_doublezisegmap_45596_dim1, 1, 1)\nvoid do_DBSCAN_doublezisegmap_45596(__global int *global_failure, int8_t clBase_34768, int64_t inf_41963, int64_t dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_41966, __global unsigned char *mem_49454, __global unsigned char *mem_49456, __global unsigned char *mem_49850, __global unsigned char *mem_49852, __global unsigned char *mem_49854)\n{\n    #define segmap_tblock_sizze_45590 (do_DBSCAN_doublezise",
                                    "gmap_45596zisegmap_tblock_sizze_45590)\n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_51817;\n    int32_t tblock_sizze_51820;\n    int32_t wave_sizze_51819;\n    int32_t block_id_51818;\n    int32_t global_tid_51816;\n    int64_t phys_tid_45596;\n    int64_t global_tid_51821;\n    int64_t slice_51822;\n    int64_t gtid_45595;\n    int64_t remnant_51823;\n    \n    local_tid_51817 = get_local_id(0);\n    tblock_sizze_51820 = get_local_size(0);\n    wave_sizze_51819 = LOCKSTEP_WIDTH;\n    block_id_51818 = get_tblock_id(0);\n    global_tid_51816 = block_id_51818 * tblock_sizze_51820 + local_tid_51817;\n    phys_tid_45596 = sext_i32_i64(global_tid_51816);\n    global_tid_51821 = sext_i32_i64(block_id_51818) * segmap_tblock_sizze_45590 + sext_i32_i64(local_tid_51817);\n    slice_51822 = dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_41966;\n    gtid_45595 = global_tid_51821;\n    remnant_51823 = global_tid_51821 - gtid_45595;\n    if (slt64(gtid_45595, dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_41966)) {\n        int64_t slice_46435;\n        double eta_p_45597;\n        double eta_p_45598;\n        double zt_res_45599;\n        double zt_res_45600;\n        double zs_res_45601;\n        double zs_res_45602;\n        double d_haversine_res_45603;\n        double d_haversine_res_45604;\n        double cos_res_45605;\n        \n        slice_46435 = inf_41963 + gtid_45595;\n        eta_p_45597 = ((__global double *) mem_49454)[slice_46435];\n        eta_p_45598 = ((__global double *) mem_49456)[slice_46435];\n        zt_res_45599 = 3.141592653589793 * eta_p_45597;\n        zt_res_45600 = 3.141592653589793 * eta_p_45598;\n        zs_res_45601 = zt_res_45599 / 180.0;\n        zs_res_45602 = zt_res_45600 / 180.0;\n        if (clBase_34768 == (int8_t) 1) {\n            d_haversine_res_45603 = eta_p_45597;\n        } else {\n            d_haversine_res_45603 = zs_res_45601;\n        }\n        if (clBase_34768 == (int8_t) 1) {\n            d_haversine_res_45604 = eta_p_45598;\n        } else {\n            d_haversine_re", "s_45604 = zs_res_45602;\n        }\n        cos_res_45605 = futrts_cos64(d_haversine_res_45603);\n        ((__global double *) mem_49850)[gtid_45595] = d_haversine_res_45603;\n        ((__global double *) mem_49852)[gtid_45595] = d_haversine_res_45604;\n        ((__global double *) mem_49854)[gtid_45595] = cos_res_45605;\n    }\n    \n  error_0:\n    return;\n    #undef segmap_tblock_sizze_45590\n}\nFUTHARK_KERNEL_SIZED(do_DBSCAN_doublezisegmap_45663_dim1, 1, 1)\nvoid do_DBSCAN_doublezisegmap_45663(__global int *global_failure, int64_t dz2080U_34760, int64_t dz2081U_34761, int64_t partition_sizze_41393, int64_t num_tblocks_45668, int32_t virt_num_tblocks_51924, __global unsigned char *mem_49417, __global unsigned char *mem_49419, __global unsigned char *mem_49460, __global unsigned char *mem_49476, __global unsigned char *mem_49494)\n{\n    #define segmap_tblock_sizze_45666 (do_DBSCAN_doublezisegmap_45663zisegmap_tblock_sizze_45666)\n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_51926;\n    int32_t tblock_sizze_51929;\n    int32_t wave_sizze_51928;\n    int32_t block_id_51927;\n    int32_t global_tid_51925;\n    int64_t phys_tid_45663;\n    int32_t phys_tblock_id_51930;\n    int32_t iterations_51931;\n    \n    local_tid_51926 = get_local_id(0);\n    tblock_sizze_51929 = get_local_size(0);\n    wave_sizze_51928 = LOCKSTEP_WIDTH;\n    block_id_51927 = get_tblock_id(0);\n    global_tid_51925 = block_id_51927 * tblock_sizze_51929 + local_tid_51926;\n    phys_tid_45663 = sext_i32_i64(global_tid_51925);\n    phys_tblock_id_51930 = get_tblock_id(0);\n    iterations_51931 = sdiv_up32(virt_num_tblocks_51924 - phys_tblock_id_51930, sext_i64_i32(num_tblocks_45668));\n    for (int32_t i_51932 = 0; i_51932 < iterations_51931; i_51932++) {\n        int32_t virt_tblock_id_51933;\n        int64_t global_tid_51934;\n        int64_t slice_51935;\n        int64_t write_i_45662;\n        int64_t remnant_51936;\n        \n        virt_tblock_id_51933 = phys_tblock_id_51930 + i_51932 * sext_i64_i32(", "num_tblocks_45668);\n        global_tid_51934 = sext_i32_i64(virt_tblock_id_51933) * segmap_tblock_sizze_45666 + sext_i32_i64(local_tid_51926);\n        slice_51935 = partition_sizze_41393;\n        write_i_45662 = global_tid_51934;\n        remnant_51936 = global_tid_51934 - write_i_45662;\n        if (slt64(write_i_45662, partition_sizze_41393)) {\n            int64_t write_index_42445;\n            bool write_value_42446;\n            int64_t write_value_42448;\n            \n            write_index_42445 = ((__global int64_t *) mem_49460)[write_i_45662];\n            write_value_42446 = ((__global bool *) mem_49476)[write_i_45662];\n            write_value_42448 = ((__global int64_t *) mem_49494)[write_i_45662];\n            if (sle64((int64_t) 0, write_index_42445) && slt64(write_index_42445, dz2080U_34760)) {\n                ((__global bool *) mem_49417)[write_index_42445] = write_value_42446;\n            }\n            if (sle64((int64_t) 0, write_index_42445) && slt64(write_index_42445, dz2081U_34761)) {\n                ((__global int64_t *) mem_49419)[write_index_42445] = write_value_42448;\n            }\n        }\n        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    }\n    \n  error_1:\n    return;\n    #undef segmap_tblock_sizze_45666\n}\nFUTHARK_KERNEL_SIZED(do_DBSCAN_doublezisegmap_45679_dim1, 1, 1)\nvoid do_DBSCAN_doublezisegmap_45679(__global int *global_failure, int64_t m_41830, int64_t m_41896, int64_t num_tblocks_45684, int32_t virt_num_tblocks_51938, __global unsigned char *mem_49755, __global unsigned char *mem_49757, __global unsigned char *mem_49927, __global unsigned char *mem_49929, __global unsigned char *mem_49931, __global unsigned char *mem_49933)\n{\n    #define segmap_tblock_sizze_45682 (do_DBSCAN_doublezisegmap_45679zisegmap_tblock_sizze_45682)\n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_51940;\n    int32_t tblock_sizze_51943;\n    int32_t wave_sizze_51942;\n    int32_t block_id_51941;\n    int32_t global_tid_51939;\n    in",
                                    "t64_t phys_tid_45679;\n    int32_t phys_tblock_id_51944;\n    int32_t iterations_51945;\n    \n    local_tid_51940 = get_local_id(0);\n    tblock_sizze_51943 = get_local_size(0);\n    wave_sizze_51942 = LOCKSTEP_WIDTH;\n    block_id_51941 = get_tblock_id(0);\n    global_tid_51939 = block_id_51941 * tblock_sizze_51943 + local_tid_51940;\n    phys_tid_45679 = sext_i32_i64(global_tid_51939);\n    phys_tblock_id_51944 = get_tblock_id(0);\n    iterations_51945 = sdiv_up32(virt_num_tblocks_51938 - phys_tblock_id_51944, sext_i64_i32(num_tblocks_45684));\n    for (int32_t i_51946 = 0; i_51946 < iterations_51945; i_51946++) {\n        int32_t virt_tblock_id_51947;\n        int64_t global_tid_51948;\n        int64_t slice_51949;\n        int64_t write_i_45678;\n        int64_t remnant_51950;\n        \n        virt_tblock_id_51947 = phys_tblock_id_51944 + i_51946 * sext_i64_i32(num_tblocks_45684);\n        global_tid_51948 = sext_i32_i64(virt_tblock_id_51947) * segmap_tblock_sizze_45682 + sext_i32_i64(local_tid_51940);\n        slice_51949 = m_41830;\n        write_i_45678 = global_tid_51948;\n        remnant_51950 = global_tid_51948 - write_i_45678;\n        if (slt64(write_i_45678, m_41830)) {\n            int64_t eta_p_42187;\n            int64_t write_value_42189;\n            int64_t write_value_42190;\n            bool cond_42191;\n            int64_t lifted_lambda_res_42192;\n            \n            eta_p_42187 = ((__global int64_t *) mem_49929)[write_i_45678];\n            write_value_42189 = ((__global int64_t *) mem_49757)[write_i_45678];\n            write_value_42190 = ((__global int64_t *) mem_49755)[write_i_45678];\n            cond_42191 = eta_p_42187 == (int64_t) 1;\n            if (cond_42191) {\n                int64_t eta_p_42188;\n                int64_t lifted_lambda_res_t_res_42732;\n                \n                eta_p_42188 = ((__global int64_t *) mem_49927)[write_i_45678];\n                lifted_lambda_res_t_res_42732 = sub64(eta_p_42188, (int64_t) 1);\n                lifted_lambda_re", "s_42192 = lifted_lambda_res_t_res_42732;\n            } else {\n                lifted_lambda_res_42192 = (int64_t) -1;\n            }\n            if (sle64((int64_t) 0, lifted_lambda_res_42192) && slt64(lifted_lambda_res_42192, m_41896)) {\n                ((__global int64_t *) mem_49933)[lifted_lambda_res_42192] = write_value_42189;\n            }\n            if (sle64((int64_t) 0, lifted_lambda_res_42192) && slt64(lifted_lambda_res_42192, m_41896)) {\n                ((__global int64_t *) mem_49931)[lifted_lambda_res_42192] = write_value_42190;\n            }\n        }\n        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    }\n    \n  error_1:\n    return;\n    #undef segmap_tblock_sizze_45682\n}\nFUTHARK_KERNEL_SIZED(do_DBSCAN_doublezisegmap_45890_dim1, 1, 1)\nvoid do_DBSCAN_doublezisegmap_45890(__global int *global_failure, int8_t clBase_34768, int64_t inf_42046, int64_t dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_42049, __global unsigned char *current_partition_mem_49387, __global unsigned char *current_partition_mem_49388, __global unsigned char *mem_49940, __global unsigned char *mem_49942, __global unsigned char *mem_49944)\n{\n    #define segmap_tblock_sizze_45884 (do_DBSCAN_doublezisegmap_45890zisegmap_tblock_sizze_45884)\n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_51976;\n    int32_t tblock_sizze_51979;\n    int32_t wave_sizze_51978;\n    int32_t block_id_51977;\n    int32_t global_tid_51975;\n    int64_t phys_tid_45890;\n    int64_t global_tid_51980;\n    int64_t slice_51981;\n    int64_t gtid_45889;\n    int64_t remnant_51982;\n    \n    local_tid_51976 = get_local_id(0);\n    tblock_sizze_51979 = get_local_size(0);\n    wave_sizze_51978 = LOCKSTEP_WIDTH;\n    block_id_51977 = get_tblock_id(0);\n    global_tid_51975 = block_id_51977 * tblock_sizze_51979 + local_tid_51976;\n    phys_tid_45890 = sext_i32_i64(global_tid_51975);\n    global_tid_51980 = sext_i32_i64(block_id_51977) * segmap_tblock_sizze_45884 + sext_i32_i64(local_tid_51976);\n    slice_51981 = dz", "lz7bUZLzmZRz20Usupz20Uinfz7dUzg_42049;\n    gtid_45889 = global_tid_51980;\n    remnant_51982 = global_tid_51980 - gtid_45889;\n    if (slt64(gtid_45889, dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_42049)) {\n        int64_t slice_46429;\n        double eta_p_45891;\n        double eta_p_45892;\n        double zt_res_45893;\n        double zt_res_45894;\n        double zs_res_45895;\n        double zs_res_45896;\n        double d_haversine_res_45897;\n        double d_haversine_res_45898;\n        double cos_res_45899;\n        \n        slice_46429 = inf_42046 + gtid_45889;\n        eta_p_45891 = ((__global double *) current_partition_mem_49387)[slice_46429];\n        eta_p_45892 = ((__global double *) current_partition_mem_49388)[slice_46429];\n        zt_res_45893 = 3.141592653589793 * eta_p_45891;\n        zt_res_45894 = 3.141592653589793 * eta_p_45892;\n        zs_res_45895 = zt_res_45893 / 180.0;\n        zs_res_45896 = zt_res_45894 / 180.0;\n        if (clBase_34768 == (int8_t) 1) {\n            d_haversine_res_45897 = eta_p_45891;\n        } else {\n            d_haversine_res_45897 = zs_res_45895;\n        }\n        if (clBase_34768 == (int8_t) 1) {\n            d_haversine_res_45898 = eta_p_45892;\n        } else {\n            d_haversine_res_45898 = zs_res_45896;\n        }\n        cos_res_45899 = futrts_cos64(d_haversine_res_45897);\n        ((__global double *) mem_49940)[gtid_45889] = d_haversine_res_45897;\n        ((__global double *) mem_49942)[gtid_45889] = d_haversine_res_45898;\n        ((__global double *) mem_49944)[gtid_45889] = cos_res_45899;\n    }\n    \n  error_0:\n    return;\n    #undef segmap_tblock_sizze_45884\n}\nFUTHARK_KERNEL_SIZED(do_DBSCAN_doublezisegmap_intrablock_46535_dim1, 1, 1)\nvoid do_DBSCAN_doublezisegmap_intrablock_46535(__global int *global_failure, int8_t clBase_34768, int8_t clBase_34769, double clBase_34770, double clBase_34776, int64_t m_41485, int64_t conc_tmp_41556, int64_t inf_41586, int64_t j_m_i_41589, int64_t ldim_46538, int64_t num_whole_tiles_46597, int64_t ",
                                    "residual_input_46804, unsigned char cond_46805_bits, int64_t binop_x_46821, __global unsigned char *mem_49480, __global unsigned char *mem_49482, __global unsigned char *mem_49498, __global unsigned char *mem_49500, __global unsigned char *mem_param_49520, __global unsigned char *mem_49584)\n{\n    bool cond_46805 = cond_46805_bits;\n    \n    #define tile_sizze_46537 (do_DBSCAN_doublezisegmap_intrablock_46535zitile_sizze_46537)\n    #define bytes_49561 (do_DBSCAN_doublezisegmap_intrablock_46535zibytes_49561)\n    \n    volatile __local unsigned char *color_50174_backing_2 = &shared_mem[0];\n    const int64_t color_50174_backing_2_offset = 0 + (bytes_49561 + srem64((int64_t) 8 - srem64(bytes_49561, (int64_t) 8), (int64_t) 8));\n    volatile __local unsigned char *color_50173_backing_1 = &shared_mem[color_50174_backing_2_offset];\n    const int64_t color_50173_backing_1_offset = color_50174_backing_2_offset + (bytes_49561 + srem64((int64_t) 8 - srem64(bytes_49561, (int64_t) 8), (int64_t) 8));\n    volatile __local unsigned char *color_50172_backing_0 = &shared_mem[color_50173_backing_1_offset];\n    const int64_t color_50172_backing_0_offset = color_50173_backing_1_offset + (bytes_49561 + srem64((int64_t) 8 - srem64(bytes_49561, (int64_t) 8), (int64_t) 8));\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_51087;\n    int32_t tblock_sizze_51090;\n    int32_t wave_sizze_51089;\n    int32_t block_id_51088;\n    int32_t global_tid_51086;\n    int64_t gid_flat_46535;\n    int64_t slice_51092;\n    int64_t ltid_pre_51091;\n    int64_t remnant_51093;\n    int64_t slice_51094;\n    int64_t gid_46534;\n    int64_t remnant_51095;\n    __local unsigned char *color_50172;\n    __local unsigned char *color_50173;\n    __local unsigned char *color_50174;\n    int64_t binop_x_46555;\n    int64_t mem_49535[1];\n    double mem_49539[1];\n    double mem_49543[1];\n    double mem_49547[1];\n    double mem_49551[1];\n    double mem_49555[1];\n    int64_t ltid_flat_46540;\n    int64_t ltid_465", "39;\n    int64_t gtid_46556;\n    bool cond_46557;\n    int64_t pre_46558;\n    double pre_46559;\n    double pre_46560;\n    double pre_46561;\n    double pre_46562;\n    double pre_46563;\n    int64_t mem_49559[1];\n    int64_t ltid_flat_46599;\n    int64_t ltid_46598;\n    int64_t ext_mem_49571[1];\n    int64_t mem_param_49560[1];\n    int64_t mem_49581[1];\n    int64_t ext_mem_49582[1];\n    \n    local_tid_51087 = get_local_id(0);\n    tblock_sizze_51090 = get_local_size(0);\n    wave_sizze_51089 = LOCKSTEP_WIDTH;\n    block_id_51088 = get_tblock_id(0);\n    global_tid_51086 = block_id_51088 * tblock_sizze_51090 + local_tid_51087;\n    gid_flat_46535 = sext_i32_i64(block_id_51088);\n    slice_51092 = tile_sizze_46537;\n    ltid_pre_51091 = sext_i32_i64(local_tid_51087);\n    remnant_51093 = sext_i32_i64(local_tid_51087) - ltid_pre_51091;\n    slice_51094 = ldim_46538;\n    gid_46534 = sext_i32_i64(block_id_51088);\n    remnant_51095 = sext_i32_i64(block_id_51088) - gid_46534;\n    color_50172 = (__local unsigned char *) color_50172_backing_0;\n    color_50173 = (__local unsigned char *) color_50173_backing_1;\n    color_50174 = (__local unsigned char *) color_50174_backing_2;\n    binop_x_46555 = gid_46534 * tile_sizze_46537;\n    ltid_flat_46540 = sext_i32_i64(local_tid_51087);\n    ltid_46539 = sext_i32_i64(sext_i64_i32(ltid_pre_51091));\n    gtid_46556 = ltid_46539 + binop_x_46555;\n    cond_46557 = slt64(gtid_46556, j_m_i_41589);\n    if (cond_46557) {\n        int64_t slice_46564;\n        int64_t eta_p_46565;\n        bool index_concat_cmp_46567;\n        double index_concat_branch_46568;\n        double index_concat_branch_46574;\n        double zt_res_46578;\n        double zt_res_46579;\n        double zs_res_46580;\n        double zs_res_46581;\n        double d_haversine_res_46582;\n        double d_haversine_res_46583;\n        double cos_res_46584;\n        \n        slice_46564 = inf_41586 + gtid_46556;\n        eta_p_46565 = ((__global int64_t *) mem_param_49520)[slice_46564];\n        index_concat", "_cmp_46567 = sle64(m_41485, slice_46564);\n        if (index_concat_cmp_46567) {\n            int64_t index_concat_i_46569;\n            double index_concat_46570;\n            \n            index_concat_i_46569 = sub64(slice_46564, m_41485);\n            index_concat_46570 = ((__global double *) mem_49500)[index_concat_i_46569];\n            index_concat_branch_46568 = index_concat_46570;\n        } else {\n            double index_concat_46571 = ((__global double *) mem_49482)[slice_46564];\n            \n            index_concat_branch_46568 = index_concat_46571;\n        }\n        if (index_concat_cmp_46567) {\n            int64_t index_concat_i_46575;\n            double index_concat_46576;\n            \n            index_concat_i_46575 = sub64(slice_46564, m_41485);\n            index_concat_46576 = ((__global double *) mem_49498)[index_concat_i_46575];\n            index_concat_branch_46574 = index_concat_46576;\n        } else {\n            double index_concat_46577 = ((__global double *) mem_49480)[slice_46564];\n            \n            index_concat_branch_46574 = index_concat_46577;\n        }\n        zt_res_46578 = 3.141592653589793 * index_concat_branch_46568;\n        zt_res_46579 = 3.141592653589793 * index_concat_branch_46574;\n        zs_res_46580 = zt_res_46578 / 180.0;\n        zs_res_46581 = zt_res_46579 / 180.0;\n        if (clBase_34768 == (int8_t) 1) {\n            d_haversine_res_46582 = index_concat_branch_46568;\n        } else {\n            d_haversine_res_46582 = zs_res_46580;\n        }\n        if (clBase_34768 == (int8_t) 1) {\n            d_haversine_res_46583 = index_concat_branch_46574;\n        } else {\n            d_haversine_res_46583 = zs_res_46581;\n        }\n        cos_res_46584 = futrts_cos64(d_haversine_res_46582);\n        pre_46558 = eta_p_46565;\n        pre_46559 = d_haversine_res_46582;\n        pre_46560 = d_haversine_res_46583;\n        pre_46561 = cos_res_46584;\n        pre_46562 = index_concat_branch_46574;\n        pre_46563 = index_concat_branch_46",
                                    "568;\n    } else {\n        pre_46558 = (int64_t) 0;\n        pre_46559 = 0.0;\n        pre_46560 = 0.0;\n        pre_46561 = 0.0;\n        pre_46562 = 0.0;\n        pre_46563 = 0.0;\n    }\n    mem_49535[(int64_t) 0] = pre_46558;\n    mem_49539[(int64_t) 0] = pre_46559;\n    mem_49543[(int64_t) 0] = pre_46560;\n    mem_49547[(int64_t) 0] = pre_46561;\n    mem_49551[(int64_t) 0] = pre_46562;\n    mem_49555[(int64_t) 0] = pre_46563;\n    barrier(CLK_LOCAL_MEM_FENCE);\n    ltid_flat_46599 = sext_i32_i64(local_tid_51087);\n    ltid_46598 = sext_i32_i64(sext_i64_i32(ltid_pre_51091));\n    mem_49559[(int64_t) 0] = (int64_t) 9223372036854775807;\n    barrier(CLK_LOCAL_MEM_FENCE);\n    barrier(CLK_LOCAL_MEM_FENCE);\n    for (int32_t i_3 = 0; i_3 < 1; i_3++)\n        mem_param_49560[i_3] = mem_49559[i_3];\n    for (int64_t tile_id_46605 = 0; tile_id_46605 < num_whole_tiles_46597; tile_id_46605++) {\n        int64_t binop_x_46702;\n        int64_t ltid_flat_46701;\n        int64_t ltid_46700;\n        int64_t j_46703;\n        bool cond_46712;\n        double pre1d_46713;\n        double pre1d_46714;\n        int64_t pre1d_46715;\n        int64_t mem_49570[1];\n        int64_t ltid_flat_46724;\n        int64_t ltid_46723;\n        int64_t gtid_46726;\n        int64_t acc_46733;\n        bool cond_46734;\n        int64_t acc_46735;\n        int64_t mem_param_tmp_51096[1];\n        \n        binop_x_46702 = tile_sizze_46537 * tile_id_46605;\n        ltid_flat_46701 = sext_i32_i64(local_tid_51087);\n        ltid_46700 = sext_i32_i64(sext_i64_i32(ltid_pre_51091));\n        j_46703 = ltid_46700 + binop_x_46702;\n        cond_46712 = slt64(j_46703, conc_tmp_41556);\n        if (cond_46712) {\n            bool index_concat_cmp_48996;\n            double index_concat_branch_49000;\n            double index_concat_branch_48994;\n            int64_t tile_elem_46718;\n            \n            index_concat_cmp_48996 = sle64(m_41485, j_46703);\n            if (index_concat_cmp_48996) {\n                int64_t index_concat_i_48997;\n       ", "         double index_concat_48998;\n                \n                index_concat_i_48997 = sub64(j_46703, m_41485);\n                index_concat_48998 = ((__global double *) mem_49500)[index_concat_i_48997];\n                index_concat_branch_49000 = index_concat_48998;\n            } else {\n                double index_concat_48999 = ((__global double *) mem_49482)[j_46703];\n                \n                index_concat_branch_49000 = index_concat_48999;\n            }\n            if (index_concat_cmp_48996) {\n                int64_t index_concat_i_48991;\n                double index_concat_48992;\n                \n                index_concat_i_48991 = sub64(j_46703, m_41485);\n                index_concat_48992 = ((__global double *) mem_49498)[index_concat_i_48991];\n                index_concat_branch_48994 = index_concat_48992;\n            } else {\n                double index_concat_48993 = ((__global double *) mem_49480)[j_46703];\n                \n                index_concat_branch_48994 = index_concat_48993;\n            }\n            tile_elem_46718 = ((__global int64_t *) mem_param_49520)[j_46703];\n            pre1d_46713 = index_concat_branch_49000;\n            pre1d_46714 = index_concat_branch_48994;\n            pre1d_46715 = tile_elem_46718;\n        } else {\n            pre1d_46713 = 0.0;\n            pre1d_46714 = 0.0;\n            pre1d_46715 = (int64_t) 0;\n        }\n        ((__local double *) color_50174)[ltid_46700] = pre1d_46713;\n        ((__local double *) color_50173)[ltid_46700] = pre1d_46714;\n        ((__local int64_t *) color_50172)[ltid_46700] = pre1d_46715;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        ltid_flat_46724 = sext_i32_i64(local_tid_51087);\n        ltid_46723 = sext_i32_i64(sext_i64_i32(ltid_pre_51091));\n        gtid_46726 = binop_x_46555 + ltid_46723;\n        acc_46733 = mem_param_49560[(int64_t) 0];\n        cond_46734 = slt64(gtid_46726, j_m_i_41589);\n        if (cond_46734) {\n            int64_t eta_p_46727;\n            double d_ha", "versine_res_46728;\n            double d_haversine_res_46729;\n            double cos_res_46730;\n            double index_concat_branch_46731;\n            double index_concat_branch_46732;\n            int64_t x_46736;\n            int64_t redout_49001;\n            \n            eta_p_46727 = mem_49535[(int64_t) 0];\n            d_haversine_res_46728 = mem_49539[(int64_t) 0];\n            d_haversine_res_46729 = mem_49543[(int64_t) 0];\n            cos_res_46730 = mem_49547[(int64_t) 0];\n            index_concat_branch_46731 = mem_49551[(int64_t) 0];\n            index_concat_branch_46732 = mem_49555[(int64_t) 0];\n            redout_49001 = acc_46733;\n            for (int64_t i_49002 = 0; i_49002 < tile_sizze_46537; i_49002++) {\n                double eta_p_46737;\n                double eta_p_46738;\n                double dist_res_46740;\n                bool zlze_res_46765;\n                int64_t lifted_lambda_res_46766;\n                int64_t min_res_46769;\n                int64_t redout_tmp_51098;\n                \n                eta_p_46737 = ((__local double *) color_50174)[i_49002];\n                eta_p_46738 = ((__local double *) color_50173)[i_49002];\n                if (clBase_34769 == (int8_t) 0) {\n                    double zm_res_46741;\n                    double zm_res_46742;\n                    double hypot_res_46743;\n                    \n                    zm_res_46741 = index_concat_branch_46731 - eta_p_46738;\n                    zm_res_46742 = index_concat_branch_46732 - eta_p_46737;\n                    hypot_res_46743 = futrts_hypot64(zm_res_46742, zm_res_46741);\n                    dist_res_46740 = hypot_res_46743;\n                } else {\n                    double d_haversine_res_46744;\n                    double d_haversine_res_46745;\n                    double zm_res_46750;\n                    double cos_res_46751;\n                    double zm_res_46752;\n                    double cos_res_46753;\n                    double zt_res_46754;\n            ",
                                    "        double zm_res_46755;\n                    double zm_res_46756;\n                    double zt_res_46757;\n                    double zp_res_46758;\n                    double zs_res_46759;\n                    double min_res_46760;\n                    double zt_res_46761;\n                    double zm_res_46762;\n                    double acos_res_46763;\n                    double zt_res_46764;\n                    \n                    if (clBase_34768 == (int8_t) 1) {\n                        d_haversine_res_46744 = eta_p_46737;\n                        d_haversine_res_46745 = eta_p_46738;\n                    } else {\n                        double zt_res_46746;\n                        double zs_res_46747;\n                        double zt_res_46748;\n                        double zs_res_46749;\n                        \n                        zt_res_46746 = 3.141592653589793 * eta_p_46737;\n                        zs_res_46747 = zt_res_46746 / 180.0;\n                        zt_res_46748 = 3.141592653589793 * eta_p_46738;\n                        zs_res_46749 = zt_res_46748 / 180.0;\n                        d_haversine_res_46744 = zs_res_46747;\n                        d_haversine_res_46745 = zs_res_46749;\n                    }\n                    zm_res_46750 = d_haversine_res_46728 - d_haversine_res_46744;\n                    cos_res_46751 = futrts_cos64(zm_res_46750);\n                    zm_res_46752 = 1.0 - cos_res_46751;\n                    cos_res_46753 = futrts_cos64(d_haversine_res_46744);\n                    zt_res_46754 = cos_res_46730 * cos_res_46753;\n                    zm_res_46755 = d_haversine_res_46729 - d_haversine_res_46745;\n                    zm_res_46756 = 1.0 - zm_res_46755;\n                    zt_res_46757 = zt_res_46754 * zm_res_46756;\n                    zp_res_46758 = zm_res_46752 + zt_res_46757;\n                    zs_res_46759 = zp_res_46758 / 2.0;\n                    min_res_46760 = fmin64(1.0, zs_res_46759);\n                    zt_res_46761", " = 2.0 * min_res_46760;\n                    zm_res_46762 = 1.0 - zt_res_46761;\n                    acos_res_46763 = futrts_acos64(zm_res_46762);\n                    zt_res_46764 = clBase_34776 * acos_res_46763;\n                    dist_res_46740 = zt_res_46764;\n                }\n                zlze_res_46765 = dist_res_46740 <= clBase_34770;\n                if (zlze_res_46765) {\n                    int64_t eta_p_46739 = ((__local int64_t *) color_50172)[i_49002];\n                    \n                    lifted_lambda_res_46766 = eta_p_46739;\n                } else {\n                    lifted_lambda_res_46766 = eta_p_46727;\n                }\n                min_res_46769 = smin64(lifted_lambda_res_46766, redout_49001);\n                redout_tmp_51098 = min_res_46769;\n                redout_49001 = redout_tmp_51098;\n            }\n            x_46736 = redout_49001;\n            acc_46735 = x_46736;\n        } else {\n            acc_46735 = acc_46733;\n        }\n        mem_49570[(int64_t) 0] = acc_46735;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        for (int32_t i_4 = 0; i_4 < 1; i_4++)\n            mem_param_tmp_51096[i_4] = mem_49570[i_4];\n        for (int32_t i_5 = 0; i_5 < 1; i_5++)\n            mem_param_49560[i_5] = mem_param_tmp_51096[i_5];\n    }\n    for (int32_t i_6 = 0; i_6 < 1; i_6++)\n        ext_mem_49571[i_6] = mem_param_49560[i_6];\n    barrier(CLK_LOCAL_MEM_FENCE);\n    if (cond_46805) {\n        for (int32_t i_7 = 0; i_7 < 1; i_7++)\n            ext_mem_49582[i_7] = ext_mem_49571[i_7];\n    } else {\n        int64_t ltid_flat_46807;\n        int64_t ltid_46806;\n        int64_t j_46822;\n        bool cond_46831;\n        double pre1d_46832;\n        double pre1d_46833;\n        int64_t pre1d_46834;\n        int64_t ltid_flat_46848;\n        int64_t ltid_46847;\n        int64_t gtid_46855;\n        int64_t acc_46862;\n        bool cond_46863;\n        int64_t acc_46864;\n        \n        ltid_flat_46807 = sext_i32_i64(local_tid_51087);\n        ltid_46806 = sext_i32_i64(sext_", "i64_i32(ltid_pre_51091));\n        j_46822 = ltid_46806 + binop_x_46821;\n        cond_46831 = slt64(j_46822, conc_tmp_41556);\n        if (cond_46831) {\n            bool index_concat_cmp_48984;\n            double index_concat_branch_48988;\n            double index_concat_branch_48982;\n            int64_t tile_elem_46837;\n            \n            index_concat_cmp_48984 = sle64(m_41485, j_46822);\n            if (index_concat_cmp_48984) {\n                int64_t index_concat_i_48985;\n                double index_concat_48986;\n                \n                index_concat_i_48985 = sub64(j_46822, m_41485);\n                index_concat_48986 = ((__global double *) mem_49500)[index_concat_i_48985];\n                index_concat_branch_48988 = index_concat_48986;\n            } else {\n                double index_concat_48987 = ((__global double *) mem_49482)[j_46822];\n                \n                index_concat_branch_48988 = index_concat_48987;\n            }\n            if (index_concat_cmp_48984) {\n                int64_t index_concat_i_48979;\n                double index_concat_48980;\n                \n                index_concat_i_48979 = sub64(j_46822, m_41485);\n                index_concat_48980 = ((__global double *) mem_49498)[index_concat_i_48979];\n                index_concat_branch_48982 = index_concat_48980;\n            } else {\n                double index_concat_48981 = ((__global double *) mem_49480)[j_46822];\n                \n                index_concat_branch_48982 = index_concat_48981;\n            }\n            tile_elem_46837 = ((__global int64_t *) mem_param_49520)[j_46822];\n            pre1d_46832 = index_concat_branch_48988;\n            pre1d_46833 = index_concat_branch_48982;\n            pre1d_46834 = tile_elem_46837;\n        } else {\n            pre1d_46832 = 0.0;\n            pre1d_46833 = 0.0;\n            pre1d_46834 = (int64_t) 0;\n        }\n        ((__local double *) color_50174)[ltid_46806] = pre1d_46832;\n        ((__local double *) color_50173)",
                                    "[ltid_46806] = pre1d_46833;\n        ((__local int64_t *) color_50172)[ltid_46806] = pre1d_46834;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        ltid_flat_46848 = sext_i32_i64(local_tid_51087);\n        ltid_46847 = sext_i32_i64(sext_i64_i32(ltid_pre_51091));\n        gtid_46855 = binop_x_46555 + ltid_46847;\n        acc_46862 = ext_mem_49571[(int64_t) 0];\n        cond_46863 = slt64(gtid_46855, j_m_i_41589);\n        if (cond_46863) {\n            int64_t eta_p_46856;\n            double d_haversine_res_46857;\n            double d_haversine_res_46858;\n            double cos_res_46859;\n            double index_concat_branch_46860;\n            double index_concat_branch_46861;\n            int64_t x_46865;\n            int64_t redout_49003;\n            \n            eta_p_46856 = mem_49535[(int64_t) 0];\n            d_haversine_res_46857 = mem_49539[(int64_t) 0];\n            d_haversine_res_46858 = mem_49543[(int64_t) 0];\n            cos_res_46859 = mem_49547[(int64_t) 0];\n            index_concat_branch_46860 = mem_49551[(int64_t) 0];\n            index_concat_branch_46861 = mem_49555[(int64_t) 0];\n            redout_49003 = acc_46862;\n            for (int64_t i_49004 = 0; i_49004 < residual_input_46804; i_49004++) {\n                double eta_p_46866;\n                double eta_p_46867;\n                double dist_res_46869;\n                bool zlze_res_46894;\n                int64_t lifted_lambda_res_46895;\n                int64_t min_res_46898;\n                int64_t redout_tmp_51099;\n                \n                eta_p_46866 = ((__local double *) color_50174)[i_49004];\n                eta_p_46867 = ((__local double *) color_50173)[i_49004];\n                if (clBase_34769 == (int8_t) 0) {\n                    double zm_res_46870;\n                    double zm_res_46871;\n                    double hypot_res_46872;\n                    \n                    zm_res_46870 = index_concat_branch_46860 - eta_p_46867;\n                    zm_res_46871 = index_concat_branch_46861 - ", "eta_p_46866;\n                    hypot_res_46872 = futrts_hypot64(zm_res_46871, zm_res_46870);\n                    dist_res_46869 = hypot_res_46872;\n                } else {\n                    double d_haversine_res_46873;\n                    double d_haversine_res_46874;\n                    double zm_res_46879;\n                    double cos_res_46880;\n                    double zm_res_46881;\n                    double cos_res_46882;\n                    double zt_res_46883;\n                    double zm_res_46884;\n                    double zm_res_46885;\n                    double zt_res_46886;\n                    double zp_res_46887;\n                    double zs_res_46888;\n                    double min_res_46889;\n                    double zt_res_46890;\n                    double zm_res_46891;\n                    double acos_res_46892;\n                    double zt_res_46893;\n                    \n                    if (clBase_34768 == (int8_t) 1) {\n                        d_haversine_res_46873 = eta_p_46866;\n                        d_haversine_res_46874 = eta_p_46867;\n                    } else {\n                        double zt_res_46875;\n                        double zs_res_46876;\n                        double zt_res_46877;\n                        double zs_res_46878;\n                        \n                        zt_res_46875 = 3.141592653589793 * eta_p_46866;\n                        zs_res_46876 = zt_res_46875 / 180.0;\n                        zt_res_46877 = 3.141592653589793 * eta_p_46867;\n                        zs_res_46878 = zt_res_46877 / 180.0;\n                        d_haversine_res_46873 = zs_res_46876;\n                        d_haversine_res_46874 = zs_res_46878;\n                    }\n                    zm_res_46879 = d_haversine_res_46857 - d_haversine_res_46873;\n                    cos_res_46880 = futrts_cos64(zm_res_46879);\n                    zm_res_46881 = 1.0 - cos_res_46880;\n                    cos_res_46882 = futrts_cos64(d_haversine_", "res_46873);\n                    zt_res_46883 = cos_res_46859 * cos_res_46882;\n                    zm_res_46884 = d_haversine_res_46858 - d_haversine_res_46874;\n                    zm_res_46885 = 1.0 - zm_res_46884;\n                    zt_res_46886 = zt_res_46883 * zm_res_46885;\n                    zp_res_46887 = zm_res_46881 + zt_res_46886;\n                    zs_res_46888 = zp_res_46887 / 2.0;\n                    min_res_46889 = fmin64(1.0, zs_res_46888);\n                    zt_res_46890 = 2.0 * min_res_46889;\n                    zm_res_46891 = 1.0 - zt_res_46890;\n                    acos_res_46892 = futrts_acos64(zm_res_46891);\n                    zt_res_46893 = clBase_34776 * acos_res_46892;\n                    dist_res_46869 = zt_res_46893;\n                }\n                zlze_res_46894 = dist_res_46869 <= clBase_34770;\n                if (zlze_res_46894) {\n                    int64_t eta_p_46868 = ((__local int64_t *) color_50172)[i_49004];\n                    \n                    lifted_lambda_res_46895 = eta_p_46868;\n                } else {\n                    lifted_lambda_res_46895 = eta_p_46856;\n                }\n                min_res_46898 = smin64(lifted_lambda_res_46895, redout_49003);\n                redout_tmp_51099 = min_res_46898;\n                redout_49003 = redout_tmp_51099;\n            }\n            x_46865 = redout_49003;\n            acc_46864 = x_46865;\n        } else {\n            acc_46864 = acc_46862;\n        }\n        mem_49581[(int64_t) 0] = acc_46864;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        for (int32_t i_8 = 0; i_8 < 1; i_8++)\n            ext_mem_49582[i_8] = mem_49581[i_8];\n    }\n    if (slt64(sext_i32_i64(local_tid_51087) + tile_sizze_46537 * sext_i32_i64(block_id_51088), j_m_i_41589)) {\n        int64_t tmp_51100 = ext_mem_49582[(int64_t) 0];\n        \n        ((__global int64_t *) mem_49584)[sext_i32_i64(local_tid_51087) + tile_sizze_46537 * sext_i32_i64(block_id_51088)] = tmp_51100;\n    }\n    \n  error_8:\n    return;\n    #",
                                    "undef tile_sizze_46537\n    #undef bytes_49561\n}\nFUTHARK_KERNEL_SIZED(do_DBSCAN_doublezisegmap_intrablock_46915_dim1, 1, 1)\nvoid do_DBSCAN_doublezisegmap_intrablock_46915(__global int *global_failure, int64_t m_41740, int64_t ldim_46918, int64_t num_whole_tiles_46938, int64_t residual_input_47152, unsigned char cond_47153_bits, int64_t binop_x_47169, __global unsigned char *mem_49510, __global unsigned char *mem_49615, __global unsigned char *mem_49740)\n{\n    bool cond_47153 = cond_47153_bits;\n    \n    #define tile_sizze_46917 (do_DBSCAN_doublezisegmap_intrablock_46915zitile_sizze_46917)\n    #define bytes_49703 (do_DBSCAN_doublezisegmap_intrablock_46915zibytes_49703)\n    \n    volatile __local unsigned char *color_50177_backing_2 = &shared_mem[0];\n    const int64_t color_50177_backing_2_offset = 0 + (bytes_49703 + srem64((int64_t) 8 - srem64(bytes_49703, (int64_t) 8), (int64_t) 8));\n    volatile __local unsigned char *color_50176_backing_1 = &shared_mem[color_50177_backing_2_offset];\n    const int64_t color_50176_backing_1_offset = color_50177_backing_2_offset + (bytes_49703 + srem64((int64_t) 8 - srem64(bytes_49703, (int64_t) 8), (int64_t) 8));\n    volatile __local unsigned char *color_50175_backing_0 = &shared_mem[color_50176_backing_1_offset];\n    const int64_t color_50175_backing_0_offset = color_50176_backing_1_offset + (bytes_49703 + srem64((int64_t) 8 - srem64(bytes_49703, (int64_t) 8), (int64_t) 8));\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_51473;\n    int32_t tblock_sizze_51476;\n    int32_t wave_sizze_51475;\n    int32_t block_id_51474;\n    int32_t global_tid_51472;\n    int64_t gid_flat_46915;\n    int64_t slice_51478;\n    int64_t ltid_pre_51477;\n    int64_t remnant_51479;\n    int64_t slice_51480;\n    int64_t gid_46914;\n    int64_t remnant_51481;\n    __local unsigned char *color_50175;\n    __local unsigned char *color_50176;\n    __local unsigned char *color_50177;\n    int64_t binop_x_46927;\n    int64_t mem_49683[1];\n    int64", "_t mem_49687[1];\n    int64_t ltid_flat_46920;\n    int64_t ltid_46919;\n    int64_t gtid_46928;\n    bool cond_46929;\n    int64_t pre_46930;\n    int64_t pre_46931;\n    int64_t mem_49691[1];\n    int64_t mem_49695[1];\n    int64_t mem_49699[1];\n    int64_t ltid_flat_46940;\n    int64_t ltid_46939;\n    int64_t gtid_46950;\n    bool cond_46951;\n    int64_t neutral_46952;\n    int64_t neutral_46953;\n    int64_t neutral_46954;\n    int64_t ext_mem_49723[1];\n    int64_t ext_mem_49722[1];\n    int64_t ext_mem_49721[1];\n    int64_t mem_param_49700[1];\n    int64_t mem_param_49701[1];\n    int64_t mem_param_49702[1];\n    int64_t mem_49733[1];\n    int64_t ext_mem_49734[1];\n    int64_t mem_49738[1];\n    int64_t ltid_flat_47251;\n    int64_t ltid_47250;\n    int64_t gtid_47257;\n    bool cond_47261;\n    int64_t postlude_47262;\n    \n    local_tid_51473 = get_local_id(0);\n    tblock_sizze_51476 = get_local_size(0);\n    wave_sizze_51475 = LOCKSTEP_WIDTH;\n    block_id_51474 = get_tblock_id(0);\n    global_tid_51472 = block_id_51474 * tblock_sizze_51476 + local_tid_51473;\n    gid_flat_46915 = sext_i32_i64(block_id_51474);\n    slice_51478 = tile_sizze_46917;\n    ltid_pre_51477 = sext_i32_i64(local_tid_51473);\n    remnant_51479 = sext_i32_i64(local_tid_51473) - ltid_pre_51477;\n    slice_51480 = ldim_46918;\n    gid_46914 = sext_i32_i64(block_id_51474);\n    remnant_51481 = sext_i32_i64(block_id_51474) - gid_46914;\n    color_50175 = (__local unsigned char *) color_50175_backing_0;\n    color_50176 = (__local unsigned char *) color_50176_backing_1;\n    color_50177 = (__local unsigned char *) color_50177_backing_2;\n    binop_x_46927 = gid_46914 * tile_sizze_46917;\n    ltid_flat_46920 = sext_i32_i64(local_tid_51473);\n    ltid_46919 = sext_i32_i64(sext_i64_i32(ltid_pre_51477));\n    gtid_46928 = ltid_46919 + binop_x_46927;\n    cond_46929 = slt64(gtid_46928, m_41740);\n    if (cond_46929) {\n        int64_t lifted_lambda_res_46932;\n        int64_t lifted_lambda_res_46933;\n        \n        lifted_lambda_res_46932", " = ((__global int64_t *) mem_49615)[gtid_46928];\n        lifted_lambda_res_46933 = ((__global int64_t *) mem_49510)[gtid_46928];\n        pre_46930 = lifted_lambda_res_46932;\n        pre_46931 = lifted_lambda_res_46933;\n    } else {\n        pre_46930 = (int64_t) 0;\n        pre_46931 = (int64_t) 0;\n    }\n    mem_49683[(int64_t) 0] = pre_46930;\n    mem_49687[(int64_t) 0] = pre_46931;\n    barrier(CLK_LOCAL_MEM_FENCE);\n    ltid_flat_46940 = sext_i32_i64(local_tid_51473);\n    ltid_46939 = sext_i32_i64(sext_i64_i32(ltid_pre_51477));\n    gtid_46950 = binop_x_46927 + ltid_46939;\n    cond_46951 = slt64(gtid_46950, m_41740);\n    if (cond_46951) {\n        neutral_46952 = gtid_46950;\n    } else {\n        neutral_46952 = (int64_t) 0;\n    }\n    if (cond_46951) {\n        int64_t lifted_lambda_res_46955;\n        int64_t lifted_lambda_res_46956;\n        \n        lifted_lambda_res_46955 = mem_49683[(int64_t) 0];\n        lifted_lambda_res_46956 = mem_49687[(int64_t) 0];\n        neutral_46953 = lifted_lambda_res_46955;\n        neutral_46954 = lifted_lambda_res_46956;\n    } else {\n        neutral_46953 = (int64_t) 0;\n        neutral_46954 = (int64_t) 0;\n    }\n    mem_49691[(int64_t) 0] = neutral_46952;\n    mem_49695[(int64_t) 0] = neutral_46953;\n    mem_49699[(int64_t) 0] = neutral_46954;\n    barrier(CLK_LOCAL_MEM_FENCE);\n    barrier(CLK_LOCAL_MEM_FENCE);\n    for (int32_t i_3 = 0; i_3 < 1; i_3++)\n        mem_param_49700[i_3] = mem_49691[i_3];\n    for (int32_t i_4 = 0; i_4 < 1; i_4++)\n        mem_param_49701[i_4] = mem_49695[i_4];\n    for (int32_t i_5 = 0; i_5 < 1; i_5++)\n        mem_param_49702[i_5] = mem_49699[i_5];\n    for (int64_t tile_id_46966 = 0; tile_id_46966 < num_whole_tiles_46938; tile_id_46966++) {\n        int64_t binop_x_47062;\n        int64_t ltid_flat_47061;\n        int64_t ltid_47060;\n        int64_t j_47063;\n        bool cond_47068;\n        int64_t pre1d_47069;\n        int64_t pre1d_47070;\n        int64_t pre1d_47071;\n        int64_t mem_49712[1];\n        int64_t mem_4971",
                                    "6[1];\n        int64_t mem_49720[1];\n        int64_t ltid_flat_47082;\n        int64_t ltid_47081;\n        int64_t gtid_47084;\n        int64_t acc_47087;\n        int64_t acc_47088;\n        int64_t acc_47089;\n        bool cond_47090;\n        int64_t acc_47091;\n        int64_t acc_47092;\n        int64_t acc_47093;\n        int64_t mem_param_tmp_51482[1];\n        int64_t mem_param_tmp_51483[1];\n        int64_t mem_param_tmp_51484[1];\n        \n        binop_x_47062 = tile_sizze_46917 * tile_id_46966;\n        ltid_flat_47061 = sext_i32_i64(local_tid_51473);\n        ltid_47060 = sext_i32_i64(sext_i64_i32(ltid_pre_51477));\n        j_47063 = ltid_47060 + binop_x_47062;\n        cond_47068 = slt64(j_47063, m_41740);\n        if (cond_47068) {\n            pre1d_47069 = j_47063;\n        } else {\n            pre1d_47069 = (int64_t) 0;\n        }\n        if (cond_47068) {\n            int64_t tile_elem_47073;\n            int64_t tile_elem_47074;\n            \n            tile_elem_47073 = ((__global int64_t *) mem_49615)[j_47063];\n            tile_elem_47074 = ((__global int64_t *) mem_49510)[j_47063];\n            pre1d_47070 = tile_elem_47073;\n            pre1d_47071 = tile_elem_47074;\n        } else {\n            pre1d_47070 = (int64_t) 0;\n            pre1d_47071 = (int64_t) 0;\n        }\n        ((__local int64_t *) color_50177)[ltid_47060] = pre1d_47069;\n        ((__local int64_t *) color_50176)[ltid_47060] = pre1d_47070;\n        ((__local int64_t *) color_50175)[ltid_47060] = pre1d_47071;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        ltid_flat_47082 = sext_i32_i64(local_tid_51473);\n        ltid_47081 = sext_i32_i64(sext_i64_i32(ltid_pre_51477));\n        gtid_47084 = binop_x_46927 + ltid_47081;\n        acc_47087 = mem_param_49700[(int64_t) 0];\n        acc_47088 = mem_param_49701[(int64_t) 0];\n        acc_47089 = mem_param_49702[(int64_t) 0];\n        cond_47090 = slt64(gtid_47084, m_41740);\n        if (cond_47090) {\n            int64_t lifted_lambda_res_47085;\n            int64_t lift", "ed_lambda_res_47086;\n            int64_t x_47094;\n            int64_t x_47095;\n            int64_t x_47096;\n            int64_t redout_49009;\n            int64_t redout_49010;\n            int64_t redout_49011;\n            \n            lifted_lambda_res_47085 = mem_49683[(int64_t) 0];\n            lifted_lambda_res_47086 = mem_49687[(int64_t) 0];\n            redout_49009 = acc_47087;\n            redout_49010 = acc_47088;\n            redout_49011 = acc_47089;\n            for (int64_t i_49012 = 0; i_49012 < tile_sizze_46917; i_49012++) {\n                int64_t x_47097;\n                int64_t x_47098;\n                int64_t x_47099;\n                bool cond_47106;\n                bool cond_47107;\n                bool cond_f_res_47108;\n                bool cond_f_res_47109;\n                bool y_47110;\n                bool cond_47111;\n                bool cond_47112;\n                bool cond_t_res_47113;\n                bool x_47114;\n                bool cond_f_res_t_res_47115;\n                bool x_47116;\n                bool x_47117;\n                bool y_47118;\n                bool cond_47119;\n                int64_t lifted_lambda_res_47120;\n                int64_t lifted_lambda_res_47121;\n                int64_t lifted_lambda_res_47122;\n                int64_t redout_tmp_51488;\n                int64_t redout_tmp_51489;\n                int64_t redout_tmp_51490;\n                \n                x_47097 = ((__local int64_t *) color_50177)[i_49012];\n                x_47098 = ((__local int64_t *) color_50176)[i_49012];\n                x_47099 = ((__local int64_t *) color_50175)[i_49012];\n                cond_47106 = redout_49010 == lifted_lambda_res_47085;\n                cond_47107 = !cond_47106;\n                cond_f_res_47108 = redout_49011 == lifted_lambda_res_47086;\n                cond_f_res_47109 = !cond_f_res_47108;\n                y_47110 = cond_47106 && cond_f_res_47109;\n                cond_47111 = cond_47107 || y_47110;\n                cond_47112 = slt", "64(x_47097, redout_49009);\n                cond_t_res_47113 = x_47098 == lifted_lambda_res_47085;\n                x_47114 = cond_47112 && cond_t_res_47113;\n                cond_f_res_t_res_47115 = x_47099 == lifted_lambda_res_47086;\n                x_47116 = x_47114 && cond_f_res_t_res_47115;\n                x_47117 = !cond_47111;\n                y_47118 = x_47116 && x_47117;\n                cond_47119 = cond_47111 || y_47118;\n                if (cond_47119) {\n                    lifted_lambda_res_47120 = x_47097;\n                } else {\n                    lifted_lambda_res_47120 = redout_49009;\n                }\n                if (cond_47119) {\n                    lifted_lambda_res_47121 = x_47098;\n                } else {\n                    lifted_lambda_res_47121 = redout_49010;\n                }\n                if (cond_47119) {\n                    lifted_lambda_res_47122 = x_47099;\n                } else {\n                    lifted_lambda_res_47122 = redout_49011;\n                }\n                redout_tmp_51488 = lifted_lambda_res_47120;\n                redout_tmp_51489 = lifted_lambda_res_47121;\n                redout_tmp_51490 = lifted_lambda_res_47122;\n                redout_49009 = redout_tmp_51488;\n                redout_49010 = redout_tmp_51489;\n                redout_49011 = redout_tmp_51490;\n            }\n            x_47094 = redout_49009;\n            x_47095 = redout_49010;\n            x_47096 = redout_49011;\n            acc_47091 = x_47094;\n            acc_47092 = x_47095;\n            acc_47093 = x_47096;\n        } else {\n            acc_47091 = acc_47087;\n            acc_47092 = acc_47088;\n            acc_47093 = acc_47089;\n        }\n        mem_49712[(int64_t) 0] = acc_47091;\n        mem_49716[(int64_t) 0] = acc_47092;\n        mem_49720[(int64_t) 0] = acc_47093;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        for (int32_t i_6 = 0; i_6 < 1; i_6++)\n            mem_param_tmp_51482[i_6] = mem_49712[i_6];\n        for (int32_t i_7 = 0; i_7 < 1; i_7",
                                    "++)\n            mem_param_tmp_51483[i_7] = mem_49716[i_7];\n        for (int32_t i_8 = 0; i_8 < 1; i_8++)\n            mem_param_tmp_51484[i_8] = mem_49720[i_8];\n        for (int32_t i_9 = 0; i_9 < 1; i_9++)\n            mem_param_49700[i_9] = mem_param_tmp_51482[i_9];\n        for (int32_t i_10 = 0; i_10 < 1; i_10++)\n            mem_param_49701[i_10] = mem_param_tmp_51483[i_10];\n        for (int32_t i_11 = 0; i_11 < 1; i_11++)\n            mem_param_49702[i_11] = mem_param_tmp_51484[i_11];\n    }\n    for (int32_t i_12 = 0; i_12 < 1; i_12++)\n        ext_mem_49723[i_12] = mem_param_49700[i_12];\n    for (int32_t i_13 = 0; i_13 < 1; i_13++)\n        ext_mem_49722[i_13] = mem_param_49701[i_13];\n    for (int32_t i_14 = 0; i_14 < 1; i_14++)\n        ext_mem_49721[i_14] = mem_param_49702[i_14];\n    barrier(CLK_LOCAL_MEM_FENCE);\n    if (cond_47153) {\n        for (int32_t i_15 = 0; i_15 < 1; i_15++)\n            ext_mem_49734[i_15] = ext_mem_49723[i_15];\n    } else {\n        int64_t ltid_flat_47155;\n        int64_t ltid_47154;\n        int64_t j_47170;\n        bool cond_47175;\n        int64_t pre1d_47176;\n        int64_t pre1d_47177;\n        int64_t pre1d_47178;\n        int64_t ltid_flat_47192;\n        int64_t ltid_47191;\n        int64_t gtid_47205;\n        int64_t acc_47208;\n        bool cond_47211;\n        int64_t acc_47212;\n        \n        ltid_flat_47155 = sext_i32_i64(local_tid_51473);\n        ltid_47154 = sext_i32_i64(sext_i64_i32(ltid_pre_51477));\n        j_47170 = ltid_47154 + binop_x_47169;\n        cond_47175 = slt64(j_47170, m_41740);\n        if (cond_47175) {\n            pre1d_47176 = j_47170;\n        } else {\n            pre1d_47176 = (int64_t) 0;\n        }\n        if (cond_47175) {\n            int64_t tile_elem_47180;\n            int64_t tile_elem_47181;\n            \n            tile_elem_47180 = ((__global int64_t *) mem_49615)[j_47170];\n            tile_elem_47181 = ((__global int64_t *) mem_49510)[j_47170];\n            pre1d_47177 = tile_elem_47180;\n            pre1d_", "47178 = tile_elem_47181;\n        } else {\n            pre1d_47177 = (int64_t) 0;\n            pre1d_47178 = (int64_t) 0;\n        }\n        ((__local int64_t *) color_50177)[ltid_47154] = pre1d_47176;\n        ((__local int64_t *) color_50176)[ltid_47154] = pre1d_47177;\n        ((__local int64_t *) color_50175)[ltid_47154] = pre1d_47178;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        ltid_flat_47192 = sext_i32_i64(local_tid_51473);\n        ltid_47191 = sext_i32_i64(sext_i64_i32(ltid_pre_51477));\n        gtid_47205 = binop_x_46927 + ltid_47191;\n        acc_47208 = ext_mem_49723[(int64_t) 0];\n        cond_47211 = slt64(gtid_47205, m_41740);\n        if (cond_47211) {\n            int64_t lifted_lambda_res_47206;\n            int64_t lifted_lambda_res_47207;\n            int64_t acc_47209;\n            int64_t acc_47210;\n            int64_t x_47215;\n            int64_t x_47216;\n            int64_t x_47217;\n            int64_t redout_49013;\n            int64_t redout_49014;\n            int64_t redout_49015;\n            \n            lifted_lambda_res_47206 = mem_49683[(int64_t) 0];\n            lifted_lambda_res_47207 = mem_49687[(int64_t) 0];\n            acc_47209 = ext_mem_49722[(int64_t) 0];\n            acc_47210 = ext_mem_49721[(int64_t) 0];\n            redout_49013 = acc_47208;\n            redout_49014 = acc_47209;\n            redout_49015 = acc_47210;\n            for (int64_t i_49016 = 0; i_49016 < residual_input_47152; i_49016++) {\n                int64_t x_47218;\n                int64_t x_47219;\n                int64_t x_47220;\n                bool cond_47227;\n                bool cond_47228;\n                bool cond_f_res_47229;\n                bool cond_f_res_47230;\n                bool y_47231;\n                bool cond_47232;\n                bool cond_47233;\n                bool cond_t_res_47234;\n                bool x_47235;\n                bool cond_f_res_t_res_47236;\n                bool x_47237;\n                bool x_47238;\n                bool y_47239;\n         ", "       bool cond_47240;\n                int64_t lifted_lambda_res_47241;\n                int64_t lifted_lambda_res_47242;\n                int64_t lifted_lambda_res_47243;\n                int64_t redout_tmp_51491;\n                int64_t redout_tmp_51492;\n                int64_t redout_tmp_51493;\n                \n                x_47218 = ((__local int64_t *) color_50177)[i_49016];\n                x_47219 = ((__local int64_t *) color_50176)[i_49016];\n                x_47220 = ((__local int64_t *) color_50175)[i_49016];\n                cond_47227 = redout_49014 == lifted_lambda_res_47206;\n                cond_47228 = !cond_47227;\n                cond_f_res_47229 = redout_49015 == lifted_lambda_res_47207;\n                cond_f_res_47230 = !cond_f_res_47229;\n                y_47231 = cond_47227 && cond_f_res_47230;\n                cond_47232 = cond_47228 || y_47231;\n                cond_47233 = slt64(x_47218, redout_49013);\n                cond_t_res_47234 = x_47219 == lifted_lambda_res_47206;\n                x_47235 = cond_47233 && cond_t_res_47234;\n                cond_f_res_t_res_47236 = x_47220 == lifted_lambda_res_47207;\n                x_47237 = x_47235 && cond_f_res_t_res_47236;\n                x_47238 = !cond_47232;\n                y_47239 = x_47237 && x_47238;\n                cond_47240 = cond_47232 || y_47239;\n                if (cond_47240) {\n                    lifted_lambda_res_47241 = x_47218;\n                } else {\n                    lifted_lambda_res_47241 = redout_49013;\n                }\n                if (cond_47240) {\n                    lifted_lambda_res_47242 = x_47219;\n                } else {\n                    lifted_lambda_res_47242 = redout_49014;\n                }\n                if (cond_47240) {\n                    lifted_lambda_res_47243 = x_47220;\n                } else {\n                    lifted_lambda_res_47243 = redout_49015;\n                }\n                redout_tmp_51491 = lifted_lambda_res_47241;\n                redout_tm",
                                    "p_51492 = lifted_lambda_res_47242;\n                redout_tmp_51493 = lifted_lambda_res_47243;\n                redout_49013 = redout_tmp_51491;\n                redout_49014 = redout_tmp_51492;\n                redout_49015 = redout_tmp_51493;\n            }\n            x_47215 = redout_49013;\n            x_47216 = redout_49014;\n            x_47217 = redout_49015;\n            acc_47212 = x_47215;\n        } else {\n            acc_47212 = acc_47208;\n        }\n        mem_49733[(int64_t) 0] = acc_47212;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        for (int32_t i_16 = 0; i_16 < 1; i_16++)\n            ext_mem_49734[i_16] = mem_49733[i_16];\n    }\n    ltid_flat_47251 = sext_i32_i64(local_tid_51473);\n    ltid_47250 = sext_i32_i64(sext_i64_i32(ltid_pre_51477));\n    gtid_47257 = binop_x_46927 + ltid_47250;\n    cond_47261 = slt64(gtid_47257, m_41740);\n    if (cond_47261) {\n        int64_t defunc_0_f_res_47258;\n        bool lifted_lambda_res_47265;\n        int64_t defunc_0_f_res_47266;\n        \n        defunc_0_f_res_47258 = ext_mem_49734[(int64_t) 0];\n        lifted_lambda_res_47265 = defunc_0_f_res_47258 == gtid_47257;\n        defunc_0_f_res_47266 = btoi_bool_i64(lifted_lambda_res_47265);\n        postlude_47262 = defunc_0_f_res_47266;\n    } else {\n        postlude_47262 = (int64_t) 0;\n    }\n    mem_49738[(int64_t) 0] = postlude_47262;\n    barrier(CLK_LOCAL_MEM_FENCE);\n    if (slt64(sext_i32_i64(local_tid_51473) + tile_sizze_46917 * sext_i32_i64(block_id_51474), m_41740)) {\n        int64_t tmp_51494 = mem_49738[(int64_t) 0];\n        \n        ((__global int64_t *) mem_49740)[sext_i32_i64(local_tid_51473) + tile_sizze_46917 * sext_i32_i64(block_id_51474)] = tmp_51494;\n    }\n    \n  error_9:\n    return;\n    #undef tile_sizze_46917\n    #undef bytes_49703\n}\nFUTHARK_KERNEL_SIZED(do_DBSCAN_doublezisegmap_intrablock_47270_dim1, 1, 1)\nvoid do_DBSCAN_doublezisegmap_intrablock_47270(__global int *global_failure, int64_t m_41740, int64_t ldim_47273, int64_t num_whole_tiles_47293, int64_t res", "idual_input_47507, unsigned char cond_47508_bits, int64_t binop_x_47524, __global unsigned char *mem_49510, __global unsigned char *mem_49615, __global unsigned char *mem_49678)\n{\n    bool cond_47508 = cond_47508_bits;\n    \n    #define tile_sizze_47272 (do_DBSCAN_doublezisegmap_intrablock_47270zitile_sizze_47272)\n    #define bytes_49641 (do_DBSCAN_doublezisegmap_intrablock_47270zibytes_49641)\n    \n    volatile __local unsigned char *color_50180_backing_2 = &shared_mem[0];\n    const int64_t color_50180_backing_2_offset = 0 + (bytes_49641 + srem64((int64_t) 8 - srem64(bytes_49641, (int64_t) 8), (int64_t) 8));\n    volatile __local unsigned char *color_50179_backing_1 = &shared_mem[color_50180_backing_2_offset];\n    const int64_t color_50179_backing_1_offset = color_50180_backing_2_offset + (bytes_49641 + srem64((int64_t) 8 - srem64(bytes_49641, (int64_t) 8), (int64_t) 8));\n    volatile __local unsigned char *color_50178_backing_0 = &shared_mem[color_50179_backing_1_offset];\n    const int64_t color_50178_backing_0_offset = color_50179_backing_1_offset + (bytes_49641 + srem64((int64_t) 8 - srem64(bytes_49641, (int64_t) 8), (int64_t) 8));\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_51498;\n    int32_t tblock_sizze_51501;\n    int32_t wave_sizze_51500;\n    int32_t block_id_51499;\n    int32_t global_tid_51497;\n    int64_t gid_flat_47270;\n    int64_t slice_51503;\n    int64_t ltid_pre_51502;\n    int64_t remnant_51504;\n    int64_t slice_51505;\n    int64_t gid_47269;\n    int64_t remnant_51506;\n    __local unsigned char *color_50178;\n    __local unsigned char *color_50179;\n    __local unsigned char *color_50180;\n    int64_t binop_x_47282;\n    int64_t mem_49621[1];\n    int64_t mem_49625[1];\n    int64_t ltid_flat_47275;\n    int64_t ltid_47274;\n    int64_t gtid_47283;\n    bool cond_47284;\n    int64_t pre_47285;\n    int64_t pre_47286;\n    int64_t mem_49629[1];\n    int64_t mem_49633[1];\n    int64_t mem_49637[1];\n    int64_t ltid_flat_47295;\n    int64_t", " ltid_47294;\n    int64_t gtid_47305;\n    bool cond_47306;\n    int64_t neutral_47307;\n    int64_t neutral_47308;\n    int64_t neutral_47309;\n    int64_t ext_mem_49661[1];\n    int64_t ext_mem_49660[1];\n    int64_t ext_mem_49659[1];\n    int64_t mem_param_49638[1];\n    int64_t mem_param_49639[1];\n    int64_t mem_param_49640[1];\n    int64_t mem_49671[1];\n    int64_t ext_mem_49672[1];\n    int64_t mem_49676[1];\n    int64_t ltid_flat_47606;\n    int64_t ltid_47605;\n    int64_t gtid_47612;\n    bool cond_47616;\n    int64_t postlude_47617;\n    \n    local_tid_51498 = get_local_id(0);\n    tblock_sizze_51501 = get_local_size(0);\n    wave_sizze_51500 = LOCKSTEP_WIDTH;\n    block_id_51499 = get_tblock_id(0);\n    global_tid_51497 = block_id_51499 * tblock_sizze_51501 + local_tid_51498;\n    gid_flat_47270 = sext_i32_i64(block_id_51499);\n    slice_51503 = tile_sizze_47272;\n    ltid_pre_51502 = sext_i32_i64(local_tid_51498);\n    remnant_51504 = sext_i32_i64(local_tid_51498) - ltid_pre_51502;\n    slice_51505 = ldim_47273;\n    gid_47269 = sext_i32_i64(block_id_51499);\n    remnant_51506 = sext_i32_i64(block_id_51499) - gid_47269;\n    color_50178 = (__local unsigned char *) color_50178_backing_0;\n    color_50179 = (__local unsigned char *) color_50179_backing_1;\n    color_50180 = (__local unsigned char *) color_50180_backing_2;\n    binop_x_47282 = gid_47269 * tile_sizze_47272;\n    ltid_flat_47275 = sext_i32_i64(local_tid_51498);\n    ltid_47274 = sext_i32_i64(sext_i64_i32(ltid_pre_51502));\n    gtid_47283 = ltid_47274 + binop_x_47282;\n    cond_47284 = slt64(gtid_47283, m_41740);\n    if (cond_47284) {\n        int64_t lifted_lambda_res_47287;\n        int64_t lifted_lambda_res_47288;\n        \n        lifted_lambda_res_47287 = ((__global int64_t *) mem_49615)[gtid_47283];\n        lifted_lambda_res_47288 = ((__global int64_t *) mem_49510)[gtid_47283];\n        pre_47285 = lifted_lambda_res_47287;\n        pre_47286 = lifted_lambda_res_47288;\n    } else {\n        pre_47285 = (int64_t) 0;\n        pre_47",
                                    "286 = (int64_t) 0;\n    }\n    mem_49621[(int64_t) 0] = pre_47285;\n    mem_49625[(int64_t) 0] = pre_47286;\n    barrier(CLK_LOCAL_MEM_FENCE);\n    ltid_flat_47295 = sext_i32_i64(local_tid_51498);\n    ltid_47294 = sext_i32_i64(sext_i64_i32(ltid_pre_51502));\n    gtid_47305 = binop_x_47282 + ltid_47294;\n    cond_47306 = slt64(gtid_47305, m_41740);\n    if (cond_47306) {\n        neutral_47307 = gtid_47305;\n    } else {\n        neutral_47307 = (int64_t) 0;\n    }\n    if (cond_47306) {\n        int64_t lifted_lambda_res_47310;\n        int64_t lifted_lambda_res_47311;\n        \n        lifted_lambda_res_47310 = mem_49621[(int64_t) 0];\n        lifted_lambda_res_47311 = mem_49625[(int64_t) 0];\n        neutral_47308 = lifted_lambda_res_47310;\n        neutral_47309 = lifted_lambda_res_47311;\n    } else {\n        neutral_47308 = (int64_t) 0;\n        neutral_47309 = (int64_t) 0;\n    }\n    mem_49629[(int64_t) 0] = neutral_47307;\n    mem_49633[(int64_t) 0] = neutral_47308;\n    mem_49637[(int64_t) 0] = neutral_47309;\n    barrier(CLK_LOCAL_MEM_FENCE);\n    barrier(CLK_LOCAL_MEM_FENCE);\n    for (int32_t i_3 = 0; i_3 < 1; i_3++)\n        mem_param_49638[i_3] = mem_49629[i_3];\n    for (int32_t i_4 = 0; i_4 < 1; i_4++)\n        mem_param_49639[i_4] = mem_49633[i_4];\n    for (int32_t i_5 = 0; i_5 < 1; i_5++)\n        mem_param_49640[i_5] = mem_49637[i_5];\n    for (int64_t tile_id_47321 = 0; tile_id_47321 < num_whole_tiles_47293; tile_id_47321++) {\n        int64_t binop_x_47417;\n        int64_t ltid_flat_47416;\n        int64_t ltid_47415;\n        int64_t j_47418;\n        bool cond_47423;\n        int64_t pre1d_47424;\n        int64_t pre1d_47425;\n        int64_t pre1d_47426;\n        int64_t mem_49650[1];\n        int64_t mem_49654[1];\n        int64_t mem_49658[1];\n        int64_t ltid_flat_47437;\n        int64_t ltid_47436;\n        int64_t gtid_47439;\n        int64_t acc_47442;\n        int64_t acc_47443;\n        int64_t acc_47444;\n        bool cond_47445;\n        int64_t acc_47446;\n        int64_t acc_4", "7447;\n        int64_t acc_47448;\n        int64_t mem_param_tmp_51507[1];\n        int64_t mem_param_tmp_51508[1];\n        int64_t mem_param_tmp_51509[1];\n        \n        binop_x_47417 = tile_sizze_47272 * tile_id_47321;\n        ltid_flat_47416 = sext_i32_i64(local_tid_51498);\n        ltid_47415 = sext_i32_i64(sext_i64_i32(ltid_pre_51502));\n        j_47418 = ltid_47415 + binop_x_47417;\n        cond_47423 = slt64(j_47418, m_41740);\n        if (cond_47423) {\n            pre1d_47424 = j_47418;\n        } else {\n            pre1d_47424 = (int64_t) 0;\n        }\n        if (cond_47423) {\n            int64_t tile_elem_47428;\n            int64_t tile_elem_47429;\n            \n            tile_elem_47428 = ((__global int64_t *) mem_49615)[j_47418];\n            tile_elem_47429 = ((__global int64_t *) mem_49510)[j_47418];\n            pre1d_47425 = tile_elem_47428;\n            pre1d_47426 = tile_elem_47429;\n        } else {\n            pre1d_47425 = (int64_t) 0;\n            pre1d_47426 = (int64_t) 0;\n        }\n        ((__local int64_t *) color_50180)[ltid_47415] = pre1d_47424;\n        ((__local int64_t *) color_50179)[ltid_47415] = pre1d_47425;\n        ((__local int64_t *) color_50178)[ltid_47415] = pre1d_47426;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        ltid_flat_47437 = sext_i32_i64(local_tid_51498);\n        ltid_47436 = sext_i32_i64(sext_i64_i32(ltid_pre_51502));\n        gtid_47439 = binop_x_47282 + ltid_47436;\n        acc_47442 = mem_param_49638[(int64_t) 0];\n        acc_47443 = mem_param_49639[(int64_t) 0];\n        acc_47444 = mem_param_49640[(int64_t) 0];\n        cond_47445 = slt64(gtid_47439, m_41740);\n        if (cond_47445) {\n            int64_t lifted_lambda_res_47440;\n            int64_t lifted_lambda_res_47441;\n            int64_t x_47449;\n            int64_t x_47450;\n            int64_t x_47451;\n            int64_t redout_49017;\n            int64_t redout_49018;\n            int64_t redout_49019;\n            \n            lifted_lambda_res_47440 = mem_49621[(int64_t", ") 0];\n            lifted_lambda_res_47441 = mem_49625[(int64_t) 0];\n            redout_49017 = acc_47442;\n            redout_49018 = acc_47443;\n            redout_49019 = acc_47444;\n            for (int64_t i_49020 = 0; i_49020 < tile_sizze_47272; i_49020++) {\n                int64_t x_47452;\n                int64_t x_47453;\n                int64_t x_47454;\n                bool cond_47461;\n                bool cond_47462;\n                bool cond_f_res_47463;\n                bool cond_f_res_47464;\n                bool y_47465;\n                bool cond_47466;\n                bool cond_47467;\n                bool cond_t_res_47468;\n                bool x_47469;\n                bool cond_f_res_t_res_47470;\n                bool x_47471;\n                bool x_47472;\n                bool y_47473;\n                bool cond_47474;\n                int64_t lifted_lambda_res_47475;\n                int64_t lifted_lambda_res_47476;\n                int64_t lifted_lambda_res_47477;\n                int64_t redout_tmp_51513;\n                int64_t redout_tmp_51514;\n                int64_t redout_tmp_51515;\n                \n                x_47452 = ((__local int64_t *) color_50180)[i_49020];\n                x_47453 = ((__local int64_t *) color_50179)[i_49020];\n                x_47454 = ((__local int64_t *) color_50178)[i_49020];\n                cond_47461 = redout_49018 == lifted_lambda_res_47440;\n                cond_47462 = !cond_47461;\n                cond_f_res_47463 = redout_49019 == lifted_lambda_res_47441;\n                cond_f_res_47464 = !cond_f_res_47463;\n                y_47465 = cond_47461 && cond_f_res_47464;\n                cond_47466 = cond_47462 || y_47465;\n                cond_47467 = slt64(x_47452, redout_49017);\n                cond_t_res_47468 = x_47453 == lifted_lambda_res_47440;\n                x_47469 = cond_47467 && cond_t_res_47468;\n                cond_f_res_t_res_47470 = x_47454 == lifted_lambda_res_47441;\n                x_47471 = x_47469 && cond_f_re",
                                    "s_t_res_47470;\n                x_47472 = !cond_47466;\n                y_47473 = x_47471 && x_47472;\n                cond_47474 = cond_47466 || y_47473;\n                if (cond_47474) {\n                    lifted_lambda_res_47475 = x_47452;\n                } else {\n                    lifted_lambda_res_47475 = redout_49017;\n                }\n                if (cond_47474) {\n                    lifted_lambda_res_47476 = x_47453;\n                } else {\n                    lifted_lambda_res_47476 = redout_49018;\n                }\n                if (cond_47474) {\n                    lifted_lambda_res_47477 = x_47454;\n                } else {\n                    lifted_lambda_res_47477 = redout_49019;\n                }\n                redout_tmp_51513 = lifted_lambda_res_47475;\n                redout_tmp_51514 = lifted_lambda_res_47476;\n                redout_tmp_51515 = lifted_lambda_res_47477;\n                redout_49017 = redout_tmp_51513;\n                redout_49018 = redout_tmp_51514;\n                redout_49019 = redout_tmp_51515;\n            }\n            x_47449 = redout_49017;\n            x_47450 = redout_49018;\n            x_47451 = redout_49019;\n            acc_47446 = x_47449;\n            acc_47447 = x_47450;\n            acc_47448 = x_47451;\n        } else {\n            acc_47446 = acc_47442;\n            acc_47447 = acc_47443;\n            acc_47448 = acc_47444;\n        }\n        mem_49650[(int64_t) 0] = acc_47446;\n        mem_49654[(int64_t) 0] = acc_47447;\n        mem_49658[(int64_t) 0] = acc_47448;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        for (int32_t i_6 = 0; i_6 < 1; i_6++)\n            mem_param_tmp_51507[i_6] = mem_49650[i_6];\n        for (int32_t i_7 = 0; i_7 < 1; i_7++)\n            mem_param_tmp_51508[i_7] = mem_49654[i_7];\n        for (int32_t i_8 = 0; i_8 < 1; i_8++)\n            mem_param_tmp_51509[i_8] = mem_49658[i_8];\n        for (int32_t i_9 = 0; i_9 < 1; i_9++)\n            mem_param_49638[i_9] = mem_param_tmp_51507[i_9];\n        for ", "(int32_t i_10 = 0; i_10 < 1; i_10++)\n            mem_param_49639[i_10] = mem_param_tmp_51508[i_10];\n        for (int32_t i_11 = 0; i_11 < 1; i_11++)\n            mem_param_49640[i_11] = mem_param_tmp_51509[i_11];\n    }\n    for (int32_t i_12 = 0; i_12 < 1; i_12++)\n        ext_mem_49661[i_12] = mem_param_49638[i_12];\n    for (int32_t i_13 = 0; i_13 < 1; i_13++)\n        ext_mem_49660[i_13] = mem_param_49639[i_13];\n    for (int32_t i_14 = 0; i_14 < 1; i_14++)\n        ext_mem_49659[i_14] = mem_param_49640[i_14];\n    barrier(CLK_LOCAL_MEM_FENCE);\n    if (cond_47508) {\n        for (int32_t i_15 = 0; i_15 < 1; i_15++)\n            ext_mem_49672[i_15] = ext_mem_49661[i_15];\n    } else {\n        int64_t ltid_flat_47510;\n        int64_t ltid_47509;\n        int64_t j_47525;\n        bool cond_47530;\n        int64_t pre1d_47531;\n        int64_t pre1d_47532;\n        int64_t pre1d_47533;\n        int64_t ltid_flat_47547;\n        int64_t ltid_47546;\n        int64_t gtid_47560;\n        int64_t acc_47563;\n        bool cond_47566;\n        int64_t acc_47567;\n        \n        ltid_flat_47510 = sext_i32_i64(local_tid_51498);\n        ltid_47509 = sext_i32_i64(sext_i64_i32(ltid_pre_51502));\n        j_47525 = ltid_47509 + binop_x_47524;\n        cond_47530 = slt64(j_47525, m_41740);\n        if (cond_47530) {\n            pre1d_47531 = j_47525;\n        } else {\n            pre1d_47531 = (int64_t) 0;\n        }\n        if (cond_47530) {\n            int64_t tile_elem_47535;\n            int64_t tile_elem_47536;\n            \n            tile_elem_47535 = ((__global int64_t *) mem_49615)[j_47525];\n            tile_elem_47536 = ((__global int64_t *) mem_49510)[j_47525];\n            pre1d_47532 = tile_elem_47535;\n            pre1d_47533 = tile_elem_47536;\n        } else {\n            pre1d_47532 = (int64_t) 0;\n            pre1d_47533 = (int64_t) 0;\n        }\n        ((__local int64_t *) color_50180)[ltid_47509] = pre1d_47531;\n        ((__local int64_t *) color_50179)[ltid_47509] = pre1d_47532;\n        ((_", "_local int64_t *) color_50178)[ltid_47509] = pre1d_47533;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        ltid_flat_47547 = sext_i32_i64(local_tid_51498);\n        ltid_47546 = sext_i32_i64(sext_i64_i32(ltid_pre_51502));\n        gtid_47560 = binop_x_47282 + ltid_47546;\n        acc_47563 = ext_mem_49661[(int64_t) 0];\n        cond_47566 = slt64(gtid_47560, m_41740);\n        if (cond_47566) {\n            int64_t lifted_lambda_res_47561;\n            int64_t lifted_lambda_res_47562;\n            int64_t acc_47564;\n            int64_t acc_47565;\n            int64_t x_47570;\n            int64_t x_47571;\n            int64_t x_47572;\n            int64_t redout_49021;\n            int64_t redout_49022;\n            int64_t redout_49023;\n            \n            lifted_lambda_res_47561 = mem_49621[(int64_t) 0];\n            lifted_lambda_res_47562 = mem_49625[(int64_t) 0];\n            acc_47564 = ext_mem_49660[(int64_t) 0];\n            acc_47565 = ext_mem_49659[(int64_t) 0];\n            redout_49021 = acc_47563;\n            redout_49022 = acc_47564;\n            redout_49023 = acc_47565;\n            for (int64_t i_49024 = 0; i_49024 < residual_input_47507; i_49024++) {\n                int64_t x_47573;\n                int64_t x_47574;\n                int64_t x_47575;\n                bool cond_47582;\n                bool cond_47583;\n                bool cond_f_res_47584;\n                bool cond_f_res_47585;\n                bool y_47586;\n                bool cond_47587;\n                bool cond_47588;\n                bool cond_t_res_47589;\n                bool x_47590;\n                bool cond_f_res_t_res_47591;\n                bool x_47592;\n                bool x_47593;\n                bool y_47594;\n                bool cond_47595;\n                int64_t lifted_lambda_res_47596;\n                int64_t lifted_lambda_res_47597;\n                int64_t lifted_lambda_res_47598;\n                int64_t redout_tmp_51516;\n                int64_t redout_tmp_51517;\n                int64_t ",
                                    "redout_tmp_51518;\n                \n                x_47573 = ((__local int64_t *) color_50180)[i_49024];\n                x_47574 = ((__local int64_t *) color_50179)[i_49024];\n                x_47575 = ((__local int64_t *) color_50178)[i_49024];\n                cond_47582 = redout_49022 == lifted_lambda_res_47561;\n                cond_47583 = !cond_47582;\n                cond_f_res_47584 = redout_49023 == lifted_lambda_res_47562;\n                cond_f_res_47585 = !cond_f_res_47584;\n                y_47586 = cond_47582 && cond_f_res_47585;\n                cond_47587 = cond_47583 || y_47586;\n                cond_47588 = slt64(x_47573, redout_49021);\n                cond_t_res_47589 = x_47574 == lifted_lambda_res_47561;\n                x_47590 = cond_47588 && cond_t_res_47589;\n                cond_f_res_t_res_47591 = x_47575 == lifted_lambda_res_47562;\n                x_47592 = x_47590 && cond_f_res_t_res_47591;\n                x_47593 = !cond_47587;\n                y_47594 = x_47592 && x_47593;\n                cond_47595 = cond_47587 || y_47594;\n                if (cond_47595) {\n                    lifted_lambda_res_47596 = x_47573;\n                } else {\n                    lifted_lambda_res_47596 = redout_49021;\n                }\n                if (cond_47595) {\n                    lifted_lambda_res_47597 = x_47574;\n                } else {\n                    lifted_lambda_res_47597 = redout_49022;\n                }\n                if (cond_47595) {\n                    lifted_lambda_res_47598 = x_47575;\n                } else {\n                    lifted_lambda_res_47598 = redout_49023;\n                }\n                redout_tmp_51516 = lifted_lambda_res_47596;\n                redout_tmp_51517 = lifted_lambda_res_47597;\n                redout_tmp_51518 = lifted_lambda_res_47598;\n                redout_49021 = redout_tmp_51516;\n                redout_49022 = redout_tmp_51517;\n                redout_49023 = redout_tmp_51518;\n            }\n            x_47570 = r", "edout_49021;\n            x_47571 = redout_49022;\n            x_47572 = redout_49023;\n            acc_47567 = x_47570;\n        } else {\n            acc_47567 = acc_47563;\n        }\n        mem_49671[(int64_t) 0] = acc_47567;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        for (int32_t i_16 = 0; i_16 < 1; i_16++)\n            ext_mem_49672[i_16] = mem_49671[i_16];\n    }\n    ltid_flat_47606 = sext_i32_i64(local_tid_51498);\n    ltid_47605 = sext_i32_i64(sext_i64_i32(ltid_pre_51502));\n    gtid_47612 = binop_x_47282 + ltid_47605;\n    cond_47616 = slt64(gtid_47612, m_41740);\n    if (cond_47616) {\n        int64_t defunc_0_f_res_47613;\n        bool lifted_lambda_res_47620;\n        int64_t defunc_0_f_res_47621;\n        \n        defunc_0_f_res_47613 = ext_mem_49672[(int64_t) 0];\n        lifted_lambda_res_47620 = defunc_0_f_res_47613 == gtid_47612;\n        defunc_0_f_res_47621 = btoi_bool_i64(lifted_lambda_res_47620);\n        postlude_47617 = defunc_0_f_res_47621;\n    } else {\n        postlude_47617 = (int64_t) 0;\n    }\n    mem_49676[(int64_t) 0] = postlude_47617;\n    barrier(CLK_LOCAL_MEM_FENCE);\n    if (slt64(sext_i32_i64(local_tid_51498) + tile_sizze_47272 * sext_i32_i64(block_id_51499), m_41740)) {\n        int64_t tmp_51519 = mem_49676[(int64_t) 0];\n        \n        ((__global int64_t *) mem_49678)[sext_i32_i64(local_tid_51498) + tile_sizze_47272 * sext_i32_i64(block_id_51499)] = tmp_51519;\n    }\n    \n  error_9:\n    return;\n    #undef tile_sizze_47272\n    #undef bytes_49641\n}\nFUTHARK_KERNEL_SIZED(do_DBSCAN_doublezisegmap_intrablock_47625_dim1, 1, 1)\nvoid do_DBSCAN_doublezisegmap_intrablock_47625(__global int *global_failure, int64_t conc_tmp_41556, int64_t m_41830, int64_t ldim_47628, int64_t num_whole_tiles_47642, int64_t residual_input_47801, unsigned char cond_47802_bits, int64_t binop_x_47815, __global unsigned char *mem_49613, __global unsigned char *mem_49755, __global unsigned char *mem_49757, __global unsigned char *mem_49838)\n{\n    bool cond_47802 = cond_47802_bits;\n ", "   \n    #define tile_sizze_47627 (do_DBSCAN_doublezisegmap_intrablock_47625zitile_sizze_47627)\n    #define bytes_49814 (do_DBSCAN_doublezisegmap_intrablock_47625zibytes_49814)\n    \n    volatile __local unsigned char *color_50182_backing_1 = &shared_mem[0];\n    const int64_t color_50182_backing_1_offset = 0 + (bytes_49814 + srem64((int64_t) 8 - srem64(bytes_49814, (int64_t) 8), (int64_t) 8));\n    volatile __local unsigned char *color_50181_backing_0 = &shared_mem[color_50182_backing_1_offset];\n    const int64_t color_50181_backing_0_offset = color_50182_backing_1_offset + (bytes_49814 + srem64((int64_t) 8 - srem64(bytes_49814, (int64_t) 8), (int64_t) 8));\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_51743;\n    int32_t tblock_sizze_51746;\n    int32_t wave_sizze_51745;\n    int32_t block_id_51744;\n    int32_t global_tid_51742;\n    int64_t gid_flat_47625;\n    int64_t slice_51748;\n    int64_t ltid_pre_51747;\n    int64_t remnant_51749;\n    int64_t slice_51750;\n    int64_t gid_47624;\n    int64_t remnant_51751;\n    __local unsigned char *color_50181;\n    __local unsigned char *color_50182;\n    int64_t binop_x_47635;\n    int64_t mem_49803[1];\n    int64_t ltid_flat_47630;\n    int64_t ltid_47629;\n    int64_t gtid_47636;\n    bool cond_47637;\n    int64_t pre_47638;\n    int64_t mem_49807[1];\n    int64_t mem_49811[1];\n    int64_t ltid_flat_47644;\n    int64_t ltid_47643;\n    int64_t gtid_47652;\n    bool cond_47653;\n    int64_t neutral_47654;\n    int64_t neutral_47655;\n    int64_t ext_mem_49827[1];\n    int64_t ext_mem_49826[1];\n    int64_t mem_param_49812[1];\n    int64_t mem_param_49813[1];\n    int64_t mem_49835[1];\n    int64_t ext_mem_49836[1];\n    \n    local_tid_51743 = get_local_id(0);\n    tblock_sizze_51746 = get_local_size(0);\n    wave_sizze_51745 = LOCKSTEP_WIDTH;\n    block_id_51744 = get_tblock_id(0);\n    global_tid_51742 = block_id_51744 * tblock_sizze_51746 + local_tid_51743;\n    gid_flat_47625 = sext_i32_i64(block_id_51744);\n    slice_51748 ",
                                    "= tile_sizze_47627;\n    ltid_pre_51747 = sext_i32_i64(local_tid_51743);\n    remnant_51749 = sext_i32_i64(local_tid_51743) - ltid_pre_51747;\n    slice_51750 = ldim_47628;\n    gid_47624 = sext_i32_i64(block_id_51744);\n    remnant_51751 = sext_i32_i64(block_id_51744) - gid_47624;\n    color_50181 = (__local unsigned char *) color_50181_backing_0;\n    color_50182 = (__local unsigned char *) color_50182_backing_1;\n    binop_x_47635 = gid_47624 * tile_sizze_47627;\n    ltid_flat_47630 = sext_i32_i64(local_tid_51743);\n    ltid_47629 = sext_i32_i64(sext_i64_i32(ltid_pre_51747));\n    gtid_47636 = ltid_47629 + binop_x_47635;\n    cond_47637 = slt64(gtid_47636, conc_tmp_41556);\n    if (cond_47637) {\n        int64_t eta_p_47639 = ((__global int64_t *) mem_49613)[gtid_47636];\n        \n        pre_47638 = eta_p_47639;\n    } else {\n        pre_47638 = (int64_t) 0;\n    }\n    mem_49803[(int64_t) 0] = pre_47638;\n    barrier(CLK_LOCAL_MEM_FENCE);\n    ltid_flat_47644 = sext_i32_i64(local_tid_51743);\n    ltid_47643 = sext_i32_i64(sext_i64_i32(ltid_pre_51747));\n    gtid_47652 = binop_x_47635 + ltid_47643;\n    cond_47653 = slt64(gtid_47652, conc_tmp_41556);\n    if (cond_47653) {\n        int64_t eta_p_47656 = mem_49803[(int64_t) 0];\n        \n        neutral_47654 = eta_p_47656;\n        neutral_47655 = eta_p_47656;\n    } else {\n        neutral_47654 = (int64_t) 0;\n        neutral_47655 = (int64_t) 0;\n    }\n    mem_49807[(int64_t) 0] = neutral_47654;\n    mem_49811[(int64_t) 0] = neutral_47655;\n    barrier(CLK_LOCAL_MEM_FENCE);\n    barrier(CLK_LOCAL_MEM_FENCE);\n    for (int32_t i_2 = 0; i_2 < 1; i_2++)\n        mem_param_49812[i_2] = mem_49807[i_2];\n    for (int32_t i_3 = 0; i_3 < 1; i_3++)\n        mem_param_49813[i_3] = mem_49811[i_3];\n    for (int64_t tile_id_47663 = 0; tile_id_47663 < num_whole_tiles_47642; tile_id_47663++) {\n        int64_t binop_x_47735;\n        int64_t ltid_flat_47734;\n        int64_t ltid_47733;\n        int64_t j_47736;\n        bool cond_47740;\n        int64_t pre1d_47741;", "\n        int64_t pre1d_47742;\n        int64_t mem_49821[1];\n        int64_t mem_49825[1];\n        int64_t ltid_flat_47750;\n        int64_t ltid_47749;\n        int64_t gtid_47752;\n        int64_t acc_47754;\n        int64_t acc_47755;\n        bool cond_47756;\n        int64_t acc_47757;\n        int64_t acc_47758;\n        int64_t mem_param_tmp_51752[1];\n        int64_t mem_param_tmp_51753[1];\n        \n        binop_x_47735 = tile_sizze_47627 * tile_id_47663;\n        ltid_flat_47734 = sext_i32_i64(local_tid_51743);\n        ltid_47733 = sext_i32_i64(sext_i64_i32(ltid_pre_51747));\n        j_47736 = ltid_47733 + binop_x_47735;\n        cond_47740 = slt64(j_47736, m_41830);\n        if (cond_47740) {\n            int64_t tile_elem_47743;\n            int64_t tile_elem_47744;\n            \n            tile_elem_47743 = ((__global int64_t *) mem_49757)[j_47736];\n            tile_elem_47744 = ((__global int64_t *) mem_49755)[j_47736];\n            pre1d_47741 = tile_elem_47743;\n            pre1d_47742 = tile_elem_47744;\n        } else {\n            pre1d_47741 = (int64_t) 0;\n            pre1d_47742 = (int64_t) 0;\n        }\n        ((__local int64_t *) color_50182)[ltid_47733] = pre1d_47741;\n        ((__local int64_t *) color_50181)[ltid_47733] = pre1d_47742;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        ltid_flat_47750 = sext_i32_i64(local_tid_51743);\n        ltid_47749 = sext_i32_i64(sext_i64_i32(ltid_pre_51747));\n        gtid_47752 = binop_x_47635 + ltid_47749;\n        acc_47754 = mem_param_49812[(int64_t) 0];\n        acc_47755 = mem_param_49813[(int64_t) 0];\n        cond_47756 = slt64(gtid_47752, conc_tmp_41556);\n        if (cond_47756) {\n            int64_t eta_p_47753;\n            int64_t x_47759;\n            int64_t x_47760;\n            int64_t redout_49025;\n            int64_t redout_49026;\n            \n            eta_p_47753 = mem_49803[(int64_t) 0];\n            redout_49025 = acc_47754;\n            redout_49026 = acc_47755;\n            for (int64_t i_49027 = 0; i_49027 < ti", "le_sizze_47627; i_49027++) {\n                int64_t x_47761;\n                int64_t x_47762;\n                bool cond_47767;\n                bool cond_47768;\n                bool cond_f_res_47769;\n                bool y_47770;\n                bool cond_47771;\n                bool cond_47772;\n                bool cond_f_res_t_res_47773;\n                bool x_47774;\n                bool x_47775;\n                bool y_47776;\n                bool cond_47777;\n                int64_t lifted_lambda_res_47778;\n                int64_t lifted_lambda_res_47779;\n                int64_t redout_tmp_51756;\n                int64_t redout_tmp_51757;\n                \n                x_47761 = ((__local int64_t *) color_50182)[i_49027];\n                x_47762 = ((__local int64_t *) color_50181)[i_49027];\n                cond_47767 = redout_49025 == eta_p_47753;\n                cond_47768 = !cond_47767;\n                cond_f_res_47769 = slt64(redout_49026, (int64_t) 0);\n                y_47770 = cond_47767 && cond_f_res_47769;\n                cond_47771 = cond_47768 || y_47770;\n                cond_47772 = slt64(x_47762, redout_49026);\n                cond_f_res_t_res_47773 = x_47761 == eta_p_47753;\n                x_47774 = cond_47772 && cond_f_res_t_res_47773;\n                x_47775 = !cond_47771;\n                y_47776 = x_47774 && x_47775;\n                cond_47777 = cond_47771 || y_47776;\n                if (cond_47777) {\n                    lifted_lambda_res_47778 = x_47761;\n                } else {\n                    lifted_lambda_res_47778 = redout_49025;\n                }\n                if (cond_47777) {\n                    lifted_lambda_res_47779 = x_47762;\n                } else {\n                    lifted_lambda_res_47779 = redout_49026;\n                }\n                redout_tmp_51756 = lifted_lambda_res_47778;\n                redout_tmp_51757 = lifted_lambda_res_47779;\n                redout_49025 = redout_tmp_51756;\n                redout_49026 = redout_tm",
                                    "p_51757;\n            }\n            x_47759 = redout_49025;\n            x_47760 = redout_49026;\n            acc_47757 = x_47759;\n            acc_47758 = x_47760;\n        } else {\n            acc_47757 = acc_47754;\n            acc_47758 = acc_47755;\n        }\n        mem_49821[(int64_t) 0] = acc_47757;\n        mem_49825[(int64_t) 0] = acc_47758;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        for (int32_t i_4 = 0; i_4 < 1; i_4++)\n            mem_param_tmp_51752[i_4] = mem_49821[i_4];\n        for (int32_t i_5 = 0; i_5 < 1; i_5++)\n            mem_param_tmp_51753[i_5] = mem_49825[i_5];\n        for (int32_t i_6 = 0; i_6 < 1; i_6++)\n            mem_param_49812[i_6] = mem_param_tmp_51752[i_6];\n        for (int32_t i_7 = 0; i_7 < 1; i_7++)\n            mem_param_49813[i_7] = mem_param_tmp_51753[i_7];\n    }\n    for (int32_t i_8 = 0; i_8 < 1; i_8++)\n        ext_mem_49827[i_8] = mem_param_49812[i_8];\n    for (int32_t i_9 = 0; i_9 < 1; i_9++)\n        ext_mem_49826[i_9] = mem_param_49813[i_9];\n    barrier(CLK_LOCAL_MEM_FENCE);\n    if (cond_47802) {\n        for (int32_t i_10 = 0; i_10 < 1; i_10++)\n            ext_mem_49836[i_10] = ext_mem_49827[i_10];\n    } else {\n        int64_t ltid_flat_47804;\n        int64_t ltid_47803;\n        int64_t j_47816;\n        bool cond_47820;\n        int64_t pre1d_47821;\n        int64_t pre1d_47822;\n        int64_t ltid_flat_47832;\n        int64_t ltid_47831;\n        int64_t gtid_47842;\n        int64_t acc_47844;\n        bool cond_47846;\n        int64_t acc_47847;\n        \n        ltid_flat_47804 = sext_i32_i64(local_tid_51743);\n        ltid_47803 = sext_i32_i64(sext_i64_i32(ltid_pre_51747));\n        j_47816 = ltid_47803 + binop_x_47815;\n        cond_47820 = slt64(j_47816, m_41830);\n        if (cond_47820) {\n            int64_t tile_elem_47823;\n            int64_t tile_elem_47824;\n            \n            tile_elem_47823 = ((__global int64_t *) mem_49757)[j_47816];\n            tile_elem_47824 = ((__global int64_t *) mem_49755)[j_47816];\n            pre1", "d_47821 = tile_elem_47823;\n            pre1d_47822 = tile_elem_47824;\n        } else {\n            pre1d_47821 = (int64_t) 0;\n            pre1d_47822 = (int64_t) 0;\n        }\n        ((__local int64_t *) color_50182)[ltid_47803] = pre1d_47821;\n        ((__local int64_t *) color_50181)[ltid_47803] = pre1d_47822;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        ltid_flat_47832 = sext_i32_i64(local_tid_51743);\n        ltid_47831 = sext_i32_i64(sext_i64_i32(ltid_pre_51747));\n        gtid_47842 = binop_x_47635 + ltid_47831;\n        acc_47844 = ext_mem_49827[(int64_t) 0];\n        cond_47846 = slt64(gtid_47842, conc_tmp_41556);\n        if (cond_47846) {\n            int64_t eta_p_47843;\n            int64_t acc_47845;\n            int64_t x_47849;\n            int64_t x_47850;\n            int64_t redout_49028;\n            int64_t redout_49029;\n            \n            eta_p_47843 = mem_49803[(int64_t) 0];\n            acc_47845 = ext_mem_49826[(int64_t) 0];\n            redout_49028 = acc_47844;\n            redout_49029 = acc_47845;\n            for (int64_t i_49030 = 0; i_49030 < residual_input_47801; i_49030++) {\n                int64_t x_47851;\n                int64_t x_47852;\n                bool cond_47857;\n                bool cond_47858;\n                bool cond_f_res_47859;\n                bool y_47860;\n                bool cond_47861;\n                bool cond_47862;\n                bool cond_f_res_t_res_47863;\n                bool x_47864;\n                bool x_47865;\n                bool y_47866;\n                bool cond_47867;\n                int64_t lifted_lambda_res_47868;\n                int64_t lifted_lambda_res_47869;\n                int64_t redout_tmp_51758;\n                int64_t redout_tmp_51759;\n                \n                x_47851 = ((__local int64_t *) color_50182)[i_49030];\n                x_47852 = ((__local int64_t *) color_50181)[i_49030];\n                cond_47857 = redout_49028 == eta_p_47843;\n                cond_47858 = !cond_47857;\n          ", "      cond_f_res_47859 = slt64(redout_49029, (int64_t) 0);\n                y_47860 = cond_47857 && cond_f_res_47859;\n                cond_47861 = cond_47858 || y_47860;\n                cond_47862 = slt64(x_47852, redout_49029);\n                cond_f_res_t_res_47863 = x_47851 == eta_p_47843;\n                x_47864 = cond_47862 && cond_f_res_t_res_47863;\n                x_47865 = !cond_47861;\n                y_47866 = x_47864 && x_47865;\n                cond_47867 = cond_47861 || y_47866;\n                if (cond_47867) {\n                    lifted_lambda_res_47868 = x_47851;\n                } else {\n                    lifted_lambda_res_47868 = redout_49028;\n                }\n                if (cond_47867) {\n                    lifted_lambda_res_47869 = x_47852;\n                } else {\n                    lifted_lambda_res_47869 = redout_49029;\n                }\n                redout_tmp_51758 = lifted_lambda_res_47868;\n                redout_tmp_51759 = lifted_lambda_res_47869;\n                redout_49028 = redout_tmp_51758;\n                redout_49029 = redout_tmp_51759;\n            }\n            x_47849 = redout_49028;\n            x_47850 = redout_49029;\n            acc_47847 = x_47849;\n        } else {\n            acc_47847 = acc_47844;\n        }\n        mem_49835[(int64_t) 0] = acc_47847;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        for (int32_t i_11 = 0; i_11 < 1; i_11++)\n            ext_mem_49836[i_11] = mem_49835[i_11];\n    }\n    if (slt64(sext_i32_i64(local_tid_51743) + tile_sizze_47627 * sext_i32_i64(block_id_51744), conc_tmp_41556)) {\n        int64_t tmp_51760 = ext_mem_49836[(int64_t) 0];\n        \n        ((__global int64_t *) mem_49838)[sext_i32_i64(local_tid_51743) + tile_sizze_47627 * sext_i32_i64(block_id_51744)] = tmp_51760;\n    }\n    \n  error_8:\n    return;\n    #undef tile_sizze_47627\n    #undef bytes_49814\n}\nFUTHARK_KERNEL_SIZED(do_DBSCAN_doublezisegmap_intrablock_47884_dim1, 1, 1)\nvoid do_DBSCAN_doublezisegmap_intrablock_47884(__global int",
                                    " *global_failure, int64_t conc_tmp_41556, int64_t m_41830, int64_t ldim_47887, int64_t num_whole_tiles_47901, int64_t residual_input_48060, unsigned char cond_48061_bits, int64_t binop_x_48074, __global unsigned char *mem_49613, __global unsigned char *mem_49755, __global unsigned char *mem_49757, __global unsigned char *mem_49798)\n{\n    bool cond_48061 = cond_48061_bits;\n    \n    #define tile_sizze_47886 (do_DBSCAN_doublezisegmap_intrablock_47884zitile_sizze_47886)\n    #define bytes_49774 (do_DBSCAN_doublezisegmap_intrablock_47884zibytes_49774)\n    \n    volatile __local unsigned char *color_50184_backing_1 = &shared_mem[0];\n    const int64_t color_50184_backing_1_offset = 0 + (bytes_49774 + srem64((int64_t) 8 - srem64(bytes_49774, (int64_t) 8), (int64_t) 8));\n    volatile __local unsigned char *color_50183_backing_0 = &shared_mem[color_50184_backing_1_offset];\n    const int64_t color_50183_backing_0_offset = color_50184_backing_1_offset + (bytes_49774 + srem64((int64_t) 8 - srem64(bytes_49774, (int64_t) 8), (int64_t) 8));\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_51764;\n    int32_t tblock_sizze_51767;\n    int32_t wave_sizze_51766;\n    int32_t block_id_51765;\n    int32_t global_tid_51763;\n    int64_t gid_flat_47884;\n    int64_t slice_51769;\n    int64_t ltid_pre_51768;\n    int64_t remnant_51770;\n    int64_t slice_51771;\n    int64_t gid_47883;\n    int64_t remnant_51772;\n    __local unsigned char *color_50183;\n    __local unsigned char *color_50184;\n    int64_t binop_x_47894;\n    int64_t mem_49763[1];\n    int64_t ltid_flat_47889;\n    int64_t ltid_47888;\n    int64_t gtid_47895;\n    bool cond_47896;\n    int64_t pre_47897;\n    int64_t mem_49767[1];\n    int64_t mem_49771[1];\n    int64_t ltid_flat_47903;\n    int64_t ltid_47902;\n    int64_t gtid_47911;\n    bool cond_47912;\n    int64_t neutral_47913;\n    int64_t neutral_47914;\n    int64_t ext_mem_49787[1];\n    int64_t ext_mem_49786[1];\n    int64_t mem_param_49772[1];\n    int64_t mem_param_4", "9773[1];\n    int64_t mem_49795[1];\n    int64_t ext_mem_49796[1];\n    \n    local_tid_51764 = get_local_id(0);\n    tblock_sizze_51767 = get_local_size(0);\n    wave_sizze_51766 = LOCKSTEP_WIDTH;\n    block_id_51765 = get_tblock_id(0);\n    global_tid_51763 = block_id_51765 * tblock_sizze_51767 + local_tid_51764;\n    gid_flat_47884 = sext_i32_i64(block_id_51765);\n    slice_51769 = tile_sizze_47886;\n    ltid_pre_51768 = sext_i32_i64(local_tid_51764);\n    remnant_51770 = sext_i32_i64(local_tid_51764) - ltid_pre_51768;\n    slice_51771 = ldim_47887;\n    gid_47883 = sext_i32_i64(block_id_51765);\n    remnant_51772 = sext_i32_i64(block_id_51765) - gid_47883;\n    color_50183 = (__local unsigned char *) color_50183_backing_0;\n    color_50184 = (__local unsigned char *) color_50184_backing_1;\n    binop_x_47894 = gid_47883 * tile_sizze_47886;\n    ltid_flat_47889 = sext_i32_i64(local_tid_51764);\n    ltid_47888 = sext_i32_i64(sext_i64_i32(ltid_pre_51768));\n    gtid_47895 = ltid_47888 + binop_x_47894;\n    cond_47896 = slt64(gtid_47895, conc_tmp_41556);\n    if (cond_47896) {\n        int64_t eta_p_47898 = ((__global int64_t *) mem_49613)[gtid_47895];\n        \n        pre_47897 = eta_p_47898;\n    } else {\n        pre_47897 = (int64_t) 0;\n    }\n    mem_49763[(int64_t) 0] = pre_47897;\n    barrier(CLK_LOCAL_MEM_FENCE);\n    ltid_flat_47903 = sext_i32_i64(local_tid_51764);\n    ltid_47902 = sext_i32_i64(sext_i64_i32(ltid_pre_51768));\n    gtid_47911 = binop_x_47894 + ltid_47902;\n    cond_47912 = slt64(gtid_47911, conc_tmp_41556);\n    if (cond_47912) {\n        int64_t eta_p_47915 = mem_49763[(int64_t) 0];\n        \n        neutral_47913 = eta_p_47915;\n        neutral_47914 = eta_p_47915;\n    } else {\n        neutral_47913 = (int64_t) 0;\n        neutral_47914 = (int64_t) 0;\n    }\n    mem_49767[(int64_t) 0] = neutral_47913;\n    mem_49771[(int64_t) 0] = neutral_47914;\n    barrier(CLK_LOCAL_MEM_FENCE);\n    barrier(CLK_LOCAL_MEM_FENCE);\n    for (int32_t i_2 = 0; i_2 < 1; i_2++)\n        mem_param_49772[", "i_2] = mem_49767[i_2];\n    for (int32_t i_3 = 0; i_3 < 1; i_3++)\n        mem_param_49773[i_3] = mem_49771[i_3];\n    for (int64_t tile_id_47922 = 0; tile_id_47922 < num_whole_tiles_47901; tile_id_47922++) {\n        int64_t binop_x_47994;\n        int64_t ltid_flat_47993;\n        int64_t ltid_47992;\n        int64_t j_47995;\n        bool cond_47999;\n        int64_t pre1d_48000;\n        int64_t pre1d_48001;\n        int64_t mem_49781[1];\n        int64_t mem_49785[1];\n        int64_t ltid_flat_48009;\n        int64_t ltid_48008;\n        int64_t gtid_48011;\n        int64_t acc_48013;\n        int64_t acc_48014;\n        bool cond_48015;\n        int64_t acc_48016;\n        int64_t acc_48017;\n        int64_t mem_param_tmp_51773[1];\n        int64_t mem_param_tmp_51774[1];\n        \n        binop_x_47994 = tile_sizze_47886 * tile_id_47922;\n        ltid_flat_47993 = sext_i32_i64(local_tid_51764);\n        ltid_47992 = sext_i32_i64(sext_i64_i32(ltid_pre_51768));\n        j_47995 = ltid_47992 + binop_x_47994;\n        cond_47999 = slt64(j_47995, m_41830);\n        if (cond_47999) {\n            int64_t tile_elem_48002;\n            int64_t tile_elem_48003;\n            \n            tile_elem_48002 = ((__global int64_t *) mem_49757)[j_47995];\n            tile_elem_48003 = ((__global int64_t *) mem_49755)[j_47995];\n            pre1d_48000 = tile_elem_48002;\n            pre1d_48001 = tile_elem_48003;\n        } else {\n            pre1d_48000 = (int64_t) 0;\n            pre1d_48001 = (int64_t) 0;\n        }\n        ((__local int64_t *) color_50184)[ltid_47992] = pre1d_48000;\n        ((__local int64_t *) color_50183)[ltid_47992] = pre1d_48001;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        ltid_flat_48009 = sext_i32_i64(local_tid_51764);\n        ltid_48008 = sext_i32_i64(sext_i64_i32(ltid_pre_51768));\n        gtid_48011 = binop_x_47894 + ltid_48008;\n        acc_48013 = mem_param_49772[(int64_t) 0];\n        acc_48014 = mem_param_49773[(int64_t) 0];\n        cond_48015 = slt64(gtid_48011, conc_tmp_41556)",
                                    ";\n        if (cond_48015) {\n            int64_t eta_p_48012;\n            int64_t x_48018;\n            int64_t x_48019;\n            int64_t redout_49031;\n            int64_t redout_49032;\n            \n            eta_p_48012 = mem_49763[(int64_t) 0];\n            redout_49031 = acc_48013;\n            redout_49032 = acc_48014;\n            for (int64_t i_49033 = 0; i_49033 < tile_sizze_47886; i_49033++) {\n                int64_t x_48020;\n                int64_t x_48021;\n                bool cond_48026;\n                bool cond_48027;\n                bool cond_f_res_48028;\n                bool y_48029;\n                bool cond_48030;\n                bool cond_48031;\n                bool cond_f_res_t_res_48032;\n                bool x_48033;\n                bool x_48034;\n                bool y_48035;\n                bool cond_48036;\n                int64_t lifted_lambda_res_48037;\n                int64_t lifted_lambda_res_48038;\n                int64_t redout_tmp_51777;\n                int64_t redout_tmp_51778;\n                \n                x_48020 = ((__local int64_t *) color_50184)[i_49033];\n                x_48021 = ((__local int64_t *) color_50183)[i_49033];\n                cond_48026 = redout_49031 == eta_p_48012;\n                cond_48027 = !cond_48026;\n                cond_f_res_48028 = slt64(redout_49032, (int64_t) 0);\n                y_48029 = cond_48026 && cond_f_res_48028;\n                cond_48030 = cond_48027 || y_48029;\n                cond_48031 = slt64(x_48021, redout_49032);\n                cond_f_res_t_res_48032 = x_48020 == eta_p_48012;\n                x_48033 = cond_48031 && cond_f_res_t_res_48032;\n                x_48034 = !cond_48030;\n                y_48035 = x_48033 && x_48034;\n                cond_48036 = cond_48030 || y_48035;\n                if (cond_48036) {\n                    lifted_lambda_res_48037 = x_48020;\n                } else {\n                    lifted_lambda_res_48037 = redout_49031;\n                }\n                if (cond_", "48036) {\n                    lifted_lambda_res_48038 = x_48021;\n                } else {\n                    lifted_lambda_res_48038 = redout_49032;\n                }\n                redout_tmp_51777 = lifted_lambda_res_48037;\n                redout_tmp_51778 = lifted_lambda_res_48038;\n                redout_49031 = redout_tmp_51777;\n                redout_49032 = redout_tmp_51778;\n            }\n            x_48018 = redout_49031;\n            x_48019 = redout_49032;\n            acc_48016 = x_48018;\n            acc_48017 = x_48019;\n        } else {\n            acc_48016 = acc_48013;\n            acc_48017 = acc_48014;\n        }\n        mem_49781[(int64_t) 0] = acc_48016;\n        mem_49785[(int64_t) 0] = acc_48017;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        for (int32_t i_4 = 0; i_4 < 1; i_4++)\n            mem_param_tmp_51773[i_4] = mem_49781[i_4];\n        for (int32_t i_5 = 0; i_5 < 1; i_5++)\n            mem_param_tmp_51774[i_5] = mem_49785[i_5];\n        for (int32_t i_6 = 0; i_6 < 1; i_6++)\n            mem_param_49772[i_6] = mem_param_tmp_51773[i_6];\n        for (int32_t i_7 = 0; i_7 < 1; i_7++)\n            mem_param_49773[i_7] = mem_param_tmp_51774[i_7];\n    }\n    for (int32_t i_8 = 0; i_8 < 1; i_8++)\n        ext_mem_49787[i_8] = mem_param_49772[i_8];\n    for (int32_t i_9 = 0; i_9 < 1; i_9++)\n        ext_mem_49786[i_9] = mem_param_49773[i_9];\n    barrier(CLK_LOCAL_MEM_FENCE);\n    if (cond_48061) {\n        for (int32_t i_10 = 0; i_10 < 1; i_10++)\n            ext_mem_49796[i_10] = ext_mem_49787[i_10];\n    } else {\n        int64_t ltid_flat_48063;\n        int64_t ltid_48062;\n        int64_t j_48075;\n        bool cond_48079;\n        int64_t pre1d_48080;\n        int64_t pre1d_48081;\n        int64_t ltid_flat_48091;\n        int64_t ltid_48090;\n        int64_t gtid_48101;\n        int64_t acc_48103;\n        bool cond_48105;\n        int64_t acc_48106;\n        \n        ltid_flat_48063 = sext_i32_i64(local_tid_51764);\n        ltid_48062 = sext_i32_i64(sext_i64_i32(ltid_pre_", "51768));\n        j_48075 = ltid_48062 + binop_x_48074;\n        cond_48079 = slt64(j_48075, m_41830);\n        if (cond_48079) {\n            int64_t tile_elem_48082;\n            int64_t tile_elem_48083;\n            \n            tile_elem_48082 = ((__global int64_t *) mem_49757)[j_48075];\n            tile_elem_48083 = ((__global int64_t *) mem_49755)[j_48075];\n            pre1d_48080 = tile_elem_48082;\n            pre1d_48081 = tile_elem_48083;\n        } else {\n            pre1d_48080 = (int64_t) 0;\n            pre1d_48081 = (int64_t) 0;\n        }\n        ((__local int64_t *) color_50184)[ltid_48062] = pre1d_48080;\n        ((__local int64_t *) color_50183)[ltid_48062] = pre1d_48081;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        ltid_flat_48091 = sext_i32_i64(local_tid_51764);\n        ltid_48090 = sext_i32_i64(sext_i64_i32(ltid_pre_51768));\n        gtid_48101 = binop_x_47894 + ltid_48090;\n        acc_48103 = ext_mem_49787[(int64_t) 0];\n        cond_48105 = slt64(gtid_48101, conc_tmp_41556);\n        if (cond_48105) {\n            int64_t eta_p_48102;\n            int64_t acc_48104;\n            int64_t x_48108;\n            int64_t x_48109;\n            int64_t redout_49034;\n            int64_t redout_49035;\n            \n            eta_p_48102 = mem_49763[(int64_t) 0];\n            acc_48104 = ext_mem_49786[(int64_t) 0];\n            redout_49034 = acc_48103;\n            redout_49035 = acc_48104;\n            for (int64_t i_49036 = 0; i_49036 < residual_input_48060; i_49036++) {\n                int64_t x_48110;\n                int64_t x_48111;\n                bool cond_48116;\n                bool cond_48117;\n                bool cond_f_res_48118;\n                bool y_48119;\n                bool cond_48120;\n                bool cond_48121;\n                bool cond_f_res_t_res_48122;\n                bool x_48123;\n                bool x_48124;\n                bool y_48125;\n                bool cond_48126;\n                int64_t lifted_lambda_res_48127;\n                int64_t ",
                                    "lifted_lambda_res_48128;\n                int64_t redout_tmp_51779;\n                int64_t redout_tmp_51780;\n                \n                x_48110 = ((__local int64_t *) color_50184)[i_49036];\n                x_48111 = ((__local int64_t *) color_50183)[i_49036];\n                cond_48116 = redout_49034 == eta_p_48102;\n                cond_48117 = !cond_48116;\n                cond_f_res_48118 = slt64(redout_49035, (int64_t) 0);\n                y_48119 = cond_48116 && cond_f_res_48118;\n                cond_48120 = cond_48117 || y_48119;\n                cond_48121 = slt64(x_48111, redout_49035);\n                cond_f_res_t_res_48122 = x_48110 == eta_p_48102;\n                x_48123 = cond_48121 && cond_f_res_t_res_48122;\n                x_48124 = !cond_48120;\n                y_48125 = x_48123 && x_48124;\n                cond_48126 = cond_48120 || y_48125;\n                if (cond_48126) {\n                    lifted_lambda_res_48127 = x_48110;\n                } else {\n                    lifted_lambda_res_48127 = redout_49034;\n                }\n                if (cond_48126) {\n                    lifted_lambda_res_48128 = x_48111;\n                } else {\n                    lifted_lambda_res_48128 = redout_49035;\n                }\n                redout_tmp_51779 = lifted_lambda_res_48127;\n                redout_tmp_51780 = lifted_lambda_res_48128;\n                redout_49034 = redout_tmp_51779;\n                redout_49035 = redout_tmp_51780;\n            }\n            x_48108 = redout_49034;\n            x_48109 = redout_49035;\n            acc_48106 = x_48108;\n        } else {\n            acc_48106 = acc_48103;\n        }\n        mem_49795[(int64_t) 0] = acc_48106;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        for (int32_t i_11 = 0; i_11 < 1; i_11++)\n            ext_mem_49796[i_11] = mem_49795[i_11];\n    }\n    if (slt64(sext_i32_i64(local_tid_51764) + tile_sizze_47886 * sext_i32_i64(block_id_51765), conc_tmp_41556)) {\n        int64_t tmp_51781 = ext_mem_49796[(in", "t64_t) 0];\n        \n        ((__global int64_t *) mem_49798)[sext_i32_i64(local_tid_51764) + tile_sizze_47886 * sext_i32_i64(block_id_51765)] = tmp_51781;\n    }\n    \n  error_8:\n    return;\n    #undef tile_sizze_47886\n    #undef bytes_49774\n}\nFUTHARK_KERNEL_SIZED(do_DBSCAN_doublezisegmap_intrablock_48143_dim1, 1, 1)\nvoid do_DBSCAN_doublezisegmap_intrablock_48143(__global int *global_failure, int8_t clBase_34768, int8_t clBase_34769, double clBase_34770, double clBase_34776, int64_t conc_tmp_41556, int64_t inf_41963, int64_t dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_41966, int64_t ldim_48146, int64_t num_whole_tiles_48190, int64_t residual_input_48428, unsigned char cond_48429_bits, int64_t binop_x_48445, __global unsigned char *mem_49454, __global unsigned char *mem_49456, __global unsigned char *mem_49494, __global unsigned char *ext_mem_49839, __global unsigned char *mem_49842, __global unsigned char *mem_49844)\n{\n    bool cond_48429 = cond_48429_bits;\n    \n    #define tile_sizze_48145 (do_DBSCAN_doublezisegmap_intrablock_48143zitile_sizze_48145)\n    #define bytes_49891 (do_DBSCAN_doublezisegmap_intrablock_48143zibytes_49891)\n    \n    volatile __local unsigned char *color_50187_backing_2 = &shared_mem[0];\n    const int64_t color_50187_backing_2_offset = 0 + (bytes_49891 + srem64((int64_t) 8 - srem64(bytes_49891, (int64_t) 8), (int64_t) 8));\n    volatile __local unsigned char *color_50186_backing_1 = &shared_mem[color_50187_backing_2_offset];\n    const int64_t color_50186_backing_1_offset = color_50187_backing_2_offset + (bytes_49891 + srem64((int64_t) 8 - srem64(bytes_49891, (int64_t) 8), (int64_t) 8));\n    volatile __local unsigned char *color_50185_backing_0 = &shared_mem[color_50186_backing_1_offset];\n    const int64_t color_50185_backing_0_offset = color_50186_backing_1_offset + (bytes_49891 + srem64((int64_t) 8 - srem64(bytes_49891, (int64_t) 8), (int64_t) 8));\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_51797;\n    int32_t tblock_sizz", "e_51800;\n    int32_t wave_sizze_51799;\n    int32_t block_id_51798;\n    int32_t global_tid_51796;\n    int64_t gid_flat_48143;\n    int64_t slice_51802;\n    int64_t ltid_pre_51801;\n    int64_t remnant_51803;\n    int64_t slice_51804;\n    int64_t gid_48142;\n    int64_t remnant_51805;\n    __local unsigned char *color_50185;\n    __local unsigned char *color_50186;\n    __local unsigned char *color_50187;\n    int64_t binop_x_48161;\n    double mem_49864[1];\n    double mem_49868[1];\n    double mem_49872[1];\n    double mem_49876[1];\n    double mem_49880[1];\n    int64_t ltid_flat_48148;\n    int64_t ltid_48147;\n    int64_t gtid_48162;\n    bool cond_48163;\n    double pre_48164;\n    double pre_48165;\n    double pre_48166;\n    double pre_48167;\n    double pre_48168;\n    int64_t mem_49884[1];\n    double mem_49888[1];\n    int64_t ltid_flat_48192;\n    int64_t ltid_48191;\n    int64_t ext_mem_49906[1];\n    double ext_mem_49905[1];\n    int64_t mem_param_49889[1];\n    double mem_param_49890[1];\n    int64_t mem_49916[1];\n    int64_t ext_mem_49917[1];\n    \n    local_tid_51797 = get_local_id(0);\n    tblock_sizze_51800 = get_local_size(0);\n    wave_sizze_51799 = LOCKSTEP_WIDTH;\n    block_id_51798 = get_tblock_id(0);\n    global_tid_51796 = block_id_51798 * tblock_sizze_51800 + local_tid_51797;\n    gid_flat_48143 = sext_i32_i64(block_id_51798);\n    slice_51802 = tile_sizze_48145;\n    ltid_pre_51801 = sext_i32_i64(local_tid_51797);\n    remnant_51803 = sext_i32_i64(local_tid_51797) - ltid_pre_51801;\n    slice_51804 = ldim_48146;\n    gid_48142 = sext_i32_i64(block_id_51798);\n    remnant_51805 = sext_i32_i64(block_id_51798) - gid_48142;\n    color_50185 = (__local unsigned char *) color_50185_backing_0;\n    color_50186 = (__local unsigned char *) color_50186_backing_1;\n    color_50187 = (__local unsigned char *) color_50187_backing_2;\n    binop_x_48161 = gid_48142 * tile_sizze_48145;\n    ltid_flat_48148 = sext_i32_i64(local_tid_51797);\n    ltid_48147 = sext_i32_i64(sext_i64_i32(ltid_pre_51801));\n    ",
                                    "gtid_48162 = ltid_48147 + binop_x_48161;\n    cond_48163 = slt64(gtid_48162, dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_41966);\n    if (cond_48163) {\n        int64_t slice_48169;\n        double eta_p_48170;\n        double eta_p_48172;\n        double zt_res_48173;\n        double zt_res_48174;\n        double zs_res_48175;\n        double zs_res_48176;\n        double d_haversine_res_48177;\n        double d_haversine_res_48178;\n        double cos_res_48179;\n        \n        slice_48169 = inf_41963 + gtid_48162;\n        eta_p_48170 = ((__global double *) mem_49454)[slice_48169];\n        eta_p_48172 = ((__global double *) mem_49456)[slice_48169];\n        zt_res_48173 = 3.141592653589793 * eta_p_48170;\n        zt_res_48174 = 3.141592653589793 * eta_p_48172;\n        zs_res_48175 = zt_res_48173 / 180.0;\n        zs_res_48176 = zt_res_48174 / 180.0;\n        if (clBase_34768 == (int8_t) 1) {\n            d_haversine_res_48177 = eta_p_48170;\n        } else {\n            d_haversine_res_48177 = zs_res_48175;\n        }\n        if (clBase_34768 == (int8_t) 1) {\n            d_haversine_res_48178 = eta_p_48172;\n        } else {\n            d_haversine_res_48178 = zs_res_48176;\n        }\n        cos_res_48179 = futrts_cos64(d_haversine_res_48177);\n        pre_48164 = eta_p_48170;\n        pre_48165 = eta_p_48172;\n        pre_48166 = d_haversine_res_48177;\n        pre_48167 = d_haversine_res_48178;\n        pre_48168 = cos_res_48179;\n    } else {\n        pre_48164 = 0.0;\n        pre_48165 = 0.0;\n        pre_48166 = 0.0;\n        pre_48167 = 0.0;\n        pre_48168 = 0.0;\n    }\n    mem_49864[(int64_t) 0] = pre_48164;\n    mem_49868[(int64_t) 0] = pre_48165;\n    mem_49872[(int64_t) 0] = pre_48166;\n    mem_49876[(int64_t) 0] = pre_48167;\n    mem_49880[(int64_t) 0] = pre_48168;\n    barrier(CLK_LOCAL_MEM_FENCE);\n    ltid_flat_48192 = sext_i32_i64(local_tid_51797);\n    ltid_48191 = sext_i32_i64(sext_i64_i32(ltid_pre_51801));\n    mem_49884[(int64_t) 0] = (int64_t) -1;\n    mem_49888[(int64_t) 0] = INFINITY;\n  ", "  barrier(CLK_LOCAL_MEM_FENCE);\n    barrier(CLK_LOCAL_MEM_FENCE);\n    for (int32_t i_3 = 0; i_3 < 1; i_3++)\n        mem_param_49889[i_3] = mem_49884[i_3];\n    for (int32_t i_4 = 0; i_4 < 1; i_4++)\n        mem_param_49890[i_4] = mem_49888[i_4];\n    for (int64_t tile_id_48200 = 0; tile_id_48200 < num_whole_tiles_48190; tile_id_48200++) {\n        int64_t binop_x_48309;\n        int64_t ltid_flat_48308;\n        int64_t ltid_48307;\n        int64_t j_48310;\n        bool cond_48318;\n        double pre1d_48319;\n        double pre1d_48320;\n        int64_t pre1d_48321;\n        int64_t mem_49900[1];\n        double mem_49904[1];\n        int64_t ltid_flat_48331;\n        int64_t ltid_48330;\n        int64_t gtid_48333;\n        int64_t acc_48339;\n        double acc_48340;\n        bool cond_48341;\n        int64_t acc_48342;\n        double acc_48343;\n        int64_t mem_param_tmp_51806[1];\n        double mem_param_tmp_51807[1];\n        \n        binop_x_48309 = tile_sizze_48145 * tile_id_48200;\n        ltid_flat_48308 = sext_i32_i64(local_tid_51797);\n        ltid_48307 = sext_i32_i64(sext_i64_i32(ltid_pre_51801));\n        j_48310 = ltid_48307 + binop_x_48309;\n        cond_48318 = slt64(j_48310, conc_tmp_41556);\n        if (cond_48318) {\n            double tile_elem_48322;\n            double tile_elem_48323;\n            int64_t tile_elem_48324;\n            \n            tile_elem_48322 = ((__global double *) mem_49842)[j_48310];\n            tile_elem_48323 = ((__global double *) mem_49844)[j_48310];\n            tile_elem_48324 = ((__global int64_t *) ext_mem_49839)[j_48310];\n            pre1d_48319 = tile_elem_48322;\n            pre1d_48320 = tile_elem_48323;\n            pre1d_48321 = tile_elem_48324;\n        } else {\n            pre1d_48319 = 0.0;\n            pre1d_48320 = 0.0;\n            pre1d_48321 = (int64_t) 0;\n        }\n        ((__local double *) color_50187)[ltid_48307] = pre1d_48319;\n        ((__local double *) color_50186)[ltid_48307] = pre1d_48320;\n        ((__local int64_t *", ") color_50185)[ltid_48307] = pre1d_48321;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        ltid_flat_48331 = sext_i32_i64(local_tid_51797);\n        ltid_48330 = sext_i32_i64(sext_i64_i32(ltid_pre_51801));\n        gtid_48333 = binop_x_48161 + ltid_48330;\n        acc_48339 = mem_param_49889[(int64_t) 0];\n        acc_48340 = mem_param_49890[(int64_t) 0];\n        cond_48341 = slt64(gtid_48333, dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_41966);\n        if (cond_48341) {\n            double eta_p_48334;\n            double eta_p_48335;\n            double d_haversine_res_48336;\n            double d_haversine_res_48337;\n            double cos_res_48338;\n            int64_t x_48344;\n            double x_48345;\n            int64_t redout_49037;\n            double redout_49038;\n            \n            eta_p_48334 = mem_49864[(int64_t) 0];\n            eta_p_48335 = mem_49868[(int64_t) 0];\n            d_haversine_res_48336 = mem_49872[(int64_t) 0];\n            d_haversine_res_48337 = mem_49876[(int64_t) 0];\n            cos_res_48338 = mem_49880[(int64_t) 0];\n            redout_49037 = acc_48339;\n            redout_49038 = acc_48340;\n            for (int64_t i_49039 = 0; i_49039 < tile_sizze_48145; i_49039++) {\n                double eta_p_48346;\n                double eta_p_48347;\n                double dist_res_48349;\n                bool zg_res_48378;\n                bool zg_res_48379;\n                bool x_48380;\n                int64_t lifted_lambda_res_48381;\n                double lifted_lambda_res_48382;\n                int64_t redout_tmp_51810;\n                double redout_tmp_51811;\n                \n                eta_p_48346 = ((__local double *) color_50187)[i_49039];\n                eta_p_48347 = ((__local double *) color_50186)[i_49039];\n                if (clBase_34769 == (int8_t) 0) {\n                    double zm_res_48350;\n                    double zm_res_48351;\n                    double hypot_res_48352;\n                    \n                    zm_res_48350 = eta_p_4833",
                                    "5 - eta_p_48347;\n                    zm_res_48351 = eta_p_48334 - eta_p_48346;\n                    hypot_res_48352 = futrts_hypot64(zm_res_48351, zm_res_48350);\n                    dist_res_48349 = hypot_res_48352;\n                } else {\n                    double d_haversine_res_48353;\n                    double d_haversine_res_48354;\n                    double zm_res_48359;\n                    double cos_res_48360;\n                    double zm_res_48361;\n                    double cos_res_48362;\n                    double zt_res_48363;\n                    double zm_res_48364;\n                    double zm_res_48365;\n                    double zt_res_48366;\n                    double zp_res_48367;\n                    double zs_res_48368;\n                    double min_res_48369;\n                    double zt_res_48370;\n                    double zm_res_48371;\n                    double acos_res_48372;\n                    double zt_res_48373;\n                    \n                    if (clBase_34768 == (int8_t) 1) {\n                        d_haversine_res_48353 = eta_p_48346;\n                        d_haversine_res_48354 = eta_p_48347;\n                    } else {\n                        double zt_res_48355;\n                        double zs_res_48356;\n                        double zt_res_48357;\n                        double zs_res_48358;\n                        \n                        zt_res_48355 = 3.141592653589793 * eta_p_48346;\n                        zs_res_48356 = zt_res_48355 / 180.0;\n                        zt_res_48357 = 3.141592653589793 * eta_p_48347;\n                        zs_res_48358 = zt_res_48357 / 180.0;\n                        d_haversine_res_48353 = zs_res_48356;\n                        d_haversine_res_48354 = zs_res_48358;\n                    }\n                    zm_res_48359 = d_haversine_res_48336 - d_haversine_res_48353;\n                    cos_res_48360 = futrts_cos64(zm_res_48359);\n                    zm_res_48361 = 1.0 - cos_res_48", "360;\n                    cos_res_48362 = futrts_cos64(d_haversine_res_48353);\n                    zt_res_48363 = cos_res_48338 * cos_res_48362;\n                    zm_res_48364 = d_haversine_res_48337 - d_haversine_res_48354;\n                    zm_res_48365 = 1.0 - zm_res_48364;\n                    zt_res_48366 = zt_res_48363 * zm_res_48365;\n                    zp_res_48367 = zm_res_48361 + zt_res_48366;\n                    zs_res_48368 = zp_res_48367 / 2.0;\n                    min_res_48369 = fmin64(1.0, zs_res_48368);\n                    zt_res_48370 = 2.0 * min_res_48369;\n                    zm_res_48371 = 1.0 - zt_res_48370;\n                    acos_res_48372 = futrts_acos64(zm_res_48371);\n                    zt_res_48373 = clBase_34776 * acos_res_48372;\n                    dist_res_48349 = zt_res_48373;\n                }\n                zg_res_48378 = clBase_34770 < redout_49038;\n                zg_res_48379 = clBase_34770 < dist_res_48349;\n                x_48380 = zg_res_48378 && zg_res_48379;\n                if (x_48380) {\n                    lifted_lambda_res_48381 = (int64_t) -1;\n                    lifted_lambda_res_48382 = INFINITY;\n                } else {\n                    bool zl_res_48383;\n                    int64_t lifted_lambda_res_f_res_48384;\n                    double lifted_lambda_res_f_res_48385;\n                    \n                    zl_res_48383 = redout_49038 < dist_res_48349;\n                    if (zl_res_48383) {\n                        lifted_lambda_res_f_res_48384 = redout_49037;\n                    } else {\n                        int64_t x_48348 = ((__local int64_t *) color_50185)[i_49039];\n                        \n                        lifted_lambda_res_f_res_48384 = x_48348;\n                    }\n                    if (zl_res_48383) {\n                        lifted_lambda_res_f_res_48385 = redout_49038;\n                    } else {\n                        lifted_lambda_res_f_res_48385 = dist_res_48349;\n                    ", "}\n                    lifted_lambda_res_48381 = lifted_lambda_res_f_res_48384;\n                    lifted_lambda_res_48382 = lifted_lambda_res_f_res_48385;\n                }\n                redout_tmp_51810 = lifted_lambda_res_48381;\n                redout_tmp_51811 = lifted_lambda_res_48382;\n                redout_49037 = redout_tmp_51810;\n                redout_49038 = redout_tmp_51811;\n            }\n            x_48344 = redout_49037;\n            x_48345 = redout_49038;\n            acc_48342 = x_48344;\n            acc_48343 = x_48345;\n        } else {\n            acc_48342 = acc_48339;\n            acc_48343 = acc_48340;\n        }\n        mem_49900[(int64_t) 0] = acc_48342;\n        mem_49904[(int64_t) 0] = acc_48343;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        for (int32_t i_5 = 0; i_5 < 1; i_5++)\n            mem_param_tmp_51806[i_5] = mem_49900[i_5];\n        for (int32_t i_6 = 0; i_6 < 1; i_6++)\n            mem_param_tmp_51807[i_6] = mem_49904[i_6];\n        for (int32_t i_7 = 0; i_7 < 1; i_7++)\n            mem_param_49889[i_7] = mem_param_tmp_51806[i_7];\n        for (int32_t i_8 = 0; i_8 < 1; i_8++)\n            mem_param_49890[i_8] = mem_param_tmp_51807[i_8];\n    }\n    for (int32_t i_9 = 0; i_9 < 1; i_9++)\n        ext_mem_49906[i_9] = mem_param_49889[i_9];\n    for (int32_t i_10 = 0; i_10 < 1; i_10++)\n        ext_mem_49905[i_10] = mem_param_49890[i_10];\n    barrier(CLK_LOCAL_MEM_FENCE);\n    if (cond_48429) {\n        for (int32_t i_11 = 0; i_11 < 1; i_11++)\n            ext_mem_49917[i_11] = ext_mem_49906[i_11];\n    } else {\n        int64_t ltid_flat_48431;\n        int64_t ltid_48430;\n        int64_t j_48446;\n        bool cond_48454;\n        double pre1d_48455;\n        double pre1d_48456;\n        int64_t pre1d_48457;\n        int64_t ltid_flat_48471;\n        int64_t ltid_48470;\n        int64_t gtid_48481;\n        int64_t acc_48487;\n        bool cond_48489;\n        int64_t acc_48490;\n        \n        ltid_flat_48431 = sext_i32_i64(local_tid_51797);\n        ltid_4843",
                                    "0 = sext_i32_i64(sext_i64_i32(ltid_pre_51801));\n        j_48446 = ltid_48430 + binop_x_48445;\n        cond_48454 = slt64(j_48446, conc_tmp_41556);\n        if (cond_48454) {\n            double tile_elem_48458;\n            double tile_elem_48459;\n            int64_t tile_elem_48460;\n            \n            tile_elem_48458 = ((__global double *) mem_49842)[j_48446];\n            tile_elem_48459 = ((__global double *) mem_49844)[j_48446];\n            tile_elem_48460 = ((__global int64_t *) ext_mem_49839)[j_48446];\n            pre1d_48455 = tile_elem_48458;\n            pre1d_48456 = tile_elem_48459;\n            pre1d_48457 = tile_elem_48460;\n        } else {\n            pre1d_48455 = 0.0;\n            pre1d_48456 = 0.0;\n            pre1d_48457 = (int64_t) 0;\n        }\n        ((__local double *) color_50187)[ltid_48430] = pre1d_48455;\n        ((__local double *) color_50186)[ltid_48430] = pre1d_48456;\n        ((__local int64_t *) color_50185)[ltid_48430] = pre1d_48457;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        ltid_flat_48471 = sext_i32_i64(local_tid_51797);\n        ltid_48470 = sext_i32_i64(sext_i64_i32(ltid_pre_51801));\n        gtid_48481 = binop_x_48161 + ltid_48470;\n        acc_48487 = ext_mem_49906[(int64_t) 0];\n        cond_48489 = slt64(gtid_48481, dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_41966);\n        if (cond_48489) {\n            double eta_p_48482;\n            double eta_p_48483;\n            double d_haversine_res_48484;\n            double d_haversine_res_48485;\n            double cos_res_48486;\n            double acc_48488;\n            int64_t x_48492;\n            double x_48493;\n            int64_t redout_49040;\n            double redout_49041;\n            \n            eta_p_48482 = mem_49864[(int64_t) 0];\n            eta_p_48483 = mem_49868[(int64_t) 0];\n            d_haversine_res_48484 = mem_49872[(int64_t) 0];\n            d_haversine_res_48485 = mem_49876[(int64_t) 0];\n            cos_res_48486 = mem_49880[(int64_t) 0];\n            acc_48488 = ext_mem_49905", "[(int64_t) 0];\n            redout_49040 = acc_48487;\n            redout_49041 = acc_48488;\n            for (int64_t i_49042 = 0; i_49042 < residual_input_48428; i_49042++) {\n                double eta_p_48494;\n                double eta_p_48495;\n                double dist_res_48497;\n                bool zg_res_48526;\n                bool zg_res_48527;\n                bool x_48528;\n                int64_t lifted_lambda_res_48529;\n                double lifted_lambda_res_48530;\n                int64_t redout_tmp_51812;\n                double redout_tmp_51813;\n                \n                eta_p_48494 = ((__local double *) color_50187)[i_49042];\n                eta_p_48495 = ((__local double *) color_50186)[i_49042];\n                if (clBase_34769 == (int8_t) 0) {\n                    double zm_res_48498;\n                    double zm_res_48499;\n                    double hypot_res_48500;\n                    \n                    zm_res_48498 = eta_p_48483 - eta_p_48495;\n                    zm_res_48499 = eta_p_48482 - eta_p_48494;\n                    hypot_res_48500 = futrts_hypot64(zm_res_48499, zm_res_48498);\n                    dist_res_48497 = hypot_res_48500;\n                } else {\n                    double d_haversine_res_48501;\n                    double d_haversine_res_48502;\n                    double zm_res_48507;\n                    double cos_res_48508;\n                    double zm_res_48509;\n                    double cos_res_48510;\n                    double zt_res_48511;\n                    double zm_res_48512;\n                    double zm_res_48513;\n                    double zt_res_48514;\n                    double zp_res_48515;\n                    double zs_res_48516;\n                    double min_res_48517;\n                    double zt_res_48518;\n                    double zm_res_48519;\n                    double acos_res_48520;\n                    double zt_res_48521;\n                    \n                    if (clBase_34768 == (int8_t) ", "1) {\n                        d_haversine_res_48501 = eta_p_48494;\n                        d_haversine_res_48502 = eta_p_48495;\n                    } else {\n                        double zt_res_48503;\n                        double zs_res_48504;\n                        double zt_res_48505;\n                        double zs_res_48506;\n                        \n                        zt_res_48503 = 3.141592653589793 * eta_p_48494;\n                        zs_res_48504 = zt_res_48503 / 180.0;\n                        zt_res_48505 = 3.141592653589793 * eta_p_48495;\n                        zs_res_48506 = zt_res_48505 / 180.0;\n                        d_haversine_res_48501 = zs_res_48504;\n                        d_haversine_res_48502 = zs_res_48506;\n                    }\n                    zm_res_48507 = d_haversine_res_48484 - d_haversine_res_48501;\n                    cos_res_48508 = futrts_cos64(zm_res_48507);\n                    zm_res_48509 = 1.0 - cos_res_48508;\n                    cos_res_48510 = futrts_cos64(d_haversine_res_48501);\n                    zt_res_48511 = cos_res_48486 * cos_res_48510;\n                    zm_res_48512 = d_haversine_res_48485 - d_haversine_res_48502;\n                    zm_res_48513 = 1.0 - zm_res_48512;\n                    zt_res_48514 = zt_res_48511 * zm_res_48513;\n                    zp_res_48515 = zm_res_48509 + zt_res_48514;\n                    zs_res_48516 = zp_res_48515 / 2.0;\n                    min_res_48517 = fmin64(1.0, zs_res_48516);\n                    zt_res_48518 = 2.0 * min_res_48517;\n                    zm_res_48519 = 1.0 - zt_res_48518;\n                    acos_res_48520 = futrts_acos64(zm_res_48519);\n                    zt_res_48521 = clBase_34776 * acos_res_48520;\n                    dist_res_48497 = zt_res_48521;\n                }\n                zg_res_48526 = clBase_34770 < redout_49041;\n                zg_res_48527 = clBase_34770 < dist_res_48497;\n                x_48528 = zg_res_48526 && zg_res_48527;\n             ",
                                    "   if (x_48528) {\n                    lifted_lambda_res_48529 = (int64_t) -1;\n                    lifted_lambda_res_48530 = INFINITY;\n                } else {\n                    bool zl_res_48531;\n                    int64_t lifted_lambda_res_f_res_48532;\n                    double lifted_lambda_res_f_res_48533;\n                    \n                    zl_res_48531 = redout_49041 < dist_res_48497;\n                    if (zl_res_48531) {\n                        lifted_lambda_res_f_res_48532 = redout_49040;\n                    } else {\n                        int64_t x_48496 = ((__local int64_t *) color_50185)[i_49042];\n                        \n                        lifted_lambda_res_f_res_48532 = x_48496;\n                    }\n                    if (zl_res_48531) {\n                        lifted_lambda_res_f_res_48533 = redout_49041;\n                    } else {\n                        lifted_lambda_res_f_res_48533 = dist_res_48497;\n                    }\n                    lifted_lambda_res_48529 = lifted_lambda_res_f_res_48532;\n                    lifted_lambda_res_48530 = lifted_lambda_res_f_res_48533;\n                }\n                redout_tmp_51812 = lifted_lambda_res_48529;\n                redout_tmp_51813 = lifted_lambda_res_48530;\n                redout_49040 = redout_tmp_51812;\n                redout_49041 = redout_tmp_51813;\n            }\n            x_48492 = redout_49040;\n            x_48493 = redout_49041;\n            acc_48490 = x_48492;\n        } else {\n            acc_48490 = acc_48487;\n        }\n        mem_49916[(int64_t) 0] = acc_48490;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        for (int32_t i_12 = 0; i_12 < 1; i_12++)\n            ext_mem_49917[i_12] = mem_49916[i_12];\n    }\n    if (slt64(sext_i32_i64(local_tid_51797) + tile_sizze_48145 * sext_i32_i64(block_id_51798), dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_41966)) {\n        int64_t tmp_51814 = ext_mem_49917[(int64_t) 0];\n        \n        ((__global int64_t *) mem_49494)[inf_41963 + (sext_i32_i6", "4(local_tid_51797) + tile_sizze_48145 * sext_i32_i64(block_id_51798))] = tmp_51814;\n    }\n    \n  error_8:\n    return;\n    #undef tile_sizze_48145\n    #undef bytes_49891\n}\nFUTHARK_KERNEL_SIZED(do_DBSCAN_doublezisegmap_intrablock_48552_dim1, 1, 1)\nvoid do_DBSCAN_doublezisegmap_intrablock_48552(__global int *global_failure, int8_t clBase_34768, int8_t clBase_34769, double clBase_34770, double clBase_34776, int64_t conc_tmp_41556, int64_t inf_42046, int64_t dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_42049, int64_t ldim_48555, int64_t num_whole_tiles_48599, int64_t residual_input_48837, unsigned char cond_48838_bits, int64_t binop_x_48854, __global unsigned char *current_partition_mem_49387, __global unsigned char *current_partition_mem_49388, __global unsigned char *mem_49424, __global unsigned char *ext_mem_49839, __global unsigned char *mem_49842, __global unsigned char *mem_49844)\n{\n    bool cond_48838 = cond_48838_bits;\n    \n    #define tile_sizze_48554 (do_DBSCAN_doublezisegmap_intrablock_48552zitile_sizze_48554)\n    #define bytes_49981 (do_DBSCAN_doublezisegmap_intrablock_48552zibytes_49981)\n    \n    volatile __local unsigned char *color_50190_backing_2 = &shared_mem[0];\n    const int64_t color_50190_backing_2_offset = 0 + (bytes_49981 + srem64((int64_t) 8 - srem64(bytes_49981, (int64_t) 8), (int64_t) 8));\n    volatile __local unsigned char *color_50189_backing_1 = &shared_mem[color_50190_backing_2_offset];\n    const int64_t color_50189_backing_1_offset = color_50190_backing_2_offset + (bytes_49981 + srem64((int64_t) 8 - srem64(bytes_49981, (int64_t) 8), (int64_t) 8));\n    volatile __local unsigned char *color_50188_backing_0 = &shared_mem[color_50189_backing_1_offset];\n    const int64_t color_50188_backing_0_offset = color_50189_backing_1_offset + (bytes_49981 + srem64((int64_t) 8 - srem64(bytes_49981, (int64_t) 8), (int64_t) 8));\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_51956;\n    int32_t tblock_sizze_51959;\n    int32_t wave_sizze_519", "58;\n    int32_t block_id_51957;\n    int32_t global_tid_51955;\n    int64_t gid_flat_48552;\n    int64_t slice_51961;\n    int64_t ltid_pre_51960;\n    int64_t remnant_51962;\n    int64_t slice_51963;\n    int64_t gid_48551;\n    int64_t remnant_51964;\n    __local unsigned char *color_50188;\n    __local unsigned char *color_50189;\n    __local unsigned char *color_50190;\n    int64_t binop_x_48570;\n    double mem_49954[1];\n    double mem_49958[1];\n    double mem_49962[1];\n    double mem_49966[1];\n    double mem_49970[1];\n    int64_t ltid_flat_48557;\n    int64_t ltid_48556;\n    int64_t gtid_48571;\n    bool cond_48572;\n    double pre_48573;\n    double pre_48574;\n    double pre_48575;\n    double pre_48576;\n    double pre_48577;\n    int64_t mem_49974[1];\n    double mem_49978[1];\n    int64_t ltid_flat_48601;\n    int64_t ltid_48600;\n    int64_t ext_mem_49996[1];\n    double ext_mem_49995[1];\n    int64_t mem_param_49979[1];\n    double mem_param_49980[1];\n    int64_t mem_50006[1];\n    int64_t ext_mem_50007[1];\n    \n    local_tid_51956 = get_local_id(0);\n    tblock_sizze_51959 = get_local_size(0);\n    wave_sizze_51958 = LOCKSTEP_WIDTH;\n    block_id_51957 = get_tblock_id(0);\n    global_tid_51955 = block_id_51957 * tblock_sizze_51959 + local_tid_51956;\n    gid_flat_48552 = sext_i32_i64(block_id_51957);\n    slice_51961 = tile_sizze_48554;\n    ltid_pre_51960 = sext_i32_i64(local_tid_51956);\n    remnant_51962 = sext_i32_i64(local_tid_51956) - ltid_pre_51960;\n    slice_51963 = ldim_48555;\n    gid_48551 = sext_i32_i64(block_id_51957);\n    remnant_51964 = sext_i32_i64(block_id_51957) - gid_48551;\n    color_50188 = (__local unsigned char *) color_50188_backing_0;\n    color_50189 = (__local unsigned char *) color_50189_backing_1;\n    color_50190 = (__local unsigned char *) color_50190_backing_2;\n    binop_x_48570 = gid_48551 * tile_sizze_48554;\n    ltid_flat_48557 = sext_i32_i64(local_tid_51956);\n    ltid_48556 = sext_i32_i64(sext_i64_i32(ltid_pre_51960));\n    gtid_48571 = ltid_48556 + binop_x_4",
                                    "8570;\n    cond_48572 = slt64(gtid_48571, dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_42049);\n    if (cond_48572) {\n        int64_t slice_48578;\n        double eta_p_48579;\n        double eta_p_48581;\n        double zt_res_48582;\n        double zt_res_48583;\n        double zs_res_48584;\n        double zs_res_48585;\n        double d_haversine_res_48586;\n        double d_haversine_res_48587;\n        double cos_res_48588;\n        \n        slice_48578 = inf_42046 + gtid_48571;\n        eta_p_48579 = ((__global double *) current_partition_mem_49387)[slice_48578];\n        eta_p_48581 = ((__global double *) current_partition_mem_49388)[slice_48578];\n        zt_res_48582 = 3.141592653589793 * eta_p_48579;\n        zt_res_48583 = 3.141592653589793 * eta_p_48581;\n        zs_res_48584 = zt_res_48582 / 180.0;\n        zs_res_48585 = zt_res_48583 / 180.0;\n        if (clBase_34768 == (int8_t) 1) {\n            d_haversine_res_48586 = eta_p_48579;\n        } else {\n            d_haversine_res_48586 = zs_res_48584;\n        }\n        if (clBase_34768 == (int8_t) 1) {\n            d_haversine_res_48587 = eta_p_48581;\n        } else {\n            d_haversine_res_48587 = zs_res_48585;\n        }\n        cos_res_48588 = futrts_cos64(d_haversine_res_48586);\n        pre_48573 = eta_p_48579;\n        pre_48574 = eta_p_48581;\n        pre_48575 = d_haversine_res_48586;\n        pre_48576 = d_haversine_res_48587;\n        pre_48577 = cos_res_48588;\n    } else {\n        pre_48573 = 0.0;\n        pre_48574 = 0.0;\n        pre_48575 = 0.0;\n        pre_48576 = 0.0;\n        pre_48577 = 0.0;\n    }\n    mem_49954[(int64_t) 0] = pre_48573;\n    mem_49958[(int64_t) 0] = pre_48574;\n    mem_49962[(int64_t) 0] = pre_48575;\n    mem_49966[(int64_t) 0] = pre_48576;\n    mem_49970[(int64_t) 0] = pre_48577;\n    barrier(CLK_LOCAL_MEM_FENCE);\n    ltid_flat_48601 = sext_i32_i64(local_tid_51956);\n    ltid_48600 = sext_i32_i64(sext_i64_i32(ltid_pre_51960));\n    mem_49974[(int64_t) 0] = (int64_t) -1;\n    mem_49978[(int64_t) 0] = INFINITY;\n ", "   barrier(CLK_LOCAL_MEM_FENCE);\n    barrier(CLK_LOCAL_MEM_FENCE);\n    for (int32_t i_3 = 0; i_3 < 1; i_3++)\n        mem_param_49979[i_3] = mem_49974[i_3];\n    for (int32_t i_4 = 0; i_4 < 1; i_4++)\n        mem_param_49980[i_4] = mem_49978[i_4];\n    for (int64_t tile_id_48609 = 0; tile_id_48609 < num_whole_tiles_48599; tile_id_48609++) {\n        int64_t binop_x_48718;\n        int64_t ltid_flat_48717;\n        int64_t ltid_48716;\n        int64_t j_48719;\n        bool cond_48727;\n        double pre1d_48728;\n        double pre1d_48729;\n        int64_t pre1d_48730;\n        int64_t mem_49990[1];\n        double mem_49994[1];\n        int64_t ltid_flat_48740;\n        int64_t ltid_48739;\n        int64_t gtid_48742;\n        int64_t acc_48748;\n        double acc_48749;\n        bool cond_48750;\n        int64_t acc_48751;\n        double acc_48752;\n        int64_t mem_param_tmp_51965[1];\n        double mem_param_tmp_51966[1];\n        \n        binop_x_48718 = tile_sizze_48554 * tile_id_48609;\n        ltid_flat_48717 = sext_i32_i64(local_tid_51956);\n        ltid_48716 = sext_i32_i64(sext_i64_i32(ltid_pre_51960));\n        j_48719 = ltid_48716 + binop_x_48718;\n        cond_48727 = slt64(j_48719, conc_tmp_41556);\n        if (cond_48727) {\n            double tile_elem_48731;\n            double tile_elem_48732;\n            int64_t tile_elem_48733;\n            \n            tile_elem_48731 = ((__global double *) mem_49842)[j_48719];\n            tile_elem_48732 = ((__global double *) mem_49844)[j_48719];\n            tile_elem_48733 = ((__global int64_t *) ext_mem_49839)[j_48719];\n            pre1d_48728 = tile_elem_48731;\n            pre1d_48729 = tile_elem_48732;\n            pre1d_48730 = tile_elem_48733;\n        } else {\n            pre1d_48728 = 0.0;\n            pre1d_48729 = 0.0;\n            pre1d_48730 = (int64_t) 0;\n        }\n        ((__local double *) color_50190)[ltid_48716] = pre1d_48728;\n        ((__local double *) color_50189)[ltid_48716] = pre1d_48729;\n        ((__local int64_t ", "*) color_50188)[ltid_48716] = pre1d_48730;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        ltid_flat_48740 = sext_i32_i64(local_tid_51956);\n        ltid_48739 = sext_i32_i64(sext_i64_i32(ltid_pre_51960));\n        gtid_48742 = binop_x_48570 + ltid_48739;\n        acc_48748 = mem_param_49979[(int64_t) 0];\n        acc_48749 = mem_param_49980[(int64_t) 0];\n        cond_48750 = slt64(gtid_48742, dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_42049);\n        if (cond_48750) {\n            double eta_p_48743;\n            double eta_p_48744;\n            double d_haversine_res_48745;\n            double d_haversine_res_48746;\n            double cos_res_48747;\n            int64_t x_48753;\n            double x_48754;\n            int64_t redout_49043;\n            double redout_49044;\n            \n            eta_p_48743 = mem_49954[(int64_t) 0];\n            eta_p_48744 = mem_49958[(int64_t) 0];\n            d_haversine_res_48745 = mem_49962[(int64_t) 0];\n            d_haversine_res_48746 = mem_49966[(int64_t) 0];\n            cos_res_48747 = mem_49970[(int64_t) 0];\n            redout_49043 = acc_48748;\n            redout_49044 = acc_48749;\n            for (int64_t i_49045 = 0; i_49045 < tile_sizze_48554; i_49045++) {\n                double eta_p_48755;\n                double eta_p_48756;\n                double dist_res_48758;\n                bool zg_res_48787;\n                bool zg_res_48788;\n                bool x_48789;\n                int64_t lifted_lambda_res_48790;\n                double lifted_lambda_res_48791;\n                int64_t redout_tmp_51969;\n                double redout_tmp_51970;\n                \n                eta_p_48755 = ((__local double *) color_50190)[i_49045];\n                eta_p_48756 = ((__local double *) color_50189)[i_49045];\n                if (clBase_34769 == (int8_t) 0) {\n                    double zm_res_48759;\n                    double zm_res_48760;\n                    double hypot_res_48761;\n                    \n                    zm_res_48759 = eta_p_487",
                                    "44 - eta_p_48756;\n                    zm_res_48760 = eta_p_48743 - eta_p_48755;\n                    hypot_res_48761 = futrts_hypot64(zm_res_48760, zm_res_48759);\n                    dist_res_48758 = hypot_res_48761;\n                } else {\n                    double d_haversine_res_48762;\n                    double d_haversine_res_48763;\n                    double zm_res_48768;\n                    double cos_res_48769;\n                    double zm_res_48770;\n                    double cos_res_48771;\n                    double zt_res_48772;\n                    double zm_res_48773;\n                    double zm_res_48774;\n                    double zt_res_48775;\n                    double zp_res_48776;\n                    double zs_res_48777;\n                    double min_res_48778;\n                    double zt_res_48779;\n                    double zm_res_48780;\n                    double acos_res_48781;\n                    double zt_res_48782;\n                    \n                    if (clBase_34768 == (int8_t) 1) {\n                        d_haversine_res_48762 = eta_p_48755;\n                        d_haversine_res_48763 = eta_p_48756;\n                    } else {\n                        double zt_res_48764;\n                        double zs_res_48765;\n                        double zt_res_48766;\n                        double zs_res_48767;\n                        \n                        zt_res_48764 = 3.141592653589793 * eta_p_48755;\n                        zs_res_48765 = zt_res_48764 / 180.0;\n                        zt_res_48766 = 3.141592653589793 * eta_p_48756;\n                        zs_res_48767 = zt_res_48766 / 180.0;\n                        d_haversine_res_48762 = zs_res_48765;\n                        d_haversine_res_48763 = zs_res_48767;\n                    }\n                    zm_res_48768 = d_haversine_res_48745 - d_haversine_res_48762;\n                    cos_res_48769 = futrts_cos64(zm_res_48768);\n                    zm_res_48770 = 1.0 - cos_res_4", "8769;\n                    cos_res_48771 = futrts_cos64(d_haversine_res_48762);\n                    zt_res_48772 = cos_res_48747 * cos_res_48771;\n                    zm_res_48773 = d_haversine_res_48746 - d_haversine_res_48763;\n                    zm_res_48774 = 1.0 - zm_res_48773;\n                    zt_res_48775 = zt_res_48772 * zm_res_48774;\n                    zp_res_48776 = zm_res_48770 + zt_res_48775;\n                    zs_res_48777 = zp_res_48776 / 2.0;\n                    min_res_48778 = fmin64(1.0, zs_res_48777);\n                    zt_res_48779 = 2.0 * min_res_48778;\n                    zm_res_48780 = 1.0 - zt_res_48779;\n                    acos_res_48781 = futrts_acos64(zm_res_48780);\n                    zt_res_48782 = clBase_34776 * acos_res_48781;\n                    dist_res_48758 = zt_res_48782;\n                }\n                zg_res_48787 = clBase_34770 < redout_49044;\n                zg_res_48788 = clBase_34770 < dist_res_48758;\n                x_48789 = zg_res_48787 && zg_res_48788;\n                if (x_48789) {\n                    lifted_lambda_res_48790 = (int64_t) -1;\n                    lifted_lambda_res_48791 = INFINITY;\n                } else {\n                    bool zl_res_48792;\n                    int64_t lifted_lambda_res_f_res_48793;\n                    double lifted_lambda_res_f_res_48794;\n                    \n                    zl_res_48792 = redout_49044 < dist_res_48758;\n                    if (zl_res_48792) {\n                        lifted_lambda_res_f_res_48793 = redout_49043;\n                    } else {\n                        int64_t x_48757 = ((__local int64_t *) color_50188)[i_49045];\n                        \n                        lifted_lambda_res_f_res_48793 = x_48757;\n                    }\n                    if (zl_res_48792) {\n                        lifted_lambda_res_f_res_48794 = redout_49044;\n                    } else {\n                        lifted_lambda_res_f_res_48794 = dist_res_48758;\n                   ", " }\n                    lifted_lambda_res_48790 = lifted_lambda_res_f_res_48793;\n                    lifted_lambda_res_48791 = lifted_lambda_res_f_res_48794;\n                }\n                redout_tmp_51969 = lifted_lambda_res_48790;\n                redout_tmp_51970 = lifted_lambda_res_48791;\n                redout_49043 = redout_tmp_51969;\n                redout_49044 = redout_tmp_51970;\n            }\n            x_48753 = redout_49043;\n            x_48754 = redout_49044;\n            acc_48751 = x_48753;\n            acc_48752 = x_48754;\n        } else {\n            acc_48751 = acc_48748;\n            acc_48752 = acc_48749;\n        }\n        mem_49990[(int64_t) 0] = acc_48751;\n        mem_49994[(int64_t) 0] = acc_48752;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        for (int32_t i_5 = 0; i_5 < 1; i_5++)\n            mem_param_tmp_51965[i_5] = mem_49990[i_5];\n        for (int32_t i_6 = 0; i_6 < 1; i_6++)\n            mem_param_tmp_51966[i_6] = mem_49994[i_6];\n        for (int32_t i_7 = 0; i_7 < 1; i_7++)\n            mem_param_49979[i_7] = mem_param_tmp_51965[i_7];\n        for (int32_t i_8 = 0; i_8 < 1; i_8++)\n            mem_param_49980[i_8] = mem_param_tmp_51966[i_8];\n    }\n    for (int32_t i_9 = 0; i_9 < 1; i_9++)\n        ext_mem_49996[i_9] = mem_param_49979[i_9];\n    for (int32_t i_10 = 0; i_10 < 1; i_10++)\n        ext_mem_49995[i_10] = mem_param_49980[i_10];\n    barrier(CLK_LOCAL_MEM_FENCE);\n    if (cond_48838) {\n        for (int32_t i_11 = 0; i_11 < 1; i_11++)\n            ext_mem_50007[i_11] = ext_mem_49996[i_11];\n    } else {\n        int64_t ltid_flat_48840;\n        int64_t ltid_48839;\n        int64_t j_48855;\n        bool cond_48863;\n        double pre1d_48864;\n        double pre1d_48865;\n        int64_t pre1d_48866;\n        int64_t ltid_flat_48880;\n        int64_t ltid_48879;\n        int64_t gtid_48890;\n        int64_t acc_48896;\n        bool cond_48898;\n        int64_t acc_48899;\n        \n        ltid_flat_48840 = sext_i32_i64(local_tid_51956);\n        ltid_488",
                                    "39 = sext_i32_i64(sext_i64_i32(ltid_pre_51960));\n        j_48855 = ltid_48839 + binop_x_48854;\n        cond_48863 = slt64(j_48855, conc_tmp_41556);\n        if (cond_48863) {\n            double tile_elem_48867;\n            double tile_elem_48868;\n            int64_t tile_elem_48869;\n            \n            tile_elem_48867 = ((__global double *) mem_49842)[j_48855];\n            tile_elem_48868 = ((__global double *) mem_49844)[j_48855];\n            tile_elem_48869 = ((__global int64_t *) ext_mem_49839)[j_48855];\n            pre1d_48864 = tile_elem_48867;\n            pre1d_48865 = tile_elem_48868;\n            pre1d_48866 = tile_elem_48869;\n        } else {\n            pre1d_48864 = 0.0;\n            pre1d_48865 = 0.0;\n            pre1d_48866 = (int64_t) 0;\n        }\n        ((__local double *) color_50190)[ltid_48839] = pre1d_48864;\n        ((__local double *) color_50189)[ltid_48839] = pre1d_48865;\n        ((__local int64_t *) color_50188)[ltid_48839] = pre1d_48866;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        ltid_flat_48880 = sext_i32_i64(local_tid_51956);\n        ltid_48879 = sext_i32_i64(sext_i64_i32(ltid_pre_51960));\n        gtid_48890 = binop_x_48570 + ltid_48879;\n        acc_48896 = ext_mem_49996[(int64_t) 0];\n        cond_48898 = slt64(gtid_48890, dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_42049);\n        if (cond_48898) {\n            double eta_p_48891;\n            double eta_p_48892;\n            double d_haversine_res_48893;\n            double d_haversine_res_48894;\n            double cos_res_48895;\n            double acc_48897;\n            int64_t x_48901;\n            double x_48902;\n            int64_t redout_49046;\n            double redout_49047;\n            \n            eta_p_48891 = mem_49954[(int64_t) 0];\n            eta_p_48892 = mem_49958[(int64_t) 0];\n            d_haversine_res_48893 = mem_49962[(int64_t) 0];\n            d_haversine_res_48894 = mem_49966[(int64_t) 0];\n            cos_res_48895 = mem_49970[(int64_t) 0];\n            acc_48897 = ext_mem_4999", "5[(int64_t) 0];\n            redout_49046 = acc_48896;\n            redout_49047 = acc_48897;\n            for (int64_t i_49048 = 0; i_49048 < residual_input_48837; i_49048++) {\n                double eta_p_48903;\n                double eta_p_48904;\n                double dist_res_48906;\n                bool zg_res_48935;\n                bool zg_res_48936;\n                bool x_48937;\n                int64_t lifted_lambda_res_48938;\n                double lifted_lambda_res_48939;\n                int64_t redout_tmp_51971;\n                double redout_tmp_51972;\n                \n                eta_p_48903 = ((__local double *) color_50190)[i_49048];\n                eta_p_48904 = ((__local double *) color_50189)[i_49048];\n                if (clBase_34769 == (int8_t) 0) {\n                    double zm_res_48907;\n                    double zm_res_48908;\n                    double hypot_res_48909;\n                    \n                    zm_res_48907 = eta_p_48892 - eta_p_48904;\n                    zm_res_48908 = eta_p_48891 - eta_p_48903;\n                    hypot_res_48909 = futrts_hypot64(zm_res_48908, zm_res_48907);\n                    dist_res_48906 = hypot_res_48909;\n                } else {\n                    double d_haversine_res_48910;\n                    double d_haversine_res_48911;\n                    double zm_res_48916;\n                    double cos_res_48917;\n                    double zm_res_48918;\n                    double cos_res_48919;\n                    double zt_res_48920;\n                    double zm_res_48921;\n                    double zm_res_48922;\n                    double zt_res_48923;\n                    double zp_res_48924;\n                    double zs_res_48925;\n                    double min_res_48926;\n                    double zt_res_48927;\n                    double zm_res_48928;\n                    double acos_res_48929;\n                    double zt_res_48930;\n                    \n                    if (clBase_34768 == (int8_t)", " 1) {\n                        d_haversine_res_48910 = eta_p_48903;\n                        d_haversine_res_48911 = eta_p_48904;\n                    } else {\n                        double zt_res_48912;\n                        double zs_res_48913;\n                        double zt_res_48914;\n                        double zs_res_48915;\n                        \n                        zt_res_48912 = 3.141592653589793 * eta_p_48903;\n                        zs_res_48913 = zt_res_48912 / 180.0;\n                        zt_res_48914 = 3.141592653589793 * eta_p_48904;\n                        zs_res_48915 = zt_res_48914 / 180.0;\n                        d_haversine_res_48910 = zs_res_48913;\n                        d_haversine_res_48911 = zs_res_48915;\n                    }\n                    zm_res_48916 = d_haversine_res_48893 - d_haversine_res_48910;\n                    cos_res_48917 = futrts_cos64(zm_res_48916);\n                    zm_res_48918 = 1.0 - cos_res_48917;\n                    cos_res_48919 = futrts_cos64(d_haversine_res_48910);\n                    zt_res_48920 = cos_res_48895 * cos_res_48919;\n                    zm_res_48921 = d_haversine_res_48894 - d_haversine_res_48911;\n                    zm_res_48922 = 1.0 - zm_res_48921;\n                    zt_res_48923 = zt_res_48920 * zm_res_48922;\n                    zp_res_48924 = zm_res_48918 + zt_res_48923;\n                    zs_res_48925 = zp_res_48924 / 2.0;\n                    min_res_48926 = fmin64(1.0, zs_res_48925);\n                    zt_res_48927 = 2.0 * min_res_48926;\n                    zm_res_48928 = 1.0 - zt_res_48927;\n                    acos_res_48929 = futrts_acos64(zm_res_48928);\n                    zt_res_48930 = clBase_34776 * acos_res_48929;\n                    dist_res_48906 = zt_res_48930;\n                }\n                zg_res_48935 = clBase_34770 < redout_49047;\n                zg_res_48936 = clBase_34770 < dist_res_48906;\n                x_48937 = zg_res_48935 && zg_res_48936;\n            ",
                                    "    if (x_48937) {\n                    lifted_lambda_res_48938 = (int64_t) -1;\n                    lifted_lambda_res_48939 = INFINITY;\n                } else {\n                    bool zl_res_48940;\n                    int64_t lifted_lambda_res_f_res_48941;\n                    double lifted_lambda_res_f_res_48942;\n                    \n                    zl_res_48940 = redout_49047 < dist_res_48906;\n                    if (zl_res_48940) {\n                        lifted_lambda_res_f_res_48941 = redout_49046;\n                    } else {\n                        int64_t x_48905 = ((__local int64_t *) color_50188)[i_49048];\n                        \n                        lifted_lambda_res_f_res_48941 = x_48905;\n                    }\n                    if (zl_res_48940) {\n                        lifted_lambda_res_f_res_48942 = redout_49047;\n                    } else {\n                        lifted_lambda_res_f_res_48942 = dist_res_48906;\n                    }\n                    lifted_lambda_res_48938 = lifted_lambda_res_f_res_48941;\n                    lifted_lambda_res_48939 = lifted_lambda_res_f_res_48942;\n                }\n                redout_tmp_51971 = lifted_lambda_res_48938;\n                redout_tmp_51972 = lifted_lambda_res_48939;\n                redout_49046 = redout_tmp_51971;\n                redout_49047 = redout_tmp_51972;\n            }\n            x_48901 = redout_49046;\n            x_48902 = redout_49047;\n            acc_48899 = x_48901;\n        } else {\n            acc_48899 = acc_48896;\n        }\n        mem_50006[(int64_t) 0] = acc_48899;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        for (int32_t i_12 = 0; i_12 < 1; i_12++)\n            ext_mem_50007[i_12] = mem_50006[i_12];\n    }\n    if (slt64(sext_i32_i64(local_tid_51956) + tile_sizze_48554 * sext_i32_i64(block_id_51957), dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_42049)) {\n        int64_t tmp_51973 = ext_mem_50007[(int64_t) 0];\n        \n        ((__global int64_t *) mem_49424)[inf_42046 + (sext_i32_i", "64(local_tid_51956) + tile_sizze_48554 * sext_i32_i64(block_id_51957))] = tmp_51973;\n    }\n    \n  error_8:\n    return;\n    #undef tile_sizze_48554\n    #undef bytes_49981\n}\nFUTHARK_KERNEL_SIZED(do_DBSCAN_doublezisegred_large_44665_dim1, 1, 1)\nvoid do_DBSCAN_doublezisegred_large_44665(__global int *global_failure, int8_t clBase_34768, int8_t clBase_34769, double clBase_34770, double clBase_34776, int64_t m_41485, int64_t conc_tmp_41556, int64_t inf_41586, int64_t j_m_i_41589, int64_t num_tblocks_44660, unsigned char x_49366_bits, int64_t blocks_per_segment_51139, int64_t q_51140, int64_t num_virtblocks_51141, int64_t threads_per_segment_51142, __global unsigned char *mem_49480, __global unsigned char *mem_49482, __global unsigned char *mem_49498, __global unsigned char *mem_49500, __global unsigned char *mem_param_49520, __global unsigned char *mem_49523, __global unsigned char *mem_49525, __global unsigned char *mem_49527, __global unsigned char *mem_49530, __global unsigned char *segred_tmp_mem_51143, __global unsigned char *counters_mem_51145)\n{\n    bool x_49366 = x_49366_bits;\n    \n    #define segred_tblock_sizze_44659 (do_DBSCAN_doublezisegred_large_44665zisegred_tblock_sizze_44659)\n    #define chunk_sizze_51110 (do_DBSCAN_doublezisegred_large_44665zichunk_sizze_51110)\n    \n    volatile __local unsigned char *sync_arr_mem_51154_backing_1 = &shared_mem[0];\n    const int64_t sync_arr_mem_51154_backing_1_offset = 0 + 8;\n    volatile __local unsigned char *red_arr_i64_mem_51152_backing_0 = &shared_mem[sync_arr_mem_51154_backing_1_offset];\n    const int64_t red_arr_i64_mem_51152_backing_0_offset = sync_arr_mem_51154_backing_1_offset + ((int64_t) 8 * segred_tblock_sizze_44659 + srem64((int64_t) 8 - srem64((int64_t) 8 * segred_tblock_sizze_44659, (int64_t) 8), (int64_t) 8));\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_51148;\n    int32_t tblock_sizze_51151;\n    int32_t wave_sizze_51150;\n    int32_t block_id_51149;\n    int32_t global_tid_", "51147;\n    int64_t phys_tid_44665;\n    __local unsigned char *red_arr_i64_mem_51152;\n    __local unsigned char *sync_arr_mem_51154;\n    int32_t phys_tblock_id_51156;\n    int32_t iterations_51157;\n    \n    local_tid_51148 = get_local_id(0);\n    tblock_sizze_51151 = get_local_size(0);\n    wave_sizze_51150 = LOCKSTEP_WIDTH;\n    block_id_51149 = get_tblock_id(0);\n    global_tid_51147 = block_id_51149 * tblock_sizze_51151 + local_tid_51148;\n    phys_tid_44665 = sext_i32_i64(global_tid_51147);\n    red_arr_i64_mem_51152 = (__local unsigned char *) red_arr_i64_mem_51152_backing_0;\n    sync_arr_mem_51154 = (__local unsigned char *) sync_arr_mem_51154_backing_1;\n    phys_tblock_id_51156 = get_tblock_id(0);\n    iterations_51157 = sdiv_up32(sext_i64_i32(num_virtblocks_51141) - phys_tblock_id_51156, sext_i64_i32(num_tblocks_44660));\n    for (int32_t i_51158 = 0; i_51158 < iterations_51157; i_51158++) {\n        int32_t virt_tblock_id_51159;\n        int64_t flat_segment_id_51160;\n        int64_t global_tid_51161;\n        int64_t slice_51162;\n        int64_t gtid_44663;\n        int64_t remnant_51163;\n        int64_t gtid_44664;\n        int64_t eta_p_block_res_acc_51164;\n        int64_t eta_p_44666;\n        int64_t eta_p_44667;\n        int64_t tblock_id_in_segment_51168;\n        int64_t block_base_offset_51169;\n        int32_t offset_51172;\n        int32_t skip_waves_51173;\n        int64_t eta_p_51165;\n        int64_t eta_p_51166;\n        \n        virt_tblock_id_51159 = phys_tblock_id_51156 + i_51158 * sext_i64_i32(num_tblocks_44660);\n        flat_segment_id_51160 = squot64(sext_i32_i64(virt_tblock_id_51159), blocks_per_segment_51139);\n        global_tid_51161 = srem64(sext_i32_i64(virt_tblock_id_51159) * segred_tblock_sizze_44659 + sext_i32_i64(local_tid_51148), threads_per_segment_51142);\n        slice_51162 = j_m_i_41589;\n        gtid_44663 = flat_segment_id_51160;\n        remnant_51163 = flat_segment_id_51160 - gtid_44663;\n        // ne-initialise the outer (per-block) accumulat",
                                    "or(s)\n        {\n            eta_p_block_res_acc_51164 = (int64_t) 9223372036854775807;\n        }\n        tblock_id_in_segment_51168 = squot64(global_tid_51161, segred_tblock_sizze_44659);\n        block_base_offset_51169 = tblock_id_in_segment_51168 * q_51140 * segred_tblock_sizze_44659;\n        for (int64_t i_51170 = 0; i_51170 < q_51140; i_51170++) {\n            int64_t block_offset_51171 = block_base_offset_51169 + i_51170 * segred_tblock_sizze_44659;\n            \n            gtid_44664 = global_tid_51161 + threads_per_segment_51142 * i_51170;\n            if (slt64(gtid_44664, conc_tmp_41556)) {\n                // apply map function(s)\n                {\n                    // apply map function\n                    {\n                        int64_t slice_46502 = inf_41586 + gtid_44663;\n                        bool index_concat_cmp_46497 = sle64(m_41485, slice_46502);\n                        double index_concat_branch_46501;\n                        \n                        if (index_concat_cmp_46497) {\n                            int64_t index_concat_i_46498 = sub64(slice_46502, m_41485);\n                            double index_concat_46499 = ((__global double *) mem_49500)[index_concat_i_46498];\n                            \n                            index_concat_branch_46501 = index_concat_46499;\n                        } else {\n                            double index_concat_46500 = ((__global double *) mem_49482)[slice_46502];\n                            \n                            index_concat_branch_46501 = index_concat_46500;\n                        }\n                        \n                        double index_concat_branch_46494;\n                        \n                        if (index_concat_cmp_46497) {\n                            int64_t index_concat_i_46491 = sub64(slice_46502, m_41485);\n                            double index_concat_46492 = ((__global double *) mem_49498)[index_concat_i_46491];\n                            \n                      ", "      index_concat_branch_46494 = index_concat_46492;\n                        } else {\n                            double index_concat_46493 = ((__global double *) mem_49480)[slice_46502];\n                            \n                            index_concat_branch_46494 = index_concat_46493;\n                        }\n                        \n                        bool index_concat_cmp_46483 = sle64(m_41485, gtid_44664);\n                        double index_concat_branch_46487;\n                        \n                        if (index_concat_cmp_46483) {\n                            int64_t index_concat_i_46484 = sub64(gtid_44664, m_41485);\n                            double index_concat_46485 = ((__global double *) mem_49500)[index_concat_i_46484];\n                            \n                            index_concat_branch_46487 = index_concat_46485;\n                        } else {\n                            double index_concat_46486 = ((__global double *) mem_49482)[gtid_44664];\n                            \n                            index_concat_branch_46487 = index_concat_46486;\n                        }\n                        \n                        double index_concat_branch_46481;\n                        \n                        if (index_concat_cmp_46483) {\n                            int64_t index_concat_i_46478 = sub64(gtid_44664, m_41485);\n                            double index_concat_46479 = ((__global double *) mem_49498)[index_concat_i_46478];\n                            \n                            index_concat_branch_46481 = index_concat_46479;\n                        } else {\n                            double index_concat_46480 = ((__global double *) mem_49480)[gtid_44664];\n                            \n                            index_concat_branch_46481 = index_concat_46480;\n                        }\n                        \n                        double d_haversine_res_44672;\n                        \n                        if (x_4936", "6) {\n                            double x_49368 = ((__global double *) mem_49523)[gtid_44663];\n                            \n                            d_haversine_res_44672 = x_49368;\n                        } else {\n                            d_haversine_res_44672 = 0.0;\n                        }\n                        \n                        double d_haversine_res_44673;\n                        \n                        if (x_49366) {\n                            double x_49370 = ((__global double *) mem_49525)[gtid_44663];\n                            \n                            d_haversine_res_44673 = x_49370;\n                        } else {\n                            d_haversine_res_44673 = 0.0;\n                        }\n                        \n                        double cos_res_44674;\n                        \n                        if (x_49366) {\n                            double x_49372 = ((__global double *) mem_49527)[gtid_44663];\n                            \n                            cos_res_44674 = x_49372;\n                        } else {\n                            cos_res_44674 = 0.0;\n                        }\n                        \n                        double dist_res_44678;\n                        \n                        if (clBase_34769 == (int8_t) 0) {\n                            double zm_res_44679 = index_concat_branch_46494 - index_concat_branch_46481;\n                            double zm_res_44680 = index_concat_branch_46501 - index_concat_branch_46487;\n                            double hypot_res_44681 = futrts_hypot64(zm_res_44680, zm_res_44679);\n                            \n                            dist_res_44678 = hypot_res_44681;\n                        } else {\n                            double d_haversine_res_44682;\n                            double d_haversine_res_44683;\n                            \n                            if (clBase_34768 == (int8_t) 1) {\n                                d_haversine_res_4468",
                                    "2 = index_concat_branch_46487;\n                                d_haversine_res_44683 = index_concat_branch_46481;\n                            } else {\n                                double zt_res_44684 = 3.141592653589793 * index_concat_branch_46487;\n                                double zs_res_44685 = zt_res_44684 / 180.0;\n                                double zt_res_44686 = 3.141592653589793 * index_concat_branch_46481;\n                                double zs_res_44687 = zt_res_44686 / 180.0;\n                                \n                                d_haversine_res_44682 = zs_res_44685;\n                                d_haversine_res_44683 = zs_res_44687;\n                            }\n                            \n                            double zm_res_44688 = d_haversine_res_44672 - d_haversine_res_44682;\n                            double cos_res_44689 = futrts_cos64(zm_res_44688);\n                            double zm_res_44690 = 1.0 - cos_res_44689;\n                            double cos_res_44691 = futrts_cos64(d_haversine_res_44682);\n                            double zt_res_44692 = cos_res_44674 * cos_res_44691;\n                            double zm_res_44693 = d_haversine_res_44673 - d_haversine_res_44683;\n                            double zm_res_44694 = 1.0 - zm_res_44693;\n                            double zt_res_44695 = zt_res_44692 * zm_res_44694;\n                            double zp_res_44696 = zm_res_44690 + zt_res_44695;\n                            double zs_res_44697 = zp_res_44696 / 2.0;\n                            double min_res_44698 = fmin64(1.0, zs_res_44697);\n                            double zt_res_44699 = 2.0 * min_res_44698;\n                            double zm_res_44700 = 1.0 - zt_res_44699;\n                            double acos_res_44701 = futrts_acos64(zm_res_44700);\n                            double zt_res_44702 = clBase_34776 * acos_res_44701;\n                            \n                            dist_res_44678", " = zt_res_44702;\n                        }\n                        \n                        bool zlze_res_44703 = dist_res_44678 <= clBase_34770;\n                        int64_t lifted_lambda_res_44704;\n                        \n                        if (zlze_res_44703) {\n                            int64_t eta_p_44677 = ((__global int64_t *) mem_param_49520)[gtid_44664];\n                            \n                            lifted_lambda_res_44704 = eta_p_44677;\n                        } else {\n                            int64_t eta_p_44669 = ((__global int64_t *) mem_param_49520)[slice_46502];\n                            \n                            lifted_lambda_res_44704 = eta_p_44669;\n                        }\n                        // load accumulator(s)\n                        {\n                            eta_p_44666 = eta_p_block_res_acc_51164;\n                        }\n                        // load next value(s)\n                        {\n                            eta_p_44667 = lifted_lambda_res_44704;\n                        }\n                        // apply reduction operator(s)\n                        {\n                            int64_t min_res_44668 = smin64(eta_p_44666, eta_p_44667);\n                            \n                            // store in accumulator(s)\n                            {\n                                eta_p_block_res_acc_51164 = min_res_44668;\n                            }\n                        }\n                    }\n                }\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        // store accs. prims go in lmem; non-prims in params (in global mem)\n        {\n            ((__local int64_t *) red_arr_i64_mem_51152)[sext_i32_i64(local_tid_51148)] = eta_p_block_res_acc_51164;\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        skip_waves_51173 = 1;\n        offset_51172 = 0;\n        // participating threads read initial accumulator\n        {\n            if (slt32(local_tid_51148, sext_i64_", "i32(segred_tblock_sizze_44659))) {\n                eta_p_51165 = ((__local int64_t *) red_arr_i64_mem_51152)[sext_i32_i64(local_tid_51148 + offset_51172)];\n            }\n        }\n        offset_51172 = 1;\n        while (slt32(offset_51172, wave_sizze_51150)) {\n            if (slt32(local_tid_51148 + offset_51172, sext_i64_i32(segred_tblock_sizze_44659)) && ((local_tid_51148 - squot32(local_tid_51148, wave_sizze_51150) * wave_sizze_51150) & (2 * offset_51172 - 1)) == 0) {\n                // read array element\n                {\n                    eta_p_51166 = ((volatile __local int64_t *) red_arr_i64_mem_51152)[sext_i32_i64(local_tid_51148 + offset_51172)];\n                }\n                // apply reduction operation\n                {\n                    int64_t min_res_51167 = smin64(eta_p_51165, eta_p_51166);\n                    \n                    eta_p_51165 = min_res_51167;\n                }\n                // write result of operation\n                {\n                    ((volatile __local int64_t *) red_arr_i64_mem_51152)[sext_i32_i64(local_tid_51148)] = eta_p_51165;\n                }\n            }\n            offset_51172 *= 2;\n        }\n        while (slt32(skip_waves_51173, squot32(sext_i64_i32(segred_tblock_sizze_44659) + wave_sizze_51150 - 1, wave_sizze_51150))) {\n            barrier(CLK_LOCAL_MEM_FENCE);\n            offset_51172 = skip_waves_51173 * wave_sizze_51150;\n            if (slt32(local_tid_51148 + offset_51172, sext_i64_i32(segred_tblock_sizze_44659)) && ((local_tid_51148 - squot32(local_tid_51148, wave_sizze_51150) * wave_sizze_51150) == 0 && (squot32(local_tid_51148, wave_sizze_51150) & (2 * skip_waves_51173 - 1)) == 0)) {\n                // read array element\n                {\n                    eta_p_51166 = ((__local int64_t *) red_arr_i64_mem_51152)[sext_i32_i64(local_tid_51148 + offset_51172)];\n                }\n                // apply reduction operation\n                {\n                    int64_t min_res_51167 = smin64(eta_p_5",
                                    "1165, eta_p_51166);\n                    \n                    eta_p_51165 = min_res_51167;\n                }\n                // write result of operation\n                {\n                    ((__local int64_t *) red_arr_i64_mem_51152)[sext_i32_i64(local_tid_51148)] = eta_p_51165;\n                }\n            }\n            skip_waves_51173 *= 2;\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        barrier(CLK_LOCAL_MEM_FENCE);\n        // thread 0 updates per-block acc(s); rest reset to ne\n        {\n            if (sext_i32_i64(local_tid_51148) == (int64_t) 0) {\n                eta_p_block_res_acc_51164 = eta_p_51165;\n            } else {\n                eta_p_block_res_acc_51164 = (int64_t) 9223372036854775807;\n            }\n        }\n        if (blocks_per_segment_51139 == (int64_t) 1) {\n            // first thread in block saves final result to memory\n            {\n                if (local_tid_51148 == 0) {\n                    ((__global int64_t *) mem_49530)[gtid_44663] = eta_p_block_res_acc_51164;\n                }\n            }\n        } else {\n            int32_t old_counter_51174;\n            bool is_last_block_51175;\n            \n            // first thread in block saves block result to global memory\n            {\n                if (local_tid_51148 == 0) {\n                    ((__global int64_t *) segred_tmp_mem_51143)[sext_i32_i64(virt_tblock_id_51159)] = eta_p_block_res_acc_51164;\n                    mem_fence_global();\n                    old_counter_51174 = atomic_add_i32_global(&((volatile __global int *) counters_mem_51145)[srem64(flat_segment_id_51160, (int64_t) 20480)], (int) 1);\n                    ((__local bool *) sync_arr_mem_51154)[(int64_t) 0] = old_counter_51174 == sext_i64_i32(blocks_per_segment_51139 - (int64_t) 1);\n                }\n            }\n            barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n            is_last_block_51175 = ((__local bool *) sync_arr_mem_51154)[(int64_t) 0];\n            if (is_last_block_51175) {\n ", "               if (local_tid_51148 == 0) {\n                    old_counter_51174 = atomic_add_i32_global(&((volatile __global int *) counters_mem_51145)[srem64(flat_segment_id_51160, (int64_t) 20480)], (int) sext_i64_i32((int64_t) 0 - blocks_per_segment_51139));\n                }\n                // read in the per-block-results\n                {\n                    int64_t read_per_thread_51176 = sdiv_up64(blocks_per_segment_51139, segred_tblock_sizze_44659);\n                    \n                    eta_p_44666 = (int64_t) 9223372036854775807;\n                    for (int64_t i_51177 = 0; i_51177 < read_per_thread_51176; i_51177++) {\n                        int64_t block_res_id_51178 = sext_i32_i64(local_tid_51148) * read_per_thread_51176 + i_51177;\n                        int64_t index_of_block_res_51179 = flat_segment_id_51160 * blocks_per_segment_51139 + block_res_id_51178;\n                        \n                        if (slt64(block_res_id_51178, blocks_per_segment_51139)) {\n                            eta_p_44667 = ((__global int64_t *) segred_tmp_mem_51143)[index_of_block_res_51179];\n                            \n                            int64_t min_res_44668 = smin64(eta_p_44666, eta_p_44667);\n                            \n                            eta_p_44666 = min_res_44668;\n                        }\n                    }\n                }\n                ((__local int64_t *) red_arr_i64_mem_51152)[sext_i32_i64(local_tid_51148)] = eta_p_44666;\n                barrier(CLK_LOCAL_MEM_FENCE);\n                // reduce the per-block results\n                {\n                    int32_t offset_51180;\n                    int32_t skip_waves_51181 = 1;\n                    int64_t eta_p_51165;\n                    int64_t eta_p_51166;\n                    \n                    offset_51180 = 0;\n                    // participating threads read initial accumulator\n                    {\n                        if (slt32(local_tid_51148, sext_i64_i32(segred_tblock_s", "izze_44659))) {\n                            eta_p_51165 = ((__local int64_t *) red_arr_i64_mem_51152)[sext_i32_i64(local_tid_51148 + offset_51180)];\n                        }\n                    }\n                    offset_51180 = 1;\n                    while (slt32(offset_51180, wave_sizze_51150)) {\n                        if (slt32(local_tid_51148 + offset_51180, sext_i64_i32(segred_tblock_sizze_44659)) && ((local_tid_51148 - squot32(local_tid_51148, wave_sizze_51150) * wave_sizze_51150) & (2 * offset_51180 - 1)) == 0) {\n                            // read array element\n                            {\n                                eta_p_51166 = ((volatile __local int64_t *) red_arr_i64_mem_51152)[sext_i32_i64(local_tid_51148 + offset_51180)];\n                            }\n                            // apply reduction operation\n                            {\n                                int64_t min_res_51167 = smin64(eta_p_51165, eta_p_51166);\n                                \n                                eta_p_51165 = min_res_51167;\n                            }\n                            // write result of operation\n                            {\n                                ((volatile __local int64_t *) red_arr_i64_mem_51152)[sext_i32_i64(local_tid_51148)] = eta_p_51165;\n                            }\n                        }\n                        offset_51180 *= 2;\n                    }\n                    while (slt32(skip_waves_51181, squot32(sext_i64_i32(segred_tblock_sizze_44659) + wave_sizze_51150 - 1, wave_sizze_51150))) {\n                        barrier(CLK_LOCAL_MEM_FENCE);\n                        offset_51180 = skip_waves_51181 * wave_sizze_51150;\n                        if (slt32(local_tid_51148 + offset_51180, sext_i64_i32(segred_tblock_sizze_44659)) && ((local_tid_51148 - squot32(local_tid_51148, wave_sizze_51150) * wave_sizze_51150) == 0 && (squot32(local_tid_51148, wave_sizze_51150) & (2 * skip_waves_51181 - 1)) == 0)) {\n               ",
                                    "             // read array element\n                            {\n                                eta_p_51166 = ((__local int64_t *) red_arr_i64_mem_51152)[sext_i32_i64(local_tid_51148 + offset_51180)];\n                            }\n                            // apply reduction operation\n                            {\n                                int64_t min_res_51167 = smin64(eta_p_51165, eta_p_51166);\n                                \n                                eta_p_51165 = min_res_51167;\n                            }\n                            // write result of operation\n                            {\n                                ((__local int64_t *) red_arr_i64_mem_51152)[sext_i32_i64(local_tid_51148)] = eta_p_51165;\n                            }\n                        }\n                        skip_waves_51181 *= 2;\n                    }\n                    barrier(CLK_LOCAL_MEM_FENCE);\n                    // and back to memory with the final result\n                    {\n                        if (local_tid_51148 == 0) {\n                            ((__global int64_t *) mem_49530)[gtid_44663] = eta_p_51165;\n                        }\n                    }\n                }\n            }\n        }\n        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    }\n    \n  error_6:\n    return;\n    #undef segred_tblock_sizze_44659\n    #undef chunk_sizze_51110\n}\nFUTHARK_KERNEL_SIZED(do_DBSCAN_doublezisegred_large_45615_dim1, 1, 1)\nvoid do_DBSCAN_doublezisegred_large_45615(__global int *global_failure, int8_t clBase_34768, int8_t clBase_34769, double clBase_34770, double clBase_34776, int64_t conc_tmp_41556, int64_t inf_41963, int64_t dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_41966, int64_t num_tblocks_45609, unsigned char x_49366_bits, int64_t blocks_per_segment_51865, int64_t q_51866, int64_t num_virtblocks_51867, int64_t threads_per_segment_51868, __global unsigned char *mem_49454, __global unsigned char *mem_49456, __global unsigned char *mem_49494, __global u", "nsigned char *ext_mem_49839, __global unsigned char *mem_49842, __global unsigned char *mem_49844, __global unsigned char *mem_49850, __global unsigned char *mem_49852, __global unsigned char *mem_49854, __global unsigned char *mem_49859, __global unsigned char *segred_tmp_mem_51869, __global unsigned char *segred_tmp_mem_51871, __global unsigned char *counters_mem_51873)\n{\n    bool x_49366 = x_49366_bits;\n    \n    #define segred_tblock_sizze_45608 (do_DBSCAN_doublezisegred_large_45615zisegred_tblock_sizze_45608)\n    #define chunk_sizze_51824 (do_DBSCAN_doublezisegred_large_45615zichunk_sizze_51824)\n    \n    volatile __local unsigned char *sync_arr_mem_51884_backing_2 = &shared_mem[0];\n    const int64_t sync_arr_mem_51884_backing_2_offset = 0 + 8;\n    volatile __local unsigned char *red_arr_f64_mem_51882_backing_1 = &shared_mem[sync_arr_mem_51884_backing_2_offset];\n    const int64_t red_arr_f64_mem_51882_backing_1_offset = sync_arr_mem_51884_backing_2_offset + ((int64_t) 8 * segred_tblock_sizze_45608 + srem64((int64_t) 8 - srem64((int64_t) 8 * segred_tblock_sizze_45608, (int64_t) 8), (int64_t) 8));\n    volatile __local unsigned char *red_arr_i64_mem_51880_backing_0 = &shared_mem[red_arr_f64_mem_51882_backing_1_offset];\n    const int64_t red_arr_i64_mem_51880_backing_0_offset = red_arr_f64_mem_51882_backing_1_offset + ((int64_t) 8 * segred_tblock_sizze_45608 + srem64((int64_t) 8 - srem64((int64_t) 8 * segred_tblock_sizze_45608, (int64_t) 8), (int64_t) 8));\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_51876;\n    int32_t tblock_sizze_51879;\n    int32_t wave_sizze_51878;\n    int32_t block_id_51877;\n    int32_t global_tid_51875;\n    int64_t phys_tid_45615;\n    __local unsigned char *red_arr_i64_mem_51880;\n    __local unsigned char *red_arr_f64_mem_51882;\n    __local unsigned char *sync_arr_mem_51884;\n    int32_t phys_tblock_id_51886;\n    int32_t iterations_51887;\n    \n    local_tid_51876 = get_local_id(0);\n    tblock_sizze_51879 = get_loc", "al_size(0);\n    wave_sizze_51878 = LOCKSTEP_WIDTH;\n    block_id_51877 = get_tblock_id(0);\n    global_tid_51875 = block_id_51877 * tblock_sizze_51879 + local_tid_51876;\n    phys_tid_45615 = sext_i32_i64(global_tid_51875);\n    red_arr_i64_mem_51880 = (__local unsigned char *) red_arr_i64_mem_51880_backing_0;\n    red_arr_f64_mem_51882 = (__local unsigned char *) red_arr_f64_mem_51882_backing_1;\n    sync_arr_mem_51884 = (__local unsigned char *) sync_arr_mem_51884_backing_2;\n    phys_tblock_id_51886 = get_tblock_id(0);\n    iterations_51887 = sdiv_up32(sext_i64_i32(num_virtblocks_51867) - phys_tblock_id_51886, sext_i64_i32(num_tblocks_45609));\n    for (int32_t i_51888 = 0; i_51888 < iterations_51887; i_51888++) {\n        int32_t virt_tblock_id_51889;\n        int64_t flat_segment_id_51890;\n        int64_t global_tid_51891;\n        int64_t slice_51892;\n        int64_t gtid_45613;\n        int64_t remnant_51893;\n        int64_t gtid_45614;\n        int64_t eta_p_block_res_acc_51894;\n        double eta_p_block_res_acc_51895;\n        int64_t eta_p_45616;\n        double eta_p_45617;\n        int64_t eta_p_45618;\n        double eta_p_45619;\n        int64_t tblock_id_in_segment_51908;\n        int64_t block_base_offset_51909;\n        int32_t offset_51912;\n        int32_t skip_waves_51913;\n        int64_t eta_p_51896;\n        double eta_p_51897;\n        int64_t eta_p_51898;\n        double eta_p_51899;\n        \n        virt_tblock_id_51889 = phys_tblock_id_51886 + i_51888 * sext_i64_i32(num_tblocks_45609);\n        flat_segment_id_51890 = squot64(sext_i32_i64(virt_tblock_id_51889), blocks_per_segment_51865);\n        global_tid_51891 = srem64(sext_i32_i64(virt_tblock_id_51889) * segred_tblock_sizze_45608 + sext_i32_i64(local_tid_51876), threads_per_segment_51868);\n        slice_51892 = dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_41966;\n        gtid_45613 = flat_segment_id_51890;\n        remnant_51893 = flat_segment_id_51890 - gtid_45613;\n        // ne-initialise the outer (per-block) accumulator(",
                                    "s)\n        {\n            eta_p_block_res_acc_51894 = (int64_t) -1;\n            eta_p_block_res_acc_51895 = INFINITY;\n        }\n        tblock_id_in_segment_51908 = squot64(global_tid_51891, segred_tblock_sizze_45608);\n        block_base_offset_51909 = tblock_id_in_segment_51908 * q_51866 * segred_tblock_sizze_45608;\n        for (int64_t i_51910 = 0; i_51910 < q_51866; i_51910++) {\n            int64_t block_offset_51911 = block_base_offset_51909 + i_51910 * segred_tblock_sizze_45608;\n            \n            gtid_45614 = global_tid_51891 + threads_per_segment_51868 * i_51910;\n            if (slt64(gtid_45614, conc_tmp_41556)) {\n                // apply map function(s)\n                {\n                    // apply map function\n                    {\n                        int64_t slice_46433 = inf_41963 + gtid_45613;\n                        double eta_p_45633 = ((__global double *) mem_49842)[gtid_45614];\n                        double eta_p_45634 = ((__global double *) mem_49844)[gtid_45614];\n                        int64_t x_45635 = ((__global int64_t *) ext_mem_49839)[gtid_45614];\n                        double d_haversine_res_45630;\n                        \n                        if (x_49366) {\n                            double x_49359 = ((__global double *) mem_49850)[gtid_45613];\n                            \n                            d_haversine_res_45630 = x_49359;\n                        } else {\n                            d_haversine_res_45630 = 0.0;\n                        }\n                        \n                        double d_haversine_res_45631;\n                        \n                        if (x_49366) {\n                            double x_49361 = ((__global double *) mem_49852)[gtid_45613];\n                            \n                            d_haversine_res_45631 = x_49361;\n                        } else {\n                            d_haversine_res_45631 = 0.0;\n                        }\n                        \n                      ", "  double cos_res_45632;\n                        \n                        if (x_49366) {\n                            double x_49363 = ((__global double *) mem_49854)[gtid_45613];\n                            \n                            cos_res_45632 = x_49363;\n                        } else {\n                            cos_res_45632 = 0.0;\n                        }\n                        \n                        double dist_res_45636;\n                        \n                        if (clBase_34769 == (int8_t) 0) {\n                            double eta_p_45628 = ((__global double *) mem_49454)[slice_46433];\n                            double eta_p_45629 = ((__global double *) mem_49456)[slice_46433];\n                            double zm_res_45637 = eta_p_45629 - eta_p_45634;\n                            double zm_res_45638 = eta_p_45628 - eta_p_45633;\n                            double hypot_res_45639 = futrts_hypot64(zm_res_45638, zm_res_45637);\n                            \n                            dist_res_45636 = hypot_res_45639;\n                        } else {\n                            double d_haversine_res_45640;\n                            double d_haversine_res_45641;\n                            \n                            if (clBase_34768 == (int8_t) 1) {\n                                d_haversine_res_45640 = eta_p_45633;\n                                d_haversine_res_45641 = eta_p_45634;\n                            } else {\n                                double zt_res_45642 = 3.141592653589793 * eta_p_45633;\n                                double zs_res_45643 = zt_res_45642 / 180.0;\n                                double zt_res_45644 = 3.141592653589793 * eta_p_45634;\n                                double zs_res_45645 = zt_res_45644 / 180.0;\n                                \n                                d_haversine_res_45640 = zs_res_45643;\n                                d_haversine_res_45641 = zs_res_45645;\n                            }\n ", "                           \n                            double zm_res_45646 = d_haversine_res_45630 - d_haversine_res_45640;\n                            double cos_res_45647 = futrts_cos64(zm_res_45646);\n                            double zm_res_45648 = 1.0 - cos_res_45647;\n                            double cos_res_45649 = futrts_cos64(d_haversine_res_45640);\n                            double zt_res_45650 = cos_res_45632 * cos_res_45649;\n                            double zm_res_45651 = d_haversine_res_45631 - d_haversine_res_45641;\n                            double zm_res_45652 = 1.0 - zm_res_45651;\n                            double zt_res_45653 = zt_res_45650 * zm_res_45652;\n                            double zp_res_45654 = zm_res_45648 + zt_res_45653;\n                            double zs_res_45655 = zp_res_45654 / 2.0;\n                            double min_res_45656 = fmin64(1.0, zs_res_45655);\n                            double zt_res_45657 = 2.0 * min_res_45656;\n                            double zm_res_45658 = 1.0 - zt_res_45657;\n                            double acos_res_45659 = futrts_acos64(zm_res_45658);\n                            double zt_res_45660 = clBase_34776 * acos_res_45659;\n                            \n                            dist_res_45636 = zt_res_45660;\n                        }\n                        // load accumulator(s)\n                        {\n                            eta_p_45616 = eta_p_block_res_acc_51894;\n                            eta_p_45617 = eta_p_block_res_acc_51895;\n                        }\n                        // load next value(s)\n                        {\n                            eta_p_45618 = x_45635;\n                            eta_p_45619 = dist_res_45636;\n                        }\n                        // apply reduction operator(s)\n                        {\n                            bool zg_res_45620 = clBase_34770 < eta_p_45617;\n                            bool zg_res_45621 = clBase_34770 < et",
                                    "a_p_45619;\n                            bool x_45622 = zg_res_45620 && zg_res_45621;\n                            int64_t lifted_lambda_res_45623;\n                            double lifted_lambda_res_45624;\n                            \n                            if (x_45622) {\n                                lifted_lambda_res_45623 = (int64_t) -1;\n                                lifted_lambda_res_45624 = INFINITY;\n                            } else {\n                                bool zl_res_45625 = eta_p_45617 < eta_p_45619;\n                                int64_t lifted_lambda_res_f_res_45626;\n                                \n                                if (zl_res_45625) {\n                                    lifted_lambda_res_f_res_45626 = eta_p_45616;\n                                } else {\n                                    lifted_lambda_res_f_res_45626 = eta_p_45618;\n                                }\n                                \n                                double lifted_lambda_res_f_res_45627;\n                                \n                                if (zl_res_45625) {\n                                    lifted_lambda_res_f_res_45627 = eta_p_45617;\n                                } else {\n                                    lifted_lambda_res_f_res_45627 = eta_p_45619;\n                                }\n                                lifted_lambda_res_45623 = lifted_lambda_res_f_res_45626;\n                                lifted_lambda_res_45624 = lifted_lambda_res_f_res_45627;\n                            }\n                            // store in accumulator(s)\n                            {\n                                eta_p_block_res_acc_51894 = lifted_lambda_res_45623;\n                                eta_p_block_res_acc_51895 = lifted_lambda_res_45624;\n                            }\n                        }\n                    }\n                }\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        // store accs. prims", " go in lmem; non-prims in params (in global mem)\n        {\n            ((__local int64_t *) red_arr_i64_mem_51880)[sext_i32_i64(local_tid_51876)] = eta_p_block_res_acc_51894;\n            ((__local double *) red_arr_f64_mem_51882)[sext_i32_i64(local_tid_51876)] = eta_p_block_res_acc_51895;\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        skip_waves_51913 = 1;\n        offset_51912 = 0;\n        // participating threads read initial accumulator\n        {\n            if (slt32(local_tid_51876, sext_i64_i32(segred_tblock_sizze_45608))) {\n                eta_p_51896 = ((__local int64_t *) red_arr_i64_mem_51880)[sext_i32_i64(local_tid_51876 + offset_51912)];\n                eta_p_51897 = ((__local double *) red_arr_f64_mem_51882)[sext_i32_i64(local_tid_51876 + offset_51912)];\n            }\n        }\n        offset_51912 = 1;\n        while (slt32(offset_51912, wave_sizze_51878)) {\n            if (slt32(local_tid_51876 + offset_51912, sext_i64_i32(segred_tblock_sizze_45608)) && ((local_tid_51876 - squot32(local_tid_51876, wave_sizze_51878) * wave_sizze_51878) & (2 * offset_51912 - 1)) == 0) {\n                // read array element\n                {\n                    eta_p_51898 = ((volatile __local int64_t *) red_arr_i64_mem_51880)[sext_i32_i64(local_tid_51876 + offset_51912)];\n                    eta_p_51899 = ((volatile __local double *) red_arr_f64_mem_51882)[sext_i32_i64(local_tid_51876 + offset_51912)];\n                }\n                // apply reduction operation\n                {\n                    bool zg_res_51900 = clBase_34770 < eta_p_51897;\n                    bool zg_res_51901 = clBase_34770 < eta_p_51899;\n                    bool x_51902 = zg_res_51900 && zg_res_51901;\n                    int64_t lifted_lambda_res_51903;\n                    double lifted_lambda_res_51904;\n                    \n                    if (x_51902) {\n                        lifted_lambda_res_51903 = (int64_t) -1;\n                        lifted_lambda_res_51904 = INFINITY;\n   ", "                 } else {\n                        bool zl_res_51905 = eta_p_51897 < eta_p_51899;\n                        int64_t lifted_lambda_res_f_res_51906;\n                        \n                        if (zl_res_51905) {\n                            lifted_lambda_res_f_res_51906 = eta_p_51896;\n                        } else {\n                            lifted_lambda_res_f_res_51906 = eta_p_51898;\n                        }\n                        \n                        double lifted_lambda_res_f_res_51907;\n                        \n                        if (zl_res_51905) {\n                            lifted_lambda_res_f_res_51907 = eta_p_51897;\n                        } else {\n                            lifted_lambda_res_f_res_51907 = eta_p_51899;\n                        }\n                        lifted_lambda_res_51903 = lifted_lambda_res_f_res_51906;\n                        lifted_lambda_res_51904 = lifted_lambda_res_f_res_51907;\n                    }\n                    eta_p_51896 = lifted_lambda_res_51903;\n                    eta_p_51897 = lifted_lambda_res_51904;\n                }\n                // write result of operation\n                {\n                    ((volatile __local int64_t *) red_arr_i64_mem_51880)[sext_i32_i64(local_tid_51876)] = eta_p_51896;\n                    ((volatile __local double *) red_arr_f64_mem_51882)[sext_i32_i64(local_tid_51876)] = eta_p_51897;\n                }\n            }\n            offset_51912 *= 2;\n        }\n        while (slt32(skip_waves_51913, squot32(sext_i64_i32(segred_tblock_sizze_45608) + wave_sizze_51878 - 1, wave_sizze_51878))) {\n            barrier(CLK_LOCAL_MEM_FENCE);\n            offset_51912 = skip_waves_51913 * wave_sizze_51878;\n            if (slt32(local_tid_51876 + offset_51912, sext_i64_i32(segred_tblock_sizze_45608)) && ((local_tid_51876 - squot32(local_tid_51876, wave_sizze_51878) * wave_sizze_51878) == 0 && (squot32(local_tid_51876, wave_sizze_51878) & (2 * skip_waves_51913 - 1)) == 0)) {\n ",
                                    "               // read array element\n                {\n                    eta_p_51898 = ((__local int64_t *) red_arr_i64_mem_51880)[sext_i32_i64(local_tid_51876 + offset_51912)];\n                    eta_p_51899 = ((__local double *) red_arr_f64_mem_51882)[sext_i32_i64(local_tid_51876 + offset_51912)];\n                }\n                // apply reduction operation\n                {\n                    bool zg_res_51900 = clBase_34770 < eta_p_51897;\n                    bool zg_res_51901 = clBase_34770 < eta_p_51899;\n                    bool x_51902 = zg_res_51900 && zg_res_51901;\n                    int64_t lifted_lambda_res_51903;\n                    double lifted_lambda_res_51904;\n                    \n                    if (x_51902) {\n                        lifted_lambda_res_51903 = (int64_t) -1;\n                        lifted_lambda_res_51904 = INFINITY;\n                    } else {\n                        bool zl_res_51905 = eta_p_51897 < eta_p_51899;\n                        int64_t lifted_lambda_res_f_res_51906;\n                        \n                        if (zl_res_51905) {\n                            lifted_lambda_res_f_res_51906 = eta_p_51896;\n                        } else {\n                            lifted_lambda_res_f_res_51906 = eta_p_51898;\n                        }\n                        \n                        double lifted_lambda_res_f_res_51907;\n                        \n                        if (zl_res_51905) {\n                            lifted_lambda_res_f_res_51907 = eta_p_51897;\n                        } else {\n                            lifted_lambda_res_f_res_51907 = eta_p_51899;\n                        }\n                        lifted_lambda_res_51903 = lifted_lambda_res_f_res_51906;\n                        lifted_lambda_res_51904 = lifted_lambda_res_f_res_51907;\n                    }\n                    eta_p_51896 = lifted_lambda_res_51903;\n                    eta_p_51897 = lifted_lambda_res_51904;\n                }\n           ", "     // write result of operation\n                {\n                    ((__local int64_t *) red_arr_i64_mem_51880)[sext_i32_i64(local_tid_51876)] = eta_p_51896;\n                    ((__local double *) red_arr_f64_mem_51882)[sext_i32_i64(local_tid_51876)] = eta_p_51897;\n                }\n            }\n            skip_waves_51913 *= 2;\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        barrier(CLK_LOCAL_MEM_FENCE);\n        // thread 0 updates per-block acc(s); rest reset to ne\n        {\n            if (sext_i32_i64(local_tid_51876) == (int64_t) 0) {\n                eta_p_block_res_acc_51894 = eta_p_51896;\n                eta_p_block_res_acc_51895 = eta_p_51897;\n            } else {\n                eta_p_block_res_acc_51894 = (int64_t) -1;\n                eta_p_block_res_acc_51895 = INFINITY;\n            }\n        }\n        if (blocks_per_segment_51865 == (int64_t) 1) {\n            // first thread in block saves final result to memory\n            {\n                if (local_tid_51876 == 0) {\n                    ((__global int64_t *) mem_49494)[inf_41963 + gtid_45613] = eta_p_block_res_acc_51894;\n                    ((__global double *) mem_49859)[gtid_45613] = eta_p_block_res_acc_51895;\n                }\n            }\n        } else {\n            int32_t old_counter_51914;\n            bool is_last_block_51915;\n            \n            // first thread in block saves block result to global memory\n            {\n                if (local_tid_51876 == 0) {\n                    ((__global int64_t *) segred_tmp_mem_51869)[sext_i32_i64(virt_tblock_id_51889)] = eta_p_block_res_acc_51894;\n                    mem_fence_global();\n                    ((__global double *) segred_tmp_mem_51871)[sext_i32_i64(virt_tblock_id_51889)] = eta_p_block_res_acc_51895;\n                    mem_fence_global();\n                    old_counter_51914 = atomic_add_i32_global(&((volatile __global int *) counters_mem_51873)[srem64(flat_segment_id_51890, (int64_t) 20480)], (int) 1);\n              ", "      ((__local bool *) sync_arr_mem_51884)[(int64_t) 0] = old_counter_51914 == sext_i64_i32(blocks_per_segment_51865 - (int64_t) 1);\n                }\n            }\n            barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n            is_last_block_51915 = ((__local bool *) sync_arr_mem_51884)[(int64_t) 0];\n            if (is_last_block_51915) {\n                if (local_tid_51876 == 0) {\n                    old_counter_51914 = atomic_add_i32_global(&((volatile __global int *) counters_mem_51873)[srem64(flat_segment_id_51890, (int64_t) 20480)], (int) sext_i64_i32((int64_t) 0 - blocks_per_segment_51865));\n                }\n                // read in the per-block-results\n                {\n                    int64_t read_per_thread_51916 = sdiv_up64(blocks_per_segment_51865, segred_tblock_sizze_45608);\n                    \n                    eta_p_45616 = (int64_t) -1;\n                    eta_p_45617 = INFINITY;\n                    for (int64_t i_51917 = 0; i_51917 < read_per_thread_51916; i_51917++) {\n                        int64_t block_res_id_51918 = sext_i32_i64(local_tid_51876) * read_per_thread_51916 + i_51917;\n                        int64_t index_of_block_res_51919 = flat_segment_id_51890 * blocks_per_segment_51865 + block_res_id_51918;\n                        \n                        if (slt64(block_res_id_51918, blocks_per_segment_51865)) {\n                            eta_p_45618 = ((__global int64_t *) segred_tmp_mem_51869)[index_of_block_res_51919];\n                            eta_p_45619 = ((__global double *) segred_tmp_mem_51871)[index_of_block_res_51919];\n                            \n                            bool zg_res_45620 = clBase_34770 < eta_p_45617;\n                            bool zg_res_45621 = clBase_34770 < eta_p_45619;\n                            bool x_45622 = zg_res_45620 && zg_res_45621;\n                            int64_t lifted_lambda_res_45623;\n                            double lifted_lambda_res_45624;\n                  ",
                                    "          \n                            if (x_45622) {\n                                lifted_lambda_res_45623 = (int64_t) -1;\n                                lifted_lambda_res_45624 = INFINITY;\n                            } else {\n                                bool zl_res_45625 = eta_p_45617 < eta_p_45619;\n                                int64_t lifted_lambda_res_f_res_45626;\n                                \n                                if (zl_res_45625) {\n                                    lifted_lambda_res_f_res_45626 = eta_p_45616;\n                                } else {\n                                    lifted_lambda_res_f_res_45626 = eta_p_45618;\n                                }\n                                \n                                double lifted_lambda_res_f_res_45627;\n                                \n                                if (zl_res_45625) {\n                                    lifted_lambda_res_f_res_45627 = eta_p_45617;\n                                } else {\n                                    lifted_lambda_res_f_res_45627 = eta_p_45619;\n                                }\n                                lifted_lambda_res_45623 = lifted_lambda_res_f_res_45626;\n                                lifted_lambda_res_45624 = lifted_lambda_res_f_res_45627;\n                            }\n                            eta_p_45616 = lifted_lambda_res_45623;\n                            eta_p_45617 = lifted_lambda_res_45624;\n                        }\n                    }\n                }\n                ((__local int64_t *) red_arr_i64_mem_51880)[sext_i32_i64(local_tid_51876)] = eta_p_45616;\n                ((__local double *) red_arr_f64_mem_51882)[sext_i32_i64(local_tid_51876)] = eta_p_45617;\n                barrier(CLK_LOCAL_MEM_FENCE);\n                // reduce the per-block results\n                {\n                    int32_t offset_51920;\n                    int32_t skip_waves_51921 = 1;\n                    int64_t eta_p_51896;\n        ", "            double eta_p_51897;\n                    int64_t eta_p_51898;\n                    double eta_p_51899;\n                    \n                    offset_51920 = 0;\n                    // participating threads read initial accumulator\n                    {\n                        if (slt32(local_tid_51876, sext_i64_i32(segred_tblock_sizze_45608))) {\n                            eta_p_51896 = ((__local int64_t *) red_arr_i64_mem_51880)[sext_i32_i64(local_tid_51876 + offset_51920)];\n                            eta_p_51897 = ((__local double *) red_arr_f64_mem_51882)[sext_i32_i64(local_tid_51876 + offset_51920)];\n                        }\n                    }\n                    offset_51920 = 1;\n                    while (slt32(offset_51920, wave_sizze_51878)) {\n                        if (slt32(local_tid_51876 + offset_51920, sext_i64_i32(segred_tblock_sizze_45608)) && ((local_tid_51876 - squot32(local_tid_51876, wave_sizze_51878) * wave_sizze_51878) & (2 * offset_51920 - 1)) == 0) {\n                            // read array element\n                            {\n                                eta_p_51898 = ((volatile __local int64_t *) red_arr_i64_mem_51880)[sext_i32_i64(local_tid_51876 + offset_51920)];\n                                eta_p_51899 = ((volatile __local double *) red_arr_f64_mem_51882)[sext_i32_i64(local_tid_51876 + offset_51920)];\n                            }\n                            // apply reduction operation\n                            {\n                                bool zg_res_51900 = clBase_34770 < eta_p_51897;\n                                bool zg_res_51901 = clBase_34770 < eta_p_51899;\n                                bool x_51902 = zg_res_51900 && zg_res_51901;\n                                int64_t lifted_lambda_res_51903;\n                                double lifted_lambda_res_51904;\n                                \n                                if (x_51902) {\n                                    lifted_lambda_res_51903 =", " (int64_t) -1;\n                                    lifted_lambda_res_51904 = INFINITY;\n                                } else {\n                                    bool zl_res_51905 = eta_p_51897 < eta_p_51899;\n                                    int64_t lifted_lambda_res_f_res_51906;\n                                    \n                                    if (zl_res_51905) {\n                                        lifted_lambda_res_f_res_51906 = eta_p_51896;\n                                    } else {\n                                        lifted_lambda_res_f_res_51906 = eta_p_51898;\n                                    }\n                                    \n                                    double lifted_lambda_res_f_res_51907;\n                                    \n                                    if (zl_res_51905) {\n                                        lifted_lambda_res_f_res_51907 = eta_p_51897;\n                                    } else {\n                                        lifted_lambda_res_f_res_51907 = eta_p_51899;\n                                    }\n                                    lifted_lambda_res_51903 = lifted_lambda_res_f_res_51906;\n                                    lifted_lambda_res_51904 = lifted_lambda_res_f_res_51907;\n                                }\n                                eta_p_51896 = lifted_lambda_res_51903;\n                                eta_p_51897 = lifted_lambda_res_51904;\n                            }\n                            // write result of operation\n                            {\n                                ((volatile __local int64_t *) red_arr_i64_mem_51880)[sext_i32_i64(local_tid_51876)] = eta_p_51896;\n                                ((volatile __local double *) red_arr_f64_mem_51882)[sext_i32_i64(local_tid_51876)] = eta_p_51897;\n                            }\n                        }\n                        offset_51920 *= 2;\n                    }\n                    while (slt32(skip_waves_51921,",
                                    " squot32(sext_i64_i32(segred_tblock_sizze_45608) + wave_sizze_51878 - 1, wave_sizze_51878))) {\n                        barrier(CLK_LOCAL_MEM_FENCE);\n                        offset_51920 = skip_waves_51921 * wave_sizze_51878;\n                        if (slt32(local_tid_51876 + offset_51920, sext_i64_i32(segred_tblock_sizze_45608)) && ((local_tid_51876 - squot32(local_tid_51876, wave_sizze_51878) * wave_sizze_51878) == 0 && (squot32(local_tid_51876, wave_sizze_51878) & (2 * skip_waves_51921 - 1)) == 0)) {\n                            // read array element\n                            {\n                                eta_p_51898 = ((__local int64_t *) red_arr_i64_mem_51880)[sext_i32_i64(local_tid_51876 + offset_51920)];\n                                eta_p_51899 = ((__local double *) red_arr_f64_mem_51882)[sext_i32_i64(local_tid_51876 + offset_51920)];\n                            }\n                            // apply reduction operation\n                            {\n                                bool zg_res_51900 = clBase_34770 < eta_p_51897;\n                                bool zg_res_51901 = clBase_34770 < eta_p_51899;\n                                bool x_51902 = zg_res_51900 && zg_res_51901;\n                                int64_t lifted_lambda_res_51903;\n                                double lifted_lambda_res_51904;\n                                \n                                if (x_51902) {\n                                    lifted_lambda_res_51903 = (int64_t) -1;\n                                    lifted_lambda_res_51904 = INFINITY;\n                                } else {\n                                    bool zl_res_51905 = eta_p_51897 < eta_p_51899;\n                                    int64_t lifted_lambda_res_f_res_51906;\n                                    \n                                    if (zl_res_51905) {\n                                        lifted_lambda_res_f_res_51906 = eta_p_51896;\n                                    } else {\n     ", "                                   lifted_lambda_res_f_res_51906 = eta_p_51898;\n                                    }\n                                    \n                                    double lifted_lambda_res_f_res_51907;\n                                    \n                                    if (zl_res_51905) {\n                                        lifted_lambda_res_f_res_51907 = eta_p_51897;\n                                    } else {\n                                        lifted_lambda_res_f_res_51907 = eta_p_51899;\n                                    }\n                                    lifted_lambda_res_51903 = lifted_lambda_res_f_res_51906;\n                                    lifted_lambda_res_51904 = lifted_lambda_res_f_res_51907;\n                                }\n                                eta_p_51896 = lifted_lambda_res_51903;\n                                eta_p_51897 = lifted_lambda_res_51904;\n                            }\n                            // write result of operation\n                            {\n                                ((__local int64_t *) red_arr_i64_mem_51880)[sext_i32_i64(local_tid_51876)] = eta_p_51896;\n                                ((__local double *) red_arr_f64_mem_51882)[sext_i32_i64(local_tid_51876)] = eta_p_51897;\n                            }\n                        }\n                        skip_waves_51921 *= 2;\n                    }\n                    barrier(CLK_LOCAL_MEM_FENCE);\n                    // and back to memory with the final result\n                    {\n                        if (local_tid_51876 == 0) {\n                            ((__global int64_t *) mem_49494)[inf_41963 + gtid_45613] = eta_p_51896;\n                            ((__global double *) mem_49859)[gtid_45613] = eta_p_51897;\n                        }\n                    }\n                }\n            }\n        }\n        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    }\n    \n  error_6:\n    return;\n    #undef segred_", "tblock_sizze_45608\n    #undef chunk_sizze_51824\n}\nFUTHARK_KERNEL_SIZED(do_DBSCAN_doublezisegred_large_45909_dim1, 1, 1)\nvoid do_DBSCAN_doublezisegred_large_45909(__global int *global_failure, int8_t clBase_34768, int8_t clBase_34769, double clBase_34770, double clBase_34776, int64_t conc_tmp_41556, int64_t inf_42046, int64_t dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_42049, int64_t num_tblocks_45903, unsigned char x_49366_bits, int64_t blocks_per_segment_52024, int64_t q_52025, int64_t num_virtblocks_52026, int64_t threads_per_segment_52027, __global unsigned char *current_partition_mem_49387, __global unsigned char *current_partition_mem_49388, __global unsigned char *mem_49424, __global unsigned char *ext_mem_49839, __global unsigned char *mem_49842, __global unsigned char *mem_49844, __global unsigned char *mem_49940, __global unsigned char *mem_49942, __global unsigned char *mem_49944, __global unsigned char *mem_49949, __global unsigned char *segred_tmp_mem_52028, __global unsigned char *segred_tmp_mem_52030, __global unsigned char *counters_mem_52032)\n{\n    bool x_49366 = x_49366_bits;\n    \n    #define segred_tblock_sizze_45902 (do_DBSCAN_doublezisegred_large_45909zisegred_tblock_sizze_45902)\n    #define chunk_sizze_51983 (do_DBSCAN_doublezisegred_large_45909zichunk_sizze_51983)\n    \n    volatile __local unsigned char *sync_arr_mem_52043_backing_2 = &shared_mem[0];\n    const int64_t sync_arr_mem_52043_backing_2_offset = 0 + 8;\n    volatile __local unsigned char *red_arr_f64_mem_52041_backing_1 = &shared_mem[sync_arr_mem_52043_backing_2_offset];\n    const int64_t red_arr_f64_mem_52041_backing_1_offset = sync_arr_mem_52043_backing_2_offset + ((int64_t) 8 * segred_tblock_sizze_45902 + srem64((int64_t) 8 - srem64((int64_t) 8 * segred_tblock_sizze_45902, (int64_t) 8), (int64_t) 8));\n    volatile __local unsigned char *red_arr_i64_mem_52039_backing_0 = &shared_mem[red_arr_f64_mem_52041_backing_1_offset];\n    const int64_t red_arr_i64_mem_52039_backing_0_offset = red_arr_f64_",
                                    "mem_52041_backing_1_offset + ((int64_t) 8 * segred_tblock_sizze_45902 + srem64((int64_t) 8 - srem64((int64_t) 8 * segred_tblock_sizze_45902, (int64_t) 8), (int64_t) 8));\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_52035;\n    int32_t tblock_sizze_52038;\n    int32_t wave_sizze_52037;\n    int32_t block_id_52036;\n    int32_t global_tid_52034;\n    int64_t phys_tid_45909;\n    __local unsigned char *red_arr_i64_mem_52039;\n    __local unsigned char *red_arr_f64_mem_52041;\n    __local unsigned char *sync_arr_mem_52043;\n    int32_t phys_tblock_id_52045;\n    int32_t iterations_52046;\n    \n    local_tid_52035 = get_local_id(0);\n    tblock_sizze_52038 = get_local_size(0);\n    wave_sizze_52037 = LOCKSTEP_WIDTH;\n    block_id_52036 = get_tblock_id(0);\n    global_tid_52034 = block_id_52036 * tblock_sizze_52038 + local_tid_52035;\n    phys_tid_45909 = sext_i32_i64(global_tid_52034);\n    red_arr_i64_mem_52039 = (__local unsigned char *) red_arr_i64_mem_52039_backing_0;\n    red_arr_f64_mem_52041 = (__local unsigned char *) red_arr_f64_mem_52041_backing_1;\n    sync_arr_mem_52043 = (__local unsigned char *) sync_arr_mem_52043_backing_2;\n    phys_tblock_id_52045 = get_tblock_id(0);\n    iterations_52046 = sdiv_up32(sext_i64_i32(num_virtblocks_52026) - phys_tblock_id_52045, sext_i64_i32(num_tblocks_45903));\n    for (int32_t i_52047 = 0; i_52047 < iterations_52046; i_52047++) {\n        int32_t virt_tblock_id_52048;\n        int64_t flat_segment_id_52049;\n        int64_t global_tid_52050;\n        int64_t slice_52051;\n        int64_t gtid_45907;\n        int64_t remnant_52052;\n        int64_t gtid_45908;\n        int64_t eta_p_block_res_acc_52053;\n        double eta_p_block_res_acc_52054;\n        int64_t eta_p_45910;\n        double eta_p_45911;\n        int64_t eta_p_45912;\n        double eta_p_45913;\n        int64_t tblock_id_in_segment_52067;\n        int64_t block_base_offset_52068;\n        int32_t offset_52071;\n        int32_t skip_waves_52072;\n        int64_t e", "ta_p_52055;\n        double eta_p_52056;\n        int64_t eta_p_52057;\n        double eta_p_52058;\n        \n        virt_tblock_id_52048 = phys_tblock_id_52045 + i_52047 * sext_i64_i32(num_tblocks_45903);\n        flat_segment_id_52049 = squot64(sext_i32_i64(virt_tblock_id_52048), blocks_per_segment_52024);\n        global_tid_52050 = srem64(sext_i32_i64(virt_tblock_id_52048) * segred_tblock_sizze_45902 + sext_i32_i64(local_tid_52035), threads_per_segment_52027);\n        slice_52051 = dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_42049;\n        gtid_45907 = flat_segment_id_52049;\n        remnant_52052 = flat_segment_id_52049 - gtid_45907;\n        // ne-initialise the outer (per-block) accumulator(s)\n        {\n            eta_p_block_res_acc_52053 = (int64_t) -1;\n            eta_p_block_res_acc_52054 = INFINITY;\n        }\n        tblock_id_in_segment_52067 = squot64(global_tid_52050, segred_tblock_sizze_45902);\n        block_base_offset_52068 = tblock_id_in_segment_52067 * q_52025 * segred_tblock_sizze_45902;\n        for (int64_t i_52069 = 0; i_52069 < q_52025; i_52069++) {\n            int64_t block_offset_52070 = block_base_offset_52068 + i_52069 * segred_tblock_sizze_45902;\n            \n            gtid_45908 = global_tid_52050 + threads_per_segment_52027 * i_52069;\n            if (slt64(gtid_45908, conc_tmp_41556)) {\n                // apply map function(s)\n                {\n                    // apply map function\n                    {\n                        int64_t slice_46427 = inf_42046 + gtid_45907;\n                        double eta_p_45927 = ((__global double *) mem_49842)[gtid_45908];\n                        double eta_p_45928 = ((__global double *) mem_49844)[gtid_45908];\n                        int64_t x_45929 = ((__global int64_t *) ext_mem_49839)[gtid_45908];\n                        double d_haversine_res_45924;\n                        \n                        if (x_49366) {\n                            double x_49350 = ((__global double *) mem_49940)[gtid_45907];\n  ", "                          \n                            d_haversine_res_45924 = x_49350;\n                        } else {\n                            d_haversine_res_45924 = 0.0;\n                        }\n                        \n                        double d_haversine_res_45925;\n                        \n                        if (x_49366) {\n                            double x_49352 = ((__global double *) mem_49942)[gtid_45907];\n                            \n                            d_haversine_res_45925 = x_49352;\n                        } else {\n                            d_haversine_res_45925 = 0.0;\n                        }\n                        \n                        double cos_res_45926;\n                        \n                        if (x_49366) {\n                            double x_49354 = ((__global double *) mem_49944)[gtid_45907];\n                            \n                            cos_res_45926 = x_49354;\n                        } else {\n                            cos_res_45926 = 0.0;\n                        }\n                        \n                        double dist_res_45930;\n                        \n                        if (clBase_34769 == (int8_t) 0) {\n                            double eta_p_45922 = ((__global double *) current_partition_mem_49387)[slice_46427];\n                            double eta_p_45923 = ((__global double *) current_partition_mem_49388)[slice_46427];\n                            double zm_res_45931 = eta_p_45923 - eta_p_45928;\n                            double zm_res_45932 = eta_p_45922 - eta_p_45927;\n                            double hypot_res_45933 = futrts_hypot64(zm_res_45932, zm_res_45931);\n                            \n                            dist_res_45930 = hypot_res_45933;\n                        } else {\n                            double d_haversine_res_45934;\n                            double d_haversine_res_45935;\n                            \n                            if (clBase_34",
                                    "768 == (int8_t) 1) {\n                                d_haversine_res_45934 = eta_p_45927;\n                                d_haversine_res_45935 = eta_p_45928;\n                            } else {\n                                double zt_res_45936 = 3.141592653589793 * eta_p_45927;\n                                double zs_res_45937 = zt_res_45936 / 180.0;\n                                double zt_res_45938 = 3.141592653589793 * eta_p_45928;\n                                double zs_res_45939 = zt_res_45938 / 180.0;\n                                \n                                d_haversine_res_45934 = zs_res_45937;\n                                d_haversine_res_45935 = zs_res_45939;\n                            }\n                            \n                            double zm_res_45940 = d_haversine_res_45924 - d_haversine_res_45934;\n                            double cos_res_45941 = futrts_cos64(zm_res_45940);\n                            double zm_res_45942 = 1.0 - cos_res_45941;\n                            double cos_res_45943 = futrts_cos64(d_haversine_res_45934);\n                            double zt_res_45944 = cos_res_45926 * cos_res_45943;\n                            double zm_res_45945 = d_haversine_res_45925 - d_haversine_res_45935;\n                            double zm_res_45946 = 1.0 - zm_res_45945;\n                            double zt_res_45947 = zt_res_45944 * zm_res_45946;\n                            double zp_res_45948 = zm_res_45942 + zt_res_45947;\n                            double zs_res_45949 = zp_res_45948 / 2.0;\n                            double min_res_45950 = fmin64(1.0, zs_res_45949);\n                            double zt_res_45951 = 2.0 * min_res_45950;\n                            double zm_res_45952 = 1.0 - zt_res_45951;\n                            double acos_res_45953 = futrts_acos64(zm_res_45952);\n                            double zt_res_45954 = clBase_34776 * acos_res_45953;\n                            \n                         ", "   dist_res_45930 = zt_res_45954;\n                        }\n                        // load accumulator(s)\n                        {\n                            eta_p_45910 = eta_p_block_res_acc_52053;\n                            eta_p_45911 = eta_p_block_res_acc_52054;\n                        }\n                        // load next value(s)\n                        {\n                            eta_p_45912 = x_45929;\n                            eta_p_45913 = dist_res_45930;\n                        }\n                        // apply reduction operator(s)\n                        {\n                            bool zg_res_45914 = clBase_34770 < eta_p_45911;\n                            bool zg_res_45915 = clBase_34770 < eta_p_45913;\n                            bool x_45916 = zg_res_45914 && zg_res_45915;\n                            int64_t lifted_lambda_res_45917;\n                            double lifted_lambda_res_45918;\n                            \n                            if (x_45916) {\n                                lifted_lambda_res_45917 = (int64_t) -1;\n                                lifted_lambda_res_45918 = INFINITY;\n                            } else {\n                                bool zl_res_45919 = eta_p_45911 < eta_p_45913;\n                                int64_t lifted_lambda_res_f_res_45920;\n                                \n                                if (zl_res_45919) {\n                                    lifted_lambda_res_f_res_45920 = eta_p_45910;\n                                } else {\n                                    lifted_lambda_res_f_res_45920 = eta_p_45912;\n                                }\n                                \n                                double lifted_lambda_res_f_res_45921;\n                                \n                                if (zl_res_45919) {\n                                    lifted_lambda_res_f_res_45921 = eta_p_45911;\n                                } else {\n                                    li", "fted_lambda_res_f_res_45921 = eta_p_45913;\n                                }\n                                lifted_lambda_res_45917 = lifted_lambda_res_f_res_45920;\n                                lifted_lambda_res_45918 = lifted_lambda_res_f_res_45921;\n                            }\n                            // store in accumulator(s)\n                            {\n                                eta_p_block_res_acc_52053 = lifted_lambda_res_45917;\n                                eta_p_block_res_acc_52054 = lifted_lambda_res_45918;\n                            }\n                        }\n                    }\n                }\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        // store accs. prims go in lmem; non-prims in params (in global mem)\n        {\n            ((__local int64_t *) red_arr_i64_mem_52039)[sext_i32_i64(local_tid_52035)] = eta_p_block_res_acc_52053;\n            ((__local double *) red_arr_f64_mem_52041)[sext_i32_i64(local_tid_52035)] = eta_p_block_res_acc_52054;\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        skip_waves_52072 = 1;\n        offset_52071 = 0;\n        // participating threads read initial accumulator\n        {\n            if (slt32(local_tid_52035, sext_i64_i32(segred_tblock_sizze_45902))) {\n                eta_p_52055 = ((__local int64_t *) red_arr_i64_mem_52039)[sext_i32_i64(local_tid_52035 + offset_52071)];\n                eta_p_52056 = ((__local double *) red_arr_f64_mem_52041)[sext_i32_i64(local_tid_52035 + offset_52071)];\n            }\n        }\n        offset_52071 = 1;\n        while (slt32(offset_52071, wave_sizze_52037)) {\n            if (slt32(local_tid_52035 + offset_52071, sext_i64_i32(segred_tblock_sizze_45902)) && ((local_tid_52035 - squot32(local_tid_52035, wave_sizze_52037) * wave_sizze_52037) & (2 * offset_52071 - 1)) == 0) {\n                // read array element\n                {\n                    eta_p_52057 = ((volatile __local int64_t *) red_arr_i64_mem_52039)[sext_i32_i64(local_tid_5",
                                    "2035 + offset_52071)];\n                    eta_p_52058 = ((volatile __local double *) red_arr_f64_mem_52041)[sext_i32_i64(local_tid_52035 + offset_52071)];\n                }\n                // apply reduction operation\n                {\n                    bool zg_res_52059 = clBase_34770 < eta_p_52056;\n                    bool zg_res_52060 = clBase_34770 < eta_p_52058;\n                    bool x_52061 = zg_res_52059 && zg_res_52060;\n                    int64_t lifted_lambda_res_52062;\n                    double lifted_lambda_res_52063;\n                    \n                    if (x_52061) {\n                        lifted_lambda_res_52062 = (int64_t) -1;\n                        lifted_lambda_res_52063 = INFINITY;\n                    } else {\n                        bool zl_res_52064 = eta_p_52056 < eta_p_52058;\n                        int64_t lifted_lambda_res_f_res_52065;\n                        \n                        if (zl_res_52064) {\n                            lifted_lambda_res_f_res_52065 = eta_p_52055;\n                        } else {\n                            lifted_lambda_res_f_res_52065 = eta_p_52057;\n                        }\n                        \n                        double lifted_lambda_res_f_res_52066;\n                        \n                        if (zl_res_52064) {\n                            lifted_lambda_res_f_res_52066 = eta_p_52056;\n                        } else {\n                            lifted_lambda_res_f_res_52066 = eta_p_52058;\n                        }\n                        lifted_lambda_res_52062 = lifted_lambda_res_f_res_52065;\n                        lifted_lambda_res_52063 = lifted_lambda_res_f_res_52066;\n                    }\n                    eta_p_52055 = lifted_lambda_res_52062;\n                    eta_p_52056 = lifted_lambda_res_52063;\n                }\n                // write result of operation\n                {\n                    ((volatile __local int64_t *) red_arr_i64_mem_52039)[sext_i32_i64(local_tid_", "52035)] = eta_p_52055;\n                    ((volatile __local double *) red_arr_f64_mem_52041)[sext_i32_i64(local_tid_52035)] = eta_p_52056;\n                }\n            }\n            offset_52071 *= 2;\n        }\n        while (slt32(skip_waves_52072, squot32(sext_i64_i32(segred_tblock_sizze_45902) + wave_sizze_52037 - 1, wave_sizze_52037))) {\n            barrier(CLK_LOCAL_MEM_FENCE);\n            offset_52071 = skip_waves_52072 * wave_sizze_52037;\n            if (slt32(local_tid_52035 + offset_52071, sext_i64_i32(segred_tblock_sizze_45902)) && ((local_tid_52035 - squot32(local_tid_52035, wave_sizze_52037) * wave_sizze_52037) == 0 && (squot32(local_tid_52035, wave_sizze_52037) & (2 * skip_waves_52072 - 1)) == 0)) {\n                // read array element\n                {\n                    eta_p_52057 = ((__local int64_t *) red_arr_i64_mem_52039)[sext_i32_i64(local_tid_52035 + offset_52071)];\n                    eta_p_52058 = ((__local double *) red_arr_f64_mem_52041)[sext_i32_i64(local_tid_52035 + offset_52071)];\n                }\n                // apply reduction operation\n                {\n                    bool zg_res_52059 = clBase_34770 < eta_p_52056;\n                    bool zg_res_52060 = clBase_34770 < eta_p_52058;\n                    bool x_52061 = zg_res_52059 && zg_res_52060;\n                    int64_t lifted_lambda_res_52062;\n                    double lifted_lambda_res_52063;\n                    \n                    if (x_52061) {\n                        lifted_lambda_res_52062 = (int64_t) -1;\n                        lifted_lambda_res_52063 = INFINITY;\n                    } else {\n                        bool zl_res_52064 = eta_p_52056 < eta_p_52058;\n                        int64_t lifted_lambda_res_f_res_52065;\n                        \n                        if (zl_res_52064) {\n                            lifted_lambda_res_f_res_52065 = eta_p_52055;\n                        } else {\n                            lifted_lambda_res_f_res_52065 = eta_p", "_52057;\n                        }\n                        \n                        double lifted_lambda_res_f_res_52066;\n                        \n                        if (zl_res_52064) {\n                            lifted_lambda_res_f_res_52066 = eta_p_52056;\n                        } else {\n                            lifted_lambda_res_f_res_52066 = eta_p_52058;\n                        }\n                        lifted_lambda_res_52062 = lifted_lambda_res_f_res_52065;\n                        lifted_lambda_res_52063 = lifted_lambda_res_f_res_52066;\n                    }\n                    eta_p_52055 = lifted_lambda_res_52062;\n                    eta_p_52056 = lifted_lambda_res_52063;\n                }\n                // write result of operation\n                {\n                    ((__local int64_t *) red_arr_i64_mem_52039)[sext_i32_i64(local_tid_52035)] = eta_p_52055;\n                    ((__local double *) red_arr_f64_mem_52041)[sext_i32_i64(local_tid_52035)] = eta_p_52056;\n                }\n            }\n            skip_waves_52072 *= 2;\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        barrier(CLK_LOCAL_MEM_FENCE);\n        // thread 0 updates per-block acc(s); rest reset to ne\n        {\n            if (sext_i32_i64(local_tid_52035) == (int64_t) 0) {\n                eta_p_block_res_acc_52053 = eta_p_52055;\n                eta_p_block_res_acc_52054 = eta_p_52056;\n            } else {\n                eta_p_block_res_acc_52053 = (int64_t) -1;\n                eta_p_block_res_acc_52054 = INFINITY;\n            }\n        }\n        if (blocks_per_segment_52024 == (int64_t) 1) {\n            // first thread in block saves final result to memory\n            {\n                if (local_tid_52035 == 0) {\n                    ((__global int64_t *) mem_49424)[inf_42046 + gtid_45907] = eta_p_block_res_acc_52053;\n                    ((__global double *) mem_49949)[gtid_45907] = eta_p_block_res_acc_52054;\n                }\n            }\n        } else {\n            int",
                                    "32_t old_counter_52073;\n            bool is_last_block_52074;\n            \n            // first thread in block saves block result to global memory\n            {\n                if (local_tid_52035 == 0) {\n                    ((__global int64_t *) segred_tmp_mem_52028)[sext_i32_i64(virt_tblock_id_52048)] = eta_p_block_res_acc_52053;\n                    mem_fence_global();\n                    ((__global double *) segred_tmp_mem_52030)[sext_i32_i64(virt_tblock_id_52048)] = eta_p_block_res_acc_52054;\n                    mem_fence_global();\n                    old_counter_52073 = atomic_add_i32_global(&((volatile __global int *) counters_mem_52032)[srem64(flat_segment_id_52049, (int64_t) 20480)], (int) 1);\n                    ((__local bool *) sync_arr_mem_52043)[(int64_t) 0] = old_counter_52073 == sext_i64_i32(blocks_per_segment_52024 - (int64_t) 1);\n                }\n            }\n            barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n            is_last_block_52074 = ((__local bool *) sync_arr_mem_52043)[(int64_t) 0];\n            if (is_last_block_52074) {\n                if (local_tid_52035 == 0) {\n                    old_counter_52073 = atomic_add_i32_global(&((volatile __global int *) counters_mem_52032)[srem64(flat_segment_id_52049, (int64_t) 20480)], (int) sext_i64_i32((int64_t) 0 - blocks_per_segment_52024));\n                }\n                // read in the per-block-results\n                {\n                    int64_t read_per_thread_52075 = sdiv_up64(blocks_per_segment_52024, segred_tblock_sizze_45902);\n                    \n                    eta_p_45910 = (int64_t) -1;\n                    eta_p_45911 = INFINITY;\n                    for (int64_t i_52076 = 0; i_52076 < read_per_thread_52075; i_52076++) {\n                        int64_t block_res_id_52077 = sext_i32_i64(local_tid_52035) * read_per_thread_52075 + i_52076;\n                        int64_t index_of_block_res_52078 = flat_segment_id_52049 * blocks_per_segment_52024 + block_res_id_52077;\n", "                        \n                        if (slt64(block_res_id_52077, blocks_per_segment_52024)) {\n                            eta_p_45912 = ((__global int64_t *) segred_tmp_mem_52028)[index_of_block_res_52078];\n                            eta_p_45913 = ((__global double *) segred_tmp_mem_52030)[index_of_block_res_52078];\n                            \n                            bool zg_res_45914 = clBase_34770 < eta_p_45911;\n                            bool zg_res_45915 = clBase_34770 < eta_p_45913;\n                            bool x_45916 = zg_res_45914 && zg_res_45915;\n                            int64_t lifted_lambda_res_45917;\n                            double lifted_lambda_res_45918;\n                            \n                            if (x_45916) {\n                                lifted_lambda_res_45917 = (int64_t) -1;\n                                lifted_lambda_res_45918 = INFINITY;\n                            } else {\n                                bool zl_res_45919 = eta_p_45911 < eta_p_45913;\n                                int64_t lifted_lambda_res_f_res_45920;\n                                \n                                if (zl_res_45919) {\n                                    lifted_lambda_res_f_res_45920 = eta_p_45910;\n                                } else {\n                                    lifted_lambda_res_f_res_45920 = eta_p_45912;\n                                }\n                                \n                                double lifted_lambda_res_f_res_45921;\n                                \n                                if (zl_res_45919) {\n                                    lifted_lambda_res_f_res_45921 = eta_p_45911;\n                                } else {\n                                    lifted_lambda_res_f_res_45921 = eta_p_45913;\n                                }\n                                lifted_lambda_res_45917 = lifted_lambda_res_f_res_45920;\n                                lifted_lambda_res_45918 =", " lifted_lambda_res_f_res_45921;\n                            }\n                            eta_p_45910 = lifted_lambda_res_45917;\n                            eta_p_45911 = lifted_lambda_res_45918;\n                        }\n                    }\n                }\n                ((__local int64_t *) red_arr_i64_mem_52039)[sext_i32_i64(local_tid_52035)] = eta_p_45910;\n                ((__local double *) red_arr_f64_mem_52041)[sext_i32_i64(local_tid_52035)] = eta_p_45911;\n                barrier(CLK_LOCAL_MEM_FENCE);\n                // reduce the per-block results\n                {\n                    int32_t offset_52079;\n                    int32_t skip_waves_52080 = 1;\n                    int64_t eta_p_52055;\n                    double eta_p_52056;\n                    int64_t eta_p_52057;\n                    double eta_p_52058;\n                    \n                    offset_52079 = 0;\n                    // participating threads read initial accumulator\n                    {\n                        if (slt32(local_tid_52035, sext_i64_i32(segred_tblock_sizze_45902))) {\n                            eta_p_52055 = ((__local int64_t *) red_arr_i64_mem_52039)[sext_i32_i64(local_tid_52035 + offset_52079)];\n                            eta_p_52056 = ((__local double *) red_arr_f64_mem_52041)[sext_i32_i64(local_tid_52035 + offset_52079)];\n                        }\n                    }\n                    offset_52079 = 1;\n                    while (slt32(offset_52079, wave_sizze_52037)) {\n                        if (slt32(local_tid_52035 + offset_52079, sext_i64_i32(segred_tblock_sizze_45902)) && ((local_tid_52035 - squot32(local_tid_52035, wave_sizze_52037) * wave_sizze_52037) & (2 * offset_52079 - 1)) == 0) {\n                            // read array element\n                            {\n                                eta_p_52057 = ((volatile __local int64_t *) red_arr_i64_mem_52039)[sext_i32_i64(local_tid_52035 + offset_52079)];\n                                eta_p_52058",
                                    " = ((volatile __local double *) red_arr_f64_mem_52041)[sext_i32_i64(local_tid_52035 + offset_52079)];\n                            }\n                            // apply reduction operation\n                            {\n                                bool zg_res_52059 = clBase_34770 < eta_p_52056;\n                                bool zg_res_52060 = clBase_34770 < eta_p_52058;\n                                bool x_52061 = zg_res_52059 && zg_res_52060;\n                                int64_t lifted_lambda_res_52062;\n                                double lifted_lambda_res_52063;\n                                \n                                if (x_52061) {\n                                    lifted_lambda_res_52062 = (int64_t) -1;\n                                    lifted_lambda_res_52063 = INFINITY;\n                                } else {\n                                    bool zl_res_52064 = eta_p_52056 < eta_p_52058;\n                                    int64_t lifted_lambda_res_f_res_52065;\n                                    \n                                    if (zl_res_52064) {\n                                        lifted_lambda_res_f_res_52065 = eta_p_52055;\n                                    } else {\n                                        lifted_lambda_res_f_res_52065 = eta_p_52057;\n                                    }\n                                    \n                                    double lifted_lambda_res_f_res_52066;\n                                    \n                                    if (zl_res_52064) {\n                                        lifted_lambda_res_f_res_52066 = eta_p_52056;\n                                    } else {\n                                        lifted_lambda_res_f_res_52066 = eta_p_52058;\n                                    }\n                                    lifted_lambda_res_52062 = lifted_lambda_res_f_res_52065;\n                                    lifted_lambda_res_52063 = lifted_lambda_res_f_res_52066;", "\n                                }\n                                eta_p_52055 = lifted_lambda_res_52062;\n                                eta_p_52056 = lifted_lambda_res_52063;\n                            }\n                            // write result of operation\n                            {\n                                ((volatile __local int64_t *) red_arr_i64_mem_52039)[sext_i32_i64(local_tid_52035)] = eta_p_52055;\n                                ((volatile __local double *) red_arr_f64_mem_52041)[sext_i32_i64(local_tid_52035)] = eta_p_52056;\n                            }\n                        }\n                        offset_52079 *= 2;\n                    }\n                    while (slt32(skip_waves_52080, squot32(sext_i64_i32(segred_tblock_sizze_45902) + wave_sizze_52037 - 1, wave_sizze_52037))) {\n                        barrier(CLK_LOCAL_MEM_FENCE);\n                        offset_52079 = skip_waves_52080 * wave_sizze_52037;\n                        if (slt32(local_tid_52035 + offset_52079, sext_i64_i32(segred_tblock_sizze_45902)) && ((local_tid_52035 - squot32(local_tid_52035, wave_sizze_52037) * wave_sizze_52037) == 0 && (squot32(local_tid_52035, wave_sizze_52037) & (2 * skip_waves_52080 - 1)) == 0)) {\n                            // read array element\n                            {\n                                eta_p_52057 = ((__local int64_t *) red_arr_i64_mem_52039)[sext_i32_i64(local_tid_52035 + offset_52079)];\n                                eta_p_52058 = ((__local double *) red_arr_f64_mem_52041)[sext_i32_i64(local_tid_52035 + offset_52079)];\n                            }\n                            // apply reduction operation\n                            {\n                                bool zg_res_52059 = clBase_34770 < eta_p_52056;\n                                bool zg_res_52060 = clBase_34770 < eta_p_52058;\n                                bool x_52061 = zg_res_52059 && zg_res_52060;\n                                int64_t lifted_lambda_res_", "52062;\n                                double lifted_lambda_res_52063;\n                                \n                                if (x_52061) {\n                                    lifted_lambda_res_52062 = (int64_t) -1;\n                                    lifted_lambda_res_52063 = INFINITY;\n                                } else {\n                                    bool zl_res_52064 = eta_p_52056 < eta_p_52058;\n                                    int64_t lifted_lambda_res_f_res_52065;\n                                    \n                                    if (zl_res_52064) {\n                                        lifted_lambda_res_f_res_52065 = eta_p_52055;\n                                    } else {\n                                        lifted_lambda_res_f_res_52065 = eta_p_52057;\n                                    }\n                                    \n                                    double lifted_lambda_res_f_res_52066;\n                                    \n                                    if (zl_res_52064) {\n                                        lifted_lambda_res_f_res_52066 = eta_p_52056;\n                                    } else {\n                                        lifted_lambda_res_f_res_52066 = eta_p_52058;\n                                    }\n                                    lifted_lambda_res_52062 = lifted_lambda_res_f_res_52065;\n                                    lifted_lambda_res_52063 = lifted_lambda_res_f_res_52066;\n                                }\n                                eta_p_52055 = lifted_lambda_res_52062;\n                                eta_p_52056 = lifted_lambda_res_52063;\n                            }\n                            // write result of operation\n                            {\n                                ((__local int64_t *) red_arr_i64_mem_52039)[sext_i32_i64(local_tid_52035)] = eta_p_52055;\n                                ((__local double *) red_arr_f64_mem_52041)[sext_i32_i64(local_tid_",
                                    "52035)] = eta_p_52056;\n                            }\n                        }\n                        skip_waves_52080 *= 2;\n                    }\n                    barrier(CLK_LOCAL_MEM_FENCE);\n                    // and back to memory with the final result\n                    {\n                        if (local_tid_52035 == 0) {\n                            ((__global int64_t *) mem_49424)[inf_42046 + gtid_45907] = eta_p_52055;\n                            ((__global double *) mem_49949)[gtid_45907] = eta_p_52056;\n                        }\n                    }\n                }\n            }\n        }\n        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    }\n    \n  error_6:\n    return;\n    #undef segred_tblock_sizze_45902\n    #undef chunk_sizze_51983\n}\nFUTHARK_KERNEL_SIZED(do_DBSCAN_doublezisegred_nonseg_44715_dim1, 1, 1)\nvoid do_DBSCAN_doublezisegred_nonseg_44715(__global int *global_failure, int64_t conc_tmp_41556, int64_t num_tblocks_44710, int64_t num_threads_51188, __global unsigned char *mem_param_49517, __global unsigned char *ext_mem_49590, __global unsigned char *mem_49592, __global unsigned char *counters_mem_51184, __global unsigned char *segred_tmp_mem_51186)\n{\n    #define segred_tblock_sizze_44708 (do_DBSCAN_doublezisegred_nonseg_44715zisegred_tblock_sizze_44708)\n    #define chunk_sizze_51183 (do_DBSCAN_doublezisegred_nonseg_44715zichunk_sizze_51183)\n    \n    volatile __local unsigned char *sync_arr_mem_51196_backing_1 = &shared_mem[0];\n    const int64_t sync_arr_mem_51196_backing_1_offset = 0 + 8;\n    volatile __local unsigned char *red_arr_bool_mem_51194_backing_0 = &shared_mem[sync_arr_mem_51196_backing_1_offset];\n    const int64_t red_arr_bool_mem_51194_backing_0_offset = sync_arr_mem_51196_backing_1_offset + (segred_tblock_sizze_44708 + srem64((int64_t) 8 - srem64(segred_tblock_sizze_44708, (int64_t) 8), (int64_t) 8));\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_51190;\n    int32_t tblock_sizze_51193;\n ", "   int32_t wave_sizze_51192;\n    int32_t block_id_51191;\n    int32_t global_tid_51189;\n    int64_t phys_tid_44715;\n    __local unsigned char *red_arr_bool_mem_51194;\n    __local unsigned char *sync_arr_mem_51196;\n    int64_t dummy_44713;\n    int64_t gtid_44714;\n    int64_t q_51198;\n    bool eta_p_block_res_acc_51199;\n    bool eta_p_41664;\n    bool eta_p_41665;\n    int64_t tblock_id_in_segment_51203;\n    int64_t block_base_offset_51204;\n    int32_t offset_51207;\n    int32_t skip_waves_51208;\n    bool eta_p_51200;\n    bool eta_p_51201;\n    int32_t old_counter_51209;\n    bool is_last_block_51210;\n    \n    local_tid_51190 = get_local_id(0);\n    tblock_sizze_51193 = get_local_size(0);\n    wave_sizze_51192 = LOCKSTEP_WIDTH;\n    block_id_51191 = get_tblock_id(0);\n    global_tid_51189 = block_id_51191 * tblock_sizze_51193 + local_tid_51190;\n    phys_tid_44715 = sext_i32_i64(global_tid_51189);\n    red_arr_bool_mem_51194 = (__local unsigned char *) red_arr_bool_mem_51194_backing_0;\n    sync_arr_mem_51196 = (__local unsigned char *) sync_arr_mem_51196_backing_1;\n    dummy_44713 = (int64_t) 0;\n    gtid_44714 = (int64_t) 0;\n    q_51198 = sdiv_up64(conc_tmp_41556, sext_i32_i64(sext_i64_i32(segred_tblock_sizze_44708 * num_tblocks_44710)) * chunk_sizze_51183);\n    // ne-initialise the outer (per-block) accumulator(s)\n    {\n        eta_p_block_res_acc_51199 = 1;\n    }\n    tblock_id_in_segment_51203 = squot64(phys_tid_44715, segred_tblock_sizze_44708);\n    block_base_offset_51204 = tblock_id_in_segment_51203 * q_51198 * segred_tblock_sizze_44708;\n    for (int64_t i_51205 = 0; i_51205 < q_51198; i_51205++) {\n        int64_t block_offset_51206 = block_base_offset_51204 + i_51205 * segred_tblock_sizze_44708;\n        \n        gtid_44714 = phys_tid_44715 + num_threads_51188 * i_51205;\n        if (slt64(gtid_44714, conc_tmp_41556)) {\n            // apply map function(s)\n            {\n                // apply map function\n                {\n                    int64_t eta_p_42485 = ((__globa", "l int64_t *) mem_param_49517)[gtid_44714];\n                    int64_t eta_p_42486 = ((__global int64_t *) ext_mem_49590)[gtid_44714];\n                    bool defunc_0_f_res_42487 = eta_p_42485 == eta_p_42486;\n                    \n                    // load accumulator(s)\n                    {\n                        eta_p_41664 = eta_p_block_res_acc_51199;\n                    }\n                    // load next value(s)\n                    {\n                        eta_p_41665 = defunc_0_f_res_42487;\n                    }\n                    // apply reduction operator(s)\n                    {\n                        bool x_41666 = eta_p_41664 && eta_p_41665;\n                        \n                        // store in accumulator(s)\n                        {\n                            eta_p_block_res_acc_51199 = x_41666;\n                        }\n                    }\n                }\n            }\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // store accs. prims go in lmem; non-prims in params (in global mem)\n    {\n        ((__local bool *) red_arr_bool_mem_51194)[sext_i32_i64(local_tid_51190)] = eta_p_block_res_acc_51199;\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    skip_waves_51208 = 1;\n    offset_51207 = 0;\n    // participating threads read initial accumulator\n    {\n        if (slt32(local_tid_51190, sext_i64_i32(segred_tblock_sizze_44708))) {\n            eta_p_51200 = ((__local bool *) red_arr_bool_mem_51194)[sext_i32_i64(local_tid_51190 + offset_51207)];\n        }\n    }\n    offset_51207 = 1;\n    while (slt32(offset_51207, wave_sizze_51192)) {\n        if (slt32(local_tid_51190 + offset_51207, sext_i64_i32(segred_tblock_sizze_44708)) && ((local_tid_51190 - squot32(local_tid_51190, wave_sizze_51192) * wave_sizze_51192) & (2 * offset_51207 - 1)) == 0) {\n            // read array element\n            {\n                eta_p_51201 = ((volatile __local bool *) red_arr_bool_mem_51194)[sext_i32_i64(local_tid_51190 + offset_51207)];\n            }\n           ",
                                    " // apply reduction operation\n            {\n                bool x_51202 = eta_p_51200 && eta_p_51201;\n                \n                eta_p_51200 = x_51202;\n            }\n            // write result of operation\n            {\n                ((volatile __local bool *) red_arr_bool_mem_51194)[sext_i32_i64(local_tid_51190)] = eta_p_51200;\n            }\n        }\n        offset_51207 *= 2;\n    }\n    while (slt32(skip_waves_51208, squot32(sext_i64_i32(segred_tblock_sizze_44708) + wave_sizze_51192 - 1, wave_sizze_51192))) {\n        barrier(CLK_LOCAL_MEM_FENCE);\n        offset_51207 = skip_waves_51208 * wave_sizze_51192;\n        if (slt32(local_tid_51190 + offset_51207, sext_i64_i32(segred_tblock_sizze_44708)) && ((local_tid_51190 - squot32(local_tid_51190, wave_sizze_51192) * wave_sizze_51192) == 0 && (squot32(local_tid_51190, wave_sizze_51192) & (2 * skip_waves_51208 - 1)) == 0)) {\n            // read array element\n            {\n                eta_p_51201 = ((__local bool *) red_arr_bool_mem_51194)[sext_i32_i64(local_tid_51190 + offset_51207)];\n            }\n            // apply reduction operation\n            {\n                bool x_51202 = eta_p_51200 && eta_p_51201;\n                \n                eta_p_51200 = x_51202;\n            }\n            // write result of operation\n            {\n                ((__local bool *) red_arr_bool_mem_51194)[sext_i32_i64(local_tid_51190)] = eta_p_51200;\n            }\n        }\n        skip_waves_51208 *= 2;\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // thread 0 updates per-block acc(s); rest reset to ne\n    {\n        if (sext_i32_i64(local_tid_51190) == (int64_t) 0) {\n            eta_p_block_res_acc_51199 = eta_p_51200;\n        } else {\n            eta_p_block_res_acc_51199 = 1;\n        }\n    }\n    // first thread in block saves block result to global memory\n    {\n        if (local_tid_51190 == 0) {\n            ((__global bool *) segred_tmp_mem_51186)[sext_i32_i64(block_id_51191)] = eta_p_bl", "ock_res_acc_51199;\n            mem_fence_global();\n            old_counter_51209 = atomic_add_i32_global(&((volatile __global int *) counters_mem_51184)[(int64_t) 0], (int) 1);\n            ((__local bool *) sync_arr_mem_51196)[(int64_t) 0] = old_counter_51209 == sext_i64_i32(num_tblocks_44710 - (int64_t) 1);\n        }\n    }\n    barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    is_last_block_51210 = ((__local bool *) sync_arr_mem_51196)[(int64_t) 0];\n    if (is_last_block_51210) {\n        if (local_tid_51190 == 0) {\n            old_counter_51209 = atomic_add_i32_global(&((volatile __global int *) counters_mem_51184)[(int64_t) 0], (int) sext_i64_i32((int64_t) 0 - num_tblocks_44710));\n        }\n        // read in the per-block-results\n        {\n            int64_t read_per_thread_51211 = sdiv_up64(num_tblocks_44710, segred_tblock_sizze_44708);\n            \n            eta_p_41664 = 1;\n            for (int64_t i_51212 = 0; i_51212 < read_per_thread_51211; i_51212++) {\n                int64_t block_res_id_51213 = sext_i32_i64(local_tid_51190) * read_per_thread_51211 + i_51212;\n                int64_t index_of_block_res_51214 = block_res_id_51213;\n                \n                if (slt64(block_res_id_51213, num_tblocks_44710)) {\n                    eta_p_41665 = ((__global bool *) segred_tmp_mem_51186)[index_of_block_res_51214];\n                    \n                    bool x_41666 = eta_p_41664 && eta_p_41665;\n                    \n                    eta_p_41664 = x_41666;\n                }\n            }\n        }\n        ((__local bool *) red_arr_bool_mem_51194)[sext_i32_i64(local_tid_51190)] = eta_p_41664;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        // reduce the per-block results\n        {\n            int32_t offset_51215;\n            int32_t skip_waves_51216 = 1;\n            bool eta_p_51200;\n            bool eta_p_51201;\n            \n            offset_51215 = 0;\n            // participating threads read initial accumulator\n            {\n                i", "f (slt32(local_tid_51190, sext_i64_i32(segred_tblock_sizze_44708))) {\n                    eta_p_51200 = ((__local bool *) red_arr_bool_mem_51194)[sext_i32_i64(local_tid_51190 + offset_51215)];\n                }\n            }\n            offset_51215 = 1;\n            while (slt32(offset_51215, wave_sizze_51192)) {\n                if (slt32(local_tid_51190 + offset_51215, sext_i64_i32(segred_tblock_sizze_44708)) && ((local_tid_51190 - squot32(local_tid_51190, wave_sizze_51192) * wave_sizze_51192) & (2 * offset_51215 - 1)) == 0) {\n                    // read array element\n                    {\n                        eta_p_51201 = ((volatile __local bool *) red_arr_bool_mem_51194)[sext_i32_i64(local_tid_51190 + offset_51215)];\n                    }\n                    // apply reduction operation\n                    {\n                        bool x_51202 = eta_p_51200 && eta_p_51201;\n                        \n                        eta_p_51200 = x_51202;\n                    }\n                    // write result of operation\n                    {\n                        ((volatile __local bool *) red_arr_bool_mem_51194)[sext_i32_i64(local_tid_51190)] = eta_p_51200;\n                    }\n                }\n                offset_51215 *= 2;\n            }\n            while (slt32(skip_waves_51216, squot32(sext_i64_i32(segred_tblock_sizze_44708) + wave_sizze_51192 - 1, wave_sizze_51192))) {\n                barrier(CLK_LOCAL_MEM_FENCE);\n                offset_51215 = skip_waves_51216 * wave_sizze_51192;\n                if (slt32(local_tid_51190 + offset_51215, sext_i64_i32(segred_tblock_sizze_44708)) && ((local_tid_51190 - squot32(local_tid_51190, wave_sizze_51192) * wave_sizze_51192) == 0 && (squot32(local_tid_51190, wave_sizze_51192) & (2 * skip_waves_51216 - 1)) == 0)) {\n                    // read array element\n                    {\n                        eta_p_51201 = ((__local bool *) red_arr_bool_mem_51194)[sext_i32_i64(local_tid_51190 + offset_51215)];\n             ",
                                    "       }\n                    // apply reduction operation\n                    {\n                        bool x_51202 = eta_p_51200 && eta_p_51201;\n                        \n                        eta_p_51200 = x_51202;\n                    }\n                    // write result of operation\n                    {\n                        ((__local bool *) red_arr_bool_mem_51194)[sext_i32_i64(local_tid_51190)] = eta_p_51200;\n                    }\n                }\n                skip_waves_51216 *= 2;\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // and back to memory with the final result\n            {\n                if (local_tid_51190 == 0) {\n                    ((__global bool *) mem_49592)[(int64_t) 0] = eta_p_51200;\n                }\n            }\n        }\n    }\n    \n  error_5:\n    return;\n    #undef segred_tblock_sizze_44708\n    #undef chunk_sizze_51183\n}\nFUTHARK_KERNEL_SIZED(do_DBSCAN_doublezisegred_small_44665_dim1, 1, 1)\nvoid do_DBSCAN_doublezisegred_small_44665(__global int *global_failure, int8_t clBase_34768, int8_t clBase_34769, double clBase_34770, double clBase_34776, int64_t m_41485, int64_t conc_tmp_41556, int64_t inf_41586, int64_t j_m_i_41589, int64_t num_tblocks_44660, unsigned char x_49366_bits, int64_t segment_sizze_nonzzero_51111, __global unsigned char *mem_49480, __global unsigned char *mem_49482, __global unsigned char *mem_49498, __global unsigned char *mem_49500, __global unsigned char *mem_param_49520, __global unsigned char *mem_49523, __global unsigned char *mem_49525, __global unsigned char *mem_49527, __global unsigned char *mem_49530)\n{\n    bool x_49366 = x_49366_bits;\n    \n    #define segred_tblock_sizze_44659 (do_DBSCAN_doublezisegred_small_44665zisegred_tblock_sizze_44659)\n    \n    volatile __local unsigned char *red_arr_i64_mem_51118_backing_0 = &shared_mem[0];\n    const int64_t red_arr_i64_mem_51118_backing_0_offset = 0 + ((int64_t) 8 * segred_tblock_sizze_44659 + srem64((int64_t) 8 - srem64((int64_t) 8 * s", "egred_tblock_sizze_44659, (int64_t) 8), (int64_t) 8));\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_51114;\n    int32_t tblock_sizze_51117;\n    int32_t wave_sizze_51116;\n    int32_t block_id_51115;\n    int32_t global_tid_51113;\n    int64_t phys_tid_44665;\n    __local unsigned char *red_arr_i64_mem_51118;\n    int32_t phys_tblock_id_51120;\n    int32_t iterations_51121;\n    \n    local_tid_51114 = get_local_id(0);\n    tblock_sizze_51117 = get_local_size(0);\n    wave_sizze_51116 = LOCKSTEP_WIDTH;\n    block_id_51115 = get_tblock_id(0);\n    global_tid_51113 = block_id_51115 * tblock_sizze_51117 + local_tid_51114;\n    phys_tid_44665 = sext_i32_i64(global_tid_51113);\n    red_arr_i64_mem_51118 = (__local unsigned char *) red_arr_i64_mem_51118_backing_0;\n    phys_tblock_id_51120 = get_tblock_id(0);\n    iterations_51121 = sdiv_up32(sext_i64_i32(sdiv_up64(j_m_i_41589, squot64(segred_tblock_sizze_44659, segment_sizze_nonzzero_51111))) - phys_tblock_id_51120, sext_i64_i32(num_tblocks_44660));\n    for (int32_t i_51122 = 0; i_51122 < iterations_51121; i_51122++) {\n        int32_t virt_tblock_id_51123;\n        int64_t slice_51124;\n        int64_t gtid_44663;\n        int64_t remnant_51125;\n        int64_t gtid_44664;\n        \n        virt_tblock_id_51123 = phys_tblock_id_51120 + i_51122 * sext_i64_i32(num_tblocks_44660);\n        slice_51124 = j_m_i_41589;\n        gtid_44663 = squot64(sext_i32_i64(local_tid_51114), segment_sizze_nonzzero_51111) + sext_i32_i64(virt_tblock_id_51123) * squot64(segred_tblock_sizze_44659, segment_sizze_nonzzero_51111);\n        remnant_51125 = squot64(sext_i32_i64(local_tid_51114), segment_sizze_nonzzero_51111) + sext_i32_i64(virt_tblock_id_51123) * squot64(segred_tblock_sizze_44659, segment_sizze_nonzzero_51111) - gtid_44663;\n        gtid_44664 = srem64(sext_i32_i64(local_tid_51114), conc_tmp_41556);\n        // apply map function if in bounds\n        {\n            if (slt64((int64_t) 0, conc_tmp_41556) && (slt64(gtid_44663, j", "_m_i_41589) && slt64(sext_i32_i64(local_tid_51114), conc_tmp_41556 * squot64(segred_tblock_sizze_44659, segment_sizze_nonzzero_51111)))) {\n                // apply map function\n                {\n                    int64_t slice_46502 = inf_41586 + gtid_44663;\n                    bool index_concat_cmp_46497 = sle64(m_41485, slice_46502);\n                    double index_concat_branch_46501;\n                    \n                    if (index_concat_cmp_46497) {\n                        int64_t index_concat_i_46498 = sub64(slice_46502, m_41485);\n                        double index_concat_46499 = ((__global double *) mem_49500)[index_concat_i_46498];\n                        \n                        index_concat_branch_46501 = index_concat_46499;\n                    } else {\n                        double index_concat_46500 = ((__global double *) mem_49482)[slice_46502];\n                        \n                        index_concat_branch_46501 = index_concat_46500;\n                    }\n                    \n                    double index_concat_branch_46494;\n                    \n                    if (index_concat_cmp_46497) {\n                        int64_t index_concat_i_46491 = sub64(slice_46502, m_41485);\n                        double index_concat_46492 = ((__global double *) mem_49498)[index_concat_i_46491];\n                        \n                        index_concat_branch_46494 = index_concat_46492;\n                    } else {\n                        double index_concat_46493 = ((__global double *) mem_49480)[slice_46502];\n                        \n                        index_concat_branch_46494 = index_concat_46493;\n                    }\n                    \n                    bool index_concat_cmp_46483 = sle64(m_41485, gtid_44664);\n                    double index_concat_branch_46487;\n                    \n                    if (index_concat_cmp_46483) {\n                        int64_t index_concat_i_46484 = sub64(gtid_44664, m_41485);\n              ",
                                    "          double index_concat_46485 = ((__global double *) mem_49500)[index_concat_i_46484];\n                        \n                        index_concat_branch_46487 = index_concat_46485;\n                    } else {\n                        double index_concat_46486 = ((__global double *) mem_49482)[gtid_44664];\n                        \n                        index_concat_branch_46487 = index_concat_46486;\n                    }\n                    \n                    double index_concat_branch_46481;\n                    \n                    if (index_concat_cmp_46483) {\n                        int64_t index_concat_i_46478 = sub64(gtid_44664, m_41485);\n                        double index_concat_46479 = ((__global double *) mem_49498)[index_concat_i_46478];\n                        \n                        index_concat_branch_46481 = index_concat_46479;\n                    } else {\n                        double index_concat_46480 = ((__global double *) mem_49480)[gtid_44664];\n                        \n                        index_concat_branch_46481 = index_concat_46480;\n                    }\n                    \n                    double d_haversine_res_44672;\n                    \n                    if (x_49366) {\n                        double x_49368 = ((__global double *) mem_49523)[gtid_44663];\n                        \n                        d_haversine_res_44672 = x_49368;\n                    } else {\n                        d_haversine_res_44672 = 0.0;\n                    }\n                    \n                    double d_haversine_res_44673;\n                    \n                    if (x_49366) {\n                        double x_49370 = ((__global double *) mem_49525)[gtid_44663];\n                        \n                        d_haversine_res_44673 = x_49370;\n                    } else {\n                        d_haversine_res_44673 = 0.0;\n                    }\n                    \n                    double cos_res_44674;\n                    \n     ", "               if (x_49366) {\n                        double x_49372 = ((__global double *) mem_49527)[gtid_44663];\n                        \n                        cos_res_44674 = x_49372;\n                    } else {\n                        cos_res_44674 = 0.0;\n                    }\n                    \n                    double dist_res_44678;\n                    \n                    if (clBase_34769 == (int8_t) 0) {\n                        double zm_res_44679 = index_concat_branch_46494 - index_concat_branch_46481;\n                        double zm_res_44680 = index_concat_branch_46501 - index_concat_branch_46487;\n                        double hypot_res_44681 = futrts_hypot64(zm_res_44680, zm_res_44679);\n                        \n                        dist_res_44678 = hypot_res_44681;\n                    } else {\n                        double d_haversine_res_44682;\n                        double d_haversine_res_44683;\n                        \n                        if (clBase_34768 == (int8_t) 1) {\n                            d_haversine_res_44682 = index_concat_branch_46487;\n                            d_haversine_res_44683 = index_concat_branch_46481;\n                        } else {\n                            double zt_res_44684 = 3.141592653589793 * index_concat_branch_46487;\n                            double zs_res_44685 = zt_res_44684 / 180.0;\n                            double zt_res_44686 = 3.141592653589793 * index_concat_branch_46481;\n                            double zs_res_44687 = zt_res_44686 / 180.0;\n                            \n                            d_haversine_res_44682 = zs_res_44685;\n                            d_haversine_res_44683 = zs_res_44687;\n                        }\n                        \n                        double zm_res_44688 = d_haversine_res_44672 - d_haversine_res_44682;\n                        double cos_res_44689 = futrts_cos64(zm_res_44688);\n                        double zm_res_44690 = 1.0 - cos_res_44689;\n ", "                       double cos_res_44691 = futrts_cos64(d_haversine_res_44682);\n                        double zt_res_44692 = cos_res_44674 * cos_res_44691;\n                        double zm_res_44693 = d_haversine_res_44673 - d_haversine_res_44683;\n                        double zm_res_44694 = 1.0 - zm_res_44693;\n                        double zt_res_44695 = zt_res_44692 * zm_res_44694;\n                        double zp_res_44696 = zm_res_44690 + zt_res_44695;\n                        double zs_res_44697 = zp_res_44696 / 2.0;\n                        double min_res_44698 = fmin64(1.0, zs_res_44697);\n                        double zt_res_44699 = 2.0 * min_res_44698;\n                        double zm_res_44700 = 1.0 - zt_res_44699;\n                        double acos_res_44701 = futrts_acos64(zm_res_44700);\n                        double zt_res_44702 = clBase_34776 * acos_res_44701;\n                        \n                        dist_res_44678 = zt_res_44702;\n                    }\n                    \n                    bool zlze_res_44703 = dist_res_44678 <= clBase_34770;\n                    int64_t lifted_lambda_res_44704;\n                    \n                    if (zlze_res_44703) {\n                        int64_t eta_p_44677 = ((__global int64_t *) mem_param_49520)[gtid_44664];\n                        \n                        lifted_lambda_res_44704 = eta_p_44677;\n                    } else {\n                        int64_t eta_p_44669 = ((__global int64_t *) mem_param_49520)[slice_46502];\n                        \n                        lifted_lambda_res_44704 = eta_p_44669;\n                    }\n                    // save results to be reduced\n                    {\n                        ((__local int64_t *) red_arr_i64_mem_51118)[sext_i32_i64(local_tid_51114)] = lifted_lambda_res_44704;\n                    }\n                }\n            } else {\n                ((__local int64_t *) red_arr_i64_mem_51118)[sext_i32_i64(local_tid_51114)] = (int64_t) 92233",
                                    "72036854775807;\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        if (slt64((int64_t) 0, conc_tmp_41556)) {\n            // perform segmented scan to imitate reduction\n            {\n                int64_t eta_p_44666;\n                int64_t eta_p_44667;\n                int64_t eta_p_51126;\n                int64_t eta_p_51127;\n                bool ltid_in_bounds_51129 = slt64(sext_i32_i64(local_tid_51114), conc_tmp_41556 * squot64(segred_tblock_sizze_44659, segment_sizze_nonzzero_51111));\n                int32_t skip_threads_51130;\n                \n                // read input for in-block scan\n                {\n                    if (ltid_in_bounds_51129) {\n                        eta_p_44667 = ((volatile __local int64_t *) red_arr_i64_mem_51118)[sext_i32_i64(local_tid_51114)];\n                        if ((local_tid_51114 - squot32(local_tid_51114, 32) * 32) == 0) {\n                            eta_p_44666 = eta_p_44667;\n                        }\n                    }\n                }\n                // in-block scan (hopefully no barriers needed)\n                {\n                    skip_threads_51130 = 1;\n                    while (slt32(skip_threads_51130, 32)) {\n                        bool thread_active_51131 = sle32(skip_threads_51130, local_tid_51114 - squot32(local_tid_51114, 32) * 32) && ltid_in_bounds_51129;\n                        \n                        if (thread_active_51131) {\n                            // read operands\n                            {\n                                eta_p_44666 = ((volatile __local int64_t *) red_arr_i64_mem_51118)[sext_i32_i64(local_tid_51114) - sext_i32_i64(skip_threads_51130)];\n                            }\n                        }\n                        // perform operation\n                        {\n                            bool inactive_51132 = slt64(srem64(sext_i32_i64(local_tid_51114), conc_tmp_41556), sext_i32_i64(local_tid_51114) - sext_i32_i64(local_tid_51114 - skip_threads_51130", "));\n                            \n                            if (thread_active_51131 && inactive_51132) {\n                                eta_p_44666 = eta_p_44667;\n                            }\n                            if (thread_active_51131) {\n                                if (!inactive_51132) {\n                                    int64_t min_res_44668 = smin64(eta_p_44666, eta_p_44667);\n                                    \n                                    eta_p_44666 = min_res_44668;\n                                }\n                            }\n                        }\n                        if (sle32(wave_sizze_51116, skip_threads_51130)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        if (thread_active_51131) {\n                            // write result\n                            {\n                                ((volatile __local int64_t *) red_arr_i64_mem_51118)[sext_i32_i64(local_tid_51114)] = eta_p_44666;\n                                eta_p_44667 = eta_p_44666;\n                            }\n                        }\n                        if (sle32(wave_sizze_51116, skip_threads_51130)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        skip_threads_51130 *= 2;\n                    }\n                }\n                barrier(CLK_LOCAL_MEM_FENCE);\n                // last thread of block 'i' writes its result to offset 'i'\n                {\n                    if ((local_tid_51114 - squot32(local_tid_51114, 32) * 32) == 31 && ltid_in_bounds_51129) {\n                        ((volatile __local int64_t *) red_arr_i64_mem_51118)[sext_i32_i64(squot32(local_tid_51114, 32))] = eta_p_44666;\n                    }\n                }\n                barrier(CLK_LOCAL_MEM_FENCE);\n                // scan the first block, after which offset 'i' contains carry-in for block 'i+1'\n                {\n                    int32_t skip_threads_5", "1133;\n                    \n                    // read input for in-block scan\n                    {\n                        if (squot32(local_tid_51114, 32) == 0 && ltid_in_bounds_51129) {\n                            eta_p_51127 = ((volatile __local int64_t *) red_arr_i64_mem_51118)[sext_i32_i64(local_tid_51114)];\n                            if ((local_tid_51114 - squot32(local_tid_51114, 32) * 32) == 0) {\n                                eta_p_51126 = eta_p_51127;\n                            }\n                        }\n                    }\n                    // in-block scan (hopefully no barriers needed)\n                    {\n                        skip_threads_51133 = 1;\n                        while (slt32(skip_threads_51133, 32)) {\n                            bool thread_active_51134 = sle32(skip_threads_51133, local_tid_51114 - squot32(local_tid_51114, 32) * 32) && (squot32(local_tid_51114, 32) == 0 && ltid_in_bounds_51129);\n                            \n                            if (thread_active_51134) {\n                                // read operands\n                                {\n                                    eta_p_51126 = ((volatile __local int64_t *) red_arr_i64_mem_51118)[sext_i32_i64(local_tid_51114) - sext_i32_i64(skip_threads_51133)];\n                                }\n                            }\n                            // perform operation\n                            {\n                                bool inactive_51135 = slt64(srem64(sext_i32_i64(local_tid_51114 * 32 + 32 - 1), conc_tmp_41556), sext_i32_i64(local_tid_51114 * 32 + 32 - 1) - sext_i32_i64((local_tid_51114 - skip_threads_51133) * 32 + 32 - 1));\n                                \n                                if (thread_active_51134 && inactive_51135) {\n                                    eta_p_51126 = eta_p_51127;\n                                }\n                                if (thread_active_51134) {\n                                    if (!inactive_51135) {\n   ",
                                    "                                     int64_t min_res_51128 = smin64(eta_p_51126, eta_p_51127);\n                                        \n                                        eta_p_51126 = min_res_51128;\n                                    }\n                                }\n                            }\n                            if (sle32(wave_sizze_51116, skip_threads_51133)) {\n                                barrier(CLK_LOCAL_MEM_FENCE);\n                            }\n                            if (thread_active_51134) {\n                                // write result\n                                {\n                                    ((volatile __local int64_t *) red_arr_i64_mem_51118)[sext_i32_i64(local_tid_51114)] = eta_p_51126;\n                                    eta_p_51127 = eta_p_51126;\n                                }\n                            }\n                            if (sle32(wave_sizze_51116, skip_threads_51133)) {\n                                barrier(CLK_LOCAL_MEM_FENCE);\n                            }\n                            skip_threads_51133 *= 2;\n                        }\n                    }\n                }\n                barrier(CLK_LOCAL_MEM_FENCE);\n                \n                bool no_carry_in_51136 = squot32(local_tid_51114, 32) == 0 || !ltid_in_bounds_51129;\n                \n                // carry-in for every block except the first\n                {\n                    // read operands\n                    {\n                        if (!no_carry_in_51136) {\n                            eta_p_44667 = eta_p_44666;\n                            eta_p_44666 = ((__local int64_t *) red_arr_i64_mem_51118)[sext_i32_i64(squot32(local_tid_51114, 32)) - (int64_t) 1];\n                        }\n                    }\n                    // perform operation\n                    {\n                        bool inactive_51137 = slt64(srem64(sext_i32_i64(local_tid_51114), conc_tmp_41556), sext_i32_i64(local_tid_51114) - sext_i32_i64(s", "quot32(local_tid_51114, 32) * 32 - 1));\n                        \n                        if (!no_carry_in_51136) {\n                            if (inactive_51137) {\n                                eta_p_44666 = eta_p_44667;\n                            }\n                        }\n                        if (!no_carry_in_51136) {\n                            if (!inactive_51137) {\n                                int64_t min_res_44668 = smin64(eta_p_44666, eta_p_44667);\n                                \n                                eta_p_44666 = min_res_44668;\n                            }\n                        }\n                    }\n                    // write final result\n                    {\n                        if (!no_carry_in_51136) {\n                            ((__local int64_t *) red_arr_i64_mem_51118)[sext_i32_i64(local_tid_51114)] = eta_p_44666;\n                        }\n                    }\n                }\n                barrier(CLK_LOCAL_MEM_FENCE);\n                // restore correct values for first block\n                {\n                    if (squot32(local_tid_51114, 32) == 0 && ltid_in_bounds_51129) {\n                        ((__local int64_t *) red_arr_i64_mem_51118)[sext_i32_i64(local_tid_51114)] = eta_p_44667;\n                    }\n                }\n                barrier(CLK_LOCAL_MEM_FENCE);\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        // save final values of segments\n        {\n            if (slt64(sext_i32_i64(virt_tblock_id_51123) * squot64(segred_tblock_sizze_44659, segment_sizze_nonzzero_51111) + sext_i32_i64(local_tid_51114), j_m_i_41589) && slt64(sext_i32_i64(local_tid_51114), squot64(segred_tblock_sizze_44659, segment_sizze_nonzzero_51111))) {\n                int64_t tmp_51138 = ((__local int64_t *) red_arr_i64_mem_51118)[(sext_i32_i64(local_tid_51114) + (int64_t) 1) * segment_sizze_nonzzero_51111 - (int64_t) 1];\n                \n                ((__global int64_t *) mem_49530)[sext_i32_i64(virt_tbl", "ock_id_51123) * squot64(segred_tblock_sizze_44659, segment_sizze_nonzzero_51111) + sext_i32_i64(local_tid_51114)] = tmp_51138;\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    }\n    \n  error_3:\n    return;\n    #undef segred_tblock_sizze_44659\n}\nFUTHARK_KERNEL_SIZED(do_DBSCAN_doublezisegred_small_45615_dim1, 1, 1)\nvoid do_DBSCAN_doublezisegred_small_45615(__global int *global_failure, int8_t clBase_34768, int8_t clBase_34769, double clBase_34770, double clBase_34776, int64_t conc_tmp_41556, int64_t inf_41963, int64_t dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_41966, int64_t num_tblocks_45609, unsigned char x_49366_bits, int64_t segment_sizze_nonzzero_51825, __global unsigned char *mem_49454, __global unsigned char *mem_49456, __global unsigned char *mem_49494, __global unsigned char *ext_mem_49839, __global unsigned char *mem_49842, __global unsigned char *mem_49844, __global unsigned char *mem_49850, __global unsigned char *mem_49852, __global unsigned char *mem_49854, __global unsigned char *mem_49859)\n{\n    bool x_49366 = x_49366_bits;\n    \n    #define segred_tblock_sizze_45608 (do_DBSCAN_doublezisegred_small_45615zisegred_tblock_sizze_45608)\n    \n    volatile __local unsigned char *red_arr_f64_mem_51834_backing_1 = &shared_mem[0];\n    const int64_t red_arr_f64_mem_51834_backing_1_offset = 0 + ((int64_t) 8 * segred_tblock_sizze_45608 + srem64((int64_t) 8 - srem64((int64_t) 8 * segred_tblock_sizze_45608, (int64_t) 8), (int64_t) 8));\n    volatile __local unsigned char *red_arr_i64_mem_51832_backing_0 = &shared_mem[red_arr_f64_mem_51834_backing_1_offset];\n    const int64_t red_arr_i64_mem_51832_backing_0_offset = red_arr_f64_mem_51834_backing_1_offset + ((int64_t) 8 * segred_tblock_sizze_45608 + srem64((int64_t) 8 - srem64((int64_t) 8 * segred_tblock_sizze_45608, (int64_t) 8), (int64_t) 8));\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_51828;\n    int32_t tblock_sizze",
                                    "_51831;\n    int32_t wave_sizze_51830;\n    int32_t block_id_51829;\n    int32_t global_tid_51827;\n    int64_t phys_tid_45615;\n    __local unsigned char *red_arr_i64_mem_51832;\n    __local unsigned char *red_arr_f64_mem_51834;\n    int32_t phys_tblock_id_51836;\n    int32_t iterations_51837;\n    \n    local_tid_51828 = get_local_id(0);\n    tblock_sizze_51831 = get_local_size(0);\n    wave_sizze_51830 = LOCKSTEP_WIDTH;\n    block_id_51829 = get_tblock_id(0);\n    global_tid_51827 = block_id_51829 * tblock_sizze_51831 + local_tid_51828;\n    phys_tid_45615 = sext_i32_i64(global_tid_51827);\n    red_arr_i64_mem_51832 = (__local unsigned char *) red_arr_i64_mem_51832_backing_0;\n    red_arr_f64_mem_51834 = (__local unsigned char *) red_arr_f64_mem_51834_backing_1;\n    phys_tblock_id_51836 = get_tblock_id(0);\n    iterations_51837 = sdiv_up32(sext_i64_i32(sdiv_up64(dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_41966, squot64(segred_tblock_sizze_45608, segment_sizze_nonzzero_51825))) - phys_tblock_id_51836, sext_i64_i32(num_tblocks_45609));\n    for (int32_t i_51838 = 0; i_51838 < iterations_51837; i_51838++) {\n        int32_t virt_tblock_id_51839;\n        int64_t slice_51840;\n        int64_t gtid_45613;\n        int64_t remnant_51841;\n        int64_t gtid_45614;\n        \n        virt_tblock_id_51839 = phys_tblock_id_51836 + i_51838 * sext_i64_i32(num_tblocks_45609);\n        slice_51840 = dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_41966;\n        gtid_45613 = squot64(sext_i32_i64(local_tid_51828), segment_sizze_nonzzero_51825) + sext_i32_i64(virt_tblock_id_51839) * squot64(segred_tblock_sizze_45608, segment_sizze_nonzzero_51825);\n        remnant_51841 = squot64(sext_i32_i64(local_tid_51828), segment_sizze_nonzzero_51825) + sext_i32_i64(virt_tblock_id_51839) * squot64(segred_tblock_sizze_45608, segment_sizze_nonzzero_51825) - gtid_45613;\n        gtid_45614 = srem64(sext_i32_i64(local_tid_51828), conc_tmp_41556);\n        // apply map function if in bounds\n        {\n            if (slt64((int64_t) 0, conc_tmp_4", "1556) && (slt64(gtid_45613, dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_41966) && slt64(sext_i32_i64(local_tid_51828), conc_tmp_41556 * squot64(segred_tblock_sizze_45608, segment_sizze_nonzzero_51825)))) {\n                // apply map function\n                {\n                    int64_t slice_46433 = inf_41963 + gtid_45613;\n                    double eta_p_45633 = ((__global double *) mem_49842)[gtid_45614];\n                    double eta_p_45634 = ((__global double *) mem_49844)[gtid_45614];\n                    int64_t x_45635 = ((__global int64_t *) ext_mem_49839)[gtid_45614];\n                    double d_haversine_res_45630;\n                    \n                    if (x_49366) {\n                        double x_49359 = ((__global double *) mem_49850)[gtid_45613];\n                        \n                        d_haversine_res_45630 = x_49359;\n                    } else {\n                        d_haversine_res_45630 = 0.0;\n                    }\n                    \n                    double d_haversine_res_45631;\n                    \n                    if (x_49366) {\n                        double x_49361 = ((__global double *) mem_49852)[gtid_45613];\n                        \n                        d_haversine_res_45631 = x_49361;\n                    } else {\n                        d_haversine_res_45631 = 0.0;\n                    }\n                    \n                    double cos_res_45632;\n                    \n                    if (x_49366) {\n                        double x_49363 = ((__global double *) mem_49854)[gtid_45613];\n                        \n                        cos_res_45632 = x_49363;\n                    } else {\n                        cos_res_45632 = 0.0;\n                    }\n                    \n                    double dist_res_45636;\n                    \n                    if (clBase_34769 == (int8_t) 0) {\n                        double eta_p_45628 = ((__global double *) mem_49454)[slice_46433];\n                        double eta_p_456", "29 = ((__global double *) mem_49456)[slice_46433];\n                        double zm_res_45637 = eta_p_45629 - eta_p_45634;\n                        double zm_res_45638 = eta_p_45628 - eta_p_45633;\n                        double hypot_res_45639 = futrts_hypot64(zm_res_45638, zm_res_45637);\n                        \n                        dist_res_45636 = hypot_res_45639;\n                    } else {\n                        double d_haversine_res_45640;\n                        double d_haversine_res_45641;\n                        \n                        if (clBase_34768 == (int8_t) 1) {\n                            d_haversine_res_45640 = eta_p_45633;\n                            d_haversine_res_45641 = eta_p_45634;\n                        } else {\n                            double zt_res_45642 = 3.141592653589793 * eta_p_45633;\n                            double zs_res_45643 = zt_res_45642 / 180.0;\n                            double zt_res_45644 = 3.141592653589793 * eta_p_45634;\n                            double zs_res_45645 = zt_res_45644 / 180.0;\n                            \n                            d_haversine_res_45640 = zs_res_45643;\n                            d_haversine_res_45641 = zs_res_45645;\n                        }\n                        \n                        double zm_res_45646 = d_haversine_res_45630 - d_haversine_res_45640;\n                        double cos_res_45647 = futrts_cos64(zm_res_45646);\n                        double zm_res_45648 = 1.0 - cos_res_45647;\n                        double cos_res_45649 = futrts_cos64(d_haversine_res_45640);\n                        double zt_res_45650 = cos_res_45632 * cos_res_45649;\n                        double zm_res_45651 = d_haversine_res_45631 - d_haversine_res_45641;\n                        double zm_res_45652 = 1.0 - zm_res_45651;\n                        double zt_res_45653 = zt_res_45650 * zm_res_45652;\n                        double zp_res_45654 = zm_res_45648 + zt_res_45653;\n                 ",
                                    "       double zs_res_45655 = zp_res_45654 / 2.0;\n                        double min_res_45656 = fmin64(1.0, zs_res_45655);\n                        double zt_res_45657 = 2.0 * min_res_45656;\n                        double zm_res_45658 = 1.0 - zt_res_45657;\n                        double acos_res_45659 = futrts_acos64(zm_res_45658);\n                        double zt_res_45660 = clBase_34776 * acos_res_45659;\n                        \n                        dist_res_45636 = zt_res_45660;\n                    }\n                    // save results to be reduced\n                    {\n                        ((__local int64_t *) red_arr_i64_mem_51832)[sext_i32_i64(local_tid_51828)] = x_45635;\n                        ((__local double *) red_arr_f64_mem_51834)[sext_i32_i64(local_tid_51828)] = dist_res_45636;\n                    }\n                }\n            } else {\n                ((__local int64_t *) red_arr_i64_mem_51832)[sext_i32_i64(local_tid_51828)] = (int64_t) -1;\n                ((__local double *) red_arr_f64_mem_51834)[sext_i32_i64(local_tid_51828)] = INFINITY;\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        if (slt64((int64_t) 0, conc_tmp_41556)) {\n            // perform segmented scan to imitate reduction\n            {\n                int64_t eta_p_45616;\n                double eta_p_45617;\n                int64_t eta_p_45618;\n                double eta_p_45619;\n                int64_t eta_p_51842;\n                double eta_p_51843;\n                int64_t eta_p_51844;\n                double eta_p_51845;\n                bool ltid_in_bounds_51854 = slt64(sext_i32_i64(local_tid_51828), conc_tmp_41556 * squot64(segred_tblock_sizze_45608, segment_sizze_nonzzero_51825));\n                int32_t skip_threads_51855;\n                \n                // read input for in-block scan\n                {\n                    if (ltid_in_bounds_51854) {\n                        eta_p_45618 = ((volatile __local int64_t *) red_arr_i64_mem_51832)[sext_i32_i64", "(local_tid_51828)];\n                        eta_p_45619 = ((volatile __local double *) red_arr_f64_mem_51834)[sext_i32_i64(local_tid_51828)];\n                        if ((local_tid_51828 - squot32(local_tid_51828, 32) * 32) == 0) {\n                            eta_p_45616 = eta_p_45618;\n                            eta_p_45617 = eta_p_45619;\n                        }\n                    }\n                }\n                // in-block scan (hopefully no barriers needed)\n                {\n                    skip_threads_51855 = 1;\n                    while (slt32(skip_threads_51855, 32)) {\n                        bool thread_active_51856 = sle32(skip_threads_51855, local_tid_51828 - squot32(local_tid_51828, 32) * 32) && ltid_in_bounds_51854;\n                        \n                        if (thread_active_51856) {\n                            // read operands\n                            {\n                                eta_p_45616 = ((volatile __local int64_t *) red_arr_i64_mem_51832)[sext_i32_i64(local_tid_51828) - sext_i32_i64(skip_threads_51855)];\n                                eta_p_45617 = ((volatile __local double *) red_arr_f64_mem_51834)[sext_i32_i64(local_tid_51828) - sext_i32_i64(skip_threads_51855)];\n                            }\n                        }\n                        // perform operation\n                        {\n                            bool inactive_51857 = slt64(srem64(sext_i32_i64(local_tid_51828), conc_tmp_41556), sext_i32_i64(local_tid_51828) - sext_i32_i64(local_tid_51828 - skip_threads_51855));\n                            \n                            if (thread_active_51856 && inactive_51857) {\n                                eta_p_45616 = eta_p_45618;\n                                eta_p_45617 = eta_p_45619;\n                            }\n                            if (thread_active_51856) {\n                                if (!inactive_51857) {\n                                    bool zg_res_45620 = clBase_34770 < eta_p_45617;\n  ", "                                  bool zg_res_45621 = clBase_34770 < eta_p_45619;\n                                    bool x_45622 = zg_res_45620 && zg_res_45621;\n                                    int64_t lifted_lambda_res_45623;\n                                    double lifted_lambda_res_45624;\n                                    \n                                    if (x_45622) {\n                                        lifted_lambda_res_45623 = (int64_t) -1;\n                                        lifted_lambda_res_45624 = INFINITY;\n                                    } else {\n                                        bool zl_res_45625 = eta_p_45617 < eta_p_45619;\n                                        int64_t lifted_lambda_res_f_res_45626;\n                                        \n                                        if (zl_res_45625) {\n                                            lifted_lambda_res_f_res_45626 = eta_p_45616;\n                                        } else {\n                                            lifted_lambda_res_f_res_45626 = eta_p_45618;\n                                        }\n                                        \n                                        double lifted_lambda_res_f_res_45627;\n                                        \n                                        if (zl_res_45625) {\n                                            lifted_lambda_res_f_res_45627 = eta_p_45617;\n                                        } else {\n                                            lifted_lambda_res_f_res_45627 = eta_p_45619;\n                                        }\n                                        lifted_lambda_res_45623 = lifted_lambda_res_f_res_45626;\n                                        lifted_lambda_res_45624 = lifted_lambda_res_f_res_45627;\n                                    }\n                                    eta_p_45616 = lifted_lambda_res_45623;\n                                    eta_p_45617 = lifted_lambda_res_45624;\n    ",
                                    "                            }\n                            }\n                        }\n                        if (sle32(wave_sizze_51830, skip_threads_51855)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        if (thread_active_51856) {\n                            // write result\n                            {\n                                ((volatile __local int64_t *) red_arr_i64_mem_51832)[sext_i32_i64(local_tid_51828)] = eta_p_45616;\n                                eta_p_45618 = eta_p_45616;\n                                ((volatile __local double *) red_arr_f64_mem_51834)[sext_i32_i64(local_tid_51828)] = eta_p_45617;\n                                eta_p_45619 = eta_p_45617;\n                            }\n                        }\n                        if (sle32(wave_sizze_51830, skip_threads_51855)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        skip_threads_51855 *= 2;\n                    }\n                }\n                barrier(CLK_LOCAL_MEM_FENCE);\n                // last thread of block 'i' writes its result to offset 'i'\n                {\n                    if ((local_tid_51828 - squot32(local_tid_51828, 32) * 32) == 31 && ltid_in_bounds_51854) {\n                        ((volatile __local int64_t *) red_arr_i64_mem_51832)[sext_i32_i64(squot32(local_tid_51828, 32))] = eta_p_45616;\n                        ((volatile __local double *) red_arr_f64_mem_51834)[sext_i32_i64(squot32(local_tid_51828, 32))] = eta_p_45617;\n                    }\n                }\n                barrier(CLK_LOCAL_MEM_FENCE);\n                // scan the first block, after which offset 'i' contains carry-in for block 'i+1'\n                {\n                    int32_t skip_threads_51858;\n                    \n                    // read input for in-block scan\n                    {\n                        if (squot32(local_tid_51828, 32) == 0 && ltid_in_bounds_", "51854) {\n                            eta_p_51844 = ((volatile __local int64_t *) red_arr_i64_mem_51832)[sext_i32_i64(local_tid_51828)];\n                            eta_p_51845 = ((volatile __local double *) red_arr_f64_mem_51834)[sext_i32_i64(local_tid_51828)];\n                            if ((local_tid_51828 - squot32(local_tid_51828, 32) * 32) == 0) {\n                                eta_p_51842 = eta_p_51844;\n                                eta_p_51843 = eta_p_51845;\n                            }\n                        }\n                    }\n                    // in-block scan (hopefully no barriers needed)\n                    {\n                        skip_threads_51858 = 1;\n                        while (slt32(skip_threads_51858, 32)) {\n                            bool thread_active_51859 = sle32(skip_threads_51858, local_tid_51828 - squot32(local_tid_51828, 32) * 32) && (squot32(local_tid_51828, 32) == 0 && ltid_in_bounds_51854);\n                            \n                            if (thread_active_51859) {\n                                // read operands\n                                {\n                                    eta_p_51842 = ((volatile __local int64_t *) red_arr_i64_mem_51832)[sext_i32_i64(local_tid_51828) - sext_i32_i64(skip_threads_51858)];\n                                    eta_p_51843 = ((volatile __local double *) red_arr_f64_mem_51834)[sext_i32_i64(local_tid_51828) - sext_i32_i64(skip_threads_51858)];\n                                }\n                            }\n                            // perform operation\n                            {\n                                bool inactive_51860 = slt64(srem64(sext_i32_i64(local_tid_51828 * 32 + 32 - 1), conc_tmp_41556), sext_i32_i64(local_tid_51828 * 32 + 32 - 1) - sext_i32_i64((local_tid_51828 - skip_threads_51858) * 32 + 32 - 1));\n                                \n                                if (thread_active_51859 && inactive_51860) {\n                                    eta_p_518", "42 = eta_p_51844;\n                                    eta_p_51843 = eta_p_51845;\n                                }\n                                if (thread_active_51859) {\n                                    if (!inactive_51860) {\n                                        bool zg_res_51846 = clBase_34770 < eta_p_51843;\n                                        bool zg_res_51847 = clBase_34770 < eta_p_51845;\n                                        bool x_51848 = zg_res_51846 && zg_res_51847;\n                                        int64_t lifted_lambda_res_51849;\n                                        double lifted_lambda_res_51850;\n                                        \n                                        if (x_51848) {\n                                            lifted_lambda_res_51849 = (int64_t) -1;\n                                            lifted_lambda_res_51850 = INFINITY;\n                                        } else {\n                                            bool zl_res_51851 = eta_p_51843 < eta_p_51845;\n                                            int64_t lifted_lambda_res_f_res_51852;\n                                            \n                                            if (zl_res_51851) {\n                                                lifted_lambda_res_f_res_51852 = eta_p_51842;\n                                            } else {\n                                                lifted_lambda_res_f_res_51852 = eta_p_51844;\n                                            }\n                                            \n                                            double lifted_lambda_res_f_res_51853;\n                                            \n                                            if (zl_res_51851) {\n                                                lifted_lambda_res_f_res_51853 = eta_p_51843;\n                                            } else {\n                                                lifted_lambda_res_f_res_51853 = eta_p_51845;\n         ",
                                    "                                   }\n                                            lifted_lambda_res_51849 = lifted_lambda_res_f_res_51852;\n                                            lifted_lambda_res_51850 = lifted_lambda_res_f_res_51853;\n                                        }\n                                        eta_p_51842 = lifted_lambda_res_51849;\n                                        eta_p_51843 = lifted_lambda_res_51850;\n                                    }\n                                }\n                            }\n                            if (sle32(wave_sizze_51830, skip_threads_51858)) {\n                                barrier(CLK_LOCAL_MEM_FENCE);\n                            }\n                            if (thread_active_51859) {\n                                // write result\n                                {\n                                    ((volatile __local int64_t *) red_arr_i64_mem_51832)[sext_i32_i64(local_tid_51828)] = eta_p_51842;\n                                    eta_p_51844 = eta_p_51842;\n                                    ((volatile __local double *) red_arr_f64_mem_51834)[sext_i32_i64(local_tid_51828)] = eta_p_51843;\n                                    eta_p_51845 = eta_p_51843;\n                                }\n                            }\n                            if (sle32(wave_sizze_51830, skip_threads_51858)) {\n                                barrier(CLK_LOCAL_MEM_FENCE);\n                            }\n                            skip_threads_51858 *= 2;\n                        }\n                    }\n                }\n                barrier(CLK_LOCAL_MEM_FENCE);\n                \n                bool no_carry_in_51861 = squot32(local_tid_51828, 32) == 0 || !ltid_in_bounds_51854;\n                \n                // carry-in for every block except the first\n                {\n                    // read operands\n                    {\n                        if (!no_carry_in_51861) {\n                            eta_p", "_45618 = eta_p_45616;\n                            eta_p_45619 = eta_p_45617;\n                            eta_p_45616 = ((__local int64_t *) red_arr_i64_mem_51832)[sext_i32_i64(squot32(local_tid_51828, 32)) - (int64_t) 1];\n                            eta_p_45617 = ((__local double *) red_arr_f64_mem_51834)[sext_i32_i64(squot32(local_tid_51828, 32)) - (int64_t) 1];\n                        }\n                    }\n                    // perform operation\n                    {\n                        bool inactive_51862 = slt64(srem64(sext_i32_i64(local_tid_51828), conc_tmp_41556), sext_i32_i64(local_tid_51828) - sext_i32_i64(squot32(local_tid_51828, 32) * 32 - 1));\n                        \n                        if (!no_carry_in_51861) {\n                            if (inactive_51862) {\n                                eta_p_45616 = eta_p_45618;\n                                eta_p_45617 = eta_p_45619;\n                            }\n                        }\n                        if (!no_carry_in_51861) {\n                            if (!inactive_51862) {\n                                bool zg_res_45620 = clBase_34770 < eta_p_45617;\n                                bool zg_res_45621 = clBase_34770 < eta_p_45619;\n                                bool x_45622 = zg_res_45620 && zg_res_45621;\n                                int64_t lifted_lambda_res_45623;\n                                double lifted_lambda_res_45624;\n                                \n                                if (x_45622) {\n                                    lifted_lambda_res_45623 = (int64_t) -1;\n                                    lifted_lambda_res_45624 = INFINITY;\n                                } else {\n                                    bool zl_res_45625 = eta_p_45617 < eta_p_45619;\n                                    int64_t lifted_lambda_res_f_res_45626;\n                                    \n                                    if (zl_res_45625) {\n                                        lift", "ed_lambda_res_f_res_45626 = eta_p_45616;\n                                    } else {\n                                        lifted_lambda_res_f_res_45626 = eta_p_45618;\n                                    }\n                                    \n                                    double lifted_lambda_res_f_res_45627;\n                                    \n                                    if (zl_res_45625) {\n                                        lifted_lambda_res_f_res_45627 = eta_p_45617;\n                                    } else {\n                                        lifted_lambda_res_f_res_45627 = eta_p_45619;\n                                    }\n                                    lifted_lambda_res_45623 = lifted_lambda_res_f_res_45626;\n                                    lifted_lambda_res_45624 = lifted_lambda_res_f_res_45627;\n                                }\n                                eta_p_45616 = lifted_lambda_res_45623;\n                                eta_p_45617 = lifted_lambda_res_45624;\n                            }\n                        }\n                    }\n                    // write final result\n                    {\n                        if (!no_carry_in_51861) {\n                            ((__local int64_t *) red_arr_i64_mem_51832)[sext_i32_i64(local_tid_51828)] = eta_p_45616;\n                            ((__local double *) red_arr_f64_mem_51834)[sext_i32_i64(local_tid_51828)] = eta_p_45617;\n                        }\n                    }\n                }\n                barrier(CLK_LOCAL_MEM_FENCE);\n                // restore correct values for first block\n                {\n                    if (squot32(local_tid_51828, 32) == 0 && ltid_in_bounds_51854) {\n                        ((__local int64_t *) red_arr_i64_mem_51832)[sext_i32_i64(local_tid_51828)] = eta_p_45618;\n                        ((__local double *) red_arr_f64_mem_51834)[sext_i32_i64(local_tid_51828)] = eta_p_45619;\n                    }\n                }\n     ",
                                    "           barrier(CLK_LOCAL_MEM_FENCE);\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        // save final values of segments\n        {\n            if (slt64(sext_i32_i64(virt_tblock_id_51839) * squot64(segred_tblock_sizze_45608, segment_sizze_nonzzero_51825) + sext_i32_i64(local_tid_51828), dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_41966) && slt64(sext_i32_i64(local_tid_51828), squot64(segred_tblock_sizze_45608, segment_sizze_nonzzero_51825))) {\n                int64_t tmp_51863 = ((__local int64_t *) red_arr_i64_mem_51832)[(sext_i32_i64(local_tid_51828) + (int64_t) 1) * segment_sizze_nonzzero_51825 - (int64_t) 1];\n                \n                ((__global int64_t *) mem_49494)[inf_41963 + (sext_i32_i64(virt_tblock_id_51839) * squot64(segred_tblock_sizze_45608, segment_sizze_nonzzero_51825) + sext_i32_i64(local_tid_51828))] = tmp_51863;\n                \n                double tmp_51864 = ((__local double *) red_arr_f64_mem_51834)[(sext_i32_i64(local_tid_51828) + (int64_t) 1) * segment_sizze_nonzzero_51825 - (int64_t) 1];\n                \n                ((__global double *) mem_49859)[sext_i32_i64(virt_tblock_id_51839) * squot64(segred_tblock_sizze_45608, segment_sizze_nonzzero_51825) + sext_i32_i64(local_tid_51828)] = tmp_51864;\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    }\n    \n  error_3:\n    return;\n    #undef segred_tblock_sizze_45608\n}\nFUTHARK_KERNEL_SIZED(do_DBSCAN_doublezisegred_small_45909_dim1, 1, 1)\nvoid do_DBSCAN_doublezisegred_small_45909(__global int *global_failure, int8_t clBase_34768, int8_t clBase_34769, double clBase_34770, double clBase_34776, int64_t conc_tmp_41556, int64_t inf_42046, int64_t dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_42049, int64_t num_tblocks_45903, unsigned char x_49366_bits, int64_t segment_sizze_nonzzero_51984, __global unsigned char *current_partition_mem_49387, __global unsigned char *current_partition_mem_49388, __global unsigned char *", "mem_49424, __global unsigned char *ext_mem_49839, __global unsigned char *mem_49842, __global unsigned char *mem_49844, __global unsigned char *mem_49940, __global unsigned char *mem_49942, __global unsigned char *mem_49944, __global unsigned char *mem_49949)\n{\n    bool x_49366 = x_49366_bits;\n    \n    #define segred_tblock_sizze_45902 (do_DBSCAN_doublezisegred_small_45909zisegred_tblock_sizze_45902)\n    \n    volatile __local unsigned char *red_arr_f64_mem_51993_backing_1 = &shared_mem[0];\n    const int64_t red_arr_f64_mem_51993_backing_1_offset = 0 + ((int64_t) 8 * segred_tblock_sizze_45902 + srem64((int64_t) 8 - srem64((int64_t) 8 * segred_tblock_sizze_45902, (int64_t) 8), (int64_t) 8));\n    volatile __local unsigned char *red_arr_i64_mem_51991_backing_0 = &shared_mem[red_arr_f64_mem_51993_backing_1_offset];\n    const int64_t red_arr_i64_mem_51991_backing_0_offset = red_arr_f64_mem_51993_backing_1_offset + ((int64_t) 8 * segred_tblock_sizze_45902 + srem64((int64_t) 8 - srem64((int64_t) 8 * segred_tblock_sizze_45902, (int64_t) 8), (int64_t) 8));\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_51987;\n    int32_t tblock_sizze_51990;\n    int32_t wave_sizze_51989;\n    int32_t block_id_51988;\n    int32_t global_tid_51986;\n    int64_t phys_tid_45909;\n    __local unsigned char *red_arr_i64_mem_51991;\n    __local unsigned char *red_arr_f64_mem_51993;\n    int32_t phys_tblock_id_51995;\n    int32_t iterations_51996;\n    \n    local_tid_51987 = get_local_id(0);\n    tblock_sizze_51990 = get_local_size(0);\n    wave_sizze_51989 = LOCKSTEP_WIDTH;\n    block_id_51988 = get_tblock_id(0);\n    global_tid_51986 = block_id_51988 * tblock_sizze_51990 + local_tid_51987;\n    phys_tid_45909 = sext_i32_i64(global_tid_51986);\n    red_arr_i64_mem_51991 = (__local unsigned char *) red_arr_i64_mem_51991_backing_0;\n    red_arr_f64_mem_51993 = (__local unsigned char *) red_arr_f64_mem_51993_backing_1;\n    phys_tblock_id_51995 = get_tblock_id(0);\n    iterations_51996 = s", "div_up32(sext_i64_i32(sdiv_up64(dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_42049, squot64(segred_tblock_sizze_45902, segment_sizze_nonzzero_51984))) - phys_tblock_id_51995, sext_i64_i32(num_tblocks_45903));\n    for (int32_t i_51997 = 0; i_51997 < iterations_51996; i_51997++) {\n        int32_t virt_tblock_id_51998;\n        int64_t slice_51999;\n        int64_t gtid_45907;\n        int64_t remnant_52000;\n        int64_t gtid_45908;\n        \n        virt_tblock_id_51998 = phys_tblock_id_51995 + i_51997 * sext_i64_i32(num_tblocks_45903);\n        slice_51999 = dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_42049;\n        gtid_45907 = squot64(sext_i32_i64(local_tid_51987), segment_sizze_nonzzero_51984) + sext_i32_i64(virt_tblock_id_51998) * squot64(segred_tblock_sizze_45902, segment_sizze_nonzzero_51984);\n        remnant_52000 = squot64(sext_i32_i64(local_tid_51987), segment_sizze_nonzzero_51984) + sext_i32_i64(virt_tblock_id_51998) * squot64(segred_tblock_sizze_45902, segment_sizze_nonzzero_51984) - gtid_45907;\n        gtid_45908 = srem64(sext_i32_i64(local_tid_51987), conc_tmp_41556);\n        // apply map function if in bounds\n        {\n            if (slt64((int64_t) 0, conc_tmp_41556) && (slt64(gtid_45907, dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_42049) && slt64(sext_i32_i64(local_tid_51987), conc_tmp_41556 * squot64(segred_tblock_sizze_45902, segment_sizze_nonzzero_51984)))) {\n                // apply map function\n                {\n                    int64_t slice_46427 = inf_42046 + gtid_45907;\n                    double eta_p_45927 = ((__global double *) mem_49842)[gtid_45908];\n                    double eta_p_45928 = ((__global double *) mem_49844)[gtid_45908];\n                    int64_t x_45929 = ((__global int64_t *) ext_mem_49839)[gtid_45908];\n                    double d_haversine_res_45924;\n                    \n                    if (x_49366) {\n                        double x_49350 = ((__global double *) mem_49940)[gtid_45907];\n                        \n                        d_haversi",
                                    "ne_res_45924 = x_49350;\n                    } else {\n                        d_haversine_res_45924 = 0.0;\n                    }\n                    \n                    double d_haversine_res_45925;\n                    \n                    if (x_49366) {\n                        double x_49352 = ((__global double *) mem_49942)[gtid_45907];\n                        \n                        d_haversine_res_45925 = x_49352;\n                    } else {\n                        d_haversine_res_45925 = 0.0;\n                    }\n                    \n                    double cos_res_45926;\n                    \n                    if (x_49366) {\n                        double x_49354 = ((__global double *) mem_49944)[gtid_45907];\n                        \n                        cos_res_45926 = x_49354;\n                    } else {\n                        cos_res_45926 = 0.0;\n                    }\n                    \n                    double dist_res_45930;\n                    \n                    if (clBase_34769 == (int8_t) 0) {\n                        double eta_p_45922 = ((__global double *) current_partition_mem_49387)[slice_46427];\n                        double eta_p_45923 = ((__global double *) current_partition_mem_49388)[slice_46427];\n                        double zm_res_45931 = eta_p_45923 - eta_p_45928;\n                        double zm_res_45932 = eta_p_45922 - eta_p_45927;\n                        double hypot_res_45933 = futrts_hypot64(zm_res_45932, zm_res_45931);\n                        \n                        dist_res_45930 = hypot_res_45933;\n                    } else {\n                        double d_haversine_res_45934;\n                        double d_haversine_res_45935;\n                        \n                        if (clBase_34768 == (int8_t) 1) {\n                            d_haversine_res_45934 = eta_p_45927;\n                            d_haversine_res_45935 = eta_p_45928;\n                        } else {\n                            double z", "t_res_45936 = 3.141592653589793 * eta_p_45927;\n                            double zs_res_45937 = zt_res_45936 / 180.0;\n                            double zt_res_45938 = 3.141592653589793 * eta_p_45928;\n                            double zs_res_45939 = zt_res_45938 / 180.0;\n                            \n                            d_haversine_res_45934 = zs_res_45937;\n                            d_haversine_res_45935 = zs_res_45939;\n                        }\n                        \n                        double zm_res_45940 = d_haversine_res_45924 - d_haversine_res_45934;\n                        double cos_res_45941 = futrts_cos64(zm_res_45940);\n                        double zm_res_45942 = 1.0 - cos_res_45941;\n                        double cos_res_45943 = futrts_cos64(d_haversine_res_45934);\n                        double zt_res_45944 = cos_res_45926 * cos_res_45943;\n                        double zm_res_45945 = d_haversine_res_45925 - d_haversine_res_45935;\n                        double zm_res_45946 = 1.0 - zm_res_45945;\n                        double zt_res_45947 = zt_res_45944 * zm_res_45946;\n                        double zp_res_45948 = zm_res_45942 + zt_res_45947;\n                        double zs_res_45949 = zp_res_45948 / 2.0;\n                        double min_res_45950 = fmin64(1.0, zs_res_45949);\n                        double zt_res_45951 = 2.0 * min_res_45950;\n                        double zm_res_45952 = 1.0 - zt_res_45951;\n                        double acos_res_45953 = futrts_acos64(zm_res_45952);\n                        double zt_res_45954 = clBase_34776 * acos_res_45953;\n                        \n                        dist_res_45930 = zt_res_45954;\n                    }\n                    // save results to be reduced\n                    {\n                        ((__local int64_t *) red_arr_i64_mem_51991)[sext_i32_i64(local_tid_51987)] = x_45929;\n                        ((__local double *) red_arr_f64_mem_51993)[sext_i32_i64(local_tid_51987)] ", "= dist_res_45930;\n                    }\n                }\n            } else {\n                ((__local int64_t *) red_arr_i64_mem_51991)[sext_i32_i64(local_tid_51987)] = (int64_t) -1;\n                ((__local double *) red_arr_f64_mem_51993)[sext_i32_i64(local_tid_51987)] = INFINITY;\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        if (slt64((int64_t) 0, conc_tmp_41556)) {\n            // perform segmented scan to imitate reduction\n            {\n                int64_t eta_p_45910;\n                double eta_p_45911;\n                int64_t eta_p_45912;\n                double eta_p_45913;\n                int64_t eta_p_52001;\n                double eta_p_52002;\n                int64_t eta_p_52003;\n                double eta_p_52004;\n                bool ltid_in_bounds_52013 = slt64(sext_i32_i64(local_tid_51987), conc_tmp_41556 * squot64(segred_tblock_sizze_45902, segment_sizze_nonzzero_51984));\n                int32_t skip_threads_52014;\n                \n                // read input for in-block scan\n                {\n                    if (ltid_in_bounds_52013) {\n                        eta_p_45912 = ((volatile __local int64_t *) red_arr_i64_mem_51991)[sext_i32_i64(local_tid_51987)];\n                        eta_p_45913 = ((volatile __local double *) red_arr_f64_mem_51993)[sext_i32_i64(local_tid_51987)];\n                        if ((local_tid_51987 - squot32(local_tid_51987, 32) * 32) == 0) {\n                            eta_p_45910 = eta_p_45912;\n                            eta_p_45911 = eta_p_45913;\n                        }\n                    }\n                }\n                // in-block scan (hopefully no barriers needed)\n                {\n                    skip_threads_52014 = 1;\n                    while (slt32(skip_threads_52014, 32)) {\n                        bool thread_active_52015 = sle32(skip_threads_52014, local_tid_51987 - squot32(local_tid_51987, 32) * 32) && ltid_in_bounds_52013;\n                        \n                  ",
                                    "      if (thread_active_52015) {\n                            // read operands\n                            {\n                                eta_p_45910 = ((volatile __local int64_t *) red_arr_i64_mem_51991)[sext_i32_i64(local_tid_51987) - sext_i32_i64(skip_threads_52014)];\n                                eta_p_45911 = ((volatile __local double *) red_arr_f64_mem_51993)[sext_i32_i64(local_tid_51987) - sext_i32_i64(skip_threads_52014)];\n                            }\n                        }\n                        // perform operation\n                        {\n                            bool inactive_52016 = slt64(srem64(sext_i32_i64(local_tid_51987), conc_tmp_41556), sext_i32_i64(local_tid_51987) - sext_i32_i64(local_tid_51987 - skip_threads_52014));\n                            \n                            if (thread_active_52015 && inactive_52016) {\n                                eta_p_45910 = eta_p_45912;\n                                eta_p_45911 = eta_p_45913;\n                            }\n                            if (thread_active_52015) {\n                                if (!inactive_52016) {\n                                    bool zg_res_45914 = clBase_34770 < eta_p_45911;\n                                    bool zg_res_45915 = clBase_34770 < eta_p_45913;\n                                    bool x_45916 = zg_res_45914 && zg_res_45915;\n                                    int64_t lifted_lambda_res_45917;\n                                    double lifted_lambda_res_45918;\n                                    \n                                    if (x_45916) {\n                                        lifted_lambda_res_45917 = (int64_t) -1;\n                                        lifted_lambda_res_45918 = INFINITY;\n                                    } else {\n                                        bool zl_res_45919 = eta_p_45911 < eta_p_45913;\n                                        int64_t lifted_lambda_res_f_res_45920;\n                                     ", "   \n                                        if (zl_res_45919) {\n                                            lifted_lambda_res_f_res_45920 = eta_p_45910;\n                                        } else {\n                                            lifted_lambda_res_f_res_45920 = eta_p_45912;\n                                        }\n                                        \n                                        double lifted_lambda_res_f_res_45921;\n                                        \n                                        if (zl_res_45919) {\n                                            lifted_lambda_res_f_res_45921 = eta_p_45911;\n                                        } else {\n                                            lifted_lambda_res_f_res_45921 = eta_p_45913;\n                                        }\n                                        lifted_lambda_res_45917 = lifted_lambda_res_f_res_45920;\n                                        lifted_lambda_res_45918 = lifted_lambda_res_f_res_45921;\n                                    }\n                                    eta_p_45910 = lifted_lambda_res_45917;\n                                    eta_p_45911 = lifted_lambda_res_45918;\n                                }\n                            }\n                        }\n                        if (sle32(wave_sizze_51989, skip_threads_52014)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        if (thread_active_52015) {\n                            // write result\n                            {\n                                ((volatile __local int64_t *) red_arr_i64_mem_51991)[sext_i32_i64(local_tid_51987)] = eta_p_45910;\n                                eta_p_45912 = eta_p_45910;\n                                ((volatile __local double *) red_arr_f64_mem_51993)[sext_i32_i64(local_tid_51987)] = eta_p_45911;\n                                eta_p_45913 = eta_p_45911;\n                            }\n             ", "           }\n                        if (sle32(wave_sizze_51989, skip_threads_52014)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        skip_threads_52014 *= 2;\n                    }\n                }\n                barrier(CLK_LOCAL_MEM_FENCE);\n                // last thread of block 'i' writes its result to offset 'i'\n                {\n                    if ((local_tid_51987 - squot32(local_tid_51987, 32) * 32) == 31 && ltid_in_bounds_52013) {\n                        ((volatile __local int64_t *) red_arr_i64_mem_51991)[sext_i32_i64(squot32(local_tid_51987, 32))] = eta_p_45910;\n                        ((volatile __local double *) red_arr_f64_mem_51993)[sext_i32_i64(squot32(local_tid_51987, 32))] = eta_p_45911;\n                    }\n                }\n                barrier(CLK_LOCAL_MEM_FENCE);\n                // scan the first block, after which offset 'i' contains carry-in for block 'i+1'\n                {\n                    int32_t skip_threads_52017;\n                    \n                    // read input for in-block scan\n                    {\n                        if (squot32(local_tid_51987, 32) == 0 && ltid_in_bounds_52013) {\n                            eta_p_52003 = ((volatile __local int64_t *) red_arr_i64_mem_51991)[sext_i32_i64(local_tid_51987)];\n                            eta_p_52004 = ((volatile __local double *) red_arr_f64_mem_51993)[sext_i32_i64(local_tid_51987)];\n                            if ((local_tid_51987 - squot32(local_tid_51987, 32) * 32) == 0) {\n                                eta_p_52001 = eta_p_52003;\n                                eta_p_52002 = eta_p_52004;\n                            }\n                        }\n                    }\n                    // in-block scan (hopefully no barriers needed)\n                    {\n                        skip_threads_52017 = 1;\n                        while (slt32(skip_threads_52017, 32)) {\n                            bool threa",
                                    "d_active_52018 = sle32(skip_threads_52017, local_tid_51987 - squot32(local_tid_51987, 32) * 32) && (squot32(local_tid_51987, 32) == 0 && ltid_in_bounds_52013);\n                            \n                            if (thread_active_52018) {\n                                // read operands\n                                {\n                                    eta_p_52001 = ((volatile __local int64_t *) red_arr_i64_mem_51991)[sext_i32_i64(local_tid_51987) - sext_i32_i64(skip_threads_52017)];\n                                    eta_p_52002 = ((volatile __local double *) red_arr_f64_mem_51993)[sext_i32_i64(local_tid_51987) - sext_i32_i64(skip_threads_52017)];\n                                }\n                            }\n                            // perform operation\n                            {\n                                bool inactive_52019 = slt64(srem64(sext_i32_i64(local_tid_51987 * 32 + 32 - 1), conc_tmp_41556), sext_i32_i64(local_tid_51987 * 32 + 32 - 1) - sext_i32_i64((local_tid_51987 - skip_threads_52017) * 32 + 32 - 1));\n                                \n                                if (thread_active_52018 && inactive_52019) {\n                                    eta_p_52001 = eta_p_52003;\n                                    eta_p_52002 = eta_p_52004;\n                                }\n                                if (thread_active_52018) {\n                                    if (!inactive_52019) {\n                                        bool zg_res_52005 = clBase_34770 < eta_p_52002;\n                                        bool zg_res_52006 = clBase_34770 < eta_p_52004;\n                                        bool x_52007 = zg_res_52005 && zg_res_52006;\n                                        int64_t lifted_lambda_res_52008;\n                                        double lifted_lambda_res_52009;\n                                        \n                                        if (x_52007) {\n                                            lifted_lambda", "_res_52008 = (int64_t) -1;\n                                            lifted_lambda_res_52009 = INFINITY;\n                                        } else {\n                                            bool zl_res_52010 = eta_p_52002 < eta_p_52004;\n                                            int64_t lifted_lambda_res_f_res_52011;\n                                            \n                                            if (zl_res_52010) {\n                                                lifted_lambda_res_f_res_52011 = eta_p_52001;\n                                            } else {\n                                                lifted_lambda_res_f_res_52011 = eta_p_52003;\n                                            }\n                                            \n                                            double lifted_lambda_res_f_res_52012;\n                                            \n                                            if (zl_res_52010) {\n                                                lifted_lambda_res_f_res_52012 = eta_p_52002;\n                                            } else {\n                                                lifted_lambda_res_f_res_52012 = eta_p_52004;\n                                            }\n                                            lifted_lambda_res_52008 = lifted_lambda_res_f_res_52011;\n                                            lifted_lambda_res_52009 = lifted_lambda_res_f_res_52012;\n                                        }\n                                        eta_p_52001 = lifted_lambda_res_52008;\n                                        eta_p_52002 = lifted_lambda_res_52009;\n                                    }\n                                }\n                            }\n                            if (sle32(wave_sizze_51989, skip_threads_52017)) {\n                                barrier(CLK_LOCAL_MEM_FENCE);\n                            }\n                            if (thread_active_52018) {\n                         ", "       // write result\n                                {\n                                    ((volatile __local int64_t *) red_arr_i64_mem_51991)[sext_i32_i64(local_tid_51987)] = eta_p_52001;\n                                    eta_p_52003 = eta_p_52001;\n                                    ((volatile __local double *) red_arr_f64_mem_51993)[sext_i32_i64(local_tid_51987)] = eta_p_52002;\n                                    eta_p_52004 = eta_p_52002;\n                                }\n                            }\n                            if (sle32(wave_sizze_51989, skip_threads_52017)) {\n                                barrier(CLK_LOCAL_MEM_FENCE);\n                            }\n                            skip_threads_52017 *= 2;\n                        }\n                    }\n                }\n                barrier(CLK_LOCAL_MEM_FENCE);\n                \n                bool no_carry_in_52020 = squot32(local_tid_51987, 32) == 0 || !ltid_in_bounds_52013;\n                \n                // carry-in for every block except the first\n                {\n                    // read operands\n                    {\n                        if (!no_carry_in_52020) {\n                            eta_p_45912 = eta_p_45910;\n                            eta_p_45913 = eta_p_45911;\n                            eta_p_45910 = ((__local int64_t *) red_arr_i64_mem_51991)[sext_i32_i64(squot32(local_tid_51987, 32)) - (int64_t) 1];\n                            eta_p_45911 = ((__local double *) red_arr_f64_mem_51993)[sext_i32_i64(squot32(local_tid_51987, 32)) - (int64_t) 1];\n                        }\n                    }\n                    // perform operation\n                    {\n                        bool inactive_52021 = slt64(srem64(sext_i32_i64(local_tid_51987), conc_tmp_41556), sext_i32_i64(local_tid_51987) - sext_i32_i64(squot32(local_tid_51987, 32) * 32 - 1));\n                        \n                        if (!no_carry_in_52020) {\n                            if (inactive_52021)",
                                    " {\n                                eta_p_45910 = eta_p_45912;\n                                eta_p_45911 = eta_p_45913;\n                            }\n                        }\n                        if (!no_carry_in_52020) {\n                            if (!inactive_52021) {\n                                bool zg_res_45914 = clBase_34770 < eta_p_45911;\n                                bool zg_res_45915 = clBase_34770 < eta_p_45913;\n                                bool x_45916 = zg_res_45914 && zg_res_45915;\n                                int64_t lifted_lambda_res_45917;\n                                double lifted_lambda_res_45918;\n                                \n                                if (x_45916) {\n                                    lifted_lambda_res_45917 = (int64_t) -1;\n                                    lifted_lambda_res_45918 = INFINITY;\n                                } else {\n                                    bool zl_res_45919 = eta_p_45911 < eta_p_45913;\n                                    int64_t lifted_lambda_res_f_res_45920;\n                                    \n                                    if (zl_res_45919) {\n                                        lifted_lambda_res_f_res_45920 = eta_p_45910;\n                                    } else {\n                                        lifted_lambda_res_f_res_45920 = eta_p_45912;\n                                    }\n                                    \n                                    double lifted_lambda_res_f_res_45921;\n                                    \n                                    if (zl_res_45919) {\n                                        lifted_lambda_res_f_res_45921 = eta_p_45911;\n                                    } else {\n                                        lifted_lambda_res_f_res_45921 = eta_p_45913;\n                                    }\n                                    lifted_lambda_res_45917 = lifted_lambda_res_f_res_45920;\n                                 ", "   lifted_lambda_res_45918 = lifted_lambda_res_f_res_45921;\n                                }\n                                eta_p_45910 = lifted_lambda_res_45917;\n                                eta_p_45911 = lifted_lambda_res_45918;\n                            }\n                        }\n                    }\n                    // write final result\n                    {\n                        if (!no_carry_in_52020) {\n                            ((__local int64_t *) red_arr_i64_mem_51991)[sext_i32_i64(local_tid_51987)] = eta_p_45910;\n                            ((__local double *) red_arr_f64_mem_51993)[sext_i32_i64(local_tid_51987)] = eta_p_45911;\n                        }\n                    }\n                }\n                barrier(CLK_LOCAL_MEM_FENCE);\n                // restore correct values for first block\n                {\n                    if (squot32(local_tid_51987, 32) == 0 && ltid_in_bounds_52013) {\n                        ((__local int64_t *) red_arr_i64_mem_51991)[sext_i32_i64(local_tid_51987)] = eta_p_45912;\n                        ((__local double *) red_arr_f64_mem_51993)[sext_i32_i64(local_tid_51987)] = eta_p_45913;\n                    }\n                }\n                barrier(CLK_LOCAL_MEM_FENCE);\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        // save final values of segments\n        {\n            if (slt64(sext_i32_i64(virt_tblock_id_51998) * squot64(segred_tblock_sizze_45902, segment_sizze_nonzzero_51984) + sext_i32_i64(local_tid_51987), dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_42049) && slt64(sext_i32_i64(local_tid_51987), squot64(segred_tblock_sizze_45902, segment_sizze_nonzzero_51984))) {\n                int64_t tmp_52022 = ((__local int64_t *) red_arr_i64_mem_51991)[(sext_i32_i64(local_tid_51987) + (int64_t) 1) * segment_sizze_nonzzero_51984 - (int64_t) 1];\n                \n                ((__global int64_t *) mem_49424)[inf_42046 + (sext_i32_i64(virt_tblock_id_51998) * squot64(segred_tblock_sizze_45902, segment", "_sizze_nonzzero_51984) + sext_i32_i64(local_tid_51987))] = tmp_52022;\n                \n                double tmp_52023 = ((__local double *) red_arr_f64_mem_51993)[(sext_i32_i64(local_tid_51987) + (int64_t) 1) * segment_sizze_nonzzero_51984 - (int64_t) 1];\n                \n                ((__global double *) mem_49949)[sext_i32_i64(virt_tblock_id_51998) * squot64(segred_tblock_sizze_45902, segment_sizze_nonzzero_51984) + sext_i32_i64(local_tid_51987)] = tmp_52023;\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    }\n    \n  error_3:\n    return;\n    #undef segred_tblock_sizze_45902\n}\nFUTHARK_KERNEL_SIZED(do_DBSCAN_doublezisegscan_44353_dim1, 1, 1)\nvoid do_DBSCAN_doublezisegscan_44353(__global int *global_failure, int64_t n_34757, int64_t num_tblocks_44350, int64_t num_virt_blocks_50238, int64_t num_virt_threads_50239, __global unsigned char *current_partition_mem_49394, __global unsigned char *mem_49403, __global unsigned char *mem_49405, __global unsigned char *status_flags_mem_50240, __global unsigned char *aggregates_mem_50262, __global unsigned char *incprefixes_mem_50264, __global unsigned char *global_dynid_mem_50266)\n{\n    #define segscan_tblock_sizze_44348 (do_DBSCAN_doublezisegscan_44353zisegscan_tblock_sizze_44348)\n    #define chunk_sizze_50237 (do_DBSCAN_doublezisegscan_44353zichunk_sizze_50237)\n    \n    volatile __local unsigned char *local_mem_50296_backing_0 = &shared_mem[0];\n    const int64_t local_mem_50296_backing_0_offset = 0 + (smax64(smax64((int64_t) 288, (int64_t) 8 * segscan_tblock_sizze_44348), chunk_sizze_50237 * segscan_tblock_sizze_44348 * (int64_t) 8) + srem64((int64_t) 8 - srem64(smax64(smax64((int64_t) 288, (int64_t) 8 * segscan_tblock_sizze_44348), chunk_sizze_50237 * segscan_tblock_sizze_44348 * (int64_t) 8), (int64_t) 8), (int64_t) 8));\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_50289;\n    int32_t tblock_sizze_50292;\n    int3",
                                    "2_t wave_sizze_50291;\n    int32_t block_id_50290;\n    int32_t global_tid_50288;\n    int64_t phys_tid_44353;\n    int32_t chunk_sizze_32b_50293;\n    int64_t byte_offsets_50294;\n    int64_t warp_byte_offset_50295;\n    __local unsigned char *local_mem_50296;\n    int64_t trans_arr_len_50297;\n    int64_t phys_block_id_50303;\n    int64_t virtloop_bound_50304;\n    \n    local_tid_50289 = get_local_id(0);\n    tblock_sizze_50292 = get_local_size(0);\n    wave_sizze_50291 = LOCKSTEP_WIDTH;\n    block_id_50290 = get_tblock_id(0);\n    global_tid_50288 = block_id_50290 * tblock_sizze_50292 + local_tid_50289;\n    phys_tid_44353 = sext_i32_i64(global_tid_50288);\n    chunk_sizze_32b_50293 = sext_i64_i32(chunk_sizze_50237);\n    byte_offsets_50294 = segscan_tblock_sizze_44348 * (int64_t) 8;\n    warp_byte_offset_50295 = (int64_t) 288;\n    // Allocate reusable shared memory\n    { }\n    local_mem_50296 = (__local unsigned char *) local_mem_50296_backing_0;\n    trans_arr_len_50297 = chunk_sizze_50237 * segscan_tblock_sizze_44348;\n    phys_block_id_50303 = get_tblock_id(0);\n    virtloop_bound_50304 = sdiv_up64(num_virt_blocks_50238 - phys_block_id_50303, num_tblocks_44350);\n    for (int64_t virtloop_i_50305 = 0; virtloop_i_50305 < virtloop_bound_50304; virtloop_i_50305++) {\n        int64_t dynamic_id_50306;\n        int64_t block_offset_50307;\n        int64_t sgm_idx_50308;\n        int32_t boundary_50309;\n        int32_t segsizze_compact_50310;\n        int64_t private_mem_50311[chunk_sizze_50237];\n        int64_t thd_offset_50313;\n        int64_t acc_50329;\n        int64_t prefix_50339;\n        bool block_new_sgm_50340;\n        \n        // First thread in block fetches this block's dynamic_id\n        {\n            if (local_tid_50289 == 0) {\n                dynamic_id_50306 = atomic_add_i32_global(&((volatile __global int *) global_dynid_mem_50266)[(int64_t) 0], (int) 1);\n                // Set dynamic id for this block\n                {\n                    ((__local int64_t *) local_mem_50296", ")[(int64_t) 0] = dynamic_id_50306;\n                }\n                // First thread in last (virtual) block resets global dynamic_id\n                {\n                    if (dynamic_id_50306 == num_virt_blocks_50238 - (int64_t) 1) {\n                        ((__global int32_t *) global_dynid_mem_50266)[(int64_t) 0] = 0;\n                    }\n                }\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        dynamic_id_50306 = ((__local int32_t *) local_mem_50296)[(int64_t) 0];\n        barrier(CLK_LOCAL_MEM_FENCE);\n        block_offset_50307 = dynamic_id_50306 * chunk_sizze_50237 * segscan_tblock_sizze_44348;\n        sgm_idx_50308 = smod64(block_offset_50307, n_34757);\n        boundary_50309 = sext_i64_i32(smin64(chunk_sizze_50237 * segscan_tblock_sizze_44348, n_34757 - sgm_idx_50308));\n        segsizze_compact_50310 = sext_i64_i32(smin64(chunk_sizze_50237 * segscan_tblock_sizze_44348, n_34757));\n        thd_offset_50313 = block_offset_50307 + sext_i32_i64(local_tid_50289);\n        // Load and map\n        {\n            for (int64_t i_50314 = 0; i_50314 < chunk_sizze_50237; i_50314++) {\n                int64_t virt_tid_50315 = thd_offset_50313 + i_50314 * segscan_tblock_sizze_44348;\n                int64_t slice_50316 = n_34757;\n                int64_t gtid_44352 = virt_tid_50315;\n                int64_t remnant_50317 = virt_tid_50315 - gtid_44352;\n                \n                if (slt64(virt_tid_50315, n_34757)) {\n                    bool eta_p_42441 = ((__global bool *) current_partition_mem_49394)[gtid_44352];\n                    int64_t defunc_0_f_res_42442 = btoi_bool_i64(eta_p_42441);\n                    \n                    ((__global int64_t *) mem_49405)[gtid_44352] = defunc_0_f_res_42442;\n                    private_mem_50311[i_50314] = defunc_0_f_res_42442;\n                } else {\n                    private_mem_50311[i_50314] = (int64_t) 0;\n                }\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        // ", "Transpose scan inputs\n        {\n            for (int64_t i_50318 = 0; i_50318 < chunk_sizze_50237; i_50318++) {\n                int64_t sharedIdx_50319 = sext_i32_i64(local_tid_50289) + i_50318 * segscan_tblock_sizze_44348;\n                int64_t tmp_50320 = private_mem_50311[i_50318];\n                \n                ((__local int64_t *) local_mem_50296)[sharedIdx_50319] = tmp_50320;\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            for (int64_t i_50321 = 0; i_50321 < chunk_sizze_50237; i_50321++) {\n                int64_t sharedIdx_50322 = sext_i32_i64(local_tid_50289) * chunk_sizze_50237 + i_50321;\n                int64_t tmp_50323 = ((__local int64_t *) local_mem_50296)[sharedIdx_50322];\n                \n                private_mem_50311[i_50321] = tmp_50323;\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n        }\n        // Per thread scan\n        {\n            for (int64_t i_50324 = 0; i_50324 < chunk_sizze_50237 - (int64_t) 1; i_50324++) {\n                int64_t eta_p_41226;\n                int64_t eta_p_41227;\n                \n                eta_p_41226 = private_mem_50311[i_50324];\n                eta_p_41227 = private_mem_50311[i_50324 + (int64_t) 1];\n                \n                int64_t defunc_0_op_res_41228 = add64(eta_p_41226, eta_p_41227);\n                \n                private_mem_50311[i_50324 + (int64_t) 1] = defunc_0_op_res_41228;\n            }\n        }\n        // Publish results in shared memory\n        {\n            int64_t tmp_50325 = private_mem_50311[chunk_sizze_50237 - (int64_t) 1];\n            \n            ((__local int64_t *) local_mem_50296)[sext_i32_i64(local_tid_50289)] = tmp_50325;\n            barrier(CLK_LOCAL_MEM_FENCE);\n        }\n        // Scan results (with warp scan)\n        {\n            int64_t eta_p_50326;\n            int64_t eta_p_50327;\n            int64_t eta_p_50330;\n            int64_t eta_p_50331;\n            bool ltid_in_bounds_50333 = slt64(sext_i32_i64(local_tid_50289), num_virt_th",
                                    "reads_50239);\n            int32_t skip_threads_50334;\n            \n            // read input for in-block scan\n            {\n                if (ltid_in_bounds_50333) {\n                    eta_p_50327 = ((volatile __local int64_t *) local_mem_50296)[sext_i32_i64(local_tid_50289)];\n                    if ((local_tid_50289 - squot32(local_tid_50289, 32) * 32) == 0) {\n                        eta_p_50326 = eta_p_50327;\n                    }\n                }\n            }\n            // in-block scan (hopefully no barriers needed)\n            {\n                skip_threads_50334 = 1;\n                while (slt32(skip_threads_50334, 32)) {\n                    bool thread_active_50335 = sle32(skip_threads_50334, local_tid_50289 - squot32(local_tid_50289, 32) * 32) && ltid_in_bounds_50333;\n                    \n                    if (thread_active_50335) {\n                        // read operands\n                        {\n                            eta_p_50326 = ((volatile __local int64_t *) local_mem_50296)[sext_i32_i64(local_tid_50289) - sext_i32_i64(skip_threads_50334)];\n                        }\n                    }\n                    // perform operation\n                    {\n                        if (thread_active_50335) {\n                            int64_t defunc_0_op_res_50328 = add64(eta_p_50326, eta_p_50327);\n                            \n                            eta_p_50326 = defunc_0_op_res_50328;\n                        }\n                    }\n                    if (sle32(wave_sizze_50291, skip_threads_50334)) {\n                        barrier(CLK_LOCAL_MEM_FENCE);\n                    }\n                    if (thread_active_50335) {\n                        // write result\n                        {\n                            ((volatile __local int64_t *) local_mem_50296)[sext_i32_i64(local_tid_50289)] = eta_p_50326;\n                            eta_p_50327 = eta_p_50326;\n                        }\n                    }\n                    if (sle32(wave", "_sizze_50291, skip_threads_50334)) {\n                        barrier(CLK_LOCAL_MEM_FENCE);\n                    }\n                    skip_threads_50334 *= 2;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // last thread of block 'i' writes its result to offset 'i'\n            {\n                if ((local_tid_50289 - squot32(local_tid_50289, 32) * 32) == 31 && ltid_in_bounds_50333) {\n                    ((volatile __local int64_t *) local_mem_50296)[sext_i32_i64(squot32(local_tid_50289, 32))] = eta_p_50326;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // scan the first block, after which offset 'i' contains carry-in for block 'i+1'\n            {\n                int32_t skip_threads_50336;\n                \n                // read input for in-block scan\n                {\n                    if (squot32(local_tid_50289, 32) == 0 && ltid_in_bounds_50333) {\n                        eta_p_50331 = ((volatile __local int64_t *) local_mem_50296)[sext_i32_i64(local_tid_50289)];\n                        if ((local_tid_50289 - squot32(local_tid_50289, 32) * 32) == 0) {\n                            eta_p_50330 = eta_p_50331;\n                        }\n                    }\n                }\n                // in-block scan (hopefully no barriers needed)\n                {\n                    skip_threads_50336 = 1;\n                    while (slt32(skip_threads_50336, 32)) {\n                        bool thread_active_50337 = sle32(skip_threads_50336, local_tid_50289 - squot32(local_tid_50289, 32) * 32) && (squot32(local_tid_50289, 32) == 0 && ltid_in_bounds_50333);\n                        \n                        if (thread_active_50337) {\n                            // read operands\n                            {\n                                eta_p_50330 = ((volatile __local int64_t *) local_mem_50296)[sext_i32_i64(local_tid_50289) - sext_i32_i64(skip_threads_50336)];\n                            }\n      ", "                  }\n                        // perform operation\n                        {\n                            if (thread_active_50337) {\n                                int64_t defunc_0_op_res_50332 = add64(eta_p_50330, eta_p_50331);\n                                \n                                eta_p_50330 = defunc_0_op_res_50332;\n                            }\n                        }\n                        if (sle32(wave_sizze_50291, skip_threads_50336)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        if (thread_active_50337) {\n                            // write result\n                            {\n                                ((volatile __local int64_t *) local_mem_50296)[sext_i32_i64(local_tid_50289)] = eta_p_50330;\n                                eta_p_50331 = eta_p_50330;\n                            }\n                        }\n                        if (sle32(wave_sizze_50291, skip_threads_50336)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        skip_threads_50336 *= 2;\n                    }\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            \n            bool no_carry_in_50338 = squot32(local_tid_50289, 32) == 0 || !ltid_in_bounds_50333;\n            \n            // carry-in for every block except the first\n            {\n                // read operands\n                {\n                    if (!no_carry_in_50338) {\n                        eta_p_50327 = eta_p_50326;\n                        eta_p_50326 = ((__local int64_t *) local_mem_50296)[sext_i32_i64(squot32(local_tid_50289, 32)) - (int64_t) 1];\n                    }\n                }\n                // perform operation\n                {\n                    if (!no_carry_in_50338) {\n                        int64_t defunc_0_op_res_50328 = add64(eta_p_50326, eta_p_50327);\n                        \n                        eta_p_50326 = d",
                                    "efunc_0_op_res_50328;\n                    }\n                }\n                // write final result\n                {\n                    if (!no_carry_in_50338) {\n                        ((__local int64_t *) local_mem_50296)[sext_i32_i64(local_tid_50289)] = eta_p_50326;\n                    }\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // restore correct values for first block\n            {\n                if (squot32(local_tid_50289, 32) == 0 && ltid_in_bounds_50333) {\n                    ((__local int64_t *) local_mem_50296)[sext_i32_i64(local_tid_50289)] = eta_p_50327;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            barrier(CLK_LOCAL_MEM_FENCE);\n            if (local_tid_50289 == 0) {\n                acc_50329 = ((__local int64_t *) local_mem_50296)[segscan_tblock_sizze_44348 - (int64_t) 1];\n            } else {\n                acc_50329 = ((__local int64_t *) local_mem_50296)[sext_i32_i64(local_tid_50289) - (int64_t) 1];\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n        }\n        prefix_50339 = (int64_t) 0;\n        block_new_sgm_50340 = sgm_idx_50308 == (int64_t) 0;\n        // Perform lookback\n        {\n            if (block_new_sgm_50340 && local_tid_50289 == 0) {\n                ((volatile __global int64_t *) incprefixes_mem_50264)[dynamic_id_50306] = acc_50329;\n                mem_fence_global();\n                ((volatile __global int8_t *) status_flags_mem_50240)[dynamic_id_50306] = (int8_t) 2;\n                acc_50329 = (int64_t) 0;\n            }\n            if (!block_new_sgm_50340 && slt32(local_tid_50289, wave_sizze_50291)) {\n                if (local_tid_50289 == 0) {\n                    ((volatile __global int64_t *) aggregates_mem_50262)[dynamic_id_50306] = acc_50329;\n                    mem_fence_global();\n                    ((volatile __global int8_t *) status_flags_mem_50240)[dynamic_id_50306] = (int8_t) 1;\n                    \n                    int8_", "t tmp_50341 = ((volatile __global int8_t *) status_flags_mem_50240)[dynamic_id_50306 - (int64_t) 1];\n                    \n                    ((volatile __local int8_t *) local_mem_50296)[(int64_t) 0] = tmp_50341;\n                }\n                mem_fence_local();\n                \n                int8_t status_50342 = ((__local int8_t *) local_mem_50296)[(int64_t) 0];\n                \n                if (status_50342 == (int8_t) 2) {\n                    if (local_tid_50289 == 0) {\n                        prefix_50339 = ((volatile __global int64_t *) incprefixes_mem_50264)[dynamic_id_50306 - (int64_t) 1];\n                    }\n                } else {\n                    int32_t readOffset_50343 = sext_i64_i32(dynamic_id_50306 - sext_i32_i64(wave_sizze_50291));\n                    \n                    while (slt32(wave_sizze_50291 * -1, readOffset_50343)) {\n                        int32_t read_i_50344 = readOffset_50343 + local_tid_50289;\n                        int64_t aggr_50345 = (int64_t) 0;\n                        int8_t flag_50346 = (int8_t) 0;\n                        \n                        if (sle32(0, read_i_50344)) {\n                            flag_50346 = ((volatile __global int8_t *) status_flags_mem_50240)[sext_i32_i64(read_i_50344)];\n                            if (flag_50346 == (int8_t) 2) {\n                                aggr_50345 = ((volatile __global int64_t *) incprefixes_mem_50264)[sext_i32_i64(read_i_50344)];\n                            } else if (flag_50346 == (int8_t) 1) {\n                                aggr_50345 = ((volatile __global int64_t *) aggregates_mem_50262)[sext_i32_i64(read_i_50344)];\n                            }\n                        }\n                        ((__local int64_t *) local_mem_50296)[(int64_t) 4 + sext_i32_i64(local_tid_50289)] = aggr_50345;\n                        ((__local int8_t *) local_mem_50296)[sext_i32_i64(local_tid_50289)] = flag_50346;\n                        flag_50346 = ((__local int8_t *) local_m", "em_50296)[sext_i32_i64(wave_sizze_50291) - (int64_t) 1];\n                        if (slt8(flag_50346, (int8_t) 2)) {\n                            int8_t flg_x_50350;\n                            int8_t flg_y_50351;\n                            int64_t eta_p_50347;\n                            int64_t eta_p_50348;\n                            int32_t skip_threads_50352;\n                            \n                            // read input for in-block scan\n                            {\n                                flg_y_50351 = ((volatile __local int8_t *) local_mem_50296)[sext_i32_i64(local_tid_50289)];\n                                eta_p_50348 = ((volatile __local int64_t *) local_mem_50296)[(int64_t) 4 + sext_i32_i64(local_tid_50289)];\n                                if ((local_tid_50289 - squot32(local_tid_50289, 32) * 32) == 0) {\n                                    eta_p_50347 = eta_p_50348;\n                                    flg_x_50350 = flg_y_50351;\n                                }\n                            }\n                            // in-block scan (hopefully no barriers needed)\n                            {\n                                skip_threads_50352 = 1;\n                                while (slt32(skip_threads_50352, 32)) {\n                                    if (sle32(skip_threads_50352, local_tid_50289 - squot32(local_tid_50289, 32) * 32)) {\n                                        // read operands\n                                        {\n                                            flg_x_50350 = ((volatile __local int8_t *) local_mem_50296)[sext_i32_i64(local_tid_50289) - sext_i32_i64(skip_threads_50352)];\n                                            eta_p_50347 = ((volatile __local int64_t *) local_mem_50296)[(int64_t) 4 + (sext_i32_i64(local_tid_50289) - sext_i32_i64(skip_threads_50352))];\n                                        }\n                                        // perform operation\n                                        {\n    ",
                                    "                                        if (flg_y_50351 == (int8_t) 2 || flg_y_50351 == (int8_t) 0) {\n                                                flg_x_50350 = flg_y_50351;\n                                                eta_p_50347 = eta_p_50348;\n                                            } else {\n                                                int64_t defunc_0_op_res_50349 = add64(eta_p_50347, eta_p_50348);\n                                                \n                                                eta_p_50347 = defunc_0_op_res_50349;\n                                            }\n                                        }\n                                        // write result\n                                        {\n                                            ((volatile __local int8_t *) local_mem_50296)[sext_i32_i64(local_tid_50289)] = flg_x_50350;\n                                            flg_y_50351 = flg_x_50350;\n                                            ((volatile __local int64_t *) local_mem_50296)[(int64_t) 4 + sext_i32_i64(local_tid_50289)] = eta_p_50347;\n                                            eta_p_50348 = eta_p_50347;\n                                        }\n                                    }\n                                    skip_threads_50352 *= 2;\n                                }\n                            }\n                        }\n                        flag_50346 = ((__local int8_t *) local_mem_50296)[sext_i32_i64(wave_sizze_50291) - (int64_t) 1];\n                        aggr_50345 = ((__local int64_t *) local_mem_50296)[(int64_t) 4 + (sext_i32_i64(wave_sizze_50291) - (int64_t) 1)];\n                        if (flag_50346 == (int8_t) 2) {\n                            readOffset_50343 = wave_sizze_50291 * -1;\n                        } else if (flag_50346 == (int8_t) 1) {\n                            readOffset_50343 -= wave_sizze_50291;\n                        }\n                        if (slt8((int8_t) 0, flag_50346)) {\n  ", "                          int64_t eta_p_50353 = aggr_50345;\n                            int64_t eta_p_50354 = prefix_50339;\n                            int64_t defunc_0_op_res_50355 = add64(eta_p_50353, eta_p_50354);\n                            \n                            prefix_50339 = defunc_0_op_res_50355;\n                        }\n                        mem_fence_local();\n                    }\n                }\n                if (local_tid_50289 == 0) {\n                    if (boundary_50309 == sext_i64_i32(segscan_tblock_sizze_44348 * chunk_sizze_50237)) {\n                        int64_t eta_p_50356 = prefix_50339;\n                        int64_t eta_p_50357 = acc_50329;\n                        int64_t defunc_0_op_res_50358 = add64(eta_p_50356, eta_p_50357);\n                        \n                        ((volatile __global int64_t *) incprefixes_mem_50264)[dynamic_id_50306] = defunc_0_op_res_50358;\n                        mem_fence_global();\n                        ((volatile __global int8_t *) status_flags_mem_50240)[dynamic_id_50306] = (int8_t) 2;\n                    }\n                    ((__local int64_t *) local_mem_50296)[(int64_t) 4] = prefix_50339;\n                    acc_50329 = (int64_t) 0;\n                }\n            }\n            if (!(dynamic_id_50306 == (int64_t) 0)) {\n                barrier(CLK_LOCAL_MEM_FENCE);\n                prefix_50339 = ((__local int64_t *) local_mem_50296)[(int64_t) 4];\n                barrier(CLK_LOCAL_MEM_FENCE);\n            }\n        }\n        // Distribute results\n        {\n            int64_t eta_p_50359;\n            int64_t eta_p_50360;\n            int64_t eta_p_50362 = prefix_50339;\n            int64_t eta_p_50363 = acc_50329;\n            \n            if (slt32(local_tid_50289 * chunk_sizze_32b_50293, boundary_50309) && !block_new_sgm_50340) {\n                int64_t defunc_0_op_res_50364 = add64(eta_p_50362, eta_p_50363);\n                \n                eta_p_50359 = defunc_0_op_res_50364;\n            } e", "lse {\n                eta_p_50359 = acc_50329;\n            }\n            \n            int32_t stopping_point_50365 = segsizze_compact_50310 - srem32(local_tid_50289 * chunk_sizze_32b_50293 - 1 + segsizze_compact_50310 - boundary_50309, segsizze_compact_50310);\n            \n            for (int64_t i_50366 = 0; i_50366 < chunk_sizze_50237; i_50366++) {\n                if (slt32(sext_i64_i32(i_50366), stopping_point_50365 - 1)) {\n                    eta_p_50360 = private_mem_50311[i_50366];\n                    \n                    int64_t defunc_0_op_res_50361 = add64(eta_p_50359, eta_p_50360);\n                    \n                    private_mem_50311[i_50366] = defunc_0_op_res_50361;\n                }\n            }\n        }\n        // Transpose scan output and Write it to global memory in coalesced fashion\n        {\n            for (int64_t i_50367 = 0; i_50367 < chunk_sizze_50237; i_50367++) {\n                int64_t sharedIdx_50368 = sext_i32_i64(local_tid_50289) * chunk_sizze_50237 + i_50367;\n                int64_t tmp_50369 = private_mem_50311[i_50367];\n                \n                ((__local int64_t *) local_mem_50296)[sharedIdx_50368] = tmp_50369;\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            for (int64_t i_50370 = 0; i_50370 < chunk_sizze_50237; i_50370++) {\n                int64_t flat_idx_50371 = thd_offset_50313 + i_50370 * segscan_tblock_sizze_44348;\n                int64_t slice_50372 = n_34757;\n                int64_t gtid_44352 = flat_idx_50371;\n                int64_t remnant_50373 = flat_idx_50371 - gtid_44352;\n                \n                if (slt64(flat_idx_50371, n_34757)) {\n                    int64_t tmp_50374 = ((__local int64_t *) local_mem_50296)[flat_idx_50371 - block_offset_50307];\n                    \n                    ((__global int64_t *) mem_49403)[gtid_44352] = tmp_50374;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n        }\n    }\n    \n  error_3:\n    return;\n    #undef segsc",
                                    "an_tblock_sizze_44348\n    #undef chunk_sizze_50237\n}\nFUTHARK_KERNEL_SIZED(do_DBSCAN_doublezisegscan_44369_dim1, 1, 1)\nvoid do_DBSCAN_doublezisegscan_44369(__global int *global_failure, int failure_is_an_option, __global int64_t *global_failure_args, int64_t dz2081U_34761, int64_t dz2082U_34762, double zt_res_41216, int64_t num_tblocks_44366, int64_t num_virt_blocks_50442, int64_t num_virt_threads_50443, __global unsigned char *clProc_mem_49381, __global unsigned char *clProc_mem_49382, __global unsigned char *clProc_mem_49383, __global unsigned char *current_partition_mem_49395, __global unsigned char *current_partition_mem_49396, __global unsigned char *mem_49428, __global unsigned char *mem_49432, __global unsigned char *mem_49434, __global unsigned char *mem_49436, __global unsigned char *status_flags_mem_50444, __global unsigned char *aggregates_mem_50446, __global unsigned char *incprefixes_mem_50448, __global unsigned char *global_dynid_mem_50450)\n{\n    #define segscan_tblock_sizze_44364 (do_DBSCAN_doublezisegscan_44369zisegscan_tblock_sizze_44364)\n    #define chunk_sizze_50441 (do_DBSCAN_doublezisegscan_44369zichunk_sizze_50441)\n    \n    volatile __local unsigned char *local_mem_50460_backing_0 = &shared_mem[0];\n    const int64_t local_mem_50460_backing_0_offset = 0 + (smax64(smax64((int64_t) 288, (int64_t) 8 * segscan_tblock_sizze_44364), chunk_sizze_50441 * segscan_tblock_sizze_44364 * (int64_t) 8) + srem64((int64_t) 8 - srem64(smax64(smax64((int64_t) 288, (int64_t) 8 * segscan_tblock_sizze_44364), chunk_sizze_50441 * segscan_tblock_sizze_44364 * (int64_t) 8), (int64_t) 8), (int64_t) 8));\n    volatile __local int local_failure;\n    \n    if (failure_is_an_option) {\n        int failed = *global_failure >= 0;\n        \n        if (failed)\n            return;\n    }\n    local_failure = 0;\n    barrier(CLK_LOCAL_MEM_FENCE);\n    \n    int32_t local_tid_50453;\n    int32_t tblock_sizze_50456;\n    int32_t wave_sizze_50455;\n    int32_t block_id_50454;\n    int32_t global_", "tid_50452;\n    int64_t phys_tid_44369;\n    int32_t chunk_sizze_32b_50457;\n    int64_t byte_offsets_50458;\n    int64_t warp_byte_offset_50459;\n    __local unsigned char *local_mem_50460;\n    int64_t trans_arr_len_50461;\n    int64_t phys_block_id_50467;\n    int64_t virtloop_bound_50468;\n    \n    local_tid_50453 = get_local_id(0);\n    tblock_sizze_50456 = get_local_size(0);\n    wave_sizze_50455 = LOCKSTEP_WIDTH;\n    block_id_50454 = get_tblock_id(0);\n    global_tid_50452 = block_id_50454 * tblock_sizze_50456 + local_tid_50453;\n    phys_tid_44369 = sext_i32_i64(global_tid_50452);\n    chunk_sizze_32b_50457 = sext_i64_i32(chunk_sizze_50441);\n    byte_offsets_50458 = segscan_tblock_sizze_44364 * (int64_t) 8;\n    warp_byte_offset_50459 = (int64_t) 288;\n    // Allocate reusable shared memory\n    { }\n    local_mem_50460 = (__local unsigned char *) local_mem_50460_backing_0;\n    trans_arr_len_50461 = chunk_sizze_50441 * segscan_tblock_sizze_44364;\n    phys_block_id_50467 = get_tblock_id(0);\n    virtloop_bound_50468 = sdiv_up64(num_virt_blocks_50442 - phys_block_id_50467, num_tblocks_44366);\n    for (int64_t virtloop_i_50469 = 0; virtloop_i_50469 < virtloop_bound_50468; virtloop_i_50469++) {\n        int64_t dynamic_id_50470;\n        int64_t block_offset_50471;\n        int64_t sgm_idx_50472;\n        int32_t boundary_50473;\n        int32_t segsizze_compact_50474;\n        int64_t private_mem_50475[chunk_sizze_50441];\n        int64_t thd_offset_50477;\n        int64_t acc_50493;\n        int64_t prefix_50503;\n        bool block_new_sgm_50504;\n        \n        // First thread in block fetches this block's dynamic_id\n        {\n            if (local_tid_50453 == 0) {\n                dynamic_id_50470 = atomic_add_i32_global(&((volatile __global int *) global_dynid_mem_50450)[(int64_t) 0], (int) 1);\n                // Set dynamic id for this block\n                {\n                    ((__local int64_t *) local_mem_50460)[(int64_t) 0] = dynamic_id_50470;\n                }\n                ", "// First thread in last (virtual) block resets global dynamic_id\n                {\n                    if (dynamic_id_50470 == num_virt_blocks_50442 - (int64_t) 1) {\n                        ((__global int32_t *) global_dynid_mem_50450)[(int64_t) 0] = 0;\n                    }\n                }\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        dynamic_id_50470 = ((__local int32_t *) local_mem_50460)[(int64_t) 0];\n        barrier(CLK_LOCAL_MEM_FENCE);\n        block_offset_50471 = dynamic_id_50470 * chunk_sizze_50441 * segscan_tblock_sizze_44364;\n        sgm_idx_50472 = smod64(block_offset_50471, dz2082U_34762);\n        boundary_50473 = sext_i64_i32(smin64(chunk_sizze_50441 * segscan_tblock_sizze_44364, dz2082U_34762 - sgm_idx_50472));\n        segsizze_compact_50474 = sext_i64_i32(smin64(chunk_sizze_50441 * segscan_tblock_sizze_44364, dz2082U_34762));\n        thd_offset_50477 = block_offset_50471 + sext_i32_i64(local_tid_50453);\n        // Load and map\n        {\n            for (int64_t i_50478 = 0; i_50478 < chunk_sizze_50441; i_50478++) {\n                int64_t virt_tid_50479 = thd_offset_50477 + i_50478 * segscan_tblock_sizze_44364;\n                int64_t slice_50480 = dz2082U_34762;\n                int64_t gtid_44368 = virt_tid_50479;\n                int64_t remnant_50481 = virt_tid_50479 - gtid_44368;\n                \n                if (slt64(virt_tid_50479, dz2082U_34762)) {\n                    bool y_42408 = slt64(gtid_44368, dz2081U_34761);\n                    bool index_certs_42410;\n                    \n                    if (!y_42408) {\n                        {\n                            if (atomic_cmpxchg_i32_global(global_failure, -1, 20) == -1) {\n                                global_failure_args[0] = (int64_t) gtid_44368;\n                                global_failure_args[1] = (int64_t) dz2081U_34761;\n                                ;\n                            }\n                            local_failure = 1;\n                  ",
                                    "          goto error_0;\n                        }\n                    }\n                    \n                    double zm_res_49056 = ((__global double *) mem_49428)[(int64_t) 0];\n                    double lifted_lambda_res_42406 = ((__global double *) clProc_mem_49382)[gtid_44368];\n                    int64_t tmp_42411 = ((__global int64_t *) clProc_mem_49381)[gtid_44368];\n                    bool zgze_res_42415 = zm_res_49056 <= lifted_lambda_res_42406;\n                    bool cond_42416;\n                    \n                    if (zgze_res_42415) {\n                        double plus_arg0_42674 = ((__global double *) current_partition_mem_49395)[(int64_t) 0];\n                        double zp_res_42675 = zt_res_41216 + plus_arg0_42674;\n                        bool zlze_res_42676 = lifted_lambda_res_42406 <= zp_res_42675;\n                        \n                        cond_42416 = zlze_res_42676;\n                    } else {\n                        cond_42416 = 0;\n                    }\n                    \n                    bool lifted_lambda_res_42420;\n                    \n                    if (cond_42416) {\n                        double lifted_lambda_res_42407 = ((__global double *) clProc_mem_49383)[gtid_44368];\n                        double minus_arg0_42680 = ((__global double *) current_partition_mem_49396)[(int64_t) 1];\n                        double zm_res_42681 = minus_arg0_42680 - zt_res_41216;\n                        bool zgze_res_42682 = zm_res_42681 <= lifted_lambda_res_42407;\n                        bool lifted_lambda_res_t_res_42683;\n                        \n                        if (zgze_res_42682) {\n                            double plus_arg0_42684 = ((__global double *) current_partition_mem_49395)[(int64_t) 1];\n                            double zp_res_42685 = zt_res_41216 + plus_arg0_42684;\n                            bool zlze_res_42686 = lifted_lambda_res_42407 <= zp_res_42685;\n                            \n                      ", "      lifted_lambda_res_t_res_42683 = zlze_res_42686;\n                        } else {\n                            lifted_lambda_res_t_res_42683 = 0;\n                        }\n                        lifted_lambda_res_42420 = lifted_lambda_res_t_res_42683;\n                    } else {\n                        lifted_lambda_res_42420 = 0;\n                    }\n                    \n                    int64_t defunc_0_f_res_42428 = btoi_bool_i64(lifted_lambda_res_42420);\n                    \n                    ((__global int64_t *) mem_49434)[gtid_44368] = defunc_0_f_res_42428;\n                    ((__global int64_t *) mem_49436)[gtid_44368] = tmp_42411;\n                    private_mem_50475[i_50478] = defunc_0_f_res_42428;\n                } else {\n                    private_mem_50475[i_50478] = (int64_t) 0;\n                }\n            }\n        }\n        \n      error_0:\n        barrier(CLK_LOCAL_MEM_FENCE);\n        if (local_failure)\n            return;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        // Transpose scan inputs\n        {\n            for (int64_t i_50482 = 0; i_50482 < chunk_sizze_50441; i_50482++) {\n                int64_t sharedIdx_50483 = sext_i32_i64(local_tid_50453) + i_50482 * segscan_tblock_sizze_44364;\n                int64_t tmp_50484 = private_mem_50475[i_50482];\n                \n                ((__local int64_t *) local_mem_50460)[sharedIdx_50483] = tmp_50484;\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            for (int64_t i_50485 = 0; i_50485 < chunk_sizze_50441; i_50485++) {\n                int64_t sharedIdx_50486 = sext_i32_i64(local_tid_50453) * chunk_sizze_50441 + i_50485;\n                int64_t tmp_50487 = ((__local int64_t *) local_mem_50460)[sharedIdx_50486];\n                \n                private_mem_50475[i_50485] = tmp_50487;\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n        }\n        // Per thread scan\n        {\n            for (int64_t i_50488 = 0; i_50488 < chunk_sizze_50441 - (int64_t) 1; i_50", "488++) {\n                int64_t eta_p_41305;\n                int64_t eta_p_41306;\n                \n                eta_p_41305 = private_mem_50475[i_50488];\n                eta_p_41306 = private_mem_50475[i_50488 + (int64_t) 1];\n                \n                int64_t defunc_0_op_res_41307 = add64(eta_p_41305, eta_p_41306);\n                \n                private_mem_50475[i_50488 + (int64_t) 1] = defunc_0_op_res_41307;\n            }\n        }\n        // Publish results in shared memory\n        {\n            int64_t tmp_50489 = private_mem_50475[chunk_sizze_50441 - (int64_t) 1];\n            \n            ((__local int64_t *) local_mem_50460)[sext_i32_i64(local_tid_50453)] = tmp_50489;\n            barrier(CLK_LOCAL_MEM_FENCE);\n        }\n        // Scan results (with warp scan)\n        {\n            int64_t eta_p_50490;\n            int64_t eta_p_50491;\n            int64_t eta_p_50494;\n            int64_t eta_p_50495;\n            bool ltid_in_bounds_50497 = slt64(sext_i32_i64(local_tid_50453), num_virt_threads_50443);\n            int32_t skip_threads_50498;\n            \n            // read input for in-block scan\n            {\n                if (ltid_in_bounds_50497) {\n                    eta_p_50491 = ((volatile __local int64_t *) local_mem_50460)[sext_i32_i64(local_tid_50453)];\n                    if ((local_tid_50453 - squot32(local_tid_50453, 32) * 32) == 0) {\n                        eta_p_50490 = eta_p_50491;\n                    }\n                }\n            }\n            // in-block scan (hopefully no barriers needed)\n            {\n                skip_threads_50498 = 1;\n                while (slt32(skip_threads_50498, 32)) {\n                    bool thread_active_50499 = sle32(skip_threads_50498, local_tid_50453 - squot32(local_tid_50453, 32) * 32) && ltid_in_bounds_50497;\n                    \n                    if (thread_active_50499) {\n                        // read operands\n                        {\n                            eta_p_50490 = ((volatile",
                                    " __local int64_t *) local_mem_50460)[sext_i32_i64(local_tid_50453) - sext_i32_i64(skip_threads_50498)];\n                        }\n                    }\n                    // perform operation\n                    {\n                        if (thread_active_50499) {\n                            int64_t defunc_0_op_res_50492 = add64(eta_p_50490, eta_p_50491);\n                            \n                            eta_p_50490 = defunc_0_op_res_50492;\n                        }\n                    }\n                    if (sle32(wave_sizze_50455, skip_threads_50498)) {\n                        barrier(CLK_LOCAL_MEM_FENCE);\n                    }\n                    if (thread_active_50499) {\n                        // write result\n                        {\n                            ((volatile __local int64_t *) local_mem_50460)[sext_i32_i64(local_tid_50453)] = eta_p_50490;\n                            eta_p_50491 = eta_p_50490;\n                        }\n                    }\n                    if (sle32(wave_sizze_50455, skip_threads_50498)) {\n                        barrier(CLK_LOCAL_MEM_FENCE);\n                    }\n                    skip_threads_50498 *= 2;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // last thread of block 'i' writes its result to offset 'i'\n            {\n                if ((local_tid_50453 - squot32(local_tid_50453, 32) * 32) == 31 && ltid_in_bounds_50497) {\n                    ((volatile __local int64_t *) local_mem_50460)[sext_i32_i64(squot32(local_tid_50453, 32))] = eta_p_50490;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // scan the first block, after which offset 'i' contains carry-in for block 'i+1'\n            {\n                int32_t skip_threads_50500;\n                \n                // read input for in-block scan\n                {\n                    if (squot32(local_tid_50453, 32) == 0 && ltid_in_bounds_50497) {\n                        eta_p_50495 ", "= ((volatile __local int64_t *) local_mem_50460)[sext_i32_i64(local_tid_50453)];\n                        if ((local_tid_50453 - squot32(local_tid_50453, 32) * 32) == 0) {\n                            eta_p_50494 = eta_p_50495;\n                        }\n                    }\n                }\n                // in-block scan (hopefully no barriers needed)\n                {\n                    skip_threads_50500 = 1;\n                    while (slt32(skip_threads_50500, 32)) {\n                        bool thread_active_50501 = sle32(skip_threads_50500, local_tid_50453 - squot32(local_tid_50453, 32) * 32) && (squot32(local_tid_50453, 32) == 0 && ltid_in_bounds_50497);\n                        \n                        if (thread_active_50501) {\n                            // read operands\n                            {\n                                eta_p_50494 = ((volatile __local int64_t *) local_mem_50460)[sext_i32_i64(local_tid_50453) - sext_i32_i64(skip_threads_50500)];\n                            }\n                        }\n                        // perform operation\n                        {\n                            if (thread_active_50501) {\n                                int64_t defunc_0_op_res_50496 = add64(eta_p_50494, eta_p_50495);\n                                \n                                eta_p_50494 = defunc_0_op_res_50496;\n                            }\n                        }\n                        if (sle32(wave_sizze_50455, skip_threads_50500)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        if (thread_active_50501) {\n                            // write result\n                            {\n                                ((volatile __local int64_t *) local_mem_50460)[sext_i32_i64(local_tid_50453)] = eta_p_50494;\n                                eta_p_50495 = eta_p_50494;\n                            }\n                        }\n                        if (sle32(wave_sizze_50455, skip", "_threads_50500)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        skip_threads_50500 *= 2;\n                    }\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            \n            bool no_carry_in_50502 = squot32(local_tid_50453, 32) == 0 || !ltid_in_bounds_50497;\n            \n            // carry-in for every block except the first\n            {\n                // read operands\n                {\n                    if (!no_carry_in_50502) {\n                        eta_p_50491 = eta_p_50490;\n                        eta_p_50490 = ((__local int64_t *) local_mem_50460)[sext_i32_i64(squot32(local_tid_50453, 32)) - (int64_t) 1];\n                    }\n                }\n                // perform operation\n                {\n                    if (!no_carry_in_50502) {\n                        int64_t defunc_0_op_res_50492 = add64(eta_p_50490, eta_p_50491);\n                        \n                        eta_p_50490 = defunc_0_op_res_50492;\n                    }\n                }\n                // write final result\n                {\n                    if (!no_carry_in_50502) {\n                        ((__local int64_t *) local_mem_50460)[sext_i32_i64(local_tid_50453)] = eta_p_50490;\n                    }\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // restore correct values for first block\n            {\n                if (squot32(local_tid_50453, 32) == 0 && ltid_in_bounds_50497) {\n                    ((__local int64_t *) local_mem_50460)[sext_i32_i64(local_tid_50453)] = eta_p_50491;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            barrier(CLK_LOCAL_MEM_FENCE);\n            if (local_tid_50453 == 0) {\n                acc_50493 = ((__local int64_t *) local_mem_50460)[segscan_tblock_sizze_44364 - (int64_t) 1];\n            } else {\n                acc_50493 = ((__local int64_t *) local_mem_50460)[sext_i32",
                                    "_i64(local_tid_50453) - (int64_t) 1];\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n        }\n        prefix_50503 = (int64_t) 0;\n        block_new_sgm_50504 = sgm_idx_50472 == (int64_t) 0;\n        // Perform lookback\n        {\n            if (block_new_sgm_50504 && local_tid_50453 == 0) {\n                ((volatile __global int64_t *) incprefixes_mem_50448)[dynamic_id_50470] = acc_50493;\n                mem_fence_global();\n                ((volatile __global int8_t *) status_flags_mem_50444)[dynamic_id_50470] = (int8_t) 2;\n                acc_50493 = (int64_t) 0;\n            }\n            if (!block_new_sgm_50504 && slt32(local_tid_50453, wave_sizze_50455)) {\n                if (local_tid_50453 == 0) {\n                    ((volatile __global int64_t *) aggregates_mem_50446)[dynamic_id_50470] = acc_50493;\n                    mem_fence_global();\n                    ((volatile __global int8_t *) status_flags_mem_50444)[dynamic_id_50470] = (int8_t) 1;\n                    \n                    int8_t tmp_50505 = ((volatile __global int8_t *) status_flags_mem_50444)[dynamic_id_50470 - (int64_t) 1];\n                    \n                    ((volatile __local int8_t *) local_mem_50460)[(int64_t) 0] = tmp_50505;\n                }\n                mem_fence_local();\n                \n                int8_t status_50506 = ((__local int8_t *) local_mem_50460)[(int64_t) 0];\n                \n                if (status_50506 == (int8_t) 2) {\n                    if (local_tid_50453 == 0) {\n                        prefix_50503 = ((volatile __global int64_t *) incprefixes_mem_50448)[dynamic_id_50470 - (int64_t) 1];\n                    }\n                } else {\n                    int32_t readOffset_50507 = sext_i64_i32(dynamic_id_50470 - sext_i32_i64(wave_sizze_50455));\n                    \n                    while (slt32(wave_sizze_50455 * -1, readOffset_50507)) {\n                        int32_t read_i_50508 = readOffset_50507 + local_tid_50453;\n                        int", "64_t aggr_50509 = (int64_t) 0;\n                        int8_t flag_50510 = (int8_t) 0;\n                        \n                        if (sle32(0, read_i_50508)) {\n                            flag_50510 = ((volatile __global int8_t *) status_flags_mem_50444)[sext_i32_i64(read_i_50508)];\n                            if (flag_50510 == (int8_t) 2) {\n                                aggr_50509 = ((volatile __global int64_t *) incprefixes_mem_50448)[sext_i32_i64(read_i_50508)];\n                            } else if (flag_50510 == (int8_t) 1) {\n                                aggr_50509 = ((volatile __global int64_t *) aggregates_mem_50446)[sext_i32_i64(read_i_50508)];\n                            }\n                        }\n                        ((__local int64_t *) local_mem_50460)[(int64_t) 4 + sext_i32_i64(local_tid_50453)] = aggr_50509;\n                        ((__local int8_t *) local_mem_50460)[sext_i32_i64(local_tid_50453)] = flag_50510;\n                        flag_50510 = ((__local int8_t *) local_mem_50460)[sext_i32_i64(wave_sizze_50455) - (int64_t) 1];\n                        if (slt8(flag_50510, (int8_t) 2)) {\n                            int8_t flg_x_50514;\n                            int8_t flg_y_50515;\n                            int64_t eta_p_50511;\n                            int64_t eta_p_50512;\n                            int32_t skip_threads_50516;\n                            \n                            // read input for in-block scan\n                            {\n                                flg_y_50515 = ((volatile __local int8_t *) local_mem_50460)[sext_i32_i64(local_tid_50453)];\n                                eta_p_50512 = ((volatile __local int64_t *) local_mem_50460)[(int64_t) 4 + sext_i32_i64(local_tid_50453)];\n                                if ((local_tid_50453 - squot32(local_tid_50453, 32) * 32) == 0) {\n                                    eta_p_50511 = eta_p_50512;\n                                    flg_x_50514 = flg_y_50515;\n        ", "                        }\n                            }\n                            // in-block scan (hopefully no barriers needed)\n                            {\n                                skip_threads_50516 = 1;\n                                while (slt32(skip_threads_50516, 32)) {\n                                    if (sle32(skip_threads_50516, local_tid_50453 - squot32(local_tid_50453, 32) * 32)) {\n                                        // read operands\n                                        {\n                                            flg_x_50514 = ((volatile __local int8_t *) local_mem_50460)[sext_i32_i64(local_tid_50453) - sext_i32_i64(skip_threads_50516)];\n                                            eta_p_50511 = ((volatile __local int64_t *) local_mem_50460)[(int64_t) 4 + (sext_i32_i64(local_tid_50453) - sext_i32_i64(skip_threads_50516))];\n                                        }\n                                        // perform operation\n                                        {\n                                            if (flg_y_50515 == (int8_t) 2 || flg_y_50515 == (int8_t) 0) {\n                                                flg_x_50514 = flg_y_50515;\n                                                eta_p_50511 = eta_p_50512;\n                                            } else {\n                                                int64_t defunc_0_op_res_50513 = add64(eta_p_50511, eta_p_50512);\n                                                \n                                                eta_p_50511 = defunc_0_op_res_50513;\n                                            }\n                                        }\n                                        // write result\n                                        {\n                                            ((volatile __local int8_t *) local_mem_50460)[sext_i32_i64(local_tid_50453)] = flg_x_50514;\n                                            flg_y_50515 = flg_x_50514;\n                                    ",
                                    "        ((volatile __local int64_t *) local_mem_50460)[(int64_t) 4 + sext_i32_i64(local_tid_50453)] = eta_p_50511;\n                                            eta_p_50512 = eta_p_50511;\n                                        }\n                                    }\n                                    skip_threads_50516 *= 2;\n                                }\n                            }\n                        }\n                        flag_50510 = ((__local int8_t *) local_mem_50460)[sext_i32_i64(wave_sizze_50455) - (int64_t) 1];\n                        aggr_50509 = ((__local int64_t *) local_mem_50460)[(int64_t) 4 + (sext_i32_i64(wave_sizze_50455) - (int64_t) 1)];\n                        if (flag_50510 == (int8_t) 2) {\n                            readOffset_50507 = wave_sizze_50455 * -1;\n                        } else if (flag_50510 == (int8_t) 1) {\n                            readOffset_50507 -= wave_sizze_50455;\n                        }\n                        if (slt8((int8_t) 0, flag_50510)) {\n                            int64_t eta_p_50517 = aggr_50509;\n                            int64_t eta_p_50518 = prefix_50503;\n                            int64_t defunc_0_op_res_50519 = add64(eta_p_50517, eta_p_50518);\n                            \n                            prefix_50503 = defunc_0_op_res_50519;\n                        }\n                        mem_fence_local();\n                    }\n                }\n                if (local_tid_50453 == 0) {\n                    if (boundary_50473 == sext_i64_i32(segscan_tblock_sizze_44364 * chunk_sizze_50441)) {\n                        int64_t eta_p_50520 = prefix_50503;\n                        int64_t eta_p_50521 = acc_50493;\n                        int64_t defunc_0_op_res_50522 = add64(eta_p_50520, eta_p_50521);\n                        \n                        ((volatile __global int64_t *) incprefixes_mem_50448)[dynamic_id_50470] = defunc_0_op_res_50522;\n                        mem_fence_global();\n              ", "          ((volatile __global int8_t *) status_flags_mem_50444)[dynamic_id_50470] = (int8_t) 2;\n                    }\n                    ((__local int64_t *) local_mem_50460)[(int64_t) 4] = prefix_50503;\n                    acc_50493 = (int64_t) 0;\n                }\n            }\n            if (!(dynamic_id_50470 == (int64_t) 0)) {\n                barrier(CLK_LOCAL_MEM_FENCE);\n                prefix_50503 = ((__local int64_t *) local_mem_50460)[(int64_t) 4];\n                barrier(CLK_LOCAL_MEM_FENCE);\n            }\n        }\n        // Distribute results\n        {\n            int64_t eta_p_50523;\n            int64_t eta_p_50524;\n            int64_t eta_p_50526 = prefix_50503;\n            int64_t eta_p_50527 = acc_50493;\n            \n            if (slt32(local_tid_50453 * chunk_sizze_32b_50457, boundary_50473) && !block_new_sgm_50504) {\n                int64_t defunc_0_op_res_50528 = add64(eta_p_50526, eta_p_50527);\n                \n                eta_p_50523 = defunc_0_op_res_50528;\n            } else {\n                eta_p_50523 = acc_50493;\n            }\n            \n            int32_t stopping_point_50529 = segsizze_compact_50474 - srem32(local_tid_50453 * chunk_sizze_32b_50457 - 1 + segsizze_compact_50474 - boundary_50473, segsizze_compact_50474);\n            \n            for (int64_t i_50530 = 0; i_50530 < chunk_sizze_50441; i_50530++) {\n                if (slt32(sext_i64_i32(i_50530), stopping_point_50529 - 1)) {\n                    eta_p_50524 = private_mem_50475[i_50530];\n                    \n                    int64_t defunc_0_op_res_50525 = add64(eta_p_50523, eta_p_50524);\n                    \n                    private_mem_50475[i_50530] = defunc_0_op_res_50525;\n                }\n            }\n        }\n        // Transpose scan output and Write it to global memory in coalesced fashion\n        {\n            for (int64_t i_50531 = 0; i_50531 < chunk_sizze_50441; i_50531++) {\n                int64_t sharedIdx_50532 = sext_i32_i64(local_tid_50453) ", "* chunk_sizze_50441 + i_50531;\n                int64_t tmp_50533 = private_mem_50475[i_50531];\n                \n                ((__local int64_t *) local_mem_50460)[sharedIdx_50532] = tmp_50533;\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            for (int64_t i_50534 = 0; i_50534 < chunk_sizze_50441; i_50534++) {\n                int64_t flat_idx_50535 = thd_offset_50477 + i_50534 * segscan_tblock_sizze_44364;\n                int64_t slice_50536 = dz2082U_34762;\n                int64_t gtid_44368 = flat_idx_50535;\n                int64_t remnant_50537 = flat_idx_50535 - gtid_44368;\n                \n                if (slt64(flat_idx_50535, dz2082U_34762)) {\n                    int64_t tmp_50538 = ((__local int64_t *) local_mem_50460)[flat_idx_50535 - block_offset_50471];\n                    \n                    ((__global int64_t *) mem_49432)[gtid_44368] = tmp_50538;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n        }\n    }\n    \n  error_3:\n    return;\n    #undef segscan_tblock_sizze_44364\n    #undef chunk_sizze_50441\n}\nFUTHARK_KERNEL_SIZED(do_DBSCAN_doublezisegscan_44385_dim1, 1, 1)\nvoid do_DBSCAN_doublezisegscan_44385(__global int *global_failure, double clBase_34770, int64_t m_41318, int64_t num_tblocks_44382, int64_t num_virt_blocks_50558, int64_t num_virt_threads_50559, __global unsigned char *current_partition_mem_49395, __global unsigned char *current_partition_mem_49396, __global unsigned char *mem_49429, __global unsigned char *mem_49442, __global unsigned char *mem_49444, __global unsigned char *mem_49448, __global unsigned char *mem_49450, __global unsigned char *mem_49452, __global unsigned char *status_flags_mem_50560, __global unsigned char *aggregates_mem_50562, __global unsigned char *incprefixes_mem_50564, __global unsigned char *aggregates_mem_50566, __global unsigned char *incprefixes_mem_50568, __global unsigned char *global_dynid_mem_50570)\n{\n    #define segscan_tblock_sizze_44380 (do_DBSCAN_double",
                                    "zisegscan_44385zisegscan_tblock_sizze_44380)\n    #define chunk_sizze_50557 (do_DBSCAN_doublezisegscan_44385zichunk_sizze_50557)\n    \n    volatile __local unsigned char *local_mem_50582_backing_0 = &shared_mem[0];\n    const int64_t local_mem_50582_backing_0_offset = 0 + (smax64(smax64((int64_t) 544, sdiv_up64((int64_t) 8 * segscan_tblock_sizze_44380, (int64_t) 8) * (int64_t) 8 + (int64_t) 8 * segscan_tblock_sizze_44380), smax64(chunk_sizze_50557 * segscan_tblock_sizze_44380 * (int64_t) 8, chunk_sizze_50557 * segscan_tblock_sizze_44380 * (int64_t) 8)) + srem64((int64_t) 8 - srem64(smax64(smax64((int64_t) 544, sdiv_up64((int64_t) 8 * segscan_tblock_sizze_44380, (int64_t) 8) * (int64_t) 8 + (int64_t) 8 * segscan_tblock_sizze_44380), smax64(chunk_sizze_50557 * segscan_tblock_sizze_44380 * (int64_t) 8, chunk_sizze_50557 * segscan_tblock_sizze_44380 * (int64_t) 8)), (int64_t) 8), (int64_t) 8));\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_50573;\n    int32_t tblock_sizze_50576;\n    int32_t wave_sizze_50575;\n    int32_t block_id_50574;\n    int32_t global_tid_50572;\n    int64_t phys_tid_44385;\n    int32_t chunk_sizze_32b_50577;\n    int64_t byte_offsets_50578;\n    int64_t byte_offsets_50579;\n    int64_t warp_byte_offset_50580;\n    int64_t warp_byte_offset_50581;\n    __local unsigned char *local_mem_50582;\n    int64_t trans_arr_len_50583;\n    int64_t phys_block_id_50592;\n    int64_t virtloop_bound_50593;\n    \n    local_tid_50573 = get_local_id(0);\n    tblock_sizze_50576 = get_local_size(0);\n    wave_sizze_50575 = LOCKSTEP_WIDTH;\n    block_id_50574 = get_tblock_id(0);\n    global_tid_50572 = block_id_50574 * tblock_sizze_50576 + local_tid_50573;\n    phys_tid_44385 = sext_i32_i64(global_tid_50572);\n    chunk_sizze_32b_50577 = sext_i64_i32(chunk_sizze_50557);\n    byte_offsets_50578 = segscan_tblock_sizze_44380 * (int64_t) 8;\n    byte_offsets_50579 = sdiv_up64(byte_offsets_50578, (int64_t) 8) * (int64_t) 8 + segscan_tblock_sizze_44380 * (int64_t) 8;\n", "    warp_byte_offset_50580 = (int64_t) 288;\n    warp_byte_offset_50581 = sdiv_up64(warp_byte_offset_50580, (int64_t) 8) * (int64_t) 8 + (int64_t) 256;\n    // Allocate reusable shared memory\n    { }\n    local_mem_50582 = (__local unsigned char *) local_mem_50582_backing_0;\n    trans_arr_len_50583 = chunk_sizze_50557 * segscan_tblock_sizze_44380;\n    phys_block_id_50592 = get_tblock_id(0);\n    virtloop_bound_50593 = sdiv_up64(num_virt_blocks_50558 - phys_block_id_50592, num_tblocks_44382);\n    for (int64_t virtloop_i_50594 = 0; virtloop_i_50594 < virtloop_bound_50593; virtloop_i_50594++) {\n        int64_t dynamic_id_50595;\n        int64_t block_offset_50596;\n        int64_t sgm_idx_50597;\n        int32_t boundary_50598;\n        int32_t segsizze_compact_50599;\n        int64_t private_mem_50600[chunk_sizze_50557];\n        int64_t private_mem_50602[chunk_sizze_50557];\n        int64_t thd_offset_50604;\n        int64_t acc_50630;\n        int64_t acc_50631;\n        int64_t prefix_50644;\n        int64_t prefix_50645;\n        bool block_new_sgm_50646;\n        \n        // First thread in block fetches this block's dynamic_id\n        {\n            if (local_tid_50573 == 0) {\n                dynamic_id_50595 = atomic_add_i32_global(&((volatile __global int *) global_dynid_mem_50570)[(int64_t) 0], (int) 1);\n                // Set dynamic id for this block\n                {\n                    ((__local int64_t *) local_mem_50582)[(int64_t) 0] = dynamic_id_50595;\n                }\n                // First thread in last (virtual) block resets global dynamic_id\n                {\n                    if (dynamic_id_50595 == num_virt_blocks_50558 - (int64_t) 1) {\n                        ((__global int32_t *) global_dynid_mem_50570)[(int64_t) 0] = 0;\n                    }\n                }\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        dynamic_id_50595 = ((__local int32_t *) local_mem_50582)[(int64_t) 0];\n        barrier(CLK_LOCAL_MEM_FENCE);\n        block_offset", "_50596 = dynamic_id_50595 * chunk_sizze_50557 * segscan_tblock_sizze_44380;\n        sgm_idx_50597 = smod64(block_offset_50596, m_41318);\n        boundary_50598 = sext_i64_i32(smin64(chunk_sizze_50557 * segscan_tblock_sizze_44380, m_41318 - sgm_idx_50597));\n        segsizze_compact_50599 = sext_i64_i32(smin64(chunk_sizze_50557 * segscan_tblock_sizze_44380, m_41318));\n        thd_offset_50604 = block_offset_50596 + sext_i32_i64(local_tid_50573);\n        // Load and map\n        {\n            for (int64_t i_50605 = 0; i_50605 < chunk_sizze_50557; i_50605++) {\n                int64_t virt_tid_50606 = thd_offset_50604 + i_50605 * segscan_tblock_sizze_44380;\n                int64_t slice_50607 = m_41318;\n                int64_t gtid_44384 = virt_tid_50606;\n                int64_t remnant_50608 = virt_tid_50606 - gtid_44384;\n                \n                if (slt64(virt_tid_50606, m_41318)) {\n                    double zm_res_49060 = ((__global double *) mem_49429)[(int64_t) 0];\n                    double x_42342 = ((__global double *) mem_49444)[gtid_44384];\n                    bool zgze_res_42344 = zm_res_49060 <= x_42342;\n                    bool cond_42345;\n                    \n                    if (zgze_res_42344) {\n                        double plus_arg0_42689 = ((__global double *) current_partition_mem_49395)[(int64_t) 0];\n                        double zp_res_42690 = clBase_34770 + plus_arg0_42689;\n                        bool zlze_res_42691 = x_42342 <= zp_res_42690;\n                        \n                        cond_42345 = zlze_res_42691;\n                    } else {\n                        cond_42345 = 0;\n                    }\n                    \n                    bool lifted_lambda_res_42349;\n                    \n                    if (cond_42345) {\n                        double x_42343 = ((__global double *) mem_49442)[gtid_44384];\n                        double minus_arg0_42695 = ((__global double *) current_partition_mem_49396)[(int64_t) 1];\n  ",
                                    "                      double zm_res_42696 = minus_arg0_42695 - clBase_34770;\n                        bool zgze_res_42697 = zm_res_42696 <= x_42343;\n                        bool lifted_lambda_res_t_res_42698;\n                        \n                        if (zgze_res_42697) {\n                            double plus_arg0_42699 = ((__global double *) current_partition_mem_49395)[(int64_t) 1];\n                            double zp_res_42700 = clBase_34770 + plus_arg0_42699;\n                            bool zlze_res_42701 = x_42343 <= zp_res_42700;\n                            \n                            lifted_lambda_res_t_res_42698 = zlze_res_42701;\n                        } else {\n                            lifted_lambda_res_t_res_42698 = 0;\n                        }\n                        lifted_lambda_res_42349 = lifted_lambda_res_t_res_42698;\n                    } else {\n                        lifted_lambda_res_42349 = 0;\n                    }\n                    \n                    bool cond_neg_42357 = !lifted_lambda_res_42349;\n                    int64_t defunc_0_lifted_pzq_res_42358 = btoi_bool_i64(cond_neg_42357);\n                    bool is_i_42359 = defunc_0_lifted_pzq_res_42358 == (int64_t) 0;\n                    int64_t part_res_42360 = btoi_bool_i64(is_i_42359);\n                    int64_t part_res_42361;\n                    int64_t part_res_42362;\n                    \n                    if (is_i_42359) {\n                        part_res_42361 = (int64_t) 0;\n                        part_res_42362 = (int64_t) 0;\n                    } else {\n                        bool is_i_42363 = defunc_0_lifted_pzq_res_42358 == (int64_t) 1;\n                        int64_t part_res_42364;\n                        \n                        if (is_i_42363) {\n                            part_res_42364 = (int64_t) 1;\n                        } else {\n                            part_res_42364 = (int64_t) 2;\n                        }\n                        \n            ", "            int64_t part_res_42365 = btoi_bool_i64(is_i_42363);\n                        \n                        part_res_42361 = part_res_42364;\n                        part_res_42362 = part_res_42365;\n                    }\n                    ((__global int64_t *) mem_49452)[gtid_44384] = part_res_42361;\n                    private_mem_50600[i_50605] = part_res_42360;\n                    private_mem_50602[i_50605] = part_res_42362;\n                } else {\n                    private_mem_50600[i_50605] = (int64_t) 0;\n                    private_mem_50602[i_50605] = (int64_t) 0;\n                }\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        // Transpose scan inputs\n        {\n            for (int64_t i_50609 = 0; i_50609 < chunk_sizze_50557; i_50609++) {\n                int64_t sharedIdx_50610 = sext_i32_i64(local_tid_50573) + i_50609 * segscan_tblock_sizze_44380;\n                int64_t tmp_50611 = private_mem_50600[i_50609];\n                \n                ((__local int64_t *) local_mem_50582)[sharedIdx_50610] = tmp_50611;\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            for (int64_t i_50612 = 0; i_50612 < chunk_sizze_50557; i_50612++) {\n                int64_t sharedIdx_50613 = sext_i32_i64(local_tid_50573) * chunk_sizze_50557 + i_50612;\n                int64_t tmp_50614 = ((__local int64_t *) local_mem_50582)[sharedIdx_50613];\n                \n                private_mem_50600[i_50612] = tmp_50614;\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            for (int64_t i_50615 = 0; i_50615 < chunk_sizze_50557; i_50615++) {\n                int64_t sharedIdx_50616 = sext_i32_i64(local_tid_50573) + i_50615 * segscan_tblock_sizze_44380;\n                int64_t tmp_50617 = private_mem_50602[i_50615];\n                \n                ((__local int64_t *) local_mem_50582)[sharedIdx_50616] = tmp_50617;\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            for (int64_t i_50618 = 0; i_50618 < chunk_sizze_", "50557; i_50618++) {\n                int64_t sharedIdx_50619 = sext_i32_i64(local_tid_50573) * chunk_sizze_50557 + i_50618;\n                int64_t tmp_50620 = ((__local int64_t *) local_mem_50582)[sharedIdx_50619];\n                \n                private_mem_50602[i_50618] = tmp_50620;\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n        }\n        // Per thread scan\n        {\n            for (int64_t i_50621 = 0; i_50621 < chunk_sizze_50557 - (int64_t) 1; i_50621++) {\n                int64_t x_41384;\n                int64_t y_41386;\n                \n                x_41384 = private_mem_50600[i_50621];\n                y_41386 = private_mem_50600[i_50621 + (int64_t) 1];\n                \n                int64_t x_41385;\n                int64_t y_41387;\n                \n                x_41385 = private_mem_50602[i_50621];\n                y_41387 = private_mem_50602[i_50621 + (int64_t) 1];\n                \n                int64_t zz_41388 = x_41384 + y_41386;\n                int64_t zz_41389 = x_41385 + y_41387;\n                \n                private_mem_50600[i_50621 + (int64_t) 1] = zz_41388;\n                private_mem_50602[i_50621 + (int64_t) 1] = zz_41389;\n            }\n        }\n        // Publish results in shared memory\n        {\n            int64_t tmp_50622 = private_mem_50600[chunk_sizze_50557 - (int64_t) 1];\n            \n            ((__local int64_t *) local_mem_50582)[sext_i32_i64(local_tid_50573)] = tmp_50622;\n            \n            int64_t tmp_50623 = private_mem_50602[chunk_sizze_50557 - (int64_t) 1];\n            \n            ((__local int64_t *) local_mem_50582)[squot64(byte_offsets_50578, (int64_t) 8) + sext_i32_i64(local_tid_50573)] = tmp_50623;\n            barrier(CLK_LOCAL_MEM_FENCE);\n        }\n        // Scan results (with warp scan)\n        {\n            int64_t x_50624;\n            int64_t x_50625;\n            int64_t y_50626;\n            int64_t y_50627;\n            int64_t x_50632;\n            int64_t x_50633;\n            int",
                                    "64_t y_50634;\n            int64_t y_50635;\n            bool ltid_in_bounds_50638 = slt64(sext_i32_i64(local_tid_50573), num_virt_threads_50559);\n            int32_t skip_threads_50639;\n            \n            // read input for in-block scan\n            {\n                if (ltid_in_bounds_50638) {\n                    y_50626 = ((volatile __local int64_t *) local_mem_50582)[sext_i32_i64(local_tid_50573)];\n                    y_50627 = ((volatile __local int64_t *) local_mem_50582)[squot64(byte_offsets_50578, (int64_t) 8) + sext_i32_i64(local_tid_50573)];\n                    if ((local_tid_50573 - squot32(local_tid_50573, 32) * 32) == 0) {\n                        x_50624 = y_50626;\n                        x_50625 = y_50627;\n                    }\n                }\n            }\n            // in-block scan (hopefully no barriers needed)\n            {\n                skip_threads_50639 = 1;\n                while (slt32(skip_threads_50639, 32)) {\n                    bool thread_active_50640 = sle32(skip_threads_50639, local_tid_50573 - squot32(local_tid_50573, 32) * 32) && ltid_in_bounds_50638;\n                    \n                    if (thread_active_50640) {\n                        // read operands\n                        {\n                            x_50624 = ((volatile __local int64_t *) local_mem_50582)[sext_i32_i64(local_tid_50573) - sext_i32_i64(skip_threads_50639)];\n                            x_50625 = ((volatile __local int64_t *) local_mem_50582)[squot64(byte_offsets_50578, (int64_t) 8) + (sext_i32_i64(local_tid_50573) - sext_i32_i64(skip_threads_50639))];\n                        }\n                    }\n                    // perform operation\n                    {\n                        if (thread_active_50640) {\n                            int64_t zz_50628 = x_50624 + y_50626;\n                            int64_t zz_50629 = x_50625 + y_50627;\n                            \n                            x_50624 = zz_50628;\n                            x_50625 =", " zz_50629;\n                        }\n                    }\n                    if (sle32(wave_sizze_50575, skip_threads_50639)) {\n                        barrier(CLK_LOCAL_MEM_FENCE);\n                    }\n                    if (thread_active_50640) {\n                        // write result\n                        {\n                            ((volatile __local int64_t *) local_mem_50582)[sext_i32_i64(local_tid_50573)] = x_50624;\n                            y_50626 = x_50624;\n                            ((volatile __local int64_t *) local_mem_50582)[squot64(byte_offsets_50578, (int64_t) 8) + sext_i32_i64(local_tid_50573)] = x_50625;\n                            y_50627 = x_50625;\n                        }\n                    }\n                    if (sle32(wave_sizze_50575, skip_threads_50639)) {\n                        barrier(CLK_LOCAL_MEM_FENCE);\n                    }\n                    skip_threads_50639 *= 2;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // last thread of block 'i' writes its result to offset 'i'\n            {\n                if ((local_tid_50573 - squot32(local_tid_50573, 32) * 32) == 31 && ltid_in_bounds_50638) {\n                    ((volatile __local int64_t *) local_mem_50582)[sext_i32_i64(squot32(local_tid_50573, 32))] = x_50624;\n                    ((volatile __local int64_t *) local_mem_50582)[squot64(byte_offsets_50578, (int64_t) 8) + sext_i32_i64(squot32(local_tid_50573, 32))] = x_50625;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // scan the first block, after which offset 'i' contains carry-in for block 'i+1'\n            {\n                int32_t skip_threads_50641;\n                \n                // read input for in-block scan\n                {\n                    if (squot32(local_tid_50573, 32) == 0 && ltid_in_bounds_50638) {\n                        y_50634 = ((volatile __local int64_t *) local_mem_50582)[sext_i32_i64(local_tid_50573)];\n         ", "               y_50635 = ((volatile __local int64_t *) local_mem_50582)[squot64(byte_offsets_50578, (int64_t) 8) + sext_i32_i64(local_tid_50573)];\n                        if ((local_tid_50573 - squot32(local_tid_50573, 32) * 32) == 0) {\n                            x_50632 = y_50634;\n                            x_50633 = y_50635;\n                        }\n                    }\n                }\n                // in-block scan (hopefully no barriers needed)\n                {\n                    skip_threads_50641 = 1;\n                    while (slt32(skip_threads_50641, 32)) {\n                        bool thread_active_50642 = sle32(skip_threads_50641, local_tid_50573 - squot32(local_tid_50573, 32) * 32) && (squot32(local_tid_50573, 32) == 0 && ltid_in_bounds_50638);\n                        \n                        if (thread_active_50642) {\n                            // read operands\n                            {\n                                x_50632 = ((volatile __local int64_t *) local_mem_50582)[sext_i32_i64(local_tid_50573) - sext_i32_i64(skip_threads_50641)];\n                                x_50633 = ((volatile __local int64_t *) local_mem_50582)[squot64(byte_offsets_50578, (int64_t) 8) + (sext_i32_i64(local_tid_50573) - sext_i32_i64(skip_threads_50641))];\n                            }\n                        }\n                        // perform operation\n                        {\n                            if (thread_active_50642) {\n                                int64_t zz_50636 = x_50632 + y_50634;\n                                int64_t zz_50637 = x_50633 + y_50635;\n                                \n                                x_50632 = zz_50636;\n                                x_50633 = zz_50637;\n                            }\n                        }\n                        if (sle32(wave_sizze_50575, skip_threads_50641)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        if (thread_active",
                                    "_50642) {\n                            // write result\n                            {\n                                ((volatile __local int64_t *) local_mem_50582)[sext_i32_i64(local_tid_50573)] = x_50632;\n                                y_50634 = x_50632;\n                                ((volatile __local int64_t *) local_mem_50582)[squot64(byte_offsets_50578, (int64_t) 8) + sext_i32_i64(local_tid_50573)] = x_50633;\n                                y_50635 = x_50633;\n                            }\n                        }\n                        if (sle32(wave_sizze_50575, skip_threads_50641)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        skip_threads_50641 *= 2;\n                    }\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            \n            bool no_carry_in_50643 = squot32(local_tid_50573, 32) == 0 || !ltid_in_bounds_50638;\n            \n            // carry-in for every block except the first\n            {\n                // read operands\n                {\n                    if (!no_carry_in_50643) {\n                        y_50626 = x_50624;\n                        y_50627 = x_50625;\n                        x_50624 = ((__local int64_t *) local_mem_50582)[sext_i32_i64(squot32(local_tid_50573, 32)) - (int64_t) 1];\n                        x_50625 = ((__local int64_t *) local_mem_50582)[squot64(byte_offsets_50578, (int64_t) 8) + (sext_i32_i64(squot32(local_tid_50573, 32)) - (int64_t) 1)];\n                    }\n                }\n                // perform operation\n                {\n                    if (!no_carry_in_50643) {\n                        int64_t zz_50628 = x_50624 + y_50626;\n                        int64_t zz_50629 = x_50625 + y_50627;\n                        \n                        x_50624 = zz_50628;\n                        x_50625 = zz_50629;\n                    }\n                }\n                // write final result\n                {\n           ", "         if (!no_carry_in_50643) {\n                        ((__local int64_t *) local_mem_50582)[sext_i32_i64(local_tid_50573)] = x_50624;\n                        ((__local int64_t *) local_mem_50582)[squot64(byte_offsets_50578, (int64_t) 8) + sext_i32_i64(local_tid_50573)] = x_50625;\n                    }\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // restore correct values for first block\n            {\n                if (squot32(local_tid_50573, 32) == 0 && ltid_in_bounds_50638) {\n                    ((__local int64_t *) local_mem_50582)[sext_i32_i64(local_tid_50573)] = y_50626;\n                    ((__local int64_t *) local_mem_50582)[squot64(byte_offsets_50578, (int64_t) 8) + sext_i32_i64(local_tid_50573)] = y_50627;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            barrier(CLK_LOCAL_MEM_FENCE);\n            if (local_tid_50573 == 0) {\n                acc_50630 = ((__local int64_t *) local_mem_50582)[segscan_tblock_sizze_44380 - (int64_t) 1];\n                acc_50631 = ((__local int64_t *) local_mem_50582)[squot64(byte_offsets_50578, (int64_t) 8) + (segscan_tblock_sizze_44380 - (int64_t) 1)];\n            } else {\n                acc_50630 = ((__local int64_t *) local_mem_50582)[sext_i32_i64(local_tid_50573) - (int64_t) 1];\n                acc_50631 = ((__local int64_t *) local_mem_50582)[squot64(byte_offsets_50578, (int64_t) 8) + (sext_i32_i64(local_tid_50573) - (int64_t) 1)];\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n        }\n        prefix_50644 = (int64_t) 0;\n        prefix_50645 = (int64_t) 0;\n        block_new_sgm_50646 = sgm_idx_50597 == (int64_t) 0;\n        // Perform lookback\n        {\n            if (block_new_sgm_50646 && local_tid_50573 == 0) {\n                ((volatile __global int64_t *) incprefixes_mem_50564)[dynamic_id_50595] = acc_50630;\n                ((volatile __global int64_t *) incprefixes_mem_50568)[dynamic_id_50595] = acc_50631;\n                ", "mem_fence_global();\n                ((volatile __global int8_t *) status_flags_mem_50560)[dynamic_id_50595] = (int8_t) 2;\n                acc_50630 = (int64_t) 0;\n                acc_50631 = (int64_t) 0;\n            }\n            if (!block_new_sgm_50646 && slt32(local_tid_50573, wave_sizze_50575)) {\n                if (local_tid_50573 == 0) {\n                    ((volatile __global int64_t *) aggregates_mem_50562)[dynamic_id_50595] = acc_50630;\n                    ((volatile __global int64_t *) aggregates_mem_50566)[dynamic_id_50595] = acc_50631;\n                    mem_fence_global();\n                    ((volatile __global int8_t *) status_flags_mem_50560)[dynamic_id_50595] = (int8_t) 1;\n                    \n                    int8_t tmp_50647 = ((volatile __global int8_t *) status_flags_mem_50560)[dynamic_id_50595 - (int64_t) 1];\n                    \n                    ((volatile __local int8_t *) local_mem_50582)[(int64_t) 0] = tmp_50647;\n                }\n                mem_fence_local();\n                \n                int8_t status_50648 = ((__local int8_t *) local_mem_50582)[(int64_t) 0];\n                \n                if (status_50648 == (int8_t) 2) {\n                    if (local_tid_50573 == 0) {\n                        prefix_50644 = ((volatile __global int64_t *) incprefixes_mem_50564)[dynamic_id_50595 - (int64_t) 1];\n                        prefix_50645 = ((volatile __global int64_t *) incprefixes_mem_50568)[dynamic_id_50595 - (int64_t) 1];\n                    }\n                } else {\n                    int32_t readOffset_50649 = sext_i64_i32(dynamic_id_50595 - sext_i32_i64(wave_sizze_50575));\n                    \n                    while (slt32(wave_sizze_50575 * -1, readOffset_50649)) {\n                        int32_t read_i_50650 = readOffset_50649 + local_tid_50573;\n                        int64_t aggr_50651 = (int64_t) 0;\n                        int64_t aggr_50652 = (int64_t) 0;\n                        int8_t flag_50653 = (int8_t) 0;\n  ",
                                    "                      \n                        if (sle32(0, read_i_50650)) {\n                            flag_50653 = ((volatile __global int8_t *) status_flags_mem_50560)[sext_i32_i64(read_i_50650)];\n                            if (flag_50653 == (int8_t) 2) {\n                                aggr_50651 = ((volatile __global int64_t *) incprefixes_mem_50564)[sext_i32_i64(read_i_50650)];\n                                aggr_50652 = ((volatile __global int64_t *) incprefixes_mem_50568)[sext_i32_i64(read_i_50650)];\n                            } else if (flag_50653 == (int8_t) 1) {\n                                aggr_50651 = ((volatile __global int64_t *) aggregates_mem_50562)[sext_i32_i64(read_i_50650)];\n                                aggr_50652 = ((volatile __global int64_t *) aggregates_mem_50566)[sext_i32_i64(read_i_50650)];\n                            }\n                        }\n                        ((__local int64_t *) local_mem_50582)[(int64_t) 4 + sext_i32_i64(local_tid_50573)] = aggr_50651;\n                        ((__local int64_t *) local_mem_50582)[squot64(warp_byte_offset_50580, (int64_t) 8) + sext_i32_i64(local_tid_50573)] = aggr_50652;\n                        ((__local int8_t *) local_mem_50582)[sext_i32_i64(local_tid_50573)] = flag_50653;\n                        flag_50653 = ((__local int8_t *) local_mem_50582)[sext_i32_i64(wave_sizze_50575) - (int64_t) 1];\n                        if (slt8(flag_50653, (int8_t) 2)) {\n                            int8_t flg_x_50660;\n                            int8_t flg_y_50661;\n                            int64_t x_50654;\n                            int64_t x_50655;\n                            int64_t y_50656;\n                            int64_t y_50657;\n                            int32_t skip_threads_50662;\n                            \n                            // read input for in-block scan\n                            {\n                                flg_y_50661 = ((volatile __local int8_t *) local_mem_50582)[s", "ext_i32_i64(local_tid_50573)];\n                                y_50656 = ((volatile __local int64_t *) local_mem_50582)[(int64_t) 4 + sext_i32_i64(local_tid_50573)];\n                                y_50657 = ((volatile __local int64_t *) local_mem_50582)[squot64(warp_byte_offset_50580, (int64_t) 8) + sext_i32_i64(local_tid_50573)];\n                                if ((local_tid_50573 - squot32(local_tid_50573, 32) * 32) == 0) {\n                                    x_50654 = y_50656;\n                                    x_50655 = y_50657;\n                                    flg_x_50660 = flg_y_50661;\n                                }\n                            }\n                            // in-block scan (hopefully no barriers needed)\n                            {\n                                skip_threads_50662 = 1;\n                                while (slt32(skip_threads_50662, 32)) {\n                                    if (sle32(skip_threads_50662, local_tid_50573 - squot32(local_tid_50573, 32) * 32)) {\n                                        // read operands\n                                        {\n                                            flg_x_50660 = ((volatile __local int8_t *) local_mem_50582)[sext_i32_i64(local_tid_50573) - sext_i32_i64(skip_threads_50662)];\n                                            x_50654 = ((volatile __local int64_t *) local_mem_50582)[(int64_t) 4 + (sext_i32_i64(local_tid_50573) - sext_i32_i64(skip_threads_50662))];\n                                            x_50655 = ((volatile __local int64_t *) local_mem_50582)[squot64(warp_byte_offset_50580, (int64_t) 8) + (sext_i32_i64(local_tid_50573) - sext_i32_i64(skip_threads_50662))];\n                                        }\n                                        // perform operation\n                                        {\n                                            if (flg_y_50661 == (int8_t) 2 || flg_y_50661 == (int8_t) 0) {\n                                                flg_x", "_50660 = flg_y_50661;\n                                                x_50654 = y_50656;\n                                                x_50655 = y_50657;\n                                            } else {\n                                                int64_t zz_50658 = x_50654 + y_50656;\n                                                int64_t zz_50659 = x_50655 + y_50657;\n                                                \n                                                x_50654 = zz_50658;\n                                                x_50655 = zz_50659;\n                                            }\n                                        }\n                                        // write result\n                                        {\n                                            ((volatile __local int8_t *) local_mem_50582)[sext_i32_i64(local_tid_50573)] = flg_x_50660;\n                                            flg_y_50661 = flg_x_50660;\n                                            ((volatile __local int64_t *) local_mem_50582)[(int64_t) 4 + sext_i32_i64(local_tid_50573)] = x_50654;\n                                            y_50656 = x_50654;\n                                            ((volatile __local int64_t *) local_mem_50582)[squot64(warp_byte_offset_50580, (int64_t) 8) + sext_i32_i64(local_tid_50573)] = x_50655;\n                                            y_50657 = x_50655;\n                                        }\n                                    }\n                                    skip_threads_50662 *= 2;\n                                }\n                            }\n                        }\n                        flag_50653 = ((__local int8_t *) local_mem_50582)[sext_i32_i64(wave_sizze_50575) - (int64_t) 1];\n                        aggr_50651 = ((__local int64_t *) local_mem_50582)[(int64_t) 4 + (sext_i32_i64(wave_sizze_50575) - (int64_t) 1)];\n                        aggr_50652 = ((__local int64_t *) local_mem_50582)[squot64(warp_byte_offse",
                                    "t_50580, (int64_t) 8) + (sext_i32_i64(wave_sizze_50575) - (int64_t) 1)];\n                        if (flag_50653 == (int8_t) 2) {\n                            readOffset_50649 = wave_sizze_50575 * -1;\n                        } else if (flag_50653 == (int8_t) 1) {\n                            readOffset_50649 -= wave_sizze_50575;\n                        }\n                        if (slt8((int8_t) 0, flag_50653)) {\n                            int64_t x_50663 = aggr_50651;\n                            int64_t x_50664 = aggr_50652;\n                            int64_t y_50665 = prefix_50644;\n                            int64_t y_50666 = prefix_50645;\n                            int64_t zz_50667 = x_50663 + y_50665;\n                            int64_t zz_50668 = x_50664 + y_50666;\n                            \n                            prefix_50644 = zz_50667;\n                            prefix_50645 = zz_50668;\n                        }\n                        mem_fence_local();\n                    }\n                }\n                if (local_tid_50573 == 0) {\n                    if (boundary_50598 == sext_i64_i32(segscan_tblock_sizze_44380 * chunk_sizze_50557)) {\n                        int64_t x_50669 = prefix_50644;\n                        int64_t x_50670 = prefix_50645;\n                        int64_t y_50671 = acc_50630;\n                        int64_t y_50672 = acc_50631;\n                        int64_t zz_50673 = x_50669 + y_50671;\n                        int64_t zz_50674 = x_50670 + y_50672;\n                        \n                        ((volatile __global int64_t *) incprefixes_mem_50564)[dynamic_id_50595] = zz_50673;\n                        ((volatile __global int64_t *) incprefixes_mem_50568)[dynamic_id_50595] = zz_50674;\n                        mem_fence_global();\n                        ((volatile __global int8_t *) status_flags_mem_50560)[dynamic_id_50595] = (int8_t) 2;\n                    }\n                    ((__local int64_t *) local_mem_50582)[(int64_", "t) 4] = prefix_50644;\n                    ((__local int64_t *) local_mem_50582)[squot64(warp_byte_offset_50580, (int64_t) 8)] = prefix_50645;\n                    acc_50630 = (int64_t) 0;\n                    acc_50631 = (int64_t) 0;\n                }\n            }\n            if (!(dynamic_id_50595 == (int64_t) 0)) {\n                barrier(CLK_LOCAL_MEM_FENCE);\n                prefix_50644 = ((__local int64_t *) local_mem_50582)[(int64_t) 4];\n                prefix_50645 = ((__local int64_t *) local_mem_50582)[squot64(warp_byte_offset_50580, (int64_t) 8)];\n                barrier(CLK_LOCAL_MEM_FENCE);\n            }\n        }\n        // Distribute results\n        {\n            int64_t x_50675;\n            int64_t y_50677;\n            int64_t x_50681 = prefix_50644;\n            int64_t y_50683 = acc_50630;\n            int64_t x_50676;\n            int64_t y_50678;\n            int64_t x_50682 = prefix_50645;\n            int64_t y_50684 = acc_50631;\n            \n            if (slt32(local_tid_50573 * chunk_sizze_32b_50577, boundary_50598) && !block_new_sgm_50646) {\n                int64_t zz_50685 = x_50681 + y_50683;\n                int64_t zz_50686 = x_50682 + y_50684;\n                \n                x_50675 = zz_50685;\n                x_50676 = zz_50686;\n            } else {\n                x_50675 = acc_50630;\n                x_50676 = acc_50631;\n            }\n            \n            int32_t stopping_point_50687 = segsizze_compact_50599 - srem32(local_tid_50573 * chunk_sizze_32b_50577 - 1 + segsizze_compact_50599 - boundary_50598, segsizze_compact_50599);\n            \n            for (int64_t i_50688 = 0; i_50688 < chunk_sizze_50557; i_50688++) {\n                if (slt32(sext_i64_i32(i_50688), stopping_point_50687 - 1)) {\n                    y_50677 = private_mem_50600[i_50688];\n                    y_50678 = private_mem_50602[i_50688];\n                    \n                    int64_t zz_50679 = x_50675 + y_50677;\n                    int64_t zz_50680 = x_50676 + y", "_50678;\n                    \n                    private_mem_50600[i_50688] = zz_50679;\n                    private_mem_50602[i_50688] = zz_50680;\n                }\n            }\n        }\n        // Transpose scan output and Write it to global memory in coalesced fashion\n        {\n            for (int64_t i_50689 = 0; i_50689 < chunk_sizze_50557; i_50689++) {\n                int64_t sharedIdx_50690 = sext_i32_i64(local_tid_50573) * chunk_sizze_50557 + i_50689;\n                int64_t tmp_50691 = private_mem_50600[i_50689];\n                \n                ((__local int64_t *) local_mem_50582)[sharedIdx_50690] = tmp_50691;\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            for (int64_t i_50692 = 0; i_50692 < chunk_sizze_50557; i_50692++) {\n                int64_t flat_idx_50693 = thd_offset_50604 + i_50692 * segscan_tblock_sizze_44380;\n                int64_t slice_50694 = m_41318;\n                int64_t gtid_44384 = flat_idx_50693;\n                int64_t remnant_50695 = flat_idx_50693 - gtid_44384;\n                \n                if (slt64(flat_idx_50693, m_41318)) {\n                    int64_t tmp_50696 = ((__local int64_t *) local_mem_50582)[flat_idx_50693 - block_offset_50596];\n                    \n                    ((__global int64_t *) mem_49448)[gtid_44384] = tmp_50696;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            for (int64_t i_50697 = 0; i_50697 < chunk_sizze_50557; i_50697++) {\n                int64_t sharedIdx_50698 = sext_i32_i64(local_tid_50573) * chunk_sizze_50557 + i_50697;\n                int64_t tmp_50699 = private_mem_50602[i_50697];\n                \n                ((__local int64_t *) local_mem_50582)[sharedIdx_50698] = tmp_50699;\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            for (int64_t i_50700 = 0; i_50700 < chunk_sizze_50557; i_50700++) {\n                int64_t flat_idx_50701 = thd_offset_50604 + i_50700 * segscan_tblock_sizze_44380;\n                int64_t ",
                                    "slice_50702 = m_41318;\n                int64_t gtid_44384 = flat_idx_50701;\n                int64_t remnant_50703 = flat_idx_50701 - gtid_44384;\n                \n                if (slt64(flat_idx_50701, m_41318)) {\n                    int64_t tmp_50704 = ((__local int64_t *) local_mem_50582)[flat_idx_50701 - block_offset_50596];\n                    \n                    ((__global int64_t *) mem_49450)[gtid_44384] = tmp_50704;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n        }\n    }\n    \n  error_3:\n    return;\n    #undef segscan_tblock_sizze_44380\n    #undef chunk_sizze_50557\n}\nFUTHARK_KERNEL_SIZED(do_DBSCAN_doublezisegscan_44401_dim1, 1, 1)\nvoid do_DBSCAN_doublezisegscan_44401(__global int *global_failure, int64_t clBase_34773, int64_t partition_sizze_41393, int64_t num_tblocks_44398, int64_t num_virt_blocks_50725, int64_t num_virt_threads_50726, __global unsigned char *ext_mem_49462, __global unsigned char *ext_mem_49469, __global unsigned char *ext_mem_49470, __global unsigned char *mem_49473, __global unsigned char *mem_49475, __global unsigned char *mem_49476, __global unsigned char *status_flags_mem_50727, __global unsigned char *aggregates_mem_50729, __global unsigned char *incprefixes_mem_50731, __global unsigned char *global_dynid_mem_50733)\n{\n    #define segscan_tblock_sizze_44396 (do_DBSCAN_doublezisegscan_44401zisegscan_tblock_sizze_44396)\n    #define chunk_sizze_50724 (do_DBSCAN_doublezisegscan_44401zichunk_sizze_50724)\n    \n    volatile __local unsigned char *local_mem_50743_backing_0 = &shared_mem[0];\n    const int64_t local_mem_50743_backing_0_offset = 0 + (smax64(smax64((int64_t) 288, (int64_t) 8 * segscan_tblock_sizze_44396), chunk_sizze_50724 * segscan_tblock_sizze_44396 * (int64_t) 8) + srem64((int64_t) 8 - srem64(smax64(smax64((int64_t) 288, (int64_t) 8 * segscan_tblock_sizze_44396), chunk_sizze_50724 * segscan_tblock_sizze_44396 * (int64_t) 8), (int64_t) 8), (int64_t) 8));\n    \n    if (*global_failure >= 0)\n    ", "    return;\n    \n    int32_t local_tid_50736;\n    int32_t tblock_sizze_50739;\n    int32_t wave_sizze_50738;\n    int32_t block_id_50737;\n    int32_t global_tid_50735;\n    int64_t phys_tid_44401;\n    int32_t chunk_sizze_32b_50740;\n    int64_t byte_offsets_50741;\n    int64_t warp_byte_offset_50742;\n    __local unsigned char *local_mem_50743;\n    int64_t trans_arr_len_50744;\n    int64_t phys_block_id_50750;\n    int64_t virtloop_bound_50751;\n    \n    local_tid_50736 = get_local_id(0);\n    tblock_sizze_50739 = get_local_size(0);\n    wave_sizze_50738 = LOCKSTEP_WIDTH;\n    block_id_50737 = get_tblock_id(0);\n    global_tid_50735 = block_id_50737 * tblock_sizze_50739 + local_tid_50736;\n    phys_tid_44401 = sext_i32_i64(global_tid_50735);\n    chunk_sizze_32b_50740 = sext_i64_i32(chunk_sizze_50724);\n    byte_offsets_50741 = segscan_tblock_sizze_44396 * (int64_t) 8;\n    warp_byte_offset_50742 = (int64_t) 288;\n    // Allocate reusable shared memory\n    { }\n    local_mem_50743 = (__local unsigned char *) local_mem_50743_backing_0;\n    trans_arr_len_50744 = chunk_sizze_50724 * segscan_tblock_sizze_44396;\n    phys_block_id_50750 = get_tblock_id(0);\n    virtloop_bound_50751 = sdiv_up64(num_virt_blocks_50725 - phys_block_id_50750, num_tblocks_44398);\n    for (int64_t virtloop_i_50752 = 0; virtloop_i_50752 < virtloop_bound_50751; virtloop_i_50752++) {\n        int64_t dynamic_id_50753;\n        int64_t block_offset_50754;\n        int64_t sgm_idx_50755;\n        int32_t boundary_50756;\n        int32_t segsizze_compact_50757;\n        int64_t private_mem_50758[chunk_sizze_50724];\n        int64_t thd_offset_50760;\n        int64_t acc_50776;\n        int64_t prefix_50786;\n        bool block_new_sgm_50787;\n        \n        // First thread in block fetches this block's dynamic_id\n        {\n            if (local_tid_50736 == 0) {\n                dynamic_id_50753 = atomic_add_i32_global(&((volatile __global int *) global_dynid_mem_50733)[(int64_t) 0], (int) 1);\n                // Set dynamic id for", " this block\n                {\n                    ((__local int64_t *) local_mem_50743)[(int64_t) 0] = dynamic_id_50753;\n                }\n                // First thread in last (virtual) block resets global dynamic_id\n                {\n                    if (dynamic_id_50753 == num_virt_blocks_50725 - (int64_t) 1) {\n                        ((__global int32_t *) global_dynid_mem_50733)[(int64_t) 0] = 0;\n                    }\n                }\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        dynamic_id_50753 = ((__local int32_t *) local_mem_50743)[(int64_t) 0];\n        barrier(CLK_LOCAL_MEM_FENCE);\n        block_offset_50754 = dynamic_id_50753 * chunk_sizze_50724 * segscan_tblock_sizze_44396;\n        sgm_idx_50755 = smod64(block_offset_50754, partition_sizze_41393);\n        boundary_50756 = sext_i64_i32(smin64(chunk_sizze_50724 * segscan_tblock_sizze_44396, partition_sizze_41393 - sgm_idx_50755));\n        segsizze_compact_50757 = sext_i64_i32(smin64(chunk_sizze_50724 * segscan_tblock_sizze_44396, partition_sizze_41393));\n        thd_offset_50760 = block_offset_50754 + sext_i32_i64(local_tid_50736);\n        // Load and map\n        {\n            for (int64_t i_50761 = 0; i_50761 < chunk_sizze_50724; i_50761++) {\n                int64_t virt_tid_50762 = thd_offset_50760 + i_50761 * segscan_tblock_sizze_44396;\n                int64_t slice_50763 = partition_sizze_41393;\n                int64_t gtid_44400 = virt_tid_50762;\n                int64_t remnant_50764 = virt_tid_50762 - gtid_44400;\n                \n                if (slt64(virt_tid_50762, partition_sizze_41393)) {\n                    int64_t eta_p_42328 = ((__global int64_t *) ext_mem_49470)[gtid_44400];\n                    int64_t eta_p_42329 = ((__global int64_t *) ext_mem_49469)[gtid_44400];\n                    int64_t eta_p_42330 = ((__global int64_t *) ext_mem_49462)[gtid_44400];\n                    int64_t zp_lhs_42331 = add64(eta_p_42328, eta_p_42329);\n                    int64_t zm",
                                    "_lhs_42332 = add64(eta_p_42330, zp_lhs_42331);\n                    int64_t lifted_lambda_res_42333 = sub64(zm_lhs_42332, (int64_t) 1);\n                    bool lifted_lambda_res_42335 = sle64(clBase_34773, lifted_lambda_res_42333);\n                    int64_t defunc_0_f_res_42337 = btoi_bool_i64(lifted_lambda_res_42335);\n                    \n                    ((__global int64_t *) mem_49475)[gtid_44400] = defunc_0_f_res_42337;\n                    ((__global bool *) mem_49476)[gtid_44400] = lifted_lambda_res_42335;\n                    private_mem_50758[i_50761] = defunc_0_f_res_42337;\n                } else {\n                    private_mem_50758[i_50761] = (int64_t) 0;\n                }\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        // Transpose scan inputs\n        {\n            for (int64_t i_50765 = 0; i_50765 < chunk_sizze_50724; i_50765++) {\n                int64_t sharedIdx_50766 = sext_i32_i64(local_tid_50736) + i_50765 * segscan_tblock_sizze_44396;\n                int64_t tmp_50767 = private_mem_50758[i_50765];\n                \n                ((__local int64_t *) local_mem_50743)[sharedIdx_50766] = tmp_50767;\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            for (int64_t i_50768 = 0; i_50768 < chunk_sizze_50724; i_50768++) {\n                int64_t sharedIdx_50769 = sext_i32_i64(local_tid_50736) * chunk_sizze_50724 + i_50768;\n                int64_t tmp_50770 = ((__local int64_t *) local_mem_50743)[sharedIdx_50769];\n                \n                private_mem_50758[i_50768] = tmp_50770;\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n        }\n        // Per thread scan\n        {\n            for (int64_t i_50771 = 0; i_50771 < chunk_sizze_50724 - (int64_t) 1; i_50771++) {\n                int64_t eta_p_41475;\n                int64_t eta_p_41476;\n                \n                eta_p_41475 = private_mem_50758[i_50771];\n                eta_p_41476 = private_mem_50758[i_50771 + (int64_t) 1];\n                \n ", "               int64_t defunc_0_op_res_41477 = add64(eta_p_41475, eta_p_41476);\n                \n                private_mem_50758[i_50771 + (int64_t) 1] = defunc_0_op_res_41477;\n            }\n        }\n        // Publish results in shared memory\n        {\n            int64_t tmp_50772 = private_mem_50758[chunk_sizze_50724 - (int64_t) 1];\n            \n            ((__local int64_t *) local_mem_50743)[sext_i32_i64(local_tid_50736)] = tmp_50772;\n            barrier(CLK_LOCAL_MEM_FENCE);\n        }\n        // Scan results (with warp scan)\n        {\n            int64_t eta_p_50773;\n            int64_t eta_p_50774;\n            int64_t eta_p_50777;\n            int64_t eta_p_50778;\n            bool ltid_in_bounds_50780 = slt64(sext_i32_i64(local_tid_50736), num_virt_threads_50726);\n            int32_t skip_threads_50781;\n            \n            // read input for in-block scan\n            {\n                if (ltid_in_bounds_50780) {\n                    eta_p_50774 = ((volatile __local int64_t *) local_mem_50743)[sext_i32_i64(local_tid_50736)];\n                    if ((local_tid_50736 - squot32(local_tid_50736, 32) * 32) == 0) {\n                        eta_p_50773 = eta_p_50774;\n                    }\n                }\n            }\n            // in-block scan (hopefully no barriers needed)\n            {\n                skip_threads_50781 = 1;\n                while (slt32(skip_threads_50781, 32)) {\n                    bool thread_active_50782 = sle32(skip_threads_50781, local_tid_50736 - squot32(local_tid_50736, 32) * 32) && ltid_in_bounds_50780;\n                    \n                    if (thread_active_50782) {\n                        // read operands\n                        {\n                            eta_p_50773 = ((volatile __local int64_t *) local_mem_50743)[sext_i32_i64(local_tid_50736) - sext_i32_i64(skip_threads_50781)];\n                        }\n                    }\n                    // perform operation\n                    {\n                        if (threa", "d_active_50782) {\n                            int64_t defunc_0_op_res_50775 = add64(eta_p_50773, eta_p_50774);\n                            \n                            eta_p_50773 = defunc_0_op_res_50775;\n                        }\n                    }\n                    if (sle32(wave_sizze_50738, skip_threads_50781)) {\n                        barrier(CLK_LOCAL_MEM_FENCE);\n                    }\n                    if (thread_active_50782) {\n                        // write result\n                        {\n                            ((volatile __local int64_t *) local_mem_50743)[sext_i32_i64(local_tid_50736)] = eta_p_50773;\n                            eta_p_50774 = eta_p_50773;\n                        }\n                    }\n                    if (sle32(wave_sizze_50738, skip_threads_50781)) {\n                        barrier(CLK_LOCAL_MEM_FENCE);\n                    }\n                    skip_threads_50781 *= 2;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // last thread of block 'i' writes its result to offset 'i'\n            {\n                if ((local_tid_50736 - squot32(local_tid_50736, 32) * 32) == 31 && ltid_in_bounds_50780) {\n                    ((volatile __local int64_t *) local_mem_50743)[sext_i32_i64(squot32(local_tid_50736, 32))] = eta_p_50773;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // scan the first block, after which offset 'i' contains carry-in for block 'i+1'\n            {\n                int32_t skip_threads_50783;\n                \n                // read input for in-block scan\n                {\n                    if (squot32(local_tid_50736, 32) == 0 && ltid_in_bounds_50780) {\n                        eta_p_50778 = ((volatile __local int64_t *) local_mem_50743)[sext_i32_i64(local_tid_50736)];\n                        if ((local_tid_50736 - squot32(local_tid_50736, 32) * 32) == 0) {\n                            eta_p_50777 = eta_p_50778;\n                      ",
                                    "  }\n                    }\n                }\n                // in-block scan (hopefully no barriers needed)\n                {\n                    skip_threads_50783 = 1;\n                    while (slt32(skip_threads_50783, 32)) {\n                        bool thread_active_50784 = sle32(skip_threads_50783, local_tid_50736 - squot32(local_tid_50736, 32) * 32) && (squot32(local_tid_50736, 32) == 0 && ltid_in_bounds_50780);\n                        \n                        if (thread_active_50784) {\n                            // read operands\n                            {\n                                eta_p_50777 = ((volatile __local int64_t *) local_mem_50743)[sext_i32_i64(local_tid_50736) - sext_i32_i64(skip_threads_50783)];\n                            }\n                        }\n                        // perform operation\n                        {\n                            if (thread_active_50784) {\n                                int64_t defunc_0_op_res_50779 = add64(eta_p_50777, eta_p_50778);\n                                \n                                eta_p_50777 = defunc_0_op_res_50779;\n                            }\n                        }\n                        if (sle32(wave_sizze_50738, skip_threads_50783)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        if (thread_active_50784) {\n                            // write result\n                            {\n                                ((volatile __local int64_t *) local_mem_50743)[sext_i32_i64(local_tid_50736)] = eta_p_50777;\n                                eta_p_50778 = eta_p_50777;\n                            }\n                        }\n                        if (sle32(wave_sizze_50738, skip_threads_50783)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        skip_threads_50783 *= 2;\n                    }\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n", "            \n            bool no_carry_in_50785 = squot32(local_tid_50736, 32) == 0 || !ltid_in_bounds_50780;\n            \n            // carry-in for every block except the first\n            {\n                // read operands\n                {\n                    if (!no_carry_in_50785) {\n                        eta_p_50774 = eta_p_50773;\n                        eta_p_50773 = ((__local int64_t *) local_mem_50743)[sext_i32_i64(squot32(local_tid_50736, 32)) - (int64_t) 1];\n                    }\n                }\n                // perform operation\n                {\n                    if (!no_carry_in_50785) {\n                        int64_t defunc_0_op_res_50775 = add64(eta_p_50773, eta_p_50774);\n                        \n                        eta_p_50773 = defunc_0_op_res_50775;\n                    }\n                }\n                // write final result\n                {\n                    if (!no_carry_in_50785) {\n                        ((__local int64_t *) local_mem_50743)[sext_i32_i64(local_tid_50736)] = eta_p_50773;\n                    }\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // restore correct values for first block\n            {\n                if (squot32(local_tid_50736, 32) == 0 && ltid_in_bounds_50780) {\n                    ((__local int64_t *) local_mem_50743)[sext_i32_i64(local_tid_50736)] = eta_p_50774;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            barrier(CLK_LOCAL_MEM_FENCE);\n            if (local_tid_50736 == 0) {\n                acc_50776 = ((__local int64_t *) local_mem_50743)[segscan_tblock_sizze_44396 - (int64_t) 1];\n            } else {\n                acc_50776 = ((__local int64_t *) local_mem_50743)[sext_i32_i64(local_tid_50736) - (int64_t) 1];\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n        }\n        prefix_50786 = (int64_t) 0;\n        block_new_sgm_50787 = sgm_idx_50755 == (int64_t) 0;\n        // Perform lookback\n        {\n          ", "  if (block_new_sgm_50787 && local_tid_50736 == 0) {\n                ((volatile __global int64_t *) incprefixes_mem_50731)[dynamic_id_50753] = acc_50776;\n                mem_fence_global();\n                ((volatile __global int8_t *) status_flags_mem_50727)[dynamic_id_50753] = (int8_t) 2;\n                acc_50776 = (int64_t) 0;\n            }\n            if (!block_new_sgm_50787 && slt32(local_tid_50736, wave_sizze_50738)) {\n                if (local_tid_50736 == 0) {\n                    ((volatile __global int64_t *) aggregates_mem_50729)[dynamic_id_50753] = acc_50776;\n                    mem_fence_global();\n                    ((volatile __global int8_t *) status_flags_mem_50727)[dynamic_id_50753] = (int8_t) 1;\n                    \n                    int8_t tmp_50788 = ((volatile __global int8_t *) status_flags_mem_50727)[dynamic_id_50753 - (int64_t) 1];\n                    \n                    ((volatile __local int8_t *) local_mem_50743)[(int64_t) 0] = tmp_50788;\n                }\n                mem_fence_local();\n                \n                int8_t status_50789 = ((__local int8_t *) local_mem_50743)[(int64_t) 0];\n                \n                if (status_50789 == (int8_t) 2) {\n                    if (local_tid_50736 == 0) {\n                        prefix_50786 = ((volatile __global int64_t *) incprefixes_mem_50731)[dynamic_id_50753 - (int64_t) 1];\n                    }\n                } else {\n                    int32_t readOffset_50790 = sext_i64_i32(dynamic_id_50753 - sext_i32_i64(wave_sizze_50738));\n                    \n                    while (slt32(wave_sizze_50738 * -1, readOffset_50790)) {\n                        int32_t read_i_50791 = readOffset_50790 + local_tid_50736;\n                        int64_t aggr_50792 = (int64_t) 0;\n                        int8_t flag_50793 = (int8_t) 0;\n                        \n                        if (sle32(0, read_i_50791)) {\n                            flag_50793 = ((volatile __global int8_t *) status_flag",
                                    "s_mem_50727)[sext_i32_i64(read_i_50791)];\n                            if (flag_50793 == (int8_t) 2) {\n                                aggr_50792 = ((volatile __global int64_t *) incprefixes_mem_50731)[sext_i32_i64(read_i_50791)];\n                            } else if (flag_50793 == (int8_t) 1) {\n                                aggr_50792 = ((volatile __global int64_t *) aggregates_mem_50729)[sext_i32_i64(read_i_50791)];\n                            }\n                        }\n                        ((__local int64_t *) local_mem_50743)[(int64_t) 4 + sext_i32_i64(local_tid_50736)] = aggr_50792;\n                        ((__local int8_t *) local_mem_50743)[sext_i32_i64(local_tid_50736)] = flag_50793;\n                        flag_50793 = ((__local int8_t *) local_mem_50743)[sext_i32_i64(wave_sizze_50738) - (int64_t) 1];\n                        if (slt8(flag_50793, (int8_t) 2)) {\n                            int8_t flg_x_50797;\n                            int8_t flg_y_50798;\n                            int64_t eta_p_50794;\n                            int64_t eta_p_50795;\n                            int32_t skip_threads_50799;\n                            \n                            // read input for in-block scan\n                            {\n                                flg_y_50798 = ((volatile __local int8_t *) local_mem_50743)[sext_i32_i64(local_tid_50736)];\n                                eta_p_50795 = ((volatile __local int64_t *) local_mem_50743)[(int64_t) 4 + sext_i32_i64(local_tid_50736)];\n                                if ((local_tid_50736 - squot32(local_tid_50736, 32) * 32) == 0) {\n                                    eta_p_50794 = eta_p_50795;\n                                    flg_x_50797 = flg_y_50798;\n                                }\n                            }\n                            // in-block scan (hopefully no barriers needed)\n                            {\n                                skip_threads_50799 = 1;\n                              ", "  while (slt32(skip_threads_50799, 32)) {\n                                    if (sle32(skip_threads_50799, local_tid_50736 - squot32(local_tid_50736, 32) * 32)) {\n                                        // read operands\n                                        {\n                                            flg_x_50797 = ((volatile __local int8_t *) local_mem_50743)[sext_i32_i64(local_tid_50736) - sext_i32_i64(skip_threads_50799)];\n                                            eta_p_50794 = ((volatile __local int64_t *) local_mem_50743)[(int64_t) 4 + (sext_i32_i64(local_tid_50736) - sext_i32_i64(skip_threads_50799))];\n                                        }\n                                        // perform operation\n                                        {\n                                            if (flg_y_50798 == (int8_t) 2 || flg_y_50798 == (int8_t) 0) {\n                                                flg_x_50797 = flg_y_50798;\n                                                eta_p_50794 = eta_p_50795;\n                                            } else {\n                                                int64_t defunc_0_op_res_50796 = add64(eta_p_50794, eta_p_50795);\n                                                \n                                                eta_p_50794 = defunc_0_op_res_50796;\n                                            }\n                                        }\n                                        // write result\n                                        {\n                                            ((volatile __local int8_t *) local_mem_50743)[sext_i32_i64(local_tid_50736)] = flg_x_50797;\n                                            flg_y_50798 = flg_x_50797;\n                                            ((volatile __local int64_t *) local_mem_50743)[(int64_t) 4 + sext_i32_i64(local_tid_50736)] = eta_p_50794;\n                                            eta_p_50795 = eta_p_50794;\n                                        }\n                    ", "                }\n                                    skip_threads_50799 *= 2;\n                                }\n                            }\n                        }\n                        flag_50793 = ((__local int8_t *) local_mem_50743)[sext_i32_i64(wave_sizze_50738) - (int64_t) 1];\n                        aggr_50792 = ((__local int64_t *) local_mem_50743)[(int64_t) 4 + (sext_i32_i64(wave_sizze_50738) - (int64_t) 1)];\n                        if (flag_50793 == (int8_t) 2) {\n                            readOffset_50790 = wave_sizze_50738 * -1;\n                        } else if (flag_50793 == (int8_t) 1) {\n                            readOffset_50790 -= wave_sizze_50738;\n                        }\n                        if (slt8((int8_t) 0, flag_50793)) {\n                            int64_t eta_p_50800 = aggr_50792;\n                            int64_t eta_p_50801 = prefix_50786;\n                            int64_t defunc_0_op_res_50802 = add64(eta_p_50800, eta_p_50801);\n                            \n                            prefix_50786 = defunc_0_op_res_50802;\n                        }\n                        mem_fence_local();\n                    }\n                }\n                if (local_tid_50736 == 0) {\n                    if (boundary_50756 == sext_i64_i32(segscan_tblock_sizze_44396 * chunk_sizze_50724)) {\n                        int64_t eta_p_50803 = prefix_50786;\n                        int64_t eta_p_50804 = acc_50776;\n                        int64_t defunc_0_op_res_50805 = add64(eta_p_50803, eta_p_50804);\n                        \n                        ((volatile __global int64_t *) incprefixes_mem_50731)[dynamic_id_50753] = defunc_0_op_res_50805;\n                        mem_fence_global();\n                        ((volatile __global int8_t *) status_flags_mem_50727)[dynamic_id_50753] = (int8_t) 2;\n                    }\n                    ((__local int64_t *) local_mem_50743)[(int64_t) 4] = prefix_50786;\n                    acc_50776 = (int64_t) 0",
                                    ";\n                }\n            }\n            if (!(dynamic_id_50753 == (int64_t) 0)) {\n                barrier(CLK_LOCAL_MEM_FENCE);\n                prefix_50786 = ((__local int64_t *) local_mem_50743)[(int64_t) 4];\n                barrier(CLK_LOCAL_MEM_FENCE);\n            }\n        }\n        // Distribute results\n        {\n            int64_t eta_p_50806;\n            int64_t eta_p_50807;\n            int64_t eta_p_50809 = prefix_50786;\n            int64_t eta_p_50810 = acc_50776;\n            \n            if (slt32(local_tid_50736 * chunk_sizze_32b_50740, boundary_50756) && !block_new_sgm_50787) {\n                int64_t defunc_0_op_res_50811 = add64(eta_p_50809, eta_p_50810);\n                \n                eta_p_50806 = defunc_0_op_res_50811;\n            } else {\n                eta_p_50806 = acc_50776;\n            }\n            \n            int32_t stopping_point_50812 = segsizze_compact_50757 - srem32(local_tid_50736 * chunk_sizze_32b_50740 - 1 + segsizze_compact_50757 - boundary_50756, segsizze_compact_50757);\n            \n            for (int64_t i_50813 = 0; i_50813 < chunk_sizze_50724; i_50813++) {\n                if (slt32(sext_i64_i32(i_50813), stopping_point_50812 - 1)) {\n                    eta_p_50807 = private_mem_50758[i_50813];\n                    \n                    int64_t defunc_0_op_res_50808 = add64(eta_p_50806, eta_p_50807);\n                    \n                    private_mem_50758[i_50813] = defunc_0_op_res_50808;\n                }\n            }\n        }\n        // Transpose scan output and Write it to global memory in coalesced fashion\n        {\n            for (int64_t i_50814 = 0; i_50814 < chunk_sizze_50724; i_50814++) {\n                int64_t sharedIdx_50815 = sext_i32_i64(local_tid_50736) * chunk_sizze_50724 + i_50814;\n                int64_t tmp_50816 = private_mem_50758[i_50814];\n                \n                ((__local int64_t *) local_mem_50743)[sharedIdx_50815] = tmp_50816;\n            }\n            barrier(CLK_LOCAL_MEM_FENC", "E);\n            for (int64_t i_50817 = 0; i_50817 < chunk_sizze_50724; i_50817++) {\n                int64_t flat_idx_50818 = thd_offset_50760 + i_50817 * segscan_tblock_sizze_44396;\n                int64_t slice_50819 = partition_sizze_41393;\n                int64_t gtid_44400 = flat_idx_50818;\n                int64_t remnant_50820 = flat_idx_50818 - gtid_44400;\n                \n                if (slt64(flat_idx_50818, partition_sizze_41393)) {\n                    int64_t tmp_50821 = ((__local int64_t *) local_mem_50743)[flat_idx_50818 - block_offset_50754];\n                    \n                    ((__global int64_t *) mem_49473)[gtid_44400] = tmp_50821;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n        }\n    }\n    \n  error_3:\n    return;\n    #undef segscan_tblock_sizze_44396\n    #undef chunk_sizze_50724\n}\nFUTHARK_KERNEL_SIZED(do_DBSCAN_doublezisegscan_44447_dim1, 1, 1)\nvoid do_DBSCAN_doublezisegscan_44447(__global int *global_failure, int64_t n_34757, int64_t num_tblocks_44444, int64_t num_virt_blocks_50863, int64_t num_virt_threads_50864, __global unsigned char *mem_49487, __global unsigned char *mem_49490, __global unsigned char *mem_49492, __global unsigned char *status_flags_mem_50865, __global unsigned char *aggregates_mem_50867, __global unsigned char *incprefixes_mem_50869, __global unsigned char *global_dynid_mem_50871)\n{\n    #define segscan_tblock_sizze_44442 (do_DBSCAN_doublezisegscan_44447zisegscan_tblock_sizze_44442)\n    #define chunk_sizze_50862 (do_DBSCAN_doublezisegscan_44447zichunk_sizze_50862)\n    \n    volatile __local unsigned char *local_mem_50881_backing_0 = &shared_mem[0];\n    const int64_t local_mem_50881_backing_0_offset = 0 + (smax64(smax64((int64_t) 288, (int64_t) 8 * segscan_tblock_sizze_44442), chunk_sizze_50862 * segscan_tblock_sizze_44442 * (int64_t) 8) + srem64((int64_t) 8 - srem64(smax64(smax64((int64_t) 288, (int64_t) 8 * segscan_tblock_sizze_44442), chunk_sizze_50862 * segscan_tblock_sizze_44442 * (", "int64_t) 8), (int64_t) 8), (int64_t) 8));\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_50874;\n    int32_t tblock_sizze_50877;\n    int32_t wave_sizze_50876;\n    int32_t block_id_50875;\n    int32_t global_tid_50873;\n    int64_t phys_tid_44447;\n    int32_t chunk_sizze_32b_50878;\n    int64_t byte_offsets_50879;\n    int64_t warp_byte_offset_50880;\n    __local unsigned char *local_mem_50881;\n    int64_t trans_arr_len_50882;\n    int64_t phys_block_id_50888;\n    int64_t virtloop_bound_50889;\n    \n    local_tid_50874 = get_local_id(0);\n    tblock_sizze_50877 = get_local_size(0);\n    wave_sizze_50876 = LOCKSTEP_WIDTH;\n    block_id_50875 = get_tblock_id(0);\n    global_tid_50873 = block_id_50875 * tblock_sizze_50877 + local_tid_50874;\n    phys_tid_44447 = sext_i32_i64(global_tid_50873);\n    chunk_sizze_32b_50878 = sext_i64_i32(chunk_sizze_50862);\n    byte_offsets_50879 = segscan_tblock_sizze_44442 * (int64_t) 8;\n    warp_byte_offset_50880 = (int64_t) 288;\n    // Allocate reusable shared memory\n    { }\n    local_mem_50881 = (__local unsigned char *) local_mem_50881_backing_0;\n    trans_arr_len_50882 = chunk_sizze_50862 * segscan_tblock_sizze_44442;\n    phys_block_id_50888 = get_tblock_id(0);\n    virtloop_bound_50889 = sdiv_up64(num_virt_blocks_50863 - phys_block_id_50888, num_tblocks_44444);\n    for (int64_t virtloop_i_50890 = 0; virtloop_i_50890 < virtloop_bound_50889; virtloop_i_50890++) {\n        int64_t dynamic_id_50891;\n        int64_t block_offset_50892;\n        int64_t sgm_idx_50893;\n        int32_t boundary_50894;\n        int32_t segsizze_compact_50895;\n        int64_t private_mem_50896[chunk_sizze_50862];\n        int64_t thd_offset_50898;\n        int64_t acc_50914;\n        int64_t prefix_50924;\n        bool block_new_sgm_50925;\n        \n        // First thread in block fetches this block's dynamic_id\n        {\n            if (local_tid_50874 == 0) {\n                dynamic_id_50891 = atomic_add_i32_global(&((volatile __global int *) glob",
                                    "al_dynid_mem_50871)[(int64_t) 0], (int) 1);\n                // Set dynamic id for this block\n                {\n                    ((__local int64_t *) local_mem_50881)[(int64_t) 0] = dynamic_id_50891;\n                }\n                // First thread in last (virtual) block resets global dynamic_id\n                {\n                    if (dynamic_id_50891 == num_virt_blocks_50863 - (int64_t) 1) {\n                        ((__global int32_t *) global_dynid_mem_50871)[(int64_t) 0] = 0;\n                    }\n                }\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        dynamic_id_50891 = ((__local int32_t *) local_mem_50881)[(int64_t) 0];\n        barrier(CLK_LOCAL_MEM_FENCE);\n        block_offset_50892 = dynamic_id_50891 * chunk_sizze_50862 * segscan_tblock_sizze_44442;\n        sgm_idx_50893 = smod64(block_offset_50892, n_34757);\n        boundary_50894 = sext_i64_i32(smin64(chunk_sizze_50862 * segscan_tblock_sizze_44442, n_34757 - sgm_idx_50893));\n        segsizze_compact_50895 = sext_i64_i32(smin64(chunk_sizze_50862 * segscan_tblock_sizze_44442, n_34757));\n        thd_offset_50898 = block_offset_50892 + sext_i32_i64(local_tid_50874);\n        // Load and map\n        {\n            for (int64_t i_50899 = 0; i_50899 < chunk_sizze_50862; i_50899++) {\n                int64_t virt_tid_50900 = thd_offset_50898 + i_50899 * segscan_tblock_sizze_44442;\n                int64_t slice_50901 = n_34757;\n                int64_t gtid_44446 = virt_tid_50900;\n                int64_t remnant_50902 = virt_tid_50900 - gtid_44446;\n                \n                if (slt64(virt_tid_50900, n_34757)) {\n                    bool eta_p_42298 = ((__global bool *) mem_49487)[gtid_44446];\n                    int64_t defunc_0_f_res_42299 = btoi_bool_i64(eta_p_42298);\n                    \n                    ((__global int64_t *) mem_49492)[gtid_44446] = defunc_0_f_res_42299;\n                    private_mem_50896[i_50899] = defunc_0_f_res_42299;\n                } else {\n    ", "                private_mem_50896[i_50899] = (int64_t) 0;\n                }\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        // Transpose scan inputs\n        {\n            for (int64_t i_50903 = 0; i_50903 < chunk_sizze_50862; i_50903++) {\n                int64_t sharedIdx_50904 = sext_i32_i64(local_tid_50874) + i_50903 * segscan_tblock_sizze_44442;\n                int64_t tmp_50905 = private_mem_50896[i_50903];\n                \n                ((__local int64_t *) local_mem_50881)[sharedIdx_50904] = tmp_50905;\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            for (int64_t i_50906 = 0; i_50906 < chunk_sizze_50862; i_50906++) {\n                int64_t sharedIdx_50907 = sext_i32_i64(local_tid_50874) * chunk_sizze_50862 + i_50906;\n                int64_t tmp_50908 = ((__local int64_t *) local_mem_50881)[sharedIdx_50907];\n                \n                private_mem_50896[i_50906] = tmp_50908;\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n        }\n        // Per thread scan\n        {\n            for (int64_t i_50909 = 0; i_50909 < chunk_sizze_50862 - (int64_t) 1; i_50909++) {\n                int64_t eta_p_41522;\n                int64_t eta_p_41523;\n                \n                eta_p_41522 = private_mem_50896[i_50909];\n                eta_p_41523 = private_mem_50896[i_50909 + (int64_t) 1];\n                \n                int64_t defunc_0_op_res_41524 = add64(eta_p_41522, eta_p_41523);\n                \n                private_mem_50896[i_50909 + (int64_t) 1] = defunc_0_op_res_41524;\n            }\n        }\n        // Publish results in shared memory\n        {\n            int64_t tmp_50910 = private_mem_50896[chunk_sizze_50862 - (int64_t) 1];\n            \n            ((__local int64_t *) local_mem_50881)[sext_i32_i64(local_tid_50874)] = tmp_50910;\n            barrier(CLK_LOCAL_MEM_FENCE);\n        }\n        // Scan results (with warp scan)\n        {\n            int64_t eta_p_50911;\n            int64_t eta_p_50912;\n     ", "       int64_t eta_p_50915;\n            int64_t eta_p_50916;\n            bool ltid_in_bounds_50918 = slt64(sext_i32_i64(local_tid_50874), num_virt_threads_50864);\n            int32_t skip_threads_50919;\n            \n            // read input for in-block scan\n            {\n                if (ltid_in_bounds_50918) {\n                    eta_p_50912 = ((volatile __local int64_t *) local_mem_50881)[sext_i32_i64(local_tid_50874)];\n                    if ((local_tid_50874 - squot32(local_tid_50874, 32) * 32) == 0) {\n                        eta_p_50911 = eta_p_50912;\n                    }\n                }\n            }\n            // in-block scan (hopefully no barriers needed)\n            {\n                skip_threads_50919 = 1;\n                while (slt32(skip_threads_50919, 32)) {\n                    bool thread_active_50920 = sle32(skip_threads_50919, local_tid_50874 - squot32(local_tid_50874, 32) * 32) && ltid_in_bounds_50918;\n                    \n                    if (thread_active_50920) {\n                        // read operands\n                        {\n                            eta_p_50911 = ((volatile __local int64_t *) local_mem_50881)[sext_i32_i64(local_tid_50874) - sext_i32_i64(skip_threads_50919)];\n                        }\n                    }\n                    // perform operation\n                    {\n                        if (thread_active_50920) {\n                            int64_t defunc_0_op_res_50913 = add64(eta_p_50911, eta_p_50912);\n                            \n                            eta_p_50911 = defunc_0_op_res_50913;\n                        }\n                    }\n                    if (sle32(wave_sizze_50876, skip_threads_50919)) {\n                        barrier(CLK_LOCAL_MEM_FENCE);\n                    }\n                    if (thread_active_50920) {\n                        // write result\n                        {\n                            ((volatile __local int64_t *) local_mem_50881)[sext_i32_i64(local_tid_50874)] = e",
                                    "ta_p_50911;\n                            eta_p_50912 = eta_p_50911;\n                        }\n                    }\n                    if (sle32(wave_sizze_50876, skip_threads_50919)) {\n                        barrier(CLK_LOCAL_MEM_FENCE);\n                    }\n                    skip_threads_50919 *= 2;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // last thread of block 'i' writes its result to offset 'i'\n            {\n                if ((local_tid_50874 - squot32(local_tid_50874, 32) * 32) == 31 && ltid_in_bounds_50918) {\n                    ((volatile __local int64_t *) local_mem_50881)[sext_i32_i64(squot32(local_tid_50874, 32))] = eta_p_50911;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // scan the first block, after which offset 'i' contains carry-in for block 'i+1'\n            {\n                int32_t skip_threads_50921;\n                \n                // read input for in-block scan\n                {\n                    if (squot32(local_tid_50874, 32) == 0 && ltid_in_bounds_50918) {\n                        eta_p_50916 = ((volatile __local int64_t *) local_mem_50881)[sext_i32_i64(local_tid_50874)];\n                        if ((local_tid_50874 - squot32(local_tid_50874, 32) * 32) == 0) {\n                            eta_p_50915 = eta_p_50916;\n                        }\n                    }\n                }\n                // in-block scan (hopefully no barriers needed)\n                {\n                    skip_threads_50921 = 1;\n                    while (slt32(skip_threads_50921, 32)) {\n                        bool thread_active_50922 = sle32(skip_threads_50921, local_tid_50874 - squot32(local_tid_50874, 32) * 32) && (squot32(local_tid_50874, 32) == 0 && ltid_in_bounds_50918);\n                        \n                        if (thread_active_50922) {\n                            // read operands\n                            {\n                                eta_p_50915 = (", "(volatile __local int64_t *) local_mem_50881)[sext_i32_i64(local_tid_50874) - sext_i32_i64(skip_threads_50921)];\n                            }\n                        }\n                        // perform operation\n                        {\n                            if (thread_active_50922) {\n                                int64_t defunc_0_op_res_50917 = add64(eta_p_50915, eta_p_50916);\n                                \n                                eta_p_50915 = defunc_0_op_res_50917;\n                            }\n                        }\n                        if (sle32(wave_sizze_50876, skip_threads_50921)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        if (thread_active_50922) {\n                            // write result\n                            {\n                                ((volatile __local int64_t *) local_mem_50881)[sext_i32_i64(local_tid_50874)] = eta_p_50915;\n                                eta_p_50916 = eta_p_50915;\n                            }\n                        }\n                        if (sle32(wave_sizze_50876, skip_threads_50921)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        skip_threads_50921 *= 2;\n                    }\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            \n            bool no_carry_in_50923 = squot32(local_tid_50874, 32) == 0 || !ltid_in_bounds_50918;\n            \n            // carry-in for every block except the first\n            {\n                // read operands\n                {\n                    if (!no_carry_in_50923) {\n                        eta_p_50912 = eta_p_50911;\n                        eta_p_50911 = ((__local int64_t *) local_mem_50881)[sext_i32_i64(squot32(local_tid_50874, 32)) - (int64_t) 1];\n                    }\n                }\n                // perform operation\n                {\n                    if (!no_carry_in_50923) {\n    ", "                    int64_t defunc_0_op_res_50913 = add64(eta_p_50911, eta_p_50912);\n                        \n                        eta_p_50911 = defunc_0_op_res_50913;\n                    }\n                }\n                // write final result\n                {\n                    if (!no_carry_in_50923) {\n                        ((__local int64_t *) local_mem_50881)[sext_i32_i64(local_tid_50874)] = eta_p_50911;\n                    }\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // restore correct values for first block\n            {\n                if (squot32(local_tid_50874, 32) == 0 && ltid_in_bounds_50918) {\n                    ((__local int64_t *) local_mem_50881)[sext_i32_i64(local_tid_50874)] = eta_p_50912;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            barrier(CLK_LOCAL_MEM_FENCE);\n            if (local_tid_50874 == 0) {\n                acc_50914 = ((__local int64_t *) local_mem_50881)[segscan_tblock_sizze_44442 - (int64_t) 1];\n            } else {\n                acc_50914 = ((__local int64_t *) local_mem_50881)[sext_i32_i64(local_tid_50874) - (int64_t) 1];\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n        }\n        prefix_50924 = (int64_t) 0;\n        block_new_sgm_50925 = sgm_idx_50893 == (int64_t) 0;\n        // Perform lookback\n        {\n            if (block_new_sgm_50925 && local_tid_50874 == 0) {\n                ((volatile __global int64_t *) incprefixes_mem_50869)[dynamic_id_50891] = acc_50914;\n                mem_fence_global();\n                ((volatile __global int8_t *) status_flags_mem_50865)[dynamic_id_50891] = (int8_t) 2;\n                acc_50914 = (int64_t) 0;\n            }\n            if (!block_new_sgm_50925 && slt32(local_tid_50874, wave_sizze_50876)) {\n                if (local_tid_50874 == 0) {\n                    ((volatile __global int64_t *) aggregates_mem_50867)[dynamic_id_50891] = acc_50914;\n                    mem_fence_global();\n   ",
                                    "                 ((volatile __global int8_t *) status_flags_mem_50865)[dynamic_id_50891] = (int8_t) 1;\n                    \n                    int8_t tmp_50926 = ((volatile __global int8_t *) status_flags_mem_50865)[dynamic_id_50891 - (int64_t) 1];\n                    \n                    ((volatile __local int8_t *) local_mem_50881)[(int64_t) 0] = tmp_50926;\n                }\n                mem_fence_local();\n                \n                int8_t status_50927 = ((__local int8_t *) local_mem_50881)[(int64_t) 0];\n                \n                if (status_50927 == (int8_t) 2) {\n                    if (local_tid_50874 == 0) {\n                        prefix_50924 = ((volatile __global int64_t *) incprefixes_mem_50869)[dynamic_id_50891 - (int64_t) 1];\n                    }\n                } else {\n                    int32_t readOffset_50928 = sext_i64_i32(dynamic_id_50891 - sext_i32_i64(wave_sizze_50876));\n                    \n                    while (slt32(wave_sizze_50876 * -1, readOffset_50928)) {\n                        int32_t read_i_50929 = readOffset_50928 + local_tid_50874;\n                        int64_t aggr_50930 = (int64_t) 0;\n                        int8_t flag_50931 = (int8_t) 0;\n                        \n                        if (sle32(0, read_i_50929)) {\n                            flag_50931 = ((volatile __global int8_t *) status_flags_mem_50865)[sext_i32_i64(read_i_50929)];\n                            if (flag_50931 == (int8_t) 2) {\n                                aggr_50930 = ((volatile __global int64_t *) incprefixes_mem_50869)[sext_i32_i64(read_i_50929)];\n                            } else if (flag_50931 == (int8_t) 1) {\n                                aggr_50930 = ((volatile __global int64_t *) aggregates_mem_50867)[sext_i32_i64(read_i_50929)];\n                            }\n                        }\n                        ((__local int64_t *) local_mem_50881)[(int64_t) 4 + sext_i32_i64(local_tid_50874)] = aggr_50930;\n                     ", "   ((__local int8_t *) local_mem_50881)[sext_i32_i64(local_tid_50874)] = flag_50931;\n                        flag_50931 = ((__local int8_t *) local_mem_50881)[sext_i32_i64(wave_sizze_50876) - (int64_t) 1];\n                        if (slt8(flag_50931, (int8_t) 2)) {\n                            int8_t flg_x_50935;\n                            int8_t flg_y_50936;\n                            int64_t eta_p_50932;\n                            int64_t eta_p_50933;\n                            int32_t skip_threads_50937;\n                            \n                            // read input for in-block scan\n                            {\n                                flg_y_50936 = ((volatile __local int8_t *) local_mem_50881)[sext_i32_i64(local_tid_50874)];\n                                eta_p_50933 = ((volatile __local int64_t *) local_mem_50881)[(int64_t) 4 + sext_i32_i64(local_tid_50874)];\n                                if ((local_tid_50874 - squot32(local_tid_50874, 32) * 32) == 0) {\n                                    eta_p_50932 = eta_p_50933;\n                                    flg_x_50935 = flg_y_50936;\n                                }\n                            }\n                            // in-block scan (hopefully no barriers needed)\n                            {\n                                skip_threads_50937 = 1;\n                                while (slt32(skip_threads_50937, 32)) {\n                                    if (sle32(skip_threads_50937, local_tid_50874 - squot32(local_tid_50874, 32) * 32)) {\n                                        // read operands\n                                        {\n                                            flg_x_50935 = ((volatile __local int8_t *) local_mem_50881)[sext_i32_i64(local_tid_50874) - sext_i32_i64(skip_threads_50937)];\n                                            eta_p_50932 = ((volatile __local int64_t *) local_mem_50881)[(int64_t) 4 + (sext_i32_i64(local_tid_50874) - sext_i32_i64(skip_threads_50937))];\n", "                                        }\n                                        // perform operation\n                                        {\n                                            if (flg_y_50936 == (int8_t) 2 || flg_y_50936 == (int8_t) 0) {\n                                                flg_x_50935 = flg_y_50936;\n                                                eta_p_50932 = eta_p_50933;\n                                            } else {\n                                                int64_t defunc_0_op_res_50934 = add64(eta_p_50932, eta_p_50933);\n                                                \n                                                eta_p_50932 = defunc_0_op_res_50934;\n                                            }\n                                        }\n                                        // write result\n                                        {\n                                            ((volatile __local int8_t *) local_mem_50881)[sext_i32_i64(local_tid_50874)] = flg_x_50935;\n                                            flg_y_50936 = flg_x_50935;\n                                            ((volatile __local int64_t *) local_mem_50881)[(int64_t) 4 + sext_i32_i64(local_tid_50874)] = eta_p_50932;\n                                            eta_p_50933 = eta_p_50932;\n                                        }\n                                    }\n                                    skip_threads_50937 *= 2;\n                                }\n                            }\n                        }\n                        flag_50931 = ((__local int8_t *) local_mem_50881)[sext_i32_i64(wave_sizze_50876) - (int64_t) 1];\n                        aggr_50930 = ((__local int64_t *) local_mem_50881)[(int64_t) 4 + (sext_i32_i64(wave_sizze_50876) - (int64_t) 1)];\n                        if (flag_50931 == (int8_t) 2) {\n                            readOffset_50928 = wave_sizze_50876 * -1;\n                        } else if (flag_50931 == (int8_t) 1) {\n     ",
                                    "                       readOffset_50928 -= wave_sizze_50876;\n                        }\n                        if (slt8((int8_t) 0, flag_50931)) {\n                            int64_t eta_p_50938 = aggr_50930;\n                            int64_t eta_p_50939 = prefix_50924;\n                            int64_t defunc_0_op_res_50940 = add64(eta_p_50938, eta_p_50939);\n                            \n                            prefix_50924 = defunc_0_op_res_50940;\n                        }\n                        mem_fence_local();\n                    }\n                }\n                if (local_tid_50874 == 0) {\n                    if (boundary_50894 == sext_i64_i32(segscan_tblock_sizze_44442 * chunk_sizze_50862)) {\n                        int64_t eta_p_50941 = prefix_50924;\n                        int64_t eta_p_50942 = acc_50914;\n                        int64_t defunc_0_op_res_50943 = add64(eta_p_50941, eta_p_50942);\n                        \n                        ((volatile __global int64_t *) incprefixes_mem_50869)[dynamic_id_50891] = defunc_0_op_res_50943;\n                        mem_fence_global();\n                        ((volatile __global int8_t *) status_flags_mem_50865)[dynamic_id_50891] = (int8_t) 2;\n                    }\n                    ((__local int64_t *) local_mem_50881)[(int64_t) 4] = prefix_50924;\n                    acc_50914 = (int64_t) 0;\n                }\n            }\n            if (!(dynamic_id_50891 == (int64_t) 0)) {\n                barrier(CLK_LOCAL_MEM_FENCE);\n                prefix_50924 = ((__local int64_t *) local_mem_50881)[(int64_t) 4];\n                barrier(CLK_LOCAL_MEM_FENCE);\n            }\n        }\n        // Distribute results\n        {\n            int64_t eta_p_50944;\n            int64_t eta_p_50945;\n            int64_t eta_p_50947 = prefix_50924;\n            int64_t eta_p_50948 = acc_50914;\n            \n            if (slt32(local_tid_50874 * chunk_sizze_32b_50878, boundary_50894) && !block_new_sgm_50925) {\n                i", "nt64_t defunc_0_op_res_50949 = add64(eta_p_50947, eta_p_50948);\n                \n                eta_p_50944 = defunc_0_op_res_50949;\n            } else {\n                eta_p_50944 = acc_50914;\n            }\n            \n            int32_t stopping_point_50950 = segsizze_compact_50895 - srem32(local_tid_50874 * chunk_sizze_32b_50878 - 1 + segsizze_compact_50895 - boundary_50894, segsizze_compact_50895);\n            \n            for (int64_t i_50951 = 0; i_50951 < chunk_sizze_50862; i_50951++) {\n                if (slt32(sext_i64_i32(i_50951), stopping_point_50950 - 1)) {\n                    eta_p_50945 = private_mem_50896[i_50951];\n                    \n                    int64_t defunc_0_op_res_50946 = add64(eta_p_50944, eta_p_50945);\n                    \n                    private_mem_50896[i_50951] = defunc_0_op_res_50946;\n                }\n            }\n        }\n        // Transpose scan output and Write it to global memory in coalesced fashion\n        {\n            for (int64_t i_50952 = 0; i_50952 < chunk_sizze_50862; i_50952++) {\n                int64_t sharedIdx_50953 = sext_i32_i64(local_tid_50874) * chunk_sizze_50862 + i_50952;\n                int64_t tmp_50954 = private_mem_50896[i_50952];\n                \n                ((__local int64_t *) local_mem_50881)[sharedIdx_50953] = tmp_50954;\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            for (int64_t i_50955 = 0; i_50955 < chunk_sizze_50862; i_50955++) {\n                int64_t flat_idx_50956 = thd_offset_50898 + i_50955 * segscan_tblock_sizze_44442;\n                int64_t slice_50957 = n_34757;\n                int64_t gtid_44446 = flat_idx_50956;\n                int64_t remnant_50958 = flat_idx_50956 - gtid_44446;\n                \n                if (slt64(flat_idx_50956, n_34757)) {\n                    int64_t tmp_50959 = ((__local int64_t *) local_mem_50881)[flat_idx_50956 - block_offset_50892];\n                    \n                    ((__global int64_t *) mem_49490)[gtid_44446", "] = tmp_50959;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n        }\n    }\n    \n  error_3:\n    return;\n    #undef segscan_tblock_sizze_44442\n    #undef chunk_sizze_50862\n}\nFUTHARK_KERNEL_SIZED(do_DBSCAN_doublezisegscan_44463_dim1, 1, 1)\nvoid do_DBSCAN_doublezisegscan_44463(__global int *global_failure, int64_t m_41485, int64_t conc_tmp_41556, int64_t num_tblocks_44460, int64_t num_virt_blocks_50980, int64_t num_virt_threads_50981, __global unsigned char *mem_49478, __global unsigned char *mem_49496, __global unsigned char *mem_49506, __global unsigned char *mem_49508, __global unsigned char *status_flags_mem_50982, __global unsigned char *aggregates_mem_50984, __global unsigned char *incprefixes_mem_50986, __global unsigned char *global_dynid_mem_50988)\n{\n    #define segscan_tblock_sizze_44458 (do_DBSCAN_doublezisegscan_44463zisegscan_tblock_sizze_44458)\n    #define chunk_sizze_50979 (do_DBSCAN_doublezisegscan_44463zichunk_sizze_50979)\n    \n    volatile __local unsigned char *local_mem_50998_backing_0 = &shared_mem[0];\n    const int64_t local_mem_50998_backing_0_offset = 0 + (smax64(smax64((int64_t) 288, (int64_t) 8 * segscan_tblock_sizze_44458), chunk_sizze_50979 * segscan_tblock_sizze_44458 * (int64_t) 8) + srem64((int64_t) 8 - srem64(smax64(smax64((int64_t) 288, (int64_t) 8 * segscan_tblock_sizze_44458), chunk_sizze_50979 * segscan_tblock_sizze_44458 * (int64_t) 8), (int64_t) 8), (int64_t) 8));\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_50991;\n    int32_t tblock_sizze_50994;\n    int32_t wave_sizze_50993;\n    int32_t block_id_50992;\n    int32_t global_tid_50990;\n    int64_t phys_tid_44463;\n    int32_t chunk_sizze_32b_50995;\n    int64_t byte_offsets_50996;\n    int64_t warp_byte_offset_50997;\n    __local unsigned char *local_mem_50998;\n    int64_t trans_arr_len_50999;\n    int64_t phys_block_id_51005;\n    int64_t virtloop_bound_51006;\n    \n    local_tid_50991 = get_local_id(0);\n    tblock_sizze_50994 = ",
                                    "get_local_size(0);\n    wave_sizze_50993 = LOCKSTEP_WIDTH;\n    block_id_50992 = get_tblock_id(0);\n    global_tid_50990 = block_id_50992 * tblock_sizze_50994 + local_tid_50991;\n    phys_tid_44463 = sext_i32_i64(global_tid_50990);\n    chunk_sizze_32b_50995 = sext_i64_i32(chunk_sizze_50979);\n    byte_offsets_50996 = segscan_tblock_sizze_44458 * (int64_t) 8;\n    warp_byte_offset_50997 = (int64_t) 288;\n    // Allocate reusable shared memory\n    { }\n    local_mem_50998 = (__local unsigned char *) local_mem_50998_backing_0;\n    trans_arr_len_50999 = chunk_sizze_50979 * segscan_tblock_sizze_44458;\n    phys_block_id_51005 = get_tblock_id(0);\n    virtloop_bound_51006 = sdiv_up64(num_virt_blocks_50980 - phys_block_id_51005, num_tblocks_44460);\n    for (int64_t virtloop_i_51007 = 0; virtloop_i_51007 < virtloop_bound_51006; virtloop_i_51007++) {\n        int64_t dynamic_id_51008;\n        int64_t block_offset_51009;\n        int64_t sgm_idx_51010;\n        int32_t boundary_51011;\n        int32_t segsizze_compact_51012;\n        int64_t private_mem_51013[chunk_sizze_50979];\n        int64_t thd_offset_51015;\n        int64_t acc_51031;\n        int64_t prefix_51041;\n        bool block_new_sgm_51042;\n        \n        // First thread in block fetches this block's dynamic_id\n        {\n            if (local_tid_50991 == 0) {\n                dynamic_id_51008 = atomic_add_i32_global(&((volatile __global int *) global_dynid_mem_50988)[(int64_t) 0], (int) 1);\n                // Set dynamic id for this block\n                {\n                    ((__local int64_t *) local_mem_50998)[(int64_t) 0] = dynamic_id_51008;\n                }\n                // First thread in last (virtual) block resets global dynamic_id\n                {\n                    if (dynamic_id_51008 == num_virt_blocks_50980 - (int64_t) 1) {\n                        ((__global int32_t *) global_dynid_mem_50988)[(int64_t) 0] = 0;\n                    }\n                }\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);", "\n        dynamic_id_51008 = ((__local int32_t *) local_mem_50998)[(int64_t) 0];\n        barrier(CLK_LOCAL_MEM_FENCE);\n        block_offset_51009 = dynamic_id_51008 * chunk_sizze_50979 * segscan_tblock_sizze_44458;\n        sgm_idx_51010 = smod64(block_offset_51009, conc_tmp_41556);\n        boundary_51011 = sext_i64_i32(smin64(chunk_sizze_50979 * segscan_tblock_sizze_44458, conc_tmp_41556 - sgm_idx_51010));\n        segsizze_compact_51012 = sext_i64_i32(smin64(chunk_sizze_50979 * segscan_tblock_sizze_44458, conc_tmp_41556));\n        thd_offset_51015 = block_offset_51009 + sext_i32_i64(local_tid_50991);\n        // Load and map\n        {\n            for (int64_t i_51016 = 0; i_51016 < chunk_sizze_50979; i_51016++) {\n                int64_t virt_tid_51017 = thd_offset_51015 + i_51016 * segscan_tblock_sizze_44458;\n                int64_t slice_51018 = conc_tmp_41556;\n                int64_t gtid_44462 = virt_tid_51017;\n                int64_t remnant_51019 = virt_tid_51017 - gtid_44462;\n                \n                if (slt64(virt_tid_51017, conc_tmp_41556)) {\n                    bool index_concat_cmp_46518 = sle64(m_41485, gtid_44462);\n                    int64_t index_concat_branch_46522;\n                    \n                    if (index_concat_cmp_46518) {\n                        int64_t index_concat_i_46519 = sub64(gtid_44462, m_41485);\n                        int64_t index_concat_46520 = ((__global int64_t *) mem_49496)[index_concat_i_46519];\n                        \n                        index_concat_branch_46522 = index_concat_46520;\n                    } else {\n                        int64_t index_concat_46521 = ((__global int64_t *) mem_49478)[gtid_44462];\n                        \n                        index_concat_branch_46522 = index_concat_46521;\n                    }\n                    \n                    bool lifted_lambda_res_42265 = sle64((int64_t) 0, index_concat_branch_46522);\n                    int64_t defunc_0_f_res_42266 = btoi_bool_i64(lif", "ted_lambda_res_42265);\n                    \n                    ((__global int64_t *) mem_49508)[gtid_44462] = defunc_0_f_res_42266;\n                    private_mem_51013[i_51016] = defunc_0_f_res_42266;\n                } else {\n                    private_mem_51013[i_51016] = (int64_t) 0;\n                }\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        // Transpose scan inputs\n        {\n            for (int64_t i_51020 = 0; i_51020 < chunk_sizze_50979; i_51020++) {\n                int64_t sharedIdx_51021 = sext_i32_i64(local_tid_50991) + i_51020 * segscan_tblock_sizze_44458;\n                int64_t tmp_51022 = private_mem_51013[i_51020];\n                \n                ((__local int64_t *) local_mem_50998)[sharedIdx_51021] = tmp_51022;\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            for (int64_t i_51023 = 0; i_51023 < chunk_sizze_50979; i_51023++) {\n                int64_t sharedIdx_51024 = sext_i32_i64(local_tid_50991) * chunk_sizze_50979 + i_51023;\n                int64_t tmp_51025 = ((__local int64_t *) local_mem_50998)[sharedIdx_51024];\n                \n                private_mem_51013[i_51023] = tmp_51025;\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n        }\n        // Per thread scan\n        {\n            for (int64_t i_51026 = 0; i_51026 < chunk_sizze_50979 - (int64_t) 1; i_51026++) {\n                int64_t eta_p_41729;\n                int64_t eta_p_41730;\n                \n                eta_p_41729 = private_mem_51013[i_51026];\n                eta_p_41730 = private_mem_51013[i_51026 + (int64_t) 1];\n                \n                int64_t defunc_0_op_res_41731 = add64(eta_p_41729, eta_p_41730);\n                \n                private_mem_51013[i_51026 + (int64_t) 1] = defunc_0_op_res_41731;\n            }\n        }\n        // Publish results in shared memory\n        {\n            int64_t tmp_51027 = private_mem_51013[chunk_sizze_50979 - (int64_t) 1];\n            \n            ((__local int64_t *) lo",
                                    "cal_mem_50998)[sext_i32_i64(local_tid_50991)] = tmp_51027;\n            barrier(CLK_LOCAL_MEM_FENCE);\n        }\n        // Scan results (with warp scan)\n        {\n            int64_t eta_p_51028;\n            int64_t eta_p_51029;\n            int64_t eta_p_51032;\n            int64_t eta_p_51033;\n            bool ltid_in_bounds_51035 = slt64(sext_i32_i64(local_tid_50991), num_virt_threads_50981);\n            int32_t skip_threads_51036;\n            \n            // read input for in-block scan\n            {\n                if (ltid_in_bounds_51035) {\n                    eta_p_51029 = ((volatile __local int64_t *) local_mem_50998)[sext_i32_i64(local_tid_50991)];\n                    if ((local_tid_50991 - squot32(local_tid_50991, 32) * 32) == 0) {\n                        eta_p_51028 = eta_p_51029;\n                    }\n                }\n            }\n            // in-block scan (hopefully no barriers needed)\n            {\n                skip_threads_51036 = 1;\n                while (slt32(skip_threads_51036, 32)) {\n                    bool thread_active_51037 = sle32(skip_threads_51036, local_tid_50991 - squot32(local_tid_50991, 32) * 32) && ltid_in_bounds_51035;\n                    \n                    if (thread_active_51037) {\n                        // read operands\n                        {\n                            eta_p_51028 = ((volatile __local int64_t *) local_mem_50998)[sext_i32_i64(local_tid_50991) - sext_i32_i64(skip_threads_51036)];\n                        }\n                    }\n                    // perform operation\n                    {\n                        if (thread_active_51037) {\n                            int64_t defunc_0_op_res_51030 = add64(eta_p_51028, eta_p_51029);\n                            \n                            eta_p_51028 = defunc_0_op_res_51030;\n                        }\n                    }\n                    if (sle32(wave_sizze_50993, skip_threads_51036)) {\n                        barrier(CLK_LOCAL_MEM_FENCE);\n           ", "         }\n                    if (thread_active_51037) {\n                        // write result\n                        {\n                            ((volatile __local int64_t *) local_mem_50998)[sext_i32_i64(local_tid_50991)] = eta_p_51028;\n                            eta_p_51029 = eta_p_51028;\n                        }\n                    }\n                    if (sle32(wave_sizze_50993, skip_threads_51036)) {\n                        barrier(CLK_LOCAL_MEM_FENCE);\n                    }\n                    skip_threads_51036 *= 2;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // last thread of block 'i' writes its result to offset 'i'\n            {\n                if ((local_tid_50991 - squot32(local_tid_50991, 32) * 32) == 31 && ltid_in_bounds_51035) {\n                    ((volatile __local int64_t *) local_mem_50998)[sext_i32_i64(squot32(local_tid_50991, 32))] = eta_p_51028;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // scan the first block, after which offset 'i' contains carry-in for block 'i+1'\n            {\n                int32_t skip_threads_51038;\n                \n                // read input for in-block scan\n                {\n                    if (squot32(local_tid_50991, 32) == 0 && ltid_in_bounds_51035) {\n                        eta_p_51033 = ((volatile __local int64_t *) local_mem_50998)[sext_i32_i64(local_tid_50991)];\n                        if ((local_tid_50991 - squot32(local_tid_50991, 32) * 32) == 0) {\n                            eta_p_51032 = eta_p_51033;\n                        }\n                    }\n                }\n                // in-block scan (hopefully no barriers needed)\n                {\n                    skip_threads_51038 = 1;\n                    while (slt32(skip_threads_51038, 32)) {\n                        bool thread_active_51039 = sle32(skip_threads_51038, local_tid_50991 - squot32(local_tid_50991, 32) * 32) && (squot32(local_tid_50991, ", "32) == 0 && ltid_in_bounds_51035);\n                        \n                        if (thread_active_51039) {\n                            // read operands\n                            {\n                                eta_p_51032 = ((volatile __local int64_t *) local_mem_50998)[sext_i32_i64(local_tid_50991) - sext_i32_i64(skip_threads_51038)];\n                            }\n                        }\n                        // perform operation\n                        {\n                            if (thread_active_51039) {\n                                int64_t defunc_0_op_res_51034 = add64(eta_p_51032, eta_p_51033);\n                                \n                                eta_p_51032 = defunc_0_op_res_51034;\n                            }\n                        }\n                        if (sle32(wave_sizze_50993, skip_threads_51038)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        if (thread_active_51039) {\n                            // write result\n                            {\n                                ((volatile __local int64_t *) local_mem_50998)[sext_i32_i64(local_tid_50991)] = eta_p_51032;\n                                eta_p_51033 = eta_p_51032;\n                            }\n                        }\n                        if (sle32(wave_sizze_50993, skip_threads_51038)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        skip_threads_51038 *= 2;\n                    }\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            \n            bool no_carry_in_51040 = squot32(local_tid_50991, 32) == 0 || !ltid_in_bounds_51035;\n            \n            // carry-in for every block except the first\n            {\n                // read operands\n                {\n                    if (!no_carry_in_51040) {\n                        eta_p_51029 = eta_p_51028;\n                        eta_p_51028 = ((__local",
                                    " int64_t *) local_mem_50998)[sext_i32_i64(squot32(local_tid_50991, 32)) - (int64_t) 1];\n                    }\n                }\n                // perform operation\n                {\n                    if (!no_carry_in_51040) {\n                        int64_t defunc_0_op_res_51030 = add64(eta_p_51028, eta_p_51029);\n                        \n                        eta_p_51028 = defunc_0_op_res_51030;\n                    }\n                }\n                // write final result\n                {\n                    if (!no_carry_in_51040) {\n                        ((__local int64_t *) local_mem_50998)[sext_i32_i64(local_tid_50991)] = eta_p_51028;\n                    }\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // restore correct values for first block\n            {\n                if (squot32(local_tid_50991, 32) == 0 && ltid_in_bounds_51035) {\n                    ((__local int64_t *) local_mem_50998)[sext_i32_i64(local_tid_50991)] = eta_p_51029;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            barrier(CLK_LOCAL_MEM_FENCE);\n            if (local_tid_50991 == 0) {\n                acc_51031 = ((__local int64_t *) local_mem_50998)[segscan_tblock_sizze_44458 - (int64_t) 1];\n            } else {\n                acc_51031 = ((__local int64_t *) local_mem_50998)[sext_i32_i64(local_tid_50991) - (int64_t) 1];\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n        }\n        prefix_51041 = (int64_t) 0;\n        block_new_sgm_51042 = sgm_idx_51010 == (int64_t) 0;\n        // Perform lookback\n        {\n            if (block_new_sgm_51042 && local_tid_50991 == 0) {\n                ((volatile __global int64_t *) incprefixes_mem_50986)[dynamic_id_51008] = acc_51031;\n                mem_fence_global();\n                ((volatile __global int8_t *) status_flags_mem_50982)[dynamic_id_51008] = (int8_t) 2;\n                acc_51031 = (int64_t) 0;\n            }\n            if (!block_new_sgm_51042 && sl", "t32(local_tid_50991, wave_sizze_50993)) {\n                if (local_tid_50991 == 0) {\n                    ((volatile __global int64_t *) aggregates_mem_50984)[dynamic_id_51008] = acc_51031;\n                    mem_fence_global();\n                    ((volatile __global int8_t *) status_flags_mem_50982)[dynamic_id_51008] = (int8_t) 1;\n                    \n                    int8_t tmp_51043 = ((volatile __global int8_t *) status_flags_mem_50982)[dynamic_id_51008 - (int64_t) 1];\n                    \n                    ((volatile __local int8_t *) local_mem_50998)[(int64_t) 0] = tmp_51043;\n                }\n                mem_fence_local();\n                \n                int8_t status_51044 = ((__local int8_t *) local_mem_50998)[(int64_t) 0];\n                \n                if (status_51044 == (int8_t) 2) {\n                    if (local_tid_50991 == 0) {\n                        prefix_51041 = ((volatile __global int64_t *) incprefixes_mem_50986)[dynamic_id_51008 - (int64_t) 1];\n                    }\n                } else {\n                    int32_t readOffset_51045 = sext_i64_i32(dynamic_id_51008 - sext_i32_i64(wave_sizze_50993));\n                    \n                    while (slt32(wave_sizze_50993 * -1, readOffset_51045)) {\n                        int32_t read_i_51046 = readOffset_51045 + local_tid_50991;\n                        int64_t aggr_51047 = (int64_t) 0;\n                        int8_t flag_51048 = (int8_t) 0;\n                        \n                        if (sle32(0, read_i_51046)) {\n                            flag_51048 = ((volatile __global int8_t *) status_flags_mem_50982)[sext_i32_i64(read_i_51046)];\n                            if (flag_51048 == (int8_t) 2) {\n                                aggr_51047 = ((volatile __global int64_t *) incprefixes_mem_50986)[sext_i32_i64(read_i_51046)];\n                            } else if (flag_51048 == (int8_t) 1) {\n                                aggr_51047 = ((volatile __global int64_t *) aggregates_mem_5", "0984)[sext_i32_i64(read_i_51046)];\n                            }\n                        }\n                        ((__local int64_t *) local_mem_50998)[(int64_t) 4 + sext_i32_i64(local_tid_50991)] = aggr_51047;\n                        ((__local int8_t *) local_mem_50998)[sext_i32_i64(local_tid_50991)] = flag_51048;\n                        flag_51048 = ((__local int8_t *) local_mem_50998)[sext_i32_i64(wave_sizze_50993) - (int64_t) 1];\n                        if (slt8(flag_51048, (int8_t) 2)) {\n                            int8_t flg_x_51052;\n                            int8_t flg_y_51053;\n                            int64_t eta_p_51049;\n                            int64_t eta_p_51050;\n                            int32_t skip_threads_51054;\n                            \n                            // read input for in-block scan\n                            {\n                                flg_y_51053 = ((volatile __local int8_t *) local_mem_50998)[sext_i32_i64(local_tid_50991)];\n                                eta_p_51050 = ((volatile __local int64_t *) local_mem_50998)[(int64_t) 4 + sext_i32_i64(local_tid_50991)];\n                                if ((local_tid_50991 - squot32(local_tid_50991, 32) * 32) == 0) {\n                                    eta_p_51049 = eta_p_51050;\n                                    flg_x_51052 = flg_y_51053;\n                                }\n                            }\n                            // in-block scan (hopefully no barriers needed)\n                            {\n                                skip_threads_51054 = 1;\n                                while (slt32(skip_threads_51054, 32)) {\n                                    if (sle32(skip_threads_51054, local_tid_50991 - squot32(local_tid_50991, 32) * 32)) {\n                                        // read operands\n                                        {\n                                            flg_x_51052 = ((volatile __local int8_t *) local_mem_50998)[sext_i32_i64(local_tid",
                                    "_50991) - sext_i32_i64(skip_threads_51054)];\n                                            eta_p_51049 = ((volatile __local int64_t *) local_mem_50998)[(int64_t) 4 + (sext_i32_i64(local_tid_50991) - sext_i32_i64(skip_threads_51054))];\n                                        }\n                                        // perform operation\n                                        {\n                                            if (flg_y_51053 == (int8_t) 2 || flg_y_51053 == (int8_t) 0) {\n                                                flg_x_51052 = flg_y_51053;\n                                                eta_p_51049 = eta_p_51050;\n                                            } else {\n                                                int64_t defunc_0_op_res_51051 = add64(eta_p_51049, eta_p_51050);\n                                                \n                                                eta_p_51049 = defunc_0_op_res_51051;\n                                            }\n                                        }\n                                        // write result\n                                        {\n                                            ((volatile __local int8_t *) local_mem_50998)[sext_i32_i64(local_tid_50991)] = flg_x_51052;\n                                            flg_y_51053 = flg_x_51052;\n                                            ((volatile __local int64_t *) local_mem_50998)[(int64_t) 4 + sext_i32_i64(local_tid_50991)] = eta_p_51049;\n                                            eta_p_51050 = eta_p_51049;\n                                        }\n                                    }\n                                    skip_threads_51054 *= 2;\n                                }\n                            }\n                        }\n                        flag_51048 = ((__local int8_t *) local_mem_50998)[sext_i32_i64(wave_sizze_50993) - (int64_t) 1];\n                        aggr_51047 = ((__local int64_t *) local_mem_50998)[(int64_t) 4 + (sext_i32_", "i64(wave_sizze_50993) - (int64_t) 1)];\n                        if (flag_51048 == (int8_t) 2) {\n                            readOffset_51045 = wave_sizze_50993 * -1;\n                        } else if (flag_51048 == (int8_t) 1) {\n                            readOffset_51045 -= wave_sizze_50993;\n                        }\n                        if (slt8((int8_t) 0, flag_51048)) {\n                            int64_t eta_p_51055 = aggr_51047;\n                            int64_t eta_p_51056 = prefix_51041;\n                            int64_t defunc_0_op_res_51057 = add64(eta_p_51055, eta_p_51056);\n                            \n                            prefix_51041 = defunc_0_op_res_51057;\n                        }\n                        mem_fence_local();\n                    }\n                }\n                if (local_tid_50991 == 0) {\n                    if (boundary_51011 == sext_i64_i32(segscan_tblock_sizze_44458 * chunk_sizze_50979)) {\n                        int64_t eta_p_51058 = prefix_51041;\n                        int64_t eta_p_51059 = acc_51031;\n                        int64_t defunc_0_op_res_51060 = add64(eta_p_51058, eta_p_51059);\n                        \n                        ((volatile __global int64_t *) incprefixes_mem_50986)[dynamic_id_51008] = defunc_0_op_res_51060;\n                        mem_fence_global();\n                        ((volatile __global int8_t *) status_flags_mem_50982)[dynamic_id_51008] = (int8_t) 2;\n                    }\n                    ((__local int64_t *) local_mem_50998)[(int64_t) 4] = prefix_51041;\n                    acc_51031 = (int64_t) 0;\n                }\n            }\n            if (!(dynamic_id_51008 == (int64_t) 0)) {\n                barrier(CLK_LOCAL_MEM_FENCE);\n                prefix_51041 = ((__local int64_t *) local_mem_50998)[(int64_t) 4];\n                barrier(CLK_LOCAL_MEM_FENCE);\n            }\n        }\n        // Distribute results\n        {\n            int64_t eta_p_51061;\n            int64_t eta_p_510", "62;\n            int64_t eta_p_51064 = prefix_51041;\n            int64_t eta_p_51065 = acc_51031;\n            \n            if (slt32(local_tid_50991 * chunk_sizze_32b_50995, boundary_51011) && !block_new_sgm_51042) {\n                int64_t defunc_0_op_res_51066 = add64(eta_p_51064, eta_p_51065);\n                \n                eta_p_51061 = defunc_0_op_res_51066;\n            } else {\n                eta_p_51061 = acc_51031;\n            }\n            \n            int32_t stopping_point_51067 = segsizze_compact_51012 - srem32(local_tid_50991 * chunk_sizze_32b_50995 - 1 + segsizze_compact_51012 - boundary_51011, segsizze_compact_51012);\n            \n            for (int64_t i_51068 = 0; i_51068 < chunk_sizze_50979; i_51068++) {\n                if (slt32(sext_i64_i32(i_51068), stopping_point_51067 - 1)) {\n                    eta_p_51062 = private_mem_51013[i_51068];\n                    \n                    int64_t defunc_0_op_res_51063 = add64(eta_p_51061, eta_p_51062);\n                    \n                    private_mem_51013[i_51068] = defunc_0_op_res_51063;\n                }\n            }\n        }\n        // Transpose scan output and Write it to global memory in coalesced fashion\n        {\n            for (int64_t i_51069 = 0; i_51069 < chunk_sizze_50979; i_51069++) {\n                int64_t sharedIdx_51070 = sext_i32_i64(local_tid_50991) * chunk_sizze_50979 + i_51069;\n                int64_t tmp_51071 = private_mem_51013[i_51069];\n                \n                ((__local int64_t *) local_mem_50998)[sharedIdx_51070] = tmp_51071;\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            for (int64_t i_51072 = 0; i_51072 < chunk_sizze_50979; i_51072++) {\n                int64_t flat_idx_51073 = thd_offset_51015 + i_51072 * segscan_tblock_sizze_44458;\n                int64_t slice_51074 = conc_tmp_41556;\n                int64_t gtid_44462 = flat_idx_51073;\n                int64_t remnant_51075 = flat_idx_51073 - gtid_44462;\n                \n              ",
                                    "  if (slt64(flat_idx_51073, conc_tmp_41556)) {\n                    int64_t tmp_51076 = ((__local int64_t *) local_mem_50998)[flat_idx_51073 - block_offset_51009];\n                    \n                    ((__global int64_t *) mem_49506)[gtid_44462] = tmp_51076;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n        }\n    }\n    \n  error_3:\n    return;\n    #undef segscan_tblock_sizze_44458\n    #undef chunk_sizze_50979\n}\nFUTHARK_KERNEL_SIZED(do_DBSCAN_doublezisegscan_44723_dim1, 1, 1)\nvoid do_DBSCAN_doublezisegscan_44723(__global int *global_failure, int64_t conc_tmp_41556, int64_t num_tblocks_44720, int64_t num_virt_blocks_51223, int64_t num_virt_threads_51224, __global unsigned char *ext_mem_49595, __global unsigned char *mem_49598, __global unsigned char *status_flags_mem_51225, __global unsigned char *aggregates_mem_51227, __global unsigned char *incprefixes_mem_51229, __global unsigned char *global_dynid_mem_51231)\n{\n    #define segscan_tblock_sizze_44718 (do_DBSCAN_doublezisegscan_44723zisegscan_tblock_sizze_44718)\n    #define chunk_sizze_51222 (do_DBSCAN_doublezisegscan_44723zichunk_sizze_51222)\n    \n    volatile __local unsigned char *local_mem_51241_backing_0 = &shared_mem[0];\n    const int64_t local_mem_51241_backing_0_offset = 0 + (smax64(smax64((int64_t) 288, (int64_t) 8 * segscan_tblock_sizze_44718), chunk_sizze_51222 * segscan_tblock_sizze_44718 * (int64_t) 8) + srem64((int64_t) 8 - srem64(smax64(smax64((int64_t) 288, (int64_t) 8 * segscan_tblock_sizze_44718), chunk_sizze_51222 * segscan_tblock_sizze_44718 * (int64_t) 8), (int64_t) 8), (int64_t) 8));\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_51234;\n    int32_t tblock_sizze_51237;\n    int32_t wave_sizze_51236;\n    int32_t block_id_51235;\n    int32_t global_tid_51233;\n    int64_t phys_tid_44723;\n    int32_t chunk_sizze_32b_51238;\n    int64_t byte_offsets_51239;\n    int64_t warp_byte_offset_51240;\n    __local unsigned char *local_mem_51241;\n    i", "nt64_t trans_arr_len_51242;\n    int64_t phys_block_id_51248;\n    int64_t virtloop_bound_51249;\n    \n    local_tid_51234 = get_local_id(0);\n    tblock_sizze_51237 = get_local_size(0);\n    wave_sizze_51236 = LOCKSTEP_WIDTH;\n    block_id_51235 = get_tblock_id(0);\n    global_tid_51233 = block_id_51235 * tblock_sizze_51237 + local_tid_51234;\n    phys_tid_44723 = sext_i32_i64(global_tid_51233);\n    chunk_sizze_32b_51238 = sext_i64_i32(chunk_sizze_51222);\n    byte_offsets_51239 = segscan_tblock_sizze_44718 * (int64_t) 8;\n    warp_byte_offset_51240 = (int64_t) 288;\n    // Allocate reusable shared memory\n    { }\n    local_mem_51241 = (__local unsigned char *) local_mem_51241_backing_0;\n    trans_arr_len_51242 = chunk_sizze_51222 * segscan_tblock_sizze_44718;\n    phys_block_id_51248 = get_tblock_id(0);\n    virtloop_bound_51249 = sdiv_up64(num_virt_blocks_51223 - phys_block_id_51248, num_tblocks_44720);\n    for (int64_t virtloop_i_51250 = 0; virtloop_i_51250 < virtloop_bound_51249; virtloop_i_51250++) {\n        int64_t dynamic_id_51251;\n        int64_t block_offset_51252;\n        int64_t sgm_idx_51253;\n        int32_t boundary_51254;\n        int32_t segsizze_compact_51255;\n        int64_t private_mem_51256[chunk_sizze_51222];\n        int64_t thd_offset_51258;\n        int64_t acc_51274;\n        int64_t prefix_51284;\n        bool block_new_sgm_51285;\n        \n        // First thread in block fetches this block's dynamic_id\n        {\n            if (local_tid_51234 == 0) {\n                dynamic_id_51251 = atomic_add_i32_global(&((volatile __global int *) global_dynid_mem_51231)[(int64_t) 0], (int) 1);\n                // Set dynamic id for this block\n                {\n                    ((__local int64_t *) local_mem_51241)[(int64_t) 0] = dynamic_id_51251;\n                }\n                // First thread in last (virtual) block resets global dynamic_id\n                {\n                    if (dynamic_id_51251 == num_virt_blocks_51223 - (int64_t) 1) {\n                        (", "(__global int32_t *) global_dynid_mem_51231)[(int64_t) 0] = 0;\n                    }\n                }\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        dynamic_id_51251 = ((__local int32_t *) local_mem_51241)[(int64_t) 0];\n        barrier(CLK_LOCAL_MEM_FENCE);\n        block_offset_51252 = dynamic_id_51251 * chunk_sizze_51222 * segscan_tblock_sizze_44718;\n        sgm_idx_51253 = smod64(block_offset_51252, conc_tmp_41556);\n        boundary_51254 = sext_i64_i32(smin64(chunk_sizze_51222 * segscan_tblock_sizze_44718, conc_tmp_41556 - sgm_idx_51253));\n        segsizze_compact_51255 = sext_i64_i32(smin64(chunk_sizze_51222 * segscan_tblock_sizze_44718, conc_tmp_41556));\n        thd_offset_51258 = block_offset_51252 + sext_i32_i64(local_tid_51234);\n        // Load and map\n        {\n            for (int64_t i_51259 = 0; i_51259 < chunk_sizze_51222; i_51259++) {\n                int64_t virt_tid_51260 = thd_offset_51258 + i_51259 * segscan_tblock_sizze_44718;\n                int64_t slice_51261 = conc_tmp_41556;\n                int64_t gtid_44722 = virt_tid_51260;\n                int64_t remnant_51262 = virt_tid_51260 - gtid_44722;\n                \n                if (slt64(virt_tid_51260, conc_tmp_41556)) {\n                    int64_t eta_p_42283 = ((__global int64_t *) ext_mem_49595)[gtid_44722];\n                    bool defunc_0_f_res_42284 = gtid_44722 == eta_p_42283;\n                    int64_t lifted_lambda_res_42286 = btoi_bool_i64(defunc_0_f_res_42284);\n                    \n                    private_mem_51256[i_51259] = lifted_lambda_res_42286;\n                } else {\n                    private_mem_51256[i_51259] = (int64_t) 0;\n                }\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        // Transpose scan inputs\n        {\n            for (int64_t i_51263 = 0; i_51263 < chunk_sizze_51222; i_51263++) {\n                int64_t sharedIdx_51264 = sext_i32_i64(local_tid_51234) + i_51263 * segscan_tblock_sizze_44718;\n        ",
                                    "        int64_t tmp_51265 = private_mem_51256[i_51263];\n                \n                ((__local int64_t *) local_mem_51241)[sharedIdx_51264] = tmp_51265;\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            for (int64_t i_51266 = 0; i_51266 < chunk_sizze_51222; i_51266++) {\n                int64_t sharedIdx_51267 = sext_i32_i64(local_tid_51234) * chunk_sizze_51222 + i_51266;\n                int64_t tmp_51268 = ((__local int64_t *) local_mem_51241)[sharedIdx_51267];\n                \n                private_mem_51256[i_51266] = tmp_51268;\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n        }\n        // Per thread scan\n        {\n            for (int64_t i_51269 = 0; i_51269 < chunk_sizze_51222 - (int64_t) 1; i_51269++) {\n                int64_t eta_p_41677;\n                int64_t eta_p_41678;\n                \n                eta_p_41677 = private_mem_51256[i_51269];\n                eta_p_41678 = private_mem_51256[i_51269 + (int64_t) 1];\n                \n                int64_t defunc_0_op_res_41679 = add64(eta_p_41677, eta_p_41678);\n                \n                private_mem_51256[i_51269 + (int64_t) 1] = defunc_0_op_res_41679;\n            }\n        }\n        // Publish results in shared memory\n        {\n            int64_t tmp_51270 = private_mem_51256[chunk_sizze_51222 - (int64_t) 1];\n            \n            ((__local int64_t *) local_mem_51241)[sext_i32_i64(local_tid_51234)] = tmp_51270;\n            barrier(CLK_LOCAL_MEM_FENCE);\n        }\n        // Scan results (with warp scan)\n        {\n            int64_t eta_p_51271;\n            int64_t eta_p_51272;\n            int64_t eta_p_51275;\n            int64_t eta_p_51276;\n            bool ltid_in_bounds_51278 = slt64(sext_i32_i64(local_tid_51234), num_virt_threads_51224);\n            int32_t skip_threads_51279;\n            \n            // read input for in-block scan\n            {\n                if (ltid_in_bounds_51278) {\n                    eta_p_51272 = ((volatile __local int64_t *)", " local_mem_51241)[sext_i32_i64(local_tid_51234)];\n                    if ((local_tid_51234 - squot32(local_tid_51234, 32) * 32) == 0) {\n                        eta_p_51271 = eta_p_51272;\n                    }\n                }\n            }\n            // in-block scan (hopefully no barriers needed)\n            {\n                skip_threads_51279 = 1;\n                while (slt32(skip_threads_51279, 32)) {\n                    bool thread_active_51280 = sle32(skip_threads_51279, local_tid_51234 - squot32(local_tid_51234, 32) * 32) && ltid_in_bounds_51278;\n                    \n                    if (thread_active_51280) {\n                        // read operands\n                        {\n                            eta_p_51271 = ((volatile __local int64_t *) local_mem_51241)[sext_i32_i64(local_tid_51234) - sext_i32_i64(skip_threads_51279)];\n                        }\n                    }\n                    // perform operation\n                    {\n                        if (thread_active_51280) {\n                            int64_t defunc_0_op_res_51273 = add64(eta_p_51271, eta_p_51272);\n                            \n                            eta_p_51271 = defunc_0_op_res_51273;\n                        }\n                    }\n                    if (sle32(wave_sizze_51236, skip_threads_51279)) {\n                        barrier(CLK_LOCAL_MEM_FENCE);\n                    }\n                    if (thread_active_51280) {\n                        // write result\n                        {\n                            ((volatile __local int64_t *) local_mem_51241)[sext_i32_i64(local_tid_51234)] = eta_p_51271;\n                            eta_p_51272 = eta_p_51271;\n                        }\n                    }\n                    if (sle32(wave_sizze_51236, skip_threads_51279)) {\n                        barrier(CLK_LOCAL_MEM_FENCE);\n                    }\n                    skip_threads_51279 *= 2;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n", "            // last thread of block 'i' writes its result to offset 'i'\n            {\n                if ((local_tid_51234 - squot32(local_tid_51234, 32) * 32) == 31 && ltid_in_bounds_51278) {\n                    ((volatile __local int64_t *) local_mem_51241)[sext_i32_i64(squot32(local_tid_51234, 32))] = eta_p_51271;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // scan the first block, after which offset 'i' contains carry-in for block 'i+1'\n            {\n                int32_t skip_threads_51281;\n                \n                // read input for in-block scan\n                {\n                    if (squot32(local_tid_51234, 32) == 0 && ltid_in_bounds_51278) {\n                        eta_p_51276 = ((volatile __local int64_t *) local_mem_51241)[sext_i32_i64(local_tid_51234)];\n                        if ((local_tid_51234 - squot32(local_tid_51234, 32) * 32) == 0) {\n                            eta_p_51275 = eta_p_51276;\n                        }\n                    }\n                }\n                // in-block scan (hopefully no barriers needed)\n                {\n                    skip_threads_51281 = 1;\n                    while (slt32(skip_threads_51281, 32)) {\n                        bool thread_active_51282 = sle32(skip_threads_51281, local_tid_51234 - squot32(local_tid_51234, 32) * 32) && (squot32(local_tid_51234, 32) == 0 && ltid_in_bounds_51278);\n                        \n                        if (thread_active_51282) {\n                            // read operands\n                            {\n                                eta_p_51275 = ((volatile __local int64_t *) local_mem_51241)[sext_i32_i64(local_tid_51234) - sext_i32_i64(skip_threads_51281)];\n                            }\n                        }\n                        // perform operation\n                        {\n                            if (thread_active_51282) {\n                                int64_t defunc_0_op_res_51277 = add64(eta_p_51275, eta",
                                    "_p_51276);\n                                \n                                eta_p_51275 = defunc_0_op_res_51277;\n                            }\n                        }\n                        if (sle32(wave_sizze_51236, skip_threads_51281)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        if (thread_active_51282) {\n                            // write result\n                            {\n                                ((volatile __local int64_t *) local_mem_51241)[sext_i32_i64(local_tid_51234)] = eta_p_51275;\n                                eta_p_51276 = eta_p_51275;\n                            }\n                        }\n                        if (sle32(wave_sizze_51236, skip_threads_51281)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        skip_threads_51281 *= 2;\n                    }\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            \n            bool no_carry_in_51283 = squot32(local_tid_51234, 32) == 0 || !ltid_in_bounds_51278;\n            \n            // carry-in for every block except the first\n            {\n                // read operands\n                {\n                    if (!no_carry_in_51283) {\n                        eta_p_51272 = eta_p_51271;\n                        eta_p_51271 = ((__local int64_t *) local_mem_51241)[sext_i32_i64(squot32(local_tid_51234, 32)) - (int64_t) 1];\n                    }\n                }\n                // perform operation\n                {\n                    if (!no_carry_in_51283) {\n                        int64_t defunc_0_op_res_51273 = add64(eta_p_51271, eta_p_51272);\n                        \n                        eta_p_51271 = defunc_0_op_res_51273;\n                    }\n                }\n                // write final result\n                {\n                    if (!no_carry_in_51283) {\n                        ((__local int64_t *) local_mem_51241)[sext_i", "32_i64(local_tid_51234)] = eta_p_51271;\n                    }\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // restore correct values for first block\n            {\n                if (squot32(local_tid_51234, 32) == 0 && ltid_in_bounds_51278) {\n                    ((__local int64_t *) local_mem_51241)[sext_i32_i64(local_tid_51234)] = eta_p_51272;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            barrier(CLK_LOCAL_MEM_FENCE);\n            if (local_tid_51234 == 0) {\n                acc_51274 = ((__local int64_t *) local_mem_51241)[segscan_tblock_sizze_44718 - (int64_t) 1];\n            } else {\n                acc_51274 = ((__local int64_t *) local_mem_51241)[sext_i32_i64(local_tid_51234) - (int64_t) 1];\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n        }\n        prefix_51284 = (int64_t) 0;\n        block_new_sgm_51285 = sgm_idx_51253 == (int64_t) 0;\n        // Perform lookback\n        {\n            if (block_new_sgm_51285 && local_tid_51234 == 0) {\n                ((volatile __global int64_t *) incprefixes_mem_51229)[dynamic_id_51251] = acc_51274;\n                mem_fence_global();\n                ((volatile __global int8_t *) status_flags_mem_51225)[dynamic_id_51251] = (int8_t) 2;\n                acc_51274 = (int64_t) 0;\n            }\n            if (!block_new_sgm_51285 && slt32(local_tid_51234, wave_sizze_51236)) {\n                if (local_tid_51234 == 0) {\n                    ((volatile __global int64_t *) aggregates_mem_51227)[dynamic_id_51251] = acc_51274;\n                    mem_fence_global();\n                    ((volatile __global int8_t *) status_flags_mem_51225)[dynamic_id_51251] = (int8_t) 1;\n                    \n                    int8_t tmp_51286 = ((volatile __global int8_t *) status_flags_mem_51225)[dynamic_id_51251 - (int64_t) 1];\n                    \n                    ((volatile __local int8_t *) local_mem_51241)[(int64_t) 0] = tmp_51286;\n                }\n", "                mem_fence_local();\n                \n                int8_t status_51287 = ((__local int8_t *) local_mem_51241)[(int64_t) 0];\n                \n                if (status_51287 == (int8_t) 2) {\n                    if (local_tid_51234 == 0) {\n                        prefix_51284 = ((volatile __global int64_t *) incprefixes_mem_51229)[dynamic_id_51251 - (int64_t) 1];\n                    }\n                } else {\n                    int32_t readOffset_51288 = sext_i64_i32(dynamic_id_51251 - sext_i32_i64(wave_sizze_51236));\n                    \n                    while (slt32(wave_sizze_51236 * -1, readOffset_51288)) {\n                        int32_t read_i_51289 = readOffset_51288 + local_tid_51234;\n                        int64_t aggr_51290 = (int64_t) 0;\n                        int8_t flag_51291 = (int8_t) 0;\n                        \n                        if (sle32(0, read_i_51289)) {\n                            flag_51291 = ((volatile __global int8_t *) status_flags_mem_51225)[sext_i32_i64(read_i_51289)];\n                            if (flag_51291 == (int8_t) 2) {\n                                aggr_51290 = ((volatile __global int64_t *) incprefixes_mem_51229)[sext_i32_i64(read_i_51289)];\n                            } else if (flag_51291 == (int8_t) 1) {\n                                aggr_51290 = ((volatile __global int64_t *) aggregates_mem_51227)[sext_i32_i64(read_i_51289)];\n                            }\n                        }\n                        ((__local int64_t *) local_mem_51241)[(int64_t) 4 + sext_i32_i64(local_tid_51234)] = aggr_51290;\n                        ((__local int8_t *) local_mem_51241)[sext_i32_i64(local_tid_51234)] = flag_51291;\n                        flag_51291 = ((__local int8_t *) local_mem_51241)[sext_i32_i64(wave_sizze_51236) - (int64_t) 1];\n                        if (slt8(flag_51291, (int8_t) 2)) {\n                            int8_t flg_x_51295;\n                            int8_t flg_y_51296;\n                   ",
                                    "         int64_t eta_p_51292;\n                            int64_t eta_p_51293;\n                            int32_t skip_threads_51297;\n                            \n                            // read input for in-block scan\n                            {\n                                flg_y_51296 = ((volatile __local int8_t *) local_mem_51241)[sext_i32_i64(local_tid_51234)];\n                                eta_p_51293 = ((volatile __local int64_t *) local_mem_51241)[(int64_t) 4 + sext_i32_i64(local_tid_51234)];\n                                if ((local_tid_51234 - squot32(local_tid_51234, 32) * 32) == 0) {\n                                    eta_p_51292 = eta_p_51293;\n                                    flg_x_51295 = flg_y_51296;\n                                }\n                            }\n                            // in-block scan (hopefully no barriers needed)\n                            {\n                                skip_threads_51297 = 1;\n                                while (slt32(skip_threads_51297, 32)) {\n                                    if (sle32(skip_threads_51297, local_tid_51234 - squot32(local_tid_51234, 32) * 32)) {\n                                        // read operands\n                                        {\n                                            flg_x_51295 = ((volatile __local int8_t *) local_mem_51241)[sext_i32_i64(local_tid_51234) - sext_i32_i64(skip_threads_51297)];\n                                            eta_p_51292 = ((volatile __local int64_t *) local_mem_51241)[(int64_t) 4 + (sext_i32_i64(local_tid_51234) - sext_i32_i64(skip_threads_51297))];\n                                        }\n                                        // perform operation\n                                        {\n                                            if (flg_y_51296 == (int8_t) 2 || flg_y_51296 == (int8_t) 0) {\n                                                flg_x_51295 = flg_y_51296;\n                                                eta_p_5", "1292 = eta_p_51293;\n                                            } else {\n                                                int64_t defunc_0_op_res_51294 = add64(eta_p_51292, eta_p_51293);\n                                                \n                                                eta_p_51292 = defunc_0_op_res_51294;\n                                            }\n                                        }\n                                        // write result\n                                        {\n                                            ((volatile __local int8_t *) local_mem_51241)[sext_i32_i64(local_tid_51234)] = flg_x_51295;\n                                            flg_y_51296 = flg_x_51295;\n                                            ((volatile __local int64_t *) local_mem_51241)[(int64_t) 4 + sext_i32_i64(local_tid_51234)] = eta_p_51292;\n                                            eta_p_51293 = eta_p_51292;\n                                        }\n                                    }\n                                    skip_threads_51297 *= 2;\n                                }\n                            }\n                        }\n                        flag_51291 = ((__local int8_t *) local_mem_51241)[sext_i32_i64(wave_sizze_51236) - (int64_t) 1];\n                        aggr_51290 = ((__local int64_t *) local_mem_51241)[(int64_t) 4 + (sext_i32_i64(wave_sizze_51236) - (int64_t) 1)];\n                        if (flag_51291 == (int8_t) 2) {\n                            readOffset_51288 = wave_sizze_51236 * -1;\n                        } else if (flag_51291 == (int8_t) 1) {\n                            readOffset_51288 -= wave_sizze_51236;\n                        }\n                        if (slt8((int8_t) 0, flag_51291)) {\n                            int64_t eta_p_51298 = aggr_51290;\n                            int64_t eta_p_51299 = prefix_51284;\n                            int64_t defunc_0_op_res_51300 = add64(eta_p_51298, eta_p_51299);\n               ", "             \n                            prefix_51284 = defunc_0_op_res_51300;\n                        }\n                        mem_fence_local();\n                    }\n                }\n                if (local_tid_51234 == 0) {\n                    if (boundary_51254 == sext_i64_i32(segscan_tblock_sizze_44718 * chunk_sizze_51222)) {\n                        int64_t eta_p_51301 = prefix_51284;\n                        int64_t eta_p_51302 = acc_51274;\n                        int64_t defunc_0_op_res_51303 = add64(eta_p_51301, eta_p_51302);\n                        \n                        ((volatile __global int64_t *) incprefixes_mem_51229)[dynamic_id_51251] = defunc_0_op_res_51303;\n                        mem_fence_global();\n                        ((volatile __global int8_t *) status_flags_mem_51225)[dynamic_id_51251] = (int8_t) 2;\n                    }\n                    ((__local int64_t *) local_mem_51241)[(int64_t) 4] = prefix_51284;\n                    acc_51274 = (int64_t) 0;\n                }\n            }\n            if (!(dynamic_id_51251 == (int64_t) 0)) {\n                barrier(CLK_LOCAL_MEM_FENCE);\n                prefix_51284 = ((__local int64_t *) local_mem_51241)[(int64_t) 4];\n                barrier(CLK_LOCAL_MEM_FENCE);\n            }\n        }\n        // Distribute results\n        {\n            int64_t eta_p_51304;\n            int64_t eta_p_51305;\n            int64_t eta_p_51307 = prefix_51284;\n            int64_t eta_p_51308 = acc_51274;\n            \n            if (slt32(local_tid_51234 * chunk_sizze_32b_51238, boundary_51254) && !block_new_sgm_51285) {\n                int64_t defunc_0_op_res_51309 = add64(eta_p_51307, eta_p_51308);\n                \n                eta_p_51304 = defunc_0_op_res_51309;\n            } else {\n                eta_p_51304 = acc_51274;\n            }\n            \n            int32_t stopping_point_51310 = segsizze_compact_51255 - srem32(local_tid_51234 * chunk_sizze_32b_51238 - 1 + segsizze_compact_51255 - boundary_512",
                                    "54, segsizze_compact_51255);\n            \n            for (int64_t i_51311 = 0; i_51311 < chunk_sizze_51222; i_51311++) {\n                if (slt32(sext_i64_i32(i_51311), stopping_point_51310 - 1)) {\n                    eta_p_51305 = private_mem_51256[i_51311];\n                    \n                    int64_t defunc_0_op_res_51306 = add64(eta_p_51304, eta_p_51305);\n                    \n                    private_mem_51256[i_51311] = defunc_0_op_res_51306;\n                }\n            }\n        }\n        // Transpose scan output and Write it to global memory in coalesced fashion\n        {\n            for (int64_t i_51312 = 0; i_51312 < chunk_sizze_51222; i_51312++) {\n                int64_t sharedIdx_51313 = sext_i32_i64(local_tid_51234) * chunk_sizze_51222 + i_51312;\n                int64_t tmp_51314 = private_mem_51256[i_51312];\n                \n                ((__local int64_t *) local_mem_51241)[sharedIdx_51313] = tmp_51314;\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            for (int64_t i_51315 = 0; i_51315 < chunk_sizze_51222; i_51315++) {\n                int64_t flat_idx_51316 = thd_offset_51258 + i_51315 * segscan_tblock_sizze_44718;\n                int64_t slice_51317 = conc_tmp_41556;\n                int64_t gtid_44722 = flat_idx_51316;\n                int64_t remnant_51318 = flat_idx_51316 - gtid_44722;\n                \n                if (slt64(flat_idx_51316, conc_tmp_41556)) {\n                    int64_t tmp_51319 = ((__local int64_t *) local_mem_51241)[flat_idx_51316 - block_offset_51252];\n                    \n                    ((__global int64_t *) mem_49598)[gtid_44722] = tmp_51319;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n        }\n    }\n    \n  error_3:\n    return;\n    #undef segscan_tblock_sizze_44718\n    #undef chunk_sizze_51222\n}\nFUTHARK_KERNEL_SIZED(do_DBSCAN_doublezisegscan_45210_dim1, 1, 1)\nvoid do_DBSCAN_doublezisegscan_45210(__global int *global_failure, int64_t m_41740, int64_t num_tblo", "cks_45206, int64_t num_virt_blocks_51526, int64_t num_virt_threads_51527, __global unsigned char *ext_mem_49741, __global unsigned char *mem_49746, __global unsigned char *status_flags_mem_51528, __global unsigned char *aggregates_mem_51530, __global unsigned char *incprefixes_mem_51532, __global unsigned char *global_dynid_mem_51534)\n{\n    #define segscan_tblock_sizze_45205 (do_DBSCAN_doublezisegscan_45210zisegscan_tblock_sizze_45205)\n    #define chunk_sizze_51525 (do_DBSCAN_doublezisegscan_45210zichunk_sizze_51525)\n    \n    volatile __local unsigned char *local_mem_51544_backing_0 = &shared_mem[0];\n    const int64_t local_mem_51544_backing_0_offset = 0 + (smax64(smax64((int64_t) 288, (int64_t) 8 * segscan_tblock_sizze_45205), chunk_sizze_51525 * segscan_tblock_sizze_45205 * (int64_t) 8) + srem64((int64_t) 8 - srem64(smax64(smax64((int64_t) 288, (int64_t) 8 * segscan_tblock_sizze_45205), chunk_sizze_51525 * segscan_tblock_sizze_45205 * (int64_t) 8), (int64_t) 8), (int64_t) 8));\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_51537;\n    int32_t tblock_sizze_51540;\n    int32_t wave_sizze_51539;\n    int32_t block_id_51538;\n    int32_t global_tid_51536;\n    int64_t phys_tid_45210;\n    int32_t chunk_sizze_32b_51541;\n    int64_t byte_offsets_51542;\n    int64_t warp_byte_offset_51543;\n    __local unsigned char *local_mem_51544;\n    int64_t trans_arr_len_51545;\n    int64_t phys_block_id_51551;\n    int64_t virtloop_bound_51552;\n    \n    local_tid_51537 = get_local_id(0);\n    tblock_sizze_51540 = get_local_size(0);\n    wave_sizze_51539 = LOCKSTEP_WIDTH;\n    block_id_51538 = get_tblock_id(0);\n    global_tid_51536 = block_id_51538 * tblock_sizze_51540 + local_tid_51537;\n    phys_tid_45210 = sext_i32_i64(global_tid_51536);\n    chunk_sizze_32b_51541 = sext_i64_i32(chunk_sizze_51525);\n    byte_offsets_51542 = segscan_tblock_sizze_45205 * (int64_t) 8;\n    warp_byte_offset_51543 = (int64_t) 288;\n    // Allocate reusable shared memory\n    { }\n    local_", "mem_51544 = (__local unsigned char *) local_mem_51544_backing_0;\n    trans_arr_len_51545 = chunk_sizze_51525 * segscan_tblock_sizze_45205;\n    phys_block_id_51551 = get_tblock_id(0);\n    virtloop_bound_51552 = sdiv_up64(num_virt_blocks_51526 - phys_block_id_51551, num_tblocks_45206);\n    for (int64_t virtloop_i_51553 = 0; virtloop_i_51553 < virtloop_bound_51552; virtloop_i_51553++) {\n        int64_t dynamic_id_51554;\n        int64_t block_offset_51555;\n        int64_t sgm_idx_51556;\n        int32_t boundary_51557;\n        int32_t segsizze_compact_51558;\n        int64_t private_mem_51559[chunk_sizze_51525];\n        int64_t thd_offset_51561;\n        int64_t acc_51577;\n        int64_t prefix_51587;\n        bool block_new_sgm_51588;\n        \n        // First thread in block fetches this block's dynamic_id\n        {\n            if (local_tid_51537 == 0) {\n                dynamic_id_51554 = atomic_add_i32_global(&((volatile __global int *) global_dynid_mem_51534)[(int64_t) 0], (int) 1);\n                // Set dynamic id for this block\n                {\n                    ((__local int64_t *) local_mem_51544)[(int64_t) 0] = dynamic_id_51554;\n                }\n                // First thread in last (virtual) block resets global dynamic_id\n                {\n                    if (dynamic_id_51554 == num_virt_blocks_51526 - (int64_t) 1) {\n                        ((__global int32_t *) global_dynid_mem_51534)[(int64_t) 0] = 0;\n                    }\n                }\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        dynamic_id_51554 = ((__local int32_t *) local_mem_51544)[(int64_t) 0];\n        barrier(CLK_LOCAL_MEM_FENCE);\n        block_offset_51555 = dynamic_id_51554 * chunk_sizze_51525 * segscan_tblock_sizze_45205;\n        sgm_idx_51556 = smod64(block_offset_51555, m_41740);\n        boundary_51557 = sext_i64_i32(smin64(chunk_sizze_51525 * segscan_tblock_sizze_45205, m_41740 - sgm_idx_51556));\n        segsizze_compact_51558 = sext_i64_i32(smin64(chunk_siz",
                                    "ze_51525 * segscan_tblock_sizze_45205, m_41740));\n        thd_offset_51561 = block_offset_51555 + sext_i32_i64(local_tid_51537);\n        // Load and map\n        {\n            for (int64_t i_51562 = 0; i_51562 < chunk_sizze_51525; i_51562++) {\n                int64_t virt_tid_51563 = thd_offset_51561 + i_51562 * segscan_tblock_sizze_45205;\n                int64_t slice_51564 = m_41740;\n                int64_t gtid_45209 = virt_tid_51563;\n                int64_t remnant_51565 = virt_tid_51563 - gtid_45209;\n                \n                if (slt64(virt_tid_51563, m_41740)) {\n                    int64_t x_45214 = ((__global int64_t *) ext_mem_49741)[gtid_45209];\n                    \n                    private_mem_51559[i_51562] = x_45214;\n                } else {\n                    private_mem_51559[i_51562] = (int64_t) 0;\n                }\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        // Transpose scan inputs\n        {\n            for (int64_t i_51566 = 0; i_51566 < chunk_sizze_51525; i_51566++) {\n                int64_t sharedIdx_51567 = sext_i32_i64(local_tid_51537) + i_51566 * segscan_tblock_sizze_45205;\n                int64_t tmp_51568 = private_mem_51559[i_51566];\n                \n                ((__local int64_t *) local_mem_51544)[sharedIdx_51567] = tmp_51568;\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            for (int64_t i_51569 = 0; i_51569 < chunk_sizze_51525; i_51569++) {\n                int64_t sharedIdx_51570 = sext_i32_i64(local_tid_51537) * chunk_sizze_51525 + i_51569;\n                int64_t tmp_51571 = ((__local int64_t *) local_mem_51544)[sharedIdx_51570];\n                \n                private_mem_51559[i_51569] = tmp_51571;\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n        }\n        // Per thread scan\n        {\n            for (int64_t i_51572 = 0; i_51572 < chunk_sizze_51525 - (int64_t) 1; i_51572++) {\n                int64_t eta_p_45211;\n                int64_t eta_p_45212;\n          ", "      \n                eta_p_45211 = private_mem_51559[i_51572];\n                eta_p_45212 = private_mem_51559[i_51572 + (int64_t) 1];\n                \n                int64_t defunc_0_op_res_45213 = add64(eta_p_45211, eta_p_45212);\n                \n                private_mem_51559[i_51572 + (int64_t) 1] = defunc_0_op_res_45213;\n            }\n        }\n        // Publish results in shared memory\n        {\n            int64_t tmp_51573 = private_mem_51559[chunk_sizze_51525 - (int64_t) 1];\n            \n            ((__local int64_t *) local_mem_51544)[sext_i32_i64(local_tid_51537)] = tmp_51573;\n            barrier(CLK_LOCAL_MEM_FENCE);\n        }\n        // Scan results (with warp scan)\n        {\n            int64_t eta_p_51574;\n            int64_t eta_p_51575;\n            int64_t eta_p_51578;\n            int64_t eta_p_51579;\n            bool ltid_in_bounds_51581 = slt64(sext_i32_i64(local_tid_51537), num_virt_threads_51527);\n            int32_t skip_threads_51582;\n            \n            // read input for in-block scan\n            {\n                if (ltid_in_bounds_51581) {\n                    eta_p_51575 = ((volatile __local int64_t *) local_mem_51544)[sext_i32_i64(local_tid_51537)];\n                    if ((local_tid_51537 - squot32(local_tid_51537, 32) * 32) == 0) {\n                        eta_p_51574 = eta_p_51575;\n                    }\n                }\n            }\n            // in-block scan (hopefully no barriers needed)\n            {\n                skip_threads_51582 = 1;\n                while (slt32(skip_threads_51582, 32)) {\n                    bool thread_active_51583 = sle32(skip_threads_51582, local_tid_51537 - squot32(local_tid_51537, 32) * 32) && ltid_in_bounds_51581;\n                    \n                    if (thread_active_51583) {\n                        // read operands\n                        {\n                            eta_p_51574 = ((volatile __local int64_t *) local_mem_51544)[sext_i32_i64(local_tid_51537) - sext_i32_i64(skip_thread", "s_51582)];\n                        }\n                    }\n                    // perform operation\n                    {\n                        if (thread_active_51583) {\n                            int64_t defunc_0_op_res_51576 = add64(eta_p_51574, eta_p_51575);\n                            \n                            eta_p_51574 = defunc_0_op_res_51576;\n                        }\n                    }\n                    if (sle32(wave_sizze_51539, skip_threads_51582)) {\n                        barrier(CLK_LOCAL_MEM_FENCE);\n                    }\n                    if (thread_active_51583) {\n                        // write result\n                        {\n                            ((volatile __local int64_t *) local_mem_51544)[sext_i32_i64(local_tid_51537)] = eta_p_51574;\n                            eta_p_51575 = eta_p_51574;\n                        }\n                    }\n                    if (sle32(wave_sizze_51539, skip_threads_51582)) {\n                        barrier(CLK_LOCAL_MEM_FENCE);\n                    }\n                    skip_threads_51582 *= 2;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // last thread of block 'i' writes its result to offset 'i'\n            {\n                if ((local_tid_51537 - squot32(local_tid_51537, 32) * 32) == 31 && ltid_in_bounds_51581) {\n                    ((volatile __local int64_t *) local_mem_51544)[sext_i32_i64(squot32(local_tid_51537, 32))] = eta_p_51574;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // scan the first block, after which offset 'i' contains carry-in for block 'i+1'\n            {\n                int32_t skip_threads_51584;\n                \n                // read input for in-block scan\n                {\n                    if (squot32(local_tid_51537, 32) == 0 && ltid_in_bounds_51581) {\n                        eta_p_51579 = ((volatile __local int64_t *) local_mem_51544)[sext_i32_i64(local_tid_51537)];\n            ",
                                    "            if ((local_tid_51537 - squot32(local_tid_51537, 32) * 32) == 0) {\n                            eta_p_51578 = eta_p_51579;\n                        }\n                    }\n                }\n                // in-block scan (hopefully no barriers needed)\n                {\n                    skip_threads_51584 = 1;\n                    while (slt32(skip_threads_51584, 32)) {\n                        bool thread_active_51585 = sle32(skip_threads_51584, local_tid_51537 - squot32(local_tid_51537, 32) * 32) && (squot32(local_tid_51537, 32) == 0 && ltid_in_bounds_51581);\n                        \n                        if (thread_active_51585) {\n                            // read operands\n                            {\n                                eta_p_51578 = ((volatile __local int64_t *) local_mem_51544)[sext_i32_i64(local_tid_51537) - sext_i32_i64(skip_threads_51584)];\n                            }\n                        }\n                        // perform operation\n                        {\n                            if (thread_active_51585) {\n                                int64_t defunc_0_op_res_51580 = add64(eta_p_51578, eta_p_51579);\n                                \n                                eta_p_51578 = defunc_0_op_res_51580;\n                            }\n                        }\n                        if (sle32(wave_sizze_51539, skip_threads_51584)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        if (thread_active_51585) {\n                            // write result\n                            {\n                                ((volatile __local int64_t *) local_mem_51544)[sext_i32_i64(local_tid_51537)] = eta_p_51578;\n                                eta_p_51579 = eta_p_51578;\n                            }\n                        }\n                        if (sle32(wave_sizze_51539, skip_threads_51584)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                ", "        }\n                        skip_threads_51584 *= 2;\n                    }\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            \n            bool no_carry_in_51586 = squot32(local_tid_51537, 32) == 0 || !ltid_in_bounds_51581;\n            \n            // carry-in for every block except the first\n            {\n                // read operands\n                {\n                    if (!no_carry_in_51586) {\n                        eta_p_51575 = eta_p_51574;\n                        eta_p_51574 = ((__local int64_t *) local_mem_51544)[sext_i32_i64(squot32(local_tid_51537, 32)) - (int64_t) 1];\n                    }\n                }\n                // perform operation\n                {\n                    if (!no_carry_in_51586) {\n                        int64_t defunc_0_op_res_51576 = add64(eta_p_51574, eta_p_51575);\n                        \n                        eta_p_51574 = defunc_0_op_res_51576;\n                    }\n                }\n                // write final result\n                {\n                    if (!no_carry_in_51586) {\n                        ((__local int64_t *) local_mem_51544)[sext_i32_i64(local_tid_51537)] = eta_p_51574;\n                    }\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // restore correct values for first block\n            {\n                if (squot32(local_tid_51537, 32) == 0 && ltid_in_bounds_51581) {\n                    ((__local int64_t *) local_mem_51544)[sext_i32_i64(local_tid_51537)] = eta_p_51575;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            barrier(CLK_LOCAL_MEM_FENCE);\n            if (local_tid_51537 == 0) {\n                acc_51577 = ((__local int64_t *) local_mem_51544)[segscan_tblock_sizze_45205 - (int64_t) 1];\n            } else {\n                acc_51577 = ((__local int64_t *) local_mem_51544)[sext_i32_i64(local_tid_51537) - (int64_t) 1];\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);", "\n        }\n        prefix_51587 = (int64_t) 0;\n        block_new_sgm_51588 = sgm_idx_51556 == (int64_t) 0;\n        // Perform lookback\n        {\n            if (block_new_sgm_51588 && local_tid_51537 == 0) {\n                ((volatile __global int64_t *) incprefixes_mem_51532)[dynamic_id_51554] = acc_51577;\n                mem_fence_global();\n                ((volatile __global int8_t *) status_flags_mem_51528)[dynamic_id_51554] = (int8_t) 2;\n                acc_51577 = (int64_t) 0;\n            }\n            if (!block_new_sgm_51588 && slt32(local_tid_51537, wave_sizze_51539)) {\n                if (local_tid_51537 == 0) {\n                    ((volatile __global int64_t *) aggregates_mem_51530)[dynamic_id_51554] = acc_51577;\n                    mem_fence_global();\n                    ((volatile __global int8_t *) status_flags_mem_51528)[dynamic_id_51554] = (int8_t) 1;\n                    \n                    int8_t tmp_51589 = ((volatile __global int8_t *) status_flags_mem_51528)[dynamic_id_51554 - (int64_t) 1];\n                    \n                    ((volatile __local int8_t *) local_mem_51544)[(int64_t) 0] = tmp_51589;\n                }\n                mem_fence_local();\n                \n                int8_t status_51590 = ((__local int8_t *) local_mem_51544)[(int64_t) 0];\n                \n                if (status_51590 == (int8_t) 2) {\n                    if (local_tid_51537 == 0) {\n                        prefix_51587 = ((volatile __global int64_t *) incprefixes_mem_51532)[dynamic_id_51554 - (int64_t) 1];\n                    }\n                } else {\n                    int32_t readOffset_51591 = sext_i64_i32(dynamic_id_51554 - sext_i32_i64(wave_sizze_51539));\n                    \n                    while (slt32(wave_sizze_51539 * -1, readOffset_51591)) {\n                        int32_t read_i_51592 = readOffset_51591 + local_tid_51537;\n                        int64_t aggr_51593 = (int64_t) 0;\n                        int8_t flag_51594 = (int8_t) 0;\n      ",
                                    "                  \n                        if (sle32(0, read_i_51592)) {\n                            flag_51594 = ((volatile __global int8_t *) status_flags_mem_51528)[sext_i32_i64(read_i_51592)];\n                            if (flag_51594 == (int8_t) 2) {\n                                aggr_51593 = ((volatile __global int64_t *) incprefixes_mem_51532)[sext_i32_i64(read_i_51592)];\n                            } else if (flag_51594 == (int8_t) 1) {\n                                aggr_51593 = ((volatile __global int64_t *) aggregates_mem_51530)[sext_i32_i64(read_i_51592)];\n                            }\n                        }\n                        ((__local int64_t *) local_mem_51544)[(int64_t) 4 + sext_i32_i64(local_tid_51537)] = aggr_51593;\n                        ((__local int8_t *) local_mem_51544)[sext_i32_i64(local_tid_51537)] = flag_51594;\n                        flag_51594 = ((__local int8_t *) local_mem_51544)[sext_i32_i64(wave_sizze_51539) - (int64_t) 1];\n                        if (slt8(flag_51594, (int8_t) 2)) {\n                            int8_t flg_x_51598;\n                            int8_t flg_y_51599;\n                            int64_t eta_p_51595;\n                            int64_t eta_p_51596;\n                            int32_t skip_threads_51600;\n                            \n                            // read input for in-block scan\n                            {\n                                flg_y_51599 = ((volatile __local int8_t *) local_mem_51544)[sext_i32_i64(local_tid_51537)];\n                                eta_p_51596 = ((volatile __local int64_t *) local_mem_51544)[(int64_t) 4 + sext_i32_i64(local_tid_51537)];\n                                if ((local_tid_51537 - squot32(local_tid_51537, 32) * 32) == 0) {\n                                    eta_p_51595 = eta_p_51596;\n                                    flg_x_51598 = flg_y_51599;\n                                }\n                            }\n                            // in-blo", "ck scan (hopefully no barriers needed)\n                            {\n                                skip_threads_51600 = 1;\n                                while (slt32(skip_threads_51600, 32)) {\n                                    if (sle32(skip_threads_51600, local_tid_51537 - squot32(local_tid_51537, 32) * 32)) {\n                                        // read operands\n                                        {\n                                            flg_x_51598 = ((volatile __local int8_t *) local_mem_51544)[sext_i32_i64(local_tid_51537) - sext_i32_i64(skip_threads_51600)];\n                                            eta_p_51595 = ((volatile __local int64_t *) local_mem_51544)[(int64_t) 4 + (sext_i32_i64(local_tid_51537) - sext_i32_i64(skip_threads_51600))];\n                                        }\n                                        // perform operation\n                                        {\n                                            if (flg_y_51599 == (int8_t) 2 || flg_y_51599 == (int8_t) 0) {\n                                                flg_x_51598 = flg_y_51599;\n                                                eta_p_51595 = eta_p_51596;\n                                            } else {\n                                                int64_t defunc_0_op_res_51597 = add64(eta_p_51595, eta_p_51596);\n                                                \n                                                eta_p_51595 = defunc_0_op_res_51597;\n                                            }\n                                        }\n                                        // write result\n                                        {\n                                            ((volatile __local int8_t *) local_mem_51544)[sext_i32_i64(local_tid_51537)] = flg_x_51598;\n                                            flg_y_51599 = flg_x_51598;\n                                            ((volatile __local int64_t *) local_mem_51544)[(int64_t) 4 + sext_i32_i64(local_tid_5", "1537)] = eta_p_51595;\n                                            eta_p_51596 = eta_p_51595;\n                                        }\n                                    }\n                                    skip_threads_51600 *= 2;\n                                }\n                            }\n                        }\n                        flag_51594 = ((__local int8_t *) local_mem_51544)[sext_i32_i64(wave_sizze_51539) - (int64_t) 1];\n                        aggr_51593 = ((__local int64_t *) local_mem_51544)[(int64_t) 4 + (sext_i32_i64(wave_sizze_51539) - (int64_t) 1)];\n                        if (flag_51594 == (int8_t) 2) {\n                            readOffset_51591 = wave_sizze_51539 * -1;\n                        } else if (flag_51594 == (int8_t) 1) {\n                            readOffset_51591 -= wave_sizze_51539;\n                        }\n                        if (slt8((int8_t) 0, flag_51594)) {\n                            int64_t eta_p_51601 = aggr_51593;\n                            int64_t eta_p_51602 = prefix_51587;\n                            int64_t defunc_0_op_res_51603 = add64(eta_p_51601, eta_p_51602);\n                            \n                            prefix_51587 = defunc_0_op_res_51603;\n                        }\n                        mem_fence_local();\n                    }\n                }\n                if (local_tid_51537 == 0) {\n                    if (boundary_51557 == sext_i64_i32(segscan_tblock_sizze_45205 * chunk_sizze_51525)) {\n                        int64_t eta_p_51604 = prefix_51587;\n                        int64_t eta_p_51605 = acc_51577;\n                        int64_t defunc_0_op_res_51606 = add64(eta_p_51604, eta_p_51605);\n                        \n                        ((volatile __global int64_t *) incprefixes_mem_51532)[dynamic_id_51554] = defunc_0_op_res_51606;\n                        mem_fence_global();\n                        ((volatile __global int8_t *) status_flags_mem_51528)[dynamic_id_51554] = (int8_t) ",
                                    "2;\n                    }\n                    ((__local int64_t *) local_mem_51544)[(int64_t) 4] = prefix_51587;\n                    acc_51577 = (int64_t) 0;\n                }\n            }\n            if (!(dynamic_id_51554 == (int64_t) 0)) {\n                barrier(CLK_LOCAL_MEM_FENCE);\n                prefix_51587 = ((__local int64_t *) local_mem_51544)[(int64_t) 4];\n                barrier(CLK_LOCAL_MEM_FENCE);\n            }\n        }\n        // Distribute results\n        {\n            int64_t eta_p_51607;\n            int64_t eta_p_51608;\n            int64_t eta_p_51610 = prefix_51587;\n            int64_t eta_p_51611 = acc_51577;\n            \n            if (slt32(local_tid_51537 * chunk_sizze_32b_51541, boundary_51557) && !block_new_sgm_51588) {\n                int64_t defunc_0_op_res_51612 = add64(eta_p_51610, eta_p_51611);\n                \n                eta_p_51607 = defunc_0_op_res_51612;\n            } else {\n                eta_p_51607 = acc_51577;\n            }\n            \n            int32_t stopping_point_51613 = segsizze_compact_51558 - srem32(local_tid_51537 * chunk_sizze_32b_51541 - 1 + segsizze_compact_51558 - boundary_51557, segsizze_compact_51558);\n            \n            for (int64_t i_51614 = 0; i_51614 < chunk_sizze_51525; i_51614++) {\n                if (slt32(sext_i64_i32(i_51614), stopping_point_51613 - 1)) {\n                    eta_p_51608 = private_mem_51559[i_51614];\n                    \n                    int64_t defunc_0_op_res_51609 = add64(eta_p_51607, eta_p_51608);\n                    \n                    private_mem_51559[i_51614] = defunc_0_op_res_51609;\n                }\n            }\n        }\n        // Transpose scan output and Write it to global memory in coalesced fashion\n        {\n            for (int64_t i_51615 = 0; i_51615 < chunk_sizze_51525; i_51615++) {\n                int64_t sharedIdx_51616 = sext_i32_i64(local_tid_51537) * chunk_sizze_51525 + i_51615;\n                int64_t tmp_51617 = private_mem_51559[i_51615]", ";\n                \n                ((__local int64_t *) local_mem_51544)[sharedIdx_51616] = tmp_51617;\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            for (int64_t i_51618 = 0; i_51618 < chunk_sizze_51525; i_51618++) {\n                int64_t flat_idx_51619 = thd_offset_51561 + i_51618 * segscan_tblock_sizze_45205;\n                int64_t slice_51620 = m_41740;\n                int64_t gtid_45209 = flat_idx_51619;\n                int64_t remnant_51621 = flat_idx_51619 - gtid_45209;\n                \n                if (slt64(flat_idx_51619, m_41740)) {\n                    int64_t tmp_51622 = ((__local int64_t *) local_mem_51544)[flat_idx_51619 - block_offset_51555];\n                    \n                    ((__global int64_t *) mem_49746)[gtid_45209] = tmp_51622;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n        }\n    }\n    \n  error_3:\n    return;\n    #undef segscan_tblock_sizze_45205\n    #undef chunk_sizze_51525\n}\nFUTHARK_KERNEL_SIZED(do_DBSCAN_doublezisegscan_45677_dim1, 1, 1)\nvoid do_DBSCAN_doublezisegscan_45677(__global int *global_failure, int64_t clProc_34783, int64_t m_41830, int64_t num_tblocks_45674, int64_t num_virt_blocks_51643, int64_t num_virt_threads_51644, __global unsigned char *mem_49757, __global unsigned char *mem_49927, __global unsigned char *mem_49929, __global unsigned char *status_flags_mem_51645, __global unsigned char *aggregates_mem_51647, __global unsigned char *incprefixes_mem_51649, __global unsigned char *global_dynid_mem_51651)\n{\n    #define segscan_tblock_sizze_45672 (do_DBSCAN_doublezisegscan_45677zisegscan_tblock_sizze_45672)\n    #define chunk_sizze_51642 (do_DBSCAN_doublezisegscan_45677zichunk_sizze_51642)\n    \n    volatile __local unsigned char *local_mem_51661_backing_0 = &shared_mem[0];\n    const int64_t local_mem_51661_backing_0_offset = 0 + (smax64(smax64((int64_t) 288, (int64_t) 8 * segscan_tblock_sizze_45672), chunk_sizze_51642 * segscan_tblock_sizze_45672 * (int64_t) 8) + s", "rem64((int64_t) 8 - srem64(smax64(smax64((int64_t) 288, (int64_t) 8 * segscan_tblock_sizze_45672), chunk_sizze_51642 * segscan_tblock_sizze_45672 * (int64_t) 8), (int64_t) 8), (int64_t) 8));\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_51654;\n    int32_t tblock_sizze_51657;\n    int32_t wave_sizze_51656;\n    int32_t block_id_51655;\n    int32_t global_tid_51653;\n    int64_t phys_tid_45677;\n    int32_t chunk_sizze_32b_51658;\n    int64_t byte_offsets_51659;\n    int64_t warp_byte_offset_51660;\n    __local unsigned char *local_mem_51661;\n    int64_t trans_arr_len_51662;\n    int64_t phys_block_id_51668;\n    int64_t virtloop_bound_51669;\n    \n    local_tid_51654 = get_local_id(0);\n    tblock_sizze_51657 = get_local_size(0);\n    wave_sizze_51656 = LOCKSTEP_WIDTH;\n    block_id_51655 = get_tblock_id(0);\n    global_tid_51653 = block_id_51655 * tblock_sizze_51657 + local_tid_51654;\n    phys_tid_45677 = sext_i32_i64(global_tid_51653);\n    chunk_sizze_32b_51658 = sext_i64_i32(chunk_sizze_51642);\n    byte_offsets_51659 = segscan_tblock_sizze_45672 * (int64_t) 8;\n    warp_byte_offset_51660 = (int64_t) 288;\n    // Allocate reusable shared memory\n    { }\n    local_mem_51661 = (__local unsigned char *) local_mem_51661_backing_0;\n    trans_arr_len_51662 = chunk_sizze_51642 * segscan_tblock_sizze_45672;\n    phys_block_id_51668 = get_tblock_id(0);\n    virtloop_bound_51669 = sdiv_up64(num_virt_blocks_51643 - phys_block_id_51668, num_tblocks_45674);\n    for (int64_t virtloop_i_51670 = 0; virtloop_i_51670 < virtloop_bound_51669; virtloop_i_51670++) {\n        int64_t dynamic_id_51671;\n        int64_t block_offset_51672;\n        int64_t sgm_idx_51673;\n        int32_t boundary_51674;\n        int32_t segsizze_compact_51675;\n        int64_t private_mem_51676[chunk_sizze_51642];\n        int64_t thd_offset_51678;\n        int64_t acc_51694;\n        int64_t prefix_51704;\n        bool block_new_sgm_51705;\n        \n        // First thread in block fetches this block's d",
                                    "ynamic_id\n        {\n            if (local_tid_51654 == 0) {\n                dynamic_id_51671 = atomic_add_i32_global(&((volatile __global int *) global_dynid_mem_51651)[(int64_t) 0], (int) 1);\n                // Set dynamic id for this block\n                {\n                    ((__local int64_t *) local_mem_51661)[(int64_t) 0] = dynamic_id_51671;\n                }\n                // First thread in last (virtual) block resets global dynamic_id\n                {\n                    if (dynamic_id_51671 == num_virt_blocks_51643 - (int64_t) 1) {\n                        ((__global int32_t *) global_dynid_mem_51651)[(int64_t) 0] = 0;\n                    }\n                }\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        dynamic_id_51671 = ((__local int32_t *) local_mem_51661)[(int64_t) 0];\n        barrier(CLK_LOCAL_MEM_FENCE);\n        block_offset_51672 = dynamic_id_51671 * chunk_sizze_51642 * segscan_tblock_sizze_45672;\n        sgm_idx_51673 = smod64(block_offset_51672, m_41830);\n        boundary_51674 = sext_i64_i32(smin64(chunk_sizze_51642 * segscan_tblock_sizze_45672, m_41830 - sgm_idx_51673));\n        segsizze_compact_51675 = sext_i64_i32(smin64(chunk_sizze_51642 * segscan_tblock_sizze_45672, m_41830));\n        thd_offset_51678 = block_offset_51672 + sext_i32_i64(local_tid_51654);\n        // Load and map\n        {\n            for (int64_t i_51679 = 0; i_51679 < chunk_sizze_51642; i_51679++) {\n                int64_t virt_tid_51680 = thd_offset_51678 + i_51679 * segscan_tblock_sizze_45672;\n                int64_t slice_51681 = m_41830;\n                int64_t gtid_45676 = virt_tid_51680;\n                int64_t remnant_51682 = virt_tid_51680 - gtid_45676;\n                \n                if (slt64(virt_tid_51680, m_41830)) {\n                    int64_t eta_p_42196 = ((__global int64_t *) mem_49757)[gtid_45676];\n                    bool lifted_lambda_res_42197 = slt64(eta_p_42196, clProc_34783);\n                    int64_t defunc_0_f_res_42198 ", "= btoi_bool_i64(lifted_lambda_res_42197);\n                    \n                    ((__global int64_t *) mem_49929)[gtid_45676] = defunc_0_f_res_42198;\n                    private_mem_51676[i_51679] = defunc_0_f_res_42198;\n                } else {\n                    private_mem_51676[i_51679] = (int64_t) 0;\n                }\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        // Transpose scan inputs\n        {\n            for (int64_t i_51683 = 0; i_51683 < chunk_sizze_51642; i_51683++) {\n                int64_t sharedIdx_51684 = sext_i32_i64(local_tid_51654) + i_51683 * segscan_tblock_sizze_45672;\n                int64_t tmp_51685 = private_mem_51676[i_51683];\n                \n                ((__local int64_t *) local_mem_51661)[sharedIdx_51684] = tmp_51685;\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            for (int64_t i_51686 = 0; i_51686 < chunk_sizze_51642; i_51686++) {\n                int64_t sharedIdx_51687 = sext_i32_i64(local_tid_51654) * chunk_sizze_51642 + i_51686;\n                int64_t tmp_51688 = ((__local int64_t *) local_mem_51661)[sharedIdx_51687];\n                \n                private_mem_51676[i_51686] = tmp_51688;\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n        }\n        // Per thread scan\n        {\n            for (int64_t i_51689 = 0; i_51689 < chunk_sizze_51642 - (int64_t) 1; i_51689++) {\n                int64_t eta_p_41886;\n                int64_t eta_p_41887;\n                \n                eta_p_41886 = private_mem_51676[i_51689];\n                eta_p_41887 = private_mem_51676[i_51689 + (int64_t) 1];\n                \n                int64_t defunc_0_op_res_41888 = add64(eta_p_41886, eta_p_41887);\n                \n                private_mem_51676[i_51689 + (int64_t) 1] = defunc_0_op_res_41888;\n            }\n        }\n        // Publish results in shared memory\n        {\n            int64_t tmp_51690 = private_mem_51676[chunk_sizze_51642 - (int64_t) 1];\n            \n            ((__", "local int64_t *) local_mem_51661)[sext_i32_i64(local_tid_51654)] = tmp_51690;\n            barrier(CLK_LOCAL_MEM_FENCE);\n        }\n        // Scan results (with warp scan)\n        {\n            int64_t eta_p_51691;\n            int64_t eta_p_51692;\n            int64_t eta_p_51695;\n            int64_t eta_p_51696;\n            bool ltid_in_bounds_51698 = slt64(sext_i32_i64(local_tid_51654), num_virt_threads_51644);\n            int32_t skip_threads_51699;\n            \n            // read input for in-block scan\n            {\n                if (ltid_in_bounds_51698) {\n                    eta_p_51692 = ((volatile __local int64_t *) local_mem_51661)[sext_i32_i64(local_tid_51654)];\n                    if ((local_tid_51654 - squot32(local_tid_51654, 32) * 32) == 0) {\n                        eta_p_51691 = eta_p_51692;\n                    }\n                }\n            }\n            // in-block scan (hopefully no barriers needed)\n            {\n                skip_threads_51699 = 1;\n                while (slt32(skip_threads_51699, 32)) {\n                    bool thread_active_51700 = sle32(skip_threads_51699, local_tid_51654 - squot32(local_tid_51654, 32) * 32) && ltid_in_bounds_51698;\n                    \n                    if (thread_active_51700) {\n                        // read operands\n                        {\n                            eta_p_51691 = ((volatile __local int64_t *) local_mem_51661)[sext_i32_i64(local_tid_51654) - sext_i32_i64(skip_threads_51699)];\n                        }\n                    }\n                    // perform operation\n                    {\n                        if (thread_active_51700) {\n                            int64_t defunc_0_op_res_51693 = add64(eta_p_51691, eta_p_51692);\n                            \n                            eta_p_51691 = defunc_0_op_res_51693;\n                        }\n                    }\n                    if (sle32(wave_sizze_51656, skip_threads_51699)) {\n                        barrier(CLK_LOCAL_MEM_",
                                    "FENCE);\n                    }\n                    if (thread_active_51700) {\n                        // write result\n                        {\n                            ((volatile __local int64_t *) local_mem_51661)[sext_i32_i64(local_tid_51654)] = eta_p_51691;\n                            eta_p_51692 = eta_p_51691;\n                        }\n                    }\n                    if (sle32(wave_sizze_51656, skip_threads_51699)) {\n                        barrier(CLK_LOCAL_MEM_FENCE);\n                    }\n                    skip_threads_51699 *= 2;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // last thread of block 'i' writes its result to offset 'i'\n            {\n                if ((local_tid_51654 - squot32(local_tid_51654, 32) * 32) == 31 && ltid_in_bounds_51698) {\n                    ((volatile __local int64_t *) local_mem_51661)[sext_i32_i64(squot32(local_tid_51654, 32))] = eta_p_51691;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // scan the first block, after which offset 'i' contains carry-in for block 'i+1'\n            {\n                int32_t skip_threads_51701;\n                \n                // read input for in-block scan\n                {\n                    if (squot32(local_tid_51654, 32) == 0 && ltid_in_bounds_51698) {\n                        eta_p_51696 = ((volatile __local int64_t *) local_mem_51661)[sext_i32_i64(local_tid_51654)];\n                        if ((local_tid_51654 - squot32(local_tid_51654, 32) * 32) == 0) {\n                            eta_p_51695 = eta_p_51696;\n                        }\n                    }\n                }\n                // in-block scan (hopefully no barriers needed)\n                {\n                    skip_threads_51701 = 1;\n                    while (slt32(skip_threads_51701, 32)) {\n                        bool thread_active_51702 = sle32(skip_threads_51701, local_tid_51654 - squot32(local_tid_51654, 32) * 32) && (squot3", "2(local_tid_51654, 32) == 0 && ltid_in_bounds_51698);\n                        \n                        if (thread_active_51702) {\n                            // read operands\n                            {\n                                eta_p_51695 = ((volatile __local int64_t *) local_mem_51661)[sext_i32_i64(local_tid_51654) - sext_i32_i64(skip_threads_51701)];\n                            }\n                        }\n                        // perform operation\n                        {\n                            if (thread_active_51702) {\n                                int64_t defunc_0_op_res_51697 = add64(eta_p_51695, eta_p_51696);\n                                \n                                eta_p_51695 = defunc_0_op_res_51697;\n                            }\n                        }\n                        if (sle32(wave_sizze_51656, skip_threads_51701)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        if (thread_active_51702) {\n                            // write result\n                            {\n                                ((volatile __local int64_t *) local_mem_51661)[sext_i32_i64(local_tid_51654)] = eta_p_51695;\n                                eta_p_51696 = eta_p_51695;\n                            }\n                        }\n                        if (sle32(wave_sizze_51656, skip_threads_51701)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        skip_threads_51701 *= 2;\n                    }\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            \n            bool no_carry_in_51703 = squot32(local_tid_51654, 32) == 0 || !ltid_in_bounds_51698;\n            \n            // carry-in for every block except the first\n            {\n                // read operands\n                {\n                    if (!no_carry_in_51703) {\n                        eta_p_51692 = eta_p_51691;\n                        eta_", "p_51691 = ((__local int64_t *) local_mem_51661)[sext_i32_i64(squot32(local_tid_51654, 32)) - (int64_t) 1];\n                    }\n                }\n                // perform operation\n                {\n                    if (!no_carry_in_51703) {\n                        int64_t defunc_0_op_res_51693 = add64(eta_p_51691, eta_p_51692);\n                        \n                        eta_p_51691 = defunc_0_op_res_51693;\n                    }\n                }\n                // write final result\n                {\n                    if (!no_carry_in_51703) {\n                        ((__local int64_t *) local_mem_51661)[sext_i32_i64(local_tid_51654)] = eta_p_51691;\n                    }\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // restore correct values for first block\n            {\n                if (squot32(local_tid_51654, 32) == 0 && ltid_in_bounds_51698) {\n                    ((__local int64_t *) local_mem_51661)[sext_i32_i64(local_tid_51654)] = eta_p_51692;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            barrier(CLK_LOCAL_MEM_FENCE);\n            if (local_tid_51654 == 0) {\n                acc_51694 = ((__local int64_t *) local_mem_51661)[segscan_tblock_sizze_45672 - (int64_t) 1];\n            } else {\n                acc_51694 = ((__local int64_t *) local_mem_51661)[sext_i32_i64(local_tid_51654) - (int64_t) 1];\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n        }\n        prefix_51704 = (int64_t) 0;\n        block_new_sgm_51705 = sgm_idx_51673 == (int64_t) 0;\n        // Perform lookback\n        {\n            if (block_new_sgm_51705 && local_tid_51654 == 0) {\n                ((volatile __global int64_t *) incprefixes_mem_51649)[dynamic_id_51671] = acc_51694;\n                mem_fence_global();\n                ((volatile __global int8_t *) status_flags_mem_51645)[dynamic_id_51671] = (int8_t) 2;\n                acc_51694 = (int64_t) 0;\n            }\n            if (!block_",
                                    "new_sgm_51705 && slt32(local_tid_51654, wave_sizze_51656)) {\n                if (local_tid_51654 == 0) {\n                    ((volatile __global int64_t *) aggregates_mem_51647)[dynamic_id_51671] = acc_51694;\n                    mem_fence_global();\n                    ((volatile __global int8_t *) status_flags_mem_51645)[dynamic_id_51671] = (int8_t) 1;\n                    \n                    int8_t tmp_51706 = ((volatile __global int8_t *) status_flags_mem_51645)[dynamic_id_51671 - (int64_t) 1];\n                    \n                    ((volatile __local int8_t *) local_mem_51661)[(int64_t) 0] = tmp_51706;\n                }\n                mem_fence_local();\n                \n                int8_t status_51707 = ((__local int8_t *) local_mem_51661)[(int64_t) 0];\n                \n                if (status_51707 == (int8_t) 2) {\n                    if (local_tid_51654 == 0) {\n                        prefix_51704 = ((volatile __global int64_t *) incprefixes_mem_51649)[dynamic_id_51671 - (int64_t) 1];\n                    }\n                } else {\n                    int32_t readOffset_51708 = sext_i64_i32(dynamic_id_51671 - sext_i32_i64(wave_sizze_51656));\n                    \n                    while (slt32(wave_sizze_51656 * -1, readOffset_51708)) {\n                        int32_t read_i_51709 = readOffset_51708 + local_tid_51654;\n                        int64_t aggr_51710 = (int64_t) 0;\n                        int8_t flag_51711 = (int8_t) 0;\n                        \n                        if (sle32(0, read_i_51709)) {\n                            flag_51711 = ((volatile __global int8_t *) status_flags_mem_51645)[sext_i32_i64(read_i_51709)];\n                            if (flag_51711 == (int8_t) 2) {\n                                aggr_51710 = ((volatile __global int64_t *) incprefixes_mem_51649)[sext_i32_i64(read_i_51709)];\n                            } else if (flag_51711 == (int8_t) 1) {\n                                aggr_51710 = ((volatile __global int64_t ", "*) aggregates_mem_51647)[sext_i32_i64(read_i_51709)];\n                            }\n                        }\n                        ((__local int64_t *) local_mem_51661)[(int64_t) 4 + sext_i32_i64(local_tid_51654)] = aggr_51710;\n                        ((__local int8_t *) local_mem_51661)[sext_i32_i64(local_tid_51654)] = flag_51711;\n                        flag_51711 = ((__local int8_t *) local_mem_51661)[sext_i32_i64(wave_sizze_51656) - (int64_t) 1];\n                        if (slt8(flag_51711, (int8_t) 2)) {\n                            int8_t flg_x_51715;\n                            int8_t flg_y_51716;\n                            int64_t eta_p_51712;\n                            int64_t eta_p_51713;\n                            int32_t skip_threads_51717;\n                            \n                            // read input for in-block scan\n                            {\n                                flg_y_51716 = ((volatile __local int8_t *) local_mem_51661)[sext_i32_i64(local_tid_51654)];\n                                eta_p_51713 = ((volatile __local int64_t *) local_mem_51661)[(int64_t) 4 + sext_i32_i64(local_tid_51654)];\n                                if ((local_tid_51654 - squot32(local_tid_51654, 32) * 32) == 0) {\n                                    eta_p_51712 = eta_p_51713;\n                                    flg_x_51715 = flg_y_51716;\n                                }\n                            }\n                            // in-block scan (hopefully no barriers needed)\n                            {\n                                skip_threads_51717 = 1;\n                                while (slt32(skip_threads_51717, 32)) {\n                                    if (sle32(skip_threads_51717, local_tid_51654 - squot32(local_tid_51654, 32) * 32)) {\n                                        // read operands\n                                        {\n                                            flg_x_51715 = ((volatile __local int8_t *) local_mem_51661)[sex", "t_i32_i64(local_tid_51654) - sext_i32_i64(skip_threads_51717)];\n                                            eta_p_51712 = ((volatile __local int64_t *) local_mem_51661)[(int64_t) 4 + (sext_i32_i64(local_tid_51654) - sext_i32_i64(skip_threads_51717))];\n                                        }\n                                        // perform operation\n                                        {\n                                            if (flg_y_51716 == (int8_t) 2 || flg_y_51716 == (int8_t) 0) {\n                                                flg_x_51715 = flg_y_51716;\n                                                eta_p_51712 = eta_p_51713;\n                                            } else {\n                                                int64_t defunc_0_op_res_51714 = add64(eta_p_51712, eta_p_51713);\n                                                \n                                                eta_p_51712 = defunc_0_op_res_51714;\n                                            }\n                                        }\n                                        // write result\n                                        {\n                                            ((volatile __local int8_t *) local_mem_51661)[sext_i32_i64(local_tid_51654)] = flg_x_51715;\n                                            flg_y_51716 = flg_x_51715;\n                                            ((volatile __local int64_t *) local_mem_51661)[(int64_t) 4 + sext_i32_i64(local_tid_51654)] = eta_p_51712;\n                                            eta_p_51713 = eta_p_51712;\n                                        }\n                                    }\n                                    skip_threads_51717 *= 2;\n                                }\n                            }\n                        }\n                        flag_51711 = ((__local int8_t *) local_mem_51661)[sext_i32_i64(wave_sizze_51656) - (int64_t) 1];\n                        aggr_51710 = ((__local int64_t *) local_mem_51661)[(int6",
                                    "4_t) 4 + (sext_i32_i64(wave_sizze_51656) - (int64_t) 1)];\n                        if (flag_51711 == (int8_t) 2) {\n                            readOffset_51708 = wave_sizze_51656 * -1;\n                        } else if (flag_51711 == (int8_t) 1) {\n                            readOffset_51708 -= wave_sizze_51656;\n                        }\n                        if (slt8((int8_t) 0, flag_51711)) {\n                            int64_t eta_p_51718 = aggr_51710;\n                            int64_t eta_p_51719 = prefix_51704;\n                            int64_t defunc_0_op_res_51720 = add64(eta_p_51718, eta_p_51719);\n                            \n                            prefix_51704 = defunc_0_op_res_51720;\n                        }\n                        mem_fence_local();\n                    }\n                }\n                if (local_tid_51654 == 0) {\n                    if (boundary_51674 == sext_i64_i32(segscan_tblock_sizze_45672 * chunk_sizze_51642)) {\n                        int64_t eta_p_51721 = prefix_51704;\n                        int64_t eta_p_51722 = acc_51694;\n                        int64_t defunc_0_op_res_51723 = add64(eta_p_51721, eta_p_51722);\n                        \n                        ((volatile __global int64_t *) incprefixes_mem_51649)[dynamic_id_51671] = defunc_0_op_res_51723;\n                        mem_fence_global();\n                        ((volatile __global int8_t *) status_flags_mem_51645)[dynamic_id_51671] = (int8_t) 2;\n                    }\n                    ((__local int64_t *) local_mem_51661)[(int64_t) 4] = prefix_51704;\n                    acc_51694 = (int64_t) 0;\n                }\n            }\n            if (!(dynamic_id_51671 == (int64_t) 0)) {\n                barrier(CLK_LOCAL_MEM_FENCE);\n                prefix_51704 = ((__local int64_t *) local_mem_51661)[(int64_t) 4];\n                barrier(CLK_LOCAL_MEM_FENCE);\n            }\n        }\n        // Distribute results\n        {\n            int64_t eta_p_51724;\n          ", "  int64_t eta_p_51725;\n            int64_t eta_p_51727 = prefix_51704;\n            int64_t eta_p_51728 = acc_51694;\n            \n            if (slt32(local_tid_51654 * chunk_sizze_32b_51658, boundary_51674) && !block_new_sgm_51705) {\n                int64_t defunc_0_op_res_51729 = add64(eta_p_51727, eta_p_51728);\n                \n                eta_p_51724 = defunc_0_op_res_51729;\n            } else {\n                eta_p_51724 = acc_51694;\n            }\n            \n            int32_t stopping_point_51730 = segsizze_compact_51675 - srem32(local_tid_51654 * chunk_sizze_32b_51658 - 1 + segsizze_compact_51675 - boundary_51674, segsizze_compact_51675);\n            \n            for (int64_t i_51731 = 0; i_51731 < chunk_sizze_51642; i_51731++) {\n                if (slt32(sext_i64_i32(i_51731), stopping_point_51730 - 1)) {\n                    eta_p_51725 = private_mem_51676[i_51731];\n                    \n                    int64_t defunc_0_op_res_51726 = add64(eta_p_51724, eta_p_51725);\n                    \n                    private_mem_51676[i_51731] = defunc_0_op_res_51726;\n                }\n            }\n        }\n        // Transpose scan output and Write it to global memory in coalesced fashion\n        {\n            for (int64_t i_51732 = 0; i_51732 < chunk_sizze_51642; i_51732++) {\n                int64_t sharedIdx_51733 = sext_i32_i64(local_tid_51654) * chunk_sizze_51642 + i_51732;\n                int64_t tmp_51734 = private_mem_51676[i_51732];\n                \n                ((__local int64_t *) local_mem_51661)[sharedIdx_51733] = tmp_51734;\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            for (int64_t i_51735 = 0; i_51735 < chunk_sizze_51642; i_51735++) {\n                int64_t flat_idx_51736 = thd_offset_51678 + i_51735 * segscan_tblock_sizze_45672;\n                int64_t slice_51737 = m_41830;\n                int64_t gtid_45676 = flat_idx_51736;\n                int64_t remnant_51738 = flat_idx_51736 - gtid_45676;\n                \n  ", "              if (slt64(flat_idx_51736, m_41830)) {\n                    int64_t tmp_51739 = ((__local int64_t *) local_mem_51661)[flat_idx_51736 - block_offset_51672];\n                    \n                    ((__global int64_t *) mem_49927)[gtid_45676] = tmp_51739;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n        }\n    }\n    \n  error_3:\n    return;\n    #undef segscan_tblock_sizze_45672\n    #undef chunk_sizze_51642\n}\nFUTHARK_KERNEL_SIZED(get_num_neighbours_against_9632zisegmap_46133_dim1, 1, 1)\nvoid get_num_neighbours_against_9632zisegmap_46133(__global int *global_failure, int8_t angle_t_28215, int64_t inf_28241, int64_t dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_28247, __global unsigned char *dat1_mem_49374, __global unsigned char *dat1_mem_49375, __global unsigned char *mem_49385, __global unsigned char *mem_49387, __global unsigned char *mem_49389)\n{\n    #define segmap_tblock_sizze_46127 (get_num_neighbours_against_9632zisegmap_46133zisegmap_tblock_sizze_46127)\n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_50233;\n    int32_t tblock_sizze_50236;\n    int32_t wave_sizze_50235;\n    int32_t block_id_50234;\n    int32_t global_tid_50232;\n    int64_t phys_tid_46133;\n    int64_t global_tid_50237;\n    int64_t slice_50238;\n    int64_t gtid_46132;\n    int64_t remnant_50239;\n    \n    local_tid_50233 = get_local_id(0);\n    tblock_sizze_50236 = get_local_size(0);\n    wave_sizze_50235 = LOCKSTEP_WIDTH;\n    block_id_50234 = get_tblock_id(0);\n    global_tid_50232 = block_id_50234 * tblock_sizze_50236 + local_tid_50233;\n    phys_tid_46133 = sext_i32_i64(global_tid_50232);\n    global_tid_50237 = sext_i32_i64(block_id_50234) * segmap_tblock_sizze_46127 + sext_i32_i64(local_tid_50233);\n    slice_50238 = dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_28247;\n    gtid_46132 = global_tid_50237;\n    remnant_50239 = global_tid_50237 - gtid_46132;\n    if (slt64(gtid_46132, dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_28247)) {\n        int64_t slice_46429;\n        ",
                                    "double eta_p_46134;\n        double eta_p_46135;\n        double zt_res_46136;\n        double zt_res_46137;\n        double zs_res_46138;\n        double zs_res_46139;\n        double d_haversine_res_46140;\n        double d_haversine_res_46141;\n        double cos_res_46142;\n        \n        slice_46429 = inf_28241 + gtid_46132;\n        eta_p_46134 = ((__global double *) dat1_mem_49374)[slice_46429];\n        eta_p_46135 = ((__global double *) dat1_mem_49375)[slice_46429];\n        zt_res_46136 = 3.141592653589793 * eta_p_46134;\n        zt_res_46137 = 3.141592653589793 * eta_p_46135;\n        zs_res_46138 = zt_res_46136 / 180.0;\n        zs_res_46139 = zt_res_46137 / 180.0;\n        if (angle_t_28215 == (int8_t) 1) {\n            d_haversine_res_46140 = eta_p_46134;\n        } else {\n            d_haversine_res_46140 = zs_res_46138;\n        }\n        if (angle_t_28215 == (int8_t) 1) {\n            d_haversine_res_46141 = eta_p_46135;\n        } else {\n            d_haversine_res_46141 = zs_res_46139;\n        }\n        cos_res_46142 = futrts_cos64(d_haversine_res_46140);\n        ((__global double *) mem_49385)[gtid_46132] = d_haversine_res_46140;\n        ((__global double *) mem_49387)[gtid_46132] = d_haversine_res_46141;\n        ((__global double *) mem_49389)[gtid_46132] = cos_res_46142;\n    }\n    \n  error_0:\n    return;\n    #undef segmap_tblock_sizze_46127\n}\nFUTHARK_KERNEL_SIZED(get_num_neighbours_against_9632zisegmap_intrablock_46535_dim1, 1, 1)\nvoid get_num_neighbours_against_9632zisegmap_intrablock_46535(__global int *global_failure, int64_t n2_28208, double eps_28213, int8_t dist_t_28214, int8_t angle_t_28215, double radius_28216, int64_t inf_28241, int64_t dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_28247, int64_t ldim_46538, int64_t num_whole_tiles_46582, int64_t residual_input_46771, unsigned char cond_46772_bits, int64_t binop_x_46785, __global unsigned char *dat1_mem_49374, __global unsigned char *dat1_mem_49375, __global unsigned char *dat2_mem_49376, __global unsigned char *dat", "2_mem_49377, __global unsigned char *mem_49379)\n{\n    bool cond_46772 = cond_46772_bits;\n    \n    #define tile_sizze_46537 (get_num_neighbours_against_9632zisegmap_intrablock_46535zitile_sizze_46537)\n    #define bytes_49419 (get_num_neighbours_against_9632zisegmap_intrablock_46535zibytes_49419)\n    \n    volatile __local unsigned char *color_50173_backing_1 = &shared_mem[0];\n    const int64_t color_50173_backing_1_offset = 0 + (bytes_49419 + srem64((int64_t) 8 - srem64(bytes_49419, (int64_t) 8), (int64_t) 8));\n    volatile __local unsigned char *color_50172_backing_0 = &shared_mem[color_50173_backing_1_offset];\n    const int64_t color_50172_backing_0_offset = color_50173_backing_1_offset + (bytes_49419 + srem64((int64_t) 8 - srem64(bytes_49419, (int64_t) 8), (int64_t) 8));\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_50217;\n    int32_t tblock_sizze_50220;\n    int32_t wave_sizze_50219;\n    int32_t block_id_50218;\n    int32_t global_tid_50216;\n    int64_t gid_flat_46535;\n    int64_t slice_50222;\n    int64_t ltid_pre_50221;\n    int64_t remnant_50223;\n    int64_t slice_50224;\n    int64_t gid_46534;\n    int64_t remnant_50225;\n    __local unsigned char *color_50172;\n    __local unsigned char *color_50173;\n    int64_t binop_x_46553;\n    double mem_49397[1];\n    double mem_49401[1];\n    double mem_49405[1];\n    double mem_49409[1];\n    double mem_49413[1];\n    int64_t ltid_flat_46540;\n    int64_t ltid_46539;\n    int64_t gtid_46554;\n    bool cond_46555;\n    double pre_46556;\n    double pre_46557;\n    double pre_46558;\n    double pre_46559;\n    double pre_46560;\n    int64_t mem_49417[1];\n    int64_t ltid_flat_46584;\n    int64_t ltid_46583;\n    int64_t ext_mem_49427[1];\n    int64_t mem_param_49418[1];\n    int64_t mem_49435[1];\n    int64_t ext_mem_49436[1];\n    \n    local_tid_50217 = get_local_id(0);\n    tblock_sizze_50220 = get_local_size(0);\n    wave_sizze_50219 = LOCKSTEP_WIDTH;\n    block_id_50218 = get_tblock_id(0);\n    global_tid_50216 = blo", "ck_id_50218 * tblock_sizze_50220 + local_tid_50217;\n    gid_flat_46535 = sext_i32_i64(block_id_50218);\n    slice_50222 = tile_sizze_46537;\n    ltid_pre_50221 = sext_i32_i64(local_tid_50217);\n    remnant_50223 = sext_i32_i64(local_tid_50217) - ltid_pre_50221;\n    slice_50224 = ldim_46538;\n    gid_46534 = sext_i32_i64(block_id_50218);\n    remnant_50225 = sext_i32_i64(block_id_50218) - gid_46534;\n    color_50172 = (__local unsigned char *) color_50172_backing_0;\n    color_50173 = (__local unsigned char *) color_50173_backing_1;\n    binop_x_46553 = gid_46534 * tile_sizze_46537;\n    ltid_flat_46540 = sext_i32_i64(local_tid_50217);\n    ltid_46539 = sext_i32_i64(sext_i64_i32(ltid_pre_50221));\n    gtid_46554 = ltid_46539 + binop_x_46553;\n    cond_46555 = slt64(gtid_46554, dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_28247);\n    if (cond_46555) {\n        int64_t slice_46561;\n        double eta_p_46562;\n        double eta_p_46564;\n        double zt_res_46565;\n        double zt_res_46566;\n        double zs_res_46567;\n        double zs_res_46568;\n        double d_haversine_res_46569;\n        double d_haversine_res_46570;\n        double cos_res_46571;\n        \n        slice_46561 = inf_28241 + gtid_46554;\n        eta_p_46562 = ((__global double *) dat1_mem_49374)[slice_46561];\n        eta_p_46564 = ((__global double *) dat1_mem_49375)[slice_46561];\n        zt_res_46565 = 3.141592653589793 * eta_p_46562;\n        zt_res_46566 = 3.141592653589793 * eta_p_46564;\n        zs_res_46567 = zt_res_46565 / 180.0;\n        zs_res_46568 = zt_res_46566 / 180.0;\n        if (angle_t_28215 == (int8_t) 1) {\n            d_haversine_res_46569 = eta_p_46562;\n        } else {\n            d_haversine_res_46569 = zs_res_46567;\n        }\n        if (angle_t_28215 == (int8_t) 1) {\n            d_haversine_res_46570 = eta_p_46564;\n        } else {\n            d_haversine_res_46570 = zs_res_46568;\n        }\n        cos_res_46571 = futrts_cos64(d_haversine_res_46569);\n        pre_46556 = eta_p_46562;\n        pre_46557 =",
                                    " eta_p_46564;\n        pre_46558 = d_haversine_res_46569;\n        pre_46559 = d_haversine_res_46570;\n        pre_46560 = cos_res_46571;\n    } else {\n        pre_46556 = 0.0;\n        pre_46557 = 0.0;\n        pre_46558 = 0.0;\n        pre_46559 = 0.0;\n        pre_46560 = 0.0;\n    }\n    mem_49397[(int64_t) 0] = pre_46556;\n    mem_49401[(int64_t) 0] = pre_46557;\n    mem_49405[(int64_t) 0] = pre_46558;\n    mem_49409[(int64_t) 0] = pre_46559;\n    mem_49413[(int64_t) 0] = pre_46560;\n    barrier(CLK_LOCAL_MEM_FENCE);\n    ltid_flat_46584 = sext_i32_i64(local_tid_50217);\n    ltid_46583 = sext_i32_i64(sext_i64_i32(ltid_pre_50221));\n    mem_49417[(int64_t) 0] = (int64_t) 0;\n    barrier(CLK_LOCAL_MEM_FENCE);\n    barrier(CLK_LOCAL_MEM_FENCE);\n    for (int32_t i_2 = 0; i_2 < 1; i_2++)\n        mem_param_49418[i_2] = mem_49417[i_2];\n    for (int64_t tile_id_46590 = 0; tile_id_46590 < num_whole_tiles_46582; tile_id_46590++) {\n        int64_t binop_x_46676;\n        int64_t ltid_flat_46675;\n        int64_t ltid_46674;\n        int64_t j_46677;\n        bool cond_46685;\n        double pre1d_46686;\n        double pre1d_46687;\n        int64_t mem_49426[1];\n        int64_t ltid_flat_46694;\n        int64_t ltid_46693;\n        int64_t gtid_46696;\n        int64_t acc_46702;\n        bool cond_46703;\n        int64_t acc_46704;\n        int64_t mem_param_tmp_50226[1];\n        \n        binop_x_46676 = tile_sizze_46537 * tile_id_46590;\n        ltid_flat_46675 = sext_i32_i64(local_tid_50217);\n        ltid_46674 = sext_i32_i64(sext_i64_i32(ltid_pre_50221));\n        j_46677 = ltid_46674 + binop_x_46676;\n        cond_46685 = slt64(j_46677, n2_28208);\n        if (cond_46685) {\n            double tile_elem_46688;\n            double tile_elem_46689;\n            \n            tile_elem_46688 = ((__global double *) dat2_mem_49376)[j_46677];\n            tile_elem_46689 = ((__global double *) dat2_mem_49377)[j_46677];\n            pre1d_46686 = tile_elem_46688;\n            pre1d_46687 = tile_elem_46689;\n        } e", "lse {\n            pre1d_46686 = 0.0;\n            pre1d_46687 = 0.0;\n        }\n        ((__local double *) color_50172)[ltid_46674] = pre1d_46686;\n        ((__local double *) color_50173)[ltid_46674] = pre1d_46687;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        ltid_flat_46694 = sext_i32_i64(local_tid_50217);\n        ltid_46693 = sext_i32_i64(sext_i64_i32(ltid_pre_50221));\n        gtid_46696 = binop_x_46553 + ltid_46693;\n        acc_46702 = mem_param_49418[(int64_t) 0];\n        cond_46703 = slt64(gtid_46696, dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_28247);\n        if (cond_46703) {\n            double eta_p_46697;\n            double eta_p_46698;\n            double d_haversine_res_46699;\n            double d_haversine_res_46700;\n            double cos_res_46701;\n            int64_t x_46705;\n            int64_t redout_49001;\n            \n            eta_p_46697 = mem_49397[(int64_t) 0];\n            eta_p_46698 = mem_49401[(int64_t) 0];\n            d_haversine_res_46699 = mem_49405[(int64_t) 0];\n            d_haversine_res_46700 = mem_49409[(int64_t) 0];\n            cos_res_46701 = mem_49413[(int64_t) 0];\n            redout_49001 = acc_46702;\n            for (int64_t i_49002 = 0; i_49002 < tile_sizze_46537; i_49002++) {\n                double eta_p_46706;\n                double eta_p_46707;\n                double dist_res_46708;\n                bool zlze_res_46733;\n                int64_t bool_res_46734;\n                int64_t zp_res_46737;\n                int64_t redout_tmp_50228;\n                \n                eta_p_46706 = ((__local double *) color_50172)[i_49002];\n                eta_p_46707 = ((__local double *) color_50173)[i_49002];\n                if (dist_t_28214 == (int8_t) 0) {\n                    double zm_res_46709;\n                    double zm_res_46710;\n                    double hypot_res_46711;\n                    \n                    zm_res_46709 = eta_p_46698 - eta_p_46707;\n                    zm_res_46710 = eta_p_46697 - eta_p_46706;\n                    h", "ypot_res_46711 = futrts_hypot64(zm_res_46710, zm_res_46709);\n                    dist_res_46708 = hypot_res_46711;\n                } else {\n                    double d_haversine_res_46712;\n                    double d_haversine_res_46713;\n                    double zm_res_46718;\n                    double cos_res_46719;\n                    double zm_res_46720;\n                    double cos_res_46721;\n                    double zt_res_46722;\n                    double zm_res_46723;\n                    double zm_res_46724;\n                    double zt_res_46725;\n                    double zp_res_46726;\n                    double zs_res_46727;\n                    double min_res_46728;\n                    double zt_res_46729;\n                    double zm_res_46730;\n                    double acos_res_46731;\n                    double zt_res_46732;\n                    \n                    if (angle_t_28215 == (int8_t) 1) {\n                        d_haversine_res_46712 = eta_p_46706;\n                        d_haversine_res_46713 = eta_p_46707;\n                    } else {\n                        double zt_res_46714;\n                        double zs_res_46715;\n                        double zt_res_46716;\n                        double zs_res_46717;\n                        \n                        zt_res_46714 = 3.141592653589793 * eta_p_46706;\n                        zs_res_46715 = zt_res_46714 / 180.0;\n                        zt_res_46716 = 3.141592653589793 * eta_p_46707;\n                        zs_res_46717 = zt_res_46716 / 180.0;\n                        d_haversine_res_46712 = zs_res_46715;\n                        d_haversine_res_46713 = zs_res_46717;\n                    }\n                    zm_res_46718 = d_haversine_res_46699 - d_haversine_res_46712;\n                    cos_res_46719 = futrts_cos64(zm_res_46718);\n                    zm_res_46720 = 1.0 - cos_res_46719;\n                    cos_res_46721 = futrts_cos64(d_haversine_res_46712);\n                    z",
                                    "t_res_46722 = cos_res_46701 * cos_res_46721;\n                    zm_res_46723 = d_haversine_res_46700 - d_haversine_res_46713;\n                    zm_res_46724 = 1.0 - zm_res_46723;\n                    zt_res_46725 = zt_res_46722 * zm_res_46724;\n                    zp_res_46726 = zm_res_46720 + zt_res_46725;\n                    zs_res_46727 = zp_res_46726 / 2.0;\n                    min_res_46728 = fmin64(1.0, zs_res_46727);\n                    zt_res_46729 = 2.0 * min_res_46728;\n                    zm_res_46730 = 1.0 - zt_res_46729;\n                    acos_res_46731 = futrts_acos64(zm_res_46730);\n                    zt_res_46732 = radius_28216 * acos_res_46731;\n                    dist_res_46708 = zt_res_46732;\n                }\n                zlze_res_46733 = dist_res_46708 <= eps_28213;\n                bool_res_46734 = btoi_bool_i64(zlze_res_46733);\n                zp_res_46737 = add64(bool_res_46734, redout_49001);\n                redout_tmp_50228 = zp_res_46737;\n                redout_49001 = redout_tmp_50228;\n            }\n            x_46705 = redout_49001;\n            acc_46704 = x_46705;\n        } else {\n            acc_46704 = acc_46702;\n        }\n        mem_49426[(int64_t) 0] = acc_46704;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        for (int32_t i_3 = 0; i_3 < 1; i_3++)\n            mem_param_tmp_50226[i_3] = mem_49426[i_3];\n        for (int32_t i_4 = 0; i_4 < 1; i_4++)\n            mem_param_49418[i_4] = mem_param_tmp_50226[i_4];\n    }\n    for (int32_t i_5 = 0; i_5 < 1; i_5++)\n        ext_mem_49427[i_5] = mem_param_49418[i_5];\n    barrier(CLK_LOCAL_MEM_FENCE);\n    if (cond_46772) {\n        for (int32_t i_6 = 0; i_6 < 1; i_6++)\n            ext_mem_49436[i_6] = ext_mem_49427[i_6];\n    } else {\n        int64_t ltid_flat_46774;\n        int64_t ltid_46773;\n        int64_t j_46786;\n        bool cond_46794;\n        double pre1d_46795;\n        double pre1d_46796;\n        int64_t ltid_flat_46806;\n        int64_t ltid_46805;\n        int64_t gtid_46813;\n        in", "t64_t acc_46819;\n        bool cond_46820;\n        int64_t acc_46821;\n        \n        ltid_flat_46774 = sext_i32_i64(local_tid_50217);\n        ltid_46773 = sext_i32_i64(sext_i64_i32(ltid_pre_50221));\n        j_46786 = ltid_46773 + binop_x_46785;\n        cond_46794 = slt64(j_46786, n2_28208);\n        if (cond_46794) {\n            double tile_elem_46797;\n            double tile_elem_46798;\n            \n            tile_elem_46797 = ((__global double *) dat2_mem_49376)[j_46786];\n            tile_elem_46798 = ((__global double *) dat2_mem_49377)[j_46786];\n            pre1d_46795 = tile_elem_46797;\n            pre1d_46796 = tile_elem_46798;\n        } else {\n            pre1d_46795 = 0.0;\n            pre1d_46796 = 0.0;\n        }\n        ((__local double *) color_50173)[ltid_46773] = pre1d_46795;\n        ((__local double *) color_50172)[ltid_46773] = pre1d_46796;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        ltid_flat_46806 = sext_i32_i64(local_tid_50217);\n        ltid_46805 = sext_i32_i64(sext_i64_i32(ltid_pre_50221));\n        gtid_46813 = binop_x_46553 + ltid_46805;\n        acc_46819 = ext_mem_49427[(int64_t) 0];\n        cond_46820 = slt64(gtid_46813, dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_28247);\n        if (cond_46820) {\n            double eta_p_46814;\n            double eta_p_46815;\n            double d_haversine_res_46816;\n            double d_haversine_res_46817;\n            double cos_res_46818;\n            int64_t x_46822;\n            int64_t redout_49003;\n            \n            eta_p_46814 = mem_49397[(int64_t) 0];\n            eta_p_46815 = mem_49401[(int64_t) 0];\n            d_haversine_res_46816 = mem_49405[(int64_t) 0];\n            d_haversine_res_46817 = mem_49409[(int64_t) 0];\n            cos_res_46818 = mem_49413[(int64_t) 0];\n            redout_49003 = acc_46819;\n            for (int64_t i_49004 = 0; i_49004 < residual_input_46771; i_49004++) {\n                double eta_p_46823;\n                double eta_p_46824;\n                double dist_res_46825;\n     ", "           bool zlze_res_46850;\n                int64_t bool_res_46851;\n                int64_t zp_res_46854;\n                int64_t redout_tmp_50229;\n                \n                eta_p_46823 = ((__local double *) color_50173)[i_49004];\n                eta_p_46824 = ((__local double *) color_50172)[i_49004];\n                if (dist_t_28214 == (int8_t) 0) {\n                    double zm_res_46826;\n                    double zm_res_46827;\n                    double hypot_res_46828;\n                    \n                    zm_res_46826 = eta_p_46815 - eta_p_46824;\n                    zm_res_46827 = eta_p_46814 - eta_p_46823;\n                    hypot_res_46828 = futrts_hypot64(zm_res_46827, zm_res_46826);\n                    dist_res_46825 = hypot_res_46828;\n                } else {\n                    double d_haversine_res_46829;\n                    double d_haversine_res_46830;\n                    double zm_res_46835;\n                    double cos_res_46836;\n                    double zm_res_46837;\n                    double cos_res_46838;\n                    double zt_res_46839;\n                    double zm_res_46840;\n                    double zm_res_46841;\n                    double zt_res_46842;\n                    double zp_res_46843;\n                    double zs_res_46844;\n                    double min_res_46845;\n                    double zt_res_46846;\n                    double zm_res_46847;\n                    double acos_res_46848;\n                    double zt_res_46849;\n                    \n                    if (angle_t_28215 == (int8_t) 1) {\n                        d_haversine_res_46829 = eta_p_46823;\n                        d_haversine_res_46830 = eta_p_46824;\n                    } else {\n                        double zt_res_46831;\n                        double zs_res_46832;\n                        double zt_res_46833;\n                        double zs_res_46834;\n                        \n                        zt_res_46831 = 3.1415926535",
                                    "89793 * eta_p_46823;\n                        zs_res_46832 = zt_res_46831 / 180.0;\n                        zt_res_46833 = 3.141592653589793 * eta_p_46824;\n                        zs_res_46834 = zt_res_46833 / 180.0;\n                        d_haversine_res_46829 = zs_res_46832;\n                        d_haversine_res_46830 = zs_res_46834;\n                    }\n                    zm_res_46835 = d_haversine_res_46816 - d_haversine_res_46829;\n                    cos_res_46836 = futrts_cos64(zm_res_46835);\n                    zm_res_46837 = 1.0 - cos_res_46836;\n                    cos_res_46838 = futrts_cos64(d_haversine_res_46829);\n                    zt_res_46839 = cos_res_46818 * cos_res_46838;\n                    zm_res_46840 = d_haversine_res_46817 - d_haversine_res_46830;\n                    zm_res_46841 = 1.0 - zm_res_46840;\n                    zt_res_46842 = zt_res_46839 * zm_res_46841;\n                    zp_res_46843 = zm_res_46837 + zt_res_46842;\n                    zs_res_46844 = zp_res_46843 / 2.0;\n                    min_res_46845 = fmin64(1.0, zs_res_46844);\n                    zt_res_46846 = 2.0 * min_res_46845;\n                    zm_res_46847 = 1.0 - zt_res_46846;\n                    acos_res_46848 = futrts_acos64(zm_res_46847);\n                    zt_res_46849 = radius_28216 * acos_res_46848;\n                    dist_res_46825 = zt_res_46849;\n                }\n                zlze_res_46850 = dist_res_46825 <= eps_28213;\n                bool_res_46851 = btoi_bool_i64(zlze_res_46850);\n                zp_res_46854 = add64(bool_res_46851, redout_49003);\n                redout_tmp_50229 = zp_res_46854;\n                redout_49003 = redout_tmp_50229;\n            }\n            x_46822 = redout_49003;\n            acc_46821 = x_46822;\n        } else {\n            acc_46821 = acc_46819;\n        }\n        mem_49435[(int64_t) 0] = acc_46821;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        for (int32_t i_7 = 0; i_7 < 1; i_7++)\n            ext_mem_49436[i_7] = mem_4", "9435[i_7];\n    }\n    if (slt64(sext_i32_i64(local_tid_50217) + tile_sizze_46537 * sext_i32_i64(block_id_50218), dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_28247)) {\n        int64_t tmp_50230 = ext_mem_49436[(int64_t) 0];\n        \n        ((__global int64_t *) mem_49379)[inf_28241 + (sext_i32_i64(local_tid_50217) + tile_sizze_46537 * sext_i32_i64(block_id_50218))] = tmp_50230;\n    }\n    \n  error_8:\n    return;\n    #undef tile_sizze_46537\n    #undef bytes_49419\n}\nFUTHARK_KERNEL_SIZED(get_num_neighbours_against_9632zisegred_large_46151_dim1, 1, 1)\nvoid get_num_neighbours_against_9632zisegred_large_46151(__global int *global_failure, int64_t n2_28208, double eps_28213, int8_t dist_t_28214, int8_t angle_t_28215, double radius_28216, int64_t inf_28241, int64_t dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_28247, int64_t num_tblocks_46146, unsigned char x_49348_bits, int64_t blocks_per_segment_50269, int64_t q_50270, int64_t num_virtblocks_50271, int64_t threads_per_segment_50272, __global unsigned char *dat1_mem_49374, __global unsigned char *dat1_mem_49375, __global unsigned char *dat2_mem_49376, __global unsigned char *dat2_mem_49377, __global unsigned char *mem_49379, __global unsigned char *mem_49385, __global unsigned char *mem_49387, __global unsigned char *mem_49389, __global unsigned char *segred_tmp_mem_50273, __global unsigned char *counters_mem_50275)\n{\n    bool x_49348 = x_49348_bits;\n    \n    #define segred_tblock_sizze_46145 (get_num_neighbours_against_9632zisegred_large_46151zisegred_tblock_sizze_46145)\n    #define chunk_sizze_50240 (get_num_neighbours_against_9632zisegred_large_46151zichunk_sizze_50240)\n    \n    volatile __local unsigned char *sync_arr_mem_50304_backing_1 = &shared_mem[0];\n    const int64_t sync_arr_mem_50304_backing_1_offset = 0 + 8;\n    volatile __local unsigned char *red_arr_i64_mem_50302_backing_0 = &shared_mem[sync_arr_mem_50304_backing_1_offset];\n    const int64_t red_arr_i64_mem_50302_backing_0_offset = sync_arr_mem_50304_backing_1_offset + ((int64_t) 8", " * segred_tblock_sizze_46145 + srem64((int64_t) 8 - srem64((int64_t) 8 * segred_tblock_sizze_46145, (int64_t) 8), (int64_t) 8));\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_50298;\n    int32_t tblock_sizze_50301;\n    int32_t wave_sizze_50300;\n    int32_t block_id_50299;\n    int32_t global_tid_50297;\n    int64_t phys_tid_46151;\n    __local unsigned char *red_arr_i64_mem_50302;\n    __local unsigned char *sync_arr_mem_50304;\n    int32_t phys_tblock_id_50306;\n    int32_t iterations_50307;\n    \n    local_tid_50298 = get_local_id(0);\n    tblock_sizze_50301 = get_local_size(0);\n    wave_sizze_50300 = LOCKSTEP_WIDTH;\n    block_id_50299 = get_tblock_id(0);\n    global_tid_50297 = block_id_50299 * tblock_sizze_50301 + local_tid_50298;\n    phys_tid_46151 = sext_i32_i64(global_tid_50297);\n    red_arr_i64_mem_50302 = (__local unsigned char *) red_arr_i64_mem_50302_backing_0;\n    sync_arr_mem_50304 = (__local unsigned char *) sync_arr_mem_50304_backing_1;\n    phys_tblock_id_50306 = get_tblock_id(0);\n    iterations_50307 = sdiv_up32(sext_i64_i32(num_virtblocks_50271) - phys_tblock_id_50306, sext_i64_i32(num_tblocks_46146));\n    for (int32_t i_50308 = 0; i_50308 < iterations_50307; i_50308++) {\n        int32_t virt_tblock_id_50309;\n        int64_t flat_segment_id_50310;\n        int64_t global_tid_50311;\n        int64_t slice_50312;\n        int64_t gtid_46149;\n        int64_t remnant_50313;\n        int64_t gtid_46150;\n        int64_t eta_p_block_res_acc_50314;\n        int64_t eta_p_46152;\n        int64_t eta_p_46153;\n        int64_t tblock_id_in_segment_50318;\n        int64_t block_base_offset_50319;\n        int32_t offset_50322;\n        int32_t skip_waves_50323;\n        int64_t eta_p_50315;\n        int64_t eta_p_50316;\n        \n        virt_tblock_id_50309 = phys_tblock_id_50306 + i_50308 * sext_i64_i32(num_tblocks_46146);\n        flat_segment_id_50310 = squot64(sext_i32_i64(virt_tblock_id_50309), blocks_per_segment_50269);\n        global_tid_50311 =",
                                    " srem64(sext_i32_i64(virt_tblock_id_50309) * segred_tblock_sizze_46145 + sext_i32_i64(local_tid_50298), threads_per_segment_50272);\n        slice_50312 = dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_28247;\n        gtid_46149 = flat_segment_id_50310;\n        remnant_50313 = flat_segment_id_50310 - gtid_46149;\n        // ne-initialise the outer (per-block) accumulator(s)\n        {\n            eta_p_block_res_acc_50314 = (int64_t) 0;\n        }\n        tblock_id_in_segment_50318 = squot64(global_tid_50311, segred_tblock_sizze_46145);\n        block_base_offset_50319 = tblock_id_in_segment_50318 * q_50270 * segred_tblock_sizze_46145;\n        for (int64_t i_50320 = 0; i_50320 < q_50270; i_50320++) {\n            int64_t block_offset_50321 = block_base_offset_50319 + i_50320 * segred_tblock_sizze_46145;\n            \n            gtid_46150 = global_tid_50311 + threads_per_segment_50272 * i_50320;\n            if (slt64(gtid_46150, n2_28208)) {\n                // apply map function(s)\n                {\n                    // apply map function\n                    {\n                        int64_t slice_46427 = inf_28241 + gtid_46149;\n                        double eta_p_46160 = ((__global double *) dat2_mem_49376)[gtid_46150];\n                        double eta_p_46161 = ((__global double *) dat2_mem_49377)[gtid_46150];\n                        double d_haversine_res_46157;\n                        \n                        if (x_49348) {\n                            double x_49350 = ((__global double *) mem_49385)[gtid_46149];\n                            \n                            d_haversine_res_46157 = x_49350;\n                        } else {\n                            d_haversine_res_46157 = 0.0;\n                        }\n                        \n                        double d_haversine_res_46158;\n                        \n                        if (x_49348) {\n                            double x_49352 = ((__global double *) mem_49387)[gtid_46149];\n                            \n     ", "                       d_haversine_res_46158 = x_49352;\n                        } else {\n                            d_haversine_res_46158 = 0.0;\n                        }\n                        \n                        double cos_res_46159;\n                        \n                        if (x_49348) {\n                            double x_49354 = ((__global double *) mem_49389)[gtid_46149];\n                            \n                            cos_res_46159 = x_49354;\n                        } else {\n                            cos_res_46159 = 0.0;\n                        }\n                        \n                        double dist_res_46162;\n                        \n                        if (dist_t_28214 == (int8_t) 0) {\n                            double eta_p_46155 = ((__global double *) dat1_mem_49374)[slice_46427];\n                            double eta_p_46156 = ((__global double *) dat1_mem_49375)[slice_46427];\n                            double zm_res_46163 = eta_p_46156 - eta_p_46161;\n                            double zm_res_46164 = eta_p_46155 - eta_p_46160;\n                            double hypot_res_46165 = futrts_hypot64(zm_res_46164, zm_res_46163);\n                            \n                            dist_res_46162 = hypot_res_46165;\n                        } else {\n                            double d_haversine_res_46166;\n                            double d_haversine_res_46167;\n                            \n                            if (angle_t_28215 == (int8_t) 1) {\n                                d_haversine_res_46166 = eta_p_46160;\n                                d_haversine_res_46167 = eta_p_46161;\n                            } else {\n                                double zt_res_46168 = 3.141592653589793 * eta_p_46160;\n                                double zs_res_46169 = zt_res_46168 / 180.0;\n                                double zt_res_46170 = 3.141592653589793 * eta_p_46161;\n                                double zs_res_4617", "1 = zt_res_46170 / 180.0;\n                                \n                                d_haversine_res_46166 = zs_res_46169;\n                                d_haversine_res_46167 = zs_res_46171;\n                            }\n                            \n                            double zm_res_46172 = d_haversine_res_46157 - d_haversine_res_46166;\n                            double cos_res_46173 = futrts_cos64(zm_res_46172);\n                            double zm_res_46174 = 1.0 - cos_res_46173;\n                            double cos_res_46175 = futrts_cos64(d_haversine_res_46166);\n                            double zt_res_46176 = cos_res_46159 * cos_res_46175;\n                            double zm_res_46177 = d_haversine_res_46158 - d_haversine_res_46167;\n                            double zm_res_46178 = 1.0 - zm_res_46177;\n                            double zt_res_46179 = zt_res_46176 * zm_res_46178;\n                            double zp_res_46180 = zm_res_46174 + zt_res_46179;\n                            double zs_res_46181 = zp_res_46180 / 2.0;\n                            double min_res_46182 = fmin64(1.0, zs_res_46181);\n                            double zt_res_46183 = 2.0 * min_res_46182;\n                            double zm_res_46184 = 1.0 - zt_res_46183;\n                            double acos_res_46185 = futrts_acos64(zm_res_46184);\n                            double zt_res_46186 = radius_28216 * acos_res_46185;\n                            \n                            dist_res_46162 = zt_res_46186;\n                        }\n                        \n                        bool zlze_res_46187 = dist_res_46162 <= eps_28213;\n                        int64_t bool_res_46188 = btoi_bool_i64(zlze_res_46187);\n                        \n                        // load accumulator(s)\n                        {\n                            eta_p_46152 = eta_p_block_res_acc_50314;\n                        }\n                        // load next value(s)\n                 ",
                                    "       {\n                            eta_p_46153 = bool_res_46188;\n                        }\n                        // apply reduction operator(s)\n                        {\n                            int64_t zp_res_46154 = add64(eta_p_46152, eta_p_46153);\n                            \n                            // store in accumulator(s)\n                            {\n                                eta_p_block_res_acc_50314 = zp_res_46154;\n                            }\n                        }\n                    }\n                }\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        // store accs. prims go in lmem; non-prims in params (in global mem)\n        {\n            ((__local int64_t *) red_arr_i64_mem_50302)[sext_i32_i64(local_tid_50298)] = eta_p_block_res_acc_50314;\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        skip_waves_50323 = 1;\n        offset_50322 = 0;\n        // participating threads read initial accumulator\n        {\n            if (slt32(local_tid_50298, sext_i64_i32(segred_tblock_sizze_46145))) {\n                eta_p_50315 = ((__local int64_t *) red_arr_i64_mem_50302)[sext_i32_i64(local_tid_50298 + offset_50322)];\n            }\n        }\n        offset_50322 = 1;\n        while (slt32(offset_50322, wave_sizze_50300)) {\n            if (slt32(local_tid_50298 + offset_50322, sext_i64_i32(segred_tblock_sizze_46145)) && ((local_tid_50298 - squot32(local_tid_50298, wave_sizze_50300) * wave_sizze_50300) & (2 * offset_50322 - 1)) == 0) {\n                // read array element\n                {\n                    eta_p_50316 = ((volatile __local int64_t *) red_arr_i64_mem_50302)[sext_i32_i64(local_tid_50298 + offset_50322)];\n                }\n                // apply reduction operation\n                {\n                    int64_t zp_res_50317 = add64(eta_p_50315, eta_p_50316);\n                    \n                    eta_p_50315 = zp_res_50317;\n                }\n                // write result of operation\n                {", "\n                    ((volatile __local int64_t *) red_arr_i64_mem_50302)[sext_i32_i64(local_tid_50298)] = eta_p_50315;\n                }\n            }\n            offset_50322 *= 2;\n        }\n        while (slt32(skip_waves_50323, squot32(sext_i64_i32(segred_tblock_sizze_46145) + wave_sizze_50300 - 1, wave_sizze_50300))) {\n            barrier(CLK_LOCAL_MEM_FENCE);\n            offset_50322 = skip_waves_50323 * wave_sizze_50300;\n            if (slt32(local_tid_50298 + offset_50322, sext_i64_i32(segred_tblock_sizze_46145)) && ((local_tid_50298 - squot32(local_tid_50298, wave_sizze_50300) * wave_sizze_50300) == 0 && (squot32(local_tid_50298, wave_sizze_50300) & (2 * skip_waves_50323 - 1)) == 0)) {\n                // read array element\n                {\n                    eta_p_50316 = ((__local int64_t *) red_arr_i64_mem_50302)[sext_i32_i64(local_tid_50298 + offset_50322)];\n                }\n                // apply reduction operation\n                {\n                    int64_t zp_res_50317 = add64(eta_p_50315, eta_p_50316);\n                    \n                    eta_p_50315 = zp_res_50317;\n                }\n                // write result of operation\n                {\n                    ((__local int64_t *) red_arr_i64_mem_50302)[sext_i32_i64(local_tid_50298)] = eta_p_50315;\n                }\n            }\n            skip_waves_50323 *= 2;\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        barrier(CLK_LOCAL_MEM_FENCE);\n        // thread 0 updates per-block acc(s); rest reset to ne\n        {\n            if (sext_i32_i64(local_tid_50298) == (int64_t) 0) {\n                eta_p_block_res_acc_50314 = eta_p_50315;\n            } else {\n                eta_p_block_res_acc_50314 = (int64_t) 0;\n            }\n        }\n        if (blocks_per_segment_50269 == (int64_t) 1) {\n            // first thread in block saves final result to memory\n            {\n                if (local_tid_50298 == 0) {\n                    ((__global int64_t *) mem_49379)[inf_28241 + gtid_", "46149] = eta_p_block_res_acc_50314;\n                }\n            }\n        } else {\n            int32_t old_counter_50324;\n            bool is_last_block_50325;\n            \n            // first thread in block saves block result to global memory\n            {\n                if (local_tid_50298 == 0) {\n                    ((__global int64_t *) segred_tmp_mem_50273)[sext_i32_i64(virt_tblock_id_50309)] = eta_p_block_res_acc_50314;\n                    mem_fence_global();\n                    old_counter_50324 = atomic_add_i32_global(&((volatile __global int *) counters_mem_50275)[srem64(flat_segment_id_50310, (int64_t) 20480)], (int) 1);\n                    ((__local bool *) sync_arr_mem_50304)[(int64_t) 0] = old_counter_50324 == sext_i64_i32(blocks_per_segment_50269 - (int64_t) 1);\n                }\n            }\n            barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n            is_last_block_50325 = ((__local bool *) sync_arr_mem_50304)[(int64_t) 0];\n            if (is_last_block_50325) {\n                if (local_tid_50298 == 0) {\n                    old_counter_50324 = atomic_add_i32_global(&((volatile __global int *) counters_mem_50275)[srem64(flat_segment_id_50310, (int64_t) 20480)], (int) sext_i64_i32((int64_t) 0 - blocks_per_segment_50269));\n                }\n                // read in the per-block-results\n                {\n                    int64_t read_per_thread_50326 = sdiv_up64(blocks_per_segment_50269, segred_tblock_sizze_46145);\n                    \n                    eta_p_46152 = (int64_t) 0;\n                    for (int64_t i_50327 = 0; i_50327 < read_per_thread_50326; i_50327++) {\n                        int64_t block_res_id_50328 = sext_i32_i64(local_tid_50298) * read_per_thread_50326 + i_50327;\n                        int64_t index_of_block_res_50329 = flat_segment_id_50310 * blocks_per_segment_50269 + block_res_id_50328;\n                        \n                        if (slt64(block_res_id_50328, blocks_per_segment_50269)) {\n     ",
                                    "                       eta_p_46153 = ((__global int64_t *) segred_tmp_mem_50273)[index_of_block_res_50329];\n                            \n                            int64_t zp_res_46154 = add64(eta_p_46152, eta_p_46153);\n                            \n                            eta_p_46152 = zp_res_46154;\n                        }\n                    }\n                }\n                ((__local int64_t *) red_arr_i64_mem_50302)[sext_i32_i64(local_tid_50298)] = eta_p_46152;\n                barrier(CLK_LOCAL_MEM_FENCE);\n                // reduce the per-block results\n                {\n                    int32_t offset_50330;\n                    int32_t skip_waves_50331 = 1;\n                    int64_t eta_p_50315;\n                    int64_t eta_p_50316;\n                    \n                    offset_50330 = 0;\n                    // participating threads read initial accumulator\n                    {\n                        if (slt32(local_tid_50298, sext_i64_i32(segred_tblock_sizze_46145))) {\n                            eta_p_50315 = ((__local int64_t *) red_arr_i64_mem_50302)[sext_i32_i64(local_tid_50298 + offset_50330)];\n                        }\n                    }\n                    offset_50330 = 1;\n                    while (slt32(offset_50330, wave_sizze_50300)) {\n                        if (slt32(local_tid_50298 + offset_50330, sext_i64_i32(segred_tblock_sizze_46145)) && ((local_tid_50298 - squot32(local_tid_50298, wave_sizze_50300) * wave_sizze_50300) & (2 * offset_50330 - 1)) == 0) {\n                            // read array element\n                            {\n                                eta_p_50316 = ((volatile __local int64_t *) red_arr_i64_mem_50302)[sext_i32_i64(local_tid_50298 + offset_50330)];\n                            }\n                            // apply reduction operation\n                            {\n                                int64_t zp_res_50317 = add64(eta_p_50315, eta_p_50316);\n                                \n            ", "                    eta_p_50315 = zp_res_50317;\n                            }\n                            // write result of operation\n                            {\n                                ((volatile __local int64_t *) red_arr_i64_mem_50302)[sext_i32_i64(local_tid_50298)] = eta_p_50315;\n                            }\n                        }\n                        offset_50330 *= 2;\n                    }\n                    while (slt32(skip_waves_50331, squot32(sext_i64_i32(segred_tblock_sizze_46145) + wave_sizze_50300 - 1, wave_sizze_50300))) {\n                        barrier(CLK_LOCAL_MEM_FENCE);\n                        offset_50330 = skip_waves_50331 * wave_sizze_50300;\n                        if (slt32(local_tid_50298 + offset_50330, sext_i64_i32(segred_tblock_sizze_46145)) && ((local_tid_50298 - squot32(local_tid_50298, wave_sizze_50300) * wave_sizze_50300) == 0 && (squot32(local_tid_50298, wave_sizze_50300) & (2 * skip_waves_50331 - 1)) == 0)) {\n                            // read array element\n                            {\n                                eta_p_50316 = ((__local int64_t *) red_arr_i64_mem_50302)[sext_i32_i64(local_tid_50298 + offset_50330)];\n                            }\n                            // apply reduction operation\n                            {\n                                int64_t zp_res_50317 = add64(eta_p_50315, eta_p_50316);\n                                \n                                eta_p_50315 = zp_res_50317;\n                            }\n                            // write result of operation\n                            {\n                                ((__local int64_t *) red_arr_i64_mem_50302)[sext_i32_i64(local_tid_50298)] = eta_p_50315;\n                            }\n                        }\n                        skip_waves_50331 *= 2;\n                    }\n                    barrier(CLK_LOCAL_MEM_FENCE);\n                    // and back to memory with the final result\n                    {\n         ", "               if (local_tid_50298 == 0) {\n                            ((__global int64_t *) mem_49379)[inf_28241 + gtid_46149] = eta_p_50315;\n                        }\n                    }\n                }\n            }\n        }\n        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    }\n    \n  error_6:\n    return;\n    #undef segred_tblock_sizze_46145\n    #undef chunk_sizze_50240\n}\nFUTHARK_KERNEL_SIZED(get_num_neighbours_against_9632zisegred_small_46151_dim1, 1, 1)\nvoid get_num_neighbours_against_9632zisegred_small_46151(__global int *global_failure, int64_t n2_28208, double eps_28213, int8_t dist_t_28214, int8_t angle_t_28215, double radius_28216, int64_t inf_28241, int64_t dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_28247, int64_t num_tblocks_46146, unsigned char x_49348_bits, int64_t segment_sizze_nonzzero_50241, __global unsigned char *dat1_mem_49374, __global unsigned char *dat1_mem_49375, __global unsigned char *dat2_mem_49376, __global unsigned char *dat2_mem_49377, __global unsigned char *mem_49379, __global unsigned char *mem_49385, __global unsigned char *mem_49387, __global unsigned char *mem_49389)\n{\n    bool x_49348 = x_49348_bits;\n    \n    #define segred_tblock_sizze_46145 (get_num_neighbours_against_9632zisegred_small_46151zisegred_tblock_sizze_46145)\n    \n    volatile __local unsigned char *red_arr_i64_mem_50248_backing_0 = &shared_mem[0];\n    const int64_t red_arr_i64_mem_50248_backing_0_offset = 0 + ((int64_t) 8 * segred_tblock_sizze_46145 + srem64((int64_t) 8 - srem64((int64_t) 8 * segred_tblock_sizze_46145, (int64_t) 8), (int64_t) 8));\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_50244;\n    int32_t tblock_sizze_50247;\n    int32_t wave_sizze_50246;\n    int32_t block_id_50245;\n    int32_t global_tid_50243;\n    int64_t phys_tid_46151;\n    __local unsigned char *red_arr_i64_mem_50248;\n    int32_t phys_tblock_id_50250;\n    int32_t iterations_50251;\n    \n    local_tid_50244 = get_local_id(0);\n    tblock_sizze_50247 = g",
                                    "et_local_size(0);\n    wave_sizze_50246 = LOCKSTEP_WIDTH;\n    block_id_50245 = get_tblock_id(0);\n    global_tid_50243 = block_id_50245 * tblock_sizze_50247 + local_tid_50244;\n    phys_tid_46151 = sext_i32_i64(global_tid_50243);\n    red_arr_i64_mem_50248 = (__local unsigned char *) red_arr_i64_mem_50248_backing_0;\n    phys_tblock_id_50250 = get_tblock_id(0);\n    iterations_50251 = sdiv_up32(sext_i64_i32(sdiv_up64(dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_28247, squot64(segred_tblock_sizze_46145, segment_sizze_nonzzero_50241))) - phys_tblock_id_50250, sext_i64_i32(num_tblocks_46146));\n    for (int32_t i_50252 = 0; i_50252 < iterations_50251; i_50252++) {\n        int32_t virt_tblock_id_50253;\n        int64_t slice_50254;\n        int64_t gtid_46149;\n        int64_t remnant_50255;\n        int64_t gtid_46150;\n        \n        virt_tblock_id_50253 = phys_tblock_id_50250 + i_50252 * sext_i64_i32(num_tblocks_46146);\n        slice_50254 = dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_28247;\n        gtid_46149 = squot64(sext_i32_i64(local_tid_50244), segment_sizze_nonzzero_50241) + sext_i32_i64(virt_tblock_id_50253) * squot64(segred_tblock_sizze_46145, segment_sizze_nonzzero_50241);\n        remnant_50255 = squot64(sext_i32_i64(local_tid_50244), segment_sizze_nonzzero_50241) + sext_i32_i64(virt_tblock_id_50253) * squot64(segred_tblock_sizze_46145, segment_sizze_nonzzero_50241) - gtid_46149;\n        gtid_46150 = srem64(sext_i32_i64(local_tid_50244), n2_28208);\n        // apply map function if in bounds\n        {\n            if (slt64((int64_t) 0, n2_28208) && (slt64(gtid_46149, dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_28247) && slt64(sext_i32_i64(local_tid_50244), n2_28208 * squot64(segred_tblock_sizze_46145, segment_sizze_nonzzero_50241)))) {\n                // apply map function\n                {\n                    int64_t slice_46427 = inf_28241 + gtid_46149;\n                    double eta_p_46160 = ((__global double *) dat2_mem_49376)[gtid_46150];\n                    double eta_p_46161 = ((__global do", "uble *) dat2_mem_49377)[gtid_46150];\n                    double d_haversine_res_46157;\n                    \n                    if (x_49348) {\n                        double x_49350 = ((__global double *) mem_49385)[gtid_46149];\n                        \n                        d_haversine_res_46157 = x_49350;\n                    } else {\n                        d_haversine_res_46157 = 0.0;\n                    }\n                    \n                    double d_haversine_res_46158;\n                    \n                    if (x_49348) {\n                        double x_49352 = ((__global double *) mem_49387)[gtid_46149];\n                        \n                        d_haversine_res_46158 = x_49352;\n                    } else {\n                        d_haversine_res_46158 = 0.0;\n                    }\n                    \n                    double cos_res_46159;\n                    \n                    if (x_49348) {\n                        double x_49354 = ((__global double *) mem_49389)[gtid_46149];\n                        \n                        cos_res_46159 = x_49354;\n                    } else {\n                        cos_res_46159 = 0.0;\n                    }\n                    \n                    double dist_res_46162;\n                    \n                    if (dist_t_28214 == (int8_t) 0) {\n                        double eta_p_46155 = ((__global double *) dat1_mem_49374)[slice_46427];\n                        double eta_p_46156 = ((__global double *) dat1_mem_49375)[slice_46427];\n                        double zm_res_46163 = eta_p_46156 - eta_p_46161;\n                        double zm_res_46164 = eta_p_46155 - eta_p_46160;\n                        double hypot_res_46165 = futrts_hypot64(zm_res_46164, zm_res_46163);\n                        \n                        dist_res_46162 = hypot_res_46165;\n                    } else {\n                        double d_haversine_res_46166;\n                        double d_haversine_res_46167;\n                     ", "   \n                        if (angle_t_28215 == (int8_t) 1) {\n                            d_haversine_res_46166 = eta_p_46160;\n                            d_haversine_res_46167 = eta_p_46161;\n                        } else {\n                            double zt_res_46168 = 3.141592653589793 * eta_p_46160;\n                            double zs_res_46169 = zt_res_46168 / 180.0;\n                            double zt_res_46170 = 3.141592653589793 * eta_p_46161;\n                            double zs_res_46171 = zt_res_46170 / 180.0;\n                            \n                            d_haversine_res_46166 = zs_res_46169;\n                            d_haversine_res_46167 = zs_res_46171;\n                        }\n                        \n                        double zm_res_46172 = d_haversine_res_46157 - d_haversine_res_46166;\n                        double cos_res_46173 = futrts_cos64(zm_res_46172);\n                        double zm_res_46174 = 1.0 - cos_res_46173;\n                        double cos_res_46175 = futrts_cos64(d_haversine_res_46166);\n                        double zt_res_46176 = cos_res_46159 * cos_res_46175;\n                        double zm_res_46177 = d_haversine_res_46158 - d_haversine_res_46167;\n                        double zm_res_46178 = 1.0 - zm_res_46177;\n                        double zt_res_46179 = zt_res_46176 * zm_res_46178;\n                        double zp_res_46180 = zm_res_46174 + zt_res_46179;\n                        double zs_res_46181 = zp_res_46180 / 2.0;\n                        double min_res_46182 = fmin64(1.0, zs_res_46181);\n                        double zt_res_46183 = 2.0 * min_res_46182;\n                        double zm_res_46184 = 1.0 - zt_res_46183;\n                        double acos_res_46185 = futrts_acos64(zm_res_46184);\n                        double zt_res_46186 = radius_28216 * acos_res_46185;\n                        \n                        dist_res_46162 = zt_res_46186;\n                    }\n                  ",
                                    "  \n                    bool zlze_res_46187 = dist_res_46162 <= eps_28213;\n                    int64_t bool_res_46188 = btoi_bool_i64(zlze_res_46187);\n                    \n                    // save results to be reduced\n                    {\n                        ((__local int64_t *) red_arr_i64_mem_50248)[sext_i32_i64(local_tid_50244)] = bool_res_46188;\n                    }\n                }\n            } else {\n                ((__local int64_t *) red_arr_i64_mem_50248)[sext_i32_i64(local_tid_50244)] = (int64_t) 0;\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        if (slt64((int64_t) 0, n2_28208)) {\n            // perform segmented scan to imitate reduction\n            {\n                int64_t eta_p_46152;\n                int64_t eta_p_46153;\n                int64_t eta_p_50256;\n                int64_t eta_p_50257;\n                bool ltid_in_bounds_50259 = slt64(sext_i32_i64(local_tid_50244), n2_28208 * squot64(segred_tblock_sizze_46145, segment_sizze_nonzzero_50241));\n                int32_t skip_threads_50260;\n                \n                // read input for in-block scan\n                {\n                    if (ltid_in_bounds_50259) {\n                        eta_p_46153 = ((volatile __local int64_t *) red_arr_i64_mem_50248)[sext_i32_i64(local_tid_50244)];\n                        if ((local_tid_50244 - squot32(local_tid_50244, 32) * 32) == 0) {\n                            eta_p_46152 = eta_p_46153;\n                        }\n                    }\n                }\n                // in-block scan (hopefully no barriers needed)\n                {\n                    skip_threads_50260 = 1;\n                    while (slt32(skip_threads_50260, 32)) {\n                        bool thread_active_50261 = sle32(skip_threads_50260, local_tid_50244 - squot32(local_tid_50244, 32) * 32) && ltid_in_bounds_50259;\n                        \n                        if (thread_active_50261) {\n                            // read operands\n                ", "            {\n                                eta_p_46152 = ((volatile __local int64_t *) red_arr_i64_mem_50248)[sext_i32_i64(local_tid_50244) - sext_i32_i64(skip_threads_50260)];\n                            }\n                        }\n                        // perform operation\n                        {\n                            bool inactive_50262 = slt64(srem64(sext_i32_i64(local_tid_50244), n2_28208), sext_i32_i64(local_tid_50244) - sext_i32_i64(local_tid_50244 - skip_threads_50260));\n                            \n                            if (thread_active_50261 && inactive_50262) {\n                                eta_p_46152 = eta_p_46153;\n                            }\n                            if (thread_active_50261) {\n                                if (!inactive_50262) {\n                                    int64_t zp_res_46154 = add64(eta_p_46152, eta_p_46153);\n                                    \n                                    eta_p_46152 = zp_res_46154;\n                                }\n                            }\n                        }\n                        if (sle32(wave_sizze_50246, skip_threads_50260)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        if (thread_active_50261) {\n                            // write result\n                            {\n                                ((volatile __local int64_t *) red_arr_i64_mem_50248)[sext_i32_i64(local_tid_50244)] = eta_p_46152;\n                                eta_p_46153 = eta_p_46152;\n                            }\n                        }\n                        if (sle32(wave_sizze_50246, skip_threads_50260)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        skip_threads_50260 *= 2;\n                    }\n                }\n                barrier(CLK_LOCAL_MEM_FENCE);\n                // last thread of block 'i' writes its result to offset 'i'\n                {\n ", "                   if ((local_tid_50244 - squot32(local_tid_50244, 32) * 32) == 31 && ltid_in_bounds_50259) {\n                        ((volatile __local int64_t *) red_arr_i64_mem_50248)[sext_i32_i64(squot32(local_tid_50244, 32))] = eta_p_46152;\n                    }\n                }\n                barrier(CLK_LOCAL_MEM_FENCE);\n                // scan the first block, after which offset 'i' contains carry-in for block 'i+1'\n                {\n                    int32_t skip_threads_50263;\n                    \n                    // read input for in-block scan\n                    {\n                        if (squot32(local_tid_50244, 32) == 0 && ltid_in_bounds_50259) {\n                            eta_p_50257 = ((volatile __local int64_t *) red_arr_i64_mem_50248)[sext_i32_i64(local_tid_50244)];\n                            if ((local_tid_50244 - squot32(local_tid_50244, 32) * 32) == 0) {\n                                eta_p_50256 = eta_p_50257;\n                            }\n                        }\n                    }\n                    // in-block scan (hopefully no barriers needed)\n                    {\n                        skip_threads_50263 = 1;\n                        while (slt32(skip_threads_50263, 32)) {\n                            bool thread_active_50264 = sle32(skip_threads_50263, local_tid_50244 - squot32(local_tid_50244, 32) * 32) && (squot32(local_tid_50244, 32) == 0 && ltid_in_bounds_50259);\n                            \n                            if (thread_active_50264) {\n                                // read operands\n                                {\n                                    eta_p_50256 = ((volatile __local int64_t *) red_arr_i64_mem_50248)[sext_i32_i64(local_tid_50244) - sext_i32_i64(skip_threads_50263)];\n                                }\n                            }\n                            // perform operation\n                            {\n                                bool inactive_50265 = slt64(srem64(sext_i32_i64(lo",
                                    "cal_tid_50244 * 32 + 32 - 1), n2_28208), sext_i32_i64(local_tid_50244 * 32 + 32 - 1) - sext_i32_i64((local_tid_50244 - skip_threads_50263) * 32 + 32 - 1));\n                                \n                                if (thread_active_50264 && inactive_50265) {\n                                    eta_p_50256 = eta_p_50257;\n                                }\n                                if (thread_active_50264) {\n                                    if (!inactive_50265) {\n                                        int64_t zp_res_50258 = add64(eta_p_50256, eta_p_50257);\n                                        \n                                        eta_p_50256 = zp_res_50258;\n                                    }\n                                }\n                            }\n                            if (sle32(wave_sizze_50246, skip_threads_50263)) {\n                                barrier(CLK_LOCAL_MEM_FENCE);\n                            }\n                            if (thread_active_50264) {\n                                // write result\n                                {\n                                    ((volatile __local int64_t *) red_arr_i64_mem_50248)[sext_i32_i64(local_tid_50244)] = eta_p_50256;\n                                    eta_p_50257 = eta_p_50256;\n                                }\n                            }\n                            if (sle32(wave_sizze_50246, skip_threads_50263)) {\n                                barrier(CLK_LOCAL_MEM_FENCE);\n                            }\n                            skip_threads_50263 *= 2;\n                        }\n                    }\n                }\n                barrier(CLK_LOCAL_MEM_FENCE);\n                \n                bool no_carry_in_50266 = squot32(local_tid_50244, 32) == 0 || !ltid_in_bounds_50259;\n                \n                // carry-in for every block except the first\n                {\n                    // read operands\n                    {\n                        if (!no_c", "arry_in_50266) {\n                            eta_p_46153 = eta_p_46152;\n                            eta_p_46152 = ((__local int64_t *) red_arr_i64_mem_50248)[sext_i32_i64(squot32(local_tid_50244, 32)) - (int64_t) 1];\n                        }\n                    }\n                    // perform operation\n                    {\n                        bool inactive_50267 = slt64(srem64(sext_i32_i64(local_tid_50244), n2_28208), sext_i32_i64(local_tid_50244) - sext_i32_i64(squot32(local_tid_50244, 32) * 32 - 1));\n                        \n                        if (!no_carry_in_50266) {\n                            if (inactive_50267) {\n                                eta_p_46152 = eta_p_46153;\n                            }\n                        }\n                        if (!no_carry_in_50266) {\n                            if (!inactive_50267) {\n                                int64_t zp_res_46154 = add64(eta_p_46152, eta_p_46153);\n                                \n                                eta_p_46152 = zp_res_46154;\n                            }\n                        }\n                    }\n                    // write final result\n                    {\n                        if (!no_carry_in_50266) {\n                            ((__local int64_t *) red_arr_i64_mem_50248)[sext_i32_i64(local_tid_50244)] = eta_p_46152;\n                        }\n                    }\n                }\n                barrier(CLK_LOCAL_MEM_FENCE);\n                // restore correct values for first block\n                {\n                    if (squot32(local_tid_50244, 32) == 0 && ltid_in_bounds_50259) {\n                        ((__local int64_t *) red_arr_i64_mem_50248)[sext_i32_i64(local_tid_50244)] = eta_p_46153;\n                    }\n                }\n                barrier(CLK_LOCAL_MEM_FENCE);\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        // save final values of segments\n        {\n            if (slt64(sext_i32_i64(virt_tblock_id_50253) * squot64(", "segred_tblock_sizze_46145, segment_sizze_nonzzero_50241) + sext_i32_i64(local_tid_50244), dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_28247) && slt64(sext_i32_i64(local_tid_50244), squot64(segred_tblock_sizze_46145, segment_sizze_nonzzero_50241))) {\n                int64_t tmp_50268 = ((__local int64_t *) red_arr_i64_mem_50248)[(sext_i32_i64(local_tid_50244) + (int64_t) 1) * segment_sizze_nonzzero_50241 - (int64_t) 1];\n                \n                ((__global int64_t *) mem_49379)[inf_28241 + (sext_i32_i64(virt_tblock_id_50253) * squot64(segred_tblock_sizze_46145, segment_sizze_nonzzero_50241) + sext_i32_i64(local_tid_50244))] = tmp_50268;\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    }\n    \n  error_3:\n    return;\n    #undef segred_tblock_sizze_46145\n}\nFUTHARK_KERNEL_SIZED(get_num_neighbours_against_9635zisegmap_46367_dim1, 1, 1)\nvoid get_num_neighbours_against_9635zisegmap_46367(__global int *global_failure, int8_t angle_t_28472, int64_t inf_28498, int64_t dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_28504, __global unsigned char *dat1_mem_49374, __global unsigned char *dat1_mem_49375, __global unsigned char *mem_49385, __global unsigned char *mem_49387, __global unsigned char *mem_49389)\n{\n    #define segmap_tblock_sizze_46361 (get_num_neighbours_against_9635zisegmap_46367zisegmap_tblock_sizze_46361)\n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_50233;\n    int32_t tblock_sizze_50236;\n    int32_t wave_sizze_50235;\n    int32_t block_id_50234;\n    int32_t global_tid_50232;\n    int64_t phys_tid_46367;\n    int64_t global_tid_50237;\n    int64_t slice_50238;\n    int64_t gtid_46366;\n    int64_t remnant_50239;\n    \n    local_tid_50233 = get_local_id(0);\n    tblock_sizze_50236 = get_local_size(0);\n    wave_sizze_50235 = LOCKSTEP_WIDTH;\n    block_id_50234 = get_tblock_id(0);\n    global_tid_50232 = block_id_50234 * tblock_sizze_50236 + local_tid_50233;\n    phys_tid_46367 = sext_i32_i64(g",
                                    "lobal_tid_50232);\n    global_tid_50237 = sext_i32_i64(block_id_50234) * segmap_tblock_sizze_46361 + sext_i32_i64(local_tid_50233);\n    slice_50238 = dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_28504;\n    gtid_46366 = global_tid_50237;\n    remnant_50239 = global_tid_50237 - gtid_46366;\n    if (slt64(gtid_46366, dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_28504)) {\n        int64_t slice_46429;\n        double eta_p_46368;\n        double eta_p_46369;\n        double zt_res_46370;\n        double zt_res_46371;\n        double zs_res_46372;\n        double zs_res_46373;\n        double d_haversine_res_46374;\n        double d_haversine_res_46375;\n        double cos_res_46376;\n        \n        slice_46429 = inf_28498 + gtid_46366;\n        eta_p_46368 = ((__global double *) dat1_mem_49374)[slice_46429];\n        eta_p_46369 = ((__global double *) dat1_mem_49375)[slice_46429];\n        zt_res_46370 = 3.141592653589793 * eta_p_46368;\n        zt_res_46371 = 3.141592653589793 * eta_p_46369;\n        zs_res_46372 = zt_res_46370 / 180.0;\n        zs_res_46373 = zt_res_46371 / 180.0;\n        if (angle_t_28472 == (int8_t) 1) {\n            d_haversine_res_46374 = eta_p_46368;\n        } else {\n            d_haversine_res_46374 = zs_res_46372;\n        }\n        if (angle_t_28472 == (int8_t) 1) {\n            d_haversine_res_46375 = eta_p_46369;\n        } else {\n            d_haversine_res_46375 = zs_res_46373;\n        }\n        cos_res_46376 = futrts_cos64(d_haversine_res_46374);\n        ((__global double *) mem_49385)[gtid_46366] = d_haversine_res_46374;\n        ((__global double *) mem_49387)[gtid_46366] = d_haversine_res_46375;\n        ((__global double *) mem_49389)[gtid_46366] = cos_res_46376;\n    }\n    \n  error_0:\n    return;\n    #undef segmap_tblock_sizze_46361\n}\nFUTHARK_KERNEL_SIZED(get_num_neighbours_against_9635zisegmap_intrablock_46535_dim1, 1, 1)\nvoid get_num_neighbours_against_9635zisegmap_intrablock_46535(__global int *global_failure, int64_t n2_28465, double eps_28470, int8_t dist_t_28471, int8_t ang", "le_t_28472, double radius_28473, int64_t inf_28498, int64_t dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_28504, int64_t ldim_46538, int64_t num_whole_tiles_46582, int64_t residual_input_46771, unsigned char cond_46772_bits, int64_t binop_x_46785, __global unsigned char *dat1_mem_49374, __global unsigned char *dat1_mem_49375, __global unsigned char *dat2_mem_49376, __global unsigned char *dat2_mem_49377, __global unsigned char *mem_49379)\n{\n    bool cond_46772 = cond_46772_bits;\n    \n    #define tile_sizze_46537 (get_num_neighbours_against_9635zisegmap_intrablock_46535zitile_sizze_46537)\n    #define bytes_49419 (get_num_neighbours_against_9635zisegmap_intrablock_46535zibytes_49419)\n    \n    volatile __local unsigned char *color_50173_backing_1 = &shared_mem[0];\n    const int64_t color_50173_backing_1_offset = 0 + (bytes_49419 + srem64((int64_t) 8 - srem64(bytes_49419, (int64_t) 8), (int64_t) 8));\n    volatile __local unsigned char *color_50172_backing_0 = &shared_mem[color_50173_backing_1_offset];\n    const int64_t color_50172_backing_0_offset = color_50173_backing_1_offset + (bytes_49419 + srem64((int64_t) 8 - srem64(bytes_49419, (int64_t) 8), (int64_t) 8));\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_50217;\n    int32_t tblock_sizze_50220;\n    int32_t wave_sizze_50219;\n    int32_t block_id_50218;\n    int32_t global_tid_50216;\n    int64_t gid_flat_46535;\n    int64_t slice_50222;\n    int64_t ltid_pre_50221;\n    int64_t remnant_50223;\n    int64_t slice_50224;\n    int64_t gid_46534;\n    int64_t remnant_50225;\n    __local unsigned char *color_50172;\n    __local unsigned char *color_50173;\n    int64_t binop_x_46553;\n    double mem_49397[1];\n    double mem_49401[1];\n    double mem_49405[1];\n    double mem_49409[1];\n    double mem_49413[1];\n    int64_t ltid_flat_46540;\n    int64_t ltid_46539;\n    int64_t gtid_46554;\n    bool cond_46555;\n    double pre_46556;\n    double pre_46557;\n    double pre_46558;\n    double pre_46559;\n    double pre_46560;\n    in", "t64_t mem_49417[1];\n    int64_t ltid_flat_46584;\n    int64_t ltid_46583;\n    int64_t ext_mem_49427[1];\n    int64_t mem_param_49418[1];\n    int64_t mem_49435[1];\n    int64_t ext_mem_49436[1];\n    \n    local_tid_50217 = get_local_id(0);\n    tblock_sizze_50220 = get_local_size(0);\n    wave_sizze_50219 = LOCKSTEP_WIDTH;\n    block_id_50218 = get_tblock_id(0);\n    global_tid_50216 = block_id_50218 * tblock_sizze_50220 + local_tid_50217;\n    gid_flat_46535 = sext_i32_i64(block_id_50218);\n    slice_50222 = tile_sizze_46537;\n    ltid_pre_50221 = sext_i32_i64(local_tid_50217);\n    remnant_50223 = sext_i32_i64(local_tid_50217) - ltid_pre_50221;\n    slice_50224 = ldim_46538;\n    gid_46534 = sext_i32_i64(block_id_50218);\n    remnant_50225 = sext_i32_i64(block_id_50218) - gid_46534;\n    color_50172 = (__local unsigned char *) color_50172_backing_0;\n    color_50173 = (__local unsigned char *) color_50173_backing_1;\n    binop_x_46553 = gid_46534 * tile_sizze_46537;\n    ltid_flat_46540 = sext_i32_i64(local_tid_50217);\n    ltid_46539 = sext_i32_i64(sext_i64_i32(ltid_pre_50221));\n    gtid_46554 = ltid_46539 + binop_x_46553;\n    cond_46555 = slt64(gtid_46554, dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_28504);\n    if (cond_46555) {\n        int64_t slice_46561;\n        double eta_p_46562;\n        double eta_p_46564;\n        double zt_res_46565;\n        double zt_res_46566;\n        double zs_res_46567;\n        double zs_res_46568;\n        double d_haversine_res_46569;\n        double d_haversine_res_46570;\n        double cos_res_46571;\n        \n        slice_46561 = inf_28498 + gtid_46554;\n        eta_p_46562 = ((__global double *) dat1_mem_49374)[slice_46561];\n        eta_p_46564 = ((__global double *) dat1_mem_49375)[slice_46561];\n        zt_res_46565 = 3.141592653589793 * eta_p_46562;\n        zt_res_46566 = 3.141592653589793 * eta_p_46564;\n        zs_res_46567 = zt_res_46565 / 180.0;\n        zs_res_46568 = zt_res_46566 / 180.0;\n        if (angle_t_28472 == (int8_t) 1) {\n            d_haversine_r",
                                    "es_46569 = eta_p_46562;\n        } else {\n            d_haversine_res_46569 = zs_res_46567;\n        }\n        if (angle_t_28472 == (int8_t) 1) {\n            d_haversine_res_46570 = eta_p_46564;\n        } else {\n            d_haversine_res_46570 = zs_res_46568;\n        }\n        cos_res_46571 = futrts_cos64(d_haversine_res_46569);\n        pre_46556 = eta_p_46562;\n        pre_46557 = eta_p_46564;\n        pre_46558 = d_haversine_res_46569;\n        pre_46559 = d_haversine_res_46570;\n        pre_46560 = cos_res_46571;\n    } else {\n        pre_46556 = 0.0;\n        pre_46557 = 0.0;\n        pre_46558 = 0.0;\n        pre_46559 = 0.0;\n        pre_46560 = 0.0;\n    }\n    mem_49397[(int64_t) 0] = pre_46556;\n    mem_49401[(int64_t) 0] = pre_46557;\n    mem_49405[(int64_t) 0] = pre_46558;\n    mem_49409[(int64_t) 0] = pre_46559;\n    mem_49413[(int64_t) 0] = pre_46560;\n    barrier(CLK_LOCAL_MEM_FENCE);\n    ltid_flat_46584 = sext_i32_i64(local_tid_50217);\n    ltid_46583 = sext_i32_i64(sext_i64_i32(ltid_pre_50221));\n    mem_49417[(int64_t) 0] = (int64_t) 0;\n    barrier(CLK_LOCAL_MEM_FENCE);\n    barrier(CLK_LOCAL_MEM_FENCE);\n    for (int32_t i_2 = 0; i_2 < 1; i_2++)\n        mem_param_49418[i_2] = mem_49417[i_2];\n    for (int64_t tile_id_46590 = 0; tile_id_46590 < num_whole_tiles_46582; tile_id_46590++) {\n        int64_t binop_x_46676;\n        int64_t ltid_flat_46675;\n        int64_t ltid_46674;\n        int64_t j_46677;\n        bool cond_46685;\n        double pre1d_46686;\n        double pre1d_46687;\n        int64_t mem_49426[1];\n        int64_t ltid_flat_46694;\n        int64_t ltid_46693;\n        int64_t gtid_46696;\n        int64_t acc_46702;\n        bool cond_46703;\n        int64_t acc_46704;\n        int64_t mem_param_tmp_50226[1];\n        \n        binop_x_46676 = tile_sizze_46537 * tile_id_46590;\n        ltid_flat_46675 = sext_i32_i64(local_tid_50217);\n        ltid_46674 = sext_i32_i64(sext_i64_i32(ltid_pre_50221));\n        j_46677 = ltid_46674 + binop_x_46676;\n        cond_46685 = slt64", "(j_46677, n2_28465);\n        if (cond_46685) {\n            double tile_elem_46688;\n            double tile_elem_46689;\n            \n            tile_elem_46688 = ((__global double *) dat2_mem_49376)[j_46677];\n            tile_elem_46689 = ((__global double *) dat2_mem_49377)[j_46677];\n            pre1d_46686 = tile_elem_46688;\n            pre1d_46687 = tile_elem_46689;\n        } else {\n            pre1d_46686 = 0.0;\n            pre1d_46687 = 0.0;\n        }\n        ((__local double *) color_50172)[ltid_46674] = pre1d_46686;\n        ((__local double *) color_50173)[ltid_46674] = pre1d_46687;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        ltid_flat_46694 = sext_i32_i64(local_tid_50217);\n        ltid_46693 = sext_i32_i64(sext_i64_i32(ltid_pre_50221));\n        gtid_46696 = binop_x_46553 + ltid_46693;\n        acc_46702 = mem_param_49418[(int64_t) 0];\n        cond_46703 = slt64(gtid_46696, dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_28504);\n        if (cond_46703) {\n            double eta_p_46697;\n            double eta_p_46698;\n            double d_haversine_res_46699;\n            double d_haversine_res_46700;\n            double cos_res_46701;\n            int64_t x_46705;\n            int64_t redout_49001;\n            \n            eta_p_46697 = mem_49397[(int64_t) 0];\n            eta_p_46698 = mem_49401[(int64_t) 0];\n            d_haversine_res_46699 = mem_49405[(int64_t) 0];\n            d_haversine_res_46700 = mem_49409[(int64_t) 0];\n            cos_res_46701 = mem_49413[(int64_t) 0];\n            redout_49001 = acc_46702;\n            for (int64_t i_49002 = 0; i_49002 < tile_sizze_46537; i_49002++) {\n                double eta_p_46706;\n                double eta_p_46707;\n                double dist_res_46708;\n                bool zlze_res_46733;\n                int64_t bool_res_46734;\n                int64_t zp_res_46737;\n                int64_t redout_tmp_50228;\n                \n                eta_p_46706 = ((__local double *) color_50172)[i_49002];\n                eta_p_46707 = ((", "__local double *) color_50173)[i_49002];\n                if (dist_t_28471 == (int8_t) 0) {\n                    double zm_res_46709;\n                    double zm_res_46710;\n                    double hypot_res_46711;\n                    \n                    zm_res_46709 = eta_p_46698 - eta_p_46707;\n                    zm_res_46710 = eta_p_46697 - eta_p_46706;\n                    hypot_res_46711 = futrts_hypot64(zm_res_46710, zm_res_46709);\n                    dist_res_46708 = hypot_res_46711;\n                } else {\n                    double d_haversine_res_46712;\n                    double d_haversine_res_46713;\n                    double zm_res_46718;\n                    double cos_res_46719;\n                    double zm_res_46720;\n                    double cos_res_46721;\n                    double zt_res_46722;\n                    double zm_res_46723;\n                    double zm_res_46724;\n                    double zt_res_46725;\n                    double zp_res_46726;\n                    double zs_res_46727;\n                    double min_res_46728;\n                    double zt_res_46729;\n                    double zm_res_46730;\n                    double acos_res_46731;\n                    double zt_res_46732;\n                    \n                    if (angle_t_28472 == (int8_t) 1) {\n                        d_haversine_res_46712 = eta_p_46706;\n                        d_haversine_res_46713 = eta_p_46707;\n                    } else {\n                        double zt_res_46714;\n                        double zs_res_46715;\n                        double zt_res_46716;\n                        double zs_res_46717;\n                        \n                        zt_res_46714 = 3.141592653589793 * eta_p_46706;\n                        zs_res_46715 = zt_res_46714 / 180.0;\n                        zt_res_46716 = 3.141592653589793 * eta_p_46707;\n                        zs_res_46717 = zt_res_46716 / 180.0;\n                        d_haversine_res_46712 = zs_res_4671",
                                    "5;\n                        d_haversine_res_46713 = zs_res_46717;\n                    }\n                    zm_res_46718 = d_haversine_res_46699 - d_haversine_res_46712;\n                    cos_res_46719 = futrts_cos64(zm_res_46718);\n                    zm_res_46720 = 1.0 - cos_res_46719;\n                    cos_res_46721 = futrts_cos64(d_haversine_res_46712);\n                    zt_res_46722 = cos_res_46701 * cos_res_46721;\n                    zm_res_46723 = d_haversine_res_46700 - d_haversine_res_46713;\n                    zm_res_46724 = 1.0 - zm_res_46723;\n                    zt_res_46725 = zt_res_46722 * zm_res_46724;\n                    zp_res_46726 = zm_res_46720 + zt_res_46725;\n                    zs_res_46727 = zp_res_46726 / 2.0;\n                    min_res_46728 = fmin64(1.0, zs_res_46727);\n                    zt_res_46729 = 2.0 * min_res_46728;\n                    zm_res_46730 = 1.0 - zt_res_46729;\n                    acos_res_46731 = futrts_acos64(zm_res_46730);\n                    zt_res_46732 = radius_28473 * acos_res_46731;\n                    dist_res_46708 = zt_res_46732;\n                }\n                zlze_res_46733 = dist_res_46708 <= eps_28470;\n                bool_res_46734 = btoi_bool_i64(zlze_res_46733);\n                zp_res_46737 = add64(bool_res_46734, redout_49001);\n                redout_tmp_50228 = zp_res_46737;\n                redout_49001 = redout_tmp_50228;\n            }\n            x_46705 = redout_49001;\n            acc_46704 = x_46705;\n        } else {\n            acc_46704 = acc_46702;\n        }\n        mem_49426[(int64_t) 0] = acc_46704;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        for (int32_t i_3 = 0; i_3 < 1; i_3++)\n            mem_param_tmp_50226[i_3] = mem_49426[i_3];\n        for (int32_t i_4 = 0; i_4 < 1; i_4++)\n            mem_param_49418[i_4] = mem_param_tmp_50226[i_4];\n    }\n    for (int32_t i_5 = 0; i_5 < 1; i_5++)\n        ext_mem_49427[i_5] = mem_param_49418[i_5];\n    barrier(CLK_LOCAL_MEM_FENCE);\n    if (cond_4677", "2) {\n        for (int32_t i_6 = 0; i_6 < 1; i_6++)\n            ext_mem_49436[i_6] = ext_mem_49427[i_6];\n    } else {\n        int64_t ltid_flat_46774;\n        int64_t ltid_46773;\n        int64_t j_46786;\n        bool cond_46794;\n        double pre1d_46795;\n        double pre1d_46796;\n        int64_t ltid_flat_46806;\n        int64_t ltid_46805;\n        int64_t gtid_46813;\n        int64_t acc_46819;\n        bool cond_46820;\n        int64_t acc_46821;\n        \n        ltid_flat_46774 = sext_i32_i64(local_tid_50217);\n        ltid_46773 = sext_i32_i64(sext_i64_i32(ltid_pre_50221));\n        j_46786 = ltid_46773 + binop_x_46785;\n        cond_46794 = slt64(j_46786, n2_28465);\n        if (cond_46794) {\n            double tile_elem_46797;\n            double tile_elem_46798;\n            \n            tile_elem_46797 = ((__global double *) dat2_mem_49376)[j_46786];\n            tile_elem_46798 = ((__global double *) dat2_mem_49377)[j_46786];\n            pre1d_46795 = tile_elem_46797;\n            pre1d_46796 = tile_elem_46798;\n        } else {\n            pre1d_46795 = 0.0;\n            pre1d_46796 = 0.0;\n        }\n        ((__local double *) color_50173)[ltid_46773] = pre1d_46795;\n        ((__local double *) color_50172)[ltid_46773] = pre1d_46796;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        ltid_flat_46806 = sext_i32_i64(local_tid_50217);\n        ltid_46805 = sext_i32_i64(sext_i64_i32(ltid_pre_50221));\n        gtid_46813 = binop_x_46553 + ltid_46805;\n        acc_46819 = ext_mem_49427[(int64_t) 0];\n        cond_46820 = slt64(gtid_46813, dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_28504);\n        if (cond_46820) {\n            double eta_p_46814;\n            double eta_p_46815;\n            double d_haversine_res_46816;\n            double d_haversine_res_46817;\n            double cos_res_46818;\n            int64_t x_46822;\n            int64_t redout_49003;\n            \n            eta_p_46814 = mem_49397[(int64_t) 0];\n            eta_p_46815 = mem_49401[(int64_t) 0];\n            d_haversine_re", "s_46816 = mem_49405[(int64_t) 0];\n            d_haversine_res_46817 = mem_49409[(int64_t) 0];\n            cos_res_46818 = mem_49413[(int64_t) 0];\n            redout_49003 = acc_46819;\n            for (int64_t i_49004 = 0; i_49004 < residual_input_46771; i_49004++) {\n                double eta_p_46823;\n                double eta_p_46824;\n                double dist_res_46825;\n                bool zlze_res_46850;\n                int64_t bool_res_46851;\n                int64_t zp_res_46854;\n                int64_t redout_tmp_50229;\n                \n                eta_p_46823 = ((__local double *) color_50173)[i_49004];\n                eta_p_46824 = ((__local double *) color_50172)[i_49004];\n                if (dist_t_28471 == (int8_t) 0) {\n                    double zm_res_46826;\n                    double zm_res_46827;\n                    double hypot_res_46828;\n                    \n                    zm_res_46826 = eta_p_46815 - eta_p_46824;\n                    zm_res_46827 = eta_p_46814 - eta_p_46823;\n                    hypot_res_46828 = futrts_hypot64(zm_res_46827, zm_res_46826);\n                    dist_res_46825 = hypot_res_46828;\n                } else {\n                    double d_haversine_res_46829;\n                    double d_haversine_res_46830;\n                    double zm_res_46835;\n                    double cos_res_46836;\n                    double zm_res_46837;\n                    double cos_res_46838;\n                    double zt_res_46839;\n                    double zm_res_46840;\n                    double zm_res_46841;\n                    double zt_res_46842;\n                    double zp_res_46843;\n                    double zs_res_46844;\n                    double min_res_46845;\n                    double zt_res_46846;\n                    double zm_res_46847;\n                    double acos_res_46848;\n                    double zt_res_46849;\n                    \n                    if (angle_t_28472 == (int8_t) 1) {\n                        ",
                                    "d_haversine_res_46829 = eta_p_46823;\n                        d_haversine_res_46830 = eta_p_46824;\n                    } else {\n                        double zt_res_46831;\n                        double zs_res_46832;\n                        double zt_res_46833;\n                        double zs_res_46834;\n                        \n                        zt_res_46831 = 3.141592653589793 * eta_p_46823;\n                        zs_res_46832 = zt_res_46831 / 180.0;\n                        zt_res_46833 = 3.141592653589793 * eta_p_46824;\n                        zs_res_46834 = zt_res_46833 / 180.0;\n                        d_haversine_res_46829 = zs_res_46832;\n                        d_haversine_res_46830 = zs_res_46834;\n                    }\n                    zm_res_46835 = d_haversine_res_46816 - d_haversine_res_46829;\n                    cos_res_46836 = futrts_cos64(zm_res_46835);\n                    zm_res_46837 = 1.0 - cos_res_46836;\n                    cos_res_46838 = futrts_cos64(d_haversine_res_46829);\n                    zt_res_46839 = cos_res_46818 * cos_res_46838;\n                    zm_res_46840 = d_haversine_res_46817 - d_haversine_res_46830;\n                    zm_res_46841 = 1.0 - zm_res_46840;\n                    zt_res_46842 = zt_res_46839 * zm_res_46841;\n                    zp_res_46843 = zm_res_46837 + zt_res_46842;\n                    zs_res_46844 = zp_res_46843 / 2.0;\n                    min_res_46845 = fmin64(1.0, zs_res_46844);\n                    zt_res_46846 = 2.0 * min_res_46845;\n                    zm_res_46847 = 1.0 - zt_res_46846;\n                    acos_res_46848 = futrts_acos64(zm_res_46847);\n                    zt_res_46849 = radius_28473 * acos_res_46848;\n                    dist_res_46825 = zt_res_46849;\n                }\n                zlze_res_46850 = dist_res_46825 <= eps_28470;\n                bool_res_46851 = btoi_bool_i64(zlze_res_46850);\n                zp_res_46854 = add64(bool_res_46851, redout_49003);\n                redout_tmp", "_50229 = zp_res_46854;\n                redout_49003 = redout_tmp_50229;\n            }\n            x_46822 = redout_49003;\n            acc_46821 = x_46822;\n        } else {\n            acc_46821 = acc_46819;\n        }\n        mem_49435[(int64_t) 0] = acc_46821;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        for (int32_t i_7 = 0; i_7 < 1; i_7++)\n            ext_mem_49436[i_7] = mem_49435[i_7];\n    }\n    if (slt64(sext_i32_i64(local_tid_50217) + tile_sizze_46537 * sext_i32_i64(block_id_50218), dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_28504)) {\n        int64_t tmp_50230 = ext_mem_49436[(int64_t) 0];\n        \n        ((__global int64_t *) mem_49379)[inf_28498 + (sext_i32_i64(local_tid_50217) + tile_sizze_46537 * sext_i32_i64(block_id_50218))] = tmp_50230;\n    }\n    \n  error_8:\n    return;\n    #undef tile_sizze_46537\n    #undef bytes_49419\n}\nFUTHARK_KERNEL_SIZED(get_num_neighbours_against_9635zisegred_large_46385_dim1, 1, 1)\nvoid get_num_neighbours_against_9635zisegred_large_46385(__global int *global_failure, int64_t n2_28465, double eps_28470, int8_t dist_t_28471, int8_t angle_t_28472, double radius_28473, int64_t inf_28498, int64_t dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_28504, int64_t num_tblocks_46380, unsigned char x_49348_bits, int64_t blocks_per_segment_50269, int64_t q_50270, int64_t num_virtblocks_50271, int64_t threads_per_segment_50272, __global unsigned char *dat1_mem_49374, __global unsigned char *dat1_mem_49375, __global unsigned char *dat2_mem_49376, __global unsigned char *dat2_mem_49377, __global unsigned char *mem_49379, __global unsigned char *mem_49385, __global unsigned char *mem_49387, __global unsigned char *mem_49389, __global unsigned char *segred_tmp_mem_50273, __global unsigned char *counters_mem_50275)\n{\n    bool x_49348 = x_49348_bits;\n    \n    #define segred_tblock_sizze_46379 (get_num_neighbours_against_9635zisegred_large_46385zisegred_tblock_sizze_46379)\n    #define chunk_sizze_50240 (get_num_neighbours_against_9635zisegred_large_46385zichunk_sizze_5024", "0)\n    \n    volatile __local unsigned char *sync_arr_mem_50304_backing_1 = &shared_mem[0];\n    const int64_t sync_arr_mem_50304_backing_1_offset = 0 + 8;\n    volatile __local unsigned char *red_arr_i64_mem_50302_backing_0 = &shared_mem[sync_arr_mem_50304_backing_1_offset];\n    const int64_t red_arr_i64_mem_50302_backing_0_offset = sync_arr_mem_50304_backing_1_offset + ((int64_t) 8 * segred_tblock_sizze_46379 + srem64((int64_t) 8 - srem64((int64_t) 8 * segred_tblock_sizze_46379, (int64_t) 8), (int64_t) 8));\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_50298;\n    int32_t tblock_sizze_50301;\n    int32_t wave_sizze_50300;\n    int32_t block_id_50299;\n    int32_t global_tid_50297;\n    int64_t phys_tid_46385;\n    __local unsigned char *red_arr_i64_mem_50302;\n    __local unsigned char *sync_arr_mem_50304;\n    int32_t phys_tblock_id_50306;\n    int32_t iterations_50307;\n    \n    local_tid_50298 = get_local_id(0);\n    tblock_sizze_50301 = get_local_size(0);\n    wave_sizze_50300 = LOCKSTEP_WIDTH;\n    block_id_50299 = get_tblock_id(0);\n    global_tid_50297 = block_id_50299 * tblock_sizze_50301 + local_tid_50298;\n    phys_tid_46385 = sext_i32_i64(global_tid_50297);\n    red_arr_i64_mem_50302 = (__local unsigned char *) red_arr_i64_mem_50302_backing_0;\n    sync_arr_mem_50304 = (__local unsigned char *) sync_arr_mem_50304_backing_1;\n    phys_tblock_id_50306 = get_tblock_id(0);\n    iterations_50307 = sdiv_up32(sext_i64_i32(num_virtblocks_50271) - phys_tblock_id_50306, sext_i64_i32(num_tblocks_46380));\n    for (int32_t i_50308 = 0; i_50308 < iterations_50307; i_50308++) {\n        int32_t virt_tblock_id_50309;\n        int64_t flat_segment_id_50310;\n        int64_t global_tid_50311;\n        int64_t slice_50312;\n        int64_t gtid_46383;\n        int64_t remnant_50313;\n        int64_t gtid_46384;\n        int64_t eta_p_block_res_acc_50314;\n        int64_t eta_p_46386;\n        int64_t eta_p_46387;\n        int64_t tblock_id_in_segment_50318;\n        int64_t",
                                    " block_base_offset_50319;\n        int32_t offset_50322;\n        int32_t skip_waves_50323;\n        int64_t eta_p_50315;\n        int64_t eta_p_50316;\n        \n        virt_tblock_id_50309 = phys_tblock_id_50306 + i_50308 * sext_i64_i32(num_tblocks_46380);\n        flat_segment_id_50310 = squot64(sext_i32_i64(virt_tblock_id_50309), blocks_per_segment_50269);\n        global_tid_50311 = srem64(sext_i32_i64(virt_tblock_id_50309) * segred_tblock_sizze_46379 + sext_i32_i64(local_tid_50298), threads_per_segment_50272);\n        slice_50312 = dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_28504;\n        gtid_46383 = flat_segment_id_50310;\n        remnant_50313 = flat_segment_id_50310 - gtid_46383;\n        // ne-initialise the outer (per-block) accumulator(s)\n        {\n            eta_p_block_res_acc_50314 = (int64_t) 0;\n        }\n        tblock_id_in_segment_50318 = squot64(global_tid_50311, segred_tblock_sizze_46379);\n        block_base_offset_50319 = tblock_id_in_segment_50318 * q_50270 * segred_tblock_sizze_46379;\n        for (int64_t i_50320 = 0; i_50320 < q_50270; i_50320++) {\n            int64_t block_offset_50321 = block_base_offset_50319 + i_50320 * segred_tblock_sizze_46379;\n            \n            gtid_46384 = global_tid_50311 + threads_per_segment_50272 * i_50320;\n            if (slt64(gtid_46384, n2_28465)) {\n                // apply map function(s)\n                {\n                    // apply map function\n                    {\n                        int64_t slice_46427 = inf_28498 + gtid_46383;\n                        double eta_p_46394 = ((__global double *) dat2_mem_49376)[gtid_46384];\n                        double eta_p_46395 = ((__global double *) dat2_mem_49377)[gtid_46384];\n                        double d_haversine_res_46391;\n                        \n                        if (x_49348) {\n                            double x_49350 = ((__global double *) mem_49385)[gtid_46383];\n                            \n                            d_haversine_res_46391 = x_49350;\n", "                        } else {\n                            d_haversine_res_46391 = 0.0;\n                        }\n                        \n                        double d_haversine_res_46392;\n                        \n                        if (x_49348) {\n                            double x_49352 = ((__global double *) mem_49387)[gtid_46383];\n                            \n                            d_haversine_res_46392 = x_49352;\n                        } else {\n                            d_haversine_res_46392 = 0.0;\n                        }\n                        \n                        double cos_res_46393;\n                        \n                        if (x_49348) {\n                            double x_49354 = ((__global double *) mem_49389)[gtid_46383];\n                            \n                            cos_res_46393 = x_49354;\n                        } else {\n                            cos_res_46393 = 0.0;\n                        }\n                        \n                        double dist_res_46396;\n                        \n                        if (dist_t_28471 == (int8_t) 0) {\n                            double eta_p_46389 = ((__global double *) dat1_mem_49374)[slice_46427];\n                            double eta_p_46390 = ((__global double *) dat1_mem_49375)[slice_46427];\n                            double zm_res_46397 = eta_p_46390 - eta_p_46395;\n                            double zm_res_46398 = eta_p_46389 - eta_p_46394;\n                            double hypot_res_46399 = futrts_hypot64(zm_res_46398, zm_res_46397);\n                            \n                            dist_res_46396 = hypot_res_46399;\n                        } else {\n                            double d_haversine_res_46400;\n                            double d_haversine_res_46401;\n                            \n                            if (angle_t_28472 == (int8_t) 1) {\n                                d_haversine_res_46400 = eta_p_46394;\n                       ", "         d_haversine_res_46401 = eta_p_46395;\n                            } else {\n                                double zt_res_46402 = 3.141592653589793 * eta_p_46394;\n                                double zs_res_46403 = zt_res_46402 / 180.0;\n                                double zt_res_46404 = 3.141592653589793 * eta_p_46395;\n                                double zs_res_46405 = zt_res_46404 / 180.0;\n                                \n                                d_haversine_res_46400 = zs_res_46403;\n                                d_haversine_res_46401 = zs_res_46405;\n                            }\n                            \n                            double zm_res_46406 = d_haversine_res_46391 - d_haversine_res_46400;\n                            double cos_res_46407 = futrts_cos64(zm_res_46406);\n                            double zm_res_46408 = 1.0 - cos_res_46407;\n                            double cos_res_46409 = futrts_cos64(d_haversine_res_46400);\n                            double zt_res_46410 = cos_res_46393 * cos_res_46409;\n                            double zm_res_46411 = d_haversine_res_46392 - d_haversine_res_46401;\n                            double zm_res_46412 = 1.0 - zm_res_46411;\n                            double zt_res_46413 = zt_res_46410 * zm_res_46412;\n                            double zp_res_46414 = zm_res_46408 + zt_res_46413;\n                            double zs_res_46415 = zp_res_46414 / 2.0;\n                            double min_res_46416 = fmin64(1.0, zs_res_46415);\n                            double zt_res_46417 = 2.0 * min_res_46416;\n                            double zm_res_46418 = 1.0 - zt_res_46417;\n                            double acos_res_46419 = futrts_acos64(zm_res_46418);\n                            double zt_res_46420 = radius_28473 * acos_res_46419;\n                            \n                            dist_res_46396 = zt_res_46420;\n                        }\n                        \n                        bool",
                                    " zlze_res_46421 = dist_res_46396 <= eps_28470;\n                        int64_t bool_res_46422 = btoi_bool_i64(zlze_res_46421);\n                        \n                        // load accumulator(s)\n                        {\n                            eta_p_46386 = eta_p_block_res_acc_50314;\n                        }\n                        // load next value(s)\n                        {\n                            eta_p_46387 = bool_res_46422;\n                        }\n                        // apply reduction operator(s)\n                        {\n                            int64_t zp_res_46388 = add64(eta_p_46386, eta_p_46387);\n                            \n                            // store in accumulator(s)\n                            {\n                                eta_p_block_res_acc_50314 = zp_res_46388;\n                            }\n                        }\n                    }\n                }\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        // store accs. prims go in lmem; non-prims in params (in global mem)\n        {\n            ((__local int64_t *) red_arr_i64_mem_50302)[sext_i32_i64(local_tid_50298)] = eta_p_block_res_acc_50314;\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        skip_waves_50323 = 1;\n        offset_50322 = 0;\n        // participating threads read initial accumulator\n        {\n            if (slt32(local_tid_50298, sext_i64_i32(segred_tblock_sizze_46379))) {\n                eta_p_50315 = ((__local int64_t *) red_arr_i64_mem_50302)[sext_i32_i64(local_tid_50298 + offset_50322)];\n            }\n        }\n        offset_50322 = 1;\n        while (slt32(offset_50322, wave_sizze_50300)) {\n            if (slt32(local_tid_50298 + offset_50322, sext_i64_i32(segred_tblock_sizze_46379)) && ((local_tid_50298 - squot32(local_tid_50298, wave_sizze_50300) * wave_sizze_50300) & (2 * offset_50322 - 1)) == 0) {\n                // read array element\n                {\n                    eta_p_50316 = ((volatile __local int6", "4_t *) red_arr_i64_mem_50302)[sext_i32_i64(local_tid_50298 + offset_50322)];\n                }\n                // apply reduction operation\n                {\n                    int64_t zp_res_50317 = add64(eta_p_50315, eta_p_50316);\n                    \n                    eta_p_50315 = zp_res_50317;\n                }\n                // write result of operation\n                {\n                    ((volatile __local int64_t *) red_arr_i64_mem_50302)[sext_i32_i64(local_tid_50298)] = eta_p_50315;\n                }\n            }\n            offset_50322 *= 2;\n        }\n        while (slt32(skip_waves_50323, squot32(sext_i64_i32(segred_tblock_sizze_46379) + wave_sizze_50300 - 1, wave_sizze_50300))) {\n            barrier(CLK_LOCAL_MEM_FENCE);\n            offset_50322 = skip_waves_50323 * wave_sizze_50300;\n            if (slt32(local_tid_50298 + offset_50322, sext_i64_i32(segred_tblock_sizze_46379)) && ((local_tid_50298 - squot32(local_tid_50298, wave_sizze_50300) * wave_sizze_50300) == 0 && (squot32(local_tid_50298, wave_sizze_50300) & (2 * skip_waves_50323 - 1)) == 0)) {\n                // read array element\n                {\n                    eta_p_50316 = ((__local int64_t *) red_arr_i64_mem_50302)[sext_i32_i64(local_tid_50298 + offset_50322)];\n                }\n                // apply reduction operation\n                {\n                    int64_t zp_res_50317 = add64(eta_p_50315, eta_p_50316);\n                    \n                    eta_p_50315 = zp_res_50317;\n                }\n                // write result of operation\n                {\n                    ((__local int64_t *) red_arr_i64_mem_50302)[sext_i32_i64(local_tid_50298)] = eta_p_50315;\n                }\n            }\n            skip_waves_50323 *= 2;\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        barrier(CLK_LOCAL_MEM_FENCE);\n        // thread 0 updates per-block acc(s); rest reset to ne\n        {\n            if (sext_i32_i64(local_tid_50298) == (int64_t) 0) {\n                eta_p_blo", "ck_res_acc_50314 = eta_p_50315;\n            } else {\n                eta_p_block_res_acc_50314 = (int64_t) 0;\n            }\n        }\n        if (blocks_per_segment_50269 == (int64_t) 1) {\n            // first thread in block saves final result to memory\n            {\n                if (local_tid_50298 == 0) {\n                    ((__global int64_t *) mem_49379)[inf_28498 + gtid_46383] = eta_p_block_res_acc_50314;\n                }\n            }\n        } else {\n            int32_t old_counter_50324;\n            bool is_last_block_50325;\n            \n            // first thread in block saves block result to global memory\n            {\n                if (local_tid_50298 == 0) {\n                    ((__global int64_t *) segred_tmp_mem_50273)[sext_i32_i64(virt_tblock_id_50309)] = eta_p_block_res_acc_50314;\n                    mem_fence_global();\n                    old_counter_50324 = atomic_add_i32_global(&((volatile __global int *) counters_mem_50275)[srem64(flat_segment_id_50310, (int64_t) 20480)], (int) 1);\n                    ((__local bool *) sync_arr_mem_50304)[(int64_t) 0] = old_counter_50324 == sext_i64_i32(blocks_per_segment_50269 - (int64_t) 1);\n                }\n            }\n            barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n            is_last_block_50325 = ((__local bool *) sync_arr_mem_50304)[(int64_t) 0];\n            if (is_last_block_50325) {\n                if (local_tid_50298 == 0) {\n                    old_counter_50324 = atomic_add_i32_global(&((volatile __global int *) counters_mem_50275)[srem64(flat_segment_id_50310, (int64_t) 20480)], (int) sext_i64_i32((int64_t) 0 - blocks_per_segment_50269));\n                }\n                // read in the per-block-results\n                {\n                    int64_t read_per_thread_50326 = sdiv_up64(blocks_per_segment_50269, segred_tblock_sizze_46379);\n                    \n                    eta_p_46386 = (int64_t) 0;\n                    for (int64_t i_50327 = 0; i_50327 < read_per_threa",
                                    "d_50326; i_50327++) {\n                        int64_t block_res_id_50328 = sext_i32_i64(local_tid_50298) * read_per_thread_50326 + i_50327;\n                        int64_t index_of_block_res_50329 = flat_segment_id_50310 * blocks_per_segment_50269 + block_res_id_50328;\n                        \n                        if (slt64(block_res_id_50328, blocks_per_segment_50269)) {\n                            eta_p_46387 = ((__global int64_t *) segred_tmp_mem_50273)[index_of_block_res_50329];\n                            \n                            int64_t zp_res_46388 = add64(eta_p_46386, eta_p_46387);\n                            \n                            eta_p_46386 = zp_res_46388;\n                        }\n                    }\n                }\n                ((__local int64_t *) red_arr_i64_mem_50302)[sext_i32_i64(local_tid_50298)] = eta_p_46386;\n                barrier(CLK_LOCAL_MEM_FENCE);\n                // reduce the per-block results\n                {\n                    int32_t offset_50330;\n                    int32_t skip_waves_50331 = 1;\n                    int64_t eta_p_50315;\n                    int64_t eta_p_50316;\n                    \n                    offset_50330 = 0;\n                    // participating threads read initial accumulator\n                    {\n                        if (slt32(local_tid_50298, sext_i64_i32(segred_tblock_sizze_46379))) {\n                            eta_p_50315 = ((__local int64_t *) red_arr_i64_mem_50302)[sext_i32_i64(local_tid_50298 + offset_50330)];\n                        }\n                    }\n                    offset_50330 = 1;\n                    while (slt32(offset_50330, wave_sizze_50300)) {\n                        if (slt32(local_tid_50298 + offset_50330, sext_i64_i32(segred_tblock_sizze_46379)) && ((local_tid_50298 - squot32(local_tid_50298, wave_sizze_50300) * wave_sizze_50300) & (2 * offset_50330 - 1)) == 0) {\n                            // read array element\n                            {\n             ", "                   eta_p_50316 = ((volatile __local int64_t *) red_arr_i64_mem_50302)[sext_i32_i64(local_tid_50298 + offset_50330)];\n                            }\n                            // apply reduction operation\n                            {\n                                int64_t zp_res_50317 = add64(eta_p_50315, eta_p_50316);\n                                \n                                eta_p_50315 = zp_res_50317;\n                            }\n                            // write result of operation\n                            {\n                                ((volatile __local int64_t *) red_arr_i64_mem_50302)[sext_i32_i64(local_tid_50298)] = eta_p_50315;\n                            }\n                        }\n                        offset_50330 *= 2;\n                    }\n                    while (slt32(skip_waves_50331, squot32(sext_i64_i32(segred_tblock_sizze_46379) + wave_sizze_50300 - 1, wave_sizze_50300))) {\n                        barrier(CLK_LOCAL_MEM_FENCE);\n                        offset_50330 = skip_waves_50331 * wave_sizze_50300;\n                        if (slt32(local_tid_50298 + offset_50330, sext_i64_i32(segred_tblock_sizze_46379)) && ((local_tid_50298 - squot32(local_tid_50298, wave_sizze_50300) * wave_sizze_50300) == 0 && (squot32(local_tid_50298, wave_sizze_50300) & (2 * skip_waves_50331 - 1)) == 0)) {\n                            // read array element\n                            {\n                                eta_p_50316 = ((__local int64_t *) red_arr_i64_mem_50302)[sext_i32_i64(local_tid_50298 + offset_50330)];\n                            }\n                            // apply reduction operation\n                            {\n                                int64_t zp_res_50317 = add64(eta_p_50315, eta_p_50316);\n                                \n                                eta_p_50315 = zp_res_50317;\n                            }\n                            // write result of operation\n                            {\n         ", "                       ((__local int64_t *) red_arr_i64_mem_50302)[sext_i32_i64(local_tid_50298)] = eta_p_50315;\n                            }\n                        }\n                        skip_waves_50331 *= 2;\n                    }\n                    barrier(CLK_LOCAL_MEM_FENCE);\n                    // and back to memory with the final result\n                    {\n                        if (local_tid_50298 == 0) {\n                            ((__global int64_t *) mem_49379)[inf_28498 + gtid_46383] = eta_p_50315;\n                        }\n                    }\n                }\n            }\n        }\n        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    }\n    \n  error_6:\n    return;\n    #undef segred_tblock_sizze_46379\n    #undef chunk_sizze_50240\n}\nFUTHARK_KERNEL_SIZED(get_num_neighbours_against_9635zisegred_small_46385_dim1, 1, 1)\nvoid get_num_neighbours_against_9635zisegred_small_46385(__global int *global_failure, int64_t n2_28465, double eps_28470, int8_t dist_t_28471, int8_t angle_t_28472, double radius_28473, int64_t inf_28498, int64_t dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_28504, int64_t num_tblocks_46380, unsigned char x_49348_bits, int64_t segment_sizze_nonzzero_50241, __global unsigned char *dat1_mem_49374, __global unsigned char *dat1_mem_49375, __global unsigned char *dat2_mem_49376, __global unsigned char *dat2_mem_49377, __global unsigned char *mem_49379, __global unsigned char *mem_49385, __global unsigned char *mem_49387, __global unsigned char *mem_49389)\n{\n    bool x_49348 = x_49348_bits;\n    \n    #define segred_tblock_sizze_46379 (get_num_neighbours_against_9635zisegred_small_46385zisegred_tblock_sizze_46379)\n    \n    volatile __local unsigned char *red_arr_i64_mem_50248_backing_0 = &shared_mem[0];\n    const int64_t red_arr_i64_mem_50248_backing_0_offset = 0 + ((int64_t) 8 * segred_tblock_sizze_46379 + srem64((int64_t) 8 - srem64((int64_t) 8 * segred_tblock_sizze_46379, (int64_t) 8), (int64_t) 8));\n    \n    if (*global_failure >= 0)",
                                    "\n        return;\n    \n    int32_t local_tid_50244;\n    int32_t tblock_sizze_50247;\n    int32_t wave_sizze_50246;\n    int32_t block_id_50245;\n    int32_t global_tid_50243;\n    int64_t phys_tid_46385;\n    __local unsigned char *red_arr_i64_mem_50248;\n    int32_t phys_tblock_id_50250;\n    int32_t iterations_50251;\n    \n    local_tid_50244 = get_local_id(0);\n    tblock_sizze_50247 = get_local_size(0);\n    wave_sizze_50246 = LOCKSTEP_WIDTH;\n    block_id_50245 = get_tblock_id(0);\n    global_tid_50243 = block_id_50245 * tblock_sizze_50247 + local_tid_50244;\n    phys_tid_46385 = sext_i32_i64(global_tid_50243);\n    red_arr_i64_mem_50248 = (__local unsigned char *) red_arr_i64_mem_50248_backing_0;\n    phys_tblock_id_50250 = get_tblock_id(0);\n    iterations_50251 = sdiv_up32(sext_i64_i32(sdiv_up64(dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_28504, squot64(segred_tblock_sizze_46379, segment_sizze_nonzzero_50241))) - phys_tblock_id_50250, sext_i64_i32(num_tblocks_46380));\n    for (int32_t i_50252 = 0; i_50252 < iterations_50251; i_50252++) {\n        int32_t virt_tblock_id_50253;\n        int64_t slice_50254;\n        int64_t gtid_46383;\n        int64_t remnant_50255;\n        int64_t gtid_46384;\n        \n        virt_tblock_id_50253 = phys_tblock_id_50250 + i_50252 * sext_i64_i32(num_tblocks_46380);\n        slice_50254 = dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_28504;\n        gtid_46383 = squot64(sext_i32_i64(local_tid_50244), segment_sizze_nonzzero_50241) + sext_i32_i64(virt_tblock_id_50253) * squot64(segred_tblock_sizze_46379, segment_sizze_nonzzero_50241);\n        remnant_50255 = squot64(sext_i32_i64(local_tid_50244), segment_sizze_nonzzero_50241) + sext_i32_i64(virt_tblock_id_50253) * squot64(segred_tblock_sizze_46379, segment_sizze_nonzzero_50241) - gtid_46383;\n        gtid_46384 = srem64(sext_i32_i64(local_tid_50244), n2_28465);\n        // apply map function if in bounds\n        {\n            if (slt64((int64_t) 0, n2_28465) && (slt64(gtid_46383, dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_28504) && sl", "t64(sext_i32_i64(local_tid_50244), n2_28465 * squot64(segred_tblock_sizze_46379, segment_sizze_nonzzero_50241)))) {\n                // apply map function\n                {\n                    int64_t slice_46427 = inf_28498 + gtid_46383;\n                    double eta_p_46394 = ((__global double *) dat2_mem_49376)[gtid_46384];\n                    double eta_p_46395 = ((__global double *) dat2_mem_49377)[gtid_46384];\n                    double d_haversine_res_46391;\n                    \n                    if (x_49348) {\n                        double x_49350 = ((__global double *) mem_49385)[gtid_46383];\n                        \n                        d_haversine_res_46391 = x_49350;\n                    } else {\n                        d_haversine_res_46391 = 0.0;\n                    }\n                    \n                    double d_haversine_res_46392;\n                    \n                    if (x_49348) {\n                        double x_49352 = ((__global double *) mem_49387)[gtid_46383];\n                        \n                        d_haversine_res_46392 = x_49352;\n                    } else {\n                        d_haversine_res_46392 = 0.0;\n                    }\n                    \n                    double cos_res_46393;\n                    \n                    if (x_49348) {\n                        double x_49354 = ((__global double *) mem_49389)[gtid_46383];\n                        \n                        cos_res_46393 = x_49354;\n                    } else {\n                        cos_res_46393 = 0.0;\n                    }\n                    \n                    double dist_res_46396;\n                    \n                    if (dist_t_28471 == (int8_t) 0) {\n                        double eta_p_46389 = ((__global double *) dat1_mem_49374)[slice_46427];\n                        double eta_p_46390 = ((__global double *) dat1_mem_49375)[slice_46427];\n                        double zm_res_46397 = eta_p_46390 - eta_p_46395;\n                        ", "double zm_res_46398 = eta_p_46389 - eta_p_46394;\n                        double hypot_res_46399 = futrts_hypot64(zm_res_46398, zm_res_46397);\n                        \n                        dist_res_46396 = hypot_res_46399;\n                    } else {\n                        double d_haversine_res_46400;\n                        double d_haversine_res_46401;\n                        \n                        if (angle_t_28472 == (int8_t) 1) {\n                            d_haversine_res_46400 = eta_p_46394;\n                            d_haversine_res_46401 = eta_p_46395;\n                        } else {\n                            double zt_res_46402 = 3.141592653589793 * eta_p_46394;\n                            double zs_res_46403 = zt_res_46402 / 180.0;\n                            double zt_res_46404 = 3.141592653589793 * eta_p_46395;\n                            double zs_res_46405 = zt_res_46404 / 180.0;\n                            \n                            d_haversine_res_46400 = zs_res_46403;\n                            d_haversine_res_46401 = zs_res_46405;\n                        }\n                        \n                        double zm_res_46406 = d_haversine_res_46391 - d_haversine_res_46400;\n                        double cos_res_46407 = futrts_cos64(zm_res_46406);\n                        double zm_res_46408 = 1.0 - cos_res_46407;\n                        double cos_res_46409 = futrts_cos64(d_haversine_res_46400);\n                        double zt_res_46410 = cos_res_46393 * cos_res_46409;\n                        double zm_res_46411 = d_haversine_res_46392 - d_haversine_res_46401;\n                        double zm_res_46412 = 1.0 - zm_res_46411;\n                        double zt_res_46413 = zt_res_46410 * zm_res_46412;\n                        double zp_res_46414 = zm_res_46408 + zt_res_46413;\n                        double zs_res_46415 = zp_res_46414 / 2.0;\n                        double min_res_46416 = fmin64(1.0, zs_res_46415);\n                        ",
                                    "double zt_res_46417 = 2.0 * min_res_46416;\n                        double zm_res_46418 = 1.0 - zt_res_46417;\n                        double acos_res_46419 = futrts_acos64(zm_res_46418);\n                        double zt_res_46420 = radius_28473 * acos_res_46419;\n                        \n                        dist_res_46396 = zt_res_46420;\n                    }\n                    \n                    bool zlze_res_46421 = dist_res_46396 <= eps_28470;\n                    int64_t bool_res_46422 = btoi_bool_i64(zlze_res_46421);\n                    \n                    // save results to be reduced\n                    {\n                        ((__local int64_t *) red_arr_i64_mem_50248)[sext_i32_i64(local_tid_50244)] = bool_res_46422;\n                    }\n                }\n            } else {\n                ((__local int64_t *) red_arr_i64_mem_50248)[sext_i32_i64(local_tid_50244)] = (int64_t) 0;\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        if (slt64((int64_t) 0, n2_28465)) {\n            // perform segmented scan to imitate reduction\n            {\n                int64_t eta_p_46386;\n                int64_t eta_p_46387;\n                int64_t eta_p_50256;\n                int64_t eta_p_50257;\n                bool ltid_in_bounds_50259 = slt64(sext_i32_i64(local_tid_50244), n2_28465 * squot64(segred_tblock_sizze_46379, segment_sizze_nonzzero_50241));\n                int32_t skip_threads_50260;\n                \n                // read input for in-block scan\n                {\n                    if (ltid_in_bounds_50259) {\n                        eta_p_46387 = ((volatile __local int64_t *) red_arr_i64_mem_50248)[sext_i32_i64(local_tid_50244)];\n                        if ((local_tid_50244 - squot32(local_tid_50244, 32) * 32) == 0) {\n                            eta_p_46386 = eta_p_46387;\n                        }\n                    }\n                }\n                // in-block scan (hopefully no barriers needed)\n                {\n             ", "       skip_threads_50260 = 1;\n                    while (slt32(skip_threads_50260, 32)) {\n                        bool thread_active_50261 = sle32(skip_threads_50260, local_tid_50244 - squot32(local_tid_50244, 32) * 32) && ltid_in_bounds_50259;\n                        \n                        if (thread_active_50261) {\n                            // read operands\n                            {\n                                eta_p_46386 = ((volatile __local int64_t *) red_arr_i64_mem_50248)[sext_i32_i64(local_tid_50244) - sext_i32_i64(skip_threads_50260)];\n                            }\n                        }\n                        // perform operation\n                        {\n                            bool inactive_50262 = slt64(srem64(sext_i32_i64(local_tid_50244), n2_28465), sext_i32_i64(local_tid_50244) - sext_i32_i64(local_tid_50244 - skip_threads_50260));\n                            \n                            if (thread_active_50261 && inactive_50262) {\n                                eta_p_46386 = eta_p_46387;\n                            }\n                            if (thread_active_50261) {\n                                if (!inactive_50262) {\n                                    int64_t zp_res_46388 = add64(eta_p_46386, eta_p_46387);\n                                    \n                                    eta_p_46386 = zp_res_46388;\n                                }\n                            }\n                        }\n                        if (sle32(wave_sizze_50246, skip_threads_50260)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        if (thread_active_50261) {\n                            // write result\n                            {\n                                ((volatile __local int64_t *) red_arr_i64_mem_50248)[sext_i32_i64(local_tid_50244)] = eta_p_46386;\n                                eta_p_46387 = eta_p_46386;\n                            }\n                        }\n      ", "                  if (sle32(wave_sizze_50246, skip_threads_50260)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        skip_threads_50260 *= 2;\n                    }\n                }\n                barrier(CLK_LOCAL_MEM_FENCE);\n                // last thread of block 'i' writes its result to offset 'i'\n                {\n                    if ((local_tid_50244 - squot32(local_tid_50244, 32) * 32) == 31 && ltid_in_bounds_50259) {\n                        ((volatile __local int64_t *) red_arr_i64_mem_50248)[sext_i32_i64(squot32(local_tid_50244, 32))] = eta_p_46386;\n                    }\n                }\n                barrier(CLK_LOCAL_MEM_FENCE);\n                // scan the first block, after which offset 'i' contains carry-in for block 'i+1'\n                {\n                    int32_t skip_threads_50263;\n                    \n                    // read input for in-block scan\n                    {\n                        if (squot32(local_tid_50244, 32) == 0 && ltid_in_bounds_50259) {\n                            eta_p_50257 = ((volatile __local int64_t *) red_arr_i64_mem_50248)[sext_i32_i64(local_tid_50244)];\n                            if ((local_tid_50244 - squot32(local_tid_50244, 32) * 32) == 0) {\n                                eta_p_50256 = eta_p_50257;\n                            }\n                        }\n                    }\n                    // in-block scan (hopefully no barriers needed)\n                    {\n                        skip_threads_50263 = 1;\n                        while (slt32(skip_threads_50263, 32)) {\n                            bool thread_active_50264 = sle32(skip_threads_50263, local_tid_50244 - squot32(local_tid_50244, 32) * 32) && (squot32(local_tid_50244, 32) == 0 && ltid_in_bounds_50259);\n                            \n                            if (thread_active_50264) {\n                                // read operands\n                                {\n            ",
                                    "                        eta_p_50256 = ((volatile __local int64_t *) red_arr_i64_mem_50248)[sext_i32_i64(local_tid_50244) - sext_i32_i64(skip_threads_50263)];\n                                }\n                            }\n                            // perform operation\n                            {\n                                bool inactive_50265 = slt64(srem64(sext_i32_i64(local_tid_50244 * 32 + 32 - 1), n2_28465), sext_i32_i64(local_tid_50244 * 32 + 32 - 1) - sext_i32_i64((local_tid_50244 - skip_threads_50263) * 32 + 32 - 1));\n                                \n                                if (thread_active_50264 && inactive_50265) {\n                                    eta_p_50256 = eta_p_50257;\n                                }\n                                if (thread_active_50264) {\n                                    if (!inactive_50265) {\n                                        int64_t zp_res_50258 = add64(eta_p_50256, eta_p_50257);\n                                        \n                                        eta_p_50256 = zp_res_50258;\n                                    }\n                                }\n                            }\n                            if (sle32(wave_sizze_50246, skip_threads_50263)) {\n                                barrier(CLK_LOCAL_MEM_FENCE);\n                            }\n                            if (thread_active_50264) {\n                                // write result\n                                {\n                                    ((volatile __local int64_t *) red_arr_i64_mem_50248)[sext_i32_i64(local_tid_50244)] = eta_p_50256;\n                                    eta_p_50257 = eta_p_50256;\n                                }\n                            }\n                            if (sle32(wave_sizze_50246, skip_threads_50263)) {\n                                barrier(CLK_LOCAL_MEM_FENCE);\n                            }\n                            skip_threads_50263 *= 2;\n                        }\n         ", "           }\n                }\n                barrier(CLK_LOCAL_MEM_FENCE);\n                \n                bool no_carry_in_50266 = squot32(local_tid_50244, 32) == 0 || !ltid_in_bounds_50259;\n                \n                // carry-in for every block except the first\n                {\n                    // read operands\n                    {\n                        if (!no_carry_in_50266) {\n                            eta_p_46387 = eta_p_46386;\n                            eta_p_46386 = ((__local int64_t *) red_arr_i64_mem_50248)[sext_i32_i64(squot32(local_tid_50244, 32)) - (int64_t) 1];\n                        }\n                    }\n                    // perform operation\n                    {\n                        bool inactive_50267 = slt64(srem64(sext_i32_i64(local_tid_50244), n2_28465), sext_i32_i64(local_tid_50244) - sext_i32_i64(squot32(local_tid_50244, 32) * 32 - 1));\n                        \n                        if (!no_carry_in_50266) {\n                            if (inactive_50267) {\n                                eta_p_46386 = eta_p_46387;\n                            }\n                        }\n                        if (!no_carry_in_50266) {\n                            if (!inactive_50267) {\n                                int64_t zp_res_46388 = add64(eta_p_46386, eta_p_46387);\n                                \n                                eta_p_46386 = zp_res_46388;\n                            }\n                        }\n                    }\n                    // write final result\n                    {\n                        if (!no_carry_in_50266) {\n                            ((__local int64_t *) red_arr_i64_mem_50248)[sext_i32_i64(local_tid_50244)] = eta_p_46386;\n                        }\n                    }\n                }\n                barrier(CLK_LOCAL_MEM_FENCE);\n                // restore correct values for first block\n                {\n                    if (squot32(local_tid_50244, 32) == 0 && ltid_in_bounds_50259)", " {\n                        ((__local int64_t *) red_arr_i64_mem_50248)[sext_i32_i64(local_tid_50244)] = eta_p_46387;\n                    }\n                }\n                barrier(CLK_LOCAL_MEM_FENCE);\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        // save final values of segments\n        {\n            if (slt64(sext_i32_i64(virt_tblock_id_50253) * squot64(segred_tblock_sizze_46379, segment_sizze_nonzzero_50241) + sext_i32_i64(local_tid_50244), dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_28504) && slt64(sext_i32_i64(local_tid_50244), squot64(segred_tblock_sizze_46379, segment_sizze_nonzzero_50241))) {\n                int64_t tmp_50268 = ((__local int64_t *) red_arr_i64_mem_50248)[(sext_i32_i64(local_tid_50244) + (int64_t) 1) * segment_sizze_nonzzero_50241 - (int64_t) 1];\n                \n                ((__global int64_t *) mem_49379)[inf_28498 + (sext_i32_i64(virt_tblock_id_50253) * squot64(segred_tblock_sizze_46379, segment_sizze_nonzzero_50241) + sext_i32_i64(local_tid_50244))] = tmp_50268;\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    }\n    \n  error_3:\n    return;\n    #undef segred_tblock_sizze_46379\n}\nFUTHARK_KERNEL_SIZED(make_collisions_compact_doublezisegmap_42997_dim1, 1, 1)\nvoid make_collisions_compact_doublezisegmap_42997(__global int *global_failure, int64_t dz2084U_35570, int64_t m_37825, int64_t num_tblocks_43002, int32_t virt_num_tblocks_50402, __global unsigned char *chain_collisions_mem_49374, __global unsigned char *chain_collisions_mem_49375, __global unsigned char *mem_49503, __global unsigned char *mem_49505, __global unsigned char *mem_49507, __global unsigned char *mem_49509)\n{\n    #define segmap_tblock_sizze_43000 (make_collisions_compact_doublezisegmap_42997zisegmap_tblock_sizze_43000)\n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_50404;\n    int32_t tblock_sizze_50407;\n    int32_t wave_sizze_50406;\n    int32_t block_id_50",
                                    "405;\n    int32_t global_tid_50403;\n    int64_t phys_tid_42997;\n    int32_t phys_tblock_id_50408;\n    int32_t iterations_50409;\n    \n    local_tid_50404 = get_local_id(0);\n    tblock_sizze_50407 = get_local_size(0);\n    wave_sizze_50406 = LOCKSTEP_WIDTH;\n    block_id_50405 = get_tblock_id(0);\n    global_tid_50403 = block_id_50405 * tblock_sizze_50407 + local_tid_50404;\n    phys_tid_42997 = sext_i32_i64(global_tid_50403);\n    phys_tblock_id_50408 = get_tblock_id(0);\n    iterations_50409 = sdiv_up32(virt_num_tblocks_50402 - phys_tblock_id_50408, sext_i64_i32(num_tblocks_43002));\n    for (int32_t i_50410 = 0; i_50410 < iterations_50409; i_50410++) {\n        int32_t virt_tblock_id_50411;\n        int64_t global_tid_50412;\n        int64_t slice_50413;\n        int64_t write_i_42996;\n        int64_t remnant_50414;\n        \n        virt_tblock_id_50411 = phys_tblock_id_50408 + i_50410 * sext_i64_i32(num_tblocks_43002);\n        global_tid_50412 = sext_i32_i64(virt_tblock_id_50411) * segmap_tblock_sizze_43000 + sext_i32_i64(local_tid_50404);\n        slice_50413 = dz2084U_35570;\n        write_i_42996 = global_tid_50412;\n        remnant_50414 = global_tid_50412 - write_i_42996;\n        if (slt64(write_i_42996, dz2084U_35570)) {\n            int64_t eta_p_42187;\n            int64_t write_value_42189;\n            int64_t write_value_42190;\n            bool cond_42191;\n            int64_t lifted_lambda_res_42192;\n            \n            eta_p_42187 = ((__global int64_t *) mem_49505)[write_i_42996];\n            write_value_42189 = ((__global int64_t *) chain_collisions_mem_49374)[write_i_42996];\n            write_value_42190 = ((__global int64_t *) chain_collisions_mem_49375)[write_i_42996];\n            cond_42191 = eta_p_42187 == (int64_t) 1;\n            if (cond_42191) {\n                int64_t eta_p_42188;\n                int64_t lifted_lambda_res_t_res_42224;\n                \n                eta_p_42188 = ((__global int64_t *) mem_49503)[write_i_42996];\n                lifted_lam", "bda_res_t_res_42224 = sub64(eta_p_42188, (int64_t) 1);\n                lifted_lambda_res_42192 = lifted_lambda_res_t_res_42224;\n            } else {\n                lifted_lambda_res_42192 = (int64_t) -1;\n            }\n            if (sle64((int64_t) 0, lifted_lambda_res_42192) && slt64(lifted_lambda_res_42192, m_37825)) {\n                ((__global int64_t *) mem_49509)[lifted_lambda_res_42192] = write_value_42189;\n            }\n            if (sle64((int64_t) 0, lifted_lambda_res_42192) && slt64(lifted_lambda_res_42192, m_37825)) {\n                ((__global int64_t *) mem_49507)[lifted_lambda_res_42192] = write_value_42190;\n            }\n        }\n        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    }\n    \n  error_1:\n    return;\n    #undef segmap_tblock_sizze_43000\n}\nFUTHARK_KERNEL_SIZED(make_collisions_compact_doublezisegmap_intrablock_46535_dim1, 1, 1)\nvoid make_collisions_compact_doublezisegmap_intrablock_46535(__global int *global_failure, int failure_is_an_option, __global int64_t *global_failure_args, int64_t dz2084U_35570, int64_t inf_37750, int64_t dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_37753, int64_t ldim_46538, int64_t num_whole_tiles_46563, int64_t residual_input_46715, unsigned char cond_46716_bits, int64_t binop_x_46729, __global unsigned char *chain_collisions_mem_49374, __global unsigned char *chain_collisions_mem_49375, __global unsigned char *mem_49401)\n{\n    bool cond_46716 = cond_46716_bits;\n    \n    #define tile_sizze_46537 (make_collisions_compact_doublezisegmap_intrablock_46535zitile_sizze_46537)\n    #define bytes_49470 (make_collisions_compact_doublezisegmap_intrablock_46535zibytes_49470)\n    \n    volatile __local unsigned char *color_50173_backing_1 = &shared_mem[0];\n    const int64_t color_50173_backing_1_offset = 0 + (bytes_49470 + srem64((int64_t) 8 - srem64(bytes_49470, (int64_t) 8), (int64_t) 8));\n    volatile __local unsigned char *color_50172_backing_0 = &shared_mem[color_50173_backing_1_offset];\n    const int64_t color_50172", "_backing_0_offset = color_50173_backing_1_offset + (bytes_49470 + srem64((int64_t) 8 - srem64(bytes_49470, (int64_t) 8), (int64_t) 8));\n    volatile __local int local_failure;\n    \n    if (failure_is_an_option) {\n        int failed = *global_failure >= 0;\n        \n        if (failed)\n            return;\n    }\n    local_failure = 0;\n    barrier(CLK_LOCAL_MEM_FENCE);\n    \n    int32_t local_tid_50218;\n    int32_t tblock_sizze_50221;\n    int32_t wave_sizze_50220;\n    int32_t block_id_50219;\n    int32_t global_tid_50217;\n    int64_t gid_flat_46535;\n    int64_t slice_50223;\n    int64_t ltid_pre_50222;\n    int64_t remnant_50224;\n    int64_t slice_50225;\n    int64_t gid_46534;\n    int64_t remnant_50226;\n    __local unsigned char *color_50172;\n    __local unsigned char *color_50173;\n    int64_t binop_x_46547;\n    int64_t mem_49455[1];\n    int64_t mem_49459[1];\n    int64_t ltid_flat_46540;\n    int64_t ltid_46539;\n    int64_t gtid_46548;\n    bool cond_46549;\n    int64_t pre_46550;\n    int64_t pre_46551;\n    int64_t mem_49463[1];\n    int64_t mem_49467[1];\n    int64_t ltid_flat_46565;\n    int64_t ltid_46564;\n    int64_t gtid_46573;\n    bool cond_46574;\n    int64_t neutral_46575;\n    int64_t neutral_46576;\n    int64_t ext_mem_49483[1];\n    int64_t ext_mem_49482[1];\n    int64_t mem_param_49468[1];\n    int64_t mem_param_49469[1];\n    int64_t mem_49491[1];\n    int64_t ext_mem_49492[1];\n    bool mem_49495[1];\n    int64_t ltid_flat_46787;\n    int64_t ltid_46786;\n    int64_t gtid_46793;\n    bool cond_46796;\n    bool postlude_46797;\n    \n    local_tid_50218 = get_local_id(0);\n    tblock_sizze_50221 = get_local_size(0);\n    wave_sizze_50220 = LOCKSTEP_WIDTH;\n    block_id_50219 = get_tblock_id(0);\n    global_tid_50217 = block_id_50219 * tblock_sizze_50221 + local_tid_50218;\n    gid_flat_46535 = sext_i32_i64(block_id_50219);\n    slice_50223 = tile_sizze_46537;\n    ltid_pre_50222 = sext_i32_i64(local_tid_50218);\n    remnant_50224 = sext_i32_i64(local_tid_50218) - ltid_pre_50222;\n    slice_5",
                                    "0225 = ldim_46538;\n    gid_46534 = sext_i32_i64(block_id_50219);\n    remnant_50226 = sext_i32_i64(block_id_50219) - gid_46534;\n    color_50172 = (__local unsigned char *) color_50172_backing_0;\n    color_50173 = (__local unsigned char *) color_50173_backing_1;\n    binop_x_46547 = gid_46534 * tile_sizze_46537;\n    ltid_flat_46540 = sext_i32_i64(local_tid_50218);\n    ltid_46539 = sext_i32_i64(sext_i64_i32(ltid_pre_50222));\n    gtid_46548 = ltid_46539 + binop_x_46547;\n    cond_46549 = slt64(gtid_46548, dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_37753);\n    if (cond_46549) {\n        int64_t index_primexp_46552;\n        bool x_46553;\n        bool y_46554;\n        bool bounds_check_46555;\n        bool index_certs_46556;\n        int64_t lifted_lambda_res_46557;\n        int64_t lifted_lambda_res_46558;\n        \n        index_primexp_46552 = add64(inf_37750, gtid_46548);\n        x_46553 = sle64((int64_t) 0, index_primexp_46552);\n        y_46554 = slt64(index_primexp_46552, dz2084U_35570);\n        bounds_check_46555 = x_46553 && y_46554;\n        if (!bounds_check_46555) {\n            {\n                if (atomic_cmpxchg_i32_global(global_failure, -1, 22) == -1) {\n                    global_failure_args[0] = (int64_t) index_primexp_46552;\n                    global_failure_args[1] = (int64_t) dz2084U_35570;\n                    ;\n                }\n                local_failure = 1;\n                goto error_0;\n            }\n        }\n        lifted_lambda_res_46557 = ((__global int64_t *) chain_collisions_mem_49374)[index_primexp_46552];\n        lifted_lambda_res_46558 = ((__global int64_t *) chain_collisions_mem_49375)[index_primexp_46552];\n        pre_46550 = lifted_lambda_res_46557;\n        pre_46551 = lifted_lambda_res_46558;\n    } else {\n        pre_46550 = (int64_t) 0;\n        pre_46551 = (int64_t) 0;\n    }\n    mem_49455[(int64_t) 0] = pre_46550;\n    mem_49459[(int64_t) 0] = pre_46551;\n    \n  error_0:\n    barrier(CLK_LOCAL_MEM_FENCE);\n    if (local_failure)\n        return;\n    ba", "rrier(CLK_LOCAL_MEM_FENCE);\n    ltid_flat_46565 = sext_i32_i64(local_tid_50218);\n    ltid_46564 = sext_i32_i64(sext_i64_i32(ltid_pre_50222));\n    gtid_46573 = binop_x_46547 + ltid_46564;\n    cond_46574 = slt64(gtid_46573, dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_37753);\n    if (cond_46574) {\n        int64_t lifted_lambda_res_46577;\n        int64_t lifted_lambda_res_46578;\n        \n        lifted_lambda_res_46577 = mem_49455[(int64_t) 0];\n        lifted_lambda_res_46578 = mem_49459[(int64_t) 0];\n        neutral_46575 = lifted_lambda_res_46577;\n        neutral_46576 = lifted_lambda_res_46578;\n    } else {\n        neutral_46575 = (int64_t) 0;\n        neutral_46576 = (int64_t) 0;\n    }\n    mem_49463[(int64_t) 0] = neutral_46575;\n    mem_49467[(int64_t) 0] = neutral_46576;\n    barrier(CLK_LOCAL_MEM_FENCE);\n    barrier(CLK_LOCAL_MEM_FENCE);\n    for (int32_t i_2 = 0; i_2 < 1; i_2++)\n        mem_param_49468[i_2] = mem_49463[i_2];\n    for (int32_t i_3 = 0; i_3 < 1; i_3++)\n        mem_param_49469[i_3] = mem_49467[i_3];\n    for (int64_t tile_id_46585 = 0; tile_id_46585 < num_whole_tiles_46563; tile_id_46585++) {\n        int64_t binop_x_46655;\n        int64_t ltid_flat_46654;\n        int64_t ltid_46653;\n        int64_t j_46656;\n        bool cond_46661;\n        int64_t pre1d_46662;\n        int64_t pre1d_46663;\n        int64_t mem_49477[1];\n        int64_t mem_49481[1];\n        int64_t ltid_flat_46671;\n        int64_t ltid_46670;\n        int64_t gtid_46673;\n        int64_t acc_46676;\n        int64_t acc_46677;\n        bool cond_46678;\n        int64_t acc_46679;\n        int64_t acc_46680;\n        int64_t mem_param_tmp_50227[1];\n        int64_t mem_param_tmp_50228[1];\n        \n        binop_x_46655 = tile_sizze_46537 * tile_id_46585;\n        ltid_flat_46654 = sext_i32_i64(local_tid_50218);\n        ltid_46653 = sext_i32_i64(sext_i64_i32(ltid_pre_50222));\n        j_46656 = ltid_46653 + binop_x_46655;\n        cond_46661 = slt64(j_46656, dz2084U_35570);\n        if (cond_46661) {\n            i", "nt64_t tile_elem_46664;\n            int64_t tile_elem_46665;\n            \n            tile_elem_46664 = ((__global int64_t *) chain_collisions_mem_49374)[j_46656];\n            tile_elem_46665 = ((__global int64_t *) chain_collisions_mem_49375)[j_46656];\n            pre1d_46662 = tile_elem_46664;\n            pre1d_46663 = tile_elem_46665;\n        } else {\n            pre1d_46662 = (int64_t) 0;\n            pre1d_46663 = (int64_t) 0;\n        }\n        ((__local int64_t *) color_50173)[ltid_46653] = pre1d_46662;\n        ((__local int64_t *) color_50172)[ltid_46653] = pre1d_46663;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        ltid_flat_46671 = sext_i32_i64(local_tid_50218);\n        ltid_46670 = sext_i32_i64(sext_i64_i32(ltid_pre_50222));\n        gtid_46673 = binop_x_46547 + ltid_46670;\n        acc_46676 = mem_param_49468[(int64_t) 0];\n        acc_46677 = mem_param_49469[(int64_t) 0];\n        cond_46678 = slt64(gtid_46673, dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_37753);\n        if (cond_46678) {\n            int64_t lifted_lambda_res_46674;\n            int64_t x_46681;\n            int64_t x_46682;\n            int64_t redout_49001;\n            int64_t redout_49002;\n            \n            lifted_lambda_res_46674 = mem_49455[(int64_t) 0];\n            redout_49001 = acc_46676;\n            redout_49002 = acc_46677;\n            for (int64_t i_49003 = 0; i_49003 < tile_sizze_46537; i_49003++) {\n                int64_t x_46683;\n                int64_t x_46684;\n                bool cond_46689;\n                bool cond_46690;\n                bool cond_46691;\n                bool cond_f_res_t_res_46692;\n                bool x_46693;\n                bool y_46694;\n                bool cond_46695;\n                int64_t lifted_lambda_res_46696;\n                int64_t lifted_lambda_res_46697;\n                int64_t redout_tmp_50231;\n                int64_t redout_tmp_50232;\n                \n                x_46683 = ((__local int64_t *) color_50173)[i_49003];\n                x_46684 = ((",
                                    "__local int64_t *) color_50172)[i_49003];\n                cond_46689 = redout_49001 == lifted_lambda_res_46674;\n                cond_46690 = !cond_46689;\n                cond_46691 = x_46683 == lifted_lambda_res_46674;\n                cond_f_res_t_res_46692 = slt64(x_46684, redout_49002);\n                x_46693 = cond_46691 && cond_f_res_t_res_46692;\n                y_46694 = cond_46689 && x_46693;\n                cond_46695 = cond_46690 || y_46694;\n                if (cond_46695) {\n                    lifted_lambda_res_46696 = x_46683;\n                } else {\n                    lifted_lambda_res_46696 = redout_49001;\n                }\n                if (cond_46695) {\n                    lifted_lambda_res_46697 = x_46684;\n                } else {\n                    lifted_lambda_res_46697 = redout_49002;\n                }\n                redout_tmp_50231 = lifted_lambda_res_46696;\n                redout_tmp_50232 = lifted_lambda_res_46697;\n                redout_49001 = redout_tmp_50231;\n                redout_49002 = redout_tmp_50232;\n            }\n            x_46681 = redout_49001;\n            x_46682 = redout_49002;\n            acc_46679 = x_46681;\n            acc_46680 = x_46682;\n        } else {\n            acc_46679 = acc_46676;\n            acc_46680 = acc_46677;\n        }\n        mem_49477[(int64_t) 0] = acc_46679;\n        mem_49481[(int64_t) 0] = acc_46680;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        for (int32_t i_4 = 0; i_4 < 1; i_4++)\n            mem_param_tmp_50227[i_4] = mem_49477[i_4];\n        for (int32_t i_5 = 0; i_5 < 1; i_5++)\n            mem_param_tmp_50228[i_5] = mem_49481[i_5];\n        for (int32_t i_6 = 0; i_6 < 1; i_6++)\n            mem_param_49468[i_6] = mem_param_tmp_50227[i_6];\n        for (int32_t i_7 = 0; i_7 < 1; i_7++)\n            mem_param_49469[i_7] = mem_param_tmp_50228[i_7];\n    }\n    for (int32_t i_8 = 0; i_8 < 1; i_8++)\n        ext_mem_49483[i_8] = mem_param_49468[i_8];\n    for (int32_t i_9 = 0; i_9 < 1; i_9++)\n        ext", "_mem_49482[i_9] = mem_param_49469[i_9];\n    barrier(CLK_LOCAL_MEM_FENCE);\n    if (cond_46716) {\n        for (int32_t i_10 = 0; i_10 < 1; i_10++)\n            ext_mem_49492[i_10] = ext_mem_49482[i_10];\n    } else {\n        int64_t ltid_flat_46718;\n        int64_t ltid_46717;\n        int64_t j_46730;\n        bool cond_46735;\n        int64_t pre1d_46736;\n        int64_t pre1d_46737;\n        int64_t ltid_flat_46747;\n        int64_t ltid_46746;\n        int64_t gtid_46757;\n        int64_t acc_46761;\n        bool cond_46762;\n        int64_t acc_46764;\n        \n        ltid_flat_46718 = sext_i32_i64(local_tid_50218);\n        ltid_46717 = sext_i32_i64(sext_i64_i32(ltid_pre_50222));\n        j_46730 = ltid_46717 + binop_x_46729;\n        cond_46735 = slt64(j_46730, dz2084U_35570);\n        if (cond_46735) {\n            int64_t tile_elem_46738;\n            int64_t tile_elem_46739;\n            \n            tile_elem_46738 = ((__global int64_t *) chain_collisions_mem_49374)[j_46730];\n            tile_elem_46739 = ((__global int64_t *) chain_collisions_mem_49375)[j_46730];\n            pre1d_46736 = tile_elem_46738;\n            pre1d_46737 = tile_elem_46739;\n        } else {\n            pre1d_46736 = (int64_t) 0;\n            pre1d_46737 = (int64_t) 0;\n        }\n        ((__local int64_t *) color_50173)[ltid_46717] = pre1d_46736;\n        ((__local int64_t *) color_50172)[ltid_46717] = pre1d_46737;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        ltid_flat_46747 = sext_i32_i64(local_tid_50218);\n        ltid_46746 = sext_i32_i64(sext_i64_i32(ltid_pre_50222));\n        gtid_46757 = binop_x_46547 + ltid_46746;\n        acc_46761 = ext_mem_49482[(int64_t) 0];\n        cond_46762 = slt64(gtid_46757, dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_37753);\n        if (cond_46762) {\n            int64_t lifted_lambda_res_46758;\n            int64_t acc_46760;\n            int64_t x_46765;\n            int64_t x_46766;\n            int64_t redout_49004;\n            int64_t redout_49005;\n            \n            lifted_l", "ambda_res_46758 = mem_49455[(int64_t) 0];\n            acc_46760 = ext_mem_49483[(int64_t) 0];\n            redout_49004 = acc_46760;\n            redout_49005 = acc_46761;\n            for (int64_t i_49006 = 0; i_49006 < residual_input_46715; i_49006++) {\n                int64_t x_46767;\n                int64_t x_46768;\n                bool cond_46773;\n                bool cond_46774;\n                bool cond_46775;\n                bool cond_f_res_t_res_46776;\n                bool x_46777;\n                bool y_46778;\n                bool cond_46779;\n                int64_t lifted_lambda_res_46780;\n                int64_t lifted_lambda_res_46781;\n                int64_t redout_tmp_50233;\n                int64_t redout_tmp_50234;\n                \n                x_46767 = ((__local int64_t *) color_50173)[i_49006];\n                x_46768 = ((__local int64_t *) color_50172)[i_49006];\n                cond_46773 = redout_49004 == lifted_lambda_res_46758;\n                cond_46774 = !cond_46773;\n                cond_46775 = x_46767 == lifted_lambda_res_46758;\n                cond_f_res_t_res_46776 = slt64(x_46768, redout_49005);\n                x_46777 = cond_46775 && cond_f_res_t_res_46776;\n                y_46778 = cond_46773 && x_46777;\n                cond_46779 = cond_46774 || y_46778;\n                if (cond_46779) {\n                    lifted_lambda_res_46780 = x_46767;\n                } else {\n                    lifted_lambda_res_46780 = redout_49004;\n                }\n                if (cond_46779) {\n                    lifted_lambda_res_46781 = x_46768;\n                } else {\n                    lifted_lambda_res_46781 = redout_49005;\n                }\n                redout_tmp_50233 = lifted_lambda_res_46780;\n                redout_tmp_50234 = lifted_lambda_res_46781;\n                redout_49004 = redout_tmp_50233;\n                redout_49005 = redout_tmp_50234;\n            }\n            x_46765 = redout_49004;\n            x_46766 = redout_49005;\n    ",
                                    "        acc_46764 = x_46766;\n        } else {\n            acc_46764 = acc_46761;\n        }\n        mem_49491[(int64_t) 0] = acc_46764;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        for (int32_t i_11 = 0; i_11 < 1; i_11++)\n            ext_mem_49492[i_11] = mem_49491[i_11];\n    }\n    ltid_flat_46787 = sext_i32_i64(local_tid_50218);\n    ltid_46786 = sext_i32_i64(sext_i64_i32(ltid_pre_50222));\n    gtid_46793 = binop_x_46547 + ltid_46786;\n    cond_46796 = slt64(gtid_46793, dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_37753);\n    if (cond_46796) {\n        int64_t defunc_0_f_res_46795;\n        int64_t lifted_lambda_res_46799;\n        bool lifted_lambda_res_46800;\n        \n        defunc_0_f_res_46795 = ext_mem_49492[(int64_t) 0];\n        lifted_lambda_res_46799 = mem_49459[(int64_t) 0];\n        lifted_lambda_res_46800 = defunc_0_f_res_46795 == lifted_lambda_res_46799;\n        postlude_46797 = lifted_lambda_res_46800;\n    } else {\n        postlude_46797 = 0;\n    }\n    mem_49495[(int64_t) 0] = postlude_46797;\n    barrier(CLK_LOCAL_MEM_FENCE);\n    if (slt64(sext_i32_i64(local_tid_50218) + tile_sizze_46537 * sext_i32_i64(block_id_50219), dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_37753)) {\n        bool tmp_50235 = mem_49495[(int64_t) 0];\n        \n        ((__global bool *) mem_49401)[inf_37750 + (sext_i32_i64(local_tid_50218) + tile_sizze_46537 * sext_i32_i64(block_id_50219))] = tmp_50235;\n    }\n    \n  error_9:\n    return;\n    #undef tile_sizze_46537\n    #undef bytes_49470\n}\nFUTHARK_KERNEL_SIZED(make_collisions_compact_doublezisegmap_intrablock_46804_dim1, 1, 1)\nvoid make_collisions_compact_doublezisegmap_intrablock_46804(__global int *global_failure, int failure_is_an_option, __global int64_t *global_failure_args, int64_t dz2084U_35570, int64_t inf_37750, int64_t dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_37753, int64_t ldim_46807, int64_t num_whole_tiles_46832, int64_t residual_input_46984, unsigned char cond_46985_bits, int64_t binop_x_46998, __global unsigned char *chain_collisions_mem_49374, __global", " unsigned char *chain_collisions_mem_49375, __global unsigned char *mem_49401)\n{\n    bool cond_46985 = cond_46985_bits;\n    \n    #define tile_sizze_46806 (make_collisions_compact_doublezisegmap_intrablock_46804zitile_sizze_46806)\n    #define bytes_49424 (make_collisions_compact_doublezisegmap_intrablock_46804zibytes_49424)\n    \n    volatile __local unsigned char *color_50175_backing_1 = &shared_mem[0];\n    const int64_t color_50175_backing_1_offset = 0 + (bytes_49424 + srem64((int64_t) 8 - srem64(bytes_49424, (int64_t) 8), (int64_t) 8));\n    volatile __local unsigned char *color_50174_backing_0 = &shared_mem[color_50175_backing_1_offset];\n    const int64_t color_50174_backing_0_offset = color_50175_backing_1_offset + (bytes_49424 + srem64((int64_t) 8 - srem64(bytes_49424, (int64_t) 8), (int64_t) 8));\n    volatile __local int local_failure;\n    \n    if (failure_is_an_option) {\n        int failed = *global_failure >= 0;\n        \n        if (failed)\n            return;\n    }\n    local_failure = 0;\n    barrier(CLK_LOCAL_MEM_FENCE);\n    \n    int32_t local_tid_50239;\n    int32_t tblock_sizze_50242;\n    int32_t wave_sizze_50241;\n    int32_t block_id_50240;\n    int32_t global_tid_50238;\n    int64_t gid_flat_46804;\n    int64_t slice_50244;\n    int64_t ltid_pre_50243;\n    int64_t remnant_50245;\n    int64_t slice_50246;\n    int64_t gid_46803;\n    int64_t remnant_50247;\n    __local unsigned char *color_50174;\n    __local unsigned char *color_50175;\n    int64_t binop_x_46816;\n    int64_t mem_49409[1];\n    int64_t mem_49413[1];\n    int64_t ltid_flat_46809;\n    int64_t ltid_46808;\n    int64_t gtid_46817;\n    bool cond_46818;\n    int64_t pre_46819;\n    int64_t pre_46820;\n    int64_t mem_49417[1];\n    int64_t mem_49421[1];\n    int64_t ltid_flat_46834;\n    int64_t ltid_46833;\n    int64_t gtid_46842;\n    bool cond_46843;\n    int64_t neutral_46844;\n    int64_t neutral_46845;\n    int64_t ext_mem_49437[1];\n    int64_t ext_mem_49436[1];\n    int64_t mem_param_49422[1];\n    int64_t mem_para", "m_49423[1];\n    int64_t mem_49445[1];\n    int64_t ext_mem_49446[1];\n    bool mem_49449[1];\n    int64_t ltid_flat_47056;\n    int64_t ltid_47055;\n    int64_t gtid_47062;\n    bool cond_47065;\n    bool postlude_47066;\n    \n    local_tid_50239 = get_local_id(0);\n    tblock_sizze_50242 = get_local_size(0);\n    wave_sizze_50241 = LOCKSTEP_WIDTH;\n    block_id_50240 = get_tblock_id(0);\n    global_tid_50238 = block_id_50240 * tblock_sizze_50242 + local_tid_50239;\n    gid_flat_46804 = sext_i32_i64(block_id_50240);\n    slice_50244 = tile_sizze_46806;\n    ltid_pre_50243 = sext_i32_i64(local_tid_50239);\n    remnant_50245 = sext_i32_i64(local_tid_50239) - ltid_pre_50243;\n    slice_50246 = ldim_46807;\n    gid_46803 = sext_i32_i64(block_id_50240);\n    remnant_50247 = sext_i32_i64(block_id_50240) - gid_46803;\n    color_50174 = (__local unsigned char *) color_50174_backing_0;\n    color_50175 = (__local unsigned char *) color_50175_backing_1;\n    binop_x_46816 = gid_46803 * tile_sizze_46806;\n    ltid_flat_46809 = sext_i32_i64(local_tid_50239);\n    ltid_46808 = sext_i32_i64(sext_i64_i32(ltid_pre_50243));\n    gtid_46817 = ltid_46808 + binop_x_46816;\n    cond_46818 = slt64(gtid_46817, dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_37753);\n    if (cond_46818) {\n        int64_t index_primexp_46821;\n        bool x_46822;\n        bool y_46823;\n        bool bounds_check_46824;\n        bool index_certs_46825;\n        int64_t lifted_lambda_res_46826;\n        int64_t lifted_lambda_res_46827;\n        \n        index_primexp_46821 = add64(inf_37750, gtid_46817);\n        x_46822 = sle64((int64_t) 0, index_primexp_46821);\n        y_46823 = slt64(index_primexp_46821, dz2084U_35570);\n        bounds_check_46824 = x_46822 && y_46823;\n        if (!bounds_check_46824) {\n            {\n                if (atomic_cmpxchg_i32_global(global_failure, -1, 23) == -1) {\n                    global_failure_args[0] = (int64_t) index_primexp_46821;\n                    global_failure_args[1] = (int64_t) dz2084U_35570;\n               ",
                                    "     ;\n                }\n                local_failure = 1;\n                goto error_0;\n            }\n        }\n        lifted_lambda_res_46826 = ((__global int64_t *) chain_collisions_mem_49374)[index_primexp_46821];\n        lifted_lambda_res_46827 = ((__global int64_t *) chain_collisions_mem_49375)[index_primexp_46821];\n        pre_46819 = lifted_lambda_res_46826;\n        pre_46820 = lifted_lambda_res_46827;\n    } else {\n        pre_46819 = (int64_t) 0;\n        pre_46820 = (int64_t) 0;\n    }\n    mem_49409[(int64_t) 0] = pre_46819;\n    mem_49413[(int64_t) 0] = pre_46820;\n    \n  error_0:\n    barrier(CLK_LOCAL_MEM_FENCE);\n    if (local_failure)\n        return;\n    barrier(CLK_LOCAL_MEM_FENCE);\n    ltid_flat_46834 = sext_i32_i64(local_tid_50239);\n    ltid_46833 = sext_i32_i64(sext_i64_i32(ltid_pre_50243));\n    gtid_46842 = binop_x_46816 + ltid_46833;\n    cond_46843 = slt64(gtid_46842, dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_37753);\n    if (cond_46843) {\n        int64_t lifted_lambda_res_46846;\n        int64_t lifted_lambda_res_46847;\n        \n        lifted_lambda_res_46846 = mem_49409[(int64_t) 0];\n        lifted_lambda_res_46847 = mem_49413[(int64_t) 0];\n        neutral_46844 = lifted_lambda_res_46846;\n        neutral_46845 = lifted_lambda_res_46847;\n    } else {\n        neutral_46844 = (int64_t) 0;\n        neutral_46845 = (int64_t) 0;\n    }\n    mem_49417[(int64_t) 0] = neutral_46844;\n    mem_49421[(int64_t) 0] = neutral_46845;\n    barrier(CLK_LOCAL_MEM_FENCE);\n    barrier(CLK_LOCAL_MEM_FENCE);\n    for (int32_t i_2 = 0; i_2 < 1; i_2++)\n        mem_param_49422[i_2] = mem_49417[i_2];\n    for (int32_t i_3 = 0; i_3 < 1; i_3++)\n        mem_param_49423[i_3] = mem_49421[i_3];\n    for (int64_t tile_id_46854 = 0; tile_id_46854 < num_whole_tiles_46832; tile_id_46854++) {\n        int64_t binop_x_46924;\n        int64_t ltid_flat_46923;\n        int64_t ltid_46922;\n        int64_t j_46925;\n        bool cond_46930;\n        int64_t pre1d_46931;\n        int64_t pre1d_46932;\n        int6", "4_t mem_49431[1];\n        int64_t mem_49435[1];\n        int64_t ltid_flat_46940;\n        int64_t ltid_46939;\n        int64_t gtid_46942;\n        int64_t acc_46945;\n        int64_t acc_46946;\n        bool cond_46947;\n        int64_t acc_46948;\n        int64_t acc_46949;\n        int64_t mem_param_tmp_50248[1];\n        int64_t mem_param_tmp_50249[1];\n        \n        binop_x_46924 = tile_sizze_46806 * tile_id_46854;\n        ltid_flat_46923 = sext_i32_i64(local_tid_50239);\n        ltid_46922 = sext_i32_i64(sext_i64_i32(ltid_pre_50243));\n        j_46925 = ltid_46922 + binop_x_46924;\n        cond_46930 = slt64(j_46925, dz2084U_35570);\n        if (cond_46930) {\n            int64_t tile_elem_46933;\n            int64_t tile_elem_46934;\n            \n            tile_elem_46933 = ((__global int64_t *) chain_collisions_mem_49374)[j_46925];\n            tile_elem_46934 = ((__global int64_t *) chain_collisions_mem_49375)[j_46925];\n            pre1d_46931 = tile_elem_46933;\n            pre1d_46932 = tile_elem_46934;\n        } else {\n            pre1d_46931 = (int64_t) 0;\n            pre1d_46932 = (int64_t) 0;\n        }\n        ((__local int64_t *) color_50175)[ltid_46922] = pre1d_46931;\n        ((__local int64_t *) color_50174)[ltid_46922] = pre1d_46932;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        ltid_flat_46940 = sext_i32_i64(local_tid_50239);\n        ltid_46939 = sext_i32_i64(sext_i64_i32(ltid_pre_50243));\n        gtid_46942 = binop_x_46816 + ltid_46939;\n        acc_46945 = mem_param_49422[(int64_t) 0];\n        acc_46946 = mem_param_49423[(int64_t) 0];\n        cond_46947 = slt64(gtid_46942, dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_37753);\n        if (cond_46947) {\n            int64_t lifted_lambda_res_46943;\n            int64_t x_46950;\n            int64_t x_46951;\n            int64_t redout_49007;\n            int64_t redout_49008;\n            \n            lifted_lambda_res_46943 = mem_49409[(int64_t) 0];\n            redout_49007 = acc_46945;\n            redout_49008 = acc_46946;\n   ", "         for (int64_t i_49009 = 0; i_49009 < tile_sizze_46806; i_49009++) {\n                int64_t x_46952;\n                int64_t x_46953;\n                bool cond_46958;\n                bool cond_46959;\n                bool cond_46960;\n                bool cond_f_res_t_res_46961;\n                bool x_46962;\n                bool y_46963;\n                bool cond_46964;\n                int64_t lifted_lambda_res_46965;\n                int64_t lifted_lambda_res_46966;\n                int64_t redout_tmp_50252;\n                int64_t redout_tmp_50253;\n                \n                x_46952 = ((__local int64_t *) color_50175)[i_49009];\n                x_46953 = ((__local int64_t *) color_50174)[i_49009];\n                cond_46958 = redout_49007 == lifted_lambda_res_46943;\n                cond_46959 = !cond_46958;\n                cond_46960 = x_46952 == lifted_lambda_res_46943;\n                cond_f_res_t_res_46961 = slt64(x_46953, redout_49008);\n                x_46962 = cond_46960 && cond_f_res_t_res_46961;\n                y_46963 = cond_46958 && x_46962;\n                cond_46964 = cond_46959 || y_46963;\n                if (cond_46964) {\n                    lifted_lambda_res_46965 = x_46952;\n                } else {\n                    lifted_lambda_res_46965 = redout_49007;\n                }\n                if (cond_46964) {\n                    lifted_lambda_res_46966 = x_46953;\n                } else {\n                    lifted_lambda_res_46966 = redout_49008;\n                }\n                redout_tmp_50252 = lifted_lambda_res_46965;\n                redout_tmp_50253 = lifted_lambda_res_46966;\n                redout_49007 = redout_tmp_50252;\n                redout_49008 = redout_tmp_50253;\n            }\n            x_46950 = redout_49007;\n            x_46951 = redout_49008;\n            acc_46948 = x_46950;\n            acc_46949 = x_46951;\n        } else {\n            acc_46948 = acc_46945;\n            acc_46949 = acc_46946;\n        }\n        mem_49431[",
                                    "(int64_t) 0] = acc_46948;\n        mem_49435[(int64_t) 0] = acc_46949;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        for (int32_t i_4 = 0; i_4 < 1; i_4++)\n            mem_param_tmp_50248[i_4] = mem_49431[i_4];\n        for (int32_t i_5 = 0; i_5 < 1; i_5++)\n            mem_param_tmp_50249[i_5] = mem_49435[i_5];\n        for (int32_t i_6 = 0; i_6 < 1; i_6++)\n            mem_param_49422[i_6] = mem_param_tmp_50248[i_6];\n        for (int32_t i_7 = 0; i_7 < 1; i_7++)\n            mem_param_49423[i_7] = mem_param_tmp_50249[i_7];\n    }\n    for (int32_t i_8 = 0; i_8 < 1; i_8++)\n        ext_mem_49437[i_8] = mem_param_49422[i_8];\n    for (int32_t i_9 = 0; i_9 < 1; i_9++)\n        ext_mem_49436[i_9] = mem_param_49423[i_9];\n    barrier(CLK_LOCAL_MEM_FENCE);\n    if (cond_46985) {\n        for (int32_t i_10 = 0; i_10 < 1; i_10++)\n            ext_mem_49446[i_10] = ext_mem_49436[i_10];\n    } else {\n        int64_t ltid_flat_46987;\n        int64_t ltid_46986;\n        int64_t j_46999;\n        bool cond_47004;\n        int64_t pre1d_47005;\n        int64_t pre1d_47006;\n        int64_t ltid_flat_47016;\n        int64_t ltid_47015;\n        int64_t gtid_47026;\n        int64_t acc_47030;\n        bool cond_47031;\n        int64_t acc_47033;\n        \n        ltid_flat_46987 = sext_i32_i64(local_tid_50239);\n        ltid_46986 = sext_i32_i64(sext_i64_i32(ltid_pre_50243));\n        j_46999 = ltid_46986 + binop_x_46998;\n        cond_47004 = slt64(j_46999, dz2084U_35570);\n        if (cond_47004) {\n            int64_t tile_elem_47007;\n            int64_t tile_elem_47008;\n            \n            tile_elem_47007 = ((__global int64_t *) chain_collisions_mem_49374)[j_46999];\n            tile_elem_47008 = ((__global int64_t *) chain_collisions_mem_49375)[j_46999];\n            pre1d_47005 = tile_elem_47007;\n            pre1d_47006 = tile_elem_47008;\n        } else {\n            pre1d_47005 = (int64_t) 0;\n            pre1d_47006 = (int64_t) 0;\n        }\n        ((__local int64_t *) color_50175)[ltid_46986] = pre1d", "_47005;\n        ((__local int64_t *) color_50174)[ltid_46986] = pre1d_47006;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        ltid_flat_47016 = sext_i32_i64(local_tid_50239);\n        ltid_47015 = sext_i32_i64(sext_i64_i32(ltid_pre_50243));\n        gtid_47026 = binop_x_46816 + ltid_47015;\n        acc_47030 = ext_mem_49436[(int64_t) 0];\n        cond_47031 = slt64(gtid_47026, dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_37753);\n        if (cond_47031) {\n            int64_t lifted_lambda_res_47027;\n            int64_t acc_47029;\n            int64_t x_47034;\n            int64_t x_47035;\n            int64_t redout_49010;\n            int64_t redout_49011;\n            \n            lifted_lambda_res_47027 = mem_49409[(int64_t) 0];\n            acc_47029 = ext_mem_49437[(int64_t) 0];\n            redout_49010 = acc_47029;\n            redout_49011 = acc_47030;\n            for (int64_t i_49012 = 0; i_49012 < residual_input_46984; i_49012++) {\n                int64_t x_47036;\n                int64_t x_47037;\n                bool cond_47042;\n                bool cond_47043;\n                bool cond_47044;\n                bool cond_f_res_t_res_47045;\n                bool x_47046;\n                bool y_47047;\n                bool cond_47048;\n                int64_t lifted_lambda_res_47049;\n                int64_t lifted_lambda_res_47050;\n                int64_t redout_tmp_50254;\n                int64_t redout_tmp_50255;\n                \n                x_47036 = ((__local int64_t *) color_50175)[i_49012];\n                x_47037 = ((__local int64_t *) color_50174)[i_49012];\n                cond_47042 = redout_49010 == lifted_lambda_res_47027;\n                cond_47043 = !cond_47042;\n                cond_47044 = x_47036 == lifted_lambda_res_47027;\n                cond_f_res_t_res_47045 = slt64(x_47037, redout_49011);\n                x_47046 = cond_47044 && cond_f_res_t_res_47045;\n                y_47047 = cond_47042 && x_47046;\n                cond_47048 = cond_47043 || y_47047;\n                ", "if (cond_47048) {\n                    lifted_lambda_res_47049 = x_47036;\n                } else {\n                    lifted_lambda_res_47049 = redout_49010;\n                }\n                if (cond_47048) {\n                    lifted_lambda_res_47050 = x_47037;\n                } else {\n                    lifted_lambda_res_47050 = redout_49011;\n                }\n                redout_tmp_50254 = lifted_lambda_res_47049;\n                redout_tmp_50255 = lifted_lambda_res_47050;\n                redout_49010 = redout_tmp_50254;\n                redout_49011 = redout_tmp_50255;\n            }\n            x_47034 = redout_49010;\n            x_47035 = redout_49011;\n            acc_47033 = x_47035;\n        } else {\n            acc_47033 = acc_47030;\n        }\n        mem_49445[(int64_t) 0] = acc_47033;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        for (int32_t i_11 = 0; i_11 < 1; i_11++)\n            ext_mem_49446[i_11] = mem_49445[i_11];\n    }\n    ltid_flat_47056 = sext_i32_i64(local_tid_50239);\n    ltid_47055 = sext_i32_i64(sext_i64_i32(ltid_pre_50243));\n    gtid_47062 = binop_x_46816 + ltid_47055;\n    cond_47065 = slt64(gtid_47062, dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_37753);\n    if (cond_47065) {\n        int64_t defunc_0_f_res_47064;\n        int64_t lifted_lambda_res_47068;\n        bool lifted_lambda_res_47069;\n        \n        defunc_0_f_res_47064 = ext_mem_49446[(int64_t) 0];\n        lifted_lambda_res_47068 = mem_49413[(int64_t) 0];\n        lifted_lambda_res_47069 = defunc_0_f_res_47064 == lifted_lambda_res_47068;\n        postlude_47066 = lifted_lambda_res_47069;\n    } else {\n        postlude_47066 = 0;\n    }\n    mem_49449[(int64_t) 0] = postlude_47066;\n    barrier(CLK_LOCAL_MEM_FENCE);\n    if (slt64(sext_i32_i64(local_tid_50239) + tile_sizze_46806 * sext_i32_i64(block_id_50240), dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_37753)) {\n        bool tmp_50256 = mem_49449[(int64_t) 0];\n        \n        ((__global bool *) mem_49401)[inf_37750 + (sext_i32_i64(local_tid_50239) + tile_",
                                    "sizze_46806 * sext_i32_i64(block_id_50240))] = tmp_50256;\n    }\n    \n  error_9:\n    return;\n    #undef tile_sizze_46806\n    #undef bytes_49424\n}\nFUTHARK_KERNEL_SIZED(make_collisions_compact_doublezisegscan_42995_dim1, 1, 1)\nvoid make_collisions_compact_doublezisegscan_42995(__global int *global_failure, int64_t dz2084U_35570, int64_t num_tblocks_42992, int64_t num_virt_blocks_50264, int64_t num_virt_threads_50265, __global unsigned char *mem_49401, __global unsigned char *mem_49503, __global unsigned char *mem_49505, __global unsigned char *status_flags_mem_50266, __global unsigned char *aggregates_mem_50288, __global unsigned char *incprefixes_mem_50290, __global unsigned char *global_dynid_mem_50292)\n{\n    #define segscan_tblock_sizze_42990 (make_collisions_compact_doublezisegscan_42995zisegscan_tblock_sizze_42990)\n    #define chunk_sizze_50263 (make_collisions_compact_doublezisegscan_42995zichunk_sizze_50263)\n    \n    volatile __local unsigned char *local_mem_50322_backing_0 = &shared_mem[0];\n    const int64_t local_mem_50322_backing_0_offset = 0 + (smax64(smax64((int64_t) 288, (int64_t) 8 * segscan_tblock_sizze_42990), chunk_sizze_50263 * segscan_tblock_sizze_42990 * (int64_t) 8) + srem64((int64_t) 8 - srem64(smax64(smax64((int64_t) 288, (int64_t) 8 * segscan_tblock_sizze_42990), chunk_sizze_50263 * segscan_tblock_sizze_42990 * (int64_t) 8), (int64_t) 8), (int64_t) 8));\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_50315;\n    int32_t tblock_sizze_50318;\n    int32_t wave_sizze_50317;\n    int32_t block_id_50316;\n    int32_t global_tid_50314;\n    int64_t phys_tid_42995;\n    int32_t chunk_sizze_32b_50319;\n    int64_t byte_offsets_50320;\n    int64_t warp_byte_offset_50321;\n    __local unsigned char *local_mem_50322;\n    int64_t trans_arr_len_50323;\n    int64_t phys_block_id_50329;\n    int64_t virtloop_bound_50330;\n    \n    local_tid_50315 = get_local_id(0);\n    tblock_sizze_50318 = get_local_size(0);\n    wave_sizze_50317 = LOCKSTEP_WID", "TH;\n    block_id_50316 = get_tblock_id(0);\n    global_tid_50314 = block_id_50316 * tblock_sizze_50318 + local_tid_50315;\n    phys_tid_42995 = sext_i32_i64(global_tid_50314);\n    chunk_sizze_32b_50319 = sext_i64_i32(chunk_sizze_50263);\n    byte_offsets_50320 = segscan_tblock_sizze_42990 * (int64_t) 8;\n    warp_byte_offset_50321 = (int64_t) 288;\n    // Allocate reusable shared memory\n    { }\n    local_mem_50322 = (__local unsigned char *) local_mem_50322_backing_0;\n    trans_arr_len_50323 = chunk_sizze_50263 * segscan_tblock_sizze_42990;\n    phys_block_id_50329 = get_tblock_id(0);\n    virtloop_bound_50330 = sdiv_up64(num_virt_blocks_50264 - phys_block_id_50329, num_tblocks_42992);\n    for (int64_t virtloop_i_50331 = 0; virtloop_i_50331 < virtloop_bound_50330; virtloop_i_50331++) {\n        int64_t dynamic_id_50332;\n        int64_t block_offset_50333;\n        int64_t sgm_idx_50334;\n        int32_t boundary_50335;\n        int32_t segsizze_compact_50336;\n        int64_t private_mem_50337[chunk_sizze_50263];\n        int64_t thd_offset_50339;\n        int64_t acc_50355;\n        int64_t prefix_50365;\n        bool block_new_sgm_50366;\n        \n        // First thread in block fetches this block's dynamic_id\n        {\n            if (local_tid_50315 == 0) {\n                dynamic_id_50332 = atomic_add_i32_global(&((volatile __global int *) global_dynid_mem_50292)[(int64_t) 0], (int) 1);\n                // Set dynamic id for this block\n                {\n                    ((__local int64_t *) local_mem_50322)[(int64_t) 0] = dynamic_id_50332;\n                }\n                // First thread in last (virtual) block resets global dynamic_id\n                {\n                    if (dynamic_id_50332 == num_virt_blocks_50264 - (int64_t) 1) {\n                        ((__global int32_t *) global_dynid_mem_50292)[(int64_t) 0] = 0;\n                    }\n                }\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        dynamic_id_50332 = ((__local int32_t *) local", "_mem_50322)[(int64_t) 0];\n        barrier(CLK_LOCAL_MEM_FENCE);\n        block_offset_50333 = dynamic_id_50332 * chunk_sizze_50263 * segscan_tblock_sizze_42990;\n        sgm_idx_50334 = smod64(block_offset_50333, dz2084U_35570);\n        boundary_50335 = sext_i64_i32(smin64(chunk_sizze_50263 * segscan_tblock_sizze_42990, dz2084U_35570 - sgm_idx_50334));\n        segsizze_compact_50336 = sext_i64_i32(smin64(chunk_sizze_50263 * segscan_tblock_sizze_42990, dz2084U_35570));\n        thd_offset_50339 = block_offset_50333 + sext_i32_i64(local_tid_50315);\n        // Load and map\n        {\n            for (int64_t i_50340 = 0; i_50340 < chunk_sizze_50263; i_50340++) {\n                int64_t virt_tid_50341 = thd_offset_50339 + i_50340 * segscan_tblock_sizze_42990;\n                int64_t slice_50342 = dz2084U_35570;\n                int64_t gtid_42994 = virt_tid_50341;\n                int64_t remnant_50343 = virt_tid_50341 - gtid_42994;\n                \n                if (slt64(virt_tid_50341, dz2084U_35570)) {\n                    bool tmp_42207 = ((__global bool *) mem_49401)[gtid_42994];\n                    int64_t defunc_0_f_res_42213 = btoi_bool_i64(tmp_42207);\n                    \n                    ((__global int64_t *) mem_49505)[gtid_42994] = defunc_0_f_res_42213;\n                    private_mem_50337[i_50340] = defunc_0_f_res_42213;\n                } else {\n                    private_mem_50337[i_50340] = (int64_t) 0;\n                }\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        // Transpose scan inputs\n        {\n            for (int64_t i_50344 = 0; i_50344 < chunk_sizze_50263; i_50344++) {\n                int64_t sharedIdx_50345 = sext_i32_i64(local_tid_50315) + i_50344 * segscan_tblock_sizze_42990;\n                int64_t tmp_50346 = private_mem_50337[i_50344];\n                \n                ((__local int64_t *) local_mem_50322)[sharedIdx_50345] = tmp_50346;\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            for (int64_t ",
                                    "i_50347 = 0; i_50347 < chunk_sizze_50263; i_50347++) {\n                int64_t sharedIdx_50348 = sext_i32_i64(local_tid_50315) * chunk_sizze_50263 + i_50347;\n                int64_t tmp_50349 = ((__local int64_t *) local_mem_50322)[sharedIdx_50348];\n                \n                private_mem_50337[i_50347] = tmp_50349;\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n        }\n        // Per thread scan\n        {\n            for (int64_t i_50350 = 0; i_50350 < chunk_sizze_50263 - (int64_t) 1; i_50350++) {\n                int64_t eta_p_37814;\n                int64_t eta_p_37815;\n                \n                eta_p_37814 = private_mem_50337[i_50350];\n                eta_p_37815 = private_mem_50337[i_50350 + (int64_t) 1];\n                \n                int64_t defunc_0_op_res_37816 = add64(eta_p_37814, eta_p_37815);\n                \n                private_mem_50337[i_50350 + (int64_t) 1] = defunc_0_op_res_37816;\n            }\n        }\n        // Publish results in shared memory\n        {\n            int64_t tmp_50351 = private_mem_50337[chunk_sizze_50263 - (int64_t) 1];\n            \n            ((__local int64_t *) local_mem_50322)[sext_i32_i64(local_tid_50315)] = tmp_50351;\n            barrier(CLK_LOCAL_MEM_FENCE);\n        }\n        // Scan results (with warp scan)\n        {\n            int64_t eta_p_50352;\n            int64_t eta_p_50353;\n            int64_t eta_p_50356;\n            int64_t eta_p_50357;\n            bool ltid_in_bounds_50359 = slt64(sext_i32_i64(local_tid_50315), num_virt_threads_50265);\n            int32_t skip_threads_50360;\n            \n            // read input for in-block scan\n            {\n                if (ltid_in_bounds_50359) {\n                    eta_p_50353 = ((volatile __local int64_t *) local_mem_50322)[sext_i32_i64(local_tid_50315)];\n                    if ((local_tid_50315 - squot32(local_tid_50315, 32) * 32) == 0) {\n                        eta_p_50352 = eta_p_50353;\n                    }\n                }\n           ", " }\n            // in-block scan (hopefully no barriers needed)\n            {\n                skip_threads_50360 = 1;\n                while (slt32(skip_threads_50360, 32)) {\n                    bool thread_active_50361 = sle32(skip_threads_50360, local_tid_50315 - squot32(local_tid_50315, 32) * 32) && ltid_in_bounds_50359;\n                    \n                    if (thread_active_50361) {\n                        // read operands\n                        {\n                            eta_p_50352 = ((volatile __local int64_t *) local_mem_50322)[sext_i32_i64(local_tid_50315) - sext_i32_i64(skip_threads_50360)];\n                        }\n                    }\n                    // perform operation\n                    {\n                        if (thread_active_50361) {\n                            int64_t defunc_0_op_res_50354 = add64(eta_p_50352, eta_p_50353);\n                            \n                            eta_p_50352 = defunc_0_op_res_50354;\n                        }\n                    }\n                    if (sle32(wave_sizze_50317, skip_threads_50360)) {\n                        barrier(CLK_LOCAL_MEM_FENCE);\n                    }\n                    if (thread_active_50361) {\n                        // write result\n                        {\n                            ((volatile __local int64_t *) local_mem_50322)[sext_i32_i64(local_tid_50315)] = eta_p_50352;\n                            eta_p_50353 = eta_p_50352;\n                        }\n                    }\n                    if (sle32(wave_sizze_50317, skip_threads_50360)) {\n                        barrier(CLK_LOCAL_MEM_FENCE);\n                    }\n                    skip_threads_50360 *= 2;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // last thread of block 'i' writes its result to offset 'i'\n            {\n                if ((local_tid_50315 - squot32(local_tid_50315, 32) * 32) == 31 && ltid_in_bounds_50359) {\n                    ((volatile __local int64_", "t *) local_mem_50322)[sext_i32_i64(squot32(local_tid_50315, 32))] = eta_p_50352;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // scan the first block, after which offset 'i' contains carry-in for block 'i+1'\n            {\n                int32_t skip_threads_50362;\n                \n                // read input for in-block scan\n                {\n                    if (squot32(local_tid_50315, 32) == 0 && ltid_in_bounds_50359) {\n                        eta_p_50357 = ((volatile __local int64_t *) local_mem_50322)[sext_i32_i64(local_tid_50315)];\n                        if ((local_tid_50315 - squot32(local_tid_50315, 32) * 32) == 0) {\n                            eta_p_50356 = eta_p_50357;\n                        }\n                    }\n                }\n                // in-block scan (hopefully no barriers needed)\n                {\n                    skip_threads_50362 = 1;\n                    while (slt32(skip_threads_50362, 32)) {\n                        bool thread_active_50363 = sle32(skip_threads_50362, local_tid_50315 - squot32(local_tid_50315, 32) * 32) && (squot32(local_tid_50315, 32) == 0 && ltid_in_bounds_50359);\n                        \n                        if (thread_active_50363) {\n                            // read operands\n                            {\n                                eta_p_50356 = ((volatile __local int64_t *) local_mem_50322)[sext_i32_i64(local_tid_50315) - sext_i32_i64(skip_threads_50362)];\n                            }\n                        }\n                        // perform operation\n                        {\n                            if (thread_active_50363) {\n                                int64_t defunc_0_op_res_50358 = add64(eta_p_50356, eta_p_50357);\n                                \n                                eta_p_50356 = defunc_0_op_res_50358;\n                            }\n                        }\n                        if (sle32(wave_sizze_50317, skip_threads_5036",
                                    "2)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        if (thread_active_50363) {\n                            // write result\n                            {\n                                ((volatile __local int64_t *) local_mem_50322)[sext_i32_i64(local_tid_50315)] = eta_p_50356;\n                                eta_p_50357 = eta_p_50356;\n                            }\n                        }\n                        if (sle32(wave_sizze_50317, skip_threads_50362)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        skip_threads_50362 *= 2;\n                    }\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            \n            bool no_carry_in_50364 = squot32(local_tid_50315, 32) == 0 || !ltid_in_bounds_50359;\n            \n            // carry-in for every block except the first\n            {\n                // read operands\n                {\n                    if (!no_carry_in_50364) {\n                        eta_p_50353 = eta_p_50352;\n                        eta_p_50352 = ((__local int64_t *) local_mem_50322)[sext_i32_i64(squot32(local_tid_50315, 32)) - (int64_t) 1];\n                    }\n                }\n                // perform operation\n                {\n                    if (!no_carry_in_50364) {\n                        int64_t defunc_0_op_res_50354 = add64(eta_p_50352, eta_p_50353);\n                        \n                        eta_p_50352 = defunc_0_op_res_50354;\n                    }\n                }\n                // write final result\n                {\n                    if (!no_carry_in_50364) {\n                        ((__local int64_t *) local_mem_50322)[sext_i32_i64(local_tid_50315)] = eta_p_50352;\n                    }\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // restore correct values for first block\n            {\n                if (squot32(local_", "tid_50315, 32) == 0 && ltid_in_bounds_50359) {\n                    ((__local int64_t *) local_mem_50322)[sext_i32_i64(local_tid_50315)] = eta_p_50353;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            barrier(CLK_LOCAL_MEM_FENCE);\n            if (local_tid_50315 == 0) {\n                acc_50355 = ((__local int64_t *) local_mem_50322)[segscan_tblock_sizze_42990 - (int64_t) 1];\n            } else {\n                acc_50355 = ((__local int64_t *) local_mem_50322)[sext_i32_i64(local_tid_50315) - (int64_t) 1];\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n        }\n        prefix_50365 = (int64_t) 0;\n        block_new_sgm_50366 = sgm_idx_50334 == (int64_t) 0;\n        // Perform lookback\n        {\n            if (block_new_sgm_50366 && local_tid_50315 == 0) {\n                ((volatile __global int64_t *) incprefixes_mem_50290)[dynamic_id_50332] = acc_50355;\n                mem_fence_global();\n                ((volatile __global int8_t *) status_flags_mem_50266)[dynamic_id_50332] = (int8_t) 2;\n                acc_50355 = (int64_t) 0;\n            }\n            if (!block_new_sgm_50366 && slt32(local_tid_50315, wave_sizze_50317)) {\n                if (local_tid_50315 == 0) {\n                    ((volatile __global int64_t *) aggregates_mem_50288)[dynamic_id_50332] = acc_50355;\n                    mem_fence_global();\n                    ((volatile __global int8_t *) status_flags_mem_50266)[dynamic_id_50332] = (int8_t) 1;\n                    \n                    int8_t tmp_50367 = ((volatile __global int8_t *) status_flags_mem_50266)[dynamic_id_50332 - (int64_t) 1];\n                    \n                    ((volatile __local int8_t *) local_mem_50322)[(int64_t) 0] = tmp_50367;\n                }\n                mem_fence_local();\n                \n                int8_t status_50368 = ((__local int8_t *) local_mem_50322)[(int64_t) 0];\n                \n                if (status_50368 == (int8_t) 2) {\n                    if (local_", "tid_50315 == 0) {\n                        prefix_50365 = ((volatile __global int64_t *) incprefixes_mem_50290)[dynamic_id_50332 - (int64_t) 1];\n                    }\n                } else {\n                    int32_t readOffset_50369 = sext_i64_i32(dynamic_id_50332 - sext_i32_i64(wave_sizze_50317));\n                    \n                    while (slt32(wave_sizze_50317 * -1, readOffset_50369)) {\n                        int32_t read_i_50370 = readOffset_50369 + local_tid_50315;\n                        int64_t aggr_50371 = (int64_t) 0;\n                        int8_t flag_50372 = (int8_t) 0;\n                        \n                        if (sle32(0, read_i_50370)) {\n                            flag_50372 = ((volatile __global int8_t *) status_flags_mem_50266)[sext_i32_i64(read_i_50370)];\n                            if (flag_50372 == (int8_t) 2) {\n                                aggr_50371 = ((volatile __global int64_t *) incprefixes_mem_50290)[sext_i32_i64(read_i_50370)];\n                            } else if (flag_50372 == (int8_t) 1) {\n                                aggr_50371 = ((volatile __global int64_t *) aggregates_mem_50288)[sext_i32_i64(read_i_50370)];\n                            }\n                        }\n                        ((__local int64_t *) local_mem_50322)[(int64_t) 4 + sext_i32_i64(local_tid_50315)] = aggr_50371;\n                        ((__local int8_t *) local_mem_50322)[sext_i32_i64(local_tid_50315)] = flag_50372;\n                        flag_50372 = ((__local int8_t *) local_mem_50322)[sext_i32_i64(wave_sizze_50317) - (int64_t) 1];\n                        if (slt8(flag_50372, (int8_t) 2)) {\n                            int8_t flg_x_50376;\n                            int8_t flg_y_50377;\n                            int64_t eta_p_50373;\n                            int64_t eta_p_50374;\n                            int32_t skip_threads_50378;\n                            \n                            // read input for in-block scan\n              ",
                                    "              {\n                                flg_y_50377 = ((volatile __local int8_t *) local_mem_50322)[sext_i32_i64(local_tid_50315)];\n                                eta_p_50374 = ((volatile __local int64_t *) local_mem_50322)[(int64_t) 4 + sext_i32_i64(local_tid_50315)];\n                                if ((local_tid_50315 - squot32(local_tid_50315, 32) * 32) == 0) {\n                                    eta_p_50373 = eta_p_50374;\n                                    flg_x_50376 = flg_y_50377;\n                                }\n                            }\n                            // in-block scan (hopefully no barriers needed)\n                            {\n                                skip_threads_50378 = 1;\n                                while (slt32(skip_threads_50378, 32)) {\n                                    if (sle32(skip_threads_50378, local_tid_50315 - squot32(local_tid_50315, 32) * 32)) {\n                                        // read operands\n                                        {\n                                            flg_x_50376 = ((volatile __local int8_t *) local_mem_50322)[sext_i32_i64(local_tid_50315) - sext_i32_i64(skip_threads_50378)];\n                                            eta_p_50373 = ((volatile __local int64_t *) local_mem_50322)[(int64_t) 4 + (sext_i32_i64(local_tid_50315) - sext_i32_i64(skip_threads_50378))];\n                                        }\n                                        // perform operation\n                                        {\n                                            if (flg_y_50377 == (int8_t) 2 || flg_y_50377 == (int8_t) 0) {\n                                                flg_x_50376 = flg_y_50377;\n                                                eta_p_50373 = eta_p_50374;\n                                            } else {\n                                                int64_t defunc_0_op_res_50375 = add64(eta_p_50373, eta_p_50374);\n                                                \n   ", "                                             eta_p_50373 = defunc_0_op_res_50375;\n                                            }\n                                        }\n                                        // write result\n                                        {\n                                            ((volatile __local int8_t *) local_mem_50322)[sext_i32_i64(local_tid_50315)] = flg_x_50376;\n                                            flg_y_50377 = flg_x_50376;\n                                            ((volatile __local int64_t *) local_mem_50322)[(int64_t) 4 + sext_i32_i64(local_tid_50315)] = eta_p_50373;\n                                            eta_p_50374 = eta_p_50373;\n                                        }\n                                    }\n                                    skip_threads_50378 *= 2;\n                                }\n                            }\n                        }\n                        flag_50372 = ((__local int8_t *) local_mem_50322)[sext_i32_i64(wave_sizze_50317) - (int64_t) 1];\n                        aggr_50371 = ((__local int64_t *) local_mem_50322)[(int64_t) 4 + (sext_i32_i64(wave_sizze_50317) - (int64_t) 1)];\n                        if (flag_50372 == (int8_t) 2) {\n                            readOffset_50369 = wave_sizze_50317 * -1;\n                        } else if (flag_50372 == (int8_t) 1) {\n                            readOffset_50369 -= wave_sizze_50317;\n                        }\n                        if (slt8((int8_t) 0, flag_50372)) {\n                            int64_t eta_p_50379 = aggr_50371;\n                            int64_t eta_p_50380 = prefix_50365;\n                            int64_t defunc_0_op_res_50381 = add64(eta_p_50379, eta_p_50380);\n                            \n                            prefix_50365 = defunc_0_op_res_50381;\n                        }\n                        mem_fence_local();\n                    }\n                }\n                if (local_tid_50315 == 0) {\n     ", "               if (boundary_50335 == sext_i64_i32(segscan_tblock_sizze_42990 * chunk_sizze_50263)) {\n                        int64_t eta_p_50382 = prefix_50365;\n                        int64_t eta_p_50383 = acc_50355;\n                        int64_t defunc_0_op_res_50384 = add64(eta_p_50382, eta_p_50383);\n                        \n                        ((volatile __global int64_t *) incprefixes_mem_50290)[dynamic_id_50332] = defunc_0_op_res_50384;\n                        mem_fence_global();\n                        ((volatile __global int8_t *) status_flags_mem_50266)[dynamic_id_50332] = (int8_t) 2;\n                    }\n                    ((__local int64_t *) local_mem_50322)[(int64_t) 4] = prefix_50365;\n                    acc_50355 = (int64_t) 0;\n                }\n            }\n            if (!(dynamic_id_50332 == (int64_t) 0)) {\n                barrier(CLK_LOCAL_MEM_FENCE);\n                prefix_50365 = ((__local int64_t *) local_mem_50322)[(int64_t) 4];\n                barrier(CLK_LOCAL_MEM_FENCE);\n            }\n        }\n        // Distribute results\n        {\n            int64_t eta_p_50385;\n            int64_t eta_p_50386;\n            int64_t eta_p_50388 = prefix_50365;\n            int64_t eta_p_50389 = acc_50355;\n            \n            if (slt32(local_tid_50315 * chunk_sizze_32b_50319, boundary_50335) && !block_new_sgm_50366) {\n                int64_t defunc_0_op_res_50390 = add64(eta_p_50388, eta_p_50389);\n                \n                eta_p_50385 = defunc_0_op_res_50390;\n            } else {\n                eta_p_50385 = acc_50355;\n            }\n            \n            int32_t stopping_point_50391 = segsizze_compact_50336 - srem32(local_tid_50315 * chunk_sizze_32b_50319 - 1 + segsizze_compact_50336 - boundary_50335, segsizze_compact_50336);\n            \n            for (int64_t i_50392 = 0; i_50392 < chunk_sizze_50263; i_50392++) {\n                if (slt32(sext_i64_i32(i_50392), stopping_point_50391 - 1)) {\n                    eta_p_50386 = priv",
                                    "ate_mem_50337[i_50392];\n                    \n                    int64_t defunc_0_op_res_50387 = add64(eta_p_50385, eta_p_50386);\n                    \n                    private_mem_50337[i_50392] = defunc_0_op_res_50387;\n                }\n            }\n        }\n        // Transpose scan output and Write it to global memory in coalesced fashion\n        {\n            for (int64_t i_50393 = 0; i_50393 < chunk_sizze_50263; i_50393++) {\n                int64_t sharedIdx_50394 = sext_i32_i64(local_tid_50315) * chunk_sizze_50263 + i_50393;\n                int64_t tmp_50395 = private_mem_50337[i_50393];\n                \n                ((__local int64_t *) local_mem_50322)[sharedIdx_50394] = tmp_50395;\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            for (int64_t i_50396 = 0; i_50396 < chunk_sizze_50263; i_50396++) {\n                int64_t flat_idx_50397 = thd_offset_50339 + i_50396 * segscan_tblock_sizze_42990;\n                int64_t slice_50398 = dz2084U_35570;\n                int64_t gtid_42994 = flat_idx_50397;\n                int64_t remnant_50399 = flat_idx_50397 - gtid_42994;\n                \n                if (slt64(flat_idx_50397, dz2084U_35570)) {\n                    int64_t tmp_50400 = ((__local int64_t *) local_mem_50322)[flat_idx_50397 - block_offset_50333];\n                    \n                    ((__global int64_t *) mem_49503)[gtid_42994] = tmp_50400;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n        }\n    }\n    \n  error_3:\n    return;\n    #undef segscan_tblock_sizze_42990\n    #undef chunk_sizze_50263\n}\nFUTHARK_KERNEL_SIZED(mk_dbcHandler_doublezigpuseq_50292_dim1, 1, 1)\nvoid mk_dbcHandler_doublezigpuseq_50292(__global int *global_failure, double min_x_22265, double min_y_22266, double max_x_22267, double max_y_22268, int64_t parts_x_22269, int64_t parts_y_22270, double zs_res_37132, double zs_res_37135, __global unsigned char *mem_49397, __global unsigned char *mem_49398, __global unsigned char *mem_4", "9399, __global unsigned char *mem_49400, __global unsigned char *mem_49401, __global unsigned char *mem_49402, __global unsigned char *mem_49403, __global unsigned char *mem_49404)\n{\n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_50294;\n    int32_t tblock_sizze_50297;\n    int32_t wave_sizze_50296;\n    int32_t block_id_50295;\n    int32_t global_tid_50293;\n    int64_t tid_50292;\n    \n    local_tid_50294 = get_local_id(0);\n    tblock_sizze_50297 = get_local_size(0);\n    wave_sizze_50296 = LOCKSTEP_WIDTH;\n    block_id_50295 = get_tblock_id(0);\n    global_tid_50293 = block_id_50295 * tblock_sizze_50297 + local_tid_50294;\n    tid_50292 = sext_i32_i64(global_tid_50293);\n    ((__global double *) mem_49397)[(int64_t) 0] = min_x_22265;\n    ((__global double *) mem_49397)[(int64_t) 1] = min_y_22266;\n    ((__global double *) mem_49398)[(int64_t) 0] = max_x_22267;\n    ((__global double *) mem_49398)[(int64_t) 1] = max_y_22268;\n    ((__global double *) mem_49399)[(int64_t) 0] = zs_res_37132;\n    ((__global double *) mem_49399)[(int64_t) 1] = zs_res_37135;\n    ((__global int64_t *) mem_49400)[(int64_t) 0] = parts_x_22269;\n    ((__global int64_t *) mem_49400)[(int64_t) 1] = parts_y_22270;\n    for (int64_t i_0 = 0; i_0 < (int64_t) 2; i_0++) {\n        ((__global double *) mem_49401)[i_0] = ((__global double *) mem_49397)[i_0];\n    }\n    for (int64_t i_0 = 0; i_0 < (int64_t) 2; i_0++) {\n        ((__global double *) mem_49402)[i_0] = ((__global double *) mem_49398)[i_0];\n    }\n    for (int64_t i_0 = 0; i_0 < (int64_t) 2; i_0++) {\n        ((__global double *) mem_49403)[i_0] = ((__global double *) mem_49399)[i_0];\n    }\n    for (int64_t i_0 = 0; i_0 < (int64_t) 2; i_0++) {\n        ((__global int64_t *) mem_49404)[i_0] = ((__global int64_t *) mem_49400)[i_0];\n    }\n    \n  error_0:\n    return;\n}\nFUTHARK_KERNEL_SIZED(next_partition_to_read_doublezigpuseq_50194_dim1, 1, 1)\nvoid next_partition_to_read_doublezigpuseq_50194(__global int *global_failure, __global unsig", "ned char *clProc_mem_49385, __global unsigned char *mem_49414)\n{\n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_50196;\n    int32_t tblock_sizze_50199;\n    int32_t wave_sizze_50198;\n    int32_t block_id_50197;\n    int32_t global_tid_50195;\n    int64_t tid_50194;\n    int64_t next_partition_to_read_res_f_res_t_res_49051;\n    \n    local_tid_50196 = get_local_id(0);\n    tblock_sizze_50199 = get_local_size(0);\n    wave_sizze_50198 = LOCKSTEP_WIDTH;\n    block_id_50197 = get_tblock_id(0);\n    global_tid_50195 = block_id_50197 * tblock_sizze_50199 + local_tid_50196;\n    tid_50194 = sext_i32_i64(global_tid_50195);\n    next_partition_to_read_res_f_res_t_res_49051 = ((__global int64_t *) clProc_mem_49385)[(int64_t) 0];\n    ((__global int64_t *) mem_49414)[(int64_t) 0] = next_partition_to_read_res_f_res_t_res_49051;\n    \n  error_0:\n    return;\n}\nFUTHARK_KERNEL_SIZED(next_partition_to_read_doublezigpuseq_50407_dim1, 1, 1)\nvoid next_partition_to_read_doublezigpuseq_50407(__global int *global_failure, __global unsigned char *mem_49410, __global unsigned char *mem_49412)\n{\n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_50409;\n    int32_t tblock_sizze_50412;\n    int32_t wave_sizze_50411;\n    int32_t block_id_50410;\n    int32_t global_tid_50408;\n    int64_t tid_50407;\n    int64_t next_partition_to_read_res_f_res_f_res_t_res_49053;\n    \n    local_tid_50409 = get_local_id(0);\n    tblock_sizze_50412 = get_local_size(0);\n    wave_sizze_50411 = LOCKSTEP_WIDTH;\n    block_id_50410 = get_tblock_id(0);\n    global_tid_50408 = block_id_50410 * tblock_sizze_50412 + local_tid_50409;\n    tid_50407 = sext_i32_i64(global_tid_50408);\n    next_partition_to_read_res_f_res_f_res_t_res_49053 = ((__global int64_t *) mem_49410)[(int64_t) 0];\n    ((__global int64_t *) mem_49412)[(int64_t) 0] = next_partition_to_read_res_f_res_f_res_t_res_49053;\n    \n  error_0:\n    return;\n}\nFUTHARK_KERNEL_SIZED(next_partition_to_read_doublezisegmap_42834_dim1, 1, 1)\nvoid ne",
                                    "xt_partition_to_read_doublezisegmap_42834(__global int *global_failure, int64_t part_no_22873, int64_t m_42373, int64_t num_tblocks_42839, int32_t virt_num_tblocks_50394, __global unsigned char *mem_49406, __global unsigned char *mem_49408, __global unsigned char *mem_49410)\n{\n    #define segmap_tblock_sizze_42837 (next_partition_to_read_doublezisegmap_42834zisegmap_tblock_sizze_42837)\n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_50396;\n    int32_t tblock_sizze_50399;\n    int32_t wave_sizze_50398;\n    int32_t block_id_50397;\n    int32_t global_tid_50395;\n    int64_t phys_tid_42834;\n    int32_t phys_tblock_id_50400;\n    int32_t iterations_50401;\n    \n    local_tid_50396 = get_local_id(0);\n    tblock_sizze_50399 = get_local_size(0);\n    wave_sizze_50398 = LOCKSTEP_WIDTH;\n    block_id_50397 = get_tblock_id(0);\n    global_tid_50395 = block_id_50397 * tblock_sizze_50399 + local_tid_50396;\n    phys_tid_42834 = sext_i32_i64(global_tid_50395);\n    phys_tblock_id_50400 = get_tblock_id(0);\n    iterations_50401 = sdiv_up32(virt_num_tblocks_50394 - phys_tblock_id_50400, sext_i64_i32(num_tblocks_42839));\n    for (int32_t i_50402 = 0; i_50402 < iterations_50401; i_50402++) {\n        int32_t virt_tblock_id_50403;\n        int64_t global_tid_50404;\n        int64_t slice_50405;\n        int64_t write_i_42833;\n        int64_t remnant_50406;\n        \n        virt_tblock_id_50403 = phys_tblock_id_50400 + i_50402 * sext_i64_i32(num_tblocks_42839);\n        global_tid_50404 = sext_i32_i64(virt_tblock_id_50403) * segmap_tblock_sizze_42837 + sext_i32_i64(local_tid_50396);\n        slice_50405 = part_no_22873;\n        write_i_42833 = global_tid_50404;\n        remnant_50406 = global_tid_50404 - write_i_42833;\n        if (slt64(write_i_42833, part_no_22873)) {\n            int64_t eta_p_42387;\n            bool cond_42390;\n            int64_t lifted_lambda_res_42391;\n            \n            eta_p_42387 = ((__global int64_t *) mem_49408)[write_i_42833];\n            cond_", "42390 = eta_p_42387 == (int64_t) 1;\n            if (cond_42390) {\n                int64_t eta_p_42388;\n                int64_t lifted_lambda_res_t_res_42392;\n                \n                eta_p_42388 = ((__global int64_t *) mem_49406)[write_i_42833];\n                lifted_lambda_res_t_res_42392 = sub64(eta_p_42388, (int64_t) 1);\n                lifted_lambda_res_42391 = lifted_lambda_res_t_res_42392;\n            } else {\n                lifted_lambda_res_42391 = (int64_t) -1;\n            }\n            if (sle64((int64_t) 0, lifted_lambda_res_42391) && slt64(lifted_lambda_res_42391, m_42373)) {\n                ((__global int64_t *) mem_49410)[lifted_lambda_res_42391] = write_i_42833;\n            }\n        }\n        barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    }\n    \n  error_1:\n    return;\n    #undef segmap_tblock_sizze_42837\n}\nFUTHARK_KERNEL_SIZED(next_partition_to_read_doublezisegred_nonseg_42824_dim1, 1, 1)\nvoid next_partition_to_read_doublezisegred_nonseg_42824(__global int *global_failure, int64_t part_no_22873, int64_t num_tblocks_42819, int64_t num_threads_50225, __global unsigned char *clProc_mem_49384, __global unsigned char *mem_49402, __global unsigned char *counters_mem_50201, __global unsigned char *segred_tmp_mem_50223)\n{\n    #define segred_tblock_sizze_42817 (next_partition_to_read_doublezisegred_nonseg_42824zisegred_tblock_sizze_42817)\n    #define chunk_sizze_50200 (next_partition_to_read_doublezisegred_nonseg_42824zichunk_sizze_50200)\n    \n    volatile __local unsigned char *sync_arr_mem_50233_backing_1 = &shared_mem[0];\n    const int64_t sync_arr_mem_50233_backing_1_offset = 0 + 8;\n    volatile __local unsigned char *red_arr_i64_mem_50231_backing_0 = &shared_mem[sync_arr_mem_50233_backing_1_offset];\n    const int64_t red_arr_i64_mem_50231_backing_0_offset = sync_arr_mem_50233_backing_1_offset + ((int64_t) 8 * segred_tblock_sizze_42817 + srem64((int64_t) 8 - srem64((int64_t) 8 * segred_tblock_sizze_42817, (int64_t) 8), (int64_t) 8));\n ", "   \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_50227;\n    int32_t tblock_sizze_50230;\n    int32_t wave_sizze_50229;\n    int32_t block_id_50228;\n    int32_t global_tid_50226;\n    int64_t phys_tid_42824;\n    __local unsigned char *red_arr_i64_mem_50231;\n    __local unsigned char *sync_arr_mem_50233;\n    int64_t dummy_42822;\n    int64_t gtid_42823;\n    int64_t q_50235;\n    int64_t eta_p_block_res_acc_50236;\n    int64_t eta_p_37745;\n    int64_t eta_p_37746;\n    int64_t tblock_id_in_segment_50240;\n    int64_t block_base_offset_50241;\n    int32_t offset_50244;\n    int32_t skip_waves_50245;\n    int64_t eta_p_50237;\n    int64_t eta_p_50238;\n    int32_t old_counter_50246;\n    bool is_last_block_50247;\n    \n    local_tid_50227 = get_local_id(0);\n    tblock_sizze_50230 = get_local_size(0);\n    wave_sizze_50229 = LOCKSTEP_WIDTH;\n    block_id_50228 = get_tblock_id(0);\n    global_tid_50226 = block_id_50228 * tblock_sizze_50230 + local_tid_50227;\n    phys_tid_42824 = sext_i32_i64(global_tid_50226);\n    red_arr_i64_mem_50231 = (__local unsigned char *) red_arr_i64_mem_50231_backing_0;\n    sync_arr_mem_50233 = (__local unsigned char *) sync_arr_mem_50233_backing_1;\n    dummy_42822 = (int64_t) 0;\n    gtid_42823 = (int64_t) 0;\n    q_50235 = sdiv_up64(part_no_22873, sext_i32_i64(sext_i64_i32(segred_tblock_sizze_42817 * num_tblocks_42819)) * chunk_sizze_50200);\n    // ne-initialise the outer (per-block) accumulator(s)\n    {\n        eta_p_block_res_acc_50236 = (int64_t) 0;\n    }\n    tblock_id_in_segment_50240 = squot64(phys_tid_42824, segred_tblock_sizze_42817);\n    block_base_offset_50241 = tblock_id_in_segment_50240 * q_50235 * segred_tblock_sizze_42817;\n    for (int64_t i_50242 = 0; i_50242 < q_50235; i_50242++) {\n        int64_t block_offset_50243 = block_base_offset_50241 + i_50242 * segred_tblock_sizze_42817;\n        \n        gtid_42823 = phys_tid_42824 + num_threads_50225 * i_50242;\n        if (slt64(gtid_42823, part_no_22873)) {\n            // apply ",
                                    "map function(s)\n            {\n                // apply map function\n                {\n                    bool eta_p_42189 = ((__global bool *) clProc_mem_49384)[gtid_42823];\n                    bool lifted_lambda_res_42190 = !eta_p_42189;\n                    int64_t bool_res_42191 = btoi_bool_i64(lifted_lambda_res_42190);\n                    \n                    // load accumulator(s)\n                    {\n                        eta_p_37745 = eta_p_block_res_acc_50236;\n                    }\n                    // load next value(s)\n                    {\n                        eta_p_37746 = bool_res_42191;\n                    }\n                    // apply reduction operator(s)\n                    {\n                        int64_t zp_res_37747 = add64(eta_p_37745, eta_p_37746);\n                        \n                        // store in accumulator(s)\n                        {\n                            eta_p_block_res_acc_50236 = zp_res_37747;\n                        }\n                    }\n                }\n            }\n        }\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // store accs. prims go in lmem; non-prims in params (in global mem)\n    {\n        ((__local int64_t *) red_arr_i64_mem_50231)[sext_i32_i64(local_tid_50227)] = eta_p_block_res_acc_50236;\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    skip_waves_50245 = 1;\n    offset_50244 = 0;\n    // participating threads read initial accumulator\n    {\n        if (slt32(local_tid_50227, sext_i64_i32(segred_tblock_sizze_42817))) {\n            eta_p_50237 = ((__local int64_t *) red_arr_i64_mem_50231)[sext_i32_i64(local_tid_50227 + offset_50244)];\n        }\n    }\n    offset_50244 = 1;\n    while (slt32(offset_50244, wave_sizze_50229)) {\n        if (slt32(local_tid_50227 + offset_50244, sext_i64_i32(segred_tblock_sizze_42817)) && ((local_tid_50227 - squot32(local_tid_50227, wave_sizze_50229) * wave_sizze_50229) & (2 * offset_50244 - 1)) == 0) {\n            // read array element\n            {\n                eta_p_5", "0238 = ((volatile __local int64_t *) red_arr_i64_mem_50231)[sext_i32_i64(local_tid_50227 + offset_50244)];\n            }\n            // apply reduction operation\n            {\n                int64_t zp_res_50239 = add64(eta_p_50237, eta_p_50238);\n                \n                eta_p_50237 = zp_res_50239;\n            }\n            // write result of operation\n            {\n                ((volatile __local int64_t *) red_arr_i64_mem_50231)[sext_i32_i64(local_tid_50227)] = eta_p_50237;\n            }\n        }\n        offset_50244 *= 2;\n    }\n    while (slt32(skip_waves_50245, squot32(sext_i64_i32(segred_tblock_sizze_42817) + wave_sizze_50229 - 1, wave_sizze_50229))) {\n        barrier(CLK_LOCAL_MEM_FENCE);\n        offset_50244 = skip_waves_50245 * wave_sizze_50229;\n        if (slt32(local_tid_50227 + offset_50244, sext_i64_i32(segred_tblock_sizze_42817)) && ((local_tid_50227 - squot32(local_tid_50227, wave_sizze_50229) * wave_sizze_50229) == 0 && (squot32(local_tid_50227, wave_sizze_50229) & (2 * skip_waves_50245 - 1)) == 0)) {\n            // read array element\n            {\n                eta_p_50238 = ((__local int64_t *) red_arr_i64_mem_50231)[sext_i32_i64(local_tid_50227 + offset_50244)];\n            }\n            // apply reduction operation\n            {\n                int64_t zp_res_50239 = add64(eta_p_50237, eta_p_50238);\n                \n                eta_p_50237 = zp_res_50239;\n            }\n            // write result of operation\n            {\n                ((__local int64_t *) red_arr_i64_mem_50231)[sext_i32_i64(local_tid_50227)] = eta_p_50237;\n            }\n        }\n        skip_waves_50245 *= 2;\n    }\n    barrier(CLK_LOCAL_MEM_FENCE);\n    barrier(CLK_LOCAL_MEM_FENCE);\n    // thread 0 updates per-block acc(s); rest reset to ne\n    {\n        if (sext_i32_i64(local_tid_50227) == (int64_t) 0) {\n            eta_p_block_res_acc_50236 = eta_p_50237;\n        } else {\n            eta_p_block_res_acc_50236 = (int64_t) 0;\n        }\n    }\n    // first thr", "ead in block saves block result to global memory\n    {\n        if (local_tid_50227 == 0) {\n            ((__global int64_t *) segred_tmp_mem_50223)[sext_i32_i64(block_id_50228)] = eta_p_block_res_acc_50236;\n            mem_fence_global();\n            old_counter_50246 = atomic_add_i32_global(&((volatile __global int *) counters_mem_50201)[(int64_t) 0], (int) 1);\n            ((__local bool *) sync_arr_mem_50233)[(int64_t) 0] = old_counter_50246 == sext_i64_i32(num_tblocks_42819 - (int64_t) 1);\n        }\n    }\n    barrier(CLK_GLOBAL_MEM_FENCE | CLK_LOCAL_MEM_FENCE);\n    is_last_block_50247 = ((__local bool *) sync_arr_mem_50233)[(int64_t) 0];\n    if (is_last_block_50247) {\n        if (local_tid_50227 == 0) {\n            old_counter_50246 = atomic_add_i32_global(&((volatile __global int *) counters_mem_50201)[(int64_t) 0], (int) sext_i64_i32((int64_t) 0 - num_tblocks_42819));\n        }\n        // read in the per-block-results\n        {\n            int64_t read_per_thread_50248 = sdiv_up64(num_tblocks_42819, segred_tblock_sizze_42817);\n            \n            eta_p_37745 = (int64_t) 0;\n            for (int64_t i_50249 = 0; i_50249 < read_per_thread_50248; i_50249++) {\n                int64_t block_res_id_50250 = sext_i32_i64(local_tid_50227) * read_per_thread_50248 + i_50249;\n                int64_t index_of_block_res_50251 = block_res_id_50250;\n                \n                if (slt64(block_res_id_50250, num_tblocks_42819)) {\n                    eta_p_37746 = ((__global int64_t *) segred_tmp_mem_50223)[index_of_block_res_50251];\n                    \n                    int64_t zp_res_37747 = add64(eta_p_37745, eta_p_37746);\n                    \n                    eta_p_37745 = zp_res_37747;\n                }\n            }\n        }\n        ((__local int64_t *) red_arr_i64_mem_50231)[sext_i32_i64(local_tid_50227)] = eta_p_37745;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        // reduce the per-block results\n        {\n            int32_t offset_50252;\n            int32_",
                                    "t skip_waves_50253 = 1;\n            int64_t eta_p_50237;\n            int64_t eta_p_50238;\n            \n            offset_50252 = 0;\n            // participating threads read initial accumulator\n            {\n                if (slt32(local_tid_50227, sext_i64_i32(segred_tblock_sizze_42817))) {\n                    eta_p_50237 = ((__local int64_t *) red_arr_i64_mem_50231)[sext_i32_i64(local_tid_50227 + offset_50252)];\n                }\n            }\n            offset_50252 = 1;\n            while (slt32(offset_50252, wave_sizze_50229)) {\n                if (slt32(local_tid_50227 + offset_50252, sext_i64_i32(segred_tblock_sizze_42817)) && ((local_tid_50227 - squot32(local_tid_50227, wave_sizze_50229) * wave_sizze_50229) & (2 * offset_50252 - 1)) == 0) {\n                    // read array element\n                    {\n                        eta_p_50238 = ((volatile __local int64_t *) red_arr_i64_mem_50231)[sext_i32_i64(local_tid_50227 + offset_50252)];\n                    }\n                    // apply reduction operation\n                    {\n                        int64_t zp_res_50239 = add64(eta_p_50237, eta_p_50238);\n                        \n                        eta_p_50237 = zp_res_50239;\n                    }\n                    // write result of operation\n                    {\n                        ((volatile __local int64_t *) red_arr_i64_mem_50231)[sext_i32_i64(local_tid_50227)] = eta_p_50237;\n                    }\n                }\n                offset_50252 *= 2;\n            }\n            while (slt32(skip_waves_50253, squot32(sext_i64_i32(segred_tblock_sizze_42817) + wave_sizze_50229 - 1, wave_sizze_50229))) {\n                barrier(CLK_LOCAL_MEM_FENCE);\n                offset_50252 = skip_waves_50253 * wave_sizze_50229;\n                if (slt32(local_tid_50227 + offset_50252, sext_i64_i32(segred_tblock_sizze_42817)) && ((local_tid_50227 - squot32(local_tid_50227, wave_sizze_50229) * wave_sizze_50229) == 0 && (squot32(local_tid_50227, wave_sizze_", "50229) & (2 * skip_waves_50253 - 1)) == 0)) {\n                    // read array element\n                    {\n                        eta_p_50238 = ((__local int64_t *) red_arr_i64_mem_50231)[sext_i32_i64(local_tid_50227 + offset_50252)];\n                    }\n                    // apply reduction operation\n                    {\n                        int64_t zp_res_50239 = add64(eta_p_50237, eta_p_50238);\n                        \n                        eta_p_50237 = zp_res_50239;\n                    }\n                    // write result of operation\n                    {\n                        ((__local int64_t *) red_arr_i64_mem_50231)[sext_i32_i64(local_tid_50227)] = eta_p_50237;\n                    }\n                }\n                skip_waves_50253 *= 2;\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // and back to memory with the final result\n            {\n                if (local_tid_50227 == 0) {\n                    ((__global int64_t *) mem_49402)[(int64_t) 0] = eta_p_50237;\n                }\n            }\n        }\n    }\n    \n  error_5:\n    return;\n    #undef segred_tblock_sizze_42817\n    #undef chunk_sizze_50200\n}\nFUTHARK_KERNEL_SIZED(next_partition_to_read_doublezisegscan_42832_dim1, 1, 1)\nvoid next_partition_to_read_doublezisegscan_42832(__global int *global_failure, int64_t part_no_22873, int64_t num_tblocks_42829, int64_t num_virt_blocks_50259, int64_t num_virt_threads_50260, __global unsigned char *clProc_mem_49384, __global unsigned char *mem_49406, __global unsigned char *mem_49408, __global unsigned char *status_flags_mem_50261, __global unsigned char *aggregates_mem_50283, __global unsigned char *incprefixes_mem_50285, __global unsigned char *global_dynid_mem_50287)\n{\n    #define segscan_tblock_sizze_42827 (next_partition_to_read_doublezisegscan_42832zisegscan_tblock_sizze_42827)\n    #define chunk_sizze_50258 (next_partition_to_read_doublezisegscan_42832zichunk_sizze_50258)\n    \n    volatile __local unsigned char *local", "_mem_50297_backing_0 = &shared_mem[0];\n    const int64_t local_mem_50297_backing_0_offset = 0 + (smax64(smax64((int64_t) 288, (int64_t) 8 * segscan_tblock_sizze_42827), chunk_sizze_50258 * segscan_tblock_sizze_42827 * (int64_t) 8) + srem64((int64_t) 8 - srem64(smax64(smax64((int64_t) 288, (int64_t) 8 * segscan_tblock_sizze_42827), chunk_sizze_50258 * segscan_tblock_sizze_42827 * (int64_t) 8), (int64_t) 8), (int64_t) 8));\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_50290;\n    int32_t tblock_sizze_50293;\n    int32_t wave_sizze_50292;\n    int32_t block_id_50291;\n    int32_t global_tid_50289;\n    int64_t phys_tid_42832;\n    int32_t chunk_sizze_32b_50294;\n    int64_t byte_offsets_50295;\n    int64_t warp_byte_offset_50296;\n    __local unsigned char *local_mem_50297;\n    int64_t trans_arr_len_50298;\n    int64_t phys_block_id_50304;\n    int64_t virtloop_bound_50305;\n    \n    local_tid_50290 = get_local_id(0);\n    tblock_sizze_50293 = get_local_size(0);\n    wave_sizze_50292 = LOCKSTEP_WIDTH;\n    block_id_50291 = get_tblock_id(0);\n    global_tid_50289 = block_id_50291 * tblock_sizze_50293 + local_tid_50290;\n    phys_tid_42832 = sext_i32_i64(global_tid_50289);\n    chunk_sizze_32b_50294 = sext_i64_i32(chunk_sizze_50258);\n    byte_offsets_50295 = segscan_tblock_sizze_42827 * (int64_t) 8;\n    warp_byte_offset_50296 = (int64_t) 288;\n    // Allocate reusable shared memory\n    { }\n    local_mem_50297 = (__local unsigned char *) local_mem_50297_backing_0;\n    trans_arr_len_50298 = chunk_sizze_50258 * segscan_tblock_sizze_42827;\n    phys_block_id_50304 = get_tblock_id(0);\n    virtloop_bound_50305 = sdiv_up64(num_virt_blocks_50259 - phys_block_id_50304, num_tblocks_42829);\n    for (int64_t virtloop_i_50306 = 0; virtloop_i_50306 < virtloop_bound_50305; virtloop_i_50306++) {\n        int64_t dynamic_id_50307;\n        int64_t block_offset_50308;\n        int64_t sgm_idx_50309;\n        int32_t boundary_50310;\n        int32_t segsizze_compact_50311;\n        i",
                                    "nt64_t private_mem_50312[chunk_sizze_50258];\n        int64_t thd_offset_50314;\n        int64_t acc_50330;\n        int64_t prefix_50340;\n        bool block_new_sgm_50341;\n        \n        // First thread in block fetches this block's dynamic_id\n        {\n            if (local_tid_50290 == 0) {\n                dynamic_id_50307 = atomic_add_i32_global(&((volatile __global int *) global_dynid_mem_50287)[(int64_t) 0], (int) 1);\n                // Set dynamic id for this block\n                {\n                    ((__local int64_t *) local_mem_50297)[(int64_t) 0] = dynamic_id_50307;\n                }\n                // First thread in last (virtual) block resets global dynamic_id\n                {\n                    if (dynamic_id_50307 == num_virt_blocks_50259 - (int64_t) 1) {\n                        ((__global int32_t *) global_dynid_mem_50287)[(int64_t) 0] = 0;\n                    }\n                }\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        dynamic_id_50307 = ((__local int32_t *) local_mem_50297)[(int64_t) 0];\n        barrier(CLK_LOCAL_MEM_FENCE);\n        block_offset_50308 = dynamic_id_50307 * chunk_sizze_50258 * segscan_tblock_sizze_42827;\n        sgm_idx_50309 = smod64(block_offset_50308, part_no_22873);\n        boundary_50310 = sext_i64_i32(smin64(chunk_sizze_50258 * segscan_tblock_sizze_42827, part_no_22873 - sgm_idx_50309));\n        segsizze_compact_50311 = sext_i64_i32(smin64(chunk_sizze_50258 * segscan_tblock_sizze_42827, part_no_22873));\n        thd_offset_50314 = block_offset_50308 + sext_i32_i64(local_tid_50290);\n        // Load and map\n        {\n            for (int64_t i_50315 = 0; i_50315 < chunk_sizze_50258; i_50315++) {\n                int64_t virt_tid_50316 = thd_offset_50314 + i_50315 * segscan_tblock_sizze_42827;\n                int64_t slice_50317 = part_no_22873;\n                int64_t gtid_42831 = virt_tid_50316;\n                int64_t remnant_50318 = virt_tid_50316 - gtid_42831;\n                \n                if", " (slt64(virt_tid_50316, part_no_22873)) {\n                    bool eta_p_42357 = ((__global bool *) clProc_mem_49384)[gtid_42831];\n                    bool lifted_lambda_res_42358 = !eta_p_42357;\n                    int64_t defunc_0_f_res_42359 = btoi_bool_i64(lifted_lambda_res_42358);\n                    \n                    ((__global int64_t *) mem_49408)[gtid_42831] = defunc_0_f_res_42359;\n                    private_mem_50312[i_50315] = defunc_0_f_res_42359;\n                } else {\n                    private_mem_50312[i_50315] = (int64_t) 0;\n                }\n            }\n        }\n        barrier(CLK_LOCAL_MEM_FENCE);\n        // Transpose scan inputs\n        {\n            for (int64_t i_50319 = 0; i_50319 < chunk_sizze_50258; i_50319++) {\n                int64_t sharedIdx_50320 = sext_i32_i64(local_tid_50290) + i_50319 * segscan_tblock_sizze_42827;\n                int64_t tmp_50321 = private_mem_50312[i_50319];\n                \n                ((__local int64_t *) local_mem_50297)[sharedIdx_50320] = tmp_50321;\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            for (int64_t i_50322 = 0; i_50322 < chunk_sizze_50258; i_50322++) {\n                int64_t sharedIdx_50323 = sext_i32_i64(local_tid_50290) * chunk_sizze_50258 + i_50322;\n                int64_t tmp_50324 = ((__local int64_t *) local_mem_50297)[sharedIdx_50323];\n                \n                private_mem_50312[i_50322] = tmp_50324;\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n        }\n        // Per thread scan\n        {\n            for (int64_t i_50325 = 0; i_50325 < chunk_sizze_50258 - (int64_t) 1; i_50325++) {\n                int64_t eta_p_42360;\n                int64_t eta_p_42361;\n                \n                eta_p_42360 = private_mem_50312[i_50325];\n                eta_p_42361 = private_mem_50312[i_50325 + (int64_t) 1];\n                \n                int64_t defunc_0_op_res_42362 = add64(eta_p_42360, eta_p_42361);\n                \n                private_mem_", "50312[i_50325 + (int64_t) 1] = defunc_0_op_res_42362;\n            }\n        }\n        // Publish results in shared memory\n        {\n            int64_t tmp_50326 = private_mem_50312[chunk_sizze_50258 - (int64_t) 1];\n            \n            ((__local int64_t *) local_mem_50297)[sext_i32_i64(local_tid_50290)] = tmp_50326;\n            barrier(CLK_LOCAL_MEM_FENCE);\n        }\n        // Scan results (with warp scan)\n        {\n            int64_t eta_p_50327;\n            int64_t eta_p_50328;\n            int64_t eta_p_50331;\n            int64_t eta_p_50332;\n            bool ltid_in_bounds_50334 = slt64(sext_i32_i64(local_tid_50290), num_virt_threads_50260);\n            int32_t skip_threads_50335;\n            \n            // read input for in-block scan\n            {\n                if (ltid_in_bounds_50334) {\n                    eta_p_50328 = ((volatile __local int64_t *) local_mem_50297)[sext_i32_i64(local_tid_50290)];\n                    if ((local_tid_50290 - squot32(local_tid_50290, 32) * 32) == 0) {\n                        eta_p_50327 = eta_p_50328;\n                    }\n                }\n            }\n            // in-block scan (hopefully no barriers needed)\n            {\n                skip_threads_50335 = 1;\n                while (slt32(skip_threads_50335, 32)) {\n                    bool thread_active_50336 = sle32(skip_threads_50335, local_tid_50290 - squot32(local_tid_50290, 32) * 32) && ltid_in_bounds_50334;\n                    \n                    if (thread_active_50336) {\n                        // read operands\n                        {\n                            eta_p_50327 = ((volatile __local int64_t *) local_mem_50297)[sext_i32_i64(local_tid_50290) - sext_i32_i64(skip_threads_50335)];\n                        }\n                    }\n                    // perform operation\n                    {\n                        if (thread_active_50336) {\n                            int64_t defunc_0_op_res_50329 = add64(eta_p_50327, eta_p_50328);\n              ",
                                    "              \n                            eta_p_50327 = defunc_0_op_res_50329;\n                        }\n                    }\n                    if (sle32(wave_sizze_50292, skip_threads_50335)) {\n                        barrier(CLK_LOCAL_MEM_FENCE);\n                    }\n                    if (thread_active_50336) {\n                        // write result\n                        {\n                            ((volatile __local int64_t *) local_mem_50297)[sext_i32_i64(local_tid_50290)] = eta_p_50327;\n                            eta_p_50328 = eta_p_50327;\n                        }\n                    }\n                    if (sle32(wave_sizze_50292, skip_threads_50335)) {\n                        barrier(CLK_LOCAL_MEM_FENCE);\n                    }\n                    skip_threads_50335 *= 2;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // last thread of block 'i' writes its result to offset 'i'\n            {\n                if ((local_tid_50290 - squot32(local_tid_50290, 32) * 32) == 31 && ltid_in_bounds_50334) {\n                    ((volatile __local int64_t *) local_mem_50297)[sext_i32_i64(squot32(local_tid_50290, 32))] = eta_p_50327;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // scan the first block, after which offset 'i' contains carry-in for block 'i+1'\n            {\n                int32_t skip_threads_50337;\n                \n                // read input for in-block scan\n                {\n                    if (squot32(local_tid_50290, 32) == 0 && ltid_in_bounds_50334) {\n                        eta_p_50332 = ((volatile __local int64_t *) local_mem_50297)[sext_i32_i64(local_tid_50290)];\n                        if ((local_tid_50290 - squot32(local_tid_50290, 32) * 32) == 0) {\n                            eta_p_50331 = eta_p_50332;\n                        }\n                    }\n                }\n                // in-block scan (hopefully no barriers needed)\n                {", "\n                    skip_threads_50337 = 1;\n                    while (slt32(skip_threads_50337, 32)) {\n                        bool thread_active_50338 = sle32(skip_threads_50337, local_tid_50290 - squot32(local_tid_50290, 32) * 32) && (squot32(local_tid_50290, 32) == 0 && ltid_in_bounds_50334);\n                        \n                        if (thread_active_50338) {\n                            // read operands\n                            {\n                                eta_p_50331 = ((volatile __local int64_t *) local_mem_50297)[sext_i32_i64(local_tid_50290) - sext_i32_i64(skip_threads_50337)];\n                            }\n                        }\n                        // perform operation\n                        {\n                            if (thread_active_50338) {\n                                int64_t defunc_0_op_res_50333 = add64(eta_p_50331, eta_p_50332);\n                                \n                                eta_p_50331 = defunc_0_op_res_50333;\n                            }\n                        }\n                        if (sle32(wave_sizze_50292, skip_threads_50337)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        if (thread_active_50338) {\n                            // write result\n                            {\n                                ((volatile __local int64_t *) local_mem_50297)[sext_i32_i64(local_tid_50290)] = eta_p_50331;\n                                eta_p_50332 = eta_p_50331;\n                            }\n                        }\n                        if (sle32(wave_sizze_50292, skip_threads_50337)) {\n                            barrier(CLK_LOCAL_MEM_FENCE);\n                        }\n                        skip_threads_50337 *= 2;\n                    }\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            \n            bool no_carry_in_50339 = squot32(local_tid_50290, 32) == 0 || !ltid_in_bounds_50334;\n            \n  ", "          // carry-in for every block except the first\n            {\n                // read operands\n                {\n                    if (!no_carry_in_50339) {\n                        eta_p_50328 = eta_p_50327;\n                        eta_p_50327 = ((__local int64_t *) local_mem_50297)[sext_i32_i64(squot32(local_tid_50290, 32)) - (int64_t) 1];\n                    }\n                }\n                // perform operation\n                {\n                    if (!no_carry_in_50339) {\n                        int64_t defunc_0_op_res_50329 = add64(eta_p_50327, eta_p_50328);\n                        \n                        eta_p_50327 = defunc_0_op_res_50329;\n                    }\n                }\n                // write final result\n                {\n                    if (!no_carry_in_50339) {\n                        ((__local int64_t *) local_mem_50297)[sext_i32_i64(local_tid_50290)] = eta_p_50327;\n                    }\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            // restore correct values for first block\n            {\n                if (squot32(local_tid_50290, 32) == 0 && ltid_in_bounds_50334) {\n                    ((__local int64_t *) local_mem_50297)[sext_i32_i64(local_tid_50290)] = eta_p_50328;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            barrier(CLK_LOCAL_MEM_FENCE);\n            if (local_tid_50290 == 0) {\n                acc_50330 = ((__local int64_t *) local_mem_50297)[segscan_tblock_sizze_42827 - (int64_t) 1];\n            } else {\n                acc_50330 = ((__local int64_t *) local_mem_50297)[sext_i32_i64(local_tid_50290) - (int64_t) 1];\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n        }\n        prefix_50340 = (int64_t) 0;\n        block_new_sgm_50341 = sgm_idx_50309 == (int64_t) 0;\n        // Perform lookback\n        {\n            if (block_new_sgm_50341 && local_tid_50290 == 0) {\n                ((volatile __global int64_t *) incprefixes_mem_50285)[dy",
                                    "namic_id_50307] = acc_50330;\n                mem_fence_global();\n                ((volatile __global int8_t *) status_flags_mem_50261)[dynamic_id_50307] = (int8_t) 2;\n                acc_50330 = (int64_t) 0;\n            }\n            if (!block_new_sgm_50341 && slt32(local_tid_50290, wave_sizze_50292)) {\n                if (local_tid_50290 == 0) {\n                    ((volatile __global int64_t *) aggregates_mem_50283)[dynamic_id_50307] = acc_50330;\n                    mem_fence_global();\n                    ((volatile __global int8_t *) status_flags_mem_50261)[dynamic_id_50307] = (int8_t) 1;\n                    \n                    int8_t tmp_50342 = ((volatile __global int8_t *) status_flags_mem_50261)[dynamic_id_50307 - (int64_t) 1];\n                    \n                    ((volatile __local int8_t *) local_mem_50297)[(int64_t) 0] = tmp_50342;\n                }\n                mem_fence_local();\n                \n                int8_t status_50343 = ((__local int8_t *) local_mem_50297)[(int64_t) 0];\n                \n                if (status_50343 == (int8_t) 2) {\n                    if (local_tid_50290 == 0) {\n                        prefix_50340 = ((volatile __global int64_t *) incprefixes_mem_50285)[dynamic_id_50307 - (int64_t) 1];\n                    }\n                } else {\n                    int32_t readOffset_50344 = sext_i64_i32(dynamic_id_50307 - sext_i32_i64(wave_sizze_50292));\n                    \n                    while (slt32(wave_sizze_50292 * -1, readOffset_50344)) {\n                        int32_t read_i_50345 = readOffset_50344 + local_tid_50290;\n                        int64_t aggr_50346 = (int64_t) 0;\n                        int8_t flag_50347 = (int8_t) 0;\n                        \n                        if (sle32(0, read_i_50345)) {\n                            flag_50347 = ((volatile __global int8_t *) status_flags_mem_50261)[sext_i32_i64(read_i_50345)];\n                            if (flag_50347 == (int8_t) 2) {\n                       ", "         aggr_50346 = ((volatile __global int64_t *) incprefixes_mem_50285)[sext_i32_i64(read_i_50345)];\n                            } else if (flag_50347 == (int8_t) 1) {\n                                aggr_50346 = ((volatile __global int64_t *) aggregates_mem_50283)[sext_i32_i64(read_i_50345)];\n                            }\n                        }\n                        ((__local int64_t *) local_mem_50297)[(int64_t) 4 + sext_i32_i64(local_tid_50290)] = aggr_50346;\n                        ((__local int8_t *) local_mem_50297)[sext_i32_i64(local_tid_50290)] = flag_50347;\n                        flag_50347 = ((__local int8_t *) local_mem_50297)[sext_i32_i64(wave_sizze_50292) - (int64_t) 1];\n                        if (slt8(flag_50347, (int8_t) 2)) {\n                            int8_t flg_x_50351;\n                            int8_t flg_y_50352;\n                            int64_t eta_p_50348;\n                            int64_t eta_p_50349;\n                            int32_t skip_threads_50353;\n                            \n                            // read input for in-block scan\n                            {\n                                flg_y_50352 = ((volatile __local int8_t *) local_mem_50297)[sext_i32_i64(local_tid_50290)];\n                                eta_p_50349 = ((volatile __local int64_t *) local_mem_50297)[(int64_t) 4 + sext_i32_i64(local_tid_50290)];\n                                if ((local_tid_50290 - squot32(local_tid_50290, 32) * 32) == 0) {\n                                    eta_p_50348 = eta_p_50349;\n                                    flg_x_50351 = flg_y_50352;\n                                }\n                            }\n                            // in-block scan (hopefully no barriers needed)\n                            {\n                                skip_threads_50353 = 1;\n                                while (slt32(skip_threads_50353, 32)) {\n                                    if (sle32(skip_threads_50353, local_tid_50290 -", " squot32(local_tid_50290, 32) * 32)) {\n                                        // read operands\n                                        {\n                                            flg_x_50351 = ((volatile __local int8_t *) local_mem_50297)[sext_i32_i64(local_tid_50290) - sext_i32_i64(skip_threads_50353)];\n                                            eta_p_50348 = ((volatile __local int64_t *) local_mem_50297)[(int64_t) 4 + (sext_i32_i64(local_tid_50290) - sext_i32_i64(skip_threads_50353))];\n                                        }\n                                        // perform operation\n                                        {\n                                            if (flg_y_50352 == (int8_t) 2 || flg_y_50352 == (int8_t) 0) {\n                                                flg_x_50351 = flg_y_50352;\n                                                eta_p_50348 = eta_p_50349;\n                                            } else {\n                                                int64_t defunc_0_op_res_50350 = add64(eta_p_50348, eta_p_50349);\n                                                \n                                                eta_p_50348 = defunc_0_op_res_50350;\n                                            }\n                                        }\n                                        // write result\n                                        {\n                                            ((volatile __local int8_t *) local_mem_50297)[sext_i32_i64(local_tid_50290)] = flg_x_50351;\n                                            flg_y_50352 = flg_x_50351;\n                                            ((volatile __local int64_t *) local_mem_50297)[(int64_t) 4 + sext_i32_i64(local_tid_50290)] = eta_p_50348;\n                                            eta_p_50349 = eta_p_50348;\n                                        }\n                                    }\n                                    skip_threads_50353 *= 2;\n                                }\n            ",
                                    "                }\n                        }\n                        flag_50347 = ((__local int8_t *) local_mem_50297)[sext_i32_i64(wave_sizze_50292) - (int64_t) 1];\n                        aggr_50346 = ((__local int64_t *) local_mem_50297)[(int64_t) 4 + (sext_i32_i64(wave_sizze_50292) - (int64_t) 1)];\n                        if (flag_50347 == (int8_t) 2) {\n                            readOffset_50344 = wave_sizze_50292 * -1;\n                        } else if (flag_50347 == (int8_t) 1) {\n                            readOffset_50344 -= wave_sizze_50292;\n                        }\n                        if (slt8((int8_t) 0, flag_50347)) {\n                            int64_t eta_p_50354 = aggr_50346;\n                            int64_t eta_p_50355 = prefix_50340;\n                            int64_t defunc_0_op_res_50356 = add64(eta_p_50354, eta_p_50355);\n                            \n                            prefix_50340 = defunc_0_op_res_50356;\n                        }\n                        mem_fence_local();\n                    }\n                }\n                if (local_tid_50290 == 0) {\n                    if (boundary_50310 == sext_i64_i32(segscan_tblock_sizze_42827 * chunk_sizze_50258)) {\n                        int64_t eta_p_50357 = prefix_50340;\n                        int64_t eta_p_50358 = acc_50330;\n                        int64_t defunc_0_op_res_50359 = add64(eta_p_50357, eta_p_50358);\n                        \n                        ((volatile __global int64_t *) incprefixes_mem_50285)[dynamic_id_50307] = defunc_0_op_res_50359;\n                        mem_fence_global();\n                        ((volatile __global int8_t *) status_flags_mem_50261)[dynamic_id_50307] = (int8_t) 2;\n                    }\n                    ((__local int64_t *) local_mem_50297)[(int64_t) 4] = prefix_50340;\n                    acc_50330 = (int64_t) 0;\n                }\n            }\n            if (!(dynamic_id_50307 == (int64_t) 0)) {\n                barrier(CLK_LOCAL_MEM", "_FENCE);\n                prefix_50340 = ((__local int64_t *) local_mem_50297)[(int64_t) 4];\n                barrier(CLK_LOCAL_MEM_FENCE);\n            }\n        }\n        // Distribute results\n        {\n            int64_t eta_p_50360;\n            int64_t eta_p_50361;\n            int64_t eta_p_50363 = prefix_50340;\n            int64_t eta_p_50364 = acc_50330;\n            \n            if (slt32(local_tid_50290 * chunk_sizze_32b_50294, boundary_50310) && !block_new_sgm_50341) {\n                int64_t defunc_0_op_res_50365 = add64(eta_p_50363, eta_p_50364);\n                \n                eta_p_50360 = defunc_0_op_res_50365;\n            } else {\n                eta_p_50360 = acc_50330;\n            }\n            \n            int32_t stopping_point_50366 = segsizze_compact_50311 - srem32(local_tid_50290 * chunk_sizze_32b_50294 - 1 + segsizze_compact_50311 - boundary_50310, segsizze_compact_50311);\n            \n            for (int64_t i_50367 = 0; i_50367 < chunk_sizze_50258; i_50367++) {\n                if (slt32(sext_i64_i32(i_50367), stopping_point_50366 - 1)) {\n                    eta_p_50361 = private_mem_50312[i_50367];\n                    \n                    int64_t defunc_0_op_res_50362 = add64(eta_p_50360, eta_p_50361);\n                    \n                    private_mem_50312[i_50367] = defunc_0_op_res_50362;\n                }\n            }\n        }\n        // Transpose scan output and Write it to global memory in coalesced fashion\n        {\n            for (int64_t i_50368 = 0; i_50368 < chunk_sizze_50258; i_50368++) {\n                int64_t sharedIdx_50369 = sext_i32_i64(local_tid_50290) * chunk_sizze_50258 + i_50368;\n                int64_t tmp_50370 = private_mem_50312[i_50368];\n                \n                ((__local int64_t *) local_mem_50297)[sharedIdx_50369] = tmp_50370;\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n            for (int64_t i_50371 = 0; i_50371 < chunk_sizze_50258; i_50371++) {\n                int64_t flat_idx_50372 = ", "thd_offset_50314 + i_50371 * segscan_tblock_sizze_42827;\n                int64_t slice_50373 = part_no_22873;\n                int64_t gtid_42831 = flat_idx_50372;\n                int64_t remnant_50374 = flat_idx_50372 - gtid_42831;\n                \n                if (slt64(flat_idx_50372, part_no_22873)) {\n                    int64_t tmp_50375 = ((__local int64_t *) local_mem_50297)[flat_idx_50372 - block_offset_50308];\n                    \n                    ((__global int64_t *) mem_49406)[gtid_42831] = tmp_50375;\n                }\n            }\n            barrier(CLK_LOCAL_MEM_FENCE);\n        }\n    }\n    \n  error_3:\n    return;\n    #undef segscan_tblock_sizze_42827\n    #undef chunk_sizze_50258\n}\nFUTHARK_KERNEL_SIZED(rectify_partition_ids_doublezisegmap_intrablock_46535_dim1, 1, 1)\nvoid rectify_partition_ids_doublezisegmap_intrablock_46535(__global int *global_failure, int64_t dz2081Uz2080U_35912, int64_t inf_37711, int64_t dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_37714, int64_t ldim_46538, int64_t num_whole_tiles_46553, int64_t residual_input_46700, unsigned char cond_46701_bits, int64_t binop_x_46714, __global unsigned char *partition_ids_mem_49374, __global unsigned char *chain_id_mem_49375, __global unsigned char *replaceWith_mem_49376, __global unsigned char *mem_49378)\n{\n    bool cond_46701 = cond_46701_bits;\n    \n    #define tile_sizze_46537 (rectify_partition_ids_doublezisegmap_intrablock_46535zitile_sizze_46537)\n    #define bytes_49437 (rectify_partition_ids_doublezisegmap_intrablock_46535zibytes_49437)\n    \n    volatile __local unsigned char *color_50173_backing_1 = &shared_mem[0];\n    const int64_t color_50173_backing_1_offset = 0 + (bytes_49437 + srem64((int64_t) 8 - srem64(bytes_49437, (int64_t) 8), (int64_t) 8));\n    volatile __local unsigned char *color_50172_backing_0 = &shared_mem[color_50173_backing_1_offset];\n    const int64_t color_50172_backing_0_offset = color_50173_backing_1_offset + (bytes_49437 + srem64((int64_t) 8 - srem64(bytes_49437, (int64",
                                    "_t) 8), (int64_t) 8));\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_50196;\n    int32_t tblock_sizze_50199;\n    int32_t wave_sizze_50198;\n    int32_t block_id_50197;\n    int32_t global_tid_50195;\n    int64_t gid_flat_46535;\n    int64_t slice_50201;\n    int64_t ltid_pre_50200;\n    int64_t remnant_50202;\n    int64_t slice_50203;\n    int64_t gid_46534;\n    int64_t remnant_50204;\n    __local unsigned char *color_50172;\n    __local unsigned char *color_50173;\n    int64_t binop_x_46545;\n    int64_t mem_49426[1];\n    int64_t ltid_flat_46540;\n    int64_t ltid_46539;\n    int64_t gtid_46546;\n    bool cond_46547;\n    int64_t pre_46548;\n    int64_t mem_49430[1];\n    int64_t mem_49434[1];\n    int64_t ltid_flat_46555;\n    int64_t ltid_46554;\n    int64_t gtid_46563;\n    bool cond_46564;\n    int64_t neutral_46565;\n    int64_t neutral_46566;\n    int64_t ext_mem_49450[1];\n    int64_t ext_mem_49449[1];\n    int64_t mem_param_49435[1];\n    int64_t mem_param_49436[1];\n    int64_t mem_49458[1];\n    int64_t ext_mem_49459[1];\n    \n    local_tid_50196 = get_local_id(0);\n    tblock_sizze_50199 = get_local_size(0);\n    wave_sizze_50198 = LOCKSTEP_WIDTH;\n    block_id_50197 = get_tblock_id(0);\n    global_tid_50195 = block_id_50197 * tblock_sizze_50199 + local_tid_50196;\n    gid_flat_46535 = sext_i32_i64(block_id_50197);\n    slice_50201 = tile_sizze_46537;\n    ltid_pre_50200 = sext_i32_i64(local_tid_50196);\n    remnant_50202 = sext_i32_i64(local_tid_50196) - ltid_pre_50200;\n    slice_50203 = ldim_46538;\n    gid_46534 = sext_i32_i64(block_id_50197);\n    remnant_50204 = sext_i32_i64(block_id_50197) - gid_46534;\n    color_50172 = (__local unsigned char *) color_50172_backing_0;\n    color_50173 = (__local unsigned char *) color_50173_backing_1;\n    binop_x_46545 = gid_46534 * tile_sizze_46537;\n    ltid_flat_46540 = sext_i32_i64(local_tid_50196);\n    ltid_46539 = sext_i32_i64(sext_i64_i32(ltid_pre_50200));\n    gtid_46546 = ltid_46539 + binop_x_46545;\n    cond_46547 = sl", "t64(gtid_46546, dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_37714);\n    if (cond_46547) {\n        int64_t slice_46549;\n        int64_t eta_p_46550;\n        \n        slice_46549 = inf_37711 + gtid_46546;\n        eta_p_46550 = ((__global int64_t *) partition_ids_mem_49374)[slice_46549];\n        pre_46548 = eta_p_46550;\n    } else {\n        pre_46548 = (int64_t) 0;\n    }\n    mem_49426[(int64_t) 0] = pre_46548;\n    barrier(CLK_LOCAL_MEM_FENCE);\n    ltid_flat_46555 = sext_i32_i64(local_tid_50196);\n    ltid_46554 = sext_i32_i64(sext_i64_i32(ltid_pre_50200));\n    gtid_46563 = binop_x_46545 + ltid_46554;\n    cond_46564 = slt64(gtid_46563, dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_37714);\n    if (cond_46564) {\n        int64_t eta_p_46567 = mem_49426[(int64_t) 0];\n        \n        neutral_46565 = eta_p_46567;\n        neutral_46566 = eta_p_46567;\n    } else {\n        neutral_46565 = (int64_t) 0;\n        neutral_46566 = (int64_t) 0;\n    }\n    mem_49430[(int64_t) 0] = neutral_46565;\n    mem_49434[(int64_t) 0] = neutral_46566;\n    barrier(CLK_LOCAL_MEM_FENCE);\n    barrier(CLK_LOCAL_MEM_FENCE);\n    for (int32_t i_2 = 0; i_2 < 1; i_2++)\n        mem_param_49435[i_2] = mem_49430[i_2];\n    for (int32_t i_3 = 0; i_3 < 1; i_3++)\n        mem_param_49436[i_3] = mem_49434[i_3];\n    for (int64_t tile_id_46574 = 0; tile_id_46574 < num_whole_tiles_46553; tile_id_46574++) {\n        int64_t binop_x_46642;\n        int64_t ltid_flat_46641;\n        int64_t ltid_46640;\n        int64_t j_46643;\n        bool cond_46647;\n        int64_t pre1d_46648;\n        int64_t pre1d_46649;\n        int64_t mem_49444[1];\n        int64_t mem_49448[1];\n        int64_t ltid_flat_46657;\n        int64_t ltid_46656;\n        int64_t gtid_46659;\n        int64_t acc_46661;\n        int64_t acc_46662;\n        bool cond_46663;\n        int64_t acc_46664;\n        int64_t acc_46665;\n        int64_t mem_param_tmp_50205[1];\n        int64_t mem_param_tmp_50206[1];\n        \n        binop_x_46642 = tile_sizze_46537 * tile_id_46574;\n        ltid_flat_46", "641 = sext_i32_i64(local_tid_50196);\n        ltid_46640 = sext_i32_i64(sext_i64_i32(ltid_pre_50200));\n        j_46643 = ltid_46640 + binop_x_46642;\n        cond_46647 = slt64(j_46643, dz2081Uz2080U_35912);\n        if (cond_46647) {\n            int64_t tile_elem_46650;\n            int64_t tile_elem_46651;\n            \n            tile_elem_46650 = ((__global int64_t *) chain_id_mem_49375)[j_46643];\n            tile_elem_46651 = ((__global int64_t *) replaceWith_mem_49376)[j_46643];\n            pre1d_46648 = tile_elem_46650;\n            pre1d_46649 = tile_elem_46651;\n        } else {\n            pre1d_46648 = (int64_t) 0;\n            pre1d_46649 = (int64_t) 0;\n        }\n        ((__local int64_t *) color_50173)[ltid_46640] = pre1d_46648;\n        ((__local int64_t *) color_50172)[ltid_46640] = pre1d_46649;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        ltid_flat_46657 = sext_i32_i64(local_tid_50196);\n        ltid_46656 = sext_i32_i64(sext_i64_i32(ltid_pre_50200));\n        gtid_46659 = binop_x_46545 + ltid_46656;\n        acc_46661 = mem_param_49435[(int64_t) 0];\n        acc_46662 = mem_param_49436[(int64_t) 0];\n        cond_46663 = slt64(gtid_46659, dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_37714);\n        if (cond_46663) {\n            int64_t eta_p_46660;\n            int64_t x_46666;\n            int64_t x_46667;\n            int64_t redout_49001;\n            int64_t redout_49002;\n            \n            eta_p_46660 = mem_49426[(int64_t) 0];\n            redout_49001 = acc_46661;\n            redout_49002 = acc_46662;\n            for (int64_t i_49003 = 0; i_49003 < tile_sizze_46537; i_49003++) {\n                int64_t x_46668;\n                bool cond_46674;\n                bool cond_46675;\n                bool cond_46676;\n                bool cond_f_res_t_res_46677;\n                bool x_46678;\n                bool y_46679;\n                bool cond_46680;\n                int64_t lifted_lambda_res_46681;\n                int64_t lifted_lambda_res_46682;\n                int64_t ",
                                    "redout_tmp_50209;\n                int64_t redout_tmp_50210;\n                \n                x_46668 = ((__local int64_t *) color_50173)[i_49003];\n                cond_46674 = redout_49001 == eta_p_46660;\n                cond_46675 = !cond_46674;\n                cond_46676 = x_46668 == eta_p_46660;\n                cond_f_res_t_res_46677 = redout_49002 == eta_p_46660;\n                x_46678 = cond_46676 && cond_f_res_t_res_46677;\n                y_46679 = cond_46674 && x_46678;\n                cond_46680 = cond_46675 || y_46679;\n                if (cond_46680) {\n                    lifted_lambda_res_46681 = x_46668;\n                } else {\n                    lifted_lambda_res_46681 = redout_49001;\n                }\n                if (cond_46680) {\n                    int64_t x_46669 = ((__local int64_t *) color_50172)[i_49003];\n                    \n                    lifted_lambda_res_46682 = x_46669;\n                } else {\n                    lifted_lambda_res_46682 = redout_49002;\n                }\n                redout_tmp_50209 = lifted_lambda_res_46681;\n                redout_tmp_50210 = lifted_lambda_res_46682;\n                redout_49001 = redout_tmp_50209;\n                redout_49002 = redout_tmp_50210;\n            }\n            x_46666 = redout_49001;\n            x_46667 = redout_49002;\n            acc_46664 = x_46666;\n            acc_46665 = x_46667;\n        } else {\n            acc_46664 = acc_46661;\n            acc_46665 = acc_46662;\n        }\n        mem_49444[(int64_t) 0] = acc_46664;\n        mem_49448[(int64_t) 0] = acc_46665;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        for (int32_t i_4 = 0; i_4 < 1; i_4++)\n            mem_param_tmp_50205[i_4] = mem_49444[i_4];\n        for (int32_t i_5 = 0; i_5 < 1; i_5++)\n            mem_param_tmp_50206[i_5] = mem_49448[i_5];\n        for (int32_t i_6 = 0; i_6 < 1; i_6++)\n            mem_param_49435[i_6] = mem_param_tmp_50205[i_6];\n        for (int32_t i_7 = 0; i_7 < 1; i_7++)\n            mem_param_49436[i_", "7] = mem_param_tmp_50206[i_7];\n    }\n    for (int32_t i_8 = 0; i_8 < 1; i_8++)\n        ext_mem_49450[i_8] = mem_param_49435[i_8];\n    for (int32_t i_9 = 0; i_9 < 1; i_9++)\n        ext_mem_49449[i_9] = mem_param_49436[i_9];\n    barrier(CLK_LOCAL_MEM_FENCE);\n    if (cond_46701) {\n        for (int32_t i_10 = 0; i_10 < 1; i_10++)\n            ext_mem_49459[i_10] = ext_mem_49449[i_10];\n    } else {\n        int64_t ltid_flat_46703;\n        int64_t ltid_46702;\n        int64_t j_46715;\n        bool cond_46719;\n        int64_t pre1d_46720;\n        int64_t pre1d_46721;\n        int64_t ltid_flat_46731;\n        int64_t ltid_46730;\n        int64_t gtid_46741;\n        int64_t acc_46744;\n        bool cond_46745;\n        int64_t acc_46747;\n        \n        ltid_flat_46703 = sext_i32_i64(local_tid_50196);\n        ltid_46702 = sext_i32_i64(sext_i64_i32(ltid_pre_50200));\n        j_46715 = ltid_46702 + binop_x_46714;\n        cond_46719 = slt64(j_46715, dz2081Uz2080U_35912);\n        if (cond_46719) {\n            int64_t tile_elem_46722;\n            int64_t tile_elem_46723;\n            \n            tile_elem_46722 = ((__global int64_t *) chain_id_mem_49375)[j_46715];\n            tile_elem_46723 = ((__global int64_t *) replaceWith_mem_49376)[j_46715];\n            pre1d_46720 = tile_elem_46722;\n            pre1d_46721 = tile_elem_46723;\n        } else {\n            pre1d_46720 = (int64_t) 0;\n            pre1d_46721 = (int64_t) 0;\n        }\n        ((__local int64_t *) color_50173)[ltid_46702] = pre1d_46720;\n        ((__local int64_t *) color_50172)[ltid_46702] = pre1d_46721;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        ltid_flat_46731 = sext_i32_i64(local_tid_50196);\n        ltid_46730 = sext_i32_i64(sext_i64_i32(ltid_pre_50200));\n        gtid_46741 = binop_x_46545 + ltid_46730;\n        acc_46744 = ext_mem_49449[(int64_t) 0];\n        cond_46745 = slt64(gtid_46741, dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_37714);\n        if (cond_46745) {\n            int64_t eta_p_46742;\n            int64_t acc_46", "743;\n            int64_t x_46748;\n            int64_t x_46749;\n            int64_t redout_49004;\n            int64_t redout_49005;\n            \n            eta_p_46742 = mem_49426[(int64_t) 0];\n            acc_46743 = ext_mem_49450[(int64_t) 0];\n            redout_49004 = acc_46743;\n            redout_49005 = acc_46744;\n            for (int64_t i_49006 = 0; i_49006 < residual_input_46700; i_49006++) {\n                int64_t x_46750;\n                bool cond_46756;\n                bool cond_46757;\n                bool cond_46758;\n                bool cond_f_res_t_res_46759;\n                bool x_46760;\n                bool y_46761;\n                bool cond_46762;\n                int64_t lifted_lambda_res_46763;\n                int64_t lifted_lambda_res_46764;\n                int64_t redout_tmp_50211;\n                int64_t redout_tmp_50212;\n                \n                x_46750 = ((__local int64_t *) color_50173)[i_49006];\n                cond_46756 = redout_49004 == eta_p_46742;\n                cond_46757 = !cond_46756;\n                cond_46758 = x_46750 == eta_p_46742;\n                cond_f_res_t_res_46759 = redout_49005 == eta_p_46742;\n                x_46760 = cond_46758 && cond_f_res_t_res_46759;\n                y_46761 = cond_46756 && x_46760;\n                cond_46762 = cond_46757 || y_46761;\n                if (cond_46762) {\n                    lifted_lambda_res_46763 = x_46750;\n                } else {\n                    lifted_lambda_res_46763 = redout_49004;\n                }\n                if (cond_46762) {\n                    int64_t x_46751 = ((__local int64_t *) color_50172)[i_49006];\n                    \n                    lifted_lambda_res_46764 = x_46751;\n                } else {\n                    lifted_lambda_res_46764 = redout_49005;\n                }\n                redout_tmp_50211 = lifted_lambda_res_46763;\n                redout_tmp_50212 = lifted_lambda_res_46764;\n                redout_49004 = redout_tmp_50211;\n            ",
                                    "    redout_49005 = redout_tmp_50212;\n            }\n            x_46748 = redout_49004;\n            x_46749 = redout_49005;\n            acc_46747 = x_46749;\n        } else {\n            acc_46747 = acc_46744;\n        }\n        mem_49458[(int64_t) 0] = acc_46747;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        for (int32_t i_11 = 0; i_11 < 1; i_11++)\n            ext_mem_49459[i_11] = mem_49458[i_11];\n    }\n    if (slt64(sext_i32_i64(local_tid_50196) + tile_sizze_46537 * sext_i32_i64(block_id_50197), dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_37714)) {\n        int64_t tmp_50213 = ext_mem_49459[(int64_t) 0];\n        \n        ((__global int64_t *) mem_49378)[inf_37711 + (sext_i32_i64(local_tid_50196) + tile_sizze_46537 * sext_i32_i64(block_id_50197))] = tmp_50213;\n    }\n    \n  error_8:\n    return;\n    #undef tile_sizze_46537\n    #undef bytes_49437\n}\nFUTHARK_KERNEL_SIZED(rectify_partition_ids_doublezisegmap_intrablock_46779_dim1, 1, 1)\nvoid rectify_partition_ids_doublezisegmap_intrablock_46779(__global int *global_failure, int64_t dz2081Uz2080U_35912, int64_t inf_37711, int64_t dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_37714, int64_t ldim_46782, int64_t num_whole_tiles_46797, int64_t residual_input_46944, unsigned char cond_46945_bits, int64_t binop_x_46958, __global unsigned char *partition_ids_mem_49374, __global unsigned char *chain_id_mem_49375, __global unsigned char *replaceWith_mem_49376, __global unsigned char *mem_49378)\n{\n    bool cond_46945 = cond_46945_bits;\n    \n    #define tile_sizze_46781 (rectify_partition_ids_doublezisegmap_intrablock_46779zitile_sizze_46781)\n    #define bytes_49397 (rectify_partition_ids_doublezisegmap_intrablock_46779zibytes_49397)\n    \n    volatile __local unsigned char *color_50175_backing_1 = &shared_mem[0];\n    const int64_t color_50175_backing_1_offset = 0 + (bytes_49397 + srem64((int64_t) 8 - srem64(bytes_49397, (int64_t) 8), (int64_t) 8));\n    volatile __local unsigned char *color_50174_backing_0 = &shared_mem[color_50175_backing_1_offset];\n    con", "st int64_t color_50174_backing_0_offset = color_50175_backing_1_offset + (bytes_49397 + srem64((int64_t) 8 - srem64(bytes_49397, (int64_t) 8), (int64_t) 8));\n    \n    if (*global_failure >= 0)\n        return;\n    \n    int32_t local_tid_50217;\n    int32_t tblock_sizze_50220;\n    int32_t wave_sizze_50219;\n    int32_t block_id_50218;\n    int32_t global_tid_50216;\n    int64_t gid_flat_46779;\n    int64_t slice_50222;\n    int64_t ltid_pre_50221;\n    int64_t remnant_50223;\n    int64_t slice_50224;\n    int64_t gid_46778;\n    int64_t remnant_50225;\n    __local unsigned char *color_50174;\n    __local unsigned char *color_50175;\n    int64_t binop_x_46789;\n    int64_t mem_49386[1];\n    int64_t ltid_flat_46784;\n    int64_t ltid_46783;\n    int64_t gtid_46790;\n    bool cond_46791;\n    int64_t pre_46792;\n    int64_t mem_49390[1];\n    int64_t mem_49394[1];\n    int64_t ltid_flat_46799;\n    int64_t ltid_46798;\n    int64_t gtid_46807;\n    bool cond_46808;\n    int64_t neutral_46809;\n    int64_t neutral_46810;\n    int64_t ext_mem_49410[1];\n    int64_t ext_mem_49409[1];\n    int64_t mem_param_49395[1];\n    int64_t mem_param_49396[1];\n    int64_t mem_49418[1];\n    int64_t ext_mem_49419[1];\n    \n    local_tid_50217 = get_local_id(0);\n    tblock_sizze_50220 = get_local_size(0);\n    wave_sizze_50219 = LOCKSTEP_WIDTH;\n    block_id_50218 = get_tblock_id(0);\n    global_tid_50216 = block_id_50218 * tblock_sizze_50220 + local_tid_50217;\n    gid_flat_46779 = sext_i32_i64(block_id_50218);\n    slice_50222 = tile_sizze_46781;\n    ltid_pre_50221 = sext_i32_i64(local_tid_50217);\n    remnant_50223 = sext_i32_i64(local_tid_50217) - ltid_pre_50221;\n    slice_50224 = ldim_46782;\n    gid_46778 = sext_i32_i64(block_id_50218);\n    remnant_50225 = sext_i32_i64(block_id_50218) - gid_46778;\n    color_50174 = (__local unsigned char *) color_50174_backing_0;\n    color_50175 = (__local unsigned char *) color_50175_backing_1;\n    binop_x_46789 = gid_46778 * tile_sizze_46781;\n    ltid_flat_46784 = sext_i32_i64(local_ti", "d_50217);\n    ltid_46783 = sext_i32_i64(sext_i64_i32(ltid_pre_50221));\n    gtid_46790 = ltid_46783 + binop_x_46789;\n    cond_46791 = slt64(gtid_46790, dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_37714);\n    if (cond_46791) {\n        int64_t slice_46793;\n        int64_t eta_p_46794;\n        \n        slice_46793 = inf_37711 + gtid_46790;\n        eta_p_46794 = ((__global int64_t *) partition_ids_mem_49374)[slice_46793];\n        pre_46792 = eta_p_46794;\n    } else {\n        pre_46792 = (int64_t) 0;\n    }\n    mem_49386[(int64_t) 0] = pre_46792;\n    barrier(CLK_LOCAL_MEM_FENCE);\n    ltid_flat_46799 = sext_i32_i64(local_tid_50217);\n    ltid_46798 = sext_i32_i64(sext_i64_i32(ltid_pre_50221));\n    gtid_46807 = binop_x_46789 + ltid_46798;\n    cond_46808 = slt64(gtid_46807, dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_37714);\n    if (cond_46808) {\n        int64_t eta_p_46811 = mem_49386[(int64_t) 0];\n        \n        neutral_46809 = eta_p_46811;\n        neutral_46810 = eta_p_46811;\n    } else {\n        neutral_46809 = (int64_t) 0;\n        neutral_46810 = (int64_t) 0;\n    }\n    mem_49390[(int64_t) 0] = neutral_46809;\n    mem_49394[(int64_t) 0] = neutral_46810;\n    barrier(CLK_LOCAL_MEM_FENCE);\n    barrier(CLK_LOCAL_MEM_FENCE);\n    for (int32_t i_2 = 0; i_2 < 1; i_2++)\n        mem_param_49395[i_2] = mem_49390[i_2];\n    for (int32_t i_3 = 0; i_3 < 1; i_3++)\n        mem_param_49396[i_3] = mem_49394[i_3];\n    for (int64_t tile_id_46818 = 0; tile_id_46818 < num_whole_tiles_46797; tile_id_46818++) {\n        int64_t binop_x_46886;\n        int64_t ltid_flat_46885;\n        int64_t ltid_46884;\n        int64_t j_46887;\n        bool cond_46891;\n        int64_t pre1d_46892;\n        int64_t pre1d_46893;\n        int64_t mem_49404[1];\n        int64_t mem_49408[1];\n        int64_t ltid_flat_46901;\n        int64_t ltid_46900;\n        int64_t gtid_46903;\n        int64_t acc_46905;\n        int64_t acc_46906;\n        bool cond_46907;\n        int64_t acc_46908;\n        int64_t acc_46909;\n        int64_t mem_param_tmp_50",
                                    "226[1];\n        int64_t mem_param_tmp_50227[1];\n        \n        binop_x_46886 = tile_sizze_46781 * tile_id_46818;\n        ltid_flat_46885 = sext_i32_i64(local_tid_50217);\n        ltid_46884 = sext_i32_i64(sext_i64_i32(ltid_pre_50221));\n        j_46887 = ltid_46884 + binop_x_46886;\n        cond_46891 = slt64(j_46887, dz2081Uz2080U_35912);\n        if (cond_46891) {\n            int64_t tile_elem_46894;\n            int64_t tile_elem_46895;\n            \n            tile_elem_46894 = ((__global int64_t *) chain_id_mem_49375)[j_46887];\n            tile_elem_46895 = ((__global int64_t *) replaceWith_mem_49376)[j_46887];\n            pre1d_46892 = tile_elem_46894;\n            pre1d_46893 = tile_elem_46895;\n        } else {\n            pre1d_46892 = (int64_t) 0;\n            pre1d_46893 = (int64_t) 0;\n        }\n        ((__local int64_t *) color_50175)[ltid_46884] = pre1d_46892;\n        ((__local int64_t *) color_50174)[ltid_46884] = pre1d_46893;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        ltid_flat_46901 = sext_i32_i64(local_tid_50217);\n        ltid_46900 = sext_i32_i64(sext_i64_i32(ltid_pre_50221));\n        gtid_46903 = binop_x_46789 + ltid_46900;\n        acc_46905 = mem_param_49395[(int64_t) 0];\n        acc_46906 = mem_param_49396[(int64_t) 0];\n        cond_46907 = slt64(gtid_46903, dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_37714);\n        if (cond_46907) {\n            int64_t eta_p_46904;\n            int64_t x_46910;\n            int64_t x_46911;\n            int64_t redout_49007;\n            int64_t redout_49008;\n            \n            eta_p_46904 = mem_49386[(int64_t) 0];\n            redout_49007 = acc_46905;\n            redout_49008 = acc_46906;\n            for (int64_t i_49009 = 0; i_49009 < tile_sizze_46781; i_49009++) {\n                int64_t x_46912;\n                bool cond_46918;\n                bool cond_46919;\n                bool cond_46920;\n                bool cond_f_res_t_res_46921;\n                bool x_46922;\n                bool y_46923;\n                bool", " cond_46924;\n                int64_t lifted_lambda_res_46925;\n                int64_t lifted_lambda_res_46926;\n                int64_t redout_tmp_50230;\n                int64_t redout_tmp_50231;\n                \n                x_46912 = ((__local int64_t *) color_50175)[i_49009];\n                cond_46918 = redout_49007 == eta_p_46904;\n                cond_46919 = !cond_46918;\n                cond_46920 = x_46912 == eta_p_46904;\n                cond_f_res_t_res_46921 = redout_49008 == eta_p_46904;\n                x_46922 = cond_46920 && cond_f_res_t_res_46921;\n                y_46923 = cond_46918 && x_46922;\n                cond_46924 = cond_46919 || y_46923;\n                if (cond_46924) {\n                    lifted_lambda_res_46925 = x_46912;\n                } else {\n                    lifted_lambda_res_46925 = redout_49007;\n                }\n                if (cond_46924) {\n                    int64_t x_46913 = ((__local int64_t *) color_50174)[i_49009];\n                    \n                    lifted_lambda_res_46926 = x_46913;\n                } else {\n                    lifted_lambda_res_46926 = redout_49008;\n                }\n                redout_tmp_50230 = lifted_lambda_res_46925;\n                redout_tmp_50231 = lifted_lambda_res_46926;\n                redout_49007 = redout_tmp_50230;\n                redout_49008 = redout_tmp_50231;\n            }\n            x_46910 = redout_49007;\n            x_46911 = redout_49008;\n            acc_46908 = x_46910;\n            acc_46909 = x_46911;\n        } else {\n            acc_46908 = acc_46905;\n            acc_46909 = acc_46906;\n        }\n        mem_49404[(int64_t) 0] = acc_46908;\n        mem_49408[(int64_t) 0] = acc_46909;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        for (int32_t i_4 = 0; i_4 < 1; i_4++)\n            mem_param_tmp_50226[i_4] = mem_49404[i_4];\n        for (int32_t i_5 = 0; i_5 < 1; i_5++)\n            mem_param_tmp_50227[i_5] = mem_49408[i_5];\n        for (int32_t i_6 = 0; i_6 < 1; i_6++)\n  ", "          mem_param_49395[i_6] = mem_param_tmp_50226[i_6];\n        for (int32_t i_7 = 0; i_7 < 1; i_7++)\n            mem_param_49396[i_7] = mem_param_tmp_50227[i_7];\n    }\n    for (int32_t i_8 = 0; i_8 < 1; i_8++)\n        ext_mem_49410[i_8] = mem_param_49395[i_8];\n    for (int32_t i_9 = 0; i_9 < 1; i_9++)\n        ext_mem_49409[i_9] = mem_param_49396[i_9];\n    barrier(CLK_LOCAL_MEM_FENCE);\n    if (cond_46945) {\n        for (int32_t i_10 = 0; i_10 < 1; i_10++)\n            ext_mem_49419[i_10] = ext_mem_49409[i_10];\n    } else {\n        int64_t ltid_flat_46947;\n        int64_t ltid_46946;\n        int64_t j_46959;\n        bool cond_46963;\n        int64_t pre1d_46964;\n        int64_t pre1d_46965;\n        int64_t ltid_flat_46975;\n        int64_t ltid_46974;\n        int64_t gtid_46985;\n        int64_t acc_46988;\n        bool cond_46989;\n        int64_t acc_46991;\n        \n        ltid_flat_46947 = sext_i32_i64(local_tid_50217);\n        ltid_46946 = sext_i32_i64(sext_i64_i32(ltid_pre_50221));\n        j_46959 = ltid_46946 + binop_x_46958;\n        cond_46963 = slt64(j_46959, dz2081Uz2080U_35912);\n        if (cond_46963) {\n            int64_t tile_elem_46966;\n            int64_t tile_elem_46967;\n            \n            tile_elem_46966 = ((__global int64_t *) chain_id_mem_49375)[j_46959];\n            tile_elem_46967 = ((__global int64_t *) replaceWith_mem_49376)[j_46959];\n            pre1d_46964 = tile_elem_46966;\n            pre1d_46965 = tile_elem_46967;\n        } else {\n            pre1d_46964 = (int64_t) 0;\n            pre1d_46965 = (int64_t) 0;\n        }\n        ((__local int64_t *) color_50175)[ltid_46946] = pre1d_46964;\n        ((__local int64_t *) color_50174)[ltid_46946] = pre1d_46965;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        ltid_flat_46975 = sext_i32_i64(local_tid_50217);\n        ltid_46974 = sext_i32_i64(sext_i64_i32(ltid_pre_50221));\n        gtid_46985 = binop_x_46789 + ltid_46974;\n        acc_46988 = ext_mem_49409[(int64_t) 0];\n        cond_46989 = slt64(gtid",
                                    "_46985, dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_37714);\n        if (cond_46989) {\n            int64_t eta_p_46986;\n            int64_t acc_46987;\n            int64_t x_46992;\n            int64_t x_46993;\n            int64_t redout_49010;\n            int64_t redout_49011;\n            \n            eta_p_46986 = mem_49386[(int64_t) 0];\n            acc_46987 = ext_mem_49410[(int64_t) 0];\n            redout_49010 = acc_46987;\n            redout_49011 = acc_46988;\n            for (int64_t i_49012 = 0; i_49012 < residual_input_46944; i_49012++) {\n                int64_t x_46994;\n                bool cond_47000;\n                bool cond_47001;\n                bool cond_47002;\n                bool cond_f_res_t_res_47003;\n                bool x_47004;\n                bool y_47005;\n                bool cond_47006;\n                int64_t lifted_lambda_res_47007;\n                int64_t lifted_lambda_res_47008;\n                int64_t redout_tmp_50232;\n                int64_t redout_tmp_50233;\n                \n                x_46994 = ((__local int64_t *) color_50175)[i_49012];\n                cond_47000 = redout_49010 == eta_p_46986;\n                cond_47001 = !cond_47000;\n                cond_47002 = x_46994 == eta_p_46986;\n                cond_f_res_t_res_47003 = redout_49011 == eta_p_46986;\n                x_47004 = cond_47002 && cond_f_res_t_res_47003;\n                y_47005 = cond_47000 && x_47004;\n                cond_47006 = cond_47001 || y_47005;\n                if (cond_47006) {\n                    lifted_lambda_res_47007 = x_46994;\n                } else {\n                    lifted_lambda_res_47007 = redout_49010;\n                }\n                if (cond_47006) {\n                    int64_t x_46995 = ((__local int64_t *) color_50174)[i_49012];\n                    \n                    lifted_lambda_res_47008 = x_46995;\n                } else {\n                    lifted_lambda_res_47008 = redout_49011;\n                }\n                redout_tmp_50232 = lifted_lamb", "da_res_47007;\n                redout_tmp_50233 = lifted_lambda_res_47008;\n                redout_49010 = redout_tmp_50232;\n                redout_49011 = redout_tmp_50233;\n            }\n            x_46992 = redout_49010;\n            x_46993 = redout_49011;\n            acc_46991 = x_46993;\n        } else {\n            acc_46991 = acc_46988;\n        }\n        mem_49418[(int64_t) 0] = acc_46991;\n        barrier(CLK_LOCAL_MEM_FENCE);\n        for (int32_t i_11 = 0; i_11 < 1; i_11++)\n            ext_mem_49419[i_11] = mem_49418[i_11];\n    }\n    if (slt64(sext_i32_i64(local_tid_50217) + tile_sizze_46781 * sext_i32_i64(block_id_50218), dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_37714)) {\n        int64_t tmp_50234 = ext_mem_49419[(int64_t) 0];\n        \n        ((__global int64_t *) mem_49378)[inf_37711 + (sext_i32_i64(local_tid_50217) + tile_sizze_46781 * sext_i32_i64(block_id_50218))] = tmp_50234;\n    }\n    \n  error_8:\n    return;\n    #undef tile_sizze_46781\n    #undef bytes_49397\n}\n", NULL};
// Start of gpu_prototypes.h

// Constants used for transpositions.  In principle these should be configurable.
#define TR_BLOCK_DIM 16
#define TR_TILE_DIM (TR_BLOCK_DIM*2)
#define TR_ELEMS_PER_THREAD 8

// Config stuff included in every GPU backend.
struct gpu_config {
  size_t default_block_size;
  size_t default_grid_size;
  size_t default_tile_size;
  size_t default_reg_tile_size;
  size_t default_cache;
  size_t default_shared_memory;
  size_t default_registers;
  size_t default_threshold;

  int default_block_size_changed;
  int default_grid_size_changed;
  int default_tile_size_changed;
};

// The following are dummy sizes that mean the concrete defaults
// will be set during initialisation via hardware-inspection-based
// heuristics.
struct gpu_config gpu_config_initial = {
  0
};

// Must be defined by the user.
static int gpu_macros(struct futhark_context *ctx, char*** names, int64_t** values);

static void gpu_init_log(struct futhark_context *ctx);
struct builtin_kernels* init_builtin_kernels(struct futhark_context* ctx);
void free_builtin_kernels(struct futhark_context* ctx, struct builtin_kernels* kernels);
static int gpu_free_all(struct futhark_context *ctx);

// End of gpu_prototypes.h

// Start of backends/cuda.h.

// Forward declarations.
// Invoked by setup_opencl() after the platform and device has been
// found, but before the program is loaded.  Its intended use is to
// tune constants based on the selected platform and device.
static void set_tuning_params(struct futhark_context* ctx);
static char* get_failure_msg(int failure_idx, int64_t args[]);

#define CUDA_SUCCEED_FATAL(x) cuda_api_succeed_fatal(x, #x, __FILE__, __LINE__)
#define CUDA_SUCCEED_NONFATAL(x) cuda_api_succeed_nonfatal(x, #x, __FILE__, __LINE__)
#define NVRTC_SUCCEED_FATAL(x) nvrtc_api_succeed_fatal(x, #x, __FILE__, __LINE__)
#define NVRTC_SUCCEED_NONFATAL(x) nvrtc_api_succeed_nonfatal(x, #x, __FILE__, __LINE__)
// Take care not to override an existing error.
#define CUDA_SUCCEED_OR_RETURN(e) {             \
    char *serror = CUDA_SUCCEED_NONFATAL(e);    \
    if (serror) {                               \
      if (!ctx->error) {                        \
        ctx->error = serror;                    \
      } else {                                  \
        free(serror);                           \
      }                                         \
      return bad;                               \
    }                                           \
  }

// CUDA_SUCCEED_OR_RETURN returns the value of the variable 'bad' in
// scope.  By default, it will be this one.  Create a local variable
// of some other type if needed.  This is a bit of a hack, but it
// saves effort in the code generator.
static const int bad = 1;

static inline void cuda_api_succeed_fatal(CUresult res, const char *call,
                                          const char *file, int line) {
  if (res != CUDA_SUCCESS) {
    const char *err_str;
    cuGetErrorString(res, &err_str);
    if (err_str == NULL) { err_str = "Unknown"; }
    futhark_panic(-1, "%s:%d: CUDA call\n  %s\nfailed with error code %d (%s)\n",
                  file, line, call, res, err_str);
  }
}

static char* cuda_api_succeed_nonfatal(CUresult res, const char *call,
                                       const char *file, int line) {
  if (res != CUDA_SUCCESS) {
    const char *err_str;
    cuGetErrorString(res, &err_str);
    if (err_str == NULL) { err_str = "Unknown"; }
    return msgprintf("%s:%d: CUDA call\n  %s\nfailed with error code %d (%s)\n",
                     file, line, call, res, err_str);
  } else {
    return NULL;
  }
}

static inline void nvrtc_api_succeed_fatal(nvrtcResult res, const char *call,
                                           const char *file, int line) {
  if (res != NVRTC_SUCCESS) {
    const char *err_str = nvrtcGetErrorString(res);
    futhark_panic(-1, "%s:%d: NVRTC call\n  %s\nfailed with error code %d (%s)\n",
                  file, line, call, res, err_str);
  }
}

static char* nvrtc_api_succeed_nonfatal(nvrtcResult res, const char *call,
                                        const char *file, int line) {
  if (res != NVRTC_SUCCESS) {
    const char *err_str = nvrtcGetErrorString(res);
    return msgprintf("%s:%d: NVRTC call\n  %s\nfailed with error code %d (%s)\n",
                     file, line, call, res, err_str);
  } else {
    return NULL;
  }
}

struct futhark_context_config {
  int in_use;
  int debugging;
  int profiling;
  int logging;
  char* cache_fname;
  int num_tuning_params;
  int64_t *tuning_params;
  const char** tuning_param_names;
  const char** tuning_param_vars;
  const char** tuning_param_classes;
  // Uniform fields above.

  char* program;
  int num_nvrtc_opts;
  char* *nvrtc_opts;

  char* preferred_device;
  int preferred_device_num;

  int unified_memory;

  char* dump_ptx_to;
  char* load_ptx_from;

  struct gpu_config gpu;
};

static void backend_context_config_setup(struct futhark_context_config *cfg) {
  cfg->num_nvrtc_opts = 0;
  cfg->nvrtc_opts = (char**) malloc(sizeof(char*));
  cfg->nvrtc_opts[0] = NULL;

  cfg->program = strconcat(gpu_program);

  cfg->preferred_device_num = 0;
  cfg->preferred_device = strdup("");

  cfg->dump_ptx_to = NULL;
  cfg->load_ptx_from = NULL;

  cfg->unified_memory = 2;

  cfg->gpu = gpu_config_initial;
  cfg->gpu.default_block_size = 256;
  cfg->gpu.default_tile_size = 32;
  cfg->gpu.default_reg_tile_size = 2;
  cfg->gpu.default_threshold = 32*1024;
}

static void backend_context_config_teardown(struct futhark_context_config* cfg) {
  for (int i = 0; i < cfg->num_nvrtc_opts; i++) {
    free(cfg->nvrtc_opts[i]);
  }
  free(cfg->nvrtc_opts);
  free(cfg->dump_ptx_to);
  free(cfg->load_ptx_from);
  free(cfg->preferred_device);
  free(cfg->program);
}

void futhark_context_config_add_nvrtc_option(struct futhark_context_config *cfg, const char *opt) {
  cfg->nvrtc_opts[cfg->num_nvrtc_opts] = strdup(opt);
  cfg->num_nvrtc_opts++;
  cfg->nvrtc_opts = (char **) realloc(cfg->nvrtc_opts, (cfg->num_nvrtc_opts + 1) * sizeof(char *));
  cfg->nvrtc_opts[cfg->num_nvrtc_opts] = NULL;
}

void futhark_context_config_set_device(struct futhark_context_config *cfg, const char *s) {
  int x = 0;
  if (*s == '#') {
    s++;
    while (isdigit(*s)) {
      x = x * 10 + (*s++)-'0';
    }
    // Skip trailing spaces.
    while (isspace(*s)) {
      s++;
    }
  }
  free(cfg->preferred_device);
  cfg->preferred_device = strdup(s);
  cfg->preferred_device_num = x;
}

const char* futhark_context_config_get_program(struct futhark_context_config *cfg) {
  return cfg->program;
}

void futhark_context_config_set_program(struct futhark_context_config *cfg, const char *s) {
  free(cfg->program);
  cfg->program = strdup(s);
}

void futhark_context_config_dump_ptx_to(struct futhark_context_config *cfg, const char *path) {
  free(cfg->dump_ptx_to);
  cfg->dump_ptx_to = strdup(path);
}

void futhark_context_config_load_ptx_from(struct futhark_context_config *cfg, const char *path) {
  free(cfg->load_ptx_from);
  cfg->load_ptx_from = strdup(path);
}

void futhark_context_config_set_unified_memory(struct futhark_context_config* cfg, int flag) {
  cfg->unified_memory = flag;
}

// A record of something that happened.
struct profiling_record {
  cudaEvent_t *events; // Points to two events.
  const char *name;
};

struct futhark_context {
  struct futhark_context_config* cfg;
  int detail_memory;
  int debugging;
  int profiling;
  int profiling_paused;
  int logging;
  lock_t lock;
  char *error;
  lock_t error_lock;
  FILE *log;
  struct constants *constants;
  struct free_list free_list;
  struct event_list event_list;
  int64_t peak_mem_usage_default;
  int64_t cur_mem_usage_default;
  struct program* program;
  bool program_initialised;
  // Uniform fields above.

  CUdeviceptr global_failure;
  CUdeviceptr global_failure_args;
  struct tuning_params tuning_params;
  // True if a potentially failing kernel has been enqueued.
  int32_t failure_is_an_option;
  int total_runs;
  long int total_runtime;
  int64_t peak_mem_usage_device;
  int64_t cur_mem_usage_device;

  CUdevice dev;
  CUcontext cu_ctx;
  CUmodule module;
  CUstream stream;

  struct free_list gpu_free_list;

  size_t max_thread_block_size;
  size_t max_grid_size;
  size_t max_tile_size;
  size_t max_threshold;
  size_t max_shared_memory;
  size_t max_bespoke;
  size_t max_registers;
  size_t max_cache;

  size_t lockstep_width;

  struct builtin_kernels* kernels;
};

#define CU_DEV_ATTR(x) (CU_DEVICE_ATTRIBUTE_##x)
#define device_query(dev,attrib) _device_query(dev, CU_DEV_ATTR(attrib))
static int _device_query(CUdevice dev, CUdevice_attribute attrib) {
  int val;
  CUDA_SUCCEED_FATAL(cuDeviceGetAttribute(&val, attrib, dev));
  return val;
}

#define CU_FUN_ATTR(x) (CU_FUNC_ATTRIBUTE_##x)
#define function_query(fn,attrib) _function_query(dev, CU_FUN_ATTR(attrib))
static int _function_query(CUfunction dev, CUfunction_attribute attrib) {
  int val;
  CUDA_SUCCEED_FATAL(cuFuncGetAttribute(&val, attrib, dev));
  return val;
}

static int cuda_device_setup(struct futhark_context *ctx) {
  struct futhark_context_config *cfg = ctx->cfg;
  char name[256];
  int count, chosen = -1, best_cc = -1;
  int cc_major_best = 0, cc_minor_best = 0;
  int cc_major = 0, cc_minor = 0;
  CUdevice dev;

  CUDA_SUCCEED_FATAL(cuDeviceGetCount(&count));
  if (count == 0) { return 1; }

  int num_device_matches = 0;

  // XXX: Current device selection policy is to choose the device with the
  // highest compute capability (if no preferred device is set).
  // This should maybe be changed, since greater compute capability is not
  // necessarily an indicator of better performance.
  for (int i = 0; i < count; i++) {
    CUDA_SUCCEED_FATAL(cuDeviceGet(&dev, i));

    cc_major = device_query(dev, COMPUTE_CAPABILITY_MAJOR);
    cc_minor = device_query(dev, COMPUTE_CAPABILITY_MINOR);

    CUDA_SUCCEED_FATAL(cuDeviceGetName(name, sizeof(name) - 1, dev));
    name[sizeof(name) - 1] = 0;

    if (cfg->logging) {
      fprintf(ctx->log, "Device #%d: name=\"%s\", compute capability=%d.%d\n",
              i, name, cc_major, cc_minor);
    }

    if (device_query(dev, COMPUTE_MODE) == CU_COMPUTEMODE_PROHIBITED) {
      if (cfg->logging) {
        fprintf(ctx->log, "Device #%d is compute-prohibited, ignoring\n", i);
      }
      continue;
    }

    if (best_cc == -1 || cc_major > cc_major_best ||
        (cc_major == cc_major_best && cc_minor > cc_minor_best)) {
      best_cc = i;
      cc_major_best = cc_major;
      cc_minor_best = cc_minor;
    }

    if (strstr(name, cfg->preferred_device) != NULL &&
        num_device_matches++ == cfg->preferred_device_num) {
      chosen = i;
      break;
    }
  }

  if (chosen == -1) { chosen = best_cc; }
  if (chosen == -1) { return 1; }

  if (cfg->logging) {
    fprintf(ctx->log, "Using device #%d\n", chosen);
  }

  CUDA_SUCCEED_FATAL(cuDeviceGet(&ctx->dev, chosen));
  return 0;
}

static const char *cuda_nvrtc_get_arch(CUdevice dev) {
  static struct {
    int major;
    int minor;
    const char *arch_str;
  } const x[] = {
    { 3, 0, "compute_30" },
    { 3, 2, "compute_32" },
    { 3, 5, "compute_35" },
    { 3, 7, "compute_37" },
    { 5, 0, "compute_50" },
    { 5, 2, "compute_52" },
    { 5, 3, "compute_53" },
    { 6, 0, "compute_60" },
    { 6, 1, "compute_61" },
    { 6, 2, "compute_62" },
    { 7, 0, "compute_70" },
    { 7, 2, "compute_72" },
    { 7, 5, "compute_75" },
    { 8, 0, "compute_80" },
    { 8, 6, "compute_80" },
    { 8, 7, "compute_80" }
  };

  int major = device_query(dev, COMPUTE_CAPABILITY_MAJOR);
  int minor = device_query(dev, COMPUTE_CAPABILITY_MINOR);

  int chosen = -1;
  int num_archs = sizeof(x)/sizeof(x[0]);
  for (int i = 0; i < num_archs; i++) {
    if (x[i].major < major || (x[i].major == major && x[i].minor <= minor)) {
      chosen = i;
    } else {
      break;
    }
  }

  if (chosen == -1) {
    futhark_panic(-1, "Unsupported compute capability %d.%d\n", major, minor);
  }

  if (x[chosen].major != major || x[chosen].minor != minor) {
    fprintf(stderr,
            "Warning: device compute capability is %d.%d, but newest supported by Futhark is %d.%d.\n",
            major, minor, x[chosen].major, x[chosen].minor);
  }

  return x[chosen].arch_str;
}

static void cuda_nvrtc_mk_build_options(struct futhark_context *ctx, const char *extra_opts[],
                                        char*** opts_out, size_t *n_opts) {
  int arch_set = 0, num_extra_opts;
  struct futhark_context_config *cfg = ctx->cfg;

  char** macro_names;
  int64_t* macro_vals;
  int num_macros = gpu_macros(ctx, &macro_names, &macro_vals);

  // nvrtc cannot handle multiple -arch options.  Hence, if one of the
  // extra_opts is -arch, we have to be careful not to do our usual
  // automatic generation.
  for (num_extra_opts = 0; extra_opts[num_extra_opts] != NULL; num_extra_opts++) {
    if (strstr(extra_opts[num_extra_opts], "-arch")
        == extra_opts[num_extra_opts] ||
        strstr(extra_opts[num_extra_opts], "--gpu-architecture")
        == extra_opts[num_extra_opts]) {
      arch_set = 1;
    }
  }

  size_t i = 0, n_opts_alloc = 20 + num_macros + num_extra_opts + cfg->num_tuning_params;
  char **opts = (char**) malloc(n_opts_alloc * sizeof(char *));
  if (!arch_set) {
    opts[i++] = strdup("-arch");
    opts[i++] = strdup(cuda_nvrtc_get_arch(ctx->dev));
  }
  opts[i++] = strdup("-default-device");
  if (cfg->debugging) {
    opts[i++] = strdup("-G");
    opts[i++] = strdup("-lineinfo");
  } else {
    opts[i++] = strdup("--disable-warnings");
  }
  opts[i++] = msgprintf("-D%s=%d",
                        "max_thread_block_size",
                        (int)ctx->max_thread_block_size);
  opts[i++] = msgprintf("-D%s=%d",
                        "max_shared_memory",
                        (int)ctx->max_shared_memory);
  opts[i++] = msgprintf("-D%s=%d",
                        "max_registers",
                        (int)ctx->max_registers);

  for (int j = 0; j < num_macros; j++) {
    opts[i++] = msgprintf("-D%s=%zu", macro_names[j], macro_vals[j]);
  }

  for (int j = 0; j < cfg->num_tuning_params; j++) {
    opts[i++] = msgprintf("-D%s=%zu", cfg->tuning_param_vars[j],
                          cfg->tuning_params[j]);
  }
  opts[i++] = msgprintf("-DLOCKSTEP_WIDTH=%zu", ctx->lockstep_width);
  opts[i++] = msgprintf("-DMAX_THREADS_PER_BLOCK=%zu", ctx->max_thread_block_size);

  // Time for the best lines of the code in the entire compiler.
  if (getenv("CUDA_HOME") != NULL) {
    opts[i++] = msgprintf("-I%s/include", getenv("CUDA_HOME"));
  }
  if (getenv("CUDA_ROOT") != NULL) {
    opts[i++] = msgprintf("-I%s/include", getenv("CUDA_ROOT"));
  }
  if (getenv("CUDA_PATH") != NULL) {
    opts[i++] = msgprintf("-I%s/include", getenv("CUDA_PATH"));
  }
  opts[i++] = msgprintf("-I/usr/local/cuda/include");
  opts[i++] = msgprintf("-I/usr/include");

  for (int j = 0; extra_opts[j] != NULL; j++) {
    opts[i++] = strdup(extra_opts[j]);
  }

  opts[i++] = msgprintf("-DTR_BLOCK_DIM=%d", TR_BLOCK_DIM);
  opts[i++] = msgprintf("-DTR_TILE_DIM=%d", TR_TILE_DIM);
  opts[i++] = msgprintf("-DTR_ELEMS_PER_THREAD=%d", TR_ELEMS_PER_THREAD);

  free(macro_names);
  free(macro_vals);

  *n_opts = i;
  *opts_out = opts;
}

static char* cuda_nvrtc_build(const char *src, const char *opts[], size_t n_opts,
                              char **ptx) {
  nvrtcProgram prog;
  char *problem = NULL;

  problem = NVRTC_SUCCEED_NONFATAL(nvrtcCreateProgram(&prog, src, "futhark-cuda", 0, NULL, NULL));

  if (problem) {
    return problem;
  }

  nvrtcResult res = nvrtcCompileProgram(prog, n_opts, opts);
  if (res != NVRTC_SUCCESS) {
    size_t log_size;
    if (nvrtcGetProgramLogSize(prog, &log_size) == NVRTC_SUCCESS) {
      char *log = (char*) malloc(log_size);
      if (nvrtcGetProgramLog(prog, log) == NVRTC_SUCCESS) {
        problem = msgprintf("NVRTC compilation failed.\n\n%s\n", log);
      } else {
        problem = msgprintf("Could not retrieve compilation log\n");
      }
      free(log);
    }
    return problem;
  }

  size_t ptx_size;
  NVRTC_SUCCEED_FATAL(nvrtcGetPTXSize(prog, &ptx_size));
  *ptx = (char*) malloc(ptx_size);
  NVRTC_SUCCEED_FATAL(nvrtcGetPTX(prog, *ptx));

  NVRTC_SUCCEED_FATAL(nvrtcDestroyProgram(&prog));

  return NULL;
}

static void cuda_load_ptx_from_cache(struct futhark_context_config *cfg,
                                     const char *src,
                                     const char *opts[], size_t n_opts,
                                     struct cache_hash *h, const char *cache_fname,
                                     char **ptx) {
  if (cfg->logging) {
    fprintf(stderr, "Restoring cache from from %s...\n", cache_fname);
  }
  cache_hash_init(h);
  for (size_t i = 0; i < n_opts; i++) {
    cache_hash(h, opts[i], strlen(opts[i]));
  }
  cache_hash(h, src, strlen(src));
  size_t ptxsize;
  errno = 0;
  if (cache_restore(cache_fname, h, (unsigned char**)ptx, &ptxsize) != 0) {
    if (cfg->logging) {
      fprintf(stderr, "Failed to restore cache (errno: %s)\n", strerror(errno));
    }
  }
}

static void cuda_size_setup(struct futhark_context *ctx)
{
  struct futhark_context_config *cfg = ctx->cfg;
  if (cfg->gpu.default_block_size > ctx->max_thread_block_size) {
    if (cfg->gpu.default_block_size_changed) {
      fprintf(stderr,
              "Note: Device limits default block size to %zu (down from %zu).\n",
              ctx->max_thread_block_size, cfg->gpu.default_block_size);
    }
    cfg->gpu.default_block_size = ctx->max_thread_block_size;
  }
  if (cfg->gpu.default_grid_size > ctx->max_grid_size) {
    if (cfg->gpu.default_grid_size_changed) {
      fprintf(stderr,
              "Note: Device limits default grid size to %zu (down from %zu).\n",
              ctx->max_grid_size, cfg->gpu.default_grid_size);
    }
    cfg->gpu.default_grid_size = ctx->max_grid_size;
  }
  if (cfg->gpu.default_tile_size > ctx->max_tile_size) {
    if (cfg->gpu.default_tile_size_changed) {
      fprintf(stderr,
              "Note: Device limits default tile size to %zu (down from %zu).\n",
              ctx->max_tile_size, cfg->gpu.default_tile_size);
    }
    cfg->gpu.default_tile_size = ctx->max_tile_size;
  }

  if (!cfg->gpu.default_grid_size_changed) {
    cfg->gpu.default_grid_size =
      (device_query(ctx->dev, MULTIPROCESSOR_COUNT) *
       device_query(ctx->dev, MAX_THREADS_PER_MULTIPROCESSOR))
      / cfg->gpu.default_block_size;
  }

  for (int i = 0; i < cfg->num_tuning_params; i++) {
    const char *size_class = cfg->tuning_param_classes[i];
    int64_t *size_value = &cfg->tuning_params[i];
    const char* size_name = cfg->tuning_param_names[i];
    int64_t max_value = 0, default_value = 0;

    if (strstr(size_class, "thread_block_size") == size_class) {
      max_value = ctx->max_thread_block_size;
      default_value = cfg->gpu.default_block_size;
    } else if (strstr(size_class, "grid_size") == size_class) {
      max_value = ctx->max_grid_size;
      default_value = cfg->gpu.default_grid_size;
      // XXX: as a quick and dirty hack, use twice as many threads for
      // histograms by default.  We really should just be smarter
      // about sizes somehow.
      if (strstr(size_name, ".seghist_") != NULL) {
        default_value *= 2;
      }
    } else if (strstr(size_class, "tile_size") == size_class) {
      max_value = ctx->max_tile_size;
      default_value = cfg->gpu.default_tile_size;
    } else if (strstr(size_class, "reg_tile_size") == size_class) {
      max_value = 0; // No limit.
      default_value = cfg->gpu.default_reg_tile_size;
    } else if (strstr(size_class, "shared_memory") == size_class) {
      max_value = ctx->max_shared_memory;
      default_value = ctx->max_shared_memory;
    } else if (strstr(size_class, "cache") == size_class) {
      max_value = ctx->max_cache;
      default_value = ctx->max_cache;
    } else if (strstr(size_class, "threshold") == size_class) {
      // Threshold can be as large as it takes.
      default_value = cfg->gpu.default_threshold;
    } else {
      // Bespoke sizes have no limit or default.
    }

    if (*size_value == 0) {
      *size_value = default_value;
    } else if (max_value > 0 && *size_value > max_value) {
      fprintf(stderr, "Note: Device limits %s to %zu (down from %zu)\n",
              size_name, max_value, *size_value);
      *size_value = max_value;
    }
  }
}

static char* cuda_module_setup(struct futhark_context *ctx,
                               const char *src,
                               const char *extra_opts[],
                               const char* cache_fname) {
  char *ptx = NULL;
  struct futhark_context_config *cfg = ctx->cfg;

  if (cfg->load_ptx_from) {
    ptx = slurp_file(cfg->load_ptx_from, NULL);
  }

  char **opts;
  size_t n_opts;
  cuda_nvrtc_mk_build_options(ctx, extra_opts, &opts, &n_opts);

  if (cfg->logging) {
    fprintf(stderr, "NVRTC compile options:\n");
    for (size_t j = 0; j < n_opts; j++) {
      fprintf(stderr, "\t%s\n", opts[j]);
    }
    fprintf(stderr, "\n");
  }

  struct cache_hash h;
  int loaded_ptx_from_cache = 0;
  if (cache_fname != NULL) {
    cuda_load_ptx_from_cache(cfg, src, (const char**)opts, n_opts, &h, cache_fname, &ptx);

    if (ptx != NULL) {
      if (cfg->logging) {
        fprintf(stderr, "Restored PTX from cache; now loading module...\n");
      }
      if (cuModuleLoadData(&ctx->module, ptx) == CUDA_SUCCESS) {
        if (cfg->logging) {
          fprintf(stderr, "Success!\n");
        }
        loaded_ptx_from_cache = 1;
      } else {
        if (cfg->logging) {
          fprintf(stderr, "Failed!\n");
        }
        free(ptx);
        ptx = NULL;
      }
    }
  }

  if (ptx == NULL) {
    char* problem = cuda_nvrtc_build(src, (const char**)opts, n_opts, &ptx);
    if (problem != NULL) {
      return problem;
    }
  }

  if (cfg->dump_ptx_to != NULL) {
    dump_file(cfg->dump_ptx_to, ptx, strlen(ptx));
  }

  if (!loaded_ptx_from_cache) {
    CUDA_SUCCEED_FATAL(cuModuleLoadData(&ctx->module, ptx));
  }

  if (cache_fname != NULL && !loaded_ptx_from_cache) {
    if (cfg->logging) {
      fprintf(stderr, "Caching PTX in %s...\n", cache_fname);
    }
    errno = 0;
    if (cache_store(cache_fname, &h, (const unsigned char*)ptx, strlen(ptx)) != 0) {
      fprintf(stderr, "Failed to cache PTX: %s\n", strerror(errno));
    }
  }

  for (size_t i = 0; i < n_opts; i++) {
    free((char *)opts[i]);
  }
  free(opts);
  free(ptx);

  return NULL;
}

struct cuda_event {
  cudaEvent_t start;
  cudaEvent_t end;
};

static struct cuda_event* cuda_event_new(struct futhark_context* ctx) {
  if (ctx->profiling && !ctx->profiling_paused) {
    struct cuda_event* e = malloc(sizeof(struct cuda_event));
    cudaEventCreate(&e->start);
    cudaEventCreate(&e->end);
    return e;
  } else {
    return NULL;
  }
}

static int cuda_event_report(struct str_builder* sb, struct cuda_event* e) {
  float ms;
  CUresult err;
  if ((err = cuEventElapsedTime(&ms, e->start, e->end)) != CUDA_SUCCESS) {
    return err;
  }

  // CUDA provides milisecond resolution, but we want microseconds.
  str_builder(sb, ",\"duration\":%f", ms*1000);

  if ((err = cuEventDestroy(e->start)) != CUDA_SUCCESS) {
    return 1;
  }

  if ((err = cuEventDestroy(e->end)) != CUDA_SUCCESS) {
    return 1;
  }

  free(e);

  return 0;
}

int futhark_context_sync(struct futhark_context* ctx) {
  CUDA_SUCCEED_OR_RETURN(cuCtxPushCurrent(ctx->cu_ctx));
  CUDA_SUCCEED_OR_RETURN(cuCtxSynchronize());
  if (ctx->failure_is_an_option) {
    // Check for any delayed error.
    int32_t failure_idx;
    CUDA_SUCCEED_OR_RETURN(
                           cuMemcpyDtoH(&failure_idx,
                                        ctx->global_failure,
                                        sizeof(int32_t)));
    ctx->failure_is_an_option = 0;

    if (failure_idx >= 0) {
      // We have to clear global_failure so that the next entry point
      // is not considered a failure from the start.
      int32_t no_failure = -1;
      CUDA_SUCCEED_OR_RETURN(
                             cuMemcpyHtoD(ctx->global_failure,
                                          &no_failure,
                                          sizeof(int32_t)));

      int64_t args[max_failure_args+1];
      CUDA_SUCCEED_OR_RETURN(
                             cuMemcpyDtoH(&args,
                                          ctx->global_failure_args,
                                          sizeof(args)));

      ctx->error = get_failure_msg(failure_idx, args);

      return FUTHARK_PROGRAM_ERROR;
    }
  }

  CUDA_SUCCEED_OR_RETURN(cuCtxPopCurrent(&ctx->cu_ctx));
  return 0;
}

struct builtin_kernels* init_builtin_kernels(struct futhark_context* ctx);
void free_builtin_kernels(struct futhark_context* ctx, struct builtin_kernels* kernels);

int backend_context_setup(struct futhark_context* ctx) {
  ctx->failure_is_an_option = 0;
  ctx->total_runs = 0;
  ctx->total_runtime = 0;
  ctx->peak_mem_usage_device = 0;
  ctx->cur_mem_usage_device = 0;
  ctx->kernels = NULL;

  CUDA_SUCCEED_FATAL(cuInit(0));
  if (cuda_device_setup(ctx) != 0) {
    futhark_panic(-1, "No suitable CUDA device found.\n");
  }
  CUDA_SUCCEED_FATAL(cuCtxCreate(&ctx->cu_ctx, 0, ctx->dev));

  free_list_init(&ctx->gpu_free_list);

  if (ctx->cfg->unified_memory == 2) {
    ctx->cfg->unified_memory = device_query(ctx->dev, MANAGED_MEMORY);
  }

  if (ctx->cfg->logging) {
    if (ctx->cfg->unified_memory) {
      fprintf(ctx->log, "Using managed memory\n");
    } else {
      fprintf(ctx->log, "Using unmanaged memory\n");
    }
  }

  ctx->max_thread_block_size = device_query(ctx->dev, MAX_THREADS_PER_BLOCK);
  ctx->max_grid_size = device_query(ctx->dev, MAX_GRID_DIM_X);
  ctx->max_tile_size = sqrt(ctx->max_thread_block_size);
  ctx->max_threshold = 1U<<31; // No limit.
  ctx->max_bespoke = 1U<<31; // No limit.

  if (ctx->cfg->gpu.default_registers != 0) {
    ctx->max_registers = ctx->cfg->gpu.default_registers;
  } else {
    ctx->max_registers = device_query(ctx->dev, MAX_REGISTERS_PER_BLOCK);
  }

  if (ctx->cfg->gpu.default_shared_memory != 0) {
    ctx->max_shared_memory = ctx->cfg->gpu.default_shared_memory;
  } else {
    // MAX_SHARED_MEMORY_PER_BLOCK gives bogus numbers (48KiB); probably
    // for backwards compatibility.  Add _OPTIN and you seem to get the
    // right number.
    ctx->max_shared_memory = device_query(ctx->dev, MAX_SHARED_MEMORY_PER_BLOCK_OPTIN);
#if CUDART_VERSION >= 12000
    ctx->max_shared_memory -= device_query(ctx->dev, RESERVED_SHARED_MEMORY_PER_BLOCK);
#endif
  }

  if (ctx->cfg->gpu.default_cache != 0) {
    ctx->max_cache = ctx->cfg->gpu.default_cache;
  } else {
    ctx->max_cache = device_query(ctx->dev, L2_CACHE_SIZE);
  }

  ctx->lockstep_width = device_query(ctx->dev, WARP_SIZE);
  CUDA_SUCCEED_FATAL(cuStreamCreate(&ctx->stream, CU_STREAM_DEFAULT));
  cuda_size_setup(ctx);

  gpu_init_log(ctx);

  ctx->error = cuda_module_setup(ctx,
                                 ctx->cfg->program,
                                 (const char**)ctx->cfg->nvrtc_opts,
                                 ctx->cfg->cache_fname);

  if (ctx->error != NULL) {
    futhark_panic(1, "During CUDA initialisation:\n%s\n", ctx->error);
  }

  int32_t no_error = -1;
  CUDA_SUCCEED_FATAL(cuMemAlloc(&ctx->global_failure, sizeof(no_error)));
  CUDA_SUCCEED_FATAL(cuMemcpyHtoD(ctx->global_failure, &no_error, sizeof(no_error)));
  // The +1 is to avoid zero-byte allocations.
  CUDA_SUCCEED_FATAL(cuMemAlloc(&ctx->global_failure_args, sizeof(int64_t)*(max_failure_args+1)));

  if ((ctx->kernels = init_builtin_kernels(ctx)) == NULL) {
    return 1;
  }

  return 0;
}

void backend_context_teardown(struct futhark_context* ctx) {
  if (ctx->kernels != NULL) {
    free_builtin_kernels(ctx, ctx->kernels);
    cuMemFree(ctx->global_failure);
    cuMemFree(ctx->global_failure_args);
    CUDA_SUCCEED_FATAL(gpu_free_all(ctx));
    CUDA_SUCCEED_FATAL(cuStreamDestroy(ctx->stream));
    CUDA_SUCCEED_FATAL(cuModuleUnload(ctx->module));
    CUDA_SUCCEED_FATAL(cuCtxDestroy(ctx->cu_ctx));
  }
  free_list_destroy(&ctx->gpu_free_list);
}

// GPU ABSTRACTION LAYER

// Types.

typedef CUfunction gpu_kernel;
typedef CUdeviceptr gpu_mem;

static void gpu_create_kernel(struct futhark_context *ctx,
                              gpu_kernel* kernel,
                              const char* name) {
  if (ctx->debugging) {
    fprintf(ctx->log, "Creating kernel %s.\n", name);
  }
  CUDA_SUCCEED_FATAL(cuModuleGetFunction(kernel, ctx->module, name));
  // Unless the below is set, the kernel is limited to 48KiB of memory.
  CUDA_SUCCEED_FATAL(cuFuncSetAttribute(*kernel,
                                        cudaFuncAttributeMaxDynamicSharedMemorySize,
                                        ctx->max_shared_memory));
}

static void gpu_free_kernel(struct futhark_context *ctx,
                            gpu_kernel kernel) {
  (void)ctx;
  (void)kernel;
}

static int gpu_scalar_to_device(struct futhark_context* ctx,
                                gpu_mem dst, size_t offset, size_t size,
                                void *src) {
  struct cuda_event *event = cuda_event_new(ctx);
  if (event != NULL) {
    add_event(ctx,
              "copy_scalar_to_dev",
              strdup(""),
              event,
              (event_report_fn)cuda_event_report);
    CUDA_SUCCEED_FATAL(cuEventRecord(event->start, ctx->stream));
  }
  CUDA_SUCCEED_OR_RETURN(cuMemcpyHtoD(dst + offset, src, size));
  if (event != NULL) {
    CUDA_SUCCEED_FATAL(cuEventRecord(event->end, ctx->stream));
  }
  return FUTHARK_SUCCESS;
}

static int gpu_scalar_from_device(struct futhark_context* ctx,
                                  void *dst,
                                  gpu_mem src, size_t offset, size_t size) {
  struct cuda_event *event = cuda_event_new(ctx);
  if (event != NULL) {
    add_event(ctx,
              "copy_scalar_from_dev",
              strdup(""),
              event,
              (event_report_fn)cuda_event_report);
    CUDA_SUCCEED_FATAL(cuEventRecord(event->start, ctx->stream));
  }
  CUDA_SUCCEED_OR_RETURN(cuMemcpyDtoH(dst, src + offset, size));
  if (event != NULL) {
    CUDA_SUCCEED_FATAL(cuEventRecord(event->end, ctx->stream));
  }
  return FUTHARK_SUCCESS;
}

static int gpu_memcpy(struct futhark_context* ctx,
                      gpu_mem dst, int64_t dst_offset,
                      gpu_mem src, int64_t src_offset,
                      int64_t nbytes) {
  struct cuda_event *event = cuda_event_new(ctx);
  if (event != NULL) {
    add_event(ctx,
              "copy_dev_to_dev",
              strdup(""),
              event,
              (event_report_fn)cuda_event_report);
    CUDA_SUCCEED_FATAL(cuEventRecord(event->start, ctx->stream));
  }
  CUDA_SUCCEED_OR_RETURN(cuMemcpyAsync(dst+dst_offset, src+src_offset, nbytes, ctx->stream));
  if (event != NULL) {
    CUDA_SUCCEED_FATAL(cuEventRecord(event->end, ctx->stream));
  }
  return FUTHARK_SUCCESS;
}

static int memcpy_host2gpu(struct futhark_context* ctx, bool sync,
                           gpu_mem dst, int64_t dst_offset,
                           const unsigned char* src, int64_t src_offset,
                           int64_t nbytes) {
  if (nbytes > 0) {
    struct cuda_event *event = cuda_event_new(ctx);
    if (event != NULL) {
      add_event(ctx,
                "copy_host_to_dev",
                strdup(""),
                event,
                (event_report_fn)cuda_event_report);
      CUDA_SUCCEED_FATAL(cuEventRecord(event->start, ctx->stream));
    }
    if (sync) {
      CUDA_SUCCEED_OR_RETURN
        (cuMemcpyHtoD(dst + dst_offset, src + src_offset, nbytes));
    } else {
      CUDA_SUCCEED_OR_RETURN
        (cuMemcpyHtoDAsync(dst + dst_offset, src + src_offset, nbytes, ctx->stream));
    }
    if (event != NULL) {
      CUDA_SUCCEED_FATAL(cuEventRecord(event->end, ctx->stream));
    }
  }
  return FUTHARK_SUCCESS;
}

static int memcpy_gpu2host(struct futhark_context* ctx, bool sync,
                           unsigned char* dst, int64_t dst_offset,
                           gpu_mem src, int64_t src_offset,
                           int64_t nbytes) {
  if (nbytes > 0) {
    struct cuda_event *event = cuda_event_new(ctx);
    if (event != NULL) {
      add_event(ctx,
                "copy_dev_to_host",
                strdup(""),
                event,
                (event_report_fn)cuda_event_report);
      CUDA_SUCCEED_FATAL(cuEventRecord(event->start, ctx->stream));
    }
    if (sync) {
      CUDA_SUCCEED_OR_RETURN
        (cuMemcpyDtoH(dst + dst_offset, src + src_offset, nbytes));
    } else {
      CUDA_SUCCEED_OR_RETURN
        (cuMemcpyDtoHAsync(dst + dst_offset, src + src_offset, nbytes, ctx->stream));
    }
    if (event != NULL) {
      CUDA_SUCCEED_FATAL(cuEventRecord(event->end, ctx->stream));
    }
    if (sync &&
        ctx->failure_is_an_option &&
        futhark_context_sync(ctx) != 0) {
      return 1;
    }
  }
  return FUTHARK_SUCCESS;
}

static int gpu_launch_kernel(struct futhark_context* ctx,
                             gpu_kernel kernel, const char *name,
                             const int32_t grid[3],
                             const int32_t block[3],
                             unsigned int shared_mem_bytes,
                             int num_args,
                             void* args[num_args],
                             size_t args_sizes[num_args]) {
  (void) args_sizes;

  if (shared_mem_bytes > ctx->max_shared_memory) {
    set_error(ctx, msgprintf("Kernel %s with %d bytes of memory exceeds device limit of %d\n",
                             name, shared_mem_bytes, (int)ctx->max_shared_memory));
    return 1;
  }

  int64_t time_start = 0, time_end = 0;
  if (ctx->debugging) {
    time_start = get_wall_time();
  }

  struct cuda_event *event = cuda_event_new(ctx);

  if (event != NULL) {
    CUDA_SUCCEED_FATAL(cuEventRecord(event->start, ctx->stream));
    add_event(ctx,
              name,
              msgprintf("Kernel %s with\n"
                        "  grid=(%d,%d,%d)\n"
                        "  block=(%d,%d,%d)\n"
                        "  shared memory=%d",
                        name,
                        grid[0], grid[1], grid[2],
                        block[0], block[1], block[2],
                        shared_mem_bytes),
              event,
              (event_report_fn)cuda_event_report);
  }

  CUDA_SUCCEED_OR_RETURN
    (cuLaunchKernel(kernel,
                    grid[0], grid[1], grid[2],
                    block[0], block[1], block[2],
                    shared_mem_bytes, ctx->stream,
                    args, NULL));

  if (event != NULL) {
    CUDA_SUCCEED_FATAL(cuEventRecord(event->end, ctx->stream));
  }

  if (ctx->debugging) {
    CUDA_SUCCEED_FATAL(cuCtxSynchronize());
    time_end = get_wall_time();
    long int time_diff = time_end - time_start;
    fprintf(ctx->log, "  runtime: %ldus\n", time_diff);
  }
  if (ctx->logging) {
    fprintf(ctx->log, "\n");
  }

  return FUTHARK_SUCCESS;
}

static int gpu_alloc_actual(struct futhark_context *ctx, size_t size, gpu_mem *mem_out) {
  CUresult res;
  if (ctx->cfg->unified_memory) {
    res = cuMemAllocManaged(mem_out, size, CU_MEM_ATTACH_GLOBAL);
  } else {
    res = cuMemAlloc(mem_out, size);
  }

  if (res == CUDA_ERROR_OUT_OF_MEMORY) {
    return FUTHARK_OUT_OF_MEMORY;
  }

  CUDA_SUCCEED_OR_RETURN(res);
  return FUTHARK_SUCCESS;
}

static int gpu_free_actual(struct futhark_context *ctx, gpu_mem mem) {
  (void)ctx;
  CUDA_SUCCEED_OR_RETURN(cuMemFree(mem));
  return FUTHARK_SUCCESS;
}

// End of backends/cuda.h.

// Start of gpu.h

// Generic functions that use our tiny GPU abstraction layer.  The
// entire context must be defined before this header is included.  In
// particular we expect the following functions to be available:

static int gpu_free_actual(struct futhark_context *ctx, gpu_mem mem);
static int gpu_alloc_actual(struct futhark_context *ctx, size_t size, gpu_mem *mem_out);
int gpu_launch_kernel(struct futhark_context* ctx,
                      gpu_kernel kernel, const char *name,
                      const int32_t grid[3],
                      const int32_t block[3],
                      unsigned int shared_mem_bytes,
                      int num_args,
                      void* args[num_args],
                      size_t args_sizes[num_args]);
int gpu_memcpy(struct futhark_context* ctx,
               gpu_mem dst, int64_t dst_offset,
               gpu_mem src, int64_t src_offset,
               int64_t nbytes);
int gpu_scalar_from_device(struct futhark_context* ctx,
                           void *dst,
                           gpu_mem src, size_t offset, size_t size);
int gpu_scalar_to_device(struct futhark_context* ctx,
                         gpu_mem dst, size_t offset, size_t size,
                         void *src);
void gpu_create_kernel(struct futhark_context *ctx,
                       gpu_kernel* kernel,
                       const char* name);

static void gpu_init_log(struct futhark_context *ctx) {
  if (ctx->cfg->logging) {
    fprintf(ctx->log, "Default block size: %ld\n", (long)ctx->cfg->gpu.default_block_size);
    fprintf(ctx->log, "Default grid size: %ld\n", (long)ctx->cfg->gpu.default_grid_size);
    fprintf(ctx->log, "Default tile size: %ld\n", (long)ctx->cfg->gpu.default_tile_size);
    fprintf(ctx->log, "Default register tile size: %ld\n", (long)ctx->cfg->gpu.default_reg_tile_size);
    fprintf(ctx->log, "Default cache: %ld\n", (long)ctx->cfg->gpu.default_cache);
    fprintf(ctx->log, "Default registers: %ld\n", (long)ctx->cfg->gpu.default_registers);
    fprintf(ctx->log, "Default threshold: %ld\n", (long)ctx->cfg->gpu.default_threshold);
    fprintf(ctx->log, "Max thread block size: %ld\n", (long)ctx->max_thread_block_size);
    fprintf(ctx->log, "Max grid size: %ld\n", (long)ctx->max_grid_size);
    fprintf(ctx->log, "Max tile size: %ld\n", (long)ctx->max_tile_size);
    fprintf(ctx->log, "Max threshold: %ld\n", (long)ctx->max_threshold);
    fprintf(ctx->log, "Max shared memory: %ld\n", (long)ctx->max_shared_memory);
    fprintf(ctx->log, "Max registers: %ld\n", (long)ctx->max_registers);
    fprintf(ctx->log, "Max cache: %ld\n", (long)ctx->max_cache);
    fprintf(ctx->log, "Lockstep width: %ld\n", (long)ctx->lockstep_width);
  }
}

// Generic GPU command line options.

void futhark_context_config_set_default_thread_block_size(struct futhark_context_config *cfg, int size) {
  cfg->gpu.default_block_size = size;
  cfg->gpu.default_block_size_changed = 1;
}

void futhark_context_config_set_default_group_size(struct futhark_context_config *cfg, int size) {
  futhark_context_config_set_default_thread_block_size(cfg, size);
}

void futhark_context_config_set_default_grid_size(struct futhark_context_config *cfg, int num) {
  cfg->gpu.default_grid_size = num;
  cfg->gpu.default_grid_size_changed = 1;
}

void futhark_context_config_set_default_num_groups(struct futhark_context_config *cfg, int num) {
  futhark_context_config_set_default_grid_size(cfg, num);
}

void futhark_context_config_set_default_tile_size(struct futhark_context_config *cfg, int size) {
  cfg->gpu.default_tile_size = size;
  cfg->gpu.default_tile_size_changed = 1;
}

void futhark_context_config_set_default_reg_tile_size(struct futhark_context_config *cfg, int size) {
  cfg->gpu.default_reg_tile_size = size;
}

void futhark_context_config_set_default_cache(struct futhark_context_config *cfg, int size) {
  cfg->gpu.default_cache = size;
}

void futhark_context_config_set_default_registers(struct futhark_context_config *cfg, int size) {
  cfg->gpu.default_registers = size;
}

void futhark_context_config_set_default_threshold(struct futhark_context_config *cfg, int size) {
  cfg->gpu.default_threshold = size;
}

int futhark_context_config_set_tuning_param(struct futhark_context_config *cfg,
                                            const char *param_name,
                                            size_t new_value) {
  for (int i = 0; i < cfg->num_tuning_params; i++) {
    if (strcmp(param_name, cfg->tuning_param_names[i]) == 0) {
      cfg->tuning_params[i] = new_value;
      return 0;
    }
  }
  if (strcmp(param_name, "default_thread_block_size") == 0 ||
      strcmp(param_name, "default_group_size") == 0) {
    cfg->gpu.default_block_size = new_value;
    return 0;
  }
  if (strcmp(param_name, "default_grid_size") == 0 ||
      strcmp(param_name, "default_num_groups") == 0) {
    cfg->gpu.default_grid_size = new_value;
    return 0;
  }
  if (strcmp(param_name, "default_threshold") == 0) {
    cfg->gpu.default_threshold = new_value;
    return 0;
  }
  if (strcmp(param_name, "default_tile_size") == 0) {
    cfg->gpu.default_tile_size = new_value;
    return 0;
  }
  if (strcmp(param_name, "default_reg_tile_size") == 0) {
    cfg->gpu.default_reg_tile_size = new_value;
    return 0;
  }
  if (strcmp(param_name, "default_cache") == 0) {
    cfg->gpu.default_cache = new_value;
    return 0;
  }
  if (strcmp(param_name, "default_shared_memory") == 0) {
    cfg->gpu.default_shared_memory = new_value;
    return 0;
  }

  return 1;
}

// End of GPU command line optiopns.

// Max number of thead blocks we allow along the second or third
// dimension for transpositions.
#define MAX_TR_THREAD_BLOCKS 65535

struct builtin_kernels {
  // We have a lot of ways to transpose arrays.
  gpu_kernel map_transpose_1b;
  gpu_kernel map_transpose_1b_low_height;
  gpu_kernel map_transpose_1b_low_width;
  gpu_kernel map_transpose_1b_small;
  gpu_kernel map_transpose_1b_large;
  gpu_kernel map_transpose_2b;
  gpu_kernel map_transpose_2b_low_height;
  gpu_kernel map_transpose_2b_low_width;
  gpu_kernel map_transpose_2b_small;
  gpu_kernel map_transpose_2b_large;
  gpu_kernel map_transpose_4b;
  gpu_kernel map_transpose_4b_low_height;
  gpu_kernel map_transpose_4b_low_width;
  gpu_kernel map_transpose_4b_small;
  gpu_kernel map_transpose_4b_large;
  gpu_kernel map_transpose_8b;
  gpu_kernel map_transpose_8b_low_height;
  gpu_kernel map_transpose_8b_low_width;
  gpu_kernel map_transpose_8b_small;
  gpu_kernel map_transpose_8b_large;

  // And a few ways of copying.
  gpu_kernel lmad_copy_1b;
  gpu_kernel lmad_copy_2b;
  gpu_kernel lmad_copy_4b;
  gpu_kernel lmad_copy_8b;
};

struct builtin_kernels* init_builtin_kernels(struct futhark_context* ctx) {
  struct builtin_kernels *kernels = malloc(sizeof(struct builtin_kernels));
  gpu_create_kernel(ctx, &kernels->map_transpose_1b, "map_transpose_1b");
  gpu_create_kernel(ctx, &kernels->map_transpose_1b_large, "map_transpose_1b_large");
  gpu_create_kernel(ctx, &kernels->map_transpose_1b_low_height, "map_transpose_1b_low_height");
  gpu_create_kernel(ctx, &kernels->map_transpose_1b_low_width, "map_transpose_1b_low_width");
  gpu_create_kernel(ctx, &kernels->map_transpose_1b_small, "map_transpose_1b_small");

  gpu_create_kernel(ctx, &kernels->map_transpose_2b, "map_transpose_2b");
  gpu_create_kernel(ctx, &kernels->map_transpose_2b_large, "map_transpose_2b_large");
  gpu_create_kernel(ctx, &kernels->map_transpose_2b_low_height, "map_transpose_2b_low_height");
  gpu_create_kernel(ctx, &kernels->map_transpose_2b_low_width, "map_transpose_2b_low_width");
  gpu_create_kernel(ctx, &kernels->map_transpose_2b_small, "map_transpose_2b_small");

  gpu_create_kernel(ctx, &kernels->map_transpose_4b, "map_transpose_4b");
  gpu_create_kernel(ctx, &kernels->map_transpose_4b_large, "map_transpose_4b_large");
  gpu_create_kernel(ctx, &kernels->map_transpose_4b_low_height, "map_transpose_4b_low_height");
  gpu_create_kernel(ctx, &kernels->map_transpose_4b_low_width, "map_transpose_4b_low_width");
  gpu_create_kernel(ctx, &kernels->map_transpose_4b_small, "map_transpose_4b_small");

  gpu_create_kernel(ctx, &kernels->map_transpose_8b, "map_transpose_8b");
  gpu_create_kernel(ctx, &kernels->map_transpose_8b_large, "map_transpose_8b_large");
  gpu_create_kernel(ctx, &kernels->map_transpose_8b_low_height, "map_transpose_8b_low_height");
  gpu_create_kernel(ctx, &kernels->map_transpose_8b_low_width, "map_transpose_8b_low_width");
  gpu_create_kernel(ctx, &kernels->map_transpose_8b_small, "map_transpose_8b_small");

  gpu_create_kernel(ctx, &kernels->lmad_copy_1b, "lmad_copy_1b");
  gpu_create_kernel(ctx, &kernels->lmad_copy_2b, "lmad_copy_2b");
  gpu_create_kernel(ctx, &kernels->lmad_copy_4b, "lmad_copy_4b");
  gpu_create_kernel(ctx, &kernels->lmad_copy_8b, "lmad_copy_8b");

  return kernels;
}

void free_builtin_kernels(struct futhark_context* ctx, struct builtin_kernels* kernels) {
  gpu_free_kernel(ctx, kernels->map_transpose_1b);
  gpu_free_kernel(ctx, kernels->map_transpose_1b_large);
  gpu_free_kernel(ctx, kernels->map_transpose_1b_low_height);
  gpu_free_kernel(ctx, kernels->map_transpose_1b_low_width);
  gpu_free_kernel(ctx, kernels->map_transpose_1b_small);

  gpu_free_kernel(ctx, kernels->map_transpose_2b);
  gpu_free_kernel(ctx, kernels->map_transpose_2b_large);
  gpu_free_kernel(ctx, kernels->map_transpose_2b_low_height);
  gpu_free_kernel(ctx, kernels->map_transpose_2b_low_width);
  gpu_free_kernel(ctx, kernels->map_transpose_2b_small);

  gpu_free_kernel(ctx, kernels->map_transpose_4b);
  gpu_free_kernel(ctx, kernels->map_transpose_4b_large);
  gpu_free_kernel(ctx, kernels->map_transpose_4b_low_height);
  gpu_free_kernel(ctx, kernels->map_transpose_4b_low_width);
  gpu_free_kernel(ctx, kernels->map_transpose_4b_small);

  gpu_free_kernel(ctx, kernels->map_transpose_8b);
  gpu_free_kernel(ctx, kernels->map_transpose_8b_large);
  gpu_free_kernel(ctx, kernels->map_transpose_8b_low_height);
  gpu_free_kernel(ctx, kernels->map_transpose_8b_low_width);
  gpu_free_kernel(ctx, kernels->map_transpose_8b_small);

  gpu_free_kernel(ctx, kernels->lmad_copy_1b);
  gpu_free_kernel(ctx, kernels->lmad_copy_2b);
  gpu_free_kernel(ctx, kernels->lmad_copy_4b);
  gpu_free_kernel(ctx, kernels->lmad_copy_8b);

  free(kernels);
}

static int gpu_alloc(struct futhark_context *ctx, FILE *log,
                     size_t min_size, const char *tag,
                     gpu_mem *mem_out, size_t *size_out) {
  if (min_size < sizeof(int)) {
    min_size = sizeof(int);
  }

  gpu_mem* memptr;
  if (free_list_find(&ctx->gpu_free_list, min_size, tag, size_out, (fl_mem*)&memptr) == 0) {
    // Successfully found a free block.  Is it big enough?
    if (*size_out >= min_size) {
      if (ctx->cfg->debugging) {
        fprintf(log, "No need to allocate: Found a block in the free list.\n");
      }
      *mem_out = *memptr;
      free(memptr);
      return FUTHARK_SUCCESS;
    } else {
      if (ctx->cfg->debugging) {
        fprintf(log, "Found a free block, but it was too small.\n");
      }
      int error = gpu_free_actual(ctx, *memptr);
      free(memptr);
      if (error != FUTHARK_SUCCESS) {
        return error;
      }
    }
  }

  *size_out = min_size;

  // We have to allocate a new block from the driver.  If the
  // allocation does not succeed, then we might be in an out-of-memory
  // situation.  We now start freeing things from the free list until
  // we think we have freed enough that the allocation will succeed.
  // Since we don't know how far the allocation is from fitting, we
  // have to check after every deallocation.  This might be pretty
  // expensive.  Let's hope that this case is hit rarely.

  if (ctx->cfg->debugging) {
    fprintf(log, "Actually allocating the desired block.\n");
  }

  int error = gpu_alloc_actual(ctx, min_size, mem_out);

  while (error == FUTHARK_OUT_OF_MEMORY) {
    if (ctx->cfg->debugging) {
      fprintf(log, "Out of GPU memory: releasing entry from the free list...\n");
    }
    gpu_mem* memptr;
    if (free_list_first(&ctx->gpu_free_list, (fl_mem*)&memptr) == 0) {
      gpu_mem mem = *memptr;
      free(memptr);
      error = gpu_free_actual(ctx, mem);
      if (error != FUTHARK_SUCCESS) {
        return error;
      }
    } else {
      break;
    }
    error = gpu_alloc_actual(ctx, min_size, mem_out);
  }

  return error;
}

static int gpu_free(struct futhark_context *ctx,
                    gpu_mem mem, size_t size, const char *tag) {
  gpu_mem* memptr = malloc(sizeof(gpu_mem));
  *memptr = mem;
  free_list_insert(&ctx->gpu_free_list, size, (fl_mem)memptr, tag);
  return FUTHARK_SUCCESS;
}

static int gpu_free_all(struct futhark_context *ctx) {
  free_list_pack(&ctx->gpu_free_list);
  gpu_mem* memptr;
  while (free_list_first(&ctx->gpu_free_list, (fl_mem*)&memptr) == 0) {
    gpu_mem mem = *memptr;
    free(memptr);
    int error = gpu_free_actual(ctx, mem);
    if (error != FUTHARK_SUCCESS) {
      return error;
    }
  }

  return FUTHARK_SUCCESS;
}

static int gpu_map_transpose(struct futhark_context* ctx,
                             gpu_kernel kernel_default,
                             gpu_kernel kernel_low_height,
                             gpu_kernel kernel_low_width,
                             gpu_kernel kernel_small,
                             gpu_kernel kernel_large,
                             const char *name, size_t elem_size,
                             gpu_mem dst, int64_t dst_offset,
                             gpu_mem src, int64_t src_offset,
                             int64_t k, int64_t n, int64_t m) {
  int64_t mulx = TR_BLOCK_DIM / n;
  int64_t muly = TR_BLOCK_DIM / m;
  int32_t mulx32 = mulx;
  int32_t muly32 = muly;
  int32_t k32 = k;
  int32_t n32 = n;
  int32_t m32 = m;

  gpu_kernel kernel = kernel_default;
  int32_t grid[3];
  int32_t block[3];

  void* args[11];
  size_t args_sizes[11] = {
    sizeof(gpu_mem), sizeof(int64_t),
    sizeof(gpu_mem), sizeof(int64_t),
    sizeof(int32_t),
    sizeof(int32_t),
    sizeof(int32_t),
    sizeof(int32_t),
    sizeof(int32_t)
  };

  args[0] = &dst;
  args[1] = &dst_offset;
  args[2] = &src;
  args[3] = &src_offset;
  args[7] = &mulx;
  args[8] = &muly;

  if (dst_offset + k * n * m <= 2147483647L &&
      src_offset + k * n * m <= 2147483647L) {
    if (m <= TR_BLOCK_DIM/2 && n <= TR_BLOCK_DIM/2) {
      if (ctx->logging) { fprintf(ctx->log, "Using small kernel\n"); }
      kernel = kernel_small;
      grid[0] = ((k * n * m) + (TR_BLOCK_DIM*TR_BLOCK_DIM) - 1) / (TR_BLOCK_DIM*TR_BLOCK_DIM);
      grid[1] = 1;
      grid[2] = 1;
      block[0] = TR_BLOCK_DIM*TR_BLOCK_DIM;
      block[1] = 1;
      block[2] = 1;
    } else if (m <= TR_BLOCK_DIM/2 && TR_BLOCK_DIM < n) {
      if (ctx->logging) { fprintf(ctx->log, "Using low-width kernel\n"); }
      kernel = kernel_low_width;
      int64_t x_elems = m;
      int64_t y_elems = (n + muly - 1) / muly;
      grid[0] = (x_elems + TR_BLOCK_DIM - 1) / TR_BLOCK_DIM;
      grid[1] = (y_elems + TR_BLOCK_DIM - 1) / TR_BLOCK_DIM;
      grid[2] = k;
      block[0] = TR_BLOCK_DIM;
      block[1] = TR_BLOCK_DIM;
      block[2] = 1;
    } else if (n <= TR_BLOCK_DIM/2 && TR_BLOCK_DIM < m) {
      if (ctx->logging) { fprintf(ctx->log, "Using low-height kernel\n"); }
      kernel = kernel_low_height;
      int64_t x_elems = (m + mulx - 1) / mulx;
      int64_t y_elems = n;
      grid[0] = (x_elems + TR_BLOCK_DIM - 1) / TR_BLOCK_DIM;
      grid[1] = (y_elems + TR_BLOCK_DIM - 1) / TR_BLOCK_DIM;
      grid[2] = k;
      block[0] = TR_BLOCK_DIM;
      block[1] = TR_BLOCK_DIM;
      block[2] = 1;
    } else {
      if (ctx->logging) { fprintf(ctx->log, "Using default kernel\n"); }
      kernel = kernel_default;
      grid[0] = (m+TR_TILE_DIM-1)/TR_TILE_DIM;
      grid[1] = (n+TR_TILE_DIM-1)/TR_TILE_DIM;
      grid[2] = k;
      block[0] = TR_TILE_DIM;
      block[1] = TR_TILE_DIM/TR_ELEMS_PER_THREAD;
      block[2] = 1;
    }
    args[4] = &k32;
    args[5] = &m32;
    args[6] = &n32;
    args[7] = &mulx32;
    args[8] = &muly32;
  } else {
    if (ctx->logging) { fprintf(ctx->log, "Using large kernel\n"); }
    kernel = kernel_large;
    grid[0] = (m+TR_TILE_DIM-1)/TR_TILE_DIM;
    grid[1] = (n+TR_TILE_DIM-1)/TR_TILE_DIM;
    grid[2] = k;
    block[0] = TR_TILE_DIM;
    block[1] = TR_TILE_DIM/TR_ELEMS_PER_THREAD;
    block[2] = 1;
    args[4] = &k;
    args[5] = &m;
    args[6] = &n;
    args[7] = &mulx;
    args[8] = &muly;
    args_sizes[4] = sizeof(int64_t);
    args_sizes[5] = sizeof(int64_t);
    args_sizes[6] = sizeof(int64_t);
    args_sizes[7] = sizeof(int64_t);
    args_sizes[8] = sizeof(int64_t);
  }

  // Cap the number of thead blocks we launch and figure out how many
  // repeats we need alongside each dimension.
  int32_t repeat_1 = grid[1] / MAX_TR_THREAD_BLOCKS;
  int32_t repeat_2 = grid[2] / MAX_TR_THREAD_BLOCKS;
  grid[1] = repeat_1 > 0 ? MAX_TR_THREAD_BLOCKS : grid[1];
  grid[2] = repeat_2 > 0 ? MAX_TR_THREAD_BLOCKS : grid[2];
  args[9] = &repeat_1;
  args[10] = &repeat_2;
  args_sizes[9] = sizeof(repeat_1);
  args_sizes[10] = sizeof(repeat_2);

  if (ctx->logging) {
    fprintf(ctx->log, "\n");
  }

  return gpu_launch_kernel(ctx, kernel, name, grid, block,
                           TR_TILE_DIM*(TR_TILE_DIM+1)*elem_size,
                           sizeof(args)/sizeof(args[0]), args, args_sizes);
}

#define GEN_MAP_TRANSPOSE_GPU2GPU(NAME, ELEM_TYPE)                      \
  static int map_transpose_gpu2gpu_##NAME                               \
  (struct futhark_context* ctx,                                         \
   gpu_mem dst, int64_t dst_offset,                                     \
   gpu_mem src, int64_t src_offset,                                     \
   int64_t k, int64_t m, int64_t n)                                     \
  {                                                                     \
    return                                                              \
      gpu_map_transpose                                                 \
      (ctx,                                                             \
       ctx->kernels->map_transpose_##NAME,                              \
       ctx->kernels->map_transpose_##NAME##_low_height,                 \
       ctx->kernels->map_transpose_##NAME##_low_width,                  \
       ctx->kernels->map_transpose_##NAME##_small,                      \
       ctx->kernels->map_transpose_##NAME##_large,                      \
       "map_transpose_" #NAME, sizeof(ELEM_TYPE),                       \
       dst, dst_offset, src, src_offset,                                \
       k, n, m);                                                        \
  }

static int gpu_lmad_copy(struct futhark_context* ctx,
                         gpu_kernel kernel, int r,
                         gpu_mem dst, int64_t dst_offset, int64_t dst_strides[r],
                         gpu_mem src, int64_t src_offset, int64_t src_strides[r],
                         int64_t shape[r]) {
  if (r > 8) {
    set_error(ctx, strdup("Futhark runtime limitation:\nCannot copy array of greater than rank 8.\n"));
    return 1;
  }

  int64_t n = 1;
  for (int i = 0; i < r; i++) { n *= shape[i]; }

  void* args[6+(8*3)];
  size_t args_sizes[6+(8*3)];

  args[0] = &dst;
  args_sizes[0] = sizeof(gpu_mem);
  args[1] = &dst_offset;
  args_sizes[1] = sizeof(dst_offset);
  args[2] = &src;
  args_sizes[2] = sizeof(gpu_mem);
  args[3] = &src_offset;
  args_sizes[3] = sizeof(src_offset);
  args[4] = &n;
  args_sizes[4] = sizeof(n);
  args[5] = &r;
  args_sizes[5] = sizeof(r);

  int64_t zero = 0;

  for (int i = 0; i < 8; i++) {
    args_sizes[6+i*3] = sizeof(int64_t);
    args_sizes[6+i*3+1] = sizeof(int64_t);
    args_sizes[6+i*3+2] = sizeof(int64_t);
    if (i < r) {
      args[6+i*3] = &shape[i];
      args[6+i*3+1] = &dst_strides[i];
      args[6+i*3+2] = &src_strides[i];
    } else {
      args[6+i*3] = &zero;
      args[6+i*3+1] = &zero;
      args[6+i*3+2] = &zero;
    }
  }
  const size_t w = 256; // XXX: hardcoded thread block size.

  return gpu_launch_kernel(ctx, kernel, "copy_lmad_dev_to_dev",
                           (const int32_t[3]) {(n+w-1)/w,1,1},
                           (const int32_t[3]) {w,1,1},
                           0, 6+(8*3), args, args_sizes);
}

#define GEN_LMAD_COPY_ELEMENTS_GPU2GPU(NAME, ELEM_TYPE)                 \
  static int lmad_copy_elements_gpu2gpu_##NAME                          \
  (struct futhark_context* ctx,                                         \
   int r,                                                               \
   gpu_mem dst, int64_t dst_offset, int64_t dst_strides[r],             \
   gpu_mem src, int64_t src_offset, int64_t src_strides[r],             \
   int64_t shape[r]) {                                                  \
    return gpu_lmad_copy(ctx, ctx->kernels->lmad_copy_##NAME, r,        \
                         dst, dst_offset, dst_strides,                  \
                         src, src_offset, src_strides,                  \
                         shape);                                        \
  }                                                                     \

#define GEN_LMAD_COPY_GPU2GPU(NAME, ELEM_TYPE)                          \
  static int lmad_copy_gpu2gpu_##NAME                                   \
  (struct futhark_context* ctx,                                         \
   int r,                                                               \
   gpu_mem dst, int64_t dst_offset, int64_t dst_strides[r],             \
   gpu_mem src, int64_t src_offset, int64_t src_strides[r],             \
   int64_t shape[r]) {                                                  \
    log_copy(ctx, "GPU to GPU", r, dst_offset, dst_strides,             \
             src_offset, src_strides, shape);                           \
    int64_t size = 1;                                                   \
    for (int i = 0; i < r; i++) { size *= shape[i]; }                   \
    if (size == 0) { return FUTHARK_SUCCESS; }                          \
    int64_t k, n, m;                                                    \
    if (lmad_map_tr(&k, &n, &m,                                         \
                       r, dst_strides, src_strides, shape)) {           \
      log_transpose(ctx, k, n, m);                                      \
      return map_transpose_gpu2gpu_##NAME                               \
        (ctx, dst, dst_offset, src, src_offset, k, n, m);               \
    } else if (lmad_memcpyable(r, dst_strides, src_strides, shape)) {   \
      if (ctx->logging) {fprintf(ctx->log, "## Flat copy\n\n");}        \
      return gpu_memcpy(ctx,                                            \
                        dst, dst_offset*sizeof(ELEM_TYPE),              \
                        src, src_offset*sizeof(ELEM_TYPE),              \
                        size * sizeof(ELEM_TYPE));                      \
    } else {                                                            \
      if (ctx->logging) {fprintf(ctx->log, "## General copy\n\n");}     \
      return lmad_copy_elements_gpu2gpu_##NAME                          \
        (ctx, r,                                                        \
         dst, dst_offset, dst_strides,                                  \
         src, src_offset, src_strides,                                  \
         shape);                                                        \
    }                                                                   \
  }

static int
lmad_copy_elements_host2gpu(struct futhark_context *ctx, size_t elem_size,
                            int r,
                            gpu_mem dst, int64_t dst_offset, int64_t dst_strides[r],
                            unsigned char* src, int64_t src_offset, int64_t src_strides[r],
                            int64_t shape[r]) {
  (void)ctx; (void)elem_size; (void)r;
  (void)dst; (void)dst_offset; (void)dst_strides;
  (void)src; (void)src_offset; (void)src_strides;
  (void)shape;
  set_error(ctx, strdup("Futhark runtime limitation:\nCannot copy unstructured array from host to GPU.\n"));
  return 1;
}

static int
lmad_copy_elements_gpu2host (struct futhark_context *ctx, size_t elem_size,
                             int r,
                             unsigned char* dst, int64_t dst_offset, int64_t dst_strides[r],
                             gpu_mem src, int64_t src_offset, int64_t src_strides[r],
                             int64_t shape[r]) {
  (void)ctx; (void)elem_size; (void)r;
  (void)dst; (void)dst_offset; (void)dst_strides;
  (void)src; (void)src_offset; (void)src_strides;
  (void)shape;
  set_error(ctx, strdup("Futhark runtime limitation:\nCannot copy unstructured array from GPU to host.\n"));
  return 1;
}

#define GEN_LMAD_COPY_ELEMENTS_HOSTGPU(NAME, ELEM_TYPE)                 \
  static int lmad_copy_elements_gpu2gpu_##NAME                          \
  (struct futhark_context* ctx,                                         \
   int r,                                                               \
   gpu_mem dst, int64_t dst_offset, int64_t dst_strides[r],             \
   gpu_mem src, int64_t src_offset, int64_t src_strides[r],             \
   int64_t shape[r]) {                                                  \
    return (ctx, ctx->kernels->lmad_copy_##NAME, r,                     \
                         dst, dst_offset, dst_strides,                  \
                         src, src_offset, src_strides,                  \
                         shape);                                        \
  }                                                                     \


static int lmad_copy_host2gpu(struct futhark_context* ctx, size_t elem_size, bool sync,
                              int r,
                              gpu_mem dst, int64_t dst_offset, int64_t dst_strides[r],
                              unsigned char* src, int64_t src_offset, int64_t src_strides[r],
                              int64_t shape[r]) {
  log_copy(ctx, "Host to GPU", r, dst_offset, dst_strides,
           src_offset, src_strides, shape);
  int64_t size = elem_size;
  for (int i = 0; i < r; i++) { size *= shape[i]; }
  if (size == 0) { return FUTHARK_SUCCESS; }
  int64_t k, n, m;
  if (lmad_memcpyable(r, dst_strides, src_strides, shape)) {
    if (ctx->logging) {fprintf(ctx->log, "## Flat copy\n\n");}
    return memcpy_host2gpu(ctx, sync,
                           dst, dst_offset*elem_size,
                           src, src_offset*elem_size,
                           size);
  } else {
    if (ctx->logging) {fprintf(ctx->log, "## General copy\n\n");}
    int error;
    error = lmad_copy_elements_host2gpu
      (ctx, elem_size, r,
       dst, dst_offset, dst_strides,
       src, src_offset, src_strides,
       shape);
    if (error == 0 && sync) {
      error = futhark_context_sync(ctx);
    }
    return error;
  }
}

static int lmad_copy_gpu2host(struct futhark_context* ctx, size_t elem_size, bool sync,
                              int r,
                              unsigned char* dst, int64_t dst_offset, int64_t dst_strides[r],
                              gpu_mem src, int64_t src_offset, int64_t src_strides[r],
                              int64_t shape[r]) {
  log_copy(ctx, "Host to GPU", r, dst_offset, dst_strides,
           src_offset, src_strides, shape);
  int64_t size = elem_size;
  for (int i = 0; i < r; i++) { size *= shape[i]; }
  if (size == 0) { return FUTHARK_SUCCESS; }
  int64_t k, n, m;
  if (lmad_memcpyable(r, dst_strides, src_strides, shape)) {
    if (ctx->logging) {fprintf(ctx->log, "## Flat copy\n\n");}
    return memcpy_gpu2host(ctx, sync,
                           dst, dst_offset*elem_size,
                           src, src_offset*elem_size,
                           size);
  } else {
    if (ctx->logging) {fprintf(ctx->log, "## General copy\n\n");}
    int error;
    error = lmad_copy_elements_gpu2host
      (ctx, elem_size, r,
       dst, dst_offset, dst_strides,
       src, src_offset, src_strides,
       shape);
    if (error == 0 && sync) {
      error = futhark_context_sync(ctx);
    }
    return error;
  }
}

GEN_MAP_TRANSPOSE_GPU2GPU(1b, uint8_t)
GEN_MAP_TRANSPOSE_GPU2GPU(2b, uint16_t)
GEN_MAP_TRANSPOSE_GPU2GPU(4b, uint32_t)
GEN_MAP_TRANSPOSE_GPU2GPU(8b, uint64_t)

GEN_LMAD_COPY_ELEMENTS_GPU2GPU(1b, uint8_t)
GEN_LMAD_COPY_ELEMENTS_GPU2GPU(2b, uint16_t)
GEN_LMAD_COPY_ELEMENTS_GPU2GPU(4b, uint32_t)
GEN_LMAD_COPY_ELEMENTS_GPU2GPU(8b, uint64_t)

GEN_LMAD_COPY_GPU2GPU(1b, uint8_t)
GEN_LMAD_COPY_GPU2GPU(2b, uint16_t)
GEN_LMAD_COPY_GPU2GPU(4b, uint32_t)
GEN_LMAD_COPY_GPU2GPU(8b, uint64_t)

// End of gpu.h

static int gpu_macros(struct futhark_context *ctx, char ***names_out, int64_t **values_out)
{
    int num_macros = 207;
    char **names = malloc(num_macros * sizeof(char *));
    int64_t *values = malloc(num_macros * sizeof(int64_t));
    
    {
        names[0] = "get_num_neighbours_against_9635zisegred_large_46385_dim1";
        values[0] = *ctx->tuning_params.get_num_neighbours_against_9635zisegred_tblock_sizze_46296;
    }
    {
        names[1] = "get_num_neighbours_against_9635zisegred_large_46385zisegred_tblock_sizze_46379";
        values[1] = *ctx->tuning_params.get_num_neighbours_against_9635zisegred_tblock_sizze_46296;
    }
    {
        names[2] = "get_num_neighbours_against_9635zisegred_large_46385zichunk_sizze_50240";
        values[2] = (int64_t) 1;
    }
    {
        names[3] = "get_num_neighbours_against_9635zisegred_small_46385_dim1";
        values[3] = *ctx->tuning_params.get_num_neighbours_against_9635zisegred_tblock_sizze_46296;
    }
    {
        names[4] = "get_num_neighbours_against_9635zisegred_small_46385zisegred_tblock_sizze_46379";
        values[4] = *ctx->tuning_params.get_num_neighbours_against_9635zisegred_tblock_sizze_46296;
    }
    {
        names[5] = "get_num_neighbours_against_9635zisegmap_46367_dim1";
        values[5] = *ctx->tuning_params.get_num_neighbours_against_9635zisegmap_tblock_sizze_46346;
    }
    {
        names[6] = "get_num_neighbours_against_9635zisegmap_46367zisegmap_tblock_sizze_46361";
        values[6] = *ctx->tuning_params.get_num_neighbours_against_9635zisegmap_tblock_sizze_46346;
    }
    {
        names[7] = "get_num_neighbours_against_9635zisegmap_intrablock_46535_dim1";
        values[7] = *ctx->tuning_params.get_num_neighbours_against_9635zitile_sizze_46536;
    }
    {
        names[8] = "get_num_neighbours_against_9635zisegmap_intrablock_46535zitile_sizze_46537";
        values[8] = *ctx->tuning_params.get_num_neighbours_against_9635zitile_sizze_46536;
    }
    {
        names[9] = "get_num_neighbours_against_9635zisegmap_intrablock_46535zibytes_49419";
        values[9] = (int64_t) 8 * *ctx->tuning_params.get_num_neighbours_against_9635zitile_sizze_46536;
    }
    {
        names[10] = "get_num_neighbours_against_9632zisegred_large_46151_dim1";
        values[10] = *ctx->tuning_params.get_num_neighbours_against_9632zisegred_tblock_sizze_46062;
    }
    {
        names[11] = "get_num_neighbours_against_9632zisegred_large_46151zisegred_tblock_sizze_46145";
        values[11] = *ctx->tuning_params.get_num_neighbours_against_9632zisegred_tblock_sizze_46062;
    }
    {
        names[12] = "get_num_neighbours_against_9632zisegred_large_46151zichunk_sizze_50240";
        values[12] = (int64_t) 1;
    }
    {
        names[13] = "get_num_neighbours_against_9632zisegred_small_46151_dim1";
        values[13] = *ctx->tuning_params.get_num_neighbours_against_9632zisegred_tblock_sizze_46062;
    }
    {
        names[14] = "get_num_neighbours_against_9632zisegred_small_46151zisegred_tblock_sizze_46145";
        values[14] = *ctx->tuning_params.get_num_neighbours_against_9632zisegred_tblock_sizze_46062;
    }
    {
        names[15] = "get_num_neighbours_against_9632zisegmap_46133_dim1";
        values[15] = *ctx->tuning_params.get_num_neighbours_against_9632zisegmap_tblock_sizze_46112;
    }
    {
        names[16] = "get_num_neighbours_against_9632zisegmap_46133zisegmap_tblock_sizze_46127";
        values[16] = *ctx->tuning_params.get_num_neighbours_against_9632zisegmap_tblock_sizze_46112;
    }
    {
        names[17] = "get_num_neighbours_against_9632zisegmap_intrablock_46535_dim1";
        values[17] = *ctx->tuning_params.get_num_neighbours_against_9632zitile_sizze_46536;
    }
    {
        names[18] = "get_num_neighbours_against_9632zisegmap_intrablock_46535zitile_sizze_46537";
        values[18] = *ctx->tuning_params.get_num_neighbours_against_9632zitile_sizze_46536;
    }
    {
        names[19] = "get_num_neighbours_against_9632zisegmap_intrablock_46535zibytes_49419";
        values[19] = (int64_t) 8 * *ctx->tuning_params.get_num_neighbours_against_9632zitile_sizze_46536;
    }
    {
        names[20] = "rectify_partition_ids_doublezisegmap_intrablock_46779_dim1";
        values[20] = *ctx->tuning_params.rectify_partition_ids_doublezitile_sizze_46780;
    }
    {
        names[21] = "rectify_partition_ids_doublezisegmap_intrablock_46779zitile_sizze_46781";
        values[21] = *ctx->tuning_params.rectify_partition_ids_doublezitile_sizze_46780;
    }
    {
        names[22] = "rectify_partition_ids_doublezisegmap_intrablock_46779zibytes_49397";
        values[22] = (int64_t) 8 * *ctx->tuning_params.rectify_partition_ids_doublezitile_sizze_46780;
    }
    {
        names[23] = "rectify_partition_ids_doublezisegmap_intrablock_46535_dim1";
        values[23] = *ctx->tuning_params.rectify_partition_ids_doublezitile_sizze_46536;
    }
    {
        names[24] = "rectify_partition_ids_doublezisegmap_intrablock_46535zitile_sizze_46537";
        values[24] = *ctx->tuning_params.rectify_partition_ids_doublezitile_sizze_46536;
    }
    {
        names[25] = "rectify_partition_ids_doublezisegmap_intrablock_46535zibytes_49437";
        values[25] = (int64_t) 8 * *ctx->tuning_params.rectify_partition_ids_doublezitile_sizze_46536;
    }
    {
        names[26] = "next_partition_to_read_doublezigpuseq_50407_dim1";
        values[26] = (int64_t) 1;
    }
    {
        names[27] = "next_partition_to_read_doublezisegmap_42834_dim1";
        values[27] = *ctx->tuning_params.next_partition_to_read_doublezisegmap_tblock_sizze_42836;
    }
    {
        names[28] = "next_partition_to_read_doublezisegmap_42834zisegmap_tblock_sizze_42837";
        values[28] = *ctx->tuning_params.next_partition_to_read_doublezisegmap_tblock_sizze_42836;
    }
    {
        names[29] = "next_partition_to_read_doublezisegscan_42832_dim1";
        values[29] = *ctx->tuning_params.next_partition_to_read_doublezisegscan_tblock_sizze_42826;
    }
    {
        names[30] = "next_partition_to_read_doublezisegscan_42832zisegscan_tblock_sizze_42827";
        values[30] = *ctx->tuning_params.next_partition_to_read_doublezisegscan_tblock_sizze_42826;
    }
    {
        names[31] = "next_partition_to_read_doublezisegscan_42832zichunk_sizze_50258";
        values[31] = smax64((int64_t) 1, smin64(squot64(squot64(ctx->max_shared_memory, ctx->max_thread_block_size), (int64_t) 8), squot64(squot64(ctx->max_registers, ctx->max_thread_block_size) - (int64_t) 1 - squot64(smax64((int64_t) 4, (int64_t) 8), (int64_t) 4), (int64_t) 2 * squot64(smax64((int64_t) 4, (int64_t) 8), (int64_t) 4))));
    }
    {
        names[32] = "next_partition_to_read_doublezisegred_nonseg_42824_dim1";
        values[32] = *ctx->tuning_params.next_partition_to_read_doublezisegred_tblock_sizze_42816;
    }
    {
        names[33] = "next_partition_to_read_doublezisegred_nonseg_42824zisegred_tblock_sizze_42817";
        values[33] = *ctx->tuning_params.next_partition_to_read_doublezisegred_tblock_sizze_42816;
    }
    {
        names[34] = "next_partition_to_read_doublezisegred_nonseg_42824zichunk_sizze_50200";
        values[34] = (int64_t) 1;
    }
    {
        names[35] = "next_partition_to_read_doublezigpuseq_50194_dim1";
        values[35] = (int64_t) 1;
    }
    {
        names[36] = "mk_dbcHandler_doublezigpuseq_50292_dim1";
        values[36] = (int64_t) 1;
    }
    {
        names[37] = "make_collisions_compact_doublezisegmap_42997_dim1";
        values[37] = *ctx->tuning_params.make_collisions_compact_doublezisegmap_tblock_sizze_42999;
    }
    {
        names[38] = "make_collisions_compact_doublezisegmap_42997zisegmap_tblock_sizze_43000";
        values[38] = *ctx->tuning_params.make_collisions_compact_doublezisegmap_tblock_sizze_42999;
    }
    {
        names[39] = "make_collisions_compact_doublezisegscan_42995_dim1";
        values[39] = *ctx->tuning_params.make_collisions_compact_doublezisegscan_tblock_sizze_42989;
    }
    {
        names[40] = "make_collisions_compact_doublezisegscan_42995zisegscan_tblock_sizze_42990";
        values[40] = *ctx->tuning_params.make_collisions_compact_doublezisegscan_tblock_sizze_42989;
    }
    {
        names[41] = "make_collisions_compact_doublezisegscan_42995zichunk_sizze_50263";
        values[41] = smax64((int64_t) 1, smin64(squot64(squot64(ctx->max_shared_memory, ctx->max_thread_block_size), (int64_t) 8), squot64(squot64(ctx->max_registers, ctx->max_thread_block_size) - (int64_t) 1 - squot64(smax64((int64_t) 4, (int64_t) 8), (int64_t) 4), (int64_t) 2 * squot64(smax64((int64_t) 4, (int64_t) 8), (int64_t) 4))));
    }
    {
        names[42] = "make_collisions_compact_doublezisegmap_intrablock_46804_dim1";
        values[42] = *ctx->tuning_params.make_collisions_compact_doublezitile_sizze_46805;
    }
    {
        names[43] = "make_collisions_compact_doublezisegmap_intrablock_46804zitile_sizze_46806";
        values[43] = *ctx->tuning_params.make_collisions_compact_doublezitile_sizze_46805;
    }
    {
        names[44] = "make_collisions_compact_doublezisegmap_intrablock_46804zibytes_49424";
        values[44] = (int64_t) 8 * *ctx->tuning_params.make_collisions_compact_doublezitile_sizze_46805;
    }
    {
        names[45] = "make_collisions_compact_doublezisegmap_intrablock_46535_dim1";
        values[45] = *ctx->tuning_params.make_collisions_compact_doublezitile_sizze_46536;
    }
    {
        names[46] = "make_collisions_compact_doublezisegmap_intrablock_46535zitile_sizze_46537";
        values[46] = *ctx->tuning_params.make_collisions_compact_doublezitile_sizze_46536;
    }
    {
        names[47] = "make_collisions_compact_doublezisegmap_intrablock_46535zibytes_49470";
        values[47] = (int64_t) 8 * *ctx->tuning_params.make_collisions_compact_doublezitile_sizze_46536;
    }
    {
        names[48] = "do_DBSCAN_doublezisegred_large_45909_dim1";
        values[48] = *ctx->tuning_params.do_DBSCAN_doublezisegred_tblock_sizze_45811;
    }
    {
        names[49] = "do_DBSCAN_doublezisegred_large_45909zisegred_tblock_sizze_45902";
        values[49] = *ctx->tuning_params.do_DBSCAN_doublezisegred_tblock_sizze_45811;
    }
    {
        names[50] = "do_DBSCAN_doublezisegred_large_45909zichunk_sizze_51983";
        values[50] = (int64_t) 1;
    }
    {
        names[51] = "do_DBSCAN_doublezisegred_small_45909_dim1";
        values[51] = *ctx->tuning_params.do_DBSCAN_doublezisegred_tblock_sizze_45811;
    }
    {
        names[52] = "do_DBSCAN_doublezisegred_small_45909zisegred_tblock_sizze_45902";
        values[52] = *ctx->tuning_params.do_DBSCAN_doublezisegred_tblock_sizze_45811;
    }
    {
        names[53] = "do_DBSCAN_doublezisegmap_45890_dim1";
        values[53] = *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_45869;
    }
    {
        names[54] = "do_DBSCAN_doublezisegmap_45890zisegmap_tblock_sizze_45884";
        values[54] = *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_45869;
    }
    {
        names[55] = "do_DBSCAN_doublezisegmap_intrablock_48552_dim1";
        values[55] = *ctx->tuning_params.do_DBSCAN_doublezitile_sizze_48553;
    }
    {
        names[56] = "do_DBSCAN_doublezisegmap_intrablock_48552zitile_sizze_48554";
        values[56] = *ctx->tuning_params.do_DBSCAN_doublezitile_sizze_48553;
    }
    {
        names[57] = "do_DBSCAN_doublezisegmap_intrablock_48552zibytes_49981";
        values[57] = (int64_t) 8 * *ctx->tuning_params.do_DBSCAN_doublezitile_sizze_48553;
    }
    {
        names[58] = "do_DBSCAN_doublezisegmap_45679_dim1";
        values[58] = *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_45681;
    }
    {
        names[59] = "do_DBSCAN_doublezisegmap_45679zisegmap_tblock_sizze_45682";
        values[59] = *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_45681;
    }
    {
        names[60] = "do_DBSCAN_doublezisegmap_45663_dim1";
        values[60] = *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_45665;
    }
    {
        names[61] = "do_DBSCAN_doublezisegmap_45663zisegmap_tblock_sizze_45666";
        values[61] = *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_45665;
    }
    {
        names[62] = "do_DBSCAN_doublezisegred_large_45615_dim1";
        values[62] = *ctx->tuning_params.do_DBSCAN_doublezisegred_tblock_sizze_45517;
    }
    {
        names[63] = "do_DBSCAN_doublezisegred_large_45615zisegred_tblock_sizze_45608";
        values[63] = *ctx->tuning_params.do_DBSCAN_doublezisegred_tblock_sizze_45517;
    }
    {
        names[64] = "do_DBSCAN_doublezisegred_large_45615zichunk_sizze_51824";
        values[64] = (int64_t) 1;
    }
    {
        names[65] = "do_DBSCAN_doublezisegred_small_45615_dim1";
        values[65] = *ctx->tuning_params.do_DBSCAN_doublezisegred_tblock_sizze_45517;
    }
    {
        names[66] = "do_DBSCAN_doublezisegred_small_45615zisegred_tblock_sizze_45608";
        values[66] = *ctx->tuning_params.do_DBSCAN_doublezisegred_tblock_sizze_45517;
    }
    {
        names[67] = "do_DBSCAN_doublezisegmap_45596_dim1";
        values[67] = *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_45575;
    }
    {
        names[68] = "do_DBSCAN_doublezisegmap_45596zisegmap_tblock_sizze_45590";
        values[68] = *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_45575;
    }
    {
        names[69] = "do_DBSCAN_doublezisegmap_intrablock_48143_dim1";
        values[69] = *ctx->tuning_params.do_DBSCAN_doublezitile_sizze_48144;
    }
    {
        names[70] = "do_DBSCAN_doublezisegmap_intrablock_48143zitile_sizze_48145";
        values[70] = *ctx->tuning_params.do_DBSCAN_doublezitile_sizze_48144;
    }
    {
        names[71] = "do_DBSCAN_doublezisegmap_intrablock_48143zibytes_49891";
        values[71] = (int64_t) 8 * *ctx->tuning_params.do_DBSCAN_doublezitile_sizze_48144;
    }
    {
        names[72] = "do_DBSCAN_doublezisegmap_45376_dim1";
        values[72] = *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_45349;
    }
    {
        names[73] = "do_DBSCAN_doublezisegmap_45376zisegmap_tblock_sizze_45370";
        values[73] = *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_45349;
    }
    {
        names[74] = "do_DBSCAN_doublezisegmap_intrablock_47884_dim1";
        values[74] = *ctx->tuning_params.do_DBSCAN_doublezitile_sizze_47885;
    }
    {
        names[75] = "do_DBSCAN_doublezisegmap_intrablock_47884zitile_sizze_47886";
        values[75] = *ctx->tuning_params.do_DBSCAN_doublezitile_sizze_47885;
    }
    {
        names[76] = "do_DBSCAN_doublezisegmap_intrablock_47884zibytes_49774";
        values[76] = (int64_t) 8 * *ctx->tuning_params.do_DBSCAN_doublezitile_sizze_47885;
    }
    {
        names[77] = "do_DBSCAN_doublezisegmap_intrablock_47625_dim1";
        values[77] = *ctx->tuning_params.do_DBSCAN_doublezitile_sizze_47626;
    }
    {
        names[78] = "do_DBSCAN_doublezisegmap_intrablock_47625zitile_sizze_47627";
        values[78] = *ctx->tuning_params.do_DBSCAN_doublezitile_sizze_47626;
    }
    {
        names[79] = "do_DBSCAN_doublezisegmap_intrablock_47625zibytes_49814";
        values[79] = (int64_t) 8 * *ctx->tuning_params.do_DBSCAN_doublezitile_sizze_47626;
    }
    {
        names[80] = "do_DBSCAN_doublezisegscan_45677_dim1";
        values[80] = *ctx->tuning_params.do_DBSCAN_doublezisegscan_tblock_sizze_45671;
    }
    {
        names[81] = "do_DBSCAN_doublezisegscan_45677zisegscan_tblock_sizze_45672";
        values[81] = *ctx->tuning_params.do_DBSCAN_doublezisegscan_tblock_sizze_45671;
    }
    {
        names[82] = "do_DBSCAN_doublezisegscan_45677zichunk_sizze_51642";
        values[82] = smax64((int64_t) 1, smin64(squot64(squot64(ctx->max_shared_memory, ctx->max_thread_block_size), (int64_t) 8), squot64(squot64(ctx->max_registers, ctx->max_thread_block_size) - (int64_t) 1 - squot64(smax64((int64_t) 4, (int64_t) 8), (int64_t) 4), (int64_t) 2 * squot64(smax64((int64_t) 4, (int64_t) 8), (int64_t) 4))));
    }
    {
        names[83] = "do_DBSCAN_doublezisegmap_45218_dim1";
        values[83] = *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_45220;
    }
    {
        names[84] = "do_DBSCAN_doublezisegmap_45218zisegmap_tblock_sizze_45221";
        values[84] = *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_45220;
    }
    {
        names[85] = "do_DBSCAN_doublezisegscan_45210_dim1";
        values[85] = *ctx->tuning_params.do_DBSCAN_doublezisegscan_tblock_sizze_45104;
    }
    {
        names[86] = "do_DBSCAN_doublezisegscan_45210zisegscan_tblock_sizze_45205";
        values[86] = *ctx->tuning_params.do_DBSCAN_doublezisegscan_tblock_sizze_45104;
    }
    {
        names[87] = "do_DBSCAN_doublezisegscan_45210zichunk_sizze_51525";
        values[87] = smax64((int64_t) 1, smin64(squot64(squot64(ctx->max_shared_memory, ctx->max_thread_block_size), (int64_t) 8), squot64(squot64(ctx->max_registers, ctx->max_thread_block_size) - (int64_t) 1 - squot64(smax64((int64_t) 4, (int64_t) 8), (int64_t) 4), (int64_t) 2 * squot64(smax64((int64_t) 4, (int64_t) 8), (int64_t) 4))));
    }
    {
        names[88] = "do_DBSCAN_doublezisegmap_intrablock_47270_dim1";
        values[88] = *ctx->tuning_params.do_DBSCAN_doublezitile_sizze_47271;
    }
    {
        names[89] = "do_DBSCAN_doublezisegmap_intrablock_47270zitile_sizze_47272";
        values[89] = *ctx->tuning_params.do_DBSCAN_doublezitile_sizze_47271;
    }
    {
        names[90] = "do_DBSCAN_doublezisegmap_intrablock_47270zibytes_49641";
        values[90] = (int64_t) 8 * *ctx->tuning_params.do_DBSCAN_doublezitile_sizze_47271;
    }
    {
        names[91] = "do_DBSCAN_doublezisegmap_intrablock_46915_dim1";
        values[91] = *ctx->tuning_params.do_DBSCAN_doublezitile_sizze_46916;
    }
    {
        names[92] = "do_DBSCAN_doublezisegmap_intrablock_46915zitile_sizze_46917";
        values[92] = *ctx->tuning_params.do_DBSCAN_doublezitile_sizze_46916;
    }
    {
        names[93] = "do_DBSCAN_doublezisegmap_intrablock_46915zibytes_49703";
        values[93] = (int64_t) 8 * *ctx->tuning_params.do_DBSCAN_doublezitile_sizze_46916;
    }
    {
        names[94] = "do_DBSCAN_doublezisegmap_44805_dim1";
        values[94] = *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_44807;
    }
    {
        names[95] = "do_DBSCAN_doublezisegmap_44805zisegmap_tblock_sizze_44808";
        values[95] = *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_44807;
    }
    {
        names[96] = "do_DBSCAN_doublezisegmap_44801_dim1";
        values[96] = *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_44789;
    }
    {
        names[97] = "do_DBSCAN_doublezisegmap_44801zisegmap_tblock_sizze_44797";
        values[97] = *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_44789;
    }
    {
        names[98] = "do_DBSCAN_doublezisegmap_44774_dim1";
        values[98] = *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_44753;
    }
    {
        names[99] = "do_DBSCAN_doublezisegmap_44774zisegmap_tblock_sizze_44770";
        values[99] = *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_44753;
    }
    {
        names[100] = "do_DBSCAN_doublezisegmap_44743_dim1";
        values[100] = *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_44727;
    }
    {
        names[101] = "do_DBSCAN_doublezisegmap_44743zisegmap_tblock_sizze_44739";
        values[101] = *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_44727;
    }
    {
        names[102] = "do_DBSCAN_doublezisegscan_44723_dim1";
        values[102] = *ctx->tuning_params.do_DBSCAN_doublezisegscan_tblock_sizze_44717;
    }
    {
        names[103] = "do_DBSCAN_doublezisegscan_44723zisegscan_tblock_sizze_44718";
        values[103] = *ctx->tuning_params.do_DBSCAN_doublezisegscan_tblock_sizze_44717;
    }
    {
        names[104] = "do_DBSCAN_doublezisegscan_44723zichunk_sizze_51222";
        values[104] = smax64((int64_t) 1, smin64(squot64(squot64(ctx->max_shared_memory, ctx->max_thread_block_size), (int64_t) 8), squot64(squot64(ctx->max_registers, ctx->max_thread_block_size) - (int64_t) 1 - squot64(smax64((int64_t) 4, (int64_t) 8), (int64_t) 4), (int64_t) 2 * squot64(smax64((int64_t) 4, (int64_t) 8), (int64_t) 4))));
    }
    {
        names[105] = "do_DBSCAN_doublezisegred_nonseg_44715_dim1";
        values[105] = *ctx->tuning_params.do_DBSCAN_doublezisegred_tblock_sizze_44707;
    }
    {
        names[106] = "do_DBSCAN_doublezisegred_nonseg_44715zisegred_tblock_sizze_44708";
        values[106] = *ctx->tuning_params.do_DBSCAN_doublezisegred_tblock_sizze_44707;
    }
    {
        names[107] = "do_DBSCAN_doublezisegred_nonseg_44715zichunk_sizze_51183";
        values[107] = (int64_t) 1;
    }
    {
        names[108] = "do_DBSCAN_doublezisegred_large_44665_dim1";
        values[108] = *ctx->tuning_params.do_DBSCAN_doublezisegred_tblock_sizze_44574;
    }
    {
        names[109] = "do_DBSCAN_doublezisegred_large_44665zisegred_tblock_sizze_44659";
        values[109] = *ctx->tuning_params.do_DBSCAN_doublezisegred_tblock_sizze_44574;
    }
    {
        names[110] = "do_DBSCAN_doublezisegred_large_44665zichunk_sizze_51110";
        values[110] = (int64_t) 1;
    }
    {
        names[111] = "do_DBSCAN_doublezisegred_small_44665_dim1";
        values[111] = *ctx->tuning_params.do_DBSCAN_doublezisegred_tblock_sizze_44574;
    }
    {
        names[112] = "do_DBSCAN_doublezisegred_small_44665zisegred_tblock_sizze_44659";
        values[112] = *ctx->tuning_params.do_DBSCAN_doublezisegred_tblock_sizze_44574;
    }
    {
        names[113] = "do_DBSCAN_doublezisegmap_44647_dim1";
        values[113] = *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_44626;
    }
    {
        names[114] = "do_DBSCAN_doublezisegmap_44647zisegmap_tblock_sizze_44641";
        values[114] = *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_44626;
    }
    {
        names[115] = "do_DBSCAN_doublezisegmap_intrablock_46535_dim1";
        values[115] = *ctx->tuning_params.do_DBSCAN_doublezitile_sizze_46536;
    }
    {
        names[116] = "do_DBSCAN_doublezisegmap_intrablock_46535zitile_sizze_46537";
        values[116] = *ctx->tuning_params.do_DBSCAN_doublezitile_sizze_46536;
    }
    {
        names[117] = "do_DBSCAN_doublezisegmap_intrablock_46535zibytes_49561";
        values[117] = (int64_t) 8 * *ctx->tuning_params.do_DBSCAN_doublezitile_sizze_46536;
    }
    {
        names[118] = "do_DBSCAN_doublezisegscan_44463_dim1";
        values[118] = *ctx->tuning_params.do_DBSCAN_doublezisegscan_tblock_sizze_44457;
    }
    {
        names[119] = "do_DBSCAN_doublezisegscan_44463zisegscan_tblock_sizze_44458";
        values[119] = *ctx->tuning_params.do_DBSCAN_doublezisegscan_tblock_sizze_44457;
    }
    {
        names[120] = "do_DBSCAN_doublezisegscan_44463zichunk_sizze_50979";
        values[120] = smax64((int64_t) 1, smin64(squot64(squot64(ctx->max_shared_memory, ctx->max_thread_block_size), (int64_t) 8), squot64(squot64(ctx->max_registers, ctx->max_thread_block_size) - (int64_t) 1 - squot64(smax64((int64_t) 4, (int64_t) 8), (int64_t) 4), (int64_t) 2 * squot64(smax64((int64_t) 4, (int64_t) 8), (int64_t) 4))));
    }
    {
        names[121] = "do_DBSCAN_doublezisegmap_44449_dim1";
        values[121] = *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_44451;
    }
    {
        names[122] = "do_DBSCAN_doublezisegmap_44449zisegmap_tblock_sizze_44452";
        values[122] = *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_44451;
    }
    {
        names[123] = "do_DBSCAN_doublezisegscan_44447_dim1";
        values[123] = *ctx->tuning_params.do_DBSCAN_doublezisegscan_tblock_sizze_44441;
    }
    {
        names[124] = "do_DBSCAN_doublezisegscan_44447zisegscan_tblock_sizze_44442";
        values[124] = *ctx->tuning_params.do_DBSCAN_doublezisegscan_tblock_sizze_44441;
    }
    {
        names[125] = "do_DBSCAN_doublezisegscan_44447zichunk_sizze_50862";
        values[125] = smax64((int64_t) 1, smin64(squot64(squot64(ctx->max_shared_memory, ctx->max_thread_block_size), (int64_t) 8), squot64(squot64(ctx->max_registers, ctx->max_thread_block_size) - (int64_t) 1 - squot64(smax64((int64_t) 4, (int64_t) 8), (int64_t) 4), (int64_t) 2 * squot64(smax64((int64_t) 4, (int64_t) 8), (int64_t) 4))));
    }
    {
        names[126] = "do_DBSCAN_doublezisegmap_44435_dim1";
        values[126] = *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_44421;
    }
    {
        names[127] = "do_DBSCAN_doublezisegmap_44435zisegmap_tblock_sizze_44431";
        values[127] = *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_44421;
    }
    {
        names[128] = "do_DBSCAN_doublezisegmap_44411_dim1";
        values[128] = *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_44413;
    }
    {
        names[129] = "do_DBSCAN_doublezisegmap_44411zisegmap_tblock_sizze_44414";
        values[129] = *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_44413;
    }
    {
        names[130] = "do_DBSCAN_doublezisegmap_44403_dim1";
        values[130] = *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_44405;
    }
    {
        names[131] = "do_DBSCAN_doublezisegmap_44403zisegmap_tblock_sizze_44406";
        values[131] = *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_44405;
    }
    {
        names[132] = "do_DBSCAN_doublezisegscan_44401_dim1";
        values[132] = *ctx->tuning_params.do_DBSCAN_doublezisegscan_tblock_sizze_44395;
    }
    {
        names[133] = "do_DBSCAN_doublezisegscan_44401zisegscan_tblock_sizze_44396";
        values[133] = *ctx->tuning_params.do_DBSCAN_doublezisegscan_tblock_sizze_44395;
    }
    {
        names[134] = "do_DBSCAN_doublezisegscan_44401zichunk_sizze_50724";
        values[134] = smax64((int64_t) 1, smin64(squot64(squot64(ctx->max_shared_memory, ctx->max_thread_block_size), (int64_t) 8), squot64(squot64(ctx->max_registers, ctx->max_thread_block_size) - (int64_t) 1 - squot64(smax64((int64_t) 4, (int64_t) 8), (int64_t) 4), (int64_t) 2 * squot64(smax64((int64_t) 4, (int64_t) 8), (int64_t) 4))));
    }
    {
        names[135] = "do_DBSCAN_doublezisegmap_44387_dim1";
        values[135] = *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_44389;
    }
    {
        names[136] = "do_DBSCAN_doublezisegmap_44387zisegmap_tblock_sizze_44390";
        values[136] = *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_44389;
    }
    {
        names[137] = "do_DBSCAN_doublezisegscan_44385_dim1";
        values[137] = *ctx->tuning_params.do_DBSCAN_doublezisegscan_tblock_sizze_44379;
    }
    {
        names[138] = "do_DBSCAN_doublezisegscan_44385zisegscan_tblock_sizze_44380";
        values[138] = *ctx->tuning_params.do_DBSCAN_doublezisegscan_tblock_sizze_44379;
    }
    {
        names[139] = "do_DBSCAN_doublezisegscan_44385zichunk_sizze_50557";
        values[139] = smax64((int64_t) 1, smin64(squot64(squot64(ctx->max_shared_memory, ctx->max_thread_block_size), (int64_t) 8), squot64(squot64(ctx->max_registers, ctx->max_thread_block_size) - (int64_t) 1 - squot64(smax64((int64_t) 4, (int64_t) 8) + smax64((int64_t) 4, (int64_t) 8), (int64_t) 4), (int64_t) 2 * squot64(smax64((int64_t) 4, (int64_t) 8) + smax64((int64_t) 4, (int64_t) 8), (int64_t) 4))));
    }
    {
        names[140] = "do_DBSCAN_doublezisegmap_44371_dim1";
        values[140] = *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_44373;
    }
    {
        names[141] = "do_DBSCAN_doublezisegmap_44371zisegmap_tblock_sizze_44374";
        values[141] = *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_44373;
    }
    {
        names[142] = "do_DBSCAN_doublezisegscan_44369_dim1";
        values[142] = *ctx->tuning_params.do_DBSCAN_doublezisegscan_tblock_sizze_44363;
    }
    {
        names[143] = "do_DBSCAN_doublezisegscan_44369zisegscan_tblock_sizze_44364";
        values[143] = *ctx->tuning_params.do_DBSCAN_doublezisegscan_tblock_sizze_44363;
    }
    {
        names[144] = "do_DBSCAN_doublezisegscan_44369zichunk_sizze_50441";
        values[144] = smax64((int64_t) 1, smin64(squot64(squot64(ctx->max_shared_memory, ctx->max_thread_block_size), (int64_t) 8), squot64(squot64(ctx->max_registers, ctx->max_thread_block_size) - (int64_t) 1 - squot64(smax64((int64_t) 4, (int64_t) 8), (int64_t) 4), (int64_t) 2 * squot64(smax64((int64_t) 4, (int64_t) 8), (int64_t) 4))));
    }
    {
        names[145] = "do_DBSCAN_doublezigpuseq_50431_dim1";
        values[145] = (int64_t) 1;
    }
    {
        names[146] = "do_DBSCAN_doublezisegmap_44355_dim1";
        values[146] = *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_44357;
    }
    {
        names[147] = "do_DBSCAN_doublezisegmap_44355zisegmap_tblock_sizze_44358";
        values[147] = *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_44357;
    }
    {
        names[148] = "do_DBSCAN_doublezisegscan_44353_dim1";
        values[148] = *ctx->tuning_params.do_DBSCAN_doublezisegscan_tblock_sizze_44347;
    }
    {
        names[149] = "do_DBSCAN_doublezisegscan_44353zisegscan_tblock_sizze_44348";
        values[149] = *ctx->tuning_params.do_DBSCAN_doublezisegscan_tblock_sizze_44347;
    }
    {
        names[150] = "do_DBSCAN_doublezisegscan_44353zichunk_sizze_50237";
        values[150] = smax64((int64_t) 1, smin64(squot64(squot64(ctx->max_shared_memory, ctx->max_thread_block_size), (int64_t) 8), squot64(squot64(ctx->max_registers, ctx->max_thread_block_size) - (int64_t) 1 - squot64(smax64((int64_t) 4, (int64_t) 8), (int64_t) 4), (int64_t) 2 * squot64(smax64((int64_t) 4, (int64_t) 8), (int64_t) 4))));
    }
    {
        names[151] = "add_next_partition_doublezigpuseq_51204_dim1";
        values[151] = (int64_t) 1;
    }
    {
        names[152] = "add_next_partition_doublezisegmap_44323_dim1";
        values[152] = *ctx->tuning_params.add_next_partition_doublezisegmap_tblock_sizze_44289;
    }
    {
        names[153] = "add_next_partition_doublezisegmap_44323zisegmap_tblock_sizze_44317";
        values[153] = *ctx->tuning_params.add_next_partition_doublezisegmap_tblock_sizze_44289;
    }
    {
        names[154] = "add_next_partition_doublezisegmap_44255_dim1";
        values[154] = *ctx->tuning_params.add_next_partition_doublezisegmap_tblock_sizze_44212;
    }
    {
        names[155] = "add_next_partition_doublezisegmap_44255zisegmap_tblock_sizze_44248";
        values[155] = *ctx->tuning_params.add_next_partition_doublezisegmap_tblock_sizze_44212;
    }
    {
        names[156] = "add_next_partition_doublezisegmap_44202_dim1";
        values[156] = *ctx->tuning_params.add_next_partition_doublezisegmap_tblock_sizze_44204;
    }
    {
        names[157] = "add_next_partition_doublezisegmap_44202zisegmap_tblock_sizze_44205";
        values[157] = *ctx->tuning_params.add_next_partition_doublezisegmap_tblock_sizze_44204;
    }
    {
        names[158] = "add_next_partition_doublezisegmap_44136_dim1";
        values[158] = *ctx->tuning_params.add_next_partition_doublezisegmap_tblock_sizze_44086;
    }
    {
        names[159] = "add_next_partition_doublezisegmap_44136zisegmap_tblock_sizze_44132";
        values[159] = *ctx->tuning_params.add_next_partition_doublezisegmap_tblock_sizze_44086;
    }
    {
        names[160] = "add_next_partition_doublezisegred_large_44044_dim1";
        values[160] = *ctx->tuning_params.add_next_partition_doublezisegred_tblock_sizze_43989;
    }
    {
        names[161] = "add_next_partition_doublezisegred_large_44044zisegred_tblock_sizze_44038";
        values[161] = *ctx->tuning_params.add_next_partition_doublezisegred_tblock_sizze_43989;
    }
    {
        names[162] = "add_next_partition_doublezisegred_large_44044zichunk_sizze_51087";
        values[162] = (int64_t) 1;
    }
    {
        names[163] = "add_next_partition_doublezisegred_small_44044_dim1";
        values[163] = *ctx->tuning_params.add_next_partition_doublezisegred_tblock_sizze_43989;
    }
    {
        names[164] = "add_next_partition_doublezisegred_small_44044zisegred_tblock_sizze_44038";
        values[164] = *ctx->tuning_params.add_next_partition_doublezisegred_tblock_sizze_43989;
    }
    {
        names[165] = "add_next_partition_doublezisegmap_intrablock_46783_dim1";
        values[165] = *ctx->tuning_params.add_next_partition_doublezitile_sizze_46784;
    }
    {
        names[166] = "add_next_partition_doublezisegmap_intrablock_46783zitile_sizze_46785";
        values[166] = *ctx->tuning_params.add_next_partition_doublezitile_sizze_46784;
    }
    {
        names[167] = "add_next_partition_doublezisegmap_intrablock_46783zinum_whole_tiles_46806";
        values[167] = squot_safe64((int64_t) 8, *ctx->tuning_params.add_next_partition_doublezitile_sizze_46784);
    }
    {
        names[168] = "add_next_partition_doublezisegmap_intrablock_46783ziresidual_input_46981";
        values[168] = srem_safe64((int64_t) 8, *ctx->tuning_params.add_next_partition_doublezitile_sizze_46784);
    }
    {
        names[169] = "add_next_partition_doublezisegmap_intrablock_46783zicond_46982";
        values[169] = srem_safe64((int64_t) 8, *ctx->tuning_params.add_next_partition_doublezitile_sizze_46784) == (int64_t) 0;
    }
    {
        names[170] = "add_next_partition_doublezisegmap_intrablock_46783zibinop_x_46992";
        values[170] = *ctx->tuning_params.add_next_partition_doublezitile_sizze_46784 * squot_safe64((int64_t) 8, *ctx->tuning_params.add_next_partition_doublezitile_sizze_46784);
    }
    {
        names[171] = "add_next_partition_doublezisegmap_intrablock_46783zibytes_49547";
        values[171] = (int64_t) 8 * *ctx->tuning_params.add_next_partition_doublezitile_sizze_46784;
    }
    {
        names[172] = "add_next_partition_doublezisegmap_43887_dim1";
        values[172] = *ctx->tuning_params.add_next_partition_doublezisegmap_tblock_sizze_43889;
    }
    {
        names[173] = "add_next_partition_doublezisegmap_43887zisegmap_tblock_sizze_43890";
        values[173] = *ctx->tuning_params.add_next_partition_doublezisegmap_tblock_sizze_43889;
    }
    {
        names[174] = "add_next_partition_doublezisegscan_44200_dim1";
        values[174] = *ctx->tuning_params.add_next_partition_doublezisegscan_tblock_sizze_44194;
    }
    {
        names[175] = "add_next_partition_doublezisegscan_44200zisegscan_tblock_sizze_44195";
        values[175] = *ctx->tuning_params.add_next_partition_doublezisegscan_tblock_sizze_44194;
    }
    {
        names[176] = "add_next_partition_doublezisegscan_44200zichunk_sizze_50862";
        values[176] = smax64((int64_t) 1, smin64(squot64(squot64(ctx->max_shared_memory, ctx->max_thread_block_size), (int64_t) 8), squot64(squot64(ctx->max_registers, ctx->max_thread_block_size) - (int64_t) 1 - squot64(smax64((int64_t) 4, (int64_t) 8) + smax64((int64_t) 4, (int64_t) 8), (int64_t) 4), (int64_t) 2 * squot64(smax64((int64_t) 4, (int64_t) 8) + smax64((int64_t) 4, (int64_t) 8), (int64_t) 4))));
    }
    {
        names[177] = "add_next_partition_doublezisegscan_43878_dim1";
        values[177] = *ctx->tuning_params.add_next_partition_doublezisegscan_tblock_sizze_43631;
    }
    {
        names[178] = "add_next_partition_doublezisegscan_43878zisegscan_tblock_sizze_43873";
        values[178] = *ctx->tuning_params.add_next_partition_doublezisegscan_tblock_sizze_43631;
    }
    {
        names[179] = "add_next_partition_doublezisegscan_43878zichunk_sizze_50760";
        values[179] = smax64((int64_t) 1, smin64(squot64(squot64(ctx->max_shared_memory, ctx->max_thread_block_size), (int64_t) 8), squot64(squot64(ctx->max_registers, ctx->max_thread_block_size) - (int64_t) 1 - squot64(smax64((int64_t) 4, (int64_t) 8), (int64_t) 4), (int64_t) 2 * squot64(smax64((int64_t) 4, (int64_t) 8), (int64_t) 4))));
    }
    {
        names[180] = "add_next_partition_doublezisegmap_43826_dim1";
        values[180] = *ctx->tuning_params.add_next_partition_doublezisegmap_tblock_sizze_43450;
    }
    {
        names[181] = "add_next_partition_doublezisegmap_43826zisegmap_tblock_sizze_43821";
        values[181] = *ctx->tuning_params.add_next_partition_doublezisegmap_tblock_sizze_43450;
    }
    {
        names[182] = "add_next_partition_doublezisegred_large_43807_dim1";
        values[182] = *ctx->tuning_params.add_next_partition_doublezisegred_tblock_sizze_43502;
    }
    {
        names[183] = "add_next_partition_doublezisegred_large_43807zisegred_tblock_sizze_43801";
        values[183] = *ctx->tuning_params.add_next_partition_doublezisegred_tblock_sizze_43502;
    }
    {
        names[184] = "add_next_partition_doublezisegred_large_43807zichunk_sizze_50672";
        values[184] = (int64_t) 1;
    }
    {
        names[185] = "add_next_partition_doublezisegred_small_43807_dim1";
        values[185] = *ctx->tuning_params.add_next_partition_doublezisegred_tblock_sizze_43502;
    }
    {
        names[186] = "add_next_partition_doublezisegred_small_43807zisegred_tblock_sizze_43801";
        values[186] = *ctx->tuning_params.add_next_partition_doublezisegred_tblock_sizze_43502;
    }
    {
        names[187] = "add_next_partition_doublezisegmap_43790_dim1";
        values[187] = *ctx->tuning_params.add_next_partition_doublezisegmap_tblock_sizze_43527;
    }
    {
        names[188] = "add_next_partition_doublezisegmap_43790zisegmap_tblock_sizze_43784";
        values[188] = *ctx->tuning_params.add_next_partition_doublezisegmap_tblock_sizze_43527;
    }
    {
        names[189] = "add_next_partition_doublezisegmap_intrablock_46535_dim1";
        values[189] = *ctx->tuning_params.add_next_partition_doublezitile_sizze_46536;
    }
    {
        names[190] = "add_next_partition_doublezisegmap_intrablock_46535zitile_sizze_46537";
        values[190] = *ctx->tuning_params.add_next_partition_doublezitile_sizze_46536;
    }
    {
        names[191] = "add_next_partition_doublezisegmap_intrablock_46535zildim_46538";
        values[191] = sdiv_up_safe64((int64_t) 8, *ctx->tuning_params.add_next_partition_doublezitile_sizze_46536);
    }
    {
        names[192] = "add_next_partition_doublezisegmap_intrablock_46535zibytes_49493";
        values[192] = (int64_t) 8 * *ctx->tuning_params.add_next_partition_doublezitile_sizze_46536;
    }
    {
        names[193] = "add_next_partition_doublezisegmap_43129_dim1";
        values[193] = *ctx->tuning_params.add_next_partition_doublezisegmap_tblock_sizze_43112;
    }
    {
        names[194] = "add_next_partition_doublezisegmap_43129zisegmap_tblock_sizze_43125";
        values[194] = *ctx->tuning_params.add_next_partition_doublezisegmap_tblock_sizze_43112;
    }
    {
        names[195] = "add_next_partition_doublezigpuseq_50501_dim1";
        values[195] = (int64_t) 1;
    }
    {
        names[196] = "add_next_partition_doublezigpuseq_50494_dim1";
        values[196] = (int64_t) 1;
    }
    {
        names[197] = "add_next_partition_doublezigpuseq_50488_dim1";
        values[197] = (int64_t) 1;
    }
    {
        names[198] = "add_next_partition_doublezigpuseq_50482_dim1";
        values[198] = (int64_t) 1;
    }
    {
        names[199] = "add_next_partition_doublezigpuseq_50476_dim1";
        values[199] = (int64_t) 1;
    }
    {
        names[200] = "add_next_partition_doublezigpuseq_50470_dim1";
        values[200] = (int64_t) 1;
    }
    {
        names[201] = "add_next_partition_doublezigpuseq_50444_dim1";
        values[201] = (int64_t) 1;
    }
    {
        names[202] = "add_next_partition_doublezisegmap_44186_dim1";
        values[202] = *ctx->tuning_params.add_next_partition_doublezisegmap_tblock_sizze_44188;
    }
    {
        names[203] = "add_next_partition_doublezisegmap_44186zisegmap_tblock_sizze_44189";
        values[203] = *ctx->tuning_params.add_next_partition_doublezisegmap_tblock_sizze_44188;
    }
    {
        names[204] = "add_next_partition_doublezisegscan_44184_dim1";
        values[204] = *ctx->tuning_params.add_next_partition_doublezisegscan_tblock_sizze_44178;
    }
    {
        names[205] = "add_next_partition_doublezisegscan_44184zisegscan_tblock_sizze_44179";
        values[205] = *ctx->tuning_params.add_next_partition_doublezisegscan_tblock_sizze_44178;
    }
    {
        names[206] = "add_next_partition_doublezisegscan_44184zichunk_sizze_50242";
        values[206] = smax64((int64_t) 1, smin64(squot64(squot64(ctx->max_shared_memory, ctx->max_thread_block_size), (int64_t) 8), squot64(squot64(ctx->max_registers, ctx->max_thread_block_size) - (int64_t) 1 - squot64(smax64((int64_t) 4, (int64_t) 8) + smax64((int64_t) 4, (int64_t) 8), (int64_t) 4), (int64_t) 2 * squot64(smax64((int64_t) 4, (int64_t) 8) + smax64((int64_t) 4, (int64_t) 8), (int64_t) 4))));
    }
    *names_out = names;
    *values_out = values;
    return num_macros;
}
static char *get_failure_msg(int failure_idx, int64_t args[])
{
    (void) args;
    switch (failure_idx) {
        
      case 0:
        {
            return msgprintf("division by zero\n-> #0  ft_libs/ftDBSCAN_plus.fut:254:43-67\n   #1  ft_libs/ftDBSCAN_plus.fut:850:18-855:84\n   #2  ft_libs/ftDBSCAN_plus.fut:849:9-855:84\n");
            break;
        }
        
      case 1:
        {
            return msgprintf("division by zero\n-> #0  ft_libs/ftDBSCAN_plus.fut:405:87-111\n   #1  /prelude/functional.fut:9:44-45\n   #2  ft_libs/ftDBSCAN_plus.fut:850:18-855:84\n   #3  ft_libs/ftDBSCAN_plus.fut:849:9-855:84\n");
            break;
        }
        
      case 2:
        {
            return msgprintf("Index [%lld] out of bounds for array of shape [%lld].\n-> #0  ft_libs/ftDBSCAN_plus.fut:282:76-99\n   #1  /prelude/functional.fut:9:44-45\n   #2  ft_libs/ftDBSCAN_plus.fut:282:56-101\n   #3  ft_libs/ftDBSCAN_plus.fut:850:18-855:84\n   #4  ft_libs/ftDBSCAN_plus.fut:849:9-855:84\n", args[0], args[1]);
            break;
        }
        
      case 3:
        {
            return msgprintf("Index [%lld] out of bounds for array of shape [%lld].\n-> #0  ft_libs/ftDBSCAN_plus.fut:314:50-67\n   #1  /prelude/functional.fut:9:44-45\n   #2  ft_libs/ftDBSCAN_plus.fut:314:36-85\n   #3  ft_libs/ftDBSCAN_plus.fut:850:18-855:84\n   #4  ft_libs/ftDBSCAN_plus.fut:849:9-855:84\n", args[0], args[1]);
            break;
        }
        
      case 4:
        {
            return msgprintf("division by zero\n-> #0  ft_libs/ftDBSCAN_plus.fut:318:56-80\n   #1  /prelude/functional.fut:9:44-45\n   #2  ft_libs/ftDBSCAN_plus.fut:850:18-855:84\n   #3  ft_libs/ftDBSCAN_plus.fut:849:9-855:84\n");
            break;
        }
        
      case 5:
        {
            return msgprintf("Index [%lld] out of bounds for array of shape [%lld].\n-> #0  ft_libs/ftDBSCAN_plus.fut:314:50-67\n   #1  /prelude/functional.fut:9:44-45\n   #2  ft_libs/ftDBSCAN_plus.fut:314:36-85\n   #3  ft_libs/ftDBSCAN_plus.fut:850:18-855:84\n   #4  ft_libs/ftDBSCAN_plus.fut:849:9-855:84\n", args[0], args[1]);
            break;
        }
        
      case 6:
        {
            return msgprintf("division by zero\n-> #0  ft_libs/ftDBSCAN_plus.fut:318:56-80\n   #1  /prelude/functional.fut:9:44-45\n   #2  ft_libs/ftDBSCAN_plus.fut:850:18-855:84\n   #3  ft_libs/ftDBSCAN_plus.fut:849:9-855:84\n");
            break;
        }
        
      case 7:
        {
            return msgprintf("Index [%lld] out of bounds for array of shape [%lld].\n-> #0  ft_libs/ftDBSCAN_plus.fut:314:50-67\n   #1  /prelude/functional.fut:9:44-45\n   #2  ft_libs/ftDBSCAN_plus.fut:314:36-85\n   #3  ft_libs/ftDBSCAN_plus.fut:850:18-855:84\n   #4  ft_libs/ftDBSCAN_plus.fut:849:9-855:84\n", args[0], args[1]);
            break;
        }
        
      case 8:
        {
            return msgprintf("division by zero\n-> #0  ft_libs/ftDBSCAN_plus.fut:318:56-80\n   #1  /prelude/functional.fut:9:44-45\n   #2  ft_libs/ftDBSCAN_plus.fut:850:18-855:84\n   #3  ft_libs/ftDBSCAN_plus.fut:849:9-855:84\n");
            break;
        }
        
      case 9:
        {
            return msgprintf("Index [%lld] out of bounds for array of shape [%lld].\n-> #0  ft_libs/ftDBSCAN_plus.fut:404:79-110\n   #1  /prelude/functional.fut:9:44-45\n   #2  ft_libs/ftDBSCAN_plus.fut:850:18-855:84\n   #3  ft_libs/ftDBSCAN_plus.fut:849:9-855:84\n", args[0], args[1]);
            break;
        }
        
      case 10:
        {
            return msgprintf("division by zero\n-> #0  ft_libs/ftDBSCAN_plus.fut:340:56-80\n   #1  /prelude/soacs.fut:205:28-30\n   #2  /prelude/functional.fut:9:44-45\n   #3  ft_libs/ftDBSCAN_plus.fut:338:43-350:34\n   #4  /prelude/functional.fut:9:44-45\n   #5  ft_libs/ftDBSCAN_plus.fut:850:18-855:84\n   #6  ft_libs/ftDBSCAN_plus.fut:849:9-855:84\n");
            break;
        }
        
      case 11:
        {
            return msgprintf("division by zero\n-> #0  ft_libs/ftDBSCAN_plus.fut:340:56-80\n   #1  /prelude/soacs.fut:205:28-30\n   #2  /prelude/functional.fut:9:44-45\n   #3  ft_libs/ftDBSCAN_plus.fut:338:43-350:34\n   #4  /prelude/functional.fut:9:44-45\n   #5  ft_libs/ftDBSCAN_plus.fut:850:18-855:84\n   #6  ft_libs/ftDBSCAN_plus.fut:849:9-855:84\n");
            break;
        }
        
      case 12:
        {
            return msgprintf("division by zero\n-> #0  ft_libs/ftDBSCAN_plus.fut:340:56-80\n   #1  /prelude/soacs.fut:205:28-30\n   #2  /prelude/functional.fut:9:44-45\n   #3  ft_libs/ftDBSCAN_plus.fut:338:43-350:34\n   #4  /prelude/functional.fut:9:44-45\n   #5  ft_libs/ftDBSCAN_plus.fut:850:18-855:84\n   #6  ft_libs/ftDBSCAN_plus.fut:849:9-855:84\n");
            break;
        }
        
      case 13:
        {
            return msgprintf("division by zero\n-> #0  ft_libs/ftDBSCAN_plus.fut:340:56-80\n   #1  /prelude/soacs.fut:205:28-30\n   #2  /prelude/functional.fut:9:44-45\n   #3  ft_libs/ftDBSCAN_plus.fut:338:43-350:34\n   #4  /prelude/functional.fut:9:44-45\n   #5  ft_libs/ftDBSCAN_plus.fut:850:18-855:84\n   #6  ft_libs/ftDBSCAN_plus.fut:849:9-855:84\n");
            break;
        }
        
      case 14:
        {
            return msgprintf("division by zero\n-> #0  ft_libs/ftDBSCAN_plus.fut:357:64-88\n   #1  /prelude/soacs.fut:205:28-30\n   #2  /prelude/functional.fut:9:44-45\n   #3  ft_libs/ftDBSCAN_plus.fut:355:52-367:42\n   #4  /prelude/functional.fut:9:44-45\n   #5  ft_libs/ftDBSCAN_plus.fut:850:18-855:84\n   #6  ft_libs/ftDBSCAN_plus.fut:849:9-855:84\n");
            break;
        }
        
      case 15:
        {
            return msgprintf("Index [%lld] out of bounds for array of shape [%lld].\n-> #0  ft_libs/ftDBSCAN_plus.fut:424:60-72\n   #1  /prelude/functional.fut:9:44-45\n   #2  ft_libs/ftDBSCAN_plus.fut:424:44-102\n   #3  ft_libs/ftDBSCAN_plus.fut:850:18-855:84\n   #4  ft_libs/ftDBSCAN_plus.fut:849:9-855:84\n", args[0], args[1]);
            break;
        }
        
      case 16:
        {
            return msgprintf("Index [%lld] out of bounds for array of shape [%lld].\n-> #0  ft_libs/ftDBSCAN_plus.fut:424:74-86\n   #1  /prelude/functional.fut:9:44-45\n   #2  ft_libs/ftDBSCAN_plus.fut:424:44-102\n   #3  ft_libs/ftDBSCAN_plus.fut:850:18-855:84\n   #4  ft_libs/ftDBSCAN_plus.fut:849:9-855:84\n", args[0], args[1]);
            break;
        }
        
      case 17:
        {
            return msgprintf("Index [%lld] out of bounds for array of shape [%lld].\n-> #0  ft_libs/ftDBSCAN_plus.fut:424:88-100\n   #1  /prelude/functional.fut:9:44-45\n   #2  ft_libs/ftDBSCAN_plus.fut:424:44-102\n   #3  ft_libs/ftDBSCAN_plus.fut:850:18-855:84\n   #4  ft_libs/ftDBSCAN_plus.fut:849:9-855:84\n", args[0], args[1]);
            break;
        }
        
      case 18:
        {
            return msgprintf("Index [%lld] out of bounds for array of shape [%lld].\n-> #0  ft_libs/ftDBSCAN_plus.fut:428:60-72\n   #1  /prelude/functional.fut:9:44-45\n   #2  ft_libs/ftDBSCAN_plus.fut:428:44-88\n   #3  ft_libs/ftDBSCAN_plus.fut:850:18-855:84\n   #4  ft_libs/ftDBSCAN_plus.fut:849:9-855:84\n", args[0], args[1]);
            break;
        }
        
      case 19:
        {
            return msgprintf("Index [%lld] out of bounds for array of shape [%lld].\n-> #0  ft_libs/ftDBSCAN_plus.fut:428:74-86\n   #1  /prelude/functional.fut:9:44-45\n   #2  ft_libs/ftDBSCAN_plus.fut:428:44-88\n   #3  ft_libs/ftDBSCAN_plus.fut:850:18-855:84\n   #4  ft_libs/ftDBSCAN_plus.fut:849:9-855:84\n", args[0], args[1]);
            break;
        }
        
      case 20:
        {
            return msgprintf("Index [%lld] out of bounds for array of shape [%lld].\n-> #0  ft_libs/ftDBSCAN_plus.fut:657:103-125\n   #1  /prelude/functional.fut:9:44-45\n   #2  ft_libs/ftDBSCAN_plus.fut:657:44-130\n   #3  ft_libs/ftDBSCAN_plus.fut:863:18-866:67\n   #4  ft_libs/ftDBSCAN_plus.fut:862:9-866:67\n", args[0], args[1]);
            break;
        }
        
      case 21:
        {
            return msgprintf("Index [%lld] out of bounds for array of shape [%lld].\n-> #0  ft_libs/ftbasics.fut:35:14-19\n   #1  /prelude/functional.fut:9:44-45\n   #2  ft_libs/ftbasics.fut:33:10-37:8\n   #3  ft_libs/ftDBSCAN_plus.fut:863:18-866:67\n   #4  ft_libs/ftDBSCAN_plus.fut:862:9-866:67\n", args[0], args[1]);
            break;
        }
        
      case 22:
        {
            return msgprintf("Index [%lld] out of bounds for array of shape [%lld].\n-> #0  ft_libs/ftDBSCAN_plus.fut:777:66-71\n   #1  /prelude/functional.fut:9:44-45\n   #2  ft_libs/ftDBSCAN_plus.fut:869:18-871:58\n   #3  ft_libs/ftDBSCAN_plus.fut:868:9-871:68\n", args[0], args[1]);
            break;
        }
        
      case 23:
        {
            return msgprintf("Index [%lld] out of bounds for array of shape [%lld].\n-> #0  ft_libs/ftDBSCAN_plus.fut:777:66-71\n   #1  /prelude/functional.fut:9:44-45\n   #2  ft_libs/ftDBSCAN_plus.fut:869:18-871:58\n   #3  ft_libs/ftDBSCAN_plus.fut:868:9-871:68\n", args[0], args[1]);
            break;
        }
    }
    return strdup("Unknown error.  This is a compiler bug.");
}
struct program {
    int dummy;
    gpu_kernel add_next_partition_doublezigpuseq_50444;
    gpu_kernel add_next_partition_doublezigpuseq_50470;
    gpu_kernel add_next_partition_doublezigpuseq_50476;
    gpu_kernel add_next_partition_doublezigpuseq_50482;
    gpu_kernel add_next_partition_doublezigpuseq_50488;
    gpu_kernel add_next_partition_doublezigpuseq_50494;
    gpu_kernel add_next_partition_doublezigpuseq_50501;
    gpu_kernel add_next_partition_doublezigpuseq_51204;
    gpu_kernel add_next_partition_doublezisegmap_43129;
    gpu_kernel add_next_partition_doublezisegmap_43790;
    gpu_kernel add_next_partition_doublezisegmap_43826;
    gpu_kernel add_next_partition_doublezisegmap_43887;
    gpu_kernel add_next_partition_doublezisegmap_44136;
    gpu_kernel add_next_partition_doublezisegmap_44186;
    gpu_kernel add_next_partition_doublezisegmap_44202;
    gpu_kernel add_next_partition_doublezisegmap_44255;
    gpu_kernel add_next_partition_doublezisegmap_44323;
    gpu_kernel add_next_partition_doublezisegmap_intrablock_43720;
    gpu_kernel add_next_partition_doublezisegmap_intrablock_46535;
    gpu_kernel add_next_partition_doublezisegmap_intrablock_46783;
    gpu_kernel add_next_partition_doublezisegred_large_43807;
    gpu_kernel add_next_partition_doublezisegred_large_44044;
    gpu_kernel add_next_partition_doublezisegred_small_43807;
    gpu_kernel add_next_partition_doublezisegred_small_44044;
    gpu_kernel add_next_partition_doublezisegscan_43878;
    gpu_kernel add_next_partition_doublezisegscan_44184;
    gpu_kernel add_next_partition_doublezisegscan_44200;
    gpu_kernel builtinzhiota_i64ziiota_i64_50380;
    gpu_kernel builtinzhreplicate_boolzireplicate_51021;
    gpu_kernel builtinzhreplicate_f64zireplicate_50455;
    gpu_kernel builtinzhreplicate_i32zireplicate_50282;
    gpu_kernel builtinzhreplicate_i64zireplicate_50197;
    gpu_kernel builtinzhreplicate_i8zireplicate_50247;
    gpu_kernel do_DBSCAN_doublezigpuseq_50431;
    gpu_kernel do_DBSCAN_doublezisegmap_44355;
    gpu_kernel do_DBSCAN_doublezisegmap_44371;
    gpu_kernel do_DBSCAN_doublezisegmap_44387;
    gpu_kernel do_DBSCAN_doublezisegmap_44403;
    gpu_kernel do_DBSCAN_doublezisegmap_44411;
    gpu_kernel do_DBSCAN_doublezisegmap_44435;
    gpu_kernel do_DBSCAN_doublezisegmap_44449;
    gpu_kernel do_DBSCAN_doublezisegmap_44647;
    gpu_kernel do_DBSCAN_doublezisegmap_44743;
    gpu_kernel do_DBSCAN_doublezisegmap_44774;
    gpu_kernel do_DBSCAN_doublezisegmap_44801;
    gpu_kernel do_DBSCAN_doublezisegmap_44805;
    gpu_kernel do_DBSCAN_doublezisegmap_45218;
    gpu_kernel do_DBSCAN_doublezisegmap_45376;
    gpu_kernel do_DBSCAN_doublezisegmap_45596;
    gpu_kernel do_DBSCAN_doublezisegmap_45663;
    gpu_kernel do_DBSCAN_doublezisegmap_45679;
    gpu_kernel do_DBSCAN_doublezisegmap_45890;
    gpu_kernel do_DBSCAN_doublezisegmap_intrablock_46535;
    gpu_kernel do_DBSCAN_doublezisegmap_intrablock_46915;
    gpu_kernel do_DBSCAN_doublezisegmap_intrablock_47270;
    gpu_kernel do_DBSCAN_doublezisegmap_intrablock_47625;
    gpu_kernel do_DBSCAN_doublezisegmap_intrablock_47884;
    gpu_kernel do_DBSCAN_doublezisegmap_intrablock_48143;
    gpu_kernel do_DBSCAN_doublezisegmap_intrablock_48552;
    gpu_kernel do_DBSCAN_doublezisegred_large_44665;
    gpu_kernel do_DBSCAN_doublezisegred_large_45615;
    gpu_kernel do_DBSCAN_doublezisegred_large_45909;
    gpu_kernel do_DBSCAN_doublezisegred_nonseg_44715;
    gpu_kernel do_DBSCAN_doublezisegred_small_44665;
    gpu_kernel do_DBSCAN_doublezisegred_small_45615;
    gpu_kernel do_DBSCAN_doublezisegred_small_45909;
    gpu_kernel do_DBSCAN_doublezisegscan_44353;
    gpu_kernel do_DBSCAN_doublezisegscan_44369;
    gpu_kernel do_DBSCAN_doublezisegscan_44385;
    gpu_kernel do_DBSCAN_doublezisegscan_44401;
    gpu_kernel do_DBSCAN_doublezisegscan_44447;
    gpu_kernel do_DBSCAN_doublezisegscan_44463;
    gpu_kernel do_DBSCAN_doublezisegscan_44723;
    gpu_kernel do_DBSCAN_doublezisegscan_45210;
    gpu_kernel do_DBSCAN_doublezisegscan_45677;
    gpu_kernel get_num_neighbours_against_9632zisegmap_46133;
    gpu_kernel get_num_neighbours_against_9632zisegmap_intrablock_46535;
    gpu_kernel get_num_neighbours_against_9632zisegred_large_46151;
    gpu_kernel get_num_neighbours_against_9632zisegred_small_46151;
    gpu_kernel get_num_neighbours_against_9635zisegmap_46367;
    gpu_kernel get_num_neighbours_against_9635zisegmap_intrablock_46535;
    gpu_kernel get_num_neighbours_against_9635zisegred_large_46385;
    gpu_kernel get_num_neighbours_against_9635zisegred_small_46385;
    gpu_kernel make_collisions_compact_doublezisegmap_42997;
    gpu_kernel make_collisions_compact_doublezisegmap_intrablock_46535;
    gpu_kernel make_collisions_compact_doublezisegmap_intrablock_46804;
    gpu_kernel make_collisions_compact_doublezisegscan_42995;
    gpu_kernel mk_dbcHandler_doublezigpuseq_50292;
    gpu_kernel next_partition_to_read_doublezigpuseq_50194;
    gpu_kernel next_partition_to_read_doublezigpuseq_50407;
    gpu_kernel next_partition_to_read_doublezisegmap_42834;
    gpu_kernel next_partition_to_read_doublezisegred_nonseg_42824;
    gpu_kernel next_partition_to_read_doublezisegscan_42832;
    gpu_kernel rectify_partition_ids_doublezisegmap_intrablock_46535;
    gpu_kernel rectify_partition_ids_doublezisegmap_intrablock_46779;
};
static void setup_program(struct futhark_context *ctx)
{
    (void) ctx;
    
    int error = 0;
    
    (void) error;
    ctx->program = malloc(sizeof(struct program));
    gpu_create_kernel(ctx, &ctx->program->add_next_partition_doublezigpuseq_50444, "add_next_partition_doublezigpuseq_50444");
    gpu_create_kernel(ctx, &ctx->program->add_next_partition_doublezigpuseq_50470, "add_next_partition_doublezigpuseq_50470");
    gpu_create_kernel(ctx, &ctx->program->add_next_partition_doublezigpuseq_50476, "add_next_partition_doublezigpuseq_50476");
    gpu_create_kernel(ctx, &ctx->program->add_next_partition_doublezigpuseq_50482, "add_next_partition_doublezigpuseq_50482");
    gpu_create_kernel(ctx, &ctx->program->add_next_partition_doublezigpuseq_50488, "add_next_partition_doublezigpuseq_50488");
    gpu_create_kernel(ctx, &ctx->program->add_next_partition_doublezigpuseq_50494, "add_next_partition_doublezigpuseq_50494");
    gpu_create_kernel(ctx, &ctx->program->add_next_partition_doublezigpuseq_50501, "add_next_partition_doublezigpuseq_50501");
    gpu_create_kernel(ctx, &ctx->program->add_next_partition_doublezigpuseq_51204, "add_next_partition_doublezigpuseq_51204");
    gpu_create_kernel(ctx, &ctx->program->add_next_partition_doublezisegmap_43129, "add_next_partition_doublezisegmap_43129");
    gpu_create_kernel(ctx, &ctx->program->add_next_partition_doublezisegmap_43790, "add_next_partition_doublezisegmap_43790");
    gpu_create_kernel(ctx, &ctx->program->add_next_partition_doublezisegmap_43826, "add_next_partition_doublezisegmap_43826");
    gpu_create_kernel(ctx, &ctx->program->add_next_partition_doublezisegmap_43887, "add_next_partition_doublezisegmap_43887");
    gpu_create_kernel(ctx, &ctx->program->add_next_partition_doublezisegmap_44136, "add_next_partition_doublezisegmap_44136");
    gpu_create_kernel(ctx, &ctx->program->add_next_partition_doublezisegmap_44186, "add_next_partition_doublezisegmap_44186");
    gpu_create_kernel(ctx, &ctx->program->add_next_partition_doublezisegmap_44202, "add_next_partition_doublezisegmap_44202");
    gpu_create_kernel(ctx, &ctx->program->add_next_partition_doublezisegmap_44255, "add_next_partition_doublezisegmap_44255");
    gpu_create_kernel(ctx, &ctx->program->add_next_partition_doublezisegmap_44323, "add_next_partition_doublezisegmap_44323");
    gpu_create_kernel(ctx, &ctx->program->add_next_partition_doublezisegmap_intrablock_43720, "add_next_partition_doublezisegmap_intrablock_43720");
    gpu_create_kernel(ctx, &ctx->program->add_next_partition_doublezisegmap_intrablock_46535, "add_next_partition_doublezisegmap_intrablock_46535");
    gpu_create_kernel(ctx, &ctx->program->add_next_partition_doublezisegmap_intrablock_46783, "add_next_partition_doublezisegmap_intrablock_46783");
    gpu_create_kernel(ctx, &ctx->program->add_next_partition_doublezisegred_large_43807, "add_next_partition_doublezisegred_large_43807");
    gpu_create_kernel(ctx, &ctx->program->add_next_partition_doublezisegred_large_44044, "add_next_partition_doublezisegred_large_44044");
    gpu_create_kernel(ctx, &ctx->program->add_next_partition_doublezisegred_small_43807, "add_next_partition_doublezisegred_small_43807");
    gpu_create_kernel(ctx, &ctx->program->add_next_partition_doublezisegred_small_44044, "add_next_partition_doublezisegred_small_44044");
    gpu_create_kernel(ctx, &ctx->program->add_next_partition_doublezisegscan_43878, "add_next_partition_doublezisegscan_43878");
    gpu_create_kernel(ctx, &ctx->program->add_next_partition_doublezisegscan_44184, "add_next_partition_doublezisegscan_44184");
    gpu_create_kernel(ctx, &ctx->program->add_next_partition_doublezisegscan_44200, "add_next_partition_doublezisegscan_44200");
    gpu_create_kernel(ctx, &ctx->program->builtinzhiota_i64ziiota_i64_50380, "builtinzhiota_i64ziiota_i64_50380");
    gpu_create_kernel(ctx, &ctx->program->builtinzhreplicate_boolzireplicate_51021, "builtinzhreplicate_boolzireplicate_51021");
    gpu_create_kernel(ctx, &ctx->program->builtinzhreplicate_f64zireplicate_50455, "builtinzhreplicate_f64zireplicate_50455");
    gpu_create_kernel(ctx, &ctx->program->builtinzhreplicate_i32zireplicate_50282, "builtinzhreplicate_i32zireplicate_50282");
    gpu_create_kernel(ctx, &ctx->program->builtinzhreplicate_i64zireplicate_50197, "builtinzhreplicate_i64zireplicate_50197");
    gpu_create_kernel(ctx, &ctx->program->builtinzhreplicate_i8zireplicate_50247, "builtinzhreplicate_i8zireplicate_50247");
    gpu_create_kernel(ctx, &ctx->program->do_DBSCAN_doublezigpuseq_50431, "do_DBSCAN_doublezigpuseq_50431");
    gpu_create_kernel(ctx, &ctx->program->do_DBSCAN_doublezisegmap_44355, "do_DBSCAN_doublezisegmap_44355");
    gpu_create_kernel(ctx, &ctx->program->do_DBSCAN_doublezisegmap_44371, "do_DBSCAN_doublezisegmap_44371");
    gpu_create_kernel(ctx, &ctx->program->do_DBSCAN_doublezisegmap_44387, "do_DBSCAN_doublezisegmap_44387");
    gpu_create_kernel(ctx, &ctx->program->do_DBSCAN_doublezisegmap_44403, "do_DBSCAN_doublezisegmap_44403");
    gpu_create_kernel(ctx, &ctx->program->do_DBSCAN_doublezisegmap_44411, "do_DBSCAN_doublezisegmap_44411");
    gpu_create_kernel(ctx, &ctx->program->do_DBSCAN_doublezisegmap_44435, "do_DBSCAN_doublezisegmap_44435");
    gpu_create_kernel(ctx, &ctx->program->do_DBSCAN_doublezisegmap_44449, "do_DBSCAN_doublezisegmap_44449");
    gpu_create_kernel(ctx, &ctx->program->do_DBSCAN_doublezisegmap_44647, "do_DBSCAN_doublezisegmap_44647");
    gpu_create_kernel(ctx, &ctx->program->do_DBSCAN_doublezisegmap_44743, "do_DBSCAN_doublezisegmap_44743");
    gpu_create_kernel(ctx, &ctx->program->do_DBSCAN_doublezisegmap_44774, "do_DBSCAN_doublezisegmap_44774");
    gpu_create_kernel(ctx, &ctx->program->do_DBSCAN_doublezisegmap_44801, "do_DBSCAN_doublezisegmap_44801");
    gpu_create_kernel(ctx, &ctx->program->do_DBSCAN_doublezisegmap_44805, "do_DBSCAN_doublezisegmap_44805");
    gpu_create_kernel(ctx, &ctx->program->do_DBSCAN_doublezisegmap_45218, "do_DBSCAN_doublezisegmap_45218");
    gpu_create_kernel(ctx, &ctx->program->do_DBSCAN_doublezisegmap_45376, "do_DBSCAN_doublezisegmap_45376");
    gpu_create_kernel(ctx, &ctx->program->do_DBSCAN_doublezisegmap_45596, "do_DBSCAN_doublezisegmap_45596");
    gpu_create_kernel(ctx, &ctx->program->do_DBSCAN_doublezisegmap_45663, "do_DBSCAN_doublezisegmap_45663");
    gpu_create_kernel(ctx, &ctx->program->do_DBSCAN_doublezisegmap_45679, "do_DBSCAN_doublezisegmap_45679");
    gpu_create_kernel(ctx, &ctx->program->do_DBSCAN_doublezisegmap_45890, "do_DBSCAN_doublezisegmap_45890");
    gpu_create_kernel(ctx, &ctx->program->do_DBSCAN_doublezisegmap_intrablock_46535, "do_DBSCAN_doublezisegmap_intrablock_46535");
    gpu_create_kernel(ctx, &ctx->program->do_DBSCAN_doublezisegmap_intrablock_46915, "do_DBSCAN_doublezisegmap_intrablock_46915");
    gpu_create_kernel(ctx, &ctx->program->do_DBSCAN_doublezisegmap_intrablock_47270, "do_DBSCAN_doublezisegmap_intrablock_47270");
    gpu_create_kernel(ctx, &ctx->program->do_DBSCAN_doublezisegmap_intrablock_47625, "do_DBSCAN_doublezisegmap_intrablock_47625");
    gpu_create_kernel(ctx, &ctx->program->do_DBSCAN_doublezisegmap_intrablock_47884, "do_DBSCAN_doublezisegmap_intrablock_47884");
    gpu_create_kernel(ctx, &ctx->program->do_DBSCAN_doublezisegmap_intrablock_48143, "do_DBSCAN_doublezisegmap_intrablock_48143");
    gpu_create_kernel(ctx, &ctx->program->do_DBSCAN_doublezisegmap_intrablock_48552, "do_DBSCAN_doublezisegmap_intrablock_48552");
    gpu_create_kernel(ctx, &ctx->program->do_DBSCAN_doublezisegred_large_44665, "do_DBSCAN_doublezisegred_large_44665");
    gpu_create_kernel(ctx, &ctx->program->do_DBSCAN_doublezisegred_large_45615, "do_DBSCAN_doublezisegred_large_45615");
    gpu_create_kernel(ctx, &ctx->program->do_DBSCAN_doublezisegred_large_45909, "do_DBSCAN_doublezisegred_large_45909");
    gpu_create_kernel(ctx, &ctx->program->do_DBSCAN_doublezisegred_nonseg_44715, "do_DBSCAN_doublezisegred_nonseg_44715");
    gpu_create_kernel(ctx, &ctx->program->do_DBSCAN_doublezisegred_small_44665, "do_DBSCAN_doublezisegred_small_44665");
    gpu_create_kernel(ctx, &ctx->program->do_DBSCAN_doublezisegred_small_45615, "do_DBSCAN_doublezisegred_small_45615");
    gpu_create_kernel(ctx, &ctx->program->do_DBSCAN_doublezisegred_small_45909, "do_DBSCAN_doublezisegred_small_45909");
    gpu_create_kernel(ctx, &ctx->program->do_DBSCAN_doublezisegscan_44353, "do_DBSCAN_doublezisegscan_44353");
    gpu_create_kernel(ctx, &ctx->program->do_DBSCAN_doublezisegscan_44369, "do_DBSCAN_doublezisegscan_44369");
    gpu_create_kernel(ctx, &ctx->program->do_DBSCAN_doublezisegscan_44385, "do_DBSCAN_doublezisegscan_44385");
    gpu_create_kernel(ctx, &ctx->program->do_DBSCAN_doublezisegscan_44401, "do_DBSCAN_doublezisegscan_44401");
    gpu_create_kernel(ctx, &ctx->program->do_DBSCAN_doublezisegscan_44447, "do_DBSCAN_doublezisegscan_44447");
    gpu_create_kernel(ctx, &ctx->program->do_DBSCAN_doublezisegscan_44463, "do_DBSCAN_doublezisegscan_44463");
    gpu_create_kernel(ctx, &ctx->program->do_DBSCAN_doublezisegscan_44723, "do_DBSCAN_doublezisegscan_44723");
    gpu_create_kernel(ctx, &ctx->program->do_DBSCAN_doublezisegscan_45210, "do_DBSCAN_doublezisegscan_45210");
    gpu_create_kernel(ctx, &ctx->program->do_DBSCAN_doublezisegscan_45677, "do_DBSCAN_doublezisegscan_45677");
    gpu_create_kernel(ctx, &ctx->program->get_num_neighbours_against_9632zisegmap_46133, "get_num_neighbours_against_9632zisegmap_46133");
    gpu_create_kernel(ctx, &ctx->program->get_num_neighbours_against_9632zisegmap_intrablock_46535, "get_num_neighbours_against_9632zisegmap_intrablock_46535");
    gpu_create_kernel(ctx, &ctx->program->get_num_neighbours_against_9632zisegred_large_46151, "get_num_neighbours_against_9632zisegred_large_46151");
    gpu_create_kernel(ctx, &ctx->program->get_num_neighbours_against_9632zisegred_small_46151, "get_num_neighbours_against_9632zisegred_small_46151");
    gpu_create_kernel(ctx, &ctx->program->get_num_neighbours_against_9635zisegmap_46367, "get_num_neighbours_against_9635zisegmap_46367");
    gpu_create_kernel(ctx, &ctx->program->get_num_neighbours_against_9635zisegmap_intrablock_46535, "get_num_neighbours_against_9635zisegmap_intrablock_46535");
    gpu_create_kernel(ctx, &ctx->program->get_num_neighbours_against_9635zisegred_large_46385, "get_num_neighbours_against_9635zisegred_large_46385");
    gpu_create_kernel(ctx, &ctx->program->get_num_neighbours_against_9635zisegred_small_46385, "get_num_neighbours_against_9635zisegred_small_46385");
    gpu_create_kernel(ctx, &ctx->program->make_collisions_compact_doublezisegmap_42997, "make_collisions_compact_doublezisegmap_42997");
    gpu_create_kernel(ctx, &ctx->program->make_collisions_compact_doublezisegmap_intrablock_46535, "make_collisions_compact_doublezisegmap_intrablock_46535");
    gpu_create_kernel(ctx, &ctx->program->make_collisions_compact_doublezisegmap_intrablock_46804, "make_collisions_compact_doublezisegmap_intrablock_46804");
    gpu_create_kernel(ctx, &ctx->program->make_collisions_compact_doublezisegscan_42995, "make_collisions_compact_doublezisegscan_42995");
    gpu_create_kernel(ctx, &ctx->program->mk_dbcHandler_doublezigpuseq_50292, "mk_dbcHandler_doublezigpuseq_50292");
    gpu_create_kernel(ctx, &ctx->program->next_partition_to_read_doublezigpuseq_50194, "next_partition_to_read_doublezigpuseq_50194");
    gpu_create_kernel(ctx, &ctx->program->next_partition_to_read_doublezigpuseq_50407, "next_partition_to_read_doublezigpuseq_50407");
    gpu_create_kernel(ctx, &ctx->program->next_partition_to_read_doublezisegmap_42834, "next_partition_to_read_doublezisegmap_42834");
    gpu_create_kernel(ctx, &ctx->program->next_partition_to_read_doublezisegred_nonseg_42824, "next_partition_to_read_doublezisegred_nonseg_42824");
    gpu_create_kernel(ctx, &ctx->program->next_partition_to_read_doublezisegscan_42832, "next_partition_to_read_doublezisegscan_42832");
    gpu_create_kernel(ctx, &ctx->program->rectify_partition_ids_doublezisegmap_intrablock_46535, "rectify_partition_ids_doublezisegmap_intrablock_46535");
    gpu_create_kernel(ctx, &ctx->program->rectify_partition_ids_doublezisegmap_intrablock_46779, "rectify_partition_ids_doublezisegmap_intrablock_46779");
}
static void teardown_program(struct futhark_context *ctx)
{
    (void) ctx;
    
    int error = 0;
    
    (void) error;
    gpu_free_kernel(ctx, ctx->program->add_next_partition_doublezigpuseq_50444);
    gpu_free_kernel(ctx, ctx->program->add_next_partition_doublezigpuseq_50470);
    gpu_free_kernel(ctx, ctx->program->add_next_partition_doublezigpuseq_50476);
    gpu_free_kernel(ctx, ctx->program->add_next_partition_doublezigpuseq_50482);
    gpu_free_kernel(ctx, ctx->program->add_next_partition_doublezigpuseq_50488);
    gpu_free_kernel(ctx, ctx->program->add_next_partition_doublezigpuseq_50494);
    gpu_free_kernel(ctx, ctx->program->add_next_partition_doublezigpuseq_50501);
    gpu_free_kernel(ctx, ctx->program->add_next_partition_doublezigpuseq_51204);
    gpu_free_kernel(ctx, ctx->program->add_next_partition_doublezisegmap_43129);
    gpu_free_kernel(ctx, ctx->program->add_next_partition_doublezisegmap_43790);
    gpu_free_kernel(ctx, ctx->program->add_next_partition_doublezisegmap_43826);
    gpu_free_kernel(ctx, ctx->program->add_next_partition_doublezisegmap_43887);
    gpu_free_kernel(ctx, ctx->program->add_next_partition_doublezisegmap_44136);
    gpu_free_kernel(ctx, ctx->program->add_next_partition_doublezisegmap_44186);
    gpu_free_kernel(ctx, ctx->program->add_next_partition_doublezisegmap_44202);
    gpu_free_kernel(ctx, ctx->program->add_next_partition_doublezisegmap_44255);
    gpu_free_kernel(ctx, ctx->program->add_next_partition_doublezisegmap_44323);
    gpu_free_kernel(ctx, ctx->program->add_next_partition_doublezisegmap_intrablock_43720);
    gpu_free_kernel(ctx, ctx->program->add_next_partition_doublezisegmap_intrablock_46535);
    gpu_free_kernel(ctx, ctx->program->add_next_partition_doublezisegmap_intrablock_46783);
    gpu_free_kernel(ctx, ctx->program->add_next_partition_doublezisegred_large_43807);
    gpu_free_kernel(ctx, ctx->program->add_next_partition_doublezisegred_large_44044);
    gpu_free_kernel(ctx, ctx->program->add_next_partition_doublezisegred_small_43807);
    gpu_free_kernel(ctx, ctx->program->add_next_partition_doublezisegred_small_44044);
    gpu_free_kernel(ctx, ctx->program->add_next_partition_doublezisegscan_43878);
    gpu_free_kernel(ctx, ctx->program->add_next_partition_doublezisegscan_44184);
    gpu_free_kernel(ctx, ctx->program->add_next_partition_doublezisegscan_44200);
    gpu_free_kernel(ctx, ctx->program->builtinzhiota_i64ziiota_i64_50380);
    gpu_free_kernel(ctx, ctx->program->builtinzhreplicate_boolzireplicate_51021);
    gpu_free_kernel(ctx, ctx->program->builtinzhreplicate_f64zireplicate_50455);
    gpu_free_kernel(ctx, ctx->program->builtinzhreplicate_i32zireplicate_50282);
    gpu_free_kernel(ctx, ctx->program->builtinzhreplicate_i64zireplicate_50197);
    gpu_free_kernel(ctx, ctx->program->builtinzhreplicate_i8zireplicate_50247);
    gpu_free_kernel(ctx, ctx->program->do_DBSCAN_doublezigpuseq_50431);
    gpu_free_kernel(ctx, ctx->program->do_DBSCAN_doublezisegmap_44355);
    gpu_free_kernel(ctx, ctx->program->do_DBSCAN_doublezisegmap_44371);
    gpu_free_kernel(ctx, ctx->program->do_DBSCAN_doublezisegmap_44387);
    gpu_free_kernel(ctx, ctx->program->do_DBSCAN_doublezisegmap_44403);
    gpu_free_kernel(ctx, ctx->program->do_DBSCAN_doublezisegmap_44411);
    gpu_free_kernel(ctx, ctx->program->do_DBSCAN_doublezisegmap_44435);
    gpu_free_kernel(ctx, ctx->program->do_DBSCAN_doublezisegmap_44449);
    gpu_free_kernel(ctx, ctx->program->do_DBSCAN_doublezisegmap_44647);
    gpu_free_kernel(ctx, ctx->program->do_DBSCAN_doublezisegmap_44743);
    gpu_free_kernel(ctx, ctx->program->do_DBSCAN_doublezisegmap_44774);
    gpu_free_kernel(ctx, ctx->program->do_DBSCAN_doublezisegmap_44801);
    gpu_free_kernel(ctx, ctx->program->do_DBSCAN_doublezisegmap_44805);
    gpu_free_kernel(ctx, ctx->program->do_DBSCAN_doublezisegmap_45218);
    gpu_free_kernel(ctx, ctx->program->do_DBSCAN_doublezisegmap_45376);
    gpu_free_kernel(ctx, ctx->program->do_DBSCAN_doublezisegmap_45596);
    gpu_free_kernel(ctx, ctx->program->do_DBSCAN_doublezisegmap_45663);
    gpu_free_kernel(ctx, ctx->program->do_DBSCAN_doublezisegmap_45679);
    gpu_free_kernel(ctx, ctx->program->do_DBSCAN_doublezisegmap_45890);
    gpu_free_kernel(ctx, ctx->program->do_DBSCAN_doublezisegmap_intrablock_46535);
    gpu_free_kernel(ctx, ctx->program->do_DBSCAN_doublezisegmap_intrablock_46915);
    gpu_free_kernel(ctx, ctx->program->do_DBSCAN_doublezisegmap_intrablock_47270);
    gpu_free_kernel(ctx, ctx->program->do_DBSCAN_doublezisegmap_intrablock_47625);
    gpu_free_kernel(ctx, ctx->program->do_DBSCAN_doublezisegmap_intrablock_47884);
    gpu_free_kernel(ctx, ctx->program->do_DBSCAN_doublezisegmap_intrablock_48143);
    gpu_free_kernel(ctx, ctx->program->do_DBSCAN_doublezisegmap_intrablock_48552);
    gpu_free_kernel(ctx, ctx->program->do_DBSCAN_doublezisegred_large_44665);
    gpu_free_kernel(ctx, ctx->program->do_DBSCAN_doublezisegred_large_45615);
    gpu_free_kernel(ctx, ctx->program->do_DBSCAN_doublezisegred_large_45909);
    gpu_free_kernel(ctx, ctx->program->do_DBSCAN_doublezisegred_nonseg_44715);
    gpu_free_kernel(ctx, ctx->program->do_DBSCAN_doublezisegred_small_44665);
    gpu_free_kernel(ctx, ctx->program->do_DBSCAN_doublezisegred_small_45615);
    gpu_free_kernel(ctx, ctx->program->do_DBSCAN_doublezisegred_small_45909);
    gpu_free_kernel(ctx, ctx->program->do_DBSCAN_doublezisegscan_44353);
    gpu_free_kernel(ctx, ctx->program->do_DBSCAN_doublezisegscan_44369);
    gpu_free_kernel(ctx, ctx->program->do_DBSCAN_doublezisegscan_44385);
    gpu_free_kernel(ctx, ctx->program->do_DBSCAN_doublezisegscan_44401);
    gpu_free_kernel(ctx, ctx->program->do_DBSCAN_doublezisegscan_44447);
    gpu_free_kernel(ctx, ctx->program->do_DBSCAN_doublezisegscan_44463);
    gpu_free_kernel(ctx, ctx->program->do_DBSCAN_doublezisegscan_44723);
    gpu_free_kernel(ctx, ctx->program->do_DBSCAN_doublezisegscan_45210);
    gpu_free_kernel(ctx, ctx->program->do_DBSCAN_doublezisegscan_45677);
    gpu_free_kernel(ctx, ctx->program->get_num_neighbours_against_9632zisegmap_46133);
    gpu_free_kernel(ctx, ctx->program->get_num_neighbours_against_9632zisegmap_intrablock_46535);
    gpu_free_kernel(ctx, ctx->program->get_num_neighbours_against_9632zisegred_large_46151);
    gpu_free_kernel(ctx, ctx->program->get_num_neighbours_against_9632zisegred_small_46151);
    gpu_free_kernel(ctx, ctx->program->get_num_neighbours_against_9635zisegmap_46367);
    gpu_free_kernel(ctx, ctx->program->get_num_neighbours_against_9635zisegmap_intrablock_46535);
    gpu_free_kernel(ctx, ctx->program->get_num_neighbours_against_9635zisegred_large_46385);
    gpu_free_kernel(ctx, ctx->program->get_num_neighbours_against_9635zisegred_small_46385);
    gpu_free_kernel(ctx, ctx->program->make_collisions_compact_doublezisegmap_42997);
    gpu_free_kernel(ctx, ctx->program->make_collisions_compact_doublezisegmap_intrablock_46535);
    gpu_free_kernel(ctx, ctx->program->make_collisions_compact_doublezisegmap_intrablock_46804);
    gpu_free_kernel(ctx, ctx->program->make_collisions_compact_doublezisegscan_42995);
    gpu_free_kernel(ctx, ctx->program->mk_dbcHandler_doublezigpuseq_50292);
    gpu_free_kernel(ctx, ctx->program->next_partition_to_read_doublezigpuseq_50194);
    gpu_free_kernel(ctx, ctx->program->next_partition_to_read_doublezigpuseq_50407);
    gpu_free_kernel(ctx, ctx->program->next_partition_to_read_doublezisegmap_42834);
    gpu_free_kernel(ctx, ctx->program->next_partition_to_read_doublezisegred_nonseg_42824);
    gpu_free_kernel(ctx, ctx->program->next_partition_to_read_doublezisegscan_42832);
    gpu_free_kernel(ctx, ctx->program->rectify_partition_ids_doublezisegmap_intrablock_46535);
    gpu_free_kernel(ctx, ctx->program->rectify_partition_ids_doublezisegmap_intrablock_46779);
    free(ctx->program);
}
static void set_tuning_params(struct futhark_context *ctx)
{
    (void) ctx;
    ctx->tuning_params.add_next_partition_doublezisegmap_num_tblocks_43891 = &ctx->cfg->tuning_params[0];
    ctx->tuning_params.add_next_partition_doublezisegmap_num_tblocks_44190 = &ctx->cfg->tuning_params[1];
    ctx->tuning_params.add_next_partition_doublezisegmap_num_tblocks_44206 = &ctx->cfg->tuning_params[2];
    ctx->tuning_params.add_next_partition_doublezisegmap_tblock_sizze_43112 = &ctx->cfg->tuning_params[3];
    ctx->tuning_params.add_next_partition_doublezisegmap_tblock_sizze_43450 = &ctx->cfg->tuning_params[4];
    ctx->tuning_params.add_next_partition_doublezisegmap_tblock_sizze_43527 = &ctx->cfg->tuning_params[5];
    ctx->tuning_params.add_next_partition_doublezisegmap_tblock_sizze_43889 = &ctx->cfg->tuning_params[6];
    ctx->tuning_params.add_next_partition_doublezisegmap_tblock_sizze_44086 = &ctx->cfg->tuning_params[7];
    ctx->tuning_params.add_next_partition_doublezisegmap_tblock_sizze_44188 = &ctx->cfg->tuning_params[8];
    ctx->tuning_params.add_next_partition_doublezisegmap_tblock_sizze_44204 = &ctx->cfg->tuning_params[9];
    ctx->tuning_params.add_next_partition_doublezisegmap_tblock_sizze_44212 = &ctx->cfg->tuning_params[10];
    ctx->tuning_params.add_next_partition_doublezisegmap_tblock_sizze_44289 = &ctx->cfg->tuning_params[11];
    ctx->tuning_params.add_next_partition_doublezisegred_num_tblocks_43504 = &ctx->cfg->tuning_params[12];
    ctx->tuning_params.add_next_partition_doublezisegred_num_tblocks_43991 = &ctx->cfg->tuning_params[13];
    ctx->tuning_params.add_next_partition_doublezisegred_tblock_sizze_43502 = &ctx->cfg->tuning_params[14];
    ctx->tuning_params.add_next_partition_doublezisegred_tblock_sizze_43989 = &ctx->cfg->tuning_params[15];
    ctx->tuning_params.add_next_partition_doublezisegscan_num_tblocks_43142 = &ctx->cfg->tuning_params[16];
    ctx->tuning_params.add_next_partition_doublezisegscan_num_tblocks_43633 = &ctx->cfg->tuning_params[17];
    ctx->tuning_params.add_next_partition_doublezisegscan_num_tblocks_44180 = &ctx->cfg->tuning_params[18];
    ctx->tuning_params.add_next_partition_doublezisegscan_num_tblocks_44196 = &ctx->cfg->tuning_params[19];
    ctx->tuning_params.add_next_partition_doublezisegscan_tblock_sizze_43140 = &ctx->cfg->tuning_params[20];
    ctx->tuning_params.add_next_partition_doublezisegscan_tblock_sizze_43631 = &ctx->cfg->tuning_params[21];
    ctx->tuning_params.add_next_partition_doublezisegscan_tblock_sizze_44178 = &ctx->cfg->tuning_params[22];
    ctx->tuning_params.add_next_partition_doublezisegscan_tblock_sizze_44194 = &ctx->cfg->tuning_params[23];
    ctx->tuning_params.add_next_partition_doublezisuff_intra_par_2 = &ctx->cfg->tuning_params[24];
    ctx->tuning_params.add_next_partition_doublezisuff_outer_par_1 = &ctx->cfg->tuning_params[25];
    ctx->tuning_params.add_next_partition_doublezisuff_outer_par_3 = &ctx->cfg->tuning_params[26];
    ctx->tuning_params.add_next_partition_doublezisuff_outer_screma_0 = &ctx->cfg->tuning_params[27];
    ctx->tuning_params.add_next_partition_doublezitile_sizze_46536 = &ctx->cfg->tuning_params[28];
    ctx->tuning_params.add_next_partition_doublezitile_sizze_46784 = &ctx->cfg->tuning_params[29];
    ctx->tuning_params.builtinzhiota_i64zitblock_sizze_50384 = &ctx->cfg->tuning_params[30];
    ctx->tuning_params.builtinzhreplicate_boolzitblock_sizze_51025 = &ctx->cfg->tuning_params[31];
    ctx->tuning_params.builtinzhreplicate_f64zitblock_sizze_50459 = &ctx->cfg->tuning_params[32];
    ctx->tuning_params.builtinzhreplicate_i32zitblock_sizze_50286 = &ctx->cfg->tuning_params[33];
    ctx->tuning_params.builtinzhreplicate_i64zitblock_sizze_50201 = &ctx->cfg->tuning_params[34];
    ctx->tuning_params.builtinzhreplicate_i8zitblock_sizze_50251 = &ctx->cfg->tuning_params[35];
    ctx->tuning_params.do_DBSCAN_doublezisegmap_num_tblocks_44359 = &ctx->cfg->tuning_params[36];
    ctx->tuning_params.do_DBSCAN_doublezisegmap_num_tblocks_44375 = &ctx->cfg->tuning_params[37];
    ctx->tuning_params.do_DBSCAN_doublezisegmap_num_tblocks_44391 = &ctx->cfg->tuning_params[38];
    ctx->tuning_params.do_DBSCAN_doublezisegmap_num_tblocks_44407 = &ctx->cfg->tuning_params[39];
    ctx->tuning_params.do_DBSCAN_doublezisegmap_num_tblocks_44415 = &ctx->cfg->tuning_params[40];
    ctx->tuning_params.do_DBSCAN_doublezisegmap_num_tblocks_44453 = &ctx->cfg->tuning_params[41];
    ctx->tuning_params.do_DBSCAN_doublezisegmap_num_tblocks_44809 = &ctx->cfg->tuning_params[42];
    ctx->tuning_params.do_DBSCAN_doublezisegmap_num_tblocks_45222 = &ctx->cfg->tuning_params[43];
    ctx->tuning_params.do_DBSCAN_doublezisegmap_num_tblocks_45667 = &ctx->cfg->tuning_params[44];
    ctx->tuning_params.do_DBSCAN_doublezisegmap_num_tblocks_45683 = &ctx->cfg->tuning_params[45];
    ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_44357 = &ctx->cfg->tuning_params[46];
    ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_44373 = &ctx->cfg->tuning_params[47];
    ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_44389 = &ctx->cfg->tuning_params[48];
    ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_44405 = &ctx->cfg->tuning_params[49];
    ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_44413 = &ctx->cfg->tuning_params[50];
    ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_44421 = &ctx->cfg->tuning_params[51];
    ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_44451 = &ctx->cfg->tuning_params[52];
    ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_44626 = &ctx->cfg->tuning_params[53];
    ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_44727 = &ctx->cfg->tuning_params[54];
    ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_44753 = &ctx->cfg->tuning_params[55];
    ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_44789 = &ctx->cfg->tuning_params[56];
    ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_44807 = &ctx->cfg->tuning_params[57];
    ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_45220 = &ctx->cfg->tuning_params[58];
    ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_45349 = &ctx->cfg->tuning_params[59];
    ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_45575 = &ctx->cfg->tuning_params[60];
    ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_45665 = &ctx->cfg->tuning_params[61];
    ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_45681 = &ctx->cfg->tuning_params[62];
    ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_45869 = &ctx->cfg->tuning_params[63];
    ctx->tuning_params.do_DBSCAN_doublezisegred_num_tblocks_44576 = &ctx->cfg->tuning_params[64];
    ctx->tuning_params.do_DBSCAN_doublezisegred_num_tblocks_44709 = &ctx->cfg->tuning_params[65];
    ctx->tuning_params.do_DBSCAN_doublezisegred_num_tblocks_45519 = &ctx->cfg->tuning_params[66];
    ctx->tuning_params.do_DBSCAN_doublezisegred_num_tblocks_45813 = &ctx->cfg->tuning_params[67];
    ctx->tuning_params.do_DBSCAN_doublezisegred_tblock_sizze_44574 = &ctx->cfg->tuning_params[68];
    ctx->tuning_params.do_DBSCAN_doublezisegred_tblock_sizze_44707 = &ctx->cfg->tuning_params[69];
    ctx->tuning_params.do_DBSCAN_doublezisegred_tblock_sizze_45517 = &ctx->cfg->tuning_params[70];
    ctx->tuning_params.do_DBSCAN_doublezisegred_tblock_sizze_45811 = &ctx->cfg->tuning_params[71];
    ctx->tuning_params.do_DBSCAN_doublezisegscan_num_tblocks_44349 = &ctx->cfg->tuning_params[72];
    ctx->tuning_params.do_DBSCAN_doublezisegscan_num_tblocks_44365 = &ctx->cfg->tuning_params[73];
    ctx->tuning_params.do_DBSCAN_doublezisegscan_num_tblocks_44381 = &ctx->cfg->tuning_params[74];
    ctx->tuning_params.do_DBSCAN_doublezisegscan_num_tblocks_44397 = &ctx->cfg->tuning_params[75];
    ctx->tuning_params.do_DBSCAN_doublezisegscan_num_tblocks_44443 = &ctx->cfg->tuning_params[76];
    ctx->tuning_params.do_DBSCAN_doublezisegscan_num_tblocks_44459 = &ctx->cfg->tuning_params[77];
    ctx->tuning_params.do_DBSCAN_doublezisegscan_num_tblocks_44719 = &ctx->cfg->tuning_params[78];
    ctx->tuning_params.do_DBSCAN_doublezisegscan_num_tblocks_44846 = &ctx->cfg->tuning_params[79];
    ctx->tuning_params.do_DBSCAN_doublezisegscan_num_tblocks_45106 = &ctx->cfg->tuning_params[80];
    ctx->tuning_params.do_DBSCAN_doublezisegscan_num_tblocks_45673 = &ctx->cfg->tuning_params[81];
    ctx->tuning_params.do_DBSCAN_doublezisegscan_tblock_sizze_44347 = &ctx->cfg->tuning_params[82];
    ctx->tuning_params.do_DBSCAN_doublezisegscan_tblock_sizze_44363 = &ctx->cfg->tuning_params[83];
    ctx->tuning_params.do_DBSCAN_doublezisegscan_tblock_sizze_44379 = &ctx->cfg->tuning_params[84];
    ctx->tuning_params.do_DBSCAN_doublezisegscan_tblock_sizze_44395 = &ctx->cfg->tuning_params[85];
    ctx->tuning_params.do_DBSCAN_doublezisegscan_tblock_sizze_44441 = &ctx->cfg->tuning_params[86];
    ctx->tuning_params.do_DBSCAN_doublezisegscan_tblock_sizze_44457 = &ctx->cfg->tuning_params[87];
    ctx->tuning_params.do_DBSCAN_doublezisegscan_tblock_sizze_44717 = &ctx->cfg->tuning_params[88];
    ctx->tuning_params.do_DBSCAN_doublezisegscan_tblock_sizze_44844 = &ctx->cfg->tuning_params[89];
    ctx->tuning_params.do_DBSCAN_doublezisegscan_tblock_sizze_45104 = &ctx->cfg->tuning_params[90];
    ctx->tuning_params.do_DBSCAN_doublezisegscan_tblock_sizze_45671 = &ctx->cfg->tuning_params[91];
    ctx->tuning_params.do_DBSCAN_doublezisuff_outer_par_0 = &ctx->cfg->tuning_params[92];
    ctx->tuning_params.do_DBSCAN_doublezisuff_outer_par_2 = &ctx->cfg->tuning_params[93];
    ctx->tuning_params.do_DBSCAN_doublezisuff_outer_par_3 = &ctx->cfg->tuning_params[94];
    ctx->tuning_params.do_DBSCAN_doublezisuff_outer_par_4 = &ctx->cfg->tuning_params[95];
    ctx->tuning_params.do_DBSCAN_doublezisuff_outer_par_5 = &ctx->cfg->tuning_params[96];
    ctx->tuning_params.do_DBSCAN_doublezisuff_outer_screma_1 = &ctx->cfg->tuning_params[97];
    ctx->tuning_params.do_DBSCAN_doublezitile_sizze_46536 = &ctx->cfg->tuning_params[98];
    ctx->tuning_params.do_DBSCAN_doublezitile_sizze_46916 = &ctx->cfg->tuning_params[99];
    ctx->tuning_params.do_DBSCAN_doublezitile_sizze_47271 = &ctx->cfg->tuning_params[100];
    ctx->tuning_params.do_DBSCAN_doublezitile_sizze_47626 = &ctx->cfg->tuning_params[101];
    ctx->tuning_params.do_DBSCAN_doublezitile_sizze_47885 = &ctx->cfg->tuning_params[102];
    ctx->tuning_params.do_DBSCAN_doublezitile_sizze_48144 = &ctx->cfg->tuning_params[103];
    ctx->tuning_params.do_DBSCAN_doublezitile_sizze_48553 = &ctx->cfg->tuning_params[104];
    ctx->tuning_params.get_num_neighbours_against_9632zisegmap_tblock_sizze_46112 = &ctx->cfg->tuning_params[105];
    ctx->tuning_params.get_num_neighbours_against_9632zisegred_num_tblocks_46064 = &ctx->cfg->tuning_params[106];
    ctx->tuning_params.get_num_neighbours_against_9632zisegred_tblock_sizze_46062 = &ctx->cfg->tuning_params[107];
    ctx->tuning_params.get_num_neighbours_against_9632zisuff_outer_par_0 = &ctx->cfg->tuning_params[108];
    ctx->tuning_params.get_num_neighbours_against_9632zitile_sizze_46536 = &ctx->cfg->tuning_params[109];
    ctx->tuning_params.get_num_neighbours_against_9635zisegmap_tblock_sizze_46346 = &ctx->cfg->tuning_params[110];
    ctx->tuning_params.get_num_neighbours_against_9635zisegred_num_tblocks_46298 = &ctx->cfg->tuning_params[111];
    ctx->tuning_params.get_num_neighbours_against_9635zisegred_tblock_sizze_46296 = &ctx->cfg->tuning_params[112];
    ctx->tuning_params.get_num_neighbours_against_9635zisuff_outer_par_0 = &ctx->cfg->tuning_params[113];
    ctx->tuning_params.get_num_neighbours_against_9635zitile_sizze_46536 = &ctx->cfg->tuning_params[114];
    ctx->tuning_params.make_collisions_compact_doublezisegmap_num_tblocks_43001 = &ctx->cfg->tuning_params[115];
    ctx->tuning_params.make_collisions_compact_doublezisegmap_tblock_sizze_42999 = &ctx->cfg->tuning_params[116];
    ctx->tuning_params.make_collisions_compact_doublezisegscan_num_tblocks_42991 = &ctx->cfg->tuning_params[117];
    ctx->tuning_params.make_collisions_compact_doublezisegscan_tblock_sizze_42989 = &ctx->cfg->tuning_params[118];
    ctx->tuning_params.make_collisions_compact_doublezisuff_outer_par_0 = &ctx->cfg->tuning_params[119];
    ctx->tuning_params.make_collisions_compact_doublezitile_sizze_46536 = &ctx->cfg->tuning_params[120];
    ctx->tuning_params.make_collisions_compact_doublezitile_sizze_46805 = &ctx->cfg->tuning_params[121];
    ctx->tuning_params.next_partition_to_read_doublezisegmap_num_tblocks_42838 = &ctx->cfg->tuning_params[122];
    ctx->tuning_params.next_partition_to_read_doublezisegmap_tblock_sizze_42836 = &ctx->cfg->tuning_params[123];
    ctx->tuning_params.next_partition_to_read_doublezisegred_num_tblocks_42818 = &ctx->cfg->tuning_params[124];
    ctx->tuning_params.next_partition_to_read_doublezisegred_tblock_sizze_42816 = &ctx->cfg->tuning_params[125];
    ctx->tuning_params.next_partition_to_read_doublezisegscan_num_tblocks_42828 = &ctx->cfg->tuning_params[126];
    ctx->tuning_params.next_partition_to_read_doublezisegscan_tblock_sizze_42826 = &ctx->cfg->tuning_params[127];
    ctx->tuning_params.rectify_partition_ids_doublezisuff_outer_par_0 = &ctx->cfg->tuning_params[128];
    ctx->tuning_params.rectify_partition_ids_doublezitile_sizze_46536 = &ctx->cfg->tuning_params[129];
    ctx->tuning_params.rectify_partition_ids_doublezitile_sizze_46780 = &ctx->cfg->tuning_params[130];
}
int memblock_unref_device(struct futhark_context *ctx, struct memblock_device *block, const char *desc)
{
    if (block->references != NULL) {
        *block->references -= 1;
        if (ctx->detail_memory)
            fprintf(ctx->log, "Unreferencing block %s (allocated as %s) in %s: %d references remaining.\n", desc, block->desc, "space 'device'", *block->references);
        if (*block->references == 0) {
            ctx->cur_mem_usage_device -= block->size;
            (void) gpu_free(ctx, block->mem, block->size, desc);
            free(block->references);
            if (ctx->detail_memory)
                fprintf(ctx->log, "%lld bytes freed (now allocated: %lld bytes)\n", (long long) block->size, (long long) ctx->cur_mem_usage_device);
        }
        block->references = NULL;
    }
    return 0;
}
int memblock_alloc_device(struct futhark_context *ctx, struct memblock_device *block, int64_t size, const char *desc)
{
    if (size < 0)
        futhark_panic(1, "Negative allocation of %lld bytes attempted for %s in %s.\n", (long long) size, desc, "space 'device'", ctx->cur_mem_usage_device);
    
    int ret = memblock_unref_device(ctx, block, desc);
    
    if (ret != FUTHARK_SUCCESS)
        return ret;
    if (ctx->detail_memory)
        fprintf(ctx->log, "Allocating %lld bytes for %s in %s (currently allocated: %lld bytes).\n", (long long) size, desc, "space 'device'", (long long) ctx->cur_mem_usage_device);
    (void) gpu_alloc(ctx, ctx->log, (size_t) size, desc, &block->mem, (size_t *) &size);
    if (ctx->error == NULL) {
        block->references = (int *) malloc(sizeof(int));
        *block->references = 1;
        block->size = size;
        block->desc = desc;
        
        long long new_usage = ctx->cur_mem_usage_device + size;
        
        if (ctx->detail_memory)
            fprintf(ctx->log, "Received block of %lld bytes; now allocated: %lld bytes", (long long) block->size, new_usage);
        ctx->cur_mem_usage_device = new_usage;
        if (new_usage > ctx->peak_mem_usage_device) {
            ctx->peak_mem_usage_device = new_usage;
            if (ctx->detail_memory)
                fprintf(ctx->log, " (new peak).\n");
        } else if (ctx->detail_memory)
            fprintf(ctx->log, ".\n");
        return FUTHARK_SUCCESS;
    } else {
        // We are naively assuming that any memory allocation error is due to OOM.
        lock_lock(&ctx->error_lock);
        
        char *old_error = ctx->error;
        
        ctx->error = msgprintf("Failed to allocate memory in %s.\nAttempted allocation: %12lld bytes\nCurrently allocated:  %12lld bytes\n%s", "space 'device'", (long long) size, (long long) ctx->cur_mem_usage_device, old_error);
        free(old_error);
        lock_unlock(&ctx->error_lock);
        return FUTHARK_OUT_OF_MEMORY;
    }
}
int memblock_set_device(struct futhark_context *ctx, struct memblock_device *lhs, struct memblock_device *rhs, const char *lhs_desc)
{
    int ret = memblock_unref_device(ctx, lhs, lhs_desc);
    
    if (rhs->references != NULL)
        (*rhs->references)++;
    *lhs = *rhs;
    return ret;
}
int memblock_unref(struct futhark_context *ctx, struct memblock *block, const char *desc)
{
    if (block->references != NULL) {
        *block->references -= 1;
        if (ctx->detail_memory)
            fprintf(ctx->log, "Unreferencing block %s (allocated as %s) in %s: %d references remaining.\n", desc, block->desc, "default space", *block->references);
        if (*block->references == 0) {
            ctx->cur_mem_usage_default -= block->size;
            host_free(ctx, (size_t) block->size, desc, (void *) block->mem);
            free(block->references);
            if (ctx->detail_memory)
                fprintf(ctx->log, "%lld bytes freed (now allocated: %lld bytes)\n", (long long) block->size, (long long) ctx->cur_mem_usage_default);
        }
        block->references = NULL;
    }
    return 0;
}
int memblock_alloc(struct futhark_context *ctx, struct memblock *block, int64_t size, const char *desc)
{
    if (size < 0)
        futhark_panic(1, "Negative allocation of %lld bytes attempted for %s in %s.\n", (long long) size, desc, "default space", ctx->cur_mem_usage_default);
    
    int ret = memblock_unref(ctx, block, desc);
    
    if (ret != FUTHARK_SUCCESS)
        return ret;
    if (ctx->detail_memory)
        fprintf(ctx->log, "Allocating %lld bytes for %s in %s (currently allocated: %lld bytes).\n", (long long) size, desc, "default space", (long long) ctx->cur_mem_usage_default);
    host_alloc(ctx, (size_t) size, desc, (size_t *) &size, (void *) &block->mem);
    if (ctx->error == NULL) {
        block->references = (int *) malloc(sizeof(int));
        *block->references = 1;
        block->size = size;
        block->desc = desc;
        
        long long new_usage = ctx->cur_mem_usage_default + size;
        
        if (ctx->detail_memory)
            fprintf(ctx->log, "Received block of %lld bytes; now allocated: %lld bytes", (long long) block->size, new_usage);
        ctx->cur_mem_usage_default = new_usage;
        if (new_usage > ctx->peak_mem_usage_default) {
            ctx->peak_mem_usage_default = new_usage;
            if (ctx->detail_memory)
                fprintf(ctx->log, " (new peak).\n");
        } else if (ctx->detail_memory)
            fprintf(ctx->log, ".\n");
        return FUTHARK_SUCCESS;
    } else {
        // We are naively assuming that any memory allocation error is due to OOM.
        lock_lock(&ctx->error_lock);
        
        char *old_error = ctx->error;
        
        ctx->error = msgprintf("Failed to allocate memory in %s.\nAttempted allocation: %12lld bytes\nCurrently allocated:  %12lld bytes\n%s", "default space", (long long) size, (long long) ctx->cur_mem_usage_default, old_error);
        free(old_error);
        lock_unlock(&ctx->error_lock);
        return FUTHARK_OUT_OF_MEMORY;
    }
}
int memblock_set(struct futhark_context *ctx, struct memblock *lhs, struct memblock *rhs, const char *lhs_desc)
{
    int ret = memblock_unref(ctx, lhs, lhs_desc);
    
    if (rhs->references != NULL)
        (*rhs->references)++;
    *lhs = *rhs;
    return ret;
}
char *futhark_context_report(struct futhark_context *ctx)
{
    if (futhark_context_sync(ctx) != 0)
        return NULL;
    
    struct str_builder builder;
    
    str_builder_init(&builder);
    str_builder_char(&builder, '{');
    str_builder_str(&builder, "\"memory\":{");
    str_builder(&builder, "\"space 'device'\": %lld", (long long) ctx->peak_mem_usage_device);
    str_builder_char(&builder, ',');
    str_builder(&builder, "\"default space\": %lld", (long long) ctx->peak_mem_usage_default);
    str_builder_str(&builder, "},\"events\":[");
    if (report_events_in_list(&ctx->event_list, &builder) != 0) {
        free(builder.str);
        return NULL;
    } else {
        str_builder_str(&builder, "]}");
        return builder.str;
    }
}
int futhark_context_clear_caches(struct futhark_context *ctx)
{
    lock_lock(&ctx->lock);
    CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
    ctx->peak_mem_usage_device = 0;
    ctx->peak_mem_usage_default = 0;
    if (ctx->error == NULL)
        gpu_free_all(ctx);
    CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
    lock_unlock(&ctx->lock);
    return ctx->error != NULL;
}

// Start of context.h

// Internal functions.

static void set_error(struct futhark_context* ctx, char *error) {
  lock_lock(&ctx->error_lock);
  if (ctx->error == NULL) {
    ctx->error = error;
  } else {
    free(error);
  }
  lock_unlock(&ctx->error_lock);
}

// XXX: should be static, but used in ispc_util.h
void lexical_realloc_error(struct futhark_context* ctx, size_t new_size) {
  set_error(ctx,
            msgprintf("Failed to allocate memory.\nAttempted allocation: %12lld bytes\n",
                      (long long) new_size));
}

static int lexical_realloc(struct futhark_context *ctx,
                           unsigned char **ptr,
                           int64_t *old_size,
                           int64_t new_size) {
  unsigned char *new = realloc(*ptr, (size_t)new_size);
  if (new == NULL) {
    lexical_realloc_error(ctx, new_size);
    return FUTHARK_OUT_OF_MEMORY;
  } else {
    *ptr = new;
    *old_size = new_size;
    return FUTHARK_SUCCESS;
  }
}

static void free_all_in_free_list(struct futhark_context* ctx) {
  fl_mem mem;
  free_list_pack(&ctx->free_list);
  while (free_list_first(&ctx->free_list, (fl_mem*)&mem) == 0) {
    free((void*)mem);
  }
}

static int is_small_alloc(size_t size) {
  return size < 1024*1024;
}

static void host_alloc(struct futhark_context* ctx,
                       size_t size, const char* tag, size_t* size_out, void** mem_out) {
  if (is_small_alloc(size) || free_list_find(&ctx->free_list, size, tag, size_out, (fl_mem*)mem_out) != 0) {
    *size_out = size;
    *mem_out = malloc(size);
  }
}

static void host_free(struct futhark_context* ctx,
                      size_t size, const char* tag, void* mem) {
  // Small allocations are handled by malloc()s own free list.  The
  // threshold here is kind of arbitrary, but seems to work OK.
  // Larger allocations are mmap()ed/munmapped() every time, which is
  // very slow, and Futhark programs tend to use a few very large
  // allocations.
  if (is_small_alloc(size)) {
    free(mem);
  } else {
    free_list_insert(&ctx->free_list, size, (fl_mem)mem, tag);
  }
}

static void add_event(struct futhark_context* ctx,
                      const char* name,
                      char* description,
                      void* data,
                      event_report_fn f) {
  if (ctx->logging) {
    fprintf(ctx->log, "Event: %s\n%s\n", name, description);
  }
  add_event_to_list(&ctx->event_list, name, description, data, f);
}

char *futhark_context_get_error(struct futhark_context *ctx) {
  char *error = ctx->error;
  ctx->error = NULL;
  return error;
}

void futhark_context_config_set_debugging(struct futhark_context_config *cfg, int flag) {
    cfg->profiling = cfg->logging = cfg->debugging = flag;
}

void futhark_context_config_set_profiling(struct futhark_context_config *cfg, int flag) {
    cfg->profiling = flag;
}

void futhark_context_config_set_logging(struct futhark_context_config *cfg, int flag) {
    cfg->logging = flag;
}

void futhark_context_config_set_cache_file(struct futhark_context_config *cfg, const char *f) {
  cfg->cache_fname = strdup(f);
}

int futhark_get_tuning_param_count(void) {
  return num_tuning_params;
}

const char *futhark_get_tuning_param_name(int i) {
  return tuning_param_names[i];
}

const char *futhark_get_tuning_param_class(int i) {
    return tuning_param_classes[i];
}

void futhark_context_set_logging_file(struct futhark_context *ctx, FILE *f){
  ctx->log = f;
}

void futhark_context_pause_profiling(struct futhark_context *ctx) {
  ctx->profiling_paused = 1;
}

void futhark_context_unpause_profiling(struct futhark_context *ctx) {
  ctx->profiling_paused = 0;
}

struct futhark_context_config* futhark_context_config_new(void) {
  struct futhark_context_config* cfg = malloc(sizeof(struct futhark_context_config));
  if (cfg == NULL) {
    return NULL;
  }
  cfg->in_use = 0;
  cfg->debugging = 0;
  cfg->profiling = 0;
  cfg->logging = 0;
  cfg->cache_fname = NULL;
  cfg->num_tuning_params = num_tuning_params;
  cfg->tuning_params = malloc(cfg->num_tuning_params * sizeof(int64_t));
  memcpy(cfg->tuning_params, tuning_param_defaults,
         cfg->num_tuning_params * sizeof(int64_t));
  cfg->tuning_param_names = tuning_param_names;
  cfg->tuning_param_vars = tuning_param_vars;
  cfg->tuning_param_classes = tuning_param_classes;
  backend_context_config_setup(cfg);
  return cfg;
}

void futhark_context_config_free(struct futhark_context_config* cfg) {
  assert(!cfg->in_use);
  backend_context_config_teardown(cfg);
  free(cfg->cache_fname);
  free(cfg->tuning_params);
  free(cfg);
}

struct futhark_context* futhark_context_new(struct futhark_context_config* cfg) {
  struct futhark_context* ctx = malloc(sizeof(struct futhark_context));
  if (ctx == NULL) {
    return NULL;
  }
  assert(!cfg->in_use);
  ctx->cfg = cfg;
  ctx->cfg->in_use = 1;
  ctx->program_initialised = false;
  create_lock(&ctx->error_lock);
  create_lock(&ctx->lock);
  free_list_init(&ctx->free_list);
  event_list_init(&ctx->event_list);
  ctx->peak_mem_usage_default = 0;
  ctx->cur_mem_usage_default = 0;
  ctx->constants = malloc(sizeof(struct constants));
  ctx->debugging = cfg->debugging;
  ctx->logging = cfg->logging;
  ctx->detail_memory = cfg->logging;
  ctx->profiling = cfg->profiling;
  ctx->profiling_paused = 0;
  ctx->error = NULL;
  ctx->log = stderr;
  set_tuning_params(ctx);
  if (backend_context_setup(ctx) == 0) {
    setup_program(ctx);
    init_constants(ctx);
    ctx->program_initialised = true;
    (void)futhark_context_clear_caches(ctx);
    (void)futhark_context_sync(ctx);
  }
  return ctx;
}

void futhark_context_free(struct futhark_context* ctx) {
  if (ctx->program_initialised) {
    free_constants(ctx);
    teardown_program(ctx);
  }
  backend_context_teardown(ctx);
  free_all_in_free_list(ctx);
  free_list_destroy(&ctx->free_list);
  event_list_free(&ctx->event_list);
  free(ctx->constants);
  free(ctx->error);
  free_lock(&ctx->lock);
  free_lock(&ctx->error_lock);
  ctx->cfg->in_use = 0;
  free(ctx);
}

// End of context.h

// Start of copy.h

// Cache-oblivious map-transpose function.
#define GEN_MAP_TRANSPOSE(NAME, ELEM_TYPE)                              \
  static void map_transpose_##NAME                                      \
  (ELEM_TYPE* dst, ELEM_TYPE* src,                                      \
   int64_t k, int64_t m, int64_t n,                                     \
   int64_t cb, int64_t ce, int64_t rb, int64_t re)                      \
  {                                                                     \
  int32_t r = re - rb;                                                  \
  int32_t c = ce - cb;                                                  \
  if (k == 1) {                                                         \
    if (r <= 64 && c <= 64) {                                           \
      for (int64_t j = 0; j < c; j++) {                                 \
        for (int64_t i = 0; i < r; i++) {                               \
          dst[(j + cb) * n + (i + rb)] = src[(i + rb) * m + (j + cb)];  \
        }                                                               \
      }                                                                 \
    } else if (c <= r) {                                                \
      map_transpose_##NAME(dst, src, k, m, n, cb, ce, rb, rb + r/2);    \
      map_transpose_##NAME(dst, src, k, m, n, cb, ce, rb + r/2, re);    \
    } else {                                                            \
      map_transpose_##NAME(dst, src, k, m, n, cb, cb + c/2, rb, re);    \
      map_transpose_##NAME(dst, src, k, m, n, cb + c/2, ce, rb, re);    \
    }                                                                   \
  } else {                                                              \
  for (int64_t i = 0; i < k; i++) {                                     \
    map_transpose_##NAME(dst + i * m * n, src + i * m * n, 1, m, n, cb, ce, rb, re); \
  }\
} \
}

// Straightforward LMAD copy function.
#define GEN_LMAD_COPY_ELEMENTS(NAME, ELEM_TYPE)                         \
  static void lmad_copy_elements_##NAME(int r,                          \
                                        ELEM_TYPE* dst, int64_t dst_strides[r], \
                                        ELEM_TYPE *src, int64_t src_strides[r], \
                                        int64_t shape[r]) {             \
    if (r == 1) {                                                       \
      for (int i = 0; i < shape[0]; i++) {                              \
        dst[i*dst_strides[0]] = src[i*src_strides[0]];                  \
      }                                                                 \
    } else if (r > 1) {                                                 \
      for (int i = 0; i < shape[0]; i++) {                              \
        lmad_copy_elements_##NAME(r-1,                                  \
                                  dst+i*dst_strides[0], dst_strides+1,  \
                                  src+i*src_strides[0], src_strides+1,  \
                                  shape+1);                             \
      }                                                                 \
    }                                                                   \
  }                                                                     \

// Check whether this LMAD can be seen as a transposed 2D array.  This
// is done by checking every possible splitting point.
static bool lmad_is_tr(int64_t *n_out, int64_t *m_out,
                       int r,
                       const int64_t strides[r],
                       const int64_t shape[r]) {
  for (int i = 1; i < r; i++) {
    int n = 1, m = 1;
    bool ok = true;
    int64_t expected = 1;
    // Check strides before 'i'.
    for (int j = i-1; j >= 0; j--) {
      ok = ok && strides[j] == expected;
      expected *= shape[j];
      n *= shape[j];
    }
    // Check strides after 'i'.
    for (int j = r-1; j >= i; j--) {
      ok = ok && strides[j] == expected;
      expected *= shape[j];
      m *= shape[j];
    }
    if (ok) {
      *n_out = n;
      *m_out = m;
      return true;
    }
  }
  return false;
}

// This function determines whether the a 'dst' LMAD is row-major and
// 'src' LMAD is column-major.  Both LMADs are for arrays of the same
// shape.  Both LMADs are allowed to have additional dimensions "on
// top".  Essentially, this function determines whether a copy from
// 'src' to 'dst' is a "map(transpose)" that we know how to implement
// efficiently.  The LMADs can have arbitrary rank, and the main
// challenge here is checking whether the src LMAD actually
// corresponds to a 2D column-major layout by morally collapsing
// dimensions.  There is a lot of looping here, but the actual trip
// count is going to be very low in practice.
//
// Returns true if this is indeed a map(transpose), and writes the
// number of arrays, and moral array size to appropriate output
// parameters.
static bool lmad_map_tr(int64_t *num_arrays_out, int64_t *n_out, int64_t *m_out,
                        int r,
                        const int64_t dst_strides[r],
                        const int64_t src_strides[r],
                        const int64_t shape[r]) {
  int64_t rowmajor_strides[r];
  rowmajor_strides[r-1] = 1;

  for (int i = r-2; i >= 0; i--) {
    rowmajor_strides[i] = rowmajor_strides[i+1] * shape[i+1];
  }

  // map_r will be the number of mapped dimensions on top.
  int map_r = 0;
  int64_t num_arrays = 1;
  for (int i = 0; i < r; i++) {
    if (dst_strides[i] != rowmajor_strides[i] ||
        src_strides[i] != rowmajor_strides[i]) {
      break;
    } else {
      num_arrays *= shape[i];
      map_r++;
    }
  }

  *num_arrays_out = num_arrays;

  if (r==map_r) {
    return false;
  }

  if (memcmp(&rowmajor_strides[map_r],
             &dst_strides[map_r],
             sizeof(int64_t)*(r-map_r)) == 0) {
    return lmad_is_tr(n_out, m_out, r-map_r, src_strides+map_r, shape+map_r);
  } else if (memcmp(&rowmajor_strides[map_r],
                    &src_strides[map_r],
                    sizeof(int64_t)*(r-map_r)) == 0) {
    return lmad_is_tr(m_out, n_out, r-map_r, dst_strides+map_r, shape+map_r);
  }
  return false;
}

// Check if the strides correspond to row-major strides of *any*
// permutation of the shape.  This is done by recursive search with
// backtracking.  This is worst-case exponential, but hopefully the
// arrays we encounter do not have that many dimensions.
static bool lmad_contiguous_search(int checked, int64_t expected,
                                   int r,
                                   int64_t strides[r], int64_t shape[r], bool used[r]) {
  for (int i = 0; i < r; i++) {
    for (int j = 0; j < r; j++) {
      if (!used[j] && strides[j] == expected && strides[j] >= 0) {
        used[j] = true;
        if (checked+1 == r ||
            lmad_contiguous_search(checked+1, expected * shape[j], r, strides, shape, used)) {
          return true;
        }
        used[j] = false;
      }
    }
  }
  return false;
}

// Does this LMAD correspond to an array with positive strides and no
// holes?
static bool lmad_contiguous(int r, int64_t strides[r], int64_t shape[r]) {
  bool used[r];
  for (int i = 0; i < r; i++) {
    used[i] = false;
  }
  return lmad_contiguous_search(0, 1, r, strides, shape, used);
}

// Does this copy correspond to something that could be done with a
// memcpy()-like operation?  I.e. do the LMADs actually represent the
// same in-memory layout and are they contiguous?
static bool lmad_memcpyable(int r,
                            int64_t dst_strides[r], int64_t src_strides[r], int64_t shape[r]) {
  if (!lmad_contiguous(r, dst_strides, shape)) {
    return false;
  }
  for (int i = 0; i < r; i++) {
    if (dst_strides[i] != src_strides[i] && shape[i] != 1) {
      return false;
    }
  }
  return true;
}


static void log_copy(struct futhark_context* ctx,
                     const char *kind, int r,
                     int64_t dst_offset, int64_t dst_strides[r],
                     int64_t src_offset, int64_t src_strides[r],
                     int64_t shape[r]) {
  if (ctx->logging) {
    fprintf(ctx->log, "\n# Copy %s\n", kind);
    fprintf(ctx->log, "Shape: ");
    for (int i = 0; i < r; i++) { fprintf(ctx->log, "[%ld]", (long int)shape[i]); }
    fprintf(ctx->log, "\n");
    fprintf(ctx->log, "Dst offset: %ld\n", (long int)dst_offset);
    fprintf(ctx->log, "Dst strides:");
    for (int i = 0; i < r; i++) { fprintf(ctx->log, " %ld", (long int)dst_strides[i]); }
    fprintf(ctx->log, "\n");
    fprintf(ctx->log, "Src offset: %ld\n", (long int)src_offset);
    fprintf(ctx->log, "Src strides:");
    for (int i = 0; i < r; i++) { fprintf(ctx->log, " %ld", (long int)src_strides[i]); }
    fprintf(ctx->log, "\n");
  }
}

static void log_transpose(struct futhark_context* ctx,
                          int64_t k, int64_t n, int64_t m) {
  if (ctx->logging) {
    fprintf(ctx->log, "## Transpose\n");
    fprintf(ctx->log, "Arrays     : %ld\n", (long int)k);
    fprintf(ctx->log, "X elements : %ld\n", (long int)m);
    fprintf(ctx->log, "Y elements : %ld\n", (long int)n);
    fprintf(ctx->log, "\n");
  }
}

#define GEN_LMAD_COPY(NAME, ELEM_TYPE)                                  \
  static void lmad_copy_##NAME                                          \
  (struct futhark_context *ctx, int r,                                  \
   ELEM_TYPE* dst, int64_t dst_offset, int64_t dst_strides[r],          \
   ELEM_TYPE *src, int64_t src_offset, int64_t src_strides[r],          \
   int64_t shape[r]) {                                                  \
    log_copy(ctx, "CPU to CPU", r, dst_offset, dst_strides,             \
             src_offset, src_strides, shape);                           \
    int64_t size = 1;                                                   \
    for (int i = 0; i < r; i++) { size *= shape[i]; }                   \
    if (size == 0) { return; }                                          \
    int64_t k, n, m;                                                    \
    if (lmad_map_tr(&k, &n, &m,                                         \
                    r, dst_strides, src_strides, shape)) {              \
      log_transpose(ctx, k, n, m);                                      \
      map_transpose_##NAME                                              \
        (dst+dst_offset, src+src_offset, k, n, m, 0, n, 0, m);          \
    } else if (lmad_memcpyable(r, dst_strides, src_strides, shape)) {   \
      if (ctx->logging) {fprintf(ctx->log, "## Flat copy\n\n");}          \
      memcpy(dst+dst_offset, src+src_offset, size*sizeof(*dst));        \
    } else {                                                            \
      if (ctx->logging) {fprintf(ctx->log, "## General copy\n\n");}       \
      lmad_copy_elements_##NAME                                         \
        (r,                                                             \
         dst+dst_offset, dst_strides,                                   \
         src+src_offset, src_strides, shape);                           \
    }                                                                   \
  }

GEN_MAP_TRANSPOSE(1b, uint8_t)
GEN_MAP_TRANSPOSE(2b, uint16_t)
GEN_MAP_TRANSPOSE(4b, uint32_t)
GEN_MAP_TRANSPOSE(8b, uint64_t)

GEN_LMAD_COPY_ELEMENTS(1b, uint8_t)
GEN_LMAD_COPY_ELEMENTS(2b, uint16_t)
GEN_LMAD_COPY_ELEMENTS(4b, uint32_t)
GEN_LMAD_COPY_ELEMENTS(8b, uint64_t)

GEN_LMAD_COPY(1b, uint8_t)
GEN_LMAD_COPY(2b, uint16_t)
GEN_LMAD_COPY(4b, uint32_t)
GEN_LMAD_COPY(8b, uint64_t)

// End of copy.h

#define FUTHARK_FUN_ATTR static

FUTHARK_FUN_ATTR int futrts_builtinzhiota_i64(struct futhark_context *ctx, struct memblock_device mem_50375, int64_t n_50376, int64_t x_50377, int64_t s_50378);
FUTHARK_FUN_ATTR int futrts_builtinzhreplicate_bool(struct futhark_context *ctx, struct memblock_device mem_51016, int64_t num_elems_51017, bool val_51018);
FUTHARK_FUN_ATTR int futrts_builtinzhreplicate_f64(struct futhark_context *ctx, struct memblock_device mem_50450, int64_t num_elems_50451, double val_50452);
FUTHARK_FUN_ATTR int futrts_builtinzhreplicate_i32(struct futhark_context *ctx, struct memblock_device mem_50277, int64_t num_elems_50278, int32_t val_50279);
FUTHARK_FUN_ATTR int futrts_builtinzhreplicate_i64(struct futhark_context *ctx, struct memblock_device mem_50192, int64_t num_elems_50193, int64_t val_50194);
FUTHARK_FUN_ATTR int futrts_builtinzhreplicate_i8(struct futhark_context *ctx, struct memblock_device mem_50242, int64_t num_elems_50243, int8_t val_50244);
FUTHARK_FUN_ATTR int futrts_entry_add_next_partition_double(struct futhark_context *ctx, struct memblock_device *mem_out_p_52084, struct memblock_device *mem_out_p_52085, struct memblock_device *mem_out_p_52086, struct memblock_device *mem_out_p_52087, struct memblock_device *mem_out_p_52088, struct memblock_device *mem_out_p_52089, struct memblock_device *mem_out_p_52090, struct memblock_device *mem_out_p_52091, struct memblock_device *mem_out_p_52092, struct memblock_device *mem_out_p_52093, struct memblock_device *mem_out_p_52094, struct memblock_device *mem_out_p_52095, struct memblock_device *mem_out_p_52096, struct memblock_device *mem_out_p_52097, struct memblock_device *mem_out_p_52098, struct memblock_device *mem_out_p_52099, struct memblock_device *mem_out_p_52100, struct memblock_device *mem_out_p_52101, struct memblock_device *mem_out_p_52102, struct memblock_device *mem_out_p_52103, struct memblock_device *mem_out_p_52104, struct memblock_device *mem_out_p_52105, struct memblock_device *mem_out_p_52106, struct memblock_device *mem_out_p_52107, struct memblock_device *mem_out_p_52108, struct memblock_device *mem_out_p_52109, struct memblock_device *mem_out_p_52110, int64_t *out_prim_out_52111, int64_t *out_prim_out_52112, int64_t *out_prim_out_52113, int8_t *out_prim_out_52114, int8_t *out_prim_out_52115, double *out_prim_out_52116, int64_t *out_prim_out_52117, int64_t *out_prim_out_52118, double *out_prim_out_52119, int64_t *out_prim_out_52120, int64_t *out_prim_out_52121, int64_t *out_prim_out_52122, int64_t *out_prim_out_52123, int64_t *out_prim_out_52124, int64_t *out_prim_out_52125, int64_t *out_prim_out_52126, struct memblock_device chain_collisions_mem_49374, struct memblock_device chain_collisions_mem_49375, struct memblock_device clBase_mem_49376, struct memblock_device clBase_mem_49377, struct memblock_device clBase_mem_49378, struct memblock_device clBase_mem_49379, struct memblock_device clProc_mem_49380, struct memblock_device clProc_mem_49381, struct memblock_device clProc_mem_49382, struct memblock_device clProc_mem_49383, struct memblock_device clProc_mem_49384, struct memblock_device clProc_mem_49385, struct memblock_device current_partition_mem_49386, struct memblock_device current_partition_mem_49387, struct memblock_device current_partition_mem_49388, struct memblock_device current_partition_mem_49389, struct memblock_device current_partition_mem_49390, struct memblock_device current_partition_mem_49391, struct memblock_device current_partition_mem_49392, struct memblock_device current_partition_mem_49393, struct memblock_device current_partition_mem_49394, struct memblock_device current_partition_mem_49395, struct memblock_device current_partition_mem_49396, struct memblock_device current_partition_mem_49397, struct memblock_device toFlush_dat_mem_49398, struct memblock_device toFlush_dat_mem_49399, struct memblock_device toFlush_ids_mem_49400, struct memblock_device new_xs_mem_49401, struct memblock_device new_ys_mem_49402, int64_t n_old_27030, int64_t part_no_27031, int64_t dz2084U_27032, int64_t dz2080U_27033, int64_t dz2081U_27034, int64_t dz2082U_27035, int64_t dz2083U_27036, int64_t dz2085U_27037, int64_t dz2086U_27038, int64_t n_new_27039, int8_t clBase_27042, int8_t clBase_27043, double clBase_27044, int64_t clBase_27045, int64_t clBase_27047, double clBase_27050, int64_t clBase_27052, int64_t clProc_27057, int64_t clProc_27058, int64_t clProc_27059, int64_t clProc_27061, int64_t clProc_27062, int64_t current_partition_27076, int64_t new_id_27080);
FUTHARK_FUN_ATTR int futrts_entry_do_DBSCAN_double(struct futhark_context *ctx, struct memblock_device *mem_out_p_52131, struct memblock_device *mem_out_p_52132, struct memblock_device *mem_out_p_52133, struct memblock_device *mem_out_p_52134, struct memblock_device *mem_out_p_52135, struct memblock_device *mem_out_p_52136, struct memblock_device *mem_out_p_52137, struct memblock_device *mem_out_p_52138, struct memblock_device *mem_out_p_52139, struct memblock_device *mem_out_p_52140, struct memblock_device *mem_out_p_52141, struct memblock_device *mem_out_p_52142, struct memblock_device *mem_out_p_52143, struct memblock_device *mem_out_p_52144, struct memblock_device *mem_out_p_52145, struct memblock_device *mem_out_p_52146, struct memblock_device *mem_out_p_52147, struct memblock_device *mem_out_p_52148, struct memblock_device *mem_out_p_52149, struct memblock_device *mem_out_p_52150, struct memblock_device *mem_out_p_52151, struct memblock_device *mem_out_p_52152, struct memblock_device *mem_out_p_52153, struct memblock_device *mem_out_p_52154, struct memblock_device *mem_out_p_52155, struct memblock_device *mem_out_p_52156, struct memblock_device *mem_out_p_52157, int64_t *out_prim_out_52158, int8_t *out_prim_out_52159, int8_t *out_prim_out_52160, double *out_prim_out_52161, int64_t *out_prim_out_52162, int64_t *out_prim_out_52163, double *out_prim_out_52164, int64_t *out_prim_out_52165, int64_t *out_prim_out_52166, int64_t *out_prim_out_52167, int64_t *out_prim_out_52168, int64_t *out_prim_out_52169, int64_t *out_prim_out_52170, int64_t *out_prim_out_52171, struct memblock_device chain_collisions_mem_49374, struct memblock_device chain_collisions_mem_49375, struct memblock_device clBase_mem_49376, struct memblock_device clBase_mem_49377, struct memblock_device clBase_mem_49378, struct memblock_device clBase_mem_49379, struct memblock_device clProc_mem_49380, struct memblock_device clProc_mem_49381, struct memblock_device clProc_mem_49382, struct memblock_device clProc_mem_49383, struct memblock_device clProc_mem_49384, struct memblock_device clProc_mem_49385, struct memblock_device current_partition_mem_49386, struct memblock_device current_partition_mem_49387, struct memblock_device current_partition_mem_49388, struct memblock_device current_partition_mem_49389, struct memblock_device current_partition_mem_49390, struct memblock_device current_partition_mem_49391, struct memblock_device current_partition_mem_49392, struct memblock_device current_partition_mem_49393, struct memblock_device current_partition_mem_49394, struct memblock_device current_partition_mem_49395, struct memblock_device current_partition_mem_49396, struct memblock_device current_partition_mem_49397, struct memblock_device toFlush_dat_mem_49398, struct memblock_device toFlush_dat_mem_49399, struct memblock_device toFlush_ids_mem_49400, int64_t n_34757, int64_t part_no_34758, int64_t dz2084U_34759, int64_t dz2080U_34760, int64_t dz2081U_34761, int64_t dz2082U_34762, int64_t dz2083U_34763, int64_t dz2085U_34764, int64_t dz2086U_34765, int8_t clBase_34768, int8_t clBase_34769, double clBase_34770, int64_t clBase_34771, int64_t clBase_34773, double clBase_34776, int64_t clBase_34778, int64_t clProc_34783, int64_t clProc_34784, int64_t clProc_34785, int64_t clProc_34787, int64_t clProc_34788, int64_t current_partition_34802, int64_t gather_psizze_34806);
FUTHARK_FUN_ATTR int futrts_entry_flush_dat_double(struct futhark_context *ctx, struct memblock_device *mem_out_p_52181, struct memblock_device *mem_out_p_52182, struct memblock_device *mem_out_p_52183, struct memblock_device chain_collisions_mem_49374, struct memblock_device chain_collisions_mem_49375, struct memblock_device clBase_mem_49376, struct memblock_device clBase_mem_49377, struct memblock_device clBase_mem_49378, struct memblock_device clBase_mem_49379, struct memblock_device clProc_mem_49380, struct memblock_device clProc_mem_49381, struct memblock_device clProc_mem_49382, struct memblock_device clProc_mem_49383, struct memblock_device clProc_mem_49384, struct memblock_device clProc_mem_49385, struct memblock_device current_partition_mem_49386, struct memblock_device current_partition_mem_49387, struct memblock_device current_partition_mem_49388, struct memblock_device current_partition_mem_49389, struct memblock_device current_partition_mem_49390, struct memblock_device current_partition_mem_49391, struct memblock_device current_partition_mem_49392, struct memblock_device current_partition_mem_49393, struct memblock_device current_partition_mem_49394, struct memblock_device current_partition_mem_49395, struct memblock_device current_partition_mem_49396, struct memblock_device current_partition_mem_49397, struct memblock_device toFlush_dat_mem_49398, struct memblock_device toFlush_dat_mem_49399, struct memblock_device toFlush_ids_mem_49400, int64_t n_27268, int64_t part_no_27269, int64_t dz2084U_27270, int64_t dz2080U_27271, int64_t dz2081U_27272, int64_t dz2082U_27273, int64_t dz2083U_27274, int64_t dz2085U_27275, int64_t dz2086U_27276, int8_t clBase_27279, int8_t clBase_27280, double clBase_27281, int64_t clBase_27282, int64_t clBase_27284, double clBase_27287, int64_t clBase_27289, int64_t clProc_27294, int64_t clProc_27295, int64_t clProc_27296, int64_t clProc_27298, int64_t clProc_27299, int64_t current_partition_27313);
FUTHARK_FUN_ATTR int futrts_entry_make_collisions_compact_double(struct futhark_context *ctx, struct memblock_device *mem_out_p_52184, struct memblock_device *mem_out_p_52185, int64_t *out_prim_out_52186, struct memblock_device chain_collisions_mem_49374, struct memblock_device chain_collisions_mem_49375, struct memblock_device clBase_mem_49376, struct memblock_device clBase_mem_49377, struct memblock_device clBase_mem_49378, struct memblock_device clBase_mem_49379, struct memblock_device clProc_mem_49380, struct memblock_device clProc_mem_49381, struct memblock_device clProc_mem_49382, struct memblock_device clProc_mem_49383, struct memblock_device clProc_mem_49384, struct memblock_device clProc_mem_49385, struct memblock_device current_partition_mem_49386, struct memblock_device current_partition_mem_49387, struct memblock_device current_partition_mem_49388, struct memblock_device current_partition_mem_49389, struct memblock_device current_partition_mem_49390, struct memblock_device current_partition_mem_49391, struct memblock_device current_partition_mem_49392, struct memblock_device current_partition_mem_49393, struct memblock_device current_partition_mem_49394, struct memblock_device current_partition_mem_49395, struct memblock_device current_partition_mem_49396, struct memblock_device current_partition_mem_49397, struct memblock_device toFlush_dat_mem_49398, struct memblock_device toFlush_dat_mem_49399, struct memblock_device toFlush_ids_mem_49400, int64_t n_35568, int64_t part_no_35569, int64_t dz2084U_35570, int64_t dz2080U_35571, int64_t dz2081U_35572, int64_t dz2082U_35573, int64_t dz2083U_35574, int64_t dz2085U_35575, int64_t dz2086U_35576, int8_t clBase_35579, int8_t clBase_35580, double clBase_35581, int64_t clBase_35582, int64_t clBase_35584, double clBase_35587, int64_t clBase_35589, int64_t clProc_35594, int64_t clProc_35595, int64_t clProc_35596, int64_t clProc_35598, int64_t clProc_35599, int64_t current_partition_35613);
FUTHARK_FUN_ATTR int futrts_entry_mk_dbcHandler_double(struct futhark_context *ctx, struct memblock_device *mem_out_p_52188, struct memblock_device *mem_out_p_52189, struct memblock_device *mem_out_p_52190, struct memblock_device *mem_out_p_52191, struct memblock_device *mem_out_p_52192, struct memblock_device *mem_out_p_52193, struct memblock_device *mem_out_p_52194, struct memblock_device *mem_out_p_52195, struct memblock_device *mem_out_p_52196, struct memblock_device *mem_out_p_52197, struct memblock_device *mem_out_p_52198, struct memblock_device *mem_out_p_52199, struct memblock_device *mem_out_p_52200, struct memblock_device *mem_out_p_52201, struct memblock_device *mem_out_p_52202, struct memblock_device *mem_out_p_52203, struct memblock_device *mem_out_p_52204, struct memblock_device *mem_out_p_52205, struct memblock_device *mem_out_p_52206, struct memblock_device *mem_out_p_52207, struct memblock_device *mem_out_p_52208, struct memblock_device *mem_out_p_52209, struct memblock_device *mem_out_p_52210, struct memblock_device *mem_out_p_52211, struct memblock_device *mem_out_p_52212, struct memblock_device *mem_out_p_52213, struct memblock_device *mem_out_p_52214, int64_t *out_prim_out_52215, int8_t *out_prim_out_52216, int8_t *out_prim_out_52217, double *out_prim_out_52218, int64_t *out_prim_out_52219, int64_t *out_prim_out_52220, double *out_prim_out_52221, int64_t *out_prim_out_52222, int64_t *out_prim_out_52223, int64_t *out_prim_out_52224, int64_t *out_prim_out_52225, int64_t *out_prim_out_52226, int64_t *out_prim_out_52227, int64_t *out_prim_out_52228, double min_x_22265, double min_y_22266, double max_x_22267, double max_y_22268, int64_t parts_x_22269, int64_t parts_y_22270, bool isEuclidean_22271, bool isRadians_22272, double radius_22273, double eps_22274, int64_t minPts_22275, int64_t m_sizze_22276);
FUTHARK_FUN_ATTR int futrts_entry_next_partition_to_read_double(struct futhark_context *ctx, int64_t *out_prim_out_52229, struct memblock_device chain_collisions_mem_49374, struct memblock_device chain_collisions_mem_49375, struct memblock_device clBase_mem_49376, struct memblock_device clBase_mem_49377, struct memblock_device clBase_mem_49378, struct memblock_device clBase_mem_49379, struct memblock_device clProc_mem_49380, struct memblock_device clProc_mem_49381, struct memblock_device clProc_mem_49382, struct memblock_device clProc_mem_49383, struct memblock_device clProc_mem_49384, struct memblock_device clProc_mem_49385, struct memblock_device current_partition_mem_49386, struct memblock_device current_partition_mem_49387, struct memblock_device current_partition_mem_49388, struct memblock_device current_partition_mem_49389, struct memblock_device current_partition_mem_49390, struct memblock_device current_partition_mem_49391, struct memblock_device current_partition_mem_49392, struct memblock_device current_partition_mem_49393, struct memblock_device current_partition_mem_49394, struct memblock_device current_partition_mem_49395, struct memblock_device current_partition_mem_49396, struct memblock_device current_partition_mem_49397, struct memblock_device toFlush_dat_mem_49398, struct memblock_device toFlush_dat_mem_49399, struct memblock_device toFlush_ids_mem_49400, int64_t n_22872, int64_t part_no_22873, int64_t dz2084U_22874, int64_t dz2080U_22875, int64_t dz2081U_22876, int64_t dz2082U_22877, int64_t dz2083U_22878, int64_t dz2085U_22879, int64_t dz2086U_22880, int8_t clBase_22883, int8_t clBase_22884, double clBase_22885, int64_t clBase_22886, int64_t clBase_22888, double clBase_22891, int64_t clBase_22893, int64_t clProc_22898, int64_t clProc_22899, int64_t clProc_22900, int64_t clProc_22902, int64_t clProc_22903, int64_t current_partition_22917);
FUTHARK_FUN_ATTR int futrts_entry_rectify_partition_ids_double(struct futhark_context *ctx, struct memblock_device *mem_out_p_52233, struct memblock_device partition_ids_mem_49374, struct memblock_device chain_id_mem_49375, struct memblock_device replaceWith_mem_49376, int64_t n_35911, int64_t dz2081Uz2080U_35912, int64_t dz2081Uz2081U_35913, int64_t m_sizze_35917);
FUTHARK_FUN_ATTR int futrts_get_num_neighbours_against_9632(struct futhark_context *ctx, struct memblock_device *mem_out_p_52234, struct memblock_device dat1_mem_49374, struct memblock_device dat1_mem_49375, struct memblock_device dat2_mem_49376, struct memblock_device dat2_mem_49377, int64_t n1_28207, int64_t n2_28208, double eps_28213, int8_t dist_t_28214, int8_t angle_t_28215, double radius_28216, int64_t m_sizze_28217);
FUTHARK_FUN_ATTR int futrts_get_num_neighbours_against_9635(struct futhark_context *ctx, struct memblock_device *mem_out_p_52235, struct memblock_device dat1_mem_49374, struct memblock_device dat1_mem_49375, struct memblock_device dat2_mem_49376, struct memblock_device dat2_mem_49377, int64_t n1_28464, int64_t n2_28465, double eps_28470, int8_t dist_t_28471, int8_t angle_t_28472, double radius_28473, int64_t m_sizze_28474);

static int init_constants(struct futhark_context *ctx)
{
    (void) ctx;
    
    int err = 0;
    
    #define counters_mem_50201 (ctx->constants->counters_mem_50201)
    #define counters_mem_50275 (ctx->constants->counters_mem_50275)
    #define counters_mem_50707 (ctx->constants->counters_mem_50707)
    #define counters_mem_51122 (ctx->constants->counters_mem_51122)
    #define counters_mem_51145 (ctx->constants->counters_mem_51145)
    #define counters_mem_51184 (ctx->constants->counters_mem_51184)
    #define counters_mem_51873 (ctx->constants->counters_mem_51873)
    #define counters_mem_52032 (ctx->constants->counters_mem_52032)
    #define global_dynid_mem_50266 (ctx->constants->global_dynid_mem_50266)
    #define global_dynid_mem_50275 (ctx->constants->global_dynid_mem_50275)
    #define global_dynid_mem_50287 (ctx->constants->global_dynid_mem_50287)
    #define global_dynid_mem_50292 (ctx->constants->global_dynid_mem_50292)
    #define global_dynid_mem_50450 (ctx->constants->global_dynid_mem_50450)
    #define global_dynid_mem_50529 (ctx->constants->global_dynid_mem_50529)
    #define global_dynid_mem_50570 (ctx->constants->global_dynid_mem_50570)
    #define global_dynid_mem_50733 (ctx->constants->global_dynid_mem_50733)
    #define global_dynid_mem_50769 (ctx->constants->global_dynid_mem_50769)
    #define global_dynid_mem_50871 (ctx->constants->global_dynid_mem_50871)
    #define global_dynid_mem_50875 (ctx->constants->global_dynid_mem_50875)
    #define global_dynid_mem_50988 (ctx->constants->global_dynid_mem_50988)
    #define global_dynid_mem_51231 (ctx->constants->global_dynid_mem_51231)
    #define global_dynid_mem_51378 (ctx->constants->global_dynid_mem_51378)
    #define global_dynid_mem_51534 (ctx->constants->global_dynid_mem_51534)
    #define global_dynid_mem_51651 (ctx->constants->global_dynid_mem_51651)
    counters_mem_50201.references = NULL;
    counters_mem_50275.references = NULL;
    counters_mem_50707.references = NULL;
    counters_mem_51122.references = NULL;
    counters_mem_51145.references = NULL;
    counters_mem_51184.references = NULL;
    counters_mem_51873.references = NULL;
    counters_mem_52032.references = NULL;
    global_dynid_mem_50266.references = NULL;
    global_dynid_mem_50275.references = NULL;
    global_dynid_mem_50287.references = NULL;
    global_dynid_mem_50292.references = NULL;
    global_dynid_mem_50450.references = NULL;
    global_dynid_mem_50529.references = NULL;
    global_dynid_mem_50570.references = NULL;
    global_dynid_mem_50733.references = NULL;
    global_dynid_mem_50769.references = NULL;
    global_dynid_mem_50871.references = NULL;
    global_dynid_mem_50875.references = NULL;
    global_dynid_mem_50988.references = NULL;
    global_dynid_mem_51231.references = NULL;
    global_dynid_mem_51378.references = NULL;
    global_dynid_mem_51534.references = NULL;
    global_dynid_mem_51651.references = NULL;
    if (memblock_alloc_device(ctx, &counters_mem_50201, (int64_t) 80, "counters_mem_50201")) {
        err = 1;
        goto cleanup;
    }
    if (futrts_builtinzhreplicate_i32(ctx, counters_mem_50201, (int64_t) 20, 0) != 0) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &global_dynid_mem_50287, (int64_t) 4, "global_dynid_mem_50287")) {
        err = 1;
        goto cleanup;
    }
    if (futrts_builtinzhreplicate_i32(ctx, global_dynid_mem_50287, (int64_t) 1, 0) != 0) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &global_dynid_mem_50292, (int64_t) 4, "global_dynid_mem_50292")) {
        err = 1;
        goto cleanup;
    }
    if (futrts_builtinzhreplicate_i32(ctx, global_dynid_mem_50292, (int64_t) 1, 0) != 0) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &global_dynid_mem_50275, (int64_t) 4, "global_dynid_mem_50275")) {
        err = 1;
        goto cleanup;
    }
    if (futrts_builtinzhreplicate_i32(ctx, global_dynid_mem_50275, (int64_t) 1, 0) != 0) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &global_dynid_mem_50529, (int64_t) 4, "global_dynid_mem_50529")) {
        err = 1;
        goto cleanup;
    }
    if (futrts_builtinzhreplicate_i32(ctx, global_dynid_mem_50529, (int64_t) 1, 0) != 0) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &counters_mem_50707, (int64_t) 81920, "counters_mem_50707")) {
        err = 1;
        goto cleanup;
    }
    if (futrts_builtinzhreplicate_i32(ctx, counters_mem_50707, (int64_t) 20480, 0) != 0) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &global_dynid_mem_50769, (int64_t) 4, "global_dynid_mem_50769")) {
        err = 1;
        goto cleanup;
    }
    if (futrts_builtinzhreplicate_i32(ctx, global_dynid_mem_50769, (int64_t) 1, 0) != 0) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &global_dynid_mem_50875, (int64_t) 4, "global_dynid_mem_50875")) {
        err = 1;
        goto cleanup;
    }
    if (futrts_builtinzhreplicate_i32(ctx, global_dynid_mem_50875, (int64_t) 1, 0) != 0) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &counters_mem_51122, (int64_t) 81920, "counters_mem_51122")) {
        err = 1;
        goto cleanup;
    }
    if (futrts_builtinzhreplicate_i32(ctx, counters_mem_51122, (int64_t) 20480, 0) != 0) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &global_dynid_mem_50266, (int64_t) 4, "global_dynid_mem_50266")) {
        err = 1;
        goto cleanup;
    }
    if (futrts_builtinzhreplicate_i32(ctx, global_dynid_mem_50266, (int64_t) 1, 0) != 0) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &global_dynid_mem_50450, (int64_t) 4, "global_dynid_mem_50450")) {
        err = 1;
        goto cleanup;
    }
    if (futrts_builtinzhreplicate_i32(ctx, global_dynid_mem_50450, (int64_t) 1, 0) != 0) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &global_dynid_mem_50570, (int64_t) 4, "global_dynid_mem_50570")) {
        err = 1;
        goto cleanup;
    }
    if (futrts_builtinzhreplicate_i32(ctx, global_dynid_mem_50570, (int64_t) 1, 0) != 0) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &global_dynid_mem_50733, (int64_t) 4, "global_dynid_mem_50733")) {
        err = 1;
        goto cleanup;
    }
    if (futrts_builtinzhreplicate_i32(ctx, global_dynid_mem_50733, (int64_t) 1, 0) != 0) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &global_dynid_mem_50871, (int64_t) 4, "global_dynid_mem_50871")) {
        err = 1;
        goto cleanup;
    }
    if (futrts_builtinzhreplicate_i32(ctx, global_dynid_mem_50871, (int64_t) 1, 0) != 0) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &global_dynid_mem_50988, (int64_t) 4, "global_dynid_mem_50988")) {
        err = 1;
        goto cleanup;
    }
    if (futrts_builtinzhreplicate_i32(ctx, global_dynid_mem_50988, (int64_t) 1, 0) != 0) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &counters_mem_51145, (int64_t) 81920, "counters_mem_51145")) {
        err = 1;
        goto cleanup;
    }
    if (futrts_builtinzhreplicate_i32(ctx, counters_mem_51145, (int64_t) 20480, 0) != 0) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &counters_mem_51184, (int64_t) 80, "counters_mem_51184")) {
        err = 1;
        goto cleanup;
    }
    if (futrts_builtinzhreplicate_i32(ctx, counters_mem_51184, (int64_t) 20, 0) != 0) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &global_dynid_mem_51231, (int64_t) 4, "global_dynid_mem_51231")) {
        err = 1;
        goto cleanup;
    }
    if (futrts_builtinzhreplicate_i32(ctx, global_dynid_mem_51231, (int64_t) 1, 0) != 0) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &global_dynid_mem_51378, (int64_t) 4, "global_dynid_mem_51378")) {
        err = 1;
        goto cleanup;
    }
    if (futrts_builtinzhreplicate_i32(ctx, global_dynid_mem_51378, (int64_t) 1, 0) != 0) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &global_dynid_mem_51534, (int64_t) 4, "global_dynid_mem_51534")) {
        err = 1;
        goto cleanup;
    }
    if (futrts_builtinzhreplicate_i32(ctx, global_dynid_mem_51534, (int64_t) 1, 0) != 0) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &global_dynid_mem_51651, (int64_t) 4, "global_dynid_mem_51651")) {
        err = 1;
        goto cleanup;
    }
    if (futrts_builtinzhreplicate_i32(ctx, global_dynid_mem_51651, (int64_t) 1, 0) != 0) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &counters_mem_51873, (int64_t) 81920, "counters_mem_51873")) {
        err = 1;
        goto cleanup;
    }
    if (futrts_builtinzhreplicate_i32(ctx, counters_mem_51873, (int64_t) 20480, 0) != 0) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &counters_mem_52032, (int64_t) 81920, "counters_mem_52032")) {
        err = 1;
        goto cleanup;
    }
    if (futrts_builtinzhreplicate_i32(ctx, counters_mem_52032, (int64_t) 20480, 0) != 0) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &counters_mem_50275, (int64_t) 81920, "counters_mem_50275")) {
        err = 1;
        goto cleanup;
    }
    if (futrts_builtinzhreplicate_i32(ctx, counters_mem_50275, (int64_t) 20480, 0) != 0) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &counters_mem_50275, (int64_t) 81920, "counters_mem_50275")) {
        err = 1;
        goto cleanup;
    }
    if (futrts_builtinzhreplicate_i32(ctx, counters_mem_50275, (int64_t) 20480, 0) != 0) {
        err = 1;
        goto cleanup;
    }
    #undef counters_mem_50201
    #undef counters_mem_50275
    #undef counters_mem_50707
    #undef counters_mem_51122
    #undef counters_mem_51145
    #undef counters_mem_51184
    #undef counters_mem_51873
    #undef counters_mem_52032
    #undef global_dynid_mem_50266
    #undef global_dynid_mem_50275
    #undef global_dynid_mem_50287
    #undef global_dynid_mem_50292
    #undef global_dynid_mem_50450
    #undef global_dynid_mem_50529
    #undef global_dynid_mem_50570
    #undef global_dynid_mem_50733
    #undef global_dynid_mem_50769
    #undef global_dynid_mem_50871
    #undef global_dynid_mem_50875
    #undef global_dynid_mem_50988
    #undef global_dynid_mem_51231
    #undef global_dynid_mem_51378
    #undef global_dynid_mem_51534
    #undef global_dynid_mem_51651
    
  cleanup:
    return err;
}
static int free_constants(struct futhark_context *ctx)
{
    (void) ctx;
    if (memblock_unref_device(ctx, &ctx->constants->counters_mem_50201, "ctx->constants->counters_mem_50201") != 0)
        return 1;
    if (memblock_unref_device(ctx, &ctx->constants->counters_mem_50275, "ctx->constants->counters_mem_50275") != 0)
        return 1;
    if (memblock_unref_device(ctx, &ctx->constants->counters_mem_50707, "ctx->constants->counters_mem_50707") != 0)
        return 1;
    if (memblock_unref_device(ctx, &ctx->constants->counters_mem_51122, "ctx->constants->counters_mem_51122") != 0)
        return 1;
    if (memblock_unref_device(ctx, &ctx->constants->counters_mem_51145, "ctx->constants->counters_mem_51145") != 0)
        return 1;
    if (memblock_unref_device(ctx, &ctx->constants->counters_mem_51184, "ctx->constants->counters_mem_51184") != 0)
        return 1;
    if (memblock_unref_device(ctx, &ctx->constants->counters_mem_51873, "ctx->constants->counters_mem_51873") != 0)
        return 1;
    if (memblock_unref_device(ctx, &ctx->constants->counters_mem_52032, "ctx->constants->counters_mem_52032") != 0)
        return 1;
    if (memblock_unref_device(ctx, &ctx->constants->global_dynid_mem_50266, "ctx->constants->global_dynid_mem_50266") != 0)
        return 1;
    if (memblock_unref_device(ctx, &ctx->constants->global_dynid_mem_50275, "ctx->constants->global_dynid_mem_50275") != 0)
        return 1;
    if (memblock_unref_device(ctx, &ctx->constants->global_dynid_mem_50287, "ctx->constants->global_dynid_mem_50287") != 0)
        return 1;
    if (memblock_unref_device(ctx, &ctx->constants->global_dynid_mem_50292, "ctx->constants->global_dynid_mem_50292") != 0)
        return 1;
    if (memblock_unref_device(ctx, &ctx->constants->global_dynid_mem_50450, "ctx->constants->global_dynid_mem_50450") != 0)
        return 1;
    if (memblock_unref_device(ctx, &ctx->constants->global_dynid_mem_50529, "ctx->constants->global_dynid_mem_50529") != 0)
        return 1;
    if (memblock_unref_device(ctx, &ctx->constants->global_dynid_mem_50570, "ctx->constants->global_dynid_mem_50570") != 0)
        return 1;
    if (memblock_unref_device(ctx, &ctx->constants->global_dynid_mem_50733, "ctx->constants->global_dynid_mem_50733") != 0)
        return 1;
    if (memblock_unref_device(ctx, &ctx->constants->global_dynid_mem_50769, "ctx->constants->global_dynid_mem_50769") != 0)
        return 1;
    if (memblock_unref_device(ctx, &ctx->constants->global_dynid_mem_50871, "ctx->constants->global_dynid_mem_50871") != 0)
        return 1;
    if (memblock_unref_device(ctx, &ctx->constants->global_dynid_mem_50875, "ctx->constants->global_dynid_mem_50875") != 0)
        return 1;
    if (memblock_unref_device(ctx, &ctx->constants->global_dynid_mem_50988, "ctx->constants->global_dynid_mem_50988") != 0)
        return 1;
    if (memblock_unref_device(ctx, &ctx->constants->global_dynid_mem_51231, "ctx->constants->global_dynid_mem_51231") != 0)
        return 1;
    if (memblock_unref_device(ctx, &ctx->constants->global_dynid_mem_51378, "ctx->constants->global_dynid_mem_51378") != 0)
        return 1;
    if (memblock_unref_device(ctx, &ctx->constants->global_dynid_mem_51534, "ctx->constants->global_dynid_mem_51534") != 0)
        return 1;
    if (memblock_unref_device(ctx, &ctx->constants->global_dynid_mem_51651, "ctx->constants->global_dynid_mem_51651") != 0)
        return 1;
    return 0;
}
static int gpu_kernel_builtinzhiota_i64ziiota_i64_50380(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int64_t arg0, int64_t arg1, int64_t arg2, int64_t arg3, int64_t arg4, gpu_mem arg5)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[6] = {&arg0, &arg1, &arg2, &arg3, &arg4, &arg5};
        size_t args_sizes[6] = {sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5)};
        
        return gpu_launch_kernel(ctx, ctx->program->builtinzhiota_i64ziiota_i64_50380, "builtin#iota_i64.iota_i64_50380", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 6, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_builtinzhreplicate_boolzireplicate_51021(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int64_t arg0, bool arg1, int64_t arg2, int64_t arg3, int64_t arg4, gpu_mem arg5)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[6] = {&arg0, &arg1, &arg2, &arg3, &arg4, &arg5};
        size_t args_sizes[6] = {sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5)};
        
        return gpu_launch_kernel(ctx, ctx->program->builtinzhreplicate_boolzireplicate_51021, "builtin#replicate_bool.replicate_51021", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 6, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_builtinzhreplicate_f64zireplicate_50455(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int64_t arg0, double arg1, int64_t arg2, int64_t arg3, int64_t arg4, gpu_mem arg5)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[6] = {&arg0, &arg1, &arg2, &arg3, &arg4, &arg5};
        size_t args_sizes[6] = {sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5)};
        
        return gpu_launch_kernel(ctx, ctx->program->builtinzhreplicate_f64zireplicate_50455, "builtin#replicate_f64.replicate_50455", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 6, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_builtinzhreplicate_i32zireplicate_50282(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int64_t arg0, int32_t arg1, int64_t arg2, int64_t arg3, int64_t arg4, gpu_mem arg5)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[6] = {&arg0, &arg1, &arg2, &arg3, &arg4, &arg5};
        size_t args_sizes[6] = {sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5)};
        
        return gpu_launch_kernel(ctx, ctx->program->builtinzhreplicate_i32zireplicate_50282, "builtin#replicate_i32.replicate_50282", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 6, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_builtinzhreplicate_i64zireplicate_50197(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int64_t arg0, int64_t arg1, int64_t arg2, int64_t arg3, int64_t arg4, gpu_mem arg5)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[6] = {&arg0, &arg1, &arg2, &arg3, &arg4, &arg5};
        size_t args_sizes[6] = {sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5)};
        
        return gpu_launch_kernel(ctx, ctx->program->builtinzhreplicate_i64zireplicate_50197, "builtin#replicate_i64.replicate_50197", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 6, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_builtinzhreplicate_i8zireplicate_50247(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int64_t arg0, int8_t arg1, int64_t arg2, int64_t arg3, int64_t arg4, gpu_mem arg5)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[6] = {&arg0, &arg1, &arg2, &arg3, &arg4, &arg5};
        size_t args_sizes[6] = {sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5)};
        
        return gpu_launch_kernel(ctx, ctx->program->builtinzhreplicate_i8zireplicate_50247, "builtin#replicate_i8.replicate_50247", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 6, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_add_next_partition_doublezisegscan_44184(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int64_t arg0, int64_t arg1, int64_t arg2, int64_t arg3, gpu_mem arg4, gpu_mem arg5, gpu_mem arg6, gpu_mem arg7, gpu_mem arg8, gpu_mem arg9, gpu_mem arg10, gpu_mem arg11, gpu_mem arg12, gpu_mem arg13)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[15] = {&ctx->global_failure, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6, &arg7, &arg8, &arg9, &arg10, &arg11, &arg12, &arg13};
        size_t args_sizes[15] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6), sizeof(arg7), sizeof(arg8), sizeof(arg9), sizeof(arg10), sizeof(arg11), sizeof(arg12), sizeof(arg13)};
        
        return gpu_launch_kernel(ctx, ctx->program->add_next_partition_doublezisegscan_44184, "add_next_partition_double.segscan_44184", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 15, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_add_next_partition_doublezisegmap_44186(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int64_t arg0, int64_t arg1, int64_t arg2, int32_t arg3, gpu_mem arg4, gpu_mem arg5, gpu_mem arg6, gpu_mem arg7, gpu_mem arg8, gpu_mem arg9, gpu_mem arg10, gpu_mem arg11, gpu_mem arg12, gpu_mem arg13, gpu_mem arg14)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[16] = {&ctx->global_failure, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6, &arg7, &arg8, &arg9, &arg10, &arg11, &arg12, &arg13, &arg14};
        size_t args_sizes[16] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6), sizeof(arg7), sizeof(arg8), sizeof(arg9), sizeof(arg10), sizeof(arg11), sizeof(arg12), sizeof(arg13), sizeof(arg14)};
        
        return gpu_launch_kernel(ctx, ctx->program->add_next_partition_doublezisegmap_44186, "add_next_partition_double.segmap_44186", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 16, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_add_next_partition_doublezigpuseq_50444(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, gpu_mem arg0, gpu_mem arg1)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[3] = {&ctx->global_failure, &arg0, &arg1};
        size_t args_sizes[3] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1)};
        
        return gpu_launch_kernel(ctx, ctx->program->add_next_partition_doublezigpuseq_50444, "add_next_partition_double.gpuseq_50444", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 3, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_add_next_partition_doublezigpuseq_50470(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, gpu_mem arg0, gpu_mem arg1)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[3] = {&ctx->global_failure, &arg0, &arg1};
        size_t args_sizes[3] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1)};
        
        return gpu_launch_kernel(ctx, ctx->program->add_next_partition_doublezigpuseq_50470, "add_next_partition_double.gpuseq_50470", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 3, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_add_next_partition_doublezigpuseq_50476(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, gpu_mem arg0, gpu_mem arg1)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[3] = {&ctx->global_failure, &arg0, &arg1};
        size_t args_sizes[3] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1)};
        
        return gpu_launch_kernel(ctx, ctx->program->add_next_partition_doublezigpuseq_50476, "add_next_partition_double.gpuseq_50476", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 3, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_add_next_partition_doublezigpuseq_50482(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, gpu_mem arg0, gpu_mem arg1)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[3] = {&ctx->global_failure, &arg0, &arg1};
        size_t args_sizes[3] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1)};
        
        return gpu_launch_kernel(ctx, ctx->program->add_next_partition_doublezigpuseq_50482, "add_next_partition_double.gpuseq_50482", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 3, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_add_next_partition_doublezigpuseq_50488(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, gpu_mem arg0, gpu_mem arg1)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[3] = {&ctx->global_failure, &arg0, &arg1};
        size_t args_sizes[3] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1)};
        
        return gpu_launch_kernel(ctx, ctx->program->add_next_partition_doublezigpuseq_50488, "add_next_partition_double.gpuseq_50488", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 3, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_add_next_partition_doublezigpuseq_50494(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, gpu_mem arg0, gpu_mem arg1)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[3] = {&ctx->global_failure, &arg0, &arg1};
        size_t args_sizes[3] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1)};
        
        return gpu_launch_kernel(ctx, ctx->program->add_next_partition_doublezigpuseq_50494, "add_next_partition_double.gpuseq_50494", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 3, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_add_next_partition_doublezigpuseq_50501(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int64_t arg0, bool arg1, gpu_mem arg2, gpu_mem arg3, gpu_mem arg4, gpu_mem arg5, gpu_mem arg6, gpu_mem arg7, gpu_mem arg8, gpu_mem arg9, gpu_mem arg10, gpu_mem arg11, gpu_mem arg12, gpu_mem arg13, gpu_mem arg14, gpu_mem arg15, gpu_mem arg16, gpu_mem arg17, gpu_mem arg18, gpu_mem arg19, gpu_mem arg20)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[24] = {&ctx->global_failure, &ctx->failure_is_an_option, &ctx->global_failure_args, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6, &arg7, &arg8, &arg9, &arg10, &arg11, &arg12, &arg13, &arg14, &arg15, &arg16, &arg17, &arg18, &arg19, &arg20};
        size_t args_sizes[24] = {sizeof(ctx->global_failure), sizeof(ctx->failure_is_an_option), sizeof(ctx->global_failure_args), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6), sizeof(arg7), sizeof(arg8), sizeof(arg9), sizeof(arg10), sizeof(arg11), sizeof(arg12), sizeof(arg13), sizeof(arg14), sizeof(arg15), sizeof(arg16), sizeof(arg17), sizeof(arg18), sizeof(arg19), sizeof(arg20)};
        
        return gpu_launch_kernel(ctx, ctx->program->add_next_partition_doublezigpuseq_50501, "add_next_partition_double.gpuseq_50501", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 24, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_add_next_partition_doublezisegmap_43129(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int64_t arg0, gpu_mem arg1, gpu_mem arg2, gpu_mem arg3)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[7] = {&ctx->global_failure, &ctx->failure_is_an_option, &ctx->global_failure_args, &arg0, &arg1, &arg2, &arg3};
        size_t args_sizes[7] = {sizeof(ctx->global_failure), sizeof(ctx->failure_is_an_option), sizeof(ctx->global_failure_args), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3)};
        
        return gpu_launch_kernel(ctx, ctx->program->add_next_partition_doublezisegmap_43129, "add_next_partition_double.segmap_43129", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 7, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_add_next_partition_doublezisegmap_intrablock_46535(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int64_t arg0, int64_t arg1, double arg2, int64_t arg3, int64_t arg4, bool arg5, int64_t arg6, gpu_mem arg7, gpu_mem arg8, gpu_mem arg9, gpu_mem arg10, gpu_mem arg11, gpu_mem arg12, gpu_mem arg13, gpu_mem arg14, gpu_mem arg15, gpu_mem arg16)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[20] = {&ctx->global_failure, &ctx->failure_is_an_option, &ctx->global_failure_args, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6, &arg7, &arg8, &arg9, &arg10, &arg11, &arg12, &arg13, &arg14, &arg15, &arg16};
        size_t args_sizes[20] = {sizeof(ctx->global_failure), sizeof(ctx->failure_is_an_option), sizeof(ctx->global_failure_args), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6), sizeof(arg7), sizeof(arg8), sizeof(arg9), sizeof(arg10), sizeof(arg11), sizeof(arg12), sizeof(arg13), sizeof(arg14), sizeof(arg15), sizeof(arg16)};
        
        return gpu_launch_kernel(ctx, ctx->program->add_next_partition_doublezisegmap_intrablock_46535, "add_next_partition_double.segmap_intrablock_46535", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 20, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_add_next_partition_doublezisegmap_intrablock_43720(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int64_t arg0, int64_t arg1, double arg2, int64_t arg3, gpu_mem arg4, gpu_mem arg5, gpu_mem arg6, gpu_mem arg7, gpu_mem arg8, gpu_mem arg9, gpu_mem arg10, gpu_mem arg11, gpu_mem arg12, gpu_mem arg13)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[17] = {&ctx->global_failure, &ctx->failure_is_an_option, &ctx->global_failure_args, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6, &arg7, &arg8, &arg9, &arg10, &arg11, &arg12, &arg13};
        size_t args_sizes[17] = {sizeof(ctx->global_failure), sizeof(ctx->failure_is_an_option), sizeof(ctx->global_failure_args), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6), sizeof(arg7), sizeof(arg8), sizeof(arg9), sizeof(arg10), sizeof(arg11), sizeof(arg12), sizeof(arg13)};
        
        return gpu_launch_kernel(ctx, ctx->program->add_next_partition_doublezisegmap_intrablock_43720, "add_next_partition_double.segmap_intrablock_43720", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 17, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_add_next_partition_doublezisegmap_43790(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, gpu_mem arg0, gpu_mem arg1, gpu_mem arg2, gpu_mem arg3, gpu_mem arg4)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[8] = {&ctx->global_failure, &ctx->failure_is_an_option, &ctx->global_failure_args, &arg0, &arg1, &arg2, &arg3, &arg4};
        size_t args_sizes[8] = {sizeof(ctx->global_failure), sizeof(ctx->failure_is_an_option), sizeof(ctx->global_failure_args), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4)};
        
        return gpu_launch_kernel(ctx, ctx->program->add_next_partition_doublezisegmap_43790, "add_next_partition_double.segmap_43790", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 8, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_add_next_partition_doublezisegred_small_43807(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int64_t arg0, int64_t arg1, int64_t arg2, gpu_mem arg3, gpu_mem arg4, gpu_mem arg5, gpu_mem arg6, gpu_mem arg7)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[9] = {&ctx->global_failure, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6, &arg7};
        size_t args_sizes[9] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6), sizeof(arg7)};
        
        return gpu_launch_kernel(ctx, ctx->program->add_next_partition_doublezisegred_small_43807, "add_next_partition_double.segred_small_43807", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 9, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_add_next_partition_doublezisegred_large_43807(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int64_t arg0, int64_t arg1, int64_t arg2, int64_t arg3, int64_t arg4, int64_t arg5, gpu_mem arg6, gpu_mem arg7, gpu_mem arg8, gpu_mem arg9, gpu_mem arg10, gpu_mem arg11, gpu_mem arg12)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[14] = {&ctx->global_failure, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6, &arg7, &arg8, &arg9, &arg10, &arg11, &arg12};
        size_t args_sizes[14] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6), sizeof(arg7), sizeof(arg8), sizeof(arg9), sizeof(arg10), sizeof(arg11), sizeof(arg12)};
        
        return gpu_launch_kernel(ctx, ctx->program->add_next_partition_doublezisegred_large_43807, "add_next_partition_double.segred_large_43807", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 14, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_add_next_partition_doublezisegmap_43826(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int64_t arg0, double arg1, gpu_mem arg2, gpu_mem arg3, gpu_mem arg4, gpu_mem arg5, gpu_mem arg6, gpu_mem arg7, gpu_mem arg8, gpu_mem arg9, gpu_mem arg10)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[14] = {&ctx->global_failure, &ctx->failure_is_an_option, &ctx->global_failure_args, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6, &arg7, &arg8, &arg9, &arg10};
        size_t args_sizes[14] = {sizeof(ctx->global_failure), sizeof(ctx->failure_is_an_option), sizeof(ctx->global_failure_args), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6), sizeof(arg7), sizeof(arg8), sizeof(arg9), sizeof(arg10)};
        
        return gpu_launch_kernel(ctx, ctx->program->add_next_partition_doublezisegmap_43826, "add_next_partition_double.segmap_43826", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 14, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_add_next_partition_doublezisegscan_43878(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int64_t arg0, int64_t arg1, int64_t arg2, gpu_mem arg3, gpu_mem arg4, gpu_mem arg5, gpu_mem arg6, gpu_mem arg7, gpu_mem arg8)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[10] = {&ctx->global_failure, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6, &arg7, &arg8};
        size_t args_sizes[10] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6), sizeof(arg7), sizeof(arg8)};
        
        return gpu_launch_kernel(ctx, ctx->program->add_next_partition_doublezisegscan_43878, "add_next_partition_double.segscan_43878", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 10, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_add_next_partition_doublezisegscan_44200(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int64_t arg0, int64_t arg1, double arg2, int64_t arg3, bool arg4, int64_t arg5, int64_t arg6, int64_t arg7, gpu_mem arg8, gpu_mem arg9, gpu_mem arg10, gpu_mem arg11, gpu_mem arg12, gpu_mem arg13, gpu_mem arg14, gpu_mem arg15, gpu_mem arg16, gpu_mem arg17, gpu_mem arg18, gpu_mem arg19, gpu_mem arg20, gpu_mem arg21, gpu_mem arg22, gpu_mem arg23, gpu_mem arg24, gpu_mem arg25, gpu_mem arg26, gpu_mem arg27, gpu_mem arg28)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[32] = {&ctx->global_failure, &ctx->failure_is_an_option, &ctx->global_failure_args, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6, &arg7, &arg8, &arg9, &arg10, &arg11, &arg12, &arg13, &arg14, &arg15, &arg16, &arg17, &arg18, &arg19, &arg20, &arg21, &arg22, &arg23, &arg24, &arg25, &arg26, &arg27, &arg28};
        size_t args_sizes[32] = {sizeof(ctx->global_failure), sizeof(ctx->failure_is_an_option), sizeof(ctx->global_failure_args), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6), sizeof(arg7), sizeof(arg8), sizeof(arg9), sizeof(arg10), sizeof(arg11), sizeof(arg12), sizeof(arg13), sizeof(arg14), sizeof(arg15), sizeof(arg16), sizeof(arg17), sizeof(arg18), sizeof(arg19), sizeof(arg20), sizeof(arg21), sizeof(arg22), sizeof(arg23), sizeof(arg24), sizeof(arg25), sizeof(arg26), sizeof(arg27), sizeof(arg28)};
        
        return gpu_launch_kernel(ctx, ctx->program->add_next_partition_doublezisegscan_44200, "add_next_partition_double.segscan_44200", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 32, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_add_next_partition_doublezisegmap_43887(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int64_t arg0, int64_t arg1, int32_t arg2, gpu_mem arg3, gpu_mem arg4, gpu_mem arg5, gpu_mem arg6)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[8] = {&ctx->global_failure, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6};
        size_t args_sizes[8] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6)};
        
        return gpu_launch_kernel(ctx, ctx->program->add_next_partition_doublezisegmap_43887, "add_next_partition_double.segmap_43887", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 8, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_add_next_partition_doublezisegmap_intrablock_46783(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int64_t arg0, double arg1, int64_t arg2, gpu_mem arg3, gpu_mem arg4, gpu_mem arg5, gpu_mem arg6, gpu_mem arg7, gpu_mem arg8, gpu_mem arg9)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[13] = {&ctx->global_failure, &ctx->failure_is_an_option, &ctx->global_failure_args, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6, &arg7, &arg8, &arg9};
        size_t args_sizes[13] = {sizeof(ctx->global_failure), sizeof(ctx->failure_is_an_option), sizeof(ctx->global_failure_args), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6), sizeof(arg7), sizeof(arg8), sizeof(arg9)};
        
        return gpu_launch_kernel(ctx, ctx->program->add_next_partition_doublezisegmap_intrablock_46783, "add_next_partition_double.segmap_intrablock_46783", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 13, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_add_next_partition_doublezisegred_small_44044(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int64_t arg0, double arg1, int64_t arg2, int64_t arg3, gpu_mem arg4, gpu_mem arg5, gpu_mem arg6, gpu_mem arg7, gpu_mem arg8, gpu_mem arg9, gpu_mem arg10)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[14] = {&ctx->global_failure, &ctx->failure_is_an_option, &ctx->global_failure_args, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6, &arg7, &arg8, &arg9, &arg10};
        size_t args_sizes[14] = {sizeof(ctx->global_failure), sizeof(ctx->failure_is_an_option), sizeof(ctx->global_failure_args), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6), sizeof(arg7), sizeof(arg8), sizeof(arg9), sizeof(arg10)};
        
        return gpu_launch_kernel(ctx, ctx->program->add_next_partition_doublezisegred_small_44044, "add_next_partition_double.segred_small_44044", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 14, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_add_next_partition_doublezisegred_large_44044(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int64_t arg0, double arg1, int64_t arg2, int64_t arg3, int64_t arg4, int64_t arg5, int64_t arg6, gpu_mem arg7, gpu_mem arg8, gpu_mem arg9, gpu_mem arg10, gpu_mem arg11, gpu_mem arg12, gpu_mem arg13, gpu_mem arg14, gpu_mem arg15)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[19] = {&ctx->global_failure, &ctx->failure_is_an_option, &ctx->global_failure_args, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6, &arg7, &arg8, &arg9, &arg10, &arg11, &arg12, &arg13, &arg14, &arg15};
        size_t args_sizes[19] = {sizeof(ctx->global_failure), sizeof(ctx->failure_is_an_option), sizeof(ctx->global_failure_args), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6), sizeof(arg7), sizeof(arg8), sizeof(arg9), sizeof(arg10), sizeof(arg11), sizeof(arg12), sizeof(arg13), sizeof(arg14), sizeof(arg15)};
        
        return gpu_launch_kernel(ctx, ctx->program->add_next_partition_doublezisegred_large_44044, "add_next_partition_double.segred_large_44044", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 19, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_add_next_partition_doublezisegmap_44136(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int64_t arg0, double arg1, gpu_mem arg2, gpu_mem arg3, gpu_mem arg4, gpu_mem arg5, gpu_mem arg6, gpu_mem arg7, gpu_mem arg8, gpu_mem arg9)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[13] = {&ctx->global_failure, &ctx->failure_is_an_option, &ctx->global_failure_args, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6, &arg7, &arg8, &arg9};
        size_t args_sizes[13] = {sizeof(ctx->global_failure), sizeof(ctx->failure_is_an_option), sizeof(ctx->global_failure_args), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6), sizeof(arg7), sizeof(arg8), sizeof(arg9)};
        
        return gpu_launch_kernel(ctx, ctx->program->add_next_partition_doublezisegmap_44136, "add_next_partition_double.segmap_44136", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 13, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_add_next_partition_doublezisegmap_44202(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int64_t arg0, int64_t arg1, int64_t arg2, int32_t arg3, gpu_mem arg4, gpu_mem arg5, gpu_mem arg6, gpu_mem arg7)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[9] = {&ctx->global_failure, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6, &arg7};
        size_t args_sizes[9] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6), sizeof(arg7)};
        
        return gpu_launch_kernel(ctx, ctx->program->add_next_partition_doublezisegmap_44202, "add_next_partition_double.segmap_44202", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 9, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_add_next_partition_doublezisegmap_44255(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int64_t arg0, int64_t arg1, int64_t arg2, int64_t arg3, int64_t arg4, int64_t arg5, int64_t arg6, gpu_mem arg7, gpu_mem arg8, gpu_mem arg9, gpu_mem arg10, gpu_mem arg11, gpu_mem arg12, gpu_mem arg13, gpu_mem arg14, gpu_mem arg15, gpu_mem arg16, gpu_mem arg17, gpu_mem arg18, gpu_mem arg19)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[23] = {&ctx->global_failure, &ctx->failure_is_an_option, &ctx->global_failure_args, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6, &arg7, &arg8, &arg9, &arg10, &arg11, &arg12, &arg13, &arg14, &arg15, &arg16, &arg17, &arg18, &arg19};
        size_t args_sizes[23] = {sizeof(ctx->global_failure), sizeof(ctx->failure_is_an_option), sizeof(ctx->global_failure_args), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6), sizeof(arg7), sizeof(arg8), sizeof(arg9), sizeof(arg10), sizeof(arg11), sizeof(arg12), sizeof(arg13), sizeof(arg14), sizeof(arg15), sizeof(arg16), sizeof(arg17), sizeof(arg18), sizeof(arg19)};
        
        return gpu_launch_kernel(ctx, ctx->program->add_next_partition_doublezisegmap_44255, "add_next_partition_double.segmap_44255", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 23, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_add_next_partition_doublezisegmap_44323(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int64_t arg0, int64_t arg1, int64_t arg2, int64_t arg3, int64_t arg4, int64_t arg5, int64_t arg6, gpu_mem arg7, gpu_mem arg8, gpu_mem arg9, gpu_mem arg10, gpu_mem arg11, gpu_mem arg12, gpu_mem arg13, gpu_mem arg14, gpu_mem arg15, gpu_mem arg16)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[20] = {&ctx->global_failure, &ctx->failure_is_an_option, &ctx->global_failure_args, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6, &arg7, &arg8, &arg9, &arg10, &arg11, &arg12, &arg13, &arg14, &arg15, &arg16};
        size_t args_sizes[20] = {sizeof(ctx->global_failure), sizeof(ctx->failure_is_an_option), sizeof(ctx->global_failure_args), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6), sizeof(arg7), sizeof(arg8), sizeof(arg9), sizeof(arg10), sizeof(arg11), sizeof(arg12), sizeof(arg13), sizeof(arg14), sizeof(arg15), sizeof(arg16)};
        
        return gpu_launch_kernel(ctx, ctx->program->add_next_partition_doublezisegmap_44323, "add_next_partition_double.segmap_44323", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 20, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_add_next_partition_doublezigpuseq_51204(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, double arg0, gpu_mem arg1, gpu_mem arg2, gpu_mem arg3, gpu_mem arg4, gpu_mem arg5, gpu_mem arg6, gpu_mem arg7, gpu_mem arg8, gpu_mem arg9, gpu_mem arg10, gpu_mem arg11, gpu_mem arg12, gpu_mem arg13)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[15] = {&ctx->global_failure, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6, &arg7, &arg8, &arg9, &arg10, &arg11, &arg12, &arg13};
        size_t args_sizes[15] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6), sizeof(arg7), sizeof(arg8), sizeof(arg9), sizeof(arg10), sizeof(arg11), sizeof(arg12), sizeof(arg13)};
        
        return gpu_launch_kernel(ctx, ctx->program->add_next_partition_doublezigpuseq_51204, "add_next_partition_double.gpuseq_51204", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 15, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_do_DBSCAN_doublezisegscan_44353(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int64_t arg0, int64_t arg1, int64_t arg2, int64_t arg3, gpu_mem arg4, gpu_mem arg5, gpu_mem arg6, gpu_mem arg7, gpu_mem arg8, gpu_mem arg9, gpu_mem arg10)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[12] = {&ctx->global_failure, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6, &arg7, &arg8, &arg9, &arg10};
        size_t args_sizes[12] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6), sizeof(arg7), sizeof(arg8), sizeof(arg9), sizeof(arg10)};
        
        return gpu_launch_kernel(ctx, ctx->program->do_DBSCAN_doublezisegscan_44353, "do_DBSCAN_double.segscan_44353", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 12, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_do_DBSCAN_doublezisegmap_44355(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int64_t arg0, int64_t arg1, int64_t arg2, int32_t arg3, gpu_mem arg4, gpu_mem arg5, gpu_mem arg6, gpu_mem arg7, gpu_mem arg8, gpu_mem arg9, gpu_mem arg10)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[12] = {&ctx->global_failure, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6, &arg7, &arg8, &arg9, &arg10};
        size_t args_sizes[12] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6), sizeof(arg7), sizeof(arg8), sizeof(arg9), sizeof(arg10)};
        
        return gpu_launch_kernel(ctx, ctx->program->do_DBSCAN_doublezisegmap_44355, "do_DBSCAN_double.segmap_44355", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 12, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_do_DBSCAN_doublezigpuseq_50431(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, double arg0, double arg1, gpu_mem arg2, gpu_mem arg3, gpu_mem arg4)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[6] = {&ctx->global_failure, &arg0, &arg1, &arg2, &arg3, &arg4};
        size_t args_sizes[6] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4)};
        
        return gpu_launch_kernel(ctx, ctx->program->do_DBSCAN_doublezigpuseq_50431, "do_DBSCAN_double.gpuseq_50431", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 6, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_do_DBSCAN_doublezisegscan_44369(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int64_t arg0, int64_t arg1, double arg2, int64_t arg3, int64_t arg4, int64_t arg5, gpu_mem arg6, gpu_mem arg7, gpu_mem arg8, gpu_mem arg9, gpu_mem arg10, gpu_mem arg11, gpu_mem arg12, gpu_mem arg13, gpu_mem arg14, gpu_mem arg15, gpu_mem arg16, gpu_mem arg17, gpu_mem arg18)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[22] = {&ctx->global_failure, &ctx->failure_is_an_option, &ctx->global_failure_args, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6, &arg7, &arg8, &arg9, &arg10, &arg11, &arg12, &arg13, &arg14, &arg15, &arg16, &arg17, &arg18};
        size_t args_sizes[22] = {sizeof(ctx->global_failure), sizeof(ctx->failure_is_an_option), sizeof(ctx->global_failure_args), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6), sizeof(arg7), sizeof(arg8), sizeof(arg9), sizeof(arg10), sizeof(arg11), sizeof(arg12), sizeof(arg13), sizeof(arg14), sizeof(arg15), sizeof(arg16), sizeof(arg17), sizeof(arg18)};
        
        return gpu_launch_kernel(ctx, ctx->program->do_DBSCAN_doublezisegscan_44369, "do_DBSCAN_double.segscan_44369", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 22, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_do_DBSCAN_doublezisegmap_44371(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int64_t arg0, int64_t arg1, int64_t arg2, int32_t arg3, gpu_mem arg4, gpu_mem arg5, gpu_mem arg6, gpu_mem arg7, gpu_mem arg8, gpu_mem arg9, gpu_mem arg10, gpu_mem arg11, gpu_mem arg12)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[14] = {&ctx->global_failure, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6, &arg7, &arg8, &arg9, &arg10, &arg11, &arg12};
        size_t args_sizes[14] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6), sizeof(arg7), sizeof(arg8), sizeof(arg9), sizeof(arg10), sizeof(arg11), sizeof(arg12)};
        
        return gpu_launch_kernel(ctx, ctx->program->do_DBSCAN_doublezisegmap_44371, "do_DBSCAN_double.segmap_44371", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 14, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_do_DBSCAN_doublezisegscan_44385(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, double arg0, int64_t arg1, int64_t arg2, int64_t arg3, int64_t arg4, gpu_mem arg5, gpu_mem arg6, gpu_mem arg7, gpu_mem arg8, gpu_mem arg9, gpu_mem arg10, gpu_mem arg11, gpu_mem arg12, gpu_mem arg13, gpu_mem arg14, gpu_mem arg15, gpu_mem arg16, gpu_mem arg17, gpu_mem arg18)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[20] = {&ctx->global_failure, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6, &arg7, &arg8, &arg9, &arg10, &arg11, &arg12, &arg13, &arg14, &arg15, &arg16, &arg17, &arg18};
        size_t args_sizes[20] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6), sizeof(arg7), sizeof(arg8), sizeof(arg9), sizeof(arg10), sizeof(arg11), sizeof(arg12), sizeof(arg13), sizeof(arg14), sizeof(arg15), sizeof(arg16), sizeof(arg17), sizeof(arg18)};
        
        return gpu_launch_kernel(ctx, ctx->program->do_DBSCAN_doublezisegscan_44385, "do_DBSCAN_double.segscan_44385", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 20, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_do_DBSCAN_doublezisegmap_44387(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int64_t arg0, int64_t arg1, int64_t arg2, int32_t arg3, gpu_mem arg4, gpu_mem arg5, gpu_mem arg6, gpu_mem arg7, gpu_mem arg8, gpu_mem arg9, gpu_mem arg10, gpu_mem arg11, gpu_mem arg12, gpu_mem arg13, gpu_mem arg14)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[16] = {&ctx->global_failure, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6, &arg7, &arg8, &arg9, &arg10, &arg11, &arg12, &arg13, &arg14};
        size_t args_sizes[16] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6), sizeof(arg7), sizeof(arg8), sizeof(arg9), sizeof(arg10), sizeof(arg11), sizeof(arg12), sizeof(arg13), sizeof(arg14)};
        
        return gpu_launch_kernel(ctx, ctx->program->do_DBSCAN_doublezisegmap_44387, "do_DBSCAN_double.segmap_44387", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 16, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_do_DBSCAN_doublezisegscan_44401(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int64_t arg0, int64_t arg1, int64_t arg2, int64_t arg3, int64_t arg4, gpu_mem arg5, gpu_mem arg6, gpu_mem arg7, gpu_mem arg8, gpu_mem arg9, gpu_mem arg10, gpu_mem arg11, gpu_mem arg12, gpu_mem arg13, gpu_mem arg14)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[16] = {&ctx->global_failure, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6, &arg7, &arg8, &arg9, &arg10, &arg11, &arg12, &arg13, &arg14};
        size_t args_sizes[16] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6), sizeof(arg7), sizeof(arg8), sizeof(arg9), sizeof(arg10), sizeof(arg11), sizeof(arg12), sizeof(arg13), sizeof(arg14)};
        
        return gpu_launch_kernel(ctx, ctx->program->do_DBSCAN_doublezisegscan_44401, "do_DBSCAN_double.segscan_44401", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 16, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_do_DBSCAN_doublezisegmap_44403(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int64_t arg0, int64_t arg1, int64_t arg2, int32_t arg3, gpu_mem arg4, gpu_mem arg5, gpu_mem arg6, gpu_mem arg7, gpu_mem arg8, gpu_mem arg9, gpu_mem arg10, gpu_mem arg11)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[13] = {&ctx->global_failure, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6, &arg7, &arg8, &arg9, &arg10, &arg11};
        size_t args_sizes[13] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6), sizeof(arg7), sizeof(arg8), sizeof(arg9), sizeof(arg10), sizeof(arg11)};
        
        return gpu_launch_kernel(ctx, ctx->program->do_DBSCAN_doublezisegmap_44403, "do_DBSCAN_double.segmap_44403", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 13, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_do_DBSCAN_doublezisegmap_44411(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int64_t arg0, int64_t arg1, int64_t arg2, int32_t arg3, gpu_mem arg4, gpu_mem arg5, gpu_mem arg6)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[8] = {&ctx->global_failure, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6};
        size_t args_sizes[8] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6)};
        
        return gpu_launch_kernel(ctx, ctx->program->do_DBSCAN_doublezisegmap_44411, "do_DBSCAN_double.segmap_44411", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 8, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_do_DBSCAN_doublezisegmap_44435(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int64_t arg0, int64_t arg1, gpu_mem arg2, gpu_mem arg3, gpu_mem arg4)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[6] = {&ctx->global_failure, &arg0, &arg1, &arg2, &arg3, &arg4};
        size_t args_sizes[6] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4)};
        
        return gpu_launch_kernel(ctx, ctx->program->do_DBSCAN_doublezisegmap_44435, "do_DBSCAN_double.segmap_44435", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 6, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_do_DBSCAN_doublezisegscan_44447(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int64_t arg0, int64_t arg1, int64_t arg2, int64_t arg3, gpu_mem arg4, gpu_mem arg5, gpu_mem arg6, gpu_mem arg7, gpu_mem arg8, gpu_mem arg9, gpu_mem arg10)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[12] = {&ctx->global_failure, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6, &arg7, &arg8, &arg9, &arg10};
        size_t args_sizes[12] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6), sizeof(arg7), sizeof(arg8), sizeof(arg9), sizeof(arg10)};
        
        return gpu_launch_kernel(ctx, ctx->program->do_DBSCAN_doublezisegscan_44447, "do_DBSCAN_double.segscan_44447", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 12, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_do_DBSCAN_doublezisegmap_44449(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int64_t arg0, int64_t arg1, int64_t arg2, int32_t arg3, gpu_mem arg4, gpu_mem arg5, gpu_mem arg6, gpu_mem arg7, gpu_mem arg8, gpu_mem arg9, gpu_mem arg10)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[12] = {&ctx->global_failure, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6, &arg7, &arg8, &arg9, &arg10};
        size_t args_sizes[12] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6), sizeof(arg7), sizeof(arg8), sizeof(arg9), sizeof(arg10)};
        
        return gpu_launch_kernel(ctx, ctx->program->do_DBSCAN_doublezisegmap_44449, "do_DBSCAN_double.segmap_44449", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 12, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_do_DBSCAN_doublezisegscan_44463(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int64_t arg0, int64_t arg1, int64_t arg2, int64_t arg3, int64_t arg4, gpu_mem arg5, gpu_mem arg6, gpu_mem arg7, gpu_mem arg8, gpu_mem arg9, gpu_mem arg10, gpu_mem arg11, gpu_mem arg12)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[14] = {&ctx->global_failure, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6, &arg7, &arg8, &arg9, &arg10, &arg11, &arg12};
        size_t args_sizes[14] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6), sizeof(arg7), sizeof(arg8), sizeof(arg9), sizeof(arg10), sizeof(arg11), sizeof(arg12)};
        
        return gpu_launch_kernel(ctx, ctx->program->do_DBSCAN_doublezisegscan_44463, "do_DBSCAN_double.segscan_44463", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 14, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_do_DBSCAN_doublezisegmap_intrablock_46535(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int8_t arg0, int8_t arg1, double arg2, double arg3, int64_t arg4, int64_t arg5, int64_t arg6, int64_t arg7, int64_t arg8, int64_t arg9, int64_t arg10, bool arg11, int64_t arg12, gpu_mem arg13, gpu_mem arg14, gpu_mem arg15, gpu_mem arg16, gpu_mem arg17, gpu_mem arg18)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[20] = {&ctx->global_failure, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6, &arg7, &arg8, &arg9, &arg10, &arg11, &arg12, &arg13, &arg14, &arg15, &arg16, &arg17, &arg18};
        size_t args_sizes[20] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6), sizeof(arg7), sizeof(arg8), sizeof(arg9), sizeof(arg10), sizeof(arg11), sizeof(arg12), sizeof(arg13), sizeof(arg14), sizeof(arg15), sizeof(arg16), sizeof(arg17), sizeof(arg18)};
        
        return gpu_launch_kernel(ctx, ctx->program->do_DBSCAN_doublezisegmap_intrablock_46535, "do_DBSCAN_double.segmap_intrablock_46535", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 20, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_do_DBSCAN_doublezisegmap_44647(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int8_t arg0, int64_t arg1, int64_t arg2, int64_t arg3, gpu_mem arg4, gpu_mem arg5, gpu_mem arg6, gpu_mem arg7, gpu_mem arg8, gpu_mem arg9, gpu_mem arg10)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[12] = {&ctx->global_failure, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6, &arg7, &arg8, &arg9, &arg10};
        size_t args_sizes[12] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6), sizeof(arg7), sizeof(arg8), sizeof(arg9), sizeof(arg10)};
        
        return gpu_launch_kernel(ctx, ctx->program->do_DBSCAN_doublezisegmap_44647, "do_DBSCAN_double.segmap_44647", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 12, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_do_DBSCAN_doublezisegred_small_44665(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int8_t arg0, int8_t arg1, double arg2, double arg3, int64_t arg4, int64_t arg5, int64_t arg6, int64_t arg7, int64_t arg8, bool arg9, int64_t arg10, gpu_mem arg11, gpu_mem arg12, gpu_mem arg13, gpu_mem arg14, gpu_mem arg15, gpu_mem arg16, gpu_mem arg17, gpu_mem arg18, gpu_mem arg19)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[21] = {&ctx->global_failure, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6, &arg7, &arg8, &arg9, &arg10, &arg11, &arg12, &arg13, &arg14, &arg15, &arg16, &arg17, &arg18, &arg19};
        size_t args_sizes[21] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6), sizeof(arg7), sizeof(arg8), sizeof(arg9), sizeof(arg10), sizeof(arg11), sizeof(arg12), sizeof(arg13), sizeof(arg14), sizeof(arg15), sizeof(arg16), sizeof(arg17), sizeof(arg18), sizeof(arg19)};
        
        return gpu_launch_kernel(ctx, ctx->program->do_DBSCAN_doublezisegred_small_44665, "do_DBSCAN_double.segred_small_44665", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 21, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_do_DBSCAN_doublezisegred_large_44665(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int8_t arg0, int8_t arg1, double arg2, double arg3, int64_t arg4, int64_t arg5, int64_t arg6, int64_t arg7, int64_t arg8, bool arg9, int64_t arg10, int64_t arg11, int64_t arg12, int64_t arg13, gpu_mem arg14, gpu_mem arg15, gpu_mem arg16, gpu_mem arg17, gpu_mem arg18, gpu_mem arg19, gpu_mem arg20, gpu_mem arg21, gpu_mem arg22, gpu_mem arg23, gpu_mem arg24)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[26] = {&ctx->global_failure, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6, &arg7, &arg8, &arg9, &arg10, &arg11, &arg12, &arg13, &arg14, &arg15, &arg16, &arg17, &arg18, &arg19, &arg20, &arg21, &arg22, &arg23, &arg24};
        size_t args_sizes[26] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6), sizeof(arg7), sizeof(arg8), sizeof(arg9), sizeof(arg10), sizeof(arg11), sizeof(arg12), sizeof(arg13), sizeof(arg14), sizeof(arg15), sizeof(arg16), sizeof(arg17), sizeof(arg18), sizeof(arg19), sizeof(arg20), sizeof(arg21), sizeof(arg22), sizeof(arg23), sizeof(arg24)};
        
        return gpu_launch_kernel(ctx, ctx->program->do_DBSCAN_doublezisegred_large_44665, "do_DBSCAN_double.segred_large_44665", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 26, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_do_DBSCAN_doublezisegred_nonseg_44715(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int64_t arg0, int64_t arg1, int64_t arg2, gpu_mem arg3, gpu_mem arg4, gpu_mem arg5, gpu_mem arg6, gpu_mem arg7)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[9] = {&ctx->global_failure, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6, &arg7};
        size_t args_sizes[9] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6), sizeof(arg7)};
        
        return gpu_launch_kernel(ctx, ctx->program->do_DBSCAN_doublezisegred_nonseg_44715, "do_DBSCAN_double.segred_nonseg_44715", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 9, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_do_DBSCAN_doublezisegscan_44723(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int64_t arg0, int64_t arg1, int64_t arg2, int64_t arg3, gpu_mem arg4, gpu_mem arg5, gpu_mem arg6, gpu_mem arg7, gpu_mem arg8, gpu_mem arg9)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[11] = {&ctx->global_failure, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6, &arg7, &arg8, &arg9};
        size_t args_sizes[11] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6), sizeof(arg7), sizeof(arg8), sizeof(arg9)};
        
        return gpu_launch_kernel(ctx, ctx->program->do_DBSCAN_doublezisegscan_44723, "do_DBSCAN_double.segscan_44723", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 11, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_do_DBSCAN_doublezisegmap_44743(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int64_t arg0, gpu_mem arg1, gpu_mem arg2)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[4] = {&ctx->global_failure, &arg0, &arg1, &arg2};
        size_t args_sizes[4] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1), sizeof(arg2)};
        
        return gpu_launch_kernel(ctx, ctx->program->do_DBSCAN_doublezisegmap_44743, "do_DBSCAN_double.segmap_44743", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 4, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_do_DBSCAN_doublezisegmap_44774(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int64_t arg0, int64_t arg1, int64_t arg2, gpu_mem arg3, gpu_mem arg4, gpu_mem arg5, gpu_mem arg6)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[10] = {&ctx->global_failure, &ctx->failure_is_an_option, &ctx->global_failure_args, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6};
        size_t args_sizes[10] = {sizeof(ctx->global_failure), sizeof(ctx->failure_is_an_option), sizeof(ctx->global_failure_args), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6)};
        
        return gpu_launch_kernel(ctx, ctx->program->do_DBSCAN_doublezisegmap_44774, "do_DBSCAN_double.segmap_44774", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 10, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_do_DBSCAN_doublezisegmap_44801(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int64_t arg0, int64_t arg1, gpu_mem arg2, gpu_mem arg3)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[5] = {&ctx->global_failure, &arg0, &arg1, &arg2, &arg3};
        size_t args_sizes[5] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3)};
        
        return gpu_launch_kernel(ctx, ctx->program->do_DBSCAN_doublezisegmap_44801, "do_DBSCAN_double.segmap_44801", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 5, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_do_DBSCAN_doublezisegmap_44805(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int64_t arg0, int64_t arg1, int64_t arg2, int64_t arg3, int32_t arg4, gpu_mem arg5, gpu_mem arg6, gpu_mem arg7, gpu_mem arg8, gpu_mem arg9, gpu_mem arg10, gpu_mem arg11)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[13] = {&ctx->global_failure, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6, &arg7, &arg8, &arg9, &arg10, &arg11};
        size_t args_sizes[13] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6), sizeof(arg7), sizeof(arg8), sizeof(arg9), sizeof(arg10), sizeof(arg11)};
        
        return gpu_launch_kernel(ctx, ctx->program->do_DBSCAN_doublezisegmap_44805, "do_DBSCAN_double.segmap_44805", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 13, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_do_DBSCAN_doublezisegmap_intrablock_46915(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int64_t arg0, int64_t arg1, int64_t arg2, int64_t arg3, bool arg4, int64_t arg5, gpu_mem arg6, gpu_mem arg7, gpu_mem arg8)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[10] = {&ctx->global_failure, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6, &arg7, &arg8};
        size_t args_sizes[10] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6), sizeof(arg7), sizeof(arg8)};
        
        return gpu_launch_kernel(ctx, ctx->program->do_DBSCAN_doublezisegmap_intrablock_46915, "do_DBSCAN_double.segmap_intrablock_46915", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 10, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_do_DBSCAN_doublezisegmap_intrablock_47270(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int64_t arg0, int64_t arg1, int64_t arg2, int64_t arg3, bool arg4, int64_t arg5, gpu_mem arg6, gpu_mem arg7, gpu_mem arg8)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[10] = {&ctx->global_failure, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6, &arg7, &arg8};
        size_t args_sizes[10] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6), sizeof(arg7), sizeof(arg8)};
        
        return gpu_launch_kernel(ctx, ctx->program->do_DBSCAN_doublezisegmap_intrablock_47270, "do_DBSCAN_double.segmap_intrablock_47270", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 10, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_do_DBSCAN_doublezisegscan_45210(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int64_t arg0, int64_t arg1, int64_t arg2, int64_t arg3, gpu_mem arg4, gpu_mem arg5, gpu_mem arg6, gpu_mem arg7, gpu_mem arg8, gpu_mem arg9)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[11] = {&ctx->global_failure, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6, &arg7, &arg8, &arg9};
        size_t args_sizes[11] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6), sizeof(arg7), sizeof(arg8), sizeof(arg9)};
        
        return gpu_launch_kernel(ctx, ctx->program->do_DBSCAN_doublezisegscan_45210, "do_DBSCAN_double.segscan_45210", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 11, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_do_DBSCAN_doublezisegmap_45218(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int64_t arg0, int64_t arg1, int64_t arg2, int32_t arg3, gpu_mem arg4, gpu_mem arg5, gpu_mem arg6, gpu_mem arg7, gpu_mem arg8, gpu_mem arg9)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[11] = {&ctx->global_failure, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6, &arg7, &arg8, &arg9};
        size_t args_sizes[11] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6), sizeof(arg7), sizeof(arg8), sizeof(arg9)};
        
        return gpu_launch_kernel(ctx, ctx->program->do_DBSCAN_doublezisegmap_45218, "do_DBSCAN_double.segmap_45218", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 11, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_do_DBSCAN_doublezisegscan_45677(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int64_t arg0, int64_t arg1, int64_t arg2, int64_t arg3, int64_t arg4, gpu_mem arg5, gpu_mem arg6, gpu_mem arg7, gpu_mem arg8, gpu_mem arg9, gpu_mem arg10, gpu_mem arg11)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[13] = {&ctx->global_failure, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6, &arg7, &arg8, &arg9, &arg10, &arg11};
        size_t args_sizes[13] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6), sizeof(arg7), sizeof(arg8), sizeof(arg9), sizeof(arg10), sizeof(arg11)};
        
        return gpu_launch_kernel(ctx, ctx->program->do_DBSCAN_doublezisegscan_45677, "do_DBSCAN_double.segscan_45677", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 13, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_do_DBSCAN_doublezisegmap_intrablock_47625(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int64_t arg0, int64_t arg1, int64_t arg2, int64_t arg3, int64_t arg4, bool arg5, int64_t arg6, gpu_mem arg7, gpu_mem arg8, gpu_mem arg9, gpu_mem arg10)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[12] = {&ctx->global_failure, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6, &arg7, &arg8, &arg9, &arg10};
        size_t args_sizes[12] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6), sizeof(arg7), sizeof(arg8), sizeof(arg9), sizeof(arg10)};
        
        return gpu_launch_kernel(ctx, ctx->program->do_DBSCAN_doublezisegmap_intrablock_47625, "do_DBSCAN_double.segmap_intrablock_47625", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 12, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_do_DBSCAN_doublezisegmap_intrablock_47884(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int64_t arg0, int64_t arg1, int64_t arg2, int64_t arg3, int64_t arg4, bool arg5, int64_t arg6, gpu_mem arg7, gpu_mem arg8, gpu_mem arg9, gpu_mem arg10)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[12] = {&ctx->global_failure, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6, &arg7, &arg8, &arg9, &arg10};
        size_t args_sizes[12] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6), sizeof(arg7), sizeof(arg8), sizeof(arg9), sizeof(arg10)};
        
        return gpu_launch_kernel(ctx, ctx->program->do_DBSCAN_doublezisegmap_intrablock_47884, "do_DBSCAN_double.segmap_intrablock_47884", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 12, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_do_DBSCAN_doublezisegmap_45376(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int64_t arg0, int64_t arg1, gpu_mem arg2, gpu_mem arg3, gpu_mem arg4, gpu_mem arg5, gpu_mem arg6, gpu_mem arg7)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[9] = {&ctx->global_failure, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6, &arg7};
        size_t args_sizes[9] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6), sizeof(arg7)};
        
        return gpu_launch_kernel(ctx, ctx->program->do_DBSCAN_doublezisegmap_45376, "do_DBSCAN_double.segmap_45376", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 9, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_do_DBSCAN_doublezisegmap_intrablock_48143(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int8_t arg0, int8_t arg1, double arg2, double arg3, int64_t arg4, int64_t arg5, int64_t arg6, int64_t arg7, int64_t arg8, int64_t arg9, bool arg10, int64_t arg11, gpu_mem arg12, gpu_mem arg13, gpu_mem arg14, gpu_mem arg15, gpu_mem arg16, gpu_mem arg17)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[19] = {&ctx->global_failure, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6, &arg7, &arg8, &arg9, &arg10, &arg11, &arg12, &arg13, &arg14, &arg15, &arg16, &arg17};
        size_t args_sizes[19] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6), sizeof(arg7), sizeof(arg8), sizeof(arg9), sizeof(arg10), sizeof(arg11), sizeof(arg12), sizeof(arg13), sizeof(arg14), sizeof(arg15), sizeof(arg16), sizeof(arg17)};
        
        return gpu_launch_kernel(ctx, ctx->program->do_DBSCAN_doublezisegmap_intrablock_48143, "do_DBSCAN_double.segmap_intrablock_48143", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 19, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_do_DBSCAN_doublezisegmap_45596(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int8_t arg0, int64_t arg1, int64_t arg2, gpu_mem arg3, gpu_mem arg4, gpu_mem arg5, gpu_mem arg6, gpu_mem arg7)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[9] = {&ctx->global_failure, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6, &arg7};
        size_t args_sizes[9] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6), sizeof(arg7)};
        
        return gpu_launch_kernel(ctx, ctx->program->do_DBSCAN_doublezisegmap_45596, "do_DBSCAN_double.segmap_45596", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 9, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_do_DBSCAN_doublezisegred_small_45615(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int8_t arg0, int8_t arg1, double arg2, double arg3, int64_t arg4, int64_t arg5, int64_t arg6, int64_t arg7, bool arg8, int64_t arg9, gpu_mem arg10, gpu_mem arg11, gpu_mem arg12, gpu_mem arg13, gpu_mem arg14, gpu_mem arg15, gpu_mem arg16, gpu_mem arg17, gpu_mem arg18, gpu_mem arg19)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[21] = {&ctx->global_failure, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6, &arg7, &arg8, &arg9, &arg10, &arg11, &arg12, &arg13, &arg14, &arg15, &arg16, &arg17, &arg18, &arg19};
        size_t args_sizes[21] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6), sizeof(arg7), sizeof(arg8), sizeof(arg9), sizeof(arg10), sizeof(arg11), sizeof(arg12), sizeof(arg13), sizeof(arg14), sizeof(arg15), sizeof(arg16), sizeof(arg17), sizeof(arg18), sizeof(arg19)};
        
        return gpu_launch_kernel(ctx, ctx->program->do_DBSCAN_doublezisegred_small_45615, "do_DBSCAN_double.segred_small_45615", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 21, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_do_DBSCAN_doublezisegred_large_45615(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int8_t arg0, int8_t arg1, double arg2, double arg3, int64_t arg4, int64_t arg5, int64_t arg6, int64_t arg7, bool arg8, int64_t arg9, int64_t arg10, int64_t arg11, int64_t arg12, gpu_mem arg13, gpu_mem arg14, gpu_mem arg15, gpu_mem arg16, gpu_mem arg17, gpu_mem arg18, gpu_mem arg19, gpu_mem arg20, gpu_mem arg21, gpu_mem arg22, gpu_mem arg23, gpu_mem arg24, gpu_mem arg25)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[27] = {&ctx->global_failure, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6, &arg7, &arg8, &arg9, &arg10, &arg11, &arg12, &arg13, &arg14, &arg15, &arg16, &arg17, &arg18, &arg19, &arg20, &arg21, &arg22, &arg23, &arg24, &arg25};
        size_t args_sizes[27] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6), sizeof(arg7), sizeof(arg8), sizeof(arg9), sizeof(arg10), sizeof(arg11), sizeof(arg12), sizeof(arg13), sizeof(arg14), sizeof(arg15), sizeof(arg16), sizeof(arg17), sizeof(arg18), sizeof(arg19), sizeof(arg20), sizeof(arg21), sizeof(arg22), sizeof(arg23), sizeof(arg24), sizeof(arg25)};
        
        return gpu_launch_kernel(ctx, ctx->program->do_DBSCAN_doublezisegred_large_45615, "do_DBSCAN_double.segred_large_45615", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 27, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_do_DBSCAN_doublezisegmap_45663(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int64_t arg0, int64_t arg1, int64_t arg2, int64_t arg3, int32_t arg4, gpu_mem arg5, gpu_mem arg6, gpu_mem arg7, gpu_mem arg8, gpu_mem arg9)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[11] = {&ctx->global_failure, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6, &arg7, &arg8, &arg9};
        size_t args_sizes[11] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6), sizeof(arg7), sizeof(arg8), sizeof(arg9)};
        
        return gpu_launch_kernel(ctx, ctx->program->do_DBSCAN_doublezisegmap_45663, "do_DBSCAN_double.segmap_45663", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 11, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_do_DBSCAN_doublezisegmap_45679(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int64_t arg0, int64_t arg1, int64_t arg2, int32_t arg3, gpu_mem arg4, gpu_mem arg5, gpu_mem arg6, gpu_mem arg7, gpu_mem arg8, gpu_mem arg9)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[11] = {&ctx->global_failure, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6, &arg7, &arg8, &arg9};
        size_t args_sizes[11] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6), sizeof(arg7), sizeof(arg8), sizeof(arg9)};
        
        return gpu_launch_kernel(ctx, ctx->program->do_DBSCAN_doublezisegmap_45679, "do_DBSCAN_double.segmap_45679", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 11, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_do_DBSCAN_doublezisegmap_intrablock_48552(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int8_t arg0, int8_t arg1, double arg2, double arg3, int64_t arg4, int64_t arg5, int64_t arg6, int64_t arg7, int64_t arg8, int64_t arg9, bool arg10, int64_t arg11, gpu_mem arg12, gpu_mem arg13, gpu_mem arg14, gpu_mem arg15, gpu_mem arg16, gpu_mem arg17)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[19] = {&ctx->global_failure, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6, &arg7, &arg8, &arg9, &arg10, &arg11, &arg12, &arg13, &arg14, &arg15, &arg16, &arg17};
        size_t args_sizes[19] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6), sizeof(arg7), sizeof(arg8), sizeof(arg9), sizeof(arg10), sizeof(arg11), sizeof(arg12), sizeof(arg13), sizeof(arg14), sizeof(arg15), sizeof(arg16), sizeof(arg17)};
        
        return gpu_launch_kernel(ctx, ctx->program->do_DBSCAN_doublezisegmap_intrablock_48552, "do_DBSCAN_double.segmap_intrablock_48552", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 19, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_do_DBSCAN_doublezisegmap_45890(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int8_t arg0, int64_t arg1, int64_t arg2, gpu_mem arg3, gpu_mem arg4, gpu_mem arg5, gpu_mem arg6, gpu_mem arg7)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[9] = {&ctx->global_failure, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6, &arg7};
        size_t args_sizes[9] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6), sizeof(arg7)};
        
        return gpu_launch_kernel(ctx, ctx->program->do_DBSCAN_doublezisegmap_45890, "do_DBSCAN_double.segmap_45890", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 9, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_do_DBSCAN_doublezisegred_small_45909(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int8_t arg0, int8_t arg1, double arg2, double arg3, int64_t arg4, int64_t arg5, int64_t arg6, int64_t arg7, bool arg8, int64_t arg9, gpu_mem arg10, gpu_mem arg11, gpu_mem arg12, gpu_mem arg13, gpu_mem arg14, gpu_mem arg15, gpu_mem arg16, gpu_mem arg17, gpu_mem arg18, gpu_mem arg19)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[21] = {&ctx->global_failure, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6, &arg7, &arg8, &arg9, &arg10, &arg11, &arg12, &arg13, &arg14, &arg15, &arg16, &arg17, &arg18, &arg19};
        size_t args_sizes[21] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6), sizeof(arg7), sizeof(arg8), sizeof(arg9), sizeof(arg10), sizeof(arg11), sizeof(arg12), sizeof(arg13), sizeof(arg14), sizeof(arg15), sizeof(arg16), sizeof(arg17), sizeof(arg18), sizeof(arg19)};
        
        return gpu_launch_kernel(ctx, ctx->program->do_DBSCAN_doublezisegred_small_45909, "do_DBSCAN_double.segred_small_45909", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 21, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_do_DBSCAN_doublezisegred_large_45909(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int8_t arg0, int8_t arg1, double arg2, double arg3, int64_t arg4, int64_t arg5, int64_t arg6, int64_t arg7, bool arg8, int64_t arg9, int64_t arg10, int64_t arg11, int64_t arg12, gpu_mem arg13, gpu_mem arg14, gpu_mem arg15, gpu_mem arg16, gpu_mem arg17, gpu_mem arg18, gpu_mem arg19, gpu_mem arg20, gpu_mem arg21, gpu_mem arg22, gpu_mem arg23, gpu_mem arg24, gpu_mem arg25)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[27] = {&ctx->global_failure, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6, &arg7, &arg8, &arg9, &arg10, &arg11, &arg12, &arg13, &arg14, &arg15, &arg16, &arg17, &arg18, &arg19, &arg20, &arg21, &arg22, &arg23, &arg24, &arg25};
        size_t args_sizes[27] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6), sizeof(arg7), sizeof(arg8), sizeof(arg9), sizeof(arg10), sizeof(arg11), sizeof(arg12), sizeof(arg13), sizeof(arg14), sizeof(arg15), sizeof(arg16), sizeof(arg17), sizeof(arg18), sizeof(arg19), sizeof(arg20), sizeof(arg21), sizeof(arg22), sizeof(arg23), sizeof(arg24), sizeof(arg25)};
        
        return gpu_launch_kernel(ctx, ctx->program->do_DBSCAN_doublezisegred_large_45909, "do_DBSCAN_double.segred_large_45909", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 27, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_make_collisions_compact_doublezisegmap_intrablock_46535(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int64_t arg0, int64_t arg1, int64_t arg2, int64_t arg3, int64_t arg4, int64_t arg5, bool arg6, int64_t arg7, gpu_mem arg8, gpu_mem arg9, gpu_mem arg10)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[14] = {&ctx->global_failure, &ctx->failure_is_an_option, &ctx->global_failure_args, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6, &arg7, &arg8, &arg9, &arg10};
        size_t args_sizes[14] = {sizeof(ctx->global_failure), sizeof(ctx->failure_is_an_option), sizeof(ctx->global_failure_args), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6), sizeof(arg7), sizeof(arg8), sizeof(arg9), sizeof(arg10)};
        
        return gpu_launch_kernel(ctx, ctx->program->make_collisions_compact_doublezisegmap_intrablock_46535, "make_collisions_compact_double.segmap_intrablock_46535", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 14, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_make_collisions_compact_doublezisegmap_intrablock_46804(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int64_t arg0, int64_t arg1, int64_t arg2, int64_t arg3, int64_t arg4, int64_t arg5, bool arg6, int64_t arg7, gpu_mem arg8, gpu_mem arg9, gpu_mem arg10)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[14] = {&ctx->global_failure, &ctx->failure_is_an_option, &ctx->global_failure_args, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6, &arg7, &arg8, &arg9, &arg10};
        size_t args_sizes[14] = {sizeof(ctx->global_failure), sizeof(ctx->failure_is_an_option), sizeof(ctx->global_failure_args), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6), sizeof(arg7), sizeof(arg8), sizeof(arg9), sizeof(arg10)};
        
        return gpu_launch_kernel(ctx, ctx->program->make_collisions_compact_doublezisegmap_intrablock_46804, "make_collisions_compact_double.segmap_intrablock_46804", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 14, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_make_collisions_compact_doublezisegscan_42995(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int64_t arg0, int64_t arg1, int64_t arg2, int64_t arg3, gpu_mem arg4, gpu_mem arg5, gpu_mem arg6, gpu_mem arg7, gpu_mem arg8, gpu_mem arg9, gpu_mem arg10)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[12] = {&ctx->global_failure, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6, &arg7, &arg8, &arg9, &arg10};
        size_t args_sizes[12] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6), sizeof(arg7), sizeof(arg8), sizeof(arg9), sizeof(arg10)};
        
        return gpu_launch_kernel(ctx, ctx->program->make_collisions_compact_doublezisegscan_42995, "make_collisions_compact_double.segscan_42995", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 12, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_make_collisions_compact_doublezisegmap_42997(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int64_t arg0, int64_t arg1, int64_t arg2, int32_t arg3, gpu_mem arg4, gpu_mem arg5, gpu_mem arg6, gpu_mem arg7, gpu_mem arg8, gpu_mem arg9)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[11] = {&ctx->global_failure, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6, &arg7, &arg8, &arg9};
        size_t args_sizes[11] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6), sizeof(arg7), sizeof(arg8), sizeof(arg9)};
        
        return gpu_launch_kernel(ctx, ctx->program->make_collisions_compact_doublezisegmap_42997, "make_collisions_compact_double.segmap_42997", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 11, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_mk_dbcHandler_doublezigpuseq_50292(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, double arg0, double arg1, double arg2, double arg3, int64_t arg4, int64_t arg5, double arg6, double arg7, gpu_mem arg8, gpu_mem arg9, gpu_mem arg10, gpu_mem arg11, gpu_mem arg12, gpu_mem arg13, gpu_mem arg14, gpu_mem arg15)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[17] = {&ctx->global_failure, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6, &arg7, &arg8, &arg9, &arg10, &arg11, &arg12, &arg13, &arg14, &arg15};
        size_t args_sizes[17] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6), sizeof(arg7), sizeof(arg8), sizeof(arg9), sizeof(arg10), sizeof(arg11), sizeof(arg12), sizeof(arg13), sizeof(arg14), sizeof(arg15)};
        
        return gpu_launch_kernel(ctx, ctx->program->mk_dbcHandler_doublezigpuseq_50292, "mk_dbcHandler_double.gpuseq_50292", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 17, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_next_partition_to_read_doublezigpuseq_50194(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, gpu_mem arg0, gpu_mem arg1)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[3] = {&ctx->global_failure, &arg0, &arg1};
        size_t args_sizes[3] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1)};
        
        return gpu_launch_kernel(ctx, ctx->program->next_partition_to_read_doublezigpuseq_50194, "next_partition_to_read_double.gpuseq_50194", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 3, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_next_partition_to_read_doublezisegred_nonseg_42824(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int64_t arg0, int64_t arg1, int64_t arg2, gpu_mem arg3, gpu_mem arg4, gpu_mem arg5, gpu_mem arg6)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[8] = {&ctx->global_failure, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6};
        size_t args_sizes[8] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6)};
        
        return gpu_launch_kernel(ctx, ctx->program->next_partition_to_read_doublezisegred_nonseg_42824, "next_partition_to_read_double.segred_nonseg_42824", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 8, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_next_partition_to_read_doublezisegscan_42832(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int64_t arg0, int64_t arg1, int64_t arg2, int64_t arg3, gpu_mem arg4, gpu_mem arg5, gpu_mem arg6, gpu_mem arg7, gpu_mem arg8, gpu_mem arg9, gpu_mem arg10)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[12] = {&ctx->global_failure, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6, &arg7, &arg8, &arg9, &arg10};
        size_t args_sizes[12] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6), sizeof(arg7), sizeof(arg8), sizeof(arg9), sizeof(arg10)};
        
        return gpu_launch_kernel(ctx, ctx->program->next_partition_to_read_doublezisegscan_42832, "next_partition_to_read_double.segscan_42832", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 12, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_next_partition_to_read_doublezisegmap_42834(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int64_t arg0, int64_t arg1, int64_t arg2, int32_t arg3, gpu_mem arg4, gpu_mem arg5, gpu_mem arg6)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[8] = {&ctx->global_failure, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6};
        size_t args_sizes[8] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6)};
        
        return gpu_launch_kernel(ctx, ctx->program->next_partition_to_read_doublezisegmap_42834, "next_partition_to_read_double.segmap_42834", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 8, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_next_partition_to_read_doublezigpuseq_50407(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, gpu_mem arg0, gpu_mem arg1)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[3] = {&ctx->global_failure, &arg0, &arg1};
        size_t args_sizes[3] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1)};
        
        return gpu_launch_kernel(ctx, ctx->program->next_partition_to_read_doublezigpuseq_50407, "next_partition_to_read_double.gpuseq_50407", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 3, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_rectify_partition_ids_doublezisegmap_intrablock_46535(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int64_t arg0, int64_t arg1, int64_t arg2, int64_t arg3, int64_t arg4, int64_t arg5, bool arg6, int64_t arg7, gpu_mem arg8, gpu_mem arg9, gpu_mem arg10, gpu_mem arg11)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[13] = {&ctx->global_failure, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6, &arg7, &arg8, &arg9, &arg10, &arg11};
        size_t args_sizes[13] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6), sizeof(arg7), sizeof(arg8), sizeof(arg9), sizeof(arg10), sizeof(arg11)};
        
        return gpu_launch_kernel(ctx, ctx->program->rectify_partition_ids_doublezisegmap_intrablock_46535, "rectify_partition_ids_double.segmap_intrablock_46535", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 13, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_rectify_partition_ids_doublezisegmap_intrablock_46779(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int64_t arg0, int64_t arg1, int64_t arg2, int64_t arg3, int64_t arg4, int64_t arg5, bool arg6, int64_t arg7, gpu_mem arg8, gpu_mem arg9, gpu_mem arg10, gpu_mem arg11)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[13] = {&ctx->global_failure, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6, &arg7, &arg8, &arg9, &arg10, &arg11};
        size_t args_sizes[13] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6), sizeof(arg7), sizeof(arg8), sizeof(arg9), sizeof(arg10), sizeof(arg11)};
        
        return gpu_launch_kernel(ctx, ctx->program->rectify_partition_ids_doublezisegmap_intrablock_46779, "rectify_partition_ids_double.segmap_intrablock_46779", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 13, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_get_num_neighbours_against_9632zisegmap_intrablock_46535(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int64_t arg0, double arg1, int8_t arg2, int8_t arg3, double arg4, int64_t arg5, int64_t arg6, int64_t arg7, int64_t arg8, int64_t arg9, bool arg10, int64_t arg11, gpu_mem arg12, gpu_mem arg13, gpu_mem arg14, gpu_mem arg15, gpu_mem arg16)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[18] = {&ctx->global_failure, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6, &arg7, &arg8, &arg9, &arg10, &arg11, &arg12, &arg13, &arg14, &arg15, &arg16};
        size_t args_sizes[18] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6), sizeof(arg7), sizeof(arg8), sizeof(arg9), sizeof(arg10), sizeof(arg11), sizeof(arg12), sizeof(arg13), sizeof(arg14), sizeof(arg15), sizeof(arg16)};
        
        return gpu_launch_kernel(ctx, ctx->program->get_num_neighbours_against_9632zisegmap_intrablock_46535, "get_num_neighbours_against_9632.segmap_intrablock_46535", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 18, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_get_num_neighbours_against_9632zisegmap_46133(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int8_t arg0, int64_t arg1, int64_t arg2, gpu_mem arg3, gpu_mem arg4, gpu_mem arg5, gpu_mem arg6, gpu_mem arg7)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[9] = {&ctx->global_failure, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6, &arg7};
        size_t args_sizes[9] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6), sizeof(arg7)};
        
        return gpu_launch_kernel(ctx, ctx->program->get_num_neighbours_against_9632zisegmap_46133, "get_num_neighbours_against_9632.segmap_46133", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 9, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_get_num_neighbours_against_9632zisegred_small_46151(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int64_t arg0, double arg1, int8_t arg2, int8_t arg3, double arg4, int64_t arg5, int64_t arg6, int64_t arg7, bool arg8, int64_t arg9, gpu_mem arg10, gpu_mem arg11, gpu_mem arg12, gpu_mem arg13, gpu_mem arg14, gpu_mem arg15, gpu_mem arg16, gpu_mem arg17)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[19] = {&ctx->global_failure, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6, &arg7, &arg8, &arg9, &arg10, &arg11, &arg12, &arg13, &arg14, &arg15, &arg16, &arg17};
        size_t args_sizes[19] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6), sizeof(arg7), sizeof(arg8), sizeof(arg9), sizeof(arg10), sizeof(arg11), sizeof(arg12), sizeof(arg13), sizeof(arg14), sizeof(arg15), sizeof(arg16), sizeof(arg17)};
        
        return gpu_launch_kernel(ctx, ctx->program->get_num_neighbours_against_9632zisegred_small_46151, "get_num_neighbours_against_9632.segred_small_46151", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 19, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_get_num_neighbours_against_9632zisegred_large_46151(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int64_t arg0, double arg1, int8_t arg2, int8_t arg3, double arg4, int64_t arg5, int64_t arg6, int64_t arg7, bool arg8, int64_t arg9, int64_t arg10, int64_t arg11, int64_t arg12, gpu_mem arg13, gpu_mem arg14, gpu_mem arg15, gpu_mem arg16, gpu_mem arg17, gpu_mem arg18, gpu_mem arg19, gpu_mem arg20, gpu_mem arg21, gpu_mem arg22)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[24] = {&ctx->global_failure, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6, &arg7, &arg8, &arg9, &arg10, &arg11, &arg12, &arg13, &arg14, &arg15, &arg16, &arg17, &arg18, &arg19, &arg20, &arg21, &arg22};
        size_t args_sizes[24] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6), sizeof(arg7), sizeof(arg8), sizeof(arg9), sizeof(arg10), sizeof(arg11), sizeof(arg12), sizeof(arg13), sizeof(arg14), sizeof(arg15), sizeof(arg16), sizeof(arg17), sizeof(arg18), sizeof(arg19), sizeof(arg20), sizeof(arg21), sizeof(arg22)};
        
        return gpu_launch_kernel(ctx, ctx->program->get_num_neighbours_against_9632zisegred_large_46151, "get_num_neighbours_against_9632.segred_large_46151", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 24, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_get_num_neighbours_against_9635zisegmap_intrablock_46535(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int64_t arg0, double arg1, int8_t arg2, int8_t arg3, double arg4, int64_t arg5, int64_t arg6, int64_t arg7, int64_t arg8, int64_t arg9, bool arg10, int64_t arg11, gpu_mem arg12, gpu_mem arg13, gpu_mem arg14, gpu_mem arg15, gpu_mem arg16)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[18] = {&ctx->global_failure, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6, &arg7, &arg8, &arg9, &arg10, &arg11, &arg12, &arg13, &arg14, &arg15, &arg16};
        size_t args_sizes[18] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6), sizeof(arg7), sizeof(arg8), sizeof(arg9), sizeof(arg10), sizeof(arg11), sizeof(arg12), sizeof(arg13), sizeof(arg14), sizeof(arg15), sizeof(arg16)};
        
        return gpu_launch_kernel(ctx, ctx->program->get_num_neighbours_against_9635zisegmap_intrablock_46535, "get_num_neighbours_against_9635.segmap_intrablock_46535", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 18, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_get_num_neighbours_against_9635zisegmap_46367(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int8_t arg0, int64_t arg1, int64_t arg2, gpu_mem arg3, gpu_mem arg4, gpu_mem arg5, gpu_mem arg6, gpu_mem arg7)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[9] = {&ctx->global_failure, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6, &arg7};
        size_t args_sizes[9] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6), sizeof(arg7)};
        
        return gpu_launch_kernel(ctx, ctx->program->get_num_neighbours_against_9635zisegmap_46367, "get_num_neighbours_against_9635.segmap_46367", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 9, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_get_num_neighbours_against_9635zisegred_small_46385(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int64_t arg0, double arg1, int8_t arg2, int8_t arg3, double arg4, int64_t arg5, int64_t arg6, int64_t arg7, bool arg8, int64_t arg9, gpu_mem arg10, gpu_mem arg11, gpu_mem arg12, gpu_mem arg13, gpu_mem arg14, gpu_mem arg15, gpu_mem arg16, gpu_mem arg17)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[19] = {&ctx->global_failure, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6, &arg7, &arg8, &arg9, &arg10, &arg11, &arg12, &arg13, &arg14, &arg15, &arg16, &arg17};
        size_t args_sizes[19] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6), sizeof(arg7), sizeof(arg8), sizeof(arg9), sizeof(arg10), sizeof(arg11), sizeof(arg12), sizeof(arg13), sizeof(arg14), sizeof(arg15), sizeof(arg16), sizeof(arg17)};
        
        return gpu_launch_kernel(ctx, ctx->program->get_num_neighbours_against_9635zisegred_small_46385, "get_num_neighbours_against_9635.segred_small_46385", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 19, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
static int gpu_kernel_get_num_neighbours_against_9635zisegred_large_46385(struct futhark_context *ctx, unsigned int grid_x, unsigned int grid_y, unsigned int grid_z, unsigned int block_x, unsigned int block_y, unsigned int block_z, unsigned int shared_bytes, int64_t arg0, double arg1, int8_t arg2, int8_t arg3, double arg4, int64_t arg5, int64_t arg6, int64_t arg7, bool arg8, int64_t arg9, int64_t arg10, int64_t arg11, int64_t arg12, gpu_mem arg13, gpu_mem arg14, gpu_mem arg15, gpu_mem arg16, gpu_mem arg17, gpu_mem arg18, gpu_mem arg19, gpu_mem arg20, gpu_mem arg21, gpu_mem arg22)
{
    if (grid_x * grid_y * grid_z * block_x * block_y * block_z != 0) {
        void *args[24] = {&ctx->global_failure, &arg0, &arg1, &arg2, &arg3, &arg4, &arg5, &arg6, &arg7, &arg8, &arg9, &arg10, &arg11, &arg12, &arg13, &arg14, &arg15, &arg16, &arg17, &arg18, &arg19, &arg20, &arg21, &arg22};
        size_t args_sizes[24] = {sizeof(ctx->global_failure), sizeof(arg0), sizeof(arg1), sizeof(arg2), sizeof(arg3), sizeof(arg4), sizeof(arg5), sizeof(arg6), sizeof(arg7), sizeof(arg8), sizeof(arg9), sizeof(arg10), sizeof(arg11), sizeof(arg12), sizeof(arg13), sizeof(arg14), sizeof(arg15), sizeof(arg16), sizeof(arg17), sizeof(arg18), sizeof(arg19), sizeof(arg20), sizeof(arg21), sizeof(arg22)};
        
        return gpu_launch_kernel(ctx, ctx->program->get_num_neighbours_against_9635zisegred_large_46385, "get_num_neighbours_against_9635.segred_large_46385", (const int32_t []) {grid_x, grid_y, grid_z}, (const int32_t []) {block_x, block_y, block_z}, shared_bytes, 24, args, args_sizes);
    }
    return FUTHARK_SUCCESS;
}
struct futhark_i64_1d {
    struct memblock_device mem;
    int64_t shape[1];
};
struct futhark_i64_1d *futhark_new_i64_1d(struct futhark_context *ctx, const int64_t *data, int64_t dim0)
{
    int err = 0;
    struct futhark_i64_1d *bad = NULL;
    struct futhark_i64_1d *arr = (struct futhark_i64_1d *) malloc(sizeof(struct futhark_i64_1d));
    
    if (arr == NULL)
        return bad;
    lock_lock(&ctx->lock);
    CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
    arr->mem.references = NULL;
    if (memblock_alloc_device(ctx, &arr->mem, dim0 * 8, "arr->mem"))
        err = 1;
    arr->shape[0] = dim0;
    err = memcpy_host2gpu(ctx, false, arr->mem.mem, 0, (const unsigned char *) data, 0, (size_t) dim0 * 8);
    CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
    lock_unlock(&ctx->lock);
    if (err != 0) {
        free(arr);
        return bad;
    }
    return arr;
}
struct futhark_i64_1d *futhark_new_raw_i64_1d(struct futhark_context *ctx, CUdeviceptr data, int64_t dim0)
{
    int err = 0;
    struct futhark_i64_1d *bad = NULL;
    struct futhark_i64_1d *arr = (struct futhark_i64_1d *) malloc(sizeof(struct futhark_i64_1d));
    
    if (arr == NULL)
        return bad;
    lock_lock(&ctx->lock);
    CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
    arr->mem.references = NULL;
    arr->mem.mem = data;
    arr->shape[0] = dim0;
    CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
    lock_unlock(&ctx->lock);
    return arr;
}
int futhark_free_i64_1d(struct futhark_context *ctx, struct futhark_i64_1d *arr)
{
    lock_lock(&ctx->lock);
    CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
    if (memblock_unref_device(ctx, &arr->mem, "arr->mem") != 0)
        return 1;
    CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
    lock_unlock(&ctx->lock);
    free(arr);
    return 0;
}
int futhark_values_i64_1d(struct futhark_context *ctx, struct futhark_i64_1d *arr, int64_t *data)
{
    int err = 0;
    
    lock_lock(&ctx->lock);
    CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
    err = memcpy_gpu2host(ctx, false, (unsigned char *) data, 0, arr->mem.mem, 0, (size_t) arr->shape[0] * 8);
    CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
    lock_unlock(&ctx->lock);
    return err;
}
int futhark_index_i64_1d(struct futhark_context *ctx, int64_t *out, struct futhark_i64_1d *arr, int64_t i0)
{
    int err = 0;
    
    if (i0 >= 0 && i0 < arr->shape[0]) {
        lock_lock(&ctx->lock);
        CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
        err = memcpy_gpu2host(ctx, false, (unsigned char *) out, 0, arr->mem.mem, 8 * (i0 * 1), 8);
        CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
        lock_unlock(&ctx->lock);
    } else {
        err = 1;
        set_error(ctx, strdup("Index out of bounds."));
    }
    return err;
}
CUdeviceptr futhark_values_raw_i64_1d(struct futhark_context *ctx, struct futhark_i64_1d *arr)
{
    (void) ctx;
    return arr->mem.mem;
}
const int64_t *futhark_shape_i64_1d(struct futhark_context *ctx, struct futhark_i64_1d *arr)
{
    (void) ctx;
    return arr->shape;
}
struct futhark_f64_1d {
    struct memblock_device mem;
    int64_t shape[1];
};
struct futhark_f64_1d *futhark_new_f64_1d(struct futhark_context *ctx, const double *data, int64_t dim0)
{
    int err = 0;
    struct futhark_f64_1d *bad = NULL;
    struct futhark_f64_1d *arr = (struct futhark_f64_1d *) malloc(sizeof(struct futhark_f64_1d));
    
    if (arr == NULL)
        return bad;
    lock_lock(&ctx->lock);
    CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
    arr->mem.references = NULL;
    if (memblock_alloc_device(ctx, &arr->mem, dim0 * 8, "arr->mem"))
        err = 1;
    arr->shape[0] = dim0;
    err = memcpy_host2gpu(ctx, false, arr->mem.mem, 0, (const unsigned char *) data, 0, (size_t) dim0 * 8);
    CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
    lock_unlock(&ctx->lock);
    if (err != 0) {
        free(arr);
        return bad;
    }
    return arr;
}
struct futhark_f64_1d *futhark_new_raw_f64_1d(struct futhark_context *ctx, CUdeviceptr data, int64_t dim0)
{
    int err = 0;
    struct futhark_f64_1d *bad = NULL;
    struct futhark_f64_1d *arr = (struct futhark_f64_1d *) malloc(sizeof(struct futhark_f64_1d));
    
    if (arr == NULL)
        return bad;
    lock_lock(&ctx->lock);
    CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
    arr->mem.references = NULL;
    arr->mem.mem = data;
    arr->shape[0] = dim0;
    CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
    lock_unlock(&ctx->lock);
    return arr;
}
int futhark_free_f64_1d(struct futhark_context *ctx, struct futhark_f64_1d *arr)
{
    lock_lock(&ctx->lock);
    CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
    if (memblock_unref_device(ctx, &arr->mem, "arr->mem") != 0)
        return 1;
    CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
    lock_unlock(&ctx->lock);
    free(arr);
    return 0;
}
int futhark_values_f64_1d(struct futhark_context *ctx, struct futhark_f64_1d *arr, double *data)
{
    int err = 0;
    
    lock_lock(&ctx->lock);
    CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
    err = memcpy_gpu2host(ctx, false, (unsigned char *) data, 0, arr->mem.mem, 0, (size_t) arr->shape[0] * 8);
    CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
    lock_unlock(&ctx->lock);
    return err;
}
int futhark_index_f64_1d(struct futhark_context *ctx, double *out, struct futhark_f64_1d *arr, int64_t i0)
{
    int err = 0;
    
    if (i0 >= 0 && i0 < arr->shape[0]) {
        lock_lock(&ctx->lock);
        CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
        err = memcpy_gpu2host(ctx, false, (unsigned char *) out, 0, arr->mem.mem, 8 * (i0 * 1), 8);
        CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
        lock_unlock(&ctx->lock);
    } else {
        err = 1;
        set_error(ctx, strdup("Index out of bounds."));
    }
    return err;
}
CUdeviceptr futhark_values_raw_f64_1d(struct futhark_context *ctx, struct futhark_f64_1d *arr)
{
    (void) ctx;
    return arr->mem.mem;
}
const int64_t *futhark_shape_f64_1d(struct futhark_context *ctx, struct futhark_f64_1d *arr)
{
    (void) ctx;
    return arr->shape;
}
struct futhark_bool_1d {
    struct memblock_device mem;
    int64_t shape[1];
};
struct futhark_bool_1d *futhark_new_bool_1d(struct futhark_context *ctx, const bool *data, int64_t dim0)
{
    int err = 0;
    struct futhark_bool_1d *bad = NULL;
    struct futhark_bool_1d *arr = (struct futhark_bool_1d *) malloc(sizeof(struct futhark_bool_1d));
    
    if (arr == NULL)
        return bad;
    lock_lock(&ctx->lock);
    CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
    arr->mem.references = NULL;
    if (memblock_alloc_device(ctx, &arr->mem, dim0 * 1, "arr->mem"))
        err = 1;
    arr->shape[0] = dim0;
    err = memcpy_host2gpu(ctx, false, arr->mem.mem, 0, (const unsigned char *) data, 0, (size_t) dim0 * 1);
    CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
    lock_unlock(&ctx->lock);
    if (err != 0) {
        free(arr);
        return bad;
    }
    return arr;
}
struct futhark_bool_1d *futhark_new_raw_bool_1d(struct futhark_context *ctx, CUdeviceptr data, int64_t dim0)
{
    int err = 0;
    struct futhark_bool_1d *bad = NULL;
    struct futhark_bool_1d *arr = (struct futhark_bool_1d *) malloc(sizeof(struct futhark_bool_1d));
    
    if (arr == NULL)
        return bad;
    lock_lock(&ctx->lock);
    CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
    arr->mem.references = NULL;
    arr->mem.mem = data;
    arr->shape[0] = dim0;
    CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
    lock_unlock(&ctx->lock);
    return arr;
}
int futhark_free_bool_1d(struct futhark_context *ctx, struct futhark_bool_1d *arr)
{
    lock_lock(&ctx->lock);
    CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
    if (memblock_unref_device(ctx, &arr->mem, "arr->mem") != 0)
        return 1;
    CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
    lock_unlock(&ctx->lock);
    free(arr);
    return 0;
}
int futhark_values_bool_1d(struct futhark_context *ctx, struct futhark_bool_1d *arr, bool *data)
{
    int err = 0;
    
    lock_lock(&ctx->lock);
    CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
    err = memcpy_gpu2host(ctx, false, (unsigned char *) data, 0, arr->mem.mem, 0, (size_t) arr->shape[0] * 1);
    CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
    lock_unlock(&ctx->lock);
    return err;
}
int futhark_index_bool_1d(struct futhark_context *ctx, bool *out, struct futhark_bool_1d *arr, int64_t i0)
{
    int err = 0;
    
    if (i0 >= 0 && i0 < arr->shape[0]) {
        lock_lock(&ctx->lock);
        CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
        err = memcpy_gpu2host(ctx, false, (unsigned char *) out, 0, arr->mem.mem, 1 * (i0 * 1), 1);
        CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
        lock_unlock(&ctx->lock);
    } else {
        err = 1;
        set_error(ctx, strdup("Index out of bounds."));
    }
    return err;
}
CUdeviceptr futhark_values_raw_bool_1d(struct futhark_context *ctx, struct futhark_bool_1d *arr)
{
    (void) ctx;
    return arr->mem.mem;
}
const int64_t *futhark_shape_bool_1d(struct futhark_context *ctx, struct futhark_bool_1d *arr)
{
    (void) ctx;
    return arr->shape;
}
struct futhark_opaque_tup2_i64_i64 {
    int64_t v0;
    int64_t v1;
};
int futhark_project_opaque_tup2_i64_i64_0(struct futhark_context *ctx, int64_t *out, const struct futhark_opaque_tup2_i64_i64 *obj)
{
    (void) ctx;
    
    int64_t v;
    
    v = obj->v0;
    *out = v;
    return 0;
}
int futhark_project_opaque_tup2_i64_i64_1(struct futhark_context *ctx, int64_t *out, const struct futhark_opaque_tup2_i64_i64 *obj)
{
    (void) ctx;
    
    int64_t v;
    
    v = obj->v1;
    *out = v;
    return 0;
}
int futhark_new_opaque_tup2_i64_i64(struct futhark_context *ctx, struct futhark_opaque_tup2_i64_i64 **out, const int64_t f_0, const int64_t f_1)
{
    struct futhark_opaque_tup2_i64_i64 *v = malloc(sizeof(struct futhark_opaque_tup2_i64_i64));
    
    lock_lock(&ctx->lock);
    CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
    v->v0 = f_0;
    v->v1 = f_1;
    CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
    lock_unlock(&ctx->lock);
    *out = v;
    return FUTHARK_SUCCESS;
}
int futhark_free_opaque_tup2_i64_i64(struct futhark_context *ctx, struct futhark_opaque_tup2_i64_i64 *obj)
{
    (void) ctx;
    
    int ret = 0, tmp;
    
    free(obj);
    return ret;
}
int futhark_store_opaque_tup2_i64_i64(struct futhark_context *ctx, const struct futhark_opaque_tup2_i64_i64 *obj, void **p, size_t *n)
{
    (void) ctx;
    
    int ret = 0;
    int64_t size_0 = 7 + 0 * sizeof(int64_t) + 1 * sizeof(int64_t);
    int64_t size_1 = 7 + 0 * sizeof(int64_t) + 1 * sizeof(int64_t);
    
    *n = size_0 + size_1;
    if (p != NULL && *p == NULL)
        *p = malloc(*n);
    if (p != NULL) {
        unsigned char *out = *p;
        
        *out++ = 'b';
        *out++ = 2;
        *out++ = 0;
        memcpy(out, " i64", 4);
        out += 4;
        memcpy(out, &obj->v0, sizeof(obj->v0));
        out += sizeof(obj->v0);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 0;
        memcpy(out, " i64", 4);
        out += 4;
        memcpy(out, &obj->v1, sizeof(obj->v1));
        out += sizeof(obj->v1);
    }
    return ret;
}
struct futhark_opaque_tup2_i64_i64 *futhark_restore_opaque_tup2_i64_i64(struct futhark_context *ctx, const void *p)
{
    (void) ctx;
    
    int err = 0;
    const unsigned char *src = p;
    struct futhark_opaque_tup2_i64_i64 *obj = malloc(sizeof(struct futhark_opaque_tup2_i64_i64));
    
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 0;
    err |= memcmp(src, " i64", 4) != 0;
    src += 4;
    if (err == 0) {
        src += 0 * sizeof(int64_t);
    }
    
    const void *data_0 = src;
    
    src += sizeof(obj->v0);
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 0;
    err |= memcmp(src, " i64", 4) != 0;
    src += 4;
    if (err == 0) {
        src += 0 * sizeof(int64_t);
    }
    
    const void *data_1 = src;
    
    src += sizeof(obj->v1);
    if (err == 0) {
        memcpy(&obj->v0, data_0, sizeof(obj->v0));
        memcpy(&obj->v1, data_1, sizeof(obj->v1));
    }
    if (err != 0) {
        int ret = 0, tmp;
        
        free(obj);
        obj = NULL;
    }
    return obj;
}
struct futhark_opaque_arr1d_tup2_i64_i64 {
    struct futhark_i64_1d *v0;
    struct futhark_i64_1d *v1;
};
int futhark_project_opaque_arr1d_tup2_i64_i64_0(struct futhark_context *ctx, struct futhark_i64_1d **out, const struct futhark_opaque_arr1d_tup2_i64_i64 *obj)
{
    (void) ctx;
    
    struct futhark_i64_1d *v;
    
    lock_lock(&ctx->lock);
    CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
    v = malloc(sizeof(struct futhark_i64_1d));
    memcpy(v, obj->v0, sizeof(struct futhark_i64_1d));
    (void) (*v->mem.references)++;
    CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
    lock_unlock(&ctx->lock);
    *out = v;
    return 0;
}
int futhark_project_opaque_arr1d_tup2_i64_i64_1(struct futhark_context *ctx, struct futhark_i64_1d **out, const struct futhark_opaque_arr1d_tup2_i64_i64 *obj)
{
    (void) ctx;
    
    struct futhark_i64_1d *v;
    
    lock_lock(&ctx->lock);
    CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
    v = malloc(sizeof(struct futhark_i64_1d));
    memcpy(v, obj->v1, sizeof(struct futhark_i64_1d));
    (void) (*v->mem.references)++;
    CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
    lock_unlock(&ctx->lock);
    *out = v;
    return 0;
}
int futhark_zip_opaque_arr1d_tup2_i64_i64(struct futhark_context *ctx, struct futhark_opaque_arr1d_tup2_i64_i64 **out, const struct futhark_i64_1d *f_0, const struct futhark_i64_1d *f_1)
{
    if (!(f_0->shape[0] == f_1->shape[0])) {
        set_error(ctx, strdup("Cannot zip arrays with different shapes."));
        return 1;
    }
    
    struct futhark_opaque_arr1d_tup2_i64_i64 *v = malloc(sizeof(struct futhark_opaque_arr1d_tup2_i64_i64));
    
    lock_lock(&ctx->lock);
    CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
    {
        v->v0 = malloc(sizeof(struct futhark_i64_1d));
        *v->v0 = *f_0;
        (void) (*v->v0->mem.references)++;
    }
    {
        v->v1 = malloc(sizeof(struct futhark_i64_1d));
        *v->v1 = *f_1;
        (void) (*v->v1->mem.references)++;
    }
    CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
    lock_unlock(&ctx->lock);
    *out = v;
    return FUTHARK_SUCCESS;
}
int futhark_index_opaque_arr1d_tup2_i64_i64(struct futhark_context *ctx, struct futhark_opaque_tup2_i64_i64 **out, struct futhark_opaque_arr1d_tup2_i64_i64 *arr, int64_t i0)
{
    int err = 0;
    
    if (i0 >= 0 && i0 < arr->v0->shape[0]) {
        struct futhark_opaque_tup2_i64_i64 *v = malloc(sizeof(struct futhark_opaque_tup2_i64_i64));
        
        err = memcpy_gpu2host(ctx, false, (unsigned char *) &v->v0, 0, arr->v0->mem.mem, 8 * (i0 * 1), 8);
        err = memcpy_gpu2host(ctx, false, (unsigned char *) &v->v1, 0, arr->v1->mem.mem, 8 * (i0 * 1), 8);
        if (err == 0)
            *out = v;
    } else {
        err = 1;
        set_error(ctx, strdup("Index out of bounds."));
    }
    return err;
}
const int64_t *futhark_shape_opaque_arr1d_tup2_i64_i64(struct futhark_context *ctx, struct futhark_opaque_arr1d_tup2_i64_i64 *arr)
{
    (void) ctx;
    return arr->v0->shape;
}
int futhark_free_opaque_arr1d_tup2_i64_i64(struct futhark_context *ctx, struct futhark_opaque_arr1d_tup2_i64_i64 *obj)
{
    (void) ctx;
    
    int ret = 0, tmp;
    
    if (obj->v0 != NULL && (tmp = futhark_free_i64_1d(ctx, obj->v0)) != 0)
        ret = tmp;
    if (obj->v1 != NULL && (tmp = futhark_free_i64_1d(ctx, obj->v1)) != 0)
        ret = tmp;
    free(obj);
    return ret;
}
int futhark_store_opaque_arr1d_tup2_i64_i64(struct futhark_context *ctx, const struct futhark_opaque_arr1d_tup2_i64_i64 *obj, void **p, size_t *n)
{
    (void) ctx;
    
    int ret = 0;
    int64_t size_0 = 7 + 1 * sizeof(int64_t) + futhark_shape_i64_1d(ctx, obj->v0)[0] * sizeof(int64_t);
    int64_t size_1 = 7 + 1 * sizeof(int64_t) + futhark_shape_i64_1d(ctx, obj->v1)[0] * sizeof(int64_t);
    
    *n = size_0 + size_1;
    if (p != NULL && *p == NULL)
        *p = malloc(*n);
    if (p != NULL) {
        unsigned char *out = *p;
        
        *out++ = 'b';
        *out++ = 2;
        *out++ = 1;
        memcpy(out, " i64", 4);
        out += 4;
        memcpy(out, futhark_shape_i64_1d(ctx, obj->v0), 1 * sizeof(int64_t));
        out += 1 * sizeof(int64_t);
        ret |= futhark_values_i64_1d(ctx, obj->v0, (void *) out);
        out += futhark_shape_i64_1d(ctx, obj->v0)[0] * sizeof(int64_t);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 1;
        memcpy(out, " i64", 4);
        out += 4;
        memcpy(out, futhark_shape_i64_1d(ctx, obj->v1), 1 * sizeof(int64_t));
        out += 1 * sizeof(int64_t);
        ret |= futhark_values_i64_1d(ctx, obj->v1, (void *) out);
        out += futhark_shape_i64_1d(ctx, obj->v1)[0] * sizeof(int64_t);
    }
    return ret;
}
struct futhark_opaque_arr1d_tup2_i64_i64 *futhark_restore_opaque_arr1d_tup2_i64_i64(struct futhark_context *ctx, const void *p)
{
    (void) ctx;
    
    int err = 0;
    const unsigned char *src = p;
    struct futhark_opaque_arr1d_tup2_i64_i64 *obj = malloc(sizeof(struct futhark_opaque_arr1d_tup2_i64_i64));
    int64_t shape_0[1] = {0};
    
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 1;
    err |= memcmp(src, " i64", 4) != 0;
    src += 4;
    if (err == 0) {
        memcpy(shape_0, src, 1 * sizeof(int64_t));
        src += 1 * sizeof(int64_t);
    }
    
    const void *data_0 = src;
    
    obj->v0 = NULL;
    src += shape_0[0] * sizeof(int64_t);
    
    int64_t shape_1[1] = {0};
    
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 1;
    err |= memcmp(src, " i64", 4) != 0;
    src += 4;
    if (err == 0) {
        memcpy(shape_1, src, 1 * sizeof(int64_t));
        src += 1 * sizeof(int64_t);
    }
    
    const void *data_1 = src;
    
    obj->v1 = NULL;
    src += shape_1[0] * sizeof(int64_t);
    if (err == 0) {
        obj->v0 = futhark_new_i64_1d(ctx, data_0, shape_0[0]);
        if (obj->v0 == NULL)
            err = 1;
        obj->v1 = futhark_new_i64_1d(ctx, data_1, shape_1[0]);
        if (obj->v1 == NULL)
            err = 1;
    }
    if (err != 0) {
        int ret = 0, tmp;
        
        if (obj->v0 != NULL && (tmp = futhark_free_i64_1d(ctx, obj->v0)) != 0)
            ret = tmp;
        if (obj->v1 != NULL && (tmp = futhark_free_i64_1d(ctx, obj->v1)) != 0)
            ret = tmp;
        free(obj);
        obj = NULL;
    }
    return obj;
}
struct futhark_opaque_00764e1f7379f14f22282d21712a8514 {
    int8_t v0;
};
int futhark_new_opaque_00764e1f7379f14f22282d21712a8514_degrees(struct futhark_context *ctx, struct futhark_opaque_00764e1f7379f14f22282d21712a8514 **out)
{
    (void) ctx;
    
    struct futhark_opaque_00764e1f7379f14f22282d21712a8514 *v = malloc(sizeof(struct futhark_opaque_00764e1f7379f14f22282d21712a8514));
    
    v->v0 = 0;
    {
        lock_lock(&ctx->lock);
        CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
        CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
        lock_unlock(&ctx->lock);
    }
    {
        { }
    }
    *out = v;
    return FUTHARK_SUCCESS;
}
int futhark_destruct_opaque_00764e1f7379f14f22282d21712a8514_degrees(struct futhark_context *ctx, const struct futhark_opaque_00764e1f7379f14f22282d21712a8514 *obj)
{
    (void) ctx;
    assert(obj->v0 == 0);
    return FUTHARK_SUCCESS;
}
int futhark_new_opaque_00764e1f7379f14f22282d21712a8514_radians(struct futhark_context *ctx, struct futhark_opaque_00764e1f7379f14f22282d21712a8514 **out)
{
    (void) ctx;
    
    struct futhark_opaque_00764e1f7379f14f22282d21712a8514 *v = malloc(sizeof(struct futhark_opaque_00764e1f7379f14f22282d21712a8514));
    
    v->v0 = 1;
    {
        lock_lock(&ctx->lock);
        CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
        CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
        lock_unlock(&ctx->lock);
    }
    {
        { }
    }
    *out = v;
    return FUTHARK_SUCCESS;
}
int futhark_destruct_opaque_00764e1f7379f14f22282d21712a8514_radians(struct futhark_context *ctx, const struct futhark_opaque_00764e1f7379f14f22282d21712a8514 *obj)
{
    (void) ctx;
    assert(obj->v0 == 1);
    return FUTHARK_SUCCESS;
}
int futhark_variant_opaque_00764e1f7379f14f22282d21712a8514(struct futhark_context *ctx, const struct futhark_opaque_00764e1f7379f14f22282d21712a8514 *v)
{
    (void) ctx;
    return v->v0;
}
int futhark_free_opaque_00764e1f7379f14f22282d21712a8514(struct futhark_context *ctx, struct futhark_opaque_00764e1f7379f14f22282d21712a8514 *obj)
{
    (void) ctx;
    
    int ret = 0, tmp;
    
    free(obj);
    return ret;
}
int futhark_store_opaque_00764e1f7379f14f22282d21712a8514(struct futhark_context *ctx, const struct futhark_opaque_00764e1f7379f14f22282d21712a8514 *obj, void **p, size_t *n)
{
    (void) ctx;
    
    int ret = 0;
    int64_t size_0 = 7 + 0 * sizeof(int64_t) + 1 * sizeof(int8_t);
    
    *n = size_0;
    if (p != NULL && *p == NULL)
        *p = malloc(*n);
    if (p != NULL) {
        unsigned char *out = *p;
        
        *out++ = 'b';
        *out++ = 2;
        *out++ = 0;
        memcpy(out, "  i8", 4);
        out += 4;
        memcpy(out, &obj->v0, sizeof(obj->v0));
        out += sizeof(obj->v0);
    }
    return ret;
}
struct futhark_opaque_00764e1f7379f14f22282d21712a8514 *futhark_restore_opaque_00764e1f7379f14f22282d21712a8514(struct futhark_context *ctx, const void *p)
{
    (void) ctx;
    
    int err = 0;
    const unsigned char *src = p;
    struct futhark_opaque_00764e1f7379f14f22282d21712a8514 *obj = malloc(sizeof(struct futhark_opaque_00764e1f7379f14f22282d21712a8514));
    
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 0;
    err |= memcmp(src, "  i8", 4) != 0;
    src += 4;
    if (err == 0) {
        src += 0 * sizeof(int64_t);
    }
    
    const void *data_0 = src;
    
    src += sizeof(obj->v0);
    if (err == 0) {
        memcpy(&obj->v0, data_0, sizeof(obj->v0));
    }
    if (err != 0) {
        int ret = 0, tmp;
        
        free(obj);
        obj = NULL;
    }
    return obj;
}
struct futhark_opaque_5797e930517e531e6d939a24b1db07bd {
    int8_t v0;
};
int futhark_new_opaque_5797e930517e531e6d939a24b1db07bd_euclidean(struct futhark_context *ctx, struct futhark_opaque_5797e930517e531e6d939a24b1db07bd **out)
{
    (void) ctx;
    
    struct futhark_opaque_5797e930517e531e6d939a24b1db07bd *v = malloc(sizeof(struct futhark_opaque_5797e930517e531e6d939a24b1db07bd));
    
    v->v0 = 0;
    {
        lock_lock(&ctx->lock);
        CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
        CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
        lock_unlock(&ctx->lock);
    }
    {
        { }
    }
    *out = v;
    return FUTHARK_SUCCESS;
}
int futhark_destruct_opaque_5797e930517e531e6d939a24b1db07bd_euclidean(struct futhark_context *ctx, const struct futhark_opaque_5797e930517e531e6d939a24b1db07bd *obj)
{
    (void) ctx;
    assert(obj->v0 == 0);
    return FUTHARK_SUCCESS;
}
int futhark_new_opaque_5797e930517e531e6d939a24b1db07bd_haversine(struct futhark_context *ctx, struct futhark_opaque_5797e930517e531e6d939a24b1db07bd **out)
{
    (void) ctx;
    
    struct futhark_opaque_5797e930517e531e6d939a24b1db07bd *v = malloc(sizeof(struct futhark_opaque_5797e930517e531e6d939a24b1db07bd));
    
    v->v0 = 1;
    {
        lock_lock(&ctx->lock);
        CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
        CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
        lock_unlock(&ctx->lock);
    }
    {
        { }
    }
    *out = v;
    return FUTHARK_SUCCESS;
}
int futhark_destruct_opaque_5797e930517e531e6d939a24b1db07bd_haversine(struct futhark_context *ctx, const struct futhark_opaque_5797e930517e531e6d939a24b1db07bd *obj)
{
    (void) ctx;
    assert(obj->v0 == 1);
    return FUTHARK_SUCCESS;
}
int futhark_variant_opaque_5797e930517e531e6d939a24b1db07bd(struct futhark_context *ctx, const struct futhark_opaque_5797e930517e531e6d939a24b1db07bd *v)
{
    (void) ctx;
    return v->v0;
}
int futhark_free_opaque_5797e930517e531e6d939a24b1db07bd(struct futhark_context *ctx, struct futhark_opaque_5797e930517e531e6d939a24b1db07bd *obj)
{
    (void) ctx;
    
    int ret = 0, tmp;
    
    free(obj);
    return ret;
}
int futhark_store_opaque_5797e930517e531e6d939a24b1db07bd(struct futhark_context *ctx, const struct futhark_opaque_5797e930517e531e6d939a24b1db07bd *obj, void **p, size_t *n)
{
    (void) ctx;
    
    int ret = 0;
    int64_t size_0 = 7 + 0 * sizeof(int64_t) + 1 * sizeof(int8_t);
    
    *n = size_0;
    if (p != NULL && *p == NULL)
        *p = malloc(*n);
    if (p != NULL) {
        unsigned char *out = *p;
        
        *out++ = 'b';
        *out++ = 2;
        *out++ = 0;
        memcpy(out, "  i8", 4);
        out += 4;
        memcpy(out, &obj->v0, sizeof(obj->v0));
        out += sizeof(obj->v0);
    }
    return ret;
}
struct futhark_opaque_5797e930517e531e6d939a24b1db07bd *futhark_restore_opaque_5797e930517e531e6d939a24b1db07bd(struct futhark_context *ctx, const void *p)
{
    (void) ctx;
    
    int err = 0;
    const unsigned char *src = p;
    struct futhark_opaque_5797e930517e531e6d939a24b1db07bd *obj = malloc(sizeof(struct futhark_opaque_5797e930517e531e6d939a24b1db07bd));
    
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 0;
    err |= memcmp(src, "  i8", 4) != 0;
    src += 4;
    if (err == 0) {
        src += 0 * sizeof(int64_t);
    }
    
    const void *data_0 = src;
    
    src += sizeof(obj->v0);
    if (err == 0) {
        memcpy(&obj->v0, data_0, sizeof(obj->v0));
    }
    if (err != 0) {
        int ret = 0, tmp;
        
        free(obj);
        obj = NULL;
    }
    return obj;
}
struct futhark_opaque_8b7e80c3fb80a9a7700efe8e89371deb {
    int8_t v0;
    int8_t v1;
    double v2;
    int64_t v3;
    struct futhark_f64_1d *v4;
    int64_t v5;
    struct futhark_f64_1d *v6;
    struct futhark_i64_1d *v7;
    double v8;
    struct futhark_f64_1d *v9;
    int64_t v10;
};
int futhark_project_opaque_8b7e80c3fb80a9a7700efe8e89371deb_angle_t(struct futhark_context *ctx, struct futhark_opaque_00764e1f7379f14f22282d21712a8514 **out, const struct futhark_opaque_8b7e80c3fb80a9a7700efe8e89371deb *obj)
{
    (void) ctx;
    
    struct futhark_opaque_00764e1f7379f14f22282d21712a8514 *v;
    
    lock_lock(&ctx->lock);
    CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
    v = malloc(sizeof(struct futhark_opaque_00764e1f7379f14f22282d21712a8514));
    v->v0 = obj->v0;
    CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
    lock_unlock(&ctx->lock);
    *out = v;
    return 0;
}
int futhark_project_opaque_8b7e80c3fb80a9a7700efe8e89371deb_dist_t(struct futhark_context *ctx, struct futhark_opaque_5797e930517e531e6d939a24b1db07bd **out, const struct futhark_opaque_8b7e80c3fb80a9a7700efe8e89371deb *obj)
{
    (void) ctx;
    
    struct futhark_opaque_5797e930517e531e6d939a24b1db07bd *v;
    
    lock_lock(&ctx->lock);
    CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
    v = malloc(sizeof(struct futhark_opaque_5797e930517e531e6d939a24b1db07bd));
    v->v0 = obj->v1;
    CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
    lock_unlock(&ctx->lock);
    *out = v;
    return 0;
}
int futhark_project_opaque_8b7e80c3fb80a9a7700efe8e89371deb_eps(struct futhark_context *ctx, double *out, const struct futhark_opaque_8b7e80c3fb80a9a7700efe8e89371deb *obj)
{
    (void) ctx;
    
    double v;
    
    v = obj->v2;
    *out = v;
    return 0;
}
int futhark_project_opaque_8b7e80c3fb80a9a7700efe8e89371deb_m_size(struct futhark_context *ctx, int64_t *out, const struct futhark_opaque_8b7e80c3fb80a9a7700efe8e89371deb *obj)
{
    (void) ctx;
    
    int64_t v;
    
    v = obj->v3;
    *out = v;
    return 0;
}
int futhark_project_opaque_8b7e80c3fb80a9a7700efe8e89371deb_maxs(struct futhark_context *ctx, struct futhark_f64_1d **out, const struct futhark_opaque_8b7e80c3fb80a9a7700efe8e89371deb *obj)
{
    (void) ctx;
    
    struct futhark_f64_1d *v;
    
    lock_lock(&ctx->lock);
    CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
    v = malloc(sizeof(struct futhark_f64_1d));
    memcpy(v, obj->v4, sizeof(struct futhark_f64_1d));
    (void) (*v->mem.references)++;
    CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
    lock_unlock(&ctx->lock);
    *out = v;
    return 0;
}
int futhark_project_opaque_8b7e80c3fb80a9a7700efe8e89371deb_minPts(struct futhark_context *ctx, int64_t *out, const struct futhark_opaque_8b7e80c3fb80a9a7700efe8e89371deb *obj)
{
    (void) ctx;
    
    int64_t v;
    
    v = obj->v5;
    *out = v;
    return 0;
}
int futhark_project_opaque_8b7e80c3fb80a9a7700efe8e89371deb_mins(struct futhark_context *ctx, struct futhark_f64_1d **out, const struct futhark_opaque_8b7e80c3fb80a9a7700efe8e89371deb *obj)
{
    (void) ctx;
    
    struct futhark_f64_1d *v;
    
    lock_lock(&ctx->lock);
    CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
    v = malloc(sizeof(struct futhark_f64_1d));
    memcpy(v, obj->v6, sizeof(struct futhark_f64_1d));
    (void) (*v->mem.references)++;
    CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
    lock_unlock(&ctx->lock);
    *out = v;
    return 0;
}
int futhark_project_opaque_8b7e80c3fb80a9a7700efe8e89371deb_part_per_dim(struct futhark_context *ctx, struct futhark_i64_1d **out, const struct futhark_opaque_8b7e80c3fb80a9a7700efe8e89371deb *obj)
{
    (void) ctx;
    
    struct futhark_i64_1d *v;
    
    lock_lock(&ctx->lock);
    CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
    v = malloc(sizeof(struct futhark_i64_1d));
    memcpy(v, obj->v7, sizeof(struct futhark_i64_1d));
    (void) (*v->mem.references)++;
    CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
    lock_unlock(&ctx->lock);
    *out = v;
    return 0;
}
int futhark_project_opaque_8b7e80c3fb80a9a7700efe8e89371deb_radius(struct futhark_context *ctx, double *out, const struct futhark_opaque_8b7e80c3fb80a9a7700efe8e89371deb *obj)
{
    (void) ctx;
    
    double v;
    
    v = obj->v8;
    *out = v;
    return 0;
}
int futhark_project_opaque_8b7e80c3fb80a9a7700efe8e89371deb_step_per_dim(struct futhark_context *ctx, struct futhark_f64_1d **out, const struct futhark_opaque_8b7e80c3fb80a9a7700efe8e89371deb *obj)
{
    (void) ctx;
    
    struct futhark_f64_1d *v;
    
    lock_lock(&ctx->lock);
    CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
    v = malloc(sizeof(struct futhark_f64_1d));
    memcpy(v, obj->v9, sizeof(struct futhark_f64_1d));
    (void) (*v->mem.references)++;
    CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
    lock_unlock(&ctx->lock);
    *out = v;
    return 0;
}
int futhark_project_opaque_8b7e80c3fb80a9a7700efe8e89371deb_total_partitions(struct futhark_context *ctx, int64_t *out, const struct futhark_opaque_8b7e80c3fb80a9a7700efe8e89371deb *obj)
{
    (void) ctx;
    
    int64_t v;
    
    v = obj->v10;
    *out = v;
    return 0;
}
int futhark_new_opaque_8b7e80c3fb80a9a7700efe8e89371deb(struct futhark_context *ctx, struct futhark_opaque_8b7e80c3fb80a9a7700efe8e89371deb **out, const struct futhark_opaque_00764e1f7379f14f22282d21712a8514 *f_angle_t, const struct futhark_opaque_5797e930517e531e6d939a24b1db07bd *f_dist_t, const double f_eps, const int64_t f_m_sizze, const struct futhark_f64_1d *f_maxs, const int64_t f_minPts, const struct futhark_f64_1d *f_mins, const struct futhark_i64_1d *f_part_per_dim, const double f_radius, const struct futhark_f64_1d *f_step_per_dim, const int64_t f_total_partitions)
{
    struct futhark_opaque_8b7e80c3fb80a9a7700efe8e89371deb *v = malloc(sizeof(struct futhark_opaque_8b7e80c3fb80a9a7700efe8e89371deb));
    
    lock_lock(&ctx->lock);
    CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
    {
        v->v0 = f_angle_t->v0;
    }
    {
        v->v1 = f_dist_t->v0;
    }
    v->v2 = f_eps;
    v->v3 = f_m_sizze;
    {
        v->v4 = malloc(sizeof(struct futhark_f64_1d));
        *v->v4 = *f_maxs;
        (void) (*v->v4->mem.references)++;
    }
    v->v5 = f_minPts;
    {
        v->v6 = malloc(sizeof(struct futhark_f64_1d));
        *v->v6 = *f_mins;
        (void) (*v->v6->mem.references)++;
    }
    {
        v->v7 = malloc(sizeof(struct futhark_i64_1d));
        *v->v7 = *f_part_per_dim;
        (void) (*v->v7->mem.references)++;
    }
    v->v8 = f_radius;
    {
        v->v9 = malloc(sizeof(struct futhark_f64_1d));
        *v->v9 = *f_step_per_dim;
        (void) (*v->v9->mem.references)++;
    }
    v->v10 = f_total_partitions;
    CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
    lock_unlock(&ctx->lock);
    *out = v;
    return FUTHARK_SUCCESS;
}
int futhark_free_opaque_8b7e80c3fb80a9a7700efe8e89371deb(struct futhark_context *ctx, struct futhark_opaque_8b7e80c3fb80a9a7700efe8e89371deb *obj)
{
    (void) ctx;
    
    int ret = 0, tmp;
    
    if (obj->v4 != NULL && (tmp = futhark_free_f64_1d(ctx, obj->v4)) != 0)
        ret = tmp;
    if (obj->v6 != NULL && (tmp = futhark_free_f64_1d(ctx, obj->v6)) != 0)
        ret = tmp;
    if (obj->v7 != NULL && (tmp = futhark_free_i64_1d(ctx, obj->v7)) != 0)
        ret = tmp;
    if (obj->v9 != NULL && (tmp = futhark_free_f64_1d(ctx, obj->v9)) != 0)
        ret = tmp;
    free(obj);
    return ret;
}
int futhark_store_opaque_8b7e80c3fb80a9a7700efe8e89371deb(struct futhark_context *ctx, const struct futhark_opaque_8b7e80c3fb80a9a7700efe8e89371deb *obj, void **p, size_t *n)
{
    (void) ctx;
    
    int ret = 0;
    int64_t size_0 = 7 + 0 * sizeof(int64_t) + 1 * sizeof(int8_t);
    int64_t size_1 = 7 + 0 * sizeof(int64_t) + 1 * sizeof(int8_t);
    int64_t size_2 = 7 + 0 * sizeof(int64_t) + 1 * sizeof(double);
    int64_t size_3 = 7 + 0 * sizeof(int64_t) + 1 * sizeof(int64_t);
    int64_t size_4 = 7 + 1 * sizeof(int64_t) + futhark_shape_f64_1d(ctx, obj->v4)[0] * sizeof(double);
    int64_t size_5 = 7 + 0 * sizeof(int64_t) + 1 * sizeof(int64_t);
    int64_t size_6 = 7 + 1 * sizeof(int64_t) + futhark_shape_f64_1d(ctx, obj->v6)[0] * sizeof(double);
    int64_t size_7 = 7 + 1 * sizeof(int64_t) + futhark_shape_i64_1d(ctx, obj->v7)[0] * sizeof(int64_t);
    int64_t size_8 = 7 + 0 * sizeof(int64_t) + 1 * sizeof(double);
    int64_t size_9 = 7 + 1 * sizeof(int64_t) + futhark_shape_f64_1d(ctx, obj->v9)[0] * sizeof(double);
    int64_t size_10 = 7 + 0 * sizeof(int64_t) + 1 * sizeof(int64_t);
    
    *n = size_0 + size_1 + size_2 + size_3 + size_4 + size_5 + size_6 + size_7 + size_8 + size_9 + size_10;
    if (p != NULL && *p == NULL)
        *p = malloc(*n);
    if (p != NULL) {
        unsigned char *out = *p;
        
        *out++ = 'b';
        *out++ = 2;
        *out++ = 0;
        memcpy(out, "  i8", 4);
        out += 4;
        memcpy(out, &obj->v0, sizeof(obj->v0));
        out += sizeof(obj->v0);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 0;
        memcpy(out, "  i8", 4);
        out += 4;
        memcpy(out, &obj->v1, sizeof(obj->v1));
        out += sizeof(obj->v1);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 0;
        memcpy(out, " f64", 4);
        out += 4;
        memcpy(out, &obj->v2, sizeof(obj->v2));
        out += sizeof(obj->v2);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 0;
        memcpy(out, " i64", 4);
        out += 4;
        memcpy(out, &obj->v3, sizeof(obj->v3));
        out += sizeof(obj->v3);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 1;
        memcpy(out, " f64", 4);
        out += 4;
        memcpy(out, futhark_shape_f64_1d(ctx, obj->v4), 1 * sizeof(int64_t));
        out += 1 * sizeof(int64_t);
        ret |= futhark_values_f64_1d(ctx, obj->v4, (void *) out);
        out += futhark_shape_f64_1d(ctx, obj->v4)[0] * sizeof(double);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 0;
        memcpy(out, " i64", 4);
        out += 4;
        memcpy(out, &obj->v5, sizeof(obj->v5));
        out += sizeof(obj->v5);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 1;
        memcpy(out, " f64", 4);
        out += 4;
        memcpy(out, futhark_shape_f64_1d(ctx, obj->v6), 1 * sizeof(int64_t));
        out += 1 * sizeof(int64_t);
        ret |= futhark_values_f64_1d(ctx, obj->v6, (void *) out);
        out += futhark_shape_f64_1d(ctx, obj->v6)[0] * sizeof(double);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 1;
        memcpy(out, " i64", 4);
        out += 4;
        memcpy(out, futhark_shape_i64_1d(ctx, obj->v7), 1 * sizeof(int64_t));
        out += 1 * sizeof(int64_t);
        ret |= futhark_values_i64_1d(ctx, obj->v7, (void *) out);
        out += futhark_shape_i64_1d(ctx, obj->v7)[0] * sizeof(int64_t);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 0;
        memcpy(out, " f64", 4);
        out += 4;
        memcpy(out, &obj->v8, sizeof(obj->v8));
        out += sizeof(obj->v8);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 1;
        memcpy(out, " f64", 4);
        out += 4;
        memcpy(out, futhark_shape_f64_1d(ctx, obj->v9), 1 * sizeof(int64_t));
        out += 1 * sizeof(int64_t);
        ret |= futhark_values_f64_1d(ctx, obj->v9, (void *) out);
        out += futhark_shape_f64_1d(ctx, obj->v9)[0] * sizeof(double);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 0;
        memcpy(out, " i64", 4);
        out += 4;
        memcpy(out, &obj->v10, sizeof(obj->v10));
        out += sizeof(obj->v10);
    }
    return ret;
}
struct futhark_opaque_8b7e80c3fb80a9a7700efe8e89371deb *futhark_restore_opaque_8b7e80c3fb80a9a7700efe8e89371deb(struct futhark_context *ctx, const void *p)
{
    (void) ctx;
    
    int err = 0;
    const unsigned char *src = p;
    struct futhark_opaque_8b7e80c3fb80a9a7700efe8e89371deb *obj = malloc(sizeof(struct futhark_opaque_8b7e80c3fb80a9a7700efe8e89371deb));
    
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 0;
    err |= memcmp(src, "  i8", 4) != 0;
    src += 4;
    if (err == 0) {
        src += 0 * sizeof(int64_t);
    }
    
    const void *data_0 = src;
    
    src += sizeof(obj->v0);
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 0;
    err |= memcmp(src, "  i8", 4) != 0;
    src += 4;
    if (err == 0) {
        src += 0 * sizeof(int64_t);
    }
    
    const void *data_1 = src;
    
    src += sizeof(obj->v1);
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 0;
    err |= memcmp(src, " f64", 4) != 0;
    src += 4;
    if (err == 0) {
        src += 0 * sizeof(int64_t);
    }
    
    const void *data_2 = src;
    
    src += sizeof(obj->v2);
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 0;
    err |= memcmp(src, " i64", 4) != 0;
    src += 4;
    if (err == 0) {
        src += 0 * sizeof(int64_t);
    }
    
    const void *data_3 = src;
    
    src += sizeof(obj->v3);
    
    int64_t shape_4[1] = {0};
    
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 1;
    err |= memcmp(src, " f64", 4) != 0;
    src += 4;
    if (err == 0) {
        memcpy(shape_4, src, 1 * sizeof(int64_t));
        src += 1 * sizeof(int64_t);
    }
    
    const void *data_4 = src;
    
    obj->v4 = NULL;
    src += shape_4[0] * sizeof(double);
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 0;
    err |= memcmp(src, " i64", 4) != 0;
    src += 4;
    if (err == 0) {
        src += 0 * sizeof(int64_t);
    }
    
    const void *data_5 = src;
    
    src += sizeof(obj->v5);
    
    int64_t shape_6[1] = {0};
    
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 1;
    err |= memcmp(src, " f64", 4) != 0;
    src += 4;
    if (err == 0) {
        memcpy(shape_6, src, 1 * sizeof(int64_t));
        src += 1 * sizeof(int64_t);
    }
    
    const void *data_6 = src;
    
    obj->v6 = NULL;
    src += shape_6[0] * sizeof(double);
    
    int64_t shape_7[1] = {0};
    
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 1;
    err |= memcmp(src, " i64", 4) != 0;
    src += 4;
    if (err == 0) {
        memcpy(shape_7, src, 1 * sizeof(int64_t));
        src += 1 * sizeof(int64_t);
    }
    
    const void *data_7 = src;
    
    obj->v7 = NULL;
    src += shape_7[0] * sizeof(int64_t);
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 0;
    err |= memcmp(src, " f64", 4) != 0;
    src += 4;
    if (err == 0) {
        src += 0 * sizeof(int64_t);
    }
    
    const void *data_8 = src;
    
    src += sizeof(obj->v8);
    
    int64_t shape_9[1] = {0};
    
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 1;
    err |= memcmp(src, " f64", 4) != 0;
    src += 4;
    if (err == 0) {
        memcpy(shape_9, src, 1 * sizeof(int64_t));
        src += 1 * sizeof(int64_t);
    }
    
    const void *data_9 = src;
    
    obj->v9 = NULL;
    src += shape_9[0] * sizeof(double);
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 0;
    err |= memcmp(src, " i64", 4) != 0;
    src += 4;
    if (err == 0) {
        src += 0 * sizeof(int64_t);
    }
    
    const void *data_10 = src;
    
    src += sizeof(obj->v10);
    if (err == 0) {
        memcpy(&obj->v0, data_0, sizeof(obj->v0));
        memcpy(&obj->v1, data_1, sizeof(obj->v1));
        memcpy(&obj->v2, data_2, sizeof(obj->v2));
        memcpy(&obj->v3, data_3, sizeof(obj->v3));
        obj->v4 = futhark_new_f64_1d(ctx, data_4, shape_4[0]);
        if (obj->v4 == NULL)
            err = 1;
        memcpy(&obj->v5, data_5, sizeof(obj->v5));
        obj->v6 = futhark_new_f64_1d(ctx, data_6, shape_6[0]);
        if (obj->v6 == NULL)
            err = 1;
        obj->v7 = futhark_new_i64_1d(ctx, data_7, shape_7[0]);
        if (obj->v7 == NULL)
            err = 1;
        memcpy(&obj->v8, data_8, sizeof(obj->v8));
        obj->v9 = futhark_new_f64_1d(ctx, data_9, shape_9[0]);
        if (obj->v9 == NULL)
            err = 1;
        memcpy(&obj->v10, data_10, sizeof(obj->v10));
    }
    if (err != 0) {
        int ret = 0, tmp;
        
        if (obj->v4 != NULL && (tmp = futhark_free_f64_1d(ctx, obj->v4)) != 0)
            ret = tmp;
        if (obj->v6 != NULL && (tmp = futhark_free_f64_1d(ctx, obj->v6)) != 0)
            ret = tmp;
        if (obj->v7 != NULL && (tmp = futhark_free_i64_1d(ctx, obj->v7)) != 0)
            ret = tmp;
        if (obj->v9 != NULL && (tmp = futhark_free_f64_1d(ctx, obj->v9)) != 0)
            ret = tmp;
        free(obj);
        obj = NULL;
    }
    return obj;
}
struct futhark_opaque_tup2_f64_f64 {
    double v0;
    double v1;
};
int futhark_project_opaque_tup2_f64_f64_0(struct futhark_context *ctx, double *out, const struct futhark_opaque_tup2_f64_f64 *obj)
{
    (void) ctx;
    
    double v;
    
    v = obj->v0;
    *out = v;
    return 0;
}
int futhark_project_opaque_tup2_f64_f64_1(struct futhark_context *ctx, double *out, const struct futhark_opaque_tup2_f64_f64 *obj)
{
    (void) ctx;
    
    double v;
    
    v = obj->v1;
    *out = v;
    return 0;
}
int futhark_new_opaque_tup2_f64_f64(struct futhark_context *ctx, struct futhark_opaque_tup2_f64_f64 **out, const double f_0, const double f_1)
{
    struct futhark_opaque_tup2_f64_f64 *v = malloc(sizeof(struct futhark_opaque_tup2_f64_f64));
    
    lock_lock(&ctx->lock);
    CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
    v->v0 = f_0;
    v->v1 = f_1;
    CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
    lock_unlock(&ctx->lock);
    *out = v;
    return FUTHARK_SUCCESS;
}
int futhark_free_opaque_tup2_f64_f64(struct futhark_context *ctx, struct futhark_opaque_tup2_f64_f64 *obj)
{
    (void) ctx;
    
    int ret = 0, tmp;
    
    free(obj);
    return ret;
}
int futhark_store_opaque_tup2_f64_f64(struct futhark_context *ctx, const struct futhark_opaque_tup2_f64_f64 *obj, void **p, size_t *n)
{
    (void) ctx;
    
    int ret = 0;
    int64_t size_0 = 7 + 0 * sizeof(int64_t) + 1 * sizeof(double);
    int64_t size_1 = 7 + 0 * sizeof(int64_t) + 1 * sizeof(double);
    
    *n = size_0 + size_1;
    if (p != NULL && *p == NULL)
        *p = malloc(*n);
    if (p != NULL) {
        unsigned char *out = *p;
        
        *out++ = 'b';
        *out++ = 2;
        *out++ = 0;
        memcpy(out, " f64", 4);
        out += 4;
        memcpy(out, &obj->v0, sizeof(obj->v0));
        out += sizeof(obj->v0);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 0;
        memcpy(out, " f64", 4);
        out += 4;
        memcpy(out, &obj->v1, sizeof(obj->v1));
        out += sizeof(obj->v1);
    }
    return ret;
}
struct futhark_opaque_tup2_f64_f64 *futhark_restore_opaque_tup2_f64_f64(struct futhark_context *ctx, const void *p)
{
    (void) ctx;
    
    int err = 0;
    const unsigned char *src = p;
    struct futhark_opaque_tup2_f64_f64 *obj = malloc(sizeof(struct futhark_opaque_tup2_f64_f64));
    
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 0;
    err |= memcmp(src, " f64", 4) != 0;
    src += 4;
    if (err == 0) {
        src += 0 * sizeof(int64_t);
    }
    
    const void *data_0 = src;
    
    src += sizeof(obj->v0);
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 0;
    err |= memcmp(src, " f64", 4) != 0;
    src += 4;
    if (err == 0) {
        src += 0 * sizeof(int64_t);
    }
    
    const void *data_1 = src;
    
    src += sizeof(obj->v1);
    if (err == 0) {
        memcpy(&obj->v0, data_0, sizeof(obj->v0));
        memcpy(&obj->v1, data_1, sizeof(obj->v1));
    }
    if (err != 0) {
        int ret = 0, tmp;
        
        free(obj);
        obj = NULL;
    }
    return obj;
}
struct futhark_opaque_arr1d_tup2_f64_f64 {
    struct futhark_f64_1d *v0;
    struct futhark_f64_1d *v1;
};
int futhark_project_opaque_arr1d_tup2_f64_f64_0(struct futhark_context *ctx, struct futhark_f64_1d **out, const struct futhark_opaque_arr1d_tup2_f64_f64 *obj)
{
    (void) ctx;
    
    struct futhark_f64_1d *v;
    
    lock_lock(&ctx->lock);
    CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
    v = malloc(sizeof(struct futhark_f64_1d));
    memcpy(v, obj->v0, sizeof(struct futhark_f64_1d));
    (void) (*v->mem.references)++;
    CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
    lock_unlock(&ctx->lock);
    *out = v;
    return 0;
}
int futhark_project_opaque_arr1d_tup2_f64_f64_1(struct futhark_context *ctx, struct futhark_f64_1d **out, const struct futhark_opaque_arr1d_tup2_f64_f64 *obj)
{
    (void) ctx;
    
    struct futhark_f64_1d *v;
    
    lock_lock(&ctx->lock);
    CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
    v = malloc(sizeof(struct futhark_f64_1d));
    memcpy(v, obj->v1, sizeof(struct futhark_f64_1d));
    (void) (*v->mem.references)++;
    CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
    lock_unlock(&ctx->lock);
    *out = v;
    return 0;
}
int futhark_zip_opaque_arr1d_tup2_f64_f64(struct futhark_context *ctx, struct futhark_opaque_arr1d_tup2_f64_f64 **out, const struct futhark_f64_1d *f_0, const struct futhark_f64_1d *f_1)
{
    if (!(f_0->shape[0] == f_1->shape[0])) {
        set_error(ctx, strdup("Cannot zip arrays with different shapes."));
        return 1;
    }
    
    struct futhark_opaque_arr1d_tup2_f64_f64 *v = malloc(sizeof(struct futhark_opaque_arr1d_tup2_f64_f64));
    
    lock_lock(&ctx->lock);
    CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
    {
        v->v0 = malloc(sizeof(struct futhark_f64_1d));
        *v->v0 = *f_0;
        (void) (*v->v0->mem.references)++;
    }
    {
        v->v1 = malloc(sizeof(struct futhark_f64_1d));
        *v->v1 = *f_1;
        (void) (*v->v1->mem.references)++;
    }
    CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
    lock_unlock(&ctx->lock);
    *out = v;
    return FUTHARK_SUCCESS;
}
int futhark_index_opaque_arr1d_tup2_f64_f64(struct futhark_context *ctx, struct futhark_opaque_tup2_f64_f64 **out, struct futhark_opaque_arr1d_tup2_f64_f64 *arr, int64_t i0)
{
    int err = 0;
    
    if (i0 >= 0 && i0 < arr->v0->shape[0]) {
        struct futhark_opaque_tup2_f64_f64 *v = malloc(sizeof(struct futhark_opaque_tup2_f64_f64));
        
        err = memcpy_gpu2host(ctx, false, (unsigned char *) &v->v0, 0, arr->v0->mem.mem, 8 * (i0 * 1), 8);
        err = memcpy_gpu2host(ctx, false, (unsigned char *) &v->v1, 0, arr->v1->mem.mem, 8 * (i0 * 1), 8);
        if (err == 0)
            *out = v;
    } else {
        err = 1;
        set_error(ctx, strdup("Index out of bounds."));
    }
    return err;
}
const int64_t *futhark_shape_opaque_arr1d_tup2_f64_f64(struct futhark_context *ctx, struct futhark_opaque_arr1d_tup2_f64_f64 *arr)
{
    (void) ctx;
    return arr->v0->shape;
}
int futhark_free_opaque_arr1d_tup2_f64_f64(struct futhark_context *ctx, struct futhark_opaque_arr1d_tup2_f64_f64 *obj)
{
    (void) ctx;
    
    int ret = 0, tmp;
    
    if (obj->v0 != NULL && (tmp = futhark_free_f64_1d(ctx, obj->v0)) != 0)
        ret = tmp;
    if (obj->v1 != NULL && (tmp = futhark_free_f64_1d(ctx, obj->v1)) != 0)
        ret = tmp;
    free(obj);
    return ret;
}
int futhark_store_opaque_arr1d_tup2_f64_f64(struct futhark_context *ctx, const struct futhark_opaque_arr1d_tup2_f64_f64 *obj, void **p, size_t *n)
{
    (void) ctx;
    
    int ret = 0;
    int64_t size_0 = 7 + 1 * sizeof(int64_t) + futhark_shape_f64_1d(ctx, obj->v0)[0] * sizeof(double);
    int64_t size_1 = 7 + 1 * sizeof(int64_t) + futhark_shape_f64_1d(ctx, obj->v1)[0] * sizeof(double);
    
    *n = size_0 + size_1;
    if (p != NULL && *p == NULL)
        *p = malloc(*n);
    if (p != NULL) {
        unsigned char *out = *p;
        
        *out++ = 'b';
        *out++ = 2;
        *out++ = 1;
        memcpy(out, " f64", 4);
        out += 4;
        memcpy(out, futhark_shape_f64_1d(ctx, obj->v0), 1 * sizeof(int64_t));
        out += 1 * sizeof(int64_t);
        ret |= futhark_values_f64_1d(ctx, obj->v0, (void *) out);
        out += futhark_shape_f64_1d(ctx, obj->v0)[0] * sizeof(double);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 1;
        memcpy(out, " f64", 4);
        out += 4;
        memcpy(out, futhark_shape_f64_1d(ctx, obj->v1), 1 * sizeof(int64_t));
        out += 1 * sizeof(int64_t);
        ret |= futhark_values_f64_1d(ctx, obj->v1, (void *) out);
        out += futhark_shape_f64_1d(ctx, obj->v1)[0] * sizeof(double);
    }
    return ret;
}
struct futhark_opaque_arr1d_tup2_f64_f64 *futhark_restore_opaque_arr1d_tup2_f64_f64(struct futhark_context *ctx, const void *p)
{
    (void) ctx;
    
    int err = 0;
    const unsigned char *src = p;
    struct futhark_opaque_arr1d_tup2_f64_f64 *obj = malloc(sizeof(struct futhark_opaque_arr1d_tup2_f64_f64));
    int64_t shape_0[1] = {0};
    
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 1;
    err |= memcmp(src, " f64", 4) != 0;
    src += 4;
    if (err == 0) {
        memcpy(shape_0, src, 1 * sizeof(int64_t));
        src += 1 * sizeof(int64_t);
    }
    
    const void *data_0 = src;
    
    obj->v0 = NULL;
    src += shape_0[0] * sizeof(double);
    
    int64_t shape_1[1] = {0};
    
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 1;
    err |= memcmp(src, " f64", 4) != 0;
    src += 4;
    if (err == 0) {
        memcpy(shape_1, src, 1 * sizeof(int64_t));
        src += 1 * sizeof(int64_t);
    }
    
    const void *data_1 = src;
    
    obj->v1 = NULL;
    src += shape_1[0] * sizeof(double);
    if (err == 0) {
        obj->v0 = futhark_new_f64_1d(ctx, data_0, shape_0[0]);
        if (obj->v0 == NULL)
            err = 1;
        obj->v1 = futhark_new_f64_1d(ctx, data_1, shape_1[0]);
        if (obj->v1 == NULL)
            err = 1;
    }
    if (err != 0) {
        int ret = 0, tmp;
        
        if (obj->v0 != NULL && (tmp = futhark_free_f64_1d(ctx, obj->v0)) != 0)
            ret = tmp;
        if (obj->v1 != NULL && (tmp = futhark_free_f64_1d(ctx, obj->v1)) != 0)
            ret = tmp;
        free(obj);
        obj = NULL;
    }
    return obj;
}
struct futhark_opaque_a8fdbed66266f52db9d5a0da8b1f6763 {
    struct futhark_bool_1d *v0;
    struct futhark_i64_1d *v1;
    struct futhark_f64_1d *v2;
    struct futhark_f64_1d *v3;
    int64_t v4;
    int64_t v5;
    int64_t v6;
    struct futhark_bool_1d *v7;
    int64_t v8;
    int64_t v9;
    struct futhark_i64_1d *v10;
};
int futhark_project_opaque_a8fdbed66266f52db9d5a0da8b1f6763_buff_isCore(struct futhark_context *ctx, struct futhark_bool_1d **out, const struct futhark_opaque_a8fdbed66266f52db9d5a0da8b1f6763 *obj)
{
    (void) ctx;
    
    struct futhark_bool_1d *v;
    
    lock_lock(&ctx->lock);
    CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
    v = malloc(sizeof(struct futhark_bool_1d));
    memcpy(v, obj->v0, sizeof(struct futhark_bool_1d));
    (void) (*v->mem.references)++;
    CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
    lock_unlock(&ctx->lock);
    *out = v;
    return 0;
}
int futhark_project_opaque_a8fdbed66266f52db9d5a0da8b1f6763_buffered_ids(struct futhark_context *ctx, struct futhark_i64_1d **out, const struct futhark_opaque_a8fdbed66266f52db9d5a0da8b1f6763 *obj)
{
    (void) ctx;
    
    struct futhark_i64_1d *v;
    
    lock_lock(&ctx->lock);
    CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
    v = malloc(sizeof(struct futhark_i64_1d));
    memcpy(v, obj->v1, sizeof(struct futhark_i64_1d));
    (void) (*v->mem.references)++;
    CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
    lock_unlock(&ctx->lock);
    *out = v;
    return 0;
}
int futhark_project_opaque_a8fdbed66266f52db9d5a0da8b1f6763_buffered_pts(struct futhark_context *ctx, struct futhark_opaque_arr1d_tup2_f64_f64 **out, const struct futhark_opaque_a8fdbed66266f52db9d5a0da8b1f6763 *obj)
{
    (void) ctx;
    
    struct futhark_opaque_arr1d_tup2_f64_f64 *v;
    
    lock_lock(&ctx->lock);
    CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
    v = malloc(sizeof(struct futhark_opaque_arr1d_tup2_f64_f64));
    v->v0 = malloc(sizeof(*v->v0));
    *v->v0 = *obj->v2;
    (void) (*v->v0->mem.references)++;
    v->v1 = malloc(sizeof(*v->v1));
    *v->v1 = *obj->v3;
    (void) (*v->v1->mem.references)++;
    CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
    lock_unlock(&ctx->lock);
    *out = v;
    return 0;
}
int futhark_project_opaque_a8fdbed66266f52db9d5a0da8b1f6763_chainOffs(struct futhark_context *ctx, int64_t *out, const struct futhark_opaque_a8fdbed66266f52db9d5a0da8b1f6763 *obj)
{
    (void) ctx;
    
    int64_t v;
    
    v = obj->v4;
    *out = v;
    return 0;
}
int futhark_project_opaque_a8fdbed66266f52db9d5a0da8b1f6763_cur_part_id(struct futhark_context *ctx, int64_t *out, const struct futhark_opaque_a8fdbed66266f52db9d5a0da8b1f6763 *obj)
{
    (void) ctx;
    
    int64_t v;
    
    v = obj->v5;
    *out = v;
    return 0;
}
int futhark_project_opaque_a8fdbed66266f52db9d5a0da8b1f6763_cur_part_order(struct futhark_context *ctx, int64_t *out, const struct futhark_opaque_a8fdbed66266f52db9d5a0da8b1f6763 *obj)
{
    (void) ctx;
    
    int64_t v;
    
    v = obj->v6;
    *out = v;
    return 0;
}
int futhark_project_opaque_a8fdbed66266f52db9d5a0da8b1f6763_isPartVisited(struct futhark_context *ctx, struct futhark_bool_1d **out, const struct futhark_opaque_a8fdbed66266f52db9d5a0da8b1f6763 *obj)
{
    (void) ctx;
    
    struct futhark_bool_1d *v;
    
    lock_lock(&ctx->lock);
    CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
    v = malloc(sizeof(struct futhark_bool_1d));
    memcpy(v, obj->v7, sizeof(struct futhark_bool_1d));
    (void) (*v->mem.references)++;
    CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
    lock_unlock(&ctx->lock);
    *out = v;
    return 0;
}
int futhark_project_opaque_a8fdbed66266f52db9d5a0da8b1f6763_next_offs(struct futhark_context *ctx, int64_t *out, const struct futhark_opaque_a8fdbed66266f52db9d5a0da8b1f6763 *obj)
{
    (void) ctx;
    
    int64_t v;
    
    v = obj->v8;
    *out = v;
    return 0;
}
int futhark_project_opaque_a8fdbed66266f52db9d5a0da8b1f6763_offs(struct futhark_context *ctx, int64_t *out, const struct futhark_opaque_a8fdbed66266f52db9d5a0da8b1f6763 *obj)
{
    (void) ctx;
    
    int64_t v;
    
    v = obj->v9;
    *out = v;
    return 0;
}
int futhark_project_opaque_a8fdbed66266f52db9d5a0da8b1f6763_relevantParts(struct futhark_context *ctx, struct futhark_i64_1d **out, const struct futhark_opaque_a8fdbed66266f52db9d5a0da8b1f6763 *obj)
{
    (void) ctx;
    
    struct futhark_i64_1d *v;
    
    lock_lock(&ctx->lock);
    CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
    v = malloc(sizeof(struct futhark_i64_1d));
    memcpy(v, obj->v10, sizeof(struct futhark_i64_1d));
    (void) (*v->mem.references)++;
    CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
    lock_unlock(&ctx->lock);
    *out = v;
    return 0;
}
int futhark_new_opaque_a8fdbed66266f52db9d5a0da8b1f6763(struct futhark_context *ctx, struct futhark_opaque_a8fdbed66266f52db9d5a0da8b1f6763 **out, const struct futhark_bool_1d *f_buff_isCore, const struct futhark_i64_1d *f_buffered_ids, const struct futhark_opaque_arr1d_tup2_f64_f64 *f_buffered_pts, const int64_t f_chainOffs, const int64_t f_cur_part_id, const int64_t f_cur_part_order, const struct futhark_bool_1d *f_isPartVisited, const int64_t f_next_offs, const int64_t f_offs, const struct futhark_i64_1d *f_relevantParts)
{
    struct futhark_opaque_a8fdbed66266f52db9d5a0da8b1f6763 *v = malloc(sizeof(struct futhark_opaque_a8fdbed66266f52db9d5a0da8b1f6763));
    
    lock_lock(&ctx->lock);
    CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
    {
        v->v0 = malloc(sizeof(struct futhark_bool_1d));
        *v->v0 = *f_buff_isCore;
        (void) (*v->v0->mem.references)++;
    }
    {
        v->v1 = malloc(sizeof(struct futhark_i64_1d));
        *v->v1 = *f_buffered_ids;
        (void) (*v->v1->mem.references)++;
    }
    {
        {
            v->v2 = malloc(sizeof(*f_buffered_pts->v0));
            *v->v2 = *f_buffered_pts->v0;
            (void) (*v->v2->mem.references)++;
        }
        {
            v->v3 = malloc(sizeof(*f_buffered_pts->v1));
            *v->v3 = *f_buffered_pts->v1;
            (void) (*v->v3->mem.references)++;
        }
    }
    v->v4 = f_chainOffs;
    v->v5 = f_cur_part_id;
    v->v6 = f_cur_part_order;
    {
        v->v7 = malloc(sizeof(struct futhark_bool_1d));
        *v->v7 = *f_isPartVisited;
        (void) (*v->v7->mem.references)++;
    }
    v->v8 = f_next_offs;
    v->v9 = f_offs;
    {
        v->v10 = malloc(sizeof(struct futhark_i64_1d));
        *v->v10 = *f_relevantParts;
        (void) (*v->v10->mem.references)++;
    }
    CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
    lock_unlock(&ctx->lock);
    *out = v;
    return FUTHARK_SUCCESS;
}
int futhark_free_opaque_a8fdbed66266f52db9d5a0da8b1f6763(struct futhark_context *ctx, struct futhark_opaque_a8fdbed66266f52db9d5a0da8b1f6763 *obj)
{
    (void) ctx;
    
    int ret = 0, tmp;
    
    if (obj->v0 != NULL && (tmp = futhark_free_bool_1d(ctx, obj->v0)) != 0)
        ret = tmp;
    if (obj->v1 != NULL && (tmp = futhark_free_i64_1d(ctx, obj->v1)) != 0)
        ret = tmp;
    if (obj->v2 != NULL && (tmp = futhark_free_f64_1d(ctx, obj->v2)) != 0)
        ret = tmp;
    if (obj->v3 != NULL && (tmp = futhark_free_f64_1d(ctx, obj->v3)) != 0)
        ret = tmp;
    if (obj->v7 != NULL && (tmp = futhark_free_bool_1d(ctx, obj->v7)) != 0)
        ret = tmp;
    if (obj->v10 != NULL && (tmp = futhark_free_i64_1d(ctx, obj->v10)) != 0)
        ret = tmp;
    free(obj);
    return ret;
}
int futhark_store_opaque_a8fdbed66266f52db9d5a0da8b1f6763(struct futhark_context *ctx, const struct futhark_opaque_a8fdbed66266f52db9d5a0da8b1f6763 *obj, void **p, size_t *n)
{
    (void) ctx;
    
    int ret = 0;
    int64_t size_0 = 7 + 1 * sizeof(int64_t) + futhark_shape_bool_1d(ctx, obj->v0)[0] * sizeof(bool);
    int64_t size_1 = 7 + 1 * sizeof(int64_t) + futhark_shape_i64_1d(ctx, obj->v1)[0] * sizeof(int64_t);
    int64_t size_2 = 7 + 1 * sizeof(int64_t) + futhark_shape_f64_1d(ctx, obj->v2)[0] * sizeof(double);
    int64_t size_3 = 7 + 1 * sizeof(int64_t) + futhark_shape_f64_1d(ctx, obj->v3)[0] * sizeof(double);
    int64_t size_4 = 7 + 0 * sizeof(int64_t) + 1 * sizeof(int64_t);
    int64_t size_5 = 7 + 0 * sizeof(int64_t) + 1 * sizeof(int64_t);
    int64_t size_6 = 7 + 0 * sizeof(int64_t) + 1 * sizeof(int64_t);
    int64_t size_7 = 7 + 1 * sizeof(int64_t) + futhark_shape_bool_1d(ctx, obj->v7)[0] * sizeof(bool);
    int64_t size_8 = 7 + 0 * sizeof(int64_t) + 1 * sizeof(int64_t);
    int64_t size_9 = 7 + 0 * sizeof(int64_t) + 1 * sizeof(int64_t);
    int64_t size_10 = 7 + 1 * sizeof(int64_t) + futhark_shape_i64_1d(ctx, obj->v10)[0] * sizeof(int64_t);
    
    *n = size_0 + size_1 + size_2 + size_3 + size_4 + size_5 + size_6 + size_7 + size_8 + size_9 + size_10;
    if (p != NULL && *p == NULL)
        *p = malloc(*n);
    if (p != NULL) {
        unsigned char *out = *p;
        
        *out++ = 'b';
        *out++ = 2;
        *out++ = 1;
        memcpy(out, "bool", 4);
        out += 4;
        memcpy(out, futhark_shape_bool_1d(ctx, obj->v0), 1 * sizeof(int64_t));
        out += 1 * sizeof(int64_t);
        ret |= futhark_values_bool_1d(ctx, obj->v0, (void *) out);
        out += futhark_shape_bool_1d(ctx, obj->v0)[0] * sizeof(bool);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 1;
        memcpy(out, " i64", 4);
        out += 4;
        memcpy(out, futhark_shape_i64_1d(ctx, obj->v1), 1 * sizeof(int64_t));
        out += 1 * sizeof(int64_t);
        ret |= futhark_values_i64_1d(ctx, obj->v1, (void *) out);
        out += futhark_shape_i64_1d(ctx, obj->v1)[0] * sizeof(int64_t);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 1;
        memcpy(out, " f64", 4);
        out += 4;
        memcpy(out, futhark_shape_f64_1d(ctx, obj->v2), 1 * sizeof(int64_t));
        out += 1 * sizeof(int64_t);
        ret |= futhark_values_f64_1d(ctx, obj->v2, (void *) out);
        out += futhark_shape_f64_1d(ctx, obj->v2)[0] * sizeof(double);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 1;
        memcpy(out, " f64", 4);
        out += 4;
        memcpy(out, futhark_shape_f64_1d(ctx, obj->v3), 1 * sizeof(int64_t));
        out += 1 * sizeof(int64_t);
        ret |= futhark_values_f64_1d(ctx, obj->v3, (void *) out);
        out += futhark_shape_f64_1d(ctx, obj->v3)[0] * sizeof(double);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 0;
        memcpy(out, " i64", 4);
        out += 4;
        memcpy(out, &obj->v4, sizeof(obj->v4));
        out += sizeof(obj->v4);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 0;
        memcpy(out, " i64", 4);
        out += 4;
        memcpy(out, &obj->v5, sizeof(obj->v5));
        out += sizeof(obj->v5);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 0;
        memcpy(out, " i64", 4);
        out += 4;
        memcpy(out, &obj->v6, sizeof(obj->v6));
        out += sizeof(obj->v6);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 1;
        memcpy(out, "bool", 4);
        out += 4;
        memcpy(out, futhark_shape_bool_1d(ctx, obj->v7), 1 * sizeof(int64_t));
        out += 1 * sizeof(int64_t);
        ret |= futhark_values_bool_1d(ctx, obj->v7, (void *) out);
        out += futhark_shape_bool_1d(ctx, obj->v7)[0] * sizeof(bool);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 0;
        memcpy(out, " i64", 4);
        out += 4;
        memcpy(out, &obj->v8, sizeof(obj->v8));
        out += sizeof(obj->v8);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 0;
        memcpy(out, " i64", 4);
        out += 4;
        memcpy(out, &obj->v9, sizeof(obj->v9));
        out += sizeof(obj->v9);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 1;
        memcpy(out, " i64", 4);
        out += 4;
        memcpy(out, futhark_shape_i64_1d(ctx, obj->v10), 1 * sizeof(int64_t));
        out += 1 * sizeof(int64_t);
        ret |= futhark_values_i64_1d(ctx, obj->v10, (void *) out);
        out += futhark_shape_i64_1d(ctx, obj->v10)[0] * sizeof(int64_t);
    }
    return ret;
}
struct futhark_opaque_a8fdbed66266f52db9d5a0da8b1f6763 *futhark_restore_opaque_a8fdbed66266f52db9d5a0da8b1f6763(struct futhark_context *ctx, const void *p)
{
    (void) ctx;
    
    int err = 0;
    const unsigned char *src = p;
    struct futhark_opaque_a8fdbed66266f52db9d5a0da8b1f6763 *obj = malloc(sizeof(struct futhark_opaque_a8fdbed66266f52db9d5a0da8b1f6763));
    int64_t shape_0[1] = {0};
    
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 1;
    err |= memcmp(src, "bool", 4) != 0;
    src += 4;
    if (err == 0) {
        memcpy(shape_0, src, 1 * sizeof(int64_t));
        src += 1 * sizeof(int64_t);
    }
    
    const void *data_0 = src;
    
    obj->v0 = NULL;
    src += shape_0[0] * sizeof(bool);
    
    int64_t shape_1[1] = {0};
    
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 1;
    err |= memcmp(src, " i64", 4) != 0;
    src += 4;
    if (err == 0) {
        memcpy(shape_1, src, 1 * sizeof(int64_t));
        src += 1 * sizeof(int64_t);
    }
    
    const void *data_1 = src;
    
    obj->v1 = NULL;
    src += shape_1[0] * sizeof(int64_t);
    
    int64_t shape_2[1] = {0};
    
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 1;
    err |= memcmp(src, " f64", 4) != 0;
    src += 4;
    if (err == 0) {
        memcpy(shape_2, src, 1 * sizeof(int64_t));
        src += 1 * sizeof(int64_t);
    }
    
    const void *data_2 = src;
    
    obj->v2 = NULL;
    src += shape_2[0] * sizeof(double);
    
    int64_t shape_3[1] = {0};
    
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 1;
    err |= memcmp(src, " f64", 4) != 0;
    src += 4;
    if (err == 0) {
        memcpy(shape_3, src, 1 * sizeof(int64_t));
        src += 1 * sizeof(int64_t);
    }
    
    const void *data_3 = src;
    
    obj->v3 = NULL;
    src += shape_3[0] * sizeof(double);
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 0;
    err |= memcmp(src, " i64", 4) != 0;
    src += 4;
    if (err == 0) {
        src += 0 * sizeof(int64_t);
    }
    
    const void *data_4 = src;
    
    src += sizeof(obj->v4);
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 0;
    err |= memcmp(src, " i64", 4) != 0;
    src += 4;
    if (err == 0) {
        src += 0 * sizeof(int64_t);
    }
    
    const void *data_5 = src;
    
    src += sizeof(obj->v5);
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 0;
    err |= memcmp(src, " i64", 4) != 0;
    src += 4;
    if (err == 0) {
        src += 0 * sizeof(int64_t);
    }
    
    const void *data_6 = src;
    
    src += sizeof(obj->v6);
    
    int64_t shape_7[1] = {0};
    
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 1;
    err |= memcmp(src, "bool", 4) != 0;
    src += 4;
    if (err == 0) {
        memcpy(shape_7, src, 1 * sizeof(int64_t));
        src += 1 * sizeof(int64_t);
    }
    
    const void *data_7 = src;
    
    obj->v7 = NULL;
    src += shape_7[0] * sizeof(bool);
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 0;
    err |= memcmp(src, " i64", 4) != 0;
    src += 4;
    if (err == 0) {
        src += 0 * sizeof(int64_t);
    }
    
    const void *data_8 = src;
    
    src += sizeof(obj->v8);
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 0;
    err |= memcmp(src, " i64", 4) != 0;
    src += 4;
    if (err == 0) {
        src += 0 * sizeof(int64_t);
    }
    
    const void *data_9 = src;
    
    src += sizeof(obj->v9);
    
    int64_t shape_10[1] = {0};
    
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 1;
    err |= memcmp(src, " i64", 4) != 0;
    src += 4;
    if (err == 0) {
        memcpy(shape_10, src, 1 * sizeof(int64_t));
        src += 1 * sizeof(int64_t);
    }
    
    const void *data_10 = src;
    
    obj->v10 = NULL;
    src += shape_10[0] * sizeof(int64_t);
    if (err == 0) {
        obj->v0 = futhark_new_bool_1d(ctx, data_0, shape_0[0]);
        if (obj->v0 == NULL)
            err = 1;
        obj->v1 = futhark_new_i64_1d(ctx, data_1, shape_1[0]);
        if (obj->v1 == NULL)
            err = 1;
        obj->v2 = futhark_new_f64_1d(ctx, data_2, shape_2[0]);
        if (obj->v2 == NULL)
            err = 1;
        obj->v3 = futhark_new_f64_1d(ctx, data_3, shape_3[0]);
        if (obj->v3 == NULL)
            err = 1;
        memcpy(&obj->v4, data_4, sizeof(obj->v4));
        memcpy(&obj->v5, data_5, sizeof(obj->v5));
        memcpy(&obj->v6, data_6, sizeof(obj->v6));
        obj->v7 = futhark_new_bool_1d(ctx, data_7, shape_7[0]);
        if (obj->v7 == NULL)
            err = 1;
        memcpy(&obj->v8, data_8, sizeof(obj->v8));
        memcpy(&obj->v9, data_9, sizeof(obj->v9));
        obj->v10 = futhark_new_i64_1d(ctx, data_10, shape_10[0]);
        if (obj->v10 == NULL)
            err = 1;
    }
    if (err != 0) {
        int ret = 0, tmp;
        
        if (obj->v0 != NULL && (tmp = futhark_free_bool_1d(ctx, obj->v0)) != 0)
            ret = tmp;
        if (obj->v1 != NULL && (tmp = futhark_free_i64_1d(ctx, obj->v1)) != 0)
            ret = tmp;
        if (obj->v2 != NULL && (tmp = futhark_free_f64_1d(ctx, obj->v2)) != 0)
            ret = tmp;
        if (obj->v3 != NULL && (tmp = futhark_free_f64_1d(ctx, obj->v3)) != 0)
            ret = tmp;
        if (obj->v7 != NULL && (tmp = futhark_free_bool_1d(ctx, obj->v7)) != 0)
            ret = tmp;
        if (obj->v10 != NULL && (tmp = futhark_free_i64_1d(ctx, obj->v10)) != 0)
            ret = tmp;
        free(obj);
        obj = NULL;
    }
    return obj;
}
struct futhark_opaque_4dedc823193c594b5c01727ae8ac5943 {
    struct futhark_i64_1d *v0;
    struct futhark_f64_1d *v1;
    struct futhark_f64_1d *v2;
    struct futhark_f64_1d *v3;
    struct futhark_f64_1d *v4;
    struct futhark_bool_1d *v5;
    struct futhark_bool_1d *v6;
    struct futhark_bool_1d *v7;
    struct futhark_bool_1d *v8;
    struct futhark_f64_1d *v9;
    struct futhark_f64_1d *v10;
    struct futhark_i64_1d *v11;
    int64_t v12;
};
int futhark_project_opaque_4dedc823193c594b5c01727ae8ac5943_chain_ids(struct futhark_context *ctx, struct futhark_i64_1d **out, const struct futhark_opaque_4dedc823193c594b5c01727ae8ac5943 *obj)
{
    (void) ctx;
    
    struct futhark_i64_1d *v;
    
    lock_lock(&ctx->lock);
    CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
    v = malloc(sizeof(struct futhark_i64_1d));
    memcpy(v, obj->v0, sizeof(struct futhark_i64_1d));
    (void) (*v->mem.references)++;
    CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
    lock_unlock(&ctx->lock);
    *out = v;
    return 0;
}
int futhark_project_opaque_4dedc823193c594b5c01727ae8ac5943_dat(struct futhark_context *ctx, struct futhark_opaque_arr1d_tup2_f64_f64 **out, const struct futhark_opaque_4dedc823193c594b5c01727ae8ac5943 *obj)
{
    (void) ctx;
    
    struct futhark_opaque_arr1d_tup2_f64_f64 *v;
    
    lock_lock(&ctx->lock);
    CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
    v = malloc(sizeof(struct futhark_opaque_arr1d_tup2_f64_f64));
    v->v0 = malloc(sizeof(*v->v0));
    *v->v0 = *obj->v1;
    (void) (*v->v0->mem.references)++;
    v->v1 = malloc(sizeof(*v->v1));
    *v->v1 = *obj->v2;
    (void) (*v->v1->mem.references)++;
    CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
    lock_unlock(&ctx->lock);
    *out = v;
    return 0;
}
int futhark_project_opaque_4dedc823193c594b5c01727ae8ac5943_inner_max_coord(struct futhark_context *ctx, struct futhark_f64_1d **out, const struct futhark_opaque_4dedc823193c594b5c01727ae8ac5943 *obj)
{
    (void) ctx;
    
    struct futhark_f64_1d *v;
    
    lock_lock(&ctx->lock);
    CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
    v = malloc(sizeof(struct futhark_f64_1d));
    memcpy(v, obj->v3, sizeof(struct futhark_f64_1d));
    (void) (*v->mem.references)++;
    CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
    lock_unlock(&ctx->lock);
    *out = v;
    return 0;
}
int futhark_project_opaque_4dedc823193c594b5c01727ae8ac5943_inner_min_coord(struct futhark_context *ctx, struct futhark_f64_1d **out, const struct futhark_opaque_4dedc823193c594b5c01727ae8ac5943 *obj)
{
    (void) ctx;
    
    struct futhark_f64_1d *v;
    
    lock_lock(&ctx->lock);
    CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
    v = malloc(sizeof(struct futhark_f64_1d));
    memcpy(v, obj->v4, sizeof(struct futhark_f64_1d));
    (void) (*v->mem.references)++;
    CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
    lock_unlock(&ctx->lock);
    *out = v;
    return 0;
}
int futhark_project_opaque_4dedc823193c594b5c01727ae8ac5943_isCore(struct futhark_context *ctx, struct futhark_bool_1d **out, const struct futhark_opaque_4dedc823193c594b5c01727ae8ac5943 *obj)
{
    (void) ctx;
    
    struct futhark_bool_1d *v;
    
    lock_lock(&ctx->lock);
    CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
    v = malloc(sizeof(struct futhark_bool_1d));
    memcpy(v, obj->v5, sizeof(struct futhark_bool_1d));
    (void) (*v->mem.references)++;
    CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
    lock_unlock(&ctx->lock);
    *out = v;
    return 0;
}
int futhark_project_opaque_4dedc823193c594b5c01727ae8ac5943_isMargin(struct futhark_context *ctx, struct futhark_bool_1d **out, const struct futhark_opaque_4dedc823193c594b5c01727ae8ac5943 *obj)
{
    (void) ctx;
    
    struct futhark_bool_1d *v;
    
    lock_lock(&ctx->lock);
    CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
    v = malloc(sizeof(struct futhark_bool_1d));
    memcpy(v, obj->v6, sizeof(struct futhark_bool_1d));
    (void) (*v->mem.references)++;
    CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
    lock_unlock(&ctx->lock);
    *out = v;
    return 0;
}
int futhark_project_opaque_4dedc823193c594b5c01727ae8ac5943_isNeighbourVisited(struct futhark_context *ctx, struct futhark_bool_1d **out, const struct futhark_opaque_4dedc823193c594b5c01727ae8ac5943 *obj)
{
    (void) ctx;
    
    struct futhark_bool_1d *v;
    
    lock_lock(&ctx->lock);
    CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
    v = malloc(sizeof(struct futhark_bool_1d));
    memcpy(v, obj->v7, sizeof(struct futhark_bool_1d));
    (void) (*v->mem.references)++;
    CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
    lock_unlock(&ctx->lock);
    *out = v;
    return 0;
}
int futhark_project_opaque_4dedc823193c594b5c01727ae8ac5943_isTightMargin(struct futhark_context *ctx, struct futhark_bool_1d **out, const struct futhark_opaque_4dedc823193c594b5c01727ae8ac5943 *obj)
{
    (void) ctx;
    
    struct futhark_bool_1d *v;
    
    lock_lock(&ctx->lock);
    CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
    v = malloc(sizeof(struct futhark_bool_1d));
    memcpy(v, obj->v8, sizeof(struct futhark_bool_1d));
    (void) (*v->mem.references)++;
    CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
    lock_unlock(&ctx->lock);
    *out = v;
    return 0;
}
int futhark_project_opaque_4dedc823193c594b5c01727ae8ac5943_max_coord(struct futhark_context *ctx, struct futhark_f64_1d **out, const struct futhark_opaque_4dedc823193c594b5c01727ae8ac5943 *obj)
{
    (void) ctx;
    
    struct futhark_f64_1d *v;
    
    lock_lock(&ctx->lock);
    CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
    v = malloc(sizeof(struct futhark_f64_1d));
    memcpy(v, obj->v9, sizeof(struct futhark_f64_1d));
    (void) (*v->mem.references)++;
    CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
    lock_unlock(&ctx->lock);
    *out = v;
    return 0;
}
int futhark_project_opaque_4dedc823193c594b5c01727ae8ac5943_min_coord(struct futhark_context *ctx, struct futhark_f64_1d **out, const struct futhark_opaque_4dedc823193c594b5c01727ae8ac5943 *obj)
{
    (void) ctx;
    
    struct futhark_f64_1d *v;
    
    lock_lock(&ctx->lock);
    CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
    v = malloc(sizeof(struct futhark_f64_1d));
    memcpy(v, obj->v10, sizeof(struct futhark_f64_1d));
    (void) (*v->mem.references)++;
    CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
    lock_unlock(&ctx->lock);
    *out = v;
    return 0;
}
int futhark_project_opaque_4dedc823193c594b5c01727ae8ac5943_neighbours(struct futhark_context *ctx, struct futhark_i64_1d **out, const struct futhark_opaque_4dedc823193c594b5c01727ae8ac5943 *obj)
{
    (void) ctx;
    
    struct futhark_i64_1d *v;
    
    lock_lock(&ctx->lock);
    CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
    v = malloc(sizeof(struct futhark_i64_1d));
    memcpy(v, obj->v11, sizeof(struct futhark_i64_1d));
    (void) (*v->mem.references)++;
    CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
    lock_unlock(&ctx->lock);
    *out = v;
    return 0;
}
int futhark_project_opaque_4dedc823193c594b5c01727ae8ac5943_part_id(struct futhark_context *ctx, int64_t *out, const struct futhark_opaque_4dedc823193c594b5c01727ae8ac5943 *obj)
{
    (void) ctx;
    
    int64_t v;
    
    v = obj->v12;
    *out = v;
    return 0;
}
int futhark_new_opaque_4dedc823193c594b5c01727ae8ac5943(struct futhark_context *ctx, struct futhark_opaque_4dedc823193c594b5c01727ae8ac5943 **out, const struct futhark_i64_1d *f_chain_ids, const struct futhark_opaque_arr1d_tup2_f64_f64 *f_dat, const struct futhark_f64_1d *f_inner_max_coord, const struct futhark_f64_1d *f_inner_min_coord, const struct futhark_bool_1d *f_isCore, const struct futhark_bool_1d *f_isMargin, const struct futhark_bool_1d *f_isNeighbourVisited, const struct futhark_bool_1d *f_isTightMargin, const struct futhark_f64_1d *f_max_coord, const struct futhark_f64_1d *f_min_coord, const struct futhark_i64_1d *f_neighbours, const int64_t f_part_id)
{
    struct futhark_opaque_4dedc823193c594b5c01727ae8ac5943 *v = malloc(sizeof(struct futhark_opaque_4dedc823193c594b5c01727ae8ac5943));
    
    lock_lock(&ctx->lock);
    CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
    {
        v->v0 = malloc(sizeof(struct futhark_i64_1d));
        *v->v0 = *f_chain_ids;
        (void) (*v->v0->mem.references)++;
    }
    {
        {
            v->v1 = malloc(sizeof(*f_dat->v0));
            *v->v1 = *f_dat->v0;
            (void) (*v->v1->mem.references)++;
        }
        {
            v->v2 = malloc(sizeof(*f_dat->v1));
            *v->v2 = *f_dat->v1;
            (void) (*v->v2->mem.references)++;
        }
    }
    {
        v->v3 = malloc(sizeof(struct futhark_f64_1d));
        *v->v3 = *f_inner_max_coord;
        (void) (*v->v3->mem.references)++;
    }
    {
        v->v4 = malloc(sizeof(struct futhark_f64_1d));
        *v->v4 = *f_inner_min_coord;
        (void) (*v->v4->mem.references)++;
    }
    {
        v->v5 = malloc(sizeof(struct futhark_bool_1d));
        *v->v5 = *f_isCore;
        (void) (*v->v5->mem.references)++;
    }
    {
        v->v6 = malloc(sizeof(struct futhark_bool_1d));
        *v->v6 = *f_isMargin;
        (void) (*v->v6->mem.references)++;
    }
    {
        v->v7 = malloc(sizeof(struct futhark_bool_1d));
        *v->v7 = *f_isNeighbourVisited;
        (void) (*v->v7->mem.references)++;
    }
    {
        v->v8 = malloc(sizeof(struct futhark_bool_1d));
        *v->v8 = *f_isTightMargin;
        (void) (*v->v8->mem.references)++;
    }
    {
        v->v9 = malloc(sizeof(struct futhark_f64_1d));
        *v->v9 = *f_max_coord;
        (void) (*v->v9->mem.references)++;
    }
    {
        v->v10 = malloc(sizeof(struct futhark_f64_1d));
        *v->v10 = *f_min_coord;
        (void) (*v->v10->mem.references)++;
    }
    {
        v->v11 = malloc(sizeof(struct futhark_i64_1d));
        *v->v11 = *f_neighbours;
        (void) (*v->v11->mem.references)++;
    }
    v->v12 = f_part_id;
    CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
    lock_unlock(&ctx->lock);
    *out = v;
    return FUTHARK_SUCCESS;
}
int futhark_free_opaque_4dedc823193c594b5c01727ae8ac5943(struct futhark_context *ctx, struct futhark_opaque_4dedc823193c594b5c01727ae8ac5943 *obj)
{
    (void) ctx;
    
    int ret = 0, tmp;
    
    if (obj->v0 != NULL && (tmp = futhark_free_i64_1d(ctx, obj->v0)) != 0)
        ret = tmp;
    if (obj->v1 != NULL && (tmp = futhark_free_f64_1d(ctx, obj->v1)) != 0)
        ret = tmp;
    if (obj->v2 != NULL && (tmp = futhark_free_f64_1d(ctx, obj->v2)) != 0)
        ret = tmp;
    if (obj->v3 != NULL && (tmp = futhark_free_f64_1d(ctx, obj->v3)) != 0)
        ret = tmp;
    if (obj->v4 != NULL && (tmp = futhark_free_f64_1d(ctx, obj->v4)) != 0)
        ret = tmp;
    if (obj->v5 != NULL && (tmp = futhark_free_bool_1d(ctx, obj->v5)) != 0)
        ret = tmp;
    if (obj->v6 != NULL && (tmp = futhark_free_bool_1d(ctx, obj->v6)) != 0)
        ret = tmp;
    if (obj->v7 != NULL && (tmp = futhark_free_bool_1d(ctx, obj->v7)) != 0)
        ret = tmp;
    if (obj->v8 != NULL && (tmp = futhark_free_bool_1d(ctx, obj->v8)) != 0)
        ret = tmp;
    if (obj->v9 != NULL && (tmp = futhark_free_f64_1d(ctx, obj->v9)) != 0)
        ret = tmp;
    if (obj->v10 != NULL && (tmp = futhark_free_f64_1d(ctx, obj->v10)) != 0)
        ret = tmp;
    if (obj->v11 != NULL && (tmp = futhark_free_i64_1d(ctx, obj->v11)) != 0)
        ret = tmp;
    free(obj);
    return ret;
}
int futhark_store_opaque_4dedc823193c594b5c01727ae8ac5943(struct futhark_context *ctx, const struct futhark_opaque_4dedc823193c594b5c01727ae8ac5943 *obj, void **p, size_t *n)
{
    (void) ctx;
    
    int ret = 0;
    int64_t size_0 = 7 + 1 * sizeof(int64_t) + futhark_shape_i64_1d(ctx, obj->v0)[0] * sizeof(int64_t);
    int64_t size_1 = 7 + 1 * sizeof(int64_t) + futhark_shape_f64_1d(ctx, obj->v1)[0] * sizeof(double);
    int64_t size_2 = 7 + 1 * sizeof(int64_t) + futhark_shape_f64_1d(ctx, obj->v2)[0] * sizeof(double);
    int64_t size_3 = 7 + 1 * sizeof(int64_t) + futhark_shape_f64_1d(ctx, obj->v3)[0] * sizeof(double);
    int64_t size_4 = 7 + 1 * sizeof(int64_t) + futhark_shape_f64_1d(ctx, obj->v4)[0] * sizeof(double);
    int64_t size_5 = 7 + 1 * sizeof(int64_t) + futhark_shape_bool_1d(ctx, obj->v5)[0] * sizeof(bool);
    int64_t size_6 = 7 + 1 * sizeof(int64_t) + futhark_shape_bool_1d(ctx, obj->v6)[0] * sizeof(bool);
    int64_t size_7 = 7 + 1 * sizeof(int64_t) + futhark_shape_bool_1d(ctx, obj->v7)[0] * sizeof(bool);
    int64_t size_8 = 7 + 1 * sizeof(int64_t) + futhark_shape_bool_1d(ctx, obj->v8)[0] * sizeof(bool);
    int64_t size_9 = 7 + 1 * sizeof(int64_t) + futhark_shape_f64_1d(ctx, obj->v9)[0] * sizeof(double);
    int64_t size_10 = 7 + 1 * sizeof(int64_t) + futhark_shape_f64_1d(ctx, obj->v10)[0] * sizeof(double);
    int64_t size_11 = 7 + 1 * sizeof(int64_t) + futhark_shape_i64_1d(ctx, obj->v11)[0] * sizeof(int64_t);
    int64_t size_12 = 7 + 0 * sizeof(int64_t) + 1 * sizeof(int64_t);
    
    *n = size_0 + size_1 + size_2 + size_3 + size_4 + size_5 + size_6 + size_7 + size_8 + size_9 + size_10 + size_11 + size_12;
    if (p != NULL && *p == NULL)
        *p = malloc(*n);
    if (p != NULL) {
        unsigned char *out = *p;
        
        *out++ = 'b';
        *out++ = 2;
        *out++ = 1;
        memcpy(out, " i64", 4);
        out += 4;
        memcpy(out, futhark_shape_i64_1d(ctx, obj->v0), 1 * sizeof(int64_t));
        out += 1 * sizeof(int64_t);
        ret |= futhark_values_i64_1d(ctx, obj->v0, (void *) out);
        out += futhark_shape_i64_1d(ctx, obj->v0)[0] * sizeof(int64_t);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 1;
        memcpy(out, " f64", 4);
        out += 4;
        memcpy(out, futhark_shape_f64_1d(ctx, obj->v1), 1 * sizeof(int64_t));
        out += 1 * sizeof(int64_t);
        ret |= futhark_values_f64_1d(ctx, obj->v1, (void *) out);
        out += futhark_shape_f64_1d(ctx, obj->v1)[0] * sizeof(double);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 1;
        memcpy(out, " f64", 4);
        out += 4;
        memcpy(out, futhark_shape_f64_1d(ctx, obj->v2), 1 * sizeof(int64_t));
        out += 1 * sizeof(int64_t);
        ret |= futhark_values_f64_1d(ctx, obj->v2, (void *) out);
        out += futhark_shape_f64_1d(ctx, obj->v2)[0] * sizeof(double);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 1;
        memcpy(out, " f64", 4);
        out += 4;
        memcpy(out, futhark_shape_f64_1d(ctx, obj->v3), 1 * sizeof(int64_t));
        out += 1 * sizeof(int64_t);
        ret |= futhark_values_f64_1d(ctx, obj->v3, (void *) out);
        out += futhark_shape_f64_1d(ctx, obj->v3)[0] * sizeof(double);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 1;
        memcpy(out, " f64", 4);
        out += 4;
        memcpy(out, futhark_shape_f64_1d(ctx, obj->v4), 1 * sizeof(int64_t));
        out += 1 * sizeof(int64_t);
        ret |= futhark_values_f64_1d(ctx, obj->v4, (void *) out);
        out += futhark_shape_f64_1d(ctx, obj->v4)[0] * sizeof(double);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 1;
        memcpy(out, "bool", 4);
        out += 4;
        memcpy(out, futhark_shape_bool_1d(ctx, obj->v5), 1 * sizeof(int64_t));
        out += 1 * sizeof(int64_t);
        ret |= futhark_values_bool_1d(ctx, obj->v5, (void *) out);
        out += futhark_shape_bool_1d(ctx, obj->v5)[0] * sizeof(bool);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 1;
        memcpy(out, "bool", 4);
        out += 4;
        memcpy(out, futhark_shape_bool_1d(ctx, obj->v6), 1 * sizeof(int64_t));
        out += 1 * sizeof(int64_t);
        ret |= futhark_values_bool_1d(ctx, obj->v6, (void *) out);
        out += futhark_shape_bool_1d(ctx, obj->v6)[0] * sizeof(bool);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 1;
        memcpy(out, "bool", 4);
        out += 4;
        memcpy(out, futhark_shape_bool_1d(ctx, obj->v7), 1 * sizeof(int64_t));
        out += 1 * sizeof(int64_t);
        ret |= futhark_values_bool_1d(ctx, obj->v7, (void *) out);
        out += futhark_shape_bool_1d(ctx, obj->v7)[0] * sizeof(bool);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 1;
        memcpy(out, "bool", 4);
        out += 4;
        memcpy(out, futhark_shape_bool_1d(ctx, obj->v8), 1 * sizeof(int64_t));
        out += 1 * sizeof(int64_t);
        ret |= futhark_values_bool_1d(ctx, obj->v8, (void *) out);
        out += futhark_shape_bool_1d(ctx, obj->v8)[0] * sizeof(bool);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 1;
        memcpy(out, " f64", 4);
        out += 4;
        memcpy(out, futhark_shape_f64_1d(ctx, obj->v9), 1 * sizeof(int64_t));
        out += 1 * sizeof(int64_t);
        ret |= futhark_values_f64_1d(ctx, obj->v9, (void *) out);
        out += futhark_shape_f64_1d(ctx, obj->v9)[0] * sizeof(double);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 1;
        memcpy(out, " f64", 4);
        out += 4;
        memcpy(out, futhark_shape_f64_1d(ctx, obj->v10), 1 * sizeof(int64_t));
        out += 1 * sizeof(int64_t);
        ret |= futhark_values_f64_1d(ctx, obj->v10, (void *) out);
        out += futhark_shape_f64_1d(ctx, obj->v10)[0] * sizeof(double);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 1;
        memcpy(out, " i64", 4);
        out += 4;
        memcpy(out, futhark_shape_i64_1d(ctx, obj->v11), 1 * sizeof(int64_t));
        out += 1 * sizeof(int64_t);
        ret |= futhark_values_i64_1d(ctx, obj->v11, (void *) out);
        out += futhark_shape_i64_1d(ctx, obj->v11)[0] * sizeof(int64_t);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 0;
        memcpy(out, " i64", 4);
        out += 4;
        memcpy(out, &obj->v12, sizeof(obj->v12));
        out += sizeof(obj->v12);
    }
    return ret;
}
struct futhark_opaque_4dedc823193c594b5c01727ae8ac5943 *futhark_restore_opaque_4dedc823193c594b5c01727ae8ac5943(struct futhark_context *ctx, const void *p)
{
    (void) ctx;
    
    int err = 0;
    const unsigned char *src = p;
    struct futhark_opaque_4dedc823193c594b5c01727ae8ac5943 *obj = malloc(sizeof(struct futhark_opaque_4dedc823193c594b5c01727ae8ac5943));
    int64_t shape_0[1] = {0};
    
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 1;
    err |= memcmp(src, " i64", 4) != 0;
    src += 4;
    if (err == 0) {
        memcpy(shape_0, src, 1 * sizeof(int64_t));
        src += 1 * sizeof(int64_t);
    }
    
    const void *data_0 = src;
    
    obj->v0 = NULL;
    src += shape_0[0] * sizeof(int64_t);
    
    int64_t shape_1[1] = {0};
    
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 1;
    err |= memcmp(src, " f64", 4) != 0;
    src += 4;
    if (err == 0) {
        memcpy(shape_1, src, 1 * sizeof(int64_t));
        src += 1 * sizeof(int64_t);
    }
    
    const void *data_1 = src;
    
    obj->v1 = NULL;
    src += shape_1[0] * sizeof(double);
    
    int64_t shape_2[1] = {0};
    
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 1;
    err |= memcmp(src, " f64", 4) != 0;
    src += 4;
    if (err == 0) {
        memcpy(shape_2, src, 1 * sizeof(int64_t));
        src += 1 * sizeof(int64_t);
    }
    
    const void *data_2 = src;
    
    obj->v2 = NULL;
    src += shape_2[0] * sizeof(double);
    
    int64_t shape_3[1] = {0};
    
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 1;
    err |= memcmp(src, " f64", 4) != 0;
    src += 4;
    if (err == 0) {
        memcpy(shape_3, src, 1 * sizeof(int64_t));
        src += 1 * sizeof(int64_t);
    }
    
    const void *data_3 = src;
    
    obj->v3 = NULL;
    src += shape_3[0] * sizeof(double);
    
    int64_t shape_4[1] = {0};
    
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 1;
    err |= memcmp(src, " f64", 4) != 0;
    src += 4;
    if (err == 0) {
        memcpy(shape_4, src, 1 * sizeof(int64_t));
        src += 1 * sizeof(int64_t);
    }
    
    const void *data_4 = src;
    
    obj->v4 = NULL;
    src += shape_4[0] * sizeof(double);
    
    int64_t shape_5[1] = {0};
    
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 1;
    err |= memcmp(src, "bool", 4) != 0;
    src += 4;
    if (err == 0) {
        memcpy(shape_5, src, 1 * sizeof(int64_t));
        src += 1 * sizeof(int64_t);
    }
    
    const void *data_5 = src;
    
    obj->v5 = NULL;
    src += shape_5[0] * sizeof(bool);
    
    int64_t shape_6[1] = {0};
    
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 1;
    err |= memcmp(src, "bool", 4) != 0;
    src += 4;
    if (err == 0) {
        memcpy(shape_6, src, 1 * sizeof(int64_t));
        src += 1 * sizeof(int64_t);
    }
    
    const void *data_6 = src;
    
    obj->v6 = NULL;
    src += shape_6[0] * sizeof(bool);
    
    int64_t shape_7[1] = {0};
    
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 1;
    err |= memcmp(src, "bool", 4) != 0;
    src += 4;
    if (err == 0) {
        memcpy(shape_7, src, 1 * sizeof(int64_t));
        src += 1 * sizeof(int64_t);
    }
    
    const void *data_7 = src;
    
    obj->v7 = NULL;
    src += shape_7[0] * sizeof(bool);
    
    int64_t shape_8[1] = {0};
    
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 1;
    err |= memcmp(src, "bool", 4) != 0;
    src += 4;
    if (err == 0) {
        memcpy(shape_8, src, 1 * sizeof(int64_t));
        src += 1 * sizeof(int64_t);
    }
    
    const void *data_8 = src;
    
    obj->v8 = NULL;
    src += shape_8[0] * sizeof(bool);
    
    int64_t shape_9[1] = {0};
    
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 1;
    err |= memcmp(src, " f64", 4) != 0;
    src += 4;
    if (err == 0) {
        memcpy(shape_9, src, 1 * sizeof(int64_t));
        src += 1 * sizeof(int64_t);
    }
    
    const void *data_9 = src;
    
    obj->v9 = NULL;
    src += shape_9[0] * sizeof(double);
    
    int64_t shape_10[1] = {0};
    
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 1;
    err |= memcmp(src, " f64", 4) != 0;
    src += 4;
    if (err == 0) {
        memcpy(shape_10, src, 1 * sizeof(int64_t));
        src += 1 * sizeof(int64_t);
    }
    
    const void *data_10 = src;
    
    obj->v10 = NULL;
    src += shape_10[0] * sizeof(double);
    
    int64_t shape_11[1] = {0};
    
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 1;
    err |= memcmp(src, " i64", 4) != 0;
    src += 4;
    if (err == 0) {
        memcpy(shape_11, src, 1 * sizeof(int64_t));
        src += 1 * sizeof(int64_t);
    }
    
    const void *data_11 = src;
    
    obj->v11 = NULL;
    src += shape_11[0] * sizeof(int64_t);
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 0;
    err |= memcmp(src, " i64", 4) != 0;
    src += 4;
    if (err == 0) {
        src += 0 * sizeof(int64_t);
    }
    
    const void *data_12 = src;
    
    src += sizeof(obj->v12);
    if (err == 0) {
        obj->v0 = futhark_new_i64_1d(ctx, data_0, shape_0[0]);
        if (obj->v0 == NULL)
            err = 1;
        obj->v1 = futhark_new_f64_1d(ctx, data_1, shape_1[0]);
        if (obj->v1 == NULL)
            err = 1;
        obj->v2 = futhark_new_f64_1d(ctx, data_2, shape_2[0]);
        if (obj->v2 == NULL)
            err = 1;
        obj->v3 = futhark_new_f64_1d(ctx, data_3, shape_3[0]);
        if (obj->v3 == NULL)
            err = 1;
        obj->v4 = futhark_new_f64_1d(ctx, data_4, shape_4[0]);
        if (obj->v4 == NULL)
            err = 1;
        obj->v5 = futhark_new_bool_1d(ctx, data_5, shape_5[0]);
        if (obj->v5 == NULL)
            err = 1;
        obj->v6 = futhark_new_bool_1d(ctx, data_6, shape_6[0]);
        if (obj->v6 == NULL)
            err = 1;
        obj->v7 = futhark_new_bool_1d(ctx, data_7, shape_7[0]);
        if (obj->v7 == NULL)
            err = 1;
        obj->v8 = futhark_new_bool_1d(ctx, data_8, shape_8[0]);
        if (obj->v8 == NULL)
            err = 1;
        obj->v9 = futhark_new_f64_1d(ctx, data_9, shape_9[0]);
        if (obj->v9 == NULL)
            err = 1;
        obj->v10 = futhark_new_f64_1d(ctx, data_10, shape_10[0]);
        if (obj->v10 == NULL)
            err = 1;
        obj->v11 = futhark_new_i64_1d(ctx, data_11, shape_11[0]);
        if (obj->v11 == NULL)
            err = 1;
        memcpy(&obj->v12, data_12, sizeof(obj->v12));
    }
    if (err != 0) {
        int ret = 0, tmp;
        
        if (obj->v0 != NULL && (tmp = futhark_free_i64_1d(ctx, obj->v0)) != 0)
            ret = tmp;
        if (obj->v1 != NULL && (tmp = futhark_free_f64_1d(ctx, obj->v1)) != 0)
            ret = tmp;
        if (obj->v2 != NULL && (tmp = futhark_free_f64_1d(ctx, obj->v2)) != 0)
            ret = tmp;
        if (obj->v3 != NULL && (tmp = futhark_free_f64_1d(ctx, obj->v3)) != 0)
            ret = tmp;
        if (obj->v4 != NULL && (tmp = futhark_free_f64_1d(ctx, obj->v4)) != 0)
            ret = tmp;
        if (obj->v5 != NULL && (tmp = futhark_free_bool_1d(ctx, obj->v5)) != 0)
            ret = tmp;
        if (obj->v6 != NULL && (tmp = futhark_free_bool_1d(ctx, obj->v6)) != 0)
            ret = tmp;
        if (obj->v7 != NULL && (tmp = futhark_free_bool_1d(ctx, obj->v7)) != 0)
            ret = tmp;
        if (obj->v8 != NULL && (tmp = futhark_free_bool_1d(ctx, obj->v8)) != 0)
            ret = tmp;
        if (obj->v9 != NULL && (tmp = futhark_free_f64_1d(ctx, obj->v9)) != 0)
            ret = tmp;
        if (obj->v10 != NULL && (tmp = futhark_free_f64_1d(ctx, obj->v10)) != 0)
            ret = tmp;
        if (obj->v11 != NULL && (tmp = futhark_free_i64_1d(ctx, obj->v11)) != 0)
            ret = tmp;
        free(obj);
        obj = NULL;
    }
    return obj;
}
struct futhark_opaque_dbcHandler_double {
    struct futhark_i64_1d *v0;
    struct futhark_i64_1d *v1;
    int8_t v2;
    int8_t v3;
    double v4;
    int64_t v5;
    struct futhark_f64_1d *v6;
    int64_t v7;
    struct futhark_f64_1d *v8;
    struct futhark_i64_1d *v9;
    double v10;
    struct futhark_f64_1d *v11;
    int64_t v12;
    struct futhark_bool_1d *v13;
    struct futhark_i64_1d *v14;
    struct futhark_f64_1d *v15;
    struct futhark_f64_1d *v16;
    int64_t v17;
    int64_t v18;
    int64_t v19;
    struct futhark_bool_1d *v20;
    int64_t v21;
    int64_t v22;
    struct futhark_i64_1d *v23;
    struct futhark_i64_1d *v24;
    struct futhark_f64_1d *v25;
    struct futhark_f64_1d *v26;
    struct futhark_f64_1d *v27;
    struct futhark_f64_1d *v28;
    struct futhark_bool_1d *v29;
    struct futhark_bool_1d *v30;
    struct futhark_bool_1d *v31;
    struct futhark_bool_1d *v32;
    struct futhark_f64_1d *v33;
    struct futhark_f64_1d *v34;
    struct futhark_i64_1d *v35;
    int64_t v36;
    struct futhark_f64_1d *v37;
    struct futhark_f64_1d *v38;
    struct futhark_i64_1d *v39;
};
int futhark_project_opaque_dbcHandler_double_chain_collisions(struct futhark_context *ctx, struct futhark_opaque_arr1d_tup2_i64_i64 **out, const struct futhark_opaque_dbcHandler_double *obj)
{
    (void) ctx;
    
    struct futhark_opaque_arr1d_tup2_i64_i64 *v;
    
    lock_lock(&ctx->lock);
    CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
    v = malloc(sizeof(struct futhark_opaque_arr1d_tup2_i64_i64));
    v->v0 = malloc(sizeof(*v->v0));
    *v->v0 = *obj->v0;
    (void) (*v->v0->mem.references)++;
    v->v1 = malloc(sizeof(*v->v1));
    *v->v1 = *obj->v1;
    (void) (*v->v1->mem.references)++;
    CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
    lock_unlock(&ctx->lock);
    *out = v;
    return 0;
}
int futhark_project_opaque_dbcHandler_double_clBase(struct futhark_context *ctx, struct futhark_opaque_8b7e80c3fb80a9a7700efe8e89371deb **out, const struct futhark_opaque_dbcHandler_double *obj)
{
    (void) ctx;
    
    struct futhark_opaque_8b7e80c3fb80a9a7700efe8e89371deb *v;
    
    lock_lock(&ctx->lock);
    CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
    v = malloc(sizeof(struct futhark_opaque_8b7e80c3fb80a9a7700efe8e89371deb));
    v->v0 = obj->v2;
    v->v1 = obj->v3;
    v->v2 = obj->v4;
    v->v3 = obj->v5;
    v->v4 = malloc(sizeof(*v->v4));
    *v->v4 = *obj->v6;
    (void) (*v->v4->mem.references)++;
    v->v5 = obj->v7;
    v->v6 = malloc(sizeof(*v->v6));
    *v->v6 = *obj->v8;
    (void) (*v->v6->mem.references)++;
    v->v7 = malloc(sizeof(*v->v7));
    *v->v7 = *obj->v9;
    (void) (*v->v7->mem.references)++;
    v->v8 = obj->v10;
    v->v9 = malloc(sizeof(*v->v9));
    *v->v9 = *obj->v11;
    (void) (*v->v9->mem.references)++;
    v->v10 = obj->v12;
    CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
    lock_unlock(&ctx->lock);
    *out = v;
    return 0;
}
int futhark_project_opaque_dbcHandler_double_clProc(struct futhark_context *ctx, struct futhark_opaque_a8fdbed66266f52db9d5a0da8b1f6763 **out, const struct futhark_opaque_dbcHandler_double *obj)
{
    (void) ctx;
    
    struct futhark_opaque_a8fdbed66266f52db9d5a0da8b1f6763 *v;
    
    lock_lock(&ctx->lock);
    CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
    v = malloc(sizeof(struct futhark_opaque_a8fdbed66266f52db9d5a0da8b1f6763));
    v->v0 = malloc(sizeof(*v->v0));
    *v->v0 = *obj->v13;
    (void) (*v->v0->mem.references)++;
    v->v1 = malloc(sizeof(*v->v1));
    *v->v1 = *obj->v14;
    (void) (*v->v1->mem.references)++;
    v->v2 = malloc(sizeof(*v->v2));
    *v->v2 = *obj->v15;
    (void) (*v->v2->mem.references)++;
    v->v3 = malloc(sizeof(*v->v3));
    *v->v3 = *obj->v16;
    (void) (*v->v3->mem.references)++;
    v->v4 = obj->v17;
    v->v5 = obj->v18;
    v->v6 = obj->v19;
    v->v7 = malloc(sizeof(*v->v7));
    *v->v7 = *obj->v20;
    (void) (*v->v7->mem.references)++;
    v->v8 = obj->v21;
    v->v9 = obj->v22;
    v->v10 = malloc(sizeof(*v->v10));
    *v->v10 = *obj->v23;
    (void) (*v->v10->mem.references)++;
    CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
    lock_unlock(&ctx->lock);
    *out = v;
    return 0;
}
int futhark_project_opaque_dbcHandler_double_current_partition(struct futhark_context *ctx, struct futhark_opaque_4dedc823193c594b5c01727ae8ac5943 **out, const struct futhark_opaque_dbcHandler_double *obj)
{
    (void) ctx;
    
    struct futhark_opaque_4dedc823193c594b5c01727ae8ac5943 *v;
    
    lock_lock(&ctx->lock);
    CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
    v = malloc(sizeof(struct futhark_opaque_4dedc823193c594b5c01727ae8ac5943));
    v->v0 = malloc(sizeof(*v->v0));
    *v->v0 = *obj->v24;
    (void) (*v->v0->mem.references)++;
    v->v1 = malloc(sizeof(*v->v1));
    *v->v1 = *obj->v25;
    (void) (*v->v1->mem.references)++;
    v->v2 = malloc(sizeof(*v->v2));
    *v->v2 = *obj->v26;
    (void) (*v->v2->mem.references)++;
    v->v3 = malloc(sizeof(*v->v3));
    *v->v3 = *obj->v27;
    (void) (*v->v3->mem.references)++;
    v->v4 = malloc(sizeof(*v->v4));
    *v->v4 = *obj->v28;
    (void) (*v->v4->mem.references)++;
    v->v5 = malloc(sizeof(*v->v5));
    *v->v5 = *obj->v29;
    (void) (*v->v5->mem.references)++;
    v->v6 = malloc(sizeof(*v->v6));
    *v->v6 = *obj->v30;
    (void) (*v->v6->mem.references)++;
    v->v7 = malloc(sizeof(*v->v7));
    *v->v7 = *obj->v31;
    (void) (*v->v7->mem.references)++;
    v->v8 = malloc(sizeof(*v->v8));
    *v->v8 = *obj->v32;
    (void) (*v->v8->mem.references)++;
    v->v9 = malloc(sizeof(*v->v9));
    *v->v9 = *obj->v33;
    (void) (*v->v9->mem.references)++;
    v->v10 = malloc(sizeof(*v->v10));
    *v->v10 = *obj->v34;
    (void) (*v->v10->mem.references)++;
    v->v11 = malloc(sizeof(*v->v11));
    *v->v11 = *obj->v35;
    (void) (*v->v11->mem.references)++;
    v->v12 = obj->v36;
    CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
    lock_unlock(&ctx->lock);
    *out = v;
    return 0;
}
int futhark_project_opaque_dbcHandler_double_toFlush_dat(struct futhark_context *ctx, struct futhark_opaque_arr1d_tup2_f64_f64 **out, const struct futhark_opaque_dbcHandler_double *obj)
{
    (void) ctx;
    
    struct futhark_opaque_arr1d_tup2_f64_f64 *v;
    
    lock_lock(&ctx->lock);
    CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
    v = malloc(sizeof(struct futhark_opaque_arr1d_tup2_f64_f64));
    v->v0 = malloc(sizeof(*v->v0));
    *v->v0 = *obj->v37;
    (void) (*v->v0->mem.references)++;
    v->v1 = malloc(sizeof(*v->v1));
    *v->v1 = *obj->v38;
    (void) (*v->v1->mem.references)++;
    CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
    lock_unlock(&ctx->lock);
    *out = v;
    return 0;
}
int futhark_project_opaque_dbcHandler_double_toFlush_ids(struct futhark_context *ctx, struct futhark_i64_1d **out, const struct futhark_opaque_dbcHandler_double *obj)
{
    (void) ctx;
    
    struct futhark_i64_1d *v;
    
    lock_lock(&ctx->lock);
    CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
    v = malloc(sizeof(struct futhark_i64_1d));
    memcpy(v, obj->v39, sizeof(struct futhark_i64_1d));
    (void) (*v->mem.references)++;
    CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
    lock_unlock(&ctx->lock);
    *out = v;
    return 0;
}
int futhark_new_opaque_dbcHandler_double(struct futhark_context *ctx, struct futhark_opaque_dbcHandler_double **out, const struct futhark_opaque_arr1d_tup2_i64_i64 *f_chain_collisions, const struct futhark_opaque_8b7e80c3fb80a9a7700efe8e89371deb *f_clBase, const struct futhark_opaque_a8fdbed66266f52db9d5a0da8b1f6763 *f_clProc, const struct futhark_opaque_4dedc823193c594b5c01727ae8ac5943 *f_current_partition, const struct futhark_opaque_arr1d_tup2_f64_f64 *f_toFlush_dat, const struct futhark_i64_1d *f_toFlush_ids)
{
    struct futhark_opaque_dbcHandler_double *v = malloc(sizeof(struct futhark_opaque_dbcHandler_double));
    
    lock_lock(&ctx->lock);
    CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
    {
        {
            v->v0 = malloc(sizeof(*f_chain_collisions->v0));
            *v->v0 = *f_chain_collisions->v0;
            (void) (*v->v0->mem.references)++;
        }
        {
            v->v1 = malloc(sizeof(*f_chain_collisions->v1));
            *v->v1 = *f_chain_collisions->v1;
            (void) (*v->v1->mem.references)++;
        }
    }
    {
        v->v2 = f_clBase->v0;
        v->v3 = f_clBase->v1;
        v->v4 = f_clBase->v2;
        v->v5 = f_clBase->v3;
        {
            v->v6 = malloc(sizeof(*f_clBase->v4));
            *v->v6 = *f_clBase->v4;
            (void) (*v->v6->mem.references)++;
        }
        v->v7 = f_clBase->v5;
        {
            v->v8 = malloc(sizeof(*f_clBase->v6));
            *v->v8 = *f_clBase->v6;
            (void) (*v->v8->mem.references)++;
        }
        {
            v->v9 = malloc(sizeof(*f_clBase->v7));
            *v->v9 = *f_clBase->v7;
            (void) (*v->v9->mem.references)++;
        }
        v->v10 = f_clBase->v8;
        {
            v->v11 = malloc(sizeof(*f_clBase->v9));
            *v->v11 = *f_clBase->v9;
            (void) (*v->v11->mem.references)++;
        }
        v->v12 = f_clBase->v10;
    }
    {
        {
            v->v13 = malloc(sizeof(*f_clProc->v0));
            *v->v13 = *f_clProc->v0;
            (void) (*v->v13->mem.references)++;
        }
        {
            v->v14 = malloc(sizeof(*f_clProc->v1));
            *v->v14 = *f_clProc->v1;
            (void) (*v->v14->mem.references)++;
        }
        {
            v->v15 = malloc(sizeof(*f_clProc->v2));
            *v->v15 = *f_clProc->v2;
            (void) (*v->v15->mem.references)++;
        }
        {
            v->v16 = malloc(sizeof(*f_clProc->v3));
            *v->v16 = *f_clProc->v3;
            (void) (*v->v16->mem.references)++;
        }
        v->v17 = f_clProc->v4;
        v->v18 = f_clProc->v5;
        v->v19 = f_clProc->v6;
        {
            v->v20 = malloc(sizeof(*f_clProc->v7));
            *v->v20 = *f_clProc->v7;
            (void) (*v->v20->mem.references)++;
        }
        v->v21 = f_clProc->v8;
        v->v22 = f_clProc->v9;
        {
            v->v23 = malloc(sizeof(*f_clProc->v10));
            *v->v23 = *f_clProc->v10;
            (void) (*v->v23->mem.references)++;
        }
    }
    {
        {
            v->v24 = malloc(sizeof(*f_current_partition->v0));
            *v->v24 = *f_current_partition->v0;
            (void) (*v->v24->mem.references)++;
        }
        {
            v->v25 = malloc(sizeof(*f_current_partition->v1));
            *v->v25 = *f_current_partition->v1;
            (void) (*v->v25->mem.references)++;
        }
        {
            v->v26 = malloc(sizeof(*f_current_partition->v2));
            *v->v26 = *f_current_partition->v2;
            (void) (*v->v26->mem.references)++;
        }
        {
            v->v27 = malloc(sizeof(*f_current_partition->v3));
            *v->v27 = *f_current_partition->v3;
            (void) (*v->v27->mem.references)++;
        }
        {
            v->v28 = malloc(sizeof(*f_current_partition->v4));
            *v->v28 = *f_current_partition->v4;
            (void) (*v->v28->mem.references)++;
        }
        {
            v->v29 = malloc(sizeof(*f_current_partition->v5));
            *v->v29 = *f_current_partition->v5;
            (void) (*v->v29->mem.references)++;
        }
        {
            v->v30 = malloc(sizeof(*f_current_partition->v6));
            *v->v30 = *f_current_partition->v6;
            (void) (*v->v30->mem.references)++;
        }
        {
            v->v31 = malloc(sizeof(*f_current_partition->v7));
            *v->v31 = *f_current_partition->v7;
            (void) (*v->v31->mem.references)++;
        }
        {
            v->v32 = malloc(sizeof(*f_current_partition->v8));
            *v->v32 = *f_current_partition->v8;
            (void) (*v->v32->mem.references)++;
        }
        {
            v->v33 = malloc(sizeof(*f_current_partition->v9));
            *v->v33 = *f_current_partition->v9;
            (void) (*v->v33->mem.references)++;
        }
        {
            v->v34 = malloc(sizeof(*f_current_partition->v10));
            *v->v34 = *f_current_partition->v10;
            (void) (*v->v34->mem.references)++;
        }
        {
            v->v35 = malloc(sizeof(*f_current_partition->v11));
            *v->v35 = *f_current_partition->v11;
            (void) (*v->v35->mem.references)++;
        }
        v->v36 = f_current_partition->v12;
    }
    {
        {
            v->v37 = malloc(sizeof(*f_toFlush_dat->v0));
            *v->v37 = *f_toFlush_dat->v0;
            (void) (*v->v37->mem.references)++;
        }
        {
            v->v38 = malloc(sizeof(*f_toFlush_dat->v1));
            *v->v38 = *f_toFlush_dat->v1;
            (void) (*v->v38->mem.references)++;
        }
    }
    {
        v->v39 = malloc(sizeof(struct futhark_i64_1d));
        *v->v39 = *f_toFlush_ids;
        (void) (*v->v39->mem.references)++;
    }
    CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
    lock_unlock(&ctx->lock);
    *out = v;
    return FUTHARK_SUCCESS;
}
int futhark_free_opaque_dbcHandler_double(struct futhark_context *ctx, struct futhark_opaque_dbcHandler_double *obj)
{
    (void) ctx;
    
    int ret = 0, tmp;
    
    if (obj->v0 != NULL && (tmp = futhark_free_i64_1d(ctx, obj->v0)) != 0)
        ret = tmp;
    if (obj->v1 != NULL && (tmp = futhark_free_i64_1d(ctx, obj->v1)) != 0)
        ret = tmp;
    if (obj->v6 != NULL && (tmp = futhark_free_f64_1d(ctx, obj->v6)) != 0)
        ret = tmp;
    if (obj->v8 != NULL && (tmp = futhark_free_f64_1d(ctx, obj->v8)) != 0)
        ret = tmp;
    if (obj->v9 != NULL && (tmp = futhark_free_i64_1d(ctx, obj->v9)) != 0)
        ret = tmp;
    if (obj->v11 != NULL && (tmp = futhark_free_f64_1d(ctx, obj->v11)) != 0)
        ret = tmp;
    if (obj->v13 != NULL && (tmp = futhark_free_bool_1d(ctx, obj->v13)) != 0)
        ret = tmp;
    if (obj->v14 != NULL && (tmp = futhark_free_i64_1d(ctx, obj->v14)) != 0)
        ret = tmp;
    if (obj->v15 != NULL && (tmp = futhark_free_f64_1d(ctx, obj->v15)) != 0)
        ret = tmp;
    if (obj->v16 != NULL && (tmp = futhark_free_f64_1d(ctx, obj->v16)) != 0)
        ret = tmp;
    if (obj->v20 != NULL && (tmp = futhark_free_bool_1d(ctx, obj->v20)) != 0)
        ret = tmp;
    if (obj->v23 != NULL && (tmp = futhark_free_i64_1d(ctx, obj->v23)) != 0)
        ret = tmp;
    if (obj->v24 != NULL && (tmp = futhark_free_i64_1d(ctx, obj->v24)) != 0)
        ret = tmp;
    if (obj->v25 != NULL && (tmp = futhark_free_f64_1d(ctx, obj->v25)) != 0)
        ret = tmp;
    if (obj->v26 != NULL && (tmp = futhark_free_f64_1d(ctx, obj->v26)) != 0)
        ret = tmp;
    if (obj->v27 != NULL && (tmp = futhark_free_f64_1d(ctx, obj->v27)) != 0)
        ret = tmp;
    if (obj->v28 != NULL && (tmp = futhark_free_f64_1d(ctx, obj->v28)) != 0)
        ret = tmp;
    if (obj->v29 != NULL && (tmp = futhark_free_bool_1d(ctx, obj->v29)) != 0)
        ret = tmp;
    if (obj->v30 != NULL && (tmp = futhark_free_bool_1d(ctx, obj->v30)) != 0)
        ret = tmp;
    if (obj->v31 != NULL && (tmp = futhark_free_bool_1d(ctx, obj->v31)) != 0)
        ret = tmp;
    if (obj->v32 != NULL && (tmp = futhark_free_bool_1d(ctx, obj->v32)) != 0)
        ret = tmp;
    if (obj->v33 != NULL && (tmp = futhark_free_f64_1d(ctx, obj->v33)) != 0)
        ret = tmp;
    if (obj->v34 != NULL && (tmp = futhark_free_f64_1d(ctx, obj->v34)) != 0)
        ret = tmp;
    if (obj->v35 != NULL && (tmp = futhark_free_i64_1d(ctx, obj->v35)) != 0)
        ret = tmp;
    if (obj->v37 != NULL && (tmp = futhark_free_f64_1d(ctx, obj->v37)) != 0)
        ret = tmp;
    if (obj->v38 != NULL && (tmp = futhark_free_f64_1d(ctx, obj->v38)) != 0)
        ret = tmp;
    if (obj->v39 != NULL && (tmp = futhark_free_i64_1d(ctx, obj->v39)) != 0)
        ret = tmp;
    free(obj);
    return ret;
}
int futhark_store_opaque_dbcHandler_double(struct futhark_context *ctx, const struct futhark_opaque_dbcHandler_double *obj, void **p, size_t *n)
{
    (void) ctx;
    
    int ret = 0;
    int64_t size_0 = 7 + 1 * sizeof(int64_t) + futhark_shape_i64_1d(ctx, obj->v0)[0] * sizeof(int64_t);
    int64_t size_1 = 7 + 1 * sizeof(int64_t) + futhark_shape_i64_1d(ctx, obj->v1)[0] * sizeof(int64_t);
    int64_t size_2 = 7 + 0 * sizeof(int64_t) + 1 * sizeof(int8_t);
    int64_t size_3 = 7 + 0 * sizeof(int64_t) + 1 * sizeof(int8_t);
    int64_t size_4 = 7 + 0 * sizeof(int64_t) + 1 * sizeof(double);
    int64_t size_5 = 7 + 0 * sizeof(int64_t) + 1 * sizeof(int64_t);
    int64_t size_6 = 7 + 1 * sizeof(int64_t) + futhark_shape_f64_1d(ctx, obj->v6)[0] * sizeof(double);
    int64_t size_7 = 7 + 0 * sizeof(int64_t) + 1 * sizeof(int64_t);
    int64_t size_8 = 7 + 1 * sizeof(int64_t) + futhark_shape_f64_1d(ctx, obj->v8)[0] * sizeof(double);
    int64_t size_9 = 7 + 1 * sizeof(int64_t) + futhark_shape_i64_1d(ctx, obj->v9)[0] * sizeof(int64_t);
    int64_t size_10 = 7 + 0 * sizeof(int64_t) + 1 * sizeof(double);
    int64_t size_11 = 7 + 1 * sizeof(int64_t) + futhark_shape_f64_1d(ctx, obj->v11)[0] * sizeof(double);
    int64_t size_12 = 7 + 0 * sizeof(int64_t) + 1 * sizeof(int64_t);
    int64_t size_13 = 7 + 1 * sizeof(int64_t) + futhark_shape_bool_1d(ctx, obj->v13)[0] * sizeof(bool);
    int64_t size_14 = 7 + 1 * sizeof(int64_t) + futhark_shape_i64_1d(ctx, obj->v14)[0] * sizeof(int64_t);
    int64_t size_15 = 7 + 1 * sizeof(int64_t) + futhark_shape_f64_1d(ctx, obj->v15)[0] * sizeof(double);
    int64_t size_16 = 7 + 1 * sizeof(int64_t) + futhark_shape_f64_1d(ctx, obj->v16)[0] * sizeof(double);
    int64_t size_17 = 7 + 0 * sizeof(int64_t) + 1 * sizeof(int64_t);
    int64_t size_18 = 7 + 0 * sizeof(int64_t) + 1 * sizeof(int64_t);
    int64_t size_19 = 7 + 0 * sizeof(int64_t) + 1 * sizeof(int64_t);
    int64_t size_20 = 7 + 1 * sizeof(int64_t) + futhark_shape_bool_1d(ctx, obj->v20)[0] * sizeof(bool);
    int64_t size_21 = 7 + 0 * sizeof(int64_t) + 1 * sizeof(int64_t);
    int64_t size_22 = 7 + 0 * sizeof(int64_t) + 1 * sizeof(int64_t);
    int64_t size_23 = 7 + 1 * sizeof(int64_t) + futhark_shape_i64_1d(ctx, obj->v23)[0] * sizeof(int64_t);
    int64_t size_24 = 7 + 1 * sizeof(int64_t) + futhark_shape_i64_1d(ctx, obj->v24)[0] * sizeof(int64_t);
    int64_t size_25 = 7 + 1 * sizeof(int64_t) + futhark_shape_f64_1d(ctx, obj->v25)[0] * sizeof(double);
    int64_t size_26 = 7 + 1 * sizeof(int64_t) + futhark_shape_f64_1d(ctx, obj->v26)[0] * sizeof(double);
    int64_t size_27 = 7 + 1 * sizeof(int64_t) + futhark_shape_f64_1d(ctx, obj->v27)[0] * sizeof(double);
    int64_t size_28 = 7 + 1 * sizeof(int64_t) + futhark_shape_f64_1d(ctx, obj->v28)[0] * sizeof(double);
    int64_t size_29 = 7 + 1 * sizeof(int64_t) + futhark_shape_bool_1d(ctx, obj->v29)[0] * sizeof(bool);
    int64_t size_30 = 7 + 1 * sizeof(int64_t) + futhark_shape_bool_1d(ctx, obj->v30)[0] * sizeof(bool);
    int64_t size_31 = 7 + 1 * sizeof(int64_t) + futhark_shape_bool_1d(ctx, obj->v31)[0] * sizeof(bool);
    int64_t size_32 = 7 + 1 * sizeof(int64_t) + futhark_shape_bool_1d(ctx, obj->v32)[0] * sizeof(bool);
    int64_t size_33 = 7 + 1 * sizeof(int64_t) + futhark_shape_f64_1d(ctx, obj->v33)[0] * sizeof(double);
    int64_t size_34 = 7 + 1 * sizeof(int64_t) + futhark_shape_f64_1d(ctx, obj->v34)[0] * sizeof(double);
    int64_t size_35 = 7 + 1 * sizeof(int64_t) + futhark_shape_i64_1d(ctx, obj->v35)[0] * sizeof(int64_t);
    int64_t size_36 = 7 + 0 * sizeof(int64_t) + 1 * sizeof(int64_t);
    int64_t size_37 = 7 + 1 * sizeof(int64_t) + futhark_shape_f64_1d(ctx, obj->v37)[0] * sizeof(double);
    int64_t size_38 = 7 + 1 * sizeof(int64_t) + futhark_shape_f64_1d(ctx, obj->v38)[0] * sizeof(double);
    int64_t size_39 = 7 + 1 * sizeof(int64_t) + futhark_shape_i64_1d(ctx, obj->v39)[0] * sizeof(int64_t);
    
    *n = size_0 + size_1 + size_2 + size_3 + size_4 + size_5 + size_6 + size_7 + size_8 + size_9 + size_10 + size_11 + size_12 + size_13 + size_14 + size_15 + size_16 + size_17 + size_18 + size_19 + size_20 + size_21 + size_22 + size_23 + size_24 + size_25 + size_26 + size_27 + size_28 + size_29 + size_30 + size_31 + size_32 + size_33 + size_34 + size_35 + size_36 + size_37 + size_38 + size_39;
    if (p != NULL && *p == NULL)
        *p = malloc(*n);
    if (p != NULL) {
        unsigned char *out = *p;
        
        *out++ = 'b';
        *out++ = 2;
        *out++ = 1;
        memcpy(out, " i64", 4);
        out += 4;
        memcpy(out, futhark_shape_i64_1d(ctx, obj->v0), 1 * sizeof(int64_t));
        out += 1 * sizeof(int64_t);
        ret |= futhark_values_i64_1d(ctx, obj->v0, (void *) out);
        out += futhark_shape_i64_1d(ctx, obj->v0)[0] * sizeof(int64_t);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 1;
        memcpy(out, " i64", 4);
        out += 4;
        memcpy(out, futhark_shape_i64_1d(ctx, obj->v1), 1 * sizeof(int64_t));
        out += 1 * sizeof(int64_t);
        ret |= futhark_values_i64_1d(ctx, obj->v1, (void *) out);
        out += futhark_shape_i64_1d(ctx, obj->v1)[0] * sizeof(int64_t);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 0;
        memcpy(out, "  i8", 4);
        out += 4;
        memcpy(out, &obj->v2, sizeof(obj->v2));
        out += sizeof(obj->v2);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 0;
        memcpy(out, "  i8", 4);
        out += 4;
        memcpy(out, &obj->v3, sizeof(obj->v3));
        out += sizeof(obj->v3);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 0;
        memcpy(out, " f64", 4);
        out += 4;
        memcpy(out, &obj->v4, sizeof(obj->v4));
        out += sizeof(obj->v4);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 0;
        memcpy(out, " i64", 4);
        out += 4;
        memcpy(out, &obj->v5, sizeof(obj->v5));
        out += sizeof(obj->v5);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 1;
        memcpy(out, " f64", 4);
        out += 4;
        memcpy(out, futhark_shape_f64_1d(ctx, obj->v6), 1 * sizeof(int64_t));
        out += 1 * sizeof(int64_t);
        ret |= futhark_values_f64_1d(ctx, obj->v6, (void *) out);
        out += futhark_shape_f64_1d(ctx, obj->v6)[0] * sizeof(double);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 0;
        memcpy(out, " i64", 4);
        out += 4;
        memcpy(out, &obj->v7, sizeof(obj->v7));
        out += sizeof(obj->v7);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 1;
        memcpy(out, " f64", 4);
        out += 4;
        memcpy(out, futhark_shape_f64_1d(ctx, obj->v8), 1 * sizeof(int64_t));
        out += 1 * sizeof(int64_t);
        ret |= futhark_values_f64_1d(ctx, obj->v8, (void *) out);
        out += futhark_shape_f64_1d(ctx, obj->v8)[0] * sizeof(double);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 1;
        memcpy(out, " i64", 4);
        out += 4;
        memcpy(out, futhark_shape_i64_1d(ctx, obj->v9), 1 * sizeof(int64_t));
        out += 1 * sizeof(int64_t);
        ret |= futhark_values_i64_1d(ctx, obj->v9, (void *) out);
        out += futhark_shape_i64_1d(ctx, obj->v9)[0] * sizeof(int64_t);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 0;
        memcpy(out, " f64", 4);
        out += 4;
        memcpy(out, &obj->v10, sizeof(obj->v10));
        out += sizeof(obj->v10);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 1;
        memcpy(out, " f64", 4);
        out += 4;
        memcpy(out, futhark_shape_f64_1d(ctx, obj->v11), 1 * sizeof(int64_t));
        out += 1 * sizeof(int64_t);
        ret |= futhark_values_f64_1d(ctx, obj->v11, (void *) out);
        out += futhark_shape_f64_1d(ctx, obj->v11)[0] * sizeof(double);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 0;
        memcpy(out, " i64", 4);
        out += 4;
        memcpy(out, &obj->v12, sizeof(obj->v12));
        out += sizeof(obj->v12);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 1;
        memcpy(out, "bool", 4);
        out += 4;
        memcpy(out, futhark_shape_bool_1d(ctx, obj->v13), 1 * sizeof(int64_t));
        out += 1 * sizeof(int64_t);
        ret |= futhark_values_bool_1d(ctx, obj->v13, (void *) out);
        out += futhark_shape_bool_1d(ctx, obj->v13)[0] * sizeof(bool);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 1;
        memcpy(out, " i64", 4);
        out += 4;
        memcpy(out, futhark_shape_i64_1d(ctx, obj->v14), 1 * sizeof(int64_t));
        out += 1 * sizeof(int64_t);
        ret |= futhark_values_i64_1d(ctx, obj->v14, (void *) out);
        out += futhark_shape_i64_1d(ctx, obj->v14)[0] * sizeof(int64_t);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 1;
        memcpy(out, " f64", 4);
        out += 4;
        memcpy(out, futhark_shape_f64_1d(ctx, obj->v15), 1 * sizeof(int64_t));
        out += 1 * sizeof(int64_t);
        ret |= futhark_values_f64_1d(ctx, obj->v15, (void *) out);
        out += futhark_shape_f64_1d(ctx, obj->v15)[0] * sizeof(double);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 1;
        memcpy(out, " f64", 4);
        out += 4;
        memcpy(out, futhark_shape_f64_1d(ctx, obj->v16), 1 * sizeof(int64_t));
        out += 1 * sizeof(int64_t);
        ret |= futhark_values_f64_1d(ctx, obj->v16, (void *) out);
        out += futhark_shape_f64_1d(ctx, obj->v16)[0] * sizeof(double);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 0;
        memcpy(out, " i64", 4);
        out += 4;
        memcpy(out, &obj->v17, sizeof(obj->v17));
        out += sizeof(obj->v17);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 0;
        memcpy(out, " i64", 4);
        out += 4;
        memcpy(out, &obj->v18, sizeof(obj->v18));
        out += sizeof(obj->v18);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 0;
        memcpy(out, " i64", 4);
        out += 4;
        memcpy(out, &obj->v19, sizeof(obj->v19));
        out += sizeof(obj->v19);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 1;
        memcpy(out, "bool", 4);
        out += 4;
        memcpy(out, futhark_shape_bool_1d(ctx, obj->v20), 1 * sizeof(int64_t));
        out += 1 * sizeof(int64_t);
        ret |= futhark_values_bool_1d(ctx, obj->v20, (void *) out);
        out += futhark_shape_bool_1d(ctx, obj->v20)[0] * sizeof(bool);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 0;
        memcpy(out, " i64", 4);
        out += 4;
        memcpy(out, &obj->v21, sizeof(obj->v21));
        out += sizeof(obj->v21);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 0;
        memcpy(out, " i64", 4);
        out += 4;
        memcpy(out, &obj->v22, sizeof(obj->v22));
        out += sizeof(obj->v22);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 1;
        memcpy(out, " i64", 4);
        out += 4;
        memcpy(out, futhark_shape_i64_1d(ctx, obj->v23), 1 * sizeof(int64_t));
        out += 1 * sizeof(int64_t);
        ret |= futhark_values_i64_1d(ctx, obj->v23, (void *) out);
        out += futhark_shape_i64_1d(ctx, obj->v23)[0] * sizeof(int64_t);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 1;
        memcpy(out, " i64", 4);
        out += 4;
        memcpy(out, futhark_shape_i64_1d(ctx, obj->v24), 1 * sizeof(int64_t));
        out += 1 * sizeof(int64_t);
        ret |= futhark_values_i64_1d(ctx, obj->v24, (void *) out);
        out += futhark_shape_i64_1d(ctx, obj->v24)[0] * sizeof(int64_t);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 1;
        memcpy(out, " f64", 4);
        out += 4;
        memcpy(out, futhark_shape_f64_1d(ctx, obj->v25), 1 * sizeof(int64_t));
        out += 1 * sizeof(int64_t);
        ret |= futhark_values_f64_1d(ctx, obj->v25, (void *) out);
        out += futhark_shape_f64_1d(ctx, obj->v25)[0] * sizeof(double);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 1;
        memcpy(out, " f64", 4);
        out += 4;
        memcpy(out, futhark_shape_f64_1d(ctx, obj->v26), 1 * sizeof(int64_t));
        out += 1 * sizeof(int64_t);
        ret |= futhark_values_f64_1d(ctx, obj->v26, (void *) out);
        out += futhark_shape_f64_1d(ctx, obj->v26)[0] * sizeof(double);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 1;
        memcpy(out, " f64", 4);
        out += 4;
        memcpy(out, futhark_shape_f64_1d(ctx, obj->v27), 1 * sizeof(int64_t));
        out += 1 * sizeof(int64_t);
        ret |= futhark_values_f64_1d(ctx, obj->v27, (void *) out);
        out += futhark_shape_f64_1d(ctx, obj->v27)[0] * sizeof(double);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 1;
        memcpy(out, " f64", 4);
        out += 4;
        memcpy(out, futhark_shape_f64_1d(ctx, obj->v28), 1 * sizeof(int64_t));
        out += 1 * sizeof(int64_t);
        ret |= futhark_values_f64_1d(ctx, obj->v28, (void *) out);
        out += futhark_shape_f64_1d(ctx, obj->v28)[0] * sizeof(double);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 1;
        memcpy(out, "bool", 4);
        out += 4;
        memcpy(out, futhark_shape_bool_1d(ctx, obj->v29), 1 * sizeof(int64_t));
        out += 1 * sizeof(int64_t);
        ret |= futhark_values_bool_1d(ctx, obj->v29, (void *) out);
        out += futhark_shape_bool_1d(ctx, obj->v29)[0] * sizeof(bool);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 1;
        memcpy(out, "bool", 4);
        out += 4;
        memcpy(out, futhark_shape_bool_1d(ctx, obj->v30), 1 * sizeof(int64_t));
        out += 1 * sizeof(int64_t);
        ret |= futhark_values_bool_1d(ctx, obj->v30, (void *) out);
        out += futhark_shape_bool_1d(ctx, obj->v30)[0] * sizeof(bool);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 1;
        memcpy(out, "bool", 4);
        out += 4;
        memcpy(out, futhark_shape_bool_1d(ctx, obj->v31), 1 * sizeof(int64_t));
        out += 1 * sizeof(int64_t);
        ret |= futhark_values_bool_1d(ctx, obj->v31, (void *) out);
        out += futhark_shape_bool_1d(ctx, obj->v31)[0] * sizeof(bool);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 1;
        memcpy(out, "bool", 4);
        out += 4;
        memcpy(out, futhark_shape_bool_1d(ctx, obj->v32), 1 * sizeof(int64_t));
        out += 1 * sizeof(int64_t);
        ret |= futhark_values_bool_1d(ctx, obj->v32, (void *) out);
        out += futhark_shape_bool_1d(ctx, obj->v32)[0] * sizeof(bool);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 1;
        memcpy(out, " f64", 4);
        out += 4;
        memcpy(out, futhark_shape_f64_1d(ctx, obj->v33), 1 * sizeof(int64_t));
        out += 1 * sizeof(int64_t);
        ret |= futhark_values_f64_1d(ctx, obj->v33, (void *) out);
        out += futhark_shape_f64_1d(ctx, obj->v33)[0] * sizeof(double);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 1;
        memcpy(out, " f64", 4);
        out += 4;
        memcpy(out, futhark_shape_f64_1d(ctx, obj->v34), 1 * sizeof(int64_t));
        out += 1 * sizeof(int64_t);
        ret |= futhark_values_f64_1d(ctx, obj->v34, (void *) out);
        out += futhark_shape_f64_1d(ctx, obj->v34)[0] * sizeof(double);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 1;
        memcpy(out, " i64", 4);
        out += 4;
        memcpy(out, futhark_shape_i64_1d(ctx, obj->v35), 1 * sizeof(int64_t));
        out += 1 * sizeof(int64_t);
        ret |= futhark_values_i64_1d(ctx, obj->v35, (void *) out);
        out += futhark_shape_i64_1d(ctx, obj->v35)[0] * sizeof(int64_t);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 0;
        memcpy(out, " i64", 4);
        out += 4;
        memcpy(out, &obj->v36, sizeof(obj->v36));
        out += sizeof(obj->v36);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 1;
        memcpy(out, " f64", 4);
        out += 4;
        memcpy(out, futhark_shape_f64_1d(ctx, obj->v37), 1 * sizeof(int64_t));
        out += 1 * sizeof(int64_t);
        ret |= futhark_values_f64_1d(ctx, obj->v37, (void *) out);
        out += futhark_shape_f64_1d(ctx, obj->v37)[0] * sizeof(double);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 1;
        memcpy(out, " f64", 4);
        out += 4;
        memcpy(out, futhark_shape_f64_1d(ctx, obj->v38), 1 * sizeof(int64_t));
        out += 1 * sizeof(int64_t);
        ret |= futhark_values_f64_1d(ctx, obj->v38, (void *) out);
        out += futhark_shape_f64_1d(ctx, obj->v38)[0] * sizeof(double);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 1;
        memcpy(out, " i64", 4);
        out += 4;
        memcpy(out, futhark_shape_i64_1d(ctx, obj->v39), 1 * sizeof(int64_t));
        out += 1 * sizeof(int64_t);
        ret |= futhark_values_i64_1d(ctx, obj->v39, (void *) out);
        out += futhark_shape_i64_1d(ctx, obj->v39)[0] * sizeof(int64_t);
    }
    return ret;
}
struct futhark_opaque_dbcHandler_double *futhark_restore_opaque_dbcHandler_double(struct futhark_context *ctx, const void *p)
{
    (void) ctx;
    
    int err = 0;
    const unsigned char *src = p;
    struct futhark_opaque_dbcHandler_double *obj = malloc(sizeof(struct futhark_opaque_dbcHandler_double));
    int64_t shape_0[1] = {0};
    
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 1;
    err |= memcmp(src, " i64", 4) != 0;
    src += 4;
    if (err == 0) {
        memcpy(shape_0, src, 1 * sizeof(int64_t));
        src += 1 * sizeof(int64_t);
    }
    
    const void *data_0 = src;
    
    obj->v0 = NULL;
    src += shape_0[0] * sizeof(int64_t);
    
    int64_t shape_1[1] = {0};
    
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 1;
    err |= memcmp(src, " i64", 4) != 0;
    src += 4;
    if (err == 0) {
        memcpy(shape_1, src, 1 * sizeof(int64_t));
        src += 1 * sizeof(int64_t);
    }
    
    const void *data_1 = src;
    
    obj->v1 = NULL;
    src += shape_1[0] * sizeof(int64_t);
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 0;
    err |= memcmp(src, "  i8", 4) != 0;
    src += 4;
    if (err == 0) {
        src += 0 * sizeof(int64_t);
    }
    
    const void *data_2 = src;
    
    src += sizeof(obj->v2);
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 0;
    err |= memcmp(src, "  i8", 4) != 0;
    src += 4;
    if (err == 0) {
        src += 0 * sizeof(int64_t);
    }
    
    const void *data_3 = src;
    
    src += sizeof(obj->v3);
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 0;
    err |= memcmp(src, " f64", 4) != 0;
    src += 4;
    if (err == 0) {
        src += 0 * sizeof(int64_t);
    }
    
    const void *data_4 = src;
    
    src += sizeof(obj->v4);
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 0;
    err |= memcmp(src, " i64", 4) != 0;
    src += 4;
    if (err == 0) {
        src += 0 * sizeof(int64_t);
    }
    
    const void *data_5 = src;
    
    src += sizeof(obj->v5);
    
    int64_t shape_6[1] = {0};
    
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 1;
    err |= memcmp(src, " f64", 4) != 0;
    src += 4;
    if (err == 0) {
        memcpy(shape_6, src, 1 * sizeof(int64_t));
        src += 1 * sizeof(int64_t);
    }
    
    const void *data_6 = src;
    
    obj->v6 = NULL;
    src += shape_6[0] * sizeof(double);
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 0;
    err |= memcmp(src, " i64", 4) != 0;
    src += 4;
    if (err == 0) {
        src += 0 * sizeof(int64_t);
    }
    
    const void *data_7 = src;
    
    src += sizeof(obj->v7);
    
    int64_t shape_8[1] = {0};
    
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 1;
    err |= memcmp(src, " f64", 4) != 0;
    src += 4;
    if (err == 0) {
        memcpy(shape_8, src, 1 * sizeof(int64_t));
        src += 1 * sizeof(int64_t);
    }
    
    const void *data_8 = src;
    
    obj->v8 = NULL;
    src += shape_8[0] * sizeof(double);
    
    int64_t shape_9[1] = {0};
    
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 1;
    err |= memcmp(src, " i64", 4) != 0;
    src += 4;
    if (err == 0) {
        memcpy(shape_9, src, 1 * sizeof(int64_t));
        src += 1 * sizeof(int64_t);
    }
    
    const void *data_9 = src;
    
    obj->v9 = NULL;
    src += shape_9[0] * sizeof(int64_t);
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 0;
    err |= memcmp(src, " f64", 4) != 0;
    src += 4;
    if (err == 0) {
        src += 0 * sizeof(int64_t);
    }
    
    const void *data_10 = src;
    
    src += sizeof(obj->v10);
    
    int64_t shape_11[1] = {0};
    
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 1;
    err |= memcmp(src, " f64", 4) != 0;
    src += 4;
    if (err == 0) {
        memcpy(shape_11, src, 1 * sizeof(int64_t));
        src += 1 * sizeof(int64_t);
    }
    
    const void *data_11 = src;
    
    obj->v11 = NULL;
    src += shape_11[0] * sizeof(double);
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 0;
    err |= memcmp(src, " i64", 4) != 0;
    src += 4;
    if (err == 0) {
        src += 0 * sizeof(int64_t);
    }
    
    const void *data_12 = src;
    
    src += sizeof(obj->v12);
    
    int64_t shape_13[1] = {0};
    
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 1;
    err |= memcmp(src, "bool", 4) != 0;
    src += 4;
    if (err == 0) {
        memcpy(shape_13, src, 1 * sizeof(int64_t));
        src += 1 * sizeof(int64_t);
    }
    
    const void *data_13 = src;
    
    obj->v13 = NULL;
    src += shape_13[0] * sizeof(bool);
    
    int64_t shape_14[1] = {0};
    
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 1;
    err |= memcmp(src, " i64", 4) != 0;
    src += 4;
    if (err == 0) {
        memcpy(shape_14, src, 1 * sizeof(int64_t));
        src += 1 * sizeof(int64_t);
    }
    
    const void *data_14 = src;
    
    obj->v14 = NULL;
    src += shape_14[0] * sizeof(int64_t);
    
    int64_t shape_15[1] = {0};
    
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 1;
    err |= memcmp(src, " f64", 4) != 0;
    src += 4;
    if (err == 0) {
        memcpy(shape_15, src, 1 * sizeof(int64_t));
        src += 1 * sizeof(int64_t);
    }
    
    const void *data_15 = src;
    
    obj->v15 = NULL;
    src += shape_15[0] * sizeof(double);
    
    int64_t shape_16[1] = {0};
    
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 1;
    err |= memcmp(src, " f64", 4) != 0;
    src += 4;
    if (err == 0) {
        memcpy(shape_16, src, 1 * sizeof(int64_t));
        src += 1 * sizeof(int64_t);
    }
    
    const void *data_16 = src;
    
    obj->v16 = NULL;
    src += shape_16[0] * sizeof(double);
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 0;
    err |= memcmp(src, " i64", 4) != 0;
    src += 4;
    if (err == 0) {
        src += 0 * sizeof(int64_t);
    }
    
    const void *data_17 = src;
    
    src += sizeof(obj->v17);
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 0;
    err |= memcmp(src, " i64", 4) != 0;
    src += 4;
    if (err == 0) {
        src += 0 * sizeof(int64_t);
    }
    
    const void *data_18 = src;
    
    src += sizeof(obj->v18);
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 0;
    err |= memcmp(src, " i64", 4) != 0;
    src += 4;
    if (err == 0) {
        src += 0 * sizeof(int64_t);
    }
    
    const void *data_19 = src;
    
    src += sizeof(obj->v19);
    
    int64_t shape_20[1] = {0};
    
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 1;
    err |= memcmp(src, "bool", 4) != 0;
    src += 4;
    if (err == 0) {
        memcpy(shape_20, src, 1 * sizeof(int64_t));
        src += 1 * sizeof(int64_t);
    }
    
    const void *data_20 = src;
    
    obj->v20 = NULL;
    src += shape_20[0] * sizeof(bool);
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 0;
    err |= memcmp(src, " i64", 4) != 0;
    src += 4;
    if (err == 0) {
        src += 0 * sizeof(int64_t);
    }
    
    const void *data_21 = src;
    
    src += sizeof(obj->v21);
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 0;
    err |= memcmp(src, " i64", 4) != 0;
    src += 4;
    if (err == 0) {
        src += 0 * sizeof(int64_t);
    }
    
    const void *data_22 = src;
    
    src += sizeof(obj->v22);
    
    int64_t shape_23[1] = {0};
    
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 1;
    err |= memcmp(src, " i64", 4) != 0;
    src += 4;
    if (err == 0) {
        memcpy(shape_23, src, 1 * sizeof(int64_t));
        src += 1 * sizeof(int64_t);
    }
    
    const void *data_23 = src;
    
    obj->v23 = NULL;
    src += shape_23[0] * sizeof(int64_t);
    
    int64_t shape_24[1] = {0};
    
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 1;
    err |= memcmp(src, " i64", 4) != 0;
    src += 4;
    if (err == 0) {
        memcpy(shape_24, src, 1 * sizeof(int64_t));
        src += 1 * sizeof(int64_t);
    }
    
    const void *data_24 = src;
    
    obj->v24 = NULL;
    src += shape_24[0] * sizeof(int64_t);
    
    int64_t shape_25[1] = {0};
    
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 1;
    err |= memcmp(src, " f64", 4) != 0;
    src += 4;
    if (err == 0) {
        memcpy(shape_25, src, 1 * sizeof(int64_t));
        src += 1 * sizeof(int64_t);
    }
    
    const void *data_25 = src;
    
    obj->v25 = NULL;
    src += shape_25[0] * sizeof(double);
    
    int64_t shape_26[1] = {0};
    
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 1;
    err |= memcmp(src, " f64", 4) != 0;
    src += 4;
    if (err == 0) {
        memcpy(shape_26, src, 1 * sizeof(int64_t));
        src += 1 * sizeof(int64_t);
    }
    
    const void *data_26 = src;
    
    obj->v26 = NULL;
    src += shape_26[0] * sizeof(double);
    
    int64_t shape_27[1] = {0};
    
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 1;
    err |= memcmp(src, " f64", 4) != 0;
    src += 4;
    if (err == 0) {
        memcpy(shape_27, src, 1 * sizeof(int64_t));
        src += 1 * sizeof(int64_t);
    }
    
    const void *data_27 = src;
    
    obj->v27 = NULL;
    src += shape_27[0] * sizeof(double);
    
    int64_t shape_28[1] = {0};
    
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 1;
    err |= memcmp(src, " f64", 4) != 0;
    src += 4;
    if (err == 0) {
        memcpy(shape_28, src, 1 * sizeof(int64_t));
        src += 1 * sizeof(int64_t);
    }
    
    const void *data_28 = src;
    
    obj->v28 = NULL;
    src += shape_28[0] * sizeof(double);
    
    int64_t shape_29[1] = {0};
    
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 1;
    err |= memcmp(src, "bool", 4) != 0;
    src += 4;
    if (err == 0) {
        memcpy(shape_29, src, 1 * sizeof(int64_t));
        src += 1 * sizeof(int64_t);
    }
    
    const void *data_29 = src;
    
    obj->v29 = NULL;
    src += shape_29[0] * sizeof(bool);
    
    int64_t shape_30[1] = {0};
    
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 1;
    err |= memcmp(src, "bool", 4) != 0;
    src += 4;
    if (err == 0) {
        memcpy(shape_30, src, 1 * sizeof(int64_t));
        src += 1 * sizeof(int64_t);
    }
    
    const void *data_30 = src;
    
    obj->v30 = NULL;
    src += shape_30[0] * sizeof(bool);
    
    int64_t shape_31[1] = {0};
    
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 1;
    err |= memcmp(src, "bool", 4) != 0;
    src += 4;
    if (err == 0) {
        memcpy(shape_31, src, 1 * sizeof(int64_t));
        src += 1 * sizeof(int64_t);
    }
    
    const void *data_31 = src;
    
    obj->v31 = NULL;
    src += shape_31[0] * sizeof(bool);
    
    int64_t shape_32[1] = {0};
    
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 1;
    err |= memcmp(src, "bool", 4) != 0;
    src += 4;
    if (err == 0) {
        memcpy(shape_32, src, 1 * sizeof(int64_t));
        src += 1 * sizeof(int64_t);
    }
    
    const void *data_32 = src;
    
    obj->v32 = NULL;
    src += shape_32[0] * sizeof(bool);
    
    int64_t shape_33[1] = {0};
    
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 1;
    err |= memcmp(src, " f64", 4) != 0;
    src += 4;
    if (err == 0) {
        memcpy(shape_33, src, 1 * sizeof(int64_t));
        src += 1 * sizeof(int64_t);
    }
    
    const void *data_33 = src;
    
    obj->v33 = NULL;
    src += shape_33[0] * sizeof(double);
    
    int64_t shape_34[1] = {0};
    
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 1;
    err |= memcmp(src, " f64", 4) != 0;
    src += 4;
    if (err == 0) {
        memcpy(shape_34, src, 1 * sizeof(int64_t));
        src += 1 * sizeof(int64_t);
    }
    
    const void *data_34 = src;
    
    obj->v34 = NULL;
    src += shape_34[0] * sizeof(double);
    
    int64_t shape_35[1] = {0};
    
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 1;
    err |= memcmp(src, " i64", 4) != 0;
    src += 4;
    if (err == 0) {
        memcpy(shape_35, src, 1 * sizeof(int64_t));
        src += 1 * sizeof(int64_t);
    }
    
    const void *data_35 = src;
    
    obj->v35 = NULL;
    src += shape_35[0] * sizeof(int64_t);
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 0;
    err |= memcmp(src, " i64", 4) != 0;
    src += 4;
    if (err == 0) {
        src += 0 * sizeof(int64_t);
    }
    
    const void *data_36 = src;
    
    src += sizeof(obj->v36);
    
    int64_t shape_37[1] = {0};
    
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 1;
    err |= memcmp(src, " f64", 4) != 0;
    src += 4;
    if (err == 0) {
        memcpy(shape_37, src, 1 * sizeof(int64_t));
        src += 1 * sizeof(int64_t);
    }
    
    const void *data_37 = src;
    
    obj->v37 = NULL;
    src += shape_37[0] * sizeof(double);
    
    int64_t shape_38[1] = {0};
    
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 1;
    err |= memcmp(src, " f64", 4) != 0;
    src += 4;
    if (err == 0) {
        memcpy(shape_38, src, 1 * sizeof(int64_t));
        src += 1 * sizeof(int64_t);
    }
    
    const void *data_38 = src;
    
    obj->v38 = NULL;
    src += shape_38[0] * sizeof(double);
    
    int64_t shape_39[1] = {0};
    
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 1;
    err |= memcmp(src, " i64", 4) != 0;
    src += 4;
    if (err == 0) {
        memcpy(shape_39, src, 1 * sizeof(int64_t));
        src += 1 * sizeof(int64_t);
    }
    
    const void *data_39 = src;
    
    obj->v39 = NULL;
    src += shape_39[0] * sizeof(int64_t);
    if (err == 0) {
        obj->v0 = futhark_new_i64_1d(ctx, data_0, shape_0[0]);
        if (obj->v0 == NULL)
            err = 1;
        obj->v1 = futhark_new_i64_1d(ctx, data_1, shape_1[0]);
        if (obj->v1 == NULL)
            err = 1;
        memcpy(&obj->v2, data_2, sizeof(obj->v2));
        memcpy(&obj->v3, data_3, sizeof(obj->v3));
        memcpy(&obj->v4, data_4, sizeof(obj->v4));
        memcpy(&obj->v5, data_5, sizeof(obj->v5));
        obj->v6 = futhark_new_f64_1d(ctx, data_6, shape_6[0]);
        if (obj->v6 == NULL)
            err = 1;
        memcpy(&obj->v7, data_7, sizeof(obj->v7));
        obj->v8 = futhark_new_f64_1d(ctx, data_8, shape_8[0]);
        if (obj->v8 == NULL)
            err = 1;
        obj->v9 = futhark_new_i64_1d(ctx, data_9, shape_9[0]);
        if (obj->v9 == NULL)
            err = 1;
        memcpy(&obj->v10, data_10, sizeof(obj->v10));
        obj->v11 = futhark_new_f64_1d(ctx, data_11, shape_11[0]);
        if (obj->v11 == NULL)
            err = 1;
        memcpy(&obj->v12, data_12, sizeof(obj->v12));
        obj->v13 = futhark_new_bool_1d(ctx, data_13, shape_13[0]);
        if (obj->v13 == NULL)
            err = 1;
        obj->v14 = futhark_new_i64_1d(ctx, data_14, shape_14[0]);
        if (obj->v14 == NULL)
            err = 1;
        obj->v15 = futhark_new_f64_1d(ctx, data_15, shape_15[0]);
        if (obj->v15 == NULL)
            err = 1;
        obj->v16 = futhark_new_f64_1d(ctx, data_16, shape_16[0]);
        if (obj->v16 == NULL)
            err = 1;
        memcpy(&obj->v17, data_17, sizeof(obj->v17));
        memcpy(&obj->v18, data_18, sizeof(obj->v18));
        memcpy(&obj->v19, data_19, sizeof(obj->v19));
        obj->v20 = futhark_new_bool_1d(ctx, data_20, shape_20[0]);
        if (obj->v20 == NULL)
            err = 1;
        memcpy(&obj->v21, data_21, sizeof(obj->v21));
        memcpy(&obj->v22, data_22, sizeof(obj->v22));
        obj->v23 = futhark_new_i64_1d(ctx, data_23, shape_23[0]);
        if (obj->v23 == NULL)
            err = 1;
        obj->v24 = futhark_new_i64_1d(ctx, data_24, shape_24[0]);
        if (obj->v24 == NULL)
            err = 1;
        obj->v25 = futhark_new_f64_1d(ctx, data_25, shape_25[0]);
        if (obj->v25 == NULL)
            err = 1;
        obj->v26 = futhark_new_f64_1d(ctx, data_26, shape_26[0]);
        if (obj->v26 == NULL)
            err = 1;
        obj->v27 = futhark_new_f64_1d(ctx, data_27, shape_27[0]);
        if (obj->v27 == NULL)
            err = 1;
        obj->v28 = futhark_new_f64_1d(ctx, data_28, shape_28[0]);
        if (obj->v28 == NULL)
            err = 1;
        obj->v29 = futhark_new_bool_1d(ctx, data_29, shape_29[0]);
        if (obj->v29 == NULL)
            err = 1;
        obj->v30 = futhark_new_bool_1d(ctx, data_30, shape_30[0]);
        if (obj->v30 == NULL)
            err = 1;
        obj->v31 = futhark_new_bool_1d(ctx, data_31, shape_31[0]);
        if (obj->v31 == NULL)
            err = 1;
        obj->v32 = futhark_new_bool_1d(ctx, data_32, shape_32[0]);
        if (obj->v32 == NULL)
            err = 1;
        obj->v33 = futhark_new_f64_1d(ctx, data_33, shape_33[0]);
        if (obj->v33 == NULL)
            err = 1;
        obj->v34 = futhark_new_f64_1d(ctx, data_34, shape_34[0]);
        if (obj->v34 == NULL)
            err = 1;
        obj->v35 = futhark_new_i64_1d(ctx, data_35, shape_35[0]);
        if (obj->v35 == NULL)
            err = 1;
        memcpy(&obj->v36, data_36, sizeof(obj->v36));
        obj->v37 = futhark_new_f64_1d(ctx, data_37, shape_37[0]);
        if (obj->v37 == NULL)
            err = 1;
        obj->v38 = futhark_new_f64_1d(ctx, data_38, shape_38[0]);
        if (obj->v38 == NULL)
            err = 1;
        obj->v39 = futhark_new_i64_1d(ctx, data_39, shape_39[0]);
        if (obj->v39 == NULL)
            err = 1;
    }
    if (err != 0) {
        int ret = 0, tmp;
        
        if (obj->v0 != NULL && (tmp = futhark_free_i64_1d(ctx, obj->v0)) != 0)
            ret = tmp;
        if (obj->v1 != NULL && (tmp = futhark_free_i64_1d(ctx, obj->v1)) != 0)
            ret = tmp;
        if (obj->v6 != NULL && (tmp = futhark_free_f64_1d(ctx, obj->v6)) != 0)
            ret = tmp;
        if (obj->v8 != NULL && (tmp = futhark_free_f64_1d(ctx, obj->v8)) != 0)
            ret = tmp;
        if (obj->v9 != NULL && (tmp = futhark_free_i64_1d(ctx, obj->v9)) != 0)
            ret = tmp;
        if (obj->v11 != NULL && (tmp = futhark_free_f64_1d(ctx, obj->v11)) != 0)
            ret = tmp;
        if (obj->v13 != NULL && (tmp = futhark_free_bool_1d(ctx, obj->v13)) != 0)
            ret = tmp;
        if (obj->v14 != NULL && (tmp = futhark_free_i64_1d(ctx, obj->v14)) != 0)
            ret = tmp;
        if (obj->v15 != NULL && (tmp = futhark_free_f64_1d(ctx, obj->v15)) != 0)
            ret = tmp;
        if (obj->v16 != NULL && (tmp = futhark_free_f64_1d(ctx, obj->v16)) != 0)
            ret = tmp;
        if (obj->v20 != NULL && (tmp = futhark_free_bool_1d(ctx, obj->v20)) != 0)
            ret = tmp;
        if (obj->v23 != NULL && (tmp = futhark_free_i64_1d(ctx, obj->v23)) != 0)
            ret = tmp;
        if (obj->v24 != NULL && (tmp = futhark_free_i64_1d(ctx, obj->v24)) != 0)
            ret = tmp;
        if (obj->v25 != NULL && (tmp = futhark_free_f64_1d(ctx, obj->v25)) != 0)
            ret = tmp;
        if (obj->v26 != NULL && (tmp = futhark_free_f64_1d(ctx, obj->v26)) != 0)
            ret = tmp;
        if (obj->v27 != NULL && (tmp = futhark_free_f64_1d(ctx, obj->v27)) != 0)
            ret = tmp;
        if (obj->v28 != NULL && (tmp = futhark_free_f64_1d(ctx, obj->v28)) != 0)
            ret = tmp;
        if (obj->v29 != NULL && (tmp = futhark_free_bool_1d(ctx, obj->v29)) != 0)
            ret = tmp;
        if (obj->v30 != NULL && (tmp = futhark_free_bool_1d(ctx, obj->v30)) != 0)
            ret = tmp;
        if (obj->v31 != NULL && (tmp = futhark_free_bool_1d(ctx, obj->v31)) != 0)
            ret = tmp;
        if (obj->v32 != NULL && (tmp = futhark_free_bool_1d(ctx, obj->v32)) != 0)
            ret = tmp;
        if (obj->v33 != NULL && (tmp = futhark_free_f64_1d(ctx, obj->v33)) != 0)
            ret = tmp;
        if (obj->v34 != NULL && (tmp = futhark_free_f64_1d(ctx, obj->v34)) != 0)
            ret = tmp;
        if (obj->v35 != NULL && (tmp = futhark_free_i64_1d(ctx, obj->v35)) != 0)
            ret = tmp;
        if (obj->v37 != NULL && (tmp = futhark_free_f64_1d(ctx, obj->v37)) != 0)
            ret = tmp;
        if (obj->v38 != NULL && (tmp = futhark_free_f64_1d(ctx, obj->v38)) != 0)
            ret = tmp;
        if (obj->v39 != NULL && (tmp = futhark_free_i64_1d(ctx, obj->v39)) != 0)
            ret = tmp;
        free(obj);
        obj = NULL;
    }
    return obj;
}
struct futhark_opaque_flushedData_double {
    struct futhark_i64_1d *v0;
    struct futhark_f64_1d *v1;
    struct futhark_f64_1d *v2;
};
int futhark_project_opaque_flushedData_double_chain_ids(struct futhark_context *ctx, struct futhark_i64_1d **out, const struct futhark_opaque_flushedData_double *obj)
{
    (void) ctx;
    
    struct futhark_i64_1d *v;
    
    lock_lock(&ctx->lock);
    CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
    v = malloc(sizeof(struct futhark_i64_1d));
    memcpy(v, obj->v0, sizeof(struct futhark_i64_1d));
    (void) (*v->mem.references)++;
    CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
    lock_unlock(&ctx->lock);
    *out = v;
    return 0;
}
int futhark_project_opaque_flushedData_double_xs(struct futhark_context *ctx, struct futhark_f64_1d **out, const struct futhark_opaque_flushedData_double *obj)
{
    (void) ctx;
    
    struct futhark_f64_1d *v;
    
    lock_lock(&ctx->lock);
    CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
    v = malloc(sizeof(struct futhark_f64_1d));
    memcpy(v, obj->v1, sizeof(struct futhark_f64_1d));
    (void) (*v->mem.references)++;
    CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
    lock_unlock(&ctx->lock);
    *out = v;
    return 0;
}
int futhark_project_opaque_flushedData_double_ys(struct futhark_context *ctx, struct futhark_f64_1d **out, const struct futhark_opaque_flushedData_double *obj)
{
    (void) ctx;
    
    struct futhark_f64_1d *v;
    
    lock_lock(&ctx->lock);
    CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
    v = malloc(sizeof(struct futhark_f64_1d));
    memcpy(v, obj->v2, sizeof(struct futhark_f64_1d));
    (void) (*v->mem.references)++;
    CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
    lock_unlock(&ctx->lock);
    *out = v;
    return 0;
}
int futhark_new_opaque_flushedData_double(struct futhark_context *ctx, struct futhark_opaque_flushedData_double **out, const struct futhark_i64_1d *f_chain_ids, const struct futhark_f64_1d *f_xs, const struct futhark_f64_1d *f_ys)
{
    struct futhark_opaque_flushedData_double *v = malloc(sizeof(struct futhark_opaque_flushedData_double));
    
    lock_lock(&ctx->lock);
    CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
    {
        v->v0 = malloc(sizeof(struct futhark_i64_1d));
        *v->v0 = *f_chain_ids;
        (void) (*v->v0->mem.references)++;
    }
    {
        v->v1 = malloc(sizeof(struct futhark_f64_1d));
        *v->v1 = *f_xs;
        (void) (*v->v1->mem.references)++;
    }
    {
        v->v2 = malloc(sizeof(struct futhark_f64_1d));
        *v->v2 = *f_ys;
        (void) (*v->v2->mem.references)++;
    }
    CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
    lock_unlock(&ctx->lock);
    *out = v;
    return FUTHARK_SUCCESS;
}
int futhark_free_opaque_flushedData_double(struct futhark_context *ctx, struct futhark_opaque_flushedData_double *obj)
{
    (void) ctx;
    
    int ret = 0, tmp;
    
    if (obj->v0 != NULL && (tmp = futhark_free_i64_1d(ctx, obj->v0)) != 0)
        ret = tmp;
    if (obj->v1 != NULL && (tmp = futhark_free_f64_1d(ctx, obj->v1)) != 0)
        ret = tmp;
    if (obj->v2 != NULL && (tmp = futhark_free_f64_1d(ctx, obj->v2)) != 0)
        ret = tmp;
    free(obj);
    return ret;
}
int futhark_store_opaque_flushedData_double(struct futhark_context *ctx, const struct futhark_opaque_flushedData_double *obj, void **p, size_t *n)
{
    (void) ctx;
    
    int ret = 0;
    int64_t size_0 = 7 + 1 * sizeof(int64_t) + futhark_shape_i64_1d(ctx, obj->v0)[0] * sizeof(int64_t);
    int64_t size_1 = 7 + 1 * sizeof(int64_t) + futhark_shape_f64_1d(ctx, obj->v1)[0] * sizeof(double);
    int64_t size_2 = 7 + 1 * sizeof(int64_t) + futhark_shape_f64_1d(ctx, obj->v2)[0] * sizeof(double);
    
    *n = size_0 + size_1 + size_2;
    if (p != NULL && *p == NULL)
        *p = malloc(*n);
    if (p != NULL) {
        unsigned char *out = *p;
        
        *out++ = 'b';
        *out++ = 2;
        *out++ = 1;
        memcpy(out, " i64", 4);
        out += 4;
        memcpy(out, futhark_shape_i64_1d(ctx, obj->v0), 1 * sizeof(int64_t));
        out += 1 * sizeof(int64_t);
        ret |= futhark_values_i64_1d(ctx, obj->v0, (void *) out);
        out += futhark_shape_i64_1d(ctx, obj->v0)[0] * sizeof(int64_t);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 1;
        memcpy(out, " f64", 4);
        out += 4;
        memcpy(out, futhark_shape_f64_1d(ctx, obj->v1), 1 * sizeof(int64_t));
        out += 1 * sizeof(int64_t);
        ret |= futhark_values_f64_1d(ctx, obj->v1, (void *) out);
        out += futhark_shape_f64_1d(ctx, obj->v1)[0] * sizeof(double);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 1;
        memcpy(out, " f64", 4);
        out += 4;
        memcpy(out, futhark_shape_f64_1d(ctx, obj->v2), 1 * sizeof(int64_t));
        out += 1 * sizeof(int64_t);
        ret |= futhark_values_f64_1d(ctx, obj->v2, (void *) out);
        out += futhark_shape_f64_1d(ctx, obj->v2)[0] * sizeof(double);
    }
    return ret;
}
struct futhark_opaque_flushedData_double *futhark_restore_opaque_flushedData_double(struct futhark_context *ctx, const void *p)
{
    (void) ctx;
    
    int err = 0;
    const unsigned char *src = p;
    struct futhark_opaque_flushedData_double *obj = malloc(sizeof(struct futhark_opaque_flushedData_double));
    int64_t shape_0[1] = {0};
    
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 1;
    err |= memcmp(src, " i64", 4) != 0;
    src += 4;
    if (err == 0) {
        memcpy(shape_0, src, 1 * sizeof(int64_t));
        src += 1 * sizeof(int64_t);
    }
    
    const void *data_0 = src;
    
    obj->v0 = NULL;
    src += shape_0[0] * sizeof(int64_t);
    
    int64_t shape_1[1] = {0};
    
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 1;
    err |= memcmp(src, " f64", 4) != 0;
    src += 4;
    if (err == 0) {
        memcpy(shape_1, src, 1 * sizeof(int64_t));
        src += 1 * sizeof(int64_t);
    }
    
    const void *data_1 = src;
    
    obj->v1 = NULL;
    src += shape_1[0] * sizeof(double);
    
    int64_t shape_2[1] = {0};
    
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 1;
    err |= memcmp(src, " f64", 4) != 0;
    src += 4;
    if (err == 0) {
        memcpy(shape_2, src, 1 * sizeof(int64_t));
        src += 1 * sizeof(int64_t);
    }
    
    const void *data_2 = src;
    
    obj->v2 = NULL;
    src += shape_2[0] * sizeof(double);
    if (err == 0) {
        obj->v0 = futhark_new_i64_1d(ctx, data_0, shape_0[0]);
        if (obj->v0 == NULL)
            err = 1;
        obj->v1 = futhark_new_f64_1d(ctx, data_1, shape_1[0]);
        if (obj->v1 == NULL)
            err = 1;
        obj->v2 = futhark_new_f64_1d(ctx, data_2, shape_2[0]);
        if (obj->v2 == NULL)
            err = 1;
    }
    if (err != 0) {
        int ret = 0, tmp;
        
        if (obj->v0 != NULL && (tmp = futhark_free_i64_1d(ctx, obj->v0)) != 0)
            ret = tmp;
        if (obj->v1 != NULL && (tmp = futhark_free_f64_1d(ctx, obj->v1)) != 0)
            ret = tmp;
        if (obj->v2 != NULL && (tmp = futhark_free_f64_1d(ctx, obj->v2)) != 0)
            ret = tmp;
        free(obj);
        obj = NULL;
    }
    return obj;
}
struct futhark_opaque_collisionTable {
    struct futhark_i64_1d *v0;
    struct futhark_i64_1d *v1;
};
int futhark_project_opaque_collisionTable_chain_id(struct futhark_context *ctx, struct futhark_i64_1d **out, const struct futhark_opaque_collisionTable *obj)
{
    (void) ctx;
    
    struct futhark_i64_1d *v;
    
    lock_lock(&ctx->lock);
    CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
    v = malloc(sizeof(struct futhark_i64_1d));
    memcpy(v, obj->v0, sizeof(struct futhark_i64_1d));
    (void) (*v->mem.references)++;
    CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
    lock_unlock(&ctx->lock);
    *out = v;
    return 0;
}
int futhark_project_opaque_collisionTable_replaceWith(struct futhark_context *ctx, struct futhark_i64_1d **out, const struct futhark_opaque_collisionTable *obj)
{
    (void) ctx;
    
    struct futhark_i64_1d *v;
    
    lock_lock(&ctx->lock);
    CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
    v = malloc(sizeof(struct futhark_i64_1d));
    memcpy(v, obj->v1, sizeof(struct futhark_i64_1d));
    (void) (*v->mem.references)++;
    CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
    lock_unlock(&ctx->lock);
    *out = v;
    return 0;
}
int futhark_new_opaque_collisionTable(struct futhark_context *ctx, struct futhark_opaque_collisionTable **out, const struct futhark_i64_1d *f_chain_id, const struct futhark_i64_1d *f_replaceWith)
{
    struct futhark_opaque_collisionTable *v = malloc(sizeof(struct futhark_opaque_collisionTable));
    
    lock_lock(&ctx->lock);
    CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
    {
        v->v0 = malloc(sizeof(struct futhark_i64_1d));
        *v->v0 = *f_chain_id;
        (void) (*v->v0->mem.references)++;
    }
    {
        v->v1 = malloc(sizeof(struct futhark_i64_1d));
        *v->v1 = *f_replaceWith;
        (void) (*v->v1->mem.references)++;
    }
    CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
    lock_unlock(&ctx->lock);
    *out = v;
    return FUTHARK_SUCCESS;
}
int futhark_free_opaque_collisionTable(struct futhark_context *ctx, struct futhark_opaque_collisionTable *obj)
{
    (void) ctx;
    
    int ret = 0, tmp;
    
    if (obj->v0 != NULL && (tmp = futhark_free_i64_1d(ctx, obj->v0)) != 0)
        ret = tmp;
    if (obj->v1 != NULL && (tmp = futhark_free_i64_1d(ctx, obj->v1)) != 0)
        ret = tmp;
    free(obj);
    return ret;
}
int futhark_store_opaque_collisionTable(struct futhark_context *ctx, const struct futhark_opaque_collisionTable *obj, void **p, size_t *n)
{
    (void) ctx;
    
    int ret = 0;
    int64_t size_0 = 7 + 1 * sizeof(int64_t) + futhark_shape_i64_1d(ctx, obj->v0)[0] * sizeof(int64_t);
    int64_t size_1 = 7 + 1 * sizeof(int64_t) + futhark_shape_i64_1d(ctx, obj->v1)[0] * sizeof(int64_t);
    
    *n = size_0 + size_1;
    if (p != NULL && *p == NULL)
        *p = malloc(*n);
    if (p != NULL) {
        unsigned char *out = *p;
        
        *out++ = 'b';
        *out++ = 2;
        *out++ = 1;
        memcpy(out, " i64", 4);
        out += 4;
        memcpy(out, futhark_shape_i64_1d(ctx, obj->v0), 1 * sizeof(int64_t));
        out += 1 * sizeof(int64_t);
        ret |= futhark_values_i64_1d(ctx, obj->v0, (void *) out);
        out += futhark_shape_i64_1d(ctx, obj->v0)[0] * sizeof(int64_t);
        *out++ = 'b';
        *out++ = 2;
        *out++ = 1;
        memcpy(out, " i64", 4);
        out += 4;
        memcpy(out, futhark_shape_i64_1d(ctx, obj->v1), 1 * sizeof(int64_t));
        out += 1 * sizeof(int64_t);
        ret |= futhark_values_i64_1d(ctx, obj->v1, (void *) out);
        out += futhark_shape_i64_1d(ctx, obj->v1)[0] * sizeof(int64_t);
    }
    return ret;
}
struct futhark_opaque_collisionTable *futhark_restore_opaque_collisionTable(struct futhark_context *ctx, const void *p)
{
    (void) ctx;
    
    int err = 0;
    const unsigned char *src = p;
    struct futhark_opaque_collisionTable *obj = malloc(sizeof(struct futhark_opaque_collisionTable));
    int64_t shape_0[1] = {0};
    
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 1;
    err |= memcmp(src, " i64", 4) != 0;
    src += 4;
    if (err == 0) {
        memcpy(shape_0, src, 1 * sizeof(int64_t));
        src += 1 * sizeof(int64_t);
    }
    
    const void *data_0 = src;
    
    obj->v0 = NULL;
    src += shape_0[0] * sizeof(int64_t);
    
    int64_t shape_1[1] = {0};
    
    err |= *src++ != 'b';
    err |= *src++ != 2;
    err |= *src++ != 1;
    err |= memcmp(src, " i64", 4) != 0;
    src += 4;
    if (err == 0) {
        memcpy(shape_1, src, 1 * sizeof(int64_t));
        src += 1 * sizeof(int64_t);
    }
    
    const void *data_1 = src;
    
    obj->v1 = NULL;
    src += shape_1[0] * sizeof(int64_t);
    if (err == 0) {
        obj->v0 = futhark_new_i64_1d(ctx, data_0, shape_0[0]);
        if (obj->v0 == NULL)
            err = 1;
        obj->v1 = futhark_new_i64_1d(ctx, data_1, shape_1[0]);
        if (obj->v1 == NULL)
            err = 1;
    }
    if (err != 0) {
        int ret = 0, tmp;
        
        if (obj->v0 != NULL && (tmp = futhark_free_i64_1d(ctx, obj->v0)) != 0)
            ret = tmp;
        if (obj->v1 != NULL && (tmp = futhark_free_i64_1d(ctx, obj->v1)) != 0)
            ret = tmp;
        free(obj);
        obj = NULL;
    }
    return obj;
}

FUTHARK_FUN_ATTR int futrts_builtinzhiota_i64(struct futhark_context *ctx, struct memblock_device mem_50375, int64_t n_50376, int64_t x_50377, int64_t s_50378)
{
    (void) ctx;
    
    int err = 0;
    struct memblock_device counters_mem_50201 = ctx->constants->counters_mem_50201;
    struct memblock_device counters_mem_50275 = ctx->constants->counters_mem_50275;
    struct memblock_device counters_mem_50707 = ctx->constants->counters_mem_50707;
    struct memblock_device counters_mem_51122 = ctx->constants->counters_mem_51122;
    struct memblock_device counters_mem_51145 = ctx->constants->counters_mem_51145;
    struct memblock_device counters_mem_51184 = ctx->constants->counters_mem_51184;
    struct memblock_device counters_mem_51873 = ctx->constants->counters_mem_51873;
    struct memblock_device counters_mem_52032 = ctx->constants->counters_mem_52032;
    struct memblock_device global_dynid_mem_50266 = ctx->constants->global_dynid_mem_50266;
    struct memblock_device global_dynid_mem_50275 = ctx->constants->global_dynid_mem_50275;
    struct memblock_device global_dynid_mem_50287 = ctx->constants->global_dynid_mem_50287;
    struct memblock_device global_dynid_mem_50292 = ctx->constants->global_dynid_mem_50292;
    struct memblock_device global_dynid_mem_50450 = ctx->constants->global_dynid_mem_50450;
    struct memblock_device global_dynid_mem_50529 = ctx->constants->global_dynid_mem_50529;
    struct memblock_device global_dynid_mem_50570 = ctx->constants->global_dynid_mem_50570;
    struct memblock_device global_dynid_mem_50733 = ctx->constants->global_dynid_mem_50733;
    struct memblock_device global_dynid_mem_50769 = ctx->constants->global_dynid_mem_50769;
    struct memblock_device global_dynid_mem_50871 = ctx->constants->global_dynid_mem_50871;
    struct memblock_device global_dynid_mem_50875 = ctx->constants->global_dynid_mem_50875;
    struct memblock_device global_dynid_mem_50988 = ctx->constants->global_dynid_mem_50988;
    struct memblock_device global_dynid_mem_51231 = ctx->constants->global_dynid_mem_51231;
    struct memblock_device global_dynid_mem_51378 = ctx->constants->global_dynid_mem_51378;
    struct memblock_device global_dynid_mem_51534 = ctx->constants->global_dynid_mem_51534;
    struct memblock_device global_dynid_mem_51651 = ctx->constants->global_dynid_mem_51651;
    int64_t tblock_sizze_50384;
    
    tblock_sizze_50384 = *ctx->tuning_params.builtinzhiota_i64zitblock_sizze_50384;
    
    int64_t virt_num_tblocks_50385 = sdiv_up64(n_50376, tblock_sizze_50384);
    int64_t num_tblocks_50386 = smin64(virt_num_tblocks_50385, (int64_t) 1048576);
    
    {
        err = gpu_kernel_builtinzhiota_i64ziiota_i64_50380(ctx, num_tblocks_50386, 1, 1, tblock_sizze_50384, 1, 1, (int64_t) 0, n_50376, x_50377, s_50378, virt_num_tblocks_50385, num_tblocks_50386, mem_50375.mem);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
  cleanup:
    { }
    return err;
}
FUTHARK_FUN_ATTR int futrts_builtinzhreplicate_bool(struct futhark_context *ctx, struct memblock_device mem_51016, int64_t num_elems_51017, bool val_51018)
{
    (void) ctx;
    
    int err = 0;
    struct memblock_device counters_mem_50201 = ctx->constants->counters_mem_50201;
    struct memblock_device counters_mem_50275 = ctx->constants->counters_mem_50275;
    struct memblock_device counters_mem_50707 = ctx->constants->counters_mem_50707;
    struct memblock_device counters_mem_51122 = ctx->constants->counters_mem_51122;
    struct memblock_device counters_mem_51145 = ctx->constants->counters_mem_51145;
    struct memblock_device counters_mem_51184 = ctx->constants->counters_mem_51184;
    struct memblock_device counters_mem_51873 = ctx->constants->counters_mem_51873;
    struct memblock_device counters_mem_52032 = ctx->constants->counters_mem_52032;
    struct memblock_device global_dynid_mem_50266 = ctx->constants->global_dynid_mem_50266;
    struct memblock_device global_dynid_mem_50275 = ctx->constants->global_dynid_mem_50275;
    struct memblock_device global_dynid_mem_50287 = ctx->constants->global_dynid_mem_50287;
    struct memblock_device global_dynid_mem_50292 = ctx->constants->global_dynid_mem_50292;
    struct memblock_device global_dynid_mem_50450 = ctx->constants->global_dynid_mem_50450;
    struct memblock_device global_dynid_mem_50529 = ctx->constants->global_dynid_mem_50529;
    struct memblock_device global_dynid_mem_50570 = ctx->constants->global_dynid_mem_50570;
    struct memblock_device global_dynid_mem_50733 = ctx->constants->global_dynid_mem_50733;
    struct memblock_device global_dynid_mem_50769 = ctx->constants->global_dynid_mem_50769;
    struct memblock_device global_dynid_mem_50871 = ctx->constants->global_dynid_mem_50871;
    struct memblock_device global_dynid_mem_50875 = ctx->constants->global_dynid_mem_50875;
    struct memblock_device global_dynid_mem_50988 = ctx->constants->global_dynid_mem_50988;
    struct memblock_device global_dynid_mem_51231 = ctx->constants->global_dynid_mem_51231;
    struct memblock_device global_dynid_mem_51378 = ctx->constants->global_dynid_mem_51378;
    struct memblock_device global_dynid_mem_51534 = ctx->constants->global_dynid_mem_51534;
    struct memblock_device global_dynid_mem_51651 = ctx->constants->global_dynid_mem_51651;
    int64_t replicate_n_51020 = num_elems_51017;
    int64_t tblock_sizze_51025;
    
    tblock_sizze_51025 = *ctx->tuning_params.builtinzhreplicate_boolzitblock_sizze_51025;
    
    int64_t virt_num_tblocks_51026 = sdiv_up64(replicate_n_51020, tblock_sizze_51025);
    int64_t num_tblocks_51027 = smin64(virt_num_tblocks_51026, (int64_t) 1048576);
    
    {
        err = gpu_kernel_builtinzhreplicate_boolzireplicate_51021(ctx, num_tblocks_51027, 1, 1, tblock_sizze_51025, 1, 1, (int64_t) 0, num_elems_51017, val_51018, replicate_n_51020, virt_num_tblocks_51026, num_tblocks_51027, mem_51016.mem);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
  cleanup:
    { }
    return err;
}
FUTHARK_FUN_ATTR int futrts_builtinzhreplicate_f64(struct futhark_context *ctx, struct memblock_device mem_50450, int64_t num_elems_50451, double val_50452)
{
    (void) ctx;
    
    int err = 0;
    struct memblock_device counters_mem_50201 = ctx->constants->counters_mem_50201;
    struct memblock_device counters_mem_50275 = ctx->constants->counters_mem_50275;
    struct memblock_device counters_mem_50707 = ctx->constants->counters_mem_50707;
    struct memblock_device counters_mem_51122 = ctx->constants->counters_mem_51122;
    struct memblock_device counters_mem_51145 = ctx->constants->counters_mem_51145;
    struct memblock_device counters_mem_51184 = ctx->constants->counters_mem_51184;
    struct memblock_device counters_mem_51873 = ctx->constants->counters_mem_51873;
    struct memblock_device counters_mem_52032 = ctx->constants->counters_mem_52032;
    struct memblock_device global_dynid_mem_50266 = ctx->constants->global_dynid_mem_50266;
    struct memblock_device global_dynid_mem_50275 = ctx->constants->global_dynid_mem_50275;
    struct memblock_device global_dynid_mem_50287 = ctx->constants->global_dynid_mem_50287;
    struct memblock_device global_dynid_mem_50292 = ctx->constants->global_dynid_mem_50292;
    struct memblock_device global_dynid_mem_50450 = ctx->constants->global_dynid_mem_50450;
    struct memblock_device global_dynid_mem_50529 = ctx->constants->global_dynid_mem_50529;
    struct memblock_device global_dynid_mem_50570 = ctx->constants->global_dynid_mem_50570;
    struct memblock_device global_dynid_mem_50733 = ctx->constants->global_dynid_mem_50733;
    struct memblock_device global_dynid_mem_50769 = ctx->constants->global_dynid_mem_50769;
    struct memblock_device global_dynid_mem_50871 = ctx->constants->global_dynid_mem_50871;
    struct memblock_device global_dynid_mem_50875 = ctx->constants->global_dynid_mem_50875;
    struct memblock_device global_dynid_mem_50988 = ctx->constants->global_dynid_mem_50988;
    struct memblock_device global_dynid_mem_51231 = ctx->constants->global_dynid_mem_51231;
    struct memblock_device global_dynid_mem_51378 = ctx->constants->global_dynid_mem_51378;
    struct memblock_device global_dynid_mem_51534 = ctx->constants->global_dynid_mem_51534;
    struct memblock_device global_dynid_mem_51651 = ctx->constants->global_dynid_mem_51651;
    int64_t replicate_n_50454 = num_elems_50451;
    int64_t tblock_sizze_50459;
    
    tblock_sizze_50459 = *ctx->tuning_params.builtinzhreplicate_f64zitblock_sizze_50459;
    
    int64_t virt_num_tblocks_50460 = sdiv_up64(replicate_n_50454, tblock_sizze_50459);
    int64_t num_tblocks_50461 = smin64(virt_num_tblocks_50460, (int64_t) 1048576);
    
    {
        err = gpu_kernel_builtinzhreplicate_f64zireplicate_50455(ctx, num_tblocks_50461, 1, 1, tblock_sizze_50459, 1, 1, (int64_t) 0, num_elems_50451, val_50452, replicate_n_50454, virt_num_tblocks_50460, num_tblocks_50461, mem_50450.mem);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
  cleanup:
    { }
    return err;
}
FUTHARK_FUN_ATTR int futrts_builtinzhreplicate_i32(struct futhark_context *ctx, struct memblock_device mem_50277, int64_t num_elems_50278, int32_t val_50279)
{
    (void) ctx;
    
    int err = 0;
    struct memblock_device counters_mem_50201 = ctx->constants->counters_mem_50201;
    struct memblock_device counters_mem_50275 = ctx->constants->counters_mem_50275;
    struct memblock_device counters_mem_50707 = ctx->constants->counters_mem_50707;
    struct memblock_device counters_mem_51122 = ctx->constants->counters_mem_51122;
    struct memblock_device counters_mem_51145 = ctx->constants->counters_mem_51145;
    struct memblock_device counters_mem_51184 = ctx->constants->counters_mem_51184;
    struct memblock_device counters_mem_51873 = ctx->constants->counters_mem_51873;
    struct memblock_device counters_mem_52032 = ctx->constants->counters_mem_52032;
    struct memblock_device global_dynid_mem_50266 = ctx->constants->global_dynid_mem_50266;
    struct memblock_device global_dynid_mem_50275 = ctx->constants->global_dynid_mem_50275;
    struct memblock_device global_dynid_mem_50287 = ctx->constants->global_dynid_mem_50287;
    struct memblock_device global_dynid_mem_50292 = ctx->constants->global_dynid_mem_50292;
    struct memblock_device global_dynid_mem_50450 = ctx->constants->global_dynid_mem_50450;
    struct memblock_device global_dynid_mem_50529 = ctx->constants->global_dynid_mem_50529;
    struct memblock_device global_dynid_mem_50570 = ctx->constants->global_dynid_mem_50570;
    struct memblock_device global_dynid_mem_50733 = ctx->constants->global_dynid_mem_50733;
    struct memblock_device global_dynid_mem_50769 = ctx->constants->global_dynid_mem_50769;
    struct memblock_device global_dynid_mem_50871 = ctx->constants->global_dynid_mem_50871;
    struct memblock_device global_dynid_mem_50875 = ctx->constants->global_dynid_mem_50875;
    struct memblock_device global_dynid_mem_50988 = ctx->constants->global_dynid_mem_50988;
    struct memblock_device global_dynid_mem_51231 = ctx->constants->global_dynid_mem_51231;
    struct memblock_device global_dynid_mem_51378 = ctx->constants->global_dynid_mem_51378;
    struct memblock_device global_dynid_mem_51534 = ctx->constants->global_dynid_mem_51534;
    struct memblock_device global_dynid_mem_51651 = ctx->constants->global_dynid_mem_51651;
    int64_t replicate_n_50281 = num_elems_50278;
    int64_t tblock_sizze_50286;
    
    tblock_sizze_50286 = *ctx->tuning_params.builtinzhreplicate_i32zitblock_sizze_50286;
    
    int64_t virt_num_tblocks_50287 = sdiv_up64(replicate_n_50281, tblock_sizze_50286);
    int64_t num_tblocks_50288 = smin64(virt_num_tblocks_50287, (int64_t) 1048576);
    
    {
        err = gpu_kernel_builtinzhreplicate_i32zireplicate_50282(ctx, num_tblocks_50288, 1, 1, tblock_sizze_50286, 1, 1, (int64_t) 0, num_elems_50278, val_50279, replicate_n_50281, virt_num_tblocks_50287, num_tblocks_50288, mem_50277.mem);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
  cleanup:
    { }
    return err;
}
FUTHARK_FUN_ATTR int futrts_builtinzhreplicate_i64(struct futhark_context *ctx, struct memblock_device mem_50192, int64_t num_elems_50193, int64_t val_50194)
{
    (void) ctx;
    
    int err = 0;
    struct memblock_device counters_mem_50201 = ctx->constants->counters_mem_50201;
    struct memblock_device counters_mem_50275 = ctx->constants->counters_mem_50275;
    struct memblock_device counters_mem_50707 = ctx->constants->counters_mem_50707;
    struct memblock_device counters_mem_51122 = ctx->constants->counters_mem_51122;
    struct memblock_device counters_mem_51145 = ctx->constants->counters_mem_51145;
    struct memblock_device counters_mem_51184 = ctx->constants->counters_mem_51184;
    struct memblock_device counters_mem_51873 = ctx->constants->counters_mem_51873;
    struct memblock_device counters_mem_52032 = ctx->constants->counters_mem_52032;
    struct memblock_device global_dynid_mem_50266 = ctx->constants->global_dynid_mem_50266;
    struct memblock_device global_dynid_mem_50275 = ctx->constants->global_dynid_mem_50275;
    struct memblock_device global_dynid_mem_50287 = ctx->constants->global_dynid_mem_50287;
    struct memblock_device global_dynid_mem_50292 = ctx->constants->global_dynid_mem_50292;
    struct memblock_device global_dynid_mem_50450 = ctx->constants->global_dynid_mem_50450;
    struct memblock_device global_dynid_mem_50529 = ctx->constants->global_dynid_mem_50529;
    struct memblock_device global_dynid_mem_50570 = ctx->constants->global_dynid_mem_50570;
    struct memblock_device global_dynid_mem_50733 = ctx->constants->global_dynid_mem_50733;
    struct memblock_device global_dynid_mem_50769 = ctx->constants->global_dynid_mem_50769;
    struct memblock_device global_dynid_mem_50871 = ctx->constants->global_dynid_mem_50871;
    struct memblock_device global_dynid_mem_50875 = ctx->constants->global_dynid_mem_50875;
    struct memblock_device global_dynid_mem_50988 = ctx->constants->global_dynid_mem_50988;
    struct memblock_device global_dynid_mem_51231 = ctx->constants->global_dynid_mem_51231;
    struct memblock_device global_dynid_mem_51378 = ctx->constants->global_dynid_mem_51378;
    struct memblock_device global_dynid_mem_51534 = ctx->constants->global_dynid_mem_51534;
    struct memblock_device global_dynid_mem_51651 = ctx->constants->global_dynid_mem_51651;
    int64_t replicate_n_50196 = num_elems_50193;
    int64_t tblock_sizze_50201;
    
    tblock_sizze_50201 = *ctx->tuning_params.builtinzhreplicate_i64zitblock_sizze_50201;
    
    int64_t virt_num_tblocks_50202 = sdiv_up64(replicate_n_50196, tblock_sizze_50201);
    int64_t num_tblocks_50203 = smin64(virt_num_tblocks_50202, (int64_t) 1048576);
    
    {
        err = gpu_kernel_builtinzhreplicate_i64zireplicate_50197(ctx, num_tblocks_50203, 1, 1, tblock_sizze_50201, 1, 1, (int64_t) 0, num_elems_50193, val_50194, replicate_n_50196, virt_num_tblocks_50202, num_tblocks_50203, mem_50192.mem);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
  cleanup:
    { }
    return err;
}
FUTHARK_FUN_ATTR int futrts_builtinzhreplicate_i8(struct futhark_context *ctx, struct memblock_device mem_50242, int64_t num_elems_50243, int8_t val_50244)
{
    (void) ctx;
    
    int err = 0;
    struct memblock_device counters_mem_50201 = ctx->constants->counters_mem_50201;
    struct memblock_device counters_mem_50275 = ctx->constants->counters_mem_50275;
    struct memblock_device counters_mem_50707 = ctx->constants->counters_mem_50707;
    struct memblock_device counters_mem_51122 = ctx->constants->counters_mem_51122;
    struct memblock_device counters_mem_51145 = ctx->constants->counters_mem_51145;
    struct memblock_device counters_mem_51184 = ctx->constants->counters_mem_51184;
    struct memblock_device counters_mem_51873 = ctx->constants->counters_mem_51873;
    struct memblock_device counters_mem_52032 = ctx->constants->counters_mem_52032;
    struct memblock_device global_dynid_mem_50266 = ctx->constants->global_dynid_mem_50266;
    struct memblock_device global_dynid_mem_50275 = ctx->constants->global_dynid_mem_50275;
    struct memblock_device global_dynid_mem_50287 = ctx->constants->global_dynid_mem_50287;
    struct memblock_device global_dynid_mem_50292 = ctx->constants->global_dynid_mem_50292;
    struct memblock_device global_dynid_mem_50450 = ctx->constants->global_dynid_mem_50450;
    struct memblock_device global_dynid_mem_50529 = ctx->constants->global_dynid_mem_50529;
    struct memblock_device global_dynid_mem_50570 = ctx->constants->global_dynid_mem_50570;
    struct memblock_device global_dynid_mem_50733 = ctx->constants->global_dynid_mem_50733;
    struct memblock_device global_dynid_mem_50769 = ctx->constants->global_dynid_mem_50769;
    struct memblock_device global_dynid_mem_50871 = ctx->constants->global_dynid_mem_50871;
    struct memblock_device global_dynid_mem_50875 = ctx->constants->global_dynid_mem_50875;
    struct memblock_device global_dynid_mem_50988 = ctx->constants->global_dynid_mem_50988;
    struct memblock_device global_dynid_mem_51231 = ctx->constants->global_dynid_mem_51231;
    struct memblock_device global_dynid_mem_51378 = ctx->constants->global_dynid_mem_51378;
    struct memblock_device global_dynid_mem_51534 = ctx->constants->global_dynid_mem_51534;
    struct memblock_device global_dynid_mem_51651 = ctx->constants->global_dynid_mem_51651;
    int64_t replicate_n_50246 = num_elems_50243;
    int64_t tblock_sizze_50251;
    
    tblock_sizze_50251 = *ctx->tuning_params.builtinzhreplicate_i8zitblock_sizze_50251;
    
    int64_t virt_num_tblocks_50252 = sdiv_up64(replicate_n_50246, tblock_sizze_50251);
    int64_t num_tblocks_50253 = smin64(virt_num_tblocks_50252, (int64_t) 1048576);
    
    {
        err = gpu_kernel_builtinzhreplicate_i8zireplicate_50247(ctx, num_tblocks_50253, 1, 1, tblock_sizze_50251, 1, 1, (int64_t) 0, num_elems_50243, val_50244, replicate_n_50246, virt_num_tblocks_50252, num_tblocks_50253, mem_50242.mem);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
  cleanup:
    { }
    return err;
}
FUTHARK_FUN_ATTR int futrts_entry_add_next_partition_double(struct futhark_context *ctx, struct memblock_device *mem_out_p_52084, struct memblock_device *mem_out_p_52085, struct memblock_device *mem_out_p_52086, struct memblock_device *mem_out_p_52087, struct memblock_device *mem_out_p_52088, struct memblock_device *mem_out_p_52089, struct memblock_device *mem_out_p_52090, struct memblock_device *mem_out_p_52091, struct memblock_device *mem_out_p_52092, struct memblock_device *mem_out_p_52093, struct memblock_device *mem_out_p_52094, struct memblock_device *mem_out_p_52095, struct memblock_device *mem_out_p_52096, struct memblock_device *mem_out_p_52097, struct memblock_device *mem_out_p_52098, struct memblock_device *mem_out_p_52099, struct memblock_device *mem_out_p_52100, struct memblock_device *mem_out_p_52101, struct memblock_device *mem_out_p_52102, struct memblock_device *mem_out_p_52103, struct memblock_device *mem_out_p_52104, struct memblock_device *mem_out_p_52105, struct memblock_device *mem_out_p_52106, struct memblock_device *mem_out_p_52107, struct memblock_device *mem_out_p_52108, struct memblock_device *mem_out_p_52109, struct memblock_device *mem_out_p_52110, int64_t *out_prim_out_52111, int64_t *out_prim_out_52112, int64_t *out_prim_out_52113, int8_t *out_prim_out_52114, int8_t *out_prim_out_52115, double *out_prim_out_52116, int64_t *out_prim_out_52117, int64_t *out_prim_out_52118, double *out_prim_out_52119, int64_t *out_prim_out_52120, int64_t *out_prim_out_52121, int64_t *out_prim_out_52122, int64_t *out_prim_out_52123, int64_t *out_prim_out_52124, int64_t *out_prim_out_52125, int64_t *out_prim_out_52126, struct memblock_device chain_collisions_mem_49374, struct memblock_device chain_collisions_mem_49375, struct memblock_device clBase_mem_49376, struct memblock_device clBase_mem_49377, struct memblock_device clBase_mem_49378, struct memblock_device clBase_mem_49379, struct memblock_device clProc_mem_49380, struct memblock_device clProc_mem_49381, struct memblock_device clProc_mem_49382, struct memblock_device clProc_mem_49383, struct memblock_device clProc_mem_49384, struct memblock_device clProc_mem_49385, struct memblock_device current_partition_mem_49386, struct memblock_device current_partition_mem_49387, struct memblock_device current_partition_mem_49388, struct memblock_device current_partition_mem_49389, struct memblock_device current_partition_mem_49390, struct memblock_device current_partition_mem_49391, struct memblock_device current_partition_mem_49392, struct memblock_device current_partition_mem_49393, struct memblock_device current_partition_mem_49394, struct memblock_device current_partition_mem_49395, struct memblock_device current_partition_mem_49396, struct memblock_device current_partition_mem_49397, struct memblock_device toFlush_dat_mem_49398, struct memblock_device toFlush_dat_mem_49399, struct memblock_device toFlush_ids_mem_49400, struct memblock_device new_xs_mem_49401, struct memblock_device new_ys_mem_49402, int64_t n_old_27030, int64_t part_no_27031, int64_t dz2084U_27032, int64_t dz2080U_27033, int64_t dz2081U_27034, int64_t dz2082U_27035, int64_t dz2083U_27036, int64_t dz2085U_27037, int64_t dz2086U_27038, int64_t n_new_27039, int8_t clBase_27042, int8_t clBase_27043, double clBase_27044, int64_t clBase_27045, int64_t clBase_27047, double clBase_27050, int64_t clBase_27052, int64_t clProc_27057, int64_t clProc_27058, int64_t clProc_27059, int64_t clProc_27061, int64_t clProc_27062, int64_t current_partition_27076, int64_t new_id_27080)
{
    (void) ctx;
    
    int err = 0;
    struct memblock_device mem_49595;
    
    mem_49595.references = NULL;
    
    struct memblock_device mem_49594;
    
    mem_49594.references = NULL;
    
    struct memblock_device mem_49593;
    
    mem_49593.references = NULL;
    
    struct memblock_device mem_49592;
    
    mem_49592.references = NULL;
    
    struct memblock_device mem_49591;
    
    mem_49591.references = NULL;
    
    struct memblock_device mem_49589;
    
    mem_49589.references = NULL;
    
    struct memblock_device mem_49587;
    
    mem_49587.references = NULL;
    
    struct memblock_device mem_49578;
    
    mem_49578.references = NULL;
    
    struct memblock_device mem_49576;
    
    mem_49576.references = NULL;
    
    struct memblock_device mem_49575;
    
    mem_49575.references = NULL;
    
    struct memblock_device mem_49573;
    
    mem_49573.references = NULL;
    
    struct memblock_device mem_49562;
    
    mem_49562.references = NULL;
    
    struct memblock_device segred_tmp_mem_51120;
    
    segred_tmp_mem_51120.references = NULL;
    
    struct memblock_device mem_49533;
    
    mem_49533.references = NULL;
    
    struct memblock_device mem_49559;
    
    mem_49559.references = NULL;
    
    struct memblock_device ext_mem_49560;
    
    ext_mem_49560.references = NULL;
    
    struct memblock_device mem_49531;
    
    mem_49531.references = NULL;
    
    struct memblock_device mem_49528;
    
    mem_49528.references = NULL;
    
    struct memblock_device mem_49445;
    
    mem_49445.references = NULL;
    
    struct memblock_device mem_49443;
    
    mem_49443.references = NULL;
    
    struct memblock_device mem_49442;
    
    mem_49442.references = NULL;
    
    struct memblock_device mem_49407;
    
    mem_49407.references = NULL;
    
    struct memblock_device mem_49405;
    
    mem_49405.references = NULL;
    
    struct memblock_device mem_49403;
    
    mem_49403.references = NULL;
    
    struct memblock_device incprefixes_mem_50873;
    
    incprefixes_mem_50873.references = NULL;
    
    struct memblock_device aggregates_mem_50871;
    
    aggregates_mem_50871.references = NULL;
    
    struct memblock_device incprefixes_mem_50869;
    
    incprefixes_mem_50869.references = NULL;
    
    struct memblock_device aggregates_mem_50867;
    
    aggregates_mem_50867.references = NULL;
    
    struct memblock_device status_flags_mem_50865;
    
    status_flags_mem_50865.references = NULL;
    
    struct memblock_device mem_49569;
    
    mem_49569.references = NULL;
    
    struct memblock_device mem_49567;
    
    mem_49567.references = NULL;
    
    struct memblock_device mem_49565;
    
    mem_49565.references = NULL;
    
    struct memblock_device incprefixes_mem_50767;
    
    incprefixes_mem_50767.references = NULL;
    
    struct memblock_device aggregates_mem_50765;
    
    aggregates_mem_50765.references = NULL;
    
    struct memblock_device status_flags_mem_50763;
    
    status_flags_mem_50763.references = NULL;
    
    struct memblock_device mem_49519;
    
    mem_49519.references = NULL;
    
    struct memblock_device mem_49517;
    
    mem_49517.references = NULL;
    
    struct memblock_device mem_49472;
    
    mem_49472.references = NULL;
    
    struct memblock_device mem_49471;
    
    mem_49471.references = NULL;
    
    struct memblock_device segred_tmp_mem_50705;
    
    segred_tmp_mem_50705.references = NULL;
    
    struct memblock_device mem_49469;
    
    mem_49469.references = NULL;
    
    struct memblock_device mem_49467;
    
    mem_49467.references = NULL;
    
    struct memblock_device mem_49466;
    
    mem_49466.references = NULL;
    
    struct memblock_device mem_49465;
    
    mem_49465.references = NULL;
    
    struct memblock_device mem_49475;
    
    mem_49475.references = NULL;
    
    struct memblock_device mem_49474;
    
    mem_49474.references = NULL;
    
    struct memblock_device ext_mem_49476;
    
    ext_mem_49476.references = NULL;
    
    struct memblock_device ext_mem_49477;
    
    ext_mem_49477.references = NULL;
    
    struct memblock_device mem_49514;
    
    mem_49514.references = NULL;
    
    struct memblock_device mem_49513;
    
    mem_49513.references = NULL;
    
    struct memblock_device ext_mem_49515;
    
    ext_mem_49515.references = NULL;
    
    struct memblock_device ext_mem_49516;
    
    ext_mem_49516.references = NULL;
    
    struct memblock_device ext_mem_49524;
    
    ext_mem_49524.references = NULL;
    
    struct memblock_device ext_mem_49525;
    
    ext_mem_49525.references = NULL;
    
    struct memblock_device ext_mem_49526;
    
    ext_mem_49526.references = NULL;
    
    struct memblock_device mem_49463;
    
    mem_49463.references = NULL;
    
    struct memblock_device mem_49461;
    
    mem_49461.references = NULL;
    
    struct memblock_device mem_49460;
    
    mem_49460.references = NULL;
    
    struct memblock_device mem_49459;
    
    mem_49459.references = NULL;
    
    struct memblock_device mem_49458;
    
    mem_49458.references = NULL;
    
    struct memblock_device mem_49457;
    
    mem_49457.references = NULL;
    
    struct memblock_device mem_49456;
    
    mem_49456.references = NULL;
    
    struct memblock_device mem_49455;
    
    mem_49455.references = NULL;
    
    struct memblock_device mem_49454;
    
    mem_49454.references = NULL;
    
    struct memblock_device mem_49453;
    
    mem_49453.references = NULL;
    
    struct memblock_device mem_49452;
    
    mem_49452.references = NULL;
    
    struct memblock_device mem_49451;
    
    mem_49451.references = NULL;
    
    struct memblock_device mem_49450;
    
    mem_49450.references = NULL;
    
    struct memblock_device mem_49449;
    
    mem_49449.references = NULL;
    
    struct memblock_device mem_49448;
    
    mem_49448.references = NULL;
    
    struct memblock_device mem_49447;
    
    mem_49447.references = NULL;
    
    struct memblock_device mem_49446;
    
    mem_49446.references = NULL;
    
    struct memblock_device mem_49438;
    
    mem_49438.references = NULL;
    
    struct memblock_device mem_49439;
    
    mem_49439.references = NULL;
    
    struct memblock_device ext_mem_49440;
    
    ext_mem_49440.references = NULL;
    
    struct memblock_device mem_49435;
    
    mem_49435.references = NULL;
    
    struct memblock_device mem_49436;
    
    mem_49436.references = NULL;
    
    struct memblock_device ext_mem_49437;
    
    ext_mem_49437.references = NULL;
    
    struct memblock_device mem_49432;
    
    mem_49432.references = NULL;
    
    struct memblock_device mem_49433;
    
    mem_49433.references = NULL;
    
    struct memblock_device ext_mem_49434;
    
    ext_mem_49434.references = NULL;
    
    struct memblock_device mem_49429;
    
    mem_49429.references = NULL;
    
    struct memblock_device mem_49430;
    
    mem_49430.references = NULL;
    
    struct memblock_device ext_mem_49431;
    
    ext_mem_49431.references = NULL;
    
    struct memblock_device mem_49426;
    
    mem_49426.references = NULL;
    
    struct memblock_device mem_49427;
    
    mem_49427.references = NULL;
    
    struct memblock_device ext_mem_49428;
    
    ext_mem_49428.references = NULL;
    
    struct memblock_device mem_49423;
    
    mem_49423.references = NULL;
    
    struct memblock_device mem_49424;
    
    mem_49424.references = NULL;
    
    struct memblock_device ext_mem_49425;
    
    ext_mem_49425.references = NULL;
    
    struct memblock_device mem_49421;
    
    mem_49421.references = NULL;
    
    struct memblock_device mem_49419;
    
    mem_49419.references = NULL;
    
    struct memblock_device mem_49418;
    
    mem_49418.references = NULL;
    
    struct memblock_device mem_49416;
    
    mem_49416.references = NULL;
    
    struct memblock_device incprefixes_mem_50273;
    
    incprefixes_mem_50273.references = NULL;
    
    struct memblock_device aggregates_mem_50271;
    
    aggregates_mem_50271.references = NULL;
    
    struct memblock_device incprefixes_mem_50269;
    
    incprefixes_mem_50269.references = NULL;
    
    struct memblock_device aggregates_mem_50267;
    
    aggregates_mem_50267.references = NULL;
    
    struct memblock_device status_flags_mem_50245;
    
    status_flags_mem_50245.references = NULL;
    
    struct memblock_device mem_49414;
    
    mem_49414.references = NULL;
    
    struct memblock_device mem_49412;
    
    mem_49412.references = NULL;
    
    struct memblock_device mem_49410;
    
    mem_49410.references = NULL;
    
    struct memblock_device mem_out_50217;
    
    mem_out_50217.references = NULL;
    
    struct memblock_device mem_out_50216;
    
    mem_out_50216.references = NULL;
    
    struct memblock_device mem_out_50215;
    
    mem_out_50215.references = NULL;
    
    struct memblock_device mem_out_50214;
    
    mem_out_50214.references = NULL;
    
    struct memblock_device mem_out_50213;
    
    mem_out_50213.references = NULL;
    
    struct memblock_device mem_out_50212;
    
    mem_out_50212.references = NULL;
    
    struct memblock_device mem_out_50211;
    
    mem_out_50211.references = NULL;
    
    struct memblock_device mem_out_50210;
    
    mem_out_50210.references = NULL;
    
    struct memblock_device mem_out_50209;
    
    mem_out_50209.references = NULL;
    
    struct memblock_device mem_out_50208;
    
    mem_out_50208.references = NULL;
    
    struct memblock_device mem_out_50207;
    
    mem_out_50207.references = NULL;
    
    struct memblock_device mem_out_50206;
    
    mem_out_50206.references = NULL;
    
    struct memblock_device mem_out_50205;
    
    mem_out_50205.references = NULL;
    
    struct memblock_device mem_out_50204;
    
    mem_out_50204.references = NULL;
    
    struct memblock_device mem_out_50203;
    
    mem_out_50203.references = NULL;
    
    struct memblock_device mem_out_50202;
    
    mem_out_50202.references = NULL;
    
    struct memblock_device mem_out_50201;
    
    mem_out_50201.references = NULL;
    
    struct memblock_device mem_out_50200;
    
    mem_out_50200.references = NULL;
    
    struct memblock_device mem_out_50199;
    
    mem_out_50199.references = NULL;
    
    struct memblock_device mem_out_50198;
    
    mem_out_50198.references = NULL;
    
    struct memblock_device mem_out_50197;
    
    mem_out_50197.references = NULL;
    
    struct memblock_device mem_out_50196;
    
    mem_out_50196.references = NULL;
    
    struct memblock_device mem_out_50195;
    
    mem_out_50195.references = NULL;
    
    struct memblock_device mem_out_50194;
    
    mem_out_50194.references = NULL;
    
    struct memblock_device mem_out_50193;
    
    mem_out_50193.references = NULL;
    
    struct memblock_device mem_out_50192;
    
    mem_out_50192.references = NULL;
    
    struct memblock_device mem_out_50191;
    
    mem_out_50191.references = NULL;
    
    struct memblock_device counters_mem_50201 = ctx->constants->counters_mem_50201;
    struct memblock_device counters_mem_50275 = ctx->constants->counters_mem_50275;
    struct memblock_device counters_mem_50707 = ctx->constants->counters_mem_50707;
    struct memblock_device counters_mem_51122 = ctx->constants->counters_mem_51122;
    struct memblock_device counters_mem_51145 = ctx->constants->counters_mem_51145;
    struct memblock_device counters_mem_51184 = ctx->constants->counters_mem_51184;
    struct memblock_device counters_mem_51873 = ctx->constants->counters_mem_51873;
    struct memblock_device counters_mem_52032 = ctx->constants->counters_mem_52032;
    struct memblock_device global_dynid_mem_50266 = ctx->constants->global_dynid_mem_50266;
    struct memblock_device global_dynid_mem_50275 = ctx->constants->global_dynid_mem_50275;
    struct memblock_device global_dynid_mem_50287 = ctx->constants->global_dynid_mem_50287;
    struct memblock_device global_dynid_mem_50292 = ctx->constants->global_dynid_mem_50292;
    struct memblock_device global_dynid_mem_50450 = ctx->constants->global_dynid_mem_50450;
    struct memblock_device global_dynid_mem_50529 = ctx->constants->global_dynid_mem_50529;
    struct memblock_device global_dynid_mem_50570 = ctx->constants->global_dynid_mem_50570;
    struct memblock_device global_dynid_mem_50733 = ctx->constants->global_dynid_mem_50733;
    struct memblock_device global_dynid_mem_50769 = ctx->constants->global_dynid_mem_50769;
    struct memblock_device global_dynid_mem_50871 = ctx->constants->global_dynid_mem_50871;
    struct memblock_device global_dynid_mem_50875 = ctx->constants->global_dynid_mem_50875;
    struct memblock_device global_dynid_mem_50988 = ctx->constants->global_dynid_mem_50988;
    struct memblock_device global_dynid_mem_51231 = ctx->constants->global_dynid_mem_51231;
    struct memblock_device global_dynid_mem_51378 = ctx->constants->global_dynid_mem_51378;
    struct memblock_device global_dynid_mem_51534 = ctx->constants->global_dynid_mem_51534;
    struct memblock_device global_dynid_mem_51651 = ctx->constants->global_dynid_mem_51651;
    int64_t prim_out_50218;
    int64_t prim_out_50219;
    int64_t prim_out_50220;
    int8_t prim_out_50221;
    int8_t prim_out_50222;
    double prim_out_50223;
    int64_t prim_out_50224;
    int64_t prim_out_50225;
    double prim_out_50226;
    int64_t prim_out_50227;
    int64_t prim_out_50228;
    int64_t prim_out_50229;
    int64_t prim_out_50230;
    int64_t prim_out_50231;
    int64_t prim_out_50232;
    int64_t prim_out_50233;
    double zt_res_38807 = 2.0 * clBase_27044;
    int64_t segmap_tblock_sizze_43125;
    
    segmap_tblock_sizze_43125 = *ctx->tuning_params.add_next_partition_doublezisegmap_tblock_sizze_43112;
    
    int64_t segmap_usable_groups_43126 = sdiv_up64((int64_t) 8, segmap_tblock_sizze_43125);
    bool x_38861 = sle64((int64_t) 0, new_id_27080);
    bool y_38862 = slt64(new_id_27080, part_no_27031);
    bool bounds_check_38863 = x_38861 && y_38862;
    bool index_certs_38864;
    
    if (!bounds_check_38863) {
        set_error(ctx, msgprintf("Error: %s%lld%s%lld%s\n\nBacktrace:\n%s", "Index [", (long long) new_id_27080, "] out of bounds for array of shape [", (long long) part_no_27031, "].", "-> #0  ft_libs/ftDBSCAN_plus.fut:283:49-97\n   #1  ft_libs/ftDBSCAN_plus.fut:850:18-855:84\n   #2  ft_libs/ftDBSCAN_plus.fut:849:9-855:84\n"));
        err = FUTHARK_PROGRAM_ERROR;
        goto cleanup;
    }
    
    int64_t bytes_49404 = (int64_t) 8 * n_new_27039;
    bool suff_outer_screma_43138;
    
    suff_outer_screma_43138 = *ctx->tuning_params.add_next_partition_doublezisuff_outer_screma_0 <= (int64_t) 8;
    if (ctx->logging)
        fprintf(ctx->log, "Compared %s <= %ld: %s.\n", "add_next_partition_double.suff_outer_screma_0", (long) (int64_t) 8, suff_outer_screma_43138 ? "true" : "false");
    
    bool suff_outer_par_43639;
    
    suff_outer_par_43639 = *ctx->tuning_params.add_next_partition_doublezisuff_outer_par_1 <= (int64_t) 8;
    if (ctx->logging)
        fprintf(ctx->log, "Compared %s <= %ld: %s.\n", "add_next_partition_double.suff_outer_par_1", (long) (int64_t) 8, suff_outer_par_43639 ? "true" : "false");
    
    int64_t intra_avail_par_43640 = smin64(dz2083U_27036, n_new_27039);
    int64_t computed_tblock_sizze_43641 = smax64(dz2083U_27036, n_new_27039);
    int64_t max_tblock_sizze_43643;
    
    max_tblock_sizze_43643 = ctx->max_thread_block_size;
    
    bool fits_43644 = sle64(computed_tblock_sizze_43641, max_tblock_sizze_43643);
    bool suff_intra_par_43646;
    
    suff_intra_par_43646 = *ctx->tuning_params.add_next_partition_doublezisuff_intra_par_2 <= intra_avail_par_43640;
    if (ctx->logging)
        fprintf(ctx->log, "Compared %s <= %ld: %s.\n", "add_next_partition_double.suff_intra_par_2", (long) intra_avail_par_43640, suff_intra_par_43646 ? "true" : "false");
    
    bool intra_suff_and_fits_43647 = fits_43644 && suff_intra_par_43646;
    int64_t segmap_tblock_sizze_43784;
    
    segmap_tblock_sizze_43784 = *ctx->tuning_params.add_next_partition_doublezisegmap_tblock_sizze_43527;
    
    int64_t segmap_usable_groups_43785 = sdiv_up_safe64((int64_t) 8, segmap_tblock_sizze_43784);
    int64_t nest_sizze_43800 = (int64_t) 8 * dz2083U_27036;
    int64_t segred_tblock_sizze_43801;
    
    segred_tblock_sizze_43801 = *ctx->tuning_params.add_next_partition_doublezisegred_tblock_sizze_43502;
    
    int64_t num_tblocks_43802;
    int64_t max_num_tblocks_50234;
    
    max_num_tblocks_50234 = *ctx->tuning_params.add_next_partition_doublezisegred_num_tblocks_43504;
    num_tblocks_43802 = sext_i64_i32(smax64((int64_t) 1, smin64(sdiv_up64(nest_sizze_43800, segred_tblock_sizze_43801), max_num_tblocks_50234)));
    
    int64_t segmap_tblock_sizze_43821;
    
    segmap_tblock_sizze_43821 = *ctx->tuning_params.add_next_partition_doublezisegmap_tblock_sizze_43450;
    
    int64_t segmap_usable_groups_43822 = sdiv_up_safe64((int64_t) 8, segmap_tblock_sizze_43821);
    int64_t segscan_tblock_sizze_43873;
    
    segscan_tblock_sizze_43873 = *ctx->tuning_params.add_next_partition_doublezisegscan_tblock_sizze_43631;
    
    int64_t num_tblocks_43874;
    int64_t max_num_tblocks_50235;
    
    max_num_tblocks_50235 = *ctx->tuning_params.add_next_partition_doublezisegscan_num_tblocks_43633;
    num_tblocks_43874 = sext_i64_i32(smax64((int64_t) 1, smin64(sdiv_up64((int64_t) 8, segscan_tblock_sizze_43873), max_num_tblocks_50235)));
    
    int64_t segscan_tblock_sizze_43148;
    
    segscan_tblock_sizze_43148 = *ctx->tuning_params.add_next_partition_doublezisegscan_tblock_sizze_43140;
    
    int64_t num_tblocks_43149;
    int64_t max_num_tblocks_50236;
    
    max_num_tblocks_50236 = *ctx->tuning_params.add_next_partition_doublezisegscan_num_tblocks_43142;
    num_tblocks_43149 = sext_i64_i32(smax64((int64_t) 1, smin64(sdiv_up64((int64_t) 8, segscan_tblock_sizze_43148), max_num_tblocks_50236)));
    
    int64_t tile_sizze_46537;
    
    tile_sizze_46537 = *ctx->tuning_params.add_next_partition_doublezitile_sizze_46536;
    
    int64_t ldim_46538 = sdiv_up_safe64((int64_t) 8, tile_sizze_46537);
    int64_t num_whole_tiles_46568 = squot_safe64(dz2083U_27036, tile_sizze_46537);
    int64_t residual_input_46669 = srem_safe64(dz2083U_27036, tile_sizze_46537);
    bool cond_46670 = residual_input_46669 == (int64_t) 0;
    int64_t binop_x_46680 = tile_sizze_46537 * num_whole_tiles_46568;
    int64_t segscan_tblock_sizze_44179;
    
    segscan_tblock_sizze_44179 = *ctx->tuning_params.add_next_partition_doublezisegscan_tblock_sizze_44178;
    
    int64_t num_tblocks_44181;
    int64_t max_num_tblocks_50237;
    
    max_num_tblocks_50237 = *ctx->tuning_params.add_next_partition_doublezisegscan_num_tblocks_44180;
    num_tblocks_44181 = sext_i64_i32(smax64((int64_t) 1, smin64(sdiv_up64(n_old_27030, segscan_tblock_sizze_44179), max_num_tblocks_50237)));
    
    int64_t bytes_49409 = (int64_t) 8 * n_old_27030;
    
    if (memblock_alloc_device(ctx, &mem_49410, bytes_49409, "mem_49410")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_49412, bytes_49409, "mem_49412")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_49414, bytes_49409, "mem_49414")) {
        err = 1;
        goto cleanup;
    }
    if (slt64((int64_t) 0, n_old_27030)) {
        if (ctx->debugging)
            fprintf(ctx->log, "%s\n", "\n# SegScan");
        
        int64_t shared_memory_50238;
        
        shared_memory_50238 = ctx->max_shared_memory;
        
        int64_t thread_block_sizze_50239;
        
        thread_block_sizze_50239 = ctx->max_thread_block_size;
        
        int64_t registers_50240;
        
        registers_50240 = ctx->max_registers;
        
        int64_t thread_block_sizze_50241;
        
        thread_block_sizze_50241 = ctx->max_thread_block_size;
        
        int64_t chunk_sizze_50242 = smax64((int64_t) 1, smin64(squot64(squot64(shared_memory_50238, thread_block_sizze_50239), (int64_t) 8), squot64(squot64(registers_50240, thread_block_sizze_50241) - (int64_t) 1 - squot64(smax64((int64_t) 4, (int64_t) 8) + smax64((int64_t) 4, (int64_t) 8), (int64_t) 4), (int64_t) 2 * squot64(smax64((int64_t) 4, (int64_t) 8) + smax64((int64_t) 4, (int64_t) 8), (int64_t) 4))));
        int64_t num_virt_blocks_50243 = sdiv_up64(n_old_27030, segscan_tblock_sizze_44179 * chunk_sizze_50242);
        int64_t num_virt_threads_50244 = num_virt_blocks_50243 * segscan_tblock_sizze_44179;
        
        if (ctx->debugging)
            fprintf(ctx->log, "%s: %llu%c", "Sequential elements per thread (chunk)", (long long) chunk_sizze_50242, '\n');
        if (memblock_alloc_device(ctx, &status_flags_mem_50245, num_virt_blocks_50243, "status_flags_mem_50245")) {
            err = 1;
            goto cleanup;
        }
        if (futrts_builtinzhreplicate_i8(ctx, status_flags_mem_50245, num_virt_blocks_50243, (int8_t) 0) != 0) {
            err = 1;
            goto cleanup;
        }
        if (memblock_alloc_device(ctx, &aggregates_mem_50267, (int64_t) 8 * num_virt_blocks_50243, "aggregates_mem_50267")) {
            err = 1;
            goto cleanup;
        }
        if (memblock_alloc_device(ctx, &incprefixes_mem_50269, (int64_t) 8 * num_virt_blocks_50243, "incprefixes_mem_50269")) {
            err = 1;
            goto cleanup;
        }
        if (memblock_alloc_device(ctx, &aggregates_mem_50271, (int64_t) 8 * num_virt_blocks_50243, "aggregates_mem_50271")) {
            err = 1;
            goto cleanup;
        }
        if (memblock_alloc_device(ctx, &incprefixes_mem_50273, (int64_t) 8 * num_virt_blocks_50243, "incprefixes_mem_50273")) {
            err = 1;
            goto cleanup;
        }
        {
            err = gpu_kernel_add_next_partition_doublezisegscan_44184(ctx, num_tblocks_44181, 1, 1, *ctx->tuning_params.add_next_partition_doublezisegscan_tblock_sizze_44178, 1, 1, smax64(smax64((int64_t) 544, sdiv_up64((int64_t) 8 * segscan_tblock_sizze_44179, (int64_t) 8) * (int64_t) 8 + (int64_t) 8 * segscan_tblock_sizze_44179), smax64(chunk_sizze_50242 * segscan_tblock_sizze_44179 * (int64_t) 8, chunk_sizze_50242 * segscan_tblock_sizze_44179 * (int64_t) 8)) + srem64((int64_t) 8 - srem64(smax64(smax64((int64_t) 544, sdiv_up64((int64_t) 8 * segscan_tblock_sizze_44179, (int64_t) 8) * (int64_t) 8 + (int64_t) 8 * segscan_tblock_sizze_44179), smax64(chunk_sizze_50242 * segscan_tblock_sizze_44179 * (int64_t) 8, chunk_sizze_50242 * segscan_tblock_sizze_44179 * (int64_t) 8)), (int64_t) 8), (int64_t) 8), n_old_27030, num_tblocks_44181, num_virt_blocks_50243, num_virt_threads_50244, current_partition_mem_49392.mem, mem_49410.mem, mem_49412.mem, mem_49414.mem, status_flags_mem_50245.mem, aggregates_mem_50267.mem, incprefixes_mem_50269.mem, aggregates_mem_50271.mem, incprefixes_mem_50273.mem, global_dynid_mem_50275.mem);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        if (ctx->debugging)
            fprintf(ctx->log, "%s\n", "");
    }
    
    int64_t last_index_39114 = n_old_27030 - (int64_t) 1;
    bool is_empty_39115 = n_old_27030 == (int64_t) 0;
    bool x_39116 = !is_empty_39115;
    int64_t last_offset_39117;
    
    if (x_39116) {
        int64_t read_res_52127;
        
        if ((err = gpu_scalar_from_device(ctx, &read_res_52127, mem_49410.mem, last_index_39114 * sizeof(int64_t), sizeof(int64_t))) != 0)
            goto cleanup;
        if (ctx->failure_is_an_option && futhark_context_sync(ctx) != 0) {
            err = 1;
            goto cleanup;
        }
        
        int64_t x_42712 = read_res_52127;
        
        last_offset_39117 = x_42712;
    } else {
        last_offset_39117 = (int64_t) 0;
    }
    
    int64_t partition_sizze_39119;
    
    if (is_empty_39115) {
        partition_sizze_39119 = (int64_t) 0;
    } else {
        partition_sizze_39119 = last_offset_39117;
    }
    if (memblock_alloc_device(ctx, &mem_49416, bytes_49409, "mem_49416")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_49418, bytes_49409, "mem_49418")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_49419, n_old_27030, "mem_49419")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_49421, bytes_49409, "mem_49421")) {
        err = 1;
        goto cleanup;
    }
    
    int64_t y_39124 = (int64_t) -1 + partition_sizze_39119;
    int64_t segmap_tblock_sizze_44189;
    
    segmap_tblock_sizze_44189 = *ctx->tuning_params.add_next_partition_doublezisegmap_tblock_sizze_44188;
    
    int64_t num_tblocks_44191;
    int64_t max_num_tblocks_50430;
    
    max_num_tblocks_50430 = *ctx->tuning_params.add_next_partition_doublezisegmap_num_tblocks_44190;
    num_tblocks_44191 = sext_i64_i32(smax64((int64_t) 1, smin64(sdiv_up64(n_old_27030, segmap_tblock_sizze_44189), max_num_tblocks_50430)));
    if (ctx->debugging)
        fprintf(ctx->log, "%s\n", "\n# SegMap");
    
    int32_t virt_num_tblocks_50431 = sext_i64_i32(sdiv_up64(n_old_27030, segmap_tblock_sizze_44189));
    
    {
        err = gpu_kernel_add_next_partition_doublezisegmap_44186(ctx, num_tblocks_44191, 1, 1, *ctx->tuning_params.add_next_partition_doublezisegmap_tblock_sizze_44188, 1, 1, (int64_t) 0, n_old_27030, y_39124, num_tblocks_44191, virt_num_tblocks_50431, current_partition_mem_49386.mem, current_partition_mem_49387.mem, current_partition_mem_49388.mem, current_partition_mem_49391.mem, mem_49410.mem, mem_49412.mem, mem_49414.mem, mem_49416.mem, mem_49418.mem, mem_49419.mem, mem_49421.mem);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (ctx->debugging)
        fprintf(ctx->log, "%s\n", "");
    if (memblock_unref_device(ctx, &mem_49410, "mem_49410") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_49412, "mem_49412") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_49414, "mem_49414") != 0)
        return 1;
    
    bool eq_x_zz_39142 = (int64_t) 0 == last_offset_39117;
    bool p_and_eq_x_y_39143 = x_39116 && eq_x_zz_39142;
    bool empty_slice_39144 = is_empty_39115 || p_and_eq_x_y_39143;
    int64_t m_39145 = sub64(partition_sizze_39119, (int64_t) 1);
    bool zzero_leq_i_p_m_t_s_39146 = sle64((int64_t) 0, m_39145);
    bool i_p_m_t_s_leq_w_39147 = slt64(m_39145, n_old_27030);
    bool i_lte_j_39148 = sle64((int64_t) 0, partition_sizze_39119);
    bool y_39149 = zzero_leq_i_p_m_t_s_39146 && i_p_m_t_s_leq_w_39147;
    bool forwards_ok_39150 = i_lte_j_39148 && y_39149;
    bool ok_or_empty_39151 = empty_slice_39144 || forwards_ok_39150;
    bool index_certs_39152;
    
    if (!ok_or_empty_39151) {
        set_error(ctx, msgprintf("Error: %s%lld%s%lld%s%lld%s\n\nBacktrace:\n%s", "Index [", (long long) (int64_t) 0, ":", (long long) partition_sizze_39119, "] out of bounds for array of shape [", (long long) n_old_27030, "].", "-> #0  /prelude/soacs.fut:174:7-19\n   #1  /prelude/functional.fut:9:44-45\n   #2  ft_libs/ftDBSCAN_plus.fut:850:18-855:84\n   #3  ft_libs/ftDBSCAN_plus.fut:849:9-855:84\n"));
        err = FUTHARK_PROGRAM_ERROR;
        goto cleanup;
    }
    
    int64_t j_m_i_39153 = sub64(n_old_27030, partition_sizze_39119);
    bool empty_slice_39154 = j_m_i_39153 == (int64_t) 0;
    int64_t m_39155 = sub64(j_m_i_39153, (int64_t) 1);
    int64_t i_p_m_t_s_39156 = add64(partition_sizze_39119, m_39155);
    bool zzero_leq_i_p_m_t_s_39157 = sle64((int64_t) 0, i_p_m_t_s_39156);
    bool i_p_m_t_s_leq_w_39158 = slt64(i_p_m_t_s_39156, n_old_27030);
    bool i_lte_j_39159 = sle64(partition_sizze_39119, n_old_27030);
    bool y_39160 = zzero_leq_i_p_m_t_s_39157 && i_p_m_t_s_leq_w_39158;
    bool forwards_ok_39161 = i_lte_j_39159 && y_39160;
    bool ok_or_empty_39162 = empty_slice_39154 || forwards_ok_39161;
    bool index_certs_39163;
    
    if (!ok_or_empty_39162) {
        set_error(ctx, msgprintf("Error: %s%lld%s%lld%s%lld%s\n\nBacktrace:\n%s", "Index [", (long long) partition_sizze_39119, ":", (long long) n_old_27030, "] out of bounds for array of shape [", (long long) n_old_27030, "].", "-> #0  /prelude/soacs.fut:174:21-33\n   #1  /prelude/functional.fut:9:44-45\n   #2  ft_libs/ftDBSCAN_plus.fut:850:18-855:84\n   #3  ft_libs/ftDBSCAN_plus.fut:849:9-855:84\n"));
        err = FUTHARK_PROGRAM_ERROR;
        goto cleanup;
    }
    
    int64_t dzlz7bUZLzpZRz20Udz2082Uz20Udz2084Uz2088Uz2084Uz7dUzg_39167 = add64(dz2082U_27035, partition_sizze_39119);
    bool cond_39171 = slt64((int64_t) 0, dz2083U_27036);
    bool loop_not_taken_39175 = !cond_39171;
    
    if (cond_39171) {
        if (memblock_alloc_device(ctx, &mem_49424, (int64_t) 8, "mem_49424")) {
            err = 1;
            goto cleanup;
        }
        {
            err = gpu_kernel_add_next_partition_doublezigpuseq_50444(ctx, (int64_t) 1, 1, 1, (int64_t) 1, 1, 1, (int64_t) 0, clBase_mem_49379.mem, mem_49424.mem);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        if (memblock_set_device(ctx, &ext_mem_49425, &mem_49424, "mem_49424") != 0)
            return 1;
    } else {
        if (memblock_alloc_device(ctx, &mem_49423, (int64_t) 8, "mem_49423")) {
            err = 1;
            goto cleanup;
        }
        if (futrts_builtinzhreplicate_f64(ctx, mem_49423, (int64_t) 1, 0.0) != 0) {
            err = 1;
            goto cleanup;
        }
        if (memblock_set_device(ctx, &ext_mem_49425, &mem_49423, "mem_49423") != 0)
            return 1;
    }
    if (cond_39171) {
        if (memblock_alloc_device(ctx, &mem_49427, (int64_t) 8, "mem_49427")) {
            err = 1;
            goto cleanup;
        }
        {
            err = gpu_kernel_add_next_partition_doublezigpuseq_50470(ctx, (int64_t) 1, 1, 1, (int64_t) 1, 1, 1, (int64_t) 0, clBase_mem_49377.mem, mem_49427.mem);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        if (memblock_set_device(ctx, &ext_mem_49428, &mem_49427, "mem_49427") != 0)
            return 1;
    } else {
        if (memblock_alloc_device(ctx, &mem_49426, (int64_t) 8, "mem_49426")) {
            err = 1;
            goto cleanup;
        }
        if (futrts_builtinzhreplicate_f64(ctx, mem_49426, (int64_t) 1, 0.0) != 0) {
            err = 1;
            goto cleanup;
        }
        if (memblock_set_device(ctx, &ext_mem_49428, &mem_49426, "mem_49426") != 0)
            return 1;
    }
    if (cond_39171) {
        if (memblock_alloc_device(ctx, &mem_49430, (int64_t) 8, "mem_49430")) {
            err = 1;
            goto cleanup;
        }
        {
            err = gpu_kernel_add_next_partition_doublezigpuseq_50476(ctx, (int64_t) 1, 1, 1, (int64_t) 1, 1, 1, (int64_t) 0, clBase_mem_49379.mem, mem_49430.mem);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        if (memblock_set_device(ctx, &ext_mem_49431, &mem_49430, "mem_49430") != 0)
            return 1;
    } else {
        if (memblock_alloc_device(ctx, &mem_49429, (int64_t) 8, "mem_49429")) {
            err = 1;
            goto cleanup;
        }
        if (futrts_builtinzhreplicate_f64(ctx, mem_49429, (int64_t) 1, 0.0) != 0) {
            err = 1;
            goto cleanup;
        }
        if (memblock_set_device(ctx, &ext_mem_49431, &mem_49429, "mem_49429") != 0)
            return 1;
    }
    if (cond_39171) {
        if (memblock_alloc_device(ctx, &mem_49433, (int64_t) 8, "mem_49433")) {
            err = 1;
            goto cleanup;
        }
        {
            err = gpu_kernel_add_next_partition_doublezigpuseq_50482(ctx, (int64_t) 1, 1, 1, (int64_t) 1, 1, 1, (int64_t) 0, clBase_mem_49377.mem, mem_49433.mem);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        if (memblock_set_device(ctx, &ext_mem_49434, &mem_49433, "mem_49433") != 0)
            return 1;
    } else {
        if (memblock_alloc_device(ctx, &mem_49432, (int64_t) 8, "mem_49432")) {
            err = 1;
            goto cleanup;
        }
        if (futrts_builtinzhreplicate_f64(ctx, mem_49432, (int64_t) 1, 0.0) != 0) {
            err = 1;
            goto cleanup;
        }
        if (memblock_set_device(ctx, &ext_mem_49434, &mem_49432, "mem_49432") != 0)
            return 1;
    }
    if (cond_39171) {
        if (memblock_alloc_device(ctx, &mem_49436, (int64_t) 8, "mem_49436")) {
            err = 1;
            goto cleanup;
        }
        {
            err = gpu_kernel_add_next_partition_doublezigpuseq_50488(ctx, (int64_t) 1, 1, 1, (int64_t) 1, 1, 1, (int64_t) 0, clBase_mem_49379.mem, mem_49436.mem);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        if (memblock_set_device(ctx, &ext_mem_49437, &mem_49436, "mem_49436") != 0)
            return 1;
    } else {
        if (memblock_alloc_device(ctx, &mem_49435, (int64_t) 8, "mem_49435")) {
            err = 1;
            goto cleanup;
        }
        if (futrts_builtinzhreplicate_f64(ctx, mem_49435, (int64_t) 1, 0.0) != 0) {
            err = 1;
            goto cleanup;
        }
        if (memblock_set_device(ctx, &ext_mem_49437, &mem_49435, "mem_49435") != 0)
            return 1;
    }
    if (cond_39171) {
        if (memblock_alloc_device(ctx, &mem_49439, (int64_t) 8, "mem_49439")) {
            err = 1;
            goto cleanup;
        }
        {
            err = gpu_kernel_add_next_partition_doublezigpuseq_50494(ctx, (int64_t) 1, 1, 1, (int64_t) 1, 1, 1, (int64_t) 0, clBase_mem_49379.mem, mem_49439.mem);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        if (memblock_set_device(ctx, &ext_mem_49440, &mem_49439, "mem_49439") != 0)
            return 1;
    } else {
        if (memblock_alloc_device(ctx, &mem_49438, (int64_t) 8, "mem_49438")) {
            err = 1;
            goto cleanup;
        }
        if (futrts_builtinzhreplicate_f64(ctx, mem_49438, (int64_t) 1, 0.0) != 0) {
            err = 1;
            goto cleanup;
        }
        if (memblock_set_device(ctx, &ext_mem_49440, &mem_49438, "mem_49438") != 0)
            return 1;
    }
    
    int64_t segscan_tblock_sizze_44195;
    
    segscan_tblock_sizze_44195 = *ctx->tuning_params.add_next_partition_doublezisegscan_tblock_sizze_44194;
    
    int64_t num_tblocks_44197;
    int64_t max_num_tblocks_50500;
    
    max_num_tblocks_50500 = *ctx->tuning_params.add_next_partition_doublezisegscan_num_tblocks_44196;
    num_tblocks_44197 = sext_i64_i32(smax64((int64_t) 1, smin64(sdiv_up64(dzlz7bUZLzpZRz20Udz2082Uz20Udz2084Uz2088Uz2084Uz7dUzg_39167, segscan_tblock_sizze_44195), max_num_tblocks_50500)));
    
    int64_t last_index_39269 = dzlz7bUZLzpZRz20Udz2082Uz20Udz2084Uz2088Uz2084Uz7dUzg_39167 - (int64_t) 1;
    bool is_empty_39270 = dzlz7bUZLzpZRz20Udz2082Uz20Udz2084Uz2088Uz2084Uz7dUzg_39167 == (int64_t) 0;
    bool x_39271 = !is_empty_39270;
    int64_t bytes_49441 = (int64_t) 8 * dzlz7bUZLzpZRz20Udz2082Uz20Udz2084Uz2088Uz2084Uz7dUzg_39167;
    
    if (memblock_alloc_device(ctx, &mem_49446, (int64_t) 64, "mem_49446")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_49447, (int64_t) 16, "mem_49447")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_49448, (int64_t) 16, "mem_49448")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_49449, (int64_t) 8, "mem_49449")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_49450, (int64_t) 64, "mem_49450")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_49451, (int64_t) 1, "mem_49451")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_49452, (int64_t) 8, "mem_49452")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_49453, (int64_t) 1, "mem_49453")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_49454, (int64_t) 8, "mem_49454")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_49455, (int64_t) 1, "mem_49455")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_49456, (int64_t) 8, "mem_49456")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_49457, (int64_t) 1, "mem_49457")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_49458, (int64_t) 8, "mem_49458")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_49459, (int64_t) 0, "mem_49459")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_49460, (int64_t) 16, "mem_49460")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_49461, (int64_t) 16, "mem_49461")) {
        err = 1;
        goto cleanup;
    }
    {
        err = gpu_kernel_add_next_partition_doublezigpuseq_50501(ctx, (int64_t) 1, 1, 1, (int64_t) 1, 1, 1, (int64_t) 0, new_id_27080, loop_not_taken_39175, clBase_mem_49377.mem, clBase_mem_49378.mem, clBase_mem_49379.mem, mem_49446.mem, mem_49447.mem, mem_49448.mem, mem_49449.mem, mem_49450.mem, mem_49451.mem, mem_49452.mem, mem_49453.mem, mem_49454.mem, mem_49455.mem, mem_49456.mem, mem_49457.mem, mem_49458.mem, mem_49459.mem, mem_49460.mem, mem_49461.mem);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    ctx->failure_is_an_option = 1;
    if (memblock_unref_device(ctx, &mem_49446, "mem_49446") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_49447, "mem_49447") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_49448, "mem_49448") != 0)
        return 1;
    if (memblock_alloc_device(ctx, &mem_49463, (int64_t) 8, "mem_49463")) {
        err = 1;
        goto cleanup;
    }
    if (ctx->debugging)
        fprintf(ctx->log, "%s\n", "\n# SegMap");
    
    int32_t virt_num_tblocks_50507 = sext_i64_i32(sdiv_up64((int64_t) 8, segmap_tblock_sizze_43125));
    
    {
        err = gpu_kernel_add_next_partition_doublezisegmap_43129(ctx, segmap_usable_groups_43126, 1, 1, *ctx->tuning_params.add_next_partition_doublezisegmap_tblock_sizze_43112, 1, 1, (int64_t) 0, part_no_27031, clProc_mem_49384.mem, mem_49450.mem, mem_49463.mem);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    ctx->failure_is_an_option = 1;
    if (ctx->debugging)
        fprintf(ctx->log, "%s\n", "");
    
    int64_t bytes_49493 = (int64_t) 8 * tile_sizze_46537;
    int64_t shared_memory_capacity_50755;
    
    shared_memory_capacity_50755 = ctx->max_shared_memory;
    if (suff_outer_par_43639 && sle64(sdiv_up64(bytes_49493, (int64_t) 8) * (int64_t) 8, shared_memory_capacity_50755)) {
        if (memblock_alloc_device(ctx, &mem_49513, (int64_t) 64, "mem_49513")) {
            err = 1;
            goto cleanup;
        }
        if (memblock_alloc_device(ctx, &mem_49514, (int64_t) 64, "mem_49514")) {
            err = 1;
            goto cleanup;
        }
        if (ctx->debugging)
            fprintf(ctx->log, "%s\n", "\n# SegMap");
        
        int32_t num_chunks_50620 = sext_i64_i32(sdiv_up64(tile_sizze_46537, tile_sizze_46537));
        int32_t virt_num_tblocks_50621 = sext_i64_i32(ldim_46538);
        
        {
            err = gpu_kernel_add_next_partition_doublezisegmap_intrablock_46535(ctx, ldim_46538, 1, 1, *ctx->tuning_params.add_next_partition_doublezitile_sizze_46536, 1, 1, bytes_49493 + srem64((int64_t) 8 - srem64(bytes_49493, (int64_t) 8), (int64_t) 8), dz2083U_27036, n_new_27039, clBase_27044, num_whole_tiles_46568, residual_input_46669, cond_46670, binop_x_46680, clBase_mem_49377.mem, clBase_mem_49378.mem, clBase_mem_49379.mem, clProc_mem_49385.mem, new_xs_mem_49401.mem, new_ys_mem_49402.mem, mem_49450.mem, mem_49463.mem, mem_49513.mem, mem_49514.mem);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        ctx->failure_is_an_option = 1;
        if (ctx->debugging)
            fprintf(ctx->log, "%s\n", "");
        if (memblock_set_device(ctx, &ext_mem_49516, &mem_49513, "mem_49513") != 0)
            return 1;
        if (memblock_set_device(ctx, &ext_mem_49515, &mem_49514, "mem_49514") != 0)
            return 1;
    } else {
        int64_t shared_memory_capacity_50754;
        
        shared_memory_capacity_50754 = ctx->max_shared_memory;
        if (intra_suff_and_fits_43647 && sle64(sdiv_up64(dz2083U_27036, (int64_t) 8) * (int64_t) 8 + sdiv_up64(n_new_27039, (int64_t) 8) * (int64_t) 8, shared_memory_capacity_50754)) {
            if (memblock_alloc_device(ctx, &mem_49474, (int64_t) 64, "mem_49474")) {
                err = 1;
                goto cleanup;
            }
            if (memblock_alloc_device(ctx, &mem_49475, (int64_t) 64, "mem_49475")) {
                err = 1;
                goto cleanup;
            }
            if (ctx->debugging)
                fprintf(ctx->log, "%s\n", "\n# SegMap");
            
            int32_t num_chunks_50639 = sext_i64_i32(sdiv_up64(dz2083U_27036, computed_tblock_sizze_43641));
            int32_t num_chunks_50640 = sext_i64_i32(sdiv_up64(n_new_27039, computed_tblock_sizze_43641));
            int32_t virt_num_tblocks_50641 = 8;
            
            {
                err = gpu_kernel_add_next_partition_doublezisegmap_intrablock_43720(ctx, (int64_t) 8, 1, 1, computed_tblock_sizze_43641, 1, 1, n_new_27039 + srem64((int64_t) 8 - srem64(n_new_27039, (int64_t) 8), (int64_t) 8) + (dz2083U_27036 + srem64((int64_t) 8 - srem64(dz2083U_27036, (int64_t) 8), (int64_t) 8)), dz2083U_27036, n_new_27039, clBase_27044, computed_tblock_sizze_43641, clBase_mem_49377.mem, clBase_mem_49378.mem, clBase_mem_49379.mem, clProc_mem_49385.mem, new_xs_mem_49401.mem, new_ys_mem_49402.mem, mem_49450.mem, mem_49463.mem, mem_49474.mem, mem_49475.mem);
                if (err != FUTHARK_SUCCESS)
                    goto cleanup;
            }
            ctx->failure_is_an_option = 1;
            if (ctx->debugging)
                fprintf(ctx->log, "%s\n", "");
            if (memblock_set_device(ctx, &ext_mem_49477, &mem_49474, "mem_49474") != 0)
                return 1;
            if (memblock_set_device(ctx, &ext_mem_49476, &mem_49475, "mem_49475") != 0)
                return 1;
        } else {
            if (memblock_alloc_device(ctx, &mem_49465, (int64_t) 8, "mem_49465")) {
                err = 1;
                goto cleanup;
            }
            if (memblock_alloc_device(ctx, &mem_49466, (int64_t) 8, "mem_49466")) {
                err = 1;
                goto cleanup;
            }
            if (memblock_alloc_device(ctx, &mem_49467, (int64_t) 64, "mem_49467")) {
                err = 1;
                goto cleanup;
            }
            if (ctx->debugging)
                fprintf(ctx->log, "%s\n", "\n# SegMap");
            
            int32_t virt_num_tblocks_50663 = sext_i64_i32(sdiv_up64((int64_t) 8, segmap_tblock_sizze_43784));
            
            {
                err = gpu_kernel_add_next_partition_doublezisegmap_43790(ctx, segmap_usable_groups_43785, 1, 1, *ctx->tuning_params.add_next_partition_doublezisegmap_tblock_sizze_43527, 1, 1, (int64_t) 0, mem_49450.mem, mem_49463.mem, mem_49465.mem, mem_49466.mem, mem_49467.mem);
                if (err != FUTHARK_SUCCESS)
                    goto cleanup;
            }
            ctx->failure_is_an_option = 1;
            if (ctx->debugging)
                fprintf(ctx->log, "%s\n", "");
            if (memblock_alloc_device(ctx, &mem_49469, (int64_t) 8, "mem_49469")) {
                err = 1;
                goto cleanup;
            }
            if (ctx->debugging)
                fprintf(ctx->log, "%s\n", "\n# SegRed");
            
            int64_t chunk_sizze_50672 = (int64_t) 1;
            
            if (slt64(dz2083U_27036 * (int64_t) 2, segred_tblock_sizze_43801 * chunk_sizze_50672)) {
                int64_t segment_sizze_nonzzero_50673 = smax64((int64_t) 1, dz2083U_27036);
                int64_t num_threads_50674 = segred_tblock_sizze_43801 * segred_tblock_sizze_43801;
                
                if (ctx->debugging)
                    fprintf(ctx->log, "%s\n", "# SegRed-small");
                if (ctx->debugging)
                    fprintf(ctx->log, "%s: %llu%c", "num_segments", (long long) (int64_t) 8, '\n');
                if (ctx->debugging)
                    fprintf(ctx->log, "%s: %llu%c", "segment_size", (long long) dz2083U_27036, '\n');
                if (ctx->debugging)
                    fprintf(ctx->log, "%s: %llu%c", "segments_per_block", (long long) squot64(segred_tblock_sizze_43801, segment_sizze_nonzzero_50673), '\n');
                if (ctx->debugging)
                    fprintf(ctx->log, "%s: %llu%c", "required_blocks", (long long) sext_i64_i32(sdiv_up64((int64_t) 8, squot64(segred_tblock_sizze_43801, segment_sizze_nonzzero_50673))), '\n');
                {
                    err = gpu_kernel_add_next_partition_doublezisegred_small_43807(ctx, num_tblocks_43802, 1, 1, *ctx->tuning_params.add_next_partition_doublezisegred_tblock_sizze_43502, 1, 1, segred_tblock_sizze_43801 + srem64((int64_t) 8 - srem64(segred_tblock_sizze_43801, (int64_t) 8), (int64_t) 8), dz2083U_27036, num_tblocks_43802, segment_sizze_nonzzero_50673, clProc_mem_49385.mem, mem_49450.mem, mem_49465.mem, mem_49466.mem, mem_49469.mem);
                    if (err != FUTHARK_SUCCESS)
                        goto cleanup;
                }
            } else {
                int64_t blocks_per_segment_50701 = sdiv_up64(num_tblocks_43802, smax64((int64_t) 1, (int64_t) 8));
                int64_t q_50702 = sdiv_up64(dz2083U_27036, segred_tblock_sizze_43801 * blocks_per_segment_50701 * chunk_sizze_50672);
                int64_t num_virtblocks_50703 = blocks_per_segment_50701 * (int64_t) 8;
                int64_t threads_per_segment_50704 = blocks_per_segment_50701 * segred_tblock_sizze_43801;
                
                if (ctx->debugging)
                    fprintf(ctx->log, "%s\n", "# SegRed-large");
                if (ctx->debugging)
                    fprintf(ctx->log, "%s: %llu%c", "num_segments", (long long) (int64_t) 8, '\n');
                if (ctx->debugging)
                    fprintf(ctx->log, "%s: %llu%c", "segment_size", (long long) dz2083U_27036, '\n');
                if (ctx->debugging)
                    fprintf(ctx->log, "%s: %llu%c", "num_virtblocks", (long long) num_virtblocks_50703, '\n');
                if (ctx->debugging)
                    fprintf(ctx->log, "%s: %llu%c", "num_tblocks", (long long) num_tblocks_43802, '\n');
                if (ctx->debugging)
                    fprintf(ctx->log, "%s: %llu%c", "tblock_size", (long long) segred_tblock_sizze_43801, '\n');
                if (ctx->debugging)
                    fprintf(ctx->log, "%s: %llu%c", "q", (long long) q_50702, '\n');
                if (ctx->debugging)
                    fprintf(ctx->log, "%s: %llu%c", "blocks_per_segment", (long long) blocks_per_segment_50701, '\n');
                if (memblock_alloc_device(ctx, &segred_tmp_mem_50705, num_virtblocks_50703, "segred_tmp_mem_50705")) {
                    err = 1;
                    goto cleanup;
                }
                {
                    err = gpu_kernel_add_next_partition_doublezisegred_large_43807(ctx, num_tblocks_43802, 1, 1, *ctx->tuning_params.add_next_partition_doublezisegred_tblock_sizze_43502, 1, 1, 8 + (segred_tblock_sizze_43801 + srem64((int64_t) 8 - srem64(segred_tblock_sizze_43801, (int64_t) 8), (int64_t) 8)), dz2083U_27036, num_tblocks_43802, blocks_per_segment_50701, q_50702, num_virtblocks_50703, threads_per_segment_50704, clProc_mem_49385.mem, mem_49450.mem, mem_49465.mem, mem_49466.mem, mem_49469.mem, segred_tmp_mem_50705.mem, counters_mem_50707.mem);
                    if (err != FUTHARK_SUCCESS)
                        goto cleanup;
                }
            }
            if (ctx->debugging)
                fprintf(ctx->log, "%s\n", "");
            if (memblock_unref_device(ctx, &mem_49465, "mem_49465") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_49466, "mem_49466") != 0)
                return 1;
            if (memblock_alloc_device(ctx, &mem_49471, (int64_t) 64, "mem_49471")) {
                err = 1;
                goto cleanup;
            }
            if (memblock_alloc_device(ctx, &mem_49472, (int64_t) 64, "mem_49472")) {
                err = 1;
                goto cleanup;
            }
            if (ctx->debugging)
                fprintf(ctx->log, "%s\n", "\n# SegMap");
            
            int32_t virt_num_tblocks_50744 = sext_i64_i32(sdiv_up64((int64_t) 8, segmap_tblock_sizze_43821));
            
            {
                err = gpu_kernel_add_next_partition_doublezisegmap_43826(ctx, segmap_usable_groups_43822, 1, 1, *ctx->tuning_params.add_next_partition_doublezisegmap_tblock_sizze_43450, 1, 1, (int64_t) 0, n_new_27039, clBase_27044, clBase_mem_49377.mem, clBase_mem_49378.mem, clBase_mem_49379.mem, new_xs_mem_49401.mem, new_ys_mem_49402.mem, mem_49467.mem, mem_49469.mem, mem_49471.mem, mem_49472.mem);
                if (err != FUTHARK_SUCCESS)
                    goto cleanup;
            }
            ctx->failure_is_an_option = 1;
            if (ctx->debugging)
                fprintf(ctx->log, "%s\n", "");
            if (memblock_unref_device(ctx, &mem_49467, "mem_49467") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_49469, "mem_49469") != 0)
                return 1;
            if (memblock_set_device(ctx, &ext_mem_49477, &mem_49471, "mem_49471") != 0)
                return 1;
            if (memblock_set_device(ctx, &ext_mem_49476, &mem_49472, "mem_49472") != 0)
                return 1;
        }
        if (memblock_set_device(ctx, &ext_mem_49516, &ext_mem_49477, "ext_mem_49477") != 0)
            return 1;
        if (memblock_set_device(ctx, &ext_mem_49515, &ext_mem_49476, "ext_mem_49476") != 0)
            return 1;
    }
    if (memblock_alloc_device(ctx, &mem_49517, (int64_t) 64, "mem_49517")) {
        err = 1;
        goto cleanup;
    }
    if ((err = lmad_copy_gpu2gpu_8b(ctx, 1, mem_49517.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, ext_mem_49516.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, (int64_t []) {(int64_t) 8})) != 0)
        goto cleanup;
    if (memblock_alloc_device(ctx, &mem_49519, (int64_t) 64, "mem_49519")) {
        err = 1;
        goto cleanup;
    }
    if (slt64((int64_t) 0, (int64_t) 8)) {
        if (ctx->debugging)
            fprintf(ctx->log, "%s\n", "\n# SegScan");
        
        int64_t shared_memory_50756;
        
        shared_memory_50756 = ctx->max_shared_memory;
        
        int64_t thread_block_sizze_50757;
        
        thread_block_sizze_50757 = ctx->max_thread_block_size;
        
        int64_t registers_50758;
        
        registers_50758 = ctx->max_registers;
        
        int64_t thread_block_sizze_50759;
        
        thread_block_sizze_50759 = ctx->max_thread_block_size;
        
        int64_t chunk_sizze_50760 = smax64((int64_t) 1, smin64(squot64(squot64(shared_memory_50756, thread_block_sizze_50757), (int64_t) 8), squot64(squot64(registers_50758, thread_block_sizze_50759) - (int64_t) 1 - squot64(smax64((int64_t) 4, (int64_t) 8), (int64_t) 4), (int64_t) 2 * squot64(smax64((int64_t) 4, (int64_t) 8), (int64_t) 4))));
        int64_t num_virt_blocks_50761 = sdiv_up64((int64_t) 8, segscan_tblock_sizze_43873 * chunk_sizze_50760);
        int64_t num_virt_threads_50762 = num_virt_blocks_50761 * segscan_tblock_sizze_43873;
        
        if (ctx->debugging)
            fprintf(ctx->log, "%s: %llu%c", "Sequential elements per thread (chunk)", (long long) chunk_sizze_50760, '\n');
        if (memblock_alloc_device(ctx, &status_flags_mem_50763, num_virt_blocks_50761, "status_flags_mem_50763")) {
            err = 1;
            goto cleanup;
        }
        if (futrts_builtinzhreplicate_i8(ctx, status_flags_mem_50763, num_virt_blocks_50761, (int8_t) 0) != 0) {
            err = 1;
            goto cleanup;
        }
        if (memblock_alloc_device(ctx, &aggregates_mem_50765, (int64_t) 8 * num_virt_blocks_50761, "aggregates_mem_50765")) {
            err = 1;
            goto cleanup;
        }
        if (memblock_alloc_device(ctx, &incprefixes_mem_50767, (int64_t) 8 * num_virt_blocks_50761, "incprefixes_mem_50767")) {
            err = 1;
            goto cleanup;
        }
        {
            err = gpu_kernel_add_next_partition_doublezisegscan_43878(ctx, num_tblocks_43874, 1, 1, *ctx->tuning_params.add_next_partition_doublezisegscan_tblock_sizze_43631, 1, 1, smax64(smax64((int64_t) 288, (int64_t) 8 * segscan_tblock_sizze_43873), chunk_sizze_50760 * segscan_tblock_sizze_43873 * (int64_t) 8) + srem64((int64_t) 8 - srem64(smax64(smax64((int64_t) 288, (int64_t) 8 * segscan_tblock_sizze_43873), chunk_sizze_50760 * segscan_tblock_sizze_43873 * (int64_t) 8), (int64_t) 8), (int64_t) 8), num_tblocks_43874, num_virt_blocks_50761, num_virt_threads_50762, ext_mem_49516.mem, mem_49519.mem, status_flags_mem_50763.mem, aggregates_mem_50765.mem, incprefixes_mem_50767.mem, global_dynid_mem_50769.mem);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        if (ctx->debugging)
            fprintf(ctx->log, "%s\n", "");
    }
    if (memblock_unref_device(ctx, &ext_mem_49516, "ext_mem_49516") != 0)
        return 1;
    if (memblock_set_device(ctx, &ext_mem_49526, &mem_49519, "mem_49519") != 0)
        return 1;
    if (memblock_set_device(ctx, &ext_mem_49525, &mem_49517, "mem_49517") != 0)
        return 1;
    if (memblock_set_device(ctx, &ext_mem_49524, &ext_mem_49515, "ext_mem_49515") != 0)
        return 1;
    
    int64_t read_res_52128;
    
    if ((err = gpu_scalar_from_device(ctx, &read_res_52128, ext_mem_49526.mem, (int64_t) 7 * sizeof(int64_t), sizeof(int64_t))) != 0)
        goto cleanup;
    if (ctx->failure_is_an_option && futhark_context_sync(ctx) != 0) {
        err = 1;
        goto cleanup;
    }
    
    int64_t m_f_res_38983 = read_res_52128;
    int64_t m_38991 = sub64(m_f_res_38983, (int64_t) 1);
    bool i_p_m_t_s_leq_w_38993 = slt64(m_38991, (int64_t) 8);
    bool zzero_leq_i_p_m_t_s_38992 = sle64((int64_t) 0, m_38991);
    bool y_38995 = zzero_leq_i_p_m_t_s_38992 && i_p_m_t_s_leq_w_38993;
    bool i_lte_j_38994 = sle64((int64_t) 0, m_f_res_38983);
    bool forwards_ok_38996 = i_lte_j_38994 && y_38995;
    bool empty_slice_38990 = m_f_res_38983 == (int64_t) 0;
    bool ok_or_empty_38997 = empty_slice_38990 || forwards_ok_38996;
    bool index_certs_38998;
    
    if (!ok_or_empty_38997) {
        set_error(ctx, msgprintf("Error: %s%lld%s%lld%s\n\nBacktrace:\n%s", "Index [:", (long long) m_f_res_38983, "] out of bounds for array of shape [", (long long) (int64_t) 8, "].", "-> #0  /prelude/soacs.fut:258:29-35\n   #1  /prelude/functional.fut:9:44-45\n   #2  ft_libs/ftDBSCAN_plus.fut:850:18-855:84\n   #3  ft_libs/ftDBSCAN_plus.fut:849:9-855:84\n"));
        err = FUTHARK_PROGRAM_ERROR;
        goto cleanup;
    }
    
    int64_t bytes_49527 = (int64_t) 8 * m_f_res_38983;
    int64_t conc_tmp_39004 = dz2083U_27036 + m_f_res_38983;
    int64_t bytes_49530 = (int64_t) 8 * conc_tmp_39004;
    bool nonzzero_cert_39177 = 0;
    
    if (memblock_unref_device(ctx, &mem_49459, "mem_49459") != 0)
        return 1;
    if (memblock_alloc_device(ctx, &mem_49565, bytes_49441, "mem_49565")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_49567, bytes_49441, "mem_49567")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_49569, bytes_49441, "mem_49569")) {
        err = 1;
        goto cleanup;
    }
    if (slt64((int64_t) 0, dzlz7bUZLzpZRz20Udz2082Uz20Udz2084Uz2088Uz2084Uz7dUzg_39167)) {
        if (ctx->debugging)
            fprintf(ctx->log, "%s\n", "\n# SegScan");
        
        int64_t shared_memory_50858;
        
        shared_memory_50858 = ctx->max_shared_memory;
        
        int64_t thread_block_sizze_50859;
        
        thread_block_sizze_50859 = ctx->max_thread_block_size;
        
        int64_t registers_50860;
        
        registers_50860 = ctx->max_registers;
        
        int64_t thread_block_sizze_50861;
        
        thread_block_sizze_50861 = ctx->max_thread_block_size;
        
        int64_t chunk_sizze_50862 = smax64((int64_t) 1, smin64(squot64(squot64(shared_memory_50858, thread_block_sizze_50859), (int64_t) 8), squot64(squot64(registers_50860, thread_block_sizze_50861) - (int64_t) 1 - squot64(smax64((int64_t) 4, (int64_t) 8) + smax64((int64_t) 4, (int64_t) 8), (int64_t) 4), (int64_t) 2 * squot64(smax64((int64_t) 4, (int64_t) 8) + smax64((int64_t) 4, (int64_t) 8), (int64_t) 4))));
        int64_t num_virt_blocks_50863 = sdiv_up64(dzlz7bUZLzpZRz20Udz2082Uz20Udz2084Uz2088Uz2084Uz7dUzg_39167, segscan_tblock_sizze_44195 * chunk_sizze_50862);
        int64_t num_virt_threads_50864 = num_virt_blocks_50863 * segscan_tblock_sizze_44195;
        
        if (ctx->debugging)
            fprintf(ctx->log, "%s: %llu%c", "Sequential elements per thread (chunk)", (long long) chunk_sizze_50862, '\n');
        if (memblock_alloc_device(ctx, &status_flags_mem_50865, num_virt_blocks_50863, "status_flags_mem_50865")) {
            err = 1;
            goto cleanup;
        }
        if (futrts_builtinzhreplicate_i8(ctx, status_flags_mem_50865, num_virt_blocks_50863, (int8_t) 0) != 0) {
            err = 1;
            goto cleanup;
        }
        if (memblock_alloc_device(ctx, &aggregates_mem_50867, (int64_t) 8 * num_virt_blocks_50863, "aggregates_mem_50867")) {
            err = 1;
            goto cleanup;
        }
        if (memblock_alloc_device(ctx, &incprefixes_mem_50869, (int64_t) 8 * num_virt_blocks_50863, "incprefixes_mem_50869")) {
            err = 1;
            goto cleanup;
        }
        if (memblock_alloc_device(ctx, &aggregates_mem_50871, (int64_t) 8 * num_virt_blocks_50863, "aggregates_mem_50871")) {
            err = 1;
            goto cleanup;
        }
        if (memblock_alloc_device(ctx, &incprefixes_mem_50873, (int64_t) 8 * num_virt_blocks_50863, "incprefixes_mem_50873")) {
            err = 1;
            goto cleanup;
        }
        {
            err = gpu_kernel_add_next_partition_doublezisegscan_44200(ctx, num_tblocks_44197, 1, 1, *ctx->tuning_params.add_next_partition_doublezisegscan_tblock_sizze_44194, 1, 1, smax64(smax64((int64_t) 544, sdiv_up64((int64_t) 8 * segscan_tblock_sizze_44195, (int64_t) 8) * (int64_t) 8 + (int64_t) 8 * segscan_tblock_sizze_44195), smax64(chunk_sizze_50862 * segscan_tblock_sizze_44195 * (int64_t) 8, chunk_sizze_50862 * segscan_tblock_sizze_44195 * (int64_t) 8)) + srem64((int64_t) 8 - srem64(smax64(smax64((int64_t) 544, sdiv_up64((int64_t) 8 * segscan_tblock_sizze_44195, (int64_t) 8) * (int64_t) 8 + (int64_t) 8 * segscan_tblock_sizze_44195), smax64(chunk_sizze_50862 * segscan_tblock_sizze_44195 * (int64_t) 8, chunk_sizze_50862 * segscan_tblock_sizze_44195 * (int64_t) 8)), (int64_t) 8), (int64_t) 8), dz2082U_27035, dz2083U_27036, zt_res_38807, dzlz7bUZLzpZRz20Udz2082Uz20Udz2084Uz2088Uz2084Uz7dUzg_39167, cond_39171, num_tblocks_44197, num_virt_blocks_50863, num_virt_threads_50864, clProc_mem_49382.mem, clProc_mem_49383.mem, clProc_mem_49385.mem, mem_49416.mem, mem_49418.mem, ext_mem_49425.mem, ext_mem_49428.mem, ext_mem_49431.mem, ext_mem_49434.mem, ext_mem_49437.mem, ext_mem_49440.mem, mem_49449.mem, mem_49565.mem, mem_49567.mem, mem_49569.mem, status_flags_mem_50865.mem, aggregates_mem_50867.mem, incprefixes_mem_50869.mem, aggregates_mem_50871.mem, incprefixes_mem_50873.mem, global_dynid_mem_50875.mem);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        ctx->failure_is_an_option = 1;
        if (ctx->debugging)
            fprintf(ctx->log, "%s\n", "");
    }
    if (memblock_unref_device(ctx, &ext_mem_49425, "ext_mem_49425") != 0)
        return 1;
    if (memblock_unref_device(ctx, &ext_mem_49428, "ext_mem_49428") != 0)
        return 1;
    if (memblock_unref_device(ctx, &ext_mem_49431, "ext_mem_49431") != 0)
        return 1;
    if (memblock_unref_device(ctx, &ext_mem_49434, "ext_mem_49434") != 0)
        return 1;
    if (memblock_unref_device(ctx, &ext_mem_49437, "ext_mem_49437") != 0)
        return 1;
    if (memblock_unref_device(ctx, &ext_mem_49440, "ext_mem_49440") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_49449, "mem_49449") != 0)
        return 1;
    
    int64_t last_offset_39272;
    
    if (x_39271) {
        int64_t read_res_52129;
        
        if ((err = gpu_scalar_from_device(ctx, &read_res_52129, mem_49565.mem, last_index_39269 * sizeof(int64_t), sizeof(int64_t))) != 0)
            goto cleanup;
        if (ctx->failure_is_an_option && futhark_context_sync(ctx) != 0) {
            err = 1;
            goto cleanup;
        }
        
        int64_t x_42723 = read_res_52129;
        
        last_offset_39272 = x_42723;
    } else {
        last_offset_39272 = (int64_t) 0;
    }
    
    int64_t partition_sizze_39274;
    
    if (is_empty_39270) {
        partition_sizze_39274 = (int64_t) 0;
    } else {
        partition_sizze_39274 = last_offset_39272;
    }
    
    bool eq_x_zz_39288 = (int64_t) 0 == last_offset_39272;
    bool p_and_eq_x_y_39289 = x_39271 && eq_x_zz_39288;
    bool empty_slice_39290 = is_empty_39270 || p_and_eq_x_y_39289;
    int64_t m_39291 = sub64(partition_sizze_39274, (int64_t) 1);
    bool zzero_leq_i_p_m_t_s_39292 = sle64((int64_t) 0, m_39291);
    bool i_p_m_t_s_leq_w_39293 = slt64(m_39291, dzlz7bUZLzpZRz20Udz2082Uz20Udz2084Uz2088Uz2084Uz7dUzg_39167);
    bool i_lte_j_39294 = sle64((int64_t) 0, partition_sizze_39274);
    bool y_39295 = zzero_leq_i_p_m_t_s_39292 && i_p_m_t_s_leq_w_39293;
    bool forwards_ok_39296 = i_lte_j_39294 && y_39295;
    bool ok_or_empty_39297 = empty_slice_39290 || forwards_ok_39296;
    bool index_certs_39298;
    
    if (!ok_or_empty_39297) {
        set_error(ctx, msgprintf("Error: %s%lld%s%lld%s%lld%s\n\nBacktrace:\n%s", "Index [", (long long) (int64_t) 0, ":", (long long) partition_sizze_39274, "] out of bounds for array of shape [", (long long) dzlz7bUZLzpZRz20Udz2082Uz20Udz2084Uz2088Uz2084Uz7dUzg_39167, "].", "-> #0  /prelude/soacs.fut:174:7-19\n   #1  /prelude/functional.fut:9:44-45\n   #2  ft_libs/ftDBSCAN_plus.fut:850:18-855:84\n   #3  ft_libs/ftDBSCAN_plus.fut:849:9-855:84\n"));
        err = FUTHARK_PROGRAM_ERROR;
        goto cleanup;
    }
    
    int64_t bytes_49572 = (int64_t) 8 * partition_sizze_39274;
    int64_t j_m_i_39300 = sub64(dzlz7bUZLzpZRz20Udz2082Uz20Udz2084Uz2088Uz2084Uz7dUzg_39167, partition_sizze_39274);
    bool empty_slice_39301 = j_m_i_39300 == (int64_t) 0;
    int64_t m_39302 = sub64(j_m_i_39300, (int64_t) 1);
    int64_t i_p_m_t_s_39303 = add64(partition_sizze_39274, m_39302);
    bool zzero_leq_i_p_m_t_s_39304 = sle64((int64_t) 0, i_p_m_t_s_39303);
    bool i_p_m_t_s_leq_w_39305 = slt64(i_p_m_t_s_39303, dzlz7bUZLzpZRz20Udz2082Uz20Udz2084Uz2088Uz2084Uz7dUzg_39167);
    bool i_lte_j_39306 = sle64(partition_sizze_39274, dzlz7bUZLzpZRz20Udz2082Uz20Udz2084Uz2088Uz2084Uz7dUzg_39167);
    bool y_39307 = zzero_leq_i_p_m_t_s_39304 && i_p_m_t_s_leq_w_39305;
    bool forwards_ok_39308 = i_lte_j_39306 && y_39307;
    bool ok_or_empty_39309 = empty_slice_39301 || forwards_ok_39308;
    bool index_certs_39310;
    
    if (!ok_or_empty_39309) {
        set_error(ctx, msgprintf("Error: %s%lld%s%lld%s%lld%s\n\nBacktrace:\n%s", "Index [", (long long) partition_sizze_39274, ":", (long long) dzlz7bUZLzpZRz20Udz2082Uz20Udz2084Uz2088Uz2084Uz7dUzg_39167, "] out of bounds for array of shape [", (long long) dzlz7bUZLzpZRz20Udz2082Uz20Udz2084Uz2088Uz2084Uz7dUzg_39167, "].", "-> #0  /prelude/soacs.fut:174:21-33\n   #1  /prelude/functional.fut:9:44-45\n   #2  ft_libs/ftDBSCAN_plus.fut:850:18-855:84\n   #3  ft_libs/ftDBSCAN_plus.fut:849:9-855:84\n"));
        err = FUTHARK_PROGRAM_ERROR;
        goto cleanup;
    }
    
    int64_t conc_tmp_39371 = j_m_i_39153 + j_m_i_39300;
    int64_t bytes_49586 = (int64_t) 8 * conc_tmp_39371;
    
    if (memblock_alloc_device(ctx, &mem_49403, part_no_27031, "mem_49403")) {
        err = 1;
        goto cleanup;
    }
    if ((err = lmad_copy_gpu2gpu_1b(ctx, 1, mem_49403.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, clProc_mem_49384.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, (int64_t []) {part_no_27031})) != 0)
        goto cleanup;
    
    bool write_tmp_52130 = 1;
    
    if ((err = gpu_scalar_to_device(ctx, mem_49403.mem, new_id_27080 * sizeof(bool), sizeof(bool), &write_tmp_52130)) != 0)
        goto cleanup;
    if (memblock_alloc_device(ctx, &mem_49405, bytes_49404, "mem_49405")) {
        err = 1;
        goto cleanup;
    }
    if ((err = lmad_copy_gpu2gpu_8b(ctx, 1, mem_49405.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, new_xs_mem_49401.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, (int64_t []) {n_new_27039})) != 0)
        goto cleanup;
    if (memblock_alloc_device(ctx, &mem_49407, bytes_49404, "mem_49407")) {
        err = 1;
        goto cleanup;
    }
    if ((err = lmad_copy_gpu2gpu_8b(ctx, 1, mem_49407.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, new_ys_mem_49402.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, (int64_t []) {n_new_27039})) != 0)
        goto cleanup;
    
    int64_t segmap_tblock_sizze_43890;
    
    segmap_tblock_sizze_43890 = *ctx->tuning_params.add_next_partition_doublezisegmap_tblock_sizze_43889;
    
    int64_t num_tblocks_43892;
    int64_t max_num_tblocks_51013;
    
    max_num_tblocks_51013 = *ctx->tuning_params.add_next_partition_doublezisegmap_num_tblocks_43891;
    num_tblocks_43892 = sext_i64_i32(smax64((int64_t) 1, smin64(sdiv_up64((int64_t) 8, segmap_tblock_sizze_43890), max_num_tblocks_51013)));
    
    bool suff_outer_par_43895;
    
    suff_outer_par_43895 = *ctx->tuning_params.add_next_partition_doublezisuff_outer_par_3 <= n_new_27039;
    if (ctx->logging)
        fprintf(ctx->log, "Compared %s <= %ld: %s.\n", "add_next_partition_double.suff_outer_par_3", (long) n_new_27039, suff_outer_par_43895 ? "true" : "false");
    
    int64_t segred_tblock_sizze_44038;
    
    segred_tblock_sizze_44038 = *ctx->tuning_params.add_next_partition_doublezisegred_tblock_sizze_43989;
    
    int64_t num_tblocks_44039;
    int64_t max_num_tblocks_51014;
    
    max_num_tblocks_51014 = *ctx->tuning_params.add_next_partition_doublezisegred_num_tblocks_43991;
    num_tblocks_44039 = sext_i64_i32(smax64((int64_t) 1, smin64(sdiv_up64(bytes_49404, segred_tblock_sizze_44038), max_num_tblocks_51014)));
    
    int64_t tile_sizze_46785;
    
    tile_sizze_46785 = *ctx->tuning_params.add_next_partition_doublezitile_sizze_46784;
    
    int64_t segmap_tblock_sizze_44132;
    
    segmap_tblock_sizze_44132 = *ctx->tuning_params.add_next_partition_doublezisegmap_tblock_sizze_44086;
    
    int64_t segmap_usable_groups_44133 = sdiv_up64(n_new_27039, segmap_tblock_sizze_44132);
    int64_t conc_tmp_39168 = dz2080U_27033 + partition_sizze_39119;
    int64_t conc_tmp_39169 = dz2081U_27034 + partition_sizze_39119;
    
    if (memblock_alloc_device(ctx, &mem_49442, bytes_49441, "mem_49442")) {
        err = 1;
        goto cleanup;
    }
    
    int64_t segmap_tblock_sizze_44205;
    
    segmap_tblock_sizze_44205 = *ctx->tuning_params.add_next_partition_doublezisegmap_tblock_sizze_44204;
    
    int64_t num_tblocks_44207;
    int64_t max_num_tblocks_51015;
    
    max_num_tblocks_51015 = *ctx->tuning_params.add_next_partition_doublezisegmap_num_tblocks_44206;
    num_tblocks_44207 = sext_i64_i32(smax64((int64_t) 1, smin64(sdiv_up64(dzlz7bUZLzpZRz20Udz2082Uz20Udz2084Uz2088Uz2084Uz7dUzg_39167, segmap_tblock_sizze_44205), max_num_tblocks_51015)));
    
    int64_t segmap_tblock_sizze_44248;
    
    segmap_tblock_sizze_44248 = *ctx->tuning_params.add_next_partition_doublezisegmap_tblock_sizze_44212;
    
    int64_t segmap_tblock_sizze_44317;
    
    segmap_tblock_sizze_44317 = *ctx->tuning_params.add_next_partition_doublezisegmap_tblock_sizze_44289;
    
    int64_t new_proc_39374 = add64((int64_t) 1, clProc_27059);
    int64_t new_proc_39375 = add64(n_new_27039, clProc_27061);
    
    if (memblock_alloc_device(ctx, &mem_49443, n_new_27039, "mem_49443")) {
        err = 1;
        goto cleanup;
    }
    if (futrts_builtinzhreplicate_bool(ctx, mem_49443, n_new_27039, 0) != 0) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_49445, bytes_49404, "mem_49445")) {
        err = 1;
        goto cleanup;
    }
    if (futrts_builtinzhreplicate_i64(ctx, mem_49445, n_new_27039, (int64_t) -1) != 0) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_49528, bytes_49527, "mem_49528")) {
        err = 1;
        goto cleanup;
    }
    if ((err = lmad_copy_gpu2gpu_8b(ctx, 1, mem_49528.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, ext_mem_49524.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, (int64_t []) {m_f_res_38983})) != 0)
        goto cleanup;
    if (ctx->debugging)
        fprintf(ctx->log, "%s\n", "\n# SegMap");
    
    int32_t virt_num_tblocks_51056 = sext_i64_i32(sdiv_up64((int64_t) 8, segmap_tblock_sizze_43890));
    
    {
        err = gpu_kernel_add_next_partition_doublezisegmap_43887(ctx, num_tblocks_43892, 1, 1, *ctx->tuning_params.add_next_partition_doublezisegmap_tblock_sizze_43889, 1, 1, (int64_t) 0, m_f_res_38983, num_tblocks_43892, virt_num_tblocks_51056, ext_mem_49524.mem, ext_mem_49525.mem, ext_mem_49526.mem, mem_49528.mem);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (ctx->debugging)
        fprintf(ctx->log, "%s\n", "");
    if (memblock_unref_device(ctx, &ext_mem_49524, "ext_mem_49524") != 0)
        return 1;
    if (memblock_unref_device(ctx, &ext_mem_49525, "ext_mem_49525") != 0)
        return 1;
    if (memblock_unref_device(ctx, &ext_mem_49526, "ext_mem_49526") != 0)
        return 1;
    if (memblock_alloc_device(ctx, &mem_49531, bytes_49530, "mem_49531")) {
        err = 1;
        goto cleanup;
    }
    
    int64_t tmp_offs_51069 = (int64_t) 0;
    
    if ((err = lmad_copy_gpu2gpu_8b(ctx, 1, mem_49531.mem, tmp_offs_51069, (int64_t []) {(int64_t) 1}, clProc_mem_49385.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, (int64_t []) {dz2083U_27036})) != 0)
        goto cleanup;
    tmp_offs_51069 += dz2083U_27036;
    if ((err = lmad_copy_gpu2gpu_8b(ctx, 1, mem_49531.mem, tmp_offs_51069, (int64_t []) {(int64_t) 1}, mem_49528.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, (int64_t []) {m_f_res_38983})) != 0)
        goto cleanup;
    tmp_offs_51069 += m_f_res_38983;
    if (memblock_unref_device(ctx, &mem_49528, "mem_49528") != 0)
        return 1;
    
    int64_t num_whole_tiles_46806 = squot_safe64((int64_t) 8, tile_sizze_46785);
    int64_t residual_input_46981 = srem_safe64((int64_t) 8, tile_sizze_46785);
    bool cond_46982 = residual_input_46981 == (int64_t) 0;
    int64_t binop_x_46992 = tile_sizze_46785 * num_whole_tiles_46806;
    int64_t bytes_49547 = (int64_t) 8 * tile_sizze_46785;
    int64_t shared_memory_capacity_51159;
    
    shared_memory_capacity_51159 = ctx->max_shared_memory;
    if (suff_outer_par_43895 && sle64(sdiv_up64(bytes_49547, (int64_t) 8) * (int64_t) 8, shared_memory_capacity_51159)) {
        int64_t ldim_46786 = sdiv_up64(n_new_27039, tile_sizze_46785);
        
        if (memblock_alloc_device(ctx, &mem_49559, n_new_27039, "mem_49559")) {
            err = 1;
            goto cleanup;
        }
        if (ctx->debugging)
            fprintf(ctx->log, "%s\n", "\n# SegMap");
        
        int32_t num_chunks_51070 = sext_i64_i32(sdiv_up64(tile_sizze_46785, tile_sizze_46785));
        int32_t virt_num_tblocks_51071 = sext_i64_i32(ldim_46786);
        
        {
            err = gpu_kernel_add_next_partition_doublezisegmap_intrablock_46783(ctx, ldim_46786, 1, 1, *ctx->tuning_params.add_next_partition_doublezitile_sizze_46784, 1, 1, bytes_49547 + srem64((int64_t) 8 - srem64(bytes_49547, (int64_t) 8), (int64_t) 8), n_new_27039, zt_res_38807, ldim_46786, clBase_mem_49377.mem, clBase_mem_49378.mem, clBase_mem_49379.mem, new_xs_mem_49401.mem, new_ys_mem_49402.mem, mem_49450.mem, mem_49559.mem);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        ctx->failure_is_an_option = 1;
        if (ctx->debugging)
            fprintf(ctx->log, "%s\n", "");
        if (memblock_set_device(ctx, &ext_mem_49560, &mem_49559, "mem_49559") != 0)
            return 1;
    } else {
        if (memblock_alloc_device(ctx, &mem_49533, n_new_27039, "mem_49533")) {
            err = 1;
            goto cleanup;
        }
        if (ctx->debugging)
            fprintf(ctx->log, "%s\n", "\n# SegRed");
        
        int64_t chunk_sizze_51087 = (int64_t) 1;
        
        if (slt64((int64_t) 16, segred_tblock_sizze_44038 * chunk_sizze_51087)) {
            int64_t segment_sizze_nonzzero_51088 = smax64((int64_t) 1, (int64_t) 8);
            int64_t num_threads_51089 = segred_tblock_sizze_44038 * segred_tblock_sizze_44038;
            
            if (ctx->debugging)
                fprintf(ctx->log, "%s\n", "# SegRed-small");
            if (ctx->debugging)
                fprintf(ctx->log, "%s: %llu%c", "num_segments", (long long) n_new_27039, '\n');
            if (ctx->debugging)
                fprintf(ctx->log, "%s: %llu%c", "segment_size", (long long) (int64_t) 8, '\n');
            if (ctx->debugging)
                fprintf(ctx->log, "%s: %llu%c", "segments_per_block", (long long) squot64(segred_tblock_sizze_44038, segment_sizze_nonzzero_51088), '\n');
            if (ctx->debugging)
                fprintf(ctx->log, "%s: %llu%c", "required_blocks", (long long) sext_i64_i32(sdiv_up64(n_new_27039, squot64(segred_tblock_sizze_44038, segment_sizze_nonzzero_51088))), '\n');
            {
                err = gpu_kernel_add_next_partition_doublezisegred_small_44044(ctx, num_tblocks_44039, 1, 1, *ctx->tuning_params.add_next_partition_doublezisegred_tblock_sizze_43989, 1, 1, segred_tblock_sizze_44038 + srem64((int64_t) 8 - srem64(segred_tblock_sizze_44038, (int64_t) 8), (int64_t) 8), n_new_27039, zt_res_38807, num_tblocks_44039, segment_sizze_nonzzero_51088, clBase_mem_49377.mem, clBase_mem_49378.mem, clBase_mem_49379.mem, new_xs_mem_49401.mem, new_ys_mem_49402.mem, mem_49450.mem, mem_49533.mem);
                if (err != FUTHARK_SUCCESS)
                    goto cleanup;
            }
            ctx->failure_is_an_option = 1;
        } else {
            int64_t blocks_per_segment_51116 = sdiv_up64(num_tblocks_44039, smax64((int64_t) 1, n_new_27039));
            int64_t q_51117 = sdiv_up64((int64_t) 8, segred_tblock_sizze_44038 * blocks_per_segment_51116 * chunk_sizze_51087);
            int64_t num_virtblocks_51118 = blocks_per_segment_51116 * n_new_27039;
            int64_t threads_per_segment_51119 = blocks_per_segment_51116 * segred_tblock_sizze_44038;
            
            if (ctx->debugging)
                fprintf(ctx->log, "%s\n", "# SegRed-large");
            if (ctx->debugging)
                fprintf(ctx->log, "%s: %llu%c", "num_segments", (long long) n_new_27039, '\n');
            if (ctx->debugging)
                fprintf(ctx->log, "%s: %llu%c", "segment_size", (long long) (int64_t) 8, '\n');
            if (ctx->debugging)
                fprintf(ctx->log, "%s: %llu%c", "num_virtblocks", (long long) num_virtblocks_51118, '\n');
            if (ctx->debugging)
                fprintf(ctx->log, "%s: %llu%c", "num_tblocks", (long long) num_tblocks_44039, '\n');
            if (ctx->debugging)
                fprintf(ctx->log, "%s: %llu%c", "tblock_size", (long long) segred_tblock_sizze_44038, '\n');
            if (ctx->debugging)
                fprintf(ctx->log, "%s: %llu%c", "q", (long long) q_51117, '\n');
            if (ctx->debugging)
                fprintf(ctx->log, "%s: %llu%c", "blocks_per_segment", (long long) blocks_per_segment_51116, '\n');
            if (memblock_alloc_device(ctx, &segred_tmp_mem_51120, num_virtblocks_51118, "segred_tmp_mem_51120")) {
                err = 1;
                goto cleanup;
            }
            {
                err = gpu_kernel_add_next_partition_doublezisegred_large_44044(ctx, num_tblocks_44039, 1, 1, *ctx->tuning_params.add_next_partition_doublezisegred_tblock_sizze_43989, 1, 1, 8 + (segred_tblock_sizze_44038 + srem64((int64_t) 8 - srem64(segred_tblock_sizze_44038, (int64_t) 8), (int64_t) 8)), n_new_27039, zt_res_38807, num_tblocks_44039, blocks_per_segment_51116, q_51117, num_virtblocks_51118, threads_per_segment_51119, clBase_mem_49377.mem, clBase_mem_49378.mem, clBase_mem_49379.mem, new_xs_mem_49401.mem, new_ys_mem_49402.mem, mem_49450.mem, mem_49533.mem, segred_tmp_mem_51120.mem, counters_mem_51122.mem);
                if (err != FUTHARK_SUCCESS)
                    goto cleanup;
            }
            ctx->failure_is_an_option = 1;
        }
        if (ctx->debugging)
            fprintf(ctx->log, "%s\n", "");
        if (memblock_set_device(ctx, &ext_mem_49560, &mem_49533, "mem_49533") != 0)
            return 1;
    }
    if (memblock_alloc_device(ctx, &mem_49562, n_new_27039, "mem_49562")) {
        err = 1;
        goto cleanup;
    }
    if (ctx->debugging)
        fprintf(ctx->log, "%s\n", "\n# SegMap");
    
    int32_t virt_num_tblocks_51160 = sext_i64_i32(sdiv_up64(n_new_27039, segmap_tblock_sizze_44132));
    
    {
        err = gpu_kernel_add_next_partition_doublezisegmap_44136(ctx, segmap_usable_groups_44133, 1, 1, *ctx->tuning_params.add_next_partition_doublezisegmap_tblock_sizze_44086, 1, 1, (int64_t) 0, n_new_27039, clBase_27044, clBase_mem_49377.mem, clBase_mem_49378.mem, clBase_mem_49379.mem, new_xs_mem_49401.mem, new_ys_mem_49402.mem, mem_49450.mem, ext_mem_49560.mem, mem_49562.mem);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    ctx->failure_is_an_option = 1;
    if (ctx->debugging)
        fprintf(ctx->log, "%s\n", "");
    
    int64_t y_39276 = (int64_t) -1 + partition_sizze_39274;
    
    if (ctx->debugging)
        fprintf(ctx->log, "%s\n", "\n# SegMap");
    
    int32_t virt_num_tblocks_51170 = sext_i64_i32(sdiv_up64(dzlz7bUZLzpZRz20Udz2082Uz20Udz2084Uz2088Uz2084Uz7dUzg_39167, segmap_tblock_sizze_44205));
    
    {
        err = gpu_kernel_add_next_partition_doublezisegmap_44202(ctx, num_tblocks_44207, 1, 1, *ctx->tuning_params.add_next_partition_doublezisegmap_tblock_sizze_44204, 1, 1, (int64_t) 0, dzlz7bUZLzpZRz20Udz2082Uz20Udz2084Uz2088Uz2084Uz7dUzg_39167, y_39276, num_tblocks_44207, virt_num_tblocks_51170, mem_49442.mem, mem_49565.mem, mem_49567.mem, mem_49569.mem);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (ctx->debugging)
        fprintf(ctx->log, "%s\n", "");
    if (memblock_unref_device(ctx, &mem_49565, "mem_49565") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_49567, "mem_49567") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_49569, "mem_49569") != 0)
        return 1;
    
    int64_t segmap_usable_groups_44249 = sdiv_up64(partition_sizze_39274, segmap_tblock_sizze_44248);
    
    if (memblock_alloc_device(ctx, &mem_49573, bytes_49572, "mem_49573")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_49575, bytes_49572, "mem_49575")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_49576, partition_sizze_39274, "mem_49576")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_49578, bytes_49572, "mem_49578")) {
        err = 1;
        goto cleanup;
    }
    if (ctx->debugging)
        fprintf(ctx->log, "%s\n", "\n# SegMap");
    
    int32_t virt_num_tblocks_51183 = sext_i64_i32(sdiv_up64(partition_sizze_39274, segmap_tblock_sizze_44248));
    
    {
        err = gpu_kernel_add_next_partition_doublezisegmap_44255(ctx, segmap_usable_groups_44249, 1, 1, *ctx->tuning_params.add_next_partition_doublezisegmap_tblock_sizze_44212, 1, 1, (int64_t) 0, dz2080U_27033, dz2081U_27034, dz2082U_27035, dzlz7bUZLzpZRz20Udz2082Uz20Udz2084Uz2088Uz2084Uz7dUzg_39167, conc_tmp_39168, conc_tmp_39169, partition_sizze_39274, clProc_mem_49380.mem, clProc_mem_49381.mem, clProc_mem_49382.mem, clProc_mem_49383.mem, mem_49416.mem, mem_49418.mem, mem_49419.mem, mem_49421.mem, mem_49442.mem, mem_49573.mem, mem_49575.mem, mem_49576.mem, mem_49578.mem);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    ctx->failure_is_an_option = 1;
    if (ctx->debugging)
        fprintf(ctx->log, "%s\n", "");
    if (memblock_unref_device(ctx, &mem_49419, "mem_49419") != 0)
        return 1;
    
    int64_t segmap_usable_groups_44318 = sdiv_up64(j_m_i_39300, segmap_tblock_sizze_44317);
    
    if (memblock_alloc_device(ctx, &mem_49587, bytes_49586, "mem_49587")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_49589, bytes_49586, "mem_49589")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_49591, bytes_49586, "mem_49591")) {
        err = 1;
        goto cleanup;
    }
    if (ctx->debugging)
        fprintf(ctx->log, "%s\n", "\n# SegMap");
    
    int32_t virt_num_tblocks_51192 = sext_i64_i32(sdiv_up64(j_m_i_39300, segmap_tblock_sizze_44317));
    
    {
        err = gpu_kernel_add_next_partition_doublezisegmap_44323(ctx, segmap_usable_groups_44318, 1, 1, *ctx->tuning_params.add_next_partition_doublezisegmap_tblock_sizze_44289, 1, 1, (int64_t) 0, dz2081U_27034, dz2082U_27035, j_m_i_39153, dzlz7bUZLzpZRz20Udz2082Uz20Udz2084Uz2088Uz2084Uz7dUzg_39167, conc_tmp_39169, partition_sizze_39274, j_m_i_39300, clProc_mem_49381.mem, clProc_mem_49382.mem, clProc_mem_49383.mem, mem_49416.mem, mem_49418.mem, mem_49421.mem, mem_49442.mem, mem_49587.mem, mem_49589.mem, mem_49591.mem);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    ctx->failure_is_an_option = 1;
    if (ctx->debugging)
        fprintf(ctx->log, "%s\n", "");
    if (memblock_unref_device(ctx, &mem_49442, "mem_49442") != 0)
        return 1;
    
    int64_t tmp_offs_51201 = (int64_t) 0;
    
    if ((err = lmad_copy_gpu2gpu_8b(ctx, 1, mem_49587.mem, tmp_offs_51201, (int64_t []) {(int64_t) 1}, mem_49416.mem, partition_sizze_39119, (int64_t []) {(int64_t) 1}, (int64_t []) {j_m_i_39153})) != 0)
        goto cleanup;
    tmp_offs_51201 += j_m_i_39153;
    if (!(tmp_offs_51201 == j_m_i_39153)) {
        if ((err = lmad_copy_gpu2gpu_8b(ctx, 1, mem_49587.mem, tmp_offs_51201, (int64_t []) {(int64_t) 1}, mem_49587.mem, j_m_i_39153, (int64_t []) {(int64_t) 1}, (int64_t []) {j_m_i_39300})) != 0)
            goto cleanup;
    }
    tmp_offs_51201 += j_m_i_39300;
    if (memblock_unref_device(ctx, &mem_49416, "mem_49416") != 0)
        return 1;
    
    int64_t tmp_offs_51202 = (int64_t) 0;
    
    if ((err = lmad_copy_gpu2gpu_8b(ctx, 1, mem_49589.mem, tmp_offs_51202, (int64_t []) {(int64_t) 1}, mem_49418.mem, partition_sizze_39119, (int64_t []) {(int64_t) 1}, (int64_t []) {j_m_i_39153})) != 0)
        goto cleanup;
    tmp_offs_51202 += j_m_i_39153;
    if (!(tmp_offs_51202 == j_m_i_39153)) {
        if ((err = lmad_copy_gpu2gpu_8b(ctx, 1, mem_49589.mem, tmp_offs_51202, (int64_t []) {(int64_t) 1}, mem_49589.mem, j_m_i_39153, (int64_t []) {(int64_t) 1}, (int64_t []) {j_m_i_39300})) != 0)
            goto cleanup;
    }
    tmp_offs_51202 += j_m_i_39300;
    if (memblock_unref_device(ctx, &mem_49418, "mem_49418") != 0)
        return 1;
    
    int64_t tmp_offs_51203 = (int64_t) 0;
    
    if ((err = lmad_copy_gpu2gpu_8b(ctx, 1, mem_49591.mem, tmp_offs_51203, (int64_t []) {(int64_t) 1}, mem_49421.mem, partition_sizze_39119, (int64_t []) {(int64_t) 1}, (int64_t []) {j_m_i_39153})) != 0)
        goto cleanup;
    tmp_offs_51203 += j_m_i_39153;
    if (!(tmp_offs_51203 == j_m_i_39153)) {
        if ((err = lmad_copy_gpu2gpu_8b(ctx, 1, mem_49591.mem, tmp_offs_51203, (int64_t []) {(int64_t) 1}, mem_49591.mem, j_m_i_39153, (int64_t []) {(int64_t) 1}, (int64_t []) {j_m_i_39300})) != 0)
            goto cleanup;
    }
    tmp_offs_51203 += j_m_i_39300;
    if (memblock_unref_device(ctx, &mem_49421, "mem_49421") != 0)
        return 1;
    if (memblock_alloc_device(ctx, &mem_49592, (int64_t) 16, "mem_49592")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_49593, (int64_t) 16, "mem_49593")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_49594, (int64_t) 16, "mem_49594")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_49595, (int64_t) 16, "mem_49595")) {
        err = 1;
        goto cleanup;
    }
    {
        err = gpu_kernel_add_next_partition_doublezigpuseq_51204(ctx, (int64_t) 1, 1, 1, (int64_t) 1, 1, 1, (int64_t) 0, zt_res_38807, mem_49451.mem, mem_49452.mem, mem_49453.mem, mem_49454.mem, mem_49455.mem, mem_49456.mem, mem_49457.mem, mem_49458.mem, mem_49463.mem, mem_49592.mem, mem_49593.mem, mem_49594.mem, mem_49595.mem);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (memblock_unref_device(ctx, &mem_49451, "mem_49451") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_49452, "mem_49452") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_49453, "mem_49453") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_49454, "mem_49454") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_49455, "mem_49455") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_49456, "mem_49456") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_49457, "mem_49457") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_49458, "mem_49458") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_49592, "mem_49592") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_49593, "mem_49593") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_50191, &chain_collisions_mem_49374, "chain_collisions_mem_49374") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_50192, &chain_collisions_mem_49375, "chain_collisions_mem_49375") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_50193, &clBase_mem_49376, "clBase_mem_49376") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_50194, &clBase_mem_49377, "clBase_mem_49377") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_50195, &clBase_mem_49378, "clBase_mem_49378") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_50196, &clBase_mem_49379, "clBase_mem_49379") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_50197, &mem_49576, "mem_49576") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_50198, &mem_49578, "mem_49578") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_50199, &mem_49573, "mem_49573") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_50200, &mem_49575, "mem_49575") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_50201, &mem_49403, "mem_49403") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_50202, &mem_49531, "mem_49531") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_50203, &mem_49445, "mem_49445") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_50204, &mem_49405, "mem_49405") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_50205, &mem_49407, "mem_49407") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_50206, &mem_49595, "mem_49595") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_50207, &mem_49594, "mem_49594") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_50208, &mem_49443, "mem_49443") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_50209, &ext_mem_49560, "ext_mem_49560") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_50210, &mem_49463, "mem_49463") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_50211, &mem_49562, "mem_49562") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_50212, &mem_49461, "mem_49461") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_50213, &mem_49460, "mem_49460") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_50214, &mem_49450, "mem_49450") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_50215, &mem_49587, "mem_49587") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_50216, &mem_49589, "mem_49589") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_50217, &mem_49591, "mem_49591") != 0)
        return 1;
    prim_out_50218 = partition_sizze_39274;
    prim_out_50219 = conc_tmp_39004;
    prim_out_50220 = conc_tmp_39371;
    prim_out_50221 = clBase_27042;
    prim_out_50222 = clBase_27043;
    prim_out_50223 = clBase_27044;
    prim_out_50224 = clBase_27045;
    prim_out_50225 = clBase_27047;
    prim_out_50226 = clBase_27050;
    prim_out_50227 = clBase_27052;
    prim_out_50228 = clProc_27057;
    prim_out_50229 = new_id_27080;
    prim_out_50230 = new_proc_39374;
    prim_out_50231 = new_proc_39375;
    prim_out_50232 = clProc_27061;
    prim_out_50233 = new_id_27080;
    if (memblock_set_device(ctx, &*mem_out_p_52084, &mem_out_50191, "mem_out_50191") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_52085, &mem_out_50192, "mem_out_50192") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_52086, &mem_out_50193, "mem_out_50193") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_52087, &mem_out_50194, "mem_out_50194") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_52088, &mem_out_50195, "mem_out_50195") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_52089, &mem_out_50196, "mem_out_50196") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_52090, &mem_out_50197, "mem_out_50197") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_52091, &mem_out_50198, "mem_out_50198") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_52092, &mem_out_50199, "mem_out_50199") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_52093, &mem_out_50200, "mem_out_50200") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_52094, &mem_out_50201, "mem_out_50201") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_52095, &mem_out_50202, "mem_out_50202") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_52096, &mem_out_50203, "mem_out_50203") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_52097, &mem_out_50204, "mem_out_50204") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_52098, &mem_out_50205, "mem_out_50205") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_52099, &mem_out_50206, "mem_out_50206") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_52100, &mem_out_50207, "mem_out_50207") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_52101, &mem_out_50208, "mem_out_50208") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_52102, &mem_out_50209, "mem_out_50209") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_52103, &mem_out_50210, "mem_out_50210") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_52104, &mem_out_50211, "mem_out_50211") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_52105, &mem_out_50212, "mem_out_50212") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_52106, &mem_out_50213, "mem_out_50213") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_52107, &mem_out_50214, "mem_out_50214") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_52108, &mem_out_50215, "mem_out_50215") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_52109, &mem_out_50216, "mem_out_50216") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_52110, &mem_out_50217, "mem_out_50217") != 0)
        return 1;
    *out_prim_out_52111 = prim_out_50218;
    *out_prim_out_52112 = prim_out_50219;
    *out_prim_out_52113 = prim_out_50220;
    *out_prim_out_52114 = prim_out_50221;
    *out_prim_out_52115 = prim_out_50222;
    *out_prim_out_52116 = prim_out_50223;
    *out_prim_out_52117 = prim_out_50224;
    *out_prim_out_52118 = prim_out_50225;
    *out_prim_out_52119 = prim_out_50226;
    *out_prim_out_52120 = prim_out_50227;
    *out_prim_out_52121 = prim_out_50228;
    *out_prim_out_52122 = prim_out_50229;
    *out_prim_out_52123 = prim_out_50230;
    *out_prim_out_52124 = prim_out_50231;
    *out_prim_out_52125 = prim_out_50232;
    *out_prim_out_52126 = prim_out_50233;
    
  cleanup:
    {
        if (memblock_unref_device(ctx, &mem_49595, "mem_49595") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49594, "mem_49594") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49593, "mem_49593") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49592, "mem_49592") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49591, "mem_49591") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49589, "mem_49589") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49587, "mem_49587") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49578, "mem_49578") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49576, "mem_49576") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49575, "mem_49575") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49573, "mem_49573") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49562, "mem_49562") != 0)
            return 1;
        if (memblock_unref_device(ctx, &segred_tmp_mem_51120, "segred_tmp_mem_51120") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49533, "mem_49533") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49559, "mem_49559") != 0)
            return 1;
        if (memblock_unref_device(ctx, &ext_mem_49560, "ext_mem_49560") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49531, "mem_49531") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49528, "mem_49528") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49445, "mem_49445") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49443, "mem_49443") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49442, "mem_49442") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49407, "mem_49407") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49405, "mem_49405") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49403, "mem_49403") != 0)
            return 1;
        if (memblock_unref_device(ctx, &incprefixes_mem_50873, "incprefixes_mem_50873") != 0)
            return 1;
        if (memblock_unref_device(ctx, &aggregates_mem_50871, "aggregates_mem_50871") != 0)
            return 1;
        if (memblock_unref_device(ctx, &incprefixes_mem_50869, "incprefixes_mem_50869") != 0)
            return 1;
        if (memblock_unref_device(ctx, &aggregates_mem_50867, "aggregates_mem_50867") != 0)
            return 1;
        if (memblock_unref_device(ctx, &status_flags_mem_50865, "status_flags_mem_50865") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49569, "mem_49569") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49567, "mem_49567") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49565, "mem_49565") != 0)
            return 1;
        if (memblock_unref_device(ctx, &incprefixes_mem_50767, "incprefixes_mem_50767") != 0)
            return 1;
        if (memblock_unref_device(ctx, &aggregates_mem_50765, "aggregates_mem_50765") != 0)
            return 1;
        if (memblock_unref_device(ctx, &status_flags_mem_50763, "status_flags_mem_50763") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49519, "mem_49519") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49517, "mem_49517") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49472, "mem_49472") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49471, "mem_49471") != 0)
            return 1;
        if (memblock_unref_device(ctx, &segred_tmp_mem_50705, "segred_tmp_mem_50705") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49469, "mem_49469") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49467, "mem_49467") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49466, "mem_49466") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49465, "mem_49465") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49475, "mem_49475") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49474, "mem_49474") != 0)
            return 1;
        if (memblock_unref_device(ctx, &ext_mem_49476, "ext_mem_49476") != 0)
            return 1;
        if (memblock_unref_device(ctx, &ext_mem_49477, "ext_mem_49477") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49514, "mem_49514") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49513, "mem_49513") != 0)
            return 1;
        if (memblock_unref_device(ctx, &ext_mem_49515, "ext_mem_49515") != 0)
            return 1;
        if (memblock_unref_device(ctx, &ext_mem_49516, "ext_mem_49516") != 0)
            return 1;
        if (memblock_unref_device(ctx, &ext_mem_49524, "ext_mem_49524") != 0)
            return 1;
        if (memblock_unref_device(ctx, &ext_mem_49525, "ext_mem_49525") != 0)
            return 1;
        if (memblock_unref_device(ctx, &ext_mem_49526, "ext_mem_49526") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49463, "mem_49463") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49461, "mem_49461") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49460, "mem_49460") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49459, "mem_49459") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49458, "mem_49458") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49457, "mem_49457") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49456, "mem_49456") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49455, "mem_49455") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49454, "mem_49454") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49453, "mem_49453") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49452, "mem_49452") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49451, "mem_49451") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49450, "mem_49450") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49449, "mem_49449") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49448, "mem_49448") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49447, "mem_49447") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49446, "mem_49446") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49438, "mem_49438") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49439, "mem_49439") != 0)
            return 1;
        if (memblock_unref_device(ctx, &ext_mem_49440, "ext_mem_49440") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49435, "mem_49435") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49436, "mem_49436") != 0)
            return 1;
        if (memblock_unref_device(ctx, &ext_mem_49437, "ext_mem_49437") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49432, "mem_49432") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49433, "mem_49433") != 0)
            return 1;
        if (memblock_unref_device(ctx, &ext_mem_49434, "ext_mem_49434") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49429, "mem_49429") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49430, "mem_49430") != 0)
            return 1;
        if (memblock_unref_device(ctx, &ext_mem_49431, "ext_mem_49431") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49426, "mem_49426") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49427, "mem_49427") != 0)
            return 1;
        if (memblock_unref_device(ctx, &ext_mem_49428, "ext_mem_49428") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49423, "mem_49423") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49424, "mem_49424") != 0)
            return 1;
        if (memblock_unref_device(ctx, &ext_mem_49425, "ext_mem_49425") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49421, "mem_49421") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49419, "mem_49419") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49418, "mem_49418") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49416, "mem_49416") != 0)
            return 1;
        if (memblock_unref_device(ctx, &incprefixes_mem_50273, "incprefixes_mem_50273") != 0)
            return 1;
        if (memblock_unref_device(ctx, &aggregates_mem_50271, "aggregates_mem_50271") != 0)
            return 1;
        if (memblock_unref_device(ctx, &incprefixes_mem_50269, "incprefixes_mem_50269") != 0)
            return 1;
        if (memblock_unref_device(ctx, &aggregates_mem_50267, "aggregates_mem_50267") != 0)
            return 1;
        if (memblock_unref_device(ctx, &status_flags_mem_50245, "status_flags_mem_50245") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49414, "mem_49414") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49412, "mem_49412") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49410, "mem_49410") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_50217, "mem_out_50217") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_50216, "mem_out_50216") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_50215, "mem_out_50215") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_50214, "mem_out_50214") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_50213, "mem_out_50213") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_50212, "mem_out_50212") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_50211, "mem_out_50211") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_50210, "mem_out_50210") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_50209, "mem_out_50209") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_50208, "mem_out_50208") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_50207, "mem_out_50207") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_50206, "mem_out_50206") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_50205, "mem_out_50205") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_50204, "mem_out_50204") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_50203, "mem_out_50203") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_50202, "mem_out_50202") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_50201, "mem_out_50201") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_50200, "mem_out_50200") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_50199, "mem_out_50199") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_50198, "mem_out_50198") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_50197, "mem_out_50197") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_50196, "mem_out_50196") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_50195, "mem_out_50195") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_50194, "mem_out_50194") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_50193, "mem_out_50193") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_50192, "mem_out_50192") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_50191, "mem_out_50191") != 0)
            return 1;
    }
    return err;
}
FUTHARK_FUN_ATTR int futrts_entry_do_DBSCAN_double(struct futhark_context *ctx, struct memblock_device *mem_out_p_52131, struct memblock_device *mem_out_p_52132, struct memblock_device *mem_out_p_52133, struct memblock_device *mem_out_p_52134, struct memblock_device *mem_out_p_52135, struct memblock_device *mem_out_p_52136, struct memblock_device *mem_out_p_52137, struct memblock_device *mem_out_p_52138, struct memblock_device *mem_out_p_52139, struct memblock_device *mem_out_p_52140, struct memblock_device *mem_out_p_52141, struct memblock_device *mem_out_p_52142, struct memblock_device *mem_out_p_52143, struct memblock_device *mem_out_p_52144, struct memblock_device *mem_out_p_52145, struct memblock_device *mem_out_p_52146, struct memblock_device *mem_out_p_52147, struct memblock_device *mem_out_p_52148, struct memblock_device *mem_out_p_52149, struct memblock_device *mem_out_p_52150, struct memblock_device *mem_out_p_52151, struct memblock_device *mem_out_p_52152, struct memblock_device *mem_out_p_52153, struct memblock_device *mem_out_p_52154, struct memblock_device *mem_out_p_52155, struct memblock_device *mem_out_p_52156, struct memblock_device *mem_out_p_52157, int64_t *out_prim_out_52158, int8_t *out_prim_out_52159, int8_t *out_prim_out_52160, double *out_prim_out_52161, int64_t *out_prim_out_52162, int64_t *out_prim_out_52163, double *out_prim_out_52164, int64_t *out_prim_out_52165, int64_t *out_prim_out_52166, int64_t *out_prim_out_52167, int64_t *out_prim_out_52168, int64_t *out_prim_out_52169, int64_t *out_prim_out_52170, int64_t *out_prim_out_52171, struct memblock_device chain_collisions_mem_49374, struct memblock_device chain_collisions_mem_49375, struct memblock_device clBase_mem_49376, struct memblock_device clBase_mem_49377, struct memblock_device clBase_mem_49378, struct memblock_device clBase_mem_49379, struct memblock_device clProc_mem_49380, struct memblock_device clProc_mem_49381, struct memblock_device clProc_mem_49382, struct memblock_device clProc_mem_49383, struct memblock_device clProc_mem_49384, struct memblock_device clProc_mem_49385, struct memblock_device current_partition_mem_49386, struct memblock_device current_partition_mem_49387, struct memblock_device current_partition_mem_49388, struct memblock_device current_partition_mem_49389, struct memblock_device current_partition_mem_49390, struct memblock_device current_partition_mem_49391, struct memblock_device current_partition_mem_49392, struct memblock_device current_partition_mem_49393, struct memblock_device current_partition_mem_49394, struct memblock_device current_partition_mem_49395, struct memblock_device current_partition_mem_49396, struct memblock_device current_partition_mem_49397, struct memblock_device toFlush_dat_mem_49398, struct memblock_device toFlush_dat_mem_49399, struct memblock_device toFlush_ids_mem_49400, int64_t n_34757, int64_t part_no_34758, int64_t dz2084U_34759, int64_t dz2080U_34760, int64_t dz2081U_34761, int64_t dz2082U_34762, int64_t dz2083U_34763, int64_t dz2085U_34764, int64_t dz2086U_34765, int8_t clBase_34768, int8_t clBase_34769, double clBase_34770, int64_t clBase_34771, int64_t clBase_34773, double clBase_34776, int64_t clBase_34778, int64_t clProc_34783, int64_t clProc_34784, int64_t clProc_34785, int64_t clProc_34787, int64_t clProc_34788, int64_t current_partition_34802, int64_t gather_psizze_34806)
{
    (void) ctx;
    
    int err = 0;
    struct memblock_device mem_50017;
    
    mem_50017.references = NULL;
    
    struct memblock_device mem_50015;
    
    mem_50015.references = NULL;
    
    struct memblock_device segred_tmp_mem_52030;
    
    segred_tmp_mem_52030.references = NULL;
    
    struct memblock_device segred_tmp_mem_52028;
    
    segred_tmp_mem_52028.references = NULL;
    
    struct memblock_device mem_49949;
    
    mem_49949.references = NULL;
    
    struct memblock_device mem_49944;
    
    mem_49944.references = NULL;
    
    struct memblock_device mem_49942;
    
    mem_49942.references = NULL;
    
    struct memblock_device mem_49940;
    
    mem_49940.references = NULL;
    
    struct memblock_device mem_49933;
    
    mem_49933.references = NULL;
    
    struct memblock_device mem_49931;
    
    mem_49931.references = NULL;
    
    struct memblock_device segred_tmp_mem_51871;
    
    segred_tmp_mem_51871.references = NULL;
    
    struct memblock_device segred_tmp_mem_51869;
    
    segred_tmp_mem_51869.references = NULL;
    
    struct memblock_device mem_49859;
    
    mem_49859.references = NULL;
    
    struct memblock_device mem_49854;
    
    mem_49854.references = NULL;
    
    struct memblock_device mem_49852;
    
    mem_49852.references = NULL;
    
    struct memblock_device mem_49850;
    
    mem_49850.references = NULL;
    
    struct memblock_device mem_49844;
    
    mem_49844.references = NULL;
    
    struct memblock_device mem_49842;
    
    mem_49842.references = NULL;
    
    struct memblock_device mem_49798;
    
    mem_49798.references = NULL;
    
    struct memblock_device mem_49838;
    
    mem_49838.references = NULL;
    
    struct memblock_device ext_mem_49839;
    
    ext_mem_49839.references = NULL;
    
    struct memblock_device mem_49494;
    
    mem_49494.references = NULL;
    
    struct memblock_device mem_49427;
    
    mem_49427.references = NULL;
    
    struct memblock_device mem_49426;
    
    mem_49426.references = NULL;
    
    struct memblock_device mem_49425;
    
    mem_49425.references = NULL;
    
    struct memblock_device mem_49424;
    
    mem_49424.references = NULL;
    
    struct memblock_device mem_49419;
    
    mem_49419.references = NULL;
    
    struct memblock_device mem_49417;
    
    mem_49417.references = NULL;
    
    struct memblock_device incprefixes_mem_51649;
    
    incprefixes_mem_51649.references = NULL;
    
    struct memblock_device aggregates_mem_51647;
    
    aggregates_mem_51647.references = NULL;
    
    struct memblock_device status_flags_mem_51645;
    
    status_flags_mem_51645.references = NULL;
    
    struct memblock_device mem_49929;
    
    mem_49929.references = NULL;
    
    struct memblock_device mem_49927;
    
    mem_49927.references = NULL;
    
    struct memblock_device mem_49757;
    
    mem_49757.references = NULL;
    
    struct memblock_device mem_49755;
    
    mem_49755.references = NULL;
    
    struct memblock_device incprefixes_mem_51532;
    
    incprefixes_mem_51532.references = NULL;
    
    struct memblock_device aggregates_mem_51530;
    
    aggregates_mem_51530.references = NULL;
    
    struct memblock_device status_flags_mem_51528;
    
    status_flags_mem_51528.references = NULL;
    
    struct memblock_device mem_49746;
    
    mem_49746.references = NULL;
    
    struct memblock_device mem_49743;
    
    mem_49743.references = NULL;
    
    struct memblock_device mem_49678;
    
    mem_49678.references = NULL;
    
    struct memblock_device mem_49740;
    
    mem_49740.references = NULL;
    
    struct memblock_device ext_mem_49741;
    
    ext_mem_49741.references = NULL;
    
    struct memblock_device ext_mem_49752;
    
    ext_mem_49752.references = NULL;
    
    struct memblock_device ext_mem_49753;
    
    ext_mem_49753.references = NULL;
    
    struct memblock_device mem_49615;
    
    mem_49615.references = NULL;
    
    struct memblock_device mem_49613;
    
    mem_49613.references = NULL;
    
    struct memblock_device mem_param_tmp_51329;
    
    mem_param_tmp_51329.references = NULL;
    
    struct memblock_device mem_49607;
    
    mem_49607.references = NULL;
    
    struct memblock_device mem_param_49604;
    
    mem_param_49604.references = NULL;
    
    struct memblock_device ext_mem_49610;
    
    ext_mem_49610.references = NULL;
    
    struct memblock_device mem_49601;
    
    mem_49601.references = NULL;
    
    struct memblock_device incprefixes_mem_51229;
    
    incprefixes_mem_51229.references = NULL;
    
    struct memblock_device aggregates_mem_51227;
    
    aggregates_mem_51227.references = NULL;
    
    struct memblock_device status_flags_mem_51225;
    
    status_flags_mem_51225.references = NULL;
    
    struct memblock_device mem_49598;
    
    mem_49598.references = NULL;
    
    struct memblock_device mem_param_tmp_51078;
    
    mem_param_tmp_51078.references = NULL;
    
    struct memblock_device segred_tmp_mem_51186;
    
    segred_tmp_mem_51186.references = NULL;
    
    struct memblock_device mem_param_tmp_51081;
    
    mem_param_tmp_51081.references = NULL;
    
    struct memblock_device mem_49587;
    
    mem_49587.references = NULL;
    
    struct memblock_device segred_tmp_mem_51143;
    
    segred_tmp_mem_51143.references = NULL;
    
    struct memblock_device mem_49530;
    
    mem_49530.references = NULL;
    
    struct memblock_device mem_49527;
    
    mem_49527.references = NULL;
    
    struct memblock_device mem_49525;
    
    mem_49525.references = NULL;
    
    struct memblock_device mem_49523;
    
    mem_49523.references = NULL;
    
    struct memblock_device mem_49584;
    
    mem_49584.references = NULL;
    
    struct memblock_device ext_mem_49585;
    
    ext_mem_49585.references = NULL;
    
    struct memblock_device mem_param_49520;
    
    mem_param_49520.references = NULL;
    
    struct memblock_device ext_mem_49590;
    
    ext_mem_49590.references = NULL;
    
    struct memblock_device mem_param_49517;
    
    mem_param_49517.references = NULL;
    
    struct memblock_device ext_mem_49595;
    
    ext_mem_49595.references = NULL;
    
    struct memblock_device mem_49592;
    
    mem_49592.references = NULL;
    
    struct memblock_device mem_49514;
    
    mem_49514.references = NULL;
    
    struct memblock_device mem_49512;
    
    mem_49512.references = NULL;
    
    struct memblock_device mem_49510;
    
    mem_49510.references = NULL;
    
    struct memblock_device incprefixes_mem_50986;
    
    incprefixes_mem_50986.references = NULL;
    
    struct memblock_device aggregates_mem_50984;
    
    aggregates_mem_50984.references = NULL;
    
    struct memblock_device status_flags_mem_50982;
    
    status_flags_mem_50982.references = NULL;
    
    struct memblock_device mem_49508;
    
    mem_49508.references = NULL;
    
    struct memblock_device mem_49506;
    
    mem_49506.references = NULL;
    
    struct memblock_device mem_49503;
    
    mem_49503.references = NULL;
    
    struct memblock_device mem_49500;
    
    mem_49500.references = NULL;
    
    struct memblock_device mem_49498;
    
    mem_49498.references = NULL;
    
    struct memblock_device mem_49496;
    
    mem_49496.references = NULL;
    
    struct memblock_device incprefixes_mem_50869;
    
    incprefixes_mem_50869.references = NULL;
    
    struct memblock_device aggregates_mem_50867;
    
    aggregates_mem_50867.references = NULL;
    
    struct memblock_device status_flags_mem_50865;
    
    status_flags_mem_50865.references = NULL;
    
    struct memblock_device mem_49492;
    
    mem_49492.references = NULL;
    
    struct memblock_device mem_49490;
    
    mem_49490.references = NULL;
    
    struct memblock_device mem_49487;
    
    mem_49487.references = NULL;
    
    struct memblock_device ext_mem_49484;
    
    ext_mem_49484.references = NULL;
    
    struct memblock_device mem_49482;
    
    mem_49482.references = NULL;
    
    struct memblock_device mem_49480;
    
    mem_49480.references = NULL;
    
    struct memblock_device mem_49478;
    
    mem_49478.references = NULL;
    
    struct memblock_device incprefixes_mem_50731;
    
    incprefixes_mem_50731.references = NULL;
    
    struct memblock_device aggregates_mem_50729;
    
    aggregates_mem_50729.references = NULL;
    
    struct memblock_device status_flags_mem_50727;
    
    status_flags_mem_50727.references = NULL;
    
    struct memblock_device mem_49476;
    
    mem_49476.references = NULL;
    
    struct memblock_device mem_49475;
    
    mem_49475.references = NULL;
    
    struct memblock_device mem_49473;
    
    mem_49473.references = NULL;
    
    struct memblock_device ext_mem_49470;
    
    ext_mem_49470.references = NULL;
    
    struct memblock_device ext_mem_49469;
    
    ext_mem_49469.references = NULL;
    
    struct memblock_device mem_49467;
    
    mem_49467.references = NULL;
    
    struct memblock_device mem_49464;
    
    mem_49464.references = NULL;
    
    struct memblock_device ext_mem_49462;
    
    ext_mem_49462.references = NULL;
    
    struct memblock_device mem_49460;
    
    mem_49460.references = NULL;
    
    struct memblock_device mem_49458;
    
    mem_49458.references = NULL;
    
    struct memblock_device mem_49456;
    
    mem_49456.references = NULL;
    
    struct memblock_device mem_49454;
    
    mem_49454.references = NULL;
    
    struct memblock_device incprefixes_mem_50568;
    
    incprefixes_mem_50568.references = NULL;
    
    struct memblock_device aggregates_mem_50566;
    
    aggregates_mem_50566.references = NULL;
    
    struct memblock_device incprefixes_mem_50564;
    
    incprefixes_mem_50564.references = NULL;
    
    struct memblock_device aggregates_mem_50562;
    
    aggregates_mem_50562.references = NULL;
    
    struct memblock_device status_flags_mem_50560;
    
    status_flags_mem_50560.references = NULL;
    
    struct memblock_device mem_49452;
    
    mem_49452.references = NULL;
    
    struct memblock_device mem_49450;
    
    mem_49450.references = NULL;
    
    struct memblock_device mem_49448;
    
    mem_49448.references = NULL;
    
    struct memblock_device mem_49444;
    
    mem_49444.references = NULL;
    
    struct memblock_device mem_49442;
    
    mem_49442.references = NULL;
    
    struct memblock_device mem_49440;
    
    mem_49440.references = NULL;
    
    struct memblock_device mem_49438;
    
    mem_49438.references = NULL;
    
    struct memblock_device incprefixes_mem_50448;
    
    incprefixes_mem_50448.references = NULL;
    
    struct memblock_device aggregates_mem_50446;
    
    aggregates_mem_50446.references = NULL;
    
    struct memblock_device status_flags_mem_50444;
    
    status_flags_mem_50444.references = NULL;
    
    struct memblock_device mem_49436;
    
    mem_49436.references = NULL;
    
    struct memblock_device mem_49434;
    
    mem_49434.references = NULL;
    
    struct memblock_device mem_49432;
    
    mem_49432.references = NULL;
    
    struct memblock_device mem_49429;
    
    mem_49429.references = NULL;
    
    struct memblock_device mem_49428;
    
    mem_49428.references = NULL;
    
    struct memblock_device ext_mem_49422;
    
    ext_mem_49422.references = NULL;
    
    struct memblock_device mem_49421;
    
    mem_49421.references = NULL;
    
    struct memblock_device mem_49415;
    
    mem_49415.references = NULL;
    
    struct memblock_device mem_49413;
    
    mem_49413.references = NULL;
    
    struct memblock_device mem_49411;
    
    mem_49411.references = NULL;
    
    struct memblock_device mem_49409;
    
    mem_49409.references = NULL;
    
    struct memblock_device mem_49407;
    
    mem_49407.references = NULL;
    
    struct memblock_device incprefixes_mem_50264;
    
    incprefixes_mem_50264.references = NULL;
    
    struct memblock_device aggregates_mem_50262;
    
    aggregates_mem_50262.references = NULL;
    
    struct memblock_device status_flags_mem_50240;
    
    status_flags_mem_50240.references = NULL;
    
    struct memblock_device mem_49405;
    
    mem_49405.references = NULL;
    
    struct memblock_device mem_49403;
    
    mem_49403.references = NULL;
    
    struct memblock_device mem_out_50217;
    
    mem_out_50217.references = NULL;
    
    struct memblock_device mem_out_50216;
    
    mem_out_50216.references = NULL;
    
    struct memblock_device mem_out_50215;
    
    mem_out_50215.references = NULL;
    
    struct memblock_device mem_out_50214;
    
    mem_out_50214.references = NULL;
    
    struct memblock_device mem_out_50213;
    
    mem_out_50213.references = NULL;
    
    struct memblock_device mem_out_50212;
    
    mem_out_50212.references = NULL;
    
    struct memblock_device mem_out_50211;
    
    mem_out_50211.references = NULL;
    
    struct memblock_device mem_out_50210;
    
    mem_out_50210.references = NULL;
    
    struct memblock_device mem_out_50209;
    
    mem_out_50209.references = NULL;
    
    struct memblock_device mem_out_50208;
    
    mem_out_50208.references = NULL;
    
    struct memblock_device mem_out_50207;
    
    mem_out_50207.references = NULL;
    
    struct memblock_device mem_out_50206;
    
    mem_out_50206.references = NULL;
    
    struct memblock_device mem_out_50205;
    
    mem_out_50205.references = NULL;
    
    struct memblock_device mem_out_50204;
    
    mem_out_50204.references = NULL;
    
    struct memblock_device mem_out_50203;
    
    mem_out_50203.references = NULL;
    
    struct memblock_device mem_out_50202;
    
    mem_out_50202.references = NULL;
    
    struct memblock_device mem_out_50201;
    
    mem_out_50201.references = NULL;
    
    struct memblock_device mem_out_50200;
    
    mem_out_50200.references = NULL;
    
    struct memblock_device mem_out_50199;
    
    mem_out_50199.references = NULL;
    
    struct memblock_device mem_out_50198;
    
    mem_out_50198.references = NULL;
    
    struct memblock_device mem_out_50197;
    
    mem_out_50197.references = NULL;
    
    struct memblock_device mem_out_50196;
    
    mem_out_50196.references = NULL;
    
    struct memblock_device mem_out_50195;
    
    mem_out_50195.references = NULL;
    
    struct memblock_device mem_out_50194;
    
    mem_out_50194.references = NULL;
    
    struct memblock_device mem_out_50193;
    
    mem_out_50193.references = NULL;
    
    struct memblock_device mem_out_50192;
    
    mem_out_50192.references = NULL;
    
    struct memblock_device mem_out_50191;
    
    mem_out_50191.references = NULL;
    
    struct memblock_device counters_mem_50201 = ctx->constants->counters_mem_50201;
    struct memblock_device counters_mem_50275 = ctx->constants->counters_mem_50275;
    struct memblock_device counters_mem_50707 = ctx->constants->counters_mem_50707;
    struct memblock_device counters_mem_51122 = ctx->constants->counters_mem_51122;
    struct memblock_device counters_mem_51145 = ctx->constants->counters_mem_51145;
    struct memblock_device counters_mem_51184 = ctx->constants->counters_mem_51184;
    struct memblock_device counters_mem_51873 = ctx->constants->counters_mem_51873;
    struct memblock_device counters_mem_52032 = ctx->constants->counters_mem_52032;
    struct memblock_device global_dynid_mem_50266 = ctx->constants->global_dynid_mem_50266;
    struct memblock_device global_dynid_mem_50275 = ctx->constants->global_dynid_mem_50275;
    struct memblock_device global_dynid_mem_50287 = ctx->constants->global_dynid_mem_50287;
    struct memblock_device global_dynid_mem_50292 = ctx->constants->global_dynid_mem_50292;
    struct memblock_device global_dynid_mem_50450 = ctx->constants->global_dynid_mem_50450;
    struct memblock_device global_dynid_mem_50529 = ctx->constants->global_dynid_mem_50529;
    struct memblock_device global_dynid_mem_50570 = ctx->constants->global_dynid_mem_50570;
    struct memblock_device global_dynid_mem_50733 = ctx->constants->global_dynid_mem_50733;
    struct memblock_device global_dynid_mem_50769 = ctx->constants->global_dynid_mem_50769;
    struct memblock_device global_dynid_mem_50871 = ctx->constants->global_dynid_mem_50871;
    struct memblock_device global_dynid_mem_50875 = ctx->constants->global_dynid_mem_50875;
    struct memblock_device global_dynid_mem_50988 = ctx->constants->global_dynid_mem_50988;
    struct memblock_device global_dynid_mem_51231 = ctx->constants->global_dynid_mem_51231;
    struct memblock_device global_dynid_mem_51378 = ctx->constants->global_dynid_mem_51378;
    struct memblock_device global_dynid_mem_51534 = ctx->constants->global_dynid_mem_51534;
    struct memblock_device global_dynid_mem_51651 = ctx->constants->global_dynid_mem_51651;
    int64_t prim_out_50218;
    int8_t prim_out_50219;
    int8_t prim_out_50220;
    double prim_out_50221;
    int64_t prim_out_50222;
    int64_t prim_out_50223;
    double prim_out_50224;
    int64_t prim_out_50225;
    int64_t prim_out_50226;
    int64_t prim_out_50227;
    int64_t prim_out_50228;
    int64_t prim_out_50229;
    int64_t prim_out_50230;
    int64_t prim_out_50231;
    double zt_res_41216 = 2.0 * clBase_34770;
    int64_t segscan_tblock_sizze_44348;
    
    segscan_tblock_sizze_44348 = *ctx->tuning_params.do_DBSCAN_doublezisegscan_tblock_sizze_44347;
    
    int64_t num_tblocks_44350;
    int64_t max_num_tblocks_50232;
    
    max_num_tblocks_50232 = *ctx->tuning_params.do_DBSCAN_doublezisegscan_num_tblocks_44349;
    num_tblocks_44350 = sext_i64_i32(smax64((int64_t) 1, smin64(sdiv_up64(n_34757, segscan_tblock_sizze_44348), max_num_tblocks_50232)));
    
    int64_t bytes_49402 = (int64_t) 8 * n_34757;
    
    if (memblock_alloc_device(ctx, &mem_49403, bytes_49402, "mem_49403")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_49405, bytes_49402, "mem_49405")) {
        err = 1;
        goto cleanup;
    }
    if (slt64((int64_t) 0, n_34757)) {
        if (ctx->debugging)
            fprintf(ctx->log, "%s\n", "\n# SegScan");
        
        int64_t shared_memory_50233;
        
        shared_memory_50233 = ctx->max_shared_memory;
        
        int64_t thread_block_sizze_50234;
        
        thread_block_sizze_50234 = ctx->max_thread_block_size;
        
        int64_t registers_50235;
        
        registers_50235 = ctx->max_registers;
        
        int64_t thread_block_sizze_50236;
        
        thread_block_sizze_50236 = ctx->max_thread_block_size;
        
        int64_t chunk_sizze_50237 = smax64((int64_t) 1, smin64(squot64(squot64(shared_memory_50233, thread_block_sizze_50234), (int64_t) 8), squot64(squot64(registers_50235, thread_block_sizze_50236) - (int64_t) 1 - squot64(smax64((int64_t) 4, (int64_t) 8), (int64_t) 4), (int64_t) 2 * squot64(smax64((int64_t) 4, (int64_t) 8), (int64_t) 4))));
        int64_t num_virt_blocks_50238 = sdiv_up64(n_34757, segscan_tblock_sizze_44348 * chunk_sizze_50237);
        int64_t num_virt_threads_50239 = num_virt_blocks_50238 * segscan_tblock_sizze_44348;
        
        if (ctx->debugging)
            fprintf(ctx->log, "%s: %llu%c", "Sequential elements per thread (chunk)", (long long) chunk_sizze_50237, '\n');
        if (memblock_alloc_device(ctx, &status_flags_mem_50240, num_virt_blocks_50238, "status_flags_mem_50240")) {
            err = 1;
            goto cleanup;
        }
        if (futrts_builtinzhreplicate_i8(ctx, status_flags_mem_50240, num_virt_blocks_50238, (int8_t) 0) != 0) {
            err = 1;
            goto cleanup;
        }
        if (memblock_alloc_device(ctx, &aggregates_mem_50262, (int64_t) 8 * num_virt_blocks_50238, "aggregates_mem_50262")) {
            err = 1;
            goto cleanup;
        }
        if (memblock_alloc_device(ctx, &incprefixes_mem_50264, (int64_t) 8 * num_virt_blocks_50238, "incprefixes_mem_50264")) {
            err = 1;
            goto cleanup;
        }
        {
            err = gpu_kernel_do_DBSCAN_doublezisegscan_44353(ctx, num_tblocks_44350, 1, 1, *ctx->tuning_params.do_DBSCAN_doublezisegscan_tblock_sizze_44347, 1, 1, smax64(smax64((int64_t) 288, (int64_t) 8 * segscan_tblock_sizze_44348), chunk_sizze_50237 * segscan_tblock_sizze_44348 * (int64_t) 8) + srem64((int64_t) 8 - srem64(smax64(smax64((int64_t) 288, (int64_t) 8 * segscan_tblock_sizze_44348), chunk_sizze_50237 * segscan_tblock_sizze_44348 * (int64_t) 8), (int64_t) 8), (int64_t) 8), n_34757, num_tblocks_44350, num_virt_blocks_50238, num_virt_threads_50239, current_partition_mem_49394.mem, mem_49403.mem, mem_49405.mem, status_flags_mem_50240.mem, aggregates_mem_50262.mem, incprefixes_mem_50264.mem, global_dynid_mem_50266.mem);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        if (ctx->debugging)
            fprintf(ctx->log, "%s\n", "");
    }
    if (memblock_alloc_device(ctx, &mem_49407, bytes_49402, "mem_49407")) {
        err = 1;
        goto cleanup;
    }
    if ((err = lmad_copy_gpu2gpu_8b(ctx, 1, mem_49407.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, current_partition_mem_49387.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, (int64_t []) {n_34757})) != 0)
        goto cleanup;
    if (memblock_alloc_device(ctx, &mem_49409, bytes_49402, "mem_49409")) {
        err = 1;
        goto cleanup;
    }
    if ((err = lmad_copy_gpu2gpu_8b(ctx, 1, mem_49409.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, current_partition_mem_49388.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, (int64_t []) {n_34757})) != 0)
        goto cleanup;
    
    bool cond_41229 = n_34757 == (int64_t) 0;
    bool x_41230 = !cond_41229;
    int64_t tmp_41231 = sub64(n_34757, (int64_t) 1);
    bool x_41232 = sle64((int64_t) 0, tmp_41231);
    bool y_41233 = slt64(tmp_41231, n_34757);
    bool bounds_check_41234 = x_41232 && y_41233;
    bool protect_assert_disj_41235 = cond_41229 || bounds_check_41234;
    bool index_certs_41236;
    
    if (!protect_assert_disj_41235) {
        set_error(ctx, msgprintf("Error: %s%lld%s%lld%s\n\nBacktrace:\n%s", "Index [", (long long) tmp_41231, "] out of bounds for array of shape [", (long long) n_34757, "].", "-> #0  /prelude/soacs.fut:257:33-47\n   #1  /prelude/functional.fut:9:44-45\n   #2  ft_libs/ftDBSCAN_plus.fut:863:18-866:67\n   #3  ft_libs/ftDBSCAN_plus.fut:862:9-866:67\n"));
        err = FUTHARK_PROGRAM_ERROR;
        goto cleanup;
    }
    
    int64_t m_f_res_41237;
    
    if (x_41230) {
        int64_t read_res_52172;
        
        if ((err = gpu_scalar_from_device(ctx, &read_res_52172, mem_49403.mem, tmp_41231 * sizeof(int64_t), sizeof(int64_t))) != 0)
            goto cleanup;
        if (ctx->failure_is_an_option && futhark_context_sync(ctx) != 0) {
            err = 1;
            goto cleanup;
        }
        
        int64_t x_42672 = read_res_52172;
        
        m_f_res_41237 = x_42672;
    } else {
        m_f_res_41237 = (int64_t) 0;
    }
    
    int64_t m_41239;
    
    if (cond_41229) {
        m_41239 = (int64_t) 0;
    } else {
        m_41239 = m_f_res_41237;
    }
    
    int64_t m_41249 = sub64(m_41239, (int64_t) 1);
    bool i_p_m_t_s_leq_w_41251 = slt64(m_41249, n_34757);
    bool zzero_leq_i_p_m_t_s_41250 = sle64((int64_t) 0, m_41249);
    bool y_41253 = zzero_leq_i_p_m_t_s_41250 && i_p_m_t_s_leq_w_41251;
    bool i_lte_j_41252 = sle64((int64_t) 0, m_41239);
    bool forwards_ok_41254 = i_lte_j_41252 && y_41253;
    bool eq_x_zz_41246 = (int64_t) 0 == m_f_res_41237;
    bool p_and_eq_x_y_41247 = x_41230 && eq_x_zz_41246;
    bool empty_slice_41248 = cond_41229 || p_and_eq_x_y_41247;
    bool ok_or_empty_41255 = empty_slice_41248 || forwards_ok_41254;
    bool index_certs_41256;
    
    if (!ok_or_empty_41255) {
        set_error(ctx, msgprintf("Error: %s%lld%s%lld%s\n\nBacktrace:\n%s", "Index [:", (long long) m_41239, "] out of bounds for array of shape [", (long long) n_34757, "].", "-> #0  /prelude/soacs.fut:258:29-35\n   #1  /prelude/functional.fut:9:44-45\n   #2  ft_libs/ftDBSCAN_plus.fut:863:18-866:67\n   #3  ft_libs/ftDBSCAN_plus.fut:862:9-866:67\n"));
        err = FUTHARK_PROGRAM_ERROR;
        goto cleanup;
    }
    
    int64_t bytes_49410 = (int64_t) 8 * m_41239;
    
    if (memblock_alloc_device(ctx, &mem_49411, bytes_49410, "mem_49411")) {
        err = 1;
        goto cleanup;
    }
    if ((err = lmad_copy_gpu2gpu_8b(ctx, 1, mem_49411.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, mem_49409.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, (int64_t []) {m_41239})) != 0)
        goto cleanup;
    if (memblock_alloc_device(ctx, &mem_49413, bytes_49410, "mem_49413")) {
        err = 1;
        goto cleanup;
    }
    if ((err = lmad_copy_gpu2gpu_8b(ctx, 1, mem_49413.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, mem_49407.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, (int64_t []) {m_41239})) != 0)
        goto cleanup;
    if (memblock_alloc_device(ctx, &mem_49415, bytes_49410, "mem_49415")) {
        err = 1;
        goto cleanup;
    }
    if (futrts_builtinzhiota_i64(ctx, mem_49415, m_41239, (int64_t) 0, (int64_t) 1) != 0) {
        err = 1;
        goto cleanup;
    }
    
    int64_t segmap_tblock_sizze_44358;
    
    segmap_tblock_sizze_44358 = *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_44357;
    
    int64_t num_tblocks_44360;
    int64_t max_num_tblocks_50392;
    
    max_num_tblocks_50392 = *ctx->tuning_params.do_DBSCAN_doublezisegmap_num_tblocks_44359;
    num_tblocks_44360 = sext_i64_i32(smax64((int64_t) 1, smin64(sdiv_up64(n_34757, segmap_tblock_sizze_44358), max_num_tblocks_50392)));
    if (ctx->debugging)
        fprintf(ctx->log, "%s\n", "\n# SegMap");
    
    int32_t virt_num_tblocks_50393 = sext_i64_i32(sdiv_up64(n_34757, segmap_tblock_sizze_44358));
    
    {
        err = gpu_kernel_do_DBSCAN_doublezisegmap_44355(ctx, num_tblocks_44360, 1, 1, *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_44357, 1, 1, (int64_t) 0, n_34757, m_41239, num_tblocks_44360, virt_num_tblocks_50393, current_partition_mem_49387.mem, current_partition_mem_49388.mem, mem_49403.mem, mem_49405.mem, mem_49411.mem, mem_49413.mem, mem_49415.mem);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (ctx->debugging)
        fprintf(ctx->log, "%s\n", "");
    if (memblock_unref_device(ctx, &mem_49403, "mem_49403") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_49405, "mem_49405") != 0)
        return 1;
    
    int64_t segscan_tblock_sizze_44364;
    
    segscan_tblock_sizze_44364 = *ctx->tuning_params.do_DBSCAN_doublezisegscan_tblock_sizze_44363;
    
    int64_t num_tblocks_44366;
    int64_t max_num_tblocks_50406;
    
    max_num_tblocks_50406 = *ctx->tuning_params.do_DBSCAN_doublezisegscan_num_tblocks_44365;
    num_tblocks_44366 = sext_i64_i32(smax64((int64_t) 1, smin64(sdiv_up64(dz2082U_34762, segscan_tblock_sizze_44364), max_num_tblocks_50406)));
    
    bool cond_41308 = dz2082U_34762 == (int64_t) 0;
    bool x_41309 = !cond_41308;
    int64_t tmp_41310 = sub64(dz2082U_34762, (int64_t) 1);
    bool x_41311 = sle64((int64_t) 0, tmp_41310);
    bool y_41312 = slt64(tmp_41310, dz2082U_34762);
    bool bounds_check_41313 = x_41311 && y_41312;
    bool protect_assert_disj_41314 = cond_41308 || bounds_check_41313;
    bool index_certs_41315;
    
    if (!protect_assert_disj_41314) {
        set_error(ctx, msgprintf("Error: %s%lld%s%lld%s\n\nBacktrace:\n%s", "Index [", (long long) tmp_41310, "] out of bounds for array of shape [", (long long) dz2082U_34762, "].", "-> #0  /prelude/soacs.fut:257:33-47\n   #1  /prelude/functional.fut:9:44-45\n   #2  ft_libs/ftDBSCAN_plus.fut:863:18-866:67\n   #3  ft_libs/ftDBSCAN_plus.fut:862:9-866:67\n"));
        err = FUTHARK_PROGRAM_ERROR;
        goto cleanup;
    }
    
    int64_t segmap_tblock_sizze_44374;
    
    segmap_tblock_sizze_44374 = *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_44373;
    
    int64_t num_tblocks_44376;
    int64_t max_num_tblocks_50407;
    
    max_num_tblocks_50407 = *ctx->tuning_params.do_DBSCAN_doublezisegmap_num_tblocks_44375;
    num_tblocks_44376 = sext_i64_i32(smax64((int64_t) 1, smin64(sdiv_up64(dz2082U_34762, segmap_tblock_sizze_44374), max_num_tblocks_50407)));
    
    int64_t segscan_tblock_sizze_44380;
    
    segscan_tblock_sizze_44380 = *ctx->tuning_params.do_DBSCAN_doublezisegscan_tblock_sizze_44379;
    
    int64_t segmap_tblock_sizze_44390;
    
    segmap_tblock_sizze_44390 = *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_44389;
    
    int64_t segscan_tblock_sizze_44396;
    
    segscan_tblock_sizze_44396 = *ctx->tuning_params.do_DBSCAN_doublezisegscan_tblock_sizze_44395;
    
    int64_t segmap_tblock_sizze_44406;
    
    segmap_tblock_sizze_44406 = *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_44405;
    
    int64_t bytes_49418 = (int64_t) 8 * dz2081U_34761;
    
    if (memblock_alloc_device(ctx, &mem_49421, bytes_49402, "mem_49421")) {
        err = 1;
        goto cleanup;
    }
    if (futrts_builtinzhreplicate_i64(ctx, mem_49421, n_34757, (int64_t) 0) != 0) {
        err = 1;
        goto cleanup;
    }
    
    int64_t segmap_tblock_sizze_44414;
    
    segmap_tblock_sizze_44414 = *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_44413;
    
    int64_t num_tblocks_44416;
    int64_t max_num_tblocks_50428;
    
    max_num_tblocks_50428 = *ctx->tuning_params.do_DBSCAN_doublezisegmap_num_tblocks_44415;
    num_tblocks_44416 = sext_i64_i32(smax64((int64_t) 1, smin64(sdiv_up64(m_41239, segmap_tblock_sizze_44414), max_num_tblocks_50428)));
    if (futrts_get_num_neighbours_against_9632(ctx, &ext_mem_49422, current_partition_mem_49387, current_partition_mem_49388, current_partition_mem_49387, current_partition_mem_49388, n_34757, n_34757, clBase_34770, clBase_34769, clBase_34768, clBase_34776, clBase_34771) != 0) {
        err = 1;
        goto cleanup;
    }
    
    int64_t segmap_tblock_sizze_44431;
    
    segmap_tblock_sizze_44431 = *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_44421;
    
    int64_t segmap_usable_groups_44432 = sdiv_up64(n_34757, segmap_tblock_sizze_44431);
    int64_t segscan_tblock_sizze_44442;
    
    segscan_tblock_sizze_44442 = *ctx->tuning_params.do_DBSCAN_doublezisegscan_tblock_sizze_44441;
    
    int64_t num_tblocks_44444;
    int64_t max_num_tblocks_50429;
    
    max_num_tblocks_50429 = *ctx->tuning_params.do_DBSCAN_doublezisegscan_num_tblocks_44443;
    num_tblocks_44444 = sext_i64_i32(smax64((int64_t) 1, smin64(sdiv_up64(n_34757, segscan_tblock_sizze_44442), max_num_tblocks_50429)));
    
    int64_t segmap_tblock_sizze_44452;
    
    segmap_tblock_sizze_44452 = *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_44451;
    
    int64_t num_tblocks_44454;
    int64_t max_num_tblocks_50430;
    
    max_num_tblocks_50430 = *ctx->tuning_params.do_DBSCAN_doublezisegmap_num_tblocks_44453;
    num_tblocks_44454 = sext_i64_i32(smax64((int64_t) 1, smin64(sdiv_up64(n_34757, segmap_tblock_sizze_44452), max_num_tblocks_50430)));
    
    int64_t segscan_tblock_sizze_44458;
    
    segscan_tblock_sizze_44458 = *ctx->tuning_params.do_DBSCAN_doublezisegscan_tblock_sizze_44457;
    
    int64_t max_arg1_41691 = sdiv64(gather_psizze_34806, (int64_t) 8);
    int64_t max_res_41692 = smax64((int64_t) 1, max_arg1_41691);
    bool zzero_41695 = max_res_41692 == (int64_t) 0;
    bool nonzzero_41696 = !zzero_41695;
    bool nonzzero_cert_41697;
    
    if (!nonzzero_41696) {
        set_error(ctx, msgprintf("Error: %s\n\nBacktrace:\n%s", "division by zero", "-> #0  ft_libs/ftbasics.fut:27:31-39\n   #1  ft_libs/ftDBSCAN_plus.fut:863:18-866:67\n   #2  ft_libs/ftDBSCAN_plus.fut:862:9-866:67\n"));
        err = FUTHARK_PROGRAM_ERROR;
        goto cleanup;
    }
    
    int64_t segmap_tblock_sizze_44641;
    
    segmap_tblock_sizze_44641 = *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_44626;
    
    int64_t segred_tblock_sizze_44659;
    
    segred_tblock_sizze_44659 = *ctx->tuning_params.do_DBSCAN_doublezisegred_tblock_sizze_44574;
    
    int64_t segred_tblock_sizze_44708;
    
    segred_tblock_sizze_44708 = *ctx->tuning_params.do_DBSCAN_doublezisegred_tblock_sizze_44707;
    
    int64_t tile_sizze_46537;
    
    tile_sizze_46537 = *ctx->tuning_params.do_DBSCAN_doublezitile_sizze_46536;
    
    bool match_val_49365 = clBase_34769 == (int8_t) 0;
    bool x_49366 = !match_val_49365;
    int64_t segscan_tblock_sizze_44718;
    
    segscan_tblock_sizze_44718 = *ctx->tuning_params.do_DBSCAN_doublezisegscan_tblock_sizze_44717;
    
    int64_t segmap_tblock_sizze_44739;
    
    segmap_tblock_sizze_44739 = *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_44727;
    
    int64_t segmap_tblock_sizze_44770;
    
    segmap_tblock_sizze_44770 = *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_44753;
    
    int64_t segmap_tblock_sizze_44797;
    
    segmap_tblock_sizze_44797 = *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_44789;
    
    int64_t segmap_tblock_sizze_44808;
    
    segmap_tblock_sizze_44808 = *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_44807;
    
    int64_t segscan_tblock_sizze_45205;
    
    segscan_tblock_sizze_45205 = *ctx->tuning_params.do_DBSCAN_doublezisegscan_tblock_sizze_45104;
    
    int64_t segscan_tblock_sizze_44852;
    
    segscan_tblock_sizze_44852 = *ctx->tuning_params.do_DBSCAN_doublezisegscan_tblock_sizze_44844;
    
    int64_t tile_sizze_47272;
    
    tile_sizze_47272 = *ctx->tuning_params.do_DBSCAN_doublezitile_sizze_47271;
    
    int64_t tile_sizze_46917;
    
    tile_sizze_46917 = *ctx->tuning_params.do_DBSCAN_doublezitile_sizze_46916;
    
    int64_t segmap_tblock_sizze_45221;
    
    segmap_tblock_sizze_45221 = *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_45220;
    
    int64_t segscan_tblock_sizze_45672;
    
    segscan_tblock_sizze_45672 = *ctx->tuning_params.do_DBSCAN_doublezisegscan_tblock_sizze_45671;
    if (memblock_alloc_device(ctx, &mem_49428, (int64_t) 8, "mem_49428")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_49429, (int64_t) 8, "mem_49429")) {
        err = 1;
        goto cleanup;
    }
    {
        err = gpu_kernel_do_DBSCAN_doublezigpuseq_50431(ctx, (int64_t) 1, 1, 1, (int64_t) 1, 1, 1, (int64_t) 0, clBase_34770, zt_res_41216, current_partition_mem_49396.mem, mem_49428.mem, mem_49429.mem);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    
    int64_t bytes_49431 = (int64_t) 8 * dz2082U_34762;
    
    if (memblock_alloc_device(ctx, &mem_49432, bytes_49431, "mem_49432")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_49434, bytes_49431, "mem_49434")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_49436, bytes_49431, "mem_49436")) {
        err = 1;
        goto cleanup;
    }
    if (slt64((int64_t) 0, dz2082U_34762)) {
        if (ctx->debugging)
            fprintf(ctx->log, "%s\n", "\n# SegScan");
        
        int64_t shared_memory_50437;
        
        shared_memory_50437 = ctx->max_shared_memory;
        
        int64_t thread_block_sizze_50438;
        
        thread_block_sizze_50438 = ctx->max_thread_block_size;
        
        int64_t registers_50439;
        
        registers_50439 = ctx->max_registers;
        
        int64_t thread_block_sizze_50440;
        
        thread_block_sizze_50440 = ctx->max_thread_block_size;
        
        int64_t chunk_sizze_50441 = smax64((int64_t) 1, smin64(squot64(squot64(shared_memory_50437, thread_block_sizze_50438), (int64_t) 8), squot64(squot64(registers_50439, thread_block_sizze_50440) - (int64_t) 1 - squot64(smax64((int64_t) 4, (int64_t) 8), (int64_t) 4), (int64_t) 2 * squot64(smax64((int64_t) 4, (int64_t) 8), (int64_t) 4))));
        int64_t num_virt_blocks_50442 = sdiv_up64(dz2082U_34762, segscan_tblock_sizze_44364 * chunk_sizze_50441);
        int64_t num_virt_threads_50443 = num_virt_blocks_50442 * segscan_tblock_sizze_44364;
        
        if (ctx->debugging)
            fprintf(ctx->log, "%s: %llu%c", "Sequential elements per thread (chunk)", (long long) chunk_sizze_50441, '\n');
        if (memblock_alloc_device(ctx, &status_flags_mem_50444, num_virt_blocks_50442, "status_flags_mem_50444")) {
            err = 1;
            goto cleanup;
        }
        if (futrts_builtinzhreplicate_i8(ctx, status_flags_mem_50444, num_virt_blocks_50442, (int8_t) 0) != 0) {
            err = 1;
            goto cleanup;
        }
        if (memblock_alloc_device(ctx, &aggregates_mem_50446, (int64_t) 8 * num_virt_blocks_50442, "aggregates_mem_50446")) {
            err = 1;
            goto cleanup;
        }
        if (memblock_alloc_device(ctx, &incprefixes_mem_50448, (int64_t) 8 * num_virt_blocks_50442, "incprefixes_mem_50448")) {
            err = 1;
            goto cleanup;
        }
        {
            err = gpu_kernel_do_DBSCAN_doublezisegscan_44369(ctx, num_tblocks_44366, 1, 1, *ctx->tuning_params.do_DBSCAN_doublezisegscan_tblock_sizze_44363, 1, 1, smax64(smax64((int64_t) 288, (int64_t) 8 * segscan_tblock_sizze_44364), chunk_sizze_50441 * segscan_tblock_sizze_44364 * (int64_t) 8) + srem64((int64_t) 8 - srem64(smax64(smax64((int64_t) 288, (int64_t) 8 * segscan_tblock_sizze_44364), chunk_sizze_50441 * segscan_tblock_sizze_44364 * (int64_t) 8), (int64_t) 8), (int64_t) 8), dz2081U_34761, dz2082U_34762, zt_res_41216, num_tblocks_44366, num_virt_blocks_50442, num_virt_threads_50443, clProc_mem_49381.mem, clProc_mem_49382.mem, clProc_mem_49383.mem, current_partition_mem_49395.mem, current_partition_mem_49396.mem, mem_49428.mem, mem_49432.mem, mem_49434.mem, mem_49436.mem, status_flags_mem_50444.mem, aggregates_mem_50446.mem, incprefixes_mem_50448.mem, global_dynid_mem_50450.mem);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        ctx->failure_is_an_option = 1;
        if (ctx->debugging)
            fprintf(ctx->log, "%s\n", "");
    }
    if (memblock_unref_device(ctx, &mem_49428, "mem_49428") != 0)
        return 1;
    
    int64_t m_f_res_41316;
    
    if (x_41309) {
        int64_t read_res_52173;
        
        if ((err = gpu_scalar_from_device(ctx, &read_res_52173, mem_49432.mem, tmp_41310 * sizeof(int64_t), sizeof(int64_t))) != 0)
            goto cleanup;
        if (ctx->failure_is_an_option && futhark_context_sync(ctx) != 0) {
            err = 1;
            goto cleanup;
        }
        
        int64_t x_42687 = read_res_52173;
        
        m_f_res_41316 = x_42687;
    } else {
        m_f_res_41316 = (int64_t) 0;
    }
    
    int64_t m_41318;
    
    if (cond_41308) {
        m_41318 = (int64_t) 0;
    } else {
        m_41318 = m_f_res_41316;
    }
    
    int64_t m_41328 = sub64(m_41318, (int64_t) 1);
    bool i_p_m_t_s_leq_w_41330 = slt64(m_41328, dz2082U_34762);
    bool zzero_leq_i_p_m_t_s_41329 = sle64((int64_t) 0, m_41328);
    bool y_41332 = zzero_leq_i_p_m_t_s_41329 && i_p_m_t_s_leq_w_41330;
    bool i_lte_j_41331 = sle64((int64_t) 0, m_41318);
    bool forwards_ok_41333 = i_lte_j_41331 && y_41332;
    bool eq_x_zz_41325 = (int64_t) 0 == m_f_res_41316;
    bool p_and_eq_x_y_41326 = x_41309 && eq_x_zz_41325;
    bool empty_slice_41327 = cond_41308 || p_and_eq_x_y_41326;
    bool ok_or_empty_41334 = empty_slice_41327 || forwards_ok_41333;
    bool index_certs_41335;
    
    if (!ok_or_empty_41334) {
        set_error(ctx, msgprintf("Error: %s%lld%s%lld%s\n\nBacktrace:\n%s", "Index [:", (long long) m_41318, "] out of bounds for array of shape [", (long long) dz2082U_34762, "].", "-> #0  /prelude/soacs.fut:258:29-35\n   #1  /prelude/functional.fut:9:44-45\n   #2  ft_libs/ftDBSCAN_plus.fut:863:18-866:67\n   #3  ft_libs/ftDBSCAN_plus.fut:862:9-866:67\n"));
        err = FUTHARK_PROGRAM_ERROR;
        goto cleanup;
    }
    
    int64_t bytes_49437 = (int64_t) 8 * m_41318;
    
    if (memblock_alloc_device(ctx, &mem_49438, bytes_49437, "mem_49438")) {
        err = 1;
        goto cleanup;
    }
    if (futrts_builtinzhiota_i64(ctx, mem_49438, m_41318, (int64_t) 0, (int64_t) 1) != 0) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_49440, bytes_49437, "mem_49440")) {
        err = 1;
        goto cleanup;
    }
    if ((err = lmad_copy_gpu2gpu_8b(ctx, 1, mem_49440.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, mem_49436.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, (int64_t []) {m_41318})) != 0)
        goto cleanup;
    if (memblock_alloc_device(ctx, &mem_49442, bytes_49437, "mem_49442")) {
        err = 1;
        goto cleanup;
    }
    if ((err = lmad_copy_gpu2gpu_8b(ctx, 1, mem_49442.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, clProc_mem_49383.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, (int64_t []) {m_41318})) != 0)
        goto cleanup;
    if (memblock_alloc_device(ctx, &mem_49444, bytes_49437, "mem_49444")) {
        err = 1;
        goto cleanup;
    }
    if ((err = lmad_copy_gpu2gpu_8b(ctx, 1, mem_49444.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, clProc_mem_49382.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, (int64_t []) {m_41318})) != 0)
        goto cleanup;
    if (ctx->debugging)
        fprintf(ctx->log, "%s\n", "\n# SegMap");
    
    int32_t virt_num_tblocks_50539 = sext_i64_i32(sdiv_up64(dz2082U_34762, segmap_tblock_sizze_44374));
    
    {
        err = gpu_kernel_do_DBSCAN_doublezisegmap_44371(ctx, num_tblocks_44376, 1, 1, *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_44373, 1, 1, (int64_t) 0, dz2082U_34762, m_41318, num_tblocks_44376, virt_num_tblocks_50539, clProc_mem_49382.mem, clProc_mem_49383.mem, mem_49432.mem, mem_49434.mem, mem_49436.mem, mem_49438.mem, mem_49440.mem, mem_49442.mem, mem_49444.mem);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (ctx->debugging)
        fprintf(ctx->log, "%s\n", "");
    if (memblock_unref_device(ctx, &mem_49432, "mem_49432") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_49434, "mem_49434") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_49436, "mem_49436") != 0)
        return 1;
    
    int64_t num_tblocks_44382;
    int64_t max_num_tblocks_50552;
    
    max_num_tblocks_50552 = *ctx->tuning_params.do_DBSCAN_doublezisegscan_num_tblocks_44381;
    num_tblocks_44382 = sext_i64_i32(smax64((int64_t) 1, smin64(sdiv_up64(m_41318, segscan_tblock_sizze_44380), max_num_tblocks_50552)));
    if (memblock_alloc_device(ctx, &mem_49448, bytes_49437, "mem_49448")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_49450, bytes_49437, "mem_49450")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_49452, bytes_49437, "mem_49452")) {
        err = 1;
        goto cleanup;
    }
    if (slt64((int64_t) 0, m_41318)) {
        if (ctx->debugging)
            fprintf(ctx->log, "%s\n", "\n# SegScan");
        
        int64_t shared_memory_50553;
        
        shared_memory_50553 = ctx->max_shared_memory;
        
        int64_t thread_block_sizze_50554;
        
        thread_block_sizze_50554 = ctx->max_thread_block_size;
        
        int64_t registers_50555;
        
        registers_50555 = ctx->max_registers;
        
        int64_t thread_block_sizze_50556;
        
        thread_block_sizze_50556 = ctx->max_thread_block_size;
        
        int64_t chunk_sizze_50557 = smax64((int64_t) 1, smin64(squot64(squot64(shared_memory_50553, thread_block_sizze_50554), (int64_t) 8), squot64(squot64(registers_50555, thread_block_sizze_50556) - (int64_t) 1 - squot64(smax64((int64_t) 4, (int64_t) 8) + smax64((int64_t) 4, (int64_t) 8), (int64_t) 4), (int64_t) 2 * squot64(smax64((int64_t) 4, (int64_t) 8) + smax64((int64_t) 4, (int64_t) 8), (int64_t) 4))));
        int64_t num_virt_blocks_50558 = sdiv_up64(m_41318, segscan_tblock_sizze_44380 * chunk_sizze_50557);
        int64_t num_virt_threads_50559 = num_virt_blocks_50558 * segscan_tblock_sizze_44380;
        
        if (ctx->debugging)
            fprintf(ctx->log, "%s: %llu%c", "Sequential elements per thread (chunk)", (long long) chunk_sizze_50557, '\n');
        if (memblock_alloc_device(ctx, &status_flags_mem_50560, num_virt_blocks_50558, "status_flags_mem_50560")) {
            err = 1;
            goto cleanup;
        }
        if (futrts_builtinzhreplicate_i8(ctx, status_flags_mem_50560, num_virt_blocks_50558, (int8_t) 0) != 0) {
            err = 1;
            goto cleanup;
        }
        if (memblock_alloc_device(ctx, &aggregates_mem_50562, (int64_t) 8 * num_virt_blocks_50558, "aggregates_mem_50562")) {
            err = 1;
            goto cleanup;
        }
        if (memblock_alloc_device(ctx, &incprefixes_mem_50564, (int64_t) 8 * num_virt_blocks_50558, "incprefixes_mem_50564")) {
            err = 1;
            goto cleanup;
        }
        if (memblock_alloc_device(ctx, &aggregates_mem_50566, (int64_t) 8 * num_virt_blocks_50558, "aggregates_mem_50566")) {
            err = 1;
            goto cleanup;
        }
        if (memblock_alloc_device(ctx, &incprefixes_mem_50568, (int64_t) 8 * num_virt_blocks_50558, "incprefixes_mem_50568")) {
            err = 1;
            goto cleanup;
        }
        {
            err = gpu_kernel_do_DBSCAN_doublezisegscan_44385(ctx, num_tblocks_44382, 1, 1, *ctx->tuning_params.do_DBSCAN_doublezisegscan_tblock_sizze_44379, 1, 1, smax64(smax64((int64_t) 544, sdiv_up64((int64_t) 8 * segscan_tblock_sizze_44380, (int64_t) 8) * (int64_t) 8 + (int64_t) 8 * segscan_tblock_sizze_44380), smax64(chunk_sizze_50557 * segscan_tblock_sizze_44380 * (int64_t) 8, chunk_sizze_50557 * segscan_tblock_sizze_44380 * (int64_t) 8)) + srem64((int64_t) 8 - srem64(smax64(smax64((int64_t) 544, sdiv_up64((int64_t) 8 * segscan_tblock_sizze_44380, (int64_t) 8) * (int64_t) 8 + (int64_t) 8 * segscan_tblock_sizze_44380), smax64(chunk_sizze_50557 * segscan_tblock_sizze_44380 * (int64_t) 8, chunk_sizze_50557 * segscan_tblock_sizze_44380 * (int64_t) 8)), (int64_t) 8), (int64_t) 8), clBase_34770, m_41318, num_tblocks_44382, num_virt_blocks_50558, num_virt_threads_50559, current_partition_mem_49395.mem, current_partition_mem_49396.mem, mem_49429.mem, mem_49442.mem, mem_49444.mem, mem_49448.mem, mem_49450.mem, mem_49452.mem, status_flags_mem_50560.mem, aggregates_mem_50562.mem, incprefixes_mem_50564.mem, aggregates_mem_50566.mem, incprefixes_mem_50568.mem, global_dynid_mem_50570.mem);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        if (ctx->debugging)
            fprintf(ctx->log, "%s\n", "");
    }
    if (memblock_unref_device(ctx, &mem_49429, "mem_49429") != 0)
        return 1;
    
    bool x_41390 = !empty_slice_41327;
    int64_t last_offset_41391;
    
    if (x_41390) {
        int64_t read_res_52174;
        
        if ((err = gpu_scalar_from_device(ctx, &read_res_52174, mem_49448.mem, m_41328 * sizeof(int64_t), sizeof(int64_t))) != 0)
            goto cleanup;
        if (ctx->failure_is_an_option && futhark_context_sync(ctx) != 0) {
            err = 1;
            goto cleanup;
        }
        
        int64_t x_42702 = read_res_52174;
        
        last_offset_41391 = x_42702;
    } else {
        last_offset_41391 = (int64_t) 0;
    }
    
    int64_t partition_sizze_41393;
    
    if (empty_slice_41327) {
        partition_sizze_41393 = (int64_t) 0;
    } else {
        partition_sizze_41393 = last_offset_41391;
    }
    if (memblock_alloc_device(ctx, &mem_49454, bytes_49437, "mem_49454")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_49456, bytes_49437, "mem_49456")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_49458, bytes_49437, "mem_49458")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_49460, bytes_49437, "mem_49460")) {
        err = 1;
        goto cleanup;
    }
    
    int64_t y_41398 = (int64_t) -1 + partition_sizze_41393;
    int64_t num_tblocks_44392;
    int64_t max_num_tblocks_50705;
    
    max_num_tblocks_50705 = *ctx->tuning_params.do_DBSCAN_doublezisegmap_num_tblocks_44391;
    num_tblocks_44392 = sext_i64_i32(smax64((int64_t) 1, smin64(sdiv_up64(m_41318, segmap_tblock_sizze_44390), max_num_tblocks_50705)));
    if (ctx->debugging)
        fprintf(ctx->log, "%s\n", "\n# SegMap");
    
    int32_t virt_num_tblocks_50706 = sext_i64_i32(sdiv_up64(m_41318, segmap_tblock_sizze_44390));
    
    {
        err = gpu_kernel_do_DBSCAN_doublezisegmap_44387(ctx, num_tblocks_44392, 1, 1, *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_44389, 1, 1, (int64_t) 0, m_41318, y_41398, num_tblocks_44392, virt_num_tblocks_50706, mem_49438.mem, mem_49440.mem, mem_49442.mem, mem_49444.mem, mem_49448.mem, mem_49450.mem, mem_49452.mem, mem_49454.mem, mem_49456.mem, mem_49458.mem, mem_49460.mem);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (ctx->debugging)
        fprintf(ctx->log, "%s\n", "");
    if (memblock_unref_device(ctx, &mem_49438, "mem_49438") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_49440, "mem_49440") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_49442, "mem_49442") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_49444, "mem_49444") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_49448, "mem_49448") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_49450, "mem_49450") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_49452, "mem_49452") != 0)
        return 1;
    
    bool eq_x_zz_41416 = (int64_t) 0 == last_offset_41391;
    bool p_and_eq_x_y_41417 = x_41390 && eq_x_zz_41416;
    bool empty_slice_41418 = empty_slice_41327 || p_and_eq_x_y_41417;
    int64_t m_41419 = sub64(partition_sizze_41393, (int64_t) 1);
    bool zzero_leq_i_p_m_t_s_41420 = sle64((int64_t) 0, m_41419);
    bool i_p_m_t_s_leq_w_41421 = slt64(m_41419, m_41318);
    bool i_lte_j_41422 = sle64((int64_t) 0, partition_sizze_41393);
    bool y_41423 = zzero_leq_i_p_m_t_s_41420 && i_p_m_t_s_leq_w_41421;
    bool forwards_ok_41424 = i_lte_j_41422 && y_41423;
    bool ok_or_empty_41425 = empty_slice_41418 || forwards_ok_41424;
    bool index_certs_41426;
    
    if (!ok_or_empty_41425) {
        set_error(ctx, msgprintf("Error: %s%lld%s%lld%s%lld%s\n\nBacktrace:\n%s", "Index [", (long long) (int64_t) 0, ":", (long long) partition_sizze_41393, "] out of bounds for array of shape [", (long long) m_41318, "].", "-> #0  /prelude/soacs.fut:174:7-19\n   #1  /prelude/functional.fut:9:44-45\n   #2  ft_libs/ftDBSCAN_plus.fut:863:18-866:67\n   #3  ft_libs/ftDBSCAN_plus.fut:862:9-866:67\n"));
        err = FUTHARK_PROGRAM_ERROR;
        goto cleanup;
    }
    
    bool y_41479 = slt64(m_41419, partition_sizze_41393);
    bool bounds_check_41480 = zzero_leq_i_p_m_t_s_41420 && y_41479;
    bool protect_assert_disj_41481 = empty_slice_41418 || bounds_check_41480;
    bool index_certs_41482;
    
    if (!protect_assert_disj_41481) {
        set_error(ctx, msgprintf("Error: %s%lld%s%lld%s\n\nBacktrace:\n%s", "Index [", (long long) m_41419, "] out of bounds for array of shape [", (long long) partition_sizze_41393, "].", "-> #0  /prelude/soacs.fut:257:33-47\n   #1  /prelude/functional.fut:9:44-45\n   #2  ft_libs/ftDBSCAN_plus.fut:863:18-866:67\n   #3  ft_libs/ftDBSCAN_plus.fut:862:9-866:67\n"));
        err = FUTHARK_PROGRAM_ERROR;
        goto cleanup;
    }
    
    bool x_41478 = !empty_slice_41418;
    
    if (futrts_get_num_neighbours_against_9635(ctx, &ext_mem_49462, mem_49454, mem_49456, mem_49413, mem_49411, partition_sizze_41393, m_41239, clBase_34770, clBase_34769, clBase_34768, clBase_34776, clBase_34771) != 0) {
        err = 1;
        goto cleanup;
    }
    
    int64_t j_m_i_41431 = sub64(m_41318, partition_sizze_41393);
    int64_t m_41433 = sub64(j_m_i_41431, (int64_t) 1);
    int64_t i_p_m_t_s_41434 = add64(partition_sizze_41393, m_41433);
    bool i_p_m_t_s_leq_w_41436 = slt64(i_p_m_t_s_41434, m_41318);
    bool zzero_leq_i_p_m_t_s_41435 = sle64((int64_t) 0, i_p_m_t_s_41434);
    bool y_41438 = zzero_leq_i_p_m_t_s_41435 && i_p_m_t_s_leq_w_41436;
    bool i_lte_j_41437 = sle64(partition_sizze_41393, m_41318);
    bool forwards_ok_41439 = i_lte_j_41437 && y_41438;
    bool empty_slice_41432 = j_m_i_41431 == (int64_t) 0;
    bool ok_or_empty_41440 = empty_slice_41432 || forwards_ok_41439;
    bool index_certs_41441;
    
    if (!ok_or_empty_41440) {
        set_error(ctx, msgprintf("Error: %s%lld%s%lld%s%lld%s\n\nBacktrace:\n%s", "Index [", (long long) partition_sizze_41393, ":", (long long) m_41318, "] out of bounds for array of shape [", (long long) m_41318, "].", "-> #0  /prelude/soacs.fut:174:21-33\n   #1  /prelude/functional.fut:9:44-45\n   #2  ft_libs/ftDBSCAN_plus.fut:863:18-866:67\n   #3  ft_libs/ftDBSCAN_plus.fut:862:9-866:67\n"));
        err = FUTHARK_PROGRAM_ERROR;
        goto cleanup;
    }
    
    int64_t bytes_49463 = (int64_t) 8 * j_m_i_41431;
    
    if (memblock_alloc_device(ctx, &mem_49464, bytes_49463, "mem_49464")) {
        err = 1;
        goto cleanup;
    }
    if ((err = lmad_copy_gpu2gpu_8b(ctx, 1, mem_49464.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, mem_49454.mem, partition_sizze_41393, (int64_t []) {(int64_t) 1}, (int64_t []) {j_m_i_41431})) != 0)
        goto cleanup;
    if (memblock_alloc_device(ctx, &mem_49467, bytes_49463, "mem_49467")) {
        err = 1;
        goto cleanup;
    }
    if ((err = lmad_copy_gpu2gpu_8b(ctx, 1, mem_49467.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, mem_49456.mem, partition_sizze_41393, (int64_t []) {(int64_t) 1}, (int64_t []) {j_m_i_41431})) != 0)
        goto cleanup;
    if (futrts_get_num_neighbours_against_9635(ctx, &ext_mem_49469, mem_49454, mem_49456, mem_49464, mem_49467, partition_sizze_41393, j_m_i_41431, clBase_34770, clBase_34769, clBase_34768, clBase_34776, clBase_34771) != 0) {
        err = 1;
        goto cleanup;
    }
    if (memblock_unref_device(ctx, &mem_49464, "mem_49464") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_49467, "mem_49467") != 0)
        return 1;
    if (futrts_get_num_neighbours_against_9632(ctx, &ext_mem_49470, mem_49454, mem_49456, mem_49454, mem_49456, partition_sizze_41393, partition_sizze_41393, clBase_34770, clBase_34769, clBase_34768, clBase_34776, clBase_34771) != 0) {
        err = 1;
        goto cleanup;
    }
    
    int64_t num_tblocks_44398;
    int64_t max_num_tblocks_50719;
    
    max_num_tblocks_50719 = *ctx->tuning_params.do_DBSCAN_doublezisegscan_num_tblocks_44397;
    num_tblocks_44398 = sext_i64_i32(smax64((int64_t) 1, smin64(sdiv_up64(partition_sizze_41393, segscan_tblock_sizze_44396), max_num_tblocks_50719)));
    
    int64_t bytes_49472 = (int64_t) 8 * partition_sizze_41393;
    
    if (memblock_alloc_device(ctx, &mem_49473, bytes_49472, "mem_49473")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_49475, bytes_49472, "mem_49475")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_49476, partition_sizze_41393, "mem_49476")) {
        err = 1;
        goto cleanup;
    }
    if (slt64((int64_t) 0, partition_sizze_41393)) {
        if (ctx->debugging)
            fprintf(ctx->log, "%s\n", "\n# SegScan");
        
        int64_t shared_memory_50720;
        
        shared_memory_50720 = ctx->max_shared_memory;
        
        int64_t thread_block_sizze_50721;
        
        thread_block_sizze_50721 = ctx->max_thread_block_size;
        
        int64_t registers_50722;
        
        registers_50722 = ctx->max_registers;
        
        int64_t thread_block_sizze_50723;
        
        thread_block_sizze_50723 = ctx->max_thread_block_size;
        
        int64_t chunk_sizze_50724 = smax64((int64_t) 1, smin64(squot64(squot64(shared_memory_50720, thread_block_sizze_50721), (int64_t) 8), squot64(squot64(registers_50722, thread_block_sizze_50723) - (int64_t) 1 - squot64(smax64((int64_t) 4, (int64_t) 8), (int64_t) 4), (int64_t) 2 * squot64(smax64((int64_t) 4, (int64_t) 8), (int64_t) 4))));
        int64_t num_virt_blocks_50725 = sdiv_up64(partition_sizze_41393, segscan_tblock_sizze_44396 * chunk_sizze_50724);
        int64_t num_virt_threads_50726 = num_virt_blocks_50725 * segscan_tblock_sizze_44396;
        
        if (ctx->debugging)
            fprintf(ctx->log, "%s: %llu%c", "Sequential elements per thread (chunk)", (long long) chunk_sizze_50724, '\n');
        if (memblock_alloc_device(ctx, &status_flags_mem_50727, num_virt_blocks_50725, "status_flags_mem_50727")) {
            err = 1;
            goto cleanup;
        }
        if (futrts_builtinzhreplicate_i8(ctx, status_flags_mem_50727, num_virt_blocks_50725, (int8_t) 0) != 0) {
            err = 1;
            goto cleanup;
        }
        if (memblock_alloc_device(ctx, &aggregates_mem_50729, (int64_t) 8 * num_virt_blocks_50725, "aggregates_mem_50729")) {
            err = 1;
            goto cleanup;
        }
        if (memblock_alloc_device(ctx, &incprefixes_mem_50731, (int64_t) 8 * num_virt_blocks_50725, "incprefixes_mem_50731")) {
            err = 1;
            goto cleanup;
        }
        {
            err = gpu_kernel_do_DBSCAN_doublezisegscan_44401(ctx, num_tblocks_44398, 1, 1, *ctx->tuning_params.do_DBSCAN_doublezisegscan_tblock_sizze_44395, 1, 1, smax64(smax64((int64_t) 288, (int64_t) 8 * segscan_tblock_sizze_44396), chunk_sizze_50724 * segscan_tblock_sizze_44396 * (int64_t) 8) + srem64((int64_t) 8 - srem64(smax64(smax64((int64_t) 288, (int64_t) 8 * segscan_tblock_sizze_44396), chunk_sizze_50724 * segscan_tblock_sizze_44396 * (int64_t) 8), (int64_t) 8), (int64_t) 8), clBase_34773, partition_sizze_41393, num_tblocks_44398, num_virt_blocks_50725, num_virt_threads_50726, ext_mem_49462.mem, ext_mem_49469.mem, ext_mem_49470.mem, mem_49473.mem, mem_49475.mem, mem_49476.mem, status_flags_mem_50727.mem, aggregates_mem_50729.mem, incprefixes_mem_50731.mem, global_dynid_mem_50733.mem);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        if (ctx->debugging)
            fprintf(ctx->log, "%s\n", "");
    }
    if (memblock_unref_device(ctx, &ext_mem_49462, "ext_mem_49462") != 0)
        return 1;
    if (memblock_unref_device(ctx, &ext_mem_49469, "ext_mem_49469") != 0)
        return 1;
    if (memblock_unref_device(ctx, &ext_mem_49470, "ext_mem_49470") != 0)
        return 1;
    
    int64_t m_f_res_41483;
    
    if (x_41478) {
        int64_t read_res_52175;
        
        if ((err = gpu_scalar_from_device(ctx, &read_res_52175, mem_49473.mem, m_41419 * sizeof(int64_t), sizeof(int64_t))) != 0)
            goto cleanup;
        if (ctx->failure_is_an_option && futhark_context_sync(ctx) != 0) {
            err = 1;
            goto cleanup;
        }
        
        int64_t x_42704 = read_res_52175;
        
        m_f_res_41483 = x_42704;
    } else {
        m_f_res_41483 = (int64_t) 0;
    }
    
    int64_t m_41485;
    
    if (empty_slice_41418) {
        m_41485 = (int64_t) 0;
    } else {
        m_41485 = m_f_res_41483;
    }
    
    int64_t m_41495 = sub64(m_41485, (int64_t) 1);
    bool i_p_m_t_s_leq_w_41497 = slt64(m_41495, partition_sizze_41393);
    bool zzero_leq_i_p_m_t_s_41496 = sle64((int64_t) 0, m_41495);
    bool y_41499 = zzero_leq_i_p_m_t_s_41496 && i_p_m_t_s_leq_w_41497;
    bool i_lte_j_41498 = sle64((int64_t) 0, m_41485);
    bool forwards_ok_41500 = i_lte_j_41498 && y_41499;
    bool eq_x_zz_41492 = (int64_t) 0 == m_f_res_41483;
    bool p_and_eq_x_y_41493 = x_41478 && eq_x_zz_41492;
    bool empty_slice_41494 = empty_slice_41418 || p_and_eq_x_y_41493;
    bool ok_or_empty_41501 = empty_slice_41494 || forwards_ok_41500;
    bool index_certs_41502;
    
    if (!ok_or_empty_41501) {
        set_error(ctx, msgprintf("Error: %s%lld%s%lld%s\n\nBacktrace:\n%s", "Index [:", (long long) m_41485, "] out of bounds for array of shape [", (long long) partition_sizze_41393, "].", "-> #0  /prelude/soacs.fut:258:29-35\n   #1  /prelude/functional.fut:9:44-45\n   #2  ft_libs/ftDBSCAN_plus.fut:863:18-866:67\n   #3  ft_libs/ftDBSCAN_plus.fut:862:9-866:67\n"));
        err = FUTHARK_PROGRAM_ERROR;
        goto cleanup;
    }
    
    int64_t bytes_49477 = (int64_t) 8 * m_41485;
    
    if (memblock_alloc_device(ctx, &mem_49478, bytes_49477, "mem_49478")) {
        err = 1;
        goto cleanup;
    }
    if ((err = lmad_copy_gpu2gpu_8b(ctx, 1, mem_49478.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, mem_49458.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, (int64_t []) {m_41485})) != 0)
        goto cleanup;
    if (memblock_alloc_device(ctx, &mem_49480, bytes_49477, "mem_49480")) {
        err = 1;
        goto cleanup;
    }
    if ((err = lmad_copy_gpu2gpu_8b(ctx, 1, mem_49480.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, mem_49456.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, (int64_t []) {m_41485})) != 0)
        goto cleanup;
    if (memblock_alloc_device(ctx, &mem_49482, bytes_49477, "mem_49482")) {
        err = 1;
        goto cleanup;
    }
    if ((err = lmad_copy_gpu2gpu_8b(ctx, 1, mem_49482.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, mem_49454.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, (int64_t []) {m_41485})) != 0)
        goto cleanup;
    
    int64_t num_tblocks_44408;
    int64_t max_num_tblocks_50822;
    
    max_num_tblocks_50822 = *ctx->tuning_params.do_DBSCAN_doublezisegmap_num_tblocks_44407;
    num_tblocks_44408 = sext_i64_i32(smax64((int64_t) 1, smin64(sdiv_up64(partition_sizze_41393, segmap_tblock_sizze_44406), max_num_tblocks_50822)));
    if (ctx->debugging)
        fprintf(ctx->log, "%s\n", "\n# SegMap");
    
    int32_t virt_num_tblocks_50823 = sext_i64_i32(sdiv_up64(partition_sizze_41393, segmap_tblock_sizze_44406));
    
    {
        err = gpu_kernel_do_DBSCAN_doublezisegmap_44403(ctx, num_tblocks_44408, 1, 1, *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_44405, 1, 1, (int64_t) 0, partition_sizze_41393, m_41485, num_tblocks_44408, virt_num_tblocks_50823, mem_49454.mem, mem_49456.mem, mem_49458.mem, mem_49473.mem, mem_49475.mem, mem_49478.mem, mem_49480.mem, mem_49482.mem);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (ctx->debugging)
        fprintf(ctx->log, "%s\n", "");
    if (memblock_unref_device(ctx, &mem_49458, "mem_49458") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_49473, "mem_49473") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_49475, "mem_49475") != 0)
        return 1;
    if (futrts_get_num_neighbours_against_9635(ctx, &ext_mem_49484, mem_49413, mem_49411, mem_49454, mem_49456, m_41239, partition_sizze_41393, clBase_34770, clBase_34769, clBase_34768, clBase_34776, clBase_34771) != 0) {
        err = 1;
        goto cleanup;
    }
    if (memblock_unref_device(ctx, &mem_49411, "mem_49411") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_49413, "mem_49413") != 0)
        return 1;
    if (ctx->debugging)
        fprintf(ctx->log, "%s\n", "\n# SegMap");
    
    int32_t virt_num_tblocks_50836 = sext_i64_i32(sdiv_up64(m_41239, segmap_tblock_sizze_44414));
    
    {
        err = gpu_kernel_do_DBSCAN_doublezisegmap_44411(ctx, num_tblocks_44416, 1, 1, *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_44413, 1, 1, (int64_t) 0, n_34757, m_41239, num_tblocks_44416, virt_num_tblocks_50836, mem_49415.mem, mem_49421.mem, ext_mem_49484.mem);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (ctx->debugging)
        fprintf(ctx->log, "%s\n", "");
    if (memblock_unref_device(ctx, &mem_49415, "mem_49415") != 0)
        return 1;
    if (memblock_unref_device(ctx, &ext_mem_49484, "ext_mem_49484") != 0)
        return 1;
    if (memblock_alloc_device(ctx, &mem_49487, n_34757, "mem_49487")) {
        err = 1;
        goto cleanup;
    }
    if (ctx->debugging)
        fprintf(ctx->log, "%s\n", "\n# SegMap");
    
    int32_t virt_num_tblocks_50849 = sext_i64_i32(sdiv_up64(n_34757, segmap_tblock_sizze_44431));
    
    {
        err = gpu_kernel_do_DBSCAN_doublezisegmap_44435(ctx, segmap_usable_groups_44432, 1, 1, *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_44421, 1, 1, (int64_t) 0, n_34757, clBase_34773, mem_49421.mem, ext_mem_49422.mem, mem_49487.mem);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (ctx->debugging)
        fprintf(ctx->log, "%s\n", "");
    if (memblock_unref_device(ctx, &mem_49421, "mem_49421") != 0)
        return 1;
    if (memblock_unref_device(ctx, &ext_mem_49422, "ext_mem_49422") != 0)
        return 1;
    if (memblock_alloc_device(ctx, &mem_49490, bytes_49402, "mem_49490")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_49492, bytes_49402, "mem_49492")) {
        err = 1;
        goto cleanup;
    }
    if (slt64((int64_t) 0, n_34757)) {
        if (ctx->debugging)
            fprintf(ctx->log, "%s\n", "\n# SegScan");
        
        int64_t shared_memory_50858;
        
        shared_memory_50858 = ctx->max_shared_memory;
        
        int64_t thread_block_sizze_50859;
        
        thread_block_sizze_50859 = ctx->max_thread_block_size;
        
        int64_t registers_50860;
        
        registers_50860 = ctx->max_registers;
        
        int64_t thread_block_sizze_50861;
        
        thread_block_sizze_50861 = ctx->max_thread_block_size;
        
        int64_t chunk_sizze_50862 = smax64((int64_t) 1, smin64(squot64(squot64(shared_memory_50858, thread_block_sizze_50859), (int64_t) 8), squot64(squot64(registers_50860, thread_block_sizze_50861) - (int64_t) 1 - squot64(smax64((int64_t) 4, (int64_t) 8), (int64_t) 4), (int64_t) 2 * squot64(smax64((int64_t) 4, (int64_t) 8), (int64_t) 4))));
        int64_t num_virt_blocks_50863 = sdiv_up64(n_34757, segscan_tblock_sizze_44442 * chunk_sizze_50862);
        int64_t num_virt_threads_50864 = num_virt_blocks_50863 * segscan_tblock_sizze_44442;
        
        if (ctx->debugging)
            fprintf(ctx->log, "%s: %llu%c", "Sequential elements per thread (chunk)", (long long) chunk_sizze_50862, '\n');
        if (memblock_alloc_device(ctx, &status_flags_mem_50865, num_virt_blocks_50863, "status_flags_mem_50865")) {
            err = 1;
            goto cleanup;
        }
        if (futrts_builtinzhreplicate_i8(ctx, status_flags_mem_50865, num_virt_blocks_50863, (int8_t) 0) != 0) {
            err = 1;
            goto cleanup;
        }
        if (memblock_alloc_device(ctx, &aggregates_mem_50867, (int64_t) 8 * num_virt_blocks_50863, "aggregates_mem_50867")) {
            err = 1;
            goto cleanup;
        }
        if (memblock_alloc_device(ctx, &incprefixes_mem_50869, (int64_t) 8 * num_virt_blocks_50863, "incprefixes_mem_50869")) {
            err = 1;
            goto cleanup;
        }
        {
            err = gpu_kernel_do_DBSCAN_doublezisegscan_44447(ctx, num_tblocks_44444, 1, 1, *ctx->tuning_params.do_DBSCAN_doublezisegscan_tblock_sizze_44441, 1, 1, smax64(smax64((int64_t) 288, (int64_t) 8 * segscan_tblock_sizze_44442), chunk_sizze_50862 * segscan_tblock_sizze_44442 * (int64_t) 8) + srem64((int64_t) 8 - srem64(smax64(smax64((int64_t) 288, (int64_t) 8 * segscan_tblock_sizze_44442), chunk_sizze_50862 * segscan_tblock_sizze_44442 * (int64_t) 8), (int64_t) 8), (int64_t) 8), n_34757, num_tblocks_44444, num_virt_blocks_50863, num_virt_threads_50864, mem_49487.mem, mem_49490.mem, mem_49492.mem, status_flags_mem_50865.mem, aggregates_mem_50867.mem, incprefixes_mem_50869.mem, global_dynid_mem_50871.mem);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        if (ctx->debugging)
            fprintf(ctx->log, "%s\n", "");
    }
    
    int64_t m_f_res_41525;
    
    if (x_41230) {
        int64_t read_res_52176;
        
        if ((err = gpu_scalar_from_device(ctx, &read_res_52176, mem_49490.mem, tmp_41231 * sizeof(int64_t), sizeof(int64_t))) != 0)
            goto cleanup;
        if (ctx->failure_is_an_option && futhark_context_sync(ctx) != 0) {
            err = 1;
            goto cleanup;
        }
        
        int64_t x_42705 = read_res_52176;
        
        m_f_res_41525 = x_42705;
    } else {
        m_f_res_41525 = (int64_t) 0;
    }
    
    int64_t m_41527;
    
    if (cond_41229) {
        m_41527 = (int64_t) 0;
    } else {
        m_41527 = m_f_res_41525;
    }
    
    int64_t conc_tmp_41556 = m_41485 + m_41527;
    bool zzero_41564 = conc_tmp_41556 == (int64_t) 0;
    bool nonzzero_41565 = !zzero_41564;
    bool nonzzero_cert_41566;
    
    if (!nonzzero_41565) {
        set_error(ctx, msgprintf("Error: %s\n\nBacktrace:\n%s", "division by zero", "-> #0  ft_libs/ftDBSCAN_plus.fut:517:63-66\n   #1  ft_libs/ftDBSCAN_plus.fut:863:18-866:67\n   #2  ft_libs/ftDBSCAN_plus.fut:862:9-866:67\n"));
        err = FUTHARK_PROGRAM_ERROR;
        goto cleanup;
    }
    
    int64_t max_arg1_41567 = sdiv64(clBase_34771, conc_tmp_41556);
    int64_t max_res_41927 = smax64((int64_t) 1, max_arg1_41567);
    bool zzero_41952 = max_res_41927 == (int64_t) 0;
    bool nonzzero_41953 = !zzero_41952;
    bool nonzzero_cert_41954;
    
    if (!nonzzero_41953) {
        set_error(ctx, msgprintf("Error: %s\n\nBacktrace:\n%s", "division by zero", "-> #0  ft_libs/ftDBSCAN_plus.fut:602:57-64\n   #1  ft_libs/ftDBSCAN_plus.fut:863:18-866:67\n   #2  ft_libs/ftDBSCAN_plus.fut:862:9-866:67\n"));
        err = FUTHARK_PROGRAM_ERROR;
        goto cleanup;
    }
    
    int64_t zm_lhs_41950 = add64(partition_sizze_41393, max_res_41927);
    int64_t zs_lhs_41951 = sub64(zm_lhs_41950, (int64_t) 1);
    int64_t numIter1_41955 = sdiv64(zs_lhs_41951, max_res_41927);
    bool bounds_invalid_upwards_41957 = slt64(numIter1_41955, (int64_t) 0);
    bool valid_41958 = !bounds_invalid_upwards_41957;
    bool range_valid_c_41959;
    
    if (!valid_41958) {
        set_error(ctx, msgprintf("Error: %s%lld%s%lld%s%lld%s\n\nBacktrace:\n%s", "Range ", (long long) (int64_t) 0, "..", (long long) (int64_t) 1, "..<", (long long) numIter1_41955, " is invalid.", "-> #0  /prelude/array.fut:94:3-11\n   #1  ft_libs/ftDBSCAN_plus.fut:604:75-88\n   #2  ft_libs/ftDBSCAN_plus.fut:863:18-866:67\n   #3  ft_libs/ftDBSCAN_plus.fut:862:9-866:67\n"));
        err = FUTHARK_PROGRAM_ERROR;
        goto cleanup;
    }
    
    int64_t tmp_41732 = sub64(conc_tmp_41556, (int64_t) 1);
    bool y_41734 = slt64(tmp_41732, conc_tmp_41556);
    bool x_41733 = sle64((int64_t) 0, tmp_41732);
    bool bounds_check_41735 = x_41733 && y_41734;
    bool protect_assert_disj_41736 = zzero_41564 || bounds_check_41735;
    bool index_certs_41737;
    
    if (!protect_assert_disj_41736) {
        set_error(ctx, msgprintf("Error: %s%lld%s%lld%s\n\nBacktrace:\n%s", "Index [", (long long) tmp_41732, "] out of bounds for array of shape [", (long long) conc_tmp_41556, "].", "-> #0  /prelude/soacs.fut:257:33-47\n   #1  /prelude/functional.fut:9:44-45\n   #2  ft_libs/ftDBSCAN_plus.fut:863:18-866:67\n   #3  ft_libs/ftDBSCAN_plus.fut:862:9-866:67\n"));
        err = FUTHARK_PROGRAM_ERROR;
        goto cleanup;
    }
    
    int64_t m_41537 = sub64(m_41527, (int64_t) 1);
    bool i_p_m_t_s_leq_w_41539 = slt64(m_41537, n_34757);
    bool zzero_leq_i_p_m_t_s_41538 = sle64((int64_t) 0, m_41537);
    bool y_41541 = zzero_leq_i_p_m_t_s_41538 && i_p_m_t_s_leq_w_41539;
    bool i_lte_j_41540 = sle64((int64_t) 0, m_41527);
    bool forwards_ok_41542 = i_lte_j_41540 && y_41541;
    bool eq_x_zz_41534 = (int64_t) 0 == m_f_res_41525;
    bool p_and_eq_x_y_41535 = x_41230 && eq_x_zz_41534;
    bool empty_slice_41536 = cond_41229 || p_and_eq_x_y_41535;
    bool ok_or_empty_41543 = empty_slice_41536 || forwards_ok_41542;
    bool index_certs_41544;
    
    if (!ok_or_empty_41543) {
        set_error(ctx, msgprintf("Error: %s%lld%s%lld%s\n\nBacktrace:\n%s", "Index [:", (long long) m_41527, "] out of bounds for array of shape [", (long long) n_34757, "].", "-> #0  /prelude/soacs.fut:258:29-35\n   #1  /prelude/functional.fut:9:44-45\n   #2  ft_libs/ftDBSCAN_plus.fut:863:18-866:67\n   #3  ft_libs/ftDBSCAN_plus.fut:862:9-866:67\n"));
        err = FUTHARK_PROGRAM_ERROR;
        goto cleanup;
    }
    
    int64_t bytes_49495 = (int64_t) 8 * m_41527;
    
    if (memblock_alloc_device(ctx, &mem_49496, bytes_49495, "mem_49496")) {
        err = 1;
        goto cleanup;
    }
    if (futrts_builtinzhreplicate_i64(ctx, mem_49496, m_41527, (int64_t) -1) != 0) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_49498, bytes_49495, "mem_49498")) {
        err = 1;
        goto cleanup;
    }
    if ((err = lmad_copy_gpu2gpu_8b(ctx, 1, mem_49498.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, mem_49409.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, (int64_t []) {m_41527})) != 0)
        goto cleanup;
    if (memblock_unref_device(ctx, &mem_49409, "mem_49409") != 0)
        return 1;
    if (memblock_alloc_device(ctx, &mem_49500, bytes_49495, "mem_49500")) {
        err = 1;
        goto cleanup;
    }
    if ((err = lmad_copy_gpu2gpu_8b(ctx, 1, mem_49500.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, mem_49407.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, (int64_t []) {m_41527})) != 0)
        goto cleanup;
    if (memblock_unref_device(ctx, &mem_49407, "mem_49407") != 0)
        return 1;
    if (ctx->debugging)
        fprintf(ctx->log, "%s\n", "\n# SegMap");
    
    int32_t virt_num_tblocks_50960 = sext_i64_i32(sdiv_up64(n_34757, segmap_tblock_sizze_44452));
    
    {
        err = gpu_kernel_do_DBSCAN_doublezisegmap_44449(ctx, num_tblocks_44454, 1, 1, *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_44451, 1, 1, (int64_t) 0, n_34757, m_41527, num_tblocks_44454, virt_num_tblocks_50960, current_partition_mem_49387.mem, current_partition_mem_49388.mem, mem_49490.mem, mem_49492.mem, mem_49496.mem, mem_49498.mem, mem_49500.mem);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (ctx->debugging)
        fprintf(ctx->log, "%s\n", "");
    if (memblock_unref_device(ctx, &mem_49490, "mem_49490") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_49492, "mem_49492") != 0)
        return 1;
    
    int64_t bytes_49502 = (int64_t) 8 * conc_tmp_41556;
    
    if (memblock_alloc_device(ctx, &mem_49503, bytes_49502, "mem_49503")) {
        err = 1;
        goto cleanup;
    }
    
    int64_t tmp_offs_50973 = (int64_t) 0;
    
    if ((err = lmad_copy_gpu2gpu_8b(ctx, 1, mem_49503.mem, tmp_offs_50973, (int64_t []) {(int64_t) 1}, mem_49478.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, (int64_t []) {m_41485})) != 0)
        goto cleanup;
    tmp_offs_50973 += m_41485;
    if ((err = lmad_copy_gpu2gpu_8b(ctx, 1, mem_49503.mem, tmp_offs_50973, (int64_t []) {(int64_t) 1}, mem_49496.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, (int64_t []) {m_41527})) != 0)
        goto cleanup;
    tmp_offs_50973 += m_41527;
    
    int64_t num_tblocks_44460;
    int64_t max_num_tblocks_50974;
    
    max_num_tblocks_50974 = *ctx->tuning_params.do_DBSCAN_doublezisegscan_num_tblocks_44459;
    num_tblocks_44460 = sext_i64_i32(smax64((int64_t) 1, smin64(sdiv_up64(conc_tmp_41556, segscan_tblock_sizze_44458), max_num_tblocks_50974)));
    if (memblock_alloc_device(ctx, &mem_49506, bytes_49502, "mem_49506")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_49508, bytes_49502, "mem_49508")) {
        err = 1;
        goto cleanup;
    }
    if (slt64((int64_t) 0, conc_tmp_41556)) {
        if (ctx->debugging)
            fprintf(ctx->log, "%s\n", "\n# SegScan");
        
        int64_t shared_memory_50975;
        
        shared_memory_50975 = ctx->max_shared_memory;
        
        int64_t thread_block_sizze_50976;
        
        thread_block_sizze_50976 = ctx->max_thread_block_size;
        
        int64_t registers_50977;
        
        registers_50977 = ctx->max_registers;
        
        int64_t thread_block_sizze_50978;
        
        thread_block_sizze_50978 = ctx->max_thread_block_size;
        
        int64_t chunk_sizze_50979 = smax64((int64_t) 1, smin64(squot64(squot64(shared_memory_50975, thread_block_sizze_50976), (int64_t) 8), squot64(squot64(registers_50977, thread_block_sizze_50978) - (int64_t) 1 - squot64(smax64((int64_t) 4, (int64_t) 8), (int64_t) 4), (int64_t) 2 * squot64(smax64((int64_t) 4, (int64_t) 8), (int64_t) 4))));
        int64_t num_virt_blocks_50980 = sdiv_up64(conc_tmp_41556, segscan_tblock_sizze_44458 * chunk_sizze_50979);
        int64_t num_virt_threads_50981 = num_virt_blocks_50980 * segscan_tblock_sizze_44458;
        
        if (ctx->debugging)
            fprintf(ctx->log, "%s: %llu%c", "Sequential elements per thread (chunk)", (long long) chunk_sizze_50979, '\n');
        if (memblock_alloc_device(ctx, &status_flags_mem_50982, num_virt_blocks_50980, "status_flags_mem_50982")) {
            err = 1;
            goto cleanup;
        }
        if (futrts_builtinzhreplicate_i8(ctx, status_flags_mem_50982, num_virt_blocks_50980, (int8_t) 0) != 0) {
            err = 1;
            goto cleanup;
        }
        if (memblock_alloc_device(ctx, &aggregates_mem_50984, (int64_t) 8 * num_virt_blocks_50980, "aggregates_mem_50984")) {
            err = 1;
            goto cleanup;
        }
        if (memblock_alloc_device(ctx, &incprefixes_mem_50986, (int64_t) 8 * num_virt_blocks_50980, "incprefixes_mem_50986")) {
            err = 1;
            goto cleanup;
        }
        {
            err = gpu_kernel_do_DBSCAN_doublezisegscan_44463(ctx, num_tblocks_44460, 1, 1, *ctx->tuning_params.do_DBSCAN_doublezisegscan_tblock_sizze_44457, 1, 1, smax64(smax64((int64_t) 288, (int64_t) 8 * segscan_tblock_sizze_44458), chunk_sizze_50979 * segscan_tblock_sizze_44458 * (int64_t) 8) + srem64((int64_t) 8 - srem64(smax64(smax64((int64_t) 288, (int64_t) 8 * segscan_tblock_sizze_44458), chunk_sizze_50979 * segscan_tblock_sizze_44458 * (int64_t) 8), (int64_t) 8), (int64_t) 8), m_41485, conc_tmp_41556, num_tblocks_44460, num_virt_blocks_50980, num_virt_threads_50981, mem_49478.mem, mem_49496.mem, mem_49506.mem, mem_49508.mem, status_flags_mem_50982.mem, aggregates_mem_50984.mem, incprefixes_mem_50986.mem, global_dynid_mem_50988.mem);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        if (ctx->debugging)
            fprintf(ctx->log, "%s\n", "");
    }
    
    int64_t m_f_res_41738;
    
    if (nonzzero_41565) {
        int64_t read_res_52177;
        
        if ((err = gpu_scalar_from_device(ctx, &read_res_52177, mem_49506.mem, tmp_41732 * sizeof(int64_t), sizeof(int64_t))) != 0)
            goto cleanup;
        if (ctx->failure_is_an_option && futhark_context_sync(ctx) != 0) {
            err = 1;
            goto cleanup;
        }
        
        int64_t x_42722 = read_res_52177;
        
        m_f_res_41738 = x_42722;
    } else {
        m_f_res_41738 = (int64_t) 0;
    }
    
    int64_t m_41740;
    
    if (zzero_41564) {
        m_41740 = (int64_t) 0;
    } else {
        m_41740 = m_f_res_41738;
    }
    
    int64_t m_41750 = sub64(m_41740, (int64_t) 1);
    bool y_41824 = slt64(m_41750, m_41740);
    bool zzero_leq_i_p_m_t_s_41751 = sle64((int64_t) 0, m_41750);
    bool bounds_check_41825 = zzero_leq_i_p_m_t_s_41751 && y_41824;
    bool eq_x_zz_41747 = (int64_t) 0 == m_f_res_41738;
    bool p_and_eq_x_y_41748 = nonzzero_41565 && eq_x_zz_41747;
    bool empty_slice_41749 = zzero_41564 || p_and_eq_x_y_41748;
    bool protect_assert_disj_41826 = empty_slice_41749 || bounds_check_41825;
    bool index_certs_41827;
    
    if (!protect_assert_disj_41826) {
        set_error(ctx, msgprintf("Error: %s%lld%s%lld%s\n\nBacktrace:\n%s", "Index [", (long long) m_41750, "] out of bounds for array of shape [", (long long) m_41740, "].", "-> #0  /prelude/soacs.fut:257:33-47\n   #1  /prelude/functional.fut:9:44-45\n   #2  ft_libs/ftDBSCAN_plus.fut:863:18-866:67\n   #3  ft_libs/ftDBSCAN_plus.fut:862:9-866:67\n"));
        err = FUTHARK_PROGRAM_ERROR;
        goto cleanup;
    }
    
    bool x_41823 = !empty_slice_41749;
    bool i_p_m_t_s_leq_w_41752 = slt64(m_41750, conc_tmp_41556);
    bool y_41754 = zzero_leq_i_p_m_t_s_41751 && i_p_m_t_s_leq_w_41752;
    bool ok_or_empty_41756 = empty_slice_41749 || y_41754;
    bool index_certs_41757;
    
    if (!ok_or_empty_41756) {
        set_error(ctx, msgprintf("Error: %s%lld%s%lld%s\n\nBacktrace:\n%s", "Index [:", (long long) m_41740, "] out of bounds for array of shape [", (long long) conc_tmp_41556, "].", "-> #0  /prelude/soacs.fut:258:29-35\n   #1  /prelude/functional.fut:9:44-45\n   #2  ft_libs/ftDBSCAN_plus.fut:863:18-866:67\n   #3  ft_libs/ftDBSCAN_plus.fut:862:9-866:67\n"));
        err = FUTHARK_PROGRAM_ERROR;
        goto cleanup;
    }
    
    int64_t bytes_49509 = (int64_t) 8 * m_41740;
    
    if (memblock_alloc_device(ctx, &mem_49510, bytes_49509, "mem_49510")) {
        err = 1;
        goto cleanup;
    }
    if ((err = lmad_copy_gpu2gpu_8b(ctx, 1, mem_49510.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, mem_49503.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, (int64_t []) {m_41740})) != 0)
        goto cleanup;
    if (memblock_unref_device(ctx, &mem_49503, "mem_49503") != 0)
        return 1;
    
    int64_t zm_lhs_41693 = add64(conc_tmp_41556, max_res_41692);
    int64_t zs_lhs_41694 = sub64(zm_lhs_41693, (int64_t) 1);
    int64_t max_iter_41698 = sdiv64(zs_lhs_41694, max_res_41692);
    bool bounds_invalid_upwards_41699 = slt64(max_iter_41698, (int64_t) 0);
    bool valid_41700 = !bounds_invalid_upwards_41699;
    bool range_valid_c_41701;
    
    if (!valid_41700) {
        set_error(ctx, msgprintf("Error: %s%lld%s%lld%s%lld%s\n\nBacktrace:\n%s", "Range ", (long long) (int64_t) 0, "..", (long long) (int64_t) 1, "..<", (long long) max_iter_41698, " is invalid.", "-> #0  /prelude/array.fut:94:3-11\n   #1  ft_libs/ftbasics.fut:28:33-46\n   #2  ft_libs/ftDBSCAN_plus.fut:863:18-866:67\n   #3  ft_libs/ftDBSCAN_plus.fut:862:9-866:67\n"));
        err = FUTHARK_PROGRAM_ERROR;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_49512, bytes_49502, "mem_49512")) {
        err = 1;
        goto cleanup;
    }
    if (futrts_builtinzhreplicate_i64(ctx, mem_49512, conc_tmp_41556, (int64_t) -1) != 0) {
        err = 1;
        goto cleanup;
    }
    
    int64_t zm_lhs_41569 = add64(conc_tmp_41556, max_res_41927);
    int64_t zs_lhs_41570 = sub64(zm_lhs_41569, (int64_t) 1);
    int64_t num_iter_41574 = sdiv64(zs_lhs_41570, max_res_41927);
    bool bounds_invalid_upwards_41576 = slt64(num_iter_41574, (int64_t) 0);
    bool valid_41577 = !bounds_invalid_upwards_41576;
    bool range_valid_c_41578;
    
    if (!valid_41577) {
        set_error(ctx, msgprintf("Error: %s%lld%s%lld%s%lld%s\n\nBacktrace:\n%s", "Range ", (long long) (int64_t) 0, "..", (long long) (int64_t) 1, "..<", (long long) num_iter_41574, " is invalid.", "-> #0  /prelude/array.fut:94:3-11\n   #1  ft_libs/ftDBSCAN_plus.fut:523:73-86\n   #2  ft_libs/ftDBSCAN_plus.fut:863:18-866:67\n   #3  ft_libs/ftDBSCAN_plus.fut:862:9-866:67\n"));
        err = FUTHARK_PROGRAM_ERROR;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_49514, bytes_49502, "mem_49514")) {
        err = 1;
        goto cleanup;
    }
    if (futrts_builtinzhiota_i64(ctx, mem_49514, conc_tmp_41556, (int64_t) 0, (int64_t) 1) != 0) {
        err = 1;
        goto cleanup;
    }
    
    int64_t num_tblocks_44710;
    int64_t max_num_tblocks_51077;
    
    max_num_tblocks_51077 = *ctx->tuning_params.do_DBSCAN_doublezisegred_num_tblocks_44709;
    num_tblocks_44710 = sext_i64_i32(smax64((int64_t) 1, smin64(sdiv_up64(conc_tmp_41556, segred_tblock_sizze_44708), max_num_tblocks_51077)));
    
    int64_t num_whole_tiles_46597 = squot_safe64(conc_tmp_41556, tile_sizze_46537);
    int64_t residual_input_46804 = srem_safe64(conc_tmp_41556, tile_sizze_46537);
    bool cond_46805 = residual_input_46804 == (int64_t) 0;
    int64_t binop_x_46821 = tile_sizze_46537 * num_whole_tiles_46597;
    int64_t bytes_49561 = (int64_t) 8 * tile_sizze_46537;
    
    if (memblock_alloc_device(ctx, &mem_49592, (int64_t) 1, "mem_49592")) {
        err = 1;
        goto cleanup;
    }
    
    bool cluster_heads_41579;
    bool loop_while_41581;
    
    if (memblock_set_device(ctx, &mem_param_49517, &mem_49514, "mem_49514") != 0)
        return 1;
    loop_while_41581 = 1;
    while (loop_while_41581) {
        if (memblock_set_device(ctx, &mem_param_49520, &mem_param_49517, "mem_param_49517") != 0)
            return 1;
        for (int64_t i_41584 = 0; i_41584 < num_iter_41574; i_41584++) {
            int64_t inf_41586 = mul64(i_41584, max_res_41927);
            int64_t min_arg1_41587 = add64(inf_41586, max_res_41927);
            int64_t min_res_41588 = smin64(conc_tmp_41556, min_arg1_41587);
            int64_t j_m_i_41589 = sub64(min_res_41588, inf_41586);
            bool empty_slice_41590 = j_m_i_41589 == (int64_t) 0;
            int64_t m_41591 = sub64(j_m_i_41589, (int64_t) 1);
            int64_t i_p_m_t_s_41592 = add64(inf_41586, m_41591);
            bool zzero_leq_i_p_m_t_s_41593 = sle64((int64_t) 0, i_p_m_t_s_41592);
            bool i_p_m_t_s_leq_w_41594 = slt64(i_p_m_t_s_41592, conc_tmp_41556);
            bool zzero_lte_i_41595 = sle64((int64_t) 0, inf_41586);
            bool i_lte_j_41596 = sle64(inf_41586, min_res_41588);
            bool y_41597 = i_p_m_t_s_leq_w_41594 && zzero_lte_i_41595;
            bool y_41598 = zzero_leq_i_p_m_t_s_41593 && y_41597;
            bool forwards_ok_41599 = i_lte_j_41596 && y_41598;
            bool ok_or_empty_41600 = empty_slice_41590 || forwards_ok_41599;
            bool index_certs_41601;
            
            if (!ok_or_empty_41600) {
                set_error(ctx, msgprintf("Error: %s%lld%s%lld%s%lld%s\n\nBacktrace:\n%s", "Index [", (long long) inf_41586, ":", (long long) min_res_41588, "] out of bounds for array of shape [", (long long) conc_tmp_41556, "].", "-> #0  ft_libs/ftDBSCAN_plus.fut:526:64-81\n   #1  ft_libs/ftDBSCAN_plus.fut:863:18-866:67\n   #2  ft_libs/ftDBSCAN_plus.fut:862:9-866:67\n"));
                err = FUTHARK_PROGRAM_ERROR;
                goto cleanup;
            }
            
            bool suff_outer_par_44465;
            
            suff_outer_par_44465 = *ctx->tuning_params.do_DBSCAN_doublezisuff_outer_par_0 <= j_m_i_41589;
            if (ctx->logging)
                fprintf(ctx->log, "Compared %s <= %ld: %s.\n", "do_DBSCAN_double.suff_outer_par_0", (long) j_m_i_41589, suff_outer_par_44465 ? "true" : "false");
            
            int64_t nest_sizze_44658 = conc_tmp_41556 * j_m_i_41589;
            int64_t num_tblocks_44660;
            int64_t max_num_tblocks_51083;
            
            max_num_tblocks_51083 = *ctx->tuning_params.do_DBSCAN_doublezisegred_num_tblocks_44576;
            num_tblocks_44660 = sext_i64_i32(smax64((int64_t) 1, smin64(sdiv_up64(nest_sizze_44658, segred_tblock_sizze_44659), max_num_tblocks_51083)));
            
            int64_t bytes_49522 = (int64_t) 8 * j_m_i_41589;
            int64_t shared_memory_capacity_51182;
            
            shared_memory_capacity_51182 = ctx->max_shared_memory;
            if (suff_outer_par_44465 && sle64(sdiv_up64(bytes_49561, (int64_t) 8) * (int64_t) 8 + sdiv_up64(bytes_49561, (int64_t) 8) * (int64_t) 8 + sdiv_up64(bytes_49561, (int64_t) 8) * (int64_t) 8, shared_memory_capacity_51182)) {
                int64_t ldim_46538 = sdiv_up64(j_m_i_41589, tile_sizze_46537);
                
                if (memblock_alloc_device(ctx, &mem_49584, bytes_49522, "mem_49584")) {
                    err = 1;
                    goto cleanup;
                }
                if (ctx->debugging)
                    fprintf(ctx->log, "%s\n", "\n# SegMap");
                
                int32_t num_chunks_51084 = sext_i64_i32(sdiv_up64(tile_sizze_46537, tile_sizze_46537));
                int32_t virt_num_tblocks_51085 = sext_i64_i32(ldim_46538);
                
                {
                    err = gpu_kernel_do_DBSCAN_doublezisegmap_intrablock_46535(ctx, ldim_46538, 1, 1, *ctx->tuning_params.do_DBSCAN_doublezitile_sizze_46536, 1, 1, bytes_49561 + srem64((int64_t) 8 - srem64(bytes_49561, (int64_t) 8), (int64_t) 8) + (bytes_49561 + srem64((int64_t) 8 - srem64(bytes_49561, (int64_t) 8), (int64_t) 8)) + (bytes_49561 + srem64((int64_t) 8 - srem64(bytes_49561, (int64_t) 8), (int64_t) 8)), clBase_34768, clBase_34769, clBase_34770, clBase_34776, m_41485, conc_tmp_41556, inf_41586, j_m_i_41589, ldim_46538, num_whole_tiles_46597, residual_input_46804, cond_46805, binop_x_46821, mem_49480.mem, mem_49482.mem, mem_49498.mem, mem_49500.mem, mem_param_49520.mem, mem_49584.mem);
                    if (err != FUTHARK_SUCCESS)
                        goto cleanup;
                }
                if (ctx->debugging)
                    fprintf(ctx->log, "%s\n", "");
                if (memblock_set_device(ctx, &ext_mem_49585, &mem_49584, "mem_49584") != 0)
                    return 1;
            } else {
                int64_t segmap_usable_groups_44642 = sdiv_up64(j_m_i_41589, segmap_tblock_sizze_44641);
                
                if (memblock_alloc_device(ctx, &mem_49523, bytes_49522, "mem_49523")) {
                    err = 1;
                    goto cleanup;
                }
                if (memblock_alloc_device(ctx, &mem_49525, bytes_49522, "mem_49525")) {
                    err = 1;
                    goto cleanup;
                }
                if (memblock_alloc_device(ctx, &mem_49527, bytes_49522, "mem_49527")) {
                    err = 1;
                    goto cleanup;
                }
                if (ctx->debugging)
                    fprintf(ctx->log, "%s\n", "\n# SegMap");
                
                int32_t virt_num_tblocks_51101 = sext_i64_i32(sdiv_up64(j_m_i_41589, segmap_tblock_sizze_44641));
                
                {
                    err = gpu_kernel_do_DBSCAN_doublezisegmap_44647(ctx, segmap_usable_groups_44642, 1, 1, *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_44626, 1, 1, (int64_t) 0, clBase_34768, m_41485, inf_41586, j_m_i_41589, mem_49480.mem, mem_49482.mem, mem_49498.mem, mem_49500.mem, mem_49523.mem, mem_49525.mem, mem_49527.mem);
                    if (err != FUTHARK_SUCCESS)
                        goto cleanup;
                }
                if (ctx->debugging)
                    fprintf(ctx->log, "%s\n", "");
                if (memblock_alloc_device(ctx, &mem_49530, bytes_49522, "mem_49530")) {
                    err = 1;
                    goto cleanup;
                }
                if (ctx->debugging)
                    fprintf(ctx->log, "%s\n", "\n# SegRed");
                
                int64_t chunk_sizze_51110 = (int64_t) 1;
                
                if (slt64(conc_tmp_41556 * (int64_t) 2, segred_tblock_sizze_44659 * chunk_sizze_51110)) {
                    int64_t segment_sizze_nonzzero_51111 = smax64((int64_t) 1, conc_tmp_41556);
                    int64_t num_threads_51112 = segred_tblock_sizze_44659 * segred_tblock_sizze_44659;
                    
                    if (ctx->debugging)
                        fprintf(ctx->log, "%s\n", "# SegRed-small");
                    if (ctx->debugging)
                        fprintf(ctx->log, "%s: %llu%c", "num_segments", (long long) j_m_i_41589, '\n');
                    if (ctx->debugging)
                        fprintf(ctx->log, "%s: %llu%c", "segment_size", (long long) conc_tmp_41556, '\n');
                    if (ctx->debugging)
                        fprintf(ctx->log, "%s: %llu%c", "segments_per_block", (long long) squot64(segred_tblock_sizze_44659, segment_sizze_nonzzero_51111), '\n');
                    if (ctx->debugging)
                        fprintf(ctx->log, "%s: %llu%c", "required_blocks", (long long) sext_i64_i32(sdiv_up64(j_m_i_41589, squot64(segred_tblock_sizze_44659, segment_sizze_nonzzero_51111))), '\n');
                    {
                        err = gpu_kernel_do_DBSCAN_doublezisegred_small_44665(ctx, num_tblocks_44660, 1, 1, *ctx->tuning_params.do_DBSCAN_doublezisegred_tblock_sizze_44574, 1, 1, (int64_t) 8 * segred_tblock_sizze_44659 + srem64((int64_t) 8 - srem64((int64_t) 8 * segred_tblock_sizze_44659, (int64_t) 8), (int64_t) 8), clBase_34768, clBase_34769, clBase_34770, clBase_34776, m_41485, conc_tmp_41556, inf_41586, j_m_i_41589, num_tblocks_44660, x_49366, segment_sizze_nonzzero_51111, mem_49480.mem, mem_49482.mem, mem_49498.mem, mem_49500.mem, mem_param_49520.mem, mem_49523.mem, mem_49525.mem, mem_49527.mem, mem_49530.mem);
                        if (err != FUTHARK_SUCCESS)
                            goto cleanup;
                    }
                } else {
                    int64_t blocks_per_segment_51139 = sdiv_up64(num_tblocks_44660, smax64((int64_t) 1, j_m_i_41589));
                    int64_t q_51140 = sdiv_up64(conc_tmp_41556, segred_tblock_sizze_44659 * blocks_per_segment_51139 * chunk_sizze_51110);
                    int64_t num_virtblocks_51141 = blocks_per_segment_51139 * j_m_i_41589;
                    int64_t threads_per_segment_51142 = blocks_per_segment_51139 * segred_tblock_sizze_44659;
                    
                    if (ctx->debugging)
                        fprintf(ctx->log, "%s\n", "# SegRed-large");
                    if (ctx->debugging)
                        fprintf(ctx->log, "%s: %llu%c", "num_segments", (long long) j_m_i_41589, '\n');
                    if (ctx->debugging)
                        fprintf(ctx->log, "%s: %llu%c", "segment_size", (long long) conc_tmp_41556, '\n');
                    if (ctx->debugging)
                        fprintf(ctx->log, "%s: %llu%c", "num_virtblocks", (long long) num_virtblocks_51141, '\n');
                    if (ctx->debugging)
                        fprintf(ctx->log, "%s: %llu%c", "num_tblocks", (long long) num_tblocks_44660, '\n');
                    if (ctx->debugging)
                        fprintf(ctx->log, "%s: %llu%c", "tblock_size", (long long) segred_tblock_sizze_44659, '\n');
                    if (ctx->debugging)
                        fprintf(ctx->log, "%s: %llu%c", "q", (long long) q_51140, '\n');
                    if (ctx->debugging)
                        fprintf(ctx->log, "%s: %llu%c", "blocks_per_segment", (long long) blocks_per_segment_51139, '\n');
                    if (memblock_alloc_device(ctx, &segred_tmp_mem_51143, (int64_t) 8 * num_virtblocks_51141, "segred_tmp_mem_51143")) {
                        err = 1;
                        goto cleanup;
                    }
                    {
                        err = gpu_kernel_do_DBSCAN_doublezisegred_large_44665(ctx, num_tblocks_44660, 1, 1, *ctx->tuning_params.do_DBSCAN_doublezisegred_tblock_sizze_44574, 1, 1, 8 + ((int64_t) 8 * segred_tblock_sizze_44659 + srem64((int64_t) 8 - srem64((int64_t) 8 * segred_tblock_sizze_44659, (int64_t) 8), (int64_t) 8)), clBase_34768, clBase_34769, clBase_34770, clBase_34776, m_41485, conc_tmp_41556, inf_41586, j_m_i_41589, num_tblocks_44660, x_49366, blocks_per_segment_51139, q_51140, num_virtblocks_51141, threads_per_segment_51142, mem_49480.mem, mem_49482.mem, mem_49498.mem, mem_49500.mem, mem_param_49520.mem, mem_49523.mem, mem_49525.mem, mem_49527.mem, mem_49530.mem, segred_tmp_mem_51143.mem, counters_mem_51145.mem);
                        if (err != FUTHARK_SUCCESS)
                            goto cleanup;
                    }
                }
                if (ctx->debugging)
                    fprintf(ctx->log, "%s\n", "");
                if (memblock_unref_device(ctx, &mem_49523, "mem_49523") != 0)
                    return 1;
                if (memblock_unref_device(ctx, &mem_49525, "mem_49525") != 0)
                    return 1;
                if (memblock_unref_device(ctx, &mem_49527, "mem_49527") != 0)
                    return 1;
                if (memblock_set_device(ctx, &ext_mem_49585, &mem_49530, "mem_49530") != 0)
                    return 1;
            }
            if (memblock_alloc_device(ctx, &mem_49587, bytes_49502, "mem_49587")) {
                err = 1;
                goto cleanup;
            }
            if ((err = lmad_copy_gpu2gpu_8b(ctx, 1, mem_49587.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, mem_param_49520.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, (int64_t []) {conc_tmp_41556})) != 0)
                goto cleanup;
            if ((err = lmad_copy_gpu2gpu_8b(ctx, 1, mem_49587.mem, inf_41586, (int64_t []) {(int64_t) 1}, ext_mem_49585.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, (int64_t []) {j_m_i_41589})) != 0)
                goto cleanup;
            if (memblock_unref_device(ctx, &ext_mem_49585, "ext_mem_49585") != 0)
                return 1;
            if (memblock_set_device(ctx, &mem_param_tmp_51081, &mem_49587, "mem_49587") != 0)
                return 1;
            if (memblock_set_device(ctx, &mem_param_49520, &mem_param_tmp_51081, "mem_param_tmp_51081") != 0)
                return 1;
        }
        if (memblock_set_device(ctx, &ext_mem_49590, &mem_param_49520, "mem_param_49520") != 0)
            return 1;
        if (ctx->debugging)
            fprintf(ctx->log, "%s\n", "\n# SegRed");
        
        int64_t chunk_sizze_51183 = (int64_t) 1;
        
        if (memblock_alloc_device(ctx, &segred_tmp_mem_51186, num_tblocks_44710, "segred_tmp_mem_51186")) {
            err = 1;
            goto cleanup;
        }
        
        int64_t num_threads_51188 = num_tblocks_44710 * segred_tblock_sizze_44708;
        
        {
            err = gpu_kernel_do_DBSCAN_doublezisegred_nonseg_44715(ctx, num_tblocks_44710, 1, 1, *ctx->tuning_params.do_DBSCAN_doublezisegred_tblock_sizze_44707, 1, 1, 8 + (segred_tblock_sizze_44708 + srem64((int64_t) 8 - srem64(segred_tblock_sizze_44708, (int64_t) 8), (int64_t) 8)), conc_tmp_41556, num_tblocks_44710, num_threads_51188, mem_param_49517.mem, ext_mem_49590.mem, mem_49592.mem, counters_mem_51184.mem, segred_tmp_mem_51186.mem);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        if (ctx->debugging)
            fprintf(ctx->log, "%s\n", "");
        
        bool read_res_52178;
        
        if ((err = gpu_scalar_from_device(ctx, &read_res_52178, mem_49592.mem, (int64_t) 0 * sizeof(bool), sizeof(bool))) != 0)
            goto cleanup;
        if (ctx->failure_is_an_option && futhark_context_sync(ctx) != 0) {
            err = 1;
            goto cleanup;
        }
        
        bool defunc_0_reduce_res_42715 = read_res_52178;
        bool loop_cond_41667 = !defunc_0_reduce_res_42715;
        
        if (memblock_set_device(ctx, &mem_param_tmp_51078, &ext_mem_49590, "ext_mem_49590") != 0)
            return 1;
        
        bool loop_while_tmp_51079 = loop_cond_41667;
        
        if (memblock_set_device(ctx, &mem_param_49517, &mem_param_tmp_51078, "mem_param_tmp_51078") != 0)
            return 1;
        loop_while_41581 = loop_while_tmp_51079;
    }
    if (memblock_set_device(ctx, &ext_mem_49595, &mem_param_49517, "mem_param_49517") != 0)
        return 1;
    cluster_heads_41579 = loop_while_41581;
    if (memblock_unref_device(ctx, &mem_49514, "mem_49514") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_49592, "mem_49592") != 0)
        return 1;
    
    int64_t num_tblocks_44720;
    int64_t max_num_tblocks_51217;
    
    max_num_tblocks_51217 = *ctx->tuning_params.do_DBSCAN_doublezisegscan_num_tblocks_44719;
    num_tblocks_44720 = sext_i64_i32(smax64((int64_t) 1, smin64(sdiv_up64(conc_tmp_41556, segscan_tblock_sizze_44718), max_num_tblocks_51217)));
    if (memblock_alloc_device(ctx, &mem_49598, bytes_49502, "mem_49598")) {
        err = 1;
        goto cleanup;
    }
    if (slt64((int64_t) 0, conc_tmp_41556)) {
        if (ctx->debugging)
            fprintf(ctx->log, "%s\n", "\n# SegScan");
        
        int64_t shared_memory_51218;
        
        shared_memory_51218 = ctx->max_shared_memory;
        
        int64_t thread_block_sizze_51219;
        
        thread_block_sizze_51219 = ctx->max_thread_block_size;
        
        int64_t registers_51220;
        
        registers_51220 = ctx->max_registers;
        
        int64_t thread_block_sizze_51221;
        
        thread_block_sizze_51221 = ctx->max_thread_block_size;
        
        int64_t chunk_sizze_51222 = smax64((int64_t) 1, smin64(squot64(squot64(shared_memory_51218, thread_block_sizze_51219), (int64_t) 8), squot64(squot64(registers_51220, thread_block_sizze_51221) - (int64_t) 1 - squot64(smax64((int64_t) 4, (int64_t) 8), (int64_t) 4), (int64_t) 2 * squot64(smax64((int64_t) 4, (int64_t) 8), (int64_t) 4))));
        int64_t num_virt_blocks_51223 = sdiv_up64(conc_tmp_41556, segscan_tblock_sizze_44718 * chunk_sizze_51222);
        int64_t num_virt_threads_51224 = num_virt_blocks_51223 * segscan_tblock_sizze_44718;
        
        if (ctx->debugging)
            fprintf(ctx->log, "%s: %llu%c", "Sequential elements per thread (chunk)", (long long) chunk_sizze_51222, '\n');
        if (memblock_alloc_device(ctx, &status_flags_mem_51225, num_virt_blocks_51223, "status_flags_mem_51225")) {
            err = 1;
            goto cleanup;
        }
        if (futrts_builtinzhreplicate_i8(ctx, status_flags_mem_51225, num_virt_blocks_51223, (int8_t) 0) != 0) {
            err = 1;
            goto cleanup;
        }
        if (memblock_alloc_device(ctx, &aggregates_mem_51227, (int64_t) 8 * num_virt_blocks_51223, "aggregates_mem_51227")) {
            err = 1;
            goto cleanup;
        }
        if (memblock_alloc_device(ctx, &incprefixes_mem_51229, (int64_t) 8 * num_virt_blocks_51223, "incprefixes_mem_51229")) {
            err = 1;
            goto cleanup;
        }
        {
            err = gpu_kernel_do_DBSCAN_doublezisegscan_44723(ctx, num_tblocks_44720, 1, 1, *ctx->tuning_params.do_DBSCAN_doublezisegscan_tblock_sizze_44717, 1, 1, smax64(smax64((int64_t) 288, (int64_t) 8 * segscan_tblock_sizze_44718), chunk_sizze_51222 * segscan_tblock_sizze_44718 * (int64_t) 8) + srem64((int64_t) 8 - srem64(smax64(smax64((int64_t) 288, (int64_t) 8 * segscan_tblock_sizze_44718), chunk_sizze_51222 * segscan_tblock_sizze_44718 * (int64_t) 8), (int64_t) 8), (int64_t) 8), conc_tmp_41556, num_tblocks_44720, num_virt_blocks_51223, num_virt_threads_51224, ext_mem_49595.mem, mem_49598.mem, status_flags_mem_51225.mem, aggregates_mem_51227.mem, incprefixes_mem_51229.mem, global_dynid_mem_51231.mem);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        if (ctx->debugging)
            fprintf(ctx->log, "%s\n", "");
    }
    
    int64_t segmap_usable_groups_44740 = sdiv_up64(conc_tmp_41556, segmap_tblock_sizze_44739);
    
    if (memblock_alloc_device(ctx, &mem_49601, bytes_49502, "mem_49601")) {
        err = 1;
        goto cleanup;
    }
    if (ctx->debugging)
        fprintf(ctx->log, "%s\n", "\n# SegMap");
    
    int32_t virt_num_tblocks_51320 = sext_i64_i32(sdiv_up64(conc_tmp_41556, segmap_tblock_sizze_44739));
    
    {
        err = gpu_kernel_do_DBSCAN_doublezisegmap_44743(ctx, segmap_usable_groups_44740, 1, 1, *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_44727, 1, 1, (int64_t) 0, conc_tmp_41556, mem_49598.mem, mem_49601.mem);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (ctx->debugging)
        fprintf(ctx->log, "%s\n", "");
    if (memblock_unref_device(ctx, &mem_49598, "mem_49598") != 0)
        return 1;
    
    int64_t segmap_usable_groups_44771 = sdiv_up_safe64(conc_tmp_41556, segmap_tblock_sizze_44770);
    
    if (memblock_set_device(ctx, &mem_param_49604, &mem_49512, "mem_49512") != 0)
        return 1;
    for (int64_t i_41703 = 0; i_41703 < max_iter_41698; i_41703++) {
        int64_t inf_41705 = mul64(max_res_41692, i_41703);
        int64_t min_arg1_41706 = add64(max_res_41692, inf_41705);
        int64_t min_res_41707 = smin64(conc_tmp_41556, min_arg1_41706);
        
        if (memblock_alloc_device(ctx, &mem_49607, bytes_49502, "mem_49607")) {
            err = 1;
            goto cleanup;
        }
        if (ctx->debugging)
            fprintf(ctx->log, "%s\n", "\n# SegMap");
        
        int32_t virt_num_tblocks_51331 = sext_i64_i32(sdiv_up64(conc_tmp_41556, segmap_tblock_sizze_44770));
        
        {
            err = gpu_kernel_do_DBSCAN_doublezisegmap_44774(ctx, segmap_usable_groups_44771, 1, 1, *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_44753, 1, 1, (int64_t) 0, conc_tmp_41556, inf_41705, min_res_41707, ext_mem_49595.mem, mem_49601.mem, mem_param_49604.mem, mem_49607.mem);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        ctx->failure_is_an_option = 1;
        if (ctx->debugging)
            fprintf(ctx->log, "%s\n", "");
        if (memblock_set_device(ctx, &mem_param_tmp_51329, &mem_49607, "mem_49607") != 0)
            return 1;
        if (memblock_set_device(ctx, &mem_param_49604, &mem_param_tmp_51329, "mem_param_tmp_51329") != 0)
            return 1;
    }
    if (memblock_set_device(ctx, &ext_mem_49610, &mem_param_49604, "mem_param_49604") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_49512, "mem_49512") != 0)
        return 1;
    if (memblock_unref_device(ctx, &ext_mem_49595, "ext_mem_49595") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_49601, "mem_49601") != 0)
        return 1;
    
    int64_t segmap_usable_groups_44798 = sdiv_up64(conc_tmp_41556, segmap_tblock_sizze_44797);
    
    if (memblock_alloc_device(ctx, &mem_49613, bytes_49502, "mem_49613")) {
        err = 1;
        goto cleanup;
    }
    if (ctx->debugging)
        fprintf(ctx->log, "%s\n", "\n# SegMap");
    
    int32_t virt_num_tblocks_51340 = sext_i64_i32(sdiv_up64(conc_tmp_41556, segmap_tblock_sizze_44797));
    
    {
        err = gpu_kernel_do_DBSCAN_doublezisegmap_44801(ctx, segmap_usable_groups_44798, 1, 1, *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_44789, 1, 1, (int64_t) 0, clProc_34783, conc_tmp_41556, ext_mem_49610.mem, mem_49613.mem);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (ctx->debugging)
        fprintf(ctx->log, "%s\n", "");
    if (memblock_unref_device(ctx, &ext_mem_49610, "ext_mem_49610") != 0)
        return 1;
    if (memblock_alloc_device(ctx, &mem_49615, bytes_49509, "mem_49615")) {
        err = 1;
        goto cleanup;
    }
    if ((err = lmad_copy_gpu2gpu_8b(ctx, 1, mem_49615.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, mem_49613.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, (int64_t []) {m_41740})) != 0)
        goto cleanup;
    
    int64_t num_tblocks_44810;
    int64_t max_num_tblocks_51349;
    
    max_num_tblocks_51349 = *ctx->tuning_params.do_DBSCAN_doublezisegmap_num_tblocks_44809;
    num_tblocks_44810 = sext_i64_i32(smax64((int64_t) 1, smin64(sdiv_up64(conc_tmp_41556, segmap_tblock_sizze_44808), max_num_tblocks_51349)));
    if (ctx->debugging)
        fprintf(ctx->log, "%s\n", "\n# SegMap");
    
    int32_t virt_num_tblocks_51350 = sext_i64_i32(sdiv_up64(conc_tmp_41556, segmap_tblock_sizze_44808));
    
    {
        err = gpu_kernel_do_DBSCAN_doublezisegmap_44805(ctx, num_tblocks_44810, 1, 1, *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_44807, 1, 1, (int64_t) 0, m_41485, conc_tmp_41556, m_41740, num_tblocks_44810, virt_num_tblocks_51350, mem_49478.mem, mem_49496.mem, mem_49506.mem, mem_49508.mem, mem_49510.mem, mem_49613.mem, mem_49615.mem);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (ctx->debugging)
        fprintf(ctx->log, "%s\n", "");
    if (memblock_unref_device(ctx, &mem_49478, "mem_49478") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_49496, "mem_49496") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_49506, "mem_49506") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_49508, "mem_49508") != 0)
        return 1;
    
    bool suff_outer_screma_44842;
    
    suff_outer_screma_44842 = *ctx->tuning_params.do_DBSCAN_doublezisuff_outer_screma_1 <= m_41740;
    if (ctx->logging)
        fprintf(ctx->log, "Compared %s <= %ld: %s.\n", "do_DBSCAN_double.suff_outer_screma_1", (long) m_41740, suff_outer_screma_44842 ? "true" : "false");
    
    bool suff_outer_par_45112;
    
    suff_outer_par_45112 = *ctx->tuning_params.do_DBSCAN_doublezisuff_outer_par_2 <= m_41740;
    if (ctx->logging)
        fprintf(ctx->log, "Compared %s <= %ld: %s.\n", "do_DBSCAN_double.suff_outer_par_2", (long) m_41740, suff_outer_par_45112 ? "true" : "false");
    
    int64_t num_tblocks_45206;
    int64_t max_num_tblocks_51363;
    
    max_num_tblocks_51363 = *ctx->tuning_params.do_DBSCAN_doublezisegscan_num_tblocks_45106;
    num_tblocks_45206 = sext_i64_i32(smax64((int64_t) 1, smin64(sdiv_up64(m_41740, segscan_tblock_sizze_45205), max_num_tblocks_51363)));
    
    int64_t num_tblocks_44853;
    int64_t max_num_tblocks_51364;
    
    max_num_tblocks_51364 = *ctx->tuning_params.do_DBSCAN_doublezisegscan_num_tblocks_44846;
    num_tblocks_44853 = sext_i64_i32(smax64((int64_t) 1, smin64(sdiv_up64(m_41740, segscan_tblock_sizze_44852), max_num_tblocks_51364)));
    
    int64_t ldim_47273 = sdiv_up_safe64(m_41740, tile_sizze_47272);
    int64_t num_whole_tiles_47293 = squot_safe64(m_41740, tile_sizze_47272);
    int64_t residual_input_47507 = srem_safe64(m_41740, tile_sizze_47272);
    bool cond_47508 = residual_input_47507 == (int64_t) 0;
    int64_t ldim_46918 = sdiv_up_safe64(m_41740, tile_sizze_46917);
    int64_t num_whole_tiles_46938 = squot_safe64(m_41740, tile_sizze_46917);
    int64_t residual_input_47152 = srem_safe64(m_41740, tile_sizze_46917);
    bool cond_47153 = residual_input_47152 == (int64_t) 0;
    int64_t binop_x_47524 = tile_sizze_47272 * num_whole_tiles_47293;
    int64_t binop_x_47169 = tile_sizze_46917 * num_whole_tiles_46938;
    int64_t bytes_49641 = (int64_t) 8 * tile_sizze_47272;
    int64_t bytes_49703 = (int64_t) 8 * tile_sizze_46917;
    int64_t shared_memory_capacity_51520;
    
    shared_memory_capacity_51520 = ctx->max_shared_memory;
    if (suff_outer_par_45112 && sle64(sdiv_up64(bytes_49703, (int64_t) 8) * (int64_t) 8 + sdiv_up64(bytes_49703, (int64_t) 8) * (int64_t) 8 + sdiv_up64(bytes_49703, (int64_t) 8) * (int64_t) 8, shared_memory_capacity_51520)) {
        if (memblock_alloc_device(ctx, &mem_49740, bytes_49509, "mem_49740")) {
            err = 1;
            goto cleanup;
        }
        if (ctx->debugging)
            fprintf(ctx->log, "%s\n", "\n# SegMap");
        
        int32_t num_chunks_51470 = sext_i64_i32(sdiv_up64(tile_sizze_46917, tile_sizze_46917));
        int32_t virt_num_tblocks_51471 = sext_i64_i32(ldim_46918);
        
        {
            err = gpu_kernel_do_DBSCAN_doublezisegmap_intrablock_46915(ctx, ldim_46918, 1, 1, *ctx->tuning_params.do_DBSCAN_doublezitile_sizze_46916, 1, 1, bytes_49703 + srem64((int64_t) 8 - srem64(bytes_49703, (int64_t) 8), (int64_t) 8) + (bytes_49703 + srem64((int64_t) 8 - srem64(bytes_49703, (int64_t) 8), (int64_t) 8)) + (bytes_49703 + srem64((int64_t) 8 - srem64(bytes_49703, (int64_t) 8), (int64_t) 8)), m_41740, ldim_46918, num_whole_tiles_46938, residual_input_47152, cond_47153, binop_x_47169, mem_49510.mem, mem_49615.mem, mem_49740.mem);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        if (ctx->debugging)
            fprintf(ctx->log, "%s\n", "");
        if (memblock_set_device(ctx, &ext_mem_49741, &mem_49740, "mem_49740") != 0)
            return 1;
    } else {
        if (memblock_alloc_device(ctx, &mem_49678, bytes_49509, "mem_49678")) {
            err = 1;
            goto cleanup;
        }
        if (ctx->debugging)
            fprintf(ctx->log, "%s\n", "\n# SegMap");
        
        int32_t num_chunks_51495 = sext_i64_i32(sdiv_up64(tile_sizze_47272, tile_sizze_47272));
        int32_t virt_num_tblocks_51496 = sext_i64_i32(ldim_47273);
        
        {
            err = gpu_kernel_do_DBSCAN_doublezisegmap_intrablock_47270(ctx, ldim_47273, 1, 1, *ctx->tuning_params.do_DBSCAN_doublezitile_sizze_47271, 1, 1, bytes_49641 + srem64((int64_t) 8 - srem64(bytes_49641, (int64_t) 8), (int64_t) 8) + (bytes_49641 + srem64((int64_t) 8 - srem64(bytes_49641, (int64_t) 8), (int64_t) 8)) + (bytes_49641 + srem64((int64_t) 8 - srem64(bytes_49641, (int64_t) 8), (int64_t) 8)), m_41740, ldim_47273, num_whole_tiles_47293, residual_input_47507, cond_47508, binop_x_47524, mem_49510.mem, mem_49615.mem, mem_49678.mem);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        if (ctx->debugging)
            fprintf(ctx->log, "%s\n", "");
        if (memblock_set_device(ctx, &ext_mem_49741, &mem_49678, "mem_49678") != 0)
            return 1;
    }
    if (memblock_alloc_device(ctx, &mem_49743, bytes_49509, "mem_49743")) {
        err = 1;
        goto cleanup;
    }
    if ((err = lmad_copy_gpu2gpu_8b(ctx, 1, mem_49743.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, ext_mem_49741.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, (int64_t []) {m_41740})) != 0)
        goto cleanup;
    if (memblock_alloc_device(ctx, &mem_49746, bytes_49509, "mem_49746")) {
        err = 1;
        goto cleanup;
    }
    if (slt64((int64_t) 0, m_41740)) {
        if (ctx->debugging)
            fprintf(ctx->log, "%s\n", "\n# SegScan");
        
        int64_t shared_memory_51521;
        
        shared_memory_51521 = ctx->max_shared_memory;
        
        int64_t thread_block_sizze_51522;
        
        thread_block_sizze_51522 = ctx->max_thread_block_size;
        
        int64_t registers_51523;
        
        registers_51523 = ctx->max_registers;
        
        int64_t thread_block_sizze_51524;
        
        thread_block_sizze_51524 = ctx->max_thread_block_size;
        
        int64_t chunk_sizze_51525 = smax64((int64_t) 1, smin64(squot64(squot64(shared_memory_51521, thread_block_sizze_51522), (int64_t) 8), squot64(squot64(registers_51523, thread_block_sizze_51524) - (int64_t) 1 - squot64(smax64((int64_t) 4, (int64_t) 8), (int64_t) 4), (int64_t) 2 * squot64(smax64((int64_t) 4, (int64_t) 8), (int64_t) 4))));
        int64_t num_virt_blocks_51526 = sdiv_up64(m_41740, segscan_tblock_sizze_45205 * chunk_sizze_51525);
        int64_t num_virt_threads_51527 = num_virt_blocks_51526 * segscan_tblock_sizze_45205;
        
        if (ctx->debugging)
            fprintf(ctx->log, "%s: %llu%c", "Sequential elements per thread (chunk)", (long long) chunk_sizze_51525, '\n');
        if (memblock_alloc_device(ctx, &status_flags_mem_51528, num_virt_blocks_51526, "status_flags_mem_51528")) {
            err = 1;
            goto cleanup;
        }
        if (futrts_builtinzhreplicate_i8(ctx, status_flags_mem_51528, num_virt_blocks_51526, (int8_t) 0) != 0) {
            err = 1;
            goto cleanup;
        }
        if (memblock_alloc_device(ctx, &aggregates_mem_51530, (int64_t) 8 * num_virt_blocks_51526, "aggregates_mem_51530")) {
            err = 1;
            goto cleanup;
        }
        if (memblock_alloc_device(ctx, &incprefixes_mem_51532, (int64_t) 8 * num_virt_blocks_51526, "incprefixes_mem_51532")) {
            err = 1;
            goto cleanup;
        }
        {
            err = gpu_kernel_do_DBSCAN_doublezisegscan_45210(ctx, num_tblocks_45206, 1, 1, *ctx->tuning_params.do_DBSCAN_doublezisegscan_tblock_sizze_45104, 1, 1, smax64(smax64((int64_t) 288, (int64_t) 8 * segscan_tblock_sizze_45205), chunk_sizze_51525 * segscan_tblock_sizze_45205 * (int64_t) 8) + srem64((int64_t) 8 - srem64(smax64(smax64((int64_t) 288, (int64_t) 8 * segscan_tblock_sizze_45205), chunk_sizze_51525 * segscan_tblock_sizze_45205 * (int64_t) 8), (int64_t) 8), (int64_t) 8), m_41740, num_tblocks_45206, num_virt_blocks_51526, num_virt_threads_51527, ext_mem_49741.mem, mem_49746.mem, status_flags_mem_51528.mem, aggregates_mem_51530.mem, incprefixes_mem_51532.mem, global_dynid_mem_51534.mem);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        if (ctx->debugging)
            fprintf(ctx->log, "%s\n", "");
    }
    if (memblock_unref_device(ctx, &ext_mem_49741, "ext_mem_49741") != 0)
        return 1;
    if (memblock_set_device(ctx, &ext_mem_49753, &mem_49746, "mem_49746") != 0)
        return 1;
    if (memblock_set_device(ctx, &ext_mem_49752, &mem_49743, "mem_49743") != 0)
        return 1;
    
    int64_t m_f_res_41828;
    
    if (x_41823) {
        int64_t read_res_52179;
        
        if ((err = gpu_scalar_from_device(ctx, &read_res_52179, ext_mem_49753.mem, m_41750 * sizeof(int64_t), sizeof(int64_t))) != 0)
            goto cleanup;
        if (ctx->failure_is_an_option && futhark_context_sync(ctx) != 0) {
            err = 1;
            goto cleanup;
        }
        
        int64_t x_42727 = read_res_52179;
        
        m_f_res_41828 = x_42727;
    } else {
        m_f_res_41828 = (int64_t) 0;
    }
    
    int64_t m_41830;
    
    if (empty_slice_41749) {
        m_41830 = (int64_t) 0;
    } else {
        m_41830 = m_f_res_41828;
    }
    
    int64_t m_41840 = sub64(m_41830, (int64_t) 1);
    bool i_p_m_t_s_leq_w_41842 = slt64(m_41840, m_41740);
    bool zzero_leq_i_p_m_t_s_41841 = sle64((int64_t) 0, m_41840);
    bool y_41844 = zzero_leq_i_p_m_t_s_41841 && i_p_m_t_s_leq_w_41842;
    bool i_lte_j_41843 = sle64((int64_t) 0, m_41830);
    bool forwards_ok_41845 = i_lte_j_41843 && y_41844;
    bool eq_x_zz_41837 = (int64_t) 0 == m_f_res_41828;
    bool p_and_eq_x_y_41838 = x_41823 && eq_x_zz_41837;
    bool empty_slice_41839 = empty_slice_41749 || p_and_eq_x_y_41838;
    bool ok_or_empty_41846 = empty_slice_41839 || forwards_ok_41845;
    bool index_certs_41847;
    
    if (!ok_or_empty_41846) {
        set_error(ctx, msgprintf("Error: %s%lld%s%lld%s\n\nBacktrace:\n%s", "Index [:", (long long) m_41830, "] out of bounds for array of shape [", (long long) m_41740, "].", "-> #0  /prelude/soacs.fut:258:29-35\n   #1  /prelude/functional.fut:9:44-45\n   #2  ft_libs/ftDBSCAN_plus.fut:863:18-866:67\n   #3  ft_libs/ftDBSCAN_plus.fut:862:9-866:67\n"));
        err = FUTHARK_PROGRAM_ERROR;
        goto cleanup;
    }
    
    int64_t bytes_49754 = (int64_t) 8 * m_41830;
    
    if (memblock_alloc_device(ctx, &mem_49755, bytes_49754, "mem_49755")) {
        err = 1;
        goto cleanup;
    }
    if ((err = lmad_copy_gpu2gpu_8b(ctx, 1, mem_49755.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, mem_49510.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, (int64_t []) {m_41830})) != 0)
        goto cleanup;
    if (memblock_alloc_device(ctx, &mem_49757, bytes_49754, "mem_49757")) {
        err = 1;
        goto cleanup;
    }
    if ((err = lmad_copy_gpu2gpu_8b(ctx, 1, mem_49757.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, mem_49615.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, (int64_t []) {m_41830})) != 0)
        goto cleanup;
    
    int64_t num_tblocks_45223;
    int64_t max_num_tblocks_51623;
    
    max_num_tblocks_51623 = *ctx->tuning_params.do_DBSCAN_doublezisegmap_num_tblocks_45222;
    num_tblocks_45223 = sext_i64_i32(smax64((int64_t) 1, smin64(sdiv_up64(m_41740, segmap_tblock_sizze_45221), max_num_tblocks_51623)));
    if (ctx->debugging)
        fprintf(ctx->log, "%s\n", "\n# SegMap");
    
    int32_t virt_num_tblocks_51624 = sext_i64_i32(sdiv_up64(m_41740, segmap_tblock_sizze_45221));
    
    {
        err = gpu_kernel_do_DBSCAN_doublezisegmap_45218(ctx, num_tblocks_45223, 1, 1, *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_45220, 1, 1, (int64_t) 0, m_41740, m_41830, num_tblocks_45223, virt_num_tblocks_51624, mem_49510.mem, mem_49615.mem, ext_mem_49752.mem, ext_mem_49753.mem, mem_49755.mem, mem_49757.mem);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (ctx->debugging)
        fprintf(ctx->log, "%s\n", "");
    if (memblock_unref_device(ctx, &mem_49510, "mem_49510") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_49615, "mem_49615") != 0)
        return 1;
    if (memblock_unref_device(ctx, &ext_mem_49752, "ext_mem_49752") != 0)
        return 1;
    if (memblock_unref_device(ctx, &ext_mem_49753, "ext_mem_49753") != 0)
        return 1;
    
    int64_t num_tblocks_45674;
    int64_t max_num_tblocks_51637;
    
    max_num_tblocks_51637 = *ctx->tuning_params.do_DBSCAN_doublezisegscan_num_tblocks_45673;
    num_tblocks_45674 = sext_i64_i32(smax64((int64_t) 1, smin64(sdiv_up64(m_41830, segscan_tblock_sizze_45672), max_num_tblocks_51637)));
    if (memblock_alloc_device(ctx, &mem_49927, bytes_49754, "mem_49927")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_49929, bytes_49754, "mem_49929")) {
        err = 1;
        goto cleanup;
    }
    if (slt64((int64_t) 0, m_41830)) {
        if (ctx->debugging)
            fprintf(ctx->log, "%s\n", "\n# SegScan");
        
        int64_t shared_memory_51638;
        
        shared_memory_51638 = ctx->max_shared_memory;
        
        int64_t thread_block_sizze_51639;
        
        thread_block_sizze_51639 = ctx->max_thread_block_size;
        
        int64_t registers_51640;
        
        registers_51640 = ctx->max_registers;
        
        int64_t thread_block_sizze_51641;
        
        thread_block_sizze_51641 = ctx->max_thread_block_size;
        
        int64_t chunk_sizze_51642 = smax64((int64_t) 1, smin64(squot64(squot64(shared_memory_51638, thread_block_sizze_51639), (int64_t) 8), squot64(squot64(registers_51640, thread_block_sizze_51641) - (int64_t) 1 - squot64(smax64((int64_t) 4, (int64_t) 8), (int64_t) 4), (int64_t) 2 * squot64(smax64((int64_t) 4, (int64_t) 8), (int64_t) 4))));
        int64_t num_virt_blocks_51643 = sdiv_up64(m_41830, segscan_tblock_sizze_45672 * chunk_sizze_51642);
        int64_t num_virt_threads_51644 = num_virt_blocks_51643 * segscan_tblock_sizze_45672;
        
        if (ctx->debugging)
            fprintf(ctx->log, "%s: %llu%c", "Sequential elements per thread (chunk)", (long long) chunk_sizze_51642, '\n');
        if (memblock_alloc_device(ctx, &status_flags_mem_51645, num_virt_blocks_51643, "status_flags_mem_51645")) {
            err = 1;
            goto cleanup;
        }
        if (futrts_builtinzhreplicate_i8(ctx, status_flags_mem_51645, num_virt_blocks_51643, (int8_t) 0) != 0) {
            err = 1;
            goto cleanup;
        }
        if (memblock_alloc_device(ctx, &aggregates_mem_51647, (int64_t) 8 * num_virt_blocks_51643, "aggregates_mem_51647")) {
            err = 1;
            goto cleanup;
        }
        if (memblock_alloc_device(ctx, &incprefixes_mem_51649, (int64_t) 8 * num_virt_blocks_51643, "incprefixes_mem_51649")) {
            err = 1;
            goto cleanup;
        }
        {
            err = gpu_kernel_do_DBSCAN_doublezisegscan_45677(ctx, num_tblocks_45674, 1, 1, *ctx->tuning_params.do_DBSCAN_doublezisegscan_tblock_sizze_45671, 1, 1, smax64(smax64((int64_t) 288, (int64_t) 8 * segscan_tblock_sizze_45672), chunk_sizze_51642 * segscan_tblock_sizze_45672 * (int64_t) 8) + srem64((int64_t) 8 - srem64(smax64(smax64((int64_t) 288, (int64_t) 8 * segscan_tblock_sizze_45672), chunk_sizze_51642 * segscan_tblock_sizze_45672 * (int64_t) 8), (int64_t) 8), (int64_t) 8), clProc_34783, m_41830, num_tblocks_45674, num_virt_blocks_51643, num_virt_threads_51644, mem_49757.mem, mem_49927.mem, mem_49929.mem, status_flags_mem_51645.mem, aggregates_mem_51647.mem, incprefixes_mem_51649.mem, global_dynid_mem_51651.mem);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        if (ctx->debugging)
            fprintf(ctx->log, "%s\n", "");
    }
    
    bool x_41889 = !empty_slice_41839;
    bool y_41890 = slt64(m_41840, m_41830);
    bool bounds_check_41891 = zzero_leq_i_p_m_t_s_41841 && y_41890;
    bool protect_assert_disj_41892 = empty_slice_41839 || bounds_check_41891;
    bool index_certs_41893;
    
    if (!protect_assert_disj_41892) {
        set_error(ctx, msgprintf("Error: %s%lld%s%lld%s\n\nBacktrace:\n%s", "Index [", (long long) m_41840, "] out of bounds for array of shape [", (long long) m_41830, "].", "-> #0  /prelude/soacs.fut:257:33-47\n   #1  /prelude/functional.fut:9:44-45\n   #2  ft_libs/ftDBSCAN_plus.fut:863:18-866:67\n   #3  ft_libs/ftDBSCAN_plus.fut:862:9-866:67\n"));
        err = FUTHARK_PROGRAM_ERROR;
        goto cleanup;
    }
    
    int64_t m_f_res_41894;
    
    if (x_41889) {
        int64_t read_res_52180;
        
        if ((err = gpu_scalar_from_device(ctx, &read_res_52180, mem_49927.mem, m_41840 * sizeof(int64_t), sizeof(int64_t))) != 0)
            goto cleanup;
        if (ctx->failure_is_an_option && futhark_context_sync(ctx) != 0) {
            err = 1;
            goto cleanup;
        }
        
        int64_t x_42731 = read_res_52180;
        
        m_f_res_41894 = x_42731;
    } else {
        m_f_res_41894 = (int64_t) 0;
    }
    
    int64_t m_41896;
    
    if (empty_slice_41839) {
        m_41896 = (int64_t) 0;
    } else {
        m_41896 = m_f_res_41894;
    }
    
    int64_t m_41906 = sub64(m_41896, (int64_t) 1);
    bool i_p_m_t_s_leq_w_41908 = slt64(m_41906, m_41830);
    bool zzero_leq_i_p_m_t_s_41907 = sle64((int64_t) 0, m_41906);
    bool y_41910 = zzero_leq_i_p_m_t_s_41907 && i_p_m_t_s_leq_w_41908;
    bool i_lte_j_41909 = sle64((int64_t) 0, m_41896);
    bool forwards_ok_41911 = i_lte_j_41909 && y_41910;
    bool eq_x_zz_41903 = (int64_t) 0 == m_f_res_41894;
    bool p_and_eq_x_y_41904 = x_41889 && eq_x_zz_41903;
    bool empty_slice_41905 = empty_slice_41839 || p_and_eq_x_y_41904;
    bool ok_or_empty_41912 = empty_slice_41905 || forwards_ok_41911;
    bool index_certs_41913;
    
    if (!ok_or_empty_41912) {
        set_error(ctx, msgprintf("Error: %s%lld%s%lld%s\n\nBacktrace:\n%s", "Index [:", (long long) m_41896, "] out of bounds for array of shape [", (long long) m_41830, "].", "-> #0  /prelude/soacs.fut:258:29-35\n   #1  /prelude/functional.fut:9:44-45\n   #2  ft_libs/ftDBSCAN_plus.fut:863:18-866:67\n   #3  ft_libs/ftDBSCAN_plus.fut:862:9-866:67\n"));
        err = FUTHARK_PROGRAM_ERROR;
        goto cleanup;
    }
    
    int64_t bytes_49930 = (int64_t) 8 * m_41896;
    int64_t zm_lhs_42036 = add64(n_34757, max_res_41927);
    int64_t zs_lhs_42037 = sub64(zm_lhs_42036, (int64_t) 1);
    int64_t numIter2_42038 = sdiv64(zs_lhs_42037, max_res_41927);
    bool bounds_invalid_upwards_42040 = slt64(numIter2_42038, (int64_t) 0);
    bool valid_42041 = !bounds_invalid_upwards_42040;
    bool range_valid_c_42042;
    
    if (!valid_42041) {
        set_error(ctx, msgprintf("Error: %s%lld%s%lld%s%lld%s\n\nBacktrace:\n%s", "Range ", (long long) (int64_t) 0, "..", (long long) (int64_t) 1, "..<", (long long) numIter2_42038, " is invalid.", "-> #0  /prelude/array.fut:94:3-11\n   #1  ft_libs/ftDBSCAN_plus.fut:621:75-88\n   #2  ft_libs/ftDBSCAN_plus.fut:863:18-866:67\n   #3  ft_libs/ftDBSCAN_plus.fut:862:9-866:67\n"));
        err = FUTHARK_PROGRAM_ERROR;
        goto cleanup;
    }
    
    int64_t conc_tmp_42127 = dz2084U_34759 + m_41896;
    int64_t bytes_50014 = (int64_t) 8 * conc_tmp_42127;
    
    if (memblock_alloc_device(ctx, &mem_49417, dz2080U_34760, "mem_49417")) {
        err = 1;
        goto cleanup;
    }
    if ((err = lmad_copy_gpu2gpu_1b(ctx, 1, mem_49417.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, clProc_mem_49380.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, (int64_t []) {dz2080U_34760})) != 0)
        goto cleanup;
    if (memblock_alloc_device(ctx, &mem_49419, bytes_49418, "mem_49419")) {
        err = 1;
        goto cleanup;
    }
    if ((err = lmad_copy_gpu2gpu_8b(ctx, 1, mem_49419.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, clProc_mem_49381.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, (int64_t []) {dz2081U_34761})) != 0)
        goto cleanup;
    
    int64_t tile_sizze_47886;
    
    tile_sizze_47886 = *ctx->tuning_params.do_DBSCAN_doublezitile_sizze_47885;
    
    int64_t tile_sizze_47627;
    
    tile_sizze_47627 = *ctx->tuning_params.do_DBSCAN_doublezitile_sizze_47626;
    
    int64_t segmap_tblock_sizze_45370;
    
    segmap_tblock_sizze_45370 = *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_45349;
    
    int64_t segmap_tblock_sizze_45590;
    
    segmap_tblock_sizze_45590 = *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_45575;
    
    int64_t segred_tblock_sizze_45608;
    
    segred_tblock_sizze_45608 = *ctx->tuning_params.do_DBSCAN_doublezisegred_tblock_sizze_45517;
    
    int64_t tile_sizze_48145;
    
    tile_sizze_48145 = *ctx->tuning_params.do_DBSCAN_doublezitile_sizze_48144;
    
    int64_t segmap_tblock_sizze_45666;
    
    segmap_tblock_sizze_45666 = *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_45665;
    
    int64_t segmap_tblock_sizze_45682;
    
    segmap_tblock_sizze_45682 = *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_45681;
    if (memblock_alloc_device(ctx, &mem_49424, bytes_49402, "mem_49424")) {
        err = 1;
        goto cleanup;
    }
    if (futrts_builtinzhreplicate_i64(ctx, mem_49424, n_34757, (int64_t) -1) != 0) {
        err = 1;
        goto cleanup;
    }
    
    int64_t segmap_tblock_sizze_45884;
    
    segmap_tblock_sizze_45884 = *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_45869;
    
    int64_t segred_tblock_sizze_45902;
    
    segred_tblock_sizze_45902 = *ctx->tuning_params.do_DBSCAN_doublezisegred_tblock_sizze_45811;
    
    int64_t tile_sizze_48554;
    
    tile_sizze_48554 = *ctx->tuning_params.do_DBSCAN_doublezitile_sizze_48553;
    if (memblock_alloc_device(ctx, &mem_49425, (int64_t) 0, "mem_49425")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_49426, (int64_t) 0, "mem_49426")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_49427, (int64_t) 0, "mem_49427")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_49494, bytes_49472, "mem_49494")) {
        err = 1;
        goto cleanup;
    }
    if (futrts_builtinzhreplicate_i64(ctx, mem_49494, partition_sizze_41393, (int64_t) -1) != 0) {
        err = 1;
        goto cleanup;
    }
    
    bool suff_outer_par_45226;
    
    suff_outer_par_45226 = *ctx->tuning_params.do_DBSCAN_doublezisuff_outer_par_3 <= conc_tmp_41556;
    if (ctx->logging)
        fprintf(ctx->log, "Compared %s <= %ld: %s.\n", "do_DBSCAN_double.suff_outer_par_3", (long) conc_tmp_41556, suff_outer_par_45226 ? "true" : "false");
    
    int64_t num_whole_tiles_47901 = squot_safe64(m_41830, tile_sizze_47886);
    int64_t residual_input_48060 = srem_safe64(m_41830, tile_sizze_47886);
    bool cond_48061 = residual_input_48060 == (int64_t) 0;
    int64_t binop_x_48074 = tile_sizze_47886 * num_whole_tiles_47901;
    int64_t bytes_49774 = (int64_t) 8 * tile_sizze_47886;
    int64_t num_whole_tiles_47642 = squot_safe64(m_41830, tile_sizze_47627);
    int64_t residual_input_47801 = srem_safe64(m_41830, tile_sizze_47627);
    bool cond_47802 = residual_input_47801 == (int64_t) 0;
    int64_t binop_x_47815 = tile_sizze_47627 * num_whole_tiles_47642;
    int64_t bytes_49814 = (int64_t) 8 * tile_sizze_47627;
    int64_t shared_memory_capacity_51782;
    
    shared_memory_capacity_51782 = ctx->max_shared_memory;
    if (suff_outer_par_45226 && sle64(sdiv_up64(bytes_49814, (int64_t) 8) * (int64_t) 8 + sdiv_up64(bytes_49814, (int64_t) 8) * (int64_t) 8, shared_memory_capacity_51782)) {
        int64_t ldim_47628 = sdiv_up64(conc_tmp_41556, tile_sizze_47627);
        
        if (memblock_alloc_device(ctx, &mem_49838, bytes_49502, "mem_49838")) {
            err = 1;
            goto cleanup;
        }
        if (ctx->debugging)
            fprintf(ctx->log, "%s\n", "\n# SegMap");
        
        int32_t num_chunks_51740 = sext_i64_i32(sdiv_up64(tile_sizze_47627, tile_sizze_47627));
        int32_t virt_num_tblocks_51741 = sext_i64_i32(ldim_47628);
        
        {
            err = gpu_kernel_do_DBSCAN_doublezisegmap_intrablock_47625(ctx, ldim_47628, 1, 1, *ctx->tuning_params.do_DBSCAN_doublezitile_sizze_47626, 1, 1, bytes_49814 + srem64((int64_t) 8 - srem64(bytes_49814, (int64_t) 8), (int64_t) 8) + (bytes_49814 + srem64((int64_t) 8 - srem64(bytes_49814, (int64_t) 8), (int64_t) 8)), conc_tmp_41556, m_41830, ldim_47628, num_whole_tiles_47642, residual_input_47801, cond_47802, binop_x_47815, mem_49613.mem, mem_49755.mem, mem_49757.mem, mem_49838.mem);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        if (ctx->debugging)
            fprintf(ctx->log, "%s\n", "");
        if (memblock_set_device(ctx, &ext_mem_49839, &mem_49838, "mem_49838") != 0)
            return 1;
    } else {
        int64_t ldim_47887 = sdiv_up64(conc_tmp_41556, tile_sizze_47886);
        
        if (memblock_alloc_device(ctx, &mem_49798, bytes_49502, "mem_49798")) {
            err = 1;
            goto cleanup;
        }
        if (ctx->debugging)
            fprintf(ctx->log, "%s\n", "\n# SegMap");
        
        int32_t num_chunks_51761 = sext_i64_i32(sdiv_up64(tile_sizze_47886, tile_sizze_47886));
        int32_t virt_num_tblocks_51762 = sext_i64_i32(ldim_47887);
        
        {
            err = gpu_kernel_do_DBSCAN_doublezisegmap_intrablock_47884(ctx, ldim_47887, 1, 1, *ctx->tuning_params.do_DBSCAN_doublezitile_sizze_47885, 1, 1, bytes_49774 + srem64((int64_t) 8 - srem64(bytes_49774, (int64_t) 8), (int64_t) 8) + (bytes_49774 + srem64((int64_t) 8 - srem64(bytes_49774, (int64_t) 8), (int64_t) 8)), conc_tmp_41556, m_41830, ldim_47887, num_whole_tiles_47901, residual_input_48060, cond_48061, binop_x_48074, mem_49613.mem, mem_49755.mem, mem_49757.mem, mem_49798.mem);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        if (ctx->debugging)
            fprintf(ctx->log, "%s\n", "");
        if (memblock_set_device(ctx, &ext_mem_49839, &mem_49798, "mem_49798") != 0)
            return 1;
    }
    if (memblock_unref_device(ctx, &mem_49613, "mem_49613") != 0)
        return 1;
    
    int64_t segmap_usable_groups_45371 = sdiv_up64(conc_tmp_41556, segmap_tblock_sizze_45370);
    
    if (memblock_alloc_device(ctx, &mem_49842, bytes_49502, "mem_49842")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_49844, bytes_49502, "mem_49844")) {
        err = 1;
        goto cleanup;
    }
    if (ctx->debugging)
        fprintf(ctx->log, "%s\n", "\n# SegMap");
    
    int32_t virt_num_tblocks_51783 = sext_i64_i32(sdiv_up64(conc_tmp_41556, segmap_tblock_sizze_45370));
    
    {
        err = gpu_kernel_do_DBSCAN_doublezisegmap_45376(ctx, segmap_usable_groups_45371, 1, 1, *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_45349, 1, 1, (int64_t) 0, m_41485, conc_tmp_41556, mem_49480.mem, mem_49482.mem, mem_49498.mem, mem_49500.mem, mem_49842.mem, mem_49844.mem);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (ctx->debugging)
        fprintf(ctx->log, "%s\n", "");
    if (memblock_unref_device(ctx, &mem_49480, "mem_49480") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_49482, "mem_49482") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_49498, "mem_49498") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_49500, "mem_49500") != 0)
        return 1;
    
    int64_t num_whole_tiles_48190 = squot_safe64(conc_tmp_41556, tile_sizze_48145);
    int64_t residual_input_48428 = srem_safe64(conc_tmp_41556, tile_sizze_48145);
    bool cond_48429 = residual_input_48428 == (int64_t) 0;
    int64_t binop_x_48445 = tile_sizze_48145 * num_whole_tiles_48190;
    int64_t bytes_49891 = (int64_t) 8 * tile_sizze_48145;
    
    for (int64_t i_41961 = 0; i_41961 < numIter1_41955; i_41961++) {
        int64_t inf_41963 = mul64(max_res_41927, i_41961);
        int64_t min_arg1_41964 = add64(max_res_41927, inf_41963);
        int64_t min_res_41965 = smin64(partition_sizze_41393, min_arg1_41964);
        int64_t dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_41966 = sub64(min_res_41965, inf_41963);
        bool empty_slice_41967 = dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_41966 == (int64_t) 0;
        int64_t m_41968 = sub64(dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_41966, (int64_t) 1);
        int64_t i_p_m_t_s_41969 = add64(inf_41963, m_41968);
        bool zzero_leq_i_p_m_t_s_41970 = sle64((int64_t) 0, i_p_m_t_s_41969);
        bool i_p_m_t_s_leq_w_41971 = slt64(i_p_m_t_s_41969, partition_sizze_41393);
        bool zzero_lte_i_41972 = sle64((int64_t) 0, inf_41963);
        bool i_lte_j_41973 = sle64(inf_41963, min_res_41965);
        bool y_41974 = i_p_m_t_s_leq_w_41971 && zzero_lte_i_41972;
        bool y_41975 = zzero_leq_i_p_m_t_s_41970 && y_41974;
        bool forwards_ok_41976 = i_lte_j_41973 && y_41975;
        bool ok_or_empty_41977 = empty_slice_41967 || forwards_ok_41976;
        bool index_certs_41978;
        
        if (!ok_or_empty_41977) {
            set_error(ctx, msgprintf("Error: %s%lld%s%lld%s%lld%s\n\nBacktrace:\n%s", "Index [", (long long) inf_41963, ":", (long long) min_res_41965, "] out of bounds for array of shape [", (long long) partition_sizze_41393, "].", "-> #0  ft_libs/ftDBSCAN_plus.fut:607:48-69\n   #1  ft_libs/ftDBSCAN_plus.fut:863:18-866:67\n   #2  ft_libs/ftDBSCAN_plus.fut:862:9-866:67\n"));
            err = FUTHARK_PROGRAM_ERROR;
            goto cleanup;
        }
        
        bool suff_outer_par_45393;
        
        suff_outer_par_45393 = *ctx->tuning_params.do_DBSCAN_doublezisuff_outer_par_4 <= dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_41966;
        if (ctx->logging)
            fprintf(ctx->log, "Compared %s <= %ld: %s.\n", "do_DBSCAN_double.suff_outer_par_4", (long) dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_41966, suff_outer_par_45393 ? "true" : "false");
        
        int64_t nest_sizze_45607 = conc_tmp_41556 * dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_41966;
        int64_t num_tblocks_45609;
        int64_t max_num_tblocks_51793;
        
        max_num_tblocks_51793 = *ctx->tuning_params.do_DBSCAN_doublezisegred_num_tblocks_45519;
        num_tblocks_45609 = sext_i64_i32(smax64((int64_t) 1, smin64(sdiv_up64(nest_sizze_45607, segred_tblock_sizze_45608), max_num_tblocks_51793)));
        
        int64_t bytes_49849 = (int64_t) 8 * dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_41966;
        int64_t shared_memory_capacity_51922;
        
        shared_memory_capacity_51922 = ctx->max_shared_memory;
        if (suff_outer_par_45393 && sle64(sdiv_up64(bytes_49891, (int64_t) 8) * (int64_t) 8 + sdiv_up64(bytes_49891, (int64_t) 8) * (int64_t) 8 + sdiv_up64(bytes_49891, (int64_t) 8) * (int64_t) 8, shared_memory_capacity_51922)) {
            int64_t ldim_48146 = sdiv_up64(dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_41966, tile_sizze_48145);
            
            if (ctx->debugging)
                fprintf(ctx->log, "%s\n", "\n# SegMap");
            
            int32_t num_chunks_51794 = sext_i64_i32(sdiv_up64(tile_sizze_48145, tile_sizze_48145));
            int32_t virt_num_tblocks_51795 = sext_i64_i32(ldim_48146);
            
            {
                err = gpu_kernel_do_DBSCAN_doublezisegmap_intrablock_48143(ctx, ldim_48146, 1, 1, *ctx->tuning_params.do_DBSCAN_doublezitile_sizze_48144, 1, 1, bytes_49891 + srem64((int64_t) 8 - srem64(bytes_49891, (int64_t) 8), (int64_t) 8) + (bytes_49891 + srem64((int64_t) 8 - srem64(bytes_49891, (int64_t) 8), (int64_t) 8)) + (bytes_49891 + srem64((int64_t) 8 - srem64(bytes_49891, (int64_t) 8), (int64_t) 8)), clBase_34768, clBase_34769, clBase_34770, clBase_34776, conc_tmp_41556, inf_41963, dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_41966, ldim_48146, num_whole_tiles_48190, residual_input_48428, cond_48429, binop_x_48445, mem_49454.mem, mem_49456.mem, mem_49494.mem, ext_mem_49839.mem, mem_49842.mem, mem_49844.mem);
                if (err != FUTHARK_SUCCESS)
                    goto cleanup;
            }
            if (ctx->debugging)
                fprintf(ctx->log, "%s\n", "");
        } else {
            int64_t segmap_usable_groups_45591 = sdiv_up64(dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_41966, segmap_tblock_sizze_45590);
            
            if (memblock_alloc_device(ctx, &mem_49850, bytes_49849, "mem_49850")) {
                err = 1;
                goto cleanup;
            }
            if (memblock_alloc_device(ctx, &mem_49852, bytes_49849, "mem_49852")) {
                err = 1;
                goto cleanup;
            }
            if (memblock_alloc_device(ctx, &mem_49854, bytes_49849, "mem_49854")) {
                err = 1;
                goto cleanup;
            }
            if (ctx->debugging)
                fprintf(ctx->log, "%s\n", "\n# SegMap");
            
            int32_t virt_num_tblocks_51815 = sext_i64_i32(sdiv_up64(dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_41966, segmap_tblock_sizze_45590));
            
            {
                err = gpu_kernel_do_DBSCAN_doublezisegmap_45596(ctx, segmap_usable_groups_45591, 1, 1, *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_45575, 1, 1, (int64_t) 0, clBase_34768, inf_41963, dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_41966, mem_49454.mem, mem_49456.mem, mem_49850.mem, mem_49852.mem, mem_49854.mem);
                if (err != FUTHARK_SUCCESS)
                    goto cleanup;
            }
            if (ctx->debugging)
                fprintf(ctx->log, "%s\n", "");
            if (memblock_alloc_device(ctx, &mem_49859, bytes_49849, "mem_49859")) {
                err = 1;
                goto cleanup;
            }
            if (ctx->debugging)
                fprintf(ctx->log, "%s\n", "\n# SegRed");
            
            int64_t chunk_sizze_51824 = (int64_t) 1;
            
            if (slt64(conc_tmp_41556 * (int64_t) 2, segred_tblock_sizze_45608 * chunk_sizze_51824)) {
                int64_t segment_sizze_nonzzero_51825 = smax64((int64_t) 1, conc_tmp_41556);
                int64_t num_threads_51826 = segred_tblock_sizze_45608 * segred_tblock_sizze_45608;
                
                if (ctx->debugging)
                    fprintf(ctx->log, "%s\n", "# SegRed-small");
                if (ctx->debugging)
                    fprintf(ctx->log, "%s: %llu%c", "num_segments", (long long) dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_41966, '\n');
                if (ctx->debugging)
                    fprintf(ctx->log, "%s: %llu%c", "segment_size", (long long) conc_tmp_41556, '\n');
                if (ctx->debugging)
                    fprintf(ctx->log, "%s: %llu%c", "segments_per_block", (long long) squot64(segred_tblock_sizze_45608, segment_sizze_nonzzero_51825), '\n');
                if (ctx->debugging)
                    fprintf(ctx->log, "%s: %llu%c", "required_blocks", (long long) sext_i64_i32(sdiv_up64(dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_41966, squot64(segred_tblock_sizze_45608, segment_sizze_nonzzero_51825))), '\n');
                {
                    err = gpu_kernel_do_DBSCAN_doublezisegred_small_45615(ctx, num_tblocks_45609, 1, 1, *ctx->tuning_params.do_DBSCAN_doublezisegred_tblock_sizze_45517, 1, 1, (int64_t) 8 * segred_tblock_sizze_45608 + srem64((int64_t) 8 - srem64((int64_t) 8 * segred_tblock_sizze_45608, (int64_t) 8), (int64_t) 8) + ((int64_t) 8 * segred_tblock_sizze_45608 + srem64((int64_t) 8 - srem64((int64_t) 8 * segred_tblock_sizze_45608, (int64_t) 8), (int64_t) 8)), clBase_34768, clBase_34769, clBase_34770, clBase_34776, conc_tmp_41556, inf_41963, dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_41966, num_tblocks_45609, x_49366, segment_sizze_nonzzero_51825, mem_49454.mem, mem_49456.mem, mem_49494.mem, ext_mem_49839.mem, mem_49842.mem, mem_49844.mem, mem_49850.mem, mem_49852.mem, mem_49854.mem, mem_49859.mem);
                    if (err != FUTHARK_SUCCESS)
                        goto cleanup;
                }
            } else {
                int64_t blocks_per_segment_51865 = sdiv_up64(num_tblocks_45609, smax64((int64_t) 1, dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_41966));
                int64_t q_51866 = sdiv_up64(conc_tmp_41556, segred_tblock_sizze_45608 * blocks_per_segment_51865 * chunk_sizze_51824);
                int64_t num_virtblocks_51867 = blocks_per_segment_51865 * dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_41966;
                int64_t threads_per_segment_51868 = blocks_per_segment_51865 * segred_tblock_sizze_45608;
                
                if (ctx->debugging)
                    fprintf(ctx->log, "%s\n", "# SegRed-large");
                if (ctx->debugging)
                    fprintf(ctx->log, "%s: %llu%c", "num_segments", (long long) dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_41966, '\n');
                if (ctx->debugging)
                    fprintf(ctx->log, "%s: %llu%c", "segment_size", (long long) conc_tmp_41556, '\n');
                if (ctx->debugging)
                    fprintf(ctx->log, "%s: %llu%c", "num_virtblocks", (long long) num_virtblocks_51867, '\n');
                if (ctx->debugging)
                    fprintf(ctx->log, "%s: %llu%c", "num_tblocks", (long long) num_tblocks_45609, '\n');
                if (ctx->debugging)
                    fprintf(ctx->log, "%s: %llu%c", "tblock_size", (long long) segred_tblock_sizze_45608, '\n');
                if (ctx->debugging)
                    fprintf(ctx->log, "%s: %llu%c", "q", (long long) q_51866, '\n');
                if (ctx->debugging)
                    fprintf(ctx->log, "%s: %llu%c", "blocks_per_segment", (long long) blocks_per_segment_51865, '\n');
                if (memblock_alloc_device(ctx, &segred_tmp_mem_51869, (int64_t) 8 * num_virtblocks_51867, "segred_tmp_mem_51869")) {
                    err = 1;
                    goto cleanup;
                }
                if (memblock_alloc_device(ctx, &segred_tmp_mem_51871, (int64_t) 8 * num_virtblocks_51867, "segred_tmp_mem_51871")) {
                    err = 1;
                    goto cleanup;
                }
                {
                    err = gpu_kernel_do_DBSCAN_doublezisegred_large_45615(ctx, num_tblocks_45609, 1, 1, *ctx->tuning_params.do_DBSCAN_doublezisegred_tblock_sizze_45517, 1, 1, 8 + ((int64_t) 8 * segred_tblock_sizze_45608 + srem64((int64_t) 8 - srem64((int64_t) 8 * segred_tblock_sizze_45608, (int64_t) 8), (int64_t) 8)) + ((int64_t) 8 * segred_tblock_sizze_45608 + srem64((int64_t) 8 - srem64((int64_t) 8 * segred_tblock_sizze_45608, (int64_t) 8), (int64_t) 8)), clBase_34768, clBase_34769, clBase_34770, clBase_34776, conc_tmp_41556, inf_41963, dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_41966, num_tblocks_45609, x_49366, blocks_per_segment_51865, q_51866, num_virtblocks_51867, threads_per_segment_51868, mem_49454.mem, mem_49456.mem, mem_49494.mem, ext_mem_49839.mem, mem_49842.mem, mem_49844.mem, mem_49850.mem, mem_49852.mem, mem_49854.mem, mem_49859.mem, segred_tmp_mem_51869.mem, segred_tmp_mem_51871.mem, counters_mem_51873.mem);
                    if (err != FUTHARK_SUCCESS)
                        goto cleanup;
                }
            }
            if (ctx->debugging)
                fprintf(ctx->log, "%s\n", "");
            if (memblock_unref_device(ctx, &mem_49850, "mem_49850") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_49852, "mem_49852") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_49854, "mem_49854") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_49859, "mem_49859") != 0)
                return 1;
        }
    }
    if (memblock_unref_device(ctx, &mem_49454, "mem_49454") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_49456, "mem_49456") != 0)
        return 1;
    
    int64_t num_tblocks_45668;
    int64_t max_num_tblocks_51923;
    
    max_num_tblocks_51923 = *ctx->tuning_params.do_DBSCAN_doublezisegmap_num_tblocks_45667;
    num_tblocks_45668 = sext_i64_i32(smax64((int64_t) 1, smin64(sdiv_up64(partition_sizze_41393, segmap_tblock_sizze_45666), max_num_tblocks_51923)));
    if (ctx->debugging)
        fprintf(ctx->log, "%s\n", "\n# SegMap");
    
    int32_t virt_num_tblocks_51924 = sext_i64_i32(sdiv_up64(partition_sizze_41393, segmap_tblock_sizze_45666));
    
    {
        err = gpu_kernel_do_DBSCAN_doublezisegmap_45663(ctx, num_tblocks_45668, 1, 1, *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_45665, 1, 1, (int64_t) 0, dz2080U_34760, dz2081U_34761, partition_sizze_41393, num_tblocks_45668, virt_num_tblocks_51924, mem_49417.mem, mem_49419.mem, mem_49460.mem, mem_49476.mem, mem_49494.mem);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (ctx->debugging)
        fprintf(ctx->log, "%s\n", "");
    if (memblock_unref_device(ctx, &mem_49460, "mem_49460") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_49476, "mem_49476") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_49494, "mem_49494") != 0)
        return 1;
    if (memblock_alloc_device(ctx, &mem_49931, bytes_49930, "mem_49931")) {
        err = 1;
        goto cleanup;
    }
    if ((err = lmad_copy_gpu2gpu_8b(ctx, 1, mem_49931.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, mem_49755.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, (int64_t []) {m_41896})) != 0)
        goto cleanup;
    if (memblock_alloc_device(ctx, &mem_49933, bytes_49930, "mem_49933")) {
        err = 1;
        goto cleanup;
    }
    if ((err = lmad_copy_gpu2gpu_8b(ctx, 1, mem_49933.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, mem_49757.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, (int64_t []) {m_41896})) != 0)
        goto cleanup;
    
    int64_t num_tblocks_45684;
    int64_t max_num_tblocks_51937;
    
    max_num_tblocks_51937 = *ctx->tuning_params.do_DBSCAN_doublezisegmap_num_tblocks_45683;
    num_tblocks_45684 = sext_i64_i32(smax64((int64_t) 1, smin64(sdiv_up64(m_41830, segmap_tblock_sizze_45682), max_num_tblocks_51937)));
    if (ctx->debugging)
        fprintf(ctx->log, "%s\n", "\n# SegMap");
    
    int32_t virt_num_tblocks_51938 = sext_i64_i32(sdiv_up64(m_41830, segmap_tblock_sizze_45682));
    
    {
        err = gpu_kernel_do_DBSCAN_doublezisegmap_45679(ctx, num_tblocks_45684, 1, 1, *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_45681, 1, 1, (int64_t) 0, m_41830, m_41896, num_tblocks_45684, virt_num_tblocks_51938, mem_49755.mem, mem_49757.mem, mem_49927.mem, mem_49929.mem, mem_49931.mem, mem_49933.mem);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (ctx->debugging)
        fprintf(ctx->log, "%s\n", "");
    if (memblock_unref_device(ctx, &mem_49755, "mem_49755") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_49757, "mem_49757") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_49927, "mem_49927") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_49929, "mem_49929") != 0)
        return 1;
    
    int64_t num_whole_tiles_48599 = squot_safe64(conc_tmp_41556, tile_sizze_48554);
    int64_t residual_input_48837 = srem_safe64(conc_tmp_41556, tile_sizze_48554);
    bool cond_48838 = residual_input_48837 == (int64_t) 0;
    int64_t binop_x_48854 = tile_sizze_48554 * num_whole_tiles_48599;
    int64_t bytes_49981 = (int64_t) 8 * tile_sizze_48554;
    
    for (int64_t i_42044 = 0; i_42044 < numIter2_42038; i_42044++) {
        int64_t inf_42046 = mul64(max_res_41927, i_42044);
        int64_t min_arg1_42047 = add64(max_res_41927, inf_42046);
        int64_t min_res_42048 = smin64(n_34757, min_arg1_42047);
        int64_t dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_42049 = sub64(min_res_42048, inf_42046);
        bool empty_slice_42050 = dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_42049 == (int64_t) 0;
        int64_t m_42051 = sub64(dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_42049, (int64_t) 1);
        int64_t i_p_m_t_s_42052 = add64(inf_42046, m_42051);
        bool zzero_leq_i_p_m_t_s_42053 = sle64((int64_t) 0, i_p_m_t_s_42052);
        bool i_p_m_t_s_leq_w_42054 = slt64(i_p_m_t_s_42052, n_34757);
        bool zzero_lte_i_42055 = sle64((int64_t) 0, inf_42046);
        bool i_lte_j_42056 = sle64(inf_42046, min_res_42048);
        bool y_42057 = i_p_m_t_s_leq_w_42054 && zzero_lte_i_42055;
        bool y_42058 = zzero_leq_i_p_m_t_s_42053 && y_42057;
        bool forwards_ok_42059 = i_lte_j_42056 && y_42058;
        bool ok_or_empty_42060 = empty_slice_42050 || forwards_ok_42059;
        bool index_certs_42061;
        
        if (!ok_or_empty_42060) {
            set_error(ctx, msgprintf("Error: %s%lld%s%lld%s%lld%s\n\nBacktrace:\n%s", "Index [", (long long) inf_42046, ":", (long long) min_res_42048, "] out of bounds for array of shape [", (long long) n_34757, "].", "-> #0  ft_libs/ftDBSCAN_plus.fut:624:48-70\n   #1  ft_libs/ftDBSCAN_plus.fut:863:18-866:67\n   #2  ft_libs/ftDBSCAN_plus.fut:862:9-866:67\n"));
            err = FUTHARK_PROGRAM_ERROR;
            goto cleanup;
        }
        
        bool suff_outer_par_45687;
        
        suff_outer_par_45687 = *ctx->tuning_params.do_DBSCAN_doublezisuff_outer_par_5 <= dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_42049;
        if (ctx->logging)
            fprintf(ctx->log, "Compared %s <= %ld: %s.\n", "do_DBSCAN_double.suff_outer_par_5", (long) dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_42049, suff_outer_par_45687 ? "true" : "false");
        
        int64_t nest_sizze_45901 = conc_tmp_41556 * dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_42049;
        int64_t num_tblocks_45903;
        int64_t max_num_tblocks_51952;
        
        max_num_tblocks_51952 = *ctx->tuning_params.do_DBSCAN_doublezisegred_num_tblocks_45813;
        num_tblocks_45903 = sext_i64_i32(smax64((int64_t) 1, smin64(sdiv_up64(nest_sizze_45901, segred_tblock_sizze_45902), max_num_tblocks_51952)));
        
        int64_t bytes_49939 = (int64_t) 8 * dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_42049;
        int64_t shared_memory_capacity_52081;
        
        shared_memory_capacity_52081 = ctx->max_shared_memory;
        if (suff_outer_par_45687 && sle64(sdiv_up64(bytes_49981, (int64_t) 8) * (int64_t) 8 + sdiv_up64(bytes_49981, (int64_t) 8) * (int64_t) 8 + sdiv_up64(bytes_49981, (int64_t) 8) * (int64_t) 8, shared_memory_capacity_52081)) {
            int64_t ldim_48555 = sdiv_up64(dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_42049, tile_sizze_48554);
            
            if (ctx->debugging)
                fprintf(ctx->log, "%s\n", "\n# SegMap");
            
            int32_t num_chunks_51953 = sext_i64_i32(sdiv_up64(tile_sizze_48554, tile_sizze_48554));
            int32_t virt_num_tblocks_51954 = sext_i64_i32(ldim_48555);
            
            {
                err = gpu_kernel_do_DBSCAN_doublezisegmap_intrablock_48552(ctx, ldim_48555, 1, 1, *ctx->tuning_params.do_DBSCAN_doublezitile_sizze_48553, 1, 1, bytes_49981 + srem64((int64_t) 8 - srem64(bytes_49981, (int64_t) 8), (int64_t) 8) + (bytes_49981 + srem64((int64_t) 8 - srem64(bytes_49981, (int64_t) 8), (int64_t) 8)) + (bytes_49981 + srem64((int64_t) 8 - srem64(bytes_49981, (int64_t) 8), (int64_t) 8)), clBase_34768, clBase_34769, clBase_34770, clBase_34776, conc_tmp_41556, inf_42046, dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_42049, ldim_48555, num_whole_tiles_48599, residual_input_48837, cond_48838, binop_x_48854, current_partition_mem_49387.mem, current_partition_mem_49388.mem, mem_49424.mem, ext_mem_49839.mem, mem_49842.mem, mem_49844.mem);
                if (err != FUTHARK_SUCCESS)
                    goto cleanup;
            }
            if (ctx->debugging)
                fprintf(ctx->log, "%s\n", "");
        } else {
            int64_t segmap_usable_groups_45885 = sdiv_up64(dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_42049, segmap_tblock_sizze_45884);
            
            if (memblock_alloc_device(ctx, &mem_49940, bytes_49939, "mem_49940")) {
                err = 1;
                goto cleanup;
            }
            if (memblock_alloc_device(ctx, &mem_49942, bytes_49939, "mem_49942")) {
                err = 1;
                goto cleanup;
            }
            if (memblock_alloc_device(ctx, &mem_49944, bytes_49939, "mem_49944")) {
                err = 1;
                goto cleanup;
            }
            if (ctx->debugging)
                fprintf(ctx->log, "%s\n", "\n# SegMap");
            
            int32_t virt_num_tblocks_51974 = sext_i64_i32(sdiv_up64(dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_42049, segmap_tblock_sizze_45884));
            
            {
                err = gpu_kernel_do_DBSCAN_doublezisegmap_45890(ctx, segmap_usable_groups_45885, 1, 1, *ctx->tuning_params.do_DBSCAN_doublezisegmap_tblock_sizze_45869, 1, 1, (int64_t) 0, clBase_34768, inf_42046, dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_42049, current_partition_mem_49387.mem, current_partition_mem_49388.mem, mem_49940.mem, mem_49942.mem, mem_49944.mem);
                if (err != FUTHARK_SUCCESS)
                    goto cleanup;
            }
            if (ctx->debugging)
                fprintf(ctx->log, "%s\n", "");
            if (memblock_alloc_device(ctx, &mem_49949, bytes_49939, "mem_49949")) {
                err = 1;
                goto cleanup;
            }
            if (ctx->debugging)
                fprintf(ctx->log, "%s\n", "\n# SegRed");
            
            int64_t chunk_sizze_51983 = (int64_t) 1;
            
            if (slt64(conc_tmp_41556 * (int64_t) 2, segred_tblock_sizze_45902 * chunk_sizze_51983)) {
                int64_t segment_sizze_nonzzero_51984 = smax64((int64_t) 1, conc_tmp_41556);
                int64_t num_threads_51985 = segred_tblock_sizze_45902 * segred_tblock_sizze_45902;
                
                if (ctx->debugging)
                    fprintf(ctx->log, "%s\n", "# SegRed-small");
                if (ctx->debugging)
                    fprintf(ctx->log, "%s: %llu%c", "num_segments", (long long) dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_42049, '\n');
                if (ctx->debugging)
                    fprintf(ctx->log, "%s: %llu%c", "segment_size", (long long) conc_tmp_41556, '\n');
                if (ctx->debugging)
                    fprintf(ctx->log, "%s: %llu%c", "segments_per_block", (long long) squot64(segred_tblock_sizze_45902, segment_sizze_nonzzero_51984), '\n');
                if (ctx->debugging)
                    fprintf(ctx->log, "%s: %llu%c", "required_blocks", (long long) sext_i64_i32(sdiv_up64(dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_42049, squot64(segred_tblock_sizze_45902, segment_sizze_nonzzero_51984))), '\n');
                {
                    err = gpu_kernel_do_DBSCAN_doublezisegred_small_45909(ctx, num_tblocks_45903, 1, 1, *ctx->tuning_params.do_DBSCAN_doublezisegred_tblock_sizze_45811, 1, 1, (int64_t) 8 * segred_tblock_sizze_45902 + srem64((int64_t) 8 - srem64((int64_t) 8 * segred_tblock_sizze_45902, (int64_t) 8), (int64_t) 8) + ((int64_t) 8 * segred_tblock_sizze_45902 + srem64((int64_t) 8 - srem64((int64_t) 8 * segred_tblock_sizze_45902, (int64_t) 8), (int64_t) 8)), clBase_34768, clBase_34769, clBase_34770, clBase_34776, conc_tmp_41556, inf_42046, dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_42049, num_tblocks_45903, x_49366, segment_sizze_nonzzero_51984, current_partition_mem_49387.mem, current_partition_mem_49388.mem, mem_49424.mem, ext_mem_49839.mem, mem_49842.mem, mem_49844.mem, mem_49940.mem, mem_49942.mem, mem_49944.mem, mem_49949.mem);
                    if (err != FUTHARK_SUCCESS)
                        goto cleanup;
                }
            } else {
                int64_t blocks_per_segment_52024 = sdiv_up64(num_tblocks_45903, smax64((int64_t) 1, dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_42049));
                int64_t q_52025 = sdiv_up64(conc_tmp_41556, segred_tblock_sizze_45902 * blocks_per_segment_52024 * chunk_sizze_51983);
                int64_t num_virtblocks_52026 = blocks_per_segment_52024 * dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_42049;
                int64_t threads_per_segment_52027 = blocks_per_segment_52024 * segred_tblock_sizze_45902;
                
                if (ctx->debugging)
                    fprintf(ctx->log, "%s\n", "# SegRed-large");
                if (ctx->debugging)
                    fprintf(ctx->log, "%s: %llu%c", "num_segments", (long long) dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_42049, '\n');
                if (ctx->debugging)
                    fprintf(ctx->log, "%s: %llu%c", "segment_size", (long long) conc_tmp_41556, '\n');
                if (ctx->debugging)
                    fprintf(ctx->log, "%s: %llu%c", "num_virtblocks", (long long) num_virtblocks_52026, '\n');
                if (ctx->debugging)
                    fprintf(ctx->log, "%s: %llu%c", "num_tblocks", (long long) num_tblocks_45903, '\n');
                if (ctx->debugging)
                    fprintf(ctx->log, "%s: %llu%c", "tblock_size", (long long) segred_tblock_sizze_45902, '\n');
                if (ctx->debugging)
                    fprintf(ctx->log, "%s: %llu%c", "q", (long long) q_52025, '\n');
                if (ctx->debugging)
                    fprintf(ctx->log, "%s: %llu%c", "blocks_per_segment", (long long) blocks_per_segment_52024, '\n');
                if (memblock_alloc_device(ctx, &segred_tmp_mem_52028, (int64_t) 8 * num_virtblocks_52026, "segred_tmp_mem_52028")) {
                    err = 1;
                    goto cleanup;
                }
                if (memblock_alloc_device(ctx, &segred_tmp_mem_52030, (int64_t) 8 * num_virtblocks_52026, "segred_tmp_mem_52030")) {
                    err = 1;
                    goto cleanup;
                }
                {
                    err = gpu_kernel_do_DBSCAN_doublezisegred_large_45909(ctx, num_tblocks_45903, 1, 1, *ctx->tuning_params.do_DBSCAN_doublezisegred_tblock_sizze_45811, 1, 1, 8 + ((int64_t) 8 * segred_tblock_sizze_45902 + srem64((int64_t) 8 - srem64((int64_t) 8 * segred_tblock_sizze_45902, (int64_t) 8), (int64_t) 8)) + ((int64_t) 8 * segred_tblock_sizze_45902 + srem64((int64_t) 8 - srem64((int64_t) 8 * segred_tblock_sizze_45902, (int64_t) 8), (int64_t) 8)), clBase_34768, clBase_34769, clBase_34770, clBase_34776, conc_tmp_41556, inf_42046, dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_42049, num_tblocks_45903, x_49366, blocks_per_segment_52024, q_52025, num_virtblocks_52026, threads_per_segment_52027, current_partition_mem_49387.mem, current_partition_mem_49388.mem, mem_49424.mem, ext_mem_49839.mem, mem_49842.mem, mem_49844.mem, mem_49940.mem, mem_49942.mem, mem_49944.mem, mem_49949.mem, segred_tmp_mem_52028.mem, segred_tmp_mem_52030.mem, counters_mem_52032.mem);
                    if (err != FUTHARK_SUCCESS)
                        goto cleanup;
                }
            }
            if (ctx->debugging)
                fprintf(ctx->log, "%s\n", "");
            if (memblock_unref_device(ctx, &mem_49940, "mem_49940") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_49942, "mem_49942") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_49944, "mem_49944") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_49949, "mem_49949") != 0)
                return 1;
        }
    }
    if (memblock_unref_device(ctx, &ext_mem_49839, "ext_mem_49839") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_49842, "mem_49842") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_49844, "mem_49844") != 0)
        return 1;
    if (memblock_alloc_device(ctx, &mem_50015, bytes_50014, "mem_50015")) {
        err = 1;
        goto cleanup;
    }
    
    int64_t tmp_offs_52082 = (int64_t) 0;
    
    if ((err = lmad_copy_gpu2gpu_8b(ctx, 1, mem_50015.mem, tmp_offs_52082, (int64_t []) {(int64_t) 1}, chain_collisions_mem_49374.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, (int64_t []) {dz2084U_34759})) != 0)
        goto cleanup;
    tmp_offs_52082 += dz2084U_34759;
    if ((err = lmad_copy_gpu2gpu_8b(ctx, 1, mem_50015.mem, tmp_offs_52082, (int64_t []) {(int64_t) 1}, mem_49933.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, (int64_t []) {m_41896})) != 0)
        goto cleanup;
    tmp_offs_52082 += m_41896;
    if (memblock_unref_device(ctx, &mem_49933, "mem_49933") != 0)
        return 1;
    if (memblock_alloc_device(ctx, &mem_50017, bytes_50014, "mem_50017")) {
        err = 1;
        goto cleanup;
    }
    
    int64_t tmp_offs_52083 = (int64_t) 0;
    
    if ((err = lmad_copy_gpu2gpu_8b(ctx, 1, mem_50017.mem, tmp_offs_52083, (int64_t []) {(int64_t) 1}, chain_collisions_mem_49375.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, (int64_t []) {dz2084U_34759})) != 0)
        goto cleanup;
    tmp_offs_52083 += dz2084U_34759;
    if ((err = lmad_copy_gpu2gpu_8b(ctx, 1, mem_50017.mem, tmp_offs_52083, (int64_t []) {(int64_t) 1}, mem_49931.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, (int64_t []) {m_41896})) != 0)
        goto cleanup;
    tmp_offs_52083 += m_41896;
    if (memblock_unref_device(ctx, &mem_49931, "mem_49931") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_50191, &mem_50015, "mem_50015") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_50192, &mem_50017, "mem_50017") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_50193, &clBase_mem_49376, "clBase_mem_49376") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_50194, &clBase_mem_49377, "clBase_mem_49377") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_50195, &clBase_mem_49378, "clBase_mem_49378") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_50196, &clBase_mem_49379, "clBase_mem_49379") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_50197, &mem_49417, "mem_49417") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_50198, &mem_49419, "mem_49419") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_50199, &clProc_mem_49382, "clProc_mem_49382") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_50200, &clProc_mem_49383, "clProc_mem_49383") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_50201, &clProc_mem_49384, "clProc_mem_49384") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_50202, &clProc_mem_49385, "clProc_mem_49385") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_50203, &mem_49424, "mem_49424") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_50204, &current_partition_mem_49387, "current_partition_mem_49387") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_50205, &current_partition_mem_49388, "current_partition_mem_49388") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_50206, &current_partition_mem_49389, "current_partition_mem_49389") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_50207, &current_partition_mem_49390, "current_partition_mem_49390") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_50208, &mem_49487, "mem_49487") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_50209, &current_partition_mem_49392, "current_partition_mem_49392") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_50210, &current_partition_mem_49393, "current_partition_mem_49393") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_50211, &current_partition_mem_49394, "current_partition_mem_49394") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_50212, &current_partition_mem_49395, "current_partition_mem_49395") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_50213, &current_partition_mem_49396, "current_partition_mem_49396") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_50214, &current_partition_mem_49397, "current_partition_mem_49397") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_50215, &mem_49425, "mem_49425") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_50216, &mem_49426, "mem_49426") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_50217, &mem_49427, "mem_49427") != 0)
        return 1;
    prim_out_50218 = conc_tmp_42127;
    prim_out_50219 = clBase_34768;
    prim_out_50220 = clBase_34769;
    prim_out_50221 = clBase_34770;
    prim_out_50222 = clBase_34771;
    prim_out_50223 = clBase_34773;
    prim_out_50224 = clBase_34776;
    prim_out_50225 = clBase_34778;
    prim_out_50226 = clProc_34783;
    prim_out_50227 = clProc_34784;
    prim_out_50228 = clProc_34785;
    prim_out_50229 = clProc_34787;
    prim_out_50230 = clProc_34788;
    prim_out_50231 = current_partition_34802;
    if (memblock_set_device(ctx, &*mem_out_p_52131, &mem_out_50191, "mem_out_50191") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_52132, &mem_out_50192, "mem_out_50192") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_52133, &mem_out_50193, "mem_out_50193") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_52134, &mem_out_50194, "mem_out_50194") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_52135, &mem_out_50195, "mem_out_50195") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_52136, &mem_out_50196, "mem_out_50196") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_52137, &mem_out_50197, "mem_out_50197") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_52138, &mem_out_50198, "mem_out_50198") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_52139, &mem_out_50199, "mem_out_50199") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_52140, &mem_out_50200, "mem_out_50200") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_52141, &mem_out_50201, "mem_out_50201") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_52142, &mem_out_50202, "mem_out_50202") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_52143, &mem_out_50203, "mem_out_50203") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_52144, &mem_out_50204, "mem_out_50204") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_52145, &mem_out_50205, "mem_out_50205") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_52146, &mem_out_50206, "mem_out_50206") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_52147, &mem_out_50207, "mem_out_50207") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_52148, &mem_out_50208, "mem_out_50208") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_52149, &mem_out_50209, "mem_out_50209") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_52150, &mem_out_50210, "mem_out_50210") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_52151, &mem_out_50211, "mem_out_50211") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_52152, &mem_out_50212, "mem_out_50212") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_52153, &mem_out_50213, "mem_out_50213") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_52154, &mem_out_50214, "mem_out_50214") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_52155, &mem_out_50215, "mem_out_50215") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_52156, &mem_out_50216, "mem_out_50216") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_52157, &mem_out_50217, "mem_out_50217") != 0)
        return 1;
    *out_prim_out_52158 = prim_out_50218;
    *out_prim_out_52159 = prim_out_50219;
    *out_prim_out_52160 = prim_out_50220;
    *out_prim_out_52161 = prim_out_50221;
    *out_prim_out_52162 = prim_out_50222;
    *out_prim_out_52163 = prim_out_50223;
    *out_prim_out_52164 = prim_out_50224;
    *out_prim_out_52165 = prim_out_50225;
    *out_prim_out_52166 = prim_out_50226;
    *out_prim_out_52167 = prim_out_50227;
    *out_prim_out_52168 = prim_out_50228;
    *out_prim_out_52169 = prim_out_50229;
    *out_prim_out_52170 = prim_out_50230;
    *out_prim_out_52171 = prim_out_50231;
    
  cleanup:
    {
        if (memblock_unref_device(ctx, &mem_50017, "mem_50017") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_50015, "mem_50015") != 0)
            return 1;
        if (memblock_unref_device(ctx, &segred_tmp_mem_52030, "segred_tmp_mem_52030") != 0)
            return 1;
        if (memblock_unref_device(ctx, &segred_tmp_mem_52028, "segred_tmp_mem_52028") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49949, "mem_49949") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49944, "mem_49944") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49942, "mem_49942") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49940, "mem_49940") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49933, "mem_49933") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49931, "mem_49931") != 0)
            return 1;
        if (memblock_unref_device(ctx, &segred_tmp_mem_51871, "segred_tmp_mem_51871") != 0)
            return 1;
        if (memblock_unref_device(ctx, &segred_tmp_mem_51869, "segred_tmp_mem_51869") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49859, "mem_49859") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49854, "mem_49854") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49852, "mem_49852") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49850, "mem_49850") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49844, "mem_49844") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49842, "mem_49842") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49798, "mem_49798") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49838, "mem_49838") != 0)
            return 1;
        if (memblock_unref_device(ctx, &ext_mem_49839, "ext_mem_49839") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49494, "mem_49494") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49427, "mem_49427") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49426, "mem_49426") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49425, "mem_49425") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49424, "mem_49424") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49419, "mem_49419") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49417, "mem_49417") != 0)
            return 1;
        if (memblock_unref_device(ctx, &incprefixes_mem_51649, "incprefixes_mem_51649") != 0)
            return 1;
        if (memblock_unref_device(ctx, &aggregates_mem_51647, "aggregates_mem_51647") != 0)
            return 1;
        if (memblock_unref_device(ctx, &status_flags_mem_51645, "status_flags_mem_51645") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49929, "mem_49929") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49927, "mem_49927") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49757, "mem_49757") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49755, "mem_49755") != 0)
            return 1;
        if (memblock_unref_device(ctx, &incprefixes_mem_51532, "incprefixes_mem_51532") != 0)
            return 1;
        if (memblock_unref_device(ctx, &aggregates_mem_51530, "aggregates_mem_51530") != 0)
            return 1;
        if (memblock_unref_device(ctx, &status_flags_mem_51528, "status_flags_mem_51528") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49746, "mem_49746") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49743, "mem_49743") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49678, "mem_49678") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49740, "mem_49740") != 0)
            return 1;
        if (memblock_unref_device(ctx, &ext_mem_49741, "ext_mem_49741") != 0)
            return 1;
        if (memblock_unref_device(ctx, &ext_mem_49752, "ext_mem_49752") != 0)
            return 1;
        if (memblock_unref_device(ctx, &ext_mem_49753, "ext_mem_49753") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49615, "mem_49615") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49613, "mem_49613") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_param_tmp_51329, "mem_param_tmp_51329") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49607, "mem_49607") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_param_49604, "mem_param_49604") != 0)
            return 1;
        if (memblock_unref_device(ctx, &ext_mem_49610, "ext_mem_49610") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49601, "mem_49601") != 0)
            return 1;
        if (memblock_unref_device(ctx, &incprefixes_mem_51229, "incprefixes_mem_51229") != 0)
            return 1;
        if (memblock_unref_device(ctx, &aggregates_mem_51227, "aggregates_mem_51227") != 0)
            return 1;
        if (memblock_unref_device(ctx, &status_flags_mem_51225, "status_flags_mem_51225") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49598, "mem_49598") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_param_tmp_51078, "mem_param_tmp_51078") != 0)
            return 1;
        if (memblock_unref_device(ctx, &segred_tmp_mem_51186, "segred_tmp_mem_51186") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_param_tmp_51081, "mem_param_tmp_51081") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49587, "mem_49587") != 0)
            return 1;
        if (memblock_unref_device(ctx, &segred_tmp_mem_51143, "segred_tmp_mem_51143") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49530, "mem_49530") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49527, "mem_49527") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49525, "mem_49525") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49523, "mem_49523") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49584, "mem_49584") != 0)
            return 1;
        if (memblock_unref_device(ctx, &ext_mem_49585, "ext_mem_49585") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_param_49520, "mem_param_49520") != 0)
            return 1;
        if (memblock_unref_device(ctx, &ext_mem_49590, "ext_mem_49590") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_param_49517, "mem_param_49517") != 0)
            return 1;
        if (memblock_unref_device(ctx, &ext_mem_49595, "ext_mem_49595") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49592, "mem_49592") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49514, "mem_49514") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49512, "mem_49512") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49510, "mem_49510") != 0)
            return 1;
        if (memblock_unref_device(ctx, &incprefixes_mem_50986, "incprefixes_mem_50986") != 0)
            return 1;
        if (memblock_unref_device(ctx, &aggregates_mem_50984, "aggregates_mem_50984") != 0)
            return 1;
        if (memblock_unref_device(ctx, &status_flags_mem_50982, "status_flags_mem_50982") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49508, "mem_49508") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49506, "mem_49506") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49503, "mem_49503") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49500, "mem_49500") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49498, "mem_49498") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49496, "mem_49496") != 0)
            return 1;
        if (memblock_unref_device(ctx, &incprefixes_mem_50869, "incprefixes_mem_50869") != 0)
            return 1;
        if (memblock_unref_device(ctx, &aggregates_mem_50867, "aggregates_mem_50867") != 0)
            return 1;
        if (memblock_unref_device(ctx, &status_flags_mem_50865, "status_flags_mem_50865") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49492, "mem_49492") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49490, "mem_49490") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49487, "mem_49487") != 0)
            return 1;
        if (memblock_unref_device(ctx, &ext_mem_49484, "ext_mem_49484") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49482, "mem_49482") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49480, "mem_49480") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49478, "mem_49478") != 0)
            return 1;
        if (memblock_unref_device(ctx, &incprefixes_mem_50731, "incprefixes_mem_50731") != 0)
            return 1;
        if (memblock_unref_device(ctx, &aggregates_mem_50729, "aggregates_mem_50729") != 0)
            return 1;
        if (memblock_unref_device(ctx, &status_flags_mem_50727, "status_flags_mem_50727") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49476, "mem_49476") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49475, "mem_49475") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49473, "mem_49473") != 0)
            return 1;
        if (memblock_unref_device(ctx, &ext_mem_49470, "ext_mem_49470") != 0)
            return 1;
        if (memblock_unref_device(ctx, &ext_mem_49469, "ext_mem_49469") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49467, "mem_49467") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49464, "mem_49464") != 0)
            return 1;
        if (memblock_unref_device(ctx, &ext_mem_49462, "ext_mem_49462") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49460, "mem_49460") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49458, "mem_49458") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49456, "mem_49456") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49454, "mem_49454") != 0)
            return 1;
        if (memblock_unref_device(ctx, &incprefixes_mem_50568, "incprefixes_mem_50568") != 0)
            return 1;
        if (memblock_unref_device(ctx, &aggregates_mem_50566, "aggregates_mem_50566") != 0)
            return 1;
        if (memblock_unref_device(ctx, &incprefixes_mem_50564, "incprefixes_mem_50564") != 0)
            return 1;
        if (memblock_unref_device(ctx, &aggregates_mem_50562, "aggregates_mem_50562") != 0)
            return 1;
        if (memblock_unref_device(ctx, &status_flags_mem_50560, "status_flags_mem_50560") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49452, "mem_49452") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49450, "mem_49450") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49448, "mem_49448") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49444, "mem_49444") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49442, "mem_49442") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49440, "mem_49440") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49438, "mem_49438") != 0)
            return 1;
        if (memblock_unref_device(ctx, &incprefixes_mem_50448, "incprefixes_mem_50448") != 0)
            return 1;
        if (memblock_unref_device(ctx, &aggregates_mem_50446, "aggregates_mem_50446") != 0)
            return 1;
        if (memblock_unref_device(ctx, &status_flags_mem_50444, "status_flags_mem_50444") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49436, "mem_49436") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49434, "mem_49434") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49432, "mem_49432") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49429, "mem_49429") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49428, "mem_49428") != 0)
            return 1;
        if (memblock_unref_device(ctx, &ext_mem_49422, "ext_mem_49422") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49421, "mem_49421") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49415, "mem_49415") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49413, "mem_49413") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49411, "mem_49411") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49409, "mem_49409") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49407, "mem_49407") != 0)
            return 1;
        if (memblock_unref_device(ctx, &incprefixes_mem_50264, "incprefixes_mem_50264") != 0)
            return 1;
        if (memblock_unref_device(ctx, &aggregates_mem_50262, "aggregates_mem_50262") != 0)
            return 1;
        if (memblock_unref_device(ctx, &status_flags_mem_50240, "status_flags_mem_50240") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49405, "mem_49405") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49403, "mem_49403") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_50217, "mem_out_50217") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_50216, "mem_out_50216") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_50215, "mem_out_50215") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_50214, "mem_out_50214") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_50213, "mem_out_50213") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_50212, "mem_out_50212") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_50211, "mem_out_50211") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_50210, "mem_out_50210") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_50209, "mem_out_50209") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_50208, "mem_out_50208") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_50207, "mem_out_50207") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_50206, "mem_out_50206") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_50205, "mem_out_50205") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_50204, "mem_out_50204") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_50203, "mem_out_50203") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_50202, "mem_out_50202") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_50201, "mem_out_50201") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_50200, "mem_out_50200") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_50199, "mem_out_50199") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_50198, "mem_out_50198") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_50197, "mem_out_50197") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_50196, "mem_out_50196") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_50195, "mem_out_50195") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_50194, "mem_out_50194") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_50193, "mem_out_50193") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_50192, "mem_out_50192") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_50191, "mem_out_50191") != 0)
            return 1;
    }
    return err;
}
FUTHARK_FUN_ATTR int futrts_entry_flush_dat_double(struct futhark_context *ctx, struct memblock_device *mem_out_p_52181, struct memblock_device *mem_out_p_52182, struct memblock_device *mem_out_p_52183, struct memblock_device chain_collisions_mem_49374, struct memblock_device chain_collisions_mem_49375, struct memblock_device clBase_mem_49376, struct memblock_device clBase_mem_49377, struct memblock_device clBase_mem_49378, struct memblock_device clBase_mem_49379, struct memblock_device clProc_mem_49380, struct memblock_device clProc_mem_49381, struct memblock_device clProc_mem_49382, struct memblock_device clProc_mem_49383, struct memblock_device clProc_mem_49384, struct memblock_device clProc_mem_49385, struct memblock_device current_partition_mem_49386, struct memblock_device current_partition_mem_49387, struct memblock_device current_partition_mem_49388, struct memblock_device current_partition_mem_49389, struct memblock_device current_partition_mem_49390, struct memblock_device current_partition_mem_49391, struct memblock_device current_partition_mem_49392, struct memblock_device current_partition_mem_49393, struct memblock_device current_partition_mem_49394, struct memblock_device current_partition_mem_49395, struct memblock_device current_partition_mem_49396, struct memblock_device current_partition_mem_49397, struct memblock_device toFlush_dat_mem_49398, struct memblock_device toFlush_dat_mem_49399, struct memblock_device toFlush_ids_mem_49400, int64_t n_27268, int64_t part_no_27269, int64_t dz2084U_27270, int64_t dz2080U_27271, int64_t dz2081U_27272, int64_t dz2082U_27273, int64_t dz2083U_27274, int64_t dz2085U_27275, int64_t dz2086U_27276, int8_t clBase_27279, int8_t clBase_27280, double clBase_27281, int64_t clBase_27282, int64_t clBase_27284, double clBase_27287, int64_t clBase_27289, int64_t clProc_27294, int64_t clProc_27295, int64_t clProc_27296, int64_t clProc_27298, int64_t clProc_27299, int64_t current_partition_27313)
{
    (void) ctx;
    
    int err = 0;
    struct memblock_device mem_49404;
    
    mem_49404.references = NULL;
    
    struct memblock_device mem_49402;
    
    mem_49402.references = NULL;
    
    struct memblock_device mem_out_50193;
    
    mem_out_50193.references = NULL;
    
    struct memblock_device mem_out_50192;
    
    mem_out_50192.references = NULL;
    
    struct memblock_device mem_out_50191;
    
    mem_out_50191.references = NULL;
    
    struct memblock_device counters_mem_50201 = ctx->constants->counters_mem_50201;
    struct memblock_device counters_mem_50275 = ctx->constants->counters_mem_50275;
    struct memblock_device counters_mem_50707 = ctx->constants->counters_mem_50707;
    struct memblock_device counters_mem_51122 = ctx->constants->counters_mem_51122;
    struct memblock_device counters_mem_51145 = ctx->constants->counters_mem_51145;
    struct memblock_device counters_mem_51184 = ctx->constants->counters_mem_51184;
    struct memblock_device counters_mem_51873 = ctx->constants->counters_mem_51873;
    struct memblock_device counters_mem_52032 = ctx->constants->counters_mem_52032;
    struct memblock_device global_dynid_mem_50266 = ctx->constants->global_dynid_mem_50266;
    struct memblock_device global_dynid_mem_50275 = ctx->constants->global_dynid_mem_50275;
    struct memblock_device global_dynid_mem_50287 = ctx->constants->global_dynid_mem_50287;
    struct memblock_device global_dynid_mem_50292 = ctx->constants->global_dynid_mem_50292;
    struct memblock_device global_dynid_mem_50450 = ctx->constants->global_dynid_mem_50450;
    struct memblock_device global_dynid_mem_50529 = ctx->constants->global_dynid_mem_50529;
    struct memblock_device global_dynid_mem_50570 = ctx->constants->global_dynid_mem_50570;
    struct memblock_device global_dynid_mem_50733 = ctx->constants->global_dynid_mem_50733;
    struct memblock_device global_dynid_mem_50769 = ctx->constants->global_dynid_mem_50769;
    struct memblock_device global_dynid_mem_50871 = ctx->constants->global_dynid_mem_50871;
    struct memblock_device global_dynid_mem_50875 = ctx->constants->global_dynid_mem_50875;
    struct memblock_device global_dynid_mem_50988 = ctx->constants->global_dynid_mem_50988;
    struct memblock_device global_dynid_mem_51231 = ctx->constants->global_dynid_mem_51231;
    struct memblock_device global_dynid_mem_51378 = ctx->constants->global_dynid_mem_51378;
    struct memblock_device global_dynid_mem_51534 = ctx->constants->global_dynid_mem_51534;
    struct memblock_device global_dynid_mem_51651 = ctx->constants->global_dynid_mem_51651;
    int64_t bytes_49401 = (int64_t) 8 * dz2085U_27275;
    
    if (memblock_alloc_device(ctx, &mem_49402, bytes_49401, "mem_49402")) {
        err = 1;
        goto cleanup;
    }
    if ((err = lmad_copy_gpu2gpu_8b(ctx, 1, mem_49402.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, toFlush_dat_mem_49398.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, (int64_t []) {dz2085U_27275})) != 0)
        goto cleanup;
    if (memblock_alloc_device(ctx, &mem_49404, bytes_49401, "mem_49404")) {
        err = 1;
        goto cleanup;
    }
    if ((err = lmad_copy_gpu2gpu_8b(ctx, 1, mem_49404.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, toFlush_dat_mem_49399.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, (int64_t []) {dz2085U_27275})) != 0)
        goto cleanup;
    if (memblock_set_device(ctx, &mem_out_50191, &toFlush_ids_mem_49400, "toFlush_ids_mem_49400") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_50192, &mem_49402, "mem_49402") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_50193, &mem_49404, "mem_49404") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_52181, &mem_out_50191, "mem_out_50191") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_52182, &mem_out_50192, "mem_out_50192") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_52183, &mem_out_50193, "mem_out_50193") != 0)
        return 1;
    
  cleanup:
    {
        if (memblock_unref_device(ctx, &mem_49404, "mem_49404") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49402, "mem_49402") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_50193, "mem_out_50193") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_50192, "mem_out_50192") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_50191, "mem_out_50191") != 0)
            return 1;
    }
    return err;
}
FUTHARK_FUN_ATTR int futrts_entry_make_collisions_compact_double(struct futhark_context *ctx, struct memblock_device *mem_out_p_52184, struct memblock_device *mem_out_p_52185, int64_t *out_prim_out_52186, struct memblock_device chain_collisions_mem_49374, struct memblock_device chain_collisions_mem_49375, struct memblock_device clBase_mem_49376, struct memblock_device clBase_mem_49377, struct memblock_device clBase_mem_49378, struct memblock_device clBase_mem_49379, struct memblock_device clProc_mem_49380, struct memblock_device clProc_mem_49381, struct memblock_device clProc_mem_49382, struct memblock_device clProc_mem_49383, struct memblock_device clProc_mem_49384, struct memblock_device clProc_mem_49385, struct memblock_device current_partition_mem_49386, struct memblock_device current_partition_mem_49387, struct memblock_device current_partition_mem_49388, struct memblock_device current_partition_mem_49389, struct memblock_device current_partition_mem_49390, struct memblock_device current_partition_mem_49391, struct memblock_device current_partition_mem_49392, struct memblock_device current_partition_mem_49393, struct memblock_device current_partition_mem_49394, struct memblock_device current_partition_mem_49395, struct memblock_device current_partition_mem_49396, struct memblock_device current_partition_mem_49397, struct memblock_device toFlush_dat_mem_49398, struct memblock_device toFlush_dat_mem_49399, struct memblock_device toFlush_ids_mem_49400, int64_t n_35568, int64_t part_no_35569, int64_t dz2084U_35570, int64_t dz2080U_35571, int64_t dz2081U_35572, int64_t dz2082U_35573, int64_t dz2083U_35574, int64_t dz2085U_35575, int64_t dz2086U_35576, int8_t clBase_35579, int8_t clBase_35580, double clBase_35581, int64_t clBase_35582, int64_t clBase_35584, double clBase_35587, int64_t clBase_35589, int64_t clProc_35594, int64_t clProc_35595, int64_t clProc_35596, int64_t clProc_35598, int64_t clProc_35599, int64_t current_partition_35613)
{
    (void) ctx;
    
    int err = 0;
    struct memblock_device mem_49509;
    
    mem_49509.references = NULL;
    
    struct memblock_device mem_49507;
    
    mem_49507.references = NULL;
    
    struct memblock_device incprefixes_mem_50290;
    
    incprefixes_mem_50290.references = NULL;
    
    struct memblock_device aggregates_mem_50288;
    
    aggregates_mem_50288.references = NULL;
    
    struct memblock_device status_flags_mem_50266;
    
    status_flags_mem_50266.references = NULL;
    
    struct memblock_device mem_49505;
    
    mem_49505.references = NULL;
    
    struct memblock_device mem_49503;
    
    mem_49503.references = NULL;
    
    struct memblock_device mem_49401;
    
    mem_49401.references = NULL;
    
    struct memblock_device mem_out_50192;
    
    mem_out_50192.references = NULL;
    
    struct memblock_device mem_out_50191;
    
    mem_out_50191.references = NULL;
    
    struct memblock_device counters_mem_50201 = ctx->constants->counters_mem_50201;
    struct memblock_device counters_mem_50275 = ctx->constants->counters_mem_50275;
    struct memblock_device counters_mem_50707 = ctx->constants->counters_mem_50707;
    struct memblock_device counters_mem_51122 = ctx->constants->counters_mem_51122;
    struct memblock_device counters_mem_51145 = ctx->constants->counters_mem_51145;
    struct memblock_device counters_mem_51184 = ctx->constants->counters_mem_51184;
    struct memblock_device counters_mem_51873 = ctx->constants->counters_mem_51873;
    struct memblock_device counters_mem_52032 = ctx->constants->counters_mem_52032;
    struct memblock_device global_dynid_mem_50266 = ctx->constants->global_dynid_mem_50266;
    struct memblock_device global_dynid_mem_50275 = ctx->constants->global_dynid_mem_50275;
    struct memblock_device global_dynid_mem_50287 = ctx->constants->global_dynid_mem_50287;
    struct memblock_device global_dynid_mem_50292 = ctx->constants->global_dynid_mem_50292;
    struct memblock_device global_dynid_mem_50450 = ctx->constants->global_dynid_mem_50450;
    struct memblock_device global_dynid_mem_50529 = ctx->constants->global_dynid_mem_50529;
    struct memblock_device global_dynid_mem_50570 = ctx->constants->global_dynid_mem_50570;
    struct memblock_device global_dynid_mem_50733 = ctx->constants->global_dynid_mem_50733;
    struct memblock_device global_dynid_mem_50769 = ctx->constants->global_dynid_mem_50769;
    struct memblock_device global_dynid_mem_50871 = ctx->constants->global_dynid_mem_50871;
    struct memblock_device global_dynid_mem_50875 = ctx->constants->global_dynid_mem_50875;
    struct memblock_device global_dynid_mem_50988 = ctx->constants->global_dynid_mem_50988;
    struct memblock_device global_dynid_mem_51231 = ctx->constants->global_dynid_mem_51231;
    struct memblock_device global_dynid_mem_51378 = ctx->constants->global_dynid_mem_51378;
    struct memblock_device global_dynid_mem_51534 = ctx->constants->global_dynid_mem_51534;
    struct memblock_device global_dynid_mem_51651 = ctx->constants->global_dynid_mem_51651;
    int64_t prim_out_50193;
    bool zzero_37732 = dz2084U_35570 == (int64_t) 0;
    bool nonzzero_37733 = !zzero_37732;
    bool nonzzero_cert_37734;
    
    if (!nonzzero_37733) {
        set_error(ctx, msgprintf("Error: %s\n\nBacktrace:\n%s", "division by zero", "-> #0  ft_libs/ftDBSCAN_plus.fut:769:56-60\n   #1  ft_libs/ftDBSCAN_plus.fut:869:18-871:58\n   #2  ft_libs/ftDBSCAN_plus.fut:868:9-871:68\n"));
        err = FUTHARK_PROGRAM_ERROR;
        goto cleanup;
    }
    
    int64_t max_arg1_37735 = sdiv64(clBase_35582, dz2084U_35570);
    int64_t max_res_37736 = smax64((int64_t) 1, max_arg1_37735);
    int64_t zm_lhs_37737 = add64(dz2084U_35570, max_res_37736);
    int64_t zs_lhs_37738 = sub64(zm_lhs_37737, (int64_t) 1);
    bool zzero_37739 = max_res_37736 == (int64_t) 0;
    bool nonzzero_37740 = !zzero_37739;
    bool nonzzero_cert_37741;
    
    if (!nonzzero_37740) {
        set_error(ctx, msgprintf("Error: %s\n\nBacktrace:\n%s", "division by zero", "-> #0  ft_libs/ftDBSCAN_plus.fut:770:58-66\n   #1  ft_libs/ftDBSCAN_plus.fut:869:18-871:58\n   #2  ft_libs/ftDBSCAN_plus.fut:868:9-871:68\n"));
        err = FUTHARK_PROGRAM_ERROR;
        goto cleanup;
    }
    
    int64_t num_iter_37742 = sdiv64(zs_lhs_37738, max_res_37736);
    
    if (memblock_alloc_device(ctx, &mem_49401, dz2084U_35570, "mem_49401")) {
        err = 1;
        goto cleanup;
    }
    if (futrts_builtinzhreplicate_bool(ctx, mem_49401, dz2084U_35570, 1) != 0) {
        err = 1;
        goto cleanup;
    }
    
    bool bounds_invalid_upwards_37744 = slt64(num_iter_37742, (int64_t) 0);
    bool valid_37745 = !bounds_invalid_upwards_37744;
    bool range_valid_c_37746;
    
    if (!valid_37745) {
        set_error(ctx, msgprintf("Error: %s%lld%s%lld%s%lld%s\n\nBacktrace:\n%s", "Range ", (long long) (int64_t) 0, "..", (long long) (int64_t) 1, "..<", (long long) num_iter_37742, " is invalid.", "-> #0  /prelude/array.fut:94:3-11\n   #1  ft_libs/ftDBSCAN_plus.fut:772:81-94\n   #2  ft_libs/ftDBSCAN_plus.fut:869:18-871:58\n   #3  ft_libs/ftDBSCAN_plus.fut:868:9-871:68\n"));
        err = FUTHARK_PROGRAM_ERROR;
        goto cleanup;
    }
    
    int64_t tile_sizze_46806;
    
    tile_sizze_46806 = *ctx->tuning_params.make_collisions_compact_doublezitile_sizze_46805;
    
    int64_t tile_sizze_46537;
    
    tile_sizze_46537 = *ctx->tuning_params.make_collisions_compact_doublezitile_sizze_46536;
    
    int64_t num_whole_tiles_46832 = squot_safe64(dz2084U_35570, tile_sizze_46806);
    int64_t residual_input_46984 = srem_safe64(dz2084U_35570, tile_sizze_46806);
    bool cond_46985 = residual_input_46984 == (int64_t) 0;
    int64_t binop_x_46998 = tile_sizze_46806 * num_whole_tiles_46832;
    int64_t bytes_49424 = (int64_t) 8 * tile_sizze_46806;
    int64_t num_whole_tiles_46563 = squot_safe64(dz2084U_35570, tile_sizze_46537);
    int64_t residual_input_46715 = srem_safe64(dz2084U_35570, tile_sizze_46537);
    bool cond_46716 = residual_input_46715 == (int64_t) 0;
    int64_t binop_x_46729 = tile_sizze_46537 * num_whole_tiles_46563;
    int64_t bytes_49470 = (int64_t) 8 * tile_sizze_46537;
    
    for (int64_t i_37748 = 0; i_37748 < num_iter_37742; i_37748++) {
        int64_t inf_37750 = mul64(max_res_37736, i_37748);
        int64_t min_arg0_37751 = add64(max_res_37736, inf_37750);
        int64_t min_res_37752 = smin64(dz2084U_35570, min_arg0_37751);
        int64_t dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_37753 = sub64(min_res_37752, inf_37750);
        bool bounds_invalid_upwards_37754 = slt64(min_res_37752, inf_37750);
        bool valid_37755 = !bounds_invalid_upwards_37754;
        bool range_valid_c_37756;
        
        if (!valid_37755) {
            set_error(ctx, msgprintf("Error: %s%lld%s%lld%s\n\nBacktrace:\n%s", "Range ", (long long) inf_37750, "..<", (long long) min_res_37752, " is invalid.", "-> #0  ft_libs/ftDBSCAN_plus.fut:775:55-64\n   #1  ft_libs/ftDBSCAN_plus.fut:869:18-871:58\n   #2  ft_libs/ftDBSCAN_plus.fut:868:9-871:68\n"));
            err = FUTHARK_PROGRAM_ERROR;
            goto cleanup;
        }
        
        bool empty_slice_37784 = dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_37753 == (int64_t) 0;
        int64_t m_37785 = sub64(dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_37753, (int64_t) 1);
        int64_t i_p_m_t_s_37786 = add64(inf_37750, m_37785);
        bool zzero_leq_i_p_m_t_s_37787 = sle64((int64_t) 0, i_p_m_t_s_37786);
        bool i_p_m_t_s_leq_w_37788 = slt64(i_p_m_t_s_37786, dz2084U_35570);
        bool zzero_lte_i_37789 = sle64((int64_t) 0, inf_37750);
        bool i_lte_j_37790 = sle64(inf_37750, min_res_37752);
        bool y_37791 = i_p_m_t_s_leq_w_37788 && zzero_lte_i_37789;
        bool y_37792 = zzero_leq_i_p_m_t_s_37787 && y_37791;
        bool forwards_ok_37793 = i_lte_j_37790 && y_37792;
        bool ok_or_empty_37794 = empty_slice_37784 || forwards_ok_37793;
        bool index_certs_37795;
        
        if (!ok_or_empty_37794) {
            set_error(ctx, msgprintf("Error: %s%lld%s%lld%s%lld%s\n\nBacktrace:\n%s", "Index [", (long long) inf_37750, ":", (long long) min_res_37752, "] out of bounds for array of shape [", (long long) dz2084U_35570, "].", "-> #0  ft_libs/ftDBSCAN_plus.fut:786:44-81\n   #1  ft_libs/ftDBSCAN_plus.fut:869:18-871:58\n   #2  ft_libs/ftDBSCAN_plus.fut:868:9-871:68\n"));
            err = FUTHARK_PROGRAM_ERROR;
            goto cleanup;
        }
        
        bool suff_outer_par_42842;
        
        suff_outer_par_42842 = *ctx->tuning_params.make_collisions_compact_doublezisuff_outer_par_0 <= dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_37753;
        if (ctx->logging)
            fprintf(ctx->log, "Compared %s <= %ld: %s.\n", "make_collisions_compact_double.suff_outer_par_0", (long) dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_37753, suff_outer_par_42842 ? "true" : "false");
        
        int64_t shared_memory_capacity_50257;
        
        shared_memory_capacity_50257 = ctx->max_shared_memory;
        if (suff_outer_par_42842 && sle64(sdiv_up64(bytes_49470, (int64_t) 8) * (int64_t) 8 + sdiv_up64(bytes_49470, (int64_t) 8) * (int64_t) 8, shared_memory_capacity_50257)) {
            int64_t ldim_46538 = sdiv_up64(dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_37753, tile_sizze_46537);
            
            if (ctx->debugging)
                fprintf(ctx->log, "%s\n", "\n# SegMap");
            
            int32_t num_chunks_50215 = sext_i64_i32(sdiv_up64(tile_sizze_46537, tile_sizze_46537));
            int32_t virt_num_tblocks_50216 = sext_i64_i32(ldim_46538);
            
            {
                err = gpu_kernel_make_collisions_compact_doublezisegmap_intrablock_46535(ctx, ldim_46538, 1, 1, *ctx->tuning_params.make_collisions_compact_doublezitile_sizze_46536, 1, 1, bytes_49470 + srem64((int64_t) 8 - srem64(bytes_49470, (int64_t) 8), (int64_t) 8) + (bytes_49470 + srem64((int64_t) 8 - srem64(bytes_49470, (int64_t) 8), (int64_t) 8)), dz2084U_35570, inf_37750, dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_37753, ldim_46538, num_whole_tiles_46563, residual_input_46715, cond_46716, binop_x_46729, chain_collisions_mem_49374.mem, chain_collisions_mem_49375.mem, mem_49401.mem);
                if (err != FUTHARK_SUCCESS)
                    goto cleanup;
            }
            ctx->failure_is_an_option = 1;
            if (ctx->debugging)
                fprintf(ctx->log, "%s\n", "");
        } else {
            int64_t ldim_46807 = sdiv_up64(dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_37753, tile_sizze_46806);
            
            if (ctx->debugging)
                fprintf(ctx->log, "%s\n", "\n# SegMap");
            
            int32_t num_chunks_50236 = sext_i64_i32(sdiv_up64(tile_sizze_46806, tile_sizze_46806));
            int32_t virt_num_tblocks_50237 = sext_i64_i32(ldim_46807);
            
            {
                err = gpu_kernel_make_collisions_compact_doublezisegmap_intrablock_46804(ctx, ldim_46807, 1, 1, *ctx->tuning_params.make_collisions_compact_doublezitile_sizze_46805, 1, 1, bytes_49424 + srem64((int64_t) 8 - srem64(bytes_49424, (int64_t) 8), (int64_t) 8) + (bytes_49424 + srem64((int64_t) 8 - srem64(bytes_49424, (int64_t) 8), (int64_t) 8)), dz2084U_35570, inf_37750, dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_37753, ldim_46807, num_whole_tiles_46832, residual_input_46984, cond_46985, binop_x_46998, chain_collisions_mem_49374.mem, chain_collisions_mem_49375.mem, mem_49401.mem);
                if (err != FUTHARK_SUCCESS)
                    goto cleanup;
            }
            ctx->failure_is_an_option = 1;
            if (ctx->debugging)
                fprintf(ctx->log, "%s\n", "");
        }
    }
    
    int64_t segscan_tblock_sizze_42990;
    
    segscan_tblock_sizze_42990 = *ctx->tuning_params.make_collisions_compact_doublezisegscan_tblock_sizze_42989;
    
    int64_t num_tblocks_42992;
    int64_t max_num_tblocks_50258;
    
    max_num_tblocks_50258 = *ctx->tuning_params.make_collisions_compact_doublezisegscan_num_tblocks_42991;
    num_tblocks_42992 = sext_i64_i32(smax64((int64_t) 1, smin64(sdiv_up64(dz2084U_35570, segscan_tblock_sizze_42990), max_num_tblocks_50258)));
    
    int64_t bytes_49502 = (int64_t) 8 * dz2084U_35570;
    
    if (memblock_alloc_device(ctx, &mem_49503, bytes_49502, "mem_49503")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_49505, bytes_49502, "mem_49505")) {
        err = 1;
        goto cleanup;
    }
    if (slt64((int64_t) 0, dz2084U_35570)) {
        if (ctx->debugging)
            fprintf(ctx->log, "%s\n", "\n# SegScan");
        
        int64_t shared_memory_50259;
        
        shared_memory_50259 = ctx->max_shared_memory;
        
        int64_t thread_block_sizze_50260;
        
        thread_block_sizze_50260 = ctx->max_thread_block_size;
        
        int64_t registers_50261;
        
        registers_50261 = ctx->max_registers;
        
        int64_t thread_block_sizze_50262;
        
        thread_block_sizze_50262 = ctx->max_thread_block_size;
        
        int64_t chunk_sizze_50263 = smax64((int64_t) 1, smin64(squot64(squot64(shared_memory_50259, thread_block_sizze_50260), (int64_t) 8), squot64(squot64(registers_50261, thread_block_sizze_50262) - (int64_t) 1 - squot64(smax64((int64_t) 4, (int64_t) 8), (int64_t) 4), (int64_t) 2 * squot64(smax64((int64_t) 4, (int64_t) 8), (int64_t) 4))));
        int64_t num_virt_blocks_50264 = sdiv_up64(dz2084U_35570, segscan_tblock_sizze_42990 * chunk_sizze_50263);
        int64_t num_virt_threads_50265 = num_virt_blocks_50264 * segscan_tblock_sizze_42990;
        
        if (ctx->debugging)
            fprintf(ctx->log, "%s: %llu%c", "Sequential elements per thread (chunk)", (long long) chunk_sizze_50263, '\n');
        if (memblock_alloc_device(ctx, &status_flags_mem_50266, num_virt_blocks_50264, "status_flags_mem_50266")) {
            err = 1;
            goto cleanup;
        }
        if (futrts_builtinzhreplicate_i8(ctx, status_flags_mem_50266, num_virt_blocks_50264, (int8_t) 0) != 0) {
            err = 1;
            goto cleanup;
        }
        if (memblock_alloc_device(ctx, &aggregates_mem_50288, (int64_t) 8 * num_virt_blocks_50264, "aggregates_mem_50288")) {
            err = 1;
            goto cleanup;
        }
        if (memblock_alloc_device(ctx, &incprefixes_mem_50290, (int64_t) 8 * num_virt_blocks_50264, "incprefixes_mem_50290")) {
            err = 1;
            goto cleanup;
        }
        {
            err = gpu_kernel_make_collisions_compact_doublezisegscan_42995(ctx, num_tblocks_42992, 1, 1, *ctx->tuning_params.make_collisions_compact_doublezisegscan_tblock_sizze_42989, 1, 1, smax64(smax64((int64_t) 288, (int64_t) 8 * segscan_tblock_sizze_42990), chunk_sizze_50263 * segscan_tblock_sizze_42990 * (int64_t) 8) + srem64((int64_t) 8 - srem64(smax64(smax64((int64_t) 288, (int64_t) 8 * segscan_tblock_sizze_42990), chunk_sizze_50263 * segscan_tblock_sizze_42990 * (int64_t) 8), (int64_t) 8), (int64_t) 8), dz2084U_35570, num_tblocks_42992, num_virt_blocks_50264, num_virt_threads_50265, mem_49401.mem, mem_49503.mem, mem_49505.mem, status_flags_mem_50266.mem, aggregates_mem_50288.mem, incprefixes_mem_50290.mem, global_dynid_mem_50292.mem);
            if (err != FUTHARK_SUCCESS)
                goto cleanup;
        }
        if (ctx->debugging)
            fprintf(ctx->log, "%s\n", "");
    }
    if (memblock_unref_device(ctx, &mem_49401, "mem_49401") != 0)
        return 1;
    
    int64_t tmp_37817 = sub64(dz2084U_35570, (int64_t) 1);
    bool x_37818 = sle64((int64_t) 0, tmp_37817);
    bool y_37819 = slt64(tmp_37817, dz2084U_35570);
    bool bounds_check_37820 = x_37818 && y_37819;
    bool protect_assert_disj_37821 = zzero_37732 || bounds_check_37820;
    bool index_certs_37822;
    
    if (!protect_assert_disj_37821) {
        set_error(ctx, msgprintf("Error: %s%lld%s%lld%s\n\nBacktrace:\n%s", "Index [", (long long) tmp_37817, "] out of bounds for array of shape [", (long long) dz2084U_35570, "].", "-> #0  /prelude/soacs.fut:257:33-47\n   #1  /prelude/functional.fut:9:44-45\n   #2  ft_libs/ftDBSCAN_plus.fut:869:18-871:58\n   #3  ft_libs/ftDBSCAN_plus.fut:868:9-871:68\n"));
        err = FUTHARK_PROGRAM_ERROR;
        goto cleanup;
    }
    
    int64_t m_f_res_37823;
    
    if (nonzzero_37733) {
        int64_t read_res_52187;
        
        if ((err = gpu_scalar_from_device(ctx, &read_res_52187, mem_49503.mem, tmp_37817 * sizeof(int64_t), sizeof(int64_t))) != 0)
            goto cleanup;
        if (ctx->failure_is_an_option && futhark_context_sync(ctx) != 0) {
            err = 1;
            goto cleanup;
        }
        
        int64_t x_42223 = read_res_52187;
        
        m_f_res_37823 = x_42223;
    } else {
        m_f_res_37823 = (int64_t) 0;
    }
    
    int64_t m_37825;
    
    if (zzero_37732) {
        m_37825 = (int64_t) 0;
    } else {
        m_37825 = m_f_res_37823;
    }
    
    int64_t m_37835 = sub64(m_37825, (int64_t) 1);
    bool i_p_m_t_s_leq_w_37837 = slt64(m_37835, dz2084U_35570);
    bool zzero_leq_i_p_m_t_s_37836 = sle64((int64_t) 0, m_37835);
    bool y_37839 = zzero_leq_i_p_m_t_s_37836 && i_p_m_t_s_leq_w_37837;
    bool i_lte_j_37838 = sle64((int64_t) 0, m_37825);
    bool forwards_ok_37840 = i_lte_j_37838 && y_37839;
    bool eq_x_zz_37832 = (int64_t) 0 == m_f_res_37823;
    bool p_and_eq_x_y_37833 = nonzzero_37733 && eq_x_zz_37832;
    bool empty_slice_37834 = zzero_37732 || p_and_eq_x_y_37833;
    bool ok_or_empty_37841 = empty_slice_37834 || forwards_ok_37840;
    bool index_certs_37842;
    
    if (!ok_or_empty_37841) {
        set_error(ctx, msgprintf("Error: %s%lld%s%lld%s\n\nBacktrace:\n%s", "Index [:", (long long) m_37825, "] out of bounds for array of shape [", (long long) dz2084U_35570, "].", "-> #0  /prelude/soacs.fut:258:29-35\n   #1  /prelude/functional.fut:9:44-45\n   #2  ft_libs/ftDBSCAN_plus.fut:869:18-871:58\n   #3  ft_libs/ftDBSCAN_plus.fut:868:9-871:68\n"));
        err = FUTHARK_PROGRAM_ERROR;
        goto cleanup;
    }
    
    int64_t bytes_49506 = (int64_t) 8 * m_37825;
    
    if (memblock_alloc_device(ctx, &mem_49507, bytes_49506, "mem_49507")) {
        err = 1;
        goto cleanup;
    }
    if ((err = lmad_copy_gpu2gpu_8b(ctx, 1, mem_49507.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, chain_collisions_mem_49375.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, (int64_t []) {m_37825})) != 0)
        goto cleanup;
    if (memblock_alloc_device(ctx, &mem_49509, bytes_49506, "mem_49509")) {
        err = 1;
        goto cleanup;
    }
    if ((err = lmad_copy_gpu2gpu_8b(ctx, 1, mem_49509.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, chain_collisions_mem_49374.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, (int64_t []) {m_37825})) != 0)
        goto cleanup;
    
    int64_t segmap_tblock_sizze_43000;
    
    segmap_tblock_sizze_43000 = *ctx->tuning_params.make_collisions_compact_doublezisegmap_tblock_sizze_42999;
    
    int64_t num_tblocks_43002;
    int64_t max_num_tblocks_50401;
    
    max_num_tblocks_50401 = *ctx->tuning_params.make_collisions_compact_doublezisegmap_num_tblocks_43001;
    num_tblocks_43002 = sext_i64_i32(smax64((int64_t) 1, smin64(sdiv_up64(dz2084U_35570, segmap_tblock_sizze_43000), max_num_tblocks_50401)));
    if (ctx->debugging)
        fprintf(ctx->log, "%s\n", "\n# SegMap");
    
    int32_t virt_num_tblocks_50402 = sext_i64_i32(sdiv_up64(dz2084U_35570, segmap_tblock_sizze_43000));
    
    {
        err = gpu_kernel_make_collisions_compact_doublezisegmap_42997(ctx, num_tblocks_43002, 1, 1, *ctx->tuning_params.make_collisions_compact_doublezisegmap_tblock_sizze_42999, 1, 1, (int64_t) 0, dz2084U_35570, m_37825, num_tblocks_43002, virt_num_tblocks_50402, chain_collisions_mem_49374.mem, chain_collisions_mem_49375.mem, mem_49503.mem, mem_49505.mem, mem_49507.mem, mem_49509.mem);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (ctx->debugging)
        fprintf(ctx->log, "%s\n", "");
    if (memblock_unref_device(ctx, &mem_49503, "mem_49503") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_49505, "mem_49505") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_50191, &mem_49509, "mem_49509") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_50192, &mem_49507, "mem_49507") != 0)
        return 1;
    prim_out_50193 = m_37825;
    if (memblock_set_device(ctx, &*mem_out_p_52184, &mem_out_50191, "mem_out_50191") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_52185, &mem_out_50192, "mem_out_50192") != 0)
        return 1;
    *out_prim_out_52186 = prim_out_50193;
    
  cleanup:
    {
        if (memblock_unref_device(ctx, &mem_49509, "mem_49509") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49507, "mem_49507") != 0)
            return 1;
        if (memblock_unref_device(ctx, &incprefixes_mem_50290, "incprefixes_mem_50290") != 0)
            return 1;
        if (memblock_unref_device(ctx, &aggregates_mem_50288, "aggregates_mem_50288") != 0)
            return 1;
        if (memblock_unref_device(ctx, &status_flags_mem_50266, "status_flags_mem_50266") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49505, "mem_49505") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49503, "mem_49503") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49401, "mem_49401") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_50192, "mem_out_50192") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_50191, "mem_out_50191") != 0)
            return 1;
    }
    return err;
}
FUTHARK_FUN_ATTR int futrts_entry_mk_dbcHandler_double(struct futhark_context *ctx, struct memblock_device *mem_out_p_52188, struct memblock_device *mem_out_p_52189, struct memblock_device *mem_out_p_52190, struct memblock_device *mem_out_p_52191, struct memblock_device *mem_out_p_52192, struct memblock_device *mem_out_p_52193, struct memblock_device *mem_out_p_52194, struct memblock_device *mem_out_p_52195, struct memblock_device *mem_out_p_52196, struct memblock_device *mem_out_p_52197, struct memblock_device *mem_out_p_52198, struct memblock_device *mem_out_p_52199, struct memblock_device *mem_out_p_52200, struct memblock_device *mem_out_p_52201, struct memblock_device *mem_out_p_52202, struct memblock_device *mem_out_p_52203, struct memblock_device *mem_out_p_52204, struct memblock_device *mem_out_p_52205, struct memblock_device *mem_out_p_52206, struct memblock_device *mem_out_p_52207, struct memblock_device *mem_out_p_52208, struct memblock_device *mem_out_p_52209, struct memblock_device *mem_out_p_52210, struct memblock_device *mem_out_p_52211, struct memblock_device *mem_out_p_52212, struct memblock_device *mem_out_p_52213, struct memblock_device *mem_out_p_52214, int64_t *out_prim_out_52215, int8_t *out_prim_out_52216, int8_t *out_prim_out_52217, double *out_prim_out_52218, int64_t *out_prim_out_52219, int64_t *out_prim_out_52220, double *out_prim_out_52221, int64_t *out_prim_out_52222, int64_t *out_prim_out_52223, int64_t *out_prim_out_52224, int64_t *out_prim_out_52225, int64_t *out_prim_out_52226, int64_t *out_prim_out_52227, int64_t *out_prim_out_52228, double min_x_22265, double min_y_22266, double max_x_22267, double max_y_22268, int64_t parts_x_22269, int64_t parts_y_22270, bool isEuclidean_22271, bool isRadians_22272, double radius_22273, double eps_22274, int64_t minPts_22275, int64_t m_sizze_22276)
{
    (void) ctx;
    
    int err = 0;
    struct memblock_device mem_49404;
    
    mem_49404.references = NULL;
    
    struct memblock_device mem_49403;
    
    mem_49403.references = NULL;
    
    struct memblock_device mem_49402;
    
    mem_49402.references = NULL;
    
    struct memblock_device mem_49401;
    
    mem_49401.references = NULL;
    
    struct memblock_device mem_49400;
    
    mem_49400.references = NULL;
    
    struct memblock_device mem_49399;
    
    mem_49399.references = NULL;
    
    struct memblock_device mem_49398;
    
    mem_49398.references = NULL;
    
    struct memblock_device mem_49397;
    
    mem_49397.references = NULL;
    
    struct memblock_device mem_49396;
    
    mem_49396.references = NULL;
    
    struct memblock_device mem_49395;
    
    mem_49395.references = NULL;
    
    struct memblock_device mem_49394;
    
    mem_49394.references = NULL;
    
    struct memblock_device mem_49393;
    
    mem_49393.references = NULL;
    
    struct memblock_device mem_49392;
    
    mem_49392.references = NULL;
    
    struct memblock_device mem_49391;
    
    mem_49391.references = NULL;
    
    struct memblock_device mem_49390;
    
    mem_49390.references = NULL;
    
    struct memblock_device mem_49389;
    
    mem_49389.references = NULL;
    
    struct memblock_device mem_49388;
    
    mem_49388.references = NULL;
    
    struct memblock_device mem_49387;
    
    mem_49387.references = NULL;
    
    struct memblock_device mem_49386;
    
    mem_49386.references = NULL;
    
    struct memblock_device mem_49385;
    
    mem_49385.references = NULL;
    
    struct memblock_device mem_49384;
    
    mem_49384.references = NULL;
    
    struct memblock_device mem_49383;
    
    mem_49383.references = NULL;
    
    struct memblock_device mem_49382;
    
    mem_49382.references = NULL;
    
    struct memblock_device mem_49381;
    
    mem_49381.references = NULL;
    
    struct memblock_device mem_49380;
    
    mem_49380.references = NULL;
    
    struct memblock_device mem_49379;
    
    mem_49379.references = NULL;
    
    struct memblock_device mem_49378;
    
    mem_49378.references = NULL;
    
    struct memblock_device mem_49377;
    
    mem_49377.references = NULL;
    
    struct memblock_device mem_49376;
    
    mem_49376.references = NULL;
    
    struct memblock_device mem_49375;
    
    mem_49375.references = NULL;
    
    struct memblock_device mem_49374;
    
    mem_49374.references = NULL;
    
    struct memblock_device mem_out_50217;
    
    mem_out_50217.references = NULL;
    
    struct memblock_device mem_out_50216;
    
    mem_out_50216.references = NULL;
    
    struct memblock_device mem_out_50215;
    
    mem_out_50215.references = NULL;
    
    struct memblock_device mem_out_50214;
    
    mem_out_50214.references = NULL;
    
    struct memblock_device mem_out_50213;
    
    mem_out_50213.references = NULL;
    
    struct memblock_device mem_out_50212;
    
    mem_out_50212.references = NULL;
    
    struct memblock_device mem_out_50211;
    
    mem_out_50211.references = NULL;
    
    struct memblock_device mem_out_50210;
    
    mem_out_50210.references = NULL;
    
    struct memblock_device mem_out_50209;
    
    mem_out_50209.references = NULL;
    
    struct memblock_device mem_out_50208;
    
    mem_out_50208.references = NULL;
    
    struct memblock_device mem_out_50207;
    
    mem_out_50207.references = NULL;
    
    struct memblock_device mem_out_50206;
    
    mem_out_50206.references = NULL;
    
    struct memblock_device mem_out_50205;
    
    mem_out_50205.references = NULL;
    
    struct memblock_device mem_out_50204;
    
    mem_out_50204.references = NULL;
    
    struct memblock_device mem_out_50203;
    
    mem_out_50203.references = NULL;
    
    struct memblock_device mem_out_50202;
    
    mem_out_50202.references = NULL;
    
    struct memblock_device mem_out_50201;
    
    mem_out_50201.references = NULL;
    
    struct memblock_device mem_out_50200;
    
    mem_out_50200.references = NULL;
    
    struct memblock_device mem_out_50199;
    
    mem_out_50199.references = NULL;
    
    struct memblock_device mem_out_50198;
    
    mem_out_50198.references = NULL;
    
    struct memblock_device mem_out_50197;
    
    mem_out_50197.references = NULL;
    
    struct memblock_device mem_out_50196;
    
    mem_out_50196.references = NULL;
    
    struct memblock_device mem_out_50195;
    
    mem_out_50195.references = NULL;
    
    struct memblock_device mem_out_50194;
    
    mem_out_50194.references = NULL;
    
    struct memblock_device mem_out_50193;
    
    mem_out_50193.references = NULL;
    
    struct memblock_device mem_out_50192;
    
    mem_out_50192.references = NULL;
    
    struct memblock_device mem_out_50191;
    
    mem_out_50191.references = NULL;
    
    struct memblock_device counters_mem_50201 = ctx->constants->counters_mem_50201;
    struct memblock_device counters_mem_50275 = ctx->constants->counters_mem_50275;
    struct memblock_device counters_mem_50707 = ctx->constants->counters_mem_50707;
    struct memblock_device counters_mem_51122 = ctx->constants->counters_mem_51122;
    struct memblock_device counters_mem_51145 = ctx->constants->counters_mem_51145;
    struct memblock_device counters_mem_51184 = ctx->constants->counters_mem_51184;
    struct memblock_device counters_mem_51873 = ctx->constants->counters_mem_51873;
    struct memblock_device counters_mem_52032 = ctx->constants->counters_mem_52032;
    struct memblock_device global_dynid_mem_50266 = ctx->constants->global_dynid_mem_50266;
    struct memblock_device global_dynid_mem_50275 = ctx->constants->global_dynid_mem_50275;
    struct memblock_device global_dynid_mem_50287 = ctx->constants->global_dynid_mem_50287;
    struct memblock_device global_dynid_mem_50292 = ctx->constants->global_dynid_mem_50292;
    struct memblock_device global_dynid_mem_50450 = ctx->constants->global_dynid_mem_50450;
    struct memblock_device global_dynid_mem_50529 = ctx->constants->global_dynid_mem_50529;
    struct memblock_device global_dynid_mem_50570 = ctx->constants->global_dynid_mem_50570;
    struct memblock_device global_dynid_mem_50733 = ctx->constants->global_dynid_mem_50733;
    struct memblock_device global_dynid_mem_50769 = ctx->constants->global_dynid_mem_50769;
    struct memblock_device global_dynid_mem_50871 = ctx->constants->global_dynid_mem_50871;
    struct memblock_device global_dynid_mem_50875 = ctx->constants->global_dynid_mem_50875;
    struct memblock_device global_dynid_mem_50988 = ctx->constants->global_dynid_mem_50988;
    struct memblock_device global_dynid_mem_51231 = ctx->constants->global_dynid_mem_51231;
    struct memblock_device global_dynid_mem_51378 = ctx->constants->global_dynid_mem_51378;
    struct memblock_device global_dynid_mem_51534 = ctx->constants->global_dynid_mem_51534;
    struct memblock_device global_dynid_mem_51651 = ctx->constants->global_dynid_mem_51651;
    int64_t prim_out_50218;
    int8_t prim_out_50219;
    int8_t prim_out_50220;
    double prim_out_50221;
    int64_t prim_out_50222;
    int64_t prim_out_50223;
    double prim_out_50224;
    int64_t prim_out_50225;
    int64_t prim_out_50226;
    int64_t prim_out_50227;
    int64_t prim_out_50228;
    int64_t prim_out_50229;
    int64_t prim_out_50230;
    int64_t prim_out_50231;
    int64_t dzlz7bUZLztZRz20Uparts_xz20Uparts_yz7dUzg_37127 = mul64(parts_x_22269, parts_y_22270);
    bool cond_neg_37124 = !isEuclidean_22271;
    int8_t dist_type_37125 = btoi_bool_i8(cond_neg_37124);
    int8_t angle_type_37126 = btoi_bool_i8(isRadians_22272);
    double i64_res_37130 = sitofp_i64_f64(parts_x_22269);
    double zm_res_37131 = max_x_22267 - min_x_22265;
    double zs_res_37132 = zm_res_37131 / i64_res_37130;
    double i64_res_37133 = sitofp_i64_f64(parts_y_22270);
    double zm_res_37134 = max_y_22268 - min_y_22266;
    double zs_res_37135 = zm_res_37134 / i64_res_37133;
    
    if (memblock_alloc_device(ctx, &mem_49374, dzlz7bUZLztZRz20Uparts_xz20Uparts_yz7dUzg_37127, "mem_49374")) {
        err = 1;
        goto cleanup;
    }
    if (futrts_builtinzhreplicate_bool(ctx, mem_49374, dzlz7bUZLztZRz20Uparts_xz20Uparts_yz7dUzg_37127, 0) != 0) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_49375, (int64_t) 0, "mem_49375")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_49376, (int64_t) 0, "mem_49376")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_49377, (int64_t) 0, "mem_49377")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_49378, (int64_t) 0, "mem_49378")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_49379, (int64_t) 0, "mem_49379")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_49380, (int64_t) 16, "mem_49380")) {
        err = 1;
        goto cleanup;
    }
    if (futrts_builtinzhreplicate_f64(ctx, mem_49380, (int64_t) 2, INFINITY) != 0) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_49381, (int64_t) 16, "mem_49381")) {
        err = 1;
        goto cleanup;
    }
    if (futrts_builtinzhreplicate_f64(ctx, mem_49381, (int64_t) 2, -INFINITY) != 0) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_49382, (int64_t) 16, "mem_49382")) {
        err = 1;
        goto cleanup;
    }
    if (futrts_builtinzhreplicate_f64(ctx, mem_49382, (int64_t) 2, INFINITY) != 0) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_49383, (int64_t) 16, "mem_49383")) {
        err = 1;
        goto cleanup;
    }
    if (futrts_builtinzhreplicate_f64(ctx, mem_49383, (int64_t) 2, -INFINITY) != 0) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_49384, (int64_t) 64, "mem_49384")) {
        err = 1;
        goto cleanup;
    }
    if (futrts_builtinzhreplicate_i64(ctx, mem_49384, (int64_t) 8, (int64_t) -1) != 0) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_49385, (int64_t) 8, "mem_49385")) {
        err = 1;
        goto cleanup;
    }
    if (futrts_builtinzhreplicate_bool(ctx, mem_49385, (int64_t) 8, 0) != 0) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_49386, (int64_t) 0, "mem_49386")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_49387, (int64_t) 0, "mem_49387")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_49388, (int64_t) 0, "mem_49388")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_49389, (int64_t) 0, "mem_49389")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_49390, (int64_t) 0, "mem_49390")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_49391, (int64_t) 0, "mem_49391")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_49392, (int64_t) 0, "mem_49392")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_49393, (int64_t) 0, "mem_49393")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_49394, (int64_t) 0, "mem_49394")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_49395, (int64_t) 0, "mem_49395")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_49396, (int64_t) 0, "mem_49396")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_49397, (int64_t) 16, "mem_49397")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_49398, (int64_t) 16, "mem_49398")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_49399, (int64_t) 16, "mem_49399")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_49400, (int64_t) 16, "mem_49400")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_49401, (int64_t) 16, "mem_49401")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_49402, (int64_t) 16, "mem_49402")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_49403, (int64_t) 16, "mem_49403")) {
        err = 1;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_49404, (int64_t) 16, "mem_49404")) {
        err = 1;
        goto cleanup;
    }
    {
        err = gpu_kernel_mk_dbcHandler_doublezigpuseq_50292(ctx, (int64_t) 1, 1, 1, (int64_t) 1, 1, 1, (int64_t) 0, min_x_22265, min_y_22266, max_x_22267, max_y_22268, parts_x_22269, parts_y_22270, zs_res_37132, zs_res_37135, mem_49397.mem, mem_49398.mem, mem_49399.mem, mem_49400.mem, mem_49401.mem, mem_49402.mem, mem_49403.mem, mem_49404.mem);
        if (err != FUTHARK_SUCCESS)
            goto cleanup;
    }
    if (memblock_unref_device(ctx, &mem_49397, "mem_49397") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_49398, "mem_49398") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_49399, "mem_49399") != 0)
        return 1;
    if (memblock_unref_device(ctx, &mem_49400, "mem_49400") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_50191, &mem_49395, "mem_49395") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_50192, &mem_49396, "mem_49396") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_50193, &mem_49402, "mem_49402") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_50194, &mem_49401, "mem_49401") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_50195, &mem_49404, "mem_49404") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_50196, &mem_49403, "mem_49403") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_50197, &mem_49375, "mem_49375") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_50198, &mem_49376, "mem_49376") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_50199, &mem_49377, "mem_49377") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_50200, &mem_49378, "mem_49378") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_50201, &mem_49374, "mem_49374") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_50202, &mem_49379, "mem_49379") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_50203, &mem_49386, "mem_49386") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_50204, &mem_49387, "mem_49387") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_50205, &mem_49388, "mem_49388") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_50206, &mem_49383, "mem_49383") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_50207, &mem_49382, "mem_49382") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_50208, &mem_49389, "mem_49389") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_50209, &mem_49390, "mem_49390") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_50210, &mem_49385, "mem_49385") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_50211, &mem_49391, "mem_49391") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_50212, &mem_49381, "mem_49381") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_50213, &mem_49380, "mem_49380") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_50214, &mem_49384, "mem_49384") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_50215, &mem_49392, "mem_49392") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_50216, &mem_49393, "mem_49393") != 0)
        return 1;
    if (memblock_set_device(ctx, &mem_out_50217, &mem_49394, "mem_49394") != 0)
        return 1;
    prim_out_50218 = dzlz7bUZLztZRz20Uparts_xz20Uparts_yz7dUzg_37127;
    prim_out_50219 = angle_type_37126;
    prim_out_50220 = dist_type_37125;
    prim_out_50221 = eps_22274;
    prim_out_50222 = m_sizze_22276;
    prim_out_50223 = minPts_22275;
    prim_out_50224 = radius_22273;
    prim_out_50225 = dzlz7bUZLztZRz20Uparts_xz20Uparts_yz7dUzg_37127;
    prim_out_50226 = (int64_t) 0;
    prim_out_50227 = (int64_t) -1;
    prim_out_50228 = (int64_t) -1;
    prim_out_50229 = (int64_t) 0;
    prim_out_50230 = (int64_t) -1;
    prim_out_50231 = (int64_t) -1;
    if (memblock_set_device(ctx, &*mem_out_p_52188, &mem_out_50191, "mem_out_50191") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_52189, &mem_out_50192, "mem_out_50192") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_52190, &mem_out_50193, "mem_out_50193") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_52191, &mem_out_50194, "mem_out_50194") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_52192, &mem_out_50195, "mem_out_50195") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_52193, &mem_out_50196, "mem_out_50196") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_52194, &mem_out_50197, "mem_out_50197") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_52195, &mem_out_50198, "mem_out_50198") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_52196, &mem_out_50199, "mem_out_50199") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_52197, &mem_out_50200, "mem_out_50200") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_52198, &mem_out_50201, "mem_out_50201") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_52199, &mem_out_50202, "mem_out_50202") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_52200, &mem_out_50203, "mem_out_50203") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_52201, &mem_out_50204, "mem_out_50204") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_52202, &mem_out_50205, "mem_out_50205") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_52203, &mem_out_50206, "mem_out_50206") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_52204, &mem_out_50207, "mem_out_50207") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_52205, &mem_out_50208, "mem_out_50208") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_52206, &mem_out_50209, "mem_out_50209") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_52207, &mem_out_50210, "mem_out_50210") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_52208, &mem_out_50211, "mem_out_50211") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_52209, &mem_out_50212, "mem_out_50212") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_52210, &mem_out_50213, "mem_out_50213") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_52211, &mem_out_50214, "mem_out_50214") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_52212, &mem_out_50215, "mem_out_50215") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_52213, &mem_out_50216, "mem_out_50216") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_52214, &mem_out_50217, "mem_out_50217") != 0)
        return 1;
    *out_prim_out_52215 = prim_out_50218;
    *out_prim_out_52216 = prim_out_50219;
    *out_prim_out_52217 = prim_out_50220;
    *out_prim_out_52218 = prim_out_50221;
    *out_prim_out_52219 = prim_out_50222;
    *out_prim_out_52220 = prim_out_50223;
    *out_prim_out_52221 = prim_out_50224;
    *out_prim_out_52222 = prim_out_50225;
    *out_prim_out_52223 = prim_out_50226;
    *out_prim_out_52224 = prim_out_50227;
    *out_prim_out_52225 = prim_out_50228;
    *out_prim_out_52226 = prim_out_50229;
    *out_prim_out_52227 = prim_out_50230;
    *out_prim_out_52228 = prim_out_50231;
    
  cleanup:
    {
        if (memblock_unref_device(ctx, &mem_49404, "mem_49404") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49403, "mem_49403") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49402, "mem_49402") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49401, "mem_49401") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49400, "mem_49400") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49399, "mem_49399") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49398, "mem_49398") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49397, "mem_49397") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49396, "mem_49396") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49395, "mem_49395") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49394, "mem_49394") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49393, "mem_49393") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49392, "mem_49392") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49391, "mem_49391") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49390, "mem_49390") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49389, "mem_49389") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49388, "mem_49388") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49387, "mem_49387") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49386, "mem_49386") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49385, "mem_49385") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49384, "mem_49384") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49383, "mem_49383") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49382, "mem_49382") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49381, "mem_49381") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49380, "mem_49380") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49379, "mem_49379") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49378, "mem_49378") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49377, "mem_49377") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49376, "mem_49376") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49375, "mem_49375") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49374, "mem_49374") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_50217, "mem_out_50217") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_50216, "mem_out_50216") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_50215, "mem_out_50215") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_50214, "mem_out_50214") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_50213, "mem_out_50213") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_50212, "mem_out_50212") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_50211, "mem_out_50211") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_50210, "mem_out_50210") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_50209, "mem_out_50209") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_50208, "mem_out_50208") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_50207, "mem_out_50207") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_50206, "mem_out_50206") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_50205, "mem_out_50205") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_50204, "mem_out_50204") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_50203, "mem_out_50203") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_50202, "mem_out_50202") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_50201, "mem_out_50201") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_50200, "mem_out_50200") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_50199, "mem_out_50199") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_50198, "mem_out_50198") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_50197, "mem_out_50197") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_50196, "mem_out_50196") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_50195, "mem_out_50195") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_50194, "mem_out_50194") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_50193, "mem_out_50193") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_50192, "mem_out_50192") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_50191, "mem_out_50191") != 0)
            return 1;
    }
    return err;
}
FUTHARK_FUN_ATTR int futrts_entry_next_partition_to_read_double(struct futhark_context *ctx, int64_t *out_prim_out_52229, struct memblock_device chain_collisions_mem_49374, struct memblock_device chain_collisions_mem_49375, struct memblock_device clBase_mem_49376, struct memblock_device clBase_mem_49377, struct memblock_device clBase_mem_49378, struct memblock_device clBase_mem_49379, struct memblock_device clProc_mem_49380, struct memblock_device clProc_mem_49381, struct memblock_device clProc_mem_49382, struct memblock_device clProc_mem_49383, struct memblock_device clProc_mem_49384, struct memblock_device clProc_mem_49385, struct memblock_device current_partition_mem_49386, struct memblock_device current_partition_mem_49387, struct memblock_device current_partition_mem_49388, struct memblock_device current_partition_mem_49389, struct memblock_device current_partition_mem_49390, struct memblock_device current_partition_mem_49391, struct memblock_device current_partition_mem_49392, struct memblock_device current_partition_mem_49393, struct memblock_device current_partition_mem_49394, struct memblock_device current_partition_mem_49395, struct memblock_device current_partition_mem_49396, struct memblock_device current_partition_mem_49397, struct memblock_device toFlush_dat_mem_49398, struct memblock_device toFlush_dat_mem_49399, struct memblock_device toFlush_ids_mem_49400, int64_t n_22872, int64_t part_no_22873, int64_t dz2084U_22874, int64_t dz2080U_22875, int64_t dz2081U_22876, int64_t dz2082U_22877, int64_t dz2083U_22878, int64_t dz2085U_22879, int64_t dz2086U_22880, int8_t clBase_22883, int8_t clBase_22884, double clBase_22885, int64_t clBase_22886, int64_t clBase_22888, double clBase_22891, int64_t clBase_22893, int64_t clProc_22898, int64_t clProc_22899, int64_t clProc_22900, int64_t clProc_22902, int64_t clProc_22903, int64_t current_partition_22917)
{
    (void) ctx;
    
    int err = 0;
    struct memblock_device mem_49403;
    
    mem_49403.references = NULL;
    
    struct memblock_device mem_49412;
    
    mem_49412.references = NULL;
    
    struct memblock_device mem_49410;
    
    mem_49410.references = NULL;
    
    struct memblock_device incprefixes_mem_50285;
    
    incprefixes_mem_50285.references = NULL;
    
    struct memblock_device aggregates_mem_50283;
    
    aggregates_mem_50283.references = NULL;
    
    struct memblock_device status_flags_mem_50261;
    
    status_flags_mem_50261.references = NULL;
    
    struct memblock_device mem_49408;
    
    mem_49408.references = NULL;
    
    struct memblock_device mem_49406;
    
    mem_49406.references = NULL;
    
    struct memblock_device ext_mem_49413;
    
    ext_mem_49413.references = NULL;
    
    struct memblock_device segred_tmp_mem_50223;
    
    segred_tmp_mem_50223.references = NULL;
    
    struct memblock_device mem_49402;
    
    mem_49402.references = NULL;
    
    struct memblock_device mem_49414;
    
    mem_49414.references = NULL;
    
    struct memblock_device ext_mem_49415;
    
    ext_mem_49415.references = NULL;
    
    struct memblock_device counters_mem_50201 = ctx->constants->counters_mem_50201;
    struct memblock_device counters_mem_50275 = ctx->constants->counters_mem_50275;
    struct memblock_device counters_mem_50707 = ctx->constants->counters_mem_50707;
    struct memblock_device counters_mem_51122 = ctx->constants->counters_mem_51122;
    struct memblock_device counters_mem_51145 = ctx->constants->counters_mem_51145;
    struct memblock_device counters_mem_51184 = ctx->constants->counters_mem_51184;
    struct memblock_device counters_mem_51873 = ctx->constants->counters_mem_51873;
    struct memblock_device counters_mem_52032 = ctx->constants->counters_mem_52032;
    struct memblock_device global_dynid_mem_50266 = ctx->constants->global_dynid_mem_50266;
    struct memblock_device global_dynid_mem_50275 = ctx->constants->global_dynid_mem_50275;
    struct memblock_device global_dynid_mem_50287 = ctx->constants->global_dynid_mem_50287;
    struct memblock_device global_dynid_mem_50292 = ctx->constants->global_dynid_mem_50292;
    struct memblock_device global_dynid_mem_50450 = ctx->constants->global_dynid_mem_50450;
    struct memblock_device global_dynid_mem_50529 = ctx->constants->global_dynid_mem_50529;
    struct memblock_device global_dynid_mem_50570 = ctx->constants->global_dynid_mem_50570;
    struct memblock_device global_dynid_mem_50733 = ctx->constants->global_dynid_mem_50733;
    struct memblock_device global_dynid_mem_50769 = ctx->constants->global_dynid_mem_50769;
    struct memblock_device global_dynid_mem_50871 = ctx->constants->global_dynid_mem_50871;
    struct memblock_device global_dynid_mem_50875 = ctx->constants->global_dynid_mem_50875;
    struct memblock_device global_dynid_mem_50988 = ctx->constants->global_dynid_mem_50988;
    struct memblock_device global_dynid_mem_51231 = ctx->constants->global_dynid_mem_51231;
    struct memblock_device global_dynid_mem_51378 = ctx->constants->global_dynid_mem_51378;
    struct memblock_device global_dynid_mem_51534 = ctx->constants->global_dynid_mem_51534;
    struct memblock_device global_dynid_mem_51651 = ctx->constants->global_dynid_mem_51651;
    int64_t prim_out_50191;
    int64_t zeze_rhs_37732 = sub64(part_no_22873, (int64_t) 1);
    bool cond_37733 = clProc_22900 == zeze_rhs_37732;
    int64_t next_partition_to_read_res_37734;
    
    if (cond_37733) {
        next_partition_to_read_res_37734 = (int64_t) -1;
    } else {
        bool cond_37735 = slt64((int64_t) 0, dz2083U_22878);
        int64_t segred_tblock_sizze_42817;
        
        segred_tblock_sizze_42817 = *ctx->tuning_params.next_partition_to_read_doublezisegred_tblock_sizze_42816;
        
        int64_t num_tblocks_42819;
        int64_t max_num_tblocks_50192;
        
        max_num_tblocks_50192 = *ctx->tuning_params.next_partition_to_read_doublezisegred_num_tblocks_42818;
        num_tblocks_42819 = sext_i64_i32(smax64((int64_t) 1, smin64(sdiv_up64(part_no_22873, segred_tblock_sizze_42817), max_num_tblocks_50192)));
        
        bool cond_37749 = part_no_22873 == (int64_t) 0;
        bool x_37750 = !cond_37749;
        bool x_37751 = sle64((int64_t) 0, zeze_rhs_37732);
        bool y_37752 = slt64(zeze_rhs_37732, part_no_22873);
        bool bounds_check_37753 = x_37751 && y_37752;
        bool protect_assert_disj_37754 = cond_37749 || bounds_check_37753;
        int64_t segscan_tblock_sizze_42827;
        
        segscan_tblock_sizze_42827 = *ctx->tuning_params.next_partition_to_read_doublezisegscan_tblock_sizze_42826;
        
        int64_t num_tblocks_42829;
        int64_t max_num_tblocks_50193;
        
        max_num_tblocks_50193 = *ctx->tuning_params.next_partition_to_read_doublezisegscan_num_tblocks_42828;
        num_tblocks_42829 = sext_i64_i32(smax64((int64_t) 1, smin64(sdiv_up64(part_no_22873, segscan_tblock_sizze_42827), max_num_tblocks_50193)));
        
        int64_t bytes_49405 = (int64_t) 8 * part_no_22873;
        
        if (cond_37735) {
            bool index_certs_42347;
            
            if (!cond_37735) {
                set_error(ctx, msgprintf("Error: %s%lld%s%lld%s\n\nBacktrace:\n%s", "Index [", (long long) (int64_t) 0, "] out of bounds for array of shape [", (long long) dz2083U_22878, "].", "-> #0  ft_libs/ftDBSCAN_plus.fut:231:51-84\n   #1  ft_libs/ftDBSCAN_plus.fut:845:18-847:57\n   #2  ft_libs/ftDBSCAN_plus.fut:844:9-847:67\n"));
                err = FUTHARK_PROGRAM_ERROR;
                goto cleanup;
            }
            if (memblock_alloc_device(ctx, &mem_49414, (int64_t) 8, "mem_49414")) {
                err = 1;
                goto cleanup;
            }
            {
                err = gpu_kernel_next_partition_to_read_doublezigpuseq_50194(ctx, (int64_t) 1, 1, 1, (int64_t) 1, 1, 1, (int64_t) 0, clProc_mem_49385.mem, mem_49414.mem);
                if (err != FUTHARK_SUCCESS)
                    goto cleanup;
            }
            if (memblock_set_device(ctx, &ext_mem_49415, &mem_49414, "mem_49414") != 0)
                return 1;
        } else {
            if (memblock_alloc_device(ctx, &mem_49402, (int64_t) 8, "mem_49402")) {
                err = 1;
                goto cleanup;
            }
            if (ctx->debugging)
                fprintf(ctx->log, "%s\n", "\n# SegRed");
            
            int64_t chunk_sizze_50200 = (int64_t) 1;
            
            if (memblock_alloc_device(ctx, &segred_tmp_mem_50223, (int64_t) 8 * num_tblocks_42819, "segred_tmp_mem_50223")) {
                err = 1;
                goto cleanup;
            }
            
            int64_t num_threads_50225 = num_tblocks_42819 * segred_tblock_sizze_42817;
            
            {
                err = gpu_kernel_next_partition_to_read_doublezisegred_nonseg_42824(ctx, num_tblocks_42819, 1, 1, *ctx->tuning_params.next_partition_to_read_doublezisegred_tblock_sizze_42816, 1, 1, 8 + ((int64_t) 8 * segred_tblock_sizze_42817 + srem64((int64_t) 8 - srem64((int64_t) 8 * segred_tblock_sizze_42817, (int64_t) 8), (int64_t) 8)), part_no_22873, num_tblocks_42819, num_threads_50225, clProc_mem_49384.mem, mem_49402.mem, counters_mem_50201.mem, segred_tmp_mem_50223.mem);
                if (err != FUTHARK_SUCCESS)
                    goto cleanup;
            }
            if (ctx->debugging)
                fprintf(ctx->log, "%s\n", "");
            
            int64_t read_res_52230;
            
            if ((err = gpu_scalar_from_device(ctx, &read_res_52230, mem_49402.mem, (int64_t) 0 * sizeof(int64_t), sizeof(int64_t))) != 0)
                goto cleanup;
            if (ctx->failure_is_an_option && futhark_context_sync(ctx) != 0) {
                err = 1;
                goto cleanup;
            }
            
            int64_t defunc_res_42400 = read_res_52230;
            
            if (memblock_unref_device(ctx, &mem_49402, "mem_49402") != 0)
                return 1;
            
            bool cond_37748 = slt64((int64_t) 0, defunc_res_42400);
            bool loop_not_taken_37755 = !cond_37748;
            bool protect_assert_disj_37756 = protect_assert_disj_37754 || loop_not_taken_37755;
            bool index_certs_37757;
            
            if (!protect_assert_disj_37756) {
                set_error(ctx, msgprintf("Error: %s%lld%s%lld%s\n\nBacktrace:\n%s", "Index [", (long long) zeze_rhs_37732, "] out of bounds for array of shape [", (long long) part_no_22873, "].", "-> #0  /prelude/soacs.fut:257:33-47\n   #1  /prelude/functional.fut:9:44-45\n   #2  ft_libs/ftDBSCAN_plus.fut:845:18-847:57\n   #3  ft_libs/ftDBSCAN_plus.fut:844:9-847:67\n"));
                err = FUTHARK_PROGRAM_ERROR;
                goto cleanup;
            }
            if (cond_37748) {
                if (memblock_alloc_device(ctx, &mem_49406, bytes_49405, "mem_49406")) {
                    err = 1;
                    goto cleanup;
                }
                if (memblock_alloc_device(ctx, &mem_49408, bytes_49405, "mem_49408")) {
                    err = 1;
                    goto cleanup;
                }
                if (slt64((int64_t) 0, part_no_22873)) {
                    if (ctx->debugging)
                        fprintf(ctx->log, "%s\n", "\n# SegScan");
                    
                    int64_t shared_memory_50254;
                    
                    shared_memory_50254 = ctx->max_shared_memory;
                    
                    int64_t thread_block_sizze_50255;
                    
                    thread_block_sizze_50255 = ctx->max_thread_block_size;
                    
                    int64_t registers_50256;
                    
                    registers_50256 = ctx->max_registers;
                    
                    int64_t thread_block_sizze_50257;
                    
                    thread_block_sizze_50257 = ctx->max_thread_block_size;
                    
                    int64_t chunk_sizze_50258 = smax64((int64_t) 1, smin64(squot64(squot64(shared_memory_50254, thread_block_sizze_50255), (int64_t) 8), squot64(squot64(registers_50256, thread_block_sizze_50257) - (int64_t) 1 - squot64(smax64((int64_t) 4, (int64_t) 8), (int64_t) 4), (int64_t) 2 * squot64(smax64((int64_t) 4, (int64_t) 8), (int64_t) 4))));
                    int64_t num_virt_blocks_50259 = sdiv_up64(part_no_22873, segscan_tblock_sizze_42827 * chunk_sizze_50258);
                    int64_t num_virt_threads_50260 = num_virt_blocks_50259 * segscan_tblock_sizze_42827;
                    
                    if (ctx->debugging)
                        fprintf(ctx->log, "%s: %llu%c", "Sequential elements per thread (chunk)", (long long) chunk_sizze_50258, '\n');
                    if (memblock_alloc_device(ctx, &status_flags_mem_50261, num_virt_blocks_50259, "status_flags_mem_50261")) {
                        err = 1;
                        goto cleanup;
                    }
                    if (futrts_builtinzhreplicate_i8(ctx, status_flags_mem_50261, num_virt_blocks_50259, (int8_t) 0) != 0) {
                        err = 1;
                        goto cleanup;
                    }
                    if (memblock_alloc_device(ctx, &aggregates_mem_50283, (int64_t) 8 * num_virt_blocks_50259, "aggregates_mem_50283")) {
                        err = 1;
                        goto cleanup;
                    }
                    if (memblock_alloc_device(ctx, &incprefixes_mem_50285, (int64_t) 8 * num_virt_blocks_50259, "incprefixes_mem_50285")) {
                        err = 1;
                        goto cleanup;
                    }
                    {
                        err = gpu_kernel_next_partition_to_read_doublezisegscan_42832(ctx, num_tblocks_42829, 1, 1, *ctx->tuning_params.next_partition_to_read_doublezisegscan_tblock_sizze_42826, 1, 1, smax64(smax64((int64_t) 288, (int64_t) 8 * segscan_tblock_sizze_42827), chunk_sizze_50258 * segscan_tblock_sizze_42827 * (int64_t) 8) + srem64((int64_t) 8 - srem64(smax64(smax64((int64_t) 288, (int64_t) 8 * segscan_tblock_sizze_42827), chunk_sizze_50258 * segscan_tblock_sizze_42827 * (int64_t) 8), (int64_t) 8), (int64_t) 8), part_no_22873, num_tblocks_42829, num_virt_blocks_50259, num_virt_threads_50260, clProc_mem_49384.mem, mem_49406.mem, mem_49408.mem, status_flags_mem_50261.mem, aggregates_mem_50283.mem, incprefixes_mem_50285.mem, global_dynid_mem_50287.mem);
                        if (err != FUTHARK_SUCCESS)
                            goto cleanup;
                    }
                    if (ctx->debugging)
                        fprintf(ctx->log, "%s\n", "");
                }
                
                int64_t m_f_res_42371;
                
                if (x_37750) {
                    int64_t read_res_52231;
                    
                    if ((err = gpu_scalar_from_device(ctx, &read_res_52231, mem_49406.mem, zeze_rhs_37732 * sizeof(int64_t), sizeof(int64_t))) != 0)
                        goto cleanup;
                    if (ctx->failure_is_an_option && futhark_context_sync(ctx) != 0) {
                        err = 1;
                        goto cleanup;
                    }
                    
                    int64_t x_42372 = read_res_52231;
                    
                    m_f_res_42371 = x_42372;
                } else {
                    m_f_res_42371 = (int64_t) 0;
                }
                
                int64_t m_42373;
                
                if (cond_37749) {
                    m_42373 = (int64_t) 0;
                } else {
                    m_42373 = m_f_res_42371;
                }
                
                int64_t m_42374 = sub64(m_42373, (int64_t) 1);
                bool i_p_m_t_s_leq_w_42375 = slt64(m_42374, part_no_22873);
                bool zzero_leq_i_p_m_t_s_42376 = sle64((int64_t) 0, m_42374);
                bool y_42377 = i_p_m_t_s_leq_w_42375 && zzero_leq_i_p_m_t_s_42376;
                bool i_lte_j_42378 = sle64((int64_t) 0, m_42373);
                bool forwards_ok_42379 = y_42377 && i_lte_j_42378;
                bool eq_x_zz_42380 = (int64_t) 0 == m_f_res_42371;
                bool p_and_eq_x_y_42381 = x_37750 && eq_x_zz_42380;
                bool empty_slice_42382 = cond_37749 || p_and_eq_x_y_42381;
                bool ok_or_empty_42383 = forwards_ok_42379 || empty_slice_42382;
                bool index_certs_42384;
                
                if (!ok_or_empty_42383) {
                    set_error(ctx, msgprintf("Error: %s%lld%s%lld%s\n\nBacktrace:\n%s", "Index [:", (long long) m_42373, "] out of bounds for array of shape [", (long long) part_no_22873, "].", "-> #0  /prelude/soacs.fut:258:29-35\n   #1  /prelude/functional.fut:9:44-45\n   #2  ft_libs/ftDBSCAN_plus.fut:845:18-847:57\n   #3  ft_libs/ftDBSCAN_plus.fut:844:9-847:67\n"));
                    err = FUTHARK_PROGRAM_ERROR;
                    goto cleanup;
                }
                
                int64_t bytes_49409 = (int64_t) 8 * m_42373;
                bool y_42397 = slt64((int64_t) 0, m_42373);
                bool index_certs_42398;
                
                if (!y_42397) {
                    set_error(ctx, msgprintf("Error: %s%lld%s%lld%s\n\nBacktrace:\n%s", "Index [", (long long) (int64_t) 0, "] out of bounds for array of shape [", (long long) m_42373, "].", "-> #0  ft_libs/ftDBSCAN_plus.fut:239:44-56\n   #1  ft_libs/ftDBSCAN_plus.fut:845:18-847:57\n   #2  ft_libs/ftDBSCAN_plus.fut:844:9-847:67\n"));
                    err = FUTHARK_PROGRAM_ERROR;
                    goto cleanup;
                }
                if (memblock_alloc_device(ctx, &mem_49410, bytes_49409, "mem_49410")) {
                    err = 1;
                    goto cleanup;
                }
                if (futrts_builtinzhiota_i64(ctx, mem_49410, m_42373, (int64_t) 0, (int64_t) 1) != 0) {
                    err = 1;
                    goto cleanup;
                }
                
                int64_t segmap_tblock_sizze_42837;
                
                segmap_tblock_sizze_42837 = *ctx->tuning_params.next_partition_to_read_doublezisegmap_tblock_sizze_42836;
                
                int64_t num_tblocks_42839;
                int64_t max_num_tblocks_50393;
                
                max_num_tblocks_50393 = *ctx->tuning_params.next_partition_to_read_doublezisegmap_num_tblocks_42838;
                num_tblocks_42839 = sext_i64_i32(smax64((int64_t) 1, smin64(sdiv_up64(part_no_22873, segmap_tblock_sizze_42837), max_num_tblocks_50393)));
                if (ctx->debugging)
                    fprintf(ctx->log, "%s\n", "\n# SegMap");
                
                int32_t virt_num_tblocks_50394 = sext_i64_i32(sdiv_up64(part_no_22873, segmap_tblock_sizze_42837));
                
                {
                    err = gpu_kernel_next_partition_to_read_doublezisegmap_42834(ctx, num_tblocks_42839, 1, 1, *ctx->tuning_params.next_partition_to_read_doublezisegmap_tblock_sizze_42836, 1, 1, (int64_t) 0, part_no_22873, m_42373, num_tblocks_42839, virt_num_tblocks_50394, mem_49406.mem, mem_49408.mem, mem_49410.mem);
                    if (err != FUTHARK_SUCCESS)
                        goto cleanup;
                }
                if (ctx->debugging)
                    fprintf(ctx->log, "%s\n", "");
                if (memblock_unref_device(ctx, &mem_49406, "mem_49406") != 0)
                    return 1;
                if (memblock_unref_device(ctx, &mem_49408, "mem_49408") != 0)
                    return 1;
                if (memblock_alloc_device(ctx, &mem_49412, (int64_t) 8, "mem_49412")) {
                    err = 1;
                    goto cleanup;
                }
                {
                    err = gpu_kernel_next_partition_to_read_doublezigpuseq_50407(ctx, (int64_t) 1, 1, 1, (int64_t) 1, 1, 1, (int64_t) 0, mem_49410.mem, mem_49412.mem);
                    if (err != FUTHARK_SUCCESS)
                        goto cleanup;
                }
                if (memblock_unref_device(ctx, &mem_49410, "mem_49410") != 0)
                    return 1;
                if (memblock_set_device(ctx, &ext_mem_49413, &mem_49412, "mem_49412") != 0)
                    return 1;
            } else {
                if (memblock_alloc_device(ctx, &mem_49403, (int64_t) 8, "mem_49403")) {
                    err = 1;
                    goto cleanup;
                }
                if (futrts_builtinzhreplicate_i64(ctx, mem_49403, (int64_t) 1, (int64_t) -1) != 0) {
                    err = 1;
                    goto cleanup;
                }
                if (memblock_set_device(ctx, &ext_mem_49413, &mem_49403, "mem_49403") != 0)
                    return 1;
            }
            if (memblock_set_device(ctx, &ext_mem_49415, &ext_mem_49413, "ext_mem_49413") != 0)
                return 1;
        }
        
        int64_t read_res_52232;
        
        if ((err = gpu_scalar_from_device(ctx, &read_res_52232, ext_mem_49415.mem, (int64_t) 0 * sizeof(int64_t), sizeof(int64_t))) != 0)
            goto cleanup;
        if (ctx->failure_is_an_option && futhark_context_sync(ctx) != 0) {
            err = 1;
            goto cleanup;
        }
        
        int64_t next_partition_to_read_res_f_res_37736 = read_res_52232;
        
        if (memblock_unref_device(ctx, &ext_mem_49415, "ext_mem_49415") != 0)
            return 1;
        next_partition_to_read_res_37734 = next_partition_to_read_res_f_res_37736;
    }
    prim_out_50191 = next_partition_to_read_res_37734;
    *out_prim_out_52229 = prim_out_50191;
    
  cleanup:
    {
        if (memblock_unref_device(ctx, &mem_49403, "mem_49403") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49412, "mem_49412") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49410, "mem_49410") != 0)
            return 1;
        if (memblock_unref_device(ctx, &incprefixes_mem_50285, "incprefixes_mem_50285") != 0)
            return 1;
        if (memblock_unref_device(ctx, &aggregates_mem_50283, "aggregates_mem_50283") != 0)
            return 1;
        if (memblock_unref_device(ctx, &status_flags_mem_50261, "status_flags_mem_50261") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49408, "mem_49408") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49406, "mem_49406") != 0)
            return 1;
        if (memblock_unref_device(ctx, &ext_mem_49413, "ext_mem_49413") != 0)
            return 1;
        if (memblock_unref_device(ctx, &segred_tmp_mem_50223, "segred_tmp_mem_50223") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49402, "mem_49402") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49414, "mem_49414") != 0)
            return 1;
        if (memblock_unref_device(ctx, &ext_mem_49415, "ext_mem_49415") != 0)
            return 1;
    }
    return err;
}
FUTHARK_FUN_ATTR int futrts_entry_rectify_partition_ids_double(struct futhark_context *ctx, struct memblock_device *mem_out_p_52233, struct memblock_device partition_ids_mem_49374, struct memblock_device chain_id_mem_49375, struct memblock_device replaceWith_mem_49376, int64_t n_35911, int64_t dz2081Uz2080U_35912, int64_t dz2081Uz2081U_35913, int64_t m_sizze_35917)
{
    (void) ctx;
    
    int err = 0;
    struct memblock_device mem_49378;
    
    mem_49378.references = NULL;
    
    struct memblock_device mem_out_50191;
    
    mem_out_50191.references = NULL;
    
    struct memblock_device counters_mem_50201 = ctx->constants->counters_mem_50201;
    struct memblock_device counters_mem_50275 = ctx->constants->counters_mem_50275;
    struct memblock_device counters_mem_50707 = ctx->constants->counters_mem_50707;
    struct memblock_device counters_mem_51122 = ctx->constants->counters_mem_51122;
    struct memblock_device counters_mem_51145 = ctx->constants->counters_mem_51145;
    struct memblock_device counters_mem_51184 = ctx->constants->counters_mem_51184;
    struct memblock_device counters_mem_51873 = ctx->constants->counters_mem_51873;
    struct memblock_device counters_mem_52032 = ctx->constants->counters_mem_52032;
    struct memblock_device global_dynid_mem_50266 = ctx->constants->global_dynid_mem_50266;
    struct memblock_device global_dynid_mem_50275 = ctx->constants->global_dynid_mem_50275;
    struct memblock_device global_dynid_mem_50287 = ctx->constants->global_dynid_mem_50287;
    struct memblock_device global_dynid_mem_50292 = ctx->constants->global_dynid_mem_50292;
    struct memblock_device global_dynid_mem_50450 = ctx->constants->global_dynid_mem_50450;
    struct memblock_device global_dynid_mem_50529 = ctx->constants->global_dynid_mem_50529;
    struct memblock_device global_dynid_mem_50570 = ctx->constants->global_dynid_mem_50570;
    struct memblock_device global_dynid_mem_50733 = ctx->constants->global_dynid_mem_50733;
    struct memblock_device global_dynid_mem_50769 = ctx->constants->global_dynid_mem_50769;
    struct memblock_device global_dynid_mem_50871 = ctx->constants->global_dynid_mem_50871;
    struct memblock_device global_dynid_mem_50875 = ctx->constants->global_dynid_mem_50875;
    struct memblock_device global_dynid_mem_50988 = ctx->constants->global_dynid_mem_50988;
    struct memblock_device global_dynid_mem_51231 = ctx->constants->global_dynid_mem_51231;
    struct memblock_device global_dynid_mem_51378 = ctx->constants->global_dynid_mem_51378;
    struct memblock_device global_dynid_mem_51534 = ctx->constants->global_dynid_mem_51534;
    struct memblock_device global_dynid_mem_51651 = ctx->constants->global_dynid_mem_51651;
    bool zzero_37690 = dz2081Uz2080U_35912 == (int64_t) 0;
    bool nonzzero_37691 = !zzero_37690;
    bool nonzzero_cert_37692;
    
    if (!nonzzero_37691) {
        set_error(ctx, msgprintf("Error: %s\n\nBacktrace:\n%s", "division by zero", "-> #0  ft_libs/ftDBSCAN_plus.fut:800:56-61\n   #1  ft_libs/ftDBSCAN_plus.fut:875:18-878:84\n   #2  ft_libs/ftDBSCAN_plus.fut:873:9-878:84\n"));
        err = FUTHARK_PROGRAM_ERROR;
        goto cleanup;
    }
    
    int64_t max_arg1_37693 = sdiv64(m_sizze_35917, dz2081Uz2080U_35912);
    int64_t max_res_37694 = smax64((int64_t) 1, max_arg1_37693);
    int64_t zm_lhs_37695 = add64(n_35911, max_res_37694);
    int64_t zs_lhs_37696 = sub64(zm_lhs_37695, (int64_t) 1);
    bool zzero_37697 = max_res_37694 == (int64_t) 0;
    bool nonzzero_37698 = !zzero_37697;
    bool nonzzero_cert_37699;
    
    if (!nonzzero_37698) {
        set_error(ctx, msgprintf("Error: %s\n\nBacktrace:\n%s", "division by zero", "-> #0  ft_libs/ftDBSCAN_plus.fut:801:57-65\n   #1  ft_libs/ftDBSCAN_plus.fut:875:18-878:84\n   #2  ft_libs/ftDBSCAN_plus.fut:873:9-878:84\n"));
        err = FUTHARK_PROGRAM_ERROR;
        goto cleanup;
    }
    
    int64_t num_iter_37700 = sdiv64(zs_lhs_37696, max_res_37694);
    bool dim_match_37701 = dz2081Uz2080U_35912 == dz2081Uz2081U_35913;
    bool empty_or_match_cert_37702;
    
    if (!dim_match_37701) {
        set_error(ctx, msgprintf("Error: %s%lld%s%lld%s\n\nBacktrace:\n%s", "Value of (desugared) shape [", (long long) dz2081Uz2081U_35913, "] cannot match shape of type `[", (long long) dz2081Uz2080U_35912, "]i64`.", "-> #0  ft_libs/ftDBSCAN_plus.fut:802:69-99\n   #1  ft_libs/ftDBSCAN_plus.fut:875:18-878:84\n   #2  ft_libs/ftDBSCAN_plus.fut:873:9-878:84\n"));
        err = FUTHARK_PROGRAM_ERROR;
        goto cleanup;
    }
    
    int64_t bytes_49377 = (int64_t) 8 * n_35911;
    bool bounds_invalid_upwards_37705 = slt64(num_iter_37700, (int64_t) 0);
    bool valid_37706 = !bounds_invalid_upwards_37705;
    bool range_valid_c_37707;
    
    if (!valid_37706) {
        set_error(ctx, msgprintf("Error: %s%lld%s%lld%s%lld%s\n\nBacktrace:\n%s", "Range ", (long long) (int64_t) 0, "..", (long long) (int64_t) 1, "..<", (long long) num_iter_37700, " is invalid.", "-> #0  /prelude/array.fut:94:3-11\n   #1  ft_libs/ftDBSCAN_plus.fut:804:80-93\n   #2  ft_libs/ftDBSCAN_plus.fut:875:18-878:84\n   #3  ft_libs/ftDBSCAN_plus.fut:873:9-878:84\n"));
        err = FUTHARK_PROGRAM_ERROR;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_49378, bytes_49377, "mem_49378")) {
        err = 1;
        goto cleanup;
    }
    if ((err = lmad_copy_gpu2gpu_8b(ctx, 1, mem_49378.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, partition_ids_mem_49374.mem, (int64_t) 0, (int64_t []) {(int64_t) 1}, (int64_t []) {n_35911})) != 0)
        goto cleanup;
    
    int64_t tile_sizze_46781;
    
    tile_sizze_46781 = *ctx->tuning_params.rectify_partition_ids_doublezitile_sizze_46780;
    
    int64_t tile_sizze_46537;
    
    tile_sizze_46537 = *ctx->tuning_params.rectify_partition_ids_doublezitile_sizze_46536;
    
    int64_t num_whole_tiles_46797 = squot_safe64(dz2081Uz2080U_35912, tile_sizze_46781);
    int64_t residual_input_46944 = srem_safe64(dz2081Uz2080U_35912, tile_sizze_46781);
    bool cond_46945 = residual_input_46944 == (int64_t) 0;
    int64_t binop_x_46958 = tile_sizze_46781 * num_whole_tiles_46797;
    int64_t bytes_49397 = (int64_t) 8 * tile_sizze_46781;
    int64_t num_whole_tiles_46553 = squot_safe64(dz2081Uz2080U_35912, tile_sizze_46537);
    int64_t residual_input_46700 = srem_safe64(dz2081Uz2080U_35912, tile_sizze_46537);
    bool cond_46701 = residual_input_46700 == (int64_t) 0;
    int64_t binop_x_46714 = tile_sizze_46537 * num_whole_tiles_46553;
    int64_t bytes_49437 = (int64_t) 8 * tile_sizze_46537;
    
    for (int64_t i_37709 = 0; i_37709 < num_iter_37700; i_37709++) {
        int64_t inf_37711 = mul64(max_res_37694, i_37709);
        int64_t min_arg0_37712 = add64(max_res_37694, inf_37711);
        int64_t min_res_37713 = smin64(n_35911, min_arg0_37712);
        int64_t dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_37714 = sub64(min_res_37713, inf_37711);
        bool empty_slice_37715 = dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_37714 == (int64_t) 0;
        int64_t m_37716 = sub64(dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_37714, (int64_t) 1);
        int64_t i_p_m_t_s_37717 = add64(inf_37711, m_37716);
        bool zzero_leq_i_p_m_t_s_37718 = sle64((int64_t) 0, i_p_m_t_s_37717);
        bool i_p_m_t_s_leq_w_37719 = slt64(i_p_m_t_s_37717, n_35911);
        bool zzero_lte_i_37720 = sle64((int64_t) 0, inf_37711);
        bool i_lte_j_37721 = sle64(inf_37711, min_res_37713);
        bool y_37722 = i_p_m_t_s_leq_w_37719 && zzero_lte_i_37720;
        bool y_37723 = zzero_leq_i_p_m_t_s_37718 && y_37722;
        bool forwards_ok_37724 = i_lte_j_37721 && y_37723;
        bool ok_or_empty_37725 = empty_slice_37715 || forwards_ok_37724;
        bool index_certs_37726;
        
        if (!ok_or_empty_37725) {
            set_error(ctx, msgprintf("Error: %s%lld%s%lld%s%lld%s\n\nBacktrace:\n%s", "Index [", (long long) inf_37711, ":", (long long) min_res_37713, "] out of bounds for array of shape [", (long long) n_35911, "].", "-> #0  ft_libs/ftDBSCAN_plus.fut:807:55-77\n   #1  ft_libs/ftDBSCAN_plus.fut:875:18-878:84\n   #2  ft_libs/ftDBSCAN_plus.fut:873:9-878:84\n"));
            err = FUTHARK_PROGRAM_ERROR;
            goto cleanup;
        }
        
        bool suff_outer_par_43005;
        
        suff_outer_par_43005 = *ctx->tuning_params.rectify_partition_ids_doublezisuff_outer_par_0 <= dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_37714;
        if (ctx->logging)
            fprintf(ctx->log, "Compared %s <= %ld: %s.\n", "rectify_partition_ids_double.suff_outer_par_0", (long) dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_37714, suff_outer_par_43005 ? "true" : "false");
        
        int64_t shared_memory_capacity_50235;
        
        shared_memory_capacity_50235 = ctx->max_shared_memory;
        if (suff_outer_par_43005 && sle64(sdiv_up64(bytes_49437, (int64_t) 8) * (int64_t) 8 + sdiv_up64(bytes_49437, (int64_t) 8) * (int64_t) 8, shared_memory_capacity_50235)) {
            int64_t ldim_46538 = sdiv_up64(dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_37714, tile_sizze_46537);
            
            if (ctx->debugging)
                fprintf(ctx->log, "%s\n", "\n# SegMap");
            
            int32_t num_chunks_50193 = sext_i64_i32(sdiv_up64(tile_sizze_46537, tile_sizze_46537));
            int32_t virt_num_tblocks_50194 = sext_i64_i32(ldim_46538);
            
            {
                err = gpu_kernel_rectify_partition_ids_doublezisegmap_intrablock_46535(ctx, ldim_46538, 1, 1, *ctx->tuning_params.rectify_partition_ids_doublezitile_sizze_46536, 1, 1, bytes_49437 + srem64((int64_t) 8 - srem64(bytes_49437, (int64_t) 8), (int64_t) 8) + (bytes_49437 + srem64((int64_t) 8 - srem64(bytes_49437, (int64_t) 8), (int64_t) 8)), dz2081Uz2080U_35912, inf_37711, dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_37714, ldim_46538, num_whole_tiles_46553, residual_input_46700, cond_46701, binop_x_46714, partition_ids_mem_49374.mem, chain_id_mem_49375.mem, replaceWith_mem_49376.mem, mem_49378.mem);
                if (err != FUTHARK_SUCCESS)
                    goto cleanup;
            }
            if (ctx->debugging)
                fprintf(ctx->log, "%s\n", "");
        } else {
            int64_t ldim_46782 = sdiv_up64(dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_37714, tile_sizze_46781);
            
            if (ctx->debugging)
                fprintf(ctx->log, "%s\n", "\n# SegMap");
            
            int32_t num_chunks_50214 = sext_i64_i32(sdiv_up64(tile_sizze_46781, tile_sizze_46781));
            int32_t virt_num_tblocks_50215 = sext_i64_i32(ldim_46782);
            
            {
                err = gpu_kernel_rectify_partition_ids_doublezisegmap_intrablock_46779(ctx, ldim_46782, 1, 1, *ctx->tuning_params.rectify_partition_ids_doublezitile_sizze_46780, 1, 1, bytes_49397 + srem64((int64_t) 8 - srem64(bytes_49397, (int64_t) 8), (int64_t) 8) + (bytes_49397 + srem64((int64_t) 8 - srem64(bytes_49397, (int64_t) 8), (int64_t) 8)), dz2081Uz2080U_35912, inf_37711, dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_37714, ldim_46782, num_whole_tiles_46797, residual_input_46944, cond_46945, binop_x_46958, partition_ids_mem_49374.mem, chain_id_mem_49375.mem, replaceWith_mem_49376.mem, mem_49378.mem);
                if (err != FUTHARK_SUCCESS)
                    goto cleanup;
            }
            if (ctx->debugging)
                fprintf(ctx->log, "%s\n", "");
        }
    }
    if (memblock_set_device(ctx, &mem_out_50191, &mem_49378, "mem_49378") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_52233, &mem_out_50191, "mem_out_50191") != 0)
        return 1;
    
  cleanup:
    {
        if (memblock_unref_device(ctx, &mem_49378, "mem_49378") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_50191, "mem_out_50191") != 0)
            return 1;
    }
    return err;
}
FUTHARK_FUN_ATTR int futrts_get_num_neighbours_against_9632(struct futhark_context *ctx, struct memblock_device *mem_out_p_52234, struct memblock_device dat1_mem_49374, struct memblock_device dat1_mem_49375, struct memblock_device dat2_mem_49376, struct memblock_device dat2_mem_49377, int64_t n1_28207, int64_t n2_28208, double eps_28213, int8_t dist_t_28214, int8_t angle_t_28215, double radius_28216, int64_t m_sizze_28217)
{
    (void) ctx;
    
    int err = 0;
    struct memblock_device segred_tmp_mem_50273;
    
    segred_tmp_mem_50273.references = NULL;
    
    struct memblock_device mem_49389;
    
    mem_49389.references = NULL;
    
    struct memblock_device mem_49387;
    
    mem_49387.references = NULL;
    
    struct memblock_device mem_49385;
    
    mem_49385.references = NULL;
    
    struct memblock_device mem_49379;
    
    mem_49379.references = NULL;
    
    struct memblock_device mem_out_50191;
    
    mem_out_50191.references = NULL;
    
    struct memblock_device counters_mem_50201 = ctx->constants->counters_mem_50201;
    struct memblock_device counters_mem_50275 = ctx->constants->counters_mem_50275;
    struct memblock_device counters_mem_50707 = ctx->constants->counters_mem_50707;
    struct memblock_device counters_mem_51122 = ctx->constants->counters_mem_51122;
    struct memblock_device counters_mem_51145 = ctx->constants->counters_mem_51145;
    struct memblock_device counters_mem_51184 = ctx->constants->counters_mem_51184;
    struct memblock_device counters_mem_51873 = ctx->constants->counters_mem_51873;
    struct memblock_device counters_mem_52032 = ctx->constants->counters_mem_52032;
    struct memblock_device global_dynid_mem_50266 = ctx->constants->global_dynid_mem_50266;
    struct memblock_device global_dynid_mem_50275 = ctx->constants->global_dynid_mem_50275;
    struct memblock_device global_dynid_mem_50287 = ctx->constants->global_dynid_mem_50287;
    struct memblock_device global_dynid_mem_50292 = ctx->constants->global_dynid_mem_50292;
    struct memblock_device global_dynid_mem_50450 = ctx->constants->global_dynid_mem_50450;
    struct memblock_device global_dynid_mem_50529 = ctx->constants->global_dynid_mem_50529;
    struct memblock_device global_dynid_mem_50570 = ctx->constants->global_dynid_mem_50570;
    struct memblock_device global_dynid_mem_50733 = ctx->constants->global_dynid_mem_50733;
    struct memblock_device global_dynid_mem_50769 = ctx->constants->global_dynid_mem_50769;
    struct memblock_device global_dynid_mem_50871 = ctx->constants->global_dynid_mem_50871;
    struct memblock_device global_dynid_mem_50875 = ctx->constants->global_dynid_mem_50875;
    struct memblock_device global_dynid_mem_50988 = ctx->constants->global_dynid_mem_50988;
    struct memblock_device global_dynid_mem_51231 = ctx->constants->global_dynid_mem_51231;
    struct memblock_device global_dynid_mem_51378 = ctx->constants->global_dynid_mem_51378;
    struct memblock_device global_dynid_mem_51534 = ctx->constants->global_dynid_mem_51534;
    struct memblock_device global_dynid_mem_51651 = ctx->constants->global_dynid_mem_51651;
    bool zzero_28218 = n2_28208 == (int64_t) 0;
    bool nonzzero_28219 = !zzero_28218;
    bool nonzzero_cert_28220;
    
    if (!nonzzero_28219) {
        set_error(ctx, msgprintf("Error: %s\n\nBacktrace:\n%s", "division by zero", "-> #0  ft_libs/ftDBSCAN_plus.fut:487:55-58\n"));
        err = FUTHARK_PROGRAM_ERROR;
        goto cleanup;
    }
    
    int64_t max_arg1_28221 = sdiv64(m_sizze_28217, n2_28208);
    int64_t max_res_35992 = smax64((int64_t) 1, max_arg1_28221);
    int64_t zm_lhs_28225 = add64(n1_28207, max_res_35992);
    int64_t zs_lhs_28227 = sub64(zm_lhs_28225, (int64_t) 1);
    bool zzero_28229 = max_res_35992 == (int64_t) 0;
    bool nonzzero_28230 = !zzero_28229;
    bool nonzzero_cert_28231;
    
    if (!nonzzero_28230) {
        set_error(ctx, msgprintf("Error: %s\n\nBacktrace:\n%s", "division by zero", "-> #0  ft_libs/ftDBSCAN_plus.fut:488:57-64\n"));
        err = FUTHARK_PROGRAM_ERROR;
        goto cleanup;
    }
    
    int64_t num_iter_28232 = sdiv64(zs_lhs_28227, max_res_35992);
    int64_t bytes_49378 = (int64_t) 8 * n1_28207;
    bool bounds_invalid_upwards_35994 = slt64(num_iter_28232, (int64_t) 0);
    bool valid_35995 = !bounds_invalid_upwards_35994;
    bool range_valid_c_35996;
    
    if (!valid_35995) {
        set_error(ctx, msgprintf("Error: %s%lld%s%lld%s%lld%s\n\nBacktrace:\n%s", "Range ", (long long) (int64_t) 0, "..", (long long) (int64_t) 1, "..<", (long long) num_iter_28232, " is invalid.", "-> #0  /prelude/array.fut:94:3-11\n   #1  ft_libs/ftDBSCAN_plus.fut:489:69-82\n"));
        err = FUTHARK_PROGRAM_ERROR;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_49379, bytes_49378, "mem_49379")) {
        err = 1;
        goto cleanup;
    }
    if (futrts_builtinzhreplicate_i64(ctx, mem_49379, n1_28207, (int64_t) 0) != 0) {
        err = 1;
        goto cleanup;
    }
    
    int64_t segmap_tblock_sizze_46127;
    
    segmap_tblock_sizze_46127 = *ctx->tuning_params.get_num_neighbours_against_9632zisegmap_tblock_sizze_46112;
    
    int64_t segred_tblock_sizze_46145;
    
    segred_tblock_sizze_46145 = *ctx->tuning_params.get_num_neighbours_against_9632zisegred_tblock_sizze_46062;
    
    int64_t tile_sizze_46537;
    
    tile_sizze_46537 = *ctx->tuning_params.get_num_neighbours_against_9632zitile_sizze_46536;
    
    bool match_val_49347 = dist_t_28214 == (int8_t) 0;
    bool x_49348 = !match_val_49347;
    int64_t num_whole_tiles_46582 = squot_safe64(n2_28208, tile_sizze_46537);
    int64_t residual_input_46771 = srem_safe64(n2_28208, tile_sizze_46537);
    bool cond_46772 = residual_input_46771 == (int64_t) 0;
    int64_t binop_x_46785 = tile_sizze_46537 * num_whole_tiles_46582;
    int64_t bytes_49419 = (int64_t) 8 * tile_sizze_46537;
    
    for (int64_t i_28238 = 0; i_28238 < num_iter_28232; i_28238++) {
        int64_t inf_28241 = mul64(i_28238, max_res_35992);
        int64_t min_arg1_28243 = add64(inf_28241, max_res_35992);
        int64_t min_res_36004 = smin64(n1_28207, min_arg1_28243);
        int64_t dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_28247 = sub64(min_res_36004, inf_28241);
        bool empty_slice_28259 = dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_28247 == (int64_t) 0;
        int64_t m_28260 = sub64(dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_28247, (int64_t) 1);
        int64_t i_p_m_t_s_28262 = add64(inf_28241, m_28260);
        bool zzero_leq_i_p_m_t_s_28263 = sle64((int64_t) 0, i_p_m_t_s_28262);
        bool i_p_m_t_s_leq_w_28265 = slt64(i_p_m_t_s_28262, n1_28207);
        bool zzero_lte_i_28266 = sle64((int64_t) 0, inf_28241);
        bool i_lte_j_28267 = sle64(inf_28241, min_res_36004);
        bool y_28268 = i_p_m_t_s_leq_w_28265 && zzero_lte_i_28266;
        bool y_28269 = zzero_leq_i_p_m_t_s_28263 && y_28268;
        bool forwards_ok_28270 = i_lte_j_28267 && y_28269;
        bool ok_or_empty_28277 = empty_slice_28259 || forwards_ok_28270;
        bool index_certs_28279;
        
        if (!ok_or_empty_28277) {
            set_error(ctx, msgprintf("Error: %s%lld%s%lld%s%lld%s\n\nBacktrace:\n%s", "Index [", (long long) inf_28241, ":", (long long) min_res_36004, "] out of bounds for array of shape [", (long long) n1_28207, "].", "-> #0  ft_libs/ftDBSCAN_plus.fut:492:47-60\n"));
            err = FUTHARK_PROGRAM_ERROR;
            goto cleanup;
        }
        
        bool suff_outer_par_45957;
        
        suff_outer_par_45957 = *ctx->tuning_params.get_num_neighbours_against_9632zisuff_outer_par_0 <= dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_28247;
        if (ctx->logging)
            fprintf(ctx->log, "Compared %s <= %ld: %s.\n", "get_num_neighbours_against_9632.suff_outer_par_0", (long) dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_28247, suff_outer_par_45957 ? "true" : "false");
        
        int64_t nest_sizze_46144 = n2_28208 * dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_28247;
        int64_t num_tblocks_46146;
        int64_t max_num_tblocks_50213;
        
        max_num_tblocks_50213 = *ctx->tuning_params.get_num_neighbours_against_9632zisegred_num_tblocks_46064;
        num_tblocks_46146 = sext_i64_i32(smax64((int64_t) 1, smin64(sdiv_up64(nest_sizze_46144, segred_tblock_sizze_46145), max_num_tblocks_50213)));
        
        int64_t bytes_49384 = (int64_t) 8 * dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_28247;
        int64_t shared_memory_capacity_50332;
        
        shared_memory_capacity_50332 = ctx->max_shared_memory;
        if (suff_outer_par_45957 && sle64(sdiv_up64(bytes_49419, (int64_t) 8) * (int64_t) 8 + sdiv_up64(bytes_49419, (int64_t) 8) * (int64_t) 8, shared_memory_capacity_50332)) {
            int64_t ldim_46538 = sdiv_up64(dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_28247, tile_sizze_46537);
            
            if (ctx->debugging)
                fprintf(ctx->log, "%s\n", "\n# SegMap");
            
            int32_t num_chunks_50214 = sext_i64_i32(sdiv_up64(tile_sizze_46537, tile_sizze_46537));
            int32_t virt_num_tblocks_50215 = sext_i64_i32(ldim_46538);
            
            {
                err = gpu_kernel_get_num_neighbours_against_9632zisegmap_intrablock_46535(ctx, ldim_46538, 1, 1, *ctx->tuning_params.get_num_neighbours_against_9632zitile_sizze_46536, 1, 1, bytes_49419 + srem64((int64_t) 8 - srem64(bytes_49419, (int64_t) 8), (int64_t) 8) + (bytes_49419 + srem64((int64_t) 8 - srem64(bytes_49419, (int64_t) 8), (int64_t) 8)), n2_28208, eps_28213, dist_t_28214, angle_t_28215, radius_28216, inf_28241, dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_28247, ldim_46538, num_whole_tiles_46582, residual_input_46771, cond_46772, binop_x_46785, dat1_mem_49374.mem, dat1_mem_49375.mem, dat2_mem_49376.mem, dat2_mem_49377.mem, mem_49379.mem);
                if (err != FUTHARK_SUCCESS)
                    goto cleanup;
            }
            if (ctx->debugging)
                fprintf(ctx->log, "%s\n", "");
        } else {
            int64_t segmap_usable_groups_46128 = sdiv_up64(dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_28247, segmap_tblock_sizze_46127);
            
            if (memblock_alloc_device(ctx, &mem_49385, bytes_49384, "mem_49385")) {
                err = 1;
                goto cleanup;
            }
            if (memblock_alloc_device(ctx, &mem_49387, bytes_49384, "mem_49387")) {
                err = 1;
                goto cleanup;
            }
            if (memblock_alloc_device(ctx, &mem_49389, bytes_49384, "mem_49389")) {
                err = 1;
                goto cleanup;
            }
            if (ctx->debugging)
                fprintf(ctx->log, "%s\n", "\n# SegMap");
            
            int32_t virt_num_tblocks_50231 = sext_i64_i32(sdiv_up64(dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_28247, segmap_tblock_sizze_46127));
            
            {
                err = gpu_kernel_get_num_neighbours_against_9632zisegmap_46133(ctx, segmap_usable_groups_46128, 1, 1, *ctx->tuning_params.get_num_neighbours_against_9632zisegmap_tblock_sizze_46112, 1, 1, (int64_t) 0, angle_t_28215, inf_28241, dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_28247, dat1_mem_49374.mem, dat1_mem_49375.mem, mem_49385.mem, mem_49387.mem, mem_49389.mem);
                if (err != FUTHARK_SUCCESS)
                    goto cleanup;
            }
            if (ctx->debugging)
                fprintf(ctx->log, "%s\n", "");
            if (ctx->debugging)
                fprintf(ctx->log, "%s\n", "\n# SegRed");
            
            int64_t chunk_sizze_50240 = (int64_t) 1;
            
            if (slt64(n2_28208 * (int64_t) 2, segred_tblock_sizze_46145 * chunk_sizze_50240)) {
                int64_t segment_sizze_nonzzero_50241 = smax64((int64_t) 1, n2_28208);
                int64_t num_threads_50242 = segred_tblock_sizze_46145 * segred_tblock_sizze_46145;
                
                if (ctx->debugging)
                    fprintf(ctx->log, "%s\n", "# SegRed-small");
                if (ctx->debugging)
                    fprintf(ctx->log, "%s: %llu%c", "num_segments", (long long) dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_28247, '\n');
                if (ctx->debugging)
                    fprintf(ctx->log, "%s: %llu%c", "segment_size", (long long) n2_28208, '\n');
                if (ctx->debugging)
                    fprintf(ctx->log, "%s: %llu%c", "segments_per_block", (long long) squot64(segred_tblock_sizze_46145, segment_sizze_nonzzero_50241), '\n');
                if (ctx->debugging)
                    fprintf(ctx->log, "%s: %llu%c", "required_blocks", (long long) sext_i64_i32(sdiv_up64(dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_28247, squot64(segred_tblock_sizze_46145, segment_sizze_nonzzero_50241))), '\n');
                {
                    err = gpu_kernel_get_num_neighbours_against_9632zisegred_small_46151(ctx, num_tblocks_46146, 1, 1, *ctx->tuning_params.get_num_neighbours_against_9632zisegred_tblock_sizze_46062, 1, 1, (int64_t) 8 * segred_tblock_sizze_46145 + srem64((int64_t) 8 - srem64((int64_t) 8 * segred_tblock_sizze_46145, (int64_t) 8), (int64_t) 8), n2_28208, eps_28213, dist_t_28214, angle_t_28215, radius_28216, inf_28241, dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_28247, num_tblocks_46146, x_49348, segment_sizze_nonzzero_50241, dat1_mem_49374.mem, dat1_mem_49375.mem, dat2_mem_49376.mem, dat2_mem_49377.mem, mem_49379.mem, mem_49385.mem, mem_49387.mem, mem_49389.mem);
                    if (err != FUTHARK_SUCCESS)
                        goto cleanup;
                }
            } else {
                int64_t blocks_per_segment_50269 = sdiv_up64(num_tblocks_46146, smax64((int64_t) 1, dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_28247));
                int64_t q_50270 = sdiv_up64(n2_28208, segred_tblock_sizze_46145 * blocks_per_segment_50269 * chunk_sizze_50240);
                int64_t num_virtblocks_50271 = blocks_per_segment_50269 * dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_28247;
                int64_t threads_per_segment_50272 = blocks_per_segment_50269 * segred_tblock_sizze_46145;
                
                if (ctx->debugging)
                    fprintf(ctx->log, "%s\n", "# SegRed-large");
                if (ctx->debugging)
                    fprintf(ctx->log, "%s: %llu%c", "num_segments", (long long) dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_28247, '\n');
                if (ctx->debugging)
                    fprintf(ctx->log, "%s: %llu%c", "segment_size", (long long) n2_28208, '\n');
                if (ctx->debugging)
                    fprintf(ctx->log, "%s: %llu%c", "num_virtblocks", (long long) num_virtblocks_50271, '\n');
                if (ctx->debugging)
                    fprintf(ctx->log, "%s: %llu%c", "num_tblocks", (long long) num_tblocks_46146, '\n');
                if (ctx->debugging)
                    fprintf(ctx->log, "%s: %llu%c", "tblock_size", (long long) segred_tblock_sizze_46145, '\n');
                if (ctx->debugging)
                    fprintf(ctx->log, "%s: %llu%c", "q", (long long) q_50270, '\n');
                if (ctx->debugging)
                    fprintf(ctx->log, "%s: %llu%c", "blocks_per_segment", (long long) blocks_per_segment_50269, '\n');
                if (memblock_alloc_device(ctx, &segred_tmp_mem_50273, (int64_t) 8 * num_virtblocks_50271, "segred_tmp_mem_50273")) {
                    err = 1;
                    goto cleanup;
                }
                {
                    err = gpu_kernel_get_num_neighbours_against_9632zisegred_large_46151(ctx, num_tblocks_46146, 1, 1, *ctx->tuning_params.get_num_neighbours_against_9632zisegred_tblock_sizze_46062, 1, 1, 8 + ((int64_t) 8 * segred_tblock_sizze_46145 + srem64((int64_t) 8 - srem64((int64_t) 8 * segred_tblock_sizze_46145, (int64_t) 8), (int64_t) 8)), n2_28208, eps_28213, dist_t_28214, angle_t_28215, radius_28216, inf_28241, dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_28247, num_tblocks_46146, x_49348, blocks_per_segment_50269, q_50270, num_virtblocks_50271, threads_per_segment_50272, dat1_mem_49374.mem, dat1_mem_49375.mem, dat2_mem_49376.mem, dat2_mem_49377.mem, mem_49379.mem, mem_49385.mem, mem_49387.mem, mem_49389.mem, segred_tmp_mem_50273.mem, counters_mem_50275.mem);
                    if (err != FUTHARK_SUCCESS)
                        goto cleanup;
                }
            }
            if (ctx->debugging)
                fprintf(ctx->log, "%s\n", "");
            if (memblock_unref_device(ctx, &mem_49385, "mem_49385") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_49387, "mem_49387") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_49389, "mem_49389") != 0)
                return 1;
        }
    }
    if (memblock_set_device(ctx, &mem_out_50191, &mem_49379, "mem_49379") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_52234, &mem_out_50191, "mem_out_50191") != 0)
        return 1;
    
  cleanup:
    {
        if (memblock_unref_device(ctx, &segred_tmp_mem_50273, "segred_tmp_mem_50273") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49389, "mem_49389") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49387, "mem_49387") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49385, "mem_49385") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49379, "mem_49379") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_50191, "mem_out_50191") != 0)
            return 1;
    }
    return err;
}
FUTHARK_FUN_ATTR int futrts_get_num_neighbours_against_9635(struct futhark_context *ctx, struct memblock_device *mem_out_p_52235, struct memblock_device dat1_mem_49374, struct memblock_device dat1_mem_49375, struct memblock_device dat2_mem_49376, struct memblock_device dat2_mem_49377, int64_t n1_28464, int64_t n2_28465, double eps_28470, int8_t dist_t_28471, int8_t angle_t_28472, double radius_28473, int64_t m_sizze_28474)
{
    (void) ctx;
    
    int err = 0;
    struct memblock_device segred_tmp_mem_50273;
    
    segred_tmp_mem_50273.references = NULL;
    
    struct memblock_device mem_49389;
    
    mem_49389.references = NULL;
    
    struct memblock_device mem_49387;
    
    mem_49387.references = NULL;
    
    struct memblock_device mem_49385;
    
    mem_49385.references = NULL;
    
    struct memblock_device mem_49379;
    
    mem_49379.references = NULL;
    
    struct memblock_device mem_out_50191;
    
    mem_out_50191.references = NULL;
    
    struct memblock_device counters_mem_50201 = ctx->constants->counters_mem_50201;
    struct memblock_device counters_mem_50275 = ctx->constants->counters_mem_50275;
    struct memblock_device counters_mem_50707 = ctx->constants->counters_mem_50707;
    struct memblock_device counters_mem_51122 = ctx->constants->counters_mem_51122;
    struct memblock_device counters_mem_51145 = ctx->constants->counters_mem_51145;
    struct memblock_device counters_mem_51184 = ctx->constants->counters_mem_51184;
    struct memblock_device counters_mem_51873 = ctx->constants->counters_mem_51873;
    struct memblock_device counters_mem_52032 = ctx->constants->counters_mem_52032;
    struct memblock_device global_dynid_mem_50266 = ctx->constants->global_dynid_mem_50266;
    struct memblock_device global_dynid_mem_50275 = ctx->constants->global_dynid_mem_50275;
    struct memblock_device global_dynid_mem_50287 = ctx->constants->global_dynid_mem_50287;
    struct memblock_device global_dynid_mem_50292 = ctx->constants->global_dynid_mem_50292;
    struct memblock_device global_dynid_mem_50450 = ctx->constants->global_dynid_mem_50450;
    struct memblock_device global_dynid_mem_50529 = ctx->constants->global_dynid_mem_50529;
    struct memblock_device global_dynid_mem_50570 = ctx->constants->global_dynid_mem_50570;
    struct memblock_device global_dynid_mem_50733 = ctx->constants->global_dynid_mem_50733;
    struct memblock_device global_dynid_mem_50769 = ctx->constants->global_dynid_mem_50769;
    struct memblock_device global_dynid_mem_50871 = ctx->constants->global_dynid_mem_50871;
    struct memblock_device global_dynid_mem_50875 = ctx->constants->global_dynid_mem_50875;
    struct memblock_device global_dynid_mem_50988 = ctx->constants->global_dynid_mem_50988;
    struct memblock_device global_dynid_mem_51231 = ctx->constants->global_dynid_mem_51231;
    struct memblock_device global_dynid_mem_51378 = ctx->constants->global_dynid_mem_51378;
    struct memblock_device global_dynid_mem_51534 = ctx->constants->global_dynid_mem_51534;
    struct memblock_device global_dynid_mem_51651 = ctx->constants->global_dynid_mem_51651;
    bool zzero_28475 = n2_28465 == (int64_t) 0;
    bool nonzzero_28476 = !zzero_28475;
    bool nonzzero_cert_28477;
    
    if (!nonzzero_28476) {
        set_error(ctx, msgprintf("Error: %s\n\nBacktrace:\n%s", "division by zero", "-> #0  ft_libs/ftDBSCAN_plus.fut:487:55-58\n"));
        err = FUTHARK_PROGRAM_ERROR;
        goto cleanup;
    }
    
    int64_t max_arg1_28478 = sdiv64(m_sizze_28474, n2_28465);
    int64_t max_res_35992 = smax64((int64_t) 1, max_arg1_28478);
    int64_t zm_lhs_28482 = add64(n1_28464, max_res_35992);
    int64_t zs_lhs_28484 = sub64(zm_lhs_28482, (int64_t) 1);
    bool zzero_28486 = max_res_35992 == (int64_t) 0;
    bool nonzzero_28487 = !zzero_28486;
    bool nonzzero_cert_28488;
    
    if (!nonzzero_28487) {
        set_error(ctx, msgprintf("Error: %s\n\nBacktrace:\n%s", "division by zero", "-> #0  ft_libs/ftDBSCAN_plus.fut:488:57-64\n"));
        err = FUTHARK_PROGRAM_ERROR;
        goto cleanup;
    }
    
    int64_t num_iter_28489 = sdiv64(zs_lhs_28484, max_res_35992);
    int64_t bytes_49378 = (int64_t) 8 * n1_28464;
    bool bounds_invalid_upwards_35994 = slt64(num_iter_28489, (int64_t) 0);
    bool valid_35995 = !bounds_invalid_upwards_35994;
    bool range_valid_c_35996;
    
    if (!valid_35995) {
        set_error(ctx, msgprintf("Error: %s%lld%s%lld%s%lld%s\n\nBacktrace:\n%s", "Range ", (long long) (int64_t) 0, "..", (long long) (int64_t) 1, "..<", (long long) num_iter_28489, " is invalid.", "-> #0  /prelude/array.fut:94:3-11\n   #1  ft_libs/ftDBSCAN_plus.fut:489:69-82\n"));
        err = FUTHARK_PROGRAM_ERROR;
        goto cleanup;
    }
    if (memblock_alloc_device(ctx, &mem_49379, bytes_49378, "mem_49379")) {
        err = 1;
        goto cleanup;
    }
    if (futrts_builtinzhreplicate_i64(ctx, mem_49379, n1_28464, (int64_t) 0) != 0) {
        err = 1;
        goto cleanup;
    }
    
    int64_t segmap_tblock_sizze_46361;
    
    segmap_tblock_sizze_46361 = *ctx->tuning_params.get_num_neighbours_against_9635zisegmap_tblock_sizze_46346;
    
    int64_t segred_tblock_sizze_46379;
    
    segred_tblock_sizze_46379 = *ctx->tuning_params.get_num_neighbours_against_9635zisegred_tblock_sizze_46296;
    
    int64_t tile_sizze_46537;
    
    tile_sizze_46537 = *ctx->tuning_params.get_num_neighbours_against_9635zitile_sizze_46536;
    
    bool match_val_49347 = dist_t_28471 == (int8_t) 0;
    bool x_49348 = !match_val_49347;
    int64_t num_whole_tiles_46582 = squot_safe64(n2_28465, tile_sizze_46537);
    int64_t residual_input_46771 = srem_safe64(n2_28465, tile_sizze_46537);
    bool cond_46772 = residual_input_46771 == (int64_t) 0;
    int64_t binop_x_46785 = tile_sizze_46537 * num_whole_tiles_46582;
    int64_t bytes_49419 = (int64_t) 8 * tile_sizze_46537;
    
    for (int64_t i_28495 = 0; i_28495 < num_iter_28489; i_28495++) {
        int64_t inf_28498 = mul64(i_28495, max_res_35992);
        int64_t min_arg1_28500 = add64(inf_28498, max_res_35992);
        int64_t min_res_36004 = smin64(n1_28464, min_arg1_28500);
        int64_t dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_28504 = sub64(min_res_36004, inf_28498);
        bool empty_slice_28516 = dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_28504 == (int64_t) 0;
        int64_t m_28517 = sub64(dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_28504, (int64_t) 1);
        int64_t i_p_m_t_s_28519 = add64(inf_28498, m_28517);
        bool zzero_leq_i_p_m_t_s_28520 = sle64((int64_t) 0, i_p_m_t_s_28519);
        bool i_p_m_t_s_leq_w_28522 = slt64(i_p_m_t_s_28519, n1_28464);
        bool zzero_lte_i_28523 = sle64((int64_t) 0, inf_28498);
        bool i_lte_j_28524 = sle64(inf_28498, min_res_36004);
        bool y_28525 = i_p_m_t_s_leq_w_28522 && zzero_lte_i_28523;
        bool y_28526 = zzero_leq_i_p_m_t_s_28520 && y_28525;
        bool forwards_ok_28527 = i_lte_j_28524 && y_28526;
        bool ok_or_empty_28534 = empty_slice_28516 || forwards_ok_28527;
        bool index_certs_28536;
        
        if (!ok_or_empty_28534) {
            set_error(ctx, msgprintf("Error: %s%lld%s%lld%s%lld%s\n\nBacktrace:\n%s", "Index [", (long long) inf_28498, ":", (long long) min_res_36004, "] out of bounds for array of shape [", (long long) n1_28464, "].", "-> #0  ft_libs/ftDBSCAN_plus.fut:492:47-60\n"));
            err = FUTHARK_PROGRAM_ERROR;
            goto cleanup;
        }
        
        bool suff_outer_par_46191;
        
        suff_outer_par_46191 = *ctx->tuning_params.get_num_neighbours_against_9635zisuff_outer_par_0 <= dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_28504;
        if (ctx->logging)
            fprintf(ctx->log, "Compared %s <= %ld: %s.\n", "get_num_neighbours_against_9635.suff_outer_par_0", (long) dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_28504, suff_outer_par_46191 ? "true" : "false");
        
        int64_t nest_sizze_46378 = n2_28465 * dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_28504;
        int64_t num_tblocks_46380;
        int64_t max_num_tblocks_50213;
        
        max_num_tblocks_50213 = *ctx->tuning_params.get_num_neighbours_against_9635zisegred_num_tblocks_46298;
        num_tblocks_46380 = sext_i64_i32(smax64((int64_t) 1, smin64(sdiv_up64(nest_sizze_46378, segred_tblock_sizze_46379), max_num_tblocks_50213)));
        
        int64_t bytes_49384 = (int64_t) 8 * dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_28504;
        int64_t shared_memory_capacity_50332;
        
        shared_memory_capacity_50332 = ctx->max_shared_memory;
        if (suff_outer_par_46191 && sle64(sdiv_up64(bytes_49419, (int64_t) 8) * (int64_t) 8 + sdiv_up64(bytes_49419, (int64_t) 8) * (int64_t) 8, shared_memory_capacity_50332)) {
            int64_t ldim_46538 = sdiv_up64(dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_28504, tile_sizze_46537);
            
            if (ctx->debugging)
                fprintf(ctx->log, "%s\n", "\n# SegMap");
            
            int32_t num_chunks_50214 = sext_i64_i32(sdiv_up64(tile_sizze_46537, tile_sizze_46537));
            int32_t virt_num_tblocks_50215 = sext_i64_i32(ldim_46538);
            
            {
                err = gpu_kernel_get_num_neighbours_against_9635zisegmap_intrablock_46535(ctx, ldim_46538, 1, 1, *ctx->tuning_params.get_num_neighbours_against_9635zitile_sizze_46536, 1, 1, bytes_49419 + srem64((int64_t) 8 - srem64(bytes_49419, (int64_t) 8), (int64_t) 8) + (bytes_49419 + srem64((int64_t) 8 - srem64(bytes_49419, (int64_t) 8), (int64_t) 8)), n2_28465, eps_28470, dist_t_28471, angle_t_28472, radius_28473, inf_28498, dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_28504, ldim_46538, num_whole_tiles_46582, residual_input_46771, cond_46772, binop_x_46785, dat1_mem_49374.mem, dat1_mem_49375.mem, dat2_mem_49376.mem, dat2_mem_49377.mem, mem_49379.mem);
                if (err != FUTHARK_SUCCESS)
                    goto cleanup;
            }
            if (ctx->debugging)
                fprintf(ctx->log, "%s\n", "");
        } else {
            int64_t segmap_usable_groups_46362 = sdiv_up64(dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_28504, segmap_tblock_sizze_46361);
            
            if (memblock_alloc_device(ctx, &mem_49385, bytes_49384, "mem_49385")) {
                err = 1;
                goto cleanup;
            }
            if (memblock_alloc_device(ctx, &mem_49387, bytes_49384, "mem_49387")) {
                err = 1;
                goto cleanup;
            }
            if (memblock_alloc_device(ctx, &mem_49389, bytes_49384, "mem_49389")) {
                err = 1;
                goto cleanup;
            }
            if (ctx->debugging)
                fprintf(ctx->log, "%s\n", "\n# SegMap");
            
            int32_t virt_num_tblocks_50231 = sext_i64_i32(sdiv_up64(dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_28504, segmap_tblock_sizze_46361));
            
            {
                err = gpu_kernel_get_num_neighbours_against_9635zisegmap_46367(ctx, segmap_usable_groups_46362, 1, 1, *ctx->tuning_params.get_num_neighbours_against_9635zisegmap_tblock_sizze_46346, 1, 1, (int64_t) 0, angle_t_28472, inf_28498, dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_28504, dat1_mem_49374.mem, dat1_mem_49375.mem, mem_49385.mem, mem_49387.mem, mem_49389.mem);
                if (err != FUTHARK_SUCCESS)
                    goto cleanup;
            }
            if (ctx->debugging)
                fprintf(ctx->log, "%s\n", "");
            if (ctx->debugging)
                fprintf(ctx->log, "%s\n", "\n# SegRed");
            
            int64_t chunk_sizze_50240 = (int64_t) 1;
            
            if (slt64(n2_28465 * (int64_t) 2, segred_tblock_sizze_46379 * chunk_sizze_50240)) {
                int64_t segment_sizze_nonzzero_50241 = smax64((int64_t) 1, n2_28465);
                int64_t num_threads_50242 = segred_tblock_sizze_46379 * segred_tblock_sizze_46379;
                
                if (ctx->debugging)
                    fprintf(ctx->log, "%s\n", "# SegRed-small");
                if (ctx->debugging)
                    fprintf(ctx->log, "%s: %llu%c", "num_segments", (long long) dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_28504, '\n');
                if (ctx->debugging)
                    fprintf(ctx->log, "%s: %llu%c", "segment_size", (long long) n2_28465, '\n');
                if (ctx->debugging)
                    fprintf(ctx->log, "%s: %llu%c", "segments_per_block", (long long) squot64(segred_tblock_sizze_46379, segment_sizze_nonzzero_50241), '\n');
                if (ctx->debugging)
                    fprintf(ctx->log, "%s: %llu%c", "required_blocks", (long long) sext_i64_i32(sdiv_up64(dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_28504, squot64(segred_tblock_sizze_46379, segment_sizze_nonzzero_50241))), '\n');
                {
                    err = gpu_kernel_get_num_neighbours_against_9635zisegred_small_46385(ctx, num_tblocks_46380, 1, 1, *ctx->tuning_params.get_num_neighbours_against_9635zisegred_tblock_sizze_46296, 1, 1, (int64_t) 8 * segred_tblock_sizze_46379 + srem64((int64_t) 8 - srem64((int64_t) 8 * segred_tblock_sizze_46379, (int64_t) 8), (int64_t) 8), n2_28465, eps_28470, dist_t_28471, angle_t_28472, radius_28473, inf_28498, dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_28504, num_tblocks_46380, x_49348, segment_sizze_nonzzero_50241, dat1_mem_49374.mem, dat1_mem_49375.mem, dat2_mem_49376.mem, dat2_mem_49377.mem, mem_49379.mem, mem_49385.mem, mem_49387.mem, mem_49389.mem);
                    if (err != FUTHARK_SUCCESS)
                        goto cleanup;
                }
            } else {
                int64_t blocks_per_segment_50269 = sdiv_up64(num_tblocks_46380, smax64((int64_t) 1, dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_28504));
                int64_t q_50270 = sdiv_up64(n2_28465, segred_tblock_sizze_46379 * blocks_per_segment_50269 * chunk_sizze_50240);
                int64_t num_virtblocks_50271 = blocks_per_segment_50269 * dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_28504;
                int64_t threads_per_segment_50272 = blocks_per_segment_50269 * segred_tblock_sizze_46379;
                
                if (ctx->debugging)
                    fprintf(ctx->log, "%s\n", "# SegRed-large");
                if (ctx->debugging)
                    fprintf(ctx->log, "%s: %llu%c", "num_segments", (long long) dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_28504, '\n');
                if (ctx->debugging)
                    fprintf(ctx->log, "%s: %llu%c", "segment_size", (long long) n2_28465, '\n');
                if (ctx->debugging)
                    fprintf(ctx->log, "%s: %llu%c", "num_virtblocks", (long long) num_virtblocks_50271, '\n');
                if (ctx->debugging)
                    fprintf(ctx->log, "%s: %llu%c", "num_tblocks", (long long) num_tblocks_46380, '\n');
                if (ctx->debugging)
                    fprintf(ctx->log, "%s: %llu%c", "tblock_size", (long long) segred_tblock_sizze_46379, '\n');
                if (ctx->debugging)
                    fprintf(ctx->log, "%s: %llu%c", "q", (long long) q_50270, '\n');
                if (ctx->debugging)
                    fprintf(ctx->log, "%s: %llu%c", "blocks_per_segment", (long long) blocks_per_segment_50269, '\n');
                if (memblock_alloc_device(ctx, &segred_tmp_mem_50273, (int64_t) 8 * num_virtblocks_50271, "segred_tmp_mem_50273")) {
                    err = 1;
                    goto cleanup;
                }
                {
                    err = gpu_kernel_get_num_neighbours_against_9635zisegred_large_46385(ctx, num_tblocks_46380, 1, 1, *ctx->tuning_params.get_num_neighbours_against_9635zisegred_tblock_sizze_46296, 1, 1, 8 + ((int64_t) 8 * segred_tblock_sizze_46379 + srem64((int64_t) 8 - srem64((int64_t) 8 * segred_tblock_sizze_46379, (int64_t) 8), (int64_t) 8)), n2_28465, eps_28470, dist_t_28471, angle_t_28472, radius_28473, inf_28498, dzlz7bUZLzmZRz20Usupz20Uinfz7dUzg_28504, num_tblocks_46380, x_49348, blocks_per_segment_50269, q_50270, num_virtblocks_50271, threads_per_segment_50272, dat1_mem_49374.mem, dat1_mem_49375.mem, dat2_mem_49376.mem, dat2_mem_49377.mem, mem_49379.mem, mem_49385.mem, mem_49387.mem, mem_49389.mem, segred_tmp_mem_50273.mem, counters_mem_50275.mem);
                    if (err != FUTHARK_SUCCESS)
                        goto cleanup;
                }
            }
            if (ctx->debugging)
                fprintf(ctx->log, "%s\n", "");
            if (memblock_unref_device(ctx, &mem_49385, "mem_49385") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_49387, "mem_49387") != 0)
                return 1;
            if (memblock_unref_device(ctx, &mem_49389, "mem_49389") != 0)
                return 1;
        }
    }
    if (memblock_set_device(ctx, &mem_out_50191, &mem_49379, "mem_49379") != 0)
        return 1;
    if (memblock_set_device(ctx, &*mem_out_p_52235, &mem_out_50191, "mem_out_50191") != 0)
        return 1;
    
  cleanup:
    {
        if (memblock_unref_device(ctx, &segred_tmp_mem_50273, "segred_tmp_mem_50273") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49389, "mem_49389") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49387, "mem_49387") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49385, "mem_49385") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_49379, "mem_49379") != 0)
            return 1;
        if (memblock_unref_device(ctx, &mem_out_50191, "mem_out_50191") != 0)
            return 1;
    }
    return err;
}

int futhark_entry_add_next_partition_double(struct futhark_context *ctx, struct futhark_opaque_dbcHandler_double **out0, const struct futhark_opaque_dbcHandler_double *in0, const int64_t in1, const struct futhark_f64_1d *in2, const struct futhark_f64_1d *in3)
{
    int64_t n_old_27030 = (int64_t) 0;
    int64_t part_no_27031 = (int64_t) 0;
    int64_t dz2084U_27032 = (int64_t) 0;
    int64_t dz2080U_27033 = (int64_t) 0;
    int64_t dz2081U_27034 = (int64_t) 0;
    int64_t dz2082U_27035 = (int64_t) 0;
    int64_t dz2083U_27036 = (int64_t) 0;
    int64_t dz2085U_27037 = (int64_t) 0;
    int64_t dz2086U_27038 = (int64_t) 0;
    int64_t n_new_27039 = (int64_t) 0;
    int8_t clBase_27042 = (int8_t) 0;
    int8_t clBase_27043 = (int8_t) 0;
    double clBase_27044 = 0.0;
    int64_t clBase_27045 = (int64_t) 0;
    int64_t clBase_27047 = (int64_t) 0;
    double clBase_27050 = 0.0;
    int64_t clBase_27052 = (int64_t) 0;
    int64_t clProc_27057 = (int64_t) 0;
    int64_t clProc_27058 = (int64_t) 0;
    int64_t clProc_27059 = (int64_t) 0;
    int64_t clProc_27061 = (int64_t) 0;
    int64_t clProc_27062 = (int64_t) 0;
    int64_t current_partition_27076 = (int64_t) 0;
    int64_t new_id_27080 = (int64_t) 0;
    int64_t prim_out_50218 = (int64_t) 0;
    int64_t prim_out_50219 = (int64_t) 0;
    int64_t prim_out_50220 = (int64_t) 0;
    int8_t prim_out_50221 = (int8_t) 0;
    int8_t prim_out_50222 = (int8_t) 0;
    double prim_out_50223 = 0.0;
    int64_t prim_out_50224 = (int64_t) 0;
    int64_t prim_out_50225 = (int64_t) 0;
    double prim_out_50226 = 0.0;
    int64_t prim_out_50227 = (int64_t) 0;
    int64_t prim_out_50228 = (int64_t) 0;
    int64_t prim_out_50229 = (int64_t) 0;
    int64_t prim_out_50230 = (int64_t) 0;
    int64_t prim_out_50231 = (int64_t) 0;
    int64_t prim_out_50232 = (int64_t) 0;
    int64_t prim_out_50233 = (int64_t) 0;
    int ret = 0;
    
    lock_lock(&ctx->lock);
    CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
    
    struct memblock_device mem_out_50217;
    
    mem_out_50217.references = NULL;
    
    struct memblock_device mem_out_50216;
    
    mem_out_50216.references = NULL;
    
    struct memblock_device mem_out_50215;
    
    mem_out_50215.references = NULL;
    
    struct memblock_device mem_out_50214;
    
    mem_out_50214.references = NULL;
    
    struct memblock_device mem_out_50213;
    
    mem_out_50213.references = NULL;
    
    struct memblock_device mem_out_50212;
    
    mem_out_50212.references = NULL;
    
    struct memblock_device mem_out_50211;
    
    mem_out_50211.references = NULL;
    
    struct memblock_device mem_out_50210;
    
    mem_out_50210.references = NULL;
    
    struct memblock_device mem_out_50209;
    
    mem_out_50209.references = NULL;
    
    struct memblock_device mem_out_50208;
    
    mem_out_50208.references = NULL;
    
    struct memblock_device mem_out_50207;
    
    mem_out_50207.references = NULL;
    
    struct memblock_device mem_out_50206;
    
    mem_out_50206.references = NULL;
    
    struct memblock_device mem_out_50205;
    
    mem_out_50205.references = NULL;
    
    struct memblock_device mem_out_50204;
    
    mem_out_50204.references = NULL;
    
    struct memblock_device mem_out_50203;
    
    mem_out_50203.references = NULL;
    
    struct memblock_device mem_out_50202;
    
    mem_out_50202.references = NULL;
    
    struct memblock_device mem_out_50201;
    
    mem_out_50201.references = NULL;
    
    struct memblock_device mem_out_50200;
    
    mem_out_50200.references = NULL;
    
    struct memblock_device mem_out_50199;
    
    mem_out_50199.references = NULL;
    
    struct memblock_device mem_out_50198;
    
    mem_out_50198.references = NULL;
    
    struct memblock_device mem_out_50197;
    
    mem_out_50197.references = NULL;
    
    struct memblock_device mem_out_50196;
    
    mem_out_50196.references = NULL;
    
    struct memblock_device mem_out_50195;
    
    mem_out_50195.references = NULL;
    
    struct memblock_device mem_out_50194;
    
    mem_out_50194.references = NULL;
    
    struct memblock_device mem_out_50193;
    
    mem_out_50193.references = NULL;
    
    struct memblock_device mem_out_50192;
    
    mem_out_50192.references = NULL;
    
    struct memblock_device mem_out_50191;
    
    mem_out_50191.references = NULL;
    
    struct memblock_device new_ys_mem_49402;
    
    new_ys_mem_49402.references = NULL;
    
    struct memblock_device new_xs_mem_49401;
    
    new_xs_mem_49401.references = NULL;
    
    struct memblock_device toFlush_ids_mem_49400;
    
    toFlush_ids_mem_49400.references = NULL;
    
    struct memblock_device toFlush_dat_mem_49399;
    
    toFlush_dat_mem_49399.references = NULL;
    
    struct memblock_device toFlush_dat_mem_49398;
    
    toFlush_dat_mem_49398.references = NULL;
    
    struct memblock_device current_partition_mem_49397;
    
    current_partition_mem_49397.references = NULL;
    
    struct memblock_device current_partition_mem_49396;
    
    current_partition_mem_49396.references = NULL;
    
    struct memblock_device current_partition_mem_49395;
    
    current_partition_mem_49395.references = NULL;
    
    struct memblock_device current_partition_mem_49394;
    
    current_partition_mem_49394.references = NULL;
    
    struct memblock_device current_partition_mem_49393;
    
    current_partition_mem_49393.references = NULL;
    
    struct memblock_device current_partition_mem_49392;
    
    current_partition_mem_49392.references = NULL;
    
    struct memblock_device current_partition_mem_49391;
    
    current_partition_mem_49391.references = NULL;
    
    struct memblock_device current_partition_mem_49390;
    
    current_partition_mem_49390.references = NULL;
    
    struct memblock_device current_partition_mem_49389;
    
    current_partition_mem_49389.references = NULL;
    
    struct memblock_device current_partition_mem_49388;
    
    current_partition_mem_49388.references = NULL;
    
    struct memblock_device current_partition_mem_49387;
    
    current_partition_mem_49387.references = NULL;
    
    struct memblock_device current_partition_mem_49386;
    
    current_partition_mem_49386.references = NULL;
    
    struct memblock_device clProc_mem_49385;
    
    clProc_mem_49385.references = NULL;
    
    struct memblock_device clProc_mem_49384;
    
    clProc_mem_49384.references = NULL;
    
    struct memblock_device clProc_mem_49383;
    
    clProc_mem_49383.references = NULL;
    
    struct memblock_device clProc_mem_49382;
    
    clProc_mem_49382.references = NULL;
    
    struct memblock_device clProc_mem_49381;
    
    clProc_mem_49381.references = NULL;
    
    struct memblock_device clProc_mem_49380;
    
    clProc_mem_49380.references = NULL;
    
    struct memblock_device clBase_mem_49379;
    
    clBase_mem_49379.references = NULL;
    
    struct memblock_device clBase_mem_49378;
    
    clBase_mem_49378.references = NULL;
    
    struct memblock_device clBase_mem_49377;
    
    clBase_mem_49377.references = NULL;
    
    struct memblock_device clBase_mem_49376;
    
    clBase_mem_49376.references = NULL;
    
    struct memblock_device chain_collisions_mem_49375;
    
    chain_collisions_mem_49375.references = NULL;
    
    struct memblock_device chain_collisions_mem_49374;
    
    chain_collisions_mem_49374.references = NULL;
    chain_collisions_mem_49374 = in0->v0->mem;
    dz2084U_27032 = in0->v0->shape[0];
    chain_collisions_mem_49375 = in0->v1->mem;
    dz2084U_27032 = in0->v1->shape[0];
    clBase_27042 = in0->v2;
    clBase_27043 = in0->v3;
    clBase_27044 = in0->v4;
    clBase_27045 = in0->v5;
    clBase_mem_49376 = in0->v6->mem;
    clBase_27047 = in0->v7;
    clBase_mem_49377 = in0->v8->mem;
    clBase_mem_49378 = in0->v9->mem;
    clBase_27050 = in0->v10;
    clBase_mem_49379 = in0->v11->mem;
    clBase_27052 = in0->v12;
    clProc_mem_49380 = in0->v13->mem;
    dz2080U_27033 = in0->v13->shape[0];
    clProc_mem_49381 = in0->v14->mem;
    dz2081U_27034 = in0->v14->shape[0];
    clProc_mem_49382 = in0->v15->mem;
    dz2082U_27035 = in0->v15->shape[0];
    clProc_mem_49383 = in0->v16->mem;
    dz2082U_27035 = in0->v16->shape[0];
    clProc_27057 = in0->v17;
    clProc_27058 = in0->v18;
    clProc_27059 = in0->v19;
    clProc_mem_49384 = in0->v20->mem;
    part_no_27031 = in0->v20->shape[0];
    clProc_27061 = in0->v21;
    clProc_27062 = in0->v22;
    clProc_mem_49385 = in0->v23->mem;
    dz2083U_27036 = in0->v23->shape[0];
    current_partition_mem_49386 = in0->v24->mem;
    n_old_27030 = in0->v24->shape[0];
    current_partition_mem_49387 = in0->v25->mem;
    n_old_27030 = in0->v25->shape[0];
    current_partition_mem_49388 = in0->v26->mem;
    n_old_27030 = in0->v26->shape[0];
    current_partition_mem_49389 = in0->v27->mem;
    current_partition_mem_49390 = in0->v28->mem;
    current_partition_mem_49391 = in0->v29->mem;
    n_old_27030 = in0->v29->shape[0];
    current_partition_mem_49392 = in0->v30->mem;
    n_old_27030 = in0->v30->shape[0];
    current_partition_mem_49393 = in0->v31->mem;
    current_partition_mem_49394 = in0->v32->mem;
    n_old_27030 = in0->v32->shape[0];
    current_partition_mem_49395 = in0->v33->mem;
    current_partition_mem_49396 = in0->v34->mem;
    current_partition_mem_49397 = in0->v35->mem;
    current_partition_27076 = in0->v36;
    toFlush_dat_mem_49398 = in0->v37->mem;
    dz2085U_27037 = in0->v37->shape[0];
    toFlush_dat_mem_49399 = in0->v38->mem;
    dz2085U_27037 = in0->v38->shape[0];
    toFlush_ids_mem_49400 = in0->v39->mem;
    dz2086U_27038 = in0->v39->shape[0];
    new_id_27080 = in1;
    new_xs_mem_49401 = in2->mem;
    n_new_27039 = in2->shape[0];
    new_ys_mem_49402 = in3->mem;
    n_new_27039 = in3->shape[0];
    if (!((dz2084U_27032 == in0->v0->shape[0] && (dz2084U_27032 == in0->v1->shape[0] && ((int64_t) 2 == in0->v6->shape[0] && ((int64_t) 2 == in0->v8->shape[0] && ((int64_t) 2 == in0->v9->shape[0] && ((int64_t) 2 == in0->v11->shape[0] && (dz2080U_27033 == in0->v13->shape[0] && (dz2081U_27034 == in0->v14->shape[0] && (dz2082U_27035 == in0->v15->shape[0] && (dz2082U_27035 == in0->v16->shape[0] && (part_no_27031 == in0->v20->shape[0] && (dz2083U_27036 == in0->v23->shape[0] && (n_old_27030 == in0->v24->shape[0] && (n_old_27030 == in0->v25->shape[0] && (n_old_27030 == in0->v26->shape[0] && ((int64_t) 2 == in0->v27->shape[0] && ((int64_t) 2 == in0->v28->shape[0] && (n_old_27030 == in0->v29->shape[0] && (n_old_27030 == in0->v30->shape[0] && ((int64_t) 8 == in0->v31->shape[0] && (n_old_27030 == in0->v32->shape[0] && ((int64_t) 2 == in0->v33->shape[0] && ((int64_t) 2 == in0->v34->shape[0] && ((int64_t) 8 == in0->v35->shape[0] && (dz2085U_27037 == in0->v37->shape[0] && (dz2085U_27037 == in0->v38->shape[0] && dz2086U_27038 == in0->v39->shape[0])))))))))))))))))))))))))) && (n_new_27039 == in2->shape[0] && n_new_27039 == in3->shape[0]))) {
        ret = 1;
        set_error(ctx, msgprintf("Error: entry point arguments have invalid sizes.\n"));
    }
    if (ret == 0) {
        ret = futrts_entry_add_next_partition_double(ctx, &mem_out_50191, &mem_out_50192, &mem_out_50193, &mem_out_50194, &mem_out_50195, &mem_out_50196, &mem_out_50197, &mem_out_50198, &mem_out_50199, &mem_out_50200, &mem_out_50201, &mem_out_50202, &mem_out_50203, &mem_out_50204, &mem_out_50205, &mem_out_50206, &mem_out_50207, &mem_out_50208, &mem_out_50209, &mem_out_50210, &mem_out_50211, &mem_out_50212, &mem_out_50213, &mem_out_50214, &mem_out_50215, &mem_out_50216, &mem_out_50217, &prim_out_50218, &prim_out_50219, &prim_out_50220, &prim_out_50221, &prim_out_50222, &prim_out_50223, &prim_out_50224, &prim_out_50225, &prim_out_50226, &prim_out_50227, &prim_out_50228, &prim_out_50229, &prim_out_50230, &prim_out_50231, &prim_out_50232, &prim_out_50233, chain_collisions_mem_49374, chain_collisions_mem_49375, clBase_mem_49376, clBase_mem_49377, clBase_mem_49378, clBase_mem_49379, clProc_mem_49380, clProc_mem_49381, clProc_mem_49382, clProc_mem_49383, clProc_mem_49384, clProc_mem_49385, current_partition_mem_49386, current_partition_mem_49387, current_partition_mem_49388, current_partition_mem_49389, current_partition_mem_49390, current_partition_mem_49391, current_partition_mem_49392, current_partition_mem_49393, current_partition_mem_49394, current_partition_mem_49395, current_partition_mem_49396, current_partition_mem_49397, toFlush_dat_mem_49398, toFlush_dat_mem_49399, toFlush_ids_mem_49400, new_xs_mem_49401, new_ys_mem_49402, n_old_27030, part_no_27031, dz2084U_27032, dz2080U_27033, dz2081U_27034, dz2082U_27035, dz2083U_27036, dz2085U_27037, dz2086U_27038, n_new_27039, clBase_27042, clBase_27043, clBase_27044, clBase_27045, clBase_27047, clBase_27050, clBase_27052, clProc_27057, clProc_27058, clProc_27059, clProc_27061, clProc_27062, current_partition_27076, new_id_27080);
        if (ret == 0) {
            struct memblock_device counters_mem_50201 = ctx->constants->counters_mem_50201;
            struct memblock_device counters_mem_50275 = ctx->constants->counters_mem_50275;
            struct memblock_device counters_mem_50707 = ctx->constants->counters_mem_50707;
            struct memblock_device counters_mem_51122 = ctx->constants->counters_mem_51122;
            struct memblock_device counters_mem_51145 = ctx->constants->counters_mem_51145;
            struct memblock_device counters_mem_51184 = ctx->constants->counters_mem_51184;
            struct memblock_device counters_mem_51873 = ctx->constants->counters_mem_51873;
            struct memblock_device counters_mem_52032 = ctx->constants->counters_mem_52032;
            struct memblock_device global_dynid_mem_50266 = ctx->constants->global_dynid_mem_50266;
            struct memblock_device global_dynid_mem_50275 = ctx->constants->global_dynid_mem_50275;
            struct memblock_device global_dynid_mem_50287 = ctx->constants->global_dynid_mem_50287;
            struct memblock_device global_dynid_mem_50292 = ctx->constants->global_dynid_mem_50292;
            struct memblock_device global_dynid_mem_50450 = ctx->constants->global_dynid_mem_50450;
            struct memblock_device global_dynid_mem_50529 = ctx->constants->global_dynid_mem_50529;
            struct memblock_device global_dynid_mem_50570 = ctx->constants->global_dynid_mem_50570;
            struct memblock_device global_dynid_mem_50733 = ctx->constants->global_dynid_mem_50733;
            struct memblock_device global_dynid_mem_50769 = ctx->constants->global_dynid_mem_50769;
            struct memblock_device global_dynid_mem_50871 = ctx->constants->global_dynid_mem_50871;
            struct memblock_device global_dynid_mem_50875 = ctx->constants->global_dynid_mem_50875;
            struct memblock_device global_dynid_mem_50988 = ctx->constants->global_dynid_mem_50988;
            struct memblock_device global_dynid_mem_51231 = ctx->constants->global_dynid_mem_51231;
            struct memblock_device global_dynid_mem_51378 = ctx->constants->global_dynid_mem_51378;
            struct memblock_device global_dynid_mem_51534 = ctx->constants->global_dynid_mem_51534;
            struct memblock_device global_dynid_mem_51651 = ctx->constants->global_dynid_mem_51651;
            
            assert((*out0 = (struct futhark_opaque_dbcHandler_double *) malloc(sizeof(struct futhark_opaque_dbcHandler_double))) != NULL);
            assert(((*out0)->v0 = (struct futhark_i64_1d *) malloc(sizeof(struct futhark_i64_1d))) != NULL);
            (*out0)->v0->mem = mem_out_50191;
            (*out0)->v0->shape[0] = dz2084U_27032;
            assert(((*out0)->v1 = (struct futhark_i64_1d *) malloc(sizeof(struct futhark_i64_1d))) != NULL);
            (*out0)->v1->mem = mem_out_50192;
            (*out0)->v1->shape[0] = dz2084U_27032;
            (*out0)->v2 = prim_out_50221;
            (*out0)->v3 = prim_out_50222;
            (*out0)->v4 = prim_out_50223;
            (*out0)->v5 = prim_out_50224;
            assert(((*out0)->v6 = (struct futhark_f64_1d *) malloc(sizeof(struct futhark_f64_1d))) != NULL);
            (*out0)->v6->mem = mem_out_50193;
            (*out0)->v6->shape[0] = (int64_t) 2;
            (*out0)->v7 = prim_out_50225;
            assert(((*out0)->v8 = (struct futhark_f64_1d *) malloc(sizeof(struct futhark_f64_1d))) != NULL);
            (*out0)->v8->mem = mem_out_50194;
            (*out0)->v8->shape[0] = (int64_t) 2;
            assert(((*out0)->v9 = (struct futhark_i64_1d *) malloc(sizeof(struct futhark_i64_1d))) != NULL);
            (*out0)->v9->mem = mem_out_50195;
            (*out0)->v9->shape[0] = (int64_t) 2;
            (*out0)->v10 = prim_out_50226;
            assert(((*out0)->v11 = (struct futhark_f64_1d *) malloc(sizeof(struct futhark_f64_1d))) != NULL);
            (*out0)->v11->mem = mem_out_50196;
            (*out0)->v11->shape[0] = (int64_t) 2;
            (*out0)->v12 = prim_out_50227;
            assert(((*out0)->v13 = (struct futhark_bool_1d *) malloc(sizeof(struct futhark_bool_1d))) != NULL);
            (*out0)->v13->mem = mem_out_50197;
            (*out0)->v13->shape[0] = prim_out_50218;
            assert(((*out0)->v14 = (struct futhark_i64_1d *) malloc(sizeof(struct futhark_i64_1d))) != NULL);
            (*out0)->v14->mem = mem_out_50198;
            (*out0)->v14->shape[0] = prim_out_50218;
            assert(((*out0)->v15 = (struct futhark_f64_1d *) malloc(sizeof(struct futhark_f64_1d))) != NULL);
            (*out0)->v15->mem = mem_out_50199;
            (*out0)->v15->shape[0] = prim_out_50218;
            assert(((*out0)->v16 = (struct futhark_f64_1d *) malloc(sizeof(struct futhark_f64_1d))) != NULL);
            (*out0)->v16->mem = mem_out_50200;
            (*out0)->v16->shape[0] = prim_out_50218;
            (*out0)->v17 = prim_out_50228;
            (*out0)->v18 = prim_out_50229;
            (*out0)->v19 = prim_out_50230;
            assert(((*out0)->v20 = (struct futhark_bool_1d *) malloc(sizeof(struct futhark_bool_1d))) != NULL);
            (*out0)->v20->mem = mem_out_50201;
            (*out0)->v20->shape[0] = part_no_27031;
            (*out0)->v21 = prim_out_50231;
            (*out0)->v22 = prim_out_50232;
            assert(((*out0)->v23 = (struct futhark_i64_1d *) malloc(sizeof(struct futhark_i64_1d))) != NULL);
            (*out0)->v23->mem = mem_out_50202;
            (*out0)->v23->shape[0] = prim_out_50219;
            assert(((*out0)->v24 = (struct futhark_i64_1d *) malloc(sizeof(struct futhark_i64_1d))) != NULL);
            (*out0)->v24->mem = mem_out_50203;
            (*out0)->v24->shape[0] = n_new_27039;
            assert(((*out0)->v25 = (struct futhark_f64_1d *) malloc(sizeof(struct futhark_f64_1d))) != NULL);
            (*out0)->v25->mem = mem_out_50204;
            (*out0)->v25->shape[0] = n_new_27039;
            assert(((*out0)->v26 = (struct futhark_f64_1d *) malloc(sizeof(struct futhark_f64_1d))) != NULL);
            (*out0)->v26->mem = mem_out_50205;
            (*out0)->v26->shape[0] = n_new_27039;
            assert(((*out0)->v27 = (struct futhark_f64_1d *) malloc(sizeof(struct futhark_f64_1d))) != NULL);
            (*out0)->v27->mem = mem_out_50206;
            (*out0)->v27->shape[0] = (int64_t) 2;
            assert(((*out0)->v28 = (struct futhark_f64_1d *) malloc(sizeof(struct futhark_f64_1d))) != NULL);
            (*out0)->v28->mem = mem_out_50207;
            (*out0)->v28->shape[0] = (int64_t) 2;
            assert(((*out0)->v29 = (struct futhark_bool_1d *) malloc(sizeof(struct futhark_bool_1d))) != NULL);
            (*out0)->v29->mem = mem_out_50208;
            (*out0)->v29->shape[0] = n_new_27039;
            assert(((*out0)->v30 = (struct futhark_bool_1d *) malloc(sizeof(struct futhark_bool_1d))) != NULL);
            (*out0)->v30->mem = mem_out_50209;
            (*out0)->v30->shape[0] = n_new_27039;
            assert(((*out0)->v31 = (struct futhark_bool_1d *) malloc(sizeof(struct futhark_bool_1d))) != NULL);
            (*out0)->v31->mem = mem_out_50210;
            (*out0)->v31->shape[0] = (int64_t) 8;
            assert(((*out0)->v32 = (struct futhark_bool_1d *) malloc(sizeof(struct futhark_bool_1d))) != NULL);
            (*out0)->v32->mem = mem_out_50211;
            (*out0)->v32->shape[0] = n_new_27039;
            assert(((*out0)->v33 = (struct futhark_f64_1d *) malloc(sizeof(struct futhark_f64_1d))) != NULL);
            (*out0)->v33->mem = mem_out_50212;
            (*out0)->v33->shape[0] = (int64_t) 2;
            assert(((*out0)->v34 = (struct futhark_f64_1d *) malloc(sizeof(struct futhark_f64_1d))) != NULL);
            (*out0)->v34->mem = mem_out_50213;
            (*out0)->v34->shape[0] = (int64_t) 2;
            assert(((*out0)->v35 = (struct futhark_i64_1d *) malloc(sizeof(struct futhark_i64_1d))) != NULL);
            (*out0)->v35->mem = mem_out_50214;
            (*out0)->v35->shape[0] = (int64_t) 8;
            (*out0)->v36 = prim_out_50233;
            assert(((*out0)->v37 = (struct futhark_f64_1d *) malloc(sizeof(struct futhark_f64_1d))) != NULL);
            (*out0)->v37->mem = mem_out_50215;
            (*out0)->v37->shape[0] = prim_out_50220;
            assert(((*out0)->v38 = (struct futhark_f64_1d *) malloc(sizeof(struct futhark_f64_1d))) != NULL);
            (*out0)->v38->mem = mem_out_50216;
            (*out0)->v38->shape[0] = prim_out_50220;
            assert(((*out0)->v39 = (struct futhark_i64_1d *) malloc(sizeof(struct futhark_i64_1d))) != NULL);
            (*out0)->v39->mem = mem_out_50217;
            (*out0)->v39->shape[0] = prim_out_50220;
        }
    }
    CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
    lock_unlock(&ctx->lock);
    return ret;
}
int futhark_entry_do_DBSCAN_double(struct futhark_context *ctx, struct futhark_opaque_dbcHandler_double **out0, const struct futhark_opaque_dbcHandler_double *in0, const int64_t in1)
{
    int64_t n_34757 = (int64_t) 0;
    int64_t part_no_34758 = (int64_t) 0;
    int64_t dz2084U_34759 = (int64_t) 0;
    int64_t dz2080U_34760 = (int64_t) 0;
    int64_t dz2081U_34761 = (int64_t) 0;
    int64_t dz2082U_34762 = (int64_t) 0;
    int64_t dz2083U_34763 = (int64_t) 0;
    int64_t dz2085U_34764 = (int64_t) 0;
    int64_t dz2086U_34765 = (int64_t) 0;
    int8_t clBase_34768 = (int8_t) 0;
    int8_t clBase_34769 = (int8_t) 0;
    double clBase_34770 = 0.0;
    int64_t clBase_34771 = (int64_t) 0;
    int64_t clBase_34773 = (int64_t) 0;
    double clBase_34776 = 0.0;
    int64_t clBase_34778 = (int64_t) 0;
    int64_t clProc_34783 = (int64_t) 0;
    int64_t clProc_34784 = (int64_t) 0;
    int64_t clProc_34785 = (int64_t) 0;
    int64_t clProc_34787 = (int64_t) 0;
    int64_t clProc_34788 = (int64_t) 0;
    int64_t current_partition_34802 = (int64_t) 0;
    int64_t gather_psizze_34806 = (int64_t) 0;
    int64_t prim_out_50218 = (int64_t) 0;
    int8_t prim_out_50219 = (int8_t) 0;
    int8_t prim_out_50220 = (int8_t) 0;
    double prim_out_50221 = 0.0;
    int64_t prim_out_50222 = (int64_t) 0;
    int64_t prim_out_50223 = (int64_t) 0;
    double prim_out_50224 = 0.0;
    int64_t prim_out_50225 = (int64_t) 0;
    int64_t prim_out_50226 = (int64_t) 0;
    int64_t prim_out_50227 = (int64_t) 0;
    int64_t prim_out_50228 = (int64_t) 0;
    int64_t prim_out_50229 = (int64_t) 0;
    int64_t prim_out_50230 = (int64_t) 0;
    int64_t prim_out_50231 = (int64_t) 0;
    int ret = 0;
    
    lock_lock(&ctx->lock);
    CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
    
    struct memblock_device mem_out_50217;
    
    mem_out_50217.references = NULL;
    
    struct memblock_device mem_out_50216;
    
    mem_out_50216.references = NULL;
    
    struct memblock_device mem_out_50215;
    
    mem_out_50215.references = NULL;
    
    struct memblock_device mem_out_50214;
    
    mem_out_50214.references = NULL;
    
    struct memblock_device mem_out_50213;
    
    mem_out_50213.references = NULL;
    
    struct memblock_device mem_out_50212;
    
    mem_out_50212.references = NULL;
    
    struct memblock_device mem_out_50211;
    
    mem_out_50211.references = NULL;
    
    struct memblock_device mem_out_50210;
    
    mem_out_50210.references = NULL;
    
    struct memblock_device mem_out_50209;
    
    mem_out_50209.references = NULL;
    
    struct memblock_device mem_out_50208;
    
    mem_out_50208.references = NULL;
    
    struct memblock_device mem_out_50207;
    
    mem_out_50207.references = NULL;
    
    struct memblock_device mem_out_50206;
    
    mem_out_50206.references = NULL;
    
    struct memblock_device mem_out_50205;
    
    mem_out_50205.references = NULL;
    
    struct memblock_device mem_out_50204;
    
    mem_out_50204.references = NULL;
    
    struct memblock_device mem_out_50203;
    
    mem_out_50203.references = NULL;
    
    struct memblock_device mem_out_50202;
    
    mem_out_50202.references = NULL;
    
    struct memblock_device mem_out_50201;
    
    mem_out_50201.references = NULL;
    
    struct memblock_device mem_out_50200;
    
    mem_out_50200.references = NULL;
    
    struct memblock_device mem_out_50199;
    
    mem_out_50199.references = NULL;
    
    struct memblock_device mem_out_50198;
    
    mem_out_50198.references = NULL;
    
    struct memblock_device mem_out_50197;
    
    mem_out_50197.references = NULL;
    
    struct memblock_device mem_out_50196;
    
    mem_out_50196.references = NULL;
    
    struct memblock_device mem_out_50195;
    
    mem_out_50195.references = NULL;
    
    struct memblock_device mem_out_50194;
    
    mem_out_50194.references = NULL;
    
    struct memblock_device mem_out_50193;
    
    mem_out_50193.references = NULL;
    
    struct memblock_device mem_out_50192;
    
    mem_out_50192.references = NULL;
    
    struct memblock_device mem_out_50191;
    
    mem_out_50191.references = NULL;
    
    struct memblock_device toFlush_ids_mem_49400;
    
    toFlush_ids_mem_49400.references = NULL;
    
    struct memblock_device toFlush_dat_mem_49399;
    
    toFlush_dat_mem_49399.references = NULL;
    
    struct memblock_device toFlush_dat_mem_49398;
    
    toFlush_dat_mem_49398.references = NULL;
    
    struct memblock_device current_partition_mem_49397;
    
    current_partition_mem_49397.references = NULL;
    
    struct memblock_device current_partition_mem_49396;
    
    current_partition_mem_49396.references = NULL;
    
    struct memblock_device current_partition_mem_49395;
    
    current_partition_mem_49395.references = NULL;
    
    struct memblock_device current_partition_mem_49394;
    
    current_partition_mem_49394.references = NULL;
    
    struct memblock_device current_partition_mem_49393;
    
    current_partition_mem_49393.references = NULL;
    
    struct memblock_device current_partition_mem_49392;
    
    current_partition_mem_49392.references = NULL;
    
    struct memblock_device current_partition_mem_49391;
    
    current_partition_mem_49391.references = NULL;
    
    struct memblock_device current_partition_mem_49390;
    
    current_partition_mem_49390.references = NULL;
    
    struct memblock_device current_partition_mem_49389;
    
    current_partition_mem_49389.references = NULL;
    
    struct memblock_device current_partition_mem_49388;
    
    current_partition_mem_49388.references = NULL;
    
    struct memblock_device current_partition_mem_49387;
    
    current_partition_mem_49387.references = NULL;
    
    struct memblock_device current_partition_mem_49386;
    
    current_partition_mem_49386.references = NULL;
    
    struct memblock_device clProc_mem_49385;
    
    clProc_mem_49385.references = NULL;
    
    struct memblock_device clProc_mem_49384;
    
    clProc_mem_49384.references = NULL;
    
    struct memblock_device clProc_mem_49383;
    
    clProc_mem_49383.references = NULL;
    
    struct memblock_device clProc_mem_49382;
    
    clProc_mem_49382.references = NULL;
    
    struct memblock_device clProc_mem_49381;
    
    clProc_mem_49381.references = NULL;
    
    struct memblock_device clProc_mem_49380;
    
    clProc_mem_49380.references = NULL;
    
    struct memblock_device clBase_mem_49379;
    
    clBase_mem_49379.references = NULL;
    
    struct memblock_device clBase_mem_49378;
    
    clBase_mem_49378.references = NULL;
    
    struct memblock_device clBase_mem_49377;
    
    clBase_mem_49377.references = NULL;
    
    struct memblock_device clBase_mem_49376;
    
    clBase_mem_49376.references = NULL;
    
    struct memblock_device chain_collisions_mem_49375;
    
    chain_collisions_mem_49375.references = NULL;
    
    struct memblock_device chain_collisions_mem_49374;
    
    chain_collisions_mem_49374.references = NULL;
    chain_collisions_mem_49374 = in0->v0->mem;
    dz2084U_34759 = in0->v0->shape[0];
    chain_collisions_mem_49375 = in0->v1->mem;
    dz2084U_34759 = in0->v1->shape[0];
    clBase_34768 = in0->v2;
    clBase_34769 = in0->v3;
    clBase_34770 = in0->v4;
    clBase_34771 = in0->v5;
    clBase_mem_49376 = in0->v6->mem;
    clBase_34773 = in0->v7;
    clBase_mem_49377 = in0->v8->mem;
    clBase_mem_49378 = in0->v9->mem;
    clBase_34776 = in0->v10;
    clBase_mem_49379 = in0->v11->mem;
    clBase_34778 = in0->v12;
    clProc_mem_49380 = in0->v13->mem;
    dz2080U_34760 = in0->v13->shape[0];
    clProc_mem_49381 = in0->v14->mem;
    dz2081U_34761 = in0->v14->shape[0];
    clProc_mem_49382 = in0->v15->mem;
    dz2082U_34762 = in0->v15->shape[0];
    clProc_mem_49383 = in0->v16->mem;
    dz2082U_34762 = in0->v16->shape[0];
    clProc_34783 = in0->v17;
    clProc_34784 = in0->v18;
    clProc_34785 = in0->v19;
    clProc_mem_49384 = in0->v20->mem;
    part_no_34758 = in0->v20->shape[0];
    clProc_34787 = in0->v21;
    clProc_34788 = in0->v22;
    clProc_mem_49385 = in0->v23->mem;
    dz2083U_34763 = in0->v23->shape[0];
    current_partition_mem_49386 = in0->v24->mem;
    n_34757 = in0->v24->shape[0];
    current_partition_mem_49387 = in0->v25->mem;
    n_34757 = in0->v25->shape[0];
    current_partition_mem_49388 = in0->v26->mem;
    n_34757 = in0->v26->shape[0];
    current_partition_mem_49389 = in0->v27->mem;
    current_partition_mem_49390 = in0->v28->mem;
    current_partition_mem_49391 = in0->v29->mem;
    n_34757 = in0->v29->shape[0];
    current_partition_mem_49392 = in0->v30->mem;
    n_34757 = in0->v30->shape[0];
    current_partition_mem_49393 = in0->v31->mem;
    current_partition_mem_49394 = in0->v32->mem;
    n_34757 = in0->v32->shape[0];
    current_partition_mem_49395 = in0->v33->mem;
    current_partition_mem_49396 = in0->v34->mem;
    current_partition_mem_49397 = in0->v35->mem;
    current_partition_34802 = in0->v36;
    toFlush_dat_mem_49398 = in0->v37->mem;
    dz2085U_34764 = in0->v37->shape[0];
    toFlush_dat_mem_49399 = in0->v38->mem;
    dz2085U_34764 = in0->v38->shape[0];
    toFlush_ids_mem_49400 = in0->v39->mem;
    dz2086U_34765 = in0->v39->shape[0];
    gather_psizze_34806 = in1;
    if (!(dz2084U_34759 == in0->v0->shape[0] && (dz2084U_34759 == in0->v1->shape[0] && ((int64_t) 2 == in0->v6->shape[0] && ((int64_t) 2 == in0->v8->shape[0] && ((int64_t) 2 == in0->v9->shape[0] && ((int64_t) 2 == in0->v11->shape[0] && (dz2080U_34760 == in0->v13->shape[0] && (dz2081U_34761 == in0->v14->shape[0] && (dz2082U_34762 == in0->v15->shape[0] && (dz2082U_34762 == in0->v16->shape[0] && (part_no_34758 == in0->v20->shape[0] && (dz2083U_34763 == in0->v23->shape[0] && (n_34757 == in0->v24->shape[0] && (n_34757 == in0->v25->shape[0] && (n_34757 == in0->v26->shape[0] && ((int64_t) 2 == in0->v27->shape[0] && ((int64_t) 2 == in0->v28->shape[0] && (n_34757 == in0->v29->shape[0] && (n_34757 == in0->v30->shape[0] && ((int64_t) 8 == in0->v31->shape[0] && (n_34757 == in0->v32->shape[0] && ((int64_t) 2 == in0->v33->shape[0] && ((int64_t) 2 == in0->v34->shape[0] && ((int64_t) 8 == in0->v35->shape[0] && (dz2085U_34764 == in0->v37->shape[0] && (dz2085U_34764 == in0->v38->shape[0] && dz2086U_34765 == in0->v39->shape[0]))))))))))))))))))))))))))) {
        ret = 1;
        set_error(ctx, msgprintf("Error: entry point arguments have invalid sizes.\n"));
    }
    if (ret == 0) {
        ret = futrts_entry_do_DBSCAN_double(ctx, &mem_out_50191, &mem_out_50192, &mem_out_50193, &mem_out_50194, &mem_out_50195, &mem_out_50196, &mem_out_50197, &mem_out_50198, &mem_out_50199, &mem_out_50200, &mem_out_50201, &mem_out_50202, &mem_out_50203, &mem_out_50204, &mem_out_50205, &mem_out_50206, &mem_out_50207, &mem_out_50208, &mem_out_50209, &mem_out_50210, &mem_out_50211, &mem_out_50212, &mem_out_50213, &mem_out_50214, &mem_out_50215, &mem_out_50216, &mem_out_50217, &prim_out_50218, &prim_out_50219, &prim_out_50220, &prim_out_50221, &prim_out_50222, &prim_out_50223, &prim_out_50224, &prim_out_50225, &prim_out_50226, &prim_out_50227, &prim_out_50228, &prim_out_50229, &prim_out_50230, &prim_out_50231, chain_collisions_mem_49374, chain_collisions_mem_49375, clBase_mem_49376, clBase_mem_49377, clBase_mem_49378, clBase_mem_49379, clProc_mem_49380, clProc_mem_49381, clProc_mem_49382, clProc_mem_49383, clProc_mem_49384, clProc_mem_49385, current_partition_mem_49386, current_partition_mem_49387, current_partition_mem_49388, current_partition_mem_49389, current_partition_mem_49390, current_partition_mem_49391, current_partition_mem_49392, current_partition_mem_49393, current_partition_mem_49394, current_partition_mem_49395, current_partition_mem_49396, current_partition_mem_49397, toFlush_dat_mem_49398, toFlush_dat_mem_49399, toFlush_ids_mem_49400, n_34757, part_no_34758, dz2084U_34759, dz2080U_34760, dz2081U_34761, dz2082U_34762, dz2083U_34763, dz2085U_34764, dz2086U_34765, clBase_34768, clBase_34769, clBase_34770, clBase_34771, clBase_34773, clBase_34776, clBase_34778, clProc_34783, clProc_34784, clProc_34785, clProc_34787, clProc_34788, current_partition_34802, gather_psizze_34806);
        if (ret == 0) {
            struct memblock_device counters_mem_50201 = ctx->constants->counters_mem_50201;
            struct memblock_device counters_mem_50275 = ctx->constants->counters_mem_50275;
            struct memblock_device counters_mem_50707 = ctx->constants->counters_mem_50707;
            struct memblock_device counters_mem_51122 = ctx->constants->counters_mem_51122;
            struct memblock_device counters_mem_51145 = ctx->constants->counters_mem_51145;
            struct memblock_device counters_mem_51184 = ctx->constants->counters_mem_51184;
            struct memblock_device counters_mem_51873 = ctx->constants->counters_mem_51873;
            struct memblock_device counters_mem_52032 = ctx->constants->counters_mem_52032;
            struct memblock_device global_dynid_mem_50266 = ctx->constants->global_dynid_mem_50266;
            struct memblock_device global_dynid_mem_50275 = ctx->constants->global_dynid_mem_50275;
            struct memblock_device global_dynid_mem_50287 = ctx->constants->global_dynid_mem_50287;
            struct memblock_device global_dynid_mem_50292 = ctx->constants->global_dynid_mem_50292;
            struct memblock_device global_dynid_mem_50450 = ctx->constants->global_dynid_mem_50450;
            struct memblock_device global_dynid_mem_50529 = ctx->constants->global_dynid_mem_50529;
            struct memblock_device global_dynid_mem_50570 = ctx->constants->global_dynid_mem_50570;
            struct memblock_device global_dynid_mem_50733 = ctx->constants->global_dynid_mem_50733;
            struct memblock_device global_dynid_mem_50769 = ctx->constants->global_dynid_mem_50769;
            struct memblock_device global_dynid_mem_50871 = ctx->constants->global_dynid_mem_50871;
            struct memblock_device global_dynid_mem_50875 = ctx->constants->global_dynid_mem_50875;
            struct memblock_device global_dynid_mem_50988 = ctx->constants->global_dynid_mem_50988;
            struct memblock_device global_dynid_mem_51231 = ctx->constants->global_dynid_mem_51231;
            struct memblock_device global_dynid_mem_51378 = ctx->constants->global_dynid_mem_51378;
            struct memblock_device global_dynid_mem_51534 = ctx->constants->global_dynid_mem_51534;
            struct memblock_device global_dynid_mem_51651 = ctx->constants->global_dynid_mem_51651;
            
            assert((*out0 = (struct futhark_opaque_dbcHandler_double *) malloc(sizeof(struct futhark_opaque_dbcHandler_double))) != NULL);
            assert(((*out0)->v0 = (struct futhark_i64_1d *) malloc(sizeof(struct futhark_i64_1d))) != NULL);
            (*out0)->v0->mem = mem_out_50191;
            (*out0)->v0->shape[0] = prim_out_50218;
            assert(((*out0)->v1 = (struct futhark_i64_1d *) malloc(sizeof(struct futhark_i64_1d))) != NULL);
            (*out0)->v1->mem = mem_out_50192;
            (*out0)->v1->shape[0] = prim_out_50218;
            (*out0)->v2 = prim_out_50219;
            (*out0)->v3 = prim_out_50220;
            (*out0)->v4 = prim_out_50221;
            (*out0)->v5 = prim_out_50222;
            assert(((*out0)->v6 = (struct futhark_f64_1d *) malloc(sizeof(struct futhark_f64_1d))) != NULL);
            (*out0)->v6->mem = mem_out_50193;
            (*out0)->v6->shape[0] = (int64_t) 2;
            (*out0)->v7 = prim_out_50223;
            assert(((*out0)->v8 = (struct futhark_f64_1d *) malloc(sizeof(struct futhark_f64_1d))) != NULL);
            (*out0)->v8->mem = mem_out_50194;
            (*out0)->v8->shape[0] = (int64_t) 2;
            assert(((*out0)->v9 = (struct futhark_i64_1d *) malloc(sizeof(struct futhark_i64_1d))) != NULL);
            (*out0)->v9->mem = mem_out_50195;
            (*out0)->v9->shape[0] = (int64_t) 2;
            (*out0)->v10 = prim_out_50224;
            assert(((*out0)->v11 = (struct futhark_f64_1d *) malloc(sizeof(struct futhark_f64_1d))) != NULL);
            (*out0)->v11->mem = mem_out_50196;
            (*out0)->v11->shape[0] = (int64_t) 2;
            (*out0)->v12 = prim_out_50225;
            assert(((*out0)->v13 = (struct futhark_bool_1d *) malloc(sizeof(struct futhark_bool_1d))) != NULL);
            (*out0)->v13->mem = mem_out_50197;
            (*out0)->v13->shape[0] = dz2080U_34760;
            assert(((*out0)->v14 = (struct futhark_i64_1d *) malloc(sizeof(struct futhark_i64_1d))) != NULL);
            (*out0)->v14->mem = mem_out_50198;
            (*out0)->v14->shape[0] = dz2081U_34761;
            assert(((*out0)->v15 = (struct futhark_f64_1d *) malloc(sizeof(struct futhark_f64_1d))) != NULL);
            (*out0)->v15->mem = mem_out_50199;
            (*out0)->v15->shape[0] = dz2082U_34762;
            assert(((*out0)->v16 = (struct futhark_f64_1d *) malloc(sizeof(struct futhark_f64_1d))) != NULL);
            (*out0)->v16->mem = mem_out_50200;
            (*out0)->v16->shape[0] = dz2082U_34762;
            (*out0)->v17 = prim_out_50226;
            (*out0)->v18 = prim_out_50227;
            (*out0)->v19 = prim_out_50228;
            assert(((*out0)->v20 = (struct futhark_bool_1d *) malloc(sizeof(struct futhark_bool_1d))) != NULL);
            (*out0)->v20->mem = mem_out_50201;
            (*out0)->v20->shape[0] = part_no_34758;
            (*out0)->v21 = prim_out_50229;
            (*out0)->v22 = prim_out_50230;
            assert(((*out0)->v23 = (struct futhark_i64_1d *) malloc(sizeof(struct futhark_i64_1d))) != NULL);
            (*out0)->v23->mem = mem_out_50202;
            (*out0)->v23->shape[0] = dz2083U_34763;
            assert(((*out0)->v24 = (struct futhark_i64_1d *) malloc(sizeof(struct futhark_i64_1d))) != NULL);
            (*out0)->v24->mem = mem_out_50203;
            (*out0)->v24->shape[0] = n_34757;
            assert(((*out0)->v25 = (struct futhark_f64_1d *) malloc(sizeof(struct futhark_f64_1d))) != NULL);
            (*out0)->v25->mem = mem_out_50204;
            (*out0)->v25->shape[0] = n_34757;
            assert(((*out0)->v26 = (struct futhark_f64_1d *) malloc(sizeof(struct futhark_f64_1d))) != NULL);
            (*out0)->v26->mem = mem_out_50205;
            (*out0)->v26->shape[0] = n_34757;
            assert(((*out0)->v27 = (struct futhark_f64_1d *) malloc(sizeof(struct futhark_f64_1d))) != NULL);
            (*out0)->v27->mem = mem_out_50206;
            (*out0)->v27->shape[0] = (int64_t) 2;
            assert(((*out0)->v28 = (struct futhark_f64_1d *) malloc(sizeof(struct futhark_f64_1d))) != NULL);
            (*out0)->v28->mem = mem_out_50207;
            (*out0)->v28->shape[0] = (int64_t) 2;
            assert(((*out0)->v29 = (struct futhark_bool_1d *) malloc(sizeof(struct futhark_bool_1d))) != NULL);
            (*out0)->v29->mem = mem_out_50208;
            (*out0)->v29->shape[0] = n_34757;
            assert(((*out0)->v30 = (struct futhark_bool_1d *) malloc(sizeof(struct futhark_bool_1d))) != NULL);
            (*out0)->v30->mem = mem_out_50209;
            (*out0)->v30->shape[0] = n_34757;
            assert(((*out0)->v31 = (struct futhark_bool_1d *) malloc(sizeof(struct futhark_bool_1d))) != NULL);
            (*out0)->v31->mem = mem_out_50210;
            (*out0)->v31->shape[0] = (int64_t) 8;
            assert(((*out0)->v32 = (struct futhark_bool_1d *) malloc(sizeof(struct futhark_bool_1d))) != NULL);
            (*out0)->v32->mem = mem_out_50211;
            (*out0)->v32->shape[0] = n_34757;
            assert(((*out0)->v33 = (struct futhark_f64_1d *) malloc(sizeof(struct futhark_f64_1d))) != NULL);
            (*out0)->v33->mem = mem_out_50212;
            (*out0)->v33->shape[0] = (int64_t) 2;
            assert(((*out0)->v34 = (struct futhark_f64_1d *) malloc(sizeof(struct futhark_f64_1d))) != NULL);
            (*out0)->v34->mem = mem_out_50213;
            (*out0)->v34->shape[0] = (int64_t) 2;
            assert(((*out0)->v35 = (struct futhark_i64_1d *) malloc(sizeof(struct futhark_i64_1d))) != NULL);
            (*out0)->v35->mem = mem_out_50214;
            (*out0)->v35->shape[0] = (int64_t) 8;
            (*out0)->v36 = prim_out_50231;
            assert(((*out0)->v37 = (struct futhark_f64_1d *) malloc(sizeof(struct futhark_f64_1d))) != NULL);
            (*out0)->v37->mem = mem_out_50215;
            (*out0)->v37->shape[0] = (int64_t) 0;
            assert(((*out0)->v38 = (struct futhark_f64_1d *) malloc(sizeof(struct futhark_f64_1d))) != NULL);
            (*out0)->v38->mem = mem_out_50216;
            (*out0)->v38->shape[0] = (int64_t) 0;
            assert(((*out0)->v39 = (struct futhark_i64_1d *) malloc(sizeof(struct futhark_i64_1d))) != NULL);
            (*out0)->v39->mem = mem_out_50217;
            (*out0)->v39->shape[0] = (int64_t) 0;
        }
    }
    CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
    lock_unlock(&ctx->lock);
    return ret;
}
int futhark_entry_flush_dat_double(struct futhark_context *ctx, struct futhark_opaque_flushedData_double **out0, const struct futhark_opaque_dbcHandler_double *in0)
{
    int64_t n_27268 = (int64_t) 0;
    int64_t part_no_27269 = (int64_t) 0;
    int64_t dz2084U_27270 = (int64_t) 0;
    int64_t dz2080U_27271 = (int64_t) 0;
    int64_t dz2081U_27272 = (int64_t) 0;
    int64_t dz2082U_27273 = (int64_t) 0;
    int64_t dz2083U_27274 = (int64_t) 0;
    int64_t dz2085U_27275 = (int64_t) 0;
    int64_t dz2086U_27276 = (int64_t) 0;
    int8_t clBase_27279 = (int8_t) 0;
    int8_t clBase_27280 = (int8_t) 0;
    double clBase_27281 = 0.0;
    int64_t clBase_27282 = (int64_t) 0;
    int64_t clBase_27284 = (int64_t) 0;
    double clBase_27287 = 0.0;
    int64_t clBase_27289 = (int64_t) 0;
    int64_t clProc_27294 = (int64_t) 0;
    int64_t clProc_27295 = (int64_t) 0;
    int64_t clProc_27296 = (int64_t) 0;
    int64_t clProc_27298 = (int64_t) 0;
    int64_t clProc_27299 = (int64_t) 0;
    int64_t current_partition_27313 = (int64_t) 0;
    int ret = 0;
    
    lock_lock(&ctx->lock);
    CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
    
    struct memblock_device mem_out_50193;
    
    mem_out_50193.references = NULL;
    
    struct memblock_device mem_out_50192;
    
    mem_out_50192.references = NULL;
    
    struct memblock_device mem_out_50191;
    
    mem_out_50191.references = NULL;
    
    struct memblock_device toFlush_ids_mem_49400;
    
    toFlush_ids_mem_49400.references = NULL;
    
    struct memblock_device toFlush_dat_mem_49399;
    
    toFlush_dat_mem_49399.references = NULL;
    
    struct memblock_device toFlush_dat_mem_49398;
    
    toFlush_dat_mem_49398.references = NULL;
    
    struct memblock_device current_partition_mem_49397;
    
    current_partition_mem_49397.references = NULL;
    
    struct memblock_device current_partition_mem_49396;
    
    current_partition_mem_49396.references = NULL;
    
    struct memblock_device current_partition_mem_49395;
    
    current_partition_mem_49395.references = NULL;
    
    struct memblock_device current_partition_mem_49394;
    
    current_partition_mem_49394.references = NULL;
    
    struct memblock_device current_partition_mem_49393;
    
    current_partition_mem_49393.references = NULL;
    
    struct memblock_device current_partition_mem_49392;
    
    current_partition_mem_49392.references = NULL;
    
    struct memblock_device current_partition_mem_49391;
    
    current_partition_mem_49391.references = NULL;
    
    struct memblock_device current_partition_mem_49390;
    
    current_partition_mem_49390.references = NULL;
    
    struct memblock_device current_partition_mem_49389;
    
    current_partition_mem_49389.references = NULL;
    
    struct memblock_device current_partition_mem_49388;
    
    current_partition_mem_49388.references = NULL;
    
    struct memblock_device current_partition_mem_49387;
    
    current_partition_mem_49387.references = NULL;
    
    struct memblock_device current_partition_mem_49386;
    
    current_partition_mem_49386.references = NULL;
    
    struct memblock_device clProc_mem_49385;
    
    clProc_mem_49385.references = NULL;
    
    struct memblock_device clProc_mem_49384;
    
    clProc_mem_49384.references = NULL;
    
    struct memblock_device clProc_mem_49383;
    
    clProc_mem_49383.references = NULL;
    
    struct memblock_device clProc_mem_49382;
    
    clProc_mem_49382.references = NULL;
    
    struct memblock_device clProc_mem_49381;
    
    clProc_mem_49381.references = NULL;
    
    struct memblock_device clProc_mem_49380;
    
    clProc_mem_49380.references = NULL;
    
    struct memblock_device clBase_mem_49379;
    
    clBase_mem_49379.references = NULL;
    
    struct memblock_device clBase_mem_49378;
    
    clBase_mem_49378.references = NULL;
    
    struct memblock_device clBase_mem_49377;
    
    clBase_mem_49377.references = NULL;
    
    struct memblock_device clBase_mem_49376;
    
    clBase_mem_49376.references = NULL;
    
    struct memblock_device chain_collisions_mem_49375;
    
    chain_collisions_mem_49375.references = NULL;
    
    struct memblock_device chain_collisions_mem_49374;
    
    chain_collisions_mem_49374.references = NULL;
    chain_collisions_mem_49374 = in0->v0->mem;
    dz2084U_27270 = in0->v0->shape[0];
    chain_collisions_mem_49375 = in0->v1->mem;
    dz2084U_27270 = in0->v1->shape[0];
    clBase_27279 = in0->v2;
    clBase_27280 = in0->v3;
    clBase_27281 = in0->v4;
    clBase_27282 = in0->v5;
    clBase_mem_49376 = in0->v6->mem;
    clBase_27284 = in0->v7;
    clBase_mem_49377 = in0->v8->mem;
    clBase_mem_49378 = in0->v9->mem;
    clBase_27287 = in0->v10;
    clBase_mem_49379 = in0->v11->mem;
    clBase_27289 = in0->v12;
    clProc_mem_49380 = in0->v13->mem;
    dz2080U_27271 = in0->v13->shape[0];
    clProc_mem_49381 = in0->v14->mem;
    dz2081U_27272 = in0->v14->shape[0];
    clProc_mem_49382 = in0->v15->mem;
    dz2082U_27273 = in0->v15->shape[0];
    clProc_mem_49383 = in0->v16->mem;
    dz2082U_27273 = in0->v16->shape[0];
    clProc_27294 = in0->v17;
    clProc_27295 = in0->v18;
    clProc_27296 = in0->v19;
    clProc_mem_49384 = in0->v20->mem;
    part_no_27269 = in0->v20->shape[0];
    clProc_27298 = in0->v21;
    clProc_27299 = in0->v22;
    clProc_mem_49385 = in0->v23->mem;
    dz2083U_27274 = in0->v23->shape[0];
    current_partition_mem_49386 = in0->v24->mem;
    n_27268 = in0->v24->shape[0];
    current_partition_mem_49387 = in0->v25->mem;
    n_27268 = in0->v25->shape[0];
    current_partition_mem_49388 = in0->v26->mem;
    n_27268 = in0->v26->shape[0];
    current_partition_mem_49389 = in0->v27->mem;
    current_partition_mem_49390 = in0->v28->mem;
    current_partition_mem_49391 = in0->v29->mem;
    n_27268 = in0->v29->shape[0];
    current_partition_mem_49392 = in0->v30->mem;
    n_27268 = in0->v30->shape[0];
    current_partition_mem_49393 = in0->v31->mem;
    current_partition_mem_49394 = in0->v32->mem;
    n_27268 = in0->v32->shape[0];
    current_partition_mem_49395 = in0->v33->mem;
    current_partition_mem_49396 = in0->v34->mem;
    current_partition_mem_49397 = in0->v35->mem;
    current_partition_27313 = in0->v36;
    toFlush_dat_mem_49398 = in0->v37->mem;
    dz2085U_27275 = in0->v37->shape[0];
    toFlush_dat_mem_49399 = in0->v38->mem;
    dz2085U_27275 = in0->v38->shape[0];
    toFlush_ids_mem_49400 = in0->v39->mem;
    dz2086U_27276 = in0->v39->shape[0];
    if (!(dz2084U_27270 == in0->v0->shape[0] && (dz2084U_27270 == in0->v1->shape[0] && ((int64_t) 2 == in0->v6->shape[0] && ((int64_t) 2 == in0->v8->shape[0] && ((int64_t) 2 == in0->v9->shape[0] && ((int64_t) 2 == in0->v11->shape[0] && (dz2080U_27271 == in0->v13->shape[0] && (dz2081U_27272 == in0->v14->shape[0] && (dz2082U_27273 == in0->v15->shape[0] && (dz2082U_27273 == in0->v16->shape[0] && (part_no_27269 == in0->v20->shape[0] && (dz2083U_27274 == in0->v23->shape[0] && (n_27268 == in0->v24->shape[0] && (n_27268 == in0->v25->shape[0] && (n_27268 == in0->v26->shape[0] && ((int64_t) 2 == in0->v27->shape[0] && ((int64_t) 2 == in0->v28->shape[0] && (n_27268 == in0->v29->shape[0] && (n_27268 == in0->v30->shape[0] && ((int64_t) 8 == in0->v31->shape[0] && (n_27268 == in0->v32->shape[0] && ((int64_t) 2 == in0->v33->shape[0] && ((int64_t) 2 == in0->v34->shape[0] && ((int64_t) 8 == in0->v35->shape[0] && (dz2085U_27275 == in0->v37->shape[0] && (dz2085U_27275 == in0->v38->shape[0] && dz2086U_27276 == in0->v39->shape[0]))))))))))))))))))))))))))) {
        ret = 1;
        set_error(ctx, msgprintf("Error: entry point arguments have invalid sizes.\n"));
    }
    if (ret == 0) {
        ret = futrts_entry_flush_dat_double(ctx, &mem_out_50191, &mem_out_50192, &mem_out_50193, chain_collisions_mem_49374, chain_collisions_mem_49375, clBase_mem_49376, clBase_mem_49377, clBase_mem_49378, clBase_mem_49379, clProc_mem_49380, clProc_mem_49381, clProc_mem_49382, clProc_mem_49383, clProc_mem_49384, clProc_mem_49385, current_partition_mem_49386, current_partition_mem_49387, current_partition_mem_49388, current_partition_mem_49389, current_partition_mem_49390, current_partition_mem_49391, current_partition_mem_49392, current_partition_mem_49393, current_partition_mem_49394, current_partition_mem_49395, current_partition_mem_49396, current_partition_mem_49397, toFlush_dat_mem_49398, toFlush_dat_mem_49399, toFlush_ids_mem_49400, n_27268, part_no_27269, dz2084U_27270, dz2080U_27271, dz2081U_27272, dz2082U_27273, dz2083U_27274, dz2085U_27275, dz2086U_27276, clBase_27279, clBase_27280, clBase_27281, clBase_27282, clBase_27284, clBase_27287, clBase_27289, clProc_27294, clProc_27295, clProc_27296, clProc_27298, clProc_27299, current_partition_27313);
        if (ret == 0) {
            struct memblock_device counters_mem_50201 = ctx->constants->counters_mem_50201;
            struct memblock_device counters_mem_50275 = ctx->constants->counters_mem_50275;
            struct memblock_device counters_mem_50707 = ctx->constants->counters_mem_50707;
            struct memblock_device counters_mem_51122 = ctx->constants->counters_mem_51122;
            struct memblock_device counters_mem_51145 = ctx->constants->counters_mem_51145;
            struct memblock_device counters_mem_51184 = ctx->constants->counters_mem_51184;
            struct memblock_device counters_mem_51873 = ctx->constants->counters_mem_51873;
            struct memblock_device counters_mem_52032 = ctx->constants->counters_mem_52032;
            struct memblock_device global_dynid_mem_50266 = ctx->constants->global_dynid_mem_50266;
            struct memblock_device global_dynid_mem_50275 = ctx->constants->global_dynid_mem_50275;
            struct memblock_device global_dynid_mem_50287 = ctx->constants->global_dynid_mem_50287;
            struct memblock_device global_dynid_mem_50292 = ctx->constants->global_dynid_mem_50292;
            struct memblock_device global_dynid_mem_50450 = ctx->constants->global_dynid_mem_50450;
            struct memblock_device global_dynid_mem_50529 = ctx->constants->global_dynid_mem_50529;
            struct memblock_device global_dynid_mem_50570 = ctx->constants->global_dynid_mem_50570;
            struct memblock_device global_dynid_mem_50733 = ctx->constants->global_dynid_mem_50733;
            struct memblock_device global_dynid_mem_50769 = ctx->constants->global_dynid_mem_50769;
            struct memblock_device global_dynid_mem_50871 = ctx->constants->global_dynid_mem_50871;
            struct memblock_device global_dynid_mem_50875 = ctx->constants->global_dynid_mem_50875;
            struct memblock_device global_dynid_mem_50988 = ctx->constants->global_dynid_mem_50988;
            struct memblock_device global_dynid_mem_51231 = ctx->constants->global_dynid_mem_51231;
            struct memblock_device global_dynid_mem_51378 = ctx->constants->global_dynid_mem_51378;
            struct memblock_device global_dynid_mem_51534 = ctx->constants->global_dynid_mem_51534;
            struct memblock_device global_dynid_mem_51651 = ctx->constants->global_dynid_mem_51651;
            
            assert((*out0 = (struct futhark_opaque_flushedData_double *) malloc(sizeof(struct futhark_opaque_flushedData_double))) != NULL);
            assert(((*out0)->v0 = (struct futhark_i64_1d *) malloc(sizeof(struct futhark_i64_1d))) != NULL);
            (*out0)->v0->mem = mem_out_50191;
            (*out0)->v0->shape[0] = dz2086U_27276;
            assert(((*out0)->v1 = (struct futhark_f64_1d *) malloc(sizeof(struct futhark_f64_1d))) != NULL);
            (*out0)->v1->mem = mem_out_50192;
            (*out0)->v1->shape[0] = dz2085U_27275;
            assert(((*out0)->v2 = (struct futhark_f64_1d *) malloc(sizeof(struct futhark_f64_1d))) != NULL);
            (*out0)->v2->mem = mem_out_50193;
            (*out0)->v2->shape[0] = dz2085U_27275;
        }
    }
    CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
    lock_unlock(&ctx->lock);
    return ret;
}
int futhark_entry_make_collisions_compact_double(struct futhark_context *ctx, struct futhark_opaque_collisionTable **out0, const struct futhark_opaque_dbcHandler_double *in0)
{
    int64_t n_35568 = (int64_t) 0;
    int64_t part_no_35569 = (int64_t) 0;
    int64_t dz2084U_35570 = (int64_t) 0;
    int64_t dz2080U_35571 = (int64_t) 0;
    int64_t dz2081U_35572 = (int64_t) 0;
    int64_t dz2082U_35573 = (int64_t) 0;
    int64_t dz2083U_35574 = (int64_t) 0;
    int64_t dz2085U_35575 = (int64_t) 0;
    int64_t dz2086U_35576 = (int64_t) 0;
    int8_t clBase_35579 = (int8_t) 0;
    int8_t clBase_35580 = (int8_t) 0;
    double clBase_35581 = 0.0;
    int64_t clBase_35582 = (int64_t) 0;
    int64_t clBase_35584 = (int64_t) 0;
    double clBase_35587 = 0.0;
    int64_t clBase_35589 = (int64_t) 0;
    int64_t clProc_35594 = (int64_t) 0;
    int64_t clProc_35595 = (int64_t) 0;
    int64_t clProc_35596 = (int64_t) 0;
    int64_t clProc_35598 = (int64_t) 0;
    int64_t clProc_35599 = (int64_t) 0;
    int64_t current_partition_35613 = (int64_t) 0;
    int64_t prim_out_50193 = (int64_t) 0;
    int ret = 0;
    
    lock_lock(&ctx->lock);
    CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
    
    struct memblock_device mem_out_50192;
    
    mem_out_50192.references = NULL;
    
    struct memblock_device mem_out_50191;
    
    mem_out_50191.references = NULL;
    
    struct memblock_device toFlush_ids_mem_49400;
    
    toFlush_ids_mem_49400.references = NULL;
    
    struct memblock_device toFlush_dat_mem_49399;
    
    toFlush_dat_mem_49399.references = NULL;
    
    struct memblock_device toFlush_dat_mem_49398;
    
    toFlush_dat_mem_49398.references = NULL;
    
    struct memblock_device current_partition_mem_49397;
    
    current_partition_mem_49397.references = NULL;
    
    struct memblock_device current_partition_mem_49396;
    
    current_partition_mem_49396.references = NULL;
    
    struct memblock_device current_partition_mem_49395;
    
    current_partition_mem_49395.references = NULL;
    
    struct memblock_device current_partition_mem_49394;
    
    current_partition_mem_49394.references = NULL;
    
    struct memblock_device current_partition_mem_49393;
    
    current_partition_mem_49393.references = NULL;
    
    struct memblock_device current_partition_mem_49392;
    
    current_partition_mem_49392.references = NULL;
    
    struct memblock_device current_partition_mem_49391;
    
    current_partition_mem_49391.references = NULL;
    
    struct memblock_device current_partition_mem_49390;
    
    current_partition_mem_49390.references = NULL;
    
    struct memblock_device current_partition_mem_49389;
    
    current_partition_mem_49389.references = NULL;
    
    struct memblock_device current_partition_mem_49388;
    
    current_partition_mem_49388.references = NULL;
    
    struct memblock_device current_partition_mem_49387;
    
    current_partition_mem_49387.references = NULL;
    
    struct memblock_device current_partition_mem_49386;
    
    current_partition_mem_49386.references = NULL;
    
    struct memblock_device clProc_mem_49385;
    
    clProc_mem_49385.references = NULL;
    
    struct memblock_device clProc_mem_49384;
    
    clProc_mem_49384.references = NULL;
    
    struct memblock_device clProc_mem_49383;
    
    clProc_mem_49383.references = NULL;
    
    struct memblock_device clProc_mem_49382;
    
    clProc_mem_49382.references = NULL;
    
    struct memblock_device clProc_mem_49381;
    
    clProc_mem_49381.references = NULL;
    
    struct memblock_device clProc_mem_49380;
    
    clProc_mem_49380.references = NULL;
    
    struct memblock_device clBase_mem_49379;
    
    clBase_mem_49379.references = NULL;
    
    struct memblock_device clBase_mem_49378;
    
    clBase_mem_49378.references = NULL;
    
    struct memblock_device clBase_mem_49377;
    
    clBase_mem_49377.references = NULL;
    
    struct memblock_device clBase_mem_49376;
    
    clBase_mem_49376.references = NULL;
    
    struct memblock_device chain_collisions_mem_49375;
    
    chain_collisions_mem_49375.references = NULL;
    
    struct memblock_device chain_collisions_mem_49374;
    
    chain_collisions_mem_49374.references = NULL;
    chain_collisions_mem_49374 = in0->v0->mem;
    dz2084U_35570 = in0->v0->shape[0];
    chain_collisions_mem_49375 = in0->v1->mem;
    dz2084U_35570 = in0->v1->shape[0];
    clBase_35579 = in0->v2;
    clBase_35580 = in0->v3;
    clBase_35581 = in0->v4;
    clBase_35582 = in0->v5;
    clBase_mem_49376 = in0->v6->mem;
    clBase_35584 = in0->v7;
    clBase_mem_49377 = in0->v8->mem;
    clBase_mem_49378 = in0->v9->mem;
    clBase_35587 = in0->v10;
    clBase_mem_49379 = in0->v11->mem;
    clBase_35589 = in0->v12;
    clProc_mem_49380 = in0->v13->mem;
    dz2080U_35571 = in0->v13->shape[0];
    clProc_mem_49381 = in0->v14->mem;
    dz2081U_35572 = in0->v14->shape[0];
    clProc_mem_49382 = in0->v15->mem;
    dz2082U_35573 = in0->v15->shape[0];
    clProc_mem_49383 = in0->v16->mem;
    dz2082U_35573 = in0->v16->shape[0];
    clProc_35594 = in0->v17;
    clProc_35595 = in0->v18;
    clProc_35596 = in0->v19;
    clProc_mem_49384 = in0->v20->mem;
    part_no_35569 = in0->v20->shape[0];
    clProc_35598 = in0->v21;
    clProc_35599 = in0->v22;
    clProc_mem_49385 = in0->v23->mem;
    dz2083U_35574 = in0->v23->shape[0];
    current_partition_mem_49386 = in0->v24->mem;
    n_35568 = in0->v24->shape[0];
    current_partition_mem_49387 = in0->v25->mem;
    n_35568 = in0->v25->shape[0];
    current_partition_mem_49388 = in0->v26->mem;
    n_35568 = in0->v26->shape[0];
    current_partition_mem_49389 = in0->v27->mem;
    current_partition_mem_49390 = in0->v28->mem;
    current_partition_mem_49391 = in0->v29->mem;
    n_35568 = in0->v29->shape[0];
    current_partition_mem_49392 = in0->v30->mem;
    n_35568 = in0->v30->shape[0];
    current_partition_mem_49393 = in0->v31->mem;
    current_partition_mem_49394 = in0->v32->mem;
    n_35568 = in0->v32->shape[0];
    current_partition_mem_49395 = in0->v33->mem;
    current_partition_mem_49396 = in0->v34->mem;
    current_partition_mem_49397 = in0->v35->mem;
    current_partition_35613 = in0->v36;
    toFlush_dat_mem_49398 = in0->v37->mem;
    dz2085U_35575 = in0->v37->shape[0];
    toFlush_dat_mem_49399 = in0->v38->mem;
    dz2085U_35575 = in0->v38->shape[0];
    toFlush_ids_mem_49400 = in0->v39->mem;
    dz2086U_35576 = in0->v39->shape[0];
    if (!(dz2084U_35570 == in0->v0->shape[0] && (dz2084U_35570 == in0->v1->shape[0] && ((int64_t) 2 == in0->v6->shape[0] && ((int64_t) 2 == in0->v8->shape[0] && ((int64_t) 2 == in0->v9->shape[0] && ((int64_t) 2 == in0->v11->shape[0] && (dz2080U_35571 == in0->v13->shape[0] && (dz2081U_35572 == in0->v14->shape[0] && (dz2082U_35573 == in0->v15->shape[0] && (dz2082U_35573 == in0->v16->shape[0] && (part_no_35569 == in0->v20->shape[0] && (dz2083U_35574 == in0->v23->shape[0] && (n_35568 == in0->v24->shape[0] && (n_35568 == in0->v25->shape[0] && (n_35568 == in0->v26->shape[0] && ((int64_t) 2 == in0->v27->shape[0] && ((int64_t) 2 == in0->v28->shape[0] && (n_35568 == in0->v29->shape[0] && (n_35568 == in0->v30->shape[0] && ((int64_t) 8 == in0->v31->shape[0] && (n_35568 == in0->v32->shape[0] && ((int64_t) 2 == in0->v33->shape[0] && ((int64_t) 2 == in0->v34->shape[0] && ((int64_t) 8 == in0->v35->shape[0] && (dz2085U_35575 == in0->v37->shape[0] && (dz2085U_35575 == in0->v38->shape[0] && dz2086U_35576 == in0->v39->shape[0]))))))))))))))))))))))))))) {
        ret = 1;
        set_error(ctx, msgprintf("Error: entry point arguments have invalid sizes.\n"));
    }
    if (ret == 0) {
        ret = futrts_entry_make_collisions_compact_double(ctx, &mem_out_50191, &mem_out_50192, &prim_out_50193, chain_collisions_mem_49374, chain_collisions_mem_49375, clBase_mem_49376, clBase_mem_49377, clBase_mem_49378, clBase_mem_49379, clProc_mem_49380, clProc_mem_49381, clProc_mem_49382, clProc_mem_49383, clProc_mem_49384, clProc_mem_49385, current_partition_mem_49386, current_partition_mem_49387, current_partition_mem_49388, current_partition_mem_49389, current_partition_mem_49390, current_partition_mem_49391, current_partition_mem_49392, current_partition_mem_49393, current_partition_mem_49394, current_partition_mem_49395, current_partition_mem_49396, current_partition_mem_49397, toFlush_dat_mem_49398, toFlush_dat_mem_49399, toFlush_ids_mem_49400, n_35568, part_no_35569, dz2084U_35570, dz2080U_35571, dz2081U_35572, dz2082U_35573, dz2083U_35574, dz2085U_35575, dz2086U_35576, clBase_35579, clBase_35580, clBase_35581, clBase_35582, clBase_35584, clBase_35587, clBase_35589, clProc_35594, clProc_35595, clProc_35596, clProc_35598, clProc_35599, current_partition_35613);
        if (ret == 0) {
            struct memblock_device counters_mem_50201 = ctx->constants->counters_mem_50201;
            struct memblock_device counters_mem_50275 = ctx->constants->counters_mem_50275;
            struct memblock_device counters_mem_50707 = ctx->constants->counters_mem_50707;
            struct memblock_device counters_mem_51122 = ctx->constants->counters_mem_51122;
            struct memblock_device counters_mem_51145 = ctx->constants->counters_mem_51145;
            struct memblock_device counters_mem_51184 = ctx->constants->counters_mem_51184;
            struct memblock_device counters_mem_51873 = ctx->constants->counters_mem_51873;
            struct memblock_device counters_mem_52032 = ctx->constants->counters_mem_52032;
            struct memblock_device global_dynid_mem_50266 = ctx->constants->global_dynid_mem_50266;
            struct memblock_device global_dynid_mem_50275 = ctx->constants->global_dynid_mem_50275;
            struct memblock_device global_dynid_mem_50287 = ctx->constants->global_dynid_mem_50287;
            struct memblock_device global_dynid_mem_50292 = ctx->constants->global_dynid_mem_50292;
            struct memblock_device global_dynid_mem_50450 = ctx->constants->global_dynid_mem_50450;
            struct memblock_device global_dynid_mem_50529 = ctx->constants->global_dynid_mem_50529;
            struct memblock_device global_dynid_mem_50570 = ctx->constants->global_dynid_mem_50570;
            struct memblock_device global_dynid_mem_50733 = ctx->constants->global_dynid_mem_50733;
            struct memblock_device global_dynid_mem_50769 = ctx->constants->global_dynid_mem_50769;
            struct memblock_device global_dynid_mem_50871 = ctx->constants->global_dynid_mem_50871;
            struct memblock_device global_dynid_mem_50875 = ctx->constants->global_dynid_mem_50875;
            struct memblock_device global_dynid_mem_50988 = ctx->constants->global_dynid_mem_50988;
            struct memblock_device global_dynid_mem_51231 = ctx->constants->global_dynid_mem_51231;
            struct memblock_device global_dynid_mem_51378 = ctx->constants->global_dynid_mem_51378;
            struct memblock_device global_dynid_mem_51534 = ctx->constants->global_dynid_mem_51534;
            struct memblock_device global_dynid_mem_51651 = ctx->constants->global_dynid_mem_51651;
            
            assert((*out0 = (struct futhark_opaque_collisionTable *) malloc(sizeof(struct futhark_opaque_collisionTable))) != NULL);
            assert(((*out0)->v0 = (struct futhark_i64_1d *) malloc(sizeof(struct futhark_i64_1d))) != NULL);
            (*out0)->v0->mem = mem_out_50191;
            (*out0)->v0->shape[0] = prim_out_50193;
            assert(((*out0)->v1 = (struct futhark_i64_1d *) malloc(sizeof(struct futhark_i64_1d))) != NULL);
            (*out0)->v1->mem = mem_out_50192;
            (*out0)->v1->shape[0] = prim_out_50193;
        }
    }
    CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
    lock_unlock(&ctx->lock);
    return ret;
}
int futhark_entry_mk_dbcHandler_double(struct futhark_context *ctx, struct futhark_opaque_dbcHandler_double **out0, const double in0, const double in1, const double in2, const double in3, const int64_t in4, const int64_t in5, const bool in6, const bool in7, const double in8, const double in9, const int64_t in10, const int64_t in11)
{
    double min_x_22265 = 0.0;
    double min_y_22266 = 0.0;
    double max_x_22267 = 0.0;
    double max_y_22268 = 0.0;
    int64_t parts_x_22269 = (int64_t) 0;
    int64_t parts_y_22270 = (int64_t) 0;
    bool isEuclidean_22271 = 0;
    bool isRadians_22272 = 0;
    double radius_22273 = 0.0;
    double eps_22274 = 0.0;
    int64_t minPts_22275 = (int64_t) 0;
    int64_t m_sizze_22276 = (int64_t) 0;
    int64_t prim_out_50218 = (int64_t) 0;
    int8_t prim_out_50219 = (int8_t) 0;
    int8_t prim_out_50220 = (int8_t) 0;
    double prim_out_50221 = 0.0;
    int64_t prim_out_50222 = (int64_t) 0;
    int64_t prim_out_50223 = (int64_t) 0;
    double prim_out_50224 = 0.0;
    int64_t prim_out_50225 = (int64_t) 0;
    int64_t prim_out_50226 = (int64_t) 0;
    int64_t prim_out_50227 = (int64_t) 0;
    int64_t prim_out_50228 = (int64_t) 0;
    int64_t prim_out_50229 = (int64_t) 0;
    int64_t prim_out_50230 = (int64_t) 0;
    int64_t prim_out_50231 = (int64_t) 0;
    int ret = 0;
    
    lock_lock(&ctx->lock);
    CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
    
    struct memblock_device mem_out_50217;
    
    mem_out_50217.references = NULL;
    
    struct memblock_device mem_out_50216;
    
    mem_out_50216.references = NULL;
    
    struct memblock_device mem_out_50215;
    
    mem_out_50215.references = NULL;
    
    struct memblock_device mem_out_50214;
    
    mem_out_50214.references = NULL;
    
    struct memblock_device mem_out_50213;
    
    mem_out_50213.references = NULL;
    
    struct memblock_device mem_out_50212;
    
    mem_out_50212.references = NULL;
    
    struct memblock_device mem_out_50211;
    
    mem_out_50211.references = NULL;
    
    struct memblock_device mem_out_50210;
    
    mem_out_50210.references = NULL;
    
    struct memblock_device mem_out_50209;
    
    mem_out_50209.references = NULL;
    
    struct memblock_device mem_out_50208;
    
    mem_out_50208.references = NULL;
    
    struct memblock_device mem_out_50207;
    
    mem_out_50207.references = NULL;
    
    struct memblock_device mem_out_50206;
    
    mem_out_50206.references = NULL;
    
    struct memblock_device mem_out_50205;
    
    mem_out_50205.references = NULL;
    
    struct memblock_device mem_out_50204;
    
    mem_out_50204.references = NULL;
    
    struct memblock_device mem_out_50203;
    
    mem_out_50203.references = NULL;
    
    struct memblock_device mem_out_50202;
    
    mem_out_50202.references = NULL;
    
    struct memblock_device mem_out_50201;
    
    mem_out_50201.references = NULL;
    
    struct memblock_device mem_out_50200;
    
    mem_out_50200.references = NULL;
    
    struct memblock_device mem_out_50199;
    
    mem_out_50199.references = NULL;
    
    struct memblock_device mem_out_50198;
    
    mem_out_50198.references = NULL;
    
    struct memblock_device mem_out_50197;
    
    mem_out_50197.references = NULL;
    
    struct memblock_device mem_out_50196;
    
    mem_out_50196.references = NULL;
    
    struct memblock_device mem_out_50195;
    
    mem_out_50195.references = NULL;
    
    struct memblock_device mem_out_50194;
    
    mem_out_50194.references = NULL;
    
    struct memblock_device mem_out_50193;
    
    mem_out_50193.references = NULL;
    
    struct memblock_device mem_out_50192;
    
    mem_out_50192.references = NULL;
    
    struct memblock_device mem_out_50191;
    
    mem_out_50191.references = NULL;
    min_x_22265 = in0;
    min_y_22266 = in1;
    max_x_22267 = in2;
    max_y_22268 = in3;
    parts_x_22269 = in4;
    parts_y_22270 = in5;
    isEuclidean_22271 = in6;
    isRadians_22272 = in7;
    radius_22273 = in8;
    eps_22274 = in9;
    minPts_22275 = in10;
    m_sizze_22276 = in11;
    if (ret == 0) {
        ret = futrts_entry_mk_dbcHandler_double(ctx, &mem_out_50191, &mem_out_50192, &mem_out_50193, &mem_out_50194, &mem_out_50195, &mem_out_50196, &mem_out_50197, &mem_out_50198, &mem_out_50199, &mem_out_50200, &mem_out_50201, &mem_out_50202, &mem_out_50203, &mem_out_50204, &mem_out_50205, &mem_out_50206, &mem_out_50207, &mem_out_50208, &mem_out_50209, &mem_out_50210, &mem_out_50211, &mem_out_50212, &mem_out_50213, &mem_out_50214, &mem_out_50215, &mem_out_50216, &mem_out_50217, &prim_out_50218, &prim_out_50219, &prim_out_50220, &prim_out_50221, &prim_out_50222, &prim_out_50223, &prim_out_50224, &prim_out_50225, &prim_out_50226, &prim_out_50227, &prim_out_50228, &prim_out_50229, &prim_out_50230, &prim_out_50231, min_x_22265, min_y_22266, max_x_22267, max_y_22268, parts_x_22269, parts_y_22270, isEuclidean_22271, isRadians_22272, radius_22273, eps_22274, minPts_22275, m_sizze_22276);
        if (ret == 0) {
            struct memblock_device counters_mem_50201 = ctx->constants->counters_mem_50201;
            struct memblock_device counters_mem_50275 = ctx->constants->counters_mem_50275;
            struct memblock_device counters_mem_50707 = ctx->constants->counters_mem_50707;
            struct memblock_device counters_mem_51122 = ctx->constants->counters_mem_51122;
            struct memblock_device counters_mem_51145 = ctx->constants->counters_mem_51145;
            struct memblock_device counters_mem_51184 = ctx->constants->counters_mem_51184;
            struct memblock_device counters_mem_51873 = ctx->constants->counters_mem_51873;
            struct memblock_device counters_mem_52032 = ctx->constants->counters_mem_52032;
            struct memblock_device global_dynid_mem_50266 = ctx->constants->global_dynid_mem_50266;
            struct memblock_device global_dynid_mem_50275 = ctx->constants->global_dynid_mem_50275;
            struct memblock_device global_dynid_mem_50287 = ctx->constants->global_dynid_mem_50287;
            struct memblock_device global_dynid_mem_50292 = ctx->constants->global_dynid_mem_50292;
            struct memblock_device global_dynid_mem_50450 = ctx->constants->global_dynid_mem_50450;
            struct memblock_device global_dynid_mem_50529 = ctx->constants->global_dynid_mem_50529;
            struct memblock_device global_dynid_mem_50570 = ctx->constants->global_dynid_mem_50570;
            struct memblock_device global_dynid_mem_50733 = ctx->constants->global_dynid_mem_50733;
            struct memblock_device global_dynid_mem_50769 = ctx->constants->global_dynid_mem_50769;
            struct memblock_device global_dynid_mem_50871 = ctx->constants->global_dynid_mem_50871;
            struct memblock_device global_dynid_mem_50875 = ctx->constants->global_dynid_mem_50875;
            struct memblock_device global_dynid_mem_50988 = ctx->constants->global_dynid_mem_50988;
            struct memblock_device global_dynid_mem_51231 = ctx->constants->global_dynid_mem_51231;
            struct memblock_device global_dynid_mem_51378 = ctx->constants->global_dynid_mem_51378;
            struct memblock_device global_dynid_mem_51534 = ctx->constants->global_dynid_mem_51534;
            struct memblock_device global_dynid_mem_51651 = ctx->constants->global_dynid_mem_51651;
            
            assert((*out0 = (struct futhark_opaque_dbcHandler_double *) malloc(sizeof(struct futhark_opaque_dbcHandler_double))) != NULL);
            assert(((*out0)->v0 = (struct futhark_i64_1d *) malloc(sizeof(struct futhark_i64_1d))) != NULL);
            (*out0)->v0->mem = mem_out_50191;
            (*out0)->v0->shape[0] = (int64_t) 0;
            assert(((*out0)->v1 = (struct futhark_i64_1d *) malloc(sizeof(struct futhark_i64_1d))) != NULL);
            (*out0)->v1->mem = mem_out_50192;
            (*out0)->v1->shape[0] = (int64_t) 0;
            (*out0)->v2 = prim_out_50219;
            (*out0)->v3 = prim_out_50220;
            (*out0)->v4 = prim_out_50221;
            (*out0)->v5 = prim_out_50222;
            assert(((*out0)->v6 = (struct futhark_f64_1d *) malloc(sizeof(struct futhark_f64_1d))) != NULL);
            (*out0)->v6->mem = mem_out_50193;
            (*out0)->v6->shape[0] = (int64_t) 2;
            (*out0)->v7 = prim_out_50223;
            assert(((*out0)->v8 = (struct futhark_f64_1d *) malloc(sizeof(struct futhark_f64_1d))) != NULL);
            (*out0)->v8->mem = mem_out_50194;
            (*out0)->v8->shape[0] = (int64_t) 2;
            assert(((*out0)->v9 = (struct futhark_i64_1d *) malloc(sizeof(struct futhark_i64_1d))) != NULL);
            (*out0)->v9->mem = mem_out_50195;
            (*out0)->v9->shape[0] = (int64_t) 2;
            (*out0)->v10 = prim_out_50224;
            assert(((*out0)->v11 = (struct futhark_f64_1d *) malloc(sizeof(struct futhark_f64_1d))) != NULL);
            (*out0)->v11->mem = mem_out_50196;
            (*out0)->v11->shape[0] = (int64_t) 2;
            (*out0)->v12 = prim_out_50225;
            assert(((*out0)->v13 = (struct futhark_bool_1d *) malloc(sizeof(struct futhark_bool_1d))) != NULL);
            (*out0)->v13->mem = mem_out_50197;
            (*out0)->v13->shape[0] = (int64_t) 0;
            assert(((*out0)->v14 = (struct futhark_i64_1d *) malloc(sizeof(struct futhark_i64_1d))) != NULL);
            (*out0)->v14->mem = mem_out_50198;
            (*out0)->v14->shape[0] = (int64_t) 0;
            assert(((*out0)->v15 = (struct futhark_f64_1d *) malloc(sizeof(struct futhark_f64_1d))) != NULL);
            (*out0)->v15->mem = mem_out_50199;
            (*out0)->v15->shape[0] = (int64_t) 0;
            assert(((*out0)->v16 = (struct futhark_f64_1d *) malloc(sizeof(struct futhark_f64_1d))) != NULL);
            (*out0)->v16->mem = mem_out_50200;
            (*out0)->v16->shape[0] = (int64_t) 0;
            (*out0)->v17 = prim_out_50226;
            (*out0)->v18 = prim_out_50227;
            (*out0)->v19 = prim_out_50228;
            assert(((*out0)->v20 = (struct futhark_bool_1d *) malloc(sizeof(struct futhark_bool_1d))) != NULL);
            (*out0)->v20->mem = mem_out_50201;
            (*out0)->v20->shape[0] = prim_out_50218;
            (*out0)->v21 = prim_out_50229;
            (*out0)->v22 = prim_out_50230;
            assert(((*out0)->v23 = (struct futhark_i64_1d *) malloc(sizeof(struct futhark_i64_1d))) != NULL);
            (*out0)->v23->mem = mem_out_50202;
            (*out0)->v23->shape[0] = (int64_t) 0;
            assert(((*out0)->v24 = (struct futhark_i64_1d *) malloc(sizeof(struct futhark_i64_1d))) != NULL);
            (*out0)->v24->mem = mem_out_50203;
            (*out0)->v24->shape[0] = (int64_t) 0;
            assert(((*out0)->v25 = (struct futhark_f64_1d *) malloc(sizeof(struct futhark_f64_1d))) != NULL);
            (*out0)->v25->mem = mem_out_50204;
            (*out0)->v25->shape[0] = (int64_t) 0;
            assert(((*out0)->v26 = (struct futhark_f64_1d *) malloc(sizeof(struct futhark_f64_1d))) != NULL);
            (*out0)->v26->mem = mem_out_50205;
            (*out0)->v26->shape[0] = (int64_t) 0;
            assert(((*out0)->v27 = (struct futhark_f64_1d *) malloc(sizeof(struct futhark_f64_1d))) != NULL);
            (*out0)->v27->mem = mem_out_50206;
            (*out0)->v27->shape[0] = (int64_t) 2;
            assert(((*out0)->v28 = (struct futhark_f64_1d *) malloc(sizeof(struct futhark_f64_1d))) != NULL);
            (*out0)->v28->mem = mem_out_50207;
            (*out0)->v28->shape[0] = (int64_t) 2;
            assert(((*out0)->v29 = (struct futhark_bool_1d *) malloc(sizeof(struct futhark_bool_1d))) != NULL);
            (*out0)->v29->mem = mem_out_50208;
            (*out0)->v29->shape[0] = (int64_t) 0;
            assert(((*out0)->v30 = (struct futhark_bool_1d *) malloc(sizeof(struct futhark_bool_1d))) != NULL);
            (*out0)->v30->mem = mem_out_50209;
            (*out0)->v30->shape[0] = (int64_t) 0;
            assert(((*out0)->v31 = (struct futhark_bool_1d *) malloc(sizeof(struct futhark_bool_1d))) != NULL);
            (*out0)->v31->mem = mem_out_50210;
            (*out0)->v31->shape[0] = (int64_t) 8;
            assert(((*out0)->v32 = (struct futhark_bool_1d *) malloc(sizeof(struct futhark_bool_1d))) != NULL);
            (*out0)->v32->mem = mem_out_50211;
            (*out0)->v32->shape[0] = (int64_t) 0;
            assert(((*out0)->v33 = (struct futhark_f64_1d *) malloc(sizeof(struct futhark_f64_1d))) != NULL);
            (*out0)->v33->mem = mem_out_50212;
            (*out0)->v33->shape[0] = (int64_t) 2;
            assert(((*out0)->v34 = (struct futhark_f64_1d *) malloc(sizeof(struct futhark_f64_1d))) != NULL);
            (*out0)->v34->mem = mem_out_50213;
            (*out0)->v34->shape[0] = (int64_t) 2;
            assert(((*out0)->v35 = (struct futhark_i64_1d *) malloc(sizeof(struct futhark_i64_1d))) != NULL);
            (*out0)->v35->mem = mem_out_50214;
            (*out0)->v35->shape[0] = (int64_t) 8;
            (*out0)->v36 = prim_out_50231;
            assert(((*out0)->v37 = (struct futhark_f64_1d *) malloc(sizeof(struct futhark_f64_1d))) != NULL);
            (*out0)->v37->mem = mem_out_50215;
            (*out0)->v37->shape[0] = (int64_t) 0;
            assert(((*out0)->v38 = (struct futhark_f64_1d *) malloc(sizeof(struct futhark_f64_1d))) != NULL);
            (*out0)->v38->mem = mem_out_50216;
            (*out0)->v38->shape[0] = (int64_t) 0;
            assert(((*out0)->v39 = (struct futhark_i64_1d *) malloc(sizeof(struct futhark_i64_1d))) != NULL);
            (*out0)->v39->mem = mem_out_50217;
            (*out0)->v39->shape[0] = (int64_t) 0;
        }
    }
    CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
    lock_unlock(&ctx->lock);
    return ret;
}
int futhark_entry_next_partition_to_read_double(struct futhark_context *ctx, int64_t *out0, const struct futhark_opaque_dbcHandler_double *in0)
{
    int64_t n_22872 = (int64_t) 0;
    int64_t part_no_22873 = (int64_t) 0;
    int64_t dz2084U_22874 = (int64_t) 0;
    int64_t dz2080U_22875 = (int64_t) 0;
    int64_t dz2081U_22876 = (int64_t) 0;
    int64_t dz2082U_22877 = (int64_t) 0;
    int64_t dz2083U_22878 = (int64_t) 0;
    int64_t dz2085U_22879 = (int64_t) 0;
    int64_t dz2086U_22880 = (int64_t) 0;
    int8_t clBase_22883 = (int8_t) 0;
    int8_t clBase_22884 = (int8_t) 0;
    double clBase_22885 = 0.0;
    int64_t clBase_22886 = (int64_t) 0;
    int64_t clBase_22888 = (int64_t) 0;
    double clBase_22891 = 0.0;
    int64_t clBase_22893 = (int64_t) 0;
    int64_t clProc_22898 = (int64_t) 0;
    int64_t clProc_22899 = (int64_t) 0;
    int64_t clProc_22900 = (int64_t) 0;
    int64_t clProc_22902 = (int64_t) 0;
    int64_t clProc_22903 = (int64_t) 0;
    int64_t current_partition_22917 = (int64_t) 0;
    int64_t prim_out_50191 = (int64_t) 0;
    int ret = 0;
    
    lock_lock(&ctx->lock);
    CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
    
    struct memblock_device toFlush_ids_mem_49400;
    
    toFlush_ids_mem_49400.references = NULL;
    
    struct memblock_device toFlush_dat_mem_49399;
    
    toFlush_dat_mem_49399.references = NULL;
    
    struct memblock_device toFlush_dat_mem_49398;
    
    toFlush_dat_mem_49398.references = NULL;
    
    struct memblock_device current_partition_mem_49397;
    
    current_partition_mem_49397.references = NULL;
    
    struct memblock_device current_partition_mem_49396;
    
    current_partition_mem_49396.references = NULL;
    
    struct memblock_device current_partition_mem_49395;
    
    current_partition_mem_49395.references = NULL;
    
    struct memblock_device current_partition_mem_49394;
    
    current_partition_mem_49394.references = NULL;
    
    struct memblock_device current_partition_mem_49393;
    
    current_partition_mem_49393.references = NULL;
    
    struct memblock_device current_partition_mem_49392;
    
    current_partition_mem_49392.references = NULL;
    
    struct memblock_device current_partition_mem_49391;
    
    current_partition_mem_49391.references = NULL;
    
    struct memblock_device current_partition_mem_49390;
    
    current_partition_mem_49390.references = NULL;
    
    struct memblock_device current_partition_mem_49389;
    
    current_partition_mem_49389.references = NULL;
    
    struct memblock_device current_partition_mem_49388;
    
    current_partition_mem_49388.references = NULL;
    
    struct memblock_device current_partition_mem_49387;
    
    current_partition_mem_49387.references = NULL;
    
    struct memblock_device current_partition_mem_49386;
    
    current_partition_mem_49386.references = NULL;
    
    struct memblock_device clProc_mem_49385;
    
    clProc_mem_49385.references = NULL;
    
    struct memblock_device clProc_mem_49384;
    
    clProc_mem_49384.references = NULL;
    
    struct memblock_device clProc_mem_49383;
    
    clProc_mem_49383.references = NULL;
    
    struct memblock_device clProc_mem_49382;
    
    clProc_mem_49382.references = NULL;
    
    struct memblock_device clProc_mem_49381;
    
    clProc_mem_49381.references = NULL;
    
    struct memblock_device clProc_mem_49380;
    
    clProc_mem_49380.references = NULL;
    
    struct memblock_device clBase_mem_49379;
    
    clBase_mem_49379.references = NULL;
    
    struct memblock_device clBase_mem_49378;
    
    clBase_mem_49378.references = NULL;
    
    struct memblock_device clBase_mem_49377;
    
    clBase_mem_49377.references = NULL;
    
    struct memblock_device clBase_mem_49376;
    
    clBase_mem_49376.references = NULL;
    
    struct memblock_device chain_collisions_mem_49375;
    
    chain_collisions_mem_49375.references = NULL;
    
    struct memblock_device chain_collisions_mem_49374;
    
    chain_collisions_mem_49374.references = NULL;
    chain_collisions_mem_49374 = in0->v0->mem;
    dz2084U_22874 = in0->v0->shape[0];
    chain_collisions_mem_49375 = in0->v1->mem;
    dz2084U_22874 = in0->v1->shape[0];
    clBase_22883 = in0->v2;
    clBase_22884 = in0->v3;
    clBase_22885 = in0->v4;
    clBase_22886 = in0->v5;
    clBase_mem_49376 = in0->v6->mem;
    clBase_22888 = in0->v7;
    clBase_mem_49377 = in0->v8->mem;
    clBase_mem_49378 = in0->v9->mem;
    clBase_22891 = in0->v10;
    clBase_mem_49379 = in0->v11->mem;
    clBase_22893 = in0->v12;
    clProc_mem_49380 = in0->v13->mem;
    dz2080U_22875 = in0->v13->shape[0];
    clProc_mem_49381 = in0->v14->mem;
    dz2081U_22876 = in0->v14->shape[0];
    clProc_mem_49382 = in0->v15->mem;
    dz2082U_22877 = in0->v15->shape[0];
    clProc_mem_49383 = in0->v16->mem;
    dz2082U_22877 = in0->v16->shape[0];
    clProc_22898 = in0->v17;
    clProc_22899 = in0->v18;
    clProc_22900 = in0->v19;
    clProc_mem_49384 = in0->v20->mem;
    part_no_22873 = in0->v20->shape[0];
    clProc_22902 = in0->v21;
    clProc_22903 = in0->v22;
    clProc_mem_49385 = in0->v23->mem;
    dz2083U_22878 = in0->v23->shape[0];
    current_partition_mem_49386 = in0->v24->mem;
    n_22872 = in0->v24->shape[0];
    current_partition_mem_49387 = in0->v25->mem;
    n_22872 = in0->v25->shape[0];
    current_partition_mem_49388 = in0->v26->mem;
    n_22872 = in0->v26->shape[0];
    current_partition_mem_49389 = in0->v27->mem;
    current_partition_mem_49390 = in0->v28->mem;
    current_partition_mem_49391 = in0->v29->mem;
    n_22872 = in0->v29->shape[0];
    current_partition_mem_49392 = in0->v30->mem;
    n_22872 = in0->v30->shape[0];
    current_partition_mem_49393 = in0->v31->mem;
    current_partition_mem_49394 = in0->v32->mem;
    n_22872 = in0->v32->shape[0];
    current_partition_mem_49395 = in0->v33->mem;
    current_partition_mem_49396 = in0->v34->mem;
    current_partition_mem_49397 = in0->v35->mem;
    current_partition_22917 = in0->v36;
    toFlush_dat_mem_49398 = in0->v37->mem;
    dz2085U_22879 = in0->v37->shape[0];
    toFlush_dat_mem_49399 = in0->v38->mem;
    dz2085U_22879 = in0->v38->shape[0];
    toFlush_ids_mem_49400 = in0->v39->mem;
    dz2086U_22880 = in0->v39->shape[0];
    if (!(dz2084U_22874 == in0->v0->shape[0] && (dz2084U_22874 == in0->v1->shape[0] && ((int64_t) 2 == in0->v6->shape[0] && ((int64_t) 2 == in0->v8->shape[0] && ((int64_t) 2 == in0->v9->shape[0] && ((int64_t) 2 == in0->v11->shape[0] && (dz2080U_22875 == in0->v13->shape[0] && (dz2081U_22876 == in0->v14->shape[0] && (dz2082U_22877 == in0->v15->shape[0] && (dz2082U_22877 == in0->v16->shape[0] && (part_no_22873 == in0->v20->shape[0] && (dz2083U_22878 == in0->v23->shape[0] && (n_22872 == in0->v24->shape[0] && (n_22872 == in0->v25->shape[0] && (n_22872 == in0->v26->shape[0] && ((int64_t) 2 == in0->v27->shape[0] && ((int64_t) 2 == in0->v28->shape[0] && (n_22872 == in0->v29->shape[0] && (n_22872 == in0->v30->shape[0] && ((int64_t) 8 == in0->v31->shape[0] && (n_22872 == in0->v32->shape[0] && ((int64_t) 2 == in0->v33->shape[0] && ((int64_t) 2 == in0->v34->shape[0] && ((int64_t) 8 == in0->v35->shape[0] && (dz2085U_22879 == in0->v37->shape[0] && (dz2085U_22879 == in0->v38->shape[0] && dz2086U_22880 == in0->v39->shape[0]))))))))))))))))))))))))))) {
        ret = 1;
        set_error(ctx, msgprintf("Error: entry point arguments have invalid sizes.\n"));
    }
    if (ret == 0) {
        ret = futrts_entry_next_partition_to_read_double(ctx, &prim_out_50191, chain_collisions_mem_49374, chain_collisions_mem_49375, clBase_mem_49376, clBase_mem_49377, clBase_mem_49378, clBase_mem_49379, clProc_mem_49380, clProc_mem_49381, clProc_mem_49382, clProc_mem_49383, clProc_mem_49384, clProc_mem_49385, current_partition_mem_49386, current_partition_mem_49387, current_partition_mem_49388, current_partition_mem_49389, current_partition_mem_49390, current_partition_mem_49391, current_partition_mem_49392, current_partition_mem_49393, current_partition_mem_49394, current_partition_mem_49395, current_partition_mem_49396, current_partition_mem_49397, toFlush_dat_mem_49398, toFlush_dat_mem_49399, toFlush_ids_mem_49400, n_22872, part_no_22873, dz2084U_22874, dz2080U_22875, dz2081U_22876, dz2082U_22877, dz2083U_22878, dz2085U_22879, dz2086U_22880, clBase_22883, clBase_22884, clBase_22885, clBase_22886, clBase_22888, clBase_22891, clBase_22893, clProc_22898, clProc_22899, clProc_22900, clProc_22902, clProc_22903, current_partition_22917);
        if (ret == 0) {
            struct memblock_device counters_mem_50201 = ctx->constants->counters_mem_50201;
            struct memblock_device counters_mem_50275 = ctx->constants->counters_mem_50275;
            struct memblock_device counters_mem_50707 = ctx->constants->counters_mem_50707;
            struct memblock_device counters_mem_51122 = ctx->constants->counters_mem_51122;
            struct memblock_device counters_mem_51145 = ctx->constants->counters_mem_51145;
            struct memblock_device counters_mem_51184 = ctx->constants->counters_mem_51184;
            struct memblock_device counters_mem_51873 = ctx->constants->counters_mem_51873;
            struct memblock_device counters_mem_52032 = ctx->constants->counters_mem_52032;
            struct memblock_device global_dynid_mem_50266 = ctx->constants->global_dynid_mem_50266;
            struct memblock_device global_dynid_mem_50275 = ctx->constants->global_dynid_mem_50275;
            struct memblock_device global_dynid_mem_50287 = ctx->constants->global_dynid_mem_50287;
            struct memblock_device global_dynid_mem_50292 = ctx->constants->global_dynid_mem_50292;
            struct memblock_device global_dynid_mem_50450 = ctx->constants->global_dynid_mem_50450;
            struct memblock_device global_dynid_mem_50529 = ctx->constants->global_dynid_mem_50529;
            struct memblock_device global_dynid_mem_50570 = ctx->constants->global_dynid_mem_50570;
            struct memblock_device global_dynid_mem_50733 = ctx->constants->global_dynid_mem_50733;
            struct memblock_device global_dynid_mem_50769 = ctx->constants->global_dynid_mem_50769;
            struct memblock_device global_dynid_mem_50871 = ctx->constants->global_dynid_mem_50871;
            struct memblock_device global_dynid_mem_50875 = ctx->constants->global_dynid_mem_50875;
            struct memblock_device global_dynid_mem_50988 = ctx->constants->global_dynid_mem_50988;
            struct memblock_device global_dynid_mem_51231 = ctx->constants->global_dynid_mem_51231;
            struct memblock_device global_dynid_mem_51378 = ctx->constants->global_dynid_mem_51378;
            struct memblock_device global_dynid_mem_51534 = ctx->constants->global_dynid_mem_51534;
            struct memblock_device global_dynid_mem_51651 = ctx->constants->global_dynid_mem_51651;
            
            *out0 = prim_out_50191;
        }
    }
    CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
    lock_unlock(&ctx->lock);
    return ret;
}
int futhark_entry_rectify_partition_ids_double(struct futhark_context *ctx, struct futhark_i64_1d **out0, const struct futhark_i64_1d *in0, const struct futhark_opaque_collisionTable *in1, const int64_t in2)
{
    int64_t n_35911 = (int64_t) 0;
    int64_t dz2081Uz2080U_35912 = (int64_t) 0;
    int64_t dz2081Uz2081U_35913 = (int64_t) 0;
    int64_t m_sizze_35917 = (int64_t) 0;
    int ret = 0;
    
    lock_lock(&ctx->lock);
    CUDA_SUCCEED_FATAL(cuCtxPushCurrent(ctx->cu_ctx));
    
    struct memblock_device mem_out_50191;
    
    mem_out_50191.references = NULL;
    
    struct memblock_device replaceWith_mem_49376;
    
    replaceWith_mem_49376.references = NULL;
    
    struct memblock_device chain_id_mem_49375;
    
    chain_id_mem_49375.references = NULL;
    
    struct memblock_device partition_ids_mem_49374;
    
    partition_ids_mem_49374.references = NULL;
    partition_ids_mem_49374 = in0->mem;
    n_35911 = in0->shape[0];
    chain_id_mem_49375 = in1->v0->mem;
    dz2081Uz2080U_35912 = in1->v0->shape[0];
    replaceWith_mem_49376 = in1->v1->mem;
    dz2081Uz2081U_35913 = in1->v1->shape[0];
    m_sizze_35917 = in2;
    if (!(n_35911 == in0->shape[0] && (dz2081Uz2080U_35912 == in1->v0->shape[0] && dz2081Uz2081U_35913 == in1->v1->shape[0]))) {
        ret = 1;
        set_error(ctx, msgprintf("Error: entry point arguments have invalid sizes.\n"));
    }
    if (ret == 0) {
        ret = futrts_entry_rectify_partition_ids_double(ctx, &mem_out_50191, partition_ids_mem_49374, chain_id_mem_49375, replaceWith_mem_49376, n_35911, dz2081Uz2080U_35912, dz2081Uz2081U_35913, m_sizze_35917);
        if (ret == 0) {
            struct memblock_device counters_mem_50201 = ctx->constants->counters_mem_50201;
            struct memblock_device counters_mem_50275 = ctx->constants->counters_mem_50275;
            struct memblock_device counters_mem_50707 = ctx->constants->counters_mem_50707;
            struct memblock_device counters_mem_51122 = ctx->constants->counters_mem_51122;
            struct memblock_device counters_mem_51145 = ctx->constants->counters_mem_51145;
            struct memblock_device counters_mem_51184 = ctx->constants->counters_mem_51184;
            struct memblock_device counters_mem_51873 = ctx->constants->counters_mem_51873;
            struct memblock_device counters_mem_52032 = ctx->constants->counters_mem_52032;
            struct memblock_device global_dynid_mem_50266 = ctx->constants->global_dynid_mem_50266;
            struct memblock_device global_dynid_mem_50275 = ctx->constants->global_dynid_mem_50275;
            struct memblock_device global_dynid_mem_50287 = ctx->constants->global_dynid_mem_50287;
            struct memblock_device global_dynid_mem_50292 = ctx->constants->global_dynid_mem_50292;
            struct memblock_device global_dynid_mem_50450 = ctx->constants->global_dynid_mem_50450;
            struct memblock_device global_dynid_mem_50529 = ctx->constants->global_dynid_mem_50529;
            struct memblock_device global_dynid_mem_50570 = ctx->constants->global_dynid_mem_50570;
            struct memblock_device global_dynid_mem_50733 = ctx->constants->global_dynid_mem_50733;
            struct memblock_device global_dynid_mem_50769 = ctx->constants->global_dynid_mem_50769;
            struct memblock_device global_dynid_mem_50871 = ctx->constants->global_dynid_mem_50871;
            struct memblock_device global_dynid_mem_50875 = ctx->constants->global_dynid_mem_50875;
            struct memblock_device global_dynid_mem_50988 = ctx->constants->global_dynid_mem_50988;
            struct memblock_device global_dynid_mem_51231 = ctx->constants->global_dynid_mem_51231;
            struct memblock_device global_dynid_mem_51378 = ctx->constants->global_dynid_mem_51378;
            struct memblock_device global_dynid_mem_51534 = ctx->constants->global_dynid_mem_51534;
            struct memblock_device global_dynid_mem_51651 = ctx->constants->global_dynid_mem_51651;
            
            assert((*out0 = (struct futhark_i64_1d *) malloc(sizeof(struct futhark_i64_1d))) != NULL);
            (*out0)->mem = mem_out_50191;
            (*out0)->shape[0] = n_35911;
        }
    }
    CUDA_SUCCEED_FATAL(cuCtxPopCurrent(&ctx->cu_ctx));
    lock_unlock(&ctx->lock);
    return ret;
}
  
